/*! For license information please see jbfnxa.9.c41dfb15.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[9],{10916:function(O,f){!function(O){"use strict";var f=function(O,y){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(O,f){O.__proto__=f}||function(O,f){for(var y in f)Object.prototype.hasOwnProperty.call(f,y)&&(O[y]=f[y])},f(O,y)};function y(O,y){if("function"!==typeof y&&null!==y)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");function S(){this.constructor=O}f(O,y),O.prototype=null===y?Object.create(y):(S.prototype=y.prototype,new S)}function S(O,f,y,S){var H,b=arguments.length,h=b<3?f:null===S?S=Object.getOwnPropertyDescriptor(f,y):S;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)h=Reflect.decorate(O,f,y,S);else for(var v=O.length-1;v>=0;v--)(H=O[v])&&(h=(b<3?H(h):b>3?H(f,y,h):H(f,y))||h);return b>3&&h&&Object.defineProperty(f,y,h),h}function H(O,f,y){if(y||2===arguments.length)for(var S,H=0,b=f.length;H<b;H++)!S&&H in f||(S||(S=Array.prototype.slice.call(f,0,H)),S[H]=f[H]);return O.concat(S||Array.prototype.slice.call(f))}var b,h=255,v=213;O.OPERATION=void 0,(b=O.OPERATION||(O.OPERATION={}))[b.ADD=128]="ADD",b[b.REPLACE=0]="REPLACE",b[b.DELETE=64]="DELETE",b[b.DELETE_AND_ADD=192]="DELETE_AND_ADD",b[b.TOUCH=1]="TOUCH",b[b.CLEAR=10]="CLEAR";var N=function(){function f(O,f,y){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=O,this.setParent(f,y)}return f.prototype.setParent=function(O,f,y){var S=this;if(this.indexes||(this.indexes=this.ref instanceof VO?this.ref._definition.indexes:{}),this.parent=O,this.parentIndex=y,f)if(this.root=f,this.ref instanceof VO){var H=this.ref._definition;for(var b in H.schema){var h=this.ref[b];if(h&&h.$changes){var v=H.indexes[b];h.$changes.setParent(this.ref,f,v)}}}else"object"===typeof this.ref&&this.ref.forEach((function(O,f){if(O instanceof VO){var y=O.$changes,H=S.ref.$changes.indexes[f];y.setParent(S.ref,S.root,H)}}))},f.prototype.operation=function(O){this.changes.set(--this.currentCustomOperation,O)},f.prototype.change=function(f,y){void 0===y&&(y=O.OPERATION.ADD);var S="number"===typeof f?f:this.indexes[f];this.assertValidIndex(S,f);var H=this.changes.get(S);H&&H.op!==O.OPERATION.DELETE&&H.op!==O.OPERATION.TOUCH||this.changes.set(S,{op:H&&H.op===O.OPERATION.DELETE?O.OPERATION.DELETE_AND_ADD:y,index:S}),this.allChanges.add(S),this.changed=!0,this.touchParents()},f.prototype.touch=function(f){var y="number"===typeof f?f:this.indexes[f];this.assertValidIndex(y,f),this.changes.has(y)||this.changes.set(y,{op:O.OPERATION.TOUCH,index:y}),this.allChanges.add(y),this.touchParents()},f.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},f.prototype.getType=function(O){if(this.ref._definition)return(f=this.ref._definition).schema[f.fieldsByIndex[O]];var f,y=(f=this.parent._definition).schema[f.fieldsByIndex[this.parentIndex]];return Object.values(y)[0]},f.prototype.getChildrenFilter=function(){var O=this.parent._definition.childFilters;return O&&O[this.parentIndex]},f.prototype.getValue=function(O){return this.ref.getByIndex(O)},f.prototype.delete=function(f){var y="number"===typeof f?f:this.indexes[f];if(void 0!==y){var S=this.getValue(y);this.changes.set(y,{op:O.OPERATION.DELETE,index:y}),this.allChanges.delete(y),delete this.caches[y],S&&S.$changes&&(S.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(f," (").concat(y,")"))},f.prototype.discard=function(f,y){var S=this;void 0===f&&(f=!1),void 0===y&&(y=!1),this.ref instanceof VO||this.changes.forEach((function(f){if(f.op===O.OPERATION.DELETE){var y=S.ref.getIndex(f.index);delete S.indexes[y]}})),this.changes.clear(),this.changed=f,y&&this.allChanges.clear(),this.currentCustomOperation=0},f.prototype.discardAll=function(){var O=this;this.changes.forEach((function(f){var y=O.getValue(f.index);y&&y.$changes&&y.$changes.discardAll()})),this.discard()},f.prototype.cache=function(O,f){this.caches[O]=f},f.prototype.clone=function(){return new f(this.ref,this.parent,this.root)},f.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},f.prototype.assertValidIndex=function(O,f){if(void 0===O)throw new Error('ChangeTree: missing index for field "'.concat(f,'"'))},f}();function m(O,f,y,S){return O[f]||(O[f]=[]),O[f].push(y),null===S||void 0===S||S.forEach((function(O,f){return y(O,f)})),function(){return q(O[f],O[f].indexOf(y))}}function t(f){var y=this,S="string"!==typeof this.$changes.getType();this.$items.forEach((function(H,b){f.push({refId:y.$changes.refId,op:O.OPERATION.DELETE,field:b,value:void 0,previousValue:H}),S&&y.$changes.root.removeRef(H.$changes.refId)}))}function q(O,f){if(-1===f||f>=O.length)return!1;for(var y=O.length-1,S=f;S<y;S++)O[S]=O[S+1];return O.length=y,!0}var F=function(O,f){var y=O.toString(),S=f.toString();return y<S?-1:y>S?1:0};function I(O){return O.$proxy=!0,O=new Proxy(O,{get:function(O,f){return"symbol"===typeof f||isNaN(f)?O[f]:O.at(f)},set:function(O,f,y){if("symbol"===typeof f||isNaN(f))O[f]=y;else{var S=Array.from(O.$items.keys()),H=parseInt(S[f]||f);void 0===y||null===y?O.deleteAt(H):O.setAt(H,y)}return!0},deleteProperty:function(O,f){return"number"===typeof f?O.deleteAt(f):delete O[f],!0}})}var A=function(){function f(){for(var O=[],f=0;f<arguments.length;f++)O[f]=arguments[f];this.$changes=new N(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,O)}return f.prototype.Ad=function(f,y){return void 0===y&&(y=!0),m(this.$callbacks||(this.$callbacks=[]),O.OPERATION.ADD,f,y?this.$items:void 0)},f.prototype.ab=function(f){return m(this.$callbacks||(this.$callbacks=[]),O.OPERATION.DELETE,f)},f.prototype.onChange=function(f){return m(this.$callbacks||(this.$callbacks=[]),O.OPERATION.REPLACE,f)},f.is=function(O){return Array.isArray(O)||void 0!==O.array},Object.defineProperty(f.prototype,"length",{get:function(){return this.$items.size},set:function(O){0===O?this.clear():this.splice(O,this.length-O)},enumerable:!1,configurable:!0}),f.prototype.push=function(){for(var O,f=this,y=[],S=0;S<arguments.length;S++)y[S]=arguments[S];return y.forEach((function(y){O=f.$refId++,f.setAt(O,y)})),O},f.prototype.pop=function(){var O=Array.from(this.$indexes.values()).pop();if(void 0!==O){this.$changes.delete(O),this.$indexes.delete(O);var f=this.$items.get(O);return this.$items.delete(O),f}},f.prototype.at=function(O){var f=Array.from(this.$items.keys())[O];return this.$items.get(f)},f.prototype.setAt=function(f,y){var S,H;if(void 0!==y&&null!==y){if(this.$items.get(f)!==y){void 0!==y.$changes&&y.$changes.setParent(this,this.$changes.root,f);var b=null!==(H=null===(S=this.$changes.indexes[f])||void 0===S?void 0:S.op)&&void 0!==H?H:O.OPERATION.ADD;this.$changes.indexes[f]=f,this.$indexes.set(f,f),this.$items.set(f,y),this.$changes.change(f,b)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},f.prototype.deleteAt=function(O){var f=Array.from(this.$items.keys())[O];return void 0!==f&&this.$deleteAt(f)},f.prototype.$deleteAt=function(O){return this.$changes.delete(O),this.$indexes.delete(O),this.$items.delete(O)},f.prototype.clear=function(f){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),f&&t.call(this,f),this.$items.clear(),this.$changes.operation({index:0,op:O.OPERATION.CLEAR}),this.$changes.touchParents()},f.prototype.concat=function(){for(var O,y=[],S=0;S<arguments.length;S++)y[S]=arguments[S];return new(f.bind.apply(f,H([void 0],(O=Array.from(this.$items.values())).concat.apply(O,y),!1)))},f.prototype.join=function(O){return Array.from(this.$items.values()).join(O)},f.prototype.reverse=function(){var O=this,f=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(y,S){O.setAt(f[S],y)})),this},f.prototype.shift=function(){var O=Array.from(this.$items.keys()).shift();if(void 0!==O){var f=this.$items.get(O);return this.$deleteAt(O),f}},f.prototype.slice=function(O,y){var S=new f;return S.push.apply(S,Array.from(this.$items.values()).slice(O,y)),S},f.prototype.sort=function(O){var f=this;void 0===O&&(O=F);var y=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(O).forEach((function(O,S){f.setAt(y[S],O)})),this},f.prototype.splice=function(O,f){void 0===f&&(f=this.length-O);for(var y=Array.from(this.$items.keys()),S=[],H=O;H<O+f;H++)S.push(this.$items.get(y[H])),this.$deleteAt(y[H]);return S},f.prototype.unshift=function(){for(var O=this,f=[],y=0;y<arguments.length;y++)f[y]=arguments[y];var S=this.length,H=f.length,b=Array.from(this.$items.values());return f.forEach((function(f,y){O.setAt(y,f)})),b.forEach((function(f,y){O.setAt(H+y,f)})),S+H},f.prototype.indexOf=function(O,f){return Array.from(this.$items.values()).indexOf(O,f)},f.prototype.lastIndexOf=function(O,f){return void 0===f&&(f=this.length-1),Array.from(this.$items.values()).lastIndexOf(O,f)},f.prototype.every=function(O,f){return Array.from(this.$items.values()).every(O,f)},f.prototype.some=function(O,f){return Array.from(this.$items.values()).some(O,f)},f.prototype.forEach=function(O,f){Array.from(this.$items.values()).forEach(O,f)},f.prototype.map=function(O,f){return Array.from(this.$items.values()).map(O,f)},f.prototype.filter=function(O,f){return Array.from(this.$items.values()).filter(O,f)},f.prototype.reduce=function(O,f){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},f.prototype.reduceRight=function(O,f){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},f.prototype.find=function(O,f){return Array.from(this.$items.values()).find(O,f)},f.prototype.findIndex=function(O,f){return Array.from(this.$items.values()).findIndex(O,f)},f.prototype.fill=function(O,f,y){throw new Error("ArraySchema#fill() not implemented")},f.prototype.copyWithin=function(O,f,y){throw new Error("ArraySchema#copyWithin() not implemented")},f.prototype.toString=function(){return this.$items.toString()},f.prototype.toLocaleString=function(){return this.$items.toLocaleString()},f.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(f,Symbol.species,{get:function(){return f},enumerable:!1,configurable:!0}),f.prototype.entries=function(){return this.$items.entries()},f.prototype.keys=function(){return this.$items.keys()},f.prototype.values=function(){return this.$items.values()},f.prototype.includes=function(O,f){return Array.from(this.$items.values()).includes(O,f)},f.prototype.flatMap=function(O,f){throw new Error("ArraySchema#flatMap() is not supported.")},f.prototype.flat=function(O){throw new Error("ArraySchema#flat() is not supported.")},f.prototype.findLast=function(){var O=Array.from(this.$items.values());return O.findLast.apply(O,arguments)},f.prototype.findLastIndex=function(){var O=Array.from(this.$items.values());return O.findLastIndex.apply(O,arguments)},f.prototype.setIndex=function(O,f){this.$indexes.set(O,f)},f.prototype.getIndex=function(O){return this.$indexes.get(O)},f.prototype.getByIndex=function(O){return this.$items.get(this.$indexes.get(O))},f.prototype.deleteByIndex=function(O){var f=this.$indexes.get(O);this.$items.delete(f),this.$indexes.delete(O)},f.prototype.toArray=function(){return Array.from(this.$items.values())},f.prototype.toJSON=function(){return this.toArray().map((function(O){return"function"===typeof O.toJSON?O.toJSON():O}))},f.prototype.clone=function(O){return O?new(f.bind.apply(f,H([void 0],Array.from(this.$items.values()),!1))):new(f.bind.apply(f,H([void 0],this.map((function(O){return O.$changes?O.clone():O})),!1)))},f}();function J(O){return O.$proxy=!0,O=new Proxy(O,{get:function(O,f){return"symbol"!==typeof f&&"undefined"===typeof O[f]?O.get(f):O[f]},set:function(O,f,y){return"symbol"!==typeof f&&-1===f.indexOf("$")&&"Ad"!==f&&"ab"!==f&&"onChange"!==f?O.set(f,y):O[f]=y,!0},deleteProperty:function(O,f){return O.delete(f),!0}})}var X=function(){function f(O){var y=this;if(this.$changes=new N(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,O)if(O instanceof Map||O instanceof f)O.forEach((function(O,f){return y.set(f,O)}));else for(var S in O)this.set(S,O[S])}return f.prototype.Ad=function(f,y){return void 0===y&&(y=!0),m(this.$callbacks||(this.$callbacks=[]),O.OPERATION.ADD,f,y?this.$items:void 0)},f.prototype.ab=function(f){return m(this.$callbacks||(this.$callbacks=[]),O.OPERATION.DELETE,f)},f.prototype.onChange=function(f){return m(this.$callbacks||(this.$callbacks=[]),O.OPERATION.REPLACE,f)},f.is=function(O){return void 0!==O.map},f.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(f.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(f,Symbol.species,{get:function(){return f},enumerable:!1,configurable:!0}),f.prototype.set=function(f,y){if(void 0===y||null===y)throw new Error("MapSchema#set('".concat(f,"', ").concat(y,"): trying to set ").concat(y," value on '").concat(f,"'."));f=f.toString();var S="undefined"!==typeof this.$changes.indexes[f],H=S?this.$changes.indexes[f]:this.$refId++,b=S?O.OPERATION.REPLACE:O.OPERATION.ADD,h=void 0!==y.$changes;if(h&&y.$changes.setParent(this,this.$changes.root,H),S){if(!h&&this.$items.get(f)===y)return;h&&this.$items.get(f)!==y&&(b=O.OPERATION.ADD)}else this.$changes.indexes[f]=H,this.$indexes.set(H,f);return this.$items.set(f,y),this.$changes.change(f,b),this},f.prototype.get=function(O){return this.$items.get(O)},f.prototype.delete=function(O){return this.$changes.delete(O),this.$items.delete(O)},f.prototype.clear=function(f){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),f&&t.call(this,f),this.$items.clear(),this.$changes.operation({index:0,op:O.OPERATION.CLEAR}),this.$changes.touchParents()},f.prototype.has=function(O){return this.$items.has(O)},f.prototype.forEach=function(O){this.$items.forEach(O)},f.prototype.entries=function(){return this.$items.entries()},f.prototype.keys=function(){return this.$items.keys()},f.prototype.values=function(){return this.$items.values()},Object.defineProperty(f.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),f.prototype.setIndex=function(O,f){this.$indexes.set(O,f)},f.prototype.getIndex=function(O){return this.$indexes.get(O)},f.prototype.getByIndex=function(O){return this.$items.get(this.$indexes.get(O))},f.prototype.deleteByIndex=function(O){var f=this.$indexes.get(O);this.$items.delete(f),this.$indexes.delete(O)},f.prototype.toJSON=function(){var O={};return this.forEach((function(f,y){O[y]="function"===typeof f.toJSON?f.toJSON():f})),O},f.prototype.clone=function(O){var y;return O?y=Object.assign(new f,this):(y=new f,this.forEach((function(O,f){O.$changes?y.set(f,O.clone()):y.set(f,O)}))),y},f}(),w={};function B(O,f){w[O]=f}function j(O){return w[O]}var u=function(){function O(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return O.create=function(f){var y=new O;return y.schema=Object.assign({},f&&f.schema||{}),y.indexes=Object.assign({},f&&f.indexes||{}),y.fieldsByIndex=Object.assign({},f&&f.fieldsByIndex||{}),y.descriptors=Object.assign({},f&&f.descriptors||{}),y.deprecated=Object.assign({},f&&f.deprecated||{}),y},O.prototype.addField=function(O,f){var y=this.getNextFieldIndex();this.fieldsByIndex[y]=O,this.indexes[O]=y,this.schema[O]=Array.isArray(f)?{array:f[0]}:f},O.prototype.hasField=function(O){return void 0!==this.indexes[O]},O.prototype.addFilter=function(O,f){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[O]]=f,this.indexesWithFilters.push(this.indexes[O]),!0},O.prototype.addChildrenFilter=function(O,f){var y=this.indexes[O],S=this.schema[O];if(j(Object.keys(S)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[y]=f,!0;console.warn("@filterChildren: field '".concat(O,"' can't have children. Ignoring filter."))},O.prototype.getChildrenFilter=function(O){return this.childFilters&&this.childFilters[this.indexes[O]]},O.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},O}();function L(O){return O._context&&O._context.useFilters}var p=function(){function O(){this.types={},this.schemas=new Map,this.useFilters=!1}return O.prototype.has=function(O){return this.schemas.has(O)},O.prototype.get=function(O){return this.types[O]},O.prototype.add=function(O,f){void 0===f&&(f=this.schemas.size),O._definition=u.create(O._definition),O._typeid=f,this.types[f]=O,this.schemas.set(O,f)},O.create=function(f){return void 0===f&&(f={}),function(y){return f.context||(f.context=new O),l(y,f)}},O}(),U=new p;function l(O,f){return void 0===f&&(f={}),function(y,S){var b=f.context||U,h=y.constructor;if(h._context=b,!O)throw new Error("".concat(h.name,': @type() reference provided for "').concat(S,"\" is undefined. Make sure you don't have any circular dependencies."));b.has(h)||b.add(h);var v=h._definition;if(v.addField(S,O),v.descriptors[S]){if(v.deprecated[S])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(S,"' definition on '").concat(h.name,"'.\nCheck @type() annotation"))}catch(w){var N=w.stack.split("\n")[4].trim();throw new Error("".concat(w.message," ").concat(N))}}var m=A.is(O),t=!m&&X.is(O);if("string"!==typeof O&&!VO.is(O)){var q=Object.values(O)[0];"string"===typeof q||b.has(q)||b.add(q)}if(f.manual)v.descriptors[S]={enumerable:!0,configurable:!0,writable:!0};else{var F="_".concat(S);v.descriptors[F]={enumerable:!1,configurable:!1,writable:!0},v.descriptors[S]={get:function(){return this[F]},set:function(O){O!==this[F]&&(void 0!==O&&null!==O?(!m||O instanceof A||(O=new(A.bind.apply(A,H([void 0],O,!1)))),!t||O instanceof X||(O=new X(O)),void 0===O.$proxy&&(t?O=J(O):m&&(O=I(O))),this.$changes.change(S),O.$changes&&O.$changes.setParent(this,this.$changes.root,this._definition.indexes[S])):this[F]&&this.$changes.delete(S),this[F]=O)},enumerable:!0,configurable:!0}}}}function x(O){return function(f,y){var S=f.constructor;S._definition.addFilter(y,O)&&(S._context.useFilters=!0)}}function W(O){return function(f,y){var S=f.constructor;S._definition.addChildrenFilter(y,O)&&(S._context.useFilters=!0)}}function E(O){return void 0===O&&(O=!0),function(f,y){var S=f.constructor._definition;S.deprecated[y]=!0,O&&(S.descriptors[y]={get:function(){throw new Error("".concat(y," is deprecated."))},set:function(O){},enumerable:!1,configurable:!0})}}function o(O,f,y){for(var S in void 0===y&&(y={}),y.context||(y.context=O._context||y.context||U),f)l(f[S],y)(O.prototype,S);return O}function i(O){for(var f=0,y=0,S=0,H=O.length;S<H;S++)(f=O.charCodeAt(S))<128?y+=1:f<2048?y+=2:f<55296||f>=57344?y+=3:(S++,y+=4);return y}function D(O,f,y){for(var S=0,H=0,b=y.length;H<b;H++)(S=y.charCodeAt(H))<128?O[f++]=S:S<2048?(O[f++]=192|S>>6,O[f++]=128|63&S):S<55296||S>=57344?(O[f++]=224|S>>12,O[f++]=128|S>>6&63,O[f++]=128|63&S):(H++,S=65536+((1023&S)<<10|1023&y.charCodeAt(H)),O[f++]=240|S>>18,O[f++]=128|S>>12&63,O[f++]=128|S>>6&63,O[f++]=128|63&S)}function V(O,f){O.push(255&f)}function g(O,f){O.push(255&f)}function R(O,f){O.push(255&f),O.push(f>>8&255)}function s(O,f){O.push(255&f),O.push(f>>8&255)}function k(O,f){O.push(255&f),O.push(f>>8&255),O.push(f>>16&255),O.push(f>>24&255)}function z(O,f){var y=f>>24,S=f>>16,H=f>>8,b=f;O.push(255&b),O.push(255&H),O.push(255&S),O.push(255&y)}function c(O,f){var y=Math.floor(f/Math.pow(2,32));z(O,f>>>0),z(O,y)}function d(O,f){var y=f/Math.pow(2,32)|0;z(O,f>>>0),z(O,y)}function G(O,f){P(O,f)}function Y(O,f){e(O,f)}var Z=new Int32Array(2),a=new Float32Array(Z.buffer),M=new Float64Array(Z.buffer);function P(O,f){a[0]=f,k(O,Z[0])}function e(O,f){M[0]=f,k(O,Z[0]),k(O,Z[1])}function K(O,f){return g(O,f?1:0)}function T(O,f){f||(f="");var y=i(f),S=0;if(y<32)O.push(160|y),S=1;else if(y<256)O.push(217),g(O,y),S=2;else if(y<65536)O.push(218),s(O,y),S=3;else{if(!(y<4294967296))throw new Error("String too long");O.push(219),z(O,y),S=5}return D(O,O.length,f),S+y}function Q(O,f){return isNaN(f)?Q(O,0):isFinite(f)?f!==(0|f)?(O.push(203),e(O,f),9):f>=0?f<128?(g(O,f),1):f<256?(O.push(204),g(O,f),2):f<65536?(O.push(205),s(O,f),3):f<4294967296?(O.push(206),z(O,f),5):(O.push(207),d(O,f),9):f>=-32?(O.push(224|f+32),1):f>=-128?(O.push(208),V(O,f),2):f>=-32768?(O.push(209),R(O,f),3):f>=-2147483648?(O.push(210),k(O,f),5):(O.push(211),c(O,f),9):Q(O,f>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var C=Object.freeze({__proto__:null,utf8Write:D,int8:V,uint8:g,int16:R,uint16:s,int32:k,uint32:z,int64:c,uint64:d,float32:G,float64:Y,writeFloat32:P,writeFloat64:e,boolean:K,string:T,number:Q});function r(O,f,y){for(var S="",H=0,b=f,h=f+y;b<h;b++){var v=O[b];0!==(128&v)?192!==(224&v)?224!==(240&v)?240!==(248&v)?console.error("Invalid byte "+v.toString(16)):(H=(7&v)<<18|(63&O[++b])<<12|(63&O[++b])<<6|63&O[++b])>=65536?(H-=65536,S+=String.fromCharCode(55296+(H>>>10),56320+(1023&H))):S+=String.fromCharCode(H):S+=String.fromCharCode((15&v)<<12|(63&O[++b])<<6|63&O[++b]):S+=String.fromCharCode((31&v)<<6|63&O[++b]):S+=String.fromCharCode(v)}return S}function n(O,f){return OO(O,f)<<24>>24}function OO(O,f){return O[f.offset++]}function fO(O,f){return yO(O,f)<<16>>16}function yO(O,f){return O[f.offset++]|O[f.offset++]<<8}function SO(O,f){return O[f.offset++]|O[f.offset++]<<8|O[f.offset++]<<16|O[f.offset++]<<24}function HO(O,f){return SO(O,f)>>>0}function bO(O,f){return FO(O,f)}function hO(O,f){return IO(O,f)}function vO(O,f){var y=HO(O,f);return SO(O,f)*Math.pow(2,32)+y}function NO(O,f){var y=HO(O,f);return HO(O,f)*Math.pow(2,32)+y}var mO=new Int32Array(2),tO=new Float32Array(mO.buffer),qO=new Float64Array(mO.buffer);function FO(O,f){return mO[0]=SO(O,f),tO[0]}function IO(O,f){return mO[0]=SO(O,f),mO[1]=SO(O,f),qO[0]}function AO(O,f){return OO(O,f)>0}function JO(O,f){var y,S=O[f.offset++];S<192?y=31&S:217===S?y=OO(O,f):218===S?y=yO(O,f):219===S&&(y=HO(O,f));var H=r(O,f.offset,y);return f.offset+=y,H}function XO(O,f){var y=O[f.offset];return y<192&&y>160||217===y||218===y||219===y}function wO(O,f){var y=O[f.offset++];return y<128?y:202===y?FO(O,f):203===y?IO(O,f):204===y?OO(O,f):205===y?yO(O,f):206===y?HO(O,f):207===y?NO(O,f):208===y?n(O,f):209===y?fO(O,f):210===y?SO(O,f):211===y?vO(O,f):y>223?-1*(255-y+1):void 0}function BO(O,f){var y=O[f.offset];return y<128||y>=202&&y<=211}function jO(O,f){return O[f.offset]<160}function uO(O,f){return O[f.offset-1]===h&&(O[f.offset]<128||O[f.offset]>=202&&O[f.offset]<=211)}var LO=Object.freeze({__proto__:null,int8:n,uint8:OO,int16:fO,uint16:yO,int32:SO,uint32:HO,float32:bO,float64:hO,int64:vO,uint64:NO,readFloat32:FO,readFloat64:IO,boolean:AO,string:JO,stringCheck:XO,number:wO,numberCheck:BO,arrayCheck:jO,switchStructureCheck:uO}),pO=function(){function f(O){var f=this;this.$changes=new N(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,O&&O.forEach((function(O){return f.add(O)}))}return f.prototype.Ad=function(f,y){return void 0===y&&(y=!0),m(this.$callbacks||(this.$callbacks=[]),O.OPERATION.ADD,f,y?this.$items:void 0)},f.prototype.ab=function(f){return m(this.$callbacks||(this.$callbacks=[]),O.OPERATION.DELETE,f)},f.prototype.onChange=function(f){return m(this.$callbacks||(this.$callbacks=[]),O.OPERATION.REPLACE,f)},f.is=function(O){return void 0!==O.collection},f.prototype.add=function(O){var f=this.$refId++;return void 0!==O.$changes&&O.$changes.setParent(this,this.$changes.root,f),this.$changes.indexes[f]=f,this.$indexes.set(f,f),this.$items.set(f,O),this.$changes.change(f),f},f.prototype.at=function(O){var f=Array.from(this.$items.keys())[O];return this.$items.get(f)},f.prototype.entries=function(){return this.$items.entries()},f.prototype.delete=function(O){for(var f,y,S=this.$items.entries();(y=S.next())&&!y.done;)if(O===y.value[1]){f=y.value[0];break}return void 0!==f&&(this.$changes.delete(f),this.$indexes.delete(f),this.$items.delete(f))},f.prototype.clear=function(f){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),f&&t.call(this,f),this.$items.clear(),this.$changes.operation({index:0,op:O.OPERATION.CLEAR}),this.$changes.touchParents()},f.prototype.has=function(O){return Array.from(this.$items.values()).some((function(f){return f===O}))},f.prototype.forEach=function(O){var f=this;this.$items.forEach((function(y,S,H){return O(y,S,f)}))},f.prototype.values=function(){return this.$items.values()},Object.defineProperty(f.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),f.prototype.setIndex=function(O,f){this.$indexes.set(O,f)},f.prototype.getIndex=function(O){return this.$indexes.get(O)},f.prototype.getByIndex=function(O){return this.$items.get(this.$indexes.get(O))},f.prototype.deleteByIndex=function(O){var f=this.$indexes.get(O);this.$items.delete(f),this.$indexes.delete(O)},f.prototype.toArray=function(){return Array.from(this.$items.values())},f.prototype.toJSON=function(){var O=[];return this.forEach((function(f,y){O.push("function"===typeof f.toJSON?f.toJSON():f)})),O},f.prototype.clone=function(O){var y;return O?y=Object.assign(new f,this):(y=new f,this.forEach((function(O){O.$changes?y.add(O.clone()):y.add(O)}))),y},f}(),UO=function(){function f(O){var f=this;this.$changes=new N(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,O&&O.forEach((function(O){return f.add(O)}))}return f.prototype.Ad=function(f,y){return void 0===y&&(y=!0),m(this.$callbacks||(this.$callbacks=[]),O.OPERATION.ADD,f,y?this.$items:void 0)},f.prototype.ab=function(f){return m(this.$callbacks||(this.$callbacks=[]),O.OPERATION.DELETE,f)},f.prototype.onChange=function(f){return m(this.$callbacks||(this.$callbacks=[]),O.OPERATION.REPLACE,f)},f.is=function(O){return void 0!==O.set},f.prototype.add=function(f){var y,S;if(this.has(f))return!1;var H=this.$refId++;void 0!==f.$changes&&f.$changes.setParent(this,this.$changes.root,H);var b=null!==(S=null===(y=this.$changes.indexes[H])||void 0===y?void 0:y.op)&&void 0!==S?S:O.OPERATION.ADD;return this.$changes.indexes[H]=H,this.$indexes.set(H,H),this.$items.set(H,f),this.$changes.change(H,b),H},f.prototype.entries=function(){return this.$items.entries()},f.prototype.delete=function(O){for(var f,y,S=this.$items.entries();(y=S.next())&&!y.done;)if(O===y.value[1]){f=y.value[0];break}return void 0!==f&&(this.$changes.delete(f),this.$indexes.delete(f),this.$items.delete(f))},f.prototype.clear=function(f){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),f&&t.call(this,f),this.$items.clear(),this.$changes.operation({index:0,op:O.OPERATION.CLEAR}),this.$changes.touchParents()},f.prototype.has=function(O){for(var f,y=this.$items.values(),S=!1;(f=y.next())&&!f.done;)if(O===f.value){S=!0;break}return S},f.prototype.forEach=function(O){var f=this;this.$items.forEach((function(y,S,H){return O(y,S,f)}))},f.prototype.values=function(){return this.$items.values()},Object.defineProperty(f.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),f.prototype.setIndex=function(O,f){this.$indexes.set(O,f)},f.prototype.getIndex=function(O){return this.$indexes.get(O)},f.prototype.getByIndex=function(O){return this.$items.get(this.$indexes.get(O))},f.prototype.deleteByIndex=function(O){var f=this.$indexes.get(O);this.$items.delete(f),this.$indexes.delete(O)},f.prototype.toArray=function(){return Array.from(this.$items.values())},f.prototype.toJSON=function(){var O=[];return this.forEach((function(f,y){O.push("function"===typeof f.toJSON?f.toJSON():f)})),O},f.prototype.clone=function(O){var y;return O?y=Object.assign(new f,this):(y=new f,this.forEach((function(O){O.$changes?y.add(O.clone()):y.add(O)}))),y},f}(),lO=function(){function O(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return O.prototype.addRefId=function(O){this.refIds.has(O)||(this.refIds.add(O),this.containerIndexes.set(O,new Set))},O.get=function(f){return void 0===f.$filterState&&(f.$filterState=new O),f.$filterState},O}(),xO=function(){function O(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return O.prototype.getNextUniqueId=function(){return this.nextUniqueId++},O.prototype.addRef=function(O,f,y){void 0===y&&(y=!0),this.refs.set(O,f),y&&(this.refCounts[O]=(this.refCounts[O]||0)+1)},O.prototype.removeRef=function(O){this.refCounts[O]=this.refCounts[O]-1,this.deletedRefs.add(O)},O.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},O.prototype.garbageCollectDeletedRefs=function(){var O=this;this.deletedRefs.forEach((function(f){if(!(O.refCounts[f]>0)){var y=O.refs.get(f);if(y instanceof VO)for(var S in y._definition.schema)"string"!==typeof y._definition.schema[S]&&y[S]&&y[S].$changes&&O.removeRef(y[S].$changes.refId);else{var H=y.$changes.parent._definition,b=H.schema[H.fieldsByIndex[y.$changes.parentIndex]];"function"===typeof Object.values(b)[0]&&Array.from(y.values()).forEach((function(f){return O.removeRef(f.$changes.refId)}))}O.refs.delete(f),delete O.refCounts[f]}})),this.deletedRefs.clear()},O}(),WO=function(O){function f(){return null!==O&&O.apply(this,arguments)||this}return y(f,O),f}(Error);function EO(O,f,y,S){var H,b=!1;switch(f){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":H="number",isNaN(O)&&console.log('trying to encode "NaN" in '.concat(y.constructor.name,"#").concat(S));break;case"string":H="string",b=!0;break;case"boolean":return}if(typeof O!==H&&(!b||b&&null!==O)){var h="'".concat(JSON.stringify(O),"'").concat(O&&O.constructor&&" (".concat(O.constructor.name,")")||"");throw new WO("a '".concat(H,"' was expected, but ").concat(h," was provided in ").concat(y.constructor.name,"#").concat(S))}}function oO(O,f,y,S){if(!(O instanceof f))throw new WO("a '".concat(f.name,"' was expected, but '").concat(O.constructor.name,"' was provided in ").concat(y.constructor.name,"#").concat(S))}function iO(O,f,y,S,H){EO(y,O,S,H);var b=C[O];if(!b)throw new WO("a '".concat(O,"' was expected, but ").concat(y," was provided in ").concat(S.constructor.name,"#").concat(H));b(f,y)}function DO(O,f,y){return LO[O](f,y)}var VO=function(){function f(){for(var O=[],f=0;f<arguments.length;f++)O[f]=arguments[f];Object.defineProperties(this,{$changes:{value:new N(this,void 0,new xO),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var y=this._definition.descriptors;y&&Object.defineProperties(this,y),O[0]&&this.assign(O[0])}return f.onError=function(O){console.error(O)},f.is=function(O){return O._definition&&void 0!==O._definition.schema},f.prototype.onChange=function(f){return m(this.$callbacks||(this.$callbacks=[]),O.OPERATION.REPLACE,f)},f.prototype.ab=function(f){return m(this.$callbacks||(this.$callbacks=[]),O.OPERATION.DELETE,f)},f.prototype.assign=function(O){return Object.assign(this,O),this},Object.defineProperty(f.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),f.prototype.setDirty=function(O,f){this.$changes.change(O,f)},f.prototype.listen=function(O,f,y){var S=this;return void 0===y&&(y=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[O]||(this.$callbacks[O]=[]),this.$callbacks[O].push(f),y&&void 0!==this[O]&&f(this[O],void 0),function(){return q(S.$callbacks[O],S.$callbacks[O].indexOf(f))}},f.prototype.decode=function(y,S,H){var b;void 0===S&&(S={offset:0}),void 0===H&&(H=this);var v=[],N=this.$changes.root,m=y.length,t=0;for(N.refs.set(t,this);S.offset<m;){var q=y[S.offset++];if(q!=h){var F=H.$changes,I=void 0!==H._definition,J=I?q>>6<<6:q;if(J!==O.OPERATION.CLEAR){var w=I?q%(J||255):wO(y,S),B=I?H._definition.fieldsByIndex[w]:"",u=F.getType(w),L=void 0,p=void 0,U=void 0;if(I?p=H["_".concat(B)]:(p=H.getByIndex(w),(J&O.OPERATION.ADD)===O.OPERATION.ADD?(U=H instanceof X?JO(y,S):w,H.setIndex(w,U)):U=H.getIndex(w)),(J&O.OPERATION.DELETE)===O.OPERATION.DELETE&&(J!==O.OPERATION.DELETE_AND_ADD&&H.deleteByIndex(w),p&&p.$changes&&N.removeRef(p.$changes.refId),L=null),void 0!==B){if(J===O.OPERATION.DELETE);else if(f.is(u)){var l=wO(y,S);if(L=N.refs.get(l),J!==O.OPERATION.REPLACE){var x=this.getSchemaType(y,S,u);L||((L=this.createTypeInstance(x)).$changes.refId=l,p&&(L.$callbacks=p.$callbacks,p.$changes.refId&&l!==p.$changes.refId&&N.removeRef(p.$changes.refId))),N.addRef(l,L,L!==p)}}else if("string"===typeof u)L=DO(u,y,S);else{var W=j(Object.keys(u)[0]),E=wO(y,S),o=N.refs.has(E)?p||N.refs.get(E):new W.constructor;if((L=o.clone(!0)).$changes.refId=E,p&&(L.$callbacks=p.$callbacks,p.$changes.refId&&E!==p.$changes.refId)){N.removeRef(p.$changes.refId);for(var i=p.entries(),D=void 0;(D=i.next())&&!D.done;){var V=(b=D.value)[0],g=b[1];v.push({refId:E,op:O.OPERATION.DELETE,field:V,value:void 0,previousValue:g})}}N.addRef(E,L,o!==p)}if(null!==L&&void 0!==L)if(L.$changes&&L.$changes.setParent(F.ref,F.root,w),H instanceof f)H[B]=L;else if(H instanceof X)V=U,H.$items.set(V,L),H.$changes.allChanges.add(w);else if(H instanceof A)H.setAt(w,L);else if(H instanceof pO){var R=H.add(L);H.setIndex(w,R)}else H instanceof UO&&!1!==(R=H.add(L))&&H.setIndex(w,R);p!==L&&v.push({refId:t,op:J,field:B,dynamicIndex:U,value:L,previousValue:p})}else{console.warn("@colyseus/schema: definition mismatch");for(var s={offset:S.offset};S.offset<m&&(!uO(y,S)||(s.offset=S.offset+1,!N.refs.has(wO(y,s))));)S.offset++}}else H.clear(v)}else{t=wO(y,S);var k=N.refs.get(t);if(!k)throw new Error('"refId" not found: '.concat(t));H=k}}return this._triggerChanges(v),N.garbageCollectDeletedRefs(),v},f.prototype.encode=function(y,S,H){void 0===y&&(y=!1),void 0===S&&(S=[]),void 0===H&&(H=!1);for(var b=this.$changes,v=new WeakSet,N=[b],m=1,t=0;t<m;t++){var q=N[t],F=q.ref,I=F instanceof f;q.ensureRefId(),v.add(q),q!==b&&(q.changed||y)&&(g(S,h),Q(S,q.refId));for(var A=y?Array.from(q.allChanges):Array.from(q.changes.values()),J=0,w=A.length;J<w;J++){var B=y?{op:O.OPERATION.ADD,index:A[J]}:A[J],u=B.index,L=I?F._definition.fieldsByIndex&&F._definition.fieldsByIndex[u]:u,p=S.length;if(B.op!==O.OPERATION.TOUCH)if(I)g(S,u|B.op);else{if(g(S,B.op),B.op===O.OPERATION.CLEAR)continue;Q(S,u)}if(I||(B.op&O.OPERATION.ADD)!=O.OPERATION.ADD||F instanceof X&&T(S,q.ref.$indexes.get(u)),B.op!==O.OPERATION.DELETE){var U=q.getType(u),l=q.getValue(u);if(l&&l.$changes&&!v.has(l.$changes)&&(N.push(l.$changes),l.$changes.ensureRefId(),m++),B.op!==O.OPERATION.TOUCH){if(f.is(U))oO(l,U,F,L),Q(S,l.$changes.refId),(B.op&O.OPERATION.ADD)===O.OPERATION.ADD&&this.tryEncodeTypeId(S,U,l.constructor);else if("string"===typeof U)iO(U,S,l,F,L);else{var x=j(Object.keys(U)[0]);oO(F["_".concat(L)],x.constructor,F,L),Q(S,l.$changes.refId)}H&&q.cache(u,S.slice(p))}}}y||H||q.discard()}return S},f.prototype.encodeAll=function(O){return this.encode(!0,[],O)},f.prototype.applyFilters=function(y,S){var H,b;void 0===S&&(S=!1);for(var v=this,N=new Set,m=lO.get(y),t=[this.$changes],q=1,F=[],I=function(I){var A=t[I];if(N.has(A.refId))return"continue";var J=A.ref,w=J instanceof f;g(F,h),Q(F,A.refId);var B=m.refIds.has(A),j=S||!B;m.addRefId(A);var u=m.containerIndexes.get(A),L=j?Array.from(A.allChanges):Array.from(A.changes.values());!S&&w&&J._definition.indexesWithFilters&&J._definition.indexesWithFilters.forEach((function(f){!u.has(f)&&A.allChanges.has(f)&&(j?L.push(f):L.push({op:O.OPERATION.ADD,index:f}))}));for(var p=0,U=L.length;p<U;p++){var l=j?{op:O.OPERATION.ADD,index:L[p]}:L[p];if(l.op!==O.OPERATION.CLEAR){var x=l.index;if(l.op!==O.OPERATION.DELETE){var W=A.getValue(x),E=A.getType(x);if(w){if((o=J._definition.filters&&J._definition.filters[x])&&!o.call(J,y,W,v)){W&&W.$changes&&N.add(W.$changes.refId);continue}}else{var o,i=A.parent;if((o=A.getChildrenFilter())&&!o.call(i,y,J.$indexes.get(x),W,v)){W&&W.$changes&&N.add(W.$changes.refId);continue}}if(W.$changes&&(t.push(W.$changes),q++),l.op!==O.OPERATION.TOUCH)if(l.op===O.OPERATION.ADD||w)F.push.apply(F,null!==(H=A.caches[x])&&void 0!==H?H:[]),u.add(x);else if(u.has(x))F.push.apply(F,null!==(b=A.caches[x])&&void 0!==b?b:[]);else{if(u.add(x),g(F,O.OPERATION.ADD),Q(F,x),J instanceof X){var D=A.ref.$indexes.get(x);T(F,D)}W.$changes?Q(F,W.$changes.refId):C[E](F,W)}else W.$changes&&!w&&(g(F,O.OPERATION.ADD),Q(F,x),J instanceof X&&(D=A.ref.$indexes.get(x),T(F,D)),Q(F,W.$changes.refId))}else w?g(F,l.op|x):(g(F,l.op),Q(F,x))}else g(F,l.op)}},A=0;A<q;A++)I(A);return F},f.prototype.clone=function(){var O,f=new this.constructor,y=this._definition.schema;for(var S in y)"object"===typeof this[S]&&"function"===typeof(null===(O=this[S])||void 0===O?void 0:O.clone)?f[S]=this[S].clone():f[S]=this[S];return f},f.prototype.toJSON=function(){var O=this._definition.schema,f=this._definition.deprecated,y={};for(var S in O)f[S]||null===this[S]||"undefined"===typeof this[S]||(y[S]="function"===typeof this[S].toJSON?this[S].toJSON():this["_".concat(S)]);return y},f.prototype.discardAllChanges=function(){this.$changes.discardAll()},f.prototype.getByIndex=function(O){return this[this._definition.fieldsByIndex[O]]},f.prototype.deleteByIndex=function(O){this[this._definition.fieldsByIndex[O]]=void 0},f.prototype.tryEncodeTypeId=function(O,f,y){f._typeid!==y._typeid&&(g(O,v),Q(O,y._typeid))},f.prototype.getSchemaType=function(O,f,y){var S;return O[f.offset]===v&&(f.offset++,S=this.constructor._context.get(wO(O,f))),S||y},f.prototype.createTypeInstance=function(O){var f=new O;return f.$changes.root=this.$changes.root,f},f.prototype._triggerChanges=function(y){for(var S,H,b,h,v,N,m,t,q,F=new Set,I=this.$changes.root.refs,A=function(A){var J=y[A],X=J.refId,w=I.get(X),B=w.$callbacks;if((J.op&O.OPERATION.DELETE)===O.OPERATION.DELETE&&J.previousValue instanceof f&&(null===(H=null===(S=J.previousValue.$callbacks)||void 0===S?void 0:S[O.OPERATION.DELETE])||void 0===H||H.forEach((function(O){return O()}))),!B)return"continue";if(w instanceof f){if(!F.has(X))try{null===(b=null===B||void 0===B?void 0:B[O.OPERATION.REPLACE])||void 0===b||b.forEach((function(O){return O()}))}catch(j){f.onError(j)}try{B.hasOwnProperty(J.field)&&(null===(h=B[J.field])||void 0===h||h.forEach((function(O){return O(J.value,J.previousValue)})))}catch(j){f.onError(j)}}else J.op===O.OPERATION.ADD&&void 0===J.previousValue?null===(v=B[O.OPERATION.ADD])||void 0===v||v.forEach((function(O){var f;return O(J.value,null!==(f=J.dynamicIndex)&&void 0!==f?f:J.field)})):J.op===O.OPERATION.DELETE?void 0!==J.previousValue&&(null===(N=B[O.OPERATION.DELETE])||void 0===N||N.forEach((function(O){var f;return O(J.previousValue,null!==(f=J.dynamicIndex)&&void 0!==f?f:J.field)}))):J.op===O.OPERATION.DELETE_AND_ADD&&(void 0!==J.previousValue&&(null===(m=B[O.OPERATION.DELETE])||void 0===m||m.forEach((function(O){var f;return O(J.previousValue,null!==(f=J.dynamicIndex)&&void 0!==f?f:J.field)}))),null===(t=B[O.OPERATION.ADD])||void 0===t||t.forEach((function(O){var f;return O(J.value,null!==(f=J.dynamicIndex)&&void 0!==f?f:J.field)}))),J.value!==J.previousValue&&(null===(q=B[O.OPERATION.REPLACE])||void 0===q||q.forEach((function(O){var f;return O(J.value,null!==(f=J.dynamicIndex)&&void 0!==f?f:J.field)})));F.add(X)},J=0;J<y.length;J++)A(J)},f._definition=u.create(),f}();function gO(O){for(var f=[O.$changes],y=1,S={},H=S,b=function(O){var y=f[O];y.changes.forEach((function(O){var f=y.ref,S=O.index,b=f._definition?f._definition.fieldsByIndex[S]:f.$indexes.get(S);H[b]=y.getValue(S)}))},h=0;h<y;h++)b(h);return S}var RO={context:new p},sO=function(O){function f(){return null!==O&&O.apply(this,arguments)||this}return y(f,O),S([l("string",RO)],f.prototype,"name",void 0),S([l("string",RO)],f.prototype,"type",void 0),S([l("number",RO)],f.prototype,"referencedType",void 0),f}(VO),kO=function(O){function f(){var f=null!==O&&O.apply(this,arguments)||this;return f.fields=new A,f}return y(f,O),S([l("number",RO)],f.prototype,"id",void 0),S([l([sO],RO)],f.prototype,"fields",void 0),f}(VO),zO=function(O){function f(){var f=null!==O&&O.apply(this,arguments)||this;return f.types=new A,f}return y(f,O),f.encode=function(O){var y=O.constructor,S=new f;S.rootType=y._typeid;var H=function(O,f){for(var y in f){var H=new sO;H.name=y;var b=void 0;if("string"===typeof f[y])b=f[y];else{var h=f[y],v=void 0;VO.is(h)?(b="ref",v=f[y]):"string"===typeof h[b=Object.keys(h)[0]]?b+=":"+h[b]:v=h[b],H.referencedType=v?v._typeid:-1}H.type=b,O.fields.push(H)}S.types.push(O)},b=y._context.types;for(var h in b){var v=new kO;v.id=Number(h),H(v,b[h]._definition.schema)}return S.encodeAll()},f.decode=function(O,S){var H=new p,b=new f;b.decode(O,S);var h=b.types.reduce((function(O,f){var S=function(O){function f(){return null!==O&&O.apply(this,arguments)||this}return y(f,O),f}(VO),b=f.id;return O[b]=S,H.add(S,b),O}),{});b.types.forEach((function(O){var f=h[O.id];O.fields.forEach((function(O){var y;if(void 0!==O.referencedType){var S=O.type,b=h[O.referencedType];if(!b){var v=O.type.split(":");S=v[0],b=v[1]}"ref"===S?l(b,{context:H})(f.prototype,O.name):l(((y={})[S]=b,y),{context:H})(f.prototype,O.name)}else l(O.type,{context:H})(f.prototype,O.name)}))}));var v=h[b.rootType],N=new v;for(var m in v._definition.schema){var t=v._definition.schema[m];"string"!==typeof t&&(N[m]="function"===typeof t?new t:new(j(Object.keys(t)[0]).constructor))}return N},S([l([kO],RO)],f.prototype,"types",void 0),S([l("number",RO)],f.prototype,"rootType",void 0),f}(VO);B("map",{constructor:X}),B("array",{constructor:A}),B("set",{constructor:UO}),B("collection",{constructor:pO}),O.ArraySchema=A,O.CollectionSchema=pO,O.Context=p,O.MapSchema=X,O.Reflection=zO,O.ReflectionField=sO,O.ReflectionType=kO,O.Schema=VO,O.SchemaDefinition=u,O.SetSchema=UO,O.decode=LO,O.defineTypes=o,O.deprecated=E,O.dumpChanges=gO,O.encode=C,O.filter=x,O.filterChildren=W,O.hasFilter=L,O.registerType=B,O.type=l,Object.defineProperty(O,"__esModule",{value:!0})}(f)},12458:O=>{O.exports=function(O){return null!=O&&null!=O.constructor&&"function"===typeof O.constructor.isBuffer&&O.constructor.isBuffer(O)}},12434:(O,f,y)=>{"use strict";var S=y(12443),H=y(12450),b=y(12458);y.g.__TYPEDARRAY_POOL||(y.g.__TYPEDARRAY_POOL={UINT8:H([32,0]),UINT16:H([32,0]),UINT32:H([32,0]),INT8:H([32,0]),INT16:H([32,0]),INT32:H([32,0]),FLOAT:H([32,0]),DOUBLE:H([32,0]),DATA:H([32,0]),UINT8C:H([32,0]),BUFFER:H([32,0])});var h="undefined"!==typeof Uint8ClampedArray,v=y.g.__TYPEDARRAY_POOL;v.UINT8C||(v.UINT8C=H([32,0])),v.BUFFER||(v.BUFFER=H([32,0]));var N=v.DATA,m=v.BUFFER;function t(O){if(O){var f=O.length||O.byteLength,y=S.log2(f);N[y].push(O)}}function q(O){O=S.nextPow2(O);var f=S.log2(O),y=N[f];return y.length>0?y.pop():new ArrayBuffer(O)}function F(O){return new Uint8Array(q(O),0,O)}function I(O){return new Uint16Array(q(2*O),0,O)}function A(O){return new Uint32Array(q(4*O),0,O)}function J(O){return new Int8Array(q(O),0,O)}function X(O){return new Int16Array(q(2*O),0,O)}function w(O){return new Int32Array(q(4*O),0,O)}function B(O){return new Float32Array(q(4*O),0,O)}function j(O){return new Float64Array(q(8*O),0,O)}function u(O){return h?new Uint8ClampedArray(q(O),0,O):F(O)}function L(O){return new DataView(q(O),0,O)}f.free=function(O){if(b(O))m[S.log2(O.length)].push(O);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(O)&&(O=O.buffer),!O)return;var f=O.length||O.byteLength,y=0|S.log2(f);N[y].push(O)}},f.freeUint8=f.freeUint16=f.freeUint32=f.freeInt8=f.freeInt16=f.freeInt32=f.freeFloat32=f.freeFloat=f.freeFloat64=f.freeDouble=f.freeUint8Clamped=f.freeDataView=function(O){t(O.buffer)},f.freeArrayBuffer=t,f.freeBuffer=function(O){m[S.log2(O.length)].push(O)},f.malloc=function(O,f){if(void 0===f||"arraybuffer"===f)return q(O);switch(f){case"uint8":return F(O);case"uint16":return I(O);case"uint32":return A(O);case"int8":return J(O);case"int16":return X(O);case"int32":return w(O);case"float":case"float32":return B(O);case"double":case"float64":return j(O);case"uint8_clamped":return u(O);case"buffer":throw"Buffer not supported";case"data":case"dataview":return L(O);default:return null}return null},f.mallocArrayBuffer=q,f.mallocUint8=F,f.mallocUint16=I,f.mallocUint32=A,f.mallocInt8=J,f.mallocInt16=X,f.mallocInt32=w,f.mallocFloat32=f.mallocFloat=B,f.mallocFloat64=f.mallocDouble=j,f.mallocUint8Clamped=u,f.mallocDataView=L,f.clearCache=function(){for(var O=0;O<32;++O)v.UINT8[O].length=0,v.UINT16[O].length=0,v.UINT32[O].length=0,v.INT8[O].length=0,v.INT16[O].length=0,v.INT32[O].length=0,v.FLOAT[O].length=0,v.DOUBLE[O].length=0,v.UINT8C[O].length=0,N[O].length=0,m[O].length=0}},12552:(O,f,y)=>{O.exports=H;var S=y(136);function H(O,f){if(!(this instanceof H))return new H(O,f);var y=S.create();S.add(y,O,f),this.base=S.min(S.create(),O,y),this.Rg=S.clone(f),this.max=S.max(S.create(),O,y),this.mag=S.length(this.Rg)}var b=H.prototype;b.width=function(){return this.Rg[0]},b.height=function(){return this.Rg[1]},b.depth=function(){return this.Rg[2]},b.x0=function(){return this.base[0]},b.y0=function(){return this.base[1]},b.z0=function(){return this.base[2]},b.x1=function(){return this.max[0]},b.y1=function(){return this.max[1]},b.z1=function(){return this.max[2]},b.translate=function(O){return S.add(this.max,this.max,O),S.add(this.base,this.base,O),this},b.setPosition=function(O){return S.add(this.max,O,this.Rg),S.i(this.base,O),this},b.expand=function(O){var f=S.create(),y=S.create();return S.max(f,O.max,this.max),S.min(y,O.base,this.base),S.xc(f,f,y),new H(y,f)},b.intersects=function(O){return!(O.base[0]>this.max[0])&&(!(O.base[1]>this.max[1])&&(!(O.base[2]>this.max[2])&&(!(O.max[0]<this.base[0])&&(!(O.max[1]<this.base[1])&&!(O.max[2]<this.base[2])))))},b.touches=function(O){var f=this.union(O);return null!==f&&(0==f.width()||0==f.height()||0==f.depth())},b.union=function(O){if(!this.intersects(O))return null;var f=Math.max(O.base[0],this.base[0]),y=Math.max(O.base[1],this.base[1]),S=Math.max(O.base[2],this.base[2]);return new H([f,y,S],[Math.min(O.max[0],this.max[0])-f,Math.min(O.max[1],this.max[1])-y,Math.min(O.max[2],this.max[2])-S])}},12443:(O,f)=>{"use strict";function y(O){var f=32;return(O&=-O)&&f--,65535&O&&(f-=16),16711935&O&&(f-=8),252645135&O&&(f-=4),858993459&O&&(f-=2),1431655765&O&&(f-=1),f}f.INT_BITS=32,f.INT_MAX=2147483647,f.INT_MIN=-1<<31,f.sign=function(O){return(O>0)-(O<0)},f.abs=function(O){var f=O>>31;return(O^f)-f},f.min=function(O,f){return f^(O^f)&-(O<f)},f.max=function(O,f){return O^(O^f)&-(O<f)},f.isPow2=function(O){return!(O&O-1)&&!!O},f.log2=function(O){var f,y;return f=(O>65535)<<4,f|=y=((O>>>=f)>255)<<3,f|=y=((O>>>=y)>15)<<2,(f|=y=((O>>>=y)>3)<<1)|(O>>>=y)>>1},f.log10=function(O){return O>=1e9?9:O>=1e8?8:O>=1e7?7:O>=1e6?6:O>=1e5?5:O>=1e4?4:O>=1e3?3:O>=100?2:O>=10?1:0},f.popCount=function(O){return 16843009*((O=(858993459&(O-=O>>>1&1431655765))+(O>>>2&858993459))+(O>>>4)&252645135)>>>24},f.countTrailingZeros=y,f.nextPow2=function(O){return O+=0===O,--O,O|=O>>>1,O|=O>>>2,O|=O>>>4,O|=O>>>8,(O|=O>>>16)+1},f.prevPow2=function(O){return O|=O>>>1,O|=O>>>2,O|=O>>>4,O|=O>>>8,(O|=O>>>16)-(O>>>1)},f.parity=function(O){return O^=O>>>16,O^=O>>>8,O^=O>>>4,27030>>>(O&=15)&1};var S=new Array(256);!function(O){for(var f=0;f<256;++f){var y=f,S=f,H=7;for(y>>>=1;y;y>>>=1)S<<=1,S|=1&y,--H;O[f]=S<<H&255}}(S),f.reverse=function(O){return S[255&O]<<24|S[O>>>8&255]<<16|S[O>>>16&255]<<8|S[O>>>24&255]},f.interleave2=function(O,f){return(O=1431655765&((O=858993459&((O=252645135&((O=16711935&((O&=65535)|O<<8))|O<<4))|O<<2))|O<<1))|(f=1431655765&((f=858993459&((f=252645135&((f=16711935&((f&=65535)|f<<8))|f<<4))|f<<2))|f<<1))<<1},f.deinterleave2=function(O,f){return(O=65535&((O=16711935&((O=252645135&((O=858993459&((O=O>>>f&1431655765)|O>>>1))|O>>>2))|O>>>4))|O>>>16))<<16>>16},f.interleave3=function(O,f,y){return O=1227133513&((O=3272356035&((O=251719695&((O=4278190335&((O&=1023)|O<<16))|O<<8))|O<<4))|O<<2),(O|=(f=1227133513&((f=3272356035&((f=251719695&((f=4278190335&((f&=1023)|f<<16))|f<<8))|f<<4))|f<<2))<<1)|(y=1227133513&((y=3272356035&((y=251719695&((y=4278190335&((y&=1023)|y<<16))|y<<8))|y<<4))|y<<2))<<2},f.deinterleave3=function(O,f){return(O=1023&((O=4278190335&((O=251719695&((O=3272356035&((O=O>>>f&1227133513)|O>>>2))|O>>>4))|O>>>8))|O>>>16))<<22>>22},f.nextCombination=function(O){var f=O|O-1;return f+1|(~f&-~f)-1>>>y(O)+1}},12426:(O,f,y)=>{"use strict";O.exports=function(O,f,y){switch(arguments.length){case 1:return S=[],m(H=O,H,t,!0),S;case 2:return"function"===typeof f?m(O,O,f,!0):function(O,f){return S=[],m(O,f,t,!1),S}(O,f);case 3:return m(O,f,y,!1);default:throw new Error("box-intersect: Invalid arguments")}var H};var S,H=y(12434),b=y(12465),h=y(12479);function v(O,f){for(var y=0;y<O;++y)if(!(f[y]<=f[y+O]))return!0;return!1}function N(O,f,y,S){for(var H=0,b=0,h=0,N=O.length;h<N;++h){var m=O[h];if(!v(f,m)){for(var t=0;t<2*f;++t)y[H++]=m[t];S[b++]=h}}return b}function m(O,f,y,S){var v=O.length,m=f.length;if(!(v<=0||m<=0)){var t=O[0].length>>>1;if(!(t<=0)){var q,F=H.mallocDouble(2*t*v),I=H.mallocInt32(v);if((v=N(O,t,F,I))>0){if(1===t&&S)b.init(v),q=b.sweepComplete(t,y,0,v,F,I,0,v,F,I);else{var A=H.mallocDouble(2*t*m),J=H.mallocInt32(m);(m=N(f,t,A,J))>0&&(b.init(v+m),q=1===t?b.sweepBipartite(t,y,0,v,F,I,0,m,A,J):h(t,y,S,v,F,I,m,A,J),H.free(A),H.free(J))}H.free(F),H.free(I)}return q}}}function t(O,f){S.push([O,f])}},12482:(O,f)=>{"use strict";var y="d",S="ax",H="fp",b="es",h="rs",v="re",N="rb",m="bs",t="be",q="bb",F=[y,S,"vv",h,v,N,"ri",m,t,q,"bi"];function I(O){var f="bruteForce"+(O?"Full":"Partial"),S=[],h=F.slice();O||h.splice(3,0,H);var v=["function "+f+"("+h.join()+"){"];function N(f,H){var h=function(O,f,S){var H="bruteForce"+(O?"Red":"Blue")+(f?"Flip":"")+(S?"Full":""),h=["function ",H,"(",F.join(),"){","var ",b,"=2*",y,";"],v="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",N="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(S?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return O?h.push(v,"Q",":",N):h.push(N,"Q",":",v),S?h.push("if(y1<x0||x1<y0)continue;"):f?h.push("if(y0<=x0||x1<y0)continue;"):h.push("if(y0<x0||x1<y0)continue;"),h.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),f?h.push("yi,xi"):h.push("xi,yi"),h.push(");if(rv!==void 0)return rv;}}}"),{name:H,code:h.join("")}}(f,H,O);S.push(h.code),v.push("return "+h.name+"("+F.join()+");")}v.push("if(re-rs>be-bs){"),O?(N(!0,!1),v.push("}else{"),N(!1,!1)):(v.push("if(fp){"),N(!0,!0),v.push("}else{"),N(!0,!1),v.push("}}else{if(fp){"),N(!1,!0),v.push("}else{"),N(!1,!1),v.push("}")),v.push("}}return "+f);var m=S.join("")+v.join("");return new Function(m)()}f.partial=I(!1),f.full=I(!0)},12479:(O,f,y)=>{"use strict";O.exports=function(O,f,y,b,t,E,o,i,D){!function(O,f){var y=8*H.log2(f+1)*(O+1)|0,b=H.nextPow2(u*y);p.length<b&&(S.free(p),p=S.mallocInt32(b));var h=H.nextPow2(L*y);U.length<h&&(S.free(U),U=S.mallocDouble(h))}(O,b+o);var V,g=0,R=2*O;l(g++,0,0,b,0,o,y?16:0,-1/0,1/0),y||l(g++,0,0,o,0,b,1,-1/0,1/0);for(;g>0;){var s=(g-=1)*u,k=p[s],z=p[s+1],c=p[s+2],d=p[s+3],G=p[s+4],Y=p[s+5],Z=g*L,a=U[Z],M=U[Z+1],P=1&Y,e=!!(16&Y),K=t,T=E,Q=i,C=D;if(P&&(K=i,T=D,Q=t,C=E),!(2&Y&&z>=(c=X(O,k,z,c,K,T,M)))&&!(4&Y&&(z=w(O,k,z,c,K,T,a))>=c)){var r=c-z,n=G-d;if(e){if(O*r*(r+n)<I){if(void 0!==(V=N.scanComplete(O,k,f,z,c,K,T,d,G,Q,C)))return V;continue}}else{if(O*Math.min(r,n)<q){if(void 0!==(V=h(O,k,f,P,z,c,K,T,d,G,Q,C)))return V;continue}if(O*r*n<F){if(void 0!==(V=N.scanBipartite(O,k,f,P,z,c,K,T,d,G,Q,C)))return V;continue}}var OO=A(O,k,z,c,K,T,a,M);if(z<OO)if(O*(OO-z)<q){if(void 0!==(V=v(O,k+1,f,z,OO,K,T,d,G,Q,C)))return V}else if(k===O-2){if(void 0!==(V=P?N.sweepBipartite(O,f,d,G,Q,C,z,OO,K,T):N.sweepBipartite(O,f,z,OO,K,T,d,G,Q,C)))return V}else l(g++,k+1,z,OO,d,G,P,-1/0,1/0),l(g++,k+1,d,G,z,OO,1^P,-1/0,1/0);if(OO<c){var fO=m(O,k,d,G,Q,C),yO=Q[R*fO+k],SO=J(O,k,fO,G,Q,C,yO);if(SO<G&&l(g++,k,OO,c,SO,G,(4|P)+(e?16:0),yO,M),d<fO&&l(g++,k,OO,c,d,fO,(2|P)+(e?16:0),a,yO),fO+1===SO){if(void 0!==(V=e?W(O,k,f,OO,c,K,T,fO,Q,C[fO]):x(O,k,f,P,OO,c,K,T,fO,Q,C[fO])))return V}else if(fO<SO){var HO;if(e){if(OO<(HO=B(O,k,OO,c,K,T,yO))){var bO=J(O,k,OO,HO,K,T,yO);if(k===O-2){if(OO<bO&&void 0!==(V=N.sweepComplete(O,f,OO,bO,K,T,fO,SO,Q,C)))return V;if(bO<HO&&void 0!==(V=N.sweepBipartite(O,f,bO,HO,K,T,fO,SO,Q,C)))return V}else OO<bO&&l(g++,k+1,OO,bO,fO,SO,16,-1/0,1/0),bO<HO&&(l(g++,k+1,bO,HO,fO,SO,0,-1/0,1/0),l(g++,k+1,fO,SO,bO,HO,1,-1/0,1/0))}}else OO<(HO=P?j(O,k,OO,c,K,T,yO):B(O,k,OO,c,K,T,yO))&&(k===O-2?V=P?N.sweepBipartite(O,f,fO,SO,Q,C,OO,HO,K,T):N.sweepBipartite(O,f,OO,HO,K,T,fO,SO,Q,C):(l(g++,k+1,OO,HO,fO,SO,P,-1/0,1/0),l(g++,k+1,fO,SO,OO,HO,1^P,-1/0,1/0)))}}}}};var S=y(12434),H=y(12443),b=y(12482),h=b.partial,v=b.full,N=y(12465),m=y(12489),t=y(12492),q=128,F=1<<22,I=1<<22,A=t("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),J=t("lo===p0",["p0"]),X=t("lo<p0",["p0"]),w=t("hi<=p0",["p0"]),B=t("lo<=p0&&p0<=hi",["p0"]),j=t("lo<p0&&p0<=hi",["p0"]),u=6,L=2,p=S.mallocInt32(1024),U=S.mallocDouble(1024);function l(O,f,y,S,H,b,h,v,N){var m=u*O;p[m]=f,p[m+1]=y,p[m+2]=S,p[m+3]=H,p[m+4]=b,p[m+5]=h;var t=L*O;U[t]=v,U[t+1]=N}function x(O,f,y,S,H,b,h,v,N,m,t){var q=2*O,F=N*q,I=m[F+f];O:for(var A=H,J=H*q;A<b;++A,J+=q){var X=h[J+f],w=h[J+f+O];if(!(I<X||w<I)&&(!S||I!==X)){for(var B,j=v[A],u=f+1;u<O;++u){X=h[J+u],w=h[J+u+O];var L=m[F+u],p=m[F+u+O];if(w<L||p<X)continue O}if(void 0!==(B=S?y(t,j):y(j,t)))return B}}}function W(O,f,y,S,H,b,h,v,N,m){var t=2*O,q=v*t,F=N[q+f];O:for(var I=S,A=S*t;I<H;++I,A+=t){var J=h[I];if(J!==m){var X=b[A+f],w=b[A+f+O];if(!(F<X||w<F)){for(var B=f+1;B<O;++B){X=b[A+B],w=b[A+B+O];var j=N[q+B],u=N[q+B+O];if(w<j||u<X)continue O}var L=y(J,m);if(void 0!==L)return L}}}}},12489:(O,f,y)=>{"use strict";O.exports=function(O,f,y,h,v,N){if(h<=y+1)return y;var m=y,t=h,q=h+y>>>1,F=2*O,I=q,A=v[F*q+f];for(;m<t;){if(t-m<H){b(O,f,m,t,v,N),A=v[F*q+f];break}var J=t-m,X=Math.random()*J+m|0,w=v[F*X+f],B=Math.random()*J+m|0,j=v[F*B+f],u=Math.random()*J+m|0,L=v[F*u+f];w<=j?L>=j?(I=B,A=j):w>=L?(I=X,A=w):(I=u,A=L):j>=L?(I=B,A=j):L>=w?(I=X,A=w):(I=u,A=L);for(var p=F*(t-1),U=F*I,l=0;l<F;++l,++p,++U){var x=v[p];v[p]=v[U],v[U]=x}var W=N[t-1];N[t-1]=N[I],N[I]=W;for(p=F*(t-1),U=F*(I=S(O,f,m,t-1,v,N,A)),l=0;l<F;++l,++p,++U){x=v[p];v[p]=v[U],v[U]=x}W=N[t-1];if(N[t-1]=N[I],N[I]=W,q<I){for(t=I-1;m<t&&v[F*(t-1)+f]===A;)t-=1;t+=1}else{if(!(I<q))break;for(m=I+1;m<t&&v[F*m+f]===A;)m+=1}}return S(O,f,y,q,v,N,v[F*q+f])};var S=y(12492)("lo<p0",["p0"]),H=8;function b(O,f,y,S,H,b){for(var h=2*O,v=h*(y+1)+f,N=y+1;N<S;++N,v+=h)for(var m=H[v],t=N,q=h*(N-1);t>y&&H[q+f]>m;--t,q-=h){for(var F=q,I=q+h,A=0;A<h;++A,++F,++I){var J=H[F];H[F]=H[I],H[I]=J}var X=b[t];b[t]=b[t-1],b[t-1]=X}}},12492:O=>{"use strict";O.exports=function(O,y){var S="abcdef".split("").concat(y),H=[];O.indexOf("lo")>=0&&H.push("lo=e[k+n]");O.indexOf("hi")>=0&&H.push("hi=e[k+o]");return S.push(f.replace("_",H.join()).replace("$",O)),Function.apply(void 0,S)};var f="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},12471:O=>{"use strict";O.exports=function(O,S){S<=4*f?y(0,S-1,O):m(0,S-1,O)};var f=32;function y(O,f,y){for(var S=2*(O+1),H=O+1;H<=f;++H){for(var b=y[S++],h=y[S++],v=H,N=S-2;v-- >O;){var m=y[N-2],t=y[N-1];if(m<b)break;if(m===b&&t<h)break;y[N]=m,y[N+1]=t,N-=2}y[N]=b,y[N+1]=h}}function S(O,f,y){f*=2;var S=y[O*=2],H=y[O+1];y[O]=y[f],y[O+1]=y[f+1],y[f]=S,y[f+1]=H}function H(O,f,y){f*=2,y[O*=2]=y[f],y[O+1]=y[f+1]}function b(O,f,y,S){f*=2,y*=2;var H=S[O*=2],b=S[O+1];S[O]=S[f],S[O+1]=S[f+1],S[f]=S[y],S[f+1]=S[y+1],S[y]=H,S[y+1]=b}function h(O,f,y,S,H){f*=2,H[O*=2]=H[f],H[f]=y,H[O+1]=H[f+1],H[f+1]=S}function v(O,f,y){f*=2;var S=y[O*=2],H=y[f];return!(S<H)&&(S!==H||y[O+1]>y[f+1])}function N(O,f,y,S){var H=S[O*=2];return H<f||H===f&&S[O+1]<y}function m(O,t,q){var F=(t-O+1)/6|0,I=O+F,A=t-F,J=O+t>>1,X=J-F,w=J+F,B=I,j=X,u=J,L=w,p=A,U=O+1,l=t-1,x=0;v(B,j,q)&&(x=B,B=j,j=x),v(L,p,q)&&(x=L,L=p,p=x),v(B,u,q)&&(x=B,B=u,u=x),v(j,u,q)&&(x=j,j=u,u=x),v(B,L,q)&&(x=B,B=L,L=x),v(u,L,q)&&(x=u,u=L,L=x),v(j,p,q)&&(x=j,j=p,p=x),v(j,u,q)&&(x=j,j=u,u=x),v(L,p,q)&&(x=L,L=p,p=x);for(var W=q[2*j],E=q[2*j+1],o=q[2*L],i=q[2*L+1],D=2*B,V=2*u,g=2*p,R=2*I,s=2*J,k=2*A,z=0;z<2;++z){var c=q[D+z],d=q[V+z],G=q[g+z];q[R+z]=c,q[s+z]=d,q[k+z]=G}H(X,O,q),H(w,t,q);for(var Y=U;Y<=l;++Y)if(N(Y,W,E,q))Y!==U&&S(Y,U,q),++U;else if(!N(Y,o,i,q))for(;;){if(N(l,o,i,q)){N(l,W,E,q)?(b(Y,U,l,q),++U,--l):(S(Y,l,q),--l);break}if(--l<Y)break}h(O,U-1,W,E,q),h(t,l+1,o,i,q),U-2-O<=f?y(O,U-2,q):m(O,U-2,q),t-(l+2)<=f?y(l+2,t,q):m(l+2,t,q),l-U<=f?y(U,l,q):m(U,l,q)}},12465:(O,f,y)=>{"use strict";O.exports={init:function(O){var f=H.nextPow2(O);N.length<f&&(S.free(N),N=S.mallocInt32(f));m.length<f&&(S.free(m),m=S.mallocInt32(f));t.length<f&&(S.free(t),t=S.mallocInt32(f));q.length<f&&(S.free(q),q=S.mallocInt32(f));F.length<f&&(S.free(F),F=S.mallocInt32(f));I.length<f&&(S.free(I),I=S.mallocInt32(f));var y=8*f;A.length<y&&(S.free(A),A=S.mallocDouble(y))},sweepBipartite:function(O,f,y,S,H,v,F,I,w,B){for(var j=0,u=2*O,L=O-1,p=u-1,U=y;U<S;++U){var l=v[U],x=u*U;A[j++]=H[x+L],A[j++]=-(l+1),A[j++]=H[x+p],A[j++]=l}for(U=F;U<I;++U){l=B[U]+h;var W=u*U;A[j++]=w[W+L],A[j++]=-l,A[j++]=w[W+p],A[j++]=l}var E=j>>>1;b(A,E);var o=0,i=0;for(U=0;U<E;++U){var D=0|A[2*U+1];if(D>=h)J(t,q,i--,D=D-h|0);else if(D>=0)J(N,m,o--,D);else if(D<=-h){D=-D-h|0;for(var V=0;V<o;++V){if(void 0!==(g=f(N[V],D)))return g}X(t,q,i++,D)}else{D=-D-1|0;for(V=0;V<i;++V){var g;if(void 0!==(g=f(D,t[V])))return g}X(N,m,o++,D)}}},sweepComplete:function(O,f,y,S,H,h,v,w,B,j){for(var u=0,L=2*O,p=O-1,U=L-1,l=y;l<S;++l){var x=h[l]+1<<1,W=L*l;A[u++]=H[W+p],A[u++]=-x,A[u++]=H[W+U],A[u++]=x}for(l=v;l<w;++l){x=j[l]+1<<1;var E=L*l;A[u++]=B[E+p],A[u++]=1|-x,A[u++]=B[E+U],A[u++]=1|x}var o=u>>>1;b(A,o);var i=0,D=0,V=0;for(l=0;l<o;++l){var g=0|A[2*l+1],R=1&g;if(l<o-1&&g>>1===A[2*l+3]>>1&&(R=2,l+=1),g<0){for(var s=-(g>>1)-1,k=0;k<V;++k){if(void 0!==(z=f(F[k],s)))return z}if(0!==R)for(k=0;k<i;++k){if(void 0!==(z=f(N[k],s)))return z}if(1!==R)for(k=0;k<D;++k){var z;if(void 0!==(z=f(t[k],s)))return z}0===R?X(N,m,i++,s):1===R?X(t,q,D++,s):2===R&&X(F,I,V++,s)}else{s=(g>>1)-1;0===R?J(N,m,i--,s):1===R?J(t,q,D--,s):2===R&&J(F,I,V--,s)}}},scanBipartite:function(O,f,y,S,H,v,t,q,F,I,w,B){var j=0,u=2*O,L=f,p=f+O,U=1,l=1;S?l=h:U=h;for(var x=H;x<v;++x){var W=x+U,E=u*x;A[j++]=t[E+L],A[j++]=-W,A[j++]=t[E+p],A[j++]=W}for(x=F;x<I;++x){W=x+l;var o=u*x;A[j++]=w[o+L],A[j++]=-W}var i=j>>>1;b(A,i);var D=0;for(x=0;x<i;++x){var V=0|A[2*x+1];if(V<0){var g=!1;if((W=-V)>=h?(g=!S,W-=h):(g=!!S,W-=1),g)X(N,m,D++,W);else{var R=B[W],s=u*W,k=w[s+f+1],z=w[s+f+1+O];O:for(var c=0;c<D;++c){var d=N[c],G=u*d;if(!(z<t[G+f+1]||t[G+f+1+O]<k)){for(var Y=f+2;Y<O;++Y)if(w[s+Y+O]<t[G+Y]||t[G+Y+O]<w[s+Y])continue O;var Z,a=q[d];if(void 0!==(Z=S?y(R,a):y(a,R)))return Z}}}}else J(N,m,D--,V-U)}},scanComplete:function(O,f,y,S,H,v,m,t,q,F,I){for(var J=0,X=2*O,w=f,B=f+O,j=S;j<H;++j){var u=j+h,L=X*j;A[J++]=v[L+w],A[J++]=-u,A[J++]=v[L+B],A[J++]=u}for(j=t;j<q;++j){u=j+1;var p=X*j;A[J++]=F[p+w],A[J++]=-u}var U=J>>>1;b(A,U);var l=0;for(j=0;j<U;++j){var x=0|A[2*j+1];if(x<0){if((u=-x)>=h)N[l++]=u-h;else{var W=I[u-=1],E=X*u,o=F[E+f+1],i=F[E+f+1+O];O:for(var D=0;D<l;++D){var V=N[D],g=m[V];if(g===W)break;var R=X*V;if(!(i<v[R+f+1]||v[R+f+1+O]<o)){for(var s=f+2;s<O;++s)if(F[E+s+O]<v[R+s]||v[R+s+O]<F[E+s])continue O;var k=y(g,W);if(void 0!==k)return k}}}}else{for(u=x-h,D=l-1;D>=0;--D)if(N[D]===u){for(s=D+1;s<l;++s)N[s-1]=N[s];break}--l}}}};var S=y(12434),H=y(12443),b=y(12471),h=1<<28,v=1024,N=S.mallocInt32(v),m=S.mallocInt32(v),t=S.mallocInt32(v),q=S.mallocInt32(v),F=S.mallocInt32(v),I=S.mallocInt32(v),A=S.mallocDouble(8192);function J(O,f,y,S){var H=f[S],b=O[y-1];O[H]=b,f[b]=H}function X(O,f,y,S){O[y]=S,f[S]=y}},12594:O=>{"use strict";O.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12591:(O,f,y)=>{var S=y(12594),H=y(12600),b=Object.hasOwnProperty,h=Object.create(null);for(var v in S)b.call(S,v)&&(h[S[v]]=v);var N=O.exports={to:{},get:{}};function m(O,f,y){return Math.min(Math.max(f,O),y)}function t(O){var f=Math.round(O).toString(16).toUpperCase();return f.length<2?"0"+f:f}N.get=function(O){var f,y;switch(O.substring(0,3).toLowerCase()){case"hsl":f=N.get.hsl(O),y="hsl";break;case"hwb":f=N.get.hwb(O),y="hwb";break;default:f=N.get.rgb(O),y="rgb"}return f?{model:y,value:f}:null},N.get.rgb=function(O){if(!O)return null;var f,y,H,h=[0,0,0,1];if(f=O.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(H=f[2],f=f[1],y=0;y<3;y++){var v=2*y;h[y]=parseInt(f.slice(v,v+2),16)}H&&(h[3]=parseInt(H,16)/255)}else if(f=O.match(/^#([a-f0-9]{3,4})$/i)){for(H=(f=f[1])[3],y=0;y<3;y++)h[y]=parseInt(f[y]+f[y],16);H&&(h[3]=parseInt(H+H,16)/255)}else if(f=O.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(y=0;y<3;y++)h[y]=parseInt(f[y+1],0);f[4]&&(f[5]?h[3]=.01*parseFloat(f[4]):h[3]=parseFloat(f[4]))}else{if(!(f=O.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(f=O.match(/^(\w+)$/))?"transparent"===f[1]?[0,0,0,0]:b.call(S,f[1])?((h=S[f[1]])[3]=1,h):null:null;for(y=0;y<3;y++)h[y]=Math.round(2.55*parseFloat(f[y+1]));f[4]&&(f[5]?h[3]=.01*parseFloat(f[4]):h[3]=parseFloat(f[4]))}for(y=0;y<3;y++)h[y]=m(h[y],0,255);return h[3]=m(h[3],0,1),h},N.get.hsl=function(O){if(!O)return null;var f=O.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(f){var y=parseFloat(f[4]);return[(parseFloat(f[1])%360+360)%360,m(parseFloat(f[2]),0,100),m(parseFloat(f[3]),0,100),m(isNaN(y)?1:y,0,1)]}return null},N.get.hwb=function(O){if(!O)return null;var f=O.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(f){var y=parseFloat(f[4]);return[(parseFloat(f[1])%360+360)%360,m(parseFloat(f[2]),0,100),m(parseFloat(f[3]),0,100),m(isNaN(y)?1:y,0,1)]}return null},N.to.hex=function(){var O=H(arguments);return"#"+t(O[0])+t(O[1])+t(O[2])+(O[3]<1?t(Math.round(255*O[3])):"")},N.to.rgb=function(){var O=H(arguments);return O.length<4||1===O[3]?"rgb("+Math.round(O[0])+", "+Math.round(O[1])+", "+Math.round(O[2])+")":"rgba("+Math.round(O[0])+", "+Math.round(O[1])+", "+Math.round(O[2])+", "+O[3]+")"},N.to.rgb.percent=function(){var O=H(arguments),f=Math.round(O[0]/255*100),y=Math.round(O[1]/255*100),S=Math.round(O[2]/255*100);return O.length<4||1===O[3]?"rgb("+f+"%, "+y+"%, "+S+"%)":"rgba("+f+"%, "+y+"%, "+S+"%, "+O[3]+")"},N.to.hsl=function(){var O=H(arguments);return O.length<4||1===O[3]?"hsl("+O[0]+", "+O[1]+"%, "+O[2]+"%)":"hsla("+O[0]+", "+O[1]+"%, "+O[2]+"%, "+O[3]+")"},N.to.hwb=function(){var O=H(arguments),f="";return O.length>=4&&1!==O[3]&&(f=", "+O[3]),"hwb("+O[0]+", "+O[1]+"%, "+O[2]+"%"+f+")"},N.to.keyword=function(O){return h[O.slice(0,3)]}},12589:(O,f,y)=>{const S=y(12591),H=y(12616),b=["keyword","gray","hex"],h={};for(const I of Object.keys(H))h[[...H[I].labels].sort().join("")]=I;const v={};function N(O,f){if(!(this instanceof N))return new N(O,f);if(f&&f in b&&(f=null),f&&!(f in H))throw new Error("Unknown model: "+f);let y,m;if(null==O)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(O instanceof N)this.model=O.model,this.color=[...O.color],this.valpha=O.valpha;else if("string"===typeof O){const f=S.get(O);if(null===f)throw new Error("Unable to parse color from string: "+O);this.model=f.model,m=H[this.model].channels,this.color=f.value.slice(0,m),this.valpha="number"===typeof f.value[m]?f.value[m]:1}else if(O.length>0){this.model=f||"rgb",m=H[this.model].channels;const y=Array.prototype.slice.call(O,0,m);this.color=F(y,m),this.valpha="number"===typeof O[m]?O[m]:1}else if("number"===typeof O)this.model="rgb",this.color=[O>>16&255,O>>8&255,255&O],this.valpha=1;else{this.valpha=1;const f=Object.keys(O);"alpha"in O&&(f.splice(f.indexOf("alpha"),1),this.valpha="number"===typeof O.alpha?O.alpha:0);const S=f.sort().join("");if(!(S in h))throw new Error("Unable to parse color from object: "+JSON.stringify(O));this.model=h[S];const{labels:b}=H[this.model],v=[];for(y=0;y<b.length;y++)v.push(O[b[y]]);this.color=F(v)}if(v[this.model])for(m=H[this.model].channels,y=0;y<m;y++){const O=v[this.model][y];O&&(this.color[y]=O(this.color[y]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}N.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(O){let f=this.model in S.to?this:this.rgb();f=f.round("number"===typeof O?O:1);const y=1===f.valpha?f.color:[...f.color,this.valpha];return S.to[f.model](y)},percentString(O){const f=this.rgb().round("number"===typeof O?O:1),y=1===f.valpha?f.color:[...f.color,this.valpha];return S.to.rgb.percent(y)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const O={},{channels:f}=H[this.model],{labels:y}=H[this.model];for(let S=0;S<f;S++)O[y[S]]=this.color[S];return 1!==this.valpha&&(O.alpha=this.valpha),O},unitArray(){const O=this.rgb().color;return O[0]/=255,O[1]/=255,O[2]/=255,1!==this.valpha&&O.push(this.valpha),O},unitObject(){const O=this.rgb().object();return O.r/=255,O.g/=255,O.b/=255,1!==this.valpha&&(O.alpha=this.valpha),O},round(O){return O=Math.max(O||0,0),new N([...this.color.map(m(O)),this.valpha],this.model)},alpha(O){return void 0!==O?new N([...this.color,Math.max(0,Math.min(1,O))],this.model):this.valpha},red:t("rgb",0,q(255)),green:t("rgb",1,q(255)),blue:t("rgb",2,q(255)),hue:t(["hsl","hsv","hsl","hwb","hcg"],0,(O=>(O%360+360)%360)),saturationl:t("hsl",1,q(100)),lightness:t("hsl",2,q(100)),saturationv:t("hsv",1,q(100)),value:t("hsv",2,q(100)),chroma:t("hcg",1,q(100)),gray:t("hcg",2,q(100)),white:t("hwb",1,q(100)),wblack:t("hwb",2,q(100)),cyan:t("cmyk",0,q(100)),magenta:t("cmyk",1,q(100)),yellow:t("cmyk",2,q(100)),black:t("cmyk",3,q(100)),x:t("xyz",0,q(95.047)),y:t("xyz",1,q(100)),z:t("xyz",2,q(108.833)),l:t("lab",0,q(100)),a:t("lab",1),b:t("lab",2),keyword(O){return void 0!==O?new N(O):H[this.model].keyword(this.color)},hex(O){return void 0!==O?new N(O):S.to.hex(this.rgb().round().color)},hexa(O){if(void 0!==O)return new N(O);const f=this.rgb().round().color;let y=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===y.length&&(y="0"+y),S.to.hex(f)+y},rgbNumber(){const O=this.rgb().color;return(255&O[0])<<16|(255&O[1])<<8|255&O[2]},luminosity(){const O=this.rgb().color,f=[];for(const[y,S]of O.entries()){const O=S/255;f[y]=O<=.04045?O/12.92:((O+.055)/1.055)**2.4}return.2126*f[0]+.7152*f[1]+.0722*f[2]},contrast(O){const f=this.luminosity(),y=O.luminosity();return f>y?(f+.05)/(y+.05):(y+.05)/(f+.05)},level(O){const f=this.contrast(O);return f>=7?"AAA":f>=4.5?"AA":""},isDark(){const O=this.rgb().color;return(2126*O[0]+7152*O[1]+722*O[2])/1e4<128},isLight(){return!this.isDark()},negate(){const O=this.rgb();for(let f=0;f<3;f++)O.color[f]=255-O.color[f];return O},lighten(O){const f=this.hsl();return f.color[2]+=f.color[2]*O,f},darken(O){const f=this.hsl();return f.color[2]-=f.color[2]*O,f},saturate(O){const f=this.hsl();return f.color[1]+=f.color[1]*O,f},desaturate(O){const f=this.hsl();return f.color[1]-=f.color[1]*O,f},whiten(O){const f=this.hwb();return f.color[1]+=f.color[1]*O,f},blacken(O){const f=this.hwb();return f.color[2]+=f.color[2]*O,f},grayscale(){const O=this.rgb().color,f=.3*O[0]+.59*O[1]+.11*O[2];return N.rgb(f,f,f)},fade(O){return this.alpha(this.valpha-this.valpha*O)},opaquer(O){return this.alpha(this.valpha+this.valpha*O)},rotate(O){const f=this.hsl();let y=f.color[0];return y=(y+O)%360,y=y<0?360+y:y,f.color[0]=y,f},mix(O,f){if(!O||!O.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof O);const y=O.rgb(),S=this.rgb(),H=void 0===f?.5:f,b=2*H-1,h=y.alpha()-S.alpha(),v=((b*h===-1?b:(b+h)/(1+b*h))+1)/2,m=1-v;return N.rgb(v*y.red()+m*S.red(),v*y.green()+m*S.green(),v*y.blue()+m*S.blue(),y.alpha()*H+S.alpha()*(1-H))}};for(const I of Object.keys(H)){if(b.includes(I))continue;const{channels:O}=H[I];N.prototype[I]=function(){if(this.model===I)return new N(this);for(var O=arguments.length,f=new Array(O),y=0;y<O;y++)f[y]=arguments[y];return f.length>0?new N(f,I):new N([...(S=H[this.model][I].raw(this.color),Array.isArray(S)?S:[S]),this.valpha],I);var S},N[I]=function(){for(var f=arguments.length,y=new Array(f),S=0;S<f;S++)y[S]=arguments[S];let H=y[0];return"number"===typeof H&&(H=F(y,O)),new N(H,I)}}function m(O){return function(f){return function(O,f){return Number(O.toFixed(f))}(f,O)}}function t(O,f,y){O=Array.isArray(O)?O:[O];for(const S of O)(v[S]||(v[S]=[]))[f]=y;return O=O[0],function(S){let H;return void 0!==S?(y&&(S=y(S)),H=this[O](),H.color[f]=S,H):(H=this[O]().color[f],y&&(H=y(H)),H)}}function q(O){return function(f){return Math.max(0,Math.min(O,f))}}function F(O,f){for(let y=0;y<f;y++)"number"!==typeof O[y]&&(O[y]=0);return O}O.exports=N},12622:(O,f,y)=>{const S=y(12624),H={};for(const h of Object.keys(S))H[S[h]]=h;const b={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};O.exports=b;for(const h of Object.keys(b)){if(!("channels"in b[h]))throw new Error("missing channels property: "+h);if(!("labels"in b[h]))throw new Error("missing channel labels property: "+h);if(b[h].labels.length!==b[h].channels)throw new Error("channel and label counts mismatch: "+h);const{channels:O,labels:f}=b[h];delete b[h].channels,delete b[h].labels,Object.defineProperty(b[h],"channels",{value:O}),Object.defineProperty(b[h],"labels",{value:f})}b.rgb.hsl=function(O){const f=O[0]/255,y=O[1]/255,S=O[2]/255,H=Math.min(f,y,S),b=Math.max(f,y,S),h=b-H;let v,N;b===H?v=0:f===b?v=(y-S)/h:y===b?v=2+(S-f)/h:S===b&&(v=4+(f-y)/h),v=Math.min(60*v,360),v<0&&(v+=360);const m=(H+b)/2;return N=b===H?0:m<=.5?h/(b+H):h/(2-b-H),[v,100*N,100*m]},b.rgb.hsv=function(O){let f,y,S,H,b;const h=O[0]/255,v=O[1]/255,N=O[2]/255,m=Math.max(h,v,N),t=m-Math.min(h,v,N),q=function(O){return(m-O)/6/t+.5};return 0===t?(H=0,b=0):(b=t/m,f=q(h),y=q(v),S=q(N),h===m?H=S-y:v===m?H=1/3+f-S:N===m&&(H=2/3+y-f),H<0?H+=1:H>1&&(H-=1)),[360*H,100*b,100*m]},b.rgb.hwb=function(O){const f=O[0],y=O[1];let S=O[2];const H=b.rgb.hsl(O)[0],h=1/255*Math.min(f,Math.min(y,S));return S=1-1/255*Math.max(f,Math.max(y,S)),[H,100*h,100*S]},b.rgb.cmyk=function(O){const f=O[0]/255,y=O[1]/255,S=O[2]/255,H=Math.min(1-f,1-y,1-S);return[100*((1-f-H)/(1-H)||0),100*((1-y-H)/(1-H)||0),100*((1-S-H)/(1-H)||0),100*H]},b.rgb.keyword=function(O){const f=H[O];if(f)return f;let y,b=1/0;for(const H of Object.keys(S)){const f=S[H],N=(v=f,((h=O)[0]-v[0])**2+(h[1]-v[1])**2+(h[2]-v[2])**2);N<b&&(b=N,y=H)}var h,v;return y},b.keyword.rgb=function(O){return S[O]},b.rgb.xyz=function(O){let f=O[0]/255,y=O[1]/255,S=O[2]/255;f=f>.04045?((f+.055)/1.055)**2.4:f/12.92,y=y>.04045?((y+.055)/1.055)**2.4:y/12.92,S=S>.04045?((S+.055)/1.055)**2.4:S/12.92;return[100*(.4124*f+.3576*y+.1805*S),100*(.2126*f+.7152*y+.0722*S),100*(.0193*f+.1192*y+.9505*S)]},b.rgb.lab=function(O){const f=b.rgb.xyz(O);let y=f[0],S=f[1],H=f[2];y/=95.047,S/=100,H/=108.883,y=y>.008856?y**(1/3):7.787*y+16/116,S=S>.008856?S**(1/3):7.787*S+16/116,H=H>.008856?H**(1/3):7.787*H+16/116;return[116*S-16,500*(y-S),200*(S-H)]},b.hsl.rgb=function(O){const f=O[0]/360,y=O[1]/100,S=O[2]/100;let H,b,h;if(0===y)return h=255*S,[h,h,h];H=S<.5?S*(1+y):S+y-S*y;const v=2*S-H,N=[0,0,0];for(let m=0;m<3;m++)b=f+1/3*-(m-1),b<0&&b++,b>1&&b--,h=6*b<1?v+6*(H-v)*b:2*b<1?H:3*b<2?v+(H-v)*(2/3-b)*6:v,N[m]=255*h;return N},b.hsl.hsv=function(O){const f=O[0];let y=O[1]/100,S=O[2]/100,H=y;const b=Math.max(S,.01);S*=2,y*=S<=1?S:2-S,H*=b<=1?b:2-b;return[f,100*(0===S?2*H/(b+H):2*y/(S+y)),100*((S+y)/2)]},b.hsv.rgb=function(O){const f=O[0]/60,y=O[1]/100;let S=O[2]/100;const H=Math.floor(f)%6,b=f-Math.floor(f),h=255*S*(1-y),v=255*S*(1-y*b),N=255*S*(1-y*(1-b));switch(S*=255,H){case 0:return[S,N,h];case 1:return[v,S,h];case 2:return[h,S,N];case 3:return[h,v,S];case 4:return[N,h,S];case 5:return[S,h,v]}},b.hsv.hsl=function(O){const f=O[0],y=O[1]/100,S=O[2]/100,H=Math.max(S,.01);let b,h;h=(2-y)*S;const v=(2-y)*H;return b=y*H,b/=v<=1?v:2-v,b=b||0,h/=2,[f,100*b,100*h]},b.hwb.rgb=function(O){const f=O[0]/360;let y=O[1]/100,S=O[2]/100;const H=y+S;let b;H>1&&(y/=H,S/=H);const h=Math.floor(6*f),v=1-S;b=6*f-h,0!==(1&h)&&(b=1-b);const N=y+b*(v-y);let m,t,q;switch(h){default:case 6:case 0:m=v,t=N,q=y;break;case 1:m=N,t=v,q=y;break;case 2:m=y,t=v,q=N;break;case 3:m=y,t=N,q=v;break;case 4:m=N,t=y,q=v;break;case 5:m=v,t=y,q=N}return[255*m,255*t,255*q]},b.cmyk.rgb=function(O){const f=O[0]/100,y=O[1]/100,S=O[2]/100,H=O[3]/100;return[255*(1-Math.min(1,f*(1-H)+H)),255*(1-Math.min(1,y*(1-H)+H)),255*(1-Math.min(1,S*(1-H)+H))]},b.xyz.rgb=function(O){const f=O[0]/100,y=O[1]/100,S=O[2]/100;let H,b,h;return H=3.2406*f+-1.5372*y+-.4986*S,b=-.9689*f+1.8758*y+.0415*S,h=.0557*f+-.204*y+1.057*S,H=H>.0031308?1.055*H**(1/2.4)-.055:12.92*H,b=b>.0031308?1.055*b**(1/2.4)-.055:12.92*b,h=h>.0031308?1.055*h**(1/2.4)-.055:12.92*h,H=Math.min(Math.max(0,H),1),b=Math.min(Math.max(0,b),1),h=Math.min(Math.max(0,h),1),[255*H,255*b,255*h]},b.xyz.lab=function(O){let f=O[0],y=O[1],S=O[2];f/=95.047,y/=100,S/=108.883,f=f>.008856?f**(1/3):7.787*f+16/116,y=y>.008856?y**(1/3):7.787*y+16/116,S=S>.008856?S**(1/3):7.787*S+16/116;return[116*y-16,500*(f-y),200*(y-S)]},b.lab.xyz=function(O){let f,y,S;y=(O[0]+16)/116,f=O[1]/500+y,S=y-O[2]/200;const H=y**3,b=f**3,h=S**3;return y=H>.008856?H:(y-16/116)/7.787,f=b>.008856?b:(f-16/116)/7.787,S=h>.008856?h:(S-16/116)/7.787,f*=95.047,y*=100,S*=108.883,[f,y,S]},b.lab.lch=function(O){const f=O[0],y=O[1],S=O[2];let H;H=360*Math.atan2(S,y)/2/Math.PI,H<0&&(H+=360);return[f,Math.sqrt(y*y+S*S),H]},b.lch.lab=function(O){const f=O[0],y=O[1],S=O[2]/360*2*Math.PI;return[f,y*Math.cos(S),y*Math.sin(S)]},b.rgb.ansi16=function(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[y,S,H]=O;let h=null===f?b.rgb.hsv(O)[2]:f;if(h=Math.round(h/50),0===h)return 30;let v=30+(Math.round(H/255)<<2|Math.round(S/255)<<1|Math.round(y/255));return 2===h&&(v+=60),v},b.hsv.ansi16=function(O){return b.rgb.ansi16(b.hsv.rgb(O),O[2])},b.rgb.ansi256=function(O){const f=O[0],y=O[1],S=O[2];if(f===y&&y===S)return f<8?16:f>248?231:Math.round((f-8)/247*24)+232;return 16+36*Math.round(f/255*5)+6*Math.round(y/255*5)+Math.round(S/255*5)},b.ansi16.rgb=function(O){let f=O%10;if(0===f||7===f)return O>50&&(f+=3.5),f=f/10.5*255,[f,f,f];const y=.5*(1+~~(O>50));return[(1&f)*y*255,(f>>1&1)*y*255,(f>>2&1)*y*255]},b.ansi256.rgb=function(O){if(O>=232){const f=10*(O-232)+8;return[f,f,f]}let f;O-=16;return[Math.floor(O/36)/5*255,Math.floor((f=O%36)/6)/5*255,f%6/5*255]},b.rgb.hex=function(O){const f=(((255&Math.round(O[0]))<<16)+((255&Math.round(O[1]))<<8)+(255&Math.round(O[2]))).toString(16).toUpperCase();return"000000".substring(f.length)+f},b.hex.rgb=function(O){const f=O.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!f)return[0,0,0];let y=f[0];3===f[0].length&&(y=y.split("").map((O=>O+O)).join(""));const S=parseInt(y,16);return[S>>16&255,S>>8&255,255&S]},b.rgb.hcg=function(O){const f=O[0]/255,y=O[1]/255,S=O[2]/255,H=Math.max(Math.max(f,y),S),b=Math.min(Math.min(f,y),S),h=H-b;let v,N;return v=h<1?b/(1-h):0,N=h<=0?0:H===f?(y-S)/h%6:H===y?2+(S-f)/h:4+(f-y)/h,N/=6,N%=1,[360*N,100*h,100*v]},b.hsl.hcg=function(O){const f=O[1]/100,y=O[2]/100,S=y<.5?2*f*y:2*f*(1-y);let H=0;return S<1&&(H=(y-.5*S)/(1-S)),[O[0],100*S,100*H]},b.hsv.hcg=function(O){const f=O[1]/100,y=O[2]/100,S=f*y;let H=0;return S<1&&(H=(y-S)/(1-S)),[O[0],100*S,100*H]},b.hcg.rgb=function(O){const f=O[0]/360,y=O[1]/100,S=O[2]/100;if(0===y)return[255*S,255*S,255*S];const H=[0,0,0],b=f%1*6,h=b%1,v=1-h;let N=0;switch(Math.floor(b)){case 0:H[0]=1,H[1]=h,H[2]=0;break;case 1:H[0]=v,H[1]=1,H[2]=0;break;case 2:H[0]=0,H[1]=1,H[2]=h;break;case 3:H[0]=0,H[1]=v,H[2]=1;break;case 4:H[0]=h,H[1]=0,H[2]=1;break;default:H[0]=1,H[1]=0,H[2]=v}return N=(1-y)*S,[255*(y*H[0]+N),255*(y*H[1]+N),255*(y*H[2]+N)]},b.hcg.hsv=function(O){const f=O[1]/100,y=f+O[2]/100*(1-f);let S=0;return y>0&&(S=f/y),[O[0],100*S,100*y]},b.hcg.hsl=function(O){const f=O[1]/100,y=O[2]/100*(1-f)+.5*f;let S=0;return y>0&&y<.5?S=f/(2*y):y>=.5&&y<1&&(S=f/(2*(1-y))),[O[0],100*S,100*y]},b.hcg.hwb=function(O){const f=O[1]/100,y=f+O[2]/100*(1-f);return[O[0],100*(y-f),100*(1-y)]},b.hwb.hcg=function(O){const f=O[1]/100,y=1-O[2]/100,S=y-f;let H=0;return S<1&&(H=(y-S)/(1-S)),[O[0],100*S,100*H]},b.apple.rgb=function(O){return[O[0]/65535*255,O[1]/65535*255,O[2]/65535*255]},b.rgb.apple=function(O){return[O[0]/255*65535,O[1]/255*65535,O[2]/255*65535]},b.gray.rgb=function(O){return[O[0]/100*255,O[0]/100*255,O[0]/100*255]},b.gray.hsl=function(O){return[0,0,O[0]]},b.gray.hsv=b.gray.hsl,b.gray.hwb=function(O){return[0,100,O[0]]},b.gray.cmyk=function(O){return[0,0,0,O[0]]},b.gray.lab=function(O){return[O[0],0,0]},b.gray.hex=function(O){const f=255&Math.round(O[0]/100*255),y=((f<<16)+(f<<8)+f).toString(16).toUpperCase();return"000000".substring(y.length)+y},b.rgb.gray=function(O){return[(O[0]+O[1]+O[2])/3/255*100]}},12616:(O,f,y)=>{const S=y(12622),H=y(12629),b={};Object.keys(S).forEach((O=>{b[O]={},Object.defineProperty(b[O],"channels",{value:S[O].channels}),Object.defineProperty(b[O],"labels",{value:S[O].labels});const f=H(O);Object.keys(f).forEach((y=>{const S=f[y];b[O][y]=function(O){const f=function(){for(var f=arguments.length,y=new Array(f),S=0;S<f;S++)y[S]=arguments[S];const H=y[0];if(void 0===H||null===H)return H;H.length>1&&(y=H);const b=O(y);if("object"===typeof b)for(let O=b.length,h=0;h<O;h++)b[h]=Math.round(b[h]);return b};return"conversion"in O&&(f.conversion=O.conversion),f}(S),b[O][y].raw=function(O){const f=function(){for(var f=arguments.length,y=new Array(f),S=0;S<f;S++)y[S]=arguments[S];const H=y[0];return void 0===H||null===H?H:(H.length>1&&(y=H),O(y))};return"conversion"in O&&(f.conversion=O.conversion),f}(S)}))})),O.exports=b},12629:(O,f,y)=>{const S=y(12622);function H(O){const f=function(){const O={},f=Object.keys(S);for(let y=f.length,S=0;S<y;S++)O[f[S]]={distance:-1,parent:null};return O}(),y=[O];for(f[O].distance=0;y.length;){const O=y.pop(),H=Object.keys(S[O]);for(let S=H.length,b=0;b<S;b++){const S=H[b],h=f[S];-1===h.distance&&(h.distance=f[O].distance+1,h.parent=O,y.unshift(S))}}return f}function b(O,f){return function(y){return f(O(y))}}function h(O,f){const y=[f[O].parent,O];let H=S[f[O].parent][O],h=f[O].parent;for(;f[h].parent;)y.unshift(f[h].parent),H=b(S[f[h].parent][h],H),h=f[h].parent;return H.conversion=y,H}O.exports=function(O){const f=H(O),y={},S=Object.keys(f);for(let H=S.length,b=0;b<H;b++){const O=S[b];null!==f[O].parent&&(y[O]=h(O,f))}return y}},12624:O=>{"use strict";O.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},10923:function(O,f,y){"use strict";var S=this&&this.__createBinding||(Object.create?function(O,f,y,S){void 0===S&&(S=y);var H=Object.getOwnPropertyDescriptor(f,y);H&&!("get"in H?!f.__esModule:H.writable||H.configurable)||(H={enumerable:!0,get:function(){return f[y]}}),Object.defineProperty(O,S,H)}:function(O,f,y,S){void 0===S&&(S=y),O[S]=f[y]}),H=this&&this.__setModuleDefault||(Object.create?function(O,f){Object.defineProperty(O,"default",{enumerable:!0,value:f})}:function(O,f){O.default=f}),b=this&&this.__importStar||function(O){if(O&&O.__esModule)return O;var f={};if(null!=O)for(var y in O)"default"!==y&&Object.prototype.hasOwnProperty.call(O,y)&&S(f,O,y);return H(f,O),f},h=this&&this.__awaiter||function(O,f,y,S){return new(y||(y=Promise))((function(H,b){function h(O){try{N(S.next(O))}catch(f){b(f)}}function v(O){try{N(S.throw(O))}catch(f){b(f)}}function N(O){var f;O.done?H(O.value):(f=O.value,f instanceof y?f:new y((function(O){O(f)}))).then(h,v)}N((S=S.apply(O,f||[])).next())}))};Object.defineProperty(f,"__esModule",{value:!0}),f.Auth=f.Platform=void 0;const v=b(y(10855)),N=y(10926),m="colyseus-auth-token";!function(O){O.ios="ios",O.android="android"}(f.Platform||(f.Platform={}));f.Auth=class{constructor(O){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=O.replace("ws","http"),(0,N.getItem)(m,(O=>this.token=O))}get hasToken(){return!!this.token}login(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return h(this,void 0,void 0,(function*(){const f=Object.assign({},O);this.hasToken&&(f.token=this.token);const y=yield this.request("post","/auth",f);this.token=y.token,(0,N.setItem)(m,this.token);for(let O in y)this.hasOwnProperty(O)&&(this[O]=y[O]);return this.registerPingService(),this}))}save(){return h(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return h(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return h(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return h(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(O){return h(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:O})}))}acceptFriendRequest(O){return h(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:O})}))}declineFriendRequest(O){return h(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:O})}))}blockUser(O){return h(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:O})}))}unblockUser(O){return h(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:O})}))}request(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},S=arguments.length>3?arguments[3]:void 0,H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return h(this,void 0,void 0,(function*(){H.Accept="application/json",this.hasToken&&(H.Authorization="Bearer "+this.token);const b=[];for(const O in y)b.push(`${O}=${y[O]}`);const h=b.length>0?`?${b.join("&")}`:"",N={headers:H};return S&&(N.body=S),(yield v[O](`${this.endpoint}${f}${h}`,N)).data}))}logout(){this.token=void 0,(0,N.removeItem)(m),this.unregisterPingService()}registerPingService(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),O)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},10851:function(O,f,y){"use strict";var S,H=this&&this.__awaiter||function(O,f,y,S){return new(y||(y=Promise))((function(H,b){function h(O){try{N(S.next(O))}catch(f){b(f)}}function v(O){try{N(S.throw(O))}catch(f){b(f)}}function N(O){var f;O.done?H(O.value):(f=O.value,f instanceof y?f:new y((function(O){O(f)}))).then(h,v)}N((S=S.apply(O,f||[])).next())}))};Object.defineProperty(f,"__esModule",{value:!0}),f.Client=f.MatchMakeError=void 0;const b=y(10855),h=y(10863),v=y(10866);class N extends Error{constructor(O,f){super(O),this.code=f,Object.setPrototypeOf(this,N.prototype)}}f.MatchMakeError=N;const m="undefined"!==typeof window&&"undefined"!==typeof(null===(S=null===window||void 0===window?void 0:window.location)||void 0===S?void 0:S.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";f.Client=class{constructor(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m;if("string"===typeof O){const f=new URL(O),y="https:"===f.protocol||"wss:"===f.protocol,S=Number(f.port||(y?443:80));this.settings={hostname:f.hostname,pathname:"/"!==f.pathname?f.pathname:"",port:S,secure:y}}else void 0===O.port&&(O.port=O.secure?443:80),void 0===O.pathname&&(O.pathname=""),this.settings=O}joinOrCreate(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;return H(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",O,f,y)}))}create(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;return H(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",O,f,y)}))}join(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;return H(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",O,f,y)}))}joinById(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;return H(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",O,f,y)}))}reconnect(O,f){return H(this,void 0,void 0,(function*(){if("string"===typeof O&&"string"===typeof f)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[y,S]=O.split(":");return yield this.createMatchMakeRequest("reconnect",y,{reconnectionToken:S},f)}))}getAvailableRooms(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return H(this,void 0,void 0,(function*(){return(yield(0,b.get)(this.getHttpEndpoint(`${O}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(O,f,y){return H(this,void 0,void 0,(function*(){const S=this.createRoom(O.room.name,f);S.roomId=O.room.roomId,S.sessionId=O.sessionId;const b={sessionId:S.sessionId};O.reconnectionToken&&(b.reconnectionToken=O.reconnectionToken);const v=y||S;return S.connect(this.buildEndpoint(O.room,b),O.devMode&&(()=>H(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${S.roomId}'...`);let y=0;const b=()=>H(this,void 0,void 0,(function*(){y++;try{yield this.consumeSeatReservation(O,f,v),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${S.roomId}'`)}catch(H){y<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${y} out of 8)`),setTimeout(b,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(b,2e3)}))),v),new Promise(((O,f)=>{const y=(O,y)=>f(new h.ServerError(O,y));v.onError.once(y),v.onJoin.once((()=>{v.onError.remove(y),O(v)}))}))}))}createMatchMakeRequest(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},S=arguments.length>3?arguments[3]:void 0,h=arguments.length>4?arguments[4]:void 0;return H(this,void 0,void 0,(function*(){const H=(yield(0,b.post)(this.getHttpEndpoint(`${O}/${f}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(y)})).data;if(H.error)throw new N(H.error,H.code);return"reconnect"===O&&(H.reconnectionToken=y.reconnectionToken),yield this.consumeSeatReservation(H,S,h)}))}createRoom(O,f){return new v.Room(O,f)}buildEndpoint(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const y=[];for(const H in f)f.hasOwnProperty(H)&&y.push(`${H}=${f[H]}`);let S=this.settings.secure?"wss://":"ws://";return O.publicAddress?S+=`${O.publicAddress}`:S+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${S}/${O.processId}/${O.roomId}?${y.join("&")}`}getHttpEndpoint(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${O}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},10879:(O,f,y)=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.Connection=void 0;const S=y(10885);f.Connection=class{constructor(){this.events={},this.transport=new S.WebSocketTransport(this.events)}send(O){this.transport.send(O)}connect(O){this.transport.connect(O)}close(O,f){this.transport.close(O,f)}get isOpen(){return this.transport.isOpen}}},10894:(O,f)=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.utf8Length=f.utf8Read=f.ErrorCode=f.Protocol=void 0,function(O){O[O.HANDSHAKE=9]="HANDSHAKE",O[O.JOIN_ROOM=10]="JOIN_ROOM",O[O.ERROR=11]="ERROR",O[O.LEAVE_ROOM=12]="LEAVE_ROOM",O[O.ROOM_DATA=13]="ROOM_DATA",O[O.ROOM_STATE=14]="ROOM_STATE",O[O.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",O[O.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",O[O.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(f.Protocol||(f.Protocol={})),function(O){O[O.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",O[O.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",O[O.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",O[O.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",O[O.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",O[O.AUTH_FAILED=4215]="AUTH_FAILED",O[O.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(f.ErrorCode||(f.ErrorCode={})),f.utf8Read=function(O,f){const y=O[f++];for(var S="",H=0,b=f,h=f+y;b<h;b++){var v=O[b];if(0!==(128&v))if(192!==(224&v))if(224!==(240&v)){if(240!==(248&v))throw new Error("Invalid byte "+v.toString(16));(H=(7&v)<<18|(63&O[++b])<<12|(63&O[++b])<<6|63&O[++b])>=65536?(H-=65536,S+=String.fromCharCode(55296+(H>>>10),56320+(1023&H))):S+=String.fromCharCode(H)}else S+=String.fromCharCode((15&v)<<12|(63&O[++b])<<6|63&O[++b]);else S+=String.fromCharCode((31&v)<<6|63&O[++b]);else S+=String.fromCharCode(v)}return S},f.utf8Length=function(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",f=0,y=0;for(let S=0,H=O.length;S<H;S++)f=O.charCodeAt(S),f<128?y+=1:f<2048?y+=2:f<55296||f>=57344?y+=3:(S++,y+=4);return y+1}},10866:function(O,f,y){"use strict";var S=this&&this.__createBinding||(Object.create?function(O,f,y,S){void 0===S&&(S=y);var H=Object.getOwnPropertyDescriptor(f,y);H&&!("get"in H?!f.__esModule:H.writable||H.configurable)||(H={enumerable:!0,get:function(){return f[y]}}),Object.defineProperty(O,S,H)}:function(O,f,y,S){void 0===S&&(S=y),O[S]=f[y]}),H=this&&this.__setModuleDefault||(Object.create?function(O,f){Object.defineProperty(O,"default",{enumerable:!0,value:f})}:function(O,f){O.default=f}),b=this&&this.__importStar||function(O){if(O&&O.__esModule)return O;var f={};if(null!=O)for(var y in O)"default"!==y&&Object.prototype.hasOwnProperty.call(O,y)&&S(f,O,y);return H(f,O),f};Object.defineProperty(f,"__esModule",{value:!0}),f.Room=void 0;const h=b(y(10872)),v=y(10879),N=y(10894),m=y(10903),t=y(10910),q=y(10913),F=y(10916),I=y(10863);class A{constructor(O,f){this.onStateChange=(0,q.createSignal)(),this.onError=(0,q.createSignal)(),this.onLeave=(0,q.createSignal)(),this.onJoin=(0,q.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,t.createNanoEvents)(),this.roomId=null,this.name=O,f&&(this.serializer=new((0,m.getSerializer)("schema")),this.rootSchema=f,this.serializer.state=new f),this.onError(((O,f)=>{var y;return null===(y=console.warn)||void 0===y?void 0:y.call(console,`colyseus.js - onError => (${O}) ${f}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const S=new v.Connection;y.connection=S,S.events.onmessage=A.prototype.onMessageCallback.bind(y),S.events.onclose=function(O){var S;if(!y.hasJoined)return null===(S=console.warn)||void 0===S||S.call(console,`Room connection was closed unexpectedly (${O.code}): ${O.reason}`),void y.onError.invoke(O.code,O.reason);O.code===I.CloseCode.DEVMODE_RESTART&&f?f():(y.onLeave.invoke(O.code),y.destroy())},S.events.onerror=function(O){var f;null===(f=console.warn)||void 0===f||f.call(console,`Room, onError (${O.code}): ${O.reason}`),y.onError.invoke(O.code,O.reason)},S.connect(O)}leave(){let O=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((f=>{this.onLeave((O=>f(O))),this.connection?O?this.connection.send([N.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(I.CloseCode.CONSENTED)}))}onMessage(O,f){return this.onMessageHandlers.on(this.getMessageHandlerKey(O),f)}send(O,f){const y=[N.Protocol.ROOM_DATA];let S;if("string"===typeof O?F.encode.string(y,O):F.encode.number(y,O),void 0!==f){const O=h.encode(f);S=new Uint8Array(y.length+O.byteLength),S.set(new Uint8Array(y),0),S.set(new Uint8Array(O),y.length)}else S=new Uint8Array(y);this.connection.send(S.buffer)}sendBytes(O,f){const y=[N.Protocol.ROOM_DATA_BYTES];let S;"string"===typeof O?F.encode.string(y,O):F.encode.number(y,O),S=new Uint8Array(y.length+(f.byteLength||f.length)),S.set(new Uint8Array(y),0),S.set(new Uint8Array(f),y.length),this.connection.send(S.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(O){const f=Array.from(new Uint8Array(O.data)),y=f[0];if(y===N.Protocol.JOIN_ROOM){let O=1;const y=(0,N.utf8Read)(f,O);if(O+=(0,N.utf8Length)(y),this.serializerId=(0,N.utf8Read)(f,O),O+=(0,N.utf8Length)(this.serializerId),!this.serializer){const O=(0,m.getSerializer)(this.serializerId);this.serializer=new O}f.length>O&&this.serializer.handshake&&this.serializer.handshake(f,{offset:O}),this.reconnectionToken=`${this.roomId}:${y}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([N.Protocol.JOIN_ROOM])}else if(y===N.Protocol.ERROR){const O={offset:1},y=F.decode.number(f,O),S=F.decode.string(f,O);this.onError.invoke(y,S)}else if(y===N.Protocol.LEAVE_ROOM)this.leave();else if(y===N.Protocol.ROOM_DATA_SCHEMA){const O={offset:1},y=this.serializer.getState().constructor._context.get(F.decode.number(f,O)),S=new y;S.decode(f,O),this.dispatchMessage(y,S)}else if(y===N.Protocol.ROOM_STATE)f.shift(),this.setState(f);else if(y===N.Protocol.ROOM_STATE_PATCH)f.shift(),this.patch(f);else if(y===N.Protocol.ROOM_DATA){const y={offset:1},S=F.decode.stringCheck(f,y)?F.decode.string(f,y):F.decode.number(f,y),H=f.length>y.offset?h.decode(O.data,y.offset):void 0;this.dispatchMessage(S,H)}else if(y===N.Protocol.ROOM_DATA_BYTES){const O={offset:1},y=F.decode.stringCheck(f,O)?F.decode.string(f,O):F.decode.number(f,O);this.dispatchMessage(y,new Uint8Array(f.slice(O.offset)))}}setState(O){this.serializer.setState(O),this.onStateChange.invoke(this.serializer.getState())}patch(O){this.serializer.patch(O),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(O,f){var y;const S=this.getMessageHandlerKey(O);this.onMessageHandlers.events[S]?this.onMessageHandlers.emit(S,f):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",O,f):null===(y=console.warn)||void 0===y||y.call(console,`colyseus.js: onMessage() not registered for type '${O}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(O){switch(typeof O){case"function":return`$${O._typeid}`;case"string":return O;case"number":return`i${O}`;default:throw new Error("invalid message type.")}}}f.Room=A},10926:(O,f)=>{"use strict";let y;function S(){return y||(y="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(O,f){this.cache[O]=f},getItem:function(O){this.cache[O]},removeItem:function(O){delete this.cache[O]}}),y}Object.defineProperty(f,"__esModule",{value:!0}),f.getItem=f.removeItem=f.setItem=void 0,f.setItem=function(O,f){S().setItem(O,f)},f.removeItem=function(O){S().removeItem(O)},f.getItem=function(O,f){const y=S().getItem(O);"undefined"!==typeof Promise&&y instanceof Promise?y.then((O=>f(O))):f(y)}},10910:(O,f)=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.createNanoEvents=void 0;f.createNanoEvents=()=>({emit(O){let f=this.events[O]||[];for(var y=arguments.length,S=new Array(y>1?y-1:0),H=1;H<y;H++)S[H-1]=arguments[H];for(let b=0,h=f.length;b<h;b++)f[b](...S)},events:{},on(O,f){var y;return(null===(y=this.events[O])||void 0===y?void 0:y.push(f))||(this.events[O]=[f]),()=>{var y;this.events[O]=null===(y=this.events[O])||void 0===y?void 0:y.filter((O=>f!==O))}}})},10913:(O,f)=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.createSignal=f.EventEmitter=void 0;class y{constructor(){this.handlers=[]}register(O){return this.handlers.push(O),this}invoke(){for(var O=arguments.length,f=new Array(O),y=0;y<O;y++)f[y]=arguments[y];this.handlers.forEach((O=>O.apply(this,f)))}invokeAsync(){for(var O=arguments.length,f=new Array(O),y=0;y<O;y++)f[y]=arguments[y];return Promise.all(this.handlers.map((O=>O.apply(this,f))))}remove(O){const f=this.handlers.indexOf(O);this.handlers[f]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}f.EventEmitter=y,f.createSignal=function(){const O=new y;function f(f){return O.register(f,null===this)}return f.once=f=>{const y=function(){for(var S=arguments.length,H=new Array(S),b=0;b<S;b++)H[b]=arguments[b];f.apply(this,H),O.remove(y)};O.register(y)},f.remove=f=>O.remove(f),f.invoke=function(){return O.invoke(...arguments)},f.invokeAsync=function(){return O.invokeAsync(...arguments)},f.clear=()=>O.clear(),f}},10863:(O,f)=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.ServerError=f.CloseCode=void 0,function(O){O[O.CONSENTED=4e3]="CONSENTED",O[O.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(f.CloseCode||(f.CloseCode={}));class y extends Error{constructor(O,f){super(f),this.name="ServerError",this.code=O}}f.ServerError=y},10844:(O,f,y)=>{"use strict";f.b=void 0,y(10847);var S=y(10851);Object.defineProperty(f,"b",{enumerable:!0,get:function(){return S.Client}});var H=y(10894);var b=y(10866);var h=y(10923);const v=y(10932);const N=y(10936),m=y(10903);(0,m.registerSerializer)("schema",v.SchemaSerializer),(0,m.registerSerializer)("none",N.NoneSerializer)},10847:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=O=>null!==O&&"object"===typeof O&&O.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},10872:(O,f)=>{"use strict";function y(O,f){if(this._offset=f,O instanceof ArrayBuffer)this._buffer=O,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(O))throw new Error("Invalid argument");this._buffer=O.buffer,this._view=new DataView(this._buffer,O.byteOffset,O.byteLength)}}Object.defineProperty(f,"__esModule",{value:!0}),f.decode=f.encode=void 0,y.prototype._array=function(O){for(var f=new Array(O),y=0;y<O;y++)f[y]=this._parse();return f},y.prototype._map=function(O){for(var f={},y=0;y<O;y++)f[this._parse()]=this._parse();return f},y.prototype._str=function(O){var f=function(O,f,y){for(var S="",H=0,b=f,h=f+y;b<h;b++){var v=O.getUint8(b);if(0!==(128&v))if(192!==(224&v))if(224!==(240&v)){if(240!==(248&v))throw new Error("Invalid byte "+v.toString(16));(H=(7&v)<<18|(63&O.getUint8(++b))<<12|(63&O.getUint8(++b))<<6|63&O.getUint8(++b))>=65536?(H-=65536,S+=String.fromCharCode(55296+(H>>>10),56320+(1023&H))):S+=String.fromCharCode(H)}else S+=String.fromCharCode((15&v)<<12|(63&O.getUint8(++b))<<6|63&O.getUint8(++b));else S+=String.fromCharCode((31&v)<<6|63&O.getUint8(++b));else S+=String.fromCharCode(v)}return S}(this._view,this._offset,O);return this._offset+=O,f},y.prototype._bin=function(O){var f=this._buffer.slice(this._offset,this._offset+O);return this._offset+=O,f},y.prototype._parse=function(){var O,f=this._view.getUint8(this._offset++),y=0,S=0,H=0,b=0;if(f<192)return f<128?f:f<144?this._map(15&f):f<160?this._array(15&f):this._str(31&f);if(f>223)return-1*(255-f+1);switch(f){case 192:return null;case 194:return!1;case 195:return!0;case 196:return y=this._view.getUint8(this._offset),this._offset+=1,this._bin(y);case 197:return y=this._view.getUint16(this._offset),this._offset+=2,this._bin(y);case 198:return y=this._view.getUint32(this._offset),this._offset+=4,this._bin(y);case 199:if(y=this._view.getUint8(this._offset),S=this._view.getInt8(this._offset+1),this._offset+=2,-1===S){var h=this._view.getUint32(this._offset);return H=this._view.getInt32(this._offset+4),b=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*H+b)+h/1e6)}return[S,this._bin(y)];case 200:return y=this._view.getUint16(this._offset),S=this._view.getInt8(this._offset+2),this._offset+=3,[S,this._bin(y)];case 201:return y=this._view.getUint32(this._offset),S=this._view.getInt8(this._offset+4),this._offset+=5,[S,this._bin(y)];case 202:return O=this._view.getFloat32(this._offset),this._offset+=4,O;case 203:return O=this._view.getFloat64(this._offset),this._offset+=8,O;case 204:return O=this._view.getUint8(this._offset),this._offset+=1,O;case 205:return O=this._view.getUint16(this._offset),this._offset+=2,O;case 206:return O=this._view.getUint32(this._offset),this._offset+=4,O;case 207:return H=this._view.getUint32(this._offset)*Math.pow(2,32),b=this._view.getUint32(this._offset+4),this._offset+=8,H+b;case 208:return O=this._view.getInt8(this._offset),this._offset+=1,O;case 209:return O=this._view.getInt16(this._offset),this._offset+=2,O;case 210:return O=this._view.getInt32(this._offset),this._offset+=4,O;case 211:return H=this._view.getInt32(this._offset)*Math.pow(2,32),b=this._view.getUint32(this._offset+4),this._offset+=8,H+b;case 212:return S=this._view.getInt8(this._offset),this._offset+=1,0===S?void(this._offset+=1):[S,this._bin(1)];case 213:return S=this._view.getInt8(this._offset),this._offset+=1,[S,this._bin(2)];case 214:return S=this._view.getInt8(this._offset),this._offset+=1,-1===S?(O=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*O)):[S,this._bin(4)];case 215:return S=this._view.getInt8(this._offset),this._offset+=1,0===S?(H=this._view.getInt32(this._offset)*Math.pow(2,32),b=this._view.getUint32(this._offset+4),this._offset+=8,new Date(H+b)):-1===S?(H=this._view.getUint32(this._offset),b=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&H)+b)+(H>>>2)/1e6)):[S,this._bin(8)];case 216:return S=this._view.getInt8(this._offset),this._offset+=1,[S,this._bin(16)];case 217:return y=this._view.getUint8(this._offset),this._offset+=1,this._str(y);case 218:return y=this._view.getUint16(this._offset),this._offset+=2,this._str(y);case 219:return y=this._view.getUint32(this._offset),this._offset+=4,this._str(y);case 220:return y=this._view.getUint16(this._offset),this._offset+=2,this._array(y);case 221:return y=this._view.getUint32(this._offset),this._offset+=4,this._array(y);case 222:return y=this._view.getUint16(this._offset),this._offset+=2,this._map(y);case 223:return y=this._view.getUint32(this._offset),this._offset+=4,this._map(y)}throw new Error("Could not parse")},f.decode=function(O){var f=new y(O,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),S=f._parse();if(f._offset!==O.byteLength)throw new Error(O.byteLength-f._offset+" trailing bytes");return S};function S(O,f,y){for(var S=0,H=0,b=y.length;H<b;H++)(S=y.charCodeAt(H))<128?O.setUint8(f++,S):S<2048?(O.setUint8(f++,192|S>>6),O.setUint8(f++,128|63&S)):S<55296||S>=57344?(O.setUint8(f++,224|S>>12),O.setUint8(f++,128|S>>6&63),O.setUint8(f++,128|63&S)):(H++,S=65536+((1023&S)<<10|1023&y.charCodeAt(H)),O.setUint8(f++,240|S>>18),O.setUint8(f++,128|S>>12&63),O.setUint8(f++,128|S>>6&63),O.setUint8(f++,128|63&S))}function H(O,f,y){var S=typeof y,b=0,h=0,v=0,N=0,m=0,t=0;if("string"===S){if(m=function(O){for(var f=0,y=0,S=0,H=O.length;S<H;S++)(f=O.charCodeAt(S))<128?y+=1:f<2048?y+=2:f<55296||f>=57344?y+=3:(S++,y+=4);return y}(y),m<32)O.push(160|m),t=1;else if(m<256)O.push(217,m),t=2;else if(m<65536)O.push(218,m>>8,m),t=3;else{if(!(m<4294967296))throw new Error("String too long");O.push(219,m>>24,m>>16,m>>8,m),t=5}return f.push({_str:y,_length:m,_offset:O.length}),t+m}if("number"===S)return Math.floor(y)===y&&isFinite(y)?y>=0?y<128?(O.push(y),1):y<256?(O.push(204,y),2):y<65536?(O.push(205,y>>8,y),3):y<4294967296?(O.push(206,y>>24,y>>16,y>>8,y),5):(v=y/Math.pow(2,32)|0,N=y>>>0,O.push(207,v>>24,v>>16,v>>8,v,N>>24,N>>16,N>>8,N),9):y>=-32?(O.push(y),1):y>=-128?(O.push(208,y),2):y>=-32768?(O.push(209,y>>8,y),3):y>=-2147483648?(O.push(210,y>>24,y>>16,y>>8,y),5):(v=Math.floor(y/Math.pow(2,32)),N=y>>>0,O.push(211,v>>24,v>>16,v>>8,v,N>>24,N>>16,N>>8,N),9):(O.push(203),f.push({_float:y,_length:8,_offset:O.length}),9);if("object"===S){if(null===y)return O.push(192),1;if(Array.isArray(y)){if((m=y.length)<16)O.push(144|m),t=1;else if(m<65536)O.push(220,m>>8,m),t=3;else{if(!(m<4294967296))throw new Error("Array too large");O.push(221,m>>24,m>>16,m>>8,m),t=5}for(b=0;b<m;b++)t+=H(O,f,y[b]);return t}if(y instanceof Date){var q=y.getTime(),F=Math.floor(q/1e3),I=1e6*(q-1e3*F);return F>=0&&I>=0&&F<=17179869183?0===I&&F<=4294967295?(O.push(214,255,F>>24,F>>16,F>>8,F),6):(v=F/4294967296,N=4294967295&F,O.push(215,255,I>>22,I>>14,I>>6,v,N>>24,N>>16,N>>8,N),10):(v=Math.floor(F/4294967296),N=F>>>0,O.push(199,12,255,I>>24,I>>16,I>>8,I,v>>24,v>>16,v>>8,v,N>>24,N>>16,N>>8,N),15)}if(y instanceof ArrayBuffer){if((m=y.byteLength)<256)O.push(196,m),t=2;else if(m<65536)O.push(197,m>>8,m),t=3;else{if(!(m<4294967296))throw new Error("Buffer too large");O.push(198,m>>24,m>>16,m>>8,m),t=5}return f.push({_bin:y,_length:m,_offset:O.length}),t+m}if("function"===typeof y.toJSON)return H(O,f,y.toJSON());var A=[],J="",X=Object.keys(y);for(b=0,h=X.length;b<h;b++)void 0!==y[J=X[b]]&&"function"!==typeof y[J]&&A.push(J);if((m=A.length)<16)O.push(128|m),t=1;else if(m<65536)O.push(222,m>>8,m),t=3;else{if(!(m<4294967296))throw new Error("Object too large");O.push(223,m>>24,m>>16,m>>8,m),t=5}for(b=0;b<m;b++)t+=H(O,f,J=A[b]),t+=H(O,f,y[J]);return t}if("boolean"===S)return O.push(y?195:194),1;if("undefined"===S)return O.push(192),1;if("function"===typeof y.toJSON)return H(O,f,y.toJSON());throw new Error("Could not encode")}f.encode=function(O){var f=[],y=[],b=H(f,y,O),h=new ArrayBuffer(b),v=new DataView(h),N=0,m=0,t=-1;y.length>0&&(t=y[0]._offset);for(var q,F=0,I=0,A=0,J=f.length;A<J;A++)if(v.setUint8(m+A,f[A]),A+1===t){if(F=(q=y[N])._length,I=m+t,q._bin)for(var X=new Uint8Array(q._bin),w=0;w<F;w++)v.setUint8(I+w,X[w]);else q._str?S(v,I,q._str):void 0!==q._float&&v.setFloat64(I,q._float);m+=F,y[++N]&&(t=y[N]._offset)}return h}},10936:(O,f)=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.NoneSerializer=void 0;f.NoneSerializer=class{setState(O){}getState(){return null}patch(O){}teardown(){}handshake(O){}}},10932:(O,f,y)=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.SchemaSerializer=void 0;const S=y(10916);f.SchemaSerializer=class{setState(O){return this.state.decode(O)}getState(){return this.state}patch(O){return this.state.decode(O)}teardown(){var O,f;null===(f=null===(O=this.state)||void 0===O?void 0:O.$changes)||void 0===f||f.root.clearRefs()}handshake(O,f){if(this.state){(new S.Reflection).decode(O,f)}else this.state=S.Reflection.decode(O,f)}}},10903:(O,f)=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.getSerializer=f.registerSerializer=void 0;const y={};f.registerSerializer=function(O,f){y[O]=f},f.getSerializer=function(O){const f=y[O];if(!f)throw new Error("missing serializer: "+O);return f}},10885:function(O,f,y){"use strict";var S=this&&this.__importDefault||function(O){return O&&O.__esModule?O:{default:O}};Object.defineProperty(f,"__esModule",{value:!0}),f.WebSocketTransport=void 0;const H=S(y(10888)),b=globalThis.WebSocket||H.default;f.WebSocketTransport=class{constructor(O){this.events=O}send(O){O instanceof ArrayBuffer?this.ws.send(O):Array.isArray(O)&&this.ws.send(new Uint8Array(O).buffer)}connect(O){this.ws=new b(O,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(O,f){this.ws.close(O,f)}get isOpen(){return this.ws.readyState===b.OPEN}}},10888:O=>{"use strict";O.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12450:O=>{"use strict";function f(O,y,S){var H=0|O[S];if(H<=0)return[];var b,h=new Array(H);if(S===O.length-1)for(b=0;b<H;++b)h[b]=y;else for(b=0;b<H;++b)h[b]=f(O,y,S+1);return h}O.exports=function(O,y){switch("undefined"===typeof y&&(y=0),typeof O){case"number":if(O>0)return function(O,f){var y,S;for(y=new Array(O),S=0;S<O;++S)y[S]=f;return y}(0|O,y);break;case"object":if("number"===typeof O.length)return f(O,y,0)}return[]}},12399:(O,f,y)=>{O.exports=function(){var O=this;this.components={},this.comps=this.components;var f=this.components,y=1,H={},b=[],h=[],v={timeout:!1,removals:[],multiComps:[]};function N(O,y){var S=f[y],b=H[y],h=b.hash[O];h&&(b.remove(O),S.ab&&(S.multi?(h.forEach((f=>{f&&S.ab(O,f)})),h.length=0):S.ab(O,h)),v.removals.push(b),m())}function m(){v.timeout||(v.timeout=!0,setTimeout(t,1))}function t(){v.timeout=!1,q()}function q(){v.multiComps.length&&function(O){for(var f=0;f<O.length;f++){var{entID:y,data:S}=O[f],H=S.hash[y];if(H){for(var b=0;b<H.length;b++)H[b]||(H.splice(b,1),b--);0===H.length&&(S.remove(y),v.removals.push(S))}}O.length=0}(v.multiComps),v.removals.length&&function(O){for(var f=0;f<O.length;f++){O[f].flush()}O.length=0}(v.removals)}this.Ai=H,this._systems=b,this._renderSystems=h,this.Vg=function(f){var S=y++;return Array.isArray(f)&&f.forEach((f=>O.Xe(S,f))),S},this.deleteEntity=function(f){return Object.keys(H).forEach((O=>{H[O].hash[f]&&N(f,O)})),O},this.th=function(O){if(!O)throw new Error("Missing component definition");var y=O.name;if(!y)throw new Error("Component definition must have a name property.");if("string"!==typeof y)throw new Error("Component name must be a string.");if(""===y)throw new Error("Component name must be a non-empty string.");if(H[y])throw new Error(`Component ${y} already exists.`);var v={};return v.name=y,v.multi=!!O.multi,v.order=isNaN(O.order)?99:O.order,v.stateConstructor=O.stateConstructor||null,v.state=O.state||{},v.Ad=O.Ad||null,v.ab=O.ab||null,v.system=O.system||null,v.Md=O.Md||null,f[y]=v,H[y]=new S,H[y]._pendingMultiCleanup=!1,H[y]._multiCleanupIDs=v.multi?[]:null,v.system&&(b.push(y),b.sort(((O,y)=>f[O].order-f[y].order))),v.Md&&(h.push(y),h.sort(((O,y)=>f[O].order-f[y].order))),y},this.overwriteComponent=function(O,y){var S=f[O];if(!S)throw new Error(`Unknown component: ${O}`);if(!y)throw new Error("Missing component definition");if(S.name!==y.name)throw new Error("Overwriting component must use the same name property.");var v={};v.name=O,v.multi=!!y.multi,v.order=isNaN(y.order)?99:y.order,v.state=y.state||{},v.Ad=y.Ad||null,v.ab=y.ab||null,v.system=y.system||null,v.Md=y.Md||null,f[O]=v,H[O]._pendingMultiCleanup=!1,H[O]._multiCleanupIDs=v.multi?[]:null;var N=b.indexOf(O);v.system&&N<0&&b.push(O),!v.system&&N>=0&&b.splice(N,1),b.sort(((O,y)=>f[O].order-f[y].order));var m=h.indexOf(O);v.Md&&m<0&&h.push(O),!v.Md&&m>=0&&h.splice(m,1),h.sort(((O,y)=>f[O].order-f[y].order));var t=v.state;return this.wg(O).forEach((O=>{for(var f in t)f in O||(O[f]=t[f]);v.Ad&&v.Ad(O.Jd,O)})),O},this.deleteComponent=function(y){var S=H[y];if(!S)throw new Error(`Unknown component: ${y}`);S.flush(),S.list.forEach((O=>{O&&N(O.Jd||O[0].Jd,y)}));var v=b.indexOf(y),m=h.indexOf(y);return v>-1&&b.splice(v,1),m>-1&&h.splice(m,1),H[y].dispose(),delete H[y],delete f[y],O},this.Xe=function(O,y,S){var b,h=f[y],v=H[y];if(!v)throw new Error(`Unknown component: ${y}.`);if(v.hash[O]&&!h.multi)throw new Error(`Entity ${O} already has component: ${y}.`);if(h.stateConstructor){if(!(b=new h.stateConstructor).hasOwnProperty("Jd"))throw new Error(`Component ${h.name} stateConstructor type does not have property __id`)}else b=Object.assign({},{Jd:O},h.state,S);if(b.Jd=O,h.multi){var N=v.hash[O];N||(N=[],v.add(O,N)),N.push(b)}else v.add(O,b);return h.Ad&&h.Ad(O,b),this},this.if=function(O,f){var y=H[f];if(!y)throw new Error(`Unknown component: ${f}.`);return!!y.hash[O]},this._e=function(f,y){if(!H[y])throw new Error(`Unknown component: ${y}.`);return N(f,y),O},this.getState=function(O,f){var y=H[f];if(!y)throw new Error(`Unknown component: ${f}.`);return y.hash[O]},this.wg=function(O){var f=H[O];if(!f)throw new Error(`Unknown component: ${O}.`);return q(),f.list},this.vk=function(O){if(!H[O])throw new Error(`Unknown component: ${O}.`);var f=H[O].hash;return O=>f[O]},this.yk=function(O){if(!H[O])throw new Error(`Unknown component: ${O}.`);var f=H[O].hash;return O=>!!f[O]},this.td=function(y){q();for(var S=0;S<b.length;S++){var h=b[S],v=f[h],N=H[h];v.system(y,N.list),q()}return O},this.render=function(y){q();for(var S=0;S<h.length;S++){var b=h[S],v=f[b],N=H[b];v.Md(y,N.list),q()}return O},this.removeMultiComponent=function(y,S,b){var h=f[S],N=H[S];if(!N)throw new Error(`Unknown component: ${S}.`);if(!h.multi)throw new Error("removeMultiComponent called on non-multi component");return function(O,f,y,S){var H=y.hash[O];if(H){var b=H[S];b&&(H[S]=null,f.ab&&f.ab(O,b),v.multiComps.push({entID:O,data:y}),m())}}(y,h,N,b),O}};var S=y(12405)},12405:O=>{function f(O,f){var y=O._map[f];if(delete O.hash[f],delete O._map[f],y===O.list.length-1)O.list.pop();else{var S=O.list.pop();if(O.list[y]=S,null===S||null===S[0]){var H=O.list.length;for(var b in O._map)if(O._map[b]===H)return void(O._map[b]=y)}else{var h=S.Jd||S[0].Jd;O._map[h]=y}}}O.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(O,f){if("number"===typeof this._map[O]){var y=this._map[O];this.hash[O]=f,this.list[y]=f}else this._map[O]=this.list.length,this.hash[O]=f,this.list.push(f)}remove(O){var f=this._map[O];this.hash[O]=null,this.list[f]=null,this._pendingRemovals.push(O)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var O=0;O<this._pendingRemovals.length;O++){var y=this._pendingRemovals[O];null===this.hash[y]&&f(this,y)}this._pendingRemovals.length=0}}},12676:O=>{"use strict";O.exports=function(O,f,y,S,H,b){var h=+f[0],v=+f[1],N=+f[2],m=+y[0],t=+y[1],q=+y[2],F=Math.sqrt(m*m+t*t+q*q);if(0===F)throw new Error("Can't raycast along a zero vector");return function(O,f,y,S,H,b,h,v,N,m){for(var t=0,q=Math.floor,F=0|q(f),I=0|q(y),A=0|q(S),J=H>0?1:-1,X=b>0?1:-1,w=h>0?1:-1,B=Math.abs(1/H),j=Math.abs(1/b),u=Math.abs(1/h),L=B<1/0?B*(J>0?F+1-f:f-F):1/0,p=j<1/0?j*(X>0?I+1-y:y-I):1/0,U=u<1/0?u*(w>0?A+1-S:S-A):1/0,l=-1;t<=v;){var x=O(F,I,A);if(x)return N&&(N[0]=f+t*H,N[1]=y+t*b,N[2]=S+t*h),m&&(m[0]=m[1]=m[2]=0,0===l&&(m[0]=-J),1===l&&(m[1]=-X),2===l&&(m[2]=-w)),x;L<p?L<U?(F+=J,t=L,L+=B,l=0):(A+=w,t=U,U+=u,l=2):p<U?(I+=X,t=p,p+=j,l=1):(A+=w,t=U,U+=u,l=2)}return N&&(N[0]=f+t*H,N[1]=y+t*b,N[2]=S+t*h),m&&(m[0]=m[1]=m[2]=0),0}(O,h,v,N,m/=F,t/=F,q/=F,S="undefined"===typeof S?64:+S,H,b)}},12709:(O,f,y)=>{"use strict";y.d(f,{c:()=>b});var S=y(688);function H(){this.tj=!1,this.stopPropagation=!1,this.uj=!1,this.disabled=!1}class b{constructor(O,f){this.version="0.7.0";var y=Object.assign({},new H,f||{});this.element=O||document,this.tj=!!y.tj,this.stopPropagation=!!y.stopPropagation,this.uj=!!y.uj,this.disabled=!!y.disabled,this.filterEvents=(O,f)=>!0,this.down=new S.EventEmitter,this.up=new S.EventEmitter,this.state={},this.og={dx:0,dy:0,lk:0,ng:0,mk:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?v(this):document.addEventListener("DOMContentLoaded",(O=>{v(this)}),{once:!0})}bind(O){for(var f=arguments.length,y=new Array(f>1?f-1:0),S=1;S<f;S++)y[S-1]=arguments[S];y.forEach((f=>{var y=this._keyBindmap[f]||[];y.includes(O)||(y.push(O),this._keyBindmap[f]=y)})),this.state[O]=!!this.state[O],this.pressCount[O]=this.pressCount[O]||0,this.releaseCount[O]=this.releaseCount[O]||0}unbind(O){for(var f in this._keyBindmap){var y=this._keyBindmap[f],S=y.indexOf(O);S>-1&&y.splice(S,1)}}getBindings(){var O={};for(var f in this._keyBindmap){this._keyBindmap[f].forEach((y=>{O[y]=O[y]||[],O[y].push(f)}))}return O}td(){h(this.og),h(this.pressCount),h(this.releaseCount)}}function h(O){for(var f in O)O[f]=0}function v(O){window.addEventListener("keydown",A.bind(null,O,!0),!1),window.addEventListener("keyup",A.bind(null,O,!1),!1);var f={passive:!0};O.element.addEventListener("touchstart",q.bind(void 0,O),{passive:!1}),O.element.addEventListener("touchend",I.bind(void 0,O),f),O.element.addEventListener("mousedown",J.bind(null,O,!0),f),window.document.addEventListener("mouseup",J.bind(null,O,!1),f),O.element.addEventListener("touchmove",X.bind(null,O),f),O.element.addEventListener("mousemove",X.bind(null,O),f),window.PointerEvent,O.element.addEventListener("wheel",w.bind(null,O),f),O.element.addEventListener("contextmenu",B.bind(null,O),!1),window.addEventListener("blur",j.bind(null,O),!1)}var N=0,m=0,t=null;function q(O,f){f.preventDefault(),F(f)}function F(O){let f=!1;for(let y=0;y<O.touches.length;++y)if(O.touches[y].identifier===t){f=!0;break}if(!f){const f=O.changedTouches[0];N=f.clientX,m=f.clientY,t=f.identifier}}function I(O,f){for(var y=f.changedTouches,S=0;S<y.length;++S)y[S].identifier===t&&(t=null)}function A(O,f,y){u(y.code,f,O,y)}function J(O,f,y){if("pointerId"in y)if(f){if(null!==O._touches.currID)return;O._touches.currID=y.pointerId}else{if(O._touches.currID!==y.pointerId)return;O._touches.currID=null}return u("Mouse"+("button"in y?y.button+1:1),f,O,y),!1}function X(O,f){var y=f.movementX||f.mozMovementX||0,S=f.movementY||f.mozMovementY||0;if(f.touches&&0===(y|S)){var H=function(O){F(O);for(let f=0;f<O.changedTouches.length;++f)if(O.changedTouches[f].identifier==t){const y=O.changedTouches[f],S=[y.clientX-N,y.clientY-m];return N=y.clientX,m=y.clientY,S}return console.error(`Did not find touch id ${t}`),[0,0]}(f);y=H[0],S=H[1]}O.og.dx+=y,O.og.dy+=S}function w(O,f){var y=1;switch(f.deltaMode){case 0:y=1;break;case 1:y=12;break;case 2:y=O.element.clientHeight||window.innerHeight}O.og.lk+=(f.deltaX||0)*y,O.og.ng+=(f.deltaY||0)*y,O.og.mk+=(f.deltaZ||0)*y}function B(O,f){if(!O.uj)return f.preventDefault(),!1}function j(O){for(var f in O._keyStates)O._keyStates[f]&&(/^Mouse\d/.test(f)||u(f,!1,O,{code:f,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function u(O,f,y,S){var H=y._keyBindmap[O];H&&(L(y._keyStates[O],f)&&(y._keyStates[O]=f,H.forEach((O=>{(!y.filterEvents||y.filterEvents(S,O))&&function(O,f,y,S){var H=f?y.pressCount:y.releaseCount;H[O]=(H[O]||0)+1;var b=y._bindPressCount[O]||0;(b+=f?1:-1)<0&&(b=0);y._bindPressCount[O]=b;var h=y.state[O];if(L(h,b)){y.state[O]=b>0;var v=f?y.down:y.up;y.disabled||v.emit(O,S)}}(O,f,y,S)}))),"button"in S||(y.tj&&!S.defaultPrevented&&S.preventDefault(),y.stopPropagation&&S.stopPropagation()))}function L(O,f){return O?!f:f}},10978:O=>{"use strict";O.exports=function(O){for(var f=new Array(O),y=0;y<O;++y)f[y]=y;return f}},10983:O=>{function f(O){return!!O.constructor&&"function"===typeof O.constructor.isBuffer&&O.constructor.isBuffer(O)}O.exports=function(O){return null!=O&&(f(O)||function(O){return"function"===typeof O.readFloatLE&&"function"===typeof O.slice&&f(O.slice(0,0))}(O)||!!O._isBuffer)}},12678:(O,f,y)=>{"use strict";y.d(f,{d:()=>S});class S{constructor(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Zh=!1,this.$h=!1,this.Xh=30,this.Yh=0,this.gi=!1,this.fullscreen=!1,this.ai=function(O){},this.bi=function(){},this.ei=function(){},this.bb=function(){},this.ci=function(O){},this.onFullscreenChanged=function(O){},m((()=>{!function(O,f){O._nowObject=performance||Date,O._lastTick=0,O._renderAccum=0,O._rt=0,O._frameCB=v.bind(null,O),requestAnimationFrame(O._frameCB),f>0&&(O._intervalCB=h.bind(null,O),O._interval=setInterval(O._intervalCB,Math.max(f,1e3/O.Xh/2)))}(this,f),function(O,f){if(!f)return;var y=!1,S=!1;document.addEventListener("pointerlockchange",(S=>{y=document.pointerLockElement===f,O.ci(y)})),document.addEventListener("fullscreenchange",(y=>{S=document.fullscreenElement===f,O.onFullscreenChanged(S)})),Object.defineProperty(O,"gi",{get:()=>y,set:O=>{O&&!y?N(f):y&&!O&&function(O){O.exitPointerLock&&O.exitPointerLock()}(document)}}),Object.defineProperty(O,"fullscreen",{get:()=>S,set:O=>{O&&!S?f.requestFullscreen():S&&!O&&document.exitFullscreen()}}),f.addEventListener("click",(H=>{O.Zh&&!y&&N(f),O.$h&&!S&&f.requestFullscreen()}));var H=()=>O.bb();if(window.ResizeObserver){new ResizeObserver(H).observe(f)}else window.addEventListener("resize",H)}(this,O),this.ei()}))}}var H=3,b=20;function h(O){for(var f=1e3/O.Xh,y=O._nowObject.now()+b,S=0;O._nowObject.now()>=O._lastTick+f&&O._nowObject.now()<y&&++S<=H;)O.ai(f),O._lastTick+=f;var h=5*(f+5),v=O._nowObject.now();if(v-O._lastTick>h)for(;v>=O._lastTick+f;)O._lastTick+=f}function v(O){requestAnimationFrame(O._frameCB),h(O);var f=O._nowObject.now(),y=f-O._rt;if(O._rt=f,O.Yh>0){O._renderAccum+=y;var S=1e3/O.Yh;if(O._renderAccum<S)return;O._renderAccum=Math.min(O._renderAccum-S,S)}var H=1e3/O.Xh,b=(f-O._lastTick)/H;O.bi(y,b,H)}function N(O){O.requestPointerLock&&O.requestPointerLock()}var m=O=>{if("loading"===document.readyState){var f=()=>{document.removeEventListener("readystatechange",f),O()};document.addEventListener("readystatechange",f)}else setTimeout(O,1)}},10969:(O,f,y)=>{var S=y(10978),H=y(10983),b="undefined"!==typeof Float64Array;function h(O,f){return O[0]-f[0]}function v(){var O,f=this.stride,y=new Array(f.length);for(O=0;O<y.length;++O)y[O]=[Math.abs(f[O]),O];y.sort(h);var S=new Array(y.length);for(O=0;O<S.length;++O)S[O]=y[O][1];return S}function N(O,f){var y=["View",f,"d",O].join("");f<0&&(y="View_Nil"+O);var H="generic"===O;if(-1===f){var b="function "+y+"(a){this.data=a;};var proto="+y+".prototype;proto.dtype='"+O+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+y+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+y+"(a){return new "+y+"(a);}";return new Function(b)()}if(0===f){b="function "+y+"(a,d) {this.data = a;this.offset = d};var proto="+y+".prototype;proto.dtype='"+O+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+y+"_copy() {return new "+y+"(this.data,this.offset)};proto.pick=function "+y+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+y+"_get(){return "+(H?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+y+"_set(v){return "+(H?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+y+"(a,b,c,d){return new "+y+"(a,d)}";return new Function("TrivialArray",b)(m[O][0])}b=["'use strict'"];var h=S(f),N=h.map((function(O){return"i"+O})),t="this.offset+"+h.map((function(O){return"this.stride["+O+"]*i"+O})).join("+"),q=h.map((function(O){return"b"+O})).join(","),F=h.map((function(O){return"c"+O})).join(",");b.push("function "+y+"(a,"+q+","+F+",d){this.data=a","this.shape=["+q+"]","this.stride=["+F+"]","this.offset=d|0}","var proto="+y+".prototype","proto.dtype='"+O+"'","proto.dimension="+f),b.push("Object.defineProperty(proto,'size',{get:function "+y+"_size(){return "+h.map((function(O){return"this.shape["+O+"]"})).join("*"),"}})"),1===f?b.push("proto.order=[0]"):(b.push("Object.defineProperty(proto,'order',{get:"),f<4?(b.push("function "+y+"_order(){"),2===f?b.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===f&&b.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):b.push("ORDER})")),b.push("proto.set=function "+y+"_set("+N.join(",")+",v){"),H?b.push("return this.data.set("+t+",v)}"):b.push("return this.data["+t+"]=v}"),b.push("proto.get=function "+y+"_get("+N.join(",")+"){"),H?b.push("return this.data.get("+t+")}"):b.push("return this.data["+t+"]}"),b.push("proto.index=function "+y+"_index(",N.join(),"){return "+t+"}"),b.push("proto.hi=function "+y+"_hi("+N.join(",")+"){return new "+y+"(this.data,"+h.map((function(O){return["(typeof i",O,"!=='number'||i",O,"<0)?this.shape[",O,"]:i",O,"|0"].join("")})).join(",")+","+h.map((function(O){return"this.stride["+O+"]"})).join(",")+",this.offset)}");var I=h.map((function(O){return"a"+O+"=this.shape["+O+"]"})),A=h.map((function(O){return"c"+O+"=this.stride["+O+"]"}));b.push("proto.lo=function "+y+"_lo("+N.join(",")+"){var b=this.offset,d=0,"+I.join(",")+","+A.join(","));for(var J=0;J<f;++J)b.push("if(typeof i"+J+"==='number'&&i"+J+">=0){d=i"+J+"|0;b+=c"+J+"*d;a"+J+"-=d}");b.push("return new "+y+"(this.data,"+h.map((function(O){return"a"+O})).join(",")+","+h.map((function(O){return"c"+O})).join(",")+",b)}"),b.push("proto.step=function "+y+"_step("+N.join(",")+"){var "+h.map((function(O){return"a"+O+"=this.shape["+O+"]"})).join(",")+","+h.map((function(O){return"b"+O+"=this.stride["+O+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(J=0;J<f;++J)b.push("if(typeof i"+J+"==='number'){d=i"+J+"|0;if(d<0){c+=b"+J+"*(a"+J+"-1);a"+J+"=ceil(-a"+J+"/d)}else{a"+J+"=ceil(a"+J+"/d)}b"+J+"*=d}");b.push("return new "+y+"(this.data,"+h.map((function(O){return"a"+O})).join(",")+","+h.map((function(O){return"b"+O})).join(",")+",c)}");var X=new Array(f),w=new Array(f);for(J=0;J<f;++J)X[J]="a[i"+J+"]",w[J]="b[i"+J+"]";b.push("proto.transpose=function "+y+"_transpose("+N+"){"+N.map((function(O,f){return O+"=("+O+"===undefined?"+f+":"+O+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+y+"(this.data,"+X.join(",")+","+w.join(",")+",this.offset)}"),b.push("proto.pick=function "+y+"_pick("+N+"){var a=[],b=[],c=this.offset");for(J=0;J<f;++J)b.push("if(typeof i"+J+"==='number'&&i"+J+">=0){c=(c+this.stride["+J+"]*i"+J+")|0}else{a.push(this.shape["+J+"]);b.push(this.stride["+J+"])}");return b.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),b.push("return function construct_"+y+"(data,shape,stride,offset){return new "+y+"(data,"+h.map((function(O){return"shape["+O+"]"})).join(",")+","+h.map((function(O){return"stride["+O+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",b.join("\n"))(m[O],v)}var m={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};O.exports=function(O,f,y,S){if(void 0===O)return(0,m.array[0])([]);"number"===typeof O&&(O=[O]),void 0===f&&(f=[O.length]);var h=f.length;if(void 0===y){y=new Array(h);for(var v=h-1,t=1;v>=0;--v)y[v]=t,t*=f[v]}if(void 0===S){S=0;for(v=0;v<h;++v)y[v]<0&&(S-=(f[v]-1)*y[v])}for(var q=function(O){if(H(O))return"buffer";if(b)switch(Object.prototype.toString.call(O)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(O)?"array":"generic"}(O),F=m[q];F.length<=h+1;)F.push(N(q,F.length-1));return(0,F[h+1])(O,f,y,S)}},10946:O=>{var f;self,f=()=>(()=>{"use strict";var O={d:(f,y)=>{for(var S in y)O.o(y,S)&&!O.o(f,S)&&Object.defineProperty(f,S,{enumerable:!0,get:y[S]})},o:(O,f)=>Object.prototype.hasOwnProperty.call(O,f)},f={};O.d(f,{default:()=>g});var y,S=function(O,f){var y=f.x-O.x,S=f.y-O.y;return Math.sqrt(y*y+S*S)},H=function(O){return O*(Math.PI/180)},b=new Map,h=function(O){b.has(O)&&clearTimeout(b.get(O)),b.set(O,setTimeout(O,100))},v=function(O,f,y){for(var S,H=f.split(/[ ,]+/g),b=0;b<H.length;b+=1)S=H[b],O.addEventListener?O.addEventListener(S,y,!1):O.attachEvent&&O.attachEvent(S,y)},N=function(O,f,y){for(var S,H=f.split(/[ ,]+/g),b=0;b<H.length;b+=1)S=H[b],O.removeEventListener?O.removeEventListener(S,y):O.detachEvent&&O.detachEvent(S,y)},m=function(O){return O.preventDefault(),O.type.match(/^touch/)?O.changedTouches:O},t=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},q=function(O,f){f.top||f.right||f.bottom||f.left?(O.style.top=f.top,O.style.right=f.right,O.style.bottom=f.bottom,O.style.left=f.left):(O.style.left=f.x+"px",O.style.top=f.y+"px")},F=function(O,f,y){var S=I(O);for(var H in S)if(S.hasOwnProperty(H))if("string"==typeof f)S[H]=f+" "+y;else{for(var b="",h=0,v=f.length;h<v;h+=1)b+=f[h]+" "+y+", ";S[H]=b.slice(0,-2)}return S},I=function(O){var f={};return f[O]="",["webkit","Moz","o"].forEach((function(y){f[y+O.charAt(0).toUpperCase()+O.slice(1)]=""})),f},A=function(O,f){for(var y in f)f.hasOwnProperty(y)&&(O[y]=f[y]);return O},J=function(O,f){if(O.length)for(var y=0,S=O.length;y<S;y+=1)f(O[y]);else f(O)},X="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,w=window.matchMedia("(any-hover: none)").matches,B=!!("ontouchstart"in window),j=!!window.PointerEvent,u=!!window.MSPointerEvent,L={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},p={start:"mousedown",move:"mousemove",end:"mouseup"},U={};function l(){}X&&!w?y=L:j?y={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:u?y={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:B?(y=L,U=p):y=p,l.prototype.on=function(O,f){var y,S=this,H=O.split(/[ ,]+/g);S._handlers_=S._handlers_||{};for(var b=0;b<H.length;b+=1)y=H[b],S._handlers_[y]=S._handlers_[y]||[],S._handlers_[y].push(f);return S},l.prototype.off=function(O,f){var y=this;return y._handlers_=y._handlers_||{},void 0===O?y._handlers_={}:void 0===f?y._handlers_[O]=null:y._handlers_[O]&&y._handlers_[O].indexOf(f)>=0&&y._handlers_[O].splice(y._handlers_[O].indexOf(f),1),y},l.prototype.trigger=function(O,f){var y,S=this,H=O.split(/[ ,]+/g);S._handlers_=S._handlers_||{};for(var b=0;b<H.length;b+=1)y=H[b],S._handlers_[y]&&S._handlers_[y].length&&S._handlers_[y].forEach((function(O){O.call(S,{type:y,target:S},f)}))},l.prototype.config=function(O){var f=this;f.options=f.defaults||{},O&&(f.options=function(O,f){var y={};for(var S in O)O.hasOwnProperty(S)&&f.hasOwnProperty(S)?y[S]=f[S]:O.hasOwnProperty(S)&&(y[S]=O[S]);return y}(f.options,O))},l.prototype.bindEvt=function(O,f){var S=this;return S._domHandlers_=S._domHandlers_||{},S._domHandlers_[f]=function(){"function"==typeof S["on"+f]?S["on"+f].apply(S,arguments):console.warn('[WARNING] : Missing "on'+f+'" handler.')},v(O,y[f],S._domHandlers_[f]),U[f]&&v(O,U[f],S._domHandlers_[f]),S},l.prototype.unbindEvt=function(O,f){var S=this;return S._domHandlers_=S._domHandlers_||{},N(O,y[f],S._domHandlers_[f]),U[f]&&N(O,U[f],S._domHandlers_[f]),delete S._domHandlers_[f],this};const x=l;function W(O,f){return this.identifier=f.identifier,this.position=f.position,this.frontPosition=f.frontPosition,this.collection=O,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(f),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=W.id,W.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}W.prototype=new x,W.constructor=W,W.id=0,W.prototype.buildEl=function(O){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},W.prototype.stylize=function(){if(this.options.dataOnly)return this;var O=this.options.fadeTime+"ms",f=function(){var O=I("borderRadius");for(var f in O)O.hasOwnProperty(f)&&(O[f]="50%");return O}(),y=F("transition","opacity",O),S={};return S.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},S.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},S.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},A(S.el,y),"circle"===this.options.shape&&A(S.back,f),A(S.front,f),this.applyStyles(S),this},W.prototype.applyStyles=function(O){for(var f in this.ui)if(this.ui.hasOwnProperty(f))for(var y in O[f])this.ui[f].style[y]=O[f][y];return this},W.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},W.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},W.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},W.prototype.show=function(O){var f=this;return f.options.dataOnly||(clearTimeout(f.removeTimeout),clearTimeout(f.showTimeout),clearTimeout(f.restTimeout),f.addToDom(),f.restCallback(),setTimeout((function(){f.ui.el.style.opacity=1}),0),f.showTimeout=setTimeout((function(){f.trigger("shown",f.instance),"function"==typeof O&&O.call(this)}),f.options.fadeTime)),f},W.prototype.hide=function(O){var f=this;if(f.options.dataOnly)return f;if(f.ui.el.style.opacity=f.options.restOpacity,clearTimeout(f.removeTimeout),clearTimeout(f.showTimeout),clearTimeout(f.restTimeout),f.removeTimeout=setTimeout((function(){var y="dynamic"===f.options.mode?"none":"block";f.ui.el.style.display=y,"function"==typeof O&&O.call(f),f.trigger("hidden",f.instance)}),f.options.fadeTime),f.options.restJoystick){var y=f.options.restJoystick,S={};S.x=!0===y||!1!==y.x?0:f.instance.frontPosition.x,S.y=!0===y||!1!==y.y?0:f.instance.frontPosition.y,f.setPosition(O,S)}return f},W.prototype.setPosition=function(O,f){var y=this;y.frontPosition={x:f.x,y:f.y};var S=y.options.fadeTime+"ms",H={};H.front=F("transition",["transform"],S);var b={front:{}};b.front={transform:"translate("+y.frontPosition.x+"px,"+y.frontPosition.y+"px)"},y.applyStyles(H),y.applyStyles(b),y.restTimeout=setTimeout((function(){"function"==typeof O&&O.call(y),y.restCallback()}),y.options.fadeTime)},W.prototype.restCallback=function(){var O=this,f={};f.front=F("transition","none",""),O.applyStyles(f),O.trigger("rested",O.instance)},W.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},W.prototype.computeDirection=function(O){var f,y,S,H=O.angle.radian,b=Math.PI/4,h=Math.PI/2;if(H>b&&H<3*b&&!O.lockX?f="up":H>-b&&H<=b&&!O.lockY?f="left":H>3*-b&&H<=-b&&!O.lockX?f="down":O.lockY||(f="right"),O.lockY||(y=H>-h&&H<h?"left":"right"),O.lockX||(S=H>0?"up":"down"),O.force>this.options.threshold){var v,N={};for(v in this.direction)this.direction.hasOwnProperty(v)&&(N[v]=this.direction[v]);var m={};for(v in this.direction={x:y,y:S,angle:f},O.direction=this.direction,N)N[v]===this.direction[v]&&(m[v]=!0);if(m.x&&m.y&&m.angle)return O;m.x&&m.y||this.trigger("plain",O),m.x||this.trigger("plain:"+y,O),m.y||this.trigger("plain:"+S,O),m.angle||this.trigger("dir dir:"+f,O)}else this.resetDirection();return O};const E=W;function o(O,f){var y=this;y.nipples=[],y.idles=[],y.actives=[],y.ids=[],y.pressureIntervals={},y.manager=O,y.id=o.id,o.id+=1,y.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},y.config(f),"static"!==y.options.mode&&"semi"!==y.options.mode||(y.options.multitouch=!1),y.options.multitouch||(y.options.maxNumberOfNipples=1);var S=getComputedStyle(y.options.zone.parentElement);return S&&"flex"===S.display&&(y.parentIsFlex=!0),y.updateBox(),y.prepareNipples(),y.vj(),y.begin(),y.nipples}o.prototype=new x,o.constructor=o,o.id=0,o.prototype.prepareNipples=function(){var O=this,f=O.nipples;f.on=O.on.bind(O),f.off=O.off.bind(O),f.options=O.options,f.destroy=O.destroy.bind(O),f.ids=O.ids,f.id=O.id,f.processOnMove=O.processOnMove.bind(O),f.processOnEnd=O.processOnEnd.bind(O),f.get=function(O){if(void 0===O)return f[0];for(var y=0,S=f.length;y<S;y+=1)if(f[y].identifier===O)return f[y];return!1}},o.prototype.vj=function(){var O=this;O.bindEvt(O.options.zone,"start"),O.options.zone.style.touchAction="none",O.options.zone.style.msTouchAction="none"},o.prototype.begin=function(){var O=this,f=O.options;if("static"===f.mode){var y=O.createNipple(f.position,O.manager.getIdentifier());y.add(),O.idles.push(y)}},o.prototype.createNipple=function(O,f){var y=this,S=y.manager.scroll,H={},b=y.options,h=y.parentIsFlex?S.x:S.x+y.box.left,v=y.parentIsFlex?S.y:S.y+y.box.top;if(O.x&&O.y)H={x:O.x-h,y:O.y-v};else if(O.top||O.right||O.bottom||O.left){var N=document.createElement("DIV");N.style.display="hidden",N.style.top=O.top,N.style.right=O.right,N.style.bottom=O.bottom,N.style.left=O.left,N.style.position="absolute",b.zone.appendChild(N);var m=N.getBoundingClientRect();b.zone.removeChild(N),H=O,O={x:m.left+S.x,y:m.top+S.y}}var t=new E(y,{color:b.color,size:b.size,threshold:b.threshold,fadeTime:b.fadeTime,dataOnly:b.dataOnly,restJoystick:b.restJoystick,restOpacity:b.restOpacity,mode:b.mode,identifier:f,position:O,zone:b.zone,frontPosition:{x:0,y:0},shape:b.shape});return b.dataOnly||(q(t.ui.el,H),q(t.ui.front,t.frontPosition)),y.nipples.push(t),y.trigger("added "+t.identifier+":added",t),y.manager.trigger("added "+t.identifier+":added",t),y.bindNipple(t),t},o.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},o.prototype.bindNipple=function(O){var f,y=this,S=function(O,S){f=O.type+" "+S.id+":"+O.type,y.trigger(f,S)};O.on("destroyed",y.onDestroyed.bind(y)),O.on("shown hidden rested dir plain",S),O.on("dir:up dir:right dir:down dir:left",S),O.on("plain:up plain:right plain:down plain:left",S)},o.prototype.pressureFn=function(O,f,y){var S=this,H=0;clearInterval(S.pressureIntervals[y]),S.pressureIntervals[y]=setInterval(function(){var y=O.force||O.pressure||O.webkitForce||0;y!==H&&(f.trigger("pressure",y),S.trigger("pressure "+f.identifier+":pressure",y),H=y)}.bind(S),100)},o.prototype.onstart=function(O){var f=this,y=f.options,S=O;return O=m(O),f.updateBox(),J(O,(function(H){f.actives.length<y.maxNumberOfNipples?f.processOnStart(H):S.type.match(/^touch/)&&(Object.keys(f.manager.ids).forEach((function(y){if(Object.values(S.touches).findIndex((function(O){return O.identifier===y}))<0){var H=[O[0]];H.identifier=y,f.processOnEnd(H)}})),f.actives.length<y.maxNumberOfNipples&&f.processOnStart(H))})),f.manager.bindDocument(),!1},o.prototype.processOnStart=function(O){var f,y=this,H=y.options,b=y.manager.getIdentifier(O),h=O.force||O.pressure||O.webkitForce||0,v={x:O.pageX,y:O.pageY},N=y.getOrCreate(b,v);N.identifier!==b&&y.manager.removeIdentifier(N.identifier),N.identifier=b;var m=function(f){f.trigger("start",f),y.trigger("start "+f.id+":start",f),f.show(),h>0&&y.pressureFn(O,f,f.identifier),y.processOnMove(O)};if((f=y.idles.indexOf(N))>=0&&y.idles.splice(f,1),y.actives.push(N),y.ids.push(N.identifier),"semi"!==H.mode)m(N);else{if(!(S(v,N.position)<=H.catchDistance))return N.destroy(),void y.processOnStart(O);m(N)}return N},o.prototype.getOrCreate=function(O,f){var y,S=this,H=S.options;return/(semi|static)/.test(H.mode)?(y=S.idles[0])?(S.idles.splice(0,1),y):"semi"===H.mode?S.createNipple(f,O):(console.warn("Coudln't find the needed nipple."),!1):y=S.createNipple(f,O)},o.prototype.processOnMove=function(O){var f=this,y=f.options,b=f.manager.getIdentifier(O),h=f.nipples.get(b),v=f.manager.scroll;if(function(O){return isNaN(O.buttons)?0!==O.pressure:0!==O.buttons}(O)){if(!h)return console.error("Found zombie joystick with ID "+b),void f.manager.removeIdentifier(b);if(y.dynamicPage){var N=h.el.getBoundingClientRect();h.position={x:v.x+N.left,y:v.y+N.top}}h.identifier=b;var m=h.options.size/2,t={x:O.pageX,y:O.pageY};y.lockX&&(t.y=h.position.y),y.lockY&&(t.x=h.position.x);var q,F,I,A,J,X,w,B,j,u,L=S(t,h.position),p=(q=t,I=(F=h.position).x-q.x,A=F.y-q.y,function(O){return O*(180/Math.PI)}(Math.atan2(A,I))),U=H(p),l=L/m,x={distance:L,position:t};if("circle"===h.options.shape?(J=Math.min(L,m),w=h.position,B=J,u={x:0,y:0},j=H(j=p),u.x=w.x-B*Math.cos(j),u.y=w.y-B*Math.sin(j),X=u):(X=function(O,f,y){return{x:Math.min(Math.max(O.x,f.x-y),f.x+y),y:Math.min(Math.max(O.y,f.y-y),f.y+y)}}(t,h.position,m),J=S(X,h.position)),y.follow){if(L>m){var W=t.x-X.x,E=t.y-X.y;h.position.x+=W,h.position.y+=E,h.el.style.top=h.position.y-(f.box.top+v.y)+"px",h.el.style.left=h.position.x-(f.box.left+v.x)+"px",L=S(t,h.position)}}else t=X,L=J;var o=t.x-h.position.x,i=t.y-h.position.y;h.frontPosition={x:o,y:i},y.dataOnly||(h.ui.front.style.transform="translate("+o+"px,"+i+"px)");var D={identifier:h.identifier,position:t,force:l,pressure:O.force||O.pressure||O.webkitForce||0,distance:L,angle:{radian:U,degree:p},vector:{x:o/m,y:-i/m},raw:x,instance:h,lockX:y.lockX,lockY:y.lockY};(D=h.computeDirection(D)).angle={radian:H(180-p),degree:180-p},h.trigger("move",D),f.trigger("move "+h.id+":move",D)}else this.processOnEnd(O)},o.prototype.processOnEnd=function(O){var f=this,y=f.options,S=f.manager.getIdentifier(O),H=f.nipples.get(S),b=f.manager.removeIdentifier(H.identifier);H&&(y.dataOnly||H.hide((function(){"dynamic"===y.mode&&(H.trigger("removed",H),f.trigger("removed "+H.id+":removed",H),f.manager.trigger("removed "+H.id+":removed",H),H.destroy())})),clearInterval(f.pressureIntervals[H.identifier]),H.resetDirection(),H.trigger("end",H),f.trigger("end "+H.id+":end",H),f.ids.indexOf(H.identifier)>=0&&f.ids.splice(f.ids.indexOf(H.identifier),1),f.actives.indexOf(H)>=0&&f.actives.splice(f.actives.indexOf(H),1),/(semi|static)/.test(y.mode)?f.idles.push(H):f.nipples.indexOf(H)>=0&&f.nipples.splice(f.nipples.indexOf(H),1),f.manager.unbindDocument(),/(semi|static)/.test(y.mode)&&(f.manager.ids[b.id]=b.identifier))},o.prototype.onDestroyed=function(O,f){var y=this;y.nipples.indexOf(f)>=0&&y.nipples.splice(y.nipples.indexOf(f),1),y.actives.indexOf(f)>=0&&y.actives.splice(y.actives.indexOf(f),1),y.idles.indexOf(f)>=0&&y.idles.splice(y.idles.indexOf(f),1),y.ids.indexOf(f.identifier)>=0&&y.ids.splice(y.ids.indexOf(f.identifier),1),y.manager.removeIdentifier(f.identifier),y.manager.unbindDocument()},o.prototype.destroy=function(){var O=this;for(var f in O.unbindEvt(O.options.zone,"start"),O.nipples.forEach((function(O){O.destroy()})),O.pressureIntervals)O.pressureIntervals.hasOwnProperty(f)&&clearInterval(O.pressureIntervals[f]);O.trigger("destroyed",O.nipples),O.manager.unbindDocument(),O.off()};const i=o;function D(O){var f=this;f.ids={},f.index=0,f.collections=[],f.scroll=t(),f.config(O),f.prepareCollections();var y=function(){var O;f.collections.forEach((function(y){y.forEach((function(y){O=y.el.getBoundingClientRect(),y.position={x:f.scroll.x+O.left,y:f.scroll.y+O.top}}))}))};v(window,"resize",(function(){h(y)}));var S=function(){f.scroll=t()};return v(window,"scroll",(function(){h(S)})),f.collections}D.prototype=new x,D.constructor=D,D.prototype.prepareCollections=function(){var O=this;O.collections.create=O.create.bind(O),O.collections.on=O.on.bind(O),O.collections.off=O.off.bind(O),O.collections.destroy=O.destroy.bind(O),O.collections.get=function(f){var y;return O.collections.every((function(O){return!(y=O.get(f))})),y}},D.prototype.create=function(O){return this.createCollection(O)},D.prototype.createCollection=function(O){var f=this,y=new i(f,O);return f.bindCollection(y),f.collections.push(y),y},D.prototype.bindCollection=function(O){var f,y=this,S=function(O,S){f=O.type+" "+S.id+":"+O.type,y.trigger(f,S)};O.on("destroyed",y.onDestroyed.bind(y)),O.on("shown hidden rested dir plain",S),O.on("dir:up dir:right dir:down dir:left",S),O.on("plain:up plain:right plain:down plain:left",S)},D.prototype.bindDocument=function(){var O=this;O.binded||(O.bindEvt(document,"move").bindEvt(document,"end"),O.binded=!0)},D.prototype.unbindDocument=function(O){var f=this;Object.keys(f.ids).length&&!0!==O||(f.unbindEvt(document,"move").unbindEvt(document,"end"),f.binded=!1)},D.prototype.getIdentifier=function(O){var f;return O?void 0===(f=void 0===O.identifier?O.pointerId:O.identifier)&&(f=this.latest||0):f=this.index,void 0===this.ids[f]&&(this.ids[f]=this.index,this.index+=1),this.latest=f,this.ids[f]},D.prototype.removeIdentifier=function(O){var f={};for(var y in this.ids)if(this.ids[y]===O){f.id=y,f.identifier=this.ids[y],delete this.ids[y];break}return f},D.prototype.onmove=function(O){return this.onAny("move",O),!1},D.prototype.onend=function(O){return this.onAny("end",O),!1},D.prototype.oncancel=function(O){return this.onAny("end",O),!1},D.prototype.onAny=function(O,f){var y,S=this,H="processOn"+O.charAt(0).toUpperCase()+O.slice(1);f=m(f);var b=function(O,f,y){y.ids.indexOf(f)>=0&&(y[H](O),O._found_=!0)};return J(f,(function(O){y=S.getIdentifier(O),J(S.collections,b.bind(null,O,y)),O._found_||S.removeIdentifier(y)})),!1},D.prototype.destroy=function(){var O=this;O.unbindDocument(!0),O.ids={},O.index=0,O.collections.forEach((function(O){O.destroy()})),O.off()},D.prototype.onDestroyed=function(O,f){var y=this;if(y.collections.indexOf(f)<0)return!1;y.collections.splice(y.collections.indexOf(f),1)};var V=new D;const g={create:function(O){return V.create(O)},factory:V};return f.default})(),O.exports=f()},11177:(O,f,y)=>{"use strict";const{Deflate:S,deflate:H,deflateRaw:b,gzip:h}=y(11182),{Inflate:v,inflate:N,inflateRaw:m,ungzip:t}=y(11228),q=y(11209);O.exports.Deflate=S,O.exports.deflate=H,O.exports.deflateRaw=b,O.exports.gzip=h,O.exports.Inflate=v,O.exports.inflate=N,O.exports.inflateRaw=m,O.exports.ungzip=t,O.exports.constants=q},11182:(O,f,y)=>{"use strict";const S=y(11185),H=y(11211),b=y(11216),h=y(11201),v=y(11219),N=Object.prototype.toString,{Z_NO_FLUSH:m,Z_SYNC_FLUSH:t,Z_FULL_FLUSH:q,Z_FINISH:F,Z_OK:I,Z_STREAM_END:A,Z_DEFAULT_COMPRESSION:J,Z_DEFAULT_STRATEGY:X,Z_DEFLATED:w}=y(11209);function B(O){this.options=H.assign({level:J,method:w,Ja:16384,windowBits:15,memLevel:8,strategy:X},O||{});let f=this.options;f.raw&&f.windowBits>0?f.windowBits=-f.windowBits:f.gzip&&f.windowBits>0&&f.windowBits<16&&(f.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new v,this.strm.avail_out=0;let y=S.deflateInit2(this.strm,f.level,f.method,f.windowBits,f.memLevel,f.strategy);if(y!==I)throw new Error(h[y]);if(f.header&&S.deflateSetHeader(this.strm,f.header),f.dictionary){let O;if(O="string"===typeof f.dictionary?b.string2buf(f.dictionary):"[object ArrayBuffer]"===N.call(f.dictionary)?new Uint8Array(f.dictionary):f.dictionary,y=S.deflateSetDictionary(this.strm,O),y!==I)throw new Error(h[y]);this._dict_set=!0}}function j(O,f){const y=new B(f);if(y.push(O,!0),y.err)throw y.msg||h[y.err];return y.result}B.prototype.push=function(O,f){const y=this.strm,H=this.options.Ja;let h,v;if(this.ended)return!1;for(v=f===~~f?f:!0===f?F:m,"string"===typeof O?y.input=b.string2buf(O):"[object ArrayBuffer]"===N.call(O)?y.input=new Uint8Array(O):y.input=O,y.next_in=0,y.avail_in=y.input.length;;)if(0===y.avail_out&&(y.output=new Uint8Array(H),y.next_out=0,y.avail_out=H),(v===t||v===q)&&y.avail_out<=6)this.onData(y.output.subarray(0,y.next_out)),y.avail_out=0;else{if(h=S.deflate(y,v),h===A)return y.next_out>0&&this.onData(y.output.subarray(0,y.next_out)),h=S.deflateEnd(this.strm),this.onEnd(h),this.ended=!0,h===I;if(0!==y.avail_out){if(v>0&&y.next_out>0)this.onData(y.output.subarray(0,y.next_out)),y.avail_out=0;else if(0===y.avail_in)break}else this.onData(y.output)}return!0},B.prototype.onData=function(O){this.chunks.push(O)},B.prototype.onEnd=function(O){O===I&&(this.result=H.flattenChunks(this.chunks)),this.chunks=[],this.err=O,this.msg=this.strm.msg},O.exports.Deflate=B,O.exports.deflate=j,O.exports.deflateRaw=function(O,f){return(f=f||{}).raw=!0,j(O,f)},O.exports.gzip=function(O,f){return(f=f||{}).gzip=!0,j(O,f)},O.exports.constants=y(11209)},11228:(O,f,y)=>{"use strict";const S=y(11236),H=y(11211),b=y(11216),h=y(11201),v=y(11219),N=y(11254),m=Object.prototype.toString,{Z_NO_FLUSH:t,Z_FINISH:q,Z_OK:F,Z_STREAM_END:I,Z_NEED_DICT:A,Z_STREAM_ERROR:J,Z_DATA_ERROR:X,Z_MEM_ERROR:w}=y(11209);function B(O){this.options=H.assign({Ja:65536,windowBits:15,to:""},O||{});const f=this.options;f.raw&&f.windowBits>=0&&f.windowBits<16&&(f.windowBits=-f.windowBits,0===f.windowBits&&(f.windowBits=-15)),!(f.windowBits>=0&&f.windowBits<16)||O&&O.windowBits||(f.windowBits+=32),f.windowBits>15&&f.windowBits<48&&0===(15&f.windowBits)&&(f.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new v,this.strm.avail_out=0;let y=S.inflateInit2(this.strm,f.windowBits);if(y!==F)throw new Error(h[y]);if(this.header=new N,S.inflateGetHeader(this.strm,this.header),f.dictionary&&("string"===typeof f.dictionary?f.dictionary=b.string2buf(f.dictionary):"[object ArrayBuffer]"===m.call(f.dictionary)&&(f.dictionary=new Uint8Array(f.dictionary)),f.raw&&(y=S.inflateSetDictionary(this.strm,f.dictionary),y!==F)))throw new Error(h[y])}function j(O,f){const y=new B(f);if(y.push(O),y.err)throw y.msg||h[y.err];return y.result}B.prototype.push=function(O,f){const y=this.strm,H=this.options.Ja,h=this.options.dictionary;let v,N,B;if(this.ended)return!1;for(N=f===~~f?f:!0===f?q:t,"[object ArrayBuffer]"===m.call(O)?y.input=new Uint8Array(O):y.input=O,y.next_in=0,y.avail_in=y.input.length;;){for(0===y.avail_out&&(y.output=new Uint8Array(H),y.next_out=0,y.avail_out=H),v=S.inflate(y,N),v===A&&h&&(v=S.inflateSetDictionary(y,h),v===F?v=S.inflate(y,N):v===X&&(v=A));y.avail_in>0&&v===I&&y.state.wrap>0&&0!==O[y.next_in];)S.inflateReset(y),v=S.inflate(y,N);switch(v){case J:case X:case A:case w:return this.onEnd(v),this.ended=!0,!1}if(B=y.avail_out,y.next_out&&(0===y.avail_out||v===I))if("string"===this.options.to){let O=b.utf8border(y.output,y.next_out),f=y.next_out-O,S=b.buf2string(y.output,O);y.next_out=f,y.avail_out=H-f,f&&y.output.set(y.output.subarray(O,O+f),0),this.onData(S)}else this.onData(y.output.length===y.next_out?y.output:y.output.subarray(0,y.next_out));if(v!==F||0!==B){if(v===I)return v=S.inflateEnd(this.strm),this.onEnd(v),this.ended=!0,!0;if(0===y.avail_in)break}}return!0},B.prototype.onData=function(O){this.chunks.push(O)},B.prototype.onEnd=function(O){O===F&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=H.flattenChunks(this.chunks)),this.chunks=[],this.err=O,this.msg=this.strm.msg},O.exports.Inflate=B,O.exports.inflate=j,O.exports.inflateRaw=function(O,f){return(f=f||{}).raw=!0,j(O,f)},O.exports.ungzip=j,O.exports.constants=y(11209)},11211:O=>{"use strict";const f=(O,f)=>Object.prototype.hasOwnProperty.call(O,f);O.exports.assign=function(O){const y=Array.prototype.slice.call(arguments,1);for(;y.length;){const S=y.shift();if(S){if("object"!==typeof S)throw new TypeError(S+"must be non-object");for(const y in S)f(S,y)&&(O[y]=S[y])}}return O},O.exports.flattenChunks=O=>{let f=0;for(let S=0,H=O.length;S<H;S++)f+=O[S].length;const y=new Uint8Array(f);for(let S=0,H=0,b=O.length;S<b;S++){let f=O[S];y.set(f,H),H+=f.length}return y}},11216:O=>{"use strict";let f=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(S){f=!1}const y=new Uint8Array(256);for(let H=0;H<256;H++)y[H]=H>=252?6:H>=248?5:H>=240?4:H>=224?3:H>=192?2:1;y[254]=y[254]=1,O.exports.string2buf=O=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(O);let f,y,S,H,b,h=O.length,v=0;for(H=0;H<h;H++)y=O.charCodeAt(H),55296===(64512&y)&&H+1<h&&(S=O.charCodeAt(H+1),56320===(64512&S)&&(y=65536+(y-55296<<10)+(S-56320),H++)),v+=y<128?1:y<2048?2:y<65536?3:4;for(f=new Uint8Array(v),b=0,H=0;b<v;H++)y=O.charCodeAt(H),55296===(64512&y)&&H+1<h&&(S=O.charCodeAt(H+1),56320===(64512&S)&&(y=65536+(y-55296<<10)+(S-56320),H++)),y<128?f[b++]=y:y<2048?(f[b++]=192|y>>>6,f[b++]=128|63&y):y<65536?(f[b++]=224|y>>>12,f[b++]=128|y>>>6&63,f[b++]=128|63&y):(f[b++]=240|y>>>18,f[b++]=128|y>>>12&63,f[b++]=128|y>>>6&63,f[b++]=128|63&y);return f};O.exports.buf2string=(O,S)=>{const H=S||O.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(O.subarray(0,S));let b,h;const v=new Array(2*H);for(h=0,b=0;b<H;){let f=O[b++];if(f<128){v[h++]=f;continue}let S=y[f];if(S>4)v[h++]=65533,b+=S-1;else{for(f&=2===S?31:3===S?15:7;S>1&&b<H;)f=f<<6|63&O[b++],S--;S>1?v[h++]=65533:f<65536?v[h++]=f:(f-=65536,v[h++]=55296|f>>10&1023,v[h++]=56320|1023&f)}}return((O,y)=>{if(y<65534&&O.subarray&&f)return String.fromCharCode.apply(null,O.length===y?O:O.subarray(0,y));let S="";for(let f=0;f<y;f++)S+=String.fromCharCode(O[f]);return S})(v,h)},O.exports.utf8border=(O,f)=>{(f=f||O.length)>O.length&&(f=O.length);let S=f-1;for(;S>=0&&128===(192&O[S]);)S--;return S<0||0===S?f:S+y[O[S]]>f?S:f}},11193:O=>{"use strict";O.exports=(O,f,y,S)=>{let H=65535&O,b=O>>>16&65535,h=0;for(;0!==y;){h=y>2e3?2e3:y,y-=h;do{H=H+f[S++]|0,b=b+H|0}while(--h);H%=65521,b%=65521}return H|b<<16}},11209:O=>{"use strict";O.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},11197:O=>{"use strict";const f=new Uint32Array((()=>{let O,f=[];for(var y=0;y<256;y++){O=y;for(var S=0;S<8;S++)O=1&O?3988292384^O>>>1:O>>>1;f[y]=O}return f})());O.exports=(O,y,S,H)=>{const b=f,h=H+S;O^=-1;for(let f=H;f<h;f++)O=O>>>8^b[255&(O^y[f])];return~O}},11185:(O,f,y)=>{"use strict";const{_tr_init:S,_tr_stored_block:H,_tr_flush_block:b,_tr_tally:h,_tr_align:v}=y(11190),N=y(11193),m=y(11197),t=y(11201),{Z_NO_FLUSH:q,Z_PARTIAL_FLUSH:F,Z_FULL_FLUSH:I,Z_FINISH:A,Z_BLOCK:J,Z_OK:X,Z_STREAM_END:w,Z_STREAM_ERROR:B,Z_DATA_ERROR:j,Z_BUF_ERROR:u,Z_DEFAULT_COMPRESSION:L,Z_FILTERED:p,Z_HUFFMAN_ONLY:U,Z_RLE:l,Z_FIXED:x,Z_DEFAULT_STRATEGY:W,Z_UNKNOWN:E,Z_DEFLATED:o}=y(11209),i=258,D=262,V=103,g=113,R=666,s=(O,f)=>(O.msg=t[f],f),k=O=>(O<<1)-(O>4?9:0),z=O=>{let f=O.length;for(;--f>=0;)O[f]=0};let c=(O,f,y)=>(f<<O.hash_shift^y)&O.hash_mask;const d=O=>{const f=O.state;let y=f.pending;y>O.avail_out&&(y=O.avail_out),0!==y&&(O.output.set(f.pending_buf.subarray(f.pending_out,f.pending_out+y),O.next_out),O.next_out+=y,f.pending_out+=y,O.total_out+=y,O.avail_out-=y,f.pending-=y,0===f.pending&&(f.pending_out=0))},G=(O,f)=>{b(O,O.block_start>=0?O.block_start:-1,O.strstart-O.block_start,f),O.block_start=O.strstart,d(O.strm)},Y=(O,f)=>{O.pending_buf[O.pending++]=f},Z=(O,f)=>{O.pending_buf[O.pending++]=f>>>8&255,O.pending_buf[O.pending++]=255&f},a=(O,f,y,S)=>{let H=O.avail_in;return H>S&&(H=S),0===H?0:(O.avail_in-=H,f.set(O.input.subarray(O.next_in,O.next_in+H),y),1===O.state.wrap?O.adler=N(O.adler,f,H,y):2===O.state.wrap&&(O.adler=m(O.adler,f,H,y)),O.next_in+=H,O.total_in+=H,H)},M=(O,f)=>{let y,S,H=O.max_chain_length,b=O.strstart,h=O.prev_length,v=O.nice_match;const N=O.strstart>O.w_size-D?O.strstart-(O.w_size-D):0,m=O.window,t=O.w_mask,q=O.prev,F=O.strstart+i;let I=m[b+h-1],A=m[b+h];O.prev_length>=O.good_match&&(H>>=2),v>O.lookahead&&(v=O.lookahead);do{if(y=f,m[y+h]===A&&m[y+h-1]===I&&m[y]===m[b]&&m[++y]===m[b+1]){b+=2,y++;do{}while(m[++b]===m[++y]&&m[++b]===m[++y]&&m[++b]===m[++y]&&m[++b]===m[++y]&&m[++b]===m[++y]&&m[++b]===m[++y]&&m[++b]===m[++y]&&m[++b]===m[++y]&&b<F);if(S=i-(F-b),b=F-i,S>h){if(O.match_start=f,h=S,S>=v)break;I=m[b+h-1],A=m[b+h]}}}while((f=q[f&t])>N&&0!==--H);return h<=O.lookahead?h:O.lookahead},P=O=>{const f=O.w_size;let y,S,H,b,h;do{if(b=O.window_size-O.lookahead-O.strstart,O.strstart>=f+(f-D)){O.window.set(O.window.subarray(f,f+f),0),O.match_start-=f,O.strstart-=f,O.block_start-=f,S=O.hash_size,y=S;do{H=O.head[--y],O.head[y]=H>=f?H-f:0}while(--S);S=f,y=S;do{H=O.prev[--y],O.prev[y]=H>=f?H-f:0}while(--S);b+=f}if(0===O.strm.avail_in)break;if(S=a(O.strm,O.window,O.strstart+O.lookahead,b),O.lookahead+=S,O.lookahead+O.insert>=3)for(h=O.strstart-O.insert,O.ins_h=O.window[h],O.ins_h=c(O,O.ins_h,O.window[h+1]);O.insert&&(O.ins_h=c(O,O.ins_h,O.window[h+3-1]),O.prev[h&O.w_mask]=O.head[O.ins_h],O.head[O.ins_h]=h,h++,O.insert--,!(O.lookahead+O.insert<3)););}while(O.lookahead<D&&0!==O.strm.avail_in)},e=(O,f)=>{let y,S;for(;;){if(O.lookahead<D){if(P(O),O.lookahead<D&&f===q)return 1;if(0===O.lookahead)break}if(y=0,O.lookahead>=3&&(O.ins_h=c(O,O.ins_h,O.window[O.strstart+3-1]),y=O.prev[O.strstart&O.w_mask]=O.head[O.ins_h],O.head[O.ins_h]=O.strstart),0!==y&&O.strstart-y<=O.w_size-D&&(O.match_length=M(O,y)),O.match_length>=3)if(S=h(O,O.strstart-O.match_start,O.match_length-3),O.lookahead-=O.match_length,O.match_length<=O.max_lazy_match&&O.lookahead>=3){O.match_length--;do{O.strstart++,O.ins_h=c(O,O.ins_h,O.window[O.strstart+3-1]),y=O.prev[O.strstart&O.w_mask]=O.head[O.ins_h],O.head[O.ins_h]=O.strstart}while(0!==--O.match_length);O.strstart++}else O.strstart+=O.match_length,O.match_length=0,O.ins_h=O.window[O.strstart],O.ins_h=c(O,O.ins_h,O.window[O.strstart+1]);else S=h(O,0,O.window[O.strstart]),O.lookahead--,O.strstart++;if(S&&(G(O,!1),0===O.strm.avail_out))return 1}return O.insert=O.strstart<2?O.strstart:2,f===A?(G(O,!0),0===O.strm.avail_out?3:4):O.last_lit&&(G(O,!1),0===O.strm.avail_out)?1:2},K=(O,f)=>{let y,S,H;for(;;){if(O.lookahead<D){if(P(O),O.lookahead<D&&f===q)return 1;if(0===O.lookahead)break}if(y=0,O.lookahead>=3&&(O.ins_h=c(O,O.ins_h,O.window[O.strstart+3-1]),y=O.prev[O.strstart&O.w_mask]=O.head[O.ins_h],O.head[O.ins_h]=O.strstart),O.prev_length=O.match_length,O.prev_match=O.match_start,O.match_length=2,0!==y&&O.prev_length<O.max_lazy_match&&O.strstart-y<=O.w_size-D&&(O.match_length=M(O,y),O.match_length<=5&&(O.strategy===p||3===O.match_length&&O.strstart-O.match_start>4096)&&(O.match_length=2)),O.prev_length>=3&&O.match_length<=O.prev_length){H=O.strstart+O.lookahead-3,S=h(O,O.strstart-1-O.prev_match,O.prev_length-3),O.lookahead-=O.prev_length-1,O.prev_length-=2;do{++O.strstart<=H&&(O.ins_h=c(O,O.ins_h,O.window[O.strstart+3-1]),y=O.prev[O.strstart&O.w_mask]=O.head[O.ins_h],O.head[O.ins_h]=O.strstart)}while(0!==--O.prev_length);if(O.match_available=0,O.match_length=2,O.strstart++,S&&(G(O,!1),0===O.strm.avail_out))return 1}else if(O.match_available){if(S=h(O,0,O.window[O.strstart-1]),S&&G(O,!1),O.strstart++,O.lookahead--,0===O.strm.avail_out)return 1}else O.match_available=1,O.strstart++,O.lookahead--}return O.match_available&&(S=h(O,0,O.window[O.strstart-1]),O.match_available=0),O.insert=O.strstart<2?O.strstart:2,f===A?(G(O,!0),0===O.strm.avail_out?3:4):O.last_lit&&(G(O,!1),0===O.strm.avail_out)?1:2};function T(O,f,y,S,H){this.good_length=O,this.max_lazy=f,this.nice_length=y,this.max_chain=S,this.func=H}const Q=[new T(0,0,0,0,((O,f)=>{let y=65535;for(y>O.pending_buf_size-5&&(y=O.pending_buf_size-5);;){if(O.lookahead<=1){if(P(O),0===O.lookahead&&f===q)return 1;if(0===O.lookahead)break}O.strstart+=O.lookahead,O.lookahead=0;const S=O.block_start+y;if((0===O.strstart||O.strstart>=S)&&(O.lookahead=O.strstart-S,O.strstart=S,G(O,!1),0===O.strm.avail_out))return 1;if(O.strstart-O.block_start>=O.w_size-D&&(G(O,!1),0===O.strm.avail_out))return 1}return O.insert=0,f===A?(G(O,!0),0===O.strm.avail_out?3:4):(O.strstart>O.block_start&&(G(O,!1),O.strm.avail_out),1)})),new T(4,4,8,4,e),new T(4,5,16,8,e),new T(4,6,32,32,e),new T(4,4,16,16,K),new T(8,16,32,32,K),new T(8,16,128,128,K),new T(8,32,128,256,K),new T(32,128,258,1024,K),new T(32,258,258,4096,K)];function C(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=o,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),z(this.dyn_ltree),z(this.dyn_dtree),z(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),z(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),z(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const r=O=>{if(!O||!O.state)return s(O,B);O.total_in=O.total_out=0,O.data_type=E;const f=O.state;return f.pending=0,f.pending_out=0,f.wrap<0&&(f.wrap=-f.wrap),f.status=f.wrap?42:g,O.adler=2===f.wrap?0:1,f.last_flush=q,S(f),X},n=O=>{const f=r(O);var y;return f===X&&((y=O.state).window_size=2*y.w_size,z(y.head),y.max_lazy_match=Q[y.level].max_lazy,y.good_match=Q[y.level].good_length,y.nice_match=Q[y.level].nice_length,y.max_chain_length=Q[y.level].max_chain,y.strstart=0,y.block_start=0,y.lookahead=0,y.insert=0,y.match_length=y.prev_length=2,y.match_available=0,y.ins_h=0),f},OO=(O,f,y,S,H,b)=>{if(!O)return B;let h=1;if(f===L&&(f=6),S<0?(h=0,S=-S):S>15&&(h=2,S-=16),H<1||H>9||y!==o||S<8||S>15||f<0||f>9||b<0||b>x)return s(O,B);8===S&&(S=9);const v=new C;return O.state=v,v.strm=O,v.wrap=h,v.gzhead=null,v.w_bits=S,v.w_size=1<<v.w_bits,v.w_mask=v.w_size-1,v.hash_bits=H+7,v.hash_size=1<<v.hash_bits,v.hash_mask=v.hash_size-1,v.hash_shift=~~((v.hash_bits+3-1)/3),v.window=new Uint8Array(2*v.w_size),v.head=new Uint16Array(v.hash_size),v.prev=new Uint16Array(v.w_size),v.lit_bufsize=1<<H+6,v.pending_buf_size=4*v.lit_bufsize,v.pending_buf=new Uint8Array(v.pending_buf_size),v.d_buf=1*v.lit_bufsize,v.l_buf=3*v.lit_bufsize,v.level=f,v.strategy=b,v.method=y,n(O)};O.exports.deflateInit=(O,f)=>OO(O,f,o,15,8,W),O.exports.deflateInit2=OO,O.exports.deflateReset=n,O.exports.deflateResetKeep=r,O.exports.deflateSetHeader=(O,f)=>O&&O.state?2!==O.state.wrap?B:(O.state.gzhead=f,X):B,O.exports.deflate=(O,f)=>{let y,S;if(!O||!O.state||f>J||f<0)return O?s(O,B):B;const b=O.state;if(!O.output||!O.input&&0!==O.avail_in||b.status===R&&f!==A)return s(O,0===O.avail_out?u:B);b.strm=O;const N=b.last_flush;if(b.last_flush=f,42===b.status)if(2===b.wrap)O.adler=0,Y(b,31),Y(b,139),Y(b,8),b.gzhead?(Y(b,(b.gzhead.text?1:0)+(b.gzhead.hcrc?2:0)+(b.gzhead.extra?4:0)+(b.gzhead.name?8:0)+(b.gzhead.comment?16:0)),Y(b,255&b.gzhead.time),Y(b,b.gzhead.time>>8&255),Y(b,b.gzhead.time>>16&255),Y(b,b.gzhead.time>>24&255),Y(b,9===b.level?2:b.strategy>=U||b.level<2?4:0),Y(b,255&b.gzhead.os),b.gzhead.extra&&b.gzhead.extra.length&&(Y(b,255&b.gzhead.extra.length),Y(b,b.gzhead.extra.length>>8&255)),b.gzhead.hcrc&&(O.adler=m(O.adler,b.pending_buf,b.pending,0)),b.gzindex=0,b.status=69):(Y(b,0),Y(b,0),Y(b,0),Y(b,0),Y(b,0),Y(b,9===b.level?2:b.strategy>=U||b.level<2?4:0),Y(b,3),b.status=g);else{let f=o+(b.w_bits-8<<4)<<8,y=-1;y=b.strategy>=U||b.level<2?0:b.level<6?1:6===b.level?2:3,f|=y<<6,0!==b.strstart&&(f|=32),f+=31-f%31,b.status=g,Z(b,f),0!==b.strstart&&(Z(b,O.adler>>>16),Z(b,65535&O.adler)),O.adler=1}if(69===b.status)if(b.gzhead.extra){for(y=b.pending;b.gzindex<(65535&b.gzhead.extra.length)&&(b.pending!==b.pending_buf_size||(b.gzhead.hcrc&&b.pending>y&&(O.adler=m(O.adler,b.pending_buf,b.pending-y,y)),d(O),y=b.pending,b.pending!==b.pending_buf_size));)Y(b,255&b.gzhead.extra[b.gzindex]),b.gzindex++;b.gzhead.hcrc&&b.pending>y&&(O.adler=m(O.adler,b.pending_buf,b.pending-y,y)),b.gzindex===b.gzhead.extra.length&&(b.gzindex=0,b.status=73)}else b.status=73;if(73===b.status)if(b.gzhead.name){y=b.pending;do{if(b.pending===b.pending_buf_size&&(b.gzhead.hcrc&&b.pending>y&&(O.adler=m(O.adler,b.pending_buf,b.pending-y,y)),d(O),y=b.pending,b.pending===b.pending_buf_size)){S=1;break}S=b.gzindex<b.gzhead.name.length?255&b.gzhead.name.charCodeAt(b.gzindex++):0,Y(b,S)}while(0!==S);b.gzhead.hcrc&&b.pending>y&&(O.adler=m(O.adler,b.pending_buf,b.pending-y,y)),0===S&&(b.gzindex=0,b.status=91)}else b.status=91;if(91===b.status)if(b.gzhead.comment){y=b.pending;do{if(b.pending===b.pending_buf_size&&(b.gzhead.hcrc&&b.pending>y&&(O.adler=m(O.adler,b.pending_buf,b.pending-y,y)),d(O),y=b.pending,b.pending===b.pending_buf_size)){S=1;break}S=b.gzindex<b.gzhead.comment.length?255&b.gzhead.comment.charCodeAt(b.gzindex++):0,Y(b,S)}while(0!==S);b.gzhead.hcrc&&b.pending>y&&(O.adler=m(O.adler,b.pending_buf,b.pending-y,y)),0===S&&(b.status=V)}else b.status=V;if(b.status===V&&(b.gzhead.hcrc?(b.pending+2>b.pending_buf_size&&d(O),b.pending+2<=b.pending_buf_size&&(Y(b,255&O.adler),Y(b,O.adler>>8&255),O.adler=0,b.status=g)):b.status=g),0!==b.pending){if(d(O),0===O.avail_out)return b.last_flush=-1,X}else if(0===O.avail_in&&k(f)<=k(N)&&f!==A)return s(O,u);if(b.status===R&&0!==O.avail_in)return s(O,u);if(0!==O.avail_in||0!==b.lookahead||f!==q&&b.status!==R){let y=b.strategy===U?((O,f)=>{let y;for(;;){if(0===O.lookahead&&(P(O),0===O.lookahead)){if(f===q)return 1;break}if(O.match_length=0,y=h(O,0,O.window[O.strstart]),O.lookahead--,O.strstart++,y&&(G(O,!1),0===O.strm.avail_out))return 1}return O.insert=0,f===A?(G(O,!0),0===O.strm.avail_out?3:4):O.last_lit&&(G(O,!1),0===O.strm.avail_out)?1:2})(b,f):b.strategy===l?((O,f)=>{let y,S,H,b;const v=O.window;for(;;){if(O.lookahead<=i){if(P(O),O.lookahead<=i&&f===q)return 1;if(0===O.lookahead)break}if(O.match_length=0,O.lookahead>=3&&O.strstart>0&&(H=O.strstart-1,S=v[H],S===v[++H]&&S===v[++H]&&S===v[++H])){b=O.strstart+i;do{}while(S===v[++H]&&S===v[++H]&&S===v[++H]&&S===v[++H]&&S===v[++H]&&S===v[++H]&&S===v[++H]&&S===v[++H]&&H<b);O.match_length=i-(b-H),O.match_length>O.lookahead&&(O.match_length=O.lookahead)}if(O.match_length>=3?(y=h(O,1,O.match_length-3),O.lookahead-=O.match_length,O.strstart+=O.match_length,O.match_length=0):(y=h(O,0,O.window[O.strstart]),O.lookahead--,O.strstart++),y&&(G(O,!1),0===O.strm.avail_out))return 1}return O.insert=0,f===A?(G(O,!0),0===O.strm.avail_out?3:4):O.last_lit&&(G(O,!1),0===O.strm.avail_out)?1:2})(b,f):Q[b.level].func(b,f);if(3!==y&&4!==y||(b.status=R),1===y||3===y)return 0===O.avail_out&&(b.last_flush=-1),X;if(2===y&&(f===F?v(b):f!==J&&(H(b,0,0,!1),f===I&&(z(b.head),0===b.lookahead&&(b.strstart=0,b.block_start=0,b.insert=0))),d(O),0===O.avail_out))return b.last_flush=-1,X}return f!==A?X:b.wrap<=0?w:(2===b.wrap?(Y(b,255&O.adler),Y(b,O.adler>>8&255),Y(b,O.adler>>16&255),Y(b,O.adler>>24&255),Y(b,255&O.total_in),Y(b,O.total_in>>8&255),Y(b,O.total_in>>16&255),Y(b,O.total_in>>24&255)):(Z(b,O.adler>>>16),Z(b,65535&O.adler)),d(O),b.wrap>0&&(b.wrap=-b.wrap),0!==b.pending?X:w)},O.exports.deflateEnd=O=>{if(!O||!O.state)return B;const f=O.state.status;return 42!==f&&69!==f&&73!==f&&91!==f&&f!==V&&f!==g&&f!==R?s(O,B):(O.state=null,f===g?s(O,j):X)},O.exports.deflateSetDictionary=(O,f)=>{let y=f.length;if(!O||!O.state)return B;const S=O.state,H=S.wrap;if(2===H||1===H&&42!==S.status||S.lookahead)return B;if(1===H&&(O.adler=N(O.adler,f,y,0)),S.wrap=0,y>=S.w_size){0===H&&(z(S.head),S.strstart=0,S.block_start=0,S.insert=0);let O=new Uint8Array(S.w_size);O.set(f.subarray(y-S.w_size,y),0),f=O,y=S.w_size}const b=O.avail_in,h=O.next_in,v=O.input;for(O.avail_in=y,O.next_in=0,O.input=f,P(S);S.lookahead>=3;){let O=S.strstart,f=S.lookahead-2;do{S.ins_h=c(S,S.ins_h,S.window[O+3-1]),S.prev[O&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=O,O++}while(--f);S.strstart=O,S.lookahead=2,P(S)}return S.strstart+=S.lookahead,S.block_start=S.strstart,S.insert=S.lookahead,S.lookahead=0,S.match_length=S.prev_length=2,S.match_available=0,O.next_in=h,O.input=v,O.avail_in=b,S.wrap=H,X},O.exports.deflateInfo="pako deflate (from Nodeca project)"},11254:O=>{"use strict";O.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},11242:O=>{"use strict";O.exports=function(O,f){let y,S,H,b,h,v,N,m,t,q,F,I,A,J,X,w,B,j,u,L,p,U,l,x;const W=O.state;y=O.next_in,l=O.input,S=y+(O.avail_in-5),H=O.next_out,x=O.output,b=H-(f-O.avail_out),h=H+(O.avail_out-257),v=W.dmax,N=W.wsize,m=W.whave,t=W.wnext,q=W.window,F=W.hold,I=W.bits,A=W.lencode,J=W.distcode,X=(1<<W.lenbits)-1,w=(1<<W.distbits)-1;O:do{I<15&&(F+=l[y++]<<I,I+=8,F+=l[y++]<<I,I+=8),B=A[F&X];f:for(;;){if(j=B>>>24,F>>>=j,I-=j,j=B>>>16&255,0===j)x[H++]=65535&B;else{if(!(16&j)){if(0===(64&j)){B=A[(65535&B)+(F&(1<<j)-1)];continue f}if(32&j){W.mode=12;break O}O.msg="invalid literal/length code",W.mode=30;break O}u=65535&B,j&=15,j&&(I<j&&(F+=l[y++]<<I,I+=8),u+=F&(1<<j)-1,F>>>=j,I-=j),I<15&&(F+=l[y++]<<I,I+=8,F+=l[y++]<<I,I+=8),B=J[F&w];y:for(;;){if(j=B>>>24,F>>>=j,I-=j,j=B>>>16&255,!(16&j)){if(0===(64&j)){B=J[(65535&B)+(F&(1<<j)-1)];continue y}O.msg="invalid distance code",W.mode=30;break O}if(L=65535&B,j&=15,I<j&&(F+=l[y++]<<I,I+=8,I<j&&(F+=l[y++]<<I,I+=8)),L+=F&(1<<j)-1,L>v){O.msg="invalid distance too far back",W.mode=30;break O}if(F>>>=j,I-=j,j=H-b,L>j){if(j=L-j,j>m&&W.sane){O.msg="invalid distance too far back",W.mode=30;break O}if(p=0,U=q,0===t){if(p+=N-j,j<u){u-=j;do{x[H++]=q[p++]}while(--j);p=H-L,U=x}}else if(t<j){if(p+=N+t-j,j-=t,j<u){u-=j;do{x[H++]=q[p++]}while(--j);if(p=0,t<u){j=t,u-=j;do{x[H++]=q[p++]}while(--j);p=H-L,U=x}}}else if(p+=t-j,j<u){u-=j;do{x[H++]=q[p++]}while(--j);p=H-L,U=x}for(;u>2;)x[H++]=U[p++],x[H++]=U[p++],x[H++]=U[p++],u-=3;u&&(x[H++]=U[p++],u>1&&(x[H++]=U[p++]))}else{p=H-L;do{x[H++]=x[p++],x[H++]=x[p++],x[H++]=x[p++],u-=3}while(u>2);u&&(x[H++]=x[p++],u>1&&(x[H++]=x[p++]))}break}}break}}while(y<S&&H<h);u=I>>3,y-=u,I-=u<<3,F&=(1<<I)-1,O.next_in=y,O.next_out=H,O.avail_in=y<S?S-y+5:5-(y-S),O.avail_out=H<h?h-H+257:257-(H-h),W.hold=F,W.bits=I}},11236:(O,f,y)=>{"use strict";const S=y(11193),H=y(11197),b=y(11242),h=y(11250),{Z_FINISH:v,Z_BLOCK:N,Z_TREES:m,Z_OK:t,Z_STREAM_END:q,Z_NEED_DICT:F,Z_STREAM_ERROR:I,Z_DATA_ERROR:A,Z_MEM_ERROR:J,Z_BUF_ERROR:X,Z_DEFLATED:w}=y(11209),B=12,j=30,u=O=>(O>>>24&255)+(O>>>8&65280)+((65280&O)<<8)+((255&O)<<24);function L(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const p=O=>{if(!O||!O.state)return I;const f=O.state;return O.total_in=O.total_out=f.total=0,O.msg="",f.wrap&&(O.adler=1&f.wrap),f.mode=1,f.last=0,f.havedict=0,f.dmax=32768,f.head=null,f.hold=0,f.bits=0,f.lencode=f.lendyn=new Int32Array(852),f.distcode=f.distdyn=new Int32Array(592),f.sane=1,f.back=-1,t},U=O=>{if(!O||!O.state)return I;const f=O.state;return f.wsize=0,f.whave=0,f.wnext=0,p(O)},l=(O,f)=>{let y;if(!O||!O.state)return I;const S=O.state;return f<0?(y=0,f=-f):(y=1+(f>>4),f<48&&(f&=15)),f&&(f<8||f>15)?I:(null!==S.window&&S.wbits!==f&&(S.window=null),S.wrap=y,S.wbits=f,U(O))},x=(O,f)=>{if(!O)return I;const y=new L;O.state=y,y.window=null;const S=l(O,f);return S!==t&&(O.state=null),S};let W,E,o=!0;const i=O=>{if(o){W=new Int32Array(512),E=new Int32Array(32);let f=0;for(;f<144;)O.lens[f++]=8;for(;f<256;)O.lens[f++]=9;for(;f<280;)O.lens[f++]=7;for(;f<288;)O.lens[f++]=8;for(h(1,O.lens,0,288,W,0,O.work,{bits:9}),f=0;f<32;)O.lens[f++]=5;h(2,O.lens,0,32,E,0,O.work,{bits:5}),o=!1}O.lencode=W,O.lenbits=9,O.distcode=E,O.distbits=5},D=(O,f,y,S)=>{let H;const b=O.state;return null===b.window&&(b.wsize=1<<b.wbits,b.wnext=0,b.whave=0,b.window=new Uint8Array(b.wsize)),S>=b.wsize?(b.window.set(f.subarray(y-b.wsize,y),0),b.wnext=0,b.whave=b.wsize):(H=b.wsize-b.wnext,H>S&&(H=S),b.window.set(f.subarray(y-S,y-S+H),b.wnext),(S-=H)?(b.window.set(f.subarray(y-S,y),0),b.wnext=S,b.whave=b.wsize):(b.wnext+=H,b.wnext===b.wsize&&(b.wnext=0),b.whave<b.wsize&&(b.whave+=H))),0};O.exports.inflateReset=U,O.exports.inflateReset2=l,O.exports.inflateResetKeep=p,O.exports.inflateInit=O=>x(O,15),O.exports.inflateInit2=x,O.exports.inflate=(O,f)=>{let y,L,p,U,l,x,W,E,o,V,g,R,s,k,z,c,d,G,Y,Z,a,M,P=0;const e=new Uint8Array(4);let K,T;const Q=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!O||!O.state||!O.output||!O.input&&0!==O.avail_in)return I;y=O.state,y.mode===B&&(y.mode=13),l=O.next_out,p=O.output,W=O.avail_out,U=O.next_in,L=O.input,x=O.avail_in,E=y.hold,o=y.bits,V=x,g=W,M=t;O:for(;;)switch(y.mode){case 1:if(0===y.wrap){y.mode=13;break}for(;o<16;){if(0===x)break O;x--,E+=L[U++]<<o,o+=8}if(2&y.wrap&&35615===E){y.check=0,e[0]=255&E,e[1]=E>>>8&255,y.check=H(y.check,e,2,0),E=0,o=0,y.mode=2;break}if(y.flags=0,y.head&&(y.head.done=!1),!(1&y.wrap)||(((255&E)<<8)+(E>>8))%31){O.msg="incorrect header check",y.mode=j;break}if((15&E)!==w){O.msg="unknown compression method",y.mode=j;break}if(E>>>=4,o-=4,a=8+(15&E),0===y.wbits)y.wbits=a;else if(a>y.wbits){O.msg="invalid window size",y.mode=j;break}y.dmax=1<<y.wbits,O.adler=y.check=1,y.mode=512&E?10:B,E=0,o=0;break;case 2:for(;o<16;){if(0===x)break O;x--,E+=L[U++]<<o,o+=8}if(y.flags=E,(255&y.flags)!==w){O.msg="unknown compression method",y.mode=j;break}if(57344&y.flags){O.msg="unknown header flags set",y.mode=j;break}y.head&&(y.head.text=E>>8&1),512&y.flags&&(e[0]=255&E,e[1]=E>>>8&255,y.check=H(y.check,e,2,0)),E=0,o=0,y.mode=3;case 3:for(;o<32;){if(0===x)break O;x--,E+=L[U++]<<o,o+=8}y.head&&(y.head.time=E),512&y.flags&&(e[0]=255&E,e[1]=E>>>8&255,e[2]=E>>>16&255,e[3]=E>>>24&255,y.check=H(y.check,e,4,0)),E=0,o=0,y.mode=4;case 4:for(;o<16;){if(0===x)break O;x--,E+=L[U++]<<o,o+=8}y.head&&(y.head.xflags=255&E,y.head.os=E>>8),512&y.flags&&(e[0]=255&E,e[1]=E>>>8&255,y.check=H(y.check,e,2,0)),E=0,o=0,y.mode=5;case 5:if(1024&y.flags){for(;o<16;){if(0===x)break O;x--,E+=L[U++]<<o,o+=8}y.length=E,y.head&&(y.head.extra_len=E),512&y.flags&&(e[0]=255&E,e[1]=E>>>8&255,y.check=H(y.check,e,2,0)),E=0,o=0}else y.head&&(y.head.extra=null);y.mode=6;case 6:if(1024&y.flags&&(R=y.length,R>x&&(R=x),R&&(y.head&&(a=y.head.extra_len-y.length,y.head.extra||(y.head.extra=new Uint8Array(y.head.extra_len)),y.head.extra.set(L.subarray(U,U+R),a)),512&y.flags&&(y.check=H(y.check,L,R,U)),x-=R,U+=R,y.length-=R),y.length))break O;y.length=0,y.mode=7;case 7:if(2048&y.flags){if(0===x)break O;R=0;do{a=L[U+R++],y.head&&a&&y.length<65536&&(y.head.name+=String.fromCharCode(a))}while(a&&R<x);if(512&y.flags&&(y.check=H(y.check,L,R,U)),x-=R,U+=R,a)break O}else y.head&&(y.head.name=null);y.length=0,y.mode=8;case 8:if(4096&y.flags){if(0===x)break O;R=0;do{a=L[U+R++],y.head&&a&&y.length<65536&&(y.head.comment+=String.fromCharCode(a))}while(a&&R<x);if(512&y.flags&&(y.check=H(y.check,L,R,U)),x-=R,U+=R,a)break O}else y.head&&(y.head.comment=null);y.mode=9;case 9:if(512&y.flags){for(;o<16;){if(0===x)break O;x--,E+=L[U++]<<o,o+=8}if(E!==(65535&y.check)){O.msg="header crc mismatch",y.mode=j;break}E=0,o=0}y.head&&(y.head.hcrc=y.flags>>9&1,y.head.done=!0),O.adler=y.check=0,y.mode=B;break;case 10:for(;o<32;){if(0===x)break O;x--,E+=L[U++]<<o,o+=8}O.adler=y.check=u(E),E=0,o=0,y.mode=11;case 11:if(0===y.havedict)return O.next_out=l,O.avail_out=W,O.next_in=U,O.avail_in=x,y.hold=E,y.bits=o,F;O.adler=y.check=1,y.mode=B;case B:if(f===N||f===m)break O;case 13:if(y.last){E>>>=7&o,o-=7&o,y.mode=27;break}for(;o<3;){if(0===x)break O;x--,E+=L[U++]<<o,o+=8}switch(y.last=1&E,E>>>=1,o-=1,3&E){case 0:y.mode=14;break;case 1:if(i(y),y.mode=20,f===m){E>>>=2,o-=2;break O}break;case 2:y.mode=17;break;case 3:O.msg="invalid block type",y.mode=j}E>>>=2,o-=2;break;case 14:for(E>>>=7&o,o-=7&o;o<32;){if(0===x)break O;x--,E+=L[U++]<<o,o+=8}if((65535&E)!==(E>>>16^65535)){O.msg="invalid stored block lengths",y.mode=j;break}if(y.length=65535&E,E=0,o=0,y.mode=15,f===m)break O;case 15:y.mode=16;case 16:if(R=y.length,R){if(R>x&&(R=x),R>W&&(R=W),0===R)break O;p.set(L.subarray(U,U+R),l),x-=R,U+=R,W-=R,l+=R,y.length-=R;break}y.mode=B;break;case 17:for(;o<14;){if(0===x)break O;x--,E+=L[U++]<<o,o+=8}if(y.nlen=257+(31&E),E>>>=5,o-=5,y.ndist=1+(31&E),E>>>=5,o-=5,y.ncode=4+(15&E),E>>>=4,o-=4,y.nlen>286||y.ndist>30){O.msg="too many length or distance symbols",y.mode=j;break}y.have=0,y.mode=18;case 18:for(;y.have<y.ncode;){for(;o<3;){if(0===x)break O;x--,E+=L[U++]<<o,o+=8}y.lens[Q[y.have++]]=7&E,E>>>=3,o-=3}for(;y.have<19;)y.lens[Q[y.have++]]=0;if(y.lencode=y.lendyn,y.lenbits=7,K={bits:y.lenbits},M=h(0,y.lens,0,19,y.lencode,0,y.work,K),y.lenbits=K.bits,M){O.msg="invalid code lengths set",y.mode=j;break}y.have=0,y.mode=19;case 19:for(;y.have<y.nlen+y.ndist;){for(;P=y.lencode[E&(1<<y.lenbits)-1],z=P>>>24,c=P>>>16&255,d=65535&P,!(z<=o);){if(0===x)break O;x--,E+=L[U++]<<o,o+=8}if(d<16)E>>>=z,o-=z,y.lens[y.have++]=d;else{if(16===d){for(T=z+2;o<T;){if(0===x)break O;x--,E+=L[U++]<<o,o+=8}if(E>>>=z,o-=z,0===y.have){O.msg="invalid bit length repeat",y.mode=j;break}a=y.lens[y.have-1],R=3+(3&E),E>>>=2,o-=2}else if(17===d){for(T=z+3;o<T;){if(0===x)break O;x--,E+=L[U++]<<o,o+=8}E>>>=z,o-=z,a=0,R=3+(7&E),E>>>=3,o-=3}else{for(T=z+7;o<T;){if(0===x)break O;x--,E+=L[U++]<<o,o+=8}E>>>=z,o-=z,a=0,R=11+(127&E),E>>>=7,o-=7}if(y.have+R>y.nlen+y.ndist){O.msg="invalid bit length repeat",y.mode=j;break}for(;R--;)y.lens[y.have++]=a}}if(y.mode===j)break;if(0===y.lens[256]){O.msg="invalid code -- missing end-of-block",y.mode=j;break}if(y.lenbits=9,K={bits:y.lenbits},M=h(1,y.lens,0,y.nlen,y.lencode,0,y.work,K),y.lenbits=K.bits,M){O.msg="invalid literal/lengths set",y.mode=j;break}if(y.distbits=6,y.distcode=y.distdyn,K={bits:y.distbits},M=h(2,y.lens,y.nlen,y.ndist,y.distcode,0,y.work,K),y.distbits=K.bits,M){O.msg="invalid distances set",y.mode=j;break}if(y.mode=20,f===m)break O;case 20:y.mode=21;case 21:if(x>=6&&W>=258){O.next_out=l,O.avail_out=W,O.next_in=U,O.avail_in=x,y.hold=E,y.bits=o,b(O,g),l=O.next_out,p=O.output,W=O.avail_out,U=O.next_in,L=O.input,x=O.avail_in,E=y.hold,o=y.bits,y.mode===B&&(y.back=-1);break}for(y.back=0;P=y.lencode[E&(1<<y.lenbits)-1],z=P>>>24,c=P>>>16&255,d=65535&P,!(z<=o);){if(0===x)break O;x--,E+=L[U++]<<o,o+=8}if(c&&0===(240&c)){for(G=z,Y=c,Z=d;P=y.lencode[Z+((E&(1<<G+Y)-1)>>G)],z=P>>>24,c=P>>>16&255,d=65535&P,!(G+z<=o);){if(0===x)break O;x--,E+=L[U++]<<o,o+=8}E>>>=G,o-=G,y.back+=G}if(E>>>=z,o-=z,y.back+=z,y.length=d,0===c){y.mode=26;break}if(32&c){y.back=-1,y.mode=B;break}if(64&c){O.msg="invalid literal/length code",y.mode=j;break}y.extra=15&c,y.mode=22;case 22:if(y.extra){for(T=y.extra;o<T;){if(0===x)break O;x--,E+=L[U++]<<o,o+=8}y.length+=E&(1<<y.extra)-1,E>>>=y.extra,o-=y.extra,y.back+=y.extra}y.was=y.length,y.mode=23;case 23:for(;P=y.distcode[E&(1<<y.distbits)-1],z=P>>>24,c=P>>>16&255,d=65535&P,!(z<=o);){if(0===x)break O;x--,E+=L[U++]<<o,o+=8}if(0===(240&c)){for(G=z,Y=c,Z=d;P=y.distcode[Z+((E&(1<<G+Y)-1)>>G)],z=P>>>24,c=P>>>16&255,d=65535&P,!(G+z<=o);){if(0===x)break O;x--,E+=L[U++]<<o,o+=8}E>>>=G,o-=G,y.back+=G}if(E>>>=z,o-=z,y.back+=z,64&c){O.msg="invalid distance code",y.mode=j;break}y.offset=d,y.extra=15&c,y.mode=24;case 24:if(y.extra){for(T=y.extra;o<T;){if(0===x)break O;x--,E+=L[U++]<<o,o+=8}y.offset+=E&(1<<y.extra)-1,E>>>=y.extra,o-=y.extra,y.back+=y.extra}if(y.offset>y.dmax){O.msg="invalid distance too far back",y.mode=j;break}y.mode=25;case 25:if(0===W)break O;if(R=g-W,y.offset>R){if(R=y.offset-R,R>y.whave&&y.sane){O.msg="invalid distance too far back",y.mode=j;break}R>y.wnext?(R-=y.wnext,s=y.wsize-R):s=y.wnext-R,R>y.length&&(R=y.length),k=y.window}else k=p,s=l-y.offset,R=y.length;R>W&&(R=W),W-=R,y.length-=R;do{p[l++]=k[s++]}while(--R);0===y.length&&(y.mode=21);break;case 26:if(0===W)break O;p[l++]=y.length,W--,y.mode=21;break;case 27:if(y.wrap){for(;o<32;){if(0===x)break O;x--,E|=L[U++]<<o,o+=8}if(g-=W,O.total_out+=g,y.total+=g,g&&(O.adler=y.check=y.flags?H(y.check,p,g,l-g):S(y.check,p,g,l-g)),g=W,(y.flags?E:u(E))!==y.check){O.msg="incorrect data check",y.mode=j;break}E=0,o=0}y.mode=28;case 28:if(y.wrap&&y.flags){for(;o<32;){if(0===x)break O;x--,E+=L[U++]<<o,o+=8}if(E!==(4294967295&y.total)){O.msg="incorrect length check",y.mode=j;break}E=0,o=0}y.mode=29;case 29:M=q;break O;case j:M=A;break O;case 31:return J;default:return I}return O.next_out=l,O.avail_out=W,O.next_in=U,O.avail_in=x,y.hold=E,y.bits=o,(y.wsize||g!==O.avail_out&&y.mode<j&&(y.mode<27||f!==v))&&D(O,O.output,O.next_out,g-O.avail_out)?(y.mode=31,J):(V-=O.avail_in,g-=O.avail_out,O.total_in+=V,O.total_out+=g,y.total+=g,y.wrap&&g&&(O.adler=y.check=y.flags?H(y.check,p,g,O.next_out-g):S(y.check,p,g,O.next_out-g)),O.data_type=y.bits+(y.last?64:0)+(y.mode===B?128:0)+(20===y.mode||15===y.mode?256:0),(0===V&&0===g||f===v)&&M===t&&(M=X),M)},O.exports.inflateEnd=O=>{if(!O||!O.state)return I;let f=O.state;return f.window&&(f.window=null),O.state=null,t},O.exports.inflateGetHeader=(O,f)=>{if(!O||!O.state)return I;const y=O.state;return 0===(2&y.wrap)?I:(y.head=f,f.done=!1,t)},O.exports.inflateSetDictionary=(O,f)=>{const y=f.length;let H,b,h;return O&&O.state?(H=O.state,0!==H.wrap&&11!==H.mode?I:11===H.mode&&(b=1,b=S(b,f,y,0),b!==H.check)?A:(h=D(O,f,y,y),h?(H.mode=31,J):(H.havedict=1,t))):I},O.exports.inflateInfo="pako inflate (from Nodeca project)"},11250:O=>{"use strict";const f=15,y=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),S=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),H=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),b=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);O.exports=(O,h,v,N,m,t,q,F)=>{const I=F.bits;let A,J,X,w,B,j,u=0,L=0,p=0,U=0,l=0,x=0,W=0,E=0,o=0,i=0,D=null,V=0;const g=new Uint16Array(16),R=new Uint16Array(16);let s,k,z,c=null,d=0;for(u=0;u<=f;u++)g[u]=0;for(L=0;L<N;L++)g[h[v+L]]++;for(l=I,U=f;U>=1&&0===g[U];U--);if(l>U&&(l=U),0===U)return m[t++]=20971520,m[t++]=20971520,F.bits=1,0;for(p=1;p<U&&0===g[p];p++);for(l<p&&(l=p),E=1,u=1;u<=f;u++)if(E<<=1,E-=g[u],E<0)return-1;if(E>0&&(0===O||1!==U))return-1;for(R[1]=0,u=1;u<f;u++)R[u+1]=R[u]+g[u];for(L=0;L<N;L++)0!==h[v+L]&&(q[R[h[v+L]]++]=L);if(0===O?(D=c=q,j=19):1===O?(D=y,V-=257,c=S,d-=257,j=256):(D=H,c=b,j=-1),i=0,L=0,u=p,B=t,x=l,W=0,X=-1,o=1<<l,w=o-1,1===O&&o>852||2===O&&o>592)return 1;for(;;){s=u-W,q[L]<j?(k=0,z=q[L]):q[L]>j?(k=c[d+q[L]],z=D[V+q[L]]):(k=96,z=0),A=1<<u-W,J=1<<x,p=J;do{J-=A,m[B+(i>>W)+J]=s<<24|k<<16|z}while(0!==J);for(A=1<<u-1;i&A;)A>>=1;if(0!==A?(i&=A-1,i+=A):i=0,L++,0===--g[u]){if(u===U)break;u=h[v+q[L]]}if(u>l&&(i&w)!==X){for(0===W&&(W=l),B+=p,x=u-W,E=1<<x;x+W<U&&(E-=g[x+W],!(E<=0));)x++,E<<=1;if(o+=1<<x,1===O&&o>852||2===O&&o>592)return 1;X=i&w,m[X]=l<<24|x<<16|B-t}}return 0!==i&&(m[B+i]=u-W<<24|64<<16),F.bits=l,0}},11201:O=>{"use strict";O.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},11190:O=>{"use strict";function f(O){let f=O.length;for(;--f>=0;)O[f]=0}const y=256,S=286,H=30,b=15,h=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),v=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),N=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),m=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),t=new Array(576);f(t);const q=new Array(60);f(q);const F=new Array(512);f(F);const I=new Array(256);f(I);const A=new Array(29);f(A);const J=new Array(H);function X(O,f,y,S,H){this.static_tree=O,this.extra_bits=f,this.extra_base=y,this.elems=S,this.max_length=H,this.has_stree=O&&O.length}let w,B,j;function u(O,f){this.dyn_tree=O,this.max_code=0,this.stat_desc=f}f(J);const L=O=>O<256?F[O]:F[256+(O>>>7)],p=(O,f)=>{O.pending_buf[O.pending++]=255&f,O.pending_buf[O.pending++]=f>>>8&255},U=(O,f,y)=>{O.bi_valid>16-y?(O.bi_buf|=f<<O.bi_valid&65535,p(O,O.bi_buf),O.bi_buf=f>>16-O.bi_valid,O.bi_valid+=y-16):(O.bi_buf|=f<<O.bi_valid&65535,O.bi_valid+=y)},l=(O,f,y)=>{U(O,y[2*f],y[2*f+1])},x=(O,f)=>{let y=0;do{y|=1&O,O>>>=1,y<<=1}while(--f>0);return y>>>1},W=(O,f,y)=>{const S=new Array(16);let H,h,v=0;for(H=1;H<=b;H++)S[H]=v=v+y[H-1]<<1;for(h=0;h<=f;h++){let f=O[2*h+1];0!==f&&(O[2*h]=x(S[f]++,f))}},E=O=>{let f;for(f=0;f<S;f++)O.dyn_ltree[2*f]=0;for(f=0;f<H;f++)O.dyn_dtree[2*f]=0;for(f=0;f<19;f++)O.bl_tree[2*f]=0;O.dyn_ltree[512]=1,O.opt_len=O.static_len=0,O.last_lit=O.matches=0},o=O=>{O.bi_valid>8?p(O,O.bi_buf):O.bi_valid>0&&(O.pending_buf[O.pending++]=O.bi_buf),O.bi_buf=0,O.bi_valid=0},i=(O,f,y,S)=>{const H=2*f,b=2*y;return O[H]<O[b]||O[H]===O[b]&&S[f]<=S[y]},D=(O,f,y)=>{const S=O.heap[y];let H=y<<1;for(;H<=O.heap_len&&(H<O.heap_len&&i(f,O.heap[H+1],O.heap[H],O.depth)&&H++,!i(f,S,O.heap[H],O.depth));)O.heap[y]=O.heap[H],y=H,H<<=1;O.heap[y]=S},V=(O,f,S)=>{let H,b,N,m,t=0;if(0!==O.last_lit)do{H=O.pending_buf[O.d_buf+2*t]<<8|O.pending_buf[O.d_buf+2*t+1],b=O.pending_buf[O.l_buf+t],t++,0===H?l(O,b,f):(N=I[b],l(O,N+y+1,f),m=h[N],0!==m&&(b-=A[N],U(O,b,m)),H--,N=L(H),l(O,N,S),m=v[N],0!==m&&(H-=J[N],U(O,H,m)))}while(t<O.last_lit);l(O,256,f)},g=(O,f)=>{const y=f.dyn_tree,S=f.stat_desc.static_tree,H=f.stat_desc.has_stree,h=f.stat_desc.elems;let v,N,m,t=-1;for(O.heap_len=0,O.heap_max=573,v=0;v<h;v++)0!==y[2*v]?(O.heap[++O.heap_len]=t=v,O.depth[v]=0):y[2*v+1]=0;for(;O.heap_len<2;)m=O.heap[++O.heap_len]=t<2?++t:0,y[2*m]=1,O.depth[m]=0,O.opt_len--,H&&(O.static_len-=S[2*m+1]);for(f.max_code=t,v=O.heap_len>>1;v>=1;v--)D(O,y,v);m=h;do{v=O.heap[1],O.heap[1]=O.heap[O.heap_len--],D(O,y,1),N=O.heap[1],O.heap[--O.heap_max]=v,O.heap[--O.heap_max]=N,y[2*m]=y[2*v]+y[2*N],O.depth[m]=(O.depth[v]>=O.depth[N]?O.depth[v]:O.depth[N])+1,y[2*v+1]=y[2*N+1]=m,O.heap[1]=m++,D(O,y,1)}while(O.heap_len>=2);O.heap[--O.heap_max]=O.heap[1],((O,f)=>{const y=f.dyn_tree,S=f.max_code,H=f.stat_desc.static_tree,h=f.stat_desc.has_stree,v=f.stat_desc.extra_bits,N=f.stat_desc.extra_base,m=f.stat_desc.max_length;let t,q,F,I,A,J,X=0;for(I=0;I<=b;I++)O.bl_count[I]=0;for(y[2*O.heap[O.heap_max]+1]=0,t=O.heap_max+1;t<573;t++)q=O.heap[t],I=y[2*y[2*q+1]+1]+1,I>m&&(I=m,X++),y[2*q+1]=I,q>S||(O.bl_count[I]++,A=0,q>=N&&(A=v[q-N]),J=y[2*q],O.opt_len+=J*(I+A),h&&(O.static_len+=J*(H[2*q+1]+A)));if(0!==X){do{for(I=m-1;0===O.bl_count[I];)I--;O.bl_count[I]--,O.bl_count[I+1]+=2,O.bl_count[m]--,X-=2}while(X>0);for(I=m;0!==I;I--)for(q=O.bl_count[I];0!==q;)F=O.heap[--t],F>S||(y[2*F+1]!==I&&(O.opt_len+=(I-y[2*F+1])*y[2*F],y[2*F+1]=I),q--)}})(O,f),W(y,t,O.bl_count)},R=(O,f,y)=>{let S,H,b=-1,h=f[1],v=0,N=7,m=4;for(0===h&&(N=138,m=3),f[2*(y+1)+1]=65535,S=0;S<=y;S++)H=h,h=f[2*(S+1)+1],++v<N&&H===h||(v<m?O.bl_tree[2*H]+=v:0!==H?(H!==b&&O.bl_tree[2*H]++,O.bl_tree[32]++):v<=10?O.bl_tree[34]++:O.bl_tree[36]++,v=0,b=H,0===h?(N=138,m=3):H===h?(N=6,m=3):(N=7,m=4))},s=(O,f,y)=>{let S,H,b=-1,h=f[1],v=0,N=7,m=4;for(0===h&&(N=138,m=3),S=0;S<=y;S++)if(H=h,h=f[2*(S+1)+1],!(++v<N&&H===h)){if(v<m)do{l(O,H,O.bl_tree)}while(0!==--v);else 0!==H?(H!==b&&(l(O,H,O.bl_tree),v--),l(O,16,O.bl_tree),U(O,v-3,2)):v<=10?(l(O,17,O.bl_tree),U(O,v-3,3)):(l(O,18,O.bl_tree),U(O,v-11,7));v=0,b=H,0===h?(N=138,m=3):H===h?(N=6,m=3):(N=7,m=4)}};let k=!1;const z=(O,f,y,S)=>{U(O,0+(S?1:0),3),((O,f,y,S)=>{o(O),S&&(p(O,y),p(O,~y)),O.pending_buf.set(O.window.subarray(f,f+y),O.pending),O.pending+=y})(O,f,y,!0)};O.exports._tr_init=O=>{k||((()=>{let O,f,y,m,u;const L=new Array(16);for(y=0,m=0;m<28;m++)for(A[m]=y,O=0;O<1<<h[m];O++)I[y++]=m;for(I[y-1]=m,u=0,m=0;m<16;m++)for(J[m]=u,O=0;O<1<<v[m];O++)F[u++]=m;for(u>>=7;m<H;m++)for(J[m]=u<<7,O=0;O<1<<v[m]-7;O++)F[256+u++]=m;for(f=0;f<=b;f++)L[f]=0;for(O=0;O<=143;)t[2*O+1]=8,O++,L[8]++;for(;O<=255;)t[2*O+1]=9,O++,L[9]++;for(;O<=279;)t[2*O+1]=7,O++,L[7]++;for(;O<=287;)t[2*O+1]=8,O++,L[8]++;for(W(t,287,L),O=0;O<H;O++)q[2*O+1]=5,q[2*O]=x(O,5);w=new X(t,h,257,S,b),B=new X(q,v,0,H,b),j=new X(new Array(0),N,0,19,7)})(),k=!0),O.l_desc=new u(O.dyn_ltree,w),O.d_desc=new u(O.dyn_dtree,B),O.bl_desc=new u(O.bl_tree,j),O.bi_buf=0,O.bi_valid=0,E(O)},O.exports._tr_stored_block=z,O.exports._tr_flush_block=(O,f,S,H)=>{let b,h,v=0;O.level>0?(2===O.strm.data_type&&(O.strm.data_type=(O=>{let f,S=4093624447;for(f=0;f<=31;f++,S>>>=1)if(1&S&&0!==O.dyn_ltree[2*f])return 0;if(0!==O.dyn_ltree[18]||0!==O.dyn_ltree[20]||0!==O.dyn_ltree[26])return 1;for(f=32;f<y;f++)if(0!==O.dyn_ltree[2*f])return 1;return 0})(O)),g(O,O.l_desc),g(O,O.d_desc),v=(O=>{let f;for(R(O,O.dyn_ltree,O.l_desc.max_code),R(O,O.dyn_dtree,O.d_desc.max_code),g(O,O.bl_desc),f=18;f>=3&&0===O.bl_tree[2*m[f]+1];f--);return O.opt_len+=3*(f+1)+5+5+4,f})(O),b=O.opt_len+3+7>>>3,h=O.static_len+3+7>>>3,h<=b&&(b=h)):b=h=S+5,S+4<=b&&-1!==f?z(O,f,S,H):4===O.strategy||h===b?(U(O,2+(H?1:0),3),V(O,t,q)):(U(O,4+(H?1:0),3),((O,f,y,S)=>{let H;for(U(O,f-257,5),U(O,y-1,5),U(O,S-4,4),H=0;H<S;H++)U(O,O.bl_tree[2*m[H]+1],3);s(O,O.dyn_ltree,f-1),s(O,O.dyn_dtree,y-1)})(O,O.l_desc.max_code+1,O.d_desc.max_code+1,v+1),V(O,O.dyn_ltree,O.dyn_dtree)),E(O),H&&o(O)},O.exports._tr_tally=(O,f,S)=>(O.pending_buf[O.d_buf+2*O.last_lit]=f>>>8&255,O.pending_buf[O.d_buf+2*O.last_lit+1]=255&f,O.pending_buf[O.l_buf+O.last_lit]=255&S,O.last_lit++,0===f?O.dyn_ltree[2*S]++:(O.matches++,f--,O.dyn_ltree[2*(I[S]+y+1)]++,O.dyn_dtree[2*L(f)]++),O.last_lit===O.lit_bufsize-1),O.exports._tr_align=O=>{U(O,2,3),l(O,256,t),(O=>{16===O.bi_valid?(p(O,O.bi_buf),O.bi_buf=0,O.bi_valid=0):O.bi_valid>=8&&(O.pending_buf[O.pending++]=255&O.bi_buf,O.bi_buf>>=8,O.bi_valid-=8)})(O)}},11219:O=>{"use strict";O.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},12166:O=>{function f(O,f,y){for(var S=O.length,H=-1/0,b=1/0,h=0;h<S;h++){var v=(y[0][h]-O[h])/f[h],N=(y[1][h]-O[h])/f[h];if(v>N){var m=v;v=N,N=m}if(N<H||v>b)return 1/0;v>H&&(H=v),N<b&&(b=N)}return H>b?1/0:H}O.exports=function(O,y,S,H){var b=f(y,S,H);if(b===1/0)O=null;else{O=O||[];for(var h=0;h<y.length;h++)O[h]=y[h]+S[h]*b}return O},O.exports.distance=f},12642:(O,f,y)=>{"use strict";y.d(f,{b:()=>h});var S=y(30);const H=S.useLayoutEffect;const b=function(O){var f=(0,S.useRef)(O);return H((function(){f.current=O})),f};var h=function(O){var f=b(O);(0,S.useEffect)((function(){var O=function(O){var y;if(null!=f.current&&(y=f.current(O)),O.defaultPrevented&&(O.returnValue=""),"string"===typeof y)return O.returnValue=y,y};return window.addEventListener("beforeunload",O),function(){window.removeEventListener("beforeunload",O)}}),[])}},12600:(O,f,y)=>{"use strict";var S=y(12608),H=Array.prototype.concat,b=Array.prototype.slice,h=O.exports=function(O){for(var f=[],y=0,h=O.length;y<h;y++){var v=O[y];S(v)?f=H.call(f,b.call(v)):f.push(v)}return f};h.wrap=function(O){return function(){return O(h(arguments))}}},12608:O=>{O.exports=function(O){return!(!O||"string"===typeof O)&&(O instanceof Array||Array.isArray(O)||O.length>=0&&(O.splice instanceof Function||Object.getOwnPropertyDescriptor(O,O.length-1)&&"String"!==O.constructor.name))}},12557:O=>{"use strict";var f=[],y=[],S=[],H=[],b=[],h=[],v=[],N=[],m=[],t=[],q=[],F=[];O.exports=function(O,I,A,J,X,w){for(var B=v,j=m,u=t,L=F,p=0;p<3;p++)B[p]=+A[p],u[p]=+I.max[p],j[p]=+I.base[p];w||(w=1e-10);var U=function(O,v,m,t,F,I){var A=f,J=y,X=S,w=H,B=b,j=h,u=N,L=Math.floor,p=0,U=0,l=0,x=0,W=0;if(E(),0===l)return 0;for(x=D();U<=l;){if(o(x)&&i())return p;x=D()}for(p+=l,W=0;W<3;W++)t[W]+=m[W],F[W]+=m[W];return p;function E(){if(U=0,0!==(l=Math.sqrt(m[0]*m[0]+m[1]*m[1]+m[2]*m[2])))for(var O=0;O<3;O++){var f=m[O]>=0;w[O]=f?1:-1;var y=f?F[O]:t[O];A[O]=f?t[O]:F[O],J[O]=V(y,w[O]),X[O]=g(A[O],w[O]),u[O]=m[O]/l,B[O]=Math.abs(1/u[O]);var S=f?J[O]+1-y:y-J[O];j[O]=B[O]<1/0?B[O]*S:1/0}}function o(f){for(var y=w[0],S=0===f?J[0]:X[0],H=J[0]+y,b=w[1],h=1===f?J[1]:X[1],v=J[1]+b,N=w[2],m=2===f?J[2]:X[2],t=J[2]+N,q=S;q!=H;q+=y)for(var F=h;F!=v;F+=b)for(var I=m;I!=t;I+=N)if(O(q,F,I))return!0;return!1}function i(){p+=U;var O=w[x],f=U/l,y=q;for(W=0;W<3;W++){var S=m[W]*f;t[W]+=S,F[W]+=S,y[W]=m[W]-S}if(O>0?F[x]=Math.round(F[x]):t[x]=Math.round(t[x]),v(p,x,O,y))return!0;for(W=0;W<3;W++)m[W]=y[W];return E(),0===l}function D(){var O=j[0]<j[1]?j[0]<j[2]?0:2:j[1]<j[2]?1:2,f=j[O]-U;for(U=j[O],J[O]+=w[O],j[O]+=B[O],W=0;W<3;W++)A[W]+=f*u[W],X[W]=g(A[W],w[W]);return O}function V(O,f){return L(O-f*I)}function g(O,f){return L(O+f*I)}}(O,J,B,j,u,w);if(!X){for(p=0;p<3;p++)L[p]=A[p]>0?u[p]-I.max[p]:j[p]-I.base[p];I.translate(L)}return U}},10963:(O,f,y)=>{var S=y(10967);function H(O){for(var f,y,H=0,b=O.length,h=0;h<O.length;){for(f=O[h],y=0;h<b&&O[h]===f;)++h,++y;H+=S.log2(y)/7|0,H+=S.log2(f>>>0)/7|0,H+=2}return H}f.size=H,f.encode=function(O,f){f||(f=new Uint8Array(H(O)));for(var y,S,b=0,h=f.length,v=0;v<O.length;){for(y=O[v],S=0;v<O.length&&O[v]===y;)++v,++S;for(;b<h&&S>=128;)f[b++]=128+(127&S),S>>>=7;if(b>=h)throw new Error("RLE buffer overflow");for(f[b++]=S,y>>>=0;b<h&&y>=128;)f[b++]=128+(127&y),y>>>=7;if(b>=h)throw new Error("RLE buffer overflow");f[b++]=y}return f},f.decode=function(O,f){for(var y,S,H,b,h=f.length,v=O.length,N=0,m=0;m<v;){for(y=0,S=0;m<v&&O[m]>=128;)y+=(127&O[m++])<<S,S+=7;if(y+=O[m++]<<S,m>=v)throw new Error("RLE buffer underrun");if(N+y>h)throw new Error("Chunk buffer overflow");for(H=0,S=0;m<v&&O[m]>=128;)H+=(127&O[m++])<<S,S+=7;if(m>=v)throw new Error("RLE buffer underrun");for(H+=O[m++]<<S,b=0;b<y;++b)f[N++]=H}return f}},10967:(O,f)=>{"use strict";function y(O){var f=32;return(O&=-O)&&f--,65535&O&&(f-=16),16711935&O&&(f-=8),252645135&O&&(f-=4),858993459&O&&(f-=2),1431655765&O&&(f-=1),f}f.INT_BITS=32,f.INT_MAX=2147483647,f.INT_MIN=-1<<31,f.sign=function(O){return(O>0)-(O<0)},f.abs=function(O){var f=O>>31;return(O^f)-f},f.min=function(O,f){return f^(O^f)&-(O<f)},f.max=function(O,f){return O^(O^f)&-(O<f)},f.isPow2=function(O){return!(O&O-1)&&!!O},f.log2=function(O){var f,y;return f=(O>65535)<<4,f|=y=((O>>>=f)>255)<<3,f|=y=((O>>>=y)>15)<<2,(f|=y=((O>>>=y)>3)<<1)|(O>>>=y)>>1},f.log10=function(O){return O>=1e9?9:O>=1e8?8:O>=1e7?7:O>=1e6?6:O>=1e5?5:O>=1e4?4:O>=1e3?3:O>=100?2:O>=10?1:0},f.popCount=function(O){return 16843009*((O=(858993459&(O-=O>>>1&1431655765))+(O>>>2&858993459))+(O>>>4)&252645135)>>>24},f.countTrailingZeros=y,f.nextPow2=function(O){return O+=0===O,--O,O|=O>>>1,O|=O>>>2,O|=O>>>4,O|=O>>>8,(O|=O>>>16)+1},f.prevPow2=function(O){return O|=O>>>1,O|=O>>>2,O|=O>>>4,O|=O>>>8,(O|=O>>>16)-(O>>>1)},f.parity=function(O){return O^=O>>>16,O^=O>>>8,O^=O>>>4,27030>>>(O&=15)&1};var S=new Array(256);!function(O){for(var f=0;f<256;++f){var y=f,S=f,H=7;for(y>>>=1;y;y>>>=1)S<<=1,S|=1&y,--H;O[f]=S<<H&255}}(S),f.reverse=function(O){return S[255&O]<<24|S[O>>>8&255]<<16|S[O>>>16&255]<<8|S[O>>>24&255]},f.interleave2=function(O,f){return(O=1431655765&((O=858993459&((O=252645135&((O=16711935&((O&=65535)|O<<8))|O<<4))|O<<2))|O<<1))|(f=1431655765&((f=858993459&((f=252645135&((f=16711935&((f&=65535)|f<<8))|f<<4))|f<<2))|f<<1))<<1},f.deinterleave2=function(O,f){return(O=65535&((O=16711935&((O=252645135&((O=858993459&((O=O>>>f&1431655765)|O>>>1))|O>>>2))|O>>>4))|O>>>16))<<16>>16},f.interleave3=function(O,f,y){return O=1227133513&((O=3272356035&((O=251719695&((O=4278190335&((O&=1023)|O<<16))|O<<8))|O<<4))|O<<2),(O|=(f=1227133513&((f=3272356035&((f=251719695&((f=4278190335&((f&=1023)|f<<16))|f<<8))|f<<4))|f<<2))<<1)|(y=1227133513&((y=3272356035&((y=251719695&((y=4278190335&((y&=1023)|y<<16))|y<<8))|y<<4))|y<<2))<<2},f.deinterleave3=function(O,f){return(O=1023&((O=4278190335&((O=251719695&((O=3272356035&((O=O>>>f&1227133513)|O>>>2))|O>>>4))|O>>>8))|O>>>16))<<22>>22},f.nextCombination=function(O){var f=O|O-1;return f+1|(~f&-~f)-1>>>y(O)+1}},12712:(O,f,y)=>{"use strict";y.d(f,{c:()=>q});var S=y(12552),H=y(136);class b{constructor(O,f,y,b,h,v,N){this.ug=new S(O.base,O.Rg),this.mass=f,this.friction=y,this.restitution=b,this.Bc=h,this.Gk=v,this.Gc=!!N,this.Og=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.sl=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Jf=H.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=H.create(),this._impulses=H.create(),this._sleepFrameCount=10}loadFromCopy(O){H.i(this.ug.base,O.ug.base),H.i(this.ug.Rg,O.ug.Rg),H.i(this.ug.max,O.ug.max),this.ug.mag=O.ug.mag,this.mass=O.mass,this.friction=O.friction,this.restitution=O.restitution,this.Bc=O.Bc,this.Gk=O.Gk,this.Gc=O.Gc,this.Og=O.Og,this.fluidDrag=O.fluidDrag,this.sl=O.sl,this.preventFallOffEdge=O.preventFallOffEdge,this.rolledBackLastTick=O.rolledBackLastTick,H.i(this.Jf,O.Jf),H.i(this.resting,O.resting),this.inFluid=O.inFluid,this._ratioInFluid=O._ratioInFluid,H.i(this._forces,O._forces),H.i(this._impulses,O._impulses),this._sleepFrameCount=O._sleepFrameCount}setPosition(O){h(O),H.xc(O,O,this.ug.base),this.ug.translate(O),this.Nf()}cb(){return H.clone(this.ug.base)}applyForce(O){h(O),H.add(this._forces,this._forces,O),this.Nf()}applyImpulse(O){h(O),H.add(this._impulses,this._impulses,O),this.Nf()}Nf(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var h=O=>{};var v=y(12552),N=y(136),m=y(12557);function t(){this.Og=.1,this.fluidDrag=.4,this.Wc=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function q(O,f,y){O=Object.assign(new t,O),this.gravity=O.gravity||[0,-10,0],this.Og=O.Og||.1,this.Wc=O.Wc||2,this.fluidDrag=O.fluidDrag||.4,this.minBounceImpulse=O.minBounceImpulse,this.bodies=[],this.bk=O.bk,this.testSolid=f,this.testFluid=y}q.prototype.Nk=function(O,f,y,S,H,h){O=O||new v([0,0,0],[1,1,1]),"undefined"==typeof f&&(f=1),"undefined"==typeof y&&(y=1),"undefined"==typeof S&&(S=0),"undefined"==typeof H&&(H=1);var N=new b(O,f,y,S,H,h);return this.bodies.push(N),N},q.prototype.Ok=function(O){var f=this.bodies.indexOf(O);f<0||(this.bodies.splice(f,1),O.ug=O.Gk=null)};var F=N.create(),I=N.create(),A=N.create(),J=N.create(),X=N.create(),w=N.create(),B=N.create(),j=new v([0,0,0],[1,1,1]),u=new b(j,1,1,0,1,(()=>{}),!1);function L(O,f,y){return f=y,f*=1-(1-O.ratioInFluid)**2}q.prototype.td=function(O){O/=1e3;var f=c(0,N.squaredLength(this.gravity));this.bodies.forEach((y=>function(O,f,y,S){N.i(X,f.resting),O.bk&&u.loadFromCopy(f);if(f.mass<=0)return N.set(f.Jf,0,0,0),N.set(f._forces,0,0,0),void N.set(f._impulses,0,0,0);var H=S||0===f.Bc;if(function(O,f,y,S){if(f._sleepFrameCount>0)return!1;if(S)return!0;var H=!1,b=.5*y*y*f.Bc;return N.scale(z,O.gravity,b),m(O.testSolid,f.ug,z,(function(){return H=!0,!0}),!0),H}(O,f,y,H))return;f._sleepFrameCount--,function(O,f){var y=f.ug,S=Math.floor(y.base[0]),H=Math.floor(y.base[2]),b=Math.floor(y.base[1]),h=Math.floor(y.max[1]);if(!O.testFluid(S,b,H))return f.inFluid=!1,void(f.ratioInFluid=0);var v=1,m=b+1;for(;m<=h&&O.testFluid(S,m,H);)v++,m++;var t=(b+v-y.base[1])/y.Rg[1];t>1&&(t=1);var q=y.Rg[0]*y.Rg[1]*y.Rg[2]*t,F=U;N.scale(F,O.gravity,-O.Wc*q*f.Bc),f.applyForce(F),f.inFluid=!0,f.ratioInFluid=t}(O,f),G(f._forces),G(f._impulses),G(f.Jf),G(f.resting),N.scale(F,f._forces,1/f.mass),N.ed(F,F,O.gravity,f.Bc),N.scale(I,f._impulses,1/f.mass),N.ed(I,I,F,y),N.add(f.Jf,f.Jf,I),f.friction&&(l(O,0,f,I,y),l(O,1,f,I,y),l(O,2,f,I,y));var b=f.fluidDrag>=0?f.fluidDrag:O.fluidDrag,h=f.Og>=0?f.Og:O.Og,v=h,t=h;f.inFluid&&(v=L(f,v,f.fluidDragHoriz>=0?f.fluidDragHoriz:b),t=L(f,t,f.fluidDragVert>=0?f.fluidDragVert:b));v=Math.max(1-v*y/f.mass,0),t=Math.max(1-t*y/f.mass,0),N.set(p,v,t,v),N.multiply(f.Jf,f.Jf,p),N.scale(A,f.Jf,y),N.set(f._forces,0,0,0),N.set(f._impulses,0,0,0),f.Gc&&d(E,f.ug);N.i(w,A),N.set(B,0,0,0),f.preventFallOffEdge&&function(O,f,y,S){if(!f.resting[1]||y[1]>0)return;var H=R;d(H,f.ug);for(var b=0;b<3;b+=2){N.set(g,0,0,0),g[b]=y[b];var h=!0;(h=(h=(h=(h=h&&!k(O,H.base[0]+g[0]+1e-5,H.base[1],H.base[2]+g[2]+1e-5))&&!k(O,H.max[0]+g[0]-1e-5,H.base[1],H.base[2]+g[2]+1e-5))&&!k(O,H.base[0]+g[0]+1e-5,H.base[1],H.max[2]+g[2]-1e-5))&&!k(O,H.max[0]+g[0]-1e-5,H.base[1],H.max[2]+g[2]-1e-5))?(S[b]=y[b]>0?1:-1,y[b]=0):0===b&&(N.set(s,y[0],0,0),W(O,H,s,S,f.slideOnCollision))}}(O,f,A,B);W(O,f.ug,A,f.resting,f.slideOnCollision),f.Gc&&function(O,f,y,S){if(f.resting[1]>=0&&!f.inFluid)return;var H=0!==f.resting[0],b=0!==f.resting[2];if(!H&&!b)return;var h=Math.abs(S[0]/S[2]),v=4;if(!H&&h>v)return;if(!b&&h<1/v)return;N.add(i,y.base,S);var t=O.testSolid;m(t,y,S,(function(O,f,y,S){if(1!==f)return!0;S[f]=0}));var q=y.base[1],F=f.inFluid?1.951:1.001,I=Math.floor(q+F)-q;N.set(D,0,I,0);var A=!1;if(m(t,y,D,(function(O,f,y,S){return A=!0,!0})),A)return;N.xc(V,i,y.base),V[1]=0,W(O,y,V,o,!0);var J=c(y.base[0],i[0]),X=c(y.base[2],i[2]);if(H&&!J&&(!X||!b))return;if(b&&(!J||!H)&&!X)return;var w=!0;if(w=w&&!k(O,y.base[0]+1e-5,y.base[1],y.base[2]+1e-5),w=w&&!k(O,y.max[0]-1e-5,y.base[1],y.base[2]+1e-5),w=w&&!k(O,y.base[0]+1e-5,y.base[1],y.max[2]-1e-5),w=w&&!k(O,y.max[0]-1e-5,y.base[1],y.max[2]-1e-5),w)return;d(f.ug,y),f.resting[0]=o[0],f.resting[2]=o[2],f.sl&&f.sl()}(O,f,E,w);for(var q=0;q<3;++q)f.resting[q]=f.resting[q]||B[q],J[q]=0,f.resting[q]&&(X[q]||(J[q]=-f.Jf[q]),f.Jf[q]=0);var j=N.length(J);j>.001&&(N.scale(J,J,f.mass),f.Gk&&f.Gk(J),f.restitution>0&&j>O.minBounceImpulse&&(N.scale(J,J,f.restitution),f.applyImpulse(J)));var x=N.squaredLength(f.Jf);x>1e-5&&f.Nf();O.bk&&O.bk(f)?(f.loadFromCopy(u),f.rolledBackLastTick=!0):f.rolledBackLastTick=!1}(this,y,O,f)))};var p=N.create([0,0,0]);var U=N.create();function l(O,f,y,S,H){var b=y.resting[f],h=S[f];if(!y.alwaysApplyHorizFriction||1!==f){if(0===b)return;if(b*h<=0)return}N.i(x,y.Jf),x[f]=0;var v=N.length(x);if(!c(v,0)){var m=Math.abs(y.friction*O.gravity[f]*H),t=v>m?(v-m)/v:0;y.Jf[(f+1)%3]*=t,y.Jf[(f+2)%3]*=t}}var x=N.create();function W(O,f,y,S,H){return N.set(S,0,0,0),m(O.testSolid,f,y,(function(O,f,y,b){S[f]=y,b[f]=0,H||(b[0]=0,b[1]=0,b[2]=0)}))}var E=new v([],[]),o=N.create(),i=N.create(),D=N.create(),V=N.create();var g=N.create(),R=new v([],[]),s=N.create();function k(O,f,y,S){return O.testSolid(Math.floor(f),Math.floor(y-1),Math.floor(S))}var z=N.create();function c(O,f){return Math.abs(O-f)<1e-5}function d(O,f){for(var y=0;y<3;y++)O.base[y]=f.base[y],O.max[y]=f.max[y],O.Rg[y]=f.Rg[y]}var G=function(O){}},11168:O=>{"use strict";O.exports=function(O,f,y,S){var H=self||window;try{try{var b;try{b=new H.Blob([O])}catch(m){(b=new(H.BlobBuilder||H.WebKitBlobBuilder||H.MozBlobBuilder||H.MSBlobBuilder)).append(O),b=b.getBlob()}var h=H.URL||H.webkitURL,v=h.createObjectURL(b),N=new H[f](v,y);return h.revokeObjectURL(v),N}catch(m){return new H[f]("data:application/javascript,".concat(encodeURIComponent(O)),y)}}catch(m){if(!S)throw Error("Inline worker is not supported");return new H[f](S,y)}}},12150:(O,f,y)=>{"use strict";function S(O,f,y,S,H){var b={};return Object.keys(S).forEach((function(O){b[O]=S[O]})),b.enumerable=!!b.enumerable,b.configurable=!!b.configurable,("value"in b||b.initializer)&&(b.writable=!0),b=y.slice().reverse().reduce((function(y,S){return S(O,f,y)||y}),b),H&&void 0!==b.initializer&&(b.value=b.initializer?b.initializer.call(H):void 0,b.initializer=void 0),void 0===b.initializer&&(Object.defineProperty(O,f,b),b=null),b}y.d(f,{b:()=>S})},12143:(O,f,y)=>{"use strict";function S(O,f,y,S){y&&Object.defineProperty(O,f,{enumerable:y.enumerable,configurable:y.configurable,writable:y.writable,value:y.initializer?y.initializer.call(S):void 0})}y.d(f,{c:()=>S})},12209:(O,f,y)=>{"use strict";y.d(f,{d:()=>j,e:()=>X,g:()=>w,h:()=>F,k:()=>J,l:()=>A,p:()=>I});var S=y(11324),H=y(11359),b=y(11345),h=y(11153),v=y(12215),N=y(11568),m=y(11520),t=y(11037),q=y(11362);const F=Object.freeze(new S.c(0,0,0,0)),I=Object.freeze(S.m.Zero()),A=Object.freeze(S.i.Zero()),J=Object.freeze(m.e.Zero()),X=Object.freeze(H.d.Black()),w=Object.freeze(new H.g(0,0,0,0)),B={key:0,repeatCount:0,loopMode:2};class j{static _PrepareAnimation(O,f,y,b,h,v,N,t){let q;if(!isNaN(parseFloat(h))&&isFinite(h)?q=j.ANIMATIONTYPE_FLOAT:h instanceof S.c?q=j.ANIMATIONTYPE_QUATERNION:h instanceof S.m?q=j.ANIMATIONTYPE_VECTOR3:h instanceof S.i?q=j.ANIMATIONTYPE_VECTOR2:h instanceof H.d?q=j.ANIMATIONTYPE_COLOR3:h instanceof H.g?q=j.ANIMATIONTYPE_COLOR4:h instanceof m.e&&(q=j.ANIMATIONTYPE_SIZE),void 0==q)return null;const F=new j(O,f,y,q,N),I=[{frame:0,value:h},{frame:b,value:v}];return F.setKeys(I),void 0!==t&&F.setEasingFunction(t),F}static CreateAnimation(O,f,y,S){const H=new j(O+"Animation",O,y,f,j.ANIMATIONLOOPMODE_CONSTANT);return H.setEasingFunction(S),H}static CreateAndStartAnimation(O,f,y,S,H,b,h,v,N,m,t){const q=j._PrepareAnimation(O,y,S,H,b,h,v,N);return q?(f.va&&(t=f.va()),t?t.beginDirectAnimation(f,[q],0,H,1===q.loopMode,1,m):null):null}static CreateAndStartHierarchyAnimation(O,f,y,S,H,b,h,v,N,m,t){const q=j._PrepareAnimation(O,S,H,b,h,v,N,m);if(!q)return null;return f.va().beginDirectHierarchyAnimation(f,y,[q],0,b,1===q.loopMode,1,t)}static CreateMergeAndStartAnimation(O,f,y,S,H,b,h,v,N,m){const t=j._PrepareAnimation(O,y,S,H,b,h,v,N);return t?(f.animations.push(t),f.va().beginAnimation(f,0,H,1===t.loopMode,1,m)):null}static MakeAnimationAdditive(O,f,y){let H;H="object"===typeof f?f:{referenceFrame:f??0,range:y,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let b=O;if(H.cloneOriginalAnimation&&(b=O.clone(),b.name=H.clonedAnimationName||b.name),!b._keys.length)return b;const h=H.referenceFrame&&H.referenceFrame>=0?H.referenceFrame:0;let v=0;const N=b._keys[0];let m=b._keys.length-1;const t=b._keys[m],q={referenceValue:N.value,referencePosition:S.g.fb[0],referenceQuaternion:S.g.Quaternion[0],referenceScaling:S.g.fb[1],keyPosition:S.g.fb[2],keyQuaternion:S.g.Quaternion[1],keyScaling:S.g.fb[3]};let F=N.frame,I=t.frame;if(H.range){const O=b.getRange(H.range);O&&(F=O.from,I=O.to)}else F=H.fromFrame??F,I=H.toFrame??I;if(F!==N.frame&&(v=b.createKeyForFrame(F)),I!==t.frame&&(m=b.createKeyForFrame(I)),1===b._keys.length){const O=b._getKeyValue(b._keys[0]);q.referenceValue=O.clone?O.clone():O}else if(h<=N.frame){const O=b._getKeyValue(N.value);q.referenceValue=O.clone?O.clone():O}else if(h>=t.frame){const O=b._getKeyValue(t.value);q.referenceValue=O.clone?O.clone():O}else{B.key=0;const O=b._interpolate(h,B);q.referenceValue=O.clone?O.clone():O}b.dataType===j.ANIMATIONTYPE_QUATERNION?q.referenceValue.normalize().conjugateInPlace():b.dataType===j.ANIMATIONTYPE_MATRIX&&(q.referenceValue.decompose(q.referenceScaling,q.referenceQuaternion,q.referencePosition),q.referenceQuaternion.normalize().conjugateInPlace());let A=Number.MAX_VALUE;const J=H.clipKeys?[]:null;for(let X=v;X<=m;X++){let O=b._keys[X];if((J||H.cloneOriginalAnimation)&&(O={frame:O.frame,value:O.value.clone?O.value.clone():O.value,inTangent:O.inTangent,outTangent:O.outTangent,interpolation:O.interpolation,lockedTangent:O.lockedTangent},J&&(A===Number.MAX_VALUE&&(A=O.frame),O.frame-=A,J.push(O))),!X||b.dataType===j.ANIMATIONTYPE_FLOAT||O.value!==N.value)switch(b.dataType){case j.ANIMATIONTYPE_MATRIX:O.value.decompose(q.keyScaling,q.keyQuaternion,q.keyPosition),q.keyPosition.ni(q.referencePosition),q.keyScaling.divideInPlace(q.referenceScaling),q.referenceQuaternion.multiplyToRef(q.keyQuaternion,q.keyQuaternion),S.b.ComposeToRef(q.keyScaling,q.keyQuaternion,q.keyPosition,O.value);break;case j.ANIMATIONTYPE_QUATERNION:q.referenceValue.multiplyToRef(O.value,O.value);break;case j.ANIMATIONTYPE_VECTOR2:case j.ANIMATIONTYPE_VECTOR3:case j.ANIMATIONTYPE_COLOR3:case j.ANIMATIONTYPE_COLOR4:O.value.subtractToRef(q.referenceValue,O.value);break;case j.ANIMATIONTYPE_SIZE:O.value.width-=q.referenceValue.width,O.value.height-=q.referenceValue.height;break;default:O.value-=q.referenceValue}}return J&&b.setKeys(J,!0),b}static TransitionTo(O,f,y,S,H,b,h){let v=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(h<=0)return y[O]=f,v&&v(),null;const N=H*(h/1e3);b.setKeys([{frame:0,value:y[O].clone?y[O].clone():y[O]},{frame:N,value:f}]),y.animations||(y.animations=[]),y.animations.push(b);const m=S.beginAnimation(y,0,N,!1);return m.onAnimationEnd=v,m}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const O of this._runtimeAnimations)if(!O.isStopped())return!0;return!1}constructor(O,f,y,S,H,b){this.name=O,this.targetProperty=f,this.framePerSecond=y,this.dataType=S,this.loopMode=H,this.enableBlending=b,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=f.split("."),this.dataType=S,this.loopMode=void 0===H?j.ANIMATIONLOOPMODE_CYCLE:H,this.uniqueId=j._UniqueIdGenerator++}toString(O){let f="Name: "+this.name+", property: "+this.targetProperty;if(f+=", datatype: "+["Float","fb","Quaternion","Matrix","gb","Vector2"][this.dataType],f+=", nKeys: "+(this._keys?this._keys.length:"none"),f+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),O){f+=", Ranges: {";let O=!0;for(const y in this._ranges)O&&(f+=", ",O=!1),f+=y;f+="}"}return f}addEvent(O){this._events.push(O),this._events.sort(((O,f)=>O.frame-f.frame))}removeEvents(O){for(let f=0;f<this._events.length;f++)this._events[f].frame===O&&(this._events.splice(f,1),f--)}getEvents(){return this._events}createRange(O,f,y){this._ranges[O]||(this._ranges[O]=new v.b(O,f,y))}deleteRange(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const y=this._ranges[O];if(y){if(f){const O=y.from,f=y.to;for(let y=this._keys.length-1;y>=0;y--)this._keys[y].frame>=O&&this._keys[y].frame<=f&&this._keys.splice(y,1)}this._ranges[O]=null}}getRange(O){return this._ranges[O]}getKeys(){return this._keys}getHighestFrame(){let O=0;for(let f=0,y=this._keys.length;f<y;f++)O<this._keys[f].frame&&(O=this._keys[f].frame);return O}getEasingFunction(){return this._easingFunction}setEasingFunction(O){this._easingFunction=O}floatInterpolateFunction(O,f,y){return(0,b.o)(O,f,y)}floatInterpolateFunctionWithTangents(O,f,y,S,H){return(0,b.f)(O,f,y,S,H)}quaternionInterpolateFunction(O,f,y){return S.c.Slerp(O,f,y)}quaternionInterpolateFunctionWithTangents(O,f,y,H,b){return S.c.Hermite(O,f,y,H,b).normalize()}vector3InterpolateFunction(O,f,y){return S.m.Lerp(O,f,y)}vector3InterpolateFunctionWithTangents(O,f,y,H,b){return S.m.Hermite(O,f,y,H,b)}vector2InterpolateFunction(O,f,y){return S.i.Lerp(O,f,y)}vector2InterpolateFunctionWithTangents(O,f,y,H,b){return S.i.Hermite(O,f,y,H,b)}sizeInterpolateFunction(O,f,y){return m.e.Lerp(O,f,y)}color3InterpolateFunction(O,f,y){return H.d.Lerp(O,f,y)}color3InterpolateFunctionWithTangents(O,f,y,S,b){return H.d.Hermite(O,f,y,S,b)}color4InterpolateFunction(O,f,y){return H.g.Lerp(O,f,y)}color4InterpolateFunctionWithTangents(O,f,y,S,b){return H.g.Hermite(O,f,y,S,b)}_getKeyValue(O){return"function"===typeof O?O():O}evaluate(O){return B.key=0,this._interpolate(O,B)}_interpolate(O,f){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(f.loopMode===j.ANIMATIONLOOPMODE_CONSTANT&&f.repeatCount>0)return f.highLimitValue.clone?f.highLimitValue.clone():f.highLimitValue;const S=this._keys,H=S.length;let b=f.key;for(;b>=0&&O<S[b].frame;)--b;for(;b+1<=H-1&&O>=S[b+1].frame;)++b;if(f.key=b,b<0)return y?void 0:this._getKeyValue(S[0].value);if(b+1>H-1)return y?void 0:this._getKeyValue(S[H-1].value);const h=S[b],v=S[b+1];if(y&&(O===h.frame||O===v.frame))return;const N=this._getKeyValue(h.value),m=this._getKeyValue(v.value);if(1===h.interpolation)return v.frame>O?N:m;const t=void 0!==h.outTangent&&void 0!==v.inTangent,q=v.frame-h.frame;let B=(O-h.frame)/q;const u=h.easingFunction||this.getEasingFunction();switch(null!==u&&(B=u.ease(B)),this.dataType){case j.ANIMATIONTYPE_FLOAT:{const O=t?this.floatInterpolateFunctionWithTangents(N,h.outTangent*q,m,v.inTangent*q,B):this.floatInterpolateFunction(N,m,B);switch(f.loopMode){case j.ANIMATIONLOOPMODE_CYCLE:case j.ANIMATIONLOOPMODE_CONSTANT:case j.ANIMATIONLOOPMODE_YOYO:return O;case j.ANIMATIONLOOPMODE_RELATIVE:case j.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(f.offsetValue??0)*f.repeatCount+O}break}case j.ANIMATIONTYPE_QUATERNION:{const O=t?this.quaternionInterpolateFunctionWithTangents(N,h.outTangent.scale(q),m,v.inTangent.scale(q),B):this.quaternionInterpolateFunction(N,m,B);switch(f.loopMode){case j.ANIMATIONLOOPMODE_CYCLE:case j.ANIMATIONLOOPMODE_CONSTANT:case j.ANIMATIONLOOPMODE_YOYO:return O;case j.ANIMATIONLOOPMODE_RELATIVE:case j.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return O.addInPlace((f.offsetValue||F).scale(f.repeatCount))}return O}case j.ANIMATIONTYPE_VECTOR3:{const O=t?this.vector3InterpolateFunctionWithTangents(N,h.outTangent.scale(q),m,v.inTangent.scale(q),B):this.vector3InterpolateFunction(N,m,B);switch(f.loopMode){case j.ANIMATIONLOOPMODE_CYCLE:case j.ANIMATIONLOOPMODE_CONSTANT:case j.ANIMATIONLOOPMODE_YOYO:return O;case j.ANIMATIONLOOPMODE_RELATIVE:case j.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return O.add((f.offsetValue||I).scale(f.repeatCount))}break}case j.ANIMATIONTYPE_VECTOR2:{const O=t?this.vector2InterpolateFunctionWithTangents(N,h.outTangent.scale(q),m,v.inTangent.scale(q),B):this.vector2InterpolateFunction(N,m,B);switch(f.loopMode){case j.ANIMATIONLOOPMODE_CYCLE:case j.ANIMATIONLOOPMODE_CONSTANT:case j.ANIMATIONLOOPMODE_YOYO:return O;case j.ANIMATIONLOOPMODE_RELATIVE:case j.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return O.add((f.offsetValue||A).scale(f.repeatCount))}break}case j.ANIMATIONTYPE_SIZE:switch(f.loopMode){case j.ANIMATIONLOOPMODE_CYCLE:case j.ANIMATIONLOOPMODE_CONSTANT:case j.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(N,m,B);case j.ANIMATIONLOOPMODE_RELATIVE:case j.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(N,m,B).add((f.offsetValue||J).scale(f.repeatCount))}break;case j.ANIMATIONTYPE_COLOR3:{const O=t?this.color3InterpolateFunctionWithTangents(N,h.outTangent.scale(q),m,v.inTangent.scale(q),B):this.color3InterpolateFunction(N,m,B);switch(f.loopMode){case j.ANIMATIONLOOPMODE_CYCLE:case j.ANIMATIONLOOPMODE_CONSTANT:case j.ANIMATIONLOOPMODE_YOYO:return O;case j.ANIMATIONLOOPMODE_RELATIVE:case j.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return O.add((f.offsetValue||X).scale(f.repeatCount))}break}case j.ANIMATIONTYPE_COLOR4:{const O=t?this.color4InterpolateFunctionWithTangents(N,h.outTangent.scale(q),m,v.inTangent.scale(q),B):this.color4InterpolateFunction(N,m,B);switch(f.loopMode){case j.ANIMATIONLOOPMODE_CYCLE:case j.ANIMATIONLOOPMODE_CONSTANT:case j.ANIMATIONLOOPMODE_YOYO:return O;case j.ANIMATIONLOOPMODE_RELATIVE:case j.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return O.add((f.offsetValue||w).scale(f.repeatCount))}break}case j.ANIMATIONTYPE_MATRIX:switch(f.loopMode){case j.ANIMATIONLOOPMODE_CYCLE:case j.ANIMATIONLOOPMODE_CONSTANT:case j.ANIMATIONLOOPMODE_YOYO:return j.AllowMatricesInterpolation?this.matrixInterpolateFunction(N,m,B,f.workValue):N;case j.ANIMATIONLOOPMODE_RELATIVE:case j.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return N}}return 0}matrixInterpolateFunction(O,f,y,H){return j.AllowMatrixDecomposeForInterpolation?H?(S.b.DecomposeLerpToRef(O,f,y,H),H):S.b.DecomposeLerp(O,f,y):H?(S.b.LerpToRef(O,f,y,H),H):S.b.Lerp(O,f,y)}clone(){const O=new j(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(O.enableBlending=this.enableBlending,O.blendingSpeed=this.blendingSpeed,this._keys&&O.setKeys(this._keys),this._ranges){O._ranges={};for(const f in this._ranges){const y=this._ranges[f];y&&(O._ranges[f]=y.clone())}}return O}setKeys(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=f?O:O.slice(0)}createKeyForFrame(O){B.key=0;const f=this._interpolate(O,B,!0);if(!f)return this._keys[B.key].frame===O?B.key:B.key+1;const y={frame:O,value:f.clone?f.clone():f};return this._keys.splice(B.key+1,0,y),B.key+1}serialize(){const O={};O.name=this.name,O.property=this.targetProperty,O.framePerSecond=this.framePerSecond,O.dataType=this.dataType,O.loopBehavior=this.loopMode,O.enableBlending=this.enableBlending,O.blendingSpeed=this.blendingSpeed;const f=this.dataType;O.keys=[];const y=this.getKeys();for(let S=0;S<y.length;S++){const H=y[S],b={};switch(b.frame=H.frame,f){case j.ANIMATIONTYPE_FLOAT:b.values=[H.value],void 0!==H.inTangent&&b.values.push(H.inTangent),void 0!==H.outTangent&&(void 0===H.inTangent&&b.values.push(void 0),b.values.push(H.outTangent)),void 0!==H.interpolation&&(void 0===H.inTangent&&b.values.push(void 0),void 0===H.outTangent&&b.values.push(void 0),b.values.push(H.interpolation));break;case j.ANIMATIONTYPE_QUATERNION:case j.ANIMATIONTYPE_MATRIX:case j.ANIMATIONTYPE_VECTOR3:case j.ANIMATIONTYPE_COLOR3:case j.ANIMATIONTYPE_COLOR4:b.values=H.value.gj(),void 0!=H.inTangent&&b.values.push(H.inTangent.gj()),void 0!=H.outTangent&&(void 0===H.inTangent&&b.values.push(void 0),b.values.push(H.outTangent.gj())),void 0!==H.interpolation&&(void 0===H.inTangent&&b.values.push(void 0),void 0===H.outTangent&&b.values.push(void 0),b.values.push(H.interpolation))}O.keys.push(b)}O.ranges=[];for(const S in this._ranges){const f=this._ranges[S];if(!f)continue;const y={};y.name=S,y.from=f.from,y.to=f.to,O.ranges.push(y)}return O}static _UniversalLerp(O,f,y){const S=O.constructor;return S.Lerp?S.Lerp(O,f,y):S.Slerp?S.Slerp(O,f,y):O.toFixed?O*(1-y)+y*f:f}static Parse(O){const f=new j(O.name,O.property,O.framePerSecond,O.dataType,O.loopBehavior),y=O.dataType,b=[];let h,v;for(O.enableBlending&&(f.enableBlending=O.enableBlending),O.blendingSpeed&&(f.blendingSpeed=O.blendingSpeed),v=0;v<O.keys.length;v++){const f=O.keys[v];let N,m,t;switch(y){case j.ANIMATIONTYPE_FLOAT:h=f.values[0],f.values.length>=2&&(N=f.values[1]),f.values.length>=3&&(m=f.values[2]),f.values.length>=4&&(t=f.values[3]);break;case j.ANIMATIONTYPE_QUATERNION:if(h=S.c.Ng(f.values),f.values.length>=8){const O=S.c.Ng(f.values.slice(4,8));O.equals(S.c.Zero())||(N=O)}if(f.values.length>=12){const O=S.c.Ng(f.values.slice(8,12));O.equals(S.c.Zero())||(m=O)}f.values.length>=13&&(t=f.values[12]);break;case j.ANIMATIONTYPE_MATRIX:h=S.b.Ng(f.values),f.values.length>=17&&(t=f.values[16]);break;case j.ANIMATIONTYPE_COLOR3:h=H.d.Ng(f.values),f.values[3]&&(N=H.d.Ng(f.values[3])),f.values[4]&&(m=H.d.Ng(f.values[4])),f.values[5]&&(t=f.values[5]);break;case j.ANIMATIONTYPE_COLOR4:h=H.g.Ng(f.values),f.values[4]&&(N=H.g.Ng(f.values[4])),f.values[5]&&(m=H.g.Ng(f.values[5])),f.values[6]&&(t=H.g.Ng(f.values[6]));break;case j.ANIMATIONTYPE_VECTOR3:default:h=S.m.Ng(f.values),f.values[3]&&(N=S.m.Ng(f.values[3])),f.values[4]&&(m=S.m.Ng(f.values[4])),f.values[5]&&(t=f.values[5])}const q={};q.frame=f.frame,q.value=h,void 0!=N&&(q.inTangent=N),void 0!=m&&(q.outTangent=m),void 0!=t&&(q.interpolation=t),b.push(q)}if(f.setKeys(b),O.ranges)for(v=0;v<O.ranges.length;v++)h=O.ranges[v],f.createRange(h.name,h.from,h.to);return f}static AppendSerializedAnimations(O,f){q.b.AppendSerializedAnimations(O,f)}static ParseFromFileAsync(O,f){return new Promise(((y,S)=>{const H=new t.e;H.addEventListener("readystatechange",(()=>{if(4==H.readyState)if(200==H.status){let f=JSON.parse(H.responseText);if(f.animations&&(f=f.animations),f.length){const O=[];for(const y of f)O.push(this.Parse(y));y(O)}else{const S=this.Parse(f);O&&(S.name=O),y(S)}}else S("Unable to load the animation")})),H.open("GET",f),H.send()}))}static ParseFromSnippetAsync(O){return new Promise(((f,y)=>{const S=new t.e;S.addEventListener("readystatechange",(()=>{if(4==S.readyState)if(200==S.status){const y=JSON.parse(JSON.parse(S.responseText).jsonPayload);if(y.animations){const S=JSON.parse(y.animations),H=[];for(const f of S.animations){const y=this.Parse(f);y.snippetId=O,H.push(y)}f(H)}else{const S=JSON.parse(y.animation),H=this.Parse(S);H.snippetId=O,f(H)}}else y("Unable to load the snippet "+O)})),S.open("GET",this.SnippetUrl+"/"+O.replace(/#/g,"/")),S.send()}))}}j._UniqueIdGenerator=0,j.AllowMatricesInterpolation=!1,j.AllowMatrixDecomposeForInterpolation=!0,j.SnippetUrl="https://snippet.babylonjs.com",j.ANIMATIONTYPE_FLOAT=0,j.ANIMATIONTYPE_VECTOR3=1,j.ANIMATIONTYPE_QUATERNION=2,j.ANIMATIONTYPE_MATRIX=3,j.ANIMATIONTYPE_COLOR3=4,j.ANIMATIONTYPE_COLOR4=7,j.ANIMATIONTYPE_VECTOR2=5,j.ANIMATIONTYPE_SIZE=6,j.ANIMATIONLOOPMODE_RELATIVE=0,j.ANIMATIONLOOPMODE_CYCLE=1,j.ANIMATIONLOOPMODE_CONSTANT=2,j.ANIMATIONLOOPMODE_YOYO=4,j.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,j.CreateFromSnippetAsync=j.ParseFromSnippetAsync,(0,h.g)("BABYLON.Animation",j),N.c._AnimationRangeFactory=(O,f,y)=>new v.b(O,f,y)},12215:(O,f,y)=>{"use strict";y.d(f,{b:()=>S});class S{constructor(O,f,y){this.name=O,this.from=f,this.to=y}clone(){return new S(this.name,this.from,this.to)}}},11831:(O,f,y)=>{"use strict";var S=y(11004),H=y(11017),b=y(11092),h=y(11009);b.c.AudioEngineFactory=(O,f,y)=>new v(O,f,y);class v{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new S.d,this.onAudioLockedObservable=new S.d,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,h.h)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const H=document.createElement("audio");this._hostElement=O,this._audioContext=f,this._audioDestination=y;try{H&&H.canPlayType&&(H.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||H.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(b){}try{H&&H.canPlayType&&H.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(b){}}lock(){this._triggerSuspendedState()}unlock(){var O,f;if("running"===(null===(O=this._audioContext)||void 0===O?void 0:O.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(f=this._audioContext)||void 0===f||f.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningState()})):this._triggerRunningState()}_resumeAudioContextOnStateChange(){var O;null===(O=this._audioContext)||void 0===O||O.addEventListener("statechange",(()=>{var O;this.unlocked&&"running"!==(null===(O=this._audioContext)||void 0===O?void 0:O.state)&&this._resumeAudioContext()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContext(){var O;return null!==(O=this._audioContext)&&void 0!==O&&O.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningState())}catch(O){this.canUseWebAudio=!1,H.e.Error("Web Audio: "+O.message)}}_triggerRunningState(){this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then((()=>{this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)})).catch((()=>{this._tryToRun=!1,this.unlocked=!1})))}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const O=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",f=document.createElement("style");f.appendChild(document.createTextNode(O)),document.getElementsByTagName("head")[0].appendChild(f),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningState()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(O){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=O)}connectToAnalyser(O){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=O,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}},12207:(O,f,y)=>{"use strict";y.d(f,{b:()=>h});var S=y(11324),H=y(11338),b=y(11568);class h extends b.c{get _matrix(){return this._compose(),this.Oj}set _matrix(O){(O.updateFlag!==this.Oj.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Oj.p(O),this._markAsDirtyAndDecompose())}constructor(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(O,f.va(),!1),this.name=O,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=f,this.Oj=(null===H||void 0===H?void 0:H.clone())??S.b.Identity(),this._restMatrix=b??this.Oj.clone(),this._bindMatrix=h??this.Oj.clone(),this._index=v,this._absoluteMatrix=new S.b,this._absoluteBindMatrix=new S.b,this._absoluteInverseBindMatrix=new S.b,this._finalMatrix=new S.b,f.bones.push(this),this.setParent(y,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(O){this.setParent(O)}setParent(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==O){if(this.parent){const O=this.parent.children.indexOf(this);-1!==O&&this.parent.children.splice(O,1)}this._parentNode=O,this.parent&&this.parent.children.push(this),f&&this._updateAbsoluteBindMatrices(),this.Dg()}}getLocalMatrix(){return this._compose(),this.Oj}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(O){this._restMatrix.p(O)}setRestPose(O){this.setRestMatrix(O)}getBindPose(){return this.getBindMatrix()}setBindMatrix(O){this.Fj(O)}setBindPose(O){this.setBindMatrix(O)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const O=S.g.fb[0],f=S.g.Quaternion[0],y=S.g.fb[1];this.getRestMatrix().decompose(O,f,y),this._linkedTransformNode.position.p(y),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??S.c.Identity(),this._linkedTransformNode.rotationQuaternion.p(f),this._linkedTransformNode.Yd.p(O)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(O){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=O,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Td}set position(O){this._decompose(),this.Td.p(O),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(O){this.setRotation(O)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(O){this.setRotationQuaternion(O)}get Yd(){return this.getScale()}set Yd(O){this.setScale(O)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=S.m.Zero(),this._localRotation=S.c.Zero(),this.Td=S.m.Zero()),this.Oj.decompose(this._localScaling,this._localRotation,this.Td))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,S.b.ComposeToRef(this._localScaling,this._localRotation,this.Td,this.Oj)):this._needToCompose=!1)}Fj(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(O),f&&this._updateAbsoluteBindMatrices(),y?this._matrix=O:this.Dg()}_updateAbsoluteBindMatrices(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(O||(O=this._bindMatrix),this.parent?O.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(O),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),f)for(let y=0;y<this.children.length;y++)this.children[y]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Dg(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Dg(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Dg(),this._needToDecompose=!0}_updatePosition(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0,H=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const b=this.getLocalMatrix();if(0==f)H?(b.addAtIndex(12,O.x),b.addAtIndex(13,O.y),b.addAtIndex(14,O.z)):b.setTranslationFromFloats(O.x,O.y,O.z);else{let f=null;y&&(f=y.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const v=h._TmpMats[0],N=h._TmpVecs[0];this.parent?y&&f?(v.p(this.parent.getAbsoluteMatrix()),v.multiplyToRef(f,v)):v.p(this.parent.getAbsoluteMatrix()):S.b.IdentityToRef(v),H&&v.setTranslationFromFloats(0,0,0),v.invert(),S.m.TransformCoordinatesToRef(O,v,N),H?(b.addAtIndex(12,N.x),b.addAtIndex(13,N.y),b.addAtIndex(14,N.z)):b.setTranslationFromFloats(N.x,N.y,N.z)}this._markAsDirtyAndDecompose()}translate(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0;this._updatePosition(O,f,y,!0)}setPosition(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0;this._updatePosition(O,f,y,!1)}setAbsolutePosition(O,f){this.setPosition(O,1,f)}scale(O,f,y){let H=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const b=this.getLocalMatrix(),v=h._TmpMats[0];S.b.ScalingToRef(O,f,y,v),v.multiplyToRef(b,b),v.invert();for(const S of this.children){const H=S.getLocalMatrix();H.multiplyToRef(v,H),H.multiplyAtIndex(12,O),H.multiplyAtIndex(13,f),H.multiplyAtIndex(14,y),S._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),H)for(const S of this.children)S.scale(O,f,y,H)}setScale(O){this._decompose(),this._localScaling.p(O),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(O){this._decompose(),O.p(this._localScaling)}setYawPitchRoll(O,f,y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,b=arguments.length>4?arguments[4]:void 0;if(0===H){const v=h._TmpQuat;return S.c.RotationYawPitchRollToRef(O,f,y,v),void this.setRotationQuaternion(v,H,b)}const v=h._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(v,b))return;const N=h._TmpMats[1];S.b.RotationYawPitchRollToRef(O,f,y,N),v.multiplyToRef(N,N),this._rotateWithMatrix(N,H,b)}rotate(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,H=arguments.length>3?arguments[3]:void 0;const b=h._TmpMats[0];b.setTranslationFromFloats(0,0,0),S.b.RotationAxisToRef(O,f,b),this._rotateWithMatrix(b,y,H)}setAxisAngle(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,H=arguments.length>3?arguments[3]:void 0;if(0===y){const b=h._TmpQuat;return S.c.RotationAxisToRef(O,f,b),void this.setRotationQuaternion(b,y,H)}const b=h._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(b,H))return;const v=h._TmpMats[1];S.b.RotationAxisToRef(O,f,v),b.multiplyToRef(v,v),this._rotateWithMatrix(v,y,H)}setRotation(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(O.y,O.x,O.z,f,y)}setRotationQuaternion(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0;if(0===f)return this._decompose(),this._localRotation.p(O),void this._markAsDirtyAndCompose();const H=h._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(H,y))return;const b=h._TmpMats[1];S.b.FromQuaternionToRef(O,b),H.multiplyToRef(b,b),this._rotateWithMatrix(b,f,y)}setRotationMatrix(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0;if(0===f){const H=h._TmpQuat;return S.c.FromRotationMatrixToRef(O,H),void this.setRotationQuaternion(H,f,y)}const H=h._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(H,y))return;const b=h._TmpMats[1];b.p(O),H.multiplyToRef(O,b),this._rotateWithMatrix(b,f,y)}_rotateWithMatrix(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0;const S=this.getLocalMatrix(),H=S.m[12],b=S.m[13],v=S.m[14],N=this.getParent(),m=h._TmpMats[3],t=h._TmpMats[4];N&&1==f?(y?(m.p(y.getWorldMatrix()),N.getAbsoluteMatrix().multiplyToRef(m,m)):m.p(N.getAbsoluteMatrix()),t.p(m),t.invert(),S.multiplyToRef(m,S),S.multiplyToRef(O,S),S.multiplyToRef(t,S)):1==f&&y?(m.p(y.getWorldMatrix()),t.p(m),t.invert(),S.multiplyToRef(m,S),S.multiplyToRef(O,S),S.multiplyToRef(t,S)):S.multiplyToRef(O,S),S.setTranslationFromFloats(H,b,v),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(O,f){const y=h._TmpMats[2];return O.p(this.getAbsoluteMatrix()),f?(O.multiplyToRef(f.getWorldMatrix(),O),S.b.ScalingToRef(f.Yd.x,f.Yd.y,f.Yd.z,y)):S.b.IdentityToRef(y),O.invert(),!isNaN(O.m[0])&&(y.multiplyAtIndex(0,this._scalingDeterminant),O.multiplyToRef(y,O),!0)}cb(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const y=S.m.Zero();return this.getPositionToRef(O,f,y),y}getPositionToRef(){let O=arguments.length>1?arguments[1]:void 0,f=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const O=this.getLocalMatrix();f.x=O.m[12],f.y=O.m[13],f.z=O.m[14]}else{let y=null;O&&(y=O.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let S=h._TmpMats[0];O&&y?(S.p(this.getAbsoluteMatrix()),S.multiplyToRef(y,S)):S=this.getAbsoluteMatrix(),f.x=S.m[12],f.y=S.m[13],f.z=S.m[14]}}getAbsolutePosition(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const f=S.m.Zero();return this.getPositionToRef(1,O,f),f}getAbsolutePositionToRef(O,f){this.getPositionToRef(1,O,f)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Oj.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.Oj);const O=this._skeleton.getPoseMatrix();O&&this._absoluteMatrix.multiplyToRef(O,this._absoluteMatrix)}const O=this.children,f=O.length;for(let y=0;y<f;y++)O[y].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Oe(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const y=S.m.Zero();return this.getDirectionToRef(O,f,y),y}getDirectionToRef(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2?arguments[2]:void 0,H=null;f&&(H=f.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const b=h._TmpMats[0];b.p(this.getAbsoluteMatrix()),f&&H&&b.multiplyToRef(H,b),S.m.TransformNormalToRef(O,b,y),y.normalize()}getRotation(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const y=S.m.Zero();return this.getRotationToRef(O,f,y),y}getRotationToRef(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2?arguments[2]:void 0;const S=h._TmpQuat;this.getRotationQuaternionToRef(O,f,S),S.toEulerAnglesToRef(y)}getRotationQuaternion(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const y=S.c.Identity();return this.getRotationQuaternionToRef(O,f,y),y}getRotationQuaternionToRef(){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),f.p(this._localRotation);else{const y=h._TmpMats[0],S=this.getAbsoluteMatrix();O?S.multiplyToRef(O.getWorldMatrix(),y):y.p(S),y.multiplyAtIndex(0,this._scalingDeterminant),y.multiplyAtIndex(1,this._scalingDeterminant),y.multiplyAtIndex(2,this._scalingDeterminant),y.decompose(void 0,f,void 0)}}getRotationMatrix(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1?arguments[1]:void 0;const y=S.b.Identity();return this.getRotationMatrixToRef(O,f,y),y}getRotationMatrixToRef(){let O=arguments.length>1?arguments[1]:void 0,f=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(f);else{const y=h._TmpMats[0],S=this.getAbsoluteMatrix();O?S.multiplyToRef(O.getWorldMatrix(),y):y.p(S),y.multiplyAtIndex(0,this._scalingDeterminant),y.multiplyAtIndex(1,this._scalingDeterminant),y.multiplyAtIndex(2,this._scalingDeterminant),y.getRotationMatrixToRef(f)}}getAbsolutePositionFromLocal(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const y=S.m.Zero();return this.getAbsolutePositionFromLocalToRef(O,f,y),y}getAbsolutePositionFromLocalToRef(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2?arguments[2]:void 0,H=null;f&&(H=f.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const b=h._TmpMats[0];b.p(this.getAbsoluteMatrix()),f&&H&&b.multiplyToRef(H,b),S.m.TransformCoordinatesToRef(O,b,y)}getLocalPositionFromAbsolute(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const y=S.m.Zero();return this.getLocalPositionFromAbsoluteToRef(O,f,y),y}getLocalPositionFromAbsoluteToRef(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2?arguments[2]:void 0,H=null;f&&(H=f.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const b=h._TmpMats[0];b.p(this.getAbsoluteMatrix()),f&&H&&b.multiplyToRef(H,b),b.invert(),S.m.TransformCoordinatesToRef(O,b,y)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}}h._TmpVecs=(0,H.d)(2,S.m.Zero),h._TmpQuat=S.c.Identity(),h._TmpMats=(0,H.d)(5,S.b.Identity)},11392:(O,f,y)=>{"use strict";y.d(f,{d:()=>b,f:()=>h});var S=y(11394),H=y(11017);class b{get u(){return this._isDisposed}constructor(O,f,y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,b=arguments.length>4&&void 0!==arguments[4]&&arguments[4],h=arguments.length>5&&void 0!==arguments[5]&&arguments[5],v=arguments.length>6&&void 0!==arguments[6]&&arguments[6],N=arguments.length>7?arguments[7]:void 0,m=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,O&&O.va?this._engine=O.va().getEngine():this._engine=O,this._updatable=y,this._instanced=h,this._divisor=N||1,this._label=m,f instanceof S.c?(this._data=null,this._buffer=f):(this._data=f,this._buffer=null),this.byteStride=v?H:H*Float32Array.BYTES_PER_ELEMENT,b||this.create()}createVertexBuffer(O,f,y,S,H){let b=arguments.length>5&&void 0!==arguments[5]&&arguments[5],v=arguments.length>6?arguments[6]:void 0;const N=b?f:f*Float32Array.BYTES_PER_ELEMENT,m=S?b?S:S*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new h(this._engine,this,O,this._updatable,!0,m,void 0===H?this._instanced:H,N,y,void 0,void 0,!0,this._divisor||v)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!O&&this._buffer||(O=O||this._data,O&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,O),this._data=O):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(O,this._label),this._data=O):this._buffer=this._engine.createVertexBuffer(O,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.kb>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.kb,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.kb,void 0,this._label));H.e.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(O){this.create(O)}updateDirectly(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,O,S?f:f*Float32Array.BYTES_PER_ELEMENT,y?y*this.byteStride:void 0),this._data=0===f&&void 0===y?O:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class h{get u(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(O){const f=0!=O;this._instanceDivisor=O,f!==this._instanced&&(this._instanced=f,this._computeHashCode())}get _maxVerticesCount(){const O=this.getData();return O?Array.isArray(O)?O.length/(this.byteStride/4)-this.byteOffset/4:(O.byteLength-this.byteOffset)/this.byteStride:0}constructor(O,f,y,S,H,v,N,m,t,q){let F=arguments.length>10&&void 0!==arguments[10]&&arguments[10],I=arguments.length>11&&void 0!==arguments[11]&&arguments[11],A=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,J=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let X=!1;if(this.ad=O,"object"===typeof S&&null!==S?(X=S.updatable??!1,H=S.postponeInternalCreation,v=S.stride,N=S.instanced,m=S.offset,t=S.size,q=S.type,F=S.normalized??!1,I=S.useBytes??!1,A=S.divisor??1,J=S.takeBufferOwnership??!1,this._label=S.label):X=!!S,f instanceof b?(this._buffer=f,this._ownsBuffer=J):(this._buffer=new b(O,f,X,v,H,N,I,A,this._label),this._ownsBuffer=!0),this.uniqueId=h._Counter++,this._kind=y,void 0===q){const O=this.getData();this.type=O?h.GetDataType(O):h.FLOAT}else this.type=q;const w=h.GetTypeByteLength(this.type);I?(this._size=t||(v?v/w:h.DeduceStride(y)),this.byteStride=v||this._buffer.byteStride||this._size*w,this.byteOffset=m||0):(this._size=t||v||h.DeduceStride(y),this.byteStride=v?v*w:this._buffer.byteStride||this._size*w,this.byteOffset=(m||0)*w),this.normalized=F,this._instanced=void 0!==N&&N,this._instanceDivisor=N?A:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var O;null===(O=this._buffer)||void 0===O||O._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(O,f){const y=this.getData();return y?h.GetFloatData(y,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,O,f):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/h.GetTypeByteLength(this.type)}getOffset(){return this.byteOffset/h.GetTypeByteLength(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*h.GetTypeByteLength(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(O){this._buffer.create(O),this._alignBuffer()}update(O){this._buffer.update(O),this._alignBuffer()}updateDirectly(O,f){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(O,f,void 0,y),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(O,f){h.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,O,this.normalized,f)}_alignBuffer(){}static DeduceStride(O){switch(O){case h.UVKind:case h.UV2Kind:case h.UV3Kind:case h.UV4Kind:case h.UV5Kind:case h.UV6Kind:return 2;case h.NormalKind:case h.PositionKind:return 3;case h.ColorKind:case h.ColorInstanceKind:case h.MatricesIndicesKind:case h.MatricesIndicesExtraKind:case h.MatricesWeightsKind:case h.MatricesWeightsExtraKind:case h.TangentKind:return 4;default:throw new Error("Invalid kind '"+O+"'")}}static GetDataType(O){return O instanceof Int8Array?h.BYTE:O instanceof Uint8Array?h.UNSIGNED_BYTE:O instanceof Int16Array?h.SHORT:O instanceof Uint16Array?h.UNSIGNED_SHORT:O instanceof Int32Array?h.INT:O instanceof Uint32Array?h.UNSIGNED_INT:h.FLOAT}static GetTypeByteLength(O){switch(O){case h.BYTE:case h.UNSIGNED_BYTE:return 1;case h.SHORT:case h.UNSIGNED_SHORT:return 2;case h.INT:case h.UNSIGNED_INT:case h.FLOAT:return 4;default:throw new Error(`Invalid type '${O}'`)}}static ForEach(O,f,y,S,H,b,v,N){if(O instanceof Array){let H=f/4;const h=y/4;for(let f=0;f<b;f+=S){for(let y=0;y<S;y++)N(O[H+y],f+y);H+=h}}else{const m=O instanceof ArrayBuffer?new DataView(O):new DataView(O.buffer,O.byteOffset,O.byteLength),t=h.GetTypeByteLength(H);for(let O=0;O<b;O+=S){let b=f;for(let f=0;f<S;f++){N(h._GetFloatValue(m,H,b,v),O+f),b+=t}f+=y}}}static _GetFloatValue(O,f,y,S){switch(f){case h.BYTE:{let f=O.getInt8(y);return S&&(f=Math.max(f/127,-1)),f}case h.UNSIGNED_BYTE:{let f=O.getUint8(y);return S&&(f/=255),f}case h.SHORT:{let f=O.getInt16(y,!0);return S&&(f=Math.max(f/32767,-1)),f}case h.UNSIGNED_SHORT:{let f=O.getUint16(y,!0);return S&&(f/=65535),f}case h.INT:return O.getInt32(y,!0);case h.UNSIGNED_INT:return O.getUint32(y,!0);case h.FLOAT:return O.getFloat32(y,!0);default:throw new Error(`Invalid component type ${f}`)}}static GetFloatData(O,f,y,S,b,v,N,m){const t=f*h.GetTypeByteLength(y),q=N*f;if(y!==h.FLOAT||b!==t){const H=new Float32Array(q);return h.ForEach(O,S,b,f,y,q,v,((O,f)=>H[f]=O)),H}if(!(O instanceof Array||O instanceof Float32Array)||0!==S||O.length!==q){if(O instanceof Array){const f=S/4;return O.slice(f,f+q)}if(O instanceof ArrayBuffer)return new Float32Array(O,S,q);{const f=O.byteOffset+S;if(0!==(3&f)&&(H.e.Warn("Float array must be aligned to 4-bytes border"),m=!0),m){const y=new Uint8Array(q*Float32Array.BYTES_PER_ELEMENT),S=new Uint8Array(O.buffer,f,y.length);return y.set(S),new Float32Array(y.buffer)}return new Float32Array(O.buffer,f,q)}}return m?O.slice():O}}h._Counter=0,h.BYTE=5120,h.UNSIGNED_BYTE=5121,h.SHORT=5122,h.UNSIGNED_SHORT=5123,h.INT=5124,h.UNSIGNED_INT=5125,h.FLOAT=5126,h.PositionKind="position",h.NormalKind="normal",h.TangentKind="tangent",h.UVKind="uv",h.UV2Kind="uv2",h.UV3Kind="uv3",h.UV4Kind="uv4",h.UV5Kind="uv5",h.UV6Kind="uv6",h.ColorKind="color",h.ColorInstanceKind="instanceColor",h.MatricesIndicesKind="matricesIndices",h.MatricesWeightsKind="matricesWeights",h.MatricesIndicesExtraKind="matricesIndicesExtra",h.MatricesWeightsExtraKind="matricesWeightsExtra"},11394:(O,f,y)=>{"use strict";y.d(f,{c:()=>S});class S{get underlyingResource(){return null}constructor(){this.references=0,this.kb=0,this.is32Bits=!1,this.uniqueId=S._Counter++}}S._Counter=0},12631:(O,f,y)=>{"use strict";y.d(f,{e:()=>V});var S=y(11289),H=y(11294),b=y(11004),h=y(11324),v=y(11568),N=y(11557),m=y(11406),t=y(11028),q=y(11330);class F{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(O){this._zoomStopsAnimation=O}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(O){this._idleRotationSpeed=O}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(O){this._idleRotationWaitTime=O}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(O){this._idleRotationSpinupTime=O}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(O){this._attachedCamera=O;const f=this._attachedCamera.va();this._onPrePointerObservableObserver=f.onPrePointerObservable.add((O=>{O.type!==m.b.POINTERDOWN?O.type===m.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=O.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const O=t.b.Now;let f=0;null!=this._lastFrameTime&&(f=O-this._lastFrameTime),this._lastFrameTime=O,this._applyUserInteraction();const y=O-this._lastInteractionTime-this._idleRotationWaitTime,S=Math.max(Math.min(y/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*S,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(f/1e3))}))}detach(){if(!this._attachedCamera)return;const O=this._attachedCamera.va();this._onPrePointerObservableObserver&&O.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(O){this._lastInteractionTime=O??t.b.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<q.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let O=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(O=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?O:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=t.b.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}y(11786);class I{constructor(){this._easingMode=I.EASINGMODE_EASEIN}setEasingMode(O){const f=Math.min(Math.max(O,0),2);this._easingMode=f}getEasingMode(){return this._easingMode}easeInCore(O){throw new Error("You must implement this method")}ease(O){switch(this._easingMode){case I.EASINGMODE_EASEIN:return this.easeInCore(O);case I.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-O)}return O>=.5?.5*(1-this.easeInCore(2*(1-O)))+.5:.5*this.easeInCore(2*O)}}I.EASINGMODE_EASEIN=0,I.EASINGMODE_EASEOUT=1,I.EASINGMODE_EASEINOUT=2;var A=y(12209);class J{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(O){if(this._autoTransitionRange===O)return;this._autoTransitionRange=O;const f=this._attachedCamera;f&&(O?this._onMeshTargetChangedObserver=f.onMeshTargetChangedObservable.add((O=>{if(O&&(O.Mj(!0),O.getBoundingInfo)){const f=O.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*f,this.upperRadiusTransitionRange=.05*f}})):this._onMeshTargetChangedObserver&&f.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(O){this._attachedCamera=O,this._onAfterCheckInputsObserver=O.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(O){return!!this._attachedCamera&&(this._attachedCamera.radius===O&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(O){if(!this._attachedCamera)return;this._radiusBounceTransition||(J.EasingFunction.setEasingMode(J.EasingMode),this._radiusBounceTransition=A.d.CreateAnimation("radius",A.d.ANIMATIONTYPE_FLOAT,60,J.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const f=A.d.TransitionTo("radius",this._attachedCamera.radius+O,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));f&&this._animatables.push(f)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}J.EasingFunction=new class extends I{constructor(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=O}easeInCore(O){const f=Math.max(0,this.amplitude);return Math.pow(O,3)-O*f*Math.sin(3.141592653589793*O)}}(.3),J.EasingMode=I.EASINGMODE_EASEOUT;class X{constructor(){this.onTargetFramingAnimationEndObservable=new b.d,this._mode=X.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(O){this._mode=O}get mode(){return this._mode}set radiusScale(O){this._radiusScale=O}get radiusScale(){return this._radiusScale}set positionScale(O){this._positionScale=O}get positionScale(){return this._positionScale}set defaultElevation(O){this._defaultElevation=O}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(O){this._elevationReturnTime=O}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(O){this._elevationReturnWaitTime=O}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(O){this._zoomStopsAnimation=O}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(O){this._framingTime=O}get framingTime(){return this._framingTime}init(){}attach(O){this._attachedCamera=O;const f=this._attachedCamera.va();X.EasingFunction.setEasingMode(X.EasingMode),this._onPrePointerObservableObserver=f.onPrePointerObservable.add((O=>{O.type!==m.b.POINTERDOWN?O.type===m.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=O.onMeshTargetChangedObservable.add((O=>{O&&O.getBoundingInfo&&this.zoomOnMesh(O,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=O.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const O=this._attachedCamera.va();this._onPrePointerObservableObserver&&O.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;O.Mj(!0);const S=O.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(S.minimumWorld,S.maximumWorld,f,y)}zoomOnMeshHierarchy(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;O.Mj(!0);const S=O.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(S.min,S.max,f,y)}zoomOnMeshesHierarchy(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new h.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),H=new h.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let b=0;b<O.length;b++){const f=O[b].getHierarchyBoundingVectors(!0);h.m.CheckExtends(f.min,S,H),h.m.CheckExtends(f.max,S,H)}this.zoomOnBoundingInfo(S,H,f,y)}zoomOnBoundingInfo(O,f){let y,S=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const b=O.y,v=b+(f.y-b)*this._positionScale,N=f.xc(O).scale(.5);if(S)y=new h.m(0,v,0);else{const f=O.add(N);y=new h.m(f.x,v,f.z)}this._vectorTransition||(this._vectorTransition=A.d.CreateAnimation("target",A.d.ANIMATIONTYPE_VECTOR3,60,X.EasingFunction)),this._betaIsAnimating=!0;let m=A.d.TransitionTo("target",y,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);m&&this._animatables.push(m);let t=0;if(this._mode===X.FitFrustumSidesMode){const y=this._calculateLowerRadiusFromModelBoundingSphere(O,f);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=N.length()+this._attachedCamera.Ui),t=y}else this._mode===X.IgnoreBoundsSizeMode&&(t=this._calculateLowerRadiusFromModelBoundingSphere(O,f),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Ui));if(this.autoCorrectCameraLimitsAndSensibility){const y=f.xc(O).length();this._attachedCamera.panningSensibility=5e3/y,this._attachedCamera.wheelPrecision=100/t}return this._radiusTransition||(this._radiusTransition=A.d.CreateAnimation("radius",A.d.ANIMATIONTYPE_FLOAT,60,X.EasingFunction)),m=A.d.TransitionTo("radius",t,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),H&&H(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),m&&this._animatables.push(m),!0}_calculateLowerRadiusFromModelBoundingSphere(O,f){const y=this._attachedCamera;if(!y)return 0;let S=y._calculateLowerRadiusFromModelBoundingSphere(O,f,this._radiusScale);return y.lowerRadiusLimit&&this._mode===X.IgnoreBoundsSizeMode&&(S=S<y.lowerRadiusLimit?y.lowerRadiusLimit:S),y.upperRadiusLimit&&(S=S>y.upperRadiusLimit?y.upperRadiusLimit:S),S}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const O=t.b.Now-this._lastInteractionTime,f=.5*Math.PI-this._defaultElevation,y=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>y&&O>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=A.d.CreateAnimation("beta",A.d.ANIMATIONTYPE_FLOAT,60,X.EasingFunction));const O=A.d.TransitionTo("beta",f,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));O&&this._animatables.push(O)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=t.b.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}X.EasingFunction=new class extends I{constructor(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=O}easeInCore(O){return this.exponent<=0?O:(Math.exp(this.exponent*O)-1)/(Math.exp(this.exponent)-1)}},X.EasingMode=I.EASINGMODE_EASEINOUT,X.IgnoreBoundsSizeMode=0,X.FitFrustumSidesMode=1;var w=y(11561),B=y(12200),j=y(12205),u=y(10995);class L{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(O){O=u.d.BackCompatCameraNoPreventDefault(arguments);const f=this.camera.getEngine(),y=f.getInputElement();let S=0,H=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=b=>{var h,v;const N=b.event,t="touch"===N.pointerType;if(b.type!==m.b.POINTERMOVE&&-1===this.buttons.indexOf(N.button))return;const q=N.target;if(this._altKey=N.altKey,this._ctrlKey=N.ctrlKey,this._metaKey=N.metaKey,this._shiftKey=N.shiftKey,this._buttonsPressed=N.buttons,f.isPointerLock){const O=N.movementX,f=N.movementY;this.onTouch(null,O,f),this._pointA=null,this._pointB=null}else{if(b.type!==m.b.POINTERDOWN&&b.type!==m.b.POINTERDOUBLETAP&&t&&(null===(h=this._pointA)||void 0===h?void 0:h.pointerId)!==N.pointerId&&(null===(v=this._pointB)||void 0===v?void 0:v.pointerId)!==N.pointerId)return;if(b.type!==m.b.POINTERDOWN||-1!==this._currentActiveButton&&!t)if(b.type===m.b.POINTERDOUBLETAP)this.onDoubleTap(N.pointerType);else if(b.type!==m.b.POINTERUP||this._currentActiveButton!==N.button&&!t){if(b.type===m.b.POINTERMOVE)if(O||N.preventDefault(),this._pointA&&null===this._pointB){const O=N.clientX-this._pointA.x,f=N.clientY-this._pointA.y;this._pointA.x=N.clientX,this._pointA.y=N.clientY,this.onTouch(this._pointA,O,f)}else if(this._pointA&&this._pointB){const O=this._pointA.pointerId===N.pointerId?this._pointA:this._pointB;O.x=N.clientX,O.y=N.clientY;const f=this._pointA.x-this._pointB.x,y=this._pointA.y-this._pointB.y,h=f*f+y*y,v={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:N.pointerId,type:b.type};this.onMultiTouch(this._pointA,this._pointB,S,h,H,v),H=v,S=h}}else{try{null===q||void 0===q||q.releasePointerCapture(N.pointerId)}catch(F){}t||(this._pointB=null),f._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==N.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==N.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==S||H)&&(this.onMultiTouch(this._pointA,this._pointB,S,0,H,null),S=0,H=null),this._currentActiveButton=-1,this.onButtonUp(N),O||N.preventDefault()}else{try{null===q||void 0===q||q.setPointerCapture(N.pointerId)}catch(F){}if(null===this._pointA)this._pointA={x:N.clientX,y:N.clientY,pointerId:N.pointerId,type:N.pointerType};else{if(null!==this._pointB)return;this._pointB={x:N.clientX,y:N.clientY,pointerId:N.pointerId,type:N.pointerType}}-1!==this._currentActiveButton||t||(this._currentActiveButton=N.button),this.onButtonDown(N),O||(N.preventDefault(),y&&y.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,m.b.POINTERDOWN|m.b.POINTERUP|m.b.POINTERMOVE|m.b.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,S=0,H=null,this.onLostFocus()},this._contextMenuBind=O=>this.onContextMenu(O),y&&y.addEventListener("contextmenu",this._contextMenuBind,!1);const b=this.camera.va().getEngine().getHostWindow();b&&u.d.RegisterTopRootEvents(b,[{name:"blur",handler:this._onLostFocus}])}Qi(){if(this._onLostFocus){const O=this.camera.va().getEngine().getHostWindow();O&&u.d.UnregisterTopRootEvents(O,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const O=this.camera.va().getEngine().getInputElement();O&&O.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(O){}onTouch(O,f,y){}onMultiTouch(O,f,y,S,H,b){}onContextMenu(O){O.preventDefault()}onButtonDown(O){}onButtonUp(O){}onLostFocus(){}}(0,S.b)([(0,H.L)()],L.prototype,"buttons",void 0);class p extends L{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(O,f){if(0!==this.panningSensibility&&O&&f){const y=f.x-O.x,S=f.y-O.y;this.camera.inertialPanningX+=-y/this.panningSensibility,this.camera.inertialPanningY+=S/this.panningSensibility}}_computePinchZoom(O,f){const y=this.camera.radius||p.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=y*Math.sqrt(O)/Math.sqrt(f):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(f-O)*y*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(f-O)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(O,f,y){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-f/this.panningSensibility,this.camera.inertialPanningY+=y/this.panningSensibility):(this.camera.inertialAlphaOffset-=f/this.angularSensibilityX,this.camera.inertialBetaOffset-=y/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(O,f,y,S,H,b){0===y&&null===H||0===S&&null===b||(this.multiTouchPanAndZoom?(this._computePinchZoom(y,S),this._computeMultiTouchPanning(H,b)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(S)-Math.sqrt(y))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(y,S),this._isPinching=!0):this._computeMultiTouchPanning(H,b)):this.multiTouchPanning?this._computeMultiTouchPanning(H,b):this.pinchZoom&&this._computePinchZoom(y,S))}onButtonDown(O){this._isPanClick=O.button===this.camera._panningMouseButton}onButtonUp(O){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}p.MinimumRadiusForPinch=.001,(0,S.b)([(0,H.L)()],p.prototype,"buttons",void 0),(0,S.b)([(0,H.L)()],p.prototype,"angularSensibilityX",void 0),(0,S.b)([(0,H.L)()],p.prototype,"angularSensibilityY",void 0),(0,S.b)([(0,H.L)()],p.prototype,"pinchPrecision",void 0),(0,S.b)([(0,H.L)()],p.prototype,"pinchDeltaPercentage",void 0),(0,S.b)([(0,H.L)()],p.prototype,"useNaturalPinchZoom",void 0),(0,S.b)([(0,H.L)()],p.prototype,"pinchZoom",void 0),(0,S.b)([(0,H.L)()],p.prototype,"panningSensibility",void 0),(0,S.b)([(0,H.L)()],p.prototype,"multiTouchPanning",void 0),(0,S.b)([(0,H.L)()],p.prototype,"multiTouchPanAndZoom",void 0),j.b.ArcRotateCameraPointersInput=p;var U=y(11411);class l{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(O){O=u.d.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((f=>{const y=f.event;if(!y.metaKey)if(f.type===U.e.KEYDOWN){if(this._ctrlPressed=y.ctrlKey,this._altPressed=y.altKey,-1!==this.keysUp.indexOf(y.keyCode)||-1!==this.keysDown.indexOf(y.keyCode)||-1!==this.keysLeft.indexOf(y.keyCode)||-1!==this.keysRight.indexOf(y.keyCode)||-1!==this.keysReset.indexOf(y.keyCode)){-1===this._keys.indexOf(y.keyCode)&&this._keys.push(y.keyCode),y.preventDefault&&(O||y.preventDefault())}}else if(-1!==this.keysUp.indexOf(y.keyCode)||-1!==this.keysDown.indexOf(y.keyCode)||-1!==this.keysLeft.indexOf(y.keyCode)||-1!==this.keysRight.indexOf(y.keyCode)||-1!==this.keysReset.indexOf(y.keyCode)){const f=this._keys.indexOf(y.keyCode);f>=0&&this._keys.splice(f,1),y.preventDefault&&(O||y.preventDefault())}})))}Qi(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const O=this.camera;for(let f=0;f<this._keys.length;f++){const y=this._keys[f];-1!==this.keysLeft.indexOf(y)?this._ctrlPressed&&this.camera._useCtrlForPanning?O.inertialPanningX-=1/this.panningSensibility:O.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(y)?this._ctrlPressed&&this.camera._useCtrlForPanning?O.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?O.inertialRadiusOffset+=1/this.zoomingSensibility:O.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(y)?this._ctrlPressed&&this.camera._useCtrlForPanning?O.inertialPanningX+=1/this.panningSensibility:O.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(y)?this._ctrlPressed&&this.camera._useCtrlForPanning?O.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?O.inertialRadiusOffset-=1/this.zoomingSensibility:O.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(y)&&O.useInputToRestoreState&&O.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,S.b)([(0,H.L)()],l.prototype,"keysUp",void 0),(0,S.b)([(0,H.L)()],l.prototype,"keysDown",void 0),(0,S.b)([(0,H.L)()],l.prototype,"keysLeft",void 0),(0,S.b)([(0,H.L)()],l.prototype,"keysRight",void 0),(0,S.b)([(0,H.L)()],l.prototype,"keysReset",void 0),(0,S.b)([(0,H.L)()],l.prototype,"panningSensibility",void 0),(0,S.b)([(0,H.L)()],l.prototype,"zoomingSensibility",void 0),(0,S.b)([(0,H.L)()],l.prototype,"useAltToZoom",void 0),(0,S.b)([(0,H.L)()],l.prototype,"angularSpeed",void 0),j.b.ArcRotateCameraKeyboardMoveInput=l;var x=y(11434),W=y(11417),E=y(11345);class o{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new h.m(0,0,0),this._globalOffset=new h.m(0,0,0),this._inertialPanning=h.m.Zero()}_computeDeltaFromMouseWheelLegacyEvent(O,f){let y=0;const S=.01*O*this.wheelDeltaPercentage*f;return y=O>0?S/(1+this.wheelDeltaPercentage):S*(1+this.wheelDeltaPercentage),y}attachControl(O){O=u.d.BackCompatCameraNoPreventDefault(arguments),this._wheel=f=>{if(f.type!==m.b.POINTERWHEEL)return;const y=f.event;let S=0;const H=y.deltaMode===W.e.DOM_DELTA_LINE?40:1,b=-y.deltaY*H;if(this.customComputeDeltaFromMouseWheel)S=this.customComputeDeltaFromMouseWheel(b,this,y);else if(this.wheelDeltaPercentage){if(S=this._computeDeltaFromMouseWheelLegacyEvent(b,this.camera.radius),S>0){let O=this.camera.radius,f=this.camera.inertialRadiusOffset+S;for(let y=0;y<20&&Math.abs(f)>.001;y++)O-=f,f*=this.camera.inertia;O=(0,E.c)(O,0,Number.MAX_VALUE),S=this._computeDeltaFromMouseWheelLegacyEvent(b,O)}}else S=b/(40*this.wheelPrecision);S&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(S)):this.camera.inertialRadiusOffset+=S),y.preventDefault&&(O||y.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,m.b.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Wd(0)}Qi(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const O=this.camera;0+O.inertialAlphaOffset+O.inertialBetaOffset+O.inertialRadiusOffset&&(this._updateHitPlane(),O.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(O.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const O=this.camera,f=O.target.xc(O.position);this._hitPlane=x.b.FromPositionAndNormal(O.target,f)}_getPosition(){const O=this.camera,f=O.va(),y=f.createPickingRay(f.pointerX,f.pointerY,h.b.Identity(),O,!1);0===O.targetScreenOffset.x&&0===O.targetScreenOffset.y||(this._viewOffset.set(O.targetScreenOffset.x,O.targetScreenOffset.y,0),O.getViewMatrix().invertToRef(O._cameraTransformMatrix),this._globalOffset=h.m.TransformNormal(this._viewOffset,O._cameraTransformMatrix),y.origin.addInPlace(this._globalOffset));let S=0;return this._hitPlane&&(S=y.intersectsPlane(this._hitPlane)??0),y.origin.addInPlace(y.direction.scaleInPlace(S))}_zoomToMouse(O){const f=this.camera,y=1-f.inertia;if(f.lowerRadiusLimit){const S=f.lowerRadiusLimit??0;f.radius-(f.inertialRadiusOffset+O)/y<S&&(O=(f.radius-S)*y-f.inertialRadiusOffset)}if(f.upperRadiusLimit){const S=f.upperRadiusLimit??0;f.radius-(f.inertialRadiusOffset+O)/y>S&&(O=(f.radius-S)*y-f.inertialRadiusOffset)}const S=O/y/f.radius,H=this._getPosition(),b=h.g.fb[6];H.subtractToRef(f.target,b),b.scaleInPlace(S),b.scaleInPlace(y),this._inertialPanning.addInPlace(b),f.inertialRadiusOffset+=O}_zeroIfClose(O){Math.abs(O.x)<q.d&&(O.x=0),Math.abs(O.y)<q.d&&(O.y=0),Math.abs(O.z)<q.d&&(O.z=0)}}(0,S.b)([(0,H.L)()],o.prototype,"wheelPrecision",void 0),(0,S.b)([(0,H.L)()],o.prototype,"zoomToMouseLocation",void 0),(0,S.b)([(0,H.L)()],o.prototype,"wheelDeltaPercentage",void 0),j.b.ArcRotateCameraMouseWheelInput=o;class i extends j.e{constructor(O){super(O)}addMouseWheel(){return this.add(new o),this}addPointers(){return this.add(new p),this}addKeyboard(){return this.add(new l),this}}var D=y(11153);v.c.AddNodeConstructor("ArcRotateCamera",((O,f)=>()=>new V(O,0,0,1,h.m.Zero(),f)));class V extends B.c{get target(){return this._target}set target(O){this.setTarget(O)}get targetHost(){return this._targetHost}set targetHost(O){O&&this.setTarget(O)}getTarget(){return this.target}get position(){return this._position}set position(O){this.setPosition(O)}set upVector(O){this._upToYMatrix||(this._yToUpMatrix=new h.b,this._upToYMatrix=new h.b,this._upVector=h.m.Zero()),O.normalize(),this._upVector.p(O),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){h.b.RotationAlignToRef(h.m.UpReadOnly,this._upVector,this._yToUpMatrix),h.b.RotationAlignToRef(this._upVector,h.m.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const O=this.inputs.attached.pointers;return O?O.angularSensibilityX:0}set angularSensibilityX(O){const f=this.inputs.attached.pointers;f&&(f.angularSensibilityX=O)}get angularSensibilityY(){const O=this.inputs.attached.pointers;return O?O.angularSensibilityY:0}set angularSensibilityY(O){const f=this.inputs.attached.pointers;f&&(f.angularSensibilityY=O)}get pinchPrecision(){const O=this.inputs.attached.pointers;return O?O.pinchPrecision:0}set pinchPrecision(O){const f=this.inputs.attached.pointers;f&&(f.pinchPrecision=O)}get pinchDeltaPercentage(){const O=this.inputs.attached.pointers;return O?O.pinchDeltaPercentage:0}set pinchDeltaPercentage(O){const f=this.inputs.attached.pointers;f&&(f.pinchDeltaPercentage=O)}get useNaturalPinchZoom(){const O=this.inputs.attached.pointers;return!!O&&O.useNaturalPinchZoom}set useNaturalPinchZoom(O){const f=this.inputs.attached.pointers;f&&(f.useNaturalPinchZoom=O)}get panningSensibility(){const O=this.inputs.attached.pointers;return O?O.panningSensibility:0}set panningSensibility(O){const f=this.inputs.attached.pointers;f&&(f.panningSensibility=O)}get keysUp(){const O=this.inputs.attached.keyboard;return O?O.keysUp:[]}set keysUp(O){const f=this.inputs.attached.keyboard;f&&(f.keysUp=O)}get keysDown(){const O=this.inputs.attached.keyboard;return O?O.keysDown:[]}set keysDown(O){const f=this.inputs.attached.keyboard;f&&(f.keysDown=O)}get keysLeft(){const O=this.inputs.attached.keyboard;return O?O.keysLeft:[]}set keysLeft(O){const f=this.inputs.attached.keyboard;f&&(f.keysLeft=O)}get keysRight(){const O=this.inputs.attached.keyboard;return O?O.keysRight:[]}set keysRight(O){const f=this.inputs.attached.keyboard;f&&(f.keysRight=O)}get wheelPrecision(){const O=this.inputs.attached.mousewheel;return O?O.wheelPrecision:0}set wheelPrecision(O){const f=this.inputs.attached.mousewheel;f&&(f.wheelPrecision=O)}get zoomToMouseLocation(){const O=this.inputs.attached.mousewheel;return!!O&&O.zoomToMouseLocation}set zoomToMouseLocation(O){const f=this.inputs.attached.mousewheel;f&&(f.zoomToMouseLocation=O)}get wheelDeltaPercentage(){const O=this.inputs.attached.mousewheel;return O?O.wheelDeltaPercentage:0}set wheelDeltaPercentage(O){const f=this.inputs.attached.mousewheel;f&&(f.wheelDeltaPercentage=O)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(O){O!==this.useBouncingBehavior&&(O?(this._bouncingBehavior=new J,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(O){O!==this.useFramingBehavior&&(O?(this._framingBehavior=new X,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(O){O!==this.useAutoRotationBehavior&&(O?(this._autoRotationBehavior=new F,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(O,f,y,S,H,v){var N;let m=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(O,h.m.Zero(),v,m),N=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=h.m.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=h.i.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._viewMatrix=new h.b,this.panningAxis=new h.m(1,1,0),this._transformedDirection=new h.m,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new b.d,this.checkCollisions=!1,this.collisionRadius=new h.m(.5,.5,.5),this._previousPosition=h.m.Zero(),this._collisionVelocity=h.m.Zero(),this._newPosition=h.m.Zero(),this._computationVector=h.m.Zero(),this._onCollisionPositionChange=function(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;y?(N.setPosition(f),N.Gk&&N.Gk(y)):N._previousPosition.p(N._position);const S=Math.cos(N.alpha),H=Math.sin(N.alpha),b=Math.cos(N.beta);let h=Math.sin(N.beta);0===h&&(h=1e-4);const v=N._getTargetPosition();N._computationVector.Xd(N.radius*S*h,N.radius*b,N.radius*H*h),v.addToRef(N._computationVector,N._newPosition),N._position.p(N._newPosition);let m=N.upVector;N.allowUpsideDown&&N.beta<0&&(m=m.clone(),m=m.negate()),N._computeViewMatrix(N._position,v,m),N._viewMatrix.addAtIndex(12,N.targetScreenOffset.x),N._viewMatrix.addAtIndex(13,N.targetScreenOffset.y),N._collisionTriggered=!1},this._target=h.m.Zero(),H&&this.setTarget(H),this.alpha=f,this.beta=y,this.radius=S,this.getViewMatrix(),this.inputs=new i(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new h.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=h.i.Zero()}_updateCache(O){O||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const O=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?O.addToRef(this._targetBoundingCenter,this._target):this._target.p(O)}const O=this._getLockedTargetPosition();return O||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>q.d&&this.restoreStateInterpolationFactor<1?(this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(O,f){let y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const H=arguments;f=u.d.BackCompatCameraNoPreventDefault(H),this._useCtrlForPanning=y,this._panningMouseButton=S,"boolean"===typeof H[0]&&(H.length>1&&(this._useCtrlForPanning=H[1]),H.length>2&&(this._panningMouseButton=H[2])),this.inputs.attachElement(f),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Qi(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const O=this._scene.getEngine().getDeltaTime()/1e3,f=1-Math.pow(2,-O/this.restoreStateInterpolationFactor);this.setTarget(h.m.Lerp(this.getTarget(),this._storedTarget,f)),h.c.RotationAlphaBetaGammaToRef(this._storedAlpha,this._storedBeta,0,h.g.Quaternion[0]),h.c.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,h.g.Quaternion[1]),h.c.SlerpToRef(h.g.Quaternion[1],h.g.Quaternion[0],f,h.g.Quaternion[2]),h.g.Quaternion[2].normalize(),h.g.Quaternion[2].toAlphaBetaGammaToRef(h.g.fb[0]),this.alpha=h.g.fb[0].x,this.beta=h.g.fb[0].y,this.radius+=(this._storedRadius-this.radius)*f,h.i.LerpToRef(this.targetScreenOffset,this._storedTargetScreenOffset,f,this.targetScreenOffset),(h.m.DistanceSquared(this.getTarget(),this._storedTarget)<q.d&&h.g.Quaternion[2].equalsWithEpsilon(h.g.Quaternion[0])&&Math.pow(this._storedRadius-this.radius,2)<q.d&&h.i.Distance(this.targetScreenOffset,this._storedTargetScreenOffset)<q.d||0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset||0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._progressiveRestore=!1)}if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const O=this.invertRotation?-1:1,f=this._calculateHandednessMultiplier();let y=this.inertialAlphaOffset*f;this.beta<0&&(y*=-1),this.alpha+=y*O,this.beta+=this.inertialBetaOffset*O,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<q.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<q.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*q.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const O=new h.m(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),O.multiplyInPlace(this.panningAxis),h.m.TransformNormalToRef(O,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const O=this.upVector,f=h.m.CrossToRef(this._transformedDirection,O,this._transformedDirection);h.m.CrossToRef(O,f,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);h.m.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const O=h.g.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(O),O.transposeToRef(O),h.m.TransformCoordinatesToRef(this._transformedDirection,O,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*q.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*q.d&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||h.m.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const O=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const f=Math.round((O-this.alpha)/(2*Math.PI));this.alpha+=2*f*Math.PI,this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()}setPosition(O){this._position.equals(O)||(this._position.p(O),this.rebuildAnglesAndRadius())}setTarget(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(S=this.overrideCloneAlphaBetaRadius??S,O.Mj)f&&O.getBoundingInfo?this._targetBoundingCenter=O.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,O.Mj(),this._targetHost=O,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const f=O,S=this._getTargetPosition();if(S&&!y&&S.equals(f))return;this._targetHost=null,this._target=f,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}S||this.rebuildAnglesAndRadius()}_getViewMatrix(){const O=Math.cos(this.alpha),f=Math.sin(this.alpha),y=Math.cos(this.beta);let S=Math.sin(this.beta);0===S&&(S=1e-4),0===this.radius&&(this.radius=1e-4);const H=this._getTargetPosition();if(this._computationVector.Xd(this.radius*O*S,this.radius*y,this.radius*f*S),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||h.m.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),H.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const O=this.va().collisionCoordinator;this._collider||(this._collider=O.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,O.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let O=this.upVector;this.allowUpsideDown&&S<0&&(O=O.negate()),this._computeViewMatrix(this._position,H,O),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=H,this._viewMatrix}zoomOn(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];O=O||this.va().meshes;const y=N.d.MinMax(O);let S=this._calculateLowerRadiusFromModelBoundingSphere(y.min,y.max);S=Math.max(Math.min(S,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=S*this.zoomOnFactor,this.focusOn({min:y.min,max:y.max,distance:S},f)}focusOn(O){let f,y,S=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===O.min){const S=O||this.va().meshes;f=N.d.MinMax(S),y=h.m.Distance(f.min,f.max)}else{f=O,y=O.distance}this._target=N.d.Center(f),S||(this.maxZ=2*y)}createRigCamera(O,f){let y=0;switch(this.cameraRigMode){case w.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case w.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case w.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case w.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case w.c.RIG_MODE_VR:y=this._cameraRigParams.stereoHalfAngle*(0===f?1:-1);break;case w.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:y=this._cameraRigParams.stereoHalfAngle*(0===f?-1:1)}const S=new V(O,this.alpha+y,this.beta,this.radius,this._target,this.va());return S._cameraRigParams={},S.isRigCamera=!0,S.rigParent=this,S.upVector=this.upVector,S.mode=this.mode,S.orthoLeft=this.orthoLeft,S.orthoRight=this.orthoRight,S.orthoBottom=this.orthoBottom,S.orthoTop=this.orthoTop,S}_updateRigCameras(){const O=this._rigCameras[0],f=this._rigCameras[1];switch(O.beta=f.beta=this.beta,this.cameraRigMode){case w.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case w.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case w.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case w.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case w.c.RIG_MODE_VR:O.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,f.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case w.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:O.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,f.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const S=h.m.Distance(O,f),H=this.va().getEngine().getAspectRatio(this),b=Math.tan(this.fov/2),v=b*H,N=.5*S*y,m=N*Math.sqrt(1+1/(v*v)),t=N*Math.sqrt(1+1/(b*b));return Math.max(m,t)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,S.b)([(0,H.L)()],V.prototype,"alpha",void 0),(0,S.b)([(0,H.L)()],V.prototype,"beta",void 0),(0,S.b)([(0,H.L)()],V.prototype,"radius",void 0),(0,S.b)([(0,H.L)()],V.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,S.b)([(0,H.J)("target")],V.prototype,"_target",void 0),(0,S.b)([(0,H.w)("targetHost")],V.prototype,"_targetHost",void 0),(0,S.b)([(0,H.L)()],V.prototype,"inertialAlphaOffset",void 0),(0,S.b)([(0,H.L)()],V.prototype,"inertialBetaOffset",void 0),(0,S.b)([(0,H.L)()],V.prototype,"inertialRadiusOffset",void 0),(0,S.b)([(0,H.L)()],V.prototype,"lowerAlphaLimit",void 0),(0,S.b)([(0,H.L)()],V.prototype,"upperAlphaLimit",void 0),(0,S.b)([(0,H.L)()],V.prototype,"lowerBetaLimit",void 0),(0,S.b)([(0,H.L)()],V.prototype,"upperBetaLimit",void 0),(0,S.b)([(0,H.L)()],V.prototype,"lowerRadiusLimit",void 0),(0,S.b)([(0,H.L)()],V.prototype,"upperRadiusLimit",void 0),(0,S.b)([(0,H.L)()],V.prototype,"inertialPanningX",void 0),(0,S.b)([(0,H.L)()],V.prototype,"inertialPanningY",void 0),(0,S.b)([(0,H.L)()],V.prototype,"pinchToPanMaxDistance",void 0),(0,S.b)([(0,H.L)()],V.prototype,"panningDistanceLimit",void 0),(0,S.b)([(0,H.J)()],V.prototype,"panningOriginTarget",void 0),(0,S.b)([(0,H.L)()],V.prototype,"panningInertia",void 0),(0,S.b)([(0,H.L)()],V.prototype,"zoomToMouseLocation",null),(0,S.b)([(0,H.L)()],V.prototype,"zoomOnFactor",void 0),(0,S.b)([(0,H.F)()],V.prototype,"targetScreenOffset",void 0),(0,S.b)([(0,H.L)()],V.prototype,"allowUpsideDown",void 0),(0,S.b)([(0,H.L)()],V.prototype,"useInputToRestoreState",void 0),(0,S.b)([(0,H.L)()],V.prototype,"restoreStateInterpolationFactor",void 0),(0,D.g)("BABYLON.ArcRotateCamera",V)},11561:(O,f,y)=>{"use strict";y.d(f,{c:()=>X});var S=y(11289),H=y(11294),b=y(11302),h=y(10995),v=y(11004),N=y(11324),m=y(11568),t=y(11017),q=y(11153),F=y(11030),I=y(11574),A=y(11430),J=y(11362);class X extends m.c{get position(){return this._position}set position(O){this._position=O}set upVector(O){this._upVector=O}get upVector(){return this._upVector}get screenArea(){let O=0,f=0;if(this.mode===X.PERSPECTIVE_CAMERA)this.fovMode===X.FOVMODE_VERTICAL_FIXED?(f=2*this.Ui*Math.tan(this.fov/2),O=this.getEngine().getAspectRatio(this)*f):(O=2*this.Ui*Math.tan(this.fov/2),f=O/this.getEngine().getAspectRatio(this));else{const y=this.getEngine().getRenderWidth()/2,S=this.getEngine().getRenderHeight()/2;O=(this.orthoRight??y)-(this.orthoLeft??-y),f=(this.orthoTop??S)-(this.orthoBottom??-S)}return O*f}set orthoLeft(O){this._orthoLeft=O;for(const f of this._rigCameras)f.orthoLeft=O}get orthoLeft(){return this._orthoLeft}set orthoRight(O){this._orthoRight=O;for(const f of this._rigCameras)f.orthoRight=O}get orthoRight(){return this._orthoRight}set orthoBottom(O){this._orthoBottom=O;for(const f of this._rigCameras)f.orthoBottom=O}get orthoBottom(){return this._orthoBottom}set orthoTop(O){this._orthoTop=O;for(const f of this._rigCameras)f.orthoTop=O}get orthoTop(){return this._orthoTop}set mode(O){this._mode=O;for(const f of this._rigCameras)f.mode=O}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(O,f,y){let S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(O,y,!1),this._position=N.m.Zero(),this._upVector=N.m.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.Ui=1,this.maxZ=1e4,this.inertia=.9,this._mode=X.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new I.c(0,0,1,1),this.layerMask=268435455,this.fovMode=X.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=X.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new v.d,this.onProjectionMatrixChangedObservable=new v.d,this.onAfterCheckInputsObservable=new v.d,this.onRestoreStateObservable=new v.d,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new N.b,this._postProcesses=new Array,this._activeMeshes=new b.g(256),this._globalPosition=N.m.Zero(),this._computedViewMatrix=N.b.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=N.b.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=N.c.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.va().addCamera(this),S&&!this.va().activeCamera&&(this.va().activeCamera=this),this.position=f,this.renderPassId=this.va().getEngine().createRenderPassId(`Camera ${O}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"mh"}toString(O){let f="Name: "+this.name;if(f+=", type: "+this.getClassName(),this.animations)for(let y=0;y<this.animations.length;y++)f+=", animation[0]: "+this.animations[y].toString(O);return f}applyVerticalCorrection(){const O=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-O.x:O.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(O){return-1!==this._activeMeshes.indexOf(O)}isReady(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(O)for(const f of this._postProcesses)if(f&&!f.isReady())return!1;return super.isReady(O)}_initCache(){super._initCache(),this._cache.position=new N.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new N.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.Ui=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(O){O||super._updateCache(),this._cache.position.p(this.position),this._cache.upVector.p(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let O=this._cache.mode===this.mode&&this._cache.Ui===this.Ui&&this._cache.maxZ===this.maxZ;if(!O)return!1;const f=this.getEngine();return this.mode===X.PERSPECTIVE_CAMERA?O=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===f.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(O=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===f.getRenderWidth()&&this._cache.renderHeight===f.getRenderHeight(),this.oblique&&(O=O&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),O}attachControl(O,f){}Qi(O){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==X.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let O=0;O<this._postProcesses.length;O++)if(null!==this._postProcesses[O])return this._postProcesses[O];return null}_cascadePostProcessesToRigCams(){const O=this._getFirstPostProcess();O&&O.markTextureDirty();for(let f=0,y=this._rigCameras.length;f<y;f++){const O=this._rigCameras[f],y=O._rigPostProcess;if(y){"pass"===y.getEffectName()&&(O.isIntermediate=0===this._postProcesses.length),O._postProcesses=this._postProcesses.slice(0).concat(y),y.markTextureDirty()}else O._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!O.isReusable()&&this._postProcesses.indexOf(O)>-1?(t.e.Error("You're trying to reuse a post process not defined as reusable."),0):(null==f||f<0?this._postProcesses.push(O):null===this._postProcesses[f]?this._postProcesses[f]=O:this._postProcesses.splice(f,0,O),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.Dg(),this._postProcesses.indexOf(O))}detachPostProcess(O){const f=this._postProcesses.indexOf(O);-1!==f&&(this._postProcesses[f]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.Dg(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return N.b.Identity()}getViewMatrix(O){return!O&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.va().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(O){this._doNotComputeProjectionMatrix=!0,void 0!==O&&(this._projectionMatrix=O)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(O){if(this._doNotComputeProjectionMatrix||!O&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.Ui=this.Ui,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const f=this.getEngine(),y=this.va(),S=f.useReverseDepthBuffer;if(this.mode===X.PERSPECTIVE_CAMERA){let O;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=f.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.Ui<=0&&(this.Ui=.1),O=y.useRightHandedSystem?N.b.PerspectiveFovRHToRef:N.b.PerspectiveFovLHToRef,O(this.fov,f.getAspectRatio(this),S?this.maxZ:this.Ui,S?this.Ui:this.maxZ,this._projectionMatrix,this.fovMode===X.FOVMODE_VERTICAL_FIXED,f.isNDCHalfZRange,this.projectionPlaneTilt,S)}else{var H,b,h;const O=f.getRenderWidth()/2,v=f.getRenderHeight()/2;y.useRightHandedSystem?this.oblique?N.b.ObliqueOffCenterRHToRef(this.orthoLeft??-O,this.orthoRight??O,this.orthoBottom??-v,this.orthoTop??v,S?this.maxZ:this.Ui,S?this.Ui:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,f.isNDCHalfZRange):N.b.OrthoOffCenterRHToRef(this.orthoLeft??-O,this.orthoRight??O,this.orthoBottom??-v,this.orthoTop??v,S?this.maxZ:this.Ui,S?this.Ui:this.maxZ,this._projectionMatrix,f.isNDCHalfZRange):this.oblique?N.b.ObliqueOffCenterLHToRef(this.orthoLeft??-O,this.orthoRight??O,this.orthoBottom??-v,this.orthoTop??v,S?this.maxZ:this.Ui,S?this.Ui:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,f.isNDCHalfZRange):N.b.OrthoOffCenterLHToRef(this.orthoLeft??-O,this.orthoRight??O,this.orthoBottom??-v,this.orthoTop??v,S?this.maxZ:this.Ui,S?this.Ui:this.maxZ,this._projectionMatrix,f.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(H=this.oblique)||void 0===H?void 0:H.angle,this._cache.obliqueLength=null===(b=this.oblique)||void 0===b?void 0:b.length,this._cache.obliqueOffset=null===(h=this.oblique)||void 0===h?void 0:h.offset,this._cache.renderWidth=f.getRenderWidth(),this._cache.renderHeight=f.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(O){return(this.radius||(this.target?N.m.Distance(this.position,this.target):this.position.length()))+O}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?A.c.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=A.c.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),f&&this.rigCameras.length>0){let f=!1;return this.rigCameras.forEach((y=>{y._updateFrustumPlanes(),f=f||O.isInFrustum(y._frustumPlanes)})),f}return O.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(O){return this._updateFrustumPlanes(),O.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,F.d)("Ray")}getForwardRayToRef(O){throw(0,F.d)("Ray")}dispose(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.va().stopAnimation(this),this.va().removeCamera(this);this._rigCameras.length>0;){const O=this._rigCameras.pop();O&&O.dispose()}if(this._parentContainer){const O=this._parentContainer.cameras.indexOf(this);O>-1&&this._parentContainer.cameras.splice(O,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==X.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let O=this._postProcesses.length;for(;--O>=0;){const f=this._postProcesses[O];f&&f.dispose(this)}}let y=this.customRenderTargets.length;for(;--y>=0;)this.customRenderTargets[y].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.va().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(O,f)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(O,f){if(this.cameraRigMode!==O){for(;this._rigCameras.length>0;){const O=this._rigCameras.pop();O&&O.dispose()}if(this.cameraRigMode=O,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=f.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=h.d.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==X.RIG_MODE_NONE){const O=this.createRigCamera(this.name+"_L",0);O&&(O._isLeftCamera=!0);const f=this.createRigCamera(this.name+"_R",1);f&&(f._isRightCamera=!0),O&&f&&(this._rigCameras.push(O),this._rigCameras.push(f))}this._setRigMode(f),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(O){}_getVRProjectionMatrix(){return N.b.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.Ui,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(O,f){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[O]=f,"interaxialDistance"===O&&(this._cameraRigParams.stereoHalfAngle=h.d.ToRadians(f/.0637))}createRigCamera(O,f){return null}_updateRigCameras(){for(let O=0;O<this._rigCameras.length;O++)this._rigCameras[O].Ui=this.Ui,this._rigCameras[O].maxZ=this.maxZ,this._rigCameras[O].fov=this.fov,this._rigCameras[O].upVector.p(this.upVector);this.cameraRigMode===X.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const O=J.b.Serialize(this);return O.uniqueId=this.uniqueId,O.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(O),this.inputs&&this.inputs.serialize(O),J.b.AppendSerializedAnimations(this,O),O.ranges=this.serializeAnimationRanges(),O.isEnabled=this.isEnabled(),O}clone(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const y=J.b.Clone(X.GetConstructorFromName(this.getClassName(),O,this.va(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return y.name=O,y.parent=f,this.onClonedObservable.notifyObservers(y),y}Oe(O){const f=N.m.Zero();return this.getDirectionToRef(O,f),f}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(O,f){N.m.TransformNormalToRef(O,this.getWorldMatrix(),f)}static GetConstructorFromName(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,H=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const b=m.c.Construct(O,f,y,{interaxial_distance:S,isStereoscopicSideBySide:H});return b||(()=>X._CreateDefaultParsedCamera(f,y))}Mj(){return this.getWorldMatrix()}static Parse(O,f){const y=O.type,S=X.GetConstructorFromName(y,O.name,f,O.interaxial_distance,O.isStereoscopicSideBySide),H=J.b.Parse(S,O,f);if(void 0!==O.parentId&&(H._waitingParentId=O.parentId),void 0!==O.parentInstanceIndex&&(H._waitingParentInstanceIndex=O.parentInstanceIndex),H.inputs&&(H.inputs.parse(O),H._setupInputs()),O.upVector&&(H.upVector=N.m.Ng(O.upVector)),H.setPosition&&(H.position.Xd(0,0,0),H.setPosition(N.m.Ng(O.position))),O.target&&H.setTarget&&H.setTarget(N.m.Ng(O.target)),O.cameraRigMode){const f=O.interaxial_distance?{interaxialDistance:O.interaxial_distance}:{};H.setCameraRigMode(O.cameraRigMode,f)}if(O.animations){for(let f=0;f<O.animations.length;f++){const y=O.animations[f],S=(0,q.c)("BABYLON.Animation");S&&H.animations.push(S.Parse(y))}m.c.ParseAnimationRanges(H,O,f)}return O.autoAnimate&&f.beginAnimation(H,O.autoAnimateFrom,O.autoAnimateTo,O.autoAnimateLoop,O.autoAnimateSpeed||1),void 0!==O.isEnabled&&H.$b(O.isEnabled),H}_calculateHandednessMultiplier(){let O=this.va().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(O*=-1),O}}X._CreateDefaultParsedCamera=(O,f)=>{throw(0,F.d)("UniversalCamera")},X.PERSPECTIVE_CAMERA=0,X.ORTHOGRAPHIC_CAMERA=1,X.FOVMODE_VERTICAL_FIXED=0,X.FOVMODE_HORIZONTAL_FIXED=1,X.RIG_MODE_NONE=0,X.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,X.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,X.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,X.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,X.RIG_MODE_STEREOSCOPIC_INTERLACED=14,X.RIG_MODE_VR=20,X.RIG_MODE_CUSTOM=22,X.ForceAttachControlToAlwaysPreventDefault=!1,(0,S.b)([(0,H.J)("position")],X.prototype,"_position",void 0),(0,S.b)([(0,H.J)("upVector")],X.prototype,"_upVector",void 0),(0,S.b)([(0,H.L)()],X.prototype,"orthoLeft",null),(0,S.b)([(0,H.L)()],X.prototype,"orthoRight",null),(0,S.b)([(0,H.L)()],X.prototype,"orthoBottom",null),(0,S.b)([(0,H.L)()],X.prototype,"orthoTop",null),(0,S.b)([(0,H.L)()],X.prototype,"fov",void 0),(0,S.b)([(0,H.L)()],X.prototype,"projectionPlaneTilt",void 0),(0,S.b)([(0,H.L)()],X.prototype,"Ui",void 0),(0,S.b)([(0,H.L)()],X.prototype,"maxZ",void 0),(0,S.b)([(0,H.L)()],X.prototype,"inertia",void 0),(0,S.b)([(0,H.L)()],X.prototype,"mode",null),(0,S.b)([(0,H.L)()],X.prototype,"layerMask",void 0),(0,S.b)([(0,H.L)()],X.prototype,"fovMode",void 0),(0,S.b)([(0,H.L)()],X.prototype,"cameraRigMode",void 0),(0,S.b)([(0,H.L)()],X.prototype,"interaxialDistance",void 0),(0,S.b)([(0,H.L)()],X.prototype,"isStereoscopicSideBySide",void 0)},12205:(O,f,y)=>{"use strict";y.d(f,{b:()=>h,e:()=>v});var S=y(11017),H=y(11362),b=y(11561),h={};class v{constructor(O){this.attachedToElement=!1,this.attached={},this.camera=O,this.checkInputs=()=>{}}add(O){const f=O.getSimpleName();this.attached[f]?S.e.Warn("camera input of type "+f+" already exists on camera"):(this.attached[f]=O,O.camera=this.camera,O.checkInputs&&(this.checkInputs=this._addCheckInputs(O.checkInputs.bind(O))),this.attachedToElement&&O.attachControl(this.noPreventDefault))}remove(O){for(const f in this.attached){const y=this.attached[f];if(y===O)return y.Qi(),y.camera=null,delete this.attached[f],void this.rebuildInputCheck()}}removeByType(O){for(const f in this.attached){const y=this.attached[f];y.getClassName()===O&&(y.Qi(),y.camera=null,delete this.attached[f],this.rebuildInputCheck())}}_addCheckInputs(O){const f=this.checkInputs;return()=>{f(),O()}}attachInput(O){this.attachedToElement&&O.attachControl(this.noPreventDefault)}attachElement(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){O=!b.c.ForceAttachControlToAlwaysPreventDefault&&O,this.attachedToElement=!0,this.noPreventDefault=O;for(const f in this.attached)this.attached[f].attachControl(O)}}detachElement(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const f in this.attached)this.attached[f].Qi(),O&&(this.attached[f].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const O in this.attached){const f=this.attached[O];f.checkInputs&&(this.checkInputs=this._addCheckInputs(f.checkInputs.bind(f)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(O){const f={};for(const y in this.attached){const O=this.attached[y],S=H.b.Serialize(O);f[O.getClassName()]=S}O.inputsmgr=f}parse(O){const f=O.inputsmgr;if(f){this.clear();for(const O in f){const y=h[O];if(y){const S=f[O],b=H.b.Parse((()=>new y),S,null);this.add(b)}}}else for(const y in this.attached){const f=h[this.attached[y].getClassName()];if(f){const S=H.b.Parse((()=>new f),O,null);this.remove(this.attached[y]),this.add(S)}}}}},12195:(O,f,y)=>{"use strict";y.d(f,{b:()=>p});var S=y(11289),H=y(11294),b=y(11324),h=y(12200),v=y(12205),N=y(11411),m=y(10995);class t{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(O){O=m.d.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((f=>{const y=f.event;if(!y.metaKey)if(f.type===N.e.KEYDOWN){if(-1!==this.keysUp.indexOf(y.keyCode)||-1!==this.keysDown.indexOf(y.keyCode)||-1!==this.keysLeft.indexOf(y.keyCode)||-1!==this.keysRight.indexOf(y.keyCode)||-1!==this.keysUpward.indexOf(y.keyCode)||-1!==this.keysDownward.indexOf(y.keyCode)||-1!==this.keysRotateLeft.indexOf(y.keyCode)||-1!==this.keysRotateRight.indexOf(y.keyCode)||-1!==this.keysRotateUp.indexOf(y.keyCode)||-1!==this.keysRotateDown.indexOf(y.keyCode)){-1===this._keys.indexOf(y.keyCode)&&this._keys.push(y.keyCode),O||y.preventDefault()}}else if(-1!==this.keysUp.indexOf(y.keyCode)||-1!==this.keysDown.indexOf(y.keyCode)||-1!==this.keysLeft.indexOf(y.keyCode)||-1!==this.keysRight.indexOf(y.keyCode)||-1!==this.keysUpward.indexOf(y.keyCode)||-1!==this.keysDownward.indexOf(y.keyCode)||-1!==this.keysRotateLeft.indexOf(y.keyCode)||-1!==this.keysRotateRight.indexOf(y.keyCode)||-1!==this.keysRotateUp.indexOf(y.keyCode)||-1!==this.keysRotateDown.indexOf(y.keyCode)){const f=this._keys.indexOf(y.keyCode);f>=0&&this._keys.splice(f,1),O||y.preventDefault()}})))}Qi(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const O=this.camera;for(let f=0;f<this._keys.length;f++){const y=this._keys[f],S=O._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(y)?O._localDirection.Xd(-S,0,0):-1!==this.keysUp.indexOf(y)?O._localDirection.Xd(0,0,S):-1!==this.keysRight.indexOf(y)?O._localDirection.Xd(S,0,0):-1!==this.keysDown.indexOf(y)?O._localDirection.Xd(0,0,-S):-1!==this.keysUpward.indexOf(y)?O._localDirection.Xd(0,S,0):-1!==this.keysDownward.indexOf(y)?O._localDirection.Xd(0,-S,0):-1!==this.keysRotateLeft.indexOf(y)?(O._localDirection.Xd(0,0,0),O.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(y)?(O._localDirection.Xd(0,0,0),O.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(y)?(O._localDirection.Xd(0,0,0),O.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(y)&&(O._localDirection.Xd(0,0,0),O.cameraRotation.x+=this._getLocalRotation()),O.va().useRightHandedSystem&&(O._localDirection.z*=-1),O.getViewMatrix().invertToRef(O._cameraTransformMatrix),b.m.TransformNormalToRef(O._localDirection,O._cameraTransformMatrix,O._transformedDirection),O.cameraDirection.addInPlace(O._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const O=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*O}}(0,S.b)([(0,H.L)()],t.prototype,"keysUp",void 0),(0,S.b)([(0,H.L)()],t.prototype,"keysUpward",void 0),(0,S.b)([(0,H.L)()],t.prototype,"keysDown",void 0),(0,S.b)([(0,H.L)()],t.prototype,"keysDownward",void 0),(0,S.b)([(0,H.L)()],t.prototype,"keysLeft",void 0),(0,S.b)([(0,H.L)()],t.prototype,"keysRight",void 0),(0,S.b)([(0,H.L)()],t.prototype,"rotationSpeed",void 0),(0,S.b)([(0,H.L)()],t.prototype,"keysRotateLeft",void 0),(0,S.b)([(0,H.L)()],t.prototype,"keysRotateRight",void 0),(0,S.b)([(0,H.L)()],t.prototype,"keysRotateUp",void 0),(0,S.b)([(0,H.L)()],t.prototype,"keysRotateDown",void 0),v.b.FreeCameraKeyboardMoveInput=t;var q=y(11004),F=y(11406);class I{constructor(){let O=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=O,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new q.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(O){O=m.d.BackCompatCameraNoPreventDefault(arguments);const f=this.camera.getEngine(),y=f.getInputElement();this._pointerInput||(this._pointerInput=S=>{const H=S.event,b="touch"===H.pointerType;if(!this.touchEnabled&&b)return;if(S.type!==F.b.POINTERMOVE&&-1===this.buttons.indexOf(H.button))return;const h=H.target;if(S.type===F.b.POINTERDOWN){if(b&&-1!==this._activePointerId||!b&&-1!==this._currentActiveButton)return;this._activePointerId=H.pointerId;try{null===h||void 0===h||h.setPointerCapture(H.pointerId)}catch(v){}-1===this._currentActiveButton&&(this._currentActiveButton=H.button),this._previousPosition={x:H.clientX,y:H.clientY},O||(H.preventDefault(),y&&y.focus()),f.isPointerLock&&this._onMouseMove&&this._onMouseMove(S.event)}else if(S.type===F.b.POINTERUP){if(b&&this._activePointerId!==H.pointerId||!b&&this._currentActiveButton!==H.button)return;try{null===h||void 0===h||h.releasePointerCapture(H.pointerId)}catch(v){}this._currentActiveButton=-1,this._previousPosition=null,O||H.preventDefault(),this._activePointerId=-1}else if(S.type===F.b.POINTERMOVE&&(this._activePointerId===H.pointerId||!b))if(f.isPointerLock&&this._onMouseMove)this._onMouseMove(S.event);else if(this._previousPosition){const f=this.camera._calculateHandednessMultiplier(),y=(H.clientX-this._previousPosition.x)*f,S=H.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=y/this.angularSensibility,this.camera.cameraRotation.x+=S/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:y,offsetY:S}),this._previousPosition={x:H.clientX,y:H.clientY},O||H.preventDefault()}}),this._onMouseMove=y=>{if(!f.isPointerLock)return;const S=this.camera._calculateHandednessMultiplier(),H=y.movementX*S;this.camera.cameraRotation.y+=H/this.angularSensibility;const b=y.movementY;this.camera.cameraRotation.x+=b/this.angularSensibility,this._previousPosition=null,O||y.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,F.b.POINTERDOWN|F.b.POINTERUP|F.b.POINTERMOVE),y&&(this._contextMenuBind=O=>this.onContextMenu(O),y.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(O){O.preventDefault()}Qi(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const O=this.camera.getEngine().getInputElement();O&&O.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,S.b)([(0,H.L)()],I.prototype,"buttons",void 0),(0,S.b)([(0,H.L)()],I.prototype,"angularSensibility",void 0),v.b.FreeCameraMouseInput=I;var A,J=y(11417);class X{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new q.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(O){O=m.d.BackCompatCameraNoPreventDefault(arguments),this._wheel=f=>{if(f.type!==F.b.POINTERWHEEL)return;const y=f.event,S=y.deltaMode===J.e.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*S*y.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*S*y.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*S*y.deltaZ/this._normalize,y.preventDefault&&(O||y.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,F.b.POINTERWHEEL)}Qi(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,S.b)([(0,H.L)()],X.prototype,"wheelPrecisionX",void 0),(0,S.b)([(0,H.L)()],X.prototype,"wheelPrecisionY",void 0),(0,S.b)([(0,H.L)()],X.prototype,"wheelPrecisionZ",void 0),function(O){O[O.MoveRelative=0]="MoveRelative",O[O.RotateRelative=1]="RotateRelative",O[O.MoveScene=2]="MoveScene"}(A||(A={}));class w extends X{constructor(){super(...arguments),this._moveRelative=b.m.Zero(),this._rotateRelative=b.m.Zero(),this._moveScene=b.m.Zero(),this._wheelXAction=A.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=A.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(O){null===O&&this._wheelXAction!==A.MoveRelative||(this._wheelXAction=A.MoveRelative,this._wheelXActionCoordinate=O)}get wheelXMoveRelative(){return this._wheelXAction!==A.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(O){null===O&&this._wheelYAction!==A.MoveRelative||(this._wheelYAction=A.MoveRelative,this._wheelYActionCoordinate=O)}get wheelYMoveRelative(){return this._wheelYAction!==A.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(O){null===O&&this._wheelZAction!==A.MoveRelative||(this._wheelZAction=A.MoveRelative,this._wheelZActionCoordinate=O)}get wheelZMoveRelative(){return this._wheelZAction!==A.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(O){null===O&&this._wheelXAction!==A.RotateRelative||(this._wheelXAction=A.RotateRelative,this._wheelXActionCoordinate=O)}get wheelXRotateRelative(){return this._wheelXAction!==A.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(O){null===O&&this._wheelYAction!==A.RotateRelative||(this._wheelYAction=A.RotateRelative,this._wheelYActionCoordinate=O)}get wheelYRotateRelative(){return this._wheelYAction!==A.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(O){null===O&&this._wheelZAction!==A.RotateRelative||(this._wheelZAction=A.RotateRelative,this._wheelZActionCoordinate=O)}get wheelZRotateRelative(){return this._wheelZAction!==A.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(O){null===O&&this._wheelXAction!==A.MoveScene||(this._wheelXAction=A.MoveScene,this._wheelXActionCoordinate=O)}get wheelXMoveScene(){return this._wheelXAction!==A.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(O){null===O&&this._wheelYAction!==A.MoveScene||(this._wheelYAction=A.MoveScene,this._wheelYActionCoordinate=O)}get wheelYMoveScene(){return this._wheelYAction!==A.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(O){null===O&&this._wheelZAction!==A.MoveScene||(this._wheelZAction=A.MoveScene,this._wheelZActionCoordinate=O)}get wheelZMoveScene(){return this._wheelZAction!==A.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Wd(0),this._rotateRelative.Wd(0),this._moveScene.Wd(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const O=b.b.Zero();this.camera.getViewMatrix().invertToRef(O);const f=b.m.Zero();b.m.TransformNormalToRef(this._moveRelative,O,f),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(f),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(O,f,y){if(0===O)return;if(null===f||null===y)return;let S=null;switch(f){case A.MoveRelative:S=this._moveRelative;break;case A.RotateRelative:S=this._rotateRelative;break;case A.MoveScene:S=this._moveScene}switch(y){case 0:S.set(O,0,0);break;case 1:S.set(0,O,0);break;case 2:S.set(0,0,O)}}}(0,S.b)([(0,H.L)()],w.prototype,"wheelXMoveRelative",null),(0,S.b)([(0,H.L)()],w.prototype,"wheelYMoveRelative",null),(0,S.b)([(0,H.L)()],w.prototype,"wheelZMoveRelative",null),(0,S.b)([(0,H.L)()],w.prototype,"wheelXRotateRelative",null),(0,S.b)([(0,H.L)()],w.prototype,"wheelYRotateRelative",null),(0,S.b)([(0,H.L)()],w.prototype,"wheelZRotateRelative",null),(0,S.b)([(0,H.L)()],w.prototype,"wheelXMoveScene",null),(0,S.b)([(0,H.L)()],w.prototype,"wheelYMoveScene",null),(0,S.b)([(0,H.L)()],w.prototype,"wheelZMoveScene",null),v.b.FreeCameraMouseWheelInput=w;class B{constructor(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=O,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=m.d.IsSafari()}attachControl(O){O=m.d.BackCompatCameraNoPreventDefault(arguments);let f=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=y=>{const S=y.event,H="mouse"===S.pointerType||this._isSafari&&"undefined"===typeof S.pointerType;if(this.allowMouse||!H)if(y.type===F.b.POINTERDOWN){if(O||S.preventDefault(),this._pointerPressed.push(S.pointerId),1!==this._pointerPressed.length)return;f={x:S.clientX,y:S.clientY}}else if(y.type===F.b.POINTERUP){O||S.preventDefault();const y=this._pointerPressed.indexOf(S.pointerId);if(-1===y)return;if(this._pointerPressed.splice(y,1),0!=y)return;f=null,this._offsetX=null,this._offsetY=null}else if(y.type===F.b.POINTERMOVE){if(O||S.preventDefault(),!f)return;if(0!=this._pointerPressed.indexOf(S.pointerId))return;this._offsetX=S.clientX-f.x,this._offsetY=-(S.clientY-f.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,F.b.POINTERDOWN|F.b.POINTERUP|F.b.POINTERMOVE),this._onLostFocus){const O=this.camera.getEngine().getInputElement();O&&O.addEventListener("blur",this._onLostFocus)}}Qi(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const O=this.camera.getEngine().getInputElement();O&&O.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const O=this.camera,f=O._calculateHandednessMultiplier();O.cameraRotation.y=f*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)O.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const f=O._computeLocalCameraSpeed(),y=new b.m(0,0,0!==this.touchMoveSensibility?f*this._offsetY/this.touchMoveSensibility:0);b.b.RotationYawPitchRollToRef(O.rotation.y,O.rotation.x,0,O._cameraRotationMatrix),O.cameraDirection.addInPlace(b.m.TransformCoordinates(y,O._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,S.b)([(0,H.L)()],B.prototype,"touchAngularSensibility",void 0),(0,S.b)([(0,H.L)()],B.prototype,"touchMoveSensibility",void 0),v.b.FreeCameraTouchInput=B;class j extends v.e{constructor(O){super(O),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new t),this}addMouse(){let O=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new I(O),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new w,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new B),this}clear(){super.clear(),this._mouseInput=null}}var u=y(11153),L=y(11092);class p extends h.c{get angularSensibility(){const O=this.inputs.attached.mouse;return O?O.angularSensibility:0}set angularSensibility(O){const f=this.inputs.attached.mouse;f&&(f.angularSensibility=O)}get keysUp(){const O=this.inputs.attached.keyboard;return O?O.keysUp:[]}set keysUp(O){const f=this.inputs.attached.keyboard;f&&(f.keysUp=O)}get keysUpward(){const O=this.inputs.attached.keyboard;return O?O.keysUpward:[]}set keysUpward(O){const f=this.inputs.attached.keyboard;f&&(f.keysUpward=O)}get keysDown(){const O=this.inputs.attached.keyboard;return O?O.keysDown:[]}set keysDown(O){const f=this.inputs.attached.keyboard;f&&(f.keysDown=O)}get keysDownward(){const O=this.inputs.attached.keyboard;return O?O.keysDownward:[]}set keysDownward(O){const f=this.inputs.attached.keyboard;f&&(f.keysDownward=O)}get keysLeft(){const O=this.inputs.attached.keyboard;return O?O.keysLeft:[]}set keysLeft(O){const f=this.inputs.attached.keyboard;f&&(f.keysLeft=O)}get keysRight(){const O=this.inputs.attached.keyboard;return O?O.keysRight:[]}set keysRight(O){const f=this.inputs.attached.keyboard;f&&(f.keysRight=O)}get keysRotateLeft(){const O=this.inputs.attached.keyboard;return O?O.keysRotateLeft:[]}set keysRotateLeft(O){const f=this.inputs.attached.keyboard;f&&(f.keysRotateLeft=O)}get keysRotateRight(){const O=this.inputs.attached.keyboard;return O?O.keysRotateRight:[]}set keysRotateRight(O){const f=this.inputs.attached.keyboard;f&&(f.keysRotateRight=O)}get keysRotateUp(){const O=this.inputs.attached.keyboard;return O?O.keysRotateUp:[]}set keysRotateUp(O){const f=this.inputs.attached.keyboard;f&&(f.keysRotateUp=O)}get keysRotateDown(){const O=this.inputs.attached.keyboard;return O?O.keysRotateDown:[]}set keysRotateDown(O){const f=this.inputs.attached.keyboard;f&&(f.keysRotateDown=O)}constructor(O,f,y){var S;super(O,f,y,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),S=this,this.ellipsoid=new b.m(.5,1,.5),this.ellipsoidOffset=new b.m(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=b.m.Zero(),this._diffPosition=b.m.Zero(),this._newPosition=b.m.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;S._newPosition.p(f),S._newPosition.subtractToRef(S._oldPosition,S._diffPosition),S._diffPosition.length()>L.c.CollisionsEpsilon&&(S.position.addToRef(S._diffPosition,S._deferredPositionUpdate),S._deferOnly?S._deferredUpdated=!0:S.position.p(S._deferredPositionUpdate),S.Gk&&y&&S.Gk(y))},this.inputs=new j(this),this.inputs.addKeyboard().addMouse()}attachControl(O,f){f=m.d.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(f)}Qi(){this.inputs.detachElement(),this.cameraDirection=new b.m(0,0,0),this.cameraRotation=new b.i(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(O){this._collisionMask=isNaN(O)?-1:O}_collideWithWorld(O){let f;f=this.parent?b.m.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,f.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const y=this.va().collisionCoordinator;this._collider||(this._collider=y.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let S=O;this.applyGravity&&(S=O.add(this.va().gravity)),y.getNewPosition(this._oldPosition,S,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=b.m.Zero(),this._transformedDirection=b.m.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(O){this._needMoveForGravity=O}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"hb"}}(0,S.b)([(0,H.J)()],p.prototype,"ellipsoid",void 0),(0,S.b)([(0,H.J)()],p.prototype,"ellipsoidOffset",void 0),(0,S.b)([(0,H.L)()],p.prototype,"checkCollisions",void 0),(0,S.b)([(0,H.L)()],p.prototype,"applyGravity",void 0),(0,u.g)("BABYLON.FreeCamera",p)},12200:(O,f,y)=>{"use strict";y.d(f,{c:()=>m});var S=y(11289),H=y(11294),b=y(11561),h=y(11324),v=y(11330),N=y(11606);y(11568).c.AddNodeConstructor("TargetCamera",((O,f)=>()=>new m(O,h.m.Zero(),f)));class m extends b.c{constructor(O,f,y){super(O,f,y,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this._tmpUpVector=h.m.Zero(),this._tmpTargetVector=h.m.Zero(),this.cameraDirection=new h.m(0,0,0),this.cameraRotation=new h.i(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new h.c,this.rotation=new h.m(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=h.m.Zero(),this._initialFocalDistance=1,this._viewMatrix=h.b.Zero(),this._camMatrix=h.b.Zero(),this._cameraTransformMatrix=h.b.Zero(),this._cameraRotationMatrix=h.b.Zero(),this._referencePoint=new h.m(0,0,1),this._transformedReferencePoint=h.m.Zero(),this._deferredPositionUpdate=new h.m,this._deferredRotationQuaternionUpdate=new h.c,this._deferredRotationUpdate=new h.m,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=h.m.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(O){this.getWorldMatrix();const f=this.getTarget().xc(this.position);return f.normalize(),f.scaleInPlace(O),this.globalPosition.add(f)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const O=this.lockedTarget;O.Mj().getTranslationToRef(O.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.Xd(0,0,0),this.cameraRotation.Xd(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new h.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new h.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new h.c(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(O){O||super._updateCache();const f=this._getLockedTargetPosition();f?this._cache.lockedTarget?this._cache.lockedTarget.p(f):this._cache.lockedTarget=f.clone():this._cache.lockedTarget=null,this._cache.rotation.p(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.p(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const O=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(O):!O)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const O=this.getEngine();return this.speed*Math.sqrt(O.getDeltaTime()/(100*O.getFps()))}setTarget(O){this.upVector.normalize(),this._initialFocalDistance=O.xc(this.position).length(),this.position.z===O.z&&(this.position.z+=v.d),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),h.b.LookAtLHToRef(this.position,O,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const f=O.xc(this.position);f.x>=0?this.rotation.y=-Math.atan(f.z/f.x)+Math.PI/2:this.rotation.y=-Math.atan(f.z/f.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&h.c.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(O){this.setTarget(O)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(h.g.Matrix[0]),h.m.TransformNormalToRef(this.cameraDirection,h.g.Matrix[0],h.g.fb[0]),this._deferredPositionUpdate.addInPlace(h.g.fb[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate)}_checkInputs(){const O=this.invertRotation?-this.inverseRotationSpeed:1,f=this._decideIfNeedsToMove(),y=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.p(this.rotation),this._deferredPositionUpdate.p(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.p(this.rotationQuaternion),f&&this._updatePosition(),y){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*O,this._deferredRotationUpdate.y+=this.cameraRotation.y*O,!this.noRotationConstraint){const O=1.570796;this._deferredRotationUpdate.x>O&&(this._deferredRotationUpdate.x=O),this._deferredRotationUpdate.x<-O&&(this._deferredRotationUpdate.x=-O)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.p(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(h.c.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.p(this._deferredRotationQuaternionUpdate))}}f&&(Math.abs(this.cameraDirection.x)<this.speed*v.d&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*v.d&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*v.d&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),y&&(Math.abs(this.cameraRotation.x)<this.speed*v.d&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*v.d&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):h.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return h.m.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),h.m.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?N.c.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(h.c.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),N.c.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(O,f,y){if(this.ignoreParentScaling){if(this.parent){const S=this.parent.getWorldMatrix();h.m.TransformCoordinatesToRef(O,S,this._globalPosition),h.m.TransformCoordinatesToRef(f,S,this._tmpTargetVector),h.m.TransformNormalToRef(y,S,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.p(O),this._tmpTargetVector.p(f),this._tmpUpVector.p(y);this.va().useRightHandedSystem?h.b.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):h.b.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.va().useRightHandedSystem?h.b.LookAtRHToRef(O,f,y,this._viewMatrix):h.b.LookAtLHToRef(O,f,y,this._viewMatrix),this.parent){const O=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(O,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.p(O)}createRigCamera(O,f){if(this.cameraRigMode!==b.c.RIG_MODE_NONE){const f=new m(O,this.position.clone(),this.va());return f.isRigCamera=!0,f.rigParent=this,this.cameraRigMode===b.c.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new h.c),f._cameraRigParams={},f.rotationQuaternion=new h.c),f.mode=this.mode,f.orthoLeft=this.orthoLeft,f.orthoRight=this.orthoRight,f.orthoTop=this.orthoTop,f.orthoBottom=this.orthoBottom,f}return null}_updateRigCameras(){const O=this._rigCameras[0],f=this._rigCameras[1];switch(this.Mj(),this.cameraRigMode){case b.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case b.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case b.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case b.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case b.c.RIG_MODE_STEREOSCOPIC_INTERLACED:{const y=this.cameraRigMode===b.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,S=this.cameraRigMode===b.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*y,O),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*S,f);break}case b.c.RIG_MODE_VR:O.rotationQuaternion?(O.rotationQuaternion.p(this.rotationQuaternion),f.rotationQuaternion.p(this.rotationQuaternion)):(O.rotation.p(this.rotation),f.rotation.p(this.rotation)),O.position.p(this.position),f.position.p(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(O,f){this.getTarget().subtractToRef(this.position,m._TargetFocalPoint),m._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const y=m._TargetFocalPoint.addInPlace(this.position);h.b.TranslationToRef(-y.x,-y.y,-y.z,m._TargetTransformMatrix),m._TargetTransformMatrix.multiplyToRef(h.b.RotationAxis(f.upVector,O),m._RigCamTransformMatrix),h.b.TranslationToRef(y.x,y.y,y.z,m._TargetTransformMatrix),m._RigCamTransformMatrix.multiplyToRef(m._TargetTransformMatrix,m._RigCamTransformMatrix),h.m.TransformCoordinatesToRef(this.position,m._RigCamTransformMatrix,f.position),f.setTarget(y)}getClassName(){return"TargetCamera"}}m._RigCamTransformMatrix=new h.b,m._TargetTransformMatrix=new h.b,m._TargetFocalPoint=new h.m,(0,S.b)([(0,H.J)()],m.prototype,"rotation",void 0),(0,S.b)([(0,H.L)()],m.prototype,"speed",void 0),(0,S.b)([(0,H.w)("lockedTargetId")],m.prototype,"lockedTarget",void 0)},11463:(O,f,y)=>{"use strict";y.d(f,{b:()=>S});class S{constructor(O,f,y){this.bu=O,this.bv=f,this.distance=y,this.faceId=0,this.subMeshId=0}}},11383:(O,f,y)=>{"use strict";y.d(f,{b:()=>b});var S=y(11324),H=y(11392);class b{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(){var O;let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.pickedMesh||y&&!this.pickedMesh.isVerticesDataPresent(H.f.NormalKind))return null;let b,h=this.pickedMesh.Pf();0===(null===(O=h)||void 0===O?void 0:O.length)&&(h=null);const v=S.g.fb[0],N=S.g.fb[1],m=S.g.fb[2];if(y){const O=this.pickedMesh.getVerticesData(H.f.NormalKind);let f=h?S.m.FromArrayToRef(O,3*h[3*this.faceId],v):v.Xd(O[3*this.faceId*3],O[3*this.faceId*3+1],O[3*this.faceId*3+2]),y=h?S.m.FromArrayToRef(O,3*h[3*this.faceId+1],N):N.Xd(O[3*(3*this.faceId+1)],O[3*(3*this.faceId+1)+1],O[3*(3*this.faceId+1)+2]),t=h?S.m.FromArrayToRef(O,3*h[3*this.faceId+2],m):m.Xd(O[3*(3*this.faceId+2)],O[3*(3*this.faceId+2)+1],O[3*(3*this.faceId+2)+2]);f=f.scale(this.bu),y=y.scale(this.bv),t=t.scale(1-this.bu-this.bv),b=new S.m(f.x+y.x+t.x,f.y+y.y+t.y,f.z+y.z+t.z)}else{const O=this.pickedMesh.getVerticesData(H.f.PositionKind),f=h?S.m.FromArrayToRef(O,3*h[3*this.faceId],v):v.Xd(O[3*this.faceId*3],O[3*this.faceId*3+1],O[3*this.faceId*3+2]),y=h?S.m.FromArrayToRef(O,3*h[3*this.faceId+1],N):N.Xd(O[3*(3*this.faceId+1)],O[3*(3*this.faceId+1)+1],O[3*(3*this.faceId+1)+2]),t=h?S.m.FromArrayToRef(O,3*h[3*this.faceId+2],m):m.Xd(O[3*(3*this.faceId+2)],O[3*(3*this.faceId+2)+1],O[3*(3*this.faceId+2)+2]),q=f.xc(y),F=t.xc(y);b=S.m.Cross(q,F)}const t=(O,f)=>{let y=O.getWorldMatrix();O.nonUniformScaling&&(S.g.Matrix[0].p(y),y=S.g.Matrix[0],y.setTranslationFromFloats(0,0,0),y.invert(),y.transposeToRef(S.g.Matrix[1]),y=S.g.Matrix[1]),S.m.TransformNormalToRef(f,y,f)};if(f&&t(this.pickedMesh,b),this.ray){const O=S.g.fb[0].p(b);f||t(this.pickedMesh,O),S.m.Dot(O,this.ray.direction)>0&&b.negateInPlace()}return b.normalize(),b}getTextureCoordinates(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:H.f.UVKind;if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(O))return null;const f=this.pickedMesh.Pf();if(!f)return null;const y=this.pickedMesh.getVerticesData(O);if(!y)return null;let b=S.i.Ng(y,2*f[3*this.faceId]),h=S.i.Ng(y,2*f[3*this.faceId+1]),v=S.i.Ng(y,2*f[3*this.faceId+2]);return b=b.scale(this.bu),h=h.scale(this.bv),v=v.scale(1-this.bu-this.bv),new S.i(b.x+h.x+v.x,b.y+h.y+v.y)}}},11526:(O,f,y)=>{"use strict";y.d(f,{b:()=>S});let S=!1},12683:(O,f,y)=>{"use strict";y.d(f,{c:()=>b});var S=y(11302),H=y(12691);class b{constructor(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=y,this.ki=[],this._maxBlockCapacity=f||64,this._selectionContent=new S.c(1024),this._creationFunc=O}update(O,f,y){H.e._CreateBlocks(O,f,y,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}ji(O){for(let f=0;f<this.sh.length;f++){this.sh[f].addEntry(O)}}xd(O){for(let f=0;f<this.sh.length;f++){this.sh[f].removeEntry(O)}}select(O,f){this._selectionContent.reset();for(let y=0;y<this.sh.length;y++){this.sh[y].select(O,this._selectionContent,f)}return f?this._selectionContent.concat(this.ki):this._selectionContent.concatWithNoDuplicate(this.ki),this._selectionContent}intersects(O,f,y){this._selectionContent.reset();for(let S=0;S<this.sh.length;S++){this.sh[S].intersects(O,f,this._selectionContent,y)}return y?this._selectionContent.concat(this.ki):this._selectionContent.concatWithNoDuplicate(this.ki),this._selectionContent}intersectsRay(O){this._selectionContent.reset();for(let f=0;f<this.sh.length;f++){this.sh[f].intersectsRay(O,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.ki),this._selectionContent}}b.CreationFuncForMeshes=(O,f)=>{const y=O.getBoundingInfo();!O.isBlocked&&y.boundingBox.intersectsMinMax(f.oi,f.pi)&&f.entries.push(O)},b.CreationFuncForSubMeshes=(O,f)=>{O.getBoundingInfo().boundingBox.intersectsMinMax(f.oi,f.pi)&&f.entries.push(O)}},12691:(O,f,y)=>{"use strict";y.d(f,{e:()=>b});var S=y(11324),H=y(11470);class b{constructor(O,f,y,S,H,b){this.entries=[],this.qi=new Array,this._capacity=y,this._depth=S,this._maxDepth=H,this._creationFunc=b,this._minPoint=O,this._maxPoint=f,this.qi.push(O.clone()),this.qi.push(f.clone()),this.qi.push(O.clone()),this.qi[2].x=f.x,this.qi.push(O.clone()),this.qi[3].y=f.y,this.qi.push(O.clone()),this.qi[4].z=f.z,this.qi.push(f.clone()),this.qi[5].z=O.z,this.qi.push(f.clone()),this.qi[6].x=O.x,this.qi.push(f.clone()),this.qi[7].y=O.y}get kb(){return this._capacity}get oi(){return this._minPoint}get pi(){return this._maxPoint}addEntry(O){if(this.sh)for(let f=0;f<this.sh.length;f++){this.sh[f].addEntry(O)}else this._creationFunc(O,this),this.entries.length>this.kb&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(O){if(this.sh){for(let f=0;f<this.sh.length;f++){this.sh[f].removeEntry(O)}return}const f=this.entries.indexOf(O);f>-1&&this.entries.splice(f,1)}addEntries(O){for(let f=0;f<O.length;f++){const y=O[f];this.addEntry(y)}}select(O,f,y){if(H.c.IsInFrustum(this.qi,O)){if(this.sh){for(let S=0;S<this.sh.length;S++){this.sh[S].select(O,f,y)}return}y?f.concat(this.entries):f.concatWithNoDuplicate(this.entries)}}intersects(O,f,y,S){if(H.c.IntersectsSphere(this._minPoint,this._maxPoint,O,f)){if(this.sh){for(let H=0;H<this.sh.length;H++){this.sh[H].intersects(O,f,y,S)}return}S?y.concat(this.entries):y.concatWithNoDuplicate(this.entries)}}intersectsRay(O,f){if(O.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.sh){for(let y=0;y<this.sh.length;y++){this.sh[y].intersectsRay(O,f)}return}f.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){b._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(O,f,y,H,h,v,N,m){N.sh=new Array;const t=new S.m((f.x-O.x)/2,(f.y-O.y)/2,(f.z-O.z)/2);for(let S=0;S<2;S++)for(let f=0;f<2;f++)for(let q=0;q<2;q++){const F=O.add(t.multiplyByFloats(S,f,q)),I=O.add(t.multiplyByFloats(S+1,f+1,q+1)),A=new b(F,I,H,h+1,v,m);A.addEntries(y),N.sh.push(A)}}}},12693:(O,f,y)=>{"use strict";y.d(f,{e:()=>t});var S=y(11311),H=y(11324),b=y(11593),h=y(11917),v=y(11402),N=y(12683),m=y(11042);S.c.prototype.createOrUpdateSelectionOctree=function(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,y=this._getComponent(v.b.NAME_OCTREE);y||(y=new t(this),this.o(y)),this.hi||(this.hi=new N.c(N.c.CreationFuncForMeshes,O,f));const S=this.getWorldExtends();return this.hi.update(S.min,S.max,this.meshes),this.hi},Object.defineProperty(S.c.prototype,"selectionOctree",{get:function(){return this.hi},enumerable:!0,configurable:!0}),b.c.prototype.createOrUpdateSubmeshesOctree=function(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const y=this.va();let S=y._getComponent(v.b.NAME_OCTREE);S||(S=new t(y),y.o(S)),this._submeshesOctree||(this._submeshesOctree=new N.c(N.c.CreationFuncForSubMeshes,O,f)),this.Mj(!0);const H=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(H.minimumWorld,H.maximumWorld,this.Yf),this._submeshesOctree};class t{constructor(O){this.name=v.b.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new h.d(H.m.Zero(),new H.m(1,1,1)),(O=O||m.c.LastCreatedScene)&&(this.yd=O,this.yd.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.yd.getActiveSubMeshCandidates=O=>this.getActiveSubMeshCandidates(O),this.yd.getCollidingSubMeshCandidates=(O,f)=>this.getCollidingSubMeshCandidates(O,f),this.yd.getIntersectingSubMeshCandidates=(O,f)=>this.getIntersectingSubMeshCandidates(O,f))}register(){this.yd.onMeshRemovedObservable.add((O=>{const f=this.yd.selectionOctree;if(void 0!==f&&null!==f){const y=f.ki.indexOf(O);-1!==y&&f.ki.splice(y,1)}})),this.yd.onMeshImportedObservable.add((O=>{const f=this.yd.selectionOctree;void 0!==f&&null!==f&&f.ji(O)}))}getActiveMeshCandidates(){var O;return(null===(O=this.yd.hi)||void 0===O?void 0:O.select(this.yd.frustumPlanes))||this.yd._getDefaultMeshCandidates()}getActiveSubMeshCandidates(O){if(O._submeshesOctree&&O.useOctreeForRenderingSelection){return O._submeshesOctree.select(this.yd.frustumPlanes)}return this.yd._getDefaultSubMeshCandidates(O)}getIntersectingSubMeshCandidates(O,f){if(O._submeshesOctree&&O.useOctreeForPicking){h.d.TransformToRef(f,O.getWorldMatrix(),this._tempRay);return O._submeshesOctree.intersectsRay(this._tempRay)}return this.yd._getDefaultSubMeshCandidates(O)}getCollidingSubMeshCandidates(O,f){if(O._submeshesOctree&&O.useOctreeForCollisions){const y=f._velocityWorldLength+Math.max(f._radius.x,f._radius.y,f._radius.z);return O._submeshesOctree.intersects(f._basePointWorld,y)}return this.yd._getDefaultSubMeshCandidates(O)}rebuild(){}dispose(){}}},11470:(O,f,y)=>{"use strict";y.d(f,{c:()=>h});var S=y(11338),H=y(11324),b=y(11330);class h{constructor(O,f,y){this.vectors=(0,S.d)(8,H.m.Zero),this.center=H.m.Zero(),this.centerWorld=H.m.Zero(),this.extendSize=H.m.Zero(),this.extendSizeWorld=H.m.Zero(),this.directions=(0,S.d)(3,H.m.Zero),this.vectorsWorld=(0,S.d)(8,H.m.Zero),this.minimumWorld=H.m.Zero(),this.maximumWorld=H.m.Zero(),this.minimum=H.m.Zero(),this.maximum=H.m.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(O,f,y)}reConstruct(O,f,y){const S=O.x,b=O.y,h=O.z,v=f.x,N=f.y,m=f.z,t=this.vectors;this.minimum.Xd(S,b,h),this.maximum.Xd(v,N,m),t[0].Xd(S,b,h),t[1].Xd(v,N,m),t[2].Xd(v,b,h),t[3].Xd(S,N,h),t[4].Xd(S,b,m),t[5].Xd(v,N,h),t[6].Xd(S,N,m),t[7].Xd(v,b,m),f.addToRef(O,this.center).scaleInPlace(.5),f.subtractToRef(O,this.extendSize).scaleInPlace(.5),this._worldMatrix=y||H.b.IdentityReadOnly,this._update(this._worldMatrix)}scale(O){const f=h._TmpVector3,y=this.maximum.subtractToRef(this.minimum,f[0]),S=y.length();y.normalizeFromLength(S);const H=S*O,b=y.scaleInPlace(.5*H),v=this.center.subtractToRef(b,f[1]),N=this.center.addToRef(b,f[2]);return this.reConstruct(v,N,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(O){const f=this.minimumWorld,y=this.maximumWorld,S=this.directions,b=this.vectorsWorld,h=this.vectors;if(O.isIdentity()){f.p(this.minimum),y.p(this.maximum);for(let O=0;O<8;++O)b[O].p(h[O]);this.extendSizeWorld.p(this.extendSize),this.centerWorld.p(this.center)}else{f.Wd(Number.MAX_VALUE),y.Wd(-Number.MAX_VALUE);for(let S=0;S<8;++S){const v=b[S];H.m.TransformCoordinatesToRef(h[S],O,v),f.minimizeInPlace(v),y.maximizeInPlace(v)}y.subtractToRef(f,this.extendSizeWorld).scaleInPlace(.5),y.addToRef(f,this.centerWorld).scaleInPlace(.5)}H.m.FromArrayToRef(O.m,0,S[0]),H.m.FromArrayToRef(O.m,4,S[1]),H.m.FromArrayToRef(O.m,8,S[2]),this._worldMatrix=O}isInFrustum(O){return h.IsInFrustum(this.vectorsWorld,O)}isCompletelyInFrustum(O){return h.IsCompletelyInFrustum(this.vectorsWorld,O)}intersectsPoint(O){const f=this.minimumWorld,y=this.maximumWorld,S=f.x,H=f.y,h=f.z,v=y.x,N=y.y,m=y.z,t=O.x,q=O.y,F=O.z,I=-b.d;return!(v-t<I||I>t-S)&&(!(N-q<I||I>q-H)&&!(m-F<I||I>F-h))}intersectsSphere(O){return h.IntersectsSphere(this.minimumWorld,this.maximumWorld,O.centerWorld,O.radiusWorld)}intersectsMinMax(O,f){const y=this.minimumWorld,S=this.maximumWorld,H=y.x,b=y.y,h=y.z,v=S.x,N=S.y,m=S.z,t=O.x,q=O.y,F=O.z,I=f.x,A=f.y,J=f.z;return!(v<t||H>I)&&(!(N<q||b>A)&&!(m<F||h>J))}dispose(){var O,f;null===(O=this._drawWrapperFront)||void 0===O||O.dispose(),null===(f=this._drawWrapperBack)||void 0===f||f.dispose()}static Intersects(O,f){return O.intersectsMinMax(f.minimumWorld,f.maximumWorld)}static IntersectsSphere(O,f,y,S){const b=h._TmpVector3[0];H.m.ClampToRef(y,O,f,b);return H.m.DistanceSquared(y,b)<=S*S}static IsCompletelyInFrustum(O,f){for(let y=0;y<6;++y){const S=f[y];for(let f=0;f<8;++f)if(S.dotCoordinate(O[f])<0)return!1}return!0}static IsInFrustum(O,f){for(let y=0;y<6;++y){let S=!0;const H=f[y];for(let f=0;f<8;++f)if(H.dotCoordinate(O[f])>=0){S=!1;break}if(S)return!1}return!0}}h._TmpVector3=(0,S.d)(3,H.m.Zero)},11466:(O,f,y)=>{"use strict";y.d(f,{e:()=>q});var S=y(11338),H=y(11324),b=y(11470),h=y(11475);const v={min:0,max:0},N={min:0,max:0},m=(O,f,y)=>{const S=H.m.Dot(f.centerWorld,O),b=Math.abs(H.m.Dot(f.directions[0],O))*f.extendSize.x+Math.abs(H.m.Dot(f.directions[1],O))*f.extendSize.y+Math.abs(H.m.Dot(f.directions[2],O))*f.extendSize.z;y.min=S-b,y.max=S+b},t=(O,f,y)=>(m(O,f,v),m(O,y,N),!(v.min>N.max||N.min>v.max));class q{constructor(O,f,y){this._isLocked=!1,this.boundingBox=new b.c(O,f,y),this.boundingSphere=new h.e(O,f,y)}reConstruct(O,f,y){this.boundingBox.reConstruct(O,f,y),this.boundingSphere.reConstruct(O,f,y)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(O){this._isLocked=O}update(O){this._isLocked||(this.boundingBox._update(O),this.boundingSphere._update(O))}centerOn(O,f){const y=q._TmpVector3[0].p(O).ni(f),S=q._TmpVector3[1].p(O).addInPlace(f);return this.boundingBox.reConstruct(y,S,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(y,S,this.boundingBox.getWorldMatrix()),this}encapsulate(O){const f=H.m.Minimize(this.minimum,O),y=H.m.Maximize(this.maximum,O);return this.reConstruct(f,y,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(O){const f=H.g.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(f);const y=H.g.fb[0];return H.m.TransformCoordinatesToRef(O.boundingBox.minimumWorld,f,y),this.encapsulate(y),H.m.TransformCoordinatesToRef(O.boundingBox.maximumWorld,f,y),this.encapsulate(y),this}scale(O){return this.boundingBox.scale(O),this.boundingSphere.scale(O),this}isInFrustum(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===f||3===f)&&this.boundingSphere.isCenterInFrustum(O))return!0;if(!this.boundingSphere.isInFrustum(O))return!1;return!(1!==f&&3!==f)||this.boundingBox.isInFrustum(O)}get diagonalLength(){const O=this.boundingBox;return O.maximumWorld.subtractToRef(O.minimumWorld,q._TmpVector3[0]).length()}isCompletelyInFrustum(O){return this.boundingBox.isCompletelyInFrustum(O)}_checkCollision(O){return O._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(O){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(O)&&!!this.boundingBox.intersectsPoint(O))}intersects(O,f){if(!h.e.Intersects(this.boundingSphere,O.boundingSphere))return!1;if(!b.c.Intersects(this.boundingBox,O.boundingBox))return!1;if(!f)return!0;const y=this.boundingBox,S=O.boundingBox;return!!t(y.directions[0],y,S)&&(!!t(y.directions[1],y,S)&&(!!t(y.directions[2],y,S)&&(!!t(S.directions[0],y,S)&&(!!t(S.directions[1],y,S)&&(!!t(S.directions[2],y,S)&&(!!t(H.m.Cross(y.directions[0],S.directions[0]),y,S)&&(!!t(H.m.Cross(y.directions[0],S.directions[1]),y,S)&&(!!t(H.m.Cross(y.directions[0],S.directions[2]),y,S)&&(!!t(H.m.Cross(y.directions[1],S.directions[0]),y,S)&&(!!t(H.m.Cross(y.directions[1],S.directions[1]),y,S)&&(!!t(H.m.Cross(y.directions[1],S.directions[2]),y,S)&&(!!t(H.m.Cross(y.directions[2],S.directions[0]),y,S)&&(!!t(H.m.Cross(y.directions[2],S.directions[1]),y,S)&&!!t(H.m.Cross(y.directions[2],S.directions[2]),y,S))))))))))))))}}q._TmpVector3=(0,S.d)(2,H.m.Zero)},11475:(O,f,y)=>{"use strict";y.d(f,{e:()=>b});var S=y(11338),H=y(11324);class b{constructor(O,f,y){this.center=H.m.Zero(),this.centerWorld=H.m.Zero(),this.minimum=H.m.Zero(),this.maximum=H.m.Zero(),this.reConstruct(O,f,y)}reConstruct(O,f,y){this.minimum.p(O),this.maximum.p(f);const S=H.m.Distance(O,f);f.addToRef(O,this.center).scaleInPlace(.5),this.radius=.5*S,this._update(y||H.b.IdentityReadOnly)}scale(O){const f=this.radius*O,y=b._TmpVector3,S=y[0].Wd(f),H=this.center.subtractToRef(S,y[1]),h=this.center.addToRef(S,y[2]);return this.reConstruct(H,h,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(O){if(O.isIdentity())this.centerWorld.p(this.center),this.radiusWorld=this.radius;else{H.m.TransformCoordinatesToRef(this.center,O,this.centerWorld);const f=b._TmpVector3[0];H.m.TransformNormalFromFloatsToRef(1,1,1,O,f),this.radiusWorld=Math.max(Math.abs(f.x),Math.abs(f.y),Math.abs(f.z))*this.radius}}isInFrustum(O){const f=this.centerWorld,y=this.radiusWorld;for(let S=0;S<6;S++)if(O[S].dotCoordinate(f)<=-y)return!1;return!0}isCenterInFrustum(O){const f=this.centerWorld;for(let y=0;y<6;y++)if(O[y].dotCoordinate(f)<0)return!1;return!0}intersectsPoint(O){const f=H.m.DistanceSquared(this.centerWorld,O);return!(this.radiusWorld*this.radiusWorld<f)}static Intersects(O,f){const y=H.m.DistanceSquared(O.centerWorld,f.centerWorld),S=O.radiusWorld+f.radiusWorld;return!(S*S<y)}static CreateFromCenterAndRadius(O,f,y){this._TmpVector3[0].p(O),this._TmpVector3[1].Xd(0,0,f),this._TmpVector3[2].p(O),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].ni(this._TmpVector3[1]);const S=new b(this._TmpVector3[0],this._TmpVector3[2]);return S._worldMatrix=y||H.b.Identity(),S}}b._TmpVector3=(0,S.d)(3,H.m.Zero)},11917:(O,f,y)=>{"use strict";y.d(f,{d:()=>I});var S=y(11311),H=y(11561),b=y(11330),h=y(11324),v=y(11338),N=y(11463),m=y(11383),t=y(11042),q=y(11423);const F={internalPickerForMesh:void 0};class I{constructor(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:b.d;this.origin=O,this.direction=f,this.length=y,this.epsilon=S}clone(){return new I(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const S=I._TmpVector3[0].Xd(O.x-y,O.y-y,O.z-y),H=I._TmpVector3[1].Xd(f.x+y,f.y+y,f.z+y);let b,h,v,N,m=0,t=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<S.x||this.origin.x>H.x)return!1}else if(b=1/this.direction.x,h=(S.x-this.origin.x)*b,v=(H.x-this.origin.x)*b,v===-1/0&&(v=1/0),h>v&&(N=h,h=v,v=N),m=Math.max(h,m),t=Math.min(v,t),m>t)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<S.y||this.origin.y>H.y)return!1}else if(b=1/this.direction.y,h=(S.y-this.origin.y)*b,v=(H.y-this.origin.y)*b,v===-1/0&&(v=1/0),h>v&&(N=h,h=v,v=N),m=Math.max(h,m),t=Math.min(v,t),m>t)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<S.z||this.origin.z>H.z)return!1}else if(b=1/this.direction.z,h=(S.z-this.origin.z)*b,v=(H.z-this.origin.z)*b,v===-1/0&&(v=1/0),h>v&&(N=h,h=v,v=N),m=Math.max(h,m),t=Math.min(v,t),m>t)return!1;return!0}intersectsBox(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(O.minimum,O.maximum,f)}intersectsSphere(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const y=O.center.x-this.origin.x,S=O.center.y-this.origin.y,H=O.center.z-this.origin.z,b=y*y+S*S+H*H,h=O.radius+f,v=h*h;if(b<=v)return!0;const N=y*this.direction.x+S*this.direction.y+H*this.direction.z;if(N<0)return!1;return b-N*N<=v}intersectsTriangle(O,f,y){const S=I._TmpVector3[0],H=I._TmpVector3[1],b=I._TmpVector3[2],v=I._TmpVector3[3],m=I._TmpVector3[4];f.subtractToRef(O,S),y.subtractToRef(O,H),h.m.CrossToRef(this.direction,H,b);const t=h.m.Dot(S,b);if(0===t)return null;const q=1/t;this.origin.subtractToRef(O,v);const F=h.m.Dot(v,b)*q;if(F<-this.epsilon||F>1+this.epsilon)return null;h.m.CrossToRef(v,S,m);const A=h.m.Dot(this.direction,m)*q;if(A<-this.epsilon||F+A>1+this.epsilon)return null;const J=h.m.Dot(H,m)*q;return J>this.length?null:new N.b(1-F-A,F,J)}intersectsPlane(O){let f;const y=h.m.Dot(O.k,this.direction);if(Math.abs(y)<9.99999997475243e-7)return null;{const S=h.m.Dot(O.k,this.origin);return f=(-O.d-S)/y,f<0?f<-9.99999997475243e-7?null:0:f}}intersectsAxis(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(O){case"y":{const O=(this.origin.y-f)/this.direction.y;return O>0?null:new h.m(this.origin.x+this.direction.x*-O,f,this.origin.z+this.direction.z*-O)}case"x":{const O=(this.origin.x-f)/this.direction.x;return O>0?null:new h.m(f,this.origin.y+this.direction.y*-O,this.origin.z+this.direction.z*-O)}case"z":{const O=(this.origin.z-f)/this.direction.z;return O>0?null:new h.m(this.origin.x+this.direction.x*-O,this.origin.y+this.direction.y*-O,f)}default:return null}}intersectsMesh(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],H=arguments.length>4?arguments[4]:void 0,b=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const v=h.g.Matrix[0];return O.getWorldMatrix().invertToRef(v),this._tmpRay?I.TransformToRef(this,v,this._tmpRay):this._tmpRay=I.Transform(this,v),O.intersects(this._tmpRay,f,y,S,H,b)}intersectsMeshes(O,f,y){y?y.length=0:y=[];for(let S=0;S<O.length;S++){const H=this.intersectsMesh(O[S],f);H.hit&&y.push(H)}return y.sort(this._comparePickingInfo),y}_comparePickingInfo(O,f){return O.distance<f.distance?-1:O.distance>f.distance?1:0}intersectionSegment(O,f,y){const S=this.origin,H=h.g.fb[0],b=h.g.fb[1],v=h.g.fb[2],N=h.g.fb[3];f.subtractToRef(O,H),this.direction.scaleToRef(I._Rayl,v),S.addToRef(v,b),O.subtractToRef(S,N);const m=h.m.Dot(H,H),t=h.m.Dot(H,v),q=h.m.Dot(v,v),F=h.m.Dot(H,N),A=h.m.Dot(v,N),J=m*q-t*t;let X,w,B=J,j=J;J<I._Smallnum?(X=0,B=1,w=A,j=q):(X=t*A-q*F,w=m*A-t*F,X<0?(X=0,w=A,j=q):X>B&&(X=B,w=A+t,j=q)),w<0?(w=0,-F<0?X=0:-F>m?X=B:(X=-F,B=m)):w>j&&(w=j,-F+t<0?X=0:-F+t>m?X=B:(X=-F+t,B=m));const u=Math.abs(X)<I._Smallnum?0:X/B,L=Math.abs(w)<I._Smallnum?0:w/j,p=h.g.fb[4];v.scaleToRef(L,p);const U=h.g.fb[5];H.scaleToRef(u,U),U.addInPlace(N);const l=h.g.fb[6];U.subtractToRef(p,l);return L>0&&L<=this.length&&l.lengthSquared()<y*y?U.length():-1}update(O,f,y,S,H,b,v){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){I._RayDistant||(I._RayDistant=I.Zero()),I._RayDistant.unprojectRayToRef(O,f,y,S,h.b.IdentityReadOnly,b,v);const N=h.g.Matrix[0];H.invertToRef(N),I.TransformToRef(I._RayDistant,N,this)}else this.unprojectRayToRef(O,f,y,S,H,b,v);return this}static Zero(){return new I(h.m.Zero(),h.m.Zero())}static CreateNew(O,f,y,S,H,b,h){return I.Zero().update(O,f,y,S,H,b,h)}static CreateNewFromTo(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h.b.IdentityReadOnly;const S=new I(new h.m(0,0,0),new h.m(0,0,0));return I.CreateFromToToRef(O,f,S,y)}static CreateFromToToRef(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:h.b.IdentityReadOnly;y.origin.p(O);const H=f.subtractToRef(O,y.direction),b=Math.sqrt(H.x*H.x+H.y*H.y+H.z*H.z);return y.length=b,y.direction.normalize(),I.TransformToRef(y,S,y)}static Transform(O,f){const y=new I(new h.m(0,0,0),new h.m(0,0,0));return I.TransformToRef(O,f,y),y}static TransformToRef(O,f,y){h.m.TransformCoordinatesToRef(O.origin,f,y.origin),h.m.TransformNormalToRef(O.direction,f,y.direction),y.length=O.length,y.epsilon=O.epsilon;const S=y.direction,H=S.length();if(0!==H&&1!==H){const O=1/H;S.x*=O,S.y*=O,S.z*=O,y.length*=H}return y}unprojectRayToRef(O,f,y,S,H,b,v){const N=h.g.Matrix[0];H.multiplyToRef(b,N),N.multiplyToRef(v,N),N.invert();const m=t.c.LastCreatedEngine,q=h.g.fb[0];q.x=O/y*2-1,q.y=-(f/S*2-1),q.z=null!==m&&void 0!==m&&m.useReverseDepthBuffer?1:null!==m&&void 0!==m&&m.isNDCHalfZRange?0:-1;const F=h.g.fb[1].Xd(q.x,q.y,1-1e-8),I=h.g.fb[2],A=h.g.fb[3];h.m._UnprojectFromInvertedMatrixToRef(q,N,I),h.m._UnprojectFromInvertedMatrixToRef(F,N,A),this.origin.p(I),A.subtractToRef(I,this.direction),this.direction.normalize()}}function A(O,f,y,S,H){let b=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const h=I.Zero();return J(O,f,y,S,h,H,b),h}function J(O,f,y,S,H,b){let v=arguments.length>6&&void 0!==arguments[6]&&arguments[6],N=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const m=O.getEngine();if(!b&&!(b=O.activeCamera))return O;const t=b.viewport,q=m.getRenderHeight(),{x:F,y:I,width:A,height:J}=t.toGlobal(m.getRenderWidth(),q),X=1/m.getHardwareScalingLevel();return f=f*X-F,y=y*X-(q-I-J),H.update(f,y,A,J,S||h.b.IdentityReadOnly,v?h.b.IdentityReadOnly:b.getViewMatrix(),b.getProjectionMatrix(),N),O}function X(O,f,y,S,H){if(!m.b)return O;const b=O.getEngine();if(!H&&!(H=O.activeCamera))throw new Error("Active camera not set");const v=H.viewport,N=b.getRenderHeight(),{x:t,y:q,width:F,height:I}=v.toGlobal(b.getRenderWidth(),N),A=h.b.Identity(),J=1/b.getHardwareScalingLevel();return f=f*J-t,y=y*J-(N-q-I),S.update(f,y,F,I,A,A,H.getProjectionMatrix()),O}function w(O,f,y,S,H,b,h,v){const N=f(S,y.enableDistantPicking),m=y.intersects(N,H,h,b,S,v);return m&&m.hit?!H&&null!=O&&m.distance>=O.distance?null:m:null}function B(O,f,y,S,H,b){let v=null;const N=!!(O.activeCameras&&O.activeCameras.length>1&&O.cameraToUseForPointers!==O.activeCamera),t=O.cameraToUseForPointers||O.activeCamera,q=F.internalPickerForMesh||w;for(let m=0;m<O.meshes.length;m++){const F=O.meshes[m];if(y){if(!y(F,-1))continue}else if(!F.isEnabled()||!F.isVisible||!F.Mb)continue;const I=N&&F.isWorldMatrixCameraDependent(),A=F.Mj(I,t);if(F.hasThinInstances&&F.thinInstanceEnablePicking){const O=q(v,f,F,A,!0,!0,b);if(O){if(H)return O;const N=h.g.Matrix[1],m=F.thinInstanceGetWorldMatrices();for(let O=0;O<m.length;O++){if(y&&!y(F,O))continue;m[O].multiplyToRef(A,N);const h=q(v,f,F,N,S,H,b,!0);if(h&&(v=h,v.thinInstanceIndex=O,S))return v}}}else{const O=q(v,f,F,A,S,H,b);if(O&&(v=O,S))return v}}return v||new m.b}function j(O,f,y,S){if(!m.b)return null;const H=[],b=!!(O.activeCameras&&O.activeCameras.length>1&&O.cameraToUseForPointers!==O.activeCamera),v=O.cameraToUseForPointers||O.activeCamera,N=F.internalPickerForMesh||w;for(let m=0;m<O.meshes.length;m++){const t=O.meshes[m];if(y){if(!y(t,-1))continue}else if(!t.isEnabled()||!t.isVisible||!t.Mb)continue;const q=b&&t.isWorldMatrixCameraDependent(),F=t.Mj(q,v);if(t.hasThinInstances&&t.thinInstanceEnablePicking){if(N(null,f,t,F,!0,!0,S)){const O=h.g.Matrix[1],b=t.thinInstanceGetWorldMatrices();for(let h=0;h<b.length;h++){if(y&&!y(t,h))continue;b[h].multiplyToRef(F,O);const v=N(null,f,t,O,!1,!1,S,!0);v&&(v.thinInstanceIndex=h,H.push(v))}}}else{const O=N(null,f,t,F,!1,!1,S);O&&H.push(O)}}return H}function u(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,S=arguments.length>3?arguments[3]:void 0,H=arguments.length>4?arguments[4]:void 0;S||(S=O.getWorldMatrix()),f.length=y,H?f.origin.p(H):f.origin.p(O.position);const b=h.g.fb[2];b.set(0,0,O._scene.useRightHandedSystem?-1:1);const v=h.g.fb[3];return h.m.TransformNormalToRef(b,S,v),h.m.NormalizeToRef(v,f.direction),f}var L,p;I._TmpVector3=(0,v.d)(6,h.m.Zero),I._RayDistant=I.Zero(),I._Smallnum=1e-8,I._Rayl=1e9,L=S.c,(p=H.c)&&(p.prototype.getForwardRay=function(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,f=arguments.length>1?arguments[1]:void 0,y=arguments.length>2?arguments[2]:void 0;return u(this,new I(h.m.Zero(),h.m.Zero(),O),O,f,y)},p.prototype.getForwardRayToRef=function(O){return u(this,O,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),L&&(q.d._IsPickingAvailable=!0,L.prototype.createPickingRay=function(O,f,y,S){return A(this,O,f,y,S,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),S.c.prototype.createPickingRayToRef=function(O,f,y,S,H){return J(this,O,f,y,S,H,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},S.c.prototype.createPickingRayInCameraSpace=function(O,f,y){return function(O,f,y,S){const H=I.Zero();return X(O,f,y,H,S),H}(this,O,f,y)},S.c.prototype.createPickingRayInCameraSpaceToRef=function(O,f,y,S){return X(this,O,f,y,S)},S.c.prototype.pickWithBoundingInfo=function(O,f,y,S,H){return function(O,f,y,S,H,b){if(!m.b)return null;const v=B(O,(S=>(O._tempPickingRay||(O._tempPickingRay=I.Zero()),J(O,f,y,S,O._tempPickingRay,b||null),O._tempPickingRay)),S,H,!0);return v&&(v.ray=A(O,f,y,h.b.Identity(),b||null)),v}(this,O,f,y,S,H)},S.c.prototype.mc=function(O,f,y,S,H,b){return function(O,f,y,S,H,b,v){const N=B(O,((S,H)=>(O._tempPickingRay||(O._tempPickingRay=I.Zero()),J(O,f,y,S,O._tempPickingRay,b||null,!1,H),O._tempPickingRay)),S,H,!1,v);return N&&(N.ray=A(O,f,y,h.b.Identity(),b||null)),N}(this,O,f,y,S,H,b)},S.c.prototype.pickWithRay=function(O,f,y,S){return function(O,f,y,S,H){const b=B(O,(y=>(O._pickWithRayInverseMatrix||(O._pickWithRayInverseMatrix=h.b.Identity()),y.invertToRef(O._pickWithRayInverseMatrix),O._cachedRayForTransform||(O._cachedRayForTransform=I.Zero()),I.TransformToRef(f,O._pickWithRayInverseMatrix,O._cachedRayForTransform),O._cachedRayForTransform)),y,S,!1,H);return b&&(b.ray=f),b}(this,O,f,y,S)},S.c.prototype.multiPick=function(O,f,y,S,H){return function(O,f,y,S,H,b){return j(O,(S=>A(O,f,y,S,H||null)),S,b)}(this,O,f,y,S,H)},S.c.prototype.multiPickWithRay=function(O,f,y){return function(O,f,y,S){return j(O,(y=>(O._pickWithRayInverseMatrix||(O._pickWithRayInverseMatrix=h.b.Identity()),y.invertToRef(O._pickWithRayInverseMatrix),O._cachedRayForTransform||(O._cachedRayForTransform=I.Zero()),I.TransformToRef(f,O._pickWithRayInverseMatrix,O._cachedRayForTransform),O._cachedRayForTransform)),y,S)}(this,O,f,y)}},11828:(O,f,y)=>{"use strict";var S=y(11126),H=y(11017),b=y(11051),h=y(11158),v=y(11092),N=y(11141);v.c.prototype._partialLoadFile=function(O,f,y,S){let H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(O,(O=>{y[f]=O,y._internalCount++,6===y._internalCount&&S(y)}),void 0,void 0,!0,((O,f)=>{H&&O&&H(O.status+" "+O.statusText,f)}))},v.c.prototype._cascadeLoadFiles=function(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const H=[];H._internalCount=0;for(let b=0;b<6;b++)this._partialLoadFile(y[b],b,H,f,S)},v.c.prototype._cascadeLoadImgs=function(O,f,y,S){let H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5?arguments[5]:void 0;const h=[];h._internalCount=0;for(let v=0;v<6;v++)this._partialLoadImg(S[v],v,h,O,f,y,H,b)},v.c.prototype._partialLoadImg=function(O,f,y,S,H,v){let N=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,m=arguments.length>7?arguments[7]:void 0;const t=(0,h.d)();(0,b.q)(O,(O=>{y[f]=O,y._internalCount++,S&&S.removePendingData(t),6===y._internalCount&&v&&v(H,y)}),((O,f)=>{S&&S.removePendingData(t),N&&N(O,f)}),S?S.offlineProvider:null,m),S&&S.addPendingData(t)},v.c.prototype.createCubeTextureBase=function(O,f,y,b){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,v=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,m=arguments.length>6?arguments[6]:void 0,t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,q=arguments.length>8&&void 0!==arguments[8]&&arguments[8],F=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,I=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,A=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,J=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,X=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,w=arguments.length>14&&void 0!==arguments[14]&&arguments[14],B=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const j=A||new S.c(this,7);j.isCube=!0,j.url=O,j.generateMipMaps=!b,j._lodGenerationScale=F,j._lodGenerationOffset=I,j._useSRGBBuffer=!!w&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!b),j!==A&&(j.label=O.substring(0,60)),this._doNotHandleContextLost||(j._extension=t,j._files=y,j._buffer=B);const u=O;this._transformTextureUrl&&!A&&(O=this._transformTextureUrl(O));const L=O.split("?")[0],p=L.lastIndexOf("."),U=t||(p>-1?L.substring(p).toLowerCase():""),l=(0,N.c)(U),x=(S,N)=>{O===u?v&&S&&v(S.status+" "+S.statusText,N):(H.e.Warn(`Failed to load ${O}, falling back to the ${u}`),this.createCubeTextureBase(u,f,y,!!b,h,v,m,t,q,F,I,j,J,X,w,B))};if(l)l.then((S=>{const b=O=>{J&&J(j,O),S.loadCubeData(O,j,q,h,v)};B?b(B):y&&6===y.length?S.supportCascades?this._cascadeLoadFiles(f,(O=>b(O.map((O=>new Uint8Array(O))))),y,v):v?v("Textures type does not support cascades."):H.e.Warn("Texture loader does not support cascades."):this._loadFile(O,(O=>b(new Uint8Array(O))),void 0,void 0,!0,x)}));else{if(!y||0===y.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(f,j,((O,f)=>{X&&X(O,f)}),y,v)}return this._internalTexturesCache.push(j),j}},11772:(O,f,y)=>{"use strict";y(11092).c.prototype.createDepthStencilTexture=function(O,f,y){if(f.isCube){const y=O.width||O;return this._createDepthStencilCubeTexture(y,f)}return this._createDepthStencilTexture(O,f,y)}},11751:(O,f,y)=>{"use strict";y(11712).ThinEngine.prototype.setAlphaMode=function(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._alphaMode!==O){switch(O){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}f||(this.depthCullingState.depthMask=0===O),this._alphaMode=O}else if(!f){const f=0===O;this.depthCullingState.depthMask!==f&&(this.depthCullingState.depthMask=f)}}},11707:(O,f,y)=>{"use strict";var S=y(11712);S.ThinEngine.prototype.updateDynamicIndexBuffer=function(O,f){let y;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(O),y=O.is32Bits?f instanceof Uint32Array?f:new Uint32Array(f):f instanceof Uint16Array?f:new Uint16Array(f),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,y,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},S.ThinEngine.prototype.updateDynamicVertexBuffer=function(O,f,y,S){this.bindArrayBuffer(O),void 0===y&&(y=0);const H=f.byteLength||f.length;void 0===S||S>=H&&0===y?f instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,y,new Float32Array(f)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,y,f):f instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(f).subarray(y,y+S)):(f=f instanceof ArrayBuffer?new Uint8Array(f,y,S):new Uint8Array(f.buffer,f.byteOffset+y,S),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,f)),this._resetVertexBufferBinding()}},11762:(O,f,y)=>{"use strict";var S=y(11126),H=y(11017),b=y(11712),h=y(11765);class v extends h.c{constructor(O,f,y,S,H){super(O,f,y,S),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=H}_cloneRenderTargetWrapper(){let O=null;return this._colorTextureArray&&this._depthStencilTextureArray?(O=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),O.texture.isReady=!0):O=super._cloneRenderTargetWrapper(),O}_swapRenderTargetWrapper(O){super._swapRenderTargetWrapper(O),O._framebuffer=this._framebuffer,O._depthStencilBuffer=this._depthStencilBuffer,O._MSAAFramebuffer=this._MSAAFramebuffer,O._colorTextureArray=this._colorTextureArray,O._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,b=arguments.length>5?arguments[5]:void 0;if(this._depthStencilBuffer){const O=this._engine,f=O._currentFramebuffer,y=this._context;O._bindUnboundFramebuffer(this._framebuffer),y.framebufferRenderbuffer(y.FRAMEBUFFER,y.DEPTH_STENCIL_ATTACHMENT,y.RENDERBUFFER,null),y.framebufferRenderbuffer(y.FRAMEBUFFER,y.DEPTH_ATTACHMENT,y.RENDERBUFFER,null),y.framebufferRenderbuffer(y.FRAMEBUFFER,y.STENCIL_ATTACHMENT,y.RENDERBUFFER,null),O._bindUnboundFramebuffer(f),y.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(O,f,y,S,H,b)}shareDepth(O){super.shareDepth(O);const f=this._context,y=this._depthStencilBuffer,S=O._MSAAFramebuffer||O._framebuffer,H=this._engine;O._depthStencilBuffer&&O._depthStencilBuffer!==y&&f.deleteRenderbuffer(O._depthStencilBuffer),O._depthStencilBuffer=y;const b=O._generateStencilBuffer?f.DEPTH_STENCIL_ATTACHMENT:f.DEPTH_ATTACHMENT;H._bindUnboundFramebuffer(S),f.framebufferRenderbuffer(f.FRAMEBUFFER,b,f.RENDERBUFFER,y),H._bindUnboundFramebuffer(null)}_bindTextureRenderTarget(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!O._hardwareTexture)return;const H=this._framebuffer,b=this._engine,h=b._currentFramebuffer;if(b._bindUnboundFramebuffer(H),b.webGLVersion>1){const H=this._context,b=H["COLOR_ATTACHMENT"+f];var v;if(O.is2DArray||O.is3D)y=y??(null===(v=this.layerIndices)||void 0===v?void 0:v[f])??0,H.framebufferTextureLayer(H.FRAMEBUFFER,b,O._hardwareTexture.underlyingResource,S,y);else if(O.isCube){var N;y=y??(null===(N=this.faceIndices)||void 0===N?void 0:N[f])??0,H.framebufferTexture2D(H.FRAMEBUFFER,b,H.TEXTURE_CUBE_MAP_POSITIVE_X+y,O._hardwareTexture.underlyingResource,S)}else H.framebufferTexture2D(H.FRAMEBUFFER,b,H.TEXTURE_2D,O._hardwareTexture.underlyingResource,S)}else{const H=this._context,b=H["COLOR_ATTACHMENT"+f+"_WEBGL"],h=void 0!==y?H.TEXTURE_CUBE_MAP_POSITIVE_X+y:H.TEXTURE_2D;H.framebufferTexture2D(H.FRAMEBUFFER,b,h,O._hardwareTexture.underlyingResource,S)}b._bindUnboundFramebuffer(h)}setTexture(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super.setTexture(O,f,y),this._bindTextureRenderTarget(O,f)}setLayerAndFaceIndices(O,f){var y;if(super.setLayerAndFaceIndices(O,f),!this.textures||!this.layerIndices||!this.faceIndices)return;const S=(null===(y=this._attachments)||void 0===y?void 0:y.length)??this.textures.length;for(let H=0;H<S;H++){const O=this.textures[H];O&&(O.is2DArray||O.is3D?this._bindTextureRenderTarget(O,H,this.layerIndices[H]):O.isCube?this._bindTextureRenderTarget(O,H,this.faceIndices[H]):this._bindTextureRenderTarget(O,H))}}setLayerAndFaceIndex(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1?arguments[1]:void 0,y=arguments.length>2?arguments[2]:void 0;if(super.setLayerAndFaceIndex(O,f,y),!this.textures||!this.layerIndices||!this.faceIndices)return;const S=this.textures[O];S.is2DArray||S.is3D?this._bindTextureRenderTarget(this.textures[O],O,this.layerIndices[O]):S.isCube&&this._bindTextureRenderTarget(this.textures[O],O,this.faceIndices[O])}dispose(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._disposeOnlyFramebuffers;const f=this._context;O||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(f.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(f.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(f.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(O)}}y(11772);b.ThinEngine.prototype._createHardwareRenderTargetWrapper=function(O,f,y){const S=new v(O,f,y,this,this._gl);return this._renderTargetWrapperCache.push(S),S},b.ThinEngine.prototype.createRenderTargetTexture=function(O,f){const y=this._createHardwareRenderTargetWrapper(!1,!1,O);let S,H,b=!0,h=!1,v=!1,N=1;void 0!==f&&"object"===typeof f&&(b=f.generateDepthBuffer??!0,h=!!f.generateStencilBuffer,v=!!f.noColorAttachment,S=f.colorAttachment,N=f.samples??1,H=f.label);const m=S||(v?null:this._createInternalTexture(O,f,!0,5)),t=O.width||O,q=O.height||O,F=this._currentFramebuffer,I=this._gl,A=I.createFramebuffer();if(this._bindUnboundFramebuffer(A),y._depthStencilBuffer=this._setupFramebufferDepthAttachments(h,b,t,q),!m||m.is2DArray||m.is3D||I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_2D,m._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(F),y.label=H??"RenderTargetWrapper",y._framebuffer=A,y._generateDepthBuffer=b,y._generateStencilBuffer=h,y.setTextures(m),S){if(y._samples=S.samples,S.samples>1){const O=S._hardwareTexture.getMSAARenderBuffer(0);y._MSAAFramebuffer=I.createFramebuffer(),this._bindUnboundFramebuffer(y._MSAAFramebuffer),I.framebufferRenderbuffer(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.RENDERBUFFER,O),this._bindUnboundFramebuffer(null)}}else this.updateRenderTargetTextureSampleCount(y,N);return y},b.ThinEngine.prototype._createDepthStencilTexture=function(O,f,y){const b=this._gl,h=O.layers||0,v=O.depth||0;let N=b.TEXTURE_2D;0!==h?N=b.TEXTURE_2D_ARRAY:0!==v&&(N=b.TEXTURE_3D);const m=new S.c(this,12);if(m.label=f.label,!this._caps.depthTextureExtension)return H.e.Error("Depth texture is not supported by your browser or hardware."),m;const t={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...f};if(this._bindTextureDirectly(N,m,!0),this._setupDepthStencilTexture(m,O,0!==t.comparisonFunction&&t.bilinearFiltering,t.comparisonFunction,t.samples),void 0!==t.depthTextureFormat){if(15!==t.depthTextureFormat&&16!==t.depthTextureFormat&&17!==t.depthTextureFormat&&13!==t.depthTextureFormat&&14!==t.depthTextureFormat&&18!==t.depthTextureFormat)return H.e.Error(`Depth texture ${t.depthTextureFormat} format is not supported.`),m;m.format=t.depthTextureFormat}else m.format=t.generateStencil?13:16;const q=17===m.format||13===m.format||18===m.format;let F=b.UNSIGNED_INT;15===m.format?F=b.UNSIGNED_SHORT:17===m.format||13===m.format?F=b.UNSIGNED_INT_24_8:14===m.format?F=b.FLOAT:18===m.format&&(F=b.FLOAT_32_UNSIGNED_INT_24_8_REV);const I=q?b.DEPTH_STENCIL:b.DEPTH_COMPONENT,A=this._getInternalFormatFromDepthTextureFormat(m.format,!0,q);return m.is2DArray?b.texImage3D(N,0,A,m.width,m.height,h,0,I,F,null):m.is3D?b.texImage3D(N,0,A,m.width,m.height,v,0,I,F,null):b.texImage2D(N,0,A,m.width,m.height,0,I,F,null),this._bindTextureDirectly(N,null),this._internalTexturesCache.push(m),y._depthStencilBuffer&&(b.deleteRenderbuffer(y._depthStencilBuffer),y._depthStencilBuffer=null),this._bindUnboundFramebuffer(y._MSAAFramebuffer??y._framebuffer),y._generateStencilBuffer=q,y._depthStencilTextureWithStencil=q,y._depthStencilBuffer=this._setupFramebufferDepthAttachments(y._generateStencilBuffer,y._generateDepthBuffer,y.width,y.height,y.samples,m.format),this._bindUnboundFramebuffer(null),m},b.ThinEngine.prototype.updateRenderTargetTextureSampleCount=function(O,f){var y;if(this.webGLVersion<2||!O)return 1;if(O.samples===f)return f;const S=this._gl;f=Math.min(f,this.getCaps().maxMSAASamples),O._depthStencilBuffer&&(S.deleteRenderbuffer(O._depthStencilBuffer),O._depthStencilBuffer=null),O._MSAAFramebuffer&&(S.deleteFramebuffer(O._MSAAFramebuffer),O._MSAAFramebuffer=null);const H=null===(y=O.texture)||void 0===y?void 0:y._hardwareTexture;if(null===H||void 0===H||H.releaseMSAARenderBuffers(),O.texture&&f>1&&"function"===typeof S.renderbufferStorageMultisample){const y=S.createFramebuffer();if(!y)throw new Error("Unable to create multi sampled framebuffer");O._MSAAFramebuffer=y,this._bindUnboundFramebuffer(O._MSAAFramebuffer);const b=this._createRenderBuffer(O.texture.width,O.texture.height,f,-1,this._getRGBABufferInternalSizedFormat(O.texture.type,O.texture.format,O.texture._useSRGBBuffer),S.COLOR_ATTACHMENT0,!1);if(!b)throw new Error("Unable to create multi sampled framebuffer");null===H||void 0===H||H.addMSAARenderBuffer(b)}this._bindUnboundFramebuffer(O._MSAAFramebuffer??O._framebuffer),O.texture&&(O.texture.samples=f),O._samples=f;const b=O._depthStencilTexture?O._depthStencilTexture.format:void 0;return O._depthStencilBuffer=this._setupFramebufferDepthAttachments(O._generateStencilBuffer,O._generateDepthBuffer,O.width,O.height,f,b),this._bindUnboundFramebuffer(null),f},b.ThinEngine.prototype._setupDepthStencilTexture=function(O,f,y,S){let H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const b=f.width??f,h=f.height??f,v=f.layers||0,N=f.depth||0;O.baseWidth=b,O.baseHeight=h,O.width=b,O.height=h,O.is2DArray=v>0,O.depth=v||N,O.isReady=!0,O.samples=H,O.generateMipMaps=!1,O.samplingMode=y?2:1,O.type=0,O._comparisonFunction=S;const m=this._gl,t=this._getTextureTarget(O),q=this._getSamplingParameters(O.samplingMode,!1);m.texParameteri(t,m.TEXTURE_MAG_FILTER,q.mag),m.texParameteri(t,m.TEXTURE_MIN_FILTER,q.min),m.texParameteri(t,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(t,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===S?(m.texParameteri(t,m.TEXTURE_COMPARE_FUNC,515),m.texParameteri(t,m.TEXTURE_COMPARE_MODE,m.NONE)):(m.texParameteri(t,m.TEXTURE_COMPARE_FUNC,S),m.texParameteri(t,m.TEXTURE_COMPARE_MODE,m.COMPARE_REF_TO_TEXTURE)))}},11070:(O,f,y)=>{"use strict";y.d(f,{e:()=>l,g:()=>p,h:()=>U,j:()=>V,k:()=>g});class S{constructor(){this.children=[]}isValid(O){return!0}process(O,f){let y="";if(this.line){let m=this.line;const t=f.processor;if(t){var S,H,b,h,v,N;t.lineProcessor&&(m=t.lineProcessor(m,f.isFragment,f.processingContext));const y=(null===(S=f.processor)||void 0===S?void 0:S.attributeKeywordName)??"attribute",q=f.isFragment&&null!==(H=f.processor)&&void 0!==H&&H.varyingFragmentKeywordName?null===(b=f.processor)||void 0===b?void 0:b.varyingFragmentKeywordName:!f.isFragment&&null!==(h=f.processor)&&void 0!==h&&h.varyingVertexKeywordName?null===(v=f.processor)||void 0===v?void 0:v.varyingVertexKeywordName:"varying";if(!f.isFragment&&t.attributeProcessor&&this.line.startsWith(y))m=t.attributeProcessor(this.line,O,f.processingContext);else if(t.varyingProcessor&&(null!==(N=t.varyingCheck)&&void 0!==N&&N.call(t,this.line,f.isFragment)||!t.varyingCheck&&this.line.startsWith(q)))m=t.varyingProcessor(this.line,f.isFragment,O,f.processingContext);else if(t.uniformProcessor&&t.uniformRegexp&&t.uniformRegexp.test(this.line))f.lookForClosingBracketForUniformBuffer||(m=t.uniformProcessor(this.line,f.isFragment,O,f.processingContext));else if(t.uniformBufferProcessor&&t.uniformBufferRegexp&&t.uniformBufferRegexp.test(this.line))f.lookForClosingBracketForUniformBuffer||(m=t.uniformBufferProcessor(this.line,f.isFragment,f.processingContext),f.lookForClosingBracketForUniformBuffer=!0);else if(t.textureProcessor&&t.textureRegexp&&t.textureRegexp.test(this.line))m=t.textureProcessor(this.line,f.isFragment,O,f.processingContext);else if((t.uniformProcessor||t.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!f.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?t.uniformProcessor&&(m=t.uniformProcessor(this.line,f.isFragment,O,f.processingContext)):t.uniformBufferProcessor&&(m=t.uniformBufferProcessor(this.line,f.isFragment,f.processingContext),f.lookForClosingBracketForUniformBuffer=!0)}f.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(f.lookForClosingBracketForUniformBuffer=!1,t.endOfUniformBufferProcessor&&(m=t.endOfUniformBufferProcessor(this.line,f.isFragment,f.processingContext)))}y+=m+"\n"}return this.children.forEach((S=>{y+=S.process(O,f)})),this.additionalDefineKey&&(O[this.additionalDefineKey]=this.additionalDefineValue||"true"),y}}class H{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(O){this._lines.length=0;for(const f of O){if(!f||"\r"===f)continue;if("#"===f[0]){this._lines.push(f);continue}const O=f.trim();if(!O)continue;if(O.startsWith("//")){this._lines.push(f);continue}const y=O.indexOf(";");if(-1===y)this._lines.push(O);else if(y===O.length-1)O.length>1&&this._lines.push(O);else{const O=f.split(";");for(let f=0;f<O.length;f++){let y=O[f];y&&(y=y.trim(),y&&this._lines.push(y+(f!==O.length-1?";":"")))}}}}}class b extends S{process(O,f){for(let y=0;y<this.children.length;y++){const S=this.children[y];if(S.isValid(O))return S.process(O,f)}return""}}class h extends S{isValid(O){return this.testExpression.isTrue(O)}}class v{isTrue(O){return!0}static postfixToInfix(O){const f=[];for(const y of O)if(void 0===v._OperatorPriority[y])f.push(y);else{const O=f[f.length-1],S=f[f.length-2];f.length-=2,f.push(`(${S}${y}${O})`)}return f[f.length-1]}static infixToPostfix(O){const f=v._InfixToPostfixCache.get(O);if(f)return f.accessTime=Date.now(),f.result;if(!O.includes("&&")&&!O.includes("||")&&!O.includes(")")&&!O.includes("("))return[O];const y=[];let S=-1;const H=()=>{t=t.trim(),""!==t&&(y.push(t),t="")},b=O=>{S<v._Stack.length-1&&(v._Stack[++S]=O)},h=()=>v._Stack[S],N=()=>-1===S?"!!INVALID EXPRESSION!!":v._Stack[S--];let m=0,t="";for(;m<O.length;){const f=O.charAt(m),q=m<O.length-1?O.substring(m,2+m):"";if("("===f)t="",b(f);else if(")"===f){for(H();-1!==S&&"("!==h();)y.push(N());N()}else if(v._OperatorPriority[q]>1){for(H();-1!==S&&v._OperatorPriority[h()]>=v._OperatorPriority[q];)y.push(N());b(q),m++}else t+=f;m++}for(H();-1!==S;)"("===h()?N():y.push(N());return v._InfixToPostfixCache.size>=v.InfixToPostfixCacheLimitSize&&v.ClearCache(),v._InfixToPostfixCache.set(O,{result:y,accessTime:Date.now()}),y}static ClearCache(){const O=Array.from(v._InfixToPostfixCache.entries()).sort(((O,f)=>O[1].accessTime-f[1].accessTime));for(let f=0;f<v.InfixToPostfixCacheCleanupSize;f++)v._InfixToPostfixCache.delete(O[f][0])}}v.InfixToPostfixCacheLimitSize=5e4,v.InfixToPostfixCacheCleanupSize=25e3,v._InfixToPostfixCache=new Map,v._OperatorPriority={")":0,"(":1,"||":2,"&&":3},v._Stack=["","","","","","","","","","","","","","","","","","","",""];class N extends v{constructor(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=O,this.not=f}isTrue(O){let f=void 0!==O[this.define];return this.not&&(f=!f),f}}class m extends v{isTrue(O){return this.leftOperand.isTrue(O)||this.rightOperand.isTrue(O)}}class t extends v{isTrue(O){return this.leftOperand.isTrue(O)&&this.rightOperand.isTrue(O)}}class q extends v{constructor(O,f,y){super(),this.define=O,this.operand=f,this.testValue=y}isTrue(O){let f=O[this.define];void 0===f&&(f=this.define);let y=!1;const S=parseInt(f),H=parseInt(this.testValue);switch(this.operand){case">":y=S>H;break;case"<":y=S<H;break;case"<=":y=S<=H;break;case">=":y=S>=H;break;case"==":y=S===H;break;case"!=":y=S!==H}return y}}var F=y(11030),I=y(11079);const A=/defined\s*?\((.+?)\)/g,J=/defined\s*?\[(.+?)\]/g,X=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,w=/__decl__/,B=/light\{X\}.(\w*)/g,j=/\{X\}/g,u=[],L=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function p(O){O.processor&&O.processor.initializeShaders&&O.processor.initializeShaders(O.processingContext)}function U(O,f,y,S){var H;null!==(H=f.processor)&&void 0!==H&&H.preProcessShaderCode&&(O=f.processor.preProcessShaderCode(O,f.isFragment)),V(O,f,(O=>{f.processCodeAfterIncludes&&(O=f.processCodeAfterIncludes(f.isFragment?"fragment":"vertex",O,f.defines));const H=function(O,f,y){let S=function(O,f){var y;if(null!==(y=f.processor)&&void 0!==y&&y.noPrecision)return O;const S=f.shouldUseHighPrecisionShader;-1===O.indexOf("precision highp float")?O=S?"precision highp float;\n"+O:"precision mediump float;\n"+O:S||(O=O.replace("precision highp float","precision mediump float"));return O}(O,f);if(!f.processor)return S;if(0===f.processor.shaderLanguage&&-1!==S.indexOf("#version 3")&&(S=S.replace("#version 300 es",""),!f.processor.parseGLES3))return S;const H=f.defines,b=D(f,y);f.processor.preProcessor&&(S=f.processor.preProcessor(S,H,b,f.isFragment,f.processingContext));S=i(S,b,f),f.processor.postProcessor&&(S=f.processor.postProcessor(S,H,f.isFragment,f.processingContext,y?{drawBuffersExtensionDisabled:!y.getCaps().drawBuffersExtension}:{}));null!==y&&void 0!==y&&y._features.needShaderCodeInlining&&(S=y.inlineShaderCode(S));return S}(O,f,S);y(H,O)}))}function l(O,f,y){return y.processor&&y.processor.finalizeShaders?y.processor.finalizeShaders(O,f,y.processingContext):{vertexCode:O,fragmentCode:f}}function x(O){const f=/defined\((.+)\)/.exec(O);if(f&&f.length)return new N(f[1].trim(),"!"===O[0]);const y=["==","!=",">=","<=","<",">"];let S="",H=0;for(S of y)if(H=O.indexOf(S),H>-1)break;if(-1===H)return new N(O);const b=O.substring(0,H).trim(),h=O.substring(H+S.length).trim();return new q(b,S,h)}function W(O,f){const y=new h,S=O.substring(0,f);let H=O.substring(f);return H=H.substring(0,(H.indexOf("//")+1||H.length+1)-1).trim(),y.testExpression="#ifdef"===S?new N(H):"#ifndef"===S?new N(H,!0):function(O){O=O.replace(A,"defined[$1]");const f=v.infixToPostfix(O),y=[];for(const H of f)if("||"!==H&&"&&"!==H)y.push(H);else if(y.length>=2){let O=y[y.length-1],f=y[y.length-2];y.length-=2;const S="&&"==H?new t:new m;"string"===typeof O&&(O=O.replace(J,"defined($1)")),"string"===typeof f&&(f=f.replace(J,"defined($1)")),S.leftOperand="string"===typeof f?x(f):f,S.rightOperand="string"===typeof O?x(O):O,y.push(S)}let S=y[y.length-1];return"string"===typeof S&&(S=S.replace(J,"defined($1)")),"string"===typeof S?x(S):S}(H),y}function E(O,f,y){let H=O.currentLine;for(;o(O,y);){H=O.currentLine;const b=H.substring(0,5).toLowerCase();if("#else"===b){const y=new S;return f.children.push(y),void o(O,y)}if("#elif"===b){const O=W(H,5);f.children.push(O),y=O}}}function o(O,f){for(;O.canRead;){O.lineIndex++;const y=O.currentLine;if(y.indexOf("#")>=0){const S=L.exec(y);if(S&&S.length){switch(S[0]){case"#ifdef":{const S=new b;f.children.push(S);const H=W(y,6);S.children.push(H),E(O,S,H);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const S=new b;f.children.push(S);const H=W(y,7);S.children.push(H),E(O,S,H);break}case"#if":{const S=new b,H=W(y,3);f.children.push(S),S.children.push(H),E(O,S,H);break}}continue}}const H=new S;if(H.line=y,f.children.push(H),"#"===y[0]&&"d"===y[1]){const O=y.replace(";","").split(" ");H.additionalDefineKey=O[1],3===O.length&&(H.additionalDefineValue=O[2])}}return!1}function i(O,f,y){const b=new S,h=new H;return h.lineIndex=-1,h.lines=O.split("\n"),o(h,b),b.process(f,y)}function D(O,f){var y;const S=O.defines,H={};for(const b of S){const O=b.replace("#define","").replace(";","").trim().split(" ");H[O[0]]=O.length>1?O[1]:""}return 0===(null===(y=O.processor)||void 0===y?void 0:y.shaderLanguage)&&(H.GL_ES="true"),H.__VERSION__=O.version,H[O.platformName]="true",(0,I.f)(H,null===f||void 0===f?void 0:f.isNDCHalfZRange,null===f||void 0===f?void 0:f.useReverseDepthBuffer,null===f||void 0===f?void 0:f.useExactSrgbConversions),H}function V(O,f,y){let S;for(u.length=0;null!==(S=X.exec(O));)u.push(S);let H=String(O),b=[O],h=!1;for(const v of u){let O=v[1];if(-1!==O.indexOf("__decl__")&&(O=O.replace(w,""),f.supportsUniformBuffers&&(O=O.replace("Vertex","Ubo").replace("Fragment","Ubo")),O+="Declaration"),!f.includesShadersStore[O]){const S=f.shadersRepository+"ShadersInclude/"+O+".fx";return void g.loadFile(S,(S=>{f.includesShadersStore[O]=S,V(b.join(""),f,y)}))}{let y=f.includesShadersStore[O];if(v[2]){const O=v[3].split(",");for(let f=0;f<O.length;f+=2){const S=new RegExp(O[f],"g"),H=O[f+1];y=y.replace(S,H)}}if(v[4]){const O=v[5];if(-1!==O.indexOf("..")){const S=O.split(".."),H=parseInt(S[0]);let b=parseInt(S[1]),h=y.slice(0);y="",isNaN(b)&&(b=f.indexParameters[S[1]]);for(let O=H;O<b;O++)f.supportsUniformBuffers||(h=h.replace(B,((O,f)=>f+"{X}"))),y+=h.replace(j,O.toString())+"\n"}else f.supportsUniformBuffers||(y=y.replace(B,((O,f)=>f+"{X}"))),y=y.replace(j,O)}const S=[];for(const O of b){const f=O.split(v[0]);for(let O=0;O<f.length-1;O++)S.push(f[O]),S.push(y);S.push(f[f.length-1])}b=S,h=h||y.indexOf("#include<")>=0||y.indexOf("#include <")>=0}}u.length=0,H=b.join(""),h?V(H.toString(),f,y):y(H)}const g={loadFile:(O,f,y,S,H,b)=>{throw(0,F.d)("FileTools")}}},11735:(O,f,y)=>{"use strict";y.d(f,{b:()=>S});class S{get underlyingResource(){return this._webGLTexture}constructor(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,f=arguments.length>1?arguments[1]:void 0;if(this._MSAARenderBuffers=null,this._context=f,!O&&(O=f.createTexture(),!O))throw new Error("Unable to create webGL texture");this.set(O)}setUsage(){}set(O){this._webGLTexture=O}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(O){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(O)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const O of this._MSAARenderBuffers)this._context.deleteRenderbuffer(O);this._MSAARenderBuffers=null}}getMSAARenderBuffer(){var O;let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(O=this._MSAARenderBuffers)||void 0===O?void 0:O[f])??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},11079:(O,f,y)=>{"use strict";y.d(f,{c:()=>H,d:()=>b,f:()=>v,j:()=>h,n:()=>N});var S=y(11030);y(11009);const H={};function b(O,f){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(f?f+"\n":"")+O}function h(O,f,y,b,h,v,N){const m=N||H.loadFile;if(m){return m(O,f,y,b,h,v)}throw(0,S.d)("FileTools")}function v(O,f,y,S){if(O)return f?O.IS_NDC_HALF_ZRANGE="":delete O.IS_NDC_HALF_ZRANGE,y?O.USE_REVERSE_DEPTHBUFFER="":delete O.USE_REVERSE_DEPTHBUFFER,void(S?O.USE_EXACT_SRGB_CONVERSIONS="":delete O.USE_EXACT_SRGB_CONVERSIONS);{let O="";return f&&(O+="#define IS_NDC_HALF_ZRANGE"),y&&(O&&(O+="\n"),O+="#define USE_REVERSE_DEPTHBUFFER"),S&&(O&&(O+="\n"),O+="#define USE_EXACT_SRGB_CONVERSIONS"),O}}function N(O,f){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3?arguments[3]:void 0;switch(O){case 3:{const O=(ArrayBuffer,new Int8Array(f));return S&&O.set(new Int8Array(S)),O}case 0:{const O=(ArrayBuffer,new Uint8Array(f));return S&&O.set(new Uint8Array(S)),O}case 4:{const O=f instanceof ArrayBuffer?new Int16Array(f):new Int16Array(y?f/2:f);return S&&O.set(new Int16Array(S)),O}case 5:case 8:case 9:case 10:case 2:{const O=f instanceof ArrayBuffer?new Uint16Array(f):new Uint16Array(y?f/2:f);return S&&O.set(new Uint16Array(S)),O}case 6:{const O=f instanceof ArrayBuffer?new Int32Array(f):new Int32Array(y?f/4:f);return S&&O.set(new Int32Array(S)),O}case 7:case 11:case 12:case 13:case 14:case 15:{const O=f instanceof ArrayBuffer?new Uint32Array(f):new Uint32Array(y?f/4:f);return S&&O.set(new Uint32Array(S)),O}case 1:{const O=f instanceof ArrayBuffer?new Float32Array(f):new Float32Array(y?f/4:f);return S&&O.set(new Float32Array(S)),O}}const H=(ArrayBuffer,new Uint8Array(f));return S&&H.set(new Uint8Array(S)),H}},11092:(O,f,y)=>{"use strict";y.d(f,{c:()=>j});var S=y(11042),H=y(11017),b=y(11098),h=y(11118),v=y(11028);class N{constructor(){let O=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,O&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(O){this._zOffset!==O&&(this._zOffset=O,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(O){this._zOffsetUnits!==O&&(this._zOffsetUnits=O,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(O){this._cullFace!==O&&(this._cullFace=O,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(O){this._cull!==O&&(this._cull=O,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(O){this._depthFunc!==O&&(this._depthFunc=O,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(O){this._depthMask!==O&&(this._depthMask=O,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(O){this._depthTest!==O&&(this._depthTest=O,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(O){this._frontFace!==O&&(this._frontFace=O,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(O){this.isDirty&&(this._isCullDirty&&(this.cull?O.enable(O.CULL_FACE):O.disable(O.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(O.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(O.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?O.enable(O.DEPTH_TEST):O.disable(O.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(O.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(O.enable(O.POLYGON_OFFSET_FILL),O.polygonOffset(this.zOffset,this.zOffsetUnits)):O.disable(O.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(O.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}class m{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(O){this._func!==O&&(this._func=O,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(O){this._funcRef!==O&&(this._funcRef=O,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(O){this._funcMask!==O&&(this._funcMask=O,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(O){this._opStencilFail!==O&&(this._opStencilFail=O,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(O){this._opDepthFail!==O&&(this._opDepthFail=O,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(O){this._opStencilDepthPass!==O&&(this._opStencilDepthPass=O,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(O){this._mask!==O&&(this._mask=O,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(O){this._enabled!==O&&(this._enabled=O,this._isStencilTestDirty=!0)}constructor(){let O=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,O&&this.reset()}reset(){var O;this.stencilMaterial=void 0,null===(O=this.stencilGlobal)||void 0===O||O.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(O){var f;if(!O)return;const y=!this.useStencilGlobalOnly&&!(null===(f=this.stencilMaterial)||void 0===f||!f.enabled);this.enabled=y?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=y?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=y?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=y?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=y?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=y?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=y?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=y?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?O.enable(O.STENCIL_TEST):O.disable(O.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(O.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(O.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(O.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}class t{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=t.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=t.KEEP,this.opDepthFail=t.KEEP,this.opStencilDepthPass=t.REPLACE}get stencilFunc(){return this.func}set stencilFunc(O){this.func=O}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(O){this.funcRef=O}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(O){this.funcMask=O}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(O){this.opStencilFail=O}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(O){this.opDepthFail=O}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(O){this.opStencilDepthPass=O}get stencilMask(){return this.mask}set stencilMask(O){this.mask=O}get stencilTest(){return this.enabled}set stencilTest(O){this.enabled=O}}t.ALWAYS=519,t.KEEP=7680,t.REPLACE=7681;class q{constructor(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._alphaBlend}set alphaBlend(O){this._alphaBlend!==O&&(this._alphaBlend=O,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(O,f,y,S){this._blendConstants[0]===O&&this._blendConstants[1]===f&&this._blendConstants[2]===y&&this._blendConstants[3]===S||(this._blendConstants[0]=O,this._blendConstants[1]=f,this._blendConstants[2]=y,this._blendConstants[3]=S,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(O,f,y,S){this._blendFunctionParameters[0]===O&&this._blendFunctionParameters[1]===f&&this._blendFunctionParameters[2]===y&&this._blendFunctionParameters[3]===S||(this._blendFunctionParameters[0]=O,this._blendFunctionParameters[1]=f,this._blendFunctionParameters[2]=y,this._blendFunctionParameters[3]=S,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(O,f){this._blendEquationParameters[0]===O&&this._blendEquationParameters[1]===f||(this._blendEquationParameters[0]=O,this._blendEquationParameters[1]=f,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(O){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?O.enable(O.BLEND):O.disable(O.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(O.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(O.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(O.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}var F=y(11030),I=y(11126),A=y(11009),J=y(11004),X=y(11079),w=y(11141);function B(O,f){if((0,A.h)()){const{requestAnimationFrame:y}=f||window;if("function"===typeof y)return y(O)}else if("function"===typeof requestAnimationFrame)return requestAnimationFrame(O);return setTimeout(O,16)}class j{get frameId(){return this._frameId}get isWebGPU(){return this._isWebGPU}_getShaderProcessor(O){return this._shaderProcessor}get shaderPlatformName(){return this._shaderPlatformName}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}set useReverseDepthBuffer(O){O!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=O,this._depthCullingState.depthFunc=O?518:515)}setColorWrite(O){O!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=O)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}_getGlobalDefines(O){if(O)return this.isNDCHalfZRange?O.IS_NDC_HALF_ZRANGE="":delete O.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?O.USE_REVERSE_DEPTHBUFFER="":delete O.USE_REVERSE_DEPTHBUFFER,void(this.useExactSrgbConversions?O.USE_EXACT_SRGB_CONVERSIONS="":delete O.USE_EXACT_SRGB_CONVERSIONS);{let O="";return this.isNDCHalfZRange&&(O+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(O&&(O+="\n"),O+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(O&&(O+="\n"),O+="#define USE_EXACT_SRGB_CONVERSIONS"),O}}_rebuildInternalTextures(){const O=this._internalTexturesCache.slice();for(const f of O)f._rebuild()}_rebuildRenderTargetWrappers(){const O=this._renderTargetWrapperCache.slice();for(const f of O)f._rebuild()}_rebuildEffects(){for(const O in this._compiledEffects){const f=this._compiledEffects[O];f._pipelineContext=null,f._prepareEffect()}b.b.ResetCache()}_rebuildGraphicsResources(){var O;this.wipeCaches(!0),this._rebuildEffects(),null===(O=this._rebuildComputeEffects)||void 0===O||O.call(this),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_flagContextRestored(){H.e.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}_restoreEngineAfterContextLost(O){setTimeout((async()=>{this._clearEmptyResources();const f=this._depthCullingState.depthTest,y=this._depthCullingState.depthFunc,S=this._depthCullingState.depthMask,H=this._stencilState.stencilTest;await O(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=f,this._depthCullingState.depthFunc=y,this._depthCullingState.depthMask=S,this._stencilState.stencilTest=H,this._flagContextRestored()}),0)}get u(){return this._isDisposed}get snapshotRendering(){return!1}set snapshotRendering(O){}get snapshotRenderingMode(){return 0}set snapshotRenderingMode(O){}getClassName(){return"AbstractEngine"}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){const O=new Uint8Array(4),f=[O,O,O,O,O,O];this._emptyCubeTexture=this.createRawCubeTexture(f,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get activeRenderLoops(){return this._activeRenderLoops}stopRenderLoop(O){if(!O)return this._activeRenderLoops.length=0,void this._cancelFrame();const f=this._activeRenderLoops.indexOf(O);f>=0&&(this._activeRenderLoops.splice(f,1),0==this._activeRenderLoops.length&&this._cancelFrame())}_cancelFrame(){if(0!==this._frameHandler){const O=this._frameHandler;if(this._frameHandler=0,(0,A.h)()){const{cancelAnimationFrame:f}=this.getHostWindow()||window;if("function"===typeof f)return f(O)}else if("function"===typeof cancelAnimationFrame)return cancelAnimationFrame(O);return clearTimeout(O)}}cj(){this.onBeginFrameObservable.notifyObservers(this)}dj(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let O=!0;(this._isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(O=!1),O&&(this.cj(),this._renderViews()||this._renderFrame(),this.dj())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_renderFrame(){for(let O=0;O<this._activeRenderLoops.length;O++){(0,this._activeRenderLoops[O])()}}_renderViews(){return!1}_queueNewFrame(O,f){return B(O,f)}runRenderLoop(O){-1===this._activeRenderLoops.indexOf(O)&&(this._activeRenderLoops.push(O),1===this._activeRenderLoops.length&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(O){this._depthCullingState.depthTest=O}setZOffset(O){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-O:O}getZOffset(){const O=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-O:O}setZOffsetUnits(O){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-O:O}getZOffsetUnits(){const O=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-O:O}getHostWindow(){return(0,A.h)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(O){this._compatibilityMode=!0}_rebuildTextures(){for(const O of this.scenes)O._rebuildTextures();for(const O of this._virtualScenes)O._rebuildTextures()}_releaseRenderTargetWrapper(O){const f=this._renderTargetWrapperCache.indexOf(O);-1!==f&&this._renderTargetWrapperCache.splice(f,1)}get currentViewport(){return this._cachedViewport}setViewport(O,f,y){const S=f||this.getRenderWidth(),H=y||this.getRenderHeight(),b=O.x||0,h=O.y||0;this._cachedViewport=O,this._viewport(b*S,h*H,S*O.width,H*O.height)}createCanvasImage(){return document.createElement("img")}get description(){let O=this.name+this.version;return this._caps.parallelShaderCompile&&(O+=" - Parallel shader compilation"),O}_createTextureBase(O,f,y,b){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,v=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,N=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,m=arguments.length>7?arguments[7]:void 0,t=arguments.length>8?arguments[8]:void 0,q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,F=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,A=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,J=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,X=arguments.length>13?arguments[13]:void 0,B=arguments.length>14?arguments[14]:void 0,u=arguments.length>15?arguments[15]:void 0;const L="data:"===(O=O||"").substr(0,5),p="blob:"===O.substr(0,5),U=L&&-1!==O.indexOf(";base64,"),l=F||new I.c(this,1);l!==F&&(l.label=O.substring(0,60));const x=O;!this._transformTextureUrl||U||F||q||(O=this._transformTextureUrl(O)),x!==O&&(l._originalUrl=x);const W=O.lastIndexOf(".");let E=J||(W>-1?O.substring(W).toLowerCase():"");E.indexOf("?")>-1&&(E=E.split("?")[0]);const o=(0,w.c)(E,X);b&&b.addPendingData(l),l.url=O,l.generateMipMaps=!f,l.samplingMode=h,l.invertY=y,l._useSRGBBuffer=this._getUseSRGBBuffer(!!u,f),this._doNotHandleContextLost||(l._buffer=q);let i=null;v&&!F&&(i=l.onLoadedObservable.add(v)),F||this._internalTexturesCache.push(l);const D=(y,F)=>{b&&b.removePendingData(l),O===x?(i&&l.onLoadedObservable.remove(i),S.c.UseFallbackTexture&&O!==S.c.FallbackTexture&&this._createTextureBase(S.c.FallbackTexture,f,l.invertY,b,h,null,N,m,t,q,l),y=(y||"Unknown error")+(S.c.UseFallbackTexture?" - Fallback texture was used":""),l.onErrorObservable.notifyObservers({message:y,exception:F}),N&&N(y,F)):(H.e.Warn(`Failed to load ${O}, falling back to ${x}`),this._createTextureBase(x,f,l.invertY,b,h,v,N,m,t,q,l,A,J,X,B,u))};if(o){const f=async O=>{(await o).loadData(O,l,((O,f,y,S,H,v)=>{v?D("TextureLoader failed to load data"):m(l,E,b,{width:O,height:f},l.invertY,!y,S,(()=>(H(),!1)),h)}),B)};q?q instanceof ArrayBuffer?f(new Uint8Array(q)):ArrayBuffer.isView(q)?f(q):N&&N("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(O,(O=>f(new Uint8Array(O))),void 0,b?b.offlineProvider:void 0,!0,((O,f)=>{D("Unable to load "+(O&&O.responseURL,f))}))}else{const y=O=>{p&&!this._doNotHandleContextLost&&(l._buffer=O),m(l,E,b,O,l.invertY,f,!1,t,h)};!L||U?q&&("string"===typeof q.decoding||q.close)?y(q):j._FileToolsLoadImage(O||"",y,D,b?b.offlineProvider:null,X,l.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):"string"===typeof q||q instanceof ArrayBuffer||ArrayBuffer.isView(q)||q instanceof Blob?j._FileToolsLoadImage(q,y,D,b?b.offlineProvider:null,X,l.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):q&&y(q)}return l}_rebuildBuffers(){for(const O of this._uniformBuffers)O._rebuildAfterContextLost()}get _shouldUseHighPrecisionShader(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,A.c)()?document:null}getLoadedTexturesCache(){return this._internalTexturesCache}clearInternalTexturesCache(){this._internalTexturesCache.length=0}getCaps(){return this._caps}resetTextureCache(){for(const O in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,O)&&(this._boundTexturesCache[O]=null);this._currentTextureChannel=-1}get name(){return this._name}set name(O){this._name=O}static get NpmPackage(){return"babylonjs@7.33.0"}static get Version(){return"7.33.0"}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}setHardwareScalingLevel(O){this._hardwareScalingLevel=O,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(O){this._doNotHandleContextLost=O}get isStencilEnable(){return this._isStencilEnable}getCreationOptions(){return this._creationOptions}constructor(O,f,y){var H,b;this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new N,this._stencilStateComposer=new m,this._stencilState=new t,this._alphaState=new q,this._alphaMode=1,this._alphaEquation=0,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new J.d,this.onCanvasFocusObservable=new J.d,this.onNewSceneAddedObservable=new J.d,this.onResizeObservable=new J.d,this.onCanvasPointerOutObservable=new J.d,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new J.d,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=()=>this._renderLoop(),this.onBeforeShaderCompilationObservable=new J.d,this.onAfterShaderCompilationObservable=new J.d,this.onBeginFrameObservable=new J.d,this.onEndFrameObservable=new J.d,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new J.d,this.onContextRestoredObservable=new J.d,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.hj=new J.d,S.c.Instances.push(this),this.startTime=v.b.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,h.c.SetMatrixPrecision(!!f.useHighPrecisionMatrix),(0,A.d)()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=y??!1,f.antialias=O??f.antialias,f.deterministicLockstep=f.deterministicLockstep??!1,f.lockstepMaxSteps=f.lockstepMaxSteps??4,f.timeStep=f.timeStep??1/60,f.audioEngine=f.audioEngine??!0,f.stencil=f.stencil??!0,this._audioContext=(null===(H=f.audioEngineOptions)||void 0===H?void 0:H.audioContext)??null,this._audioDestination=(null===(b=f.audioEngineOptions)||void 0===b?void 0:b.audioDestination)??null,this.premultipliedAlpha=f.premultipliedAlpha??!0,this._doNotHandleContextLost=!!f.doNotHandleContextLost,this._isStencilEnable=!!f.stencil,this.useExactSrgbConversions=f.useExactSrgbConversions??!1;const F=(0,A.h)()&&window.devicePixelRatio||1,I=f.limitDeviceRatio||F;y=y||f.adaptToDeviceRatio||!1,this._hardwareScalingLevel=y?1/Math.min(I,F):1,this._lastDevicePixelRatio=F,this._creationOptions=f}resize(){let O,f,y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.adaptToDeviceRatio){const O=(0,A.h)()&&window.devicePixelRatio||1,f=this._lastDevicePixelRatio/O;this._lastDevicePixelRatio=O,this._hardwareScalingLevel*=f}if((0,A.h)()&&(0,A.c)())if(this._renderingCanvas){const y=this._renderingCanvas.getBoundingClientRect?this._renderingCanvas.getBoundingClientRect():{width:this._renderingCanvas.width*this._hardwareScalingLevel,height:this._renderingCanvas.height*this._hardwareScalingLevel};O=this._renderingCanvas.clientWidth||y.width||this._renderingCanvas.width||100,f=this._renderingCanvas.clientHeight||y.height||this._renderingCanvas.height||100}else O=window.innerWidth,f=window.innerHeight;else O=this._renderingCanvas?this._renderingCanvas.width:100,f=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(O/this._hardwareScalingLevel,f/this._hardwareScalingLevel,y)}setSize(O,f){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._renderingCanvas)return!1;if(O|=0,f|=0,!y&&this._renderingCanvas.width===O&&this._renderingCanvas.height===f)return!1;if(this._renderingCanvas.width=O,this._renderingCanvas.height=f,this.scenes){for(let O=0;O<this.scenes.length;O++){const f=this.scenes[O];for(let O=0;O<f.cameras.length;O++){f.cameras[O]._currentRenderId=0}}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}createRawTexture(O,f,y,S,H,b,h,v,N,m,t){throw(0,F.d)("engine.rawTexture")}createRawCubeTexture(O,f,y,S,H,b,h,v){throw(0,F.d)("engine.rawTexture")}createRawTexture3D(O,f,y,S,H,b,h,v,N,m,t){throw(0,F.d)("engine.rawTexture")}createRawTexture2DArray(O,f,y,S,H,b,h,v,N,m,t){throw(0,F.d)("engine.rawTexture")}_sharedInit(O){this._renderingCanvas=O}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const O=navigator.userAgent;this.hostInformation.isMobile=-1!==O.indexOf("Mobile")||-1!==O.indexOf("Mac")&&(0,A.c)()&&"ontouchend"in document},this._checkForMobile(),(0,A.h)()&&window.addEventListener("resize",this._checkForMobile))}createVideoElement(O){return document.createElement("video")}_reportDrawCall(){var O;let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;null===(O=this._drawCalls)||void 0===O||O.addCount(f,!1)}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return 1e3*this._timeStep}_createImageBitmapFromSource(O,f){throw new Error("createImageBitmapFromSource is not implemented")}createImageBitmap(O,f){return createImageBitmap(O,f)}resizeImageBitmap(O,f,y){throw new Error("resizeImageBitmap is not implemented")}getFontOffset(O){throw new Error("getFontOffset is not implemented")}static _CreateCanvas(O,f){if("undefined"===typeof document)return new OffscreenCanvas(O,f);const y=document.createElement("canvas");return y.width=O,y.height=f,y}createCanvas(O,f){return j._CreateCanvas(O,f)}static _FileToolsLoadImage(O,f,y,S,H,b){throw(0,F.d)("FileTools")}_loadFile(O,f,y,S,H,b){const h=(0,X.j)(O,f,y,S,H,b);return this._activeRequests.push(h),h.onCompleteObservable.add((()=>{const O=this._activeRequests.indexOf(h);-1!==O&&this._activeRequests.splice(O,1)})),h}static _FileToolsLoadFile(O,f,y,S,H,b){if(X.c.loadFile)return X.c.loadFile(O,f,y,S,H,b);throw(0,F.d)("FileTools")}dispose(){var O;for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();null===(O=this.releaseComputeEffects)||void 0===O||O.call(this),b.b.ResetCache();for(const y of this._activeRequests)y.abort();this._boundRenderFunction=null,this.hj.notifyObservers(this),this.hj.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),(0,A.h)()&&window.removeEventListener("resize",this._checkForMobile);const f=S.c.Instances.indexOf(this);f>=0&&S.c.Instances.splice(f,1),S.c.Instances.length||(S.c.OnEnginesDisposedObservable.notifyObservers(this),S.c.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}static DefaultLoadingScreenFactory(O){throw(0,F.d)("LoadingScreen")}static MarkAllMaterialsAsDirty(O,f){for(let y=0;y<S.c.Instances.length;y++){const H=S.c.Instances[y];for(let y=0;y<H.scenes.length;y++)H.scenes[y].markAllMaterialsAsDirty(O,f)}}}j._RenderPassIdCounter=0,j._RescalePostProcessFactory=null,j.CollisionsEpsilon=.001,j.QueueNewFrame=B},11754:(O,f,y)=>{"use strict";y.d(f,{d:()=>l});var S=y(11126),H=y(11042),b=y(11712),h=y(11028);class v{constructor(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;this._enabled=!0,this._rollingFrameTime=new N(O)}sampleFrame(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h.b.Now;if(this._enabled){if(null!=this._lastFrameTimeMs){const f=O-this._lastFrameTimeMs;this._rollingFrameTime.add(f)}this._lastFrameTimeMs=O}}get averageFrameTime(){return this._rollingFrameTime.average}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFPS(){return 1e3/this._rollingFrameTime.average}get instantaneousFPS(){const O=this._rollingFrameTime.history(0);return 0===O?0:1e3/O}get isSaturated(){return this._rollingFrameTime.isSaturated()}enable(){this._enabled=!0}disable(){this._enabled=!1,this._lastFrameTimeMs=null}get isEnabled(){return this._enabled}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class N{constructor(O){this._samples=new Array(O),this.reset()}add(O){let f;if(this.isSaturated()){const O=this._samples[this._pos];f=O-this.average,this.average-=f/(this._sampleCount-1),this._m2-=f*(O-this.average)}else this._sampleCount++;f=O-this.average,this.average+=f/this._sampleCount,this._m2+=f*(O-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=O,this._pos++,this._pos%=this._samples.length}history(O){if(O>=this._sampleCount||O>=this._samples.length)return 0;const f=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(f-O)]}isSaturated(){return this._sampleCount>=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(O){const f=this._samples.length;return(O%f+f)%f}}var m=y(11728),t=y(11017),q=y(11735),F=(y(11751),y(11161));function I(O,f,y,S){let H,b=1;1===S?H=new Float32Array(f*y*4):2===S?(H=new Uint16Array(f*y*4),b=15360):H=7===S?new Uint32Array(f*y*4):new Uint8Array(f*y*4);for(let h=0;h<f;h++)for(let S=0;S<y;S++){const y=3*(S*f+h),v=4*(S*f+h);H[v+0]=O[y+0],H[v+1]=O[y+1],H[v+2]=O[y+2],H[v+3]=b}return H}function A(O){return function(f,y,H,b,h,v,N,m){let t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const F=O?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,I=O?10:11,A=new S.c(this,I);A.baseWidth=y,A.baseHeight=H,A.baseDepth=b,A.width=y,A.height=H,A.depth=b,A.format=h,A.type=q,A.generateMipMaps=v,A.samplingMode=m,O?A.is3D=!0:A.is2DArray=!0,this._doNotHandleContextLost||(A._bufferView=f),O?this.updateRawTexture3D(A,f,h,N,t,q):this.updateRawTexture2DArray(A,f,h,N,t,q),this._bindTextureDirectly(F,A,!0);const J=this._getSamplingParameters(m,v);return this._gl.texParameteri(F,this._gl.TEXTURE_MAG_FILTER,J.mag),this._gl.texParameteri(F,this._gl.TEXTURE_MIN_FILTER,J.min),v&&this._gl.generateMipmap(F),this._bindTextureDirectly(F,null),this._internalTexturesCache.push(A),A}}function J(O){return function(f,y,S,H){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const v=O?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,N=this._getWebGLTextureType(h),m=this._getInternalFormat(S),t=this._getRGBABufferInternalSizedFormat(h,S);this._bindTextureDirectly(v,f,!0),this._unpackFlipY(void 0===H||!!H),this._doNotHandleContextLost||(f._bufferView=y,f.format=S,f.invertY=H,f._compression=b),f.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),b&&y?this._gl.compressedTexImage3D(v,0,this.getCaps().s3tc[b],f.width,f.height,f.depth,0,y):this._gl.texImage3D(v,0,t,f.width,f.height,f.depth,0,m,N,y),f.generateMipMaps&&this._gl.generateMipmap(v),this._bindTextureDirectly(v,null),f.isReady=!0}}b.ThinEngine.prototype.updateRawTexture=function(O,f,y,S){let H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,h=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!O)return;const v=this._getRGBABufferInternalSizedFormat(b,y,h),N=this._getInternalFormat(y),m=this._getWebGLTextureType(b);this._bindTextureDirectly(this._gl.TEXTURE_2D,O,!0),this._unpackFlipY(void 0===S||!!S),this._doNotHandleContextLost||(O._bufferView=f,O.format=y,O.type=b,O.invertY=S,O._compression=H),O.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),H&&f?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[H],O.width,O.height,0,f):this._gl.texImage2D(this._gl.TEXTURE_2D,0,v,O.width,O.height,0,N,m,f),O.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),O.isReady=!0},b.ThinEngine.prototype.createRawTexture=function(O,f,y,H,b,h,v){let N=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,m=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,t=arguments.length>10&&void 0!==arguments[10]&&arguments[10];const q=new S.c(this,3);q.baseWidth=f,q.baseHeight=y,q.width=f,q.height=y,q.format=H,q.generateMipMaps=b,q.samplingMode=v,q.invertY=h,q._compression=N,q.type=m,q._useSRGBBuffer=this._getUseSRGBBuffer(t,!b),this._doNotHandleContextLost||(q._bufferView=O),this.updateRawTexture(q,O,H,h,N,m,q._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,q,!0);const F=this._getSamplingParameters(v,b);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,F.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,F.min),b&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(q),q},b.ThinEngine.prototype.createRawCubeTexture=function(O,f,y,H,b,h,v){let N=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;const m=this._gl,q=new S.c(this,8);q.isCube=!0,q.format=y,q.type=H,this._doNotHandleContextLost||(q._bufferViewArray=O);const I=this._getWebGLTextureType(H);let A=this._getInternalFormat(y);A===m.RGB&&(A=m.RGBA),I!==m.FLOAT||this._caps.textureFloatLinearFiltering?I!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?I!==m.FLOAT||this._caps.textureFloatRender?I!==m.HALF_FLOAT||this._caps.colorBufferFloat||(b=!1,t.e.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(b=!1,t.e.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(b=!1,v=1,t.e.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(b=!1,v=1,t.e.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));const J=f,X=J;q.width=J,q.height=X,q.invertY=h,q._compression=N;if(!this.needPOTTextures||(0,F.j)(q.width)&&(0,F.j)(q.height)||(b=!1),O)this.updateRawCubeTexture(q,O,y,H,h,N);else{const O=this._getRGBABufferInternalSizedFormat(H),f=0;this._bindTextureDirectly(m.TEXTURE_CUBE_MAP,q,!0);for(let y=0;y<6;y++)N?m.compressedTexImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+y,f,this.getCaps().s3tc[N],q.width,q.height,0,void 0):m.texImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+y,f,O,q.width,q.height,0,A,I,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,q,!0),O&&b&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);const w=this._getSamplingParameters(v,b);return m.texParameteri(m.TEXTURE_CUBE_MAP,m.TEXTURE_MAG_FILTER,w.mag),m.texParameteri(m.TEXTURE_CUBE_MAP,m.TEXTURE_MIN_FILTER,w.min),m.texParameteri(m.TEXTURE_CUBE_MAP,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_CUBE_MAP,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),this._bindTextureDirectly(m.TEXTURE_CUBE_MAP,null),q.generateMipMaps=b,q.samplingMode=v,q.isReady=!0,q},b.ThinEngine.prototype.updateRawCubeTexture=function(O,f,y,S,H){let b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;O._bufferViewArray=f,O.format=y,O.type=S,O.invertY=H,O._compression=b;const v=this._gl,N=this._getWebGLTextureType(S);let m=this._getInternalFormat(y);const t=this._getRGBABufferInternalSizedFormat(S);let q=!1;m===v.RGB&&(m=v.RGBA,q=!0),this._bindTextureDirectly(v.TEXTURE_CUBE_MAP,O,!0),this._unpackFlipY(void 0===H||!!H),O.width%4!==0&&v.pixelStorei(v.UNPACK_ALIGNMENT,1);for(let F=0;F<6;F++){let y=f[F];b?v.compressedTexImage2D(v.TEXTURE_CUBE_MAP_POSITIVE_X+F,h,this.getCaps().s3tc[b],O.width,O.height,0,y):(q&&(y=I(y,O.width,O.height,S)),v.texImage2D(v.TEXTURE_CUBE_MAP_POSITIVE_X+F,h,t,O.width,O.height,0,m,N,y))}(!this.needPOTTextures||(0,F.j)(O.width)&&(0,F.j)(O.height))&&O.generateMipMaps&&0===h&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),O.isReady=!0},b.ThinEngine.prototype.createRawCubeTextureFromUrl=function(O,f,y,S,H,b,h,v){let N=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,m=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,t=arguments.length>10&&void 0!==arguments[10]?arguments[10]:3,q=arguments.length>11&&void 0!==arguments[11]&&arguments[11];const F=this._gl,A=this.createRawCubeTexture(null,y,S,H,!b,q,t,null);null===f||void 0===f||f.addPendingData(A),A.url=O,A.isReady=!1,this._internalTexturesCache.push(A);const J=O=>{const y=A.width,b=h(O);if(b){if(v){const O=this._getWebGLTextureType(H);let f=this._getInternalFormat(S);const h=this._getRGBABufferInternalSizedFormat(H);let N=!1;f===F.RGB&&(f=F.RGBA,N=!0),this._bindTextureDirectly(F.TEXTURE_CUBE_MAP,A,!0),this._unpackFlipY(!1);const m=v(b);for(let S=0;S<m.length;S++){const b=y>>S;for(let y=0;y<6;y++){let v=m[S][y];N&&(v=I(v,b,b,H)),F.texImage2D(y,S,h,b,b,0,f,O,v)}}this._bindTextureDirectly(F.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(A,b,S,H,q);A.isReady=!0,null===f||void 0===f||f.removePendingData(A),A.onLoadedObservable.notifyObservers(A),A.onLoadedObservable.clear(),N&&N()}};return this._loadFile(O,(O=>{J(O)}),void 0,null===f||void 0===f?void 0:f.offlineProvider,!0,((O,y)=>{null===f||void 0===f||f.removePendingData(A),m&&O&&m(O.status+" "+O.statusText,y)})),A},b.ThinEngine.prototype.createRawTexture2DArray=A(!1),b.ThinEngine.prototype.createRawTexture3D=A(!0),b.ThinEngine.prototype.updateRawTexture2DArray=J(!1),b.ThinEngine.prototype.updateRawTexture3D=J(!0);var X=y(11079);b.ThinEngine.prototype._readTexturePixelsSync=function(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,h=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],v=arguments.length>7&&void 0!==arguments[7]&&arguments[7],N=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,m=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const t=this._gl;if(!t)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const O=t.createFramebuffer();if(!O)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=O}var q,F;(t.bindFramebuffer(t.FRAMEBUFFER,this._dummyFramebuffer),S>-1)?t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+S,null===(q=O._hardwareTexture)||void 0===q?void 0:q.underlyingResource,H):t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null===(F=O._hardwareTexture)||void 0===F?void 0:F.underlyingResource,H);let I=void 0!==O.type?this._getWebGLTextureType(O.type):t.UNSIGNED_BYTE;if(v)b||(b=(0,X.n)(O.type,4*f*y));else if(I===t.UNSIGNED_BYTE)b||(b=new Uint8Array(4*f*y)),I=t.UNSIGNED_BYTE;else b||(b=new Float32Array(4*f*y)),I=t.FLOAT;return h&&this.flushFramebuffer(),t.readPixels(N,m,f,y,t.RGBA,I,b),t.bindFramebuffer(t.FRAMEBUFFER,this._currentFramebuffer),b},b.ThinEngine.prototype._readTexturePixels=function(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,h=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],v=arguments.length>7&&void 0!==arguments[7]&&arguments[7],N=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,m=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;return Promise.resolve(this._readTexturePixelsSync(O,f,y,S,H,b,h,v,N,m))};y(11707);b.ThinEngine.prototype._createDepthStencilCubeTexture=function(O,f){const y=new S.c(this,12);if(y.isCube=!0,1===this.webGLVersion)return t.e.Error("Depth cube texture is not supported by WebGL 1."),y;const H={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...f},b=this._gl;this._bindTextureDirectly(b.TEXTURE_CUBE_MAP,y,!0),this._setupDepthStencilTexture(y,O,H.bilinearFiltering,H.comparisonFunction);for(let S=0;S<6;S++)H.generateStencil?b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+S,0,b.DEPTH24_STENCIL8,O,O,0,b.DEPTH_STENCIL,b.UNSIGNED_INT_24_8,null):b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+S,0,b.DEPTH_COMPONENT24,O,O,0,b.DEPTH_COMPONENT,b.UNSIGNED_INT,null);return this._bindTextureDirectly(b.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(y),y},b.ThinEngine.prototype._setCubeMapTextureParams=function(O,f,y){const S=this._gl;S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_MAG_FILTER,S.LINEAR),S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_MIN_FILTER,f?S.LINEAR_MIPMAP_LINEAR:S.LINEAR),S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_WRAP_S,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_WRAP_T,S.CLAMP_TO_EDGE),O.samplingMode=f?3:2,f&&this.getCaps().textureMaxLevel&&void 0!==y&&y>0&&(S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_MAX_LEVEL,y),O._maxLodLevel=y),this._bindTextureDirectly(S.TEXTURE_CUBE_MAP,null)},b.ThinEngine.prototype.createCubeTexture=function(O,f,y,S){let H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,h=arguments.length>6?arguments[6]:void 0,v=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,N=arguments.length>8&&void 0!==arguments[8]&&arguments[8],m=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,q=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,I=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,A=arguments.length>13&&void 0!==arguments[13]&&arguments[13],J=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null;const X=this._gl;return this.createCubeTextureBase(O,f,y,!!S,H,b,h,v,N,m,q,I,(O=>this._bindTextureDirectly(X.TEXTURE_CUBE_MAP,O,!0)),((O,f)=>{const y=this.needPOTTextures?(0,F.h)(f[0].width,this._caps.maxCubemapTextureSize):f[0].width,b=y,v=[X.TEXTURE_CUBE_MAP_POSITIVE_X,X.TEXTURE_CUBE_MAP_POSITIVE_Y,X.TEXTURE_CUBE_MAP_POSITIVE_Z,X.TEXTURE_CUBE_MAP_NEGATIVE_X,X.TEXTURE_CUBE_MAP_NEGATIVE_Y,X.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(X.TEXTURE_CUBE_MAP,O,!0),this._unpackFlipY(!1);const N=h?this._getInternalFormat(h,O._useSRGBBuffer):O._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:X.RGBA;let m=h?this._getInternalFormat(h):X.RGBA;O._useSRGBBuffer&&1===this.webGLVersion&&(m=N);for(let S=0;S<v.length;S++)if(f[S].width!==y||f[S].height!==b){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void t.e.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=y,this._workingCanvas.height=b,this._workingContext.drawImage(f[S],0,0,f[S].width,f[S].height,0,0,y,b),X.texImage2D(v[S],0,N,m,X.UNSIGNED_BYTE,this._workingCanvas)}else X.texImage2D(v[S],0,N,m,X.UNSIGNED_BYTE,f[S]);S||X.generateMipmap(X.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(O,!S),O.width=y,O.height=b,O.isReady=!0,h&&(O.format=h),O.onLoadedObservable.notifyObservers(O),O.onLoadedObservable.clear(),H&&H()}),!!A,J)},b.ThinEngine.prototype.generateMipMapsForCubemap=function(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(O.generateMipMaps){const y=this._gl;this._bindTextureDirectly(y.TEXTURE_CUBE_MAP,O,!0),y.generateMipmap(y.TEXTURE_CUBE_MAP),f&&this._bindTextureDirectly(y.TEXTURE_CUBE_MAP,null)}};y(11762);b.ThinEngine.prototype.setDepthStencilTexture=function(O,f,y,S){void 0!==O&&(f&&(this._boundUniforms[O]=f),y&&y.depthStencilTexture?this._setTexture(O,y,!1,!0,S):this._setTexture(O,null,void 0,void 0,S))},b.ThinEngine.prototype.createRenderTargetCubeTexture=function(O,f){const y=this._createHardwareRenderTargetWrapper(!1,!0,O),H={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...f};H.generateStencilBuffer=H.generateDepthBuffer&&H.generateStencilBuffer,(1!==H.type||this._caps.textureFloatLinearFiltering)&&(2!==H.type||this._caps.textureHalfFloatLinearFiltering)||(H.samplingMode=1);const b=this._gl,h=new S.c(this,5);this._bindTextureDirectly(b.TEXTURE_CUBE_MAP,h,!0);const v=this._getSamplingParameters(H.samplingMode,H.generateMipMaps);1!==H.type||this._caps.textureFloat||(H.type=0,t.e.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_MAG_FILTER,v.mag),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_MIN_FILTER,v.min),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);for(let S=0;S<6;S++)b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+S,0,this._getRGBABufferInternalSizedFormat(H.type,H.format),O,O,0,this._getInternalFormat(H.format),this._getWebGLTextureType(H.type),null);const N=b.createFramebuffer();return this._bindUnboundFramebuffer(N),y._depthStencilBuffer=this._setupFramebufferDepthAttachments(H.generateStencilBuffer,H.generateDepthBuffer,O,O),H.generateMipMaps&&b.generateMipmap(b.TEXTURE_CUBE_MAP),this._bindTextureDirectly(b.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),y._framebuffer=N,y._generateDepthBuffer=H.generateDepthBuffer,y._generateStencilBuffer=H.generateStencilBuffer,h.width=O,h.height=O,h.isReady=!0,h.isCube=!0,h.samples=1,h.generateMipMaps=H.generateMipMaps,h.samplingMode=H.samplingMode,h.type=H.type,h.format=H.format,this._internalTexturesCache.push(h),y.setTextures(h),y};var w=y(11776),B=y(11513),j=y(11789);b.ThinEngine.prototype.createPrefilteredCubeTexture=function(O,f,y,H){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6?arguments[6]:void 0,N=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,m=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];return this.createCubeTexture(O,f,null,!1,(O=>{if(!O)return void(b&&b(null));const h=O.texture;if(m?O.info.sphericalPolynomial&&(h._sphericalPolynomial=O.info.sphericalPolynomial):h._sphericalPolynomial=new w.h,h._source=9,this.getCaps().textureLOD)return void(b&&b(h));const v=this._gl,N=O.width;if(!N)return;const q=[];for(let b=0;b<3;b++){const m=1-b/2,F=H,I=Math.log2(N)*y+H,A=F+(I-F)*m,J=Math.round(Math.min(Math.max(A,0),I)),X=new S.c(this,2);if(X.type=h.type,X.format=h.format,X.width=Math.pow(2,Math.max(Math.log2(N)-J,0)),X.height=X.width,X.isCube=!0,X._cachedWrapU=0,X._cachedWrapV=0,this._bindTextureDirectly(v.TEXTURE_CUBE_MAP,X,!0),X.samplingMode=2,v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_MAG_FILTER,v.LINEAR),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_MIN_FILTER,v.LINEAR),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),O.isDDS){const f=O.info,y=O.data;this._unpackFlipY(f.isCompressed),j.c.UploadDDSLevels(this,X,y,f,!0,6,J)}else t.e.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(v.TEXTURE_CUBE_MAP,null);const w=new B.d(f);w._isCube=!0,w._texture=X,X.isReady=!0,q.push(w)}h._lodTextureHigh=q[2],h._lodTextureMid=q[1],h._lodTextureLow=q[0],b&&b(h)}),h,v,N,m,y,H)},b.ThinEngine.prototype.createUniformBuffer=function(O,f){const y=this._gl.createBuffer();if(!y)throw new Error("Unable to create uniform buffer");const S=new m.c(y);return this.bindUniformBuffer(S),O instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,O,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(O),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),S.references=1,S},b.ThinEngine.prototype.createDynamicUniformBuffer=function(O,f){const y=this._gl.createBuffer();if(!y)throw new Error("Unable to create dynamic uniform buffer");const S=new m.c(y);return this.bindUniformBuffer(S),O instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,O,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(O),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),S.references=1,S},b.ThinEngine.prototype.updateUniformBuffer=function(O,f,y,S){this.bindUniformBuffer(O),void 0===y&&(y=0),void 0===S?f instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,y,f):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,y,new Float32Array(f)):f instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,f.subarray(y,y+S)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(f).subarray(y,y+S)),this.bindUniformBuffer(null)},b.ThinEngine.prototype.bindUniformBuffer=function(O){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,O?O.underlyingResource:null)},b.ThinEngine.prototype.bindUniformBufferBase=function(O,f,y){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,f,O?O.underlyingResource:null)},b.ThinEngine.prototype.bindUniformBlock=function(O,f,y){const S=O.program,H=this._gl.getUniformBlockIndex(S,f);4294967295!==H&&this._gl.uniformBlockBinding(S,H,y)};var u=y(11009),L=y(11092);L.c.prototype.displayLoadingUI=function(){if(!(0,u.h)())return;const O=this.loadingScreen;O&&O.displayLoadingUI()},L.c.prototype.hideLoadingUI=function(){if(!(0,u.h)())return;const O=this._loadingScreen;O&&O.hideLoadingUI()},Object.defineProperty(L.c.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=L.c.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(O){this._loadingScreen=O},enumerable:!0,configurable:!0}),Object.defineProperty(L.c.prototype,"loadingUIText",{set:function(O){this.loadingScreen.loadingUIText=O},enumerable:!0,configurable:!0}),Object.defineProperty(L.c.prototype,"loadingUIBackgroundColor",{set:function(O){this.loadingScreen.loadingUIBackgroundColor=O},enumerable:!0,configurable:!0}),L.c.prototype.getInputElement=function(){return this._renderingCanvas},L.c.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},L.c.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},L.c.prototype.getAspectRatio=function(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const y=O.viewport;return this.getRenderWidth(f)*y.width/(this.getRenderHeight(f)*y.height)},L.c.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},L.c.prototype._verifyPointerLock=function(){var O;null===(O=this._onPointerLockChange)||void 0===O||O.call(this)},L.c.prototype.setAlphaEquation=function(O){if(this._alphaEquation!==O){switch(O){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=O}},L.c.prototype.getInputElement=function(){return this._renderingCanvas},L.c.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},L.c.prototype.setDepthFunction=function(O){this._depthCullingState.depthFunc=O},L.c.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},L.c.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},L.c.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},L.c.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},L.c.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},L.c.prototype.setDepthWrite=function(O){this._depthCullingState.depthMask=O},L.c.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},L.c.prototype.setStencilBuffer=function(O){this._stencilState.stencilTest=O},L.c.prototype.getStencilMask=function(){return this._stencilState.stencilMask},L.c.prototype.setStencilMask=function(O){this._stencilState.stencilMask=O},L.c.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},L.c.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},L.c.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},L.c.prototype.setStencilFunction=function(O){this._stencilState.stencilFunc=O},L.c.prototype.setStencilFunctionReference=function(O){this._stencilState.stencilFuncRef=O},L.c.prototype.setStencilFunctionMask=function(O){this._stencilState.stencilFuncMask=O},L.c.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},L.c.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},L.c.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},L.c.prototype.setStencilOperationFail=function(O){this._stencilState.stencilOpStencilFail=O},L.c.prototype.setStencilOperationDepthFail=function(O){this._stencilState.stencilOpDepthFail=O},L.c.prototype.setStencilOperationPass=function(O){this._stencilState.stencilOpStencilDepthPass=O},L.c.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},L.c.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},L.c.prototype.setAlphaConstants=function(O,f,y,S){this._alphaState.setAlphaBlendConstants(O,f,y,S)},L.c.prototype.getAlphaMode=function(){return this._alphaMode},L.c.prototype.getAlphaEquation=function(){return this._alphaEquation},L.c.prototype.getRenderPassNames=function(){return this._renderPassNames},L.c.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},L.c.prototype.createRenderPassId=function(O){const f=++L.c._RenderPassIdCounter;return this._renderPassNames[f]=O??"NONAME",f},L.c.prototype.releaseRenderPassId=function(O){this._renderPassNames[O]=void 0;for(let f=0;f<this.scenes.length;++f){const y=this.scenes[f];for(let f=0;f<y.meshes.length;++f){const S=y.meshes[f];if(S.Yf)for(let f=0;f<S.Yf.length;++f){S.Yf[f]._removeDrawWrapper(O)}}}};y(11772);function p(O){if(O.requestPointerLock){const f=O.requestPointerLock();f instanceof Promise?f.then((()=>{O.focus()})).catch((()=>{})):O.focus()}}var U=y(11166);y(11831);class l extends b.ThinEngine{static get NpmPackage(){return L.c.NpmPackage}static get Version(){return L.c.Version}static get Instances(){return H.c.Instances}static get LastCreatedEngine(){return H.c.LastCreatedEngine}static get LastCreatedScene(){return H.c.LastCreatedScene}static DefaultLoadingScreenFactory(O){return L.c.DefaultLoadingScreenFactory(O)}get _supportsHardwareTextureRescaling(){return!!l._RescalePostProcessFactory}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}get performanceMonitor(){return this._performanceMonitor}constructor(O,f,y){if(super(O,f,y,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this.customAnimationFrameRequester=null,this._performanceMonitor=new v,this._drawCalls=new U.d,O&&(this._features.supportRenderPasses=!0,y=this._creationOptions,O.getContext)){const f=O;this._sharedInit(f)}}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_sharedInit(O){super._sharedInit(O),function(O,f,y){O._onCanvasFocus=()=>{O.onCanvasFocusObservable.notifyObservers(O)},O._onCanvasBlur=()=>{O.onCanvasBlurObservable.notifyObservers(O)},O._onCanvasContextMenu=f=>{O.disableContextMenu&&f.preventDefault()},f.addEventListener("focus",O._onCanvasFocus),f.addEventListener("blur",O._onCanvasBlur),f.addEventListener("contextmenu",O._onCanvasContextMenu),O._onBlur=()=>{O.disablePerformanceMonitorInBackground&&O.performanceMonitor.disable(),O._windowIsBackground=!0},O._onFocus=()=>{O.disablePerformanceMonitorInBackground&&O.performanceMonitor.enable(),O._windowIsBackground=!1},O._onCanvasPointerOut=y=>{document.elementFromPoint(y.clientX,y.clientY)!==f&&O.onCanvasPointerOutObservable.notifyObservers(y)};const S=O.getHostWindow();S&&"function"===typeof S.addEventListener&&(S.addEventListener("blur",O._onBlur),S.addEventListener("focus",O._onFocus)),f.addEventListener("pointerout",O._onCanvasPointerOut),y.doNotHandleTouchAction||function(O){O&&O.setAttribute&&(O.setAttribute("touch-action","none"),O.style.touchAction="none",O.style.webkitTapHighlightColor="transparent")}(f),!L.c.audioEngine&&y.audioEngine&&L.c.AudioEngineFactory&&(L.c.audioEngine=L.c.AudioEngineFactory(O.getRenderingCanvas(),O.getAudioContext(),O.getAudioDestination())),(0,u.c)()&&(O._onFullscreenChange=()=>{O.isFullscreen=!!document.fullscreenElement,O.isFullscreen&&O._pointerLockRequested&&f&&p(f)},document.addEventListener("fullscreenchange",O._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",O._onFullscreenChange,!1),O._onPointerLockChange=()=>{O.isPointerLock=document.pointerLockElement===f},document.addEventListener("pointerlockchange",O._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",O._onPointerLockChange,!1)),O.enableOfflineSupport=void 0!==L.c.OfflineProviderFactory,O._deterministicLockstep=!!y.deterministicLockstep,O._lockstepMaxSteps=y.lockstepMaxSteps||0,O._timeStep=y.timeStep||1/60}(this,O,this._creationOptions)}resizeImageBitmap(O,f,y){return function(O,f,y,S){const H=O.createCanvas(y,S).getContext("2d");if(!H)throw new Error("Unable to get 2d context for resizeImageBitmap");return H.drawImage(f,0,0),H.getImageData(0,0,y,S).data}(this,O,f,y)}_createImageBitmapFromSource(O,f){return function(O,f,y){return new Promise(((S,H)=>{const b=new Image;b.onload=()=>{b.decode().then((()=>{O.createImageBitmap(b,y).then((O=>{S(O)}))}))},b.onerror=()=>{H(`Error loading image ${b.src}`)},b.src=f}))}(this,O,f)}switchFullscreen(O){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(O)}enterFullscreen(O){this.isFullscreen||(this._pointerLockRequested=O,this._renderingCanvas&&function(O){const f=O.requestFullscreen||O.webkitRequestFullscreen;f&&f.call(O)}(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&function(){const O=document;document.exitFullscreen?document.exitFullscreen():O.webkitCancelFullScreen&&O.webkitCancelFullScreen()}()}setDitheringState(O){O?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(O){O?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}setDirectViewport(O,f,y,S){const H=this._cachedViewport;return this._cachedViewport=null,this._viewport(O,f,y,S),H}scissorClear(O,f,y,S,H){this.enableScissor(O,f,y,S),this.clear(H,!0,!0,!0),this.disableScissor()}enableScissor(O,f,y,S){const H=this._gl;H.enable(H.SCISSOR_TEST),H.scissor(O,f,y,S)}disableScissor(){const O=this._gl;O.disable(O.SCISSOR_TEST)}_loadFileAsync(O,f,y){return new Promise(((S,H)=>{this._loadFile(O,(O=>{S(O)}),void 0,f,y,((O,f)=>{H(f)}))}))}getVertexShaderSource(O){const f=this._gl.getAttachedShaders(O);return f?this._gl.getShaderSource(f[0]):null}getFragmentShaderSource(O){const f=this._gl.getAttachedShaders(O);return f?this._gl.getShaderSource(f[1]):null}set framebufferDimensionsObject(O){this._framebufferDimensionsObject=O,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}_rebuildBuffers(){for(const O of this.scenes)O.resetCachedMaterial(),O._rebuildGeometries();for(const O of this._virtualScenes)O.resetCachedMaterial(),O._rebuildGeometries();super._rebuildBuffers()}getFontOffset(O){return function(O){const f=document.createElement("span");f.textContent="Hg",f.style.font=O;const y=document.createElement("div");y.style.display="inline-block",y.style.width="1px",y.style.height="0px",y.style.verticalAlign="bottom";const S=document.createElement("div");S.style.whiteSpace="nowrap",S.appendChild(f),S.appendChild(y),document.body.appendChild(S);let H=0,b=0;try{b=y.getBoundingClientRect().top-f.getBoundingClientRect().top,y.style.verticalAlign="baseline",H=y.getBoundingClientRect().top-f.getBoundingClientRect().top}finally{document.body.removeChild(S)}return{ascent:H,height:b,descent:b-H}}(O)}_cancelFrame(){if(this.customAnimationFrameRequester){if(0!==this._frameHandler){this._frameHandler=0;const{cancelAnimationFrame:O}=this.customAnimationFrameRequester;O&&O(this.customAnimationFrameRequester.v)}}else super._cancelFrame()}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let O=!0;(this.u||!this.renderEvenInBackground&&this._windowIsBackground)&&(O=!1),O&&(this.cj(),this._renderViews()||this._renderFrame(),this.dj())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.v=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.v):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}enterPointerlock(){this._renderingCanvas&&p(this._renderingCanvas)}exitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}cj(){this._measureFps(),super.cj()}_deletePipelineContext(O){const f=O;f&&f.program&&f.transformFeedback&&(this.deleteTransformFeedback(f.transformFeedback),f.transformFeedback=null),super._deletePipelineContext(O)}createShaderProgram(O,f,y,S,H){let b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;H=H||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const h=super.createShaderProgram(O,f,y,S,H,b);return this.onAfterShaderCompilationObservable.notifyObservers(this),h}_createShaderProgram(O,f,y,S){let H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const b=S.createProgram();if(O.program=b,!b)throw new Error("Unable to create program");if(S.attachShader(b,f),S.attachShader(b,y),this.webGLVersion>1&&H){const f=this.createTransformFeedback();this.bindTransformFeedback(f),this.setTranformFeedbackVaryings(b,H),O.transformFeedback=f}return S.linkProgram(b),this.webGLVersion>1&&H&&this.bindTransformFeedback(null),O.context=S,O.vertexShader=f,O.fragmentShader=y,O.isParallelCompiled||this._finalizePipelineContext(O),b}_releaseTexture(O){super._releaseTexture(O)}_releaseRenderTargetWrapper(O){super._releaseRenderTargetWrapper(O),this.scenes.forEach((f=>{f.postProcesses.forEach((f=>{f._outputTexture===O&&(f._outputTexture=null)})),f.cameras.forEach((f=>{f._postProcesses.forEach((f=>{f&&f._outputTexture===O&&(f._outputTexture=null)}))}))}))}_rescaleTexture(O,f,y,S,H){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const b=this.createRenderTargetTexture({width:f.width,height:f.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});if(!this._rescalePostProcess&&l._RescalePostProcessFactory&&(this._rescalePostProcess=l._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;const h=()=>{this._rescalePostProcess.onApply=function(f){f._bindTexture("textureSampler",O)};let h=y;h||(h=this.scenes[this.scenes.length-1]),h.postProcessManager.directRender([this._rescalePostProcess],b,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,f,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,S,0,0,f.width,f.height,0),this.unBindFramebuffer(b),b.dispose(),H&&H()},v=this._rescalePostProcess.getEffect();v?v.executeWhenCompiled(h):this._rescalePostProcess.onEffectCreatedObservable.addOnce((O=>{O.executeWhenCompiled(h)}))}}wrapWebGLTexture(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const h=new q.b(O,this._gl),v=new S.c(this,0,!0);return v._hardwareTexture=h,v.baseWidth=H,v.baseHeight=b,v.width=H,v.height=b,v.isReady=!0,v.useMipMaps=f,this.updateTextureSamplingMode(y,v),v}_uploadImageToTexture(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const H=this._gl,b=this._getWebGLTextureType(O.type),h=this._getInternalFormat(O.format),v=this._getRGBABufferInternalSizedFormat(O.type,h),N=O.isCube?H.TEXTURE_CUBE_MAP:H.TEXTURE_2D;this._bindTextureDirectly(N,O,!0),this._unpackFlipY(O.invertY);let m=H.TEXTURE_2D;O.isCube&&(m=H.TEXTURE_CUBE_MAP_POSITIVE_X+y),H.texImage2D(m,S,v,h,b,f),this._bindTextureDirectly(N,null,!0)}updateTextureComparisonFunction(O,f){if(1===this.webGLVersion)return void t.e.Error("WebGL 1 does not support texture comparison.");const y=this._gl;O.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,O,!0),0===f?(y.texParameteri(y.TEXTURE_CUBE_MAP,y.TEXTURE_COMPARE_FUNC,515),y.texParameteri(y.TEXTURE_CUBE_MAP,y.TEXTURE_COMPARE_MODE,y.NONE)):(y.texParameteri(y.TEXTURE_CUBE_MAP,y.TEXTURE_COMPARE_FUNC,f),y.texParameteri(y.TEXTURE_CUBE_MAP,y.TEXTURE_COMPARE_MODE,y.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,O,!0),0===f?(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_COMPARE_FUNC,515),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_COMPARE_MODE,y.NONE)):(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_COMPARE_FUNC,f),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_COMPARE_MODE,y.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),O._comparisonFunction=f}createInstancesBuffer(O){const f=this._gl.createBuffer();if(!f)throw new Error("Unable to create instance buffer");const y=new m.c(f);return y.kb=O,this.bindArrayBuffer(y),this._gl.bufferData(this._gl.ARRAY_BUFFER,O,this._gl.DYNAMIC_DRAW),y.references=1,y}deleteInstancesBuffer(O){this._gl.deleteBuffer(O)}_clientWaitAsync(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;const S=this._gl;return new Promise(((H,b)=>{const h=()=>{const v=S.clientWaitSync(O,f,0);v!=S.WAIT_FAILED?v!=S.TIMEOUT_EXPIRED?H():setTimeout(h,y):b()};h()}))}_readPixelsAsync(O,f,y,S,H,b,h){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const v=this._gl,N=v.createBuffer();v.bindBuffer(v.PIXEL_PACK_BUFFER,N),v.bufferData(v.PIXEL_PACK_BUFFER,h.byteLength,v.STREAM_READ),v.readPixels(O,f,y,S,H,b,0),v.bindBuffer(v.PIXEL_PACK_BUFFER,null);const m=v.fenceSync(v.SYNC_GPU_COMMANDS_COMPLETE,0);return m?(v.flush(),this._clientWaitAsync(m,0,10).then((()=>(v.deleteSync(m),v.bindBuffer(v.PIXEL_PACK_BUFFER,N),v.getBufferSubData(v.PIXEL_PACK_BUFFER,0,h),v.bindBuffer(v.PIXEL_PACK_BUFFER,null),v.deleteBuffer(N),h)))):null}dispose(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),function(O,f){1===H.c.Instances.length&&L.c.audioEngine&&(L.c.audioEngine.dispose(),L.c.audioEngine=null);const y=O.getHostWindow();y&&"function"===typeof y.removeEventListener&&(y.removeEventListener("blur",O._onBlur),y.removeEventListener("focus",O._onFocus)),f&&(f.removeEventListener("focus",O._onCanvasFocus),f.removeEventListener("blur",O._onCanvasBlur),f.removeEventListener("pointerout",O._onCanvasPointerOut),f.removeEventListener("contextmenu",O._onCanvasContextMenu)),(0,u.c)()&&(document.removeEventListener("fullscreenchange",O._onFullscreenChange),document.removeEventListener("mozfullscreenchange",O._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",O._onFullscreenChange),document.removeEventListener("msfullscreenchange",O._onFullscreenChange),document.removeEventListener("pointerlockchange",O._onPointerLockChange),document.removeEventListener("mspointerlockchange",O._onPointerLockChange),document.removeEventListener("mozpointerlockchange",O._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",O._onPointerLockChange))}(this,this._renderingCanvas),super.dispose()}}l.ALPHA_DISABLE=0,l.ALPHA_ADD=1,l.ALPHA_COMBINE=2,l.ALPHA_SUBTRACT=3,l.ALPHA_MULTIPLY=4,l.ALPHA_MAXIMIZED=5,l.ALPHA_ONEONE=6,l.ALPHA_PREMULTIPLIED=7,l.ALPHA_PREMULTIPLIED_PORTERDUFF=8,l.ALPHA_INTERPOLATE=9,l.ALPHA_SCREENMODE=10,l.DELAYLOADSTATE_NONE=0,l.DELAYLOADSTATE_LOADED=1,l.DELAYLOADSTATE_LOADING=2,l.DELAYLOADSTATE_NOTLOADED=4,l.NEVER=512,l.ALWAYS=519,l.LESS=513,l.EQUAL=514,l.LEQUAL=515,l.GREATER=516,l.GEQUAL=518,l.NOTEQUAL=517,l.KEEP=7680,l.REPLACE=7681,l.INCR=7682,l.DECR=7683,l.INVERT=5386,l.INCR_WRAP=34055,l.DECR_WRAP=34056,l.TEXTURE_CLAMP_ADDRESSMODE=0,l.TEXTURE_WRAP_ADDRESSMODE=1,l.TEXTURE_MIRROR_ADDRESSMODE=2,l.TEXTUREFORMAT_ALPHA=0,l.TEXTUREFORMAT_LUMINANCE=1,l.TEXTUREFORMAT_LUMINANCE_ALPHA=2,l.TEXTUREFORMAT_RGB=4,l.TEXTUREFORMAT_RGBA=5,l.TEXTUREFORMAT_RED=6,l.TEXTUREFORMAT_R=6,l.TEXTUREFORMAT_RG=7,l.TEXTUREFORMAT_RED_INTEGER=8,l.TEXTUREFORMAT_R_INTEGER=8,l.TEXTUREFORMAT_RG_INTEGER=9,l.TEXTUREFORMAT_RGB_INTEGER=10,l.TEXTUREFORMAT_RGBA_INTEGER=11,l.TEXTURETYPE_UNSIGNED_BYTE=0,l.TEXTURETYPE_UNSIGNED_INT=0,l.TEXTURETYPE_FLOAT=1,l.TEXTURETYPE_HALF_FLOAT=2,l.TEXTURETYPE_BYTE=3,l.TEXTURETYPE_SHORT=4,l.TEXTURETYPE_UNSIGNED_SHORT=5,l.TEXTURETYPE_INT=6,l.TEXTURETYPE_UNSIGNED_INTEGER=7,l.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,l.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,l.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,l.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,l.TEXTURETYPE_UNSIGNED_INT_24_8=12,l.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,l.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,l.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,l.TEXTURE_NEAREST_SAMPLINGMODE=1,l.TEXTURE_BILINEAR_SAMPLINGMODE=2,l.TEXTURE_TRILINEAR_SAMPLINGMODE=3,l.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,l.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,l.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,l.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,l.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,l.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,l.TEXTURE_NEAREST_LINEAR=7,l.TEXTURE_NEAREST_NEAREST=1,l.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,l.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,l.TEXTURE_LINEAR_LINEAR=2,l.TEXTURE_LINEAR_NEAREST=12,l.TEXTURE_EXPLICIT_MODE=0,l.TEXTURE_SPHERICAL_MODE=1,l.TEXTURE_PLANAR_MODE=2,l.TEXTURE_CUBIC_MODE=3,l.TEXTURE_PROJECTION_MODE=4,l.TEXTURE_SKYBOX_MODE=5,l.TEXTURE_INVCUBIC_MODE=6,l.TEXTURE_EQUIRECTANGULAR_MODE=7,l.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,l.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,l.SCALEMODE_FLOOR=1,l.SCALEMODE_NEAREST=2,l.SCALEMODE_CEILING=3},11042:(O,f,y)=>{"use strict";y.d(f,{c:()=>H});var S=y(11004);class H{static get LastCreatedEngine(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}static get LastCreatedScene(){return this._LastCreatedScene}}H.Instances=[],H.OnEnginesDisposedObservable=new S.d,H._LastCreatedScene=null,H.UseFallbackTexture=!0,H.FallbackTexture=""},12702:(O,f,y)=>{"use strict";y(11017);var S=y(11754);y(11126),y(11394),y(11118),y(11765),y(11720);S.d},11118:(O,f,y)=>{"use strict";y.d(f,{c:()=>S});class S{static SetMatrixPrecision(O){if(S.MatrixTrackPrecisionChange=!1,O&&!S.MatrixUse64Bits&&S.MatrixTrackedMatrices)for(let f=0;f<S.MatrixTrackedMatrices.length;++f){const O=S.MatrixTrackedMatrices[f],y=O.Nj;O.Nj=new Array(16);for(let f=0;f<16;++f)O.Nj[f]=y[f]}S.MatrixUse64Bits=O,S.MatrixCurrentType=S.MatrixUse64Bits?Array:Float32Array,S.MatrixTrackedMatrices=null}}S.MatrixUse64Bits=!1,S.MatrixTrackPrecisionChange=!0,S.MatrixCurrentType=Float32Array,S.MatrixTrackedMatrices=[]},11765:(O,f,y)=>{"use strict";y.d(f,{c:()=>S});class S{get depthStencilTexture(){return this._depthStencilTexture}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}get isCube(){return this._isCube}get isMulti(){return this._isMulti}get is2DArray(){return this.layers>0}get is3D(){return this.depth>0}get size(){return this.width}get width(){return this._size.width||this._size}get height(){return this._size.height||this._size}get layers(){return this._size.layers||0}get depth(){return this._size.depth||0}get texture(){var O;return(null===(O=this._textures)||void 0===O?void 0:O[0])??null}get textures(){return this._textures}get faceIndices(){return this._faceIndices}get layerIndices(){return this._layerIndices}getBaseArrayLayer(O){var f,y;if(!this._textures)return-1;const S=this._textures[O],H=(null===(f=this._layerIndices)||void 0===f?void 0:f[O])??0,b=(null===(y=this._faceIndices)||void 0===y?void 0:y[O])??0;return S.isCube?6*H+b:S.is3D?0:H}get samples(){return this._samples}setSamples(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.samples===O&&!y)return O;const S=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,O,f):this._engine.updateRenderTargetTextureSampleCount(this,O);return this._samples=O,S}constructor(O,f,y,S,H){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this._isMulti=O,this._isCube=f,this._size=y,this._engine=S,this._depthStencilTexture=null,this.label=H}setTextures(O){Array.isArray(O)?this._textures=O:this._textures=O?[O]:null}setTexture(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._textures||(this._textures=[]),this._textures[f]!==O&&(this._textures[f]&&y&&this._textures[f].dispose(),this._textures[f]=O)}setLayerAndFaceIndices(O,f){this._layerIndices=O,this._faceIndices=f}setLayerAndFaceIndex(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1?arguments[1]:void 0,y=arguments.length>2?arguments[2]:void 0;this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),void 0!==f&&f>=0&&(this._layerIndices[O]=f),void 0!==y&&y>=0&&(this._faceIndices[O]=y)}createDepthStencilTexture(){var O;let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],S=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,h=arguments.length>5?arguments[5]:void 0;return null===(O=this._depthStencilTexture)||void 0===O||O.dispose(),this._depthStencilTextureWithStencil=S,this._depthStencilTextureLabel=h,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:y,comparisonFunction:f,generateStencil:S,isCube:this._isCube,samples:H,depthTextureFormat:b,label:h},this),this._depthStencilTexture}_shareDepth(O){this.shareDepth(O)}shareDepth(O){this._depthStencilTexture&&(O._depthStencilTexture&&O._depthStencilTexture.dispose(),O._depthStencilTexture=this._depthStencilTexture,O._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}_swapAndDie(O){this.texture&&this.texture._swapAndDie(O),this._textures=null,this.dispose(!0)}_cloneRenderTargetWrapper(){let O=null;if(this._isMulti){const f=this.textures;if(f&&f.length>0){let y=!1,S=f.length,H=-1;const b=f[f.length-1]._source;14!==b&&12!==b||(y=!0,H=f[f.length-1].format,S--);const h=[],v=[],N=[],m=[],t=[],q=[],F=[],I={};for(let O=0;O<S;++O){const y=f[O];h.push(y.samplingMode),v.push(y.type),N.push(y.format);void 0!==I[y.uniqueId]?(m.push(-1),F.push(0)):(I[y.uniqueId]=O,y.is2DArray?(m.push(35866),F.push(y.depth)):y.isCube?(m.push(34067),F.push(0)):y.is3D?(m.push(32879),F.push(y.depth)):(m.push(3553),F.push(0))),this._faceIndices&&t.push(this._faceIndices[O]??0),this._layerIndices&&q.push(this._layerIndices[O]??0)}const A={samplingModes:h,generateMipMaps:f[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:y,depthTextureFormat:H,types:v,formats:N,textureCount:S,targetTypes:m,faceIndex:t,layerIndex:q,layerCounts:F,label:this.label},J={width:this.width,height:this.height,depth:this.depth};O=this._engine.createMultipleRenderTarget(J,A);for(let X=0;X<S;++X){if(-1!==m[X])continue;const y=I[f[X].uniqueId];O.setTexture(O.textures[y],X)}}}else{var f,y,S,H;const h={};if(h.generateDepthBuffer=this._generateDepthBuffer,h.generateMipMaps=(null===(f=this.texture)||void 0===f?void 0:f.generateMipMaps)??!1,h.generateStencilBuffer=this._generateStencilBuffer,h.samplingMode=null===(y=this.texture)||void 0===y?void 0:y.samplingMode,h.type=null===(S=this.texture)||void 0===S?void 0:S.type,h.format=null===(H=this.texture)||void 0===H?void 0:H.format,h.noColorAttachment=!this._textures,h.label=this.label,this.isCube)O=this._engine.createRenderTargetCubeTexture(this.width,h);else{var b;const f={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?null===(b=this.texture)||void 0===b?void 0:b.depth:void 0};O=this._engine.createRenderTargetTexture(f,h)}O.texture&&(O.texture.isReady=!0)}return O}_swapRenderTargetWrapper(O){if(this._textures&&O._textures)for(let f=0;f<this._textures.length;++f)this._textures[f]._swapAndDie(O._textures[f],!1),O._textures[f].isReady=!0;this._depthStencilTexture&&O._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(O._depthStencilTexture),O._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}_rebuild(){const O=this._cloneRenderTargetWrapper();if(O){if(this._depthStencilTexture){const f=this._depthStencilTexture.samplingMode,y=this._depthStencilTexture.format,S=2===f||3===f||11===f;O.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,S,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,y,this._depthStencilTextureLabel)}this.samples>1&&O.setSamples(this.samples),O._swapRenderTargetWrapper(this),O.dispose()}}releaseTextures(){if(this._textures)for(let f=0;f<(null===(O=this._textures)||void 0===O?void 0:O.length);++f){var O;this._textures[f].dispose()}this._textures=null}dispose(){var O;arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(null===(O=this._depthStencilTexture)||void 0===O||O.dispose(),this._depthStencilTexture=null,this.releaseTextures());this._engine._releaseRenderTargetWrapper(this)}}},11101:(O,f,y)=>{"use strict";y.d(f,{c:()=>S});class S{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?S.ShadersRepository:S.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?S.ShadersStore:S.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?S.IncludesShadersStore:S.IncludesShadersStoreWGSL}}S.ShadersRepository="src/Shaders/",S.ShadersStore={},S.IncludesShadersStore={},S.ShadersRepositoryWGSL="src/ShadersWGSL/",S.ShadersStoreWGSL={},S.IncludesShadersStoreWGSL={}},11113:(O,f,y)=>{"use strict";y.d(f,{e:()=>F,i:()=>B,l:()=>I,n:()=>A,q:()=>w,s:()=>q,u:()=>m,y:()=>t,A:()=>N,C:()=>v});class S{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.ad._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(O){O&&this.program&&O(this.program)}setEngine(O){this.ad=O}_fillEffectInformation(O,f,y,S,H,b,h,v){const N=this.ad;if(N.supportsUniformBuffers)for(const t in f)O.bindUniformBlock(t,f[t]);let m;for(this.ad.getUniforms(this,y).forEach(((O,f)=>{S[y[f]]=O})),this._uniforms=S,m=0;m<H.length;m++){null==O.getUniform(H[m])&&(H.splice(m,1),m--)}H.forEach(((O,f)=>{b[O]=f}));for(const t of N.getAttributes(this,h))v.push(t)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(O,f){const y=this._valueCache[O],S=f.updateFlag;return(void 0===y||y!==S)&&(this._valueCache[O]=S,!0)}_cacheFloat2(O,f,y){let S=this._valueCache[O];if(!S||2!==S.length)return S=[f,y],this._valueCache[O]=S,!0;let H=!1;return S[0]!==f&&(S[0]=f,H=!0),S[1]!==y&&(S[1]=y,H=!0),H}_cacheFloat3(O,f,y,S){let H=this._valueCache[O];if(!H||3!==H.length)return H=[f,y,S],this._valueCache[O]=H,!0;let b=!1;return H[0]!==f&&(H[0]=f,b=!0),H[1]!==y&&(H[1]=y,b=!0),H[2]!==S&&(H[2]=S,b=!0),b}_cacheFloat4(O,f,y,S,H){let b=this._valueCache[O];if(!b||4!==b.length)return b=[f,y,S,H],this._valueCache[O]=b,!0;let h=!1;return b[0]!==f&&(b[0]=f,h=!0),b[1]!==y&&(b[1]=y,h=!0),b[2]!==S&&(b[2]=S,h=!0),b[3]!==H&&(b[3]=H,h=!0),h}setInt(O,f){const y=this._valueCache[O];void 0!==y&&y===f||this.ad.setInt(this._uniforms[O],f)&&(this._valueCache[O]=f)}setInt2(O,f,y){this._cacheFloat2(O,f,y)&&(this.ad.setInt2(this._uniforms[O],f,y)||(this._valueCache[O]=null))}setInt3(O,f,y,S){this._cacheFloat3(O,f,y,S)&&(this.ad.setInt3(this._uniforms[O],f,y,S)||(this._valueCache[O]=null))}setInt4(O,f,y,S,H){this._cacheFloat4(O,f,y,S,H)&&(this.ad.setInt4(this._uniforms[O],f,y,S,H)||(this._valueCache[O]=null))}setIntArray(O,f){this._valueCache[O]=null,this.ad.setIntArray(this._uniforms[O],f)}setIntArray2(O,f){this._valueCache[O]=null,this.ad.setIntArray2(this._uniforms[O],f)}setIntArray3(O,f){this._valueCache[O]=null,this.ad.setIntArray3(this._uniforms[O],f)}setIntArray4(O,f){this._valueCache[O]=null,this.ad.setIntArray4(this._uniforms[O],f)}setUInt(O,f){const y=this._valueCache[O];void 0!==y&&y===f||this.ad.setUInt(this._uniforms[O],f)&&(this._valueCache[O]=f)}setUInt2(O,f,y){this._cacheFloat2(O,f,y)&&(this.ad.setUInt2(this._uniforms[O],f,y)||(this._valueCache[O]=null))}setUInt3(O,f,y,S){this._cacheFloat3(O,f,y,S)&&(this.ad.setUInt3(this._uniforms[O],f,y,S)||(this._valueCache[O]=null))}setUInt4(O,f,y,S,H){this._cacheFloat4(O,f,y,S,H)&&(this.ad.setUInt4(this._uniforms[O],f,y,S,H)||(this._valueCache[O]=null))}setUIntArray(O,f){this._valueCache[O]=null,this.ad.setUIntArray(this._uniforms[O],f)}setUIntArray2(O,f){this._valueCache[O]=null,this.ad.setUIntArray2(this._uniforms[O],f)}setUIntArray3(O,f){this._valueCache[O]=null,this.ad.setUIntArray3(this._uniforms[O],f)}setUIntArray4(O,f){this._valueCache[O]=null,this.ad.setUIntArray4(this._uniforms[O],f)}setArray(O,f){this._valueCache[O]=null,this.ad.setArray(this._uniforms[O],f)}setArray2(O,f){this._valueCache[O]=null,this.ad.setArray2(this._uniforms[O],f)}setArray3(O,f){this._valueCache[O]=null,this.ad.setArray3(this._uniforms[O],f)}setArray4(O,f){this._valueCache[O]=null,this.ad.setArray4(this._uniforms[O],f)}setMatrices(O,f){f&&(this._valueCache[O]=null,this.ad.setMatrices(this._uniforms[O],f))}setMatrix(O,f){this._cacheMatrix(O,f)&&(this.ad.setMatrices(this._uniforms[O],f.gj())||(this._valueCache[O]=null))}setMatrix3x3(O,f){this._valueCache[O]=null,this.ad.setMatrix3x3(this._uniforms[O],f)}setMatrix2x2(O,f){this._valueCache[O]=null,this.ad.setMatrix2x2(this._uniforms[O],f)}setFloat(O,f){const y=this._valueCache[O];void 0!==y&&y===f||this.ad.setFloat(this._uniforms[O],f)&&(this._valueCache[O]=f)}setVector2(O,f){this._cacheFloat2(O,f.x,f.y)&&(this.ad.setFloat2(this._uniforms[O],f.x,f.y)||(this._valueCache[O]=null))}setFloat2(O,f,y){this._cacheFloat2(O,f,y)&&(this.ad.setFloat2(this._uniforms[O],f,y)||(this._valueCache[O]=null))}setVector3(O,f){this._cacheFloat3(O,f.x,f.y,f.z)&&(this.ad.setFloat3(this._uniforms[O],f.x,f.y,f.z)||(this._valueCache[O]=null))}setFloat3(O,f,y,S){this._cacheFloat3(O,f,y,S)&&(this.ad.setFloat3(this._uniforms[O],f,y,S)||(this._valueCache[O]=null))}setVector4(O,f){this._cacheFloat4(O,f.x,f.y,f.z,f.w)&&(this.ad.setFloat4(this._uniforms[O],f.x,f.y,f.z,f.w)||(this._valueCache[O]=null))}setQuaternion(O,f){this._cacheFloat4(O,f.x,f.y,f.z,f.w)&&(this.ad.setFloat4(this._uniforms[O],f.x,f.y,f.z,f.w)||(this._valueCache[O]=null))}setFloat4(O,f,y,S,H){this._cacheFloat4(O,f,y,S,H)&&(this.ad.setFloat4(this._uniforms[O],f,y,S,H)||(this._valueCache[O]=null))}setColor3(O,f){this._cacheFloat3(O,f.r,f.g,f.b)&&(this.ad.setFloat3(this._uniforms[O],f.r,f.g,f.b)||(this._valueCache[O]=null))}setColor4(O,f,y){this._cacheFloat4(O,f.r,f.g,f.b,y)&&(this.ad.setFloat4(this._uniforms[O],f.r,f.g,f.b,y)||(this._valueCache[O]=null))}setDirectColor4(O,f){this._cacheFloat4(O,f.r,f.g,f.b,f.a)&&(this.ad.setFloat4(this._uniforms[O],f.r,f.g,f.b,f.a)||(this._valueCache[O]=null))}_getVertexShaderCode(){return this.vertexShader?this.ad._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.ad._getShaderSource(this.fragmentShader):null}}var H=y(11079);const b=new WeakMap,h={_webGLVersion:2,cachedPipelines:{}};function v(O){let f=b.get(O);if(!f){if(!O)return h;f={_webGLVersion:O.TEXTURE_BINDING_3D?2:1,_context:O,cachedPipelines:{}},b.set(O,f)}return f}function N(O){b.delete(O)}function m(O,f,y,S,H,b){const h=v(S);b||(b=h._createShaderProgramInjection??F);return b(O,X(f,"vertex",S,h._contextWasLost),X(y,"fragment",S,h._contextWasLost),S,H,h.validateShaderPrograms)}function t(O,f,y,S,H){let b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,h=arguments.length>6?arguments[6]:void 0;const N=v(H);h||(h=N._createShaderProgramInjection??F);const m=N._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return h(O,J(f,"vertex",S,m,H,N._contextWasLost),J(y,"fragment",S,m,H,N._contextWasLost),H,b,N.validateShaderPrograms)}function q(O,f){const y=new S,H=v(O);return H.parallelShaderCompile&&(y.isParallelCompiled=!0),y.context=H._context,y}function F(O,f,y,S){let H=arguments.length>5?arguments[5]:void 0;const b=S.createProgram();if(O.program=b,!b)throw new Error("Unable to create program");return S.attachShader(b,f),S.attachShader(b,y),S.linkProgram(b),O.context=S,O.vertexShader=f,O.fragmentShader=y,O.isParallelCompiled||I(O,S,H),b}function I(O,f,y){const S=O.context,H=O.vertexShader,b=O.fragmentShader,h=O.program;if(!S.getProgramParameter(h,S.LINK_STATUS)){if(!f.getShaderParameter(H,f.COMPILE_STATUS)){const y=f.getShaderInfoLog(H);if(y)throw O.vertexCompilationError=y,new Error("VERTEX SHADER "+y)}if(!f.getShaderParameter(b,f.COMPILE_STATUS)){const y=f.getShaderInfoLog(b);if(y)throw O.fragmentCompilationError=y,new Error("FRAGMENT SHADER "+y)}const y=S.getProgramInfoLog(h);if(y)throw O.programLinkError=y,new Error(y)}if(y){S.validateProgram(h);if(!S.getProgramParameter(h,S.VALIDATE_STATUS)){const f=S.getProgramInfoLog(h);if(f)throw O.programValidationError=f,new Error(f)}}S.deleteShader(H),S.deleteShader(b),O.vertexShader=void 0,O.fragmentShader=void 0,O.onCompiled&&(O.onCompiled(),O.onCompiled=void 0)}function A(O,f,y,S,H,b,h,N,q){let F=arguments.length>10?arguments[10]:void 0,I=arguments.length>11?arguments[11]:void 0,A=arguments.length>12?arguments[12]:void 0;const J=v(O.context);I||(I=J.createRawShaderProgramInjection??m),A||(A=J.createShaderProgramInjection??t);const X=O;X.program=S?I(X,f,y,X.context,q):A(X,f,y,N,X.context,q),X.program.__SPECTOR_rebuildProgram=h,F()}function J(O,f,y,S,b,h){return X((0,H.d)(O,y,S),f,b,h)}function X(O,f,y,S){const H=y.createShader("vertex"===f?y.VERTEX_SHADER:y.FRAGMENT_SHADER);if(!H){let O=y.NO_ERROR,H=y.NO_ERROR;for(;(H=y.getError())!==y.NO_ERROR;)O=H;throw new Error(`Something went wrong while creating a gl ${f} shader object. gl error=${O}, gl isContextLost=${y.isContextLost()}, _contextWasLost=${S}`)}return y.shaderSource(H,O),y.compileShader(H),H}function w(O,f){f.useProgram(O)}function B(O,f){const y=O;if(!y.isParallelCompiled)return void f(O);const S=y.onCompiled;y.onCompiled=()=>{null===S||void 0===S||S(),f(O)}}},11712:(O,f,y)=>{"use strict";y.r(f),y.d(f,{ThinEngine:()=>j});var S=y(11113),H=y(11720),b=y(11017),h=y(11009);class v{constructor(){this.shaderLanguage=0}postProcessor(O,f,y,S,H){if(H.drawBuffersExtensionDisabled){const f=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;O=O.replace(f,"")}return O}}const N=/(flat\s)?\s*varying\s*.*/;class m{constructor(){this.shaderLanguage=0}attributeProcessor(O){return O.replace("attribute","in")}varyingCheck(O,f){return N.test(O)}varyingProcessor(O,f){return O.replace("varying",f?"in":"out")}postProcessor(O,f,y){const S=-1!==O.search(/#extension.+GL_EXT_draw_buffers.+require/);if(O=(O=O.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),y){const f=-1!==O.search(/layout *\(location *= *0\) *out/g);O=(O=(O=(O=(O=(O=(O=O.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(S||f?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==f.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+O}return O}}var t=y(11728),q=y(11161),F=y(11092),I=y(11735),A=y(11126),J=y(11098),X=y(11079),w=y(11104);class B{}class j extends F.c{get name(){return this._name}set name(O){this._name=O}get version(){return this._webGLVersion}static get ShadersRepository(){return J.b.ShadersRepository}static set ShadersRepository(O){J.b.ShadersRepository=O}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(O){this._framebufferDimensionsObject=O}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(O,f,y,H){if(y=y||{},super(f??y.antialias,y,H),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!O)return;let h=null;if(O.getContext){if(h=O,this._renderingCanvas=h,void 0===y.kh&&(y.kh=!1),void 0===y.xrCompatible&&(y.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const O=navigator.userAgent;for(const f of j.ExceptionList){const S=f.key,H=f.targets;if(new RegExp(S).test(O)){if(f.capture&&f.captureConstraint){const y=f.capture,S=f.captureConstraint,H=new RegExp(y).exec(O);if(H&&H.length>0){if(parseInt(H[H.length-1])>=S)continue}}for(const O of H)switch(O){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":y.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost||(this._onContextLost=O=>{O.preventDefault(),this._contextWasLost=!0,b.e.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},h.addEventListener("webglcontextlost",this._onContextLost,!1),h.addEventListener("webglcontextrestored",this._onContextRestored,!1),y.powerPreference=y.powerPreference||"high-performance"),this._badDesktopOS&&(y.xrCompatible=!1),!y.disableWebGL2Support)try{this._gl=h.getContext("webgl2",y)||h.getContext("experimental-webgl2",y),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(q){}if(!this._gl){if(!h)throw new Error("The provided canvas is null or undefined.");try{this._gl=h.getContext("webgl",y)||h.getContext("experimental-webgl",y)}catch(q){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=O,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const f=this._gl.getContextAttributes();f&&(y.stencil=f.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==y.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=y.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let S=0;S<this._caps.maxVertexAttribs;S++)this._currentBufferPointers[S]=new B;this._shaderProcessor=this.webGLVersion>1?new m:new v;const N=`Babylon.js v${j.Version}`;b.e.Log(N+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",N);const t=(0,S.C)(this._gl);t.validateShaderPrograms=this.validateShaderPrograms,t.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(O){return null}areAllEffectsReady(){for(const O in this._compiledEffects){if(!this._compiledEffects[O].isReady())return!1}return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const O=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=O&&(this._glRenderer=this._gl.getParameter(O.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(O.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{const O=this._gl.getExtension("WEBGL_draw_buffers");if(null!==O){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=O.drawBuffersWEBGL.bind(O),this._caps.maxDrawBuffers=this._gl.getParameter(O.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let f=0;f<16;f++)this._gl["COLOR_ATTACHMENT"+f+"_WEBGL"]=O["COLOR_ATTACHMENT"+f+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const O=this._gl.getExtension("WEBGL_depth_texture");null!=O&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=O.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const O=this._gl.getExtension("OES_vertex_array_object");null!=O&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=O.createVertexArrayOES.bind(O),this._gl.bindVertexArray=O.bindVertexArrayOES.bind(O),this._gl.deleteVertexArray=O.deleteVertexArrayOES.bind(O))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const O=this._gl.getExtension("ANGLE_instanced_arrays");null!=O?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=O.drawArraysInstancedANGLE.bind(O),this._gl.drawElementsInstanced=O.drawElementsInstancedANGLE.bind(O),this._gl.vertexAttribDivisor=O.vertexAttribDivisorANGLE.bind(O)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const O=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),f=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);O&&f&&(this._caps.highPrecisionShaderSupported=0!==O.precision&&0!==f.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const O=this._gl.getExtension("EXT_blend_minmax");null!=O&&(this._caps.blendMinMax=!0,this._gl.MAX=O.MAX_EXT,this._gl.MIN=O.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const O=this._gl.getExtension("EXT_sRGB");null!=O&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:O.SRGB_EXT,SRGB8:O.SRGB_ALPHA_EXT,SRGB8_ALPHA8:O.SRGB_ALPHA_EXT})}if(this._creationOptions){const O=this._creationOptions.forceSRGBBufferSupportState;void 0!==O&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&O)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let f=0;f<this._maxSimultaneousTextures;f++)this._nextFreeTextureSlots.push(f);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"===typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const O=this._workingCanvas.getContext("2d");O&&(this._workingContext=O)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const O=this.getGlInfo();return O&&O.renderer?O.renderer:""}getRenderWidth(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const H=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=H;let b=0;if(f&&O){let f=!0;if(this._currentRenderTarget){var h;const y=null===(h=this._currentRenderTarget.texture)||void 0===h?void 0:h.format;if(8===y||9===y||10===y||11===y){var v;const y=null===(v=this._currentRenderTarget.texture)||void 0===v?void 0:v.type;7===y||5===y?(j._TempClearColorUint32[0]=255*O.r,j._TempClearColorUint32[1]=255*O.g,j._TempClearColorUint32[2]=255*O.b,j._TempClearColorUint32[3]=255*O.a,this._gl.clearBufferuiv(this._gl.COLOR,0,j._TempClearColorUint32),f=!1):(j._TempClearColorInt32[0]=255*O.r,j._TempClearColorInt32[1]=255*O.g,j._TempClearColorInt32[2]=255*O.b,j._TempClearColorInt32[3]=255*O.a,this._gl.clearBufferiv(this._gl.COLOR,0,j._TempClearColorInt32),f=!1)}}f&&(this._gl.clearColor(O.r,O.g,O.b,void 0!==O.a?O.a:1),b|=this._gl.COLOR_BUFFER_BIT)}y&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),b|=this._gl.DEPTH_BUFFER_BIT),S&&(this._gl.clearStencil(0),b|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(b)}_viewport(O,f,y,S){O===this._viewportCached.x&&f===this._viewportCached.y&&y===this._viewportCached.z&&S===this._viewportCached.w||(this._viewportCached.x=O,this._viewportCached.y=f,this._viewportCached.z=y,this._viewportCached.w=S,this._gl.viewport(O,f,y,S))}dj(){super.dj(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0,S=arguments.length>3?arguments[3]:void 0,H=arguments.length>4?arguments[4]:void 0,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const N=O;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=O,this._bindUnboundFramebuffer(N._framebuffer);const m=this._gl;var t;if(!O.isMulti)if(O.is2DArray||O.is3D)m.framebufferTextureLayer(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,null===(t=O.texture._hardwareTexture)||void 0===t?void 0:t.underlyingResource,h,v),N._currentLOD=h;else if(O.isCube){var q;m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_CUBE_MAP_POSITIVE_X+f,null===(q=O.texture._hardwareTexture)||void 0===q?void 0:q.underlyingResource,h)}else if(N._currentLOD!==h){var F;m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,null===(F=O.texture._hardwareTexture)||void 0===F?void 0:F.underlyingResource,h),N._currentLOD=h}const I=O._depthStencilTexture;if(I){O.is3D&&(O.texture.width===I.width&&O.texture.height===I.height&&O.texture.depth===I.depth||b.e.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const y=O._depthStencilTextureWithStencil?m.DEPTH_STENCIL_ATTACHMENT:m.DEPTH_ATTACHMENT;var A;if(O.is2DArray||O.is3D)m.framebufferTextureLayer(m.FRAMEBUFFER,y,null===(A=I._hardwareTexture)||void 0===A?void 0:A.underlyingResource,h,v);else if(O.isCube){var J;m.framebufferTexture2D(m.FRAMEBUFFER,y,m.TEXTURE_CUBE_MAP_POSITIVE_X+f,null===(J=I._hardwareTexture)||void 0===J?void 0:J.underlyingResource,h)}else{var X;m.framebufferTexture2D(m.FRAMEBUFFER,y,m.TEXTURE_2D,null===(X=I._hardwareTexture)||void 0===X?void 0:X.underlyingResource,h)}}N._MSAAFramebuffer&&this._bindUnboundFramebuffer(N._MSAAFramebuffer),this._cachedViewport&&!H?this.setViewport(this._cachedViewport,y,S):(y||(y=O.width,h&&(y/=Math.pow(2,h))),S||(S=O.height,h&&(S/=Math.pow(2,h))),this._viewport(0,0,y,S)),this.wipeCaches()}setState(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0,S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],H=arguments.length>4?arguments[4]:void 0,b=arguments.length>5?arguments[5]:void 0,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(this._depthCullingState.cull!==O||y)&&(this._depthCullingState.cull=O);const v=this.cullBackFaces??H??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==v||y)&&(this._depthCullingState.cullFace=v),this.setZOffset(f),this.setZOffsetUnits(h);const N=S?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==N||y)&&(this._depthCullingState.frontFace=N),this._stencilStateComposer.stencilMaterial=b}_bindUnboundFramebuffer(O){this._currentFramebuffer!==O&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,O),this._currentFramebuffer=O)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(O){const f=this._getTextureTarget(O);this._bindTextureDirectly(f,O,!0),this._gl.generateMipmap(f),this._bindTextureDirectly(f,null)}unBindFramebuffer(O){var f;let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],S=arguments.length>2?arguments[2]:void 0;const H=O;this._currentRenderTarget=null;const b=this._gl;if(H._MSAAFramebuffer){if(O.isMulti)return void this.unBindMultiColorAttachmentFramebuffer(O,y,S);b.bindFramebuffer(b.READ_FRAMEBUFFER,H._MSAAFramebuffer),b.bindFramebuffer(b.DRAW_FRAMEBUFFER,H._framebuffer),b.blitFramebuffer(0,0,O.width,O.height,0,0,O.width,O.height,b.COLOR_BUFFER_BIT,b.NEAREST)}null===(f=O.texture)||void 0===f||!f.generateMipMaps||y||O.isCube||this.generateMipmaps(O.texture),S&&(H._MSAAFramebuffer&&this._bindUnboundFramebuffer(H._framebuffer),S()),this._bindUnboundFramebuffer(null)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(O,f,y){return this._createVertexBuffer(O,this._gl.STATIC_DRAW)}_createVertexBuffer(O,f){const y=this._gl.createBuffer();if(!y)throw new Error("Unable to create vertex buffer");const S=new t.c(y);return this.bindArrayBuffer(S),"number"!==typeof O?O instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(O),f),S.kb=4*O.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,O,f),S.kb=O.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(O),f),S.kb=O),this._resetVertexBufferBinding(),S.references=1,S}createDynamicVertexBuffer(O,f){return this._createVertexBuffer(O,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(O,f,y){const S=this._gl.createBuffer(),H=new t.c(S);if(!S)throw new Error("Unable to create index buffer");this.bindIndexBuffer(H);const b=this._normalizeIndexData(O);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,b,f?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),H.references=1,H.is32Bits=4===b.BYTES_PER_ELEMENT,H}_normalizeIndexData(O){if(2===O.BYTES_PER_ELEMENT)return O;if(this._caps.uintIndices){if(O instanceof Uint32Array)return O;for(let f=0;f<O.length;f++)if(O[f]>=65535)return new Uint32Array(O);return new Uint16Array(O)}return new Uint16Array(O)}bindArrayBuffer(O){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(O,this._gl.ARRAY_BUFFER)}bindUniformBlock(O,f,y){const S=O.program,H=this._gl.getUniformBlockIndex(S,f);this._gl.uniformBlockBinding(S,H,y)}bindIndexBuffer(O){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(O,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(O,f){(this._vaoRecordInProgress||this._currentBoundBuffer[f]!==O)&&(this._gl.bindBuffer(f,O?O.underlyingResource:null),this._currentBoundBuffer[f]=O)}updateArrayBuffer(O){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,O)}_vertexAttribPointer(O,f,y,S,H,b,h){const v=this._currentBufferPointers[f];if(!v)return;let N=!1;v.active?(v.buffer!==O&&(v.buffer=O,N=!0),v.size!==y&&(v.size=y,N=!0),v.type!==S&&(v.type=S,N=!0),v.normalized!==H&&(v.normalized=H,N=!0),v.stride!==b&&(v.stride=b,N=!0),v.offset!==h&&(v.offset=h,N=!0)):(N=!0,v.active=!0,v.index=f,v.size=y,v.type=S,v.normalized=H,v.stride=b,v.offset=h,v.buffer=O),(N||this._vaoRecordInProgress)&&(this.bindArrayBuffer(O),S===this._gl.UNSIGNED_INT||S===this._gl.INT?this._gl.vertexAttribIPointer(f,y,S,b,h):this._gl.vertexAttribPointer(f,y,S,H,b,h))}_bindIndexBufferWithCache(O){null!=O&&this._cachedIndexBuffer!==O&&(this._cachedIndexBuffer=O,this.bindIndexBuffer(O),this._uintIndicesCurrentlySet=O.is32Bits)}_bindVertexBuffersAttributes(O,f,y){const S=f.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let H=0;H<S.length;H++){const b=f.getAttributeLocation(H);if(b>=0){const f=S[H];let h=null;if(y&&(h=y[f]),h||(h=O[f]),!h)continue;this._gl.enableVertexAttribArray(b),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[b]=!0);const v=h.getBuffer();v&&(this._vertexAttribPointer(v,b,h.getSize(),h.type,h.normalized,h.byteStride,h.byteOffset),h.getIsInstanced()&&(this._gl.vertexAttribDivisor(b,h.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(b),this._currentInstanceBuffers.push(v))))}}}recordVertexArrayObject(O,f,y,S){const H=this._gl.createVertexArray();if(!H)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(H),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(O,y,S),this.bindIndexBuffer(f),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),H}bindVertexArrayObject(O,f){this._cachedVertexArrayObject!==O&&(this._cachedVertexArrayObject=O,this._gl.bindVertexArray(O),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=f&&f.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(O,f,y,S,H){if(this._cachedVertexBuffers!==O||this._cachedEffectForVertexBuffers!==H){this._cachedVertexBuffers=O,this._cachedEffectForVertexBuffers=H;const f=H.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let b=0;for(let h=0;h<f;h++)if(h<y.length){const f=H.getAttributeLocation(h);f>=0&&(this._gl.enableVertexAttribArray(f),this._vertexAttribArraysEnabled[f]=!0,this._vertexAttribPointer(O,f,y[h],this._gl.FLOAT,!1,S,b)),b+=4*y[h]}}this._bindIndexBufferWithCache(f)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(O,f,y,S){this._cachedVertexBuffers===O&&this._cachedEffectForVertexBuffers===y||(this._cachedVertexBuffers=O,this._cachedEffectForVertexBuffers=y,this._bindVertexBuffersAttributes(O,y,S)),this._bindIndexBufferWithCache(f)}unbindInstanceAttributes(){let O;for(let f=0,y=this._currentInstanceLocations.length;f<y;f++){const y=this._currentInstanceBuffers[f];O!=y&&y.references&&(O=y,this.bindArrayBuffer(y));const S=this._currentInstanceLocations[f];this._gl.vertexAttribDivisor(S,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(O){this._gl.deleteVertexArray(O)}_releaseBuffer(O){return O.references--,0===O.references&&(this._deleteBuffer(O),!0)}_deleteBuffer(O){this._gl.deleteBuffer(O.underlyingResource)}updateAndBindInstancesBuffer(O,f,y){if(this.bindArrayBuffer(O),f&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,f),void 0!==y[0].index)this.bindInstancesBuffer(O,y,!0);else for(let S=0;S<4;S++){const f=y[S];this._vertexAttribArraysEnabled[f]||(this._gl.enableVertexAttribArray(f),this._vertexAttribArraysEnabled[f]=!0),this._vertexAttribPointer(O,f,4,this._gl.FLOAT,!1,64,16*S),this._gl.vertexAttribDivisor(f,1),this._currentInstanceLocations.push(f),this._currentInstanceBuffers.push(O)}}bindInstancesBuffer(O,f){let y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.bindArrayBuffer(O);let S=0;if(y)for(let H=0;H<f.length;H++){S+=4*f[H].attributeSize}for(let H=0;H<f.length;H++){const y=f[H];void 0===y.index&&(y.index=this._currentEffect.getAttributeLocationByName(y.attributeName)),y.index<0||(this._vertexAttribArraysEnabled[y.index]||(this._gl.enableVertexAttribArray(y.index),this._vertexAttribArraysEnabled[y.index]=!0),this._vertexAttribPointer(O,y.index,y.attributeSize,y.attributeType||this._gl.FLOAT,y.normalized||!1,S,y.offset),this._gl.vertexAttribDivisor(y.index,void 0===y.divisor?1:y.divisor),this._currentInstanceLocations.push(y.index),this._currentInstanceBuffers.push(O))}}disableInstanceAttributeByName(O){if(!this._currentEffect)return;const f=this._currentEffect.getAttributeLocationByName(O);this.disableInstanceAttribute(f)}disableInstanceAttribute(O){let f,y=!1;for(;-1!==(f=this._currentInstanceLocations.indexOf(O));)this._currentInstanceLocations.splice(f,1),this._currentInstanceBuffers.splice(f,1),y=!0,f=this._currentInstanceLocations.indexOf(O);y&&(this._gl.vertexAttribDivisor(O,0),this.disableAttributeByIndex(O))}disableAttributeByIndex(O){this._gl.disableVertexAttribArray(O),this._vertexAttribArraysEnabled[O]=!1,this._currentBufferPointers[O].active=!1}draw(O,f,y,S){this.drawElementsType(O?0:1,f,y,S)}drawPointClouds(O,f,y){this.drawArraysType(2,O,f,y)}drawUnIndexed(O,f,y,S){this.drawArraysType(O?0:1,f,y,S)}drawElementsType(O,f,y,S){this.applyStates(),this._reportDrawCall();const H=this._drawMode(O),b=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,h=this._uintIndicesCurrentlySet?4:2;S?this._gl.drawElementsInstanced(H,y,b,f*h,S):this._gl.drawElements(H,y,b,f*h)}drawArraysType(O,f,y,S){this.applyStates(),this._reportDrawCall();const H=this._drawMode(O);S?this._gl.drawArraysInstanced(H,f,y,S):this._gl.drawArrays(H,f,y)}_drawMode(O){switch(O){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(O){this._compiledEffects[O._key]&&delete this._compiledEffects[O._key];const f=O.getPipelineContext();f&&this._deletePipelineContext(f)}_deletePipelineContext(O){const f=O;f&&f.program&&(f.program.__SPECTOR_rebuildProgram=null,(0,w.g)(f),this._gl.deleteProgram(f.program))}_getGlobalDefines(O){return(0,X.f)(O,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(O,f,y,H,b,h,v,N,m){let t=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,q=arguments.length>10?arguments[10]:void 0;const F="string"===typeof O?O:O.vertexToken||O.vertexSource||O.vertexElement||O.vertex,I="string"===typeof O?O:O.fragmentToken||O.fragmentSource||O.fragmentElement||O.fragment,A=this._getGlobalDefines();let X=b??f.defines??"";A&&(X+=A);const w=F+"+"+I+"@"+X;if(this._compiledEffects[w]){const O=this._compiledEffects[w];return v&&O.isReady()&&v(O),O._refCount++,O}this._gl&&(0,S.C)(this._gl);const B=new J.b(O,f,y,H,this,b,h,v,N,m,w,f.shaderLanguage??t,f.extraInitializationsAsync??q);return this._compiledEffects[w]=B,B}_getShaderSource(O){return this._gl.getShaderSource(O)}createRawShaderProgram(O,f,y,H){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const h=(0,S.C)(this._gl);return h._contextWasLost=this._contextWasLost,h.validateShaderPrograms=this.validateShaderPrograms,(0,S.u)(O,f,y,H||this._gl,b)}createShaderProgram(O,f,y,H,b){let h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const v=(0,S.C)(this._gl);return v._contextWasLost=this._contextWasLost,v.validateShaderPrograms=this.validateShaderPrograms,(0,S.y)(O,f,y,H,b||this._gl,h)}inlineShaderCode(O){return O}createPipelineContext(O){if(this._gl){(0,S.C)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const f=(0,S.s)(this._gl,O);return f.ad=this,f}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(O){return(0,S.l)(O,this._gl,this.validateShaderPrograms)}_preparePipelineContext(O,f,y,H,b,h,v,N,m,t,q){const F=(0,S.C)(this._gl);return F._contextWasLost=this._contextWasLost,F.validateShaderPrograms=this.validateShaderPrograms,F._createShaderProgramInjection=this._createShaderProgram.bind(this),F.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),F.createShaderProgramInjection=this.createShaderProgram.bind(this),F.loadFileInjection=this._loadFile.bind(this),(0,S.n)(O,f,y,H,b,h,v,N,m,t,q)}_createShaderProgram(O,f,y,H){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,S.e)(O,f,y,H,b)}_isRenderingStateCompiled(O){const f=O;return!this._isDisposed&&!f._isDisposed&&(!!this._gl.getProgramParameter(f.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(f),!0))}_executeWhenRenderingStateIsCompiled(O,f){(0,S.i)(O,f)}getUniforms(O,f){const y=new Array,S=O;for(let H=0;H<f.length;H++)y.push(this._gl.getUniformLocation(S.program,f[H]));return y}getAttributes(O,f){const y=[],S=O;for(let b=0;b<f.length;b++)try{y.push(this._gl.getAttribLocation(S.program,f[b]))}catch(H){y.push(-1)}return y}enableEffect(O){(O=null!==O&&(0,H.c)(O)?O.effect:O)&&O!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(O),this._currentEffect=O,O.onBind&&O.onBind(O),O._onBindObservable&&O._onBindObservable.notifyObservers(O))}setInt(O,f){return!!O&&(this._gl.uniform1i(O,f),!0)}setInt2(O,f,y){return!!O&&(this._gl.uniform2i(O,f,y),!0)}setInt3(O,f,y,S){return!!O&&(this._gl.uniform3i(O,f,y,S),!0)}setInt4(O,f,y,S,H){return!!O&&(this._gl.uniform4i(O,f,y,S,H),!0)}setIntArray(O,f){return!!O&&(this._gl.uniform1iv(O,f),!0)}setIntArray2(O,f){return!(!O||f.length%2!==0)&&(this._gl.uniform2iv(O,f),!0)}setIntArray3(O,f){return!(!O||f.length%3!==0)&&(this._gl.uniform3iv(O,f),!0)}setIntArray4(O,f){return!(!O||f.length%4!==0)&&(this._gl.uniform4iv(O,f),!0)}setUInt(O,f){return!!O&&(this._gl.uniform1ui(O,f),!0)}setUInt2(O,f,y){return!!O&&(this._gl.uniform2ui(O,f,y),!0)}setUInt3(O,f,y,S){return!!O&&(this._gl.uniform3ui(O,f,y,S),!0)}setUInt4(O,f,y,S,H){return!!O&&(this._gl.uniform4ui(O,f,y,S,H),!0)}setUIntArray(O,f){return!!O&&(this._gl.uniform1uiv(O,f),!0)}setUIntArray2(O,f){return!(!O||f.length%2!==0)&&(this._gl.uniform2uiv(O,f),!0)}setUIntArray3(O,f){return!(!O||f.length%3!==0)&&(this._gl.uniform3uiv(O,f),!0)}setUIntArray4(O,f){return!(!O||f.length%4!==0)&&(this._gl.uniform4uiv(O,f),!0)}setArray(O,f){return!!O&&(!(f.length<1)&&(this._gl.uniform1fv(O,f),!0))}setArray2(O,f){return!(!O||f.length%2!==0)&&(this._gl.uniform2fv(O,f),!0)}setArray3(O,f){return!(!O||f.length%3!==0)&&(this._gl.uniform3fv(O,f),!0)}setArray4(O,f){return!(!O||f.length%4!==0)&&(this._gl.uniform4fv(O,f),!0)}setMatrices(O,f){return!!O&&(this._gl.uniformMatrix4fv(O,!1,f),!0)}setMatrix3x3(O,f){return!!O&&(this._gl.uniformMatrix3fv(O,!1,f),!0)}setMatrix2x2(O,f){return!!O&&(this._gl.uniformMatrix2fv(O,!1,f),!0)}setFloat(O,f){return!!O&&(this._gl.uniform1f(O,f),!0)}setFloat2(O,f,y){return!!O&&(this._gl.uniform2f(O,f,y),!0)}setFloat3(O,f,y,S){return!!O&&(this._gl.uniform3f(O,f,y,S),!0)}setFloat4(O,f,y,S,H){return!!O&&(this._gl.uniform4f(O,f,y,S,H),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const O=this._colorWrite;this._gl.colorMask(O,O,O,O)}}wipeCaches(O){this.preventCacheWipeBetweenFrames&&!O||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),O&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(O,f){const y=this._gl;let S=y.NEAREST,H=y.NEAREST;switch(O){case 11:S=y.LINEAR,H=f?y.LINEAR_MIPMAP_NEAREST:y.LINEAR;break;case 3:S=y.LINEAR,H=f?y.LINEAR_MIPMAP_LINEAR:y.LINEAR;break;case 8:S=y.NEAREST,H=f?y.NEAREST_MIPMAP_LINEAR:y.NEAREST;break;case 4:S=y.NEAREST,H=f?y.NEAREST_MIPMAP_NEAREST:y.NEAREST;break;case 5:S=y.NEAREST,H=f?y.LINEAR_MIPMAP_NEAREST:y.LINEAR;break;case 6:S=y.NEAREST,H=f?y.LINEAR_MIPMAP_LINEAR:y.LINEAR;break;case 7:S=y.NEAREST,H=y.LINEAR;break;case 1:S=y.NEAREST,H=y.NEAREST;break;case 9:S=y.LINEAR,H=f?y.NEAREST_MIPMAP_NEAREST:y.NEAREST;break;case 10:S=y.LINEAR,H=f?y.NEAREST_MIPMAP_LINEAR:y.NEAREST;break;case 2:S=y.LINEAR,H=y.LINEAR;break;case 12:S=y.LINEAR,H=y.NEAREST}return{min:H,mag:S}}_createTexture(){const O=this._gl.createTexture();if(!O)throw new Error("Unable to create texture");return O}_createHardwareTexture(){return new I.b(this._createTexture(),this._gl)}_createInternalTexture(O,f){let y,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,H=!1,h=0,v=3,N=5,m=!1,t=1;void 0!==f&&"object"===typeof f?(H=!!f.generateMipMaps,h=void 0===f.type?0:f.type,v=void 0===f.samplingMode?3:f.samplingMode,N=void 0===f.format?5:f.format,m=void 0!==f.useSRGBBuffer&&f.useSRGBBuffer,t=f.samples??1,y=f.label):H=!!f,m&&(m=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==h||this._caps.textureFloatLinearFiltering)&&(2!==h||this._caps.textureHalfFloatLinearFiltering)||(v=1),1!==h||this._caps.textureFloat||(h=0,b.e.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const q=this._gl,F=new A.c(this,S),I=O.width||O,J=O.height||O,X=O.depth||0,w=O.layers||0,B=this._getSamplingParameters(v,H),j=0!==w?q.TEXTURE_2D_ARRAY:0!==X?q.TEXTURE_3D:q.TEXTURE_2D,u=this._getRGBABufferInternalSizedFormat(h,N,m),L=this._getInternalFormat(N),p=this._getWebGLTextureType(h);return this._bindTextureDirectly(j,F),0!==w?(F.is2DArray=!0,q.texImage3D(j,0,u,I,J,w,0,L,p,null)):0!==X?(F.is3D=!0,q.texImage3D(j,0,u,I,J,X,0,L,p,null)):q.texImage2D(j,0,u,I,J,0,L,p,null),q.texParameteri(j,q.TEXTURE_MAG_FILTER,B.mag),q.texParameteri(j,q.TEXTURE_MIN_FILTER,B.min),q.texParameteri(j,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(j,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),H&&this._gl.generateMipmap(j),this._bindTextureDirectly(j,null),F._useSRGBBuffer=m,F.baseWidth=I,F.baseHeight=J,F.width=I,F.height=J,F.depth=w,F.isReady=!0,F.samples=t,F.generateMipMaps=H,F.samplingMode=v,F.type=h,F.format=N,F.label=y,this._internalTexturesCache.push(F),F}_getUseSRGBBuffer(O,f){return O&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||f)}createTexture(O,f,y,S){var H=this;let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,N=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,m=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,t=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,q=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,F=arguments.length>11?arguments[11]:void 0,I=arguments.length>12?arguments[12]:void 0,J=arguments.length>13?arguments[13]:void 0,X=arguments.length>14?arguments[14]:void 0;return this._createTextureBase(O,f,y,S,b,h,v,(function(){for(var O=arguments.length,f=new Array(O),y=0;y<O;y++)f[y]=arguments[y];return H._prepareWebGLTexture(...f,t)}),((O,f,y,H,b,h)=>{const v=this._gl,N=y.width===O&&y.height===f;b._creationFlags=J??0;const m=this._getTexImageParametersForCreateTexture(b.format,b._useSRGBBuffer);if(N)return v.texImage2D(v.TEXTURE_2D,0,m.internalFormat,m.format,m.type,y),!1;const t=this._caps.maxTextureSize;if(y.width>t||y.height>t||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=O,this._workingCanvas.height=f,this._workingContext.drawImage(y,0,0,y.width,y.height,0,0,O,f),v.texImage2D(v.TEXTURE_2D,0,m.internalFormat,m.format,m.type,this._workingCanvas),b.width=O,b.height=f,!1);{const O=new A.c(this,2);this._bindTextureDirectly(v.TEXTURE_2D,O,!0),v.texImage2D(v.TEXTURE_2D,0,m.internalFormat,m.format,m.type,y),this._rescaleTexture(O,b,S,m.format,(()=>{this._releaseTexture(O),this._bindTextureDirectly(v.TEXTURE_2D,b,!0),h()}))}return!0}),N,m,t,q,F,I,X)}_getTexImageParametersForCreateTexture(O,f){let y,S;return 1===this.webGLVersion?(y=this._getInternalFormat(O,f),S=y):(y=this._getInternalFormat(O,!1),S=this._getRGBABufferInternalSizedFormat(0,O,f)),{internalFormat:S,format:y,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(O,f,y,S,H){}_unpackFlipY(O){this._unpackFlipYCached!==O&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,O?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=O))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(O){return O.isCube?this._gl.TEXTURE_CUBE_MAP:O.is3D?this._gl.TEXTURE_3D:O.is2DArray||O.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(O,f){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S=this._getTextureTarget(f),H=this._getSamplingParameters(O,f.useMipMaps||y);this._setTextureParameterInteger(S,this._gl.TEXTURE_MAG_FILTER,H.mag,f),this._setTextureParameterInteger(S,this._gl.TEXTURE_MIN_FILTER,H.min),y&&(f.generateMipMaps=!0,this._gl.generateMipmap(S)),this._bindTextureDirectly(S,null),f.samplingMode=O}updateTextureDimensions(O,f,y){}updateTextureWrappingMode(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const H=this._getTextureTarget(O);null!==f&&(this._setTextureParameterInteger(H,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(f),O),O._cachedWrapU=f),null!==y&&(this._setTextureParameterInteger(H,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(y),O),O._cachedWrapV=y),(O.is2DArray||O.is3D)&&null!==S&&(this._setTextureParameterInteger(H,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(S),O),O._cachedWrapR=S),this._bindTextureDirectly(H,null)}_uploadCompressedDataToTextureDirectly(O,f,y,S,H){let b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const v=this._gl;let N=v.TEXTURE_2D;if(O.isCube&&(N=v.TEXTURE_CUBE_MAP_POSITIVE_X+b),O._useSRGBBuffer)switch(f){case 37492:case 36196:this._caps.etc2?f=v.COMPRESSED_SRGB8_ETC2:O._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?f=v.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:O._useSRGBBuffer=!1;break;case 36492:f=v.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:f=v.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?f=v.COMPRESSED_SRGB_S3TC_DXT1_EXT:O._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?f=v.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:O._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?f=v.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:O._useSRGBBuffer=!1;break;default:O._useSRGBBuffer=!1}this._gl.compressedTexImage2D(N,h,f,y,S,0,H)}_uploadDataToTextureDirectly(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,H=arguments.length>4?arguments[4]:void 0,b=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const h=this._gl,v=this._getWebGLTextureType(O.type),N=this._getInternalFormat(O.format),m=void 0===H?this._getRGBABufferInternalSizedFormat(O.type,O.format,O._useSRGBBuffer):this._getInternalFormat(H,O._useSRGBBuffer);this._unpackFlipY(O.invertY);let t=h.TEXTURE_2D;O.isCube&&(t=h.TEXTURE_CUBE_MAP_POSITIVE_X+y);const q=Math.round(Math.log(O.width)*Math.LOG2E),F=Math.round(Math.log(O.height)*Math.LOG2E),I=b?O.width:Math.pow(2,Math.max(q-S,0)),A=b?O.height:Math.pow(2,Math.max(F-S,0));h.texImage2D(t,S,m,I,A,0,N,v,f)}updateTextureData(O,f,y,S,H,b){let h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,v=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,N=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const m=this._gl,t=this._getWebGLTextureType(O.type),q=this._getInternalFormat(O.format);this._unpackFlipY(O.invertY);let F=m.TEXTURE_2D,I=m.TEXTURE_2D;O.isCube&&(I=m.TEXTURE_CUBE_MAP_POSITIVE_X+h,F=m.TEXTURE_CUBE_MAP),this._bindTextureDirectly(F,O,!0),m.texSubImage2D(I,v,y,S,H,b,q,t,f),N&&this._gl.generateMipmap(I),this._bindTextureDirectly(F,null)}_uploadArrayBufferViewToTexture(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const H=this._gl,b=O.isCube?H.TEXTURE_CUBE_MAP:H.TEXTURE_2D;this._bindTextureDirectly(b,O,!0),this._uploadDataToTextureDirectly(O,f,y,S),this._bindTextureDirectly(b,null,!0)}_prepareWebGLTextureContinuation(O,f,y,S,H){const b=this._gl;if(!b)return;const h=this._getSamplingParameters(H,!y);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,h.mag),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,h.min),y||S||b.generateMipmap(b.TEXTURE_2D),this._bindTextureDirectly(b.TEXTURE_2D,null),f&&f.removePendingData(O),O.onLoadedObservable.notifyObservers(O),O.onLoadedObservable.clear()}_prepareWebGLTexture(O,f,y,S,H,b,h,v,N,m){const t=this.getCaps().maxTextureSize,F=Math.min(t,this.needPOTTextures?(0,q.h)(S.width,t):S.width),I=Math.min(t,this.needPOTTextures?(0,q.h)(S.height,t):S.height),A=this._gl;A&&(O._hardwareTexture?(this._bindTextureDirectly(A.TEXTURE_2D,O,!0),this._unpackFlipY(void 0===H||!!H),O.baseWidth=S.width,O.baseHeight=S.height,O.width=F,O.height=I,O.isReady=!0,O.type=-1!==O.type?O.type:0,O.format=-1!==O.format?O.format:m??(".jpg"!==f||O._useSRGBBuffer?5:4),v(F,I,S,f,O,(()=>{this._prepareWebGLTextureContinuation(O,y,b,h,N)}))||this._prepareWebGLTextureContinuation(O,y,b,h,N)):y&&y.removePendingData(O))}_getInternalFormatFromDepthTextureFormat(O,f,y){const S=this._gl;if(!f)return S.STENCIL_INDEX8;let H=y?S.DEPTH_STENCIL:S.DEPTH_COMPONENT;return this.webGLVersion>1?15===O?H=S.DEPTH_COMPONENT16:16===O?H=S.DEPTH_COMPONENT24:17===O||13===O?H=y?S.DEPTH24_STENCIL8:S.DEPTH_COMPONENT24:14===O?H=S.DEPTH_COMPONENT32F:18===O&&(H=y?S.DEPTH32F_STENCIL8:S.DEPTH_COMPONENT32F):H=S.DEPTH_COMPONENT16,H}_setupFramebufferDepthAttachments(O,f,y,S){let H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,b=arguments.length>5?arguments[5]:void 0;const h=this._gl;b=b??(O?13:14);const v=this._getInternalFormatFromDepthTextureFormat(b,f,O);return O&&f?this._createRenderBuffer(y,S,H,h.DEPTH_STENCIL,v,h.DEPTH_STENCIL_ATTACHMENT):f?this._createRenderBuffer(y,S,H,v,v,h.DEPTH_ATTACHMENT):O?this._createRenderBuffer(y,S,H,v,v,h.STENCIL_ATTACHMENT):null}_createRenderBuffer(O,f,y,S,H,b){let h=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const v=this._gl.createRenderbuffer();return this._updateRenderBuffer(v,O,f,y,S,H,b,h)}_updateRenderBuffer(O,f,y,S,H,b,h){let v=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const N=this._gl;return N.bindRenderbuffer(N.RENDERBUFFER,O),S>1&&N.renderbufferStorageMultisample?N.renderbufferStorageMultisample(N.RENDERBUFFER,S,b,f,y):N.renderbufferStorage(N.RENDERBUFFER,H,f,y),N.framebufferRenderbuffer(N.FRAMEBUFFER,h,N.RENDERBUFFER,O),v&&N.bindRenderbuffer(N.RENDERBUFFER,null),O}_releaseTexture(O){this._deleteTexture(O._hardwareTexture),this.unbindAllTextures();const f=this._internalTexturesCache.indexOf(O);-1!==f&&this._internalTexturesCache.splice(f,1),O._lodTextureHigh&&O._lodTextureHigh.dispose(),O._lodTextureMid&&O._lodTextureMid.dispose(),O._lodTextureLow&&O._lodTextureLow.dispose(),O._irradianceTexture&&O._irradianceTexture.dispose()}_deleteTexture(O){null===O||void 0===O||O.release()}_setProgram(O){this._currentProgram!==O&&((0,S.q)(O,this._gl),this._currentProgram=O)}bindSamplers(O){const f=O.getPipelineContext();this._setProgram(f.program);const y=O.getSamplers();for(let S=0;S<y.length;S++){const f=O.getUniform(y[S]);f&&(this._boundUniforms[S]=f)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(O,f){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],H=!1;const h=f&&f._associatedChannel>-1;y&&h&&(this._activeChannel=f._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==f||S){if(this._activateCurrentTexture(),f&&f.isMultiview)throw b.e.Error(["_bindTextureDirectly called with a multiview texture!",O,f]),"_bindTextureDirectly called with a multiview texture!";var v;this._gl.bindTexture(O,(null===f||void 0===f||null===(v=f._hardwareTexture)||void 0===v?void 0:v.underlyingResource)??null),this._boundTexturesCache[this._activeChannel]=f,f&&(f._associatedChannel=this._activeChannel)}else y&&(H=!0,this._activateCurrentTexture());return h&&!y&&this._bindSamplerUniformToChannel(f._associatedChannel,this._activeChannel),H}_bindTexture(O,f,y){if(void 0===O)return;f&&(f._associatedChannel=O),this._activeChannel=O;const S=f?this._getTextureTarget(f):this._gl.TEXTURE_2D;this._bindTextureDirectly(S,f)}unbindAllTextures(){for(let O=0;O<this._maxSimultaneousTextures;O++)this._activeChannel=O,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(O,f,y,S){void 0!==O&&(f&&(this._boundUniforms[O]=f),this._setTexture(O,y))}_bindSamplerUniformToChannel(O,f){const y=this._boundUniforms[O];y&&y._currentState!==f&&(this._gl.uniform1i(y,f),y._currentState=f)}_getTextureWrapMode(O){switch(O){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(O,f){let y,S=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!f)return null!=this._boundTexturesCache[O]&&(this._activeChannel=O,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(f.video){this._activeChannel=O;const y=f.getInternalTexture();y&&(y._associatedChannel=O),f.update()}else if(4===f.delayLoadState)return f.delayLoad(),!1;y=H?f.depthStencilTexture:f.isReady()?f.getInternalTexture():f.isCube?this.emptyCubeTexture:f.is3D?this.emptyTexture3D:f.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!S&&y&&(y._associatedChannel=O);let b=!0;this._boundTexturesCache[O]===y&&(S||this._bindSamplerUniformToChannel(y._associatedChannel,O),b=!1),this._activeChannel=O;const h=this._getTextureTarget(y);if(b&&this._bindTextureDirectly(h,y,S),y&&!y.isMultiview){if(y.isCube&&y._cachedCoordinatesMode!==f.coordinatesMode){y._cachedCoordinatesMode=f.coordinatesMode;const O=3!==f.coordinatesMode&&5!==f.coordinatesMode?1:0;f.wrapU=O,f.wrapV=O}y._cachedWrapU!==f.wrapU&&(y._cachedWrapU=f.wrapU,this._setTextureParameterInteger(h,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(f.wrapU),y)),y._cachedWrapV!==f.wrapV&&(y._cachedWrapV=f.wrapV,this._setTextureParameterInteger(h,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(f.wrapV),y)),y.is3D&&y._cachedWrapR!==f.wrapR&&(y._cachedWrapR=f.wrapR,this._setTextureParameterInteger(h,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(f.wrapR),y)),this._setAnisotropicLevel(h,y,f.anisotropicFilteringLevel)}return!0}setTextureArray(O,f,y,S){if(void 0!==O&&f){this._textureUnits&&this._textureUnits.length===y.length||(this._textureUnits=new Int32Array(y.length));for(let f=0;f<y.length;f++){const S=y[f].getInternalTexture();S?(this._textureUnits[f]=O+f,S._associatedChannel=O+f):this._textureUnits[f]=-1}this._gl.uniform1iv(f,this._textureUnits);for(let O=0;O<y.length;O++)this._setTexture(this._textureUnits[O],y[O],!0)}}_setAnisotropicLevel(O,f,y){const S=this._caps.textureAnisotropicFilterExtension;11!==f.samplingMode&&3!==f.samplingMode&&2!==f.samplingMode&&(y=1),S&&f._cachedAnisotropicFilteringLevel!==y&&(this._setTextureParameterFloat(O,S.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(y,this._caps.maxAnisotropy),f),f._cachedAnisotropicFilteringLevel=y)}_setTextureParameterFloat(O,f,y,S){this._bindTextureDirectly(O,S,!0,!0),this._gl.texParameterf(O,f,y)}_setTextureParameterInteger(O,f,y,S){S&&this._bindTextureDirectly(O,S,!0,!0),this._gl.texParameteri(O,f,y)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let O=0;O<this._caps.maxVertexAttribs;O++)this.disableAttributeByIndex(O)}else for(let O=0,f=this._vertexAttribArraysEnabled.length;O<f;O++)O>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[O]||this.disableAttributeByIndex(O)}releaseEffects(){const O=Object.keys(this._compiledEffects);for(const f of O){this._compiledEffects[f].dispose()}this._compiledEffects={}}dispose(){var O;((0,h.h)()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose)&&(null===(O=this._gl.getExtension("WEBGL_lose_context"))||void 0===O||O.loseContext());(0,S.A)(this._gl)}attachContextLostEvent(O){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",O,!1)}attachContextRestoredEvent(O){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",O,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(O){const f=this._gl;for(;f.getError()!==f.NO_ERROR;);let y=!0;const S=f.createTexture();f.bindTexture(f.TEXTURE_2D,S),f.texImage2D(f.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(O),1,1,0,f.RGBA,this._getWebGLTextureType(O),null),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST);const H=f.createFramebuffer();f.bindFramebuffer(f.FRAMEBUFFER,H),f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,S,0);const b=f.checkFramebufferStatus(f.FRAMEBUFFER);if(y=y&&b===f.FRAMEBUFFER_COMPLETE,y=y&&f.getError()===f.NO_ERROR,y&&(f.clear(f.COLOR_BUFFER_BIT),y=y&&f.getError()===f.NO_ERROR),y){f.bindFramebuffer(f.FRAMEBUFFER,null);const O=f.RGBA,S=f.UNSIGNED_BYTE,H=new Uint8Array(4);f.readPixels(0,0,1,1,O,S,H),y=y&&f.getError()===f.NO_ERROR}for(f.deleteTexture(S),f.deleteFramebuffer(H),f.bindFramebuffer(f.FRAMEBUFFER,null);!y&&f.getError()!==f.NO_ERROR;);return y}_getWebGLTextureType(O){if(1===this._webGLVersion){switch(O){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(O){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=f?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(O){case 0:y=this._gl.ALPHA;break;case 1:y=this._gl.LUMINANCE;break;case 2:y=this._gl.LUMINANCE_ALPHA;break;case 6:y=this._gl.RED;break;case 7:y=this._gl.RG;break;case 4:y=f?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:y=f?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(O){case 8:y=this._gl.RED_INTEGER;break;case 9:y=this._gl.RG_INTEGER;break;case 10:y=this._gl.RGB_INTEGER;break;case 11:y=this._gl.RGBA_INTEGER}return y}_getRGBABufferInternalSizedFormat(O,f){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(1===this._webGLVersion){if(void 0!==f)switch(f){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return y?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(O){case 3:switch(f){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(f){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return y?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return y?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(f){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(f){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(f){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(f){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(f){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(f){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(f){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return y?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(O,f,y,S){let H=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],b=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const h=H?4:3,v=H?this._gl.RGBA:this._gl.RGB,N=new Uint8Array(S*y*h);return b&&this.flushFramebuffer(),this._gl.readPixels(O,f,y,S,v,this._gl.UNSIGNED_BYTE,N),Promise.resolve(N)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const O=F.c._CreateCanvas(1,1),f=O.getContext("webgl")||O.getContext("experimental-webgl");this._IsSupported=null!=f&&!!window.WebGLRenderingContext}catch(O){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const O=F.c._CreateCanvas(1,1),f=O.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||O.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!f}catch(O){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}j._TempClearColorUint32=new Uint32Array(4),j._TempClearColorInt32=new Int32Array(4),j.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],j._ConcatenateShader=X.d,j._IsSupported=null,j._HasMajorPerformanceCaveat=null},11417:(O,f,y)=>{"use strict";var S;y.d(f,{e:()=>H}),function(O){O[O.PointerMove=0]="PointerMove",O[O.PointerDown=1]="PointerDown",O[O.PointerUp=2]="PointerUp"}(S||(S={}));class H{}H.DOM_DELTA_PIXEL=0,H.DOM_DELTA_LINE=1,H.DOM_DELTA_PAGE=2},11411:(O,f,y)=>{"use strict";y.d(f,{e:()=>S,f:()=>b,j:()=>H});class S{}S.KEYDOWN=1,S.KEYUP=2;class H{constructor(O,f){this.type=O,this.event=f}}class b extends H{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(O){this.skipOnKeyboardObservable=O}constructor(O,f){super(O,f),this.type=O,this.event=f,this.skipOnKeyboardObservable=!1}}},11406:(O,f,y)=>{"use strict";y.d(f,{b:()=>H,f:()=>h,j:()=>v});var S=y(11324);class H{}H.POINTERDOWN=1,H.POINTERUP=2,H.POINTERMOVE=4,H.POINTERWHEEL=8,H.POINTERPICK=16,H.POINTERTAP=32,H.POINTERDOUBLETAP=64;class b{constructor(O,f){this.type=O,this.event=f}}class h extends b{constructor(O,f,y,H){super(O,f),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new S.i(y,H)}}class v extends b{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}constructor(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(O,f),this._pickInfo=y,this._inputManager=S}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}},10989:(O,f,y)=>{"use strict";y.r(f),y.d(f,{SceneInstrumentation:()=>b});var S=y(10995),H=y(11166);class b{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(O){O!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=O,O?(this._onBeforeActiveMeshesEvaluationObserver=this.yd.onBeforeActiveMeshesEvaluationObservable.add((()=>{S.d.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.yd.onAfterActiveMeshesEvaluationObservable.add((()=>{S.d.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.yd.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.yd.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(O){O!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=O,O?(this._onBeforeRenderTargetsRenderObserver=this.yd.onBeforeRenderTargetsRenderObservable.add((()=>{S.d.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.yd.onAfterRenderTargetsRenderObservable.add((()=>{S.d.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.yd.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.yd.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(O){O!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=O,O?(this._onBeforeParticlesRenderingObserver=this.yd.onBeforeParticlesRenderingObservable.add((()=>{S.d.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.yd.onAfterParticlesRenderingObservable.add((()=>{S.d.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.yd.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.yd.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(O){O!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=O,this.yd.spriteManagers&&(O?(this._onBeforeSpritesRenderingObserver=this.yd.onBeforeSpritesRenderingObservable.add((()=>{S.d.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.yd.onAfterSpritesRenderingObservable.add((()=>{S.d.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.yd.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.yd.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(O){O!==this._capturePhysicsTime&&this.yd.onBeforePhysicsObservable&&(this._capturePhysicsTime=O,O?(this._onBeforePhysicsObserver=this.yd.onBeforePhysicsObservable.add((()=>{S.d.StartPerformanceCounter("jb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.yd.onAfterPhysicsObservable.add((()=>{S.d.EndPerformanceCounter("jb"),this._physicsTime.endMonitoring()}))):(this.yd.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.yd.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(O){O!==this._captureAnimationsTime&&(this._captureAnimationsTime=O,O?this._onAfterAnimationsObserver=this.yd.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.yd.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(O){this._captureFrameTime=O}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(O){this._captureInterFrameTime=O}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(O){O!==this._captureRenderTime&&(this._captureRenderTime=O,O?(this._onBeforeDrawPhaseObserver=this.yd.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),S.d.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.yd.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),S.d.EndPerformanceCounter("Main render")}))):(this.yd.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.yd.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(O){O!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=O,O?(this._onBeforeCameraRenderObserver=this.yd.onBeforeCameraRenderObservable.add((O=>{this._cameraRenderTime.beginMonitoring(),S.d.StartPerformanceCounter(`Rendering camera ${O.name}`)})),this._onAfterCameraRenderObserver=this.yd.onAfterCameraRenderObservable.add((O=>{this._cameraRenderTime.endMonitoring(!1),S.d.EndPerformanceCounter(`Rendering camera ${O.name}`)}))):(this.yd.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.yd.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.yd.getEngine()._drawCalls}constructor(O){this.yd=O,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new H.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new H.d,this._captureFrameTime=!1,this._frameTime=new H.d,this._captureRenderTime=!1,this._renderTime=new H.d,this._captureInterFrameTime=!1,this._interFrameTime=new H.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new H.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new H.d,this._capturePhysicsTime=!1,this._physicsTime=new H.d,this._captureAnimationsTime=!1,this._animationsTime=new H.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new H.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=O.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(S.d.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.yd.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=O.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(S.d.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.dj(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.dj(),this._captureParticlesRenderTime&&this._particlesRenderTime.dj(),this._captureSpritesRenderTime&&this._spritesRenderTime.dj(),this._captureRenderTime&&this._renderTime.dj(),this._captureCameraRenderTime&&this._cameraRenderTime.dj()}))}dispose(){this.yd.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.yd.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.yd.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.yd.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.yd.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.yd.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.yd.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.yd.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.yd.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.yd.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.yd.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.yd.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.yd.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.yd.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.yd.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.yd.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.yd.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.yd=null}}},12288:(O,f,y)=>{"use strict";y.d(f,{d:()=>t});var S=y(11289),H=y(11294),b=y(11324),h=y(11568),v=y(12250),N=y(12293),m=y(11153);h.c.AddNodeConstructor("Light_Type_1",((O,f)=>()=>new t(O,b.m.Zero(),f)));class t extends N.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(O){this._shadowFrustumSize=O,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(O){this._shadowOrthoScale=O,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(O){this._orthoLeft=O}get orthoRight(){return this._orthoRight}set orthoRight(O){this._orthoRight=O}get orthoTop(){return this._orthoTop}set orthoTop(O){this._orthoTop=O}get orthoBottom(){return this._orthoBottom}set orthoBottom(O){this._orthoBottom=O}constructor(O,f,y){super(O,y),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=f.scale(-1),this.direction=f}getClassName(){return"lb"}getTypeID(){return v.d.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(O,f,y){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(O):this._setDefaultAutoExtendShadowProjectionMatrix(O,f,y)}_setDefaultFixedFrustumShadowProjectionMatrix(O){const f=this.va().activeCamera;f&&b.b.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:f.Ui,void 0!==this.shadowMaxZ?this.shadowMaxZ:f.maxZ,O,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(O,f,y){const S=this.va().activeCamera;if(!S)return;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const O=b.m.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let S=Number.MAX_VALUE,H=-Number.MAX_VALUE;for(let h=0;h<y.length;h++){const v=y[h];if(!v)continue;const N=v.getBoundingInfo().boundingBox;for(let y=0;y<N.vectorsWorld.length;y++)b.m.TransformCoordinatesToRef(N.vectorsWorld[y],f,O),O.x<this._orthoLeft&&(this._orthoLeft=O.x),O.y<this._orthoBottom&&(this._orthoBottom=O.y),O.x>this._orthoRight&&(this._orthoRight=O.x),O.y>this._orthoTop&&(this._orthoTop=O.y),this.autoCalcShadowZBounds&&(O.z<S&&(S=O.z),O.z>H&&(H=O.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=S,this._shadowMaxZ=H)}const H=this._orthoRight-this._orthoLeft,h=this._orthoTop-this._orthoBottom,v=void 0!==this.shadowMinZ?this.shadowMinZ:S.Ui,N=void 0!==this.shadowMaxZ?this.shadowMaxZ:S.maxZ,m=this.va().getEngine().useReverseDepthBuffer;b.b.OrthoOffCenterLHToRef(this._orthoLeft-H*this.shadowOrthoScale,this._orthoRight+H*this.shadowOrthoScale,this._orthoBottom-h*this.shadowOrthoScale,this._orthoTop+h*this.shadowOrthoScale,m?N:v,m?v:N,O,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(O,f){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,f),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,f),this)}transferToNodeMaterialEffect(O,f){return this.computeTransformedInformation()?(O.setFloat3(f,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(O.setFloat3(f,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(O){const f=this._scene.getEngine();return!f.useReverseDepthBuffer&&f.isNDCHalfZRange?0:1}getDepthMaxZ(O){const f=this._scene.getEngine();return f.useReverseDepthBuffer&&f.isNDCHalfZRange?0:1}prepareLightSpecificDefines(O,f){O["DIRLIGHT"+f]=!0}}(0,S.b)([(0,H.L)()],t.prototype,"shadowFrustumSize",null),(0,S.b)([(0,H.L)()],t.prototype,"shadowOrthoScale",null),(0,S.b)([(0,H.L)()],t.prototype,"autoUpdateExtends",void 0),(0,S.b)([(0,H.L)()],t.prototype,"autoCalcShadowZBounds",void 0),(0,S.b)([(0,H.L)("orthoLeft")],t.prototype,"_orthoLeft",void 0),(0,S.b)([(0,H.L)("orthoRight")],t.prototype,"_orthoRight",void 0),(0,S.b)([(0,H.L)("orthoTop")],t.prototype,"_orthoTop",void 0),(0,S.b)([(0,H.L)("orthoBottom")],t.prototype,"_orthoBottom",void 0),(0,m.g)("BABYLON.DirectionalLight",t)},12635:(O,f,y)=>{"use strict";y.d(f,{c:()=>t});var S=y(11289),H=y(11294),b=y(11324),h=y(11359),v=y(11568),N=y(12250),m=y(11153);v.c.AddNodeConstructor("Light_Type_3",((O,f)=>()=>new t(O,b.m.Zero(),f)));class t extends N.d{constructor(O,f,y){super(O,y),this.groundColor=new h.d(0,0,0),this.direction=f||b.m.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"nb"}setDirectionToTarget(O){return this.direction=b.m.Normalize(O.xc(b.m.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(O,f){const y=b.m.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",y.x,y.y,y.z,0,f),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Yi),f),this}transferToNodeMaterialEffect(O,f){const y=b.m.Normalize(this.direction);return O.setFloat3(f,y.x,y.y,y.z),this}Mj(){return this._worldMatrix||(this._worldMatrix=b.b.Identity()),this._worldMatrix}getTypeID(){return N.d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(O,f){O["HEMILIGHT"+f]=!0}}(0,S.b)([(0,H.h)()],t.prototype,"groundColor",void 0),(0,S.b)([(0,H.J)()],t.prototype,"direction",void 0),(0,m.g)("BABYLON.HemisphericLight",t)},12250:(O,f,y)=>{"use strict";y.d(f,{d:()=>F});var S=y(11289),H=y(11294),b=y(11324),h=y(11359),v=y(11568),N=y(11380),m=y(11153),t=y(11445),q=y(11362);class F extends v.c{get range(){return this._range}set range(O){this._range=O,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(O){this._intensityMode=O,this._computePhotometricScale()}get radius(){return this._radius}set radius(O){this._radius=O,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(O){this._shadowEnabled!==O&&(this._shadowEnabled=O,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(O){this._includedOnlyMeshes=O,this._hookArrayForIncludedOnly(O)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(O){this._excludedMeshes=O,this._hookArrayForExcluded(O)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(O){this._excludeWithLayerMask=O,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(O){this._includeOnlyWithLayerMask=O,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(O){this._lightmapMode!==O&&(this._lightmapMode=O,this._markMeshesAsLightDirty())}getViewMatrix(O){return null}getProjectionMatrix(O,f){return null}constructor(O,f){super(O,f,!1),this.nh=new h.d(1,1,1),this.ph=new h.d(1,1,1),this.falloffType=F.FALLOFF_DEFAULT,this.Yi=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=F.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.va().addLight(this),this._uniformBuffer=new N.b(this.va().getEngine(),void 0,void 0,O),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(O,f){return this}_bindLight(O,f,y,S){let H=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const b=O.toString();let v=!1;if(this._uniformBuffer.bindToEffect(y,"Light"+b),this._renderId!==f.getRenderId()||this._lastUseSpecular!==S||!this._uniformBuffer.useUbo){this._renderId=f.getRenderId(),this._lastUseSpecular=S;const O=this.getScaledIntensity();this.transferToEffect(y,b),this.nh.scaleToRef(O,h.k.gb[0]),this._uniformBuffer.updateColor4("vLightDiffuse",h.k.gb[0],this.range,b),S&&(this.ph.scaleToRef(O,h.k.gb[1]),this._uniformBuffer.updateColor4("vLightSpecular",h.k.gb[1],this.radius,b)),v=!0}if(this.transferTexturesToEffect(y,b),f.shadowsEnabled&&this.shadowEnabled&&H){const O=this.getShadowGenerator(f.activeCamera)??this.getShadowGenerator();O&&(O.bindShadowLight(b,y),v=!0)}v?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(O){let f="Name: "+this.name;if(f+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let y=0;y<this.animations.length;y++)f+=", animation[0]: "+this.animations[y].toString(O);return f}_syncParentEnabledState(){super._syncParentEnabledState(),this.u()||this._resyncMeshes()}$b(O){super.$b(O),this._resyncMeshes()}getShadowGenerator(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(O)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return b.m.Zero()}canAffectMesh(O){return!O||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(O))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(O))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&O.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&O.layerMask)))}dispose(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const O=this._shadowGenerators.values();for(let f=O.next();!0!==f.done;f=O.next()){f.value.dispose()}this._shadowGenerators=null}if(this.va().stopAnimation(this),this._parentContainer){const O=this._parentContainer.lights.indexOf(this);O>-1&&this._parentContainer.lights.splice(O,1),this._parentContainer=null}for(const y of this.va().meshes)y._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.va().removeLight(this),super.dispose(O,f)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.Yi}clone(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const y=F.GetConstructorFromName(this.getTypeID(),O,this.va());if(!y)return null;const S=q.b.Clone(y,this);return O&&(S.name=O),f&&(S.parent=f),S.$b(this.isEnabled()),this.onClonedObservable.notifyObservers(S),S}serialize(){const O=q.b.Serialize(this);return O.uniqueId=this.uniqueId,O.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(O),this.excludedMeshes.length>0&&(O.excludedMeshesIds=[],this.excludedMeshes.forEach((f=>{O.excludedMeshesIds.push(f.id)}))),this.includedOnlyMeshes.length>0&&(O.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((f=>{O.includedOnlyMeshesIds.push(f.id)}))),q.b.AppendSerializedAnimations(this,O),O.ranges=this.serializeAnimationRanges(),O.isEnabled=this.isEnabled(),O}static GetConstructorFromName(O,f,y){const S=v.c.Construct("Light_Type_"+O,f,y);return S||null}static Parse(O,f){const y=F.GetConstructorFromName(O.type,O.name,f);if(!y)return null;const S=q.b.Parse(y,O,f);if(O.excludedMeshesIds&&(S._excludedMeshesIds=O.excludedMeshesIds),O.includedOnlyMeshesIds&&(S._includedOnlyMeshesIds=O.includedOnlyMeshesIds),void 0!==O.parentId&&(S._waitingParentId=O.parentId),void 0!==O.parentInstanceIndex&&(S._waitingParentInstanceIndex=O.parentInstanceIndex),void 0!==O.falloffType&&(S.falloffType=O.falloffType),void 0!==O.lightmapMode&&(S.lightmapMode=O.lightmapMode),O.animations){for(let f=0;f<O.animations.length;f++){const y=O.animations[f],H=(0,m.c)("BABYLON.Animation");H&&S.animations.push(H.Parse(y))}v.c.ParseAnimationRanges(S,O,f)}return O.autoAnimate&&f.beginAnimation(S,O.autoAnimateFrom,O.autoAnimateTo,O.autoAnimateLoop,O.autoAnimateSpeed||1),void 0!==O.isEnabled&&S.$b(O.isEnabled),S}_hookArrayForExcluded(O){var f=this;const y=O.push;O.push=function(){for(var S=arguments.length,H=new Array(S),b=0;b<S;b++)H[b]=arguments[b];const h=y.apply(O,H);for(const O of H)O._resyncLightSource(f);return h};const S=O.splice;O.splice=(f,y)=>{const H=S.apply(O,[f,y]);for(const O of H)O._resyncLightSource(this);return H};for(const H of O)H._resyncLightSource(this)}_hookArrayForIncludedOnly(O){var f=this;const y=O.push;O.push=function(){for(var S=arguments.length,H=new Array(S),b=0;b<S;b++)H[b]=arguments[b];const h=y.apply(O,H);return f._resyncMeshes(),h};const S=O.splice;O.splice=(f,y)=>{const H=S.apply(O,[f,y]);return this._resyncMeshes(),H},this._resyncMeshes()}_resyncMeshes(){for(const O of this.va().meshes)O._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const O of this.va().meshes)-1!==O.lightSources.indexOf(this)&&O._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.va().resetCachedMaterial()}_getPhotometricScale(){let O=0;const f=this.getTypeID();let y=this.intensityMode;switch(y===F.INTENSITYMODE_AUTOMATIC&&(y=f===F.LIGHTTYPEID_DIRECTIONALLIGHT?F.INTENSITYMODE_ILLUMINANCE:F.INTENSITYMODE_LUMINOUSINTENSITY),f){case F.LIGHTTYPEID_POINTLIGHT:case F.LIGHTTYPEID_SPOTLIGHT:switch(y){case F.INTENSITYMODE_LUMINOUSPOWER:O=1/(4*Math.PI);break;case F.INTENSITYMODE_LUMINOUSINTENSITY:O=1;break;case F.INTENSITYMODE_LUMINANCE:O=this.radius*this.radius}break;case F.LIGHTTYPEID_DIRECTIONALLIGHT:switch(y){case F.INTENSITYMODE_ILLUMINANCE:O=1;break;case F.INTENSITYMODE_LUMINANCE:{let f=this.radius;f=Math.max(f,.001);O=2*Math.PI*(1-Math.cos(f));break}}break;case F.LIGHTTYPEID_HEMISPHERICLIGHT:O=1}return O}_reorderLightsInScene(){const O=this.va();0!=this._renderPriority&&(O.requireLightSorting=!0),this.va().sortLightsByPriority()}}F.FALLOFF_DEFAULT=t.d.FALLOFF_DEFAULT,F.FALLOFF_PHYSICAL=t.d.FALLOFF_PHYSICAL,F.FALLOFF_GLTF=t.d.FALLOFF_GLTF,F.FALLOFF_STANDARD=t.d.FALLOFF_STANDARD,F.LIGHTMAP_DEFAULT=t.d.LIGHTMAP_DEFAULT,F.LIGHTMAP_SPECULAR=t.d.LIGHTMAP_SPECULAR,F.LIGHTMAP_SHADOWSONLY=t.d.LIGHTMAP_SHADOWSONLY,F.INTENSITYMODE_AUTOMATIC=t.d.INTENSITYMODE_AUTOMATIC,F.INTENSITYMODE_LUMINOUSPOWER=t.d.INTENSITYMODE_LUMINOUSPOWER,F.INTENSITYMODE_LUMINOUSINTENSITY=t.d.INTENSITYMODE_LUMINOUSINTENSITY,F.INTENSITYMODE_ILLUMINANCE=t.d.INTENSITYMODE_ILLUMINANCE,F.INTENSITYMODE_LUMINANCE=t.d.INTENSITYMODE_LUMINANCE,F.LIGHTTYPEID_POINTLIGHT=t.d.LIGHTTYPEID_POINTLIGHT,F.LIGHTTYPEID_DIRECTIONALLIGHT=t.d.LIGHTTYPEID_DIRECTIONALLIGHT,F.LIGHTTYPEID_SPOTLIGHT=t.d.LIGHTTYPEID_SPOTLIGHT,F.LIGHTTYPEID_HEMISPHERICLIGHT=t.d.LIGHTTYPEID_HEMISPHERICLIGHT,(0,S.b)([(0,H.h)()],F.prototype,"diffuse",void 0),(0,S.b)([(0,H.h)()],F.prototype,"specular",void 0),(0,S.b)([(0,H.L)()],F.prototype,"falloffType",void 0),(0,S.b)([(0,H.L)()],F.prototype,"intensity",void 0),(0,S.b)([(0,H.L)()],F.prototype,"range",null),(0,S.b)([(0,H.L)()],F.prototype,"intensityMode",null),(0,S.b)([(0,H.L)()],F.prototype,"radius",null),(0,S.b)([(0,H.L)()],F.prototype,"_renderPriority",void 0),(0,S.b)([(0,H.d)("_reorderLightsInScene")],F.prototype,"renderPriority",void 0),(0,S.b)([(0,H.L)("shadowEnabled")],F.prototype,"_shadowEnabled",void 0),(0,S.b)([(0,H.L)("excludeWithLayerMask")],F.prototype,"_excludeWithLayerMask",void 0),(0,S.b)([(0,H.L)("includeOnlyWithLayerMask")],F.prototype,"_includeOnlyWithLayerMask",void 0),(0,S.b)([(0,H.L)("lightmapMode")],F.prototype,"_lightmapMode",void 0)},11445:(O,f,y)=>{"use strict";y.d(f,{d:()=>S});class S{static CompareLightsPriority(O,f){return O.shadowEnabled!==f.shadowEnabled?(f.shadowEnabled?1:0)-(O.shadowEnabled?1:0):f.renderPriority-O.renderPriority}}S.FALLOFF_DEFAULT=0,S.FALLOFF_PHYSICAL=1,S.FALLOFF_GLTF=2,S.FALLOFF_STANDARD=3,S.LIGHTMAP_DEFAULT=0,S.LIGHTMAP_SPECULAR=1,S.LIGHTMAP_SHADOWSONLY=2,S.INTENSITYMODE_AUTOMATIC=0,S.INTENSITYMODE_LUMINOUSPOWER=1,S.INTENSITYMODE_LUMINOUSINTENSITY=2,S.INTENSITYMODE_ILLUMINANCE=3,S.INTENSITYMODE_LUMINANCE=4,S.LIGHTTYPEID_POINTLIGHT=0,S.LIGHTTYPEID_DIRECTIONALLIGHT=1,S.LIGHTTYPEID_SPOTLIGHT=2,S.LIGHTTYPEID_HEMISPHERICLIGHT=3},12293:(O,f,y)=>{"use strict";y.d(f,{b:()=>N});var S=y(11289),H=y(11294),b=y(11324),h=y(12250),v=y(11606);class N extends h.d{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=b.b.Identity(),this._projectionMatrix=b.b.Identity()}_setPosition(O){this._position=O}get position(){return this._position}set position(O){this._setPosition(O)}_setDirection(O){this._direction=O}get direction(){return this._direction}set direction(O){this._setDirection(O)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(O){this._shadowMinZ=O,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(O){this._shadowMaxZ=O,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=b.m.Zero()),b.m.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=b.m.Zero()),b.m.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(O){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(O){return this.direction=b.m.Normalize(O.xc(this.position)),this.direction}getRotation(){this.direction.normalize();const O=b.m.Cross(this.direction,v.c.Y),f=b.m.Cross(O,this.direction);return b.m.RotationFromAxis(O,f,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=b.m.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}Mj(O){return!O&&this.isSynchronized()?(this._currentRenderId=this.va().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.p(this.position),this._worldMatrix||(this._worldMatrix=b.b.Identity()),b.b.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(O){return void 0!==this.shadowMinZ?this.shadowMinZ:O.Ui}getDepthMaxZ(O){return void 0!==this.shadowMaxZ?this.shadowMaxZ:O.maxZ}setShadowProjectionMatrix(O,f,y){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(f,y,O):this._setDefaultShadowProjectionMatrix(O,f,y),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(O){const f=b.g.fb[0];let y=this.position;this.computeTransformedInformation()&&(y=this.transformedPosition),b.m.NormalizeToRef(this.getShadowDirection(O),f),1===Math.abs(b.m.Dot(f,b.m.Up()))&&(f.z=1e-13);const S=b.g.fb[1];return y.addToRef(f,S),b.b.LookAtLHToRef(y,S,b.m.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(O,f){return this.setShadowProjectionMatrix(this._projectionMatrix,O??this._viewMatrix,f??[]),this._projectionMatrix}}(0,S.b)([(0,H.J)()],N.prototype,"position",null),(0,S.b)([(0,H.J)()],N.prototype,"direction",null),(0,S.b)([(0,H.L)()],N.prototype,"shadowMinZ",null),(0,S.b)([(0,H.L)()],N.prototype,"shadowMaxZ",null)},11910:(O,f,y)=>{"use strict";y.d(f,{b:()=>h,d:()=>b,g:()=>v});const S={},H={};function b(O,f){S[O]=f}function h(O,f){H[O]=f}function v(O){return H[O]?H[O]:null}},11666:(O,f,y)=>{"use strict";y.d(f,{b:()=>g,d:()=>p});var S,H=y(10995),b=y(11004),h=y(11311),v=y(11042),N=y(11017),m=y(11588),t=y(11051),q=y(11059),F=y(11158),I=y(11092);!function(O){O[O.Clean=0]="Clean",O[O.Stop=1]="Stop",O[O.Sync=2]="Sync",O[O.NoSync=3]="NoSync"}(S||(S={}));const A=new b.d,J={};let X=!1;function w(){return J[".babylon"]}function B(O){const f=J[O];return f||(N.e.Warn("Unable to find a plugin to load "+O+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),w())}function j(O,f,y){let S="Unable to load from "+(O.rawData?"binary data":O.url);return f?S+=`: ${f}`:y&&(S+=`: ${y}`),S}function u(O,f,y,S,H,b,h,v,N){var m;const q="data:"===(F=O.url).substring(0,5)?F.substring(5):null;var F;if(O.rawData&&!h)throw"When using ArrayBufferView to load data the file extension must be provided.";const X=h?B(h):q?function(O){for(const f in J){const y=J[f].plugin;if(y.canDirectLoad&&y.canDirectLoad(O))return J[f]}return w()}(O.url):function(O){const f=O.indexOf("?");-1!==f&&(O=O.substring(0,f));const y=O.lastIndexOf(".");return B(O.substring(y,O.length).toLowerCase())}(O.url);if(!X)throw new Error(`No plugin or fallback for ${h??O.url}`);if(!1===(null===N||void 0===N||null===(m=N[X.plugin.name])||void 0===m?void 0:m.enabled))throw new Error(`The '${X.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(O.rawData&&!X.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(O=>{if(X.plugin.createPlugin){const f=X.plugin.createPlugin(N??{});return f instanceof Promise?(f.then(O).catch((O=>{H("Error instantiating plugin.",O)})),null):(O(f),f)}return O(X.plugin),X.plugin})((N=>{var m;if(!N)throw`The loader plugin corresponding to the '${h}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(A.notifyObservers(N),q&&(N.canDirectLoad&&N.canDirectLoad(O.url)||!(0,t.g)(O.url))){if(N.directLoad){const O=N.directLoad(f,q);O instanceof Promise?O.then((O=>{y(N,O)})).catch((O=>{H("Error in directLoad of _loadData: "+O,O)})):y(N,O)}else y(N,q);return}const F=X.isBinary,J=(O,S)=>{f.u?H("Scene has been disposed"):y(N,O,S)};let w=null,B=!1;null===(m=N.hj)||void 0===m||m.add((()=>{B=!0,w&&(w.abort(),w=null),b()}));const j=()=>{if(B)return;const y=(O,f)=>{H(null===O||void 0===O?void 0:O.statusText,f)};if(!N.loadFile&&O.rawData)throw"Plugin does not support loading ArrayBufferView.";w=N.loadFile?N.loadFile(f,O.rawData||O.file||O.url,O.rootUrl,J,S,F,y,v):f._loadFile(O.file||O.url,J,S,!0,F,y)},u=f.getEngine();let L=u.enableOfflineSupport;if(L){let y=!1;for(const S of f.disableOfflineSupportExceptionRules)if(S.test(O.url)){y=!0;break}L=!y}L&&I.c.OfflineProviderFactory?f.offlineProvider=I.c.OfflineProviderFactory(O.url,j,u.disableManifestCheck):j()}))}function L(O,f){let y,S,b=null,h=null;if(f)if(f.name)y=`file:${f.name}`,S=f.name,b=f;else if(ArrayBuffer.isView(f))y="",S=(0,F.d)(),h=f;else if(f.startsWith("data:"))y=f,S="";else if(O){const b=f;if("/"===b.substring(0,1))return H.d.Error("Wrong sceneFilename parameter"),null;y=O+b,S=b}else y=f,S=H.d.GetFilename(f),O=H.d.GetFolderPath(f);else y=O,S=H.d.GetFilename(O),O=H.d.GetFolderPath(O);return{url:y,rootUrl:O,name:S,file:b,rawData:h}}function p(O){if("string"===typeof O.extensions){const f=O.extensions;J[f.toLowerCase()]={plugin:O,isBinary:!1}}else{const f=O.extensions;Object.keys(f).forEach((y=>{J[y.toLowerCase()]={plugin:O,isBinary:f[y].isBinary}}))}}function U(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:v.c.LastCreatedScene,H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,m=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",F=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!S)return N.e.Error("No scene available to import mesh to"),null;const I=L(f,y);if(!I)return null;const A={};S.addPendingData(A);const J=()=>{S.removePendingData(A)},X=(O,f)=>{const y=j(I,O,f);h?h(S,y,new q.l(y,q.i.SceneLoaderError,f)):N.e.Error(y),J()},w=b?O=>{try{b(O)}catch(f){X("Error in onProgress callback: "+f,f)}}:void 0,B=(O,f,y,b,h,v,N,m)=>{if(S.importedMeshesFiles.push(I.url),H)try{H(O,f,y,b,h,v,N,m)}catch(t){X("Error in onSuccess callback: "+t,t)}S.removePendingData(A)};return u(I,S,((f,y,H)=>{if(f.rewriteRootURL&&(I.rootUrl=f.rewriteRootURL(I.rootUrl,H)),f.importMesh){const H=[],b=[],h=[];if(!f.importMesh(O,S,y,I.rootUrl,H,b,h,X))return;S.loadingPluginName=f.name,B(H,b,h,[],[],[],[],[])}else{f.importMeshAsync(O,S,y,I.rootUrl,w,I.name).then((O=>{S.loadingPluginName=f.name,B(O.meshes,O.oj,O.skeletons,O.animationGroups,O.transformNodes,O.geometries,O.lights,O.spriteManagers)})).catch((O=>{X(O.message,O)}))}}),w,X,J,m,t,F)}function l(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v.c.LastCreatedEngine,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,N=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};return y?W(O,f,new h.c(y),S,b,N,m,t,q):(H.d.Error("No engine available"),null)}function x(O,f,y,S,H,b,h){return new Promise(((v,N)=>{l(O,f,y,(O=>{v(O)}),S,((O,f,y)=>{N(y||new Error(f))}),H,b,h)}))}function W(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v.c.LastCreatedScene,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!y)return N.e.Error("No scene available to append to"),null;const I=L(O,f);if(!I)return null;const A={};y.addPendingData(A);const J=()=>{y.removePendingData(A)};m.d.ShowLoadingScreen&&!X&&(X=!0,y.getEngine().displayLoadingUI(),y.executeWhenReady((()=>{y.getEngine().hideLoadingUI(),X=!1})));const w=(O,f)=>{const S=j(I,O,f);b?b(y,S,new q.l(S,q.i.SceneLoaderError,f)):N.e.Error(S),J()},B=H?O=>{try{H(O)}catch(f){w("Error in onProgress callback",f)}}:void 0,p=()=>{if(S)try{S(y)}catch(O){w("Error in onSuccess callback",O)}y.removePendingData(A)};return u(I,y,((O,f)=>{if(O.load){if(!O.load(y,f,I.rootUrl,w))return;y.loadingPluginName=O.name,p()}else{O.loadAsync(y,f,I.rootUrl,B,I.name).then((()=>{y.loadingPluginName=O.name,p()})).catch((O=>{w(O.message,O)}))}}),B,w,J,h,t,F)}function E(O,f,y,S,H,b,h){return new Promise(((v,N)=>{W(O,f,y,(O=>{v(O)}),S,((O,f,y)=>{N(y||new Error(f))}),H,b,h)}))}function o(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v.c.LastCreatedScene,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,m=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!y)return N.e.Error("No scene available to load asset container to"),null;const F=L(O,f);if(!F)return null;const I={};y.addPendingData(I);const A=()=>{y.removePendingData(I)},J=(O,f)=>{const S=j(F,O,f);b?b(y,S,new q.l(S,q.i.SceneLoaderError,f)):N.e.Error(S),A()},X=H?O=>{try{H(O)}catch(f){J("Error in onProgress callback",f)}}:void 0,w=O=>{if(S)try{S(O)}catch(f){J("Error in onSuccess callback",f)}y.removePendingData(I)};return u(F,y,((O,f)=>{if(O.loadAssetContainer){const S=O.loadAssetContainer(y,f,F.rootUrl,J);if(!S)return;S.populateRootNodes(),y.loadingPluginName=O.name,w(S)}else if(O.loadAssetContainerAsync){O.loadAssetContainerAsync(y,f,F.rootUrl,X,F.name).then((f=>{f.populateRootNodes(),y.loadingPluginName=O.name,w(f)})).catch((O=>{J(O.message,O)}))}else J("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),X,J,A,h,m,t)}function i(O,f,y,S,H,b,h){return new Promise(((v,N)=>{o(O,f,y,(O=>{v(O)}),S,((O,f,y)=>{N(y||new Error(f))}),H,b,h)}))}function D(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v.c.LastCreatedScene,S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,m=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,F=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",I=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!y)return void N.e.Error("No scene available to load animations to");if(S){for(const O of y.animatables)O.reset();y.stopAllAnimations(),y.animationGroups.slice().forEach((O=>{O.dispose()}));y.getNodes().forEach((O=>{O.animations&&(O.animations=[])}))}else switch(H){case 0:y.animationGroups.slice().forEach((O=>{O.dispose()}));break;case 1:y.animationGroups.forEach((O=>{O.stop()}));break;case 2:y.animationGroups.forEach((O=>{O.reset(),O.restart()}));break;case 3:break;default:return void N.e.Error("Unknown animation group loading mode value '"+H+"'")}const A=y.animatables.length;o(O,f,y,(O=>{O.mergeAnimationsTo(y,y.animatables.slice(A),b),O.dispose(),y.onAnimationFileImportedObservable.notifyObservers(y),h&&h(y)}),m,t,q,F,I)}function V(O,f,y,S,H,b,h,v,N,m){return new Promise(((t,q)=>{D(O,f,y,S,H,b,(O=>{t(O)}),h,((O,f,y)=>{q(y||new Error(f))}),v,N,m)}))}class g{static get ForceFullSceneLoadingForIncremental(){return m.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(O){m.d.ForceFullSceneLoadingForIncremental=O}static get ShowLoadingScreen(){return m.d.ShowLoadingScreen}static set ShowLoadingScreen(O){m.d.ShowLoadingScreen=O}static get loggingLevel(){return m.d.loggingLevel}static set loggingLevel(O){m.d.loggingLevel=O}static get CleanBoneMatrixWeights(){return m.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(O){m.d.CleanBoneMatrixWeights=O}static GetDefaultPlugin(){return w()}static GetPluginForExtension(O){var f;return null===(f=B(O))||void 0===f?void 0:f.plugin}static IsPluginForExtensionAvailable(O){return function(O){return!!J[O]}(O)}static RegisterPlugin(O){p(O)}static ImportMesh(O,f,y,S,H,b,h,v,N){return U(O,f,y,S,H,b,h,v,N)}static ImportMeshAsync(O,f,y,S,H,b,h){return function(O,f,y,S,H,b,h,v){return new Promise(((N,m)=>{U(O,f,y,S,((O,f,y,S,H,b,h,v)=>{N({meshes:O,oj:f,skeletons:y,animationGroups:S,transformNodes:H,geometries:b,lights:h,spriteManagers:v})}),H,((O,f,y)=>{m(y||new Error(f))}),b,h,v)}))}(O,f,y,S,H,b,h)}static Load(O,f,y,S,H,b,h,v){return l(O,f,y,S,H,b,h,v)}static LoadAsync(O,f,y,S,H,b){return x(O,f,y,S,H,b)}static Append(O,f,y,S,H,b,h,v){return W(O,f,y,S,H,b,h,v)}static AppendAsync(O,f,y,S,H,b){return E(O,f,y,S,H,b)}static LoadAssetContainer(O,f,y,S,H,b,h,v){return o(O,f,y,S,H,b,h,v)}static LoadAssetContainerAsync(O,f,y,S,H,b){return i(O,f,y,S,H,b)}static ImportAnimations(O,f,y,S,H,b,h,v,N,m,t){D(O,f,y,S,H,b,h,v,N,m,t)}static ImportAnimationsAsync(O,f,y,S,H,b,h,v,N,m,t){return V(O,f,y,S,H,b,v,m,t)}}g.NO_LOGGING=0,g.MINIMAL_LOGGING=1,g.SUMMARY_LOGGING=2,g.DETAILED_LOGGING=3,g.OnPluginActivatedObservable=A},11588:(O,f,y)=>{"use strict";y.d(f,{d:()=>S});class S{static get ForceFullSceneLoadingForIncremental(){return S._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(O){S._ForceFullSceneLoadingForIncremental=O}static get ShowLoadingScreen(){return S._ShowLoadingScreen}static set ShowLoadingScreen(O){S._ShowLoadingScreen=O}static get loggingLevel(){return S._LoggingLevel}static set loggingLevel(O){S._LoggingLevel=O}static get CleanBoneMatrixWeights(){return S._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(O){S._CleanBoneMatrixWeights=O}}S._ForceFullSceneLoadingForIncremental=!1,S._ShowLoadingScreen=!0,S._CleanBoneMatrixWeights=!1,S._LoggingLevel=0},12231:(O,f,y)=>{"use strict";y.d(f,{d:()=>G});var S=y(11289),H=y(11294),b=y(11017),h=y(11302),v=y(12223),N=y(11311),m=y(11324),t=y(11392),q=y(11497),F=y(11544);class I extends q.e{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1}}class A extends F.b{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(O,"PBRBRDF",90,new I,f),this._useEnergyConservation=A.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=A.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=A.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=A.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=A.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=A.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=A.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=A.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=O._dirtyCallbacks[16],this._enable(!0)}prepareDefines(O){O.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,O.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,O.SPHERICAL_HARMONICS=this._useSphericalHarmonics,O.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation}getClassName(){return"PBRBRDFConfiguration"}}A.DEFAULT_USE_ENERGY_CONSERVATION=!0,A.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,A.DEFAULT_USE_SPHERICAL_HARMONICS=!0,A.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,(0,S.b)([(0,H.L)(),(0,H.d)("_markAllSubMeshesAsMiscDirty")],A.prototype,"useEnergyConservation",void 0),(0,S.b)([(0,H.L)(),(0,H.d)("_markAllSubMeshesAsMiscDirty")],A.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,S.b)([(0,H.L)(),(0,H.d)("_markAllSubMeshesAsMiscDirty")],A.prototype,"useSphericalHarmonics",void 0),(0,S.b)([(0,H.L)(),(0,H.d)("_markAllSubMeshesAsMiscDirty")],A.prototype,"useSpecularGlossinessInputEnergyConservation",void 0);var J=y(11451),X=y(11359),w=y(11352),B=y(11455),j=y(11506),u=y(11509),L=y(11532),p=(y(12237),y(11536)),U=y(11490);class l extends q.e{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class x extends F.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(O,"PBRClearCoat",100,new l,f),this._isEnabled=!1,this.isEnabled=!1,this.Yi=1,this.roughness=0,this._indexOfRefraction=x._DefaultIndexOfRefraction,this.indexOfRefraction=x._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=X.d.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=O._dirtyCallbacks[1]}isReadyForSubMesh(O,f,y){if(!this._isEnabled)return!0;const S=this._material._disableBumpMap;if(O._areTexturesDirty&&f.texturesEnabled){if(this._texture&&L.b.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&L.b.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(y.getCaps().standardDerivatives&&this._bumpTexture&&L.b.ClearCoatBumpTextureEnabled&&!S&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&L.b.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(O,f){this._isEnabled?(O.CLEARCOAT=!0,O.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,O.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,O._areTexturesDirty&&f.texturesEnabled&&(this._texture&&L.b.ClearCoatTextureEnabled?(0,U.J)(this._texture,O,"CLEARCOAT_TEXTURE"):O.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&L.b.ClearCoatTextureEnabled?(0,U.J)(this._textureRoughness,O,"CLEARCOAT_TEXTURE_ROUGHNESS"):O.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&L.b.ClearCoatBumpTextureEnabled?(0,U.J)(this._bumpTexture,O,"CLEARCOAT_BUMP"):O.CLEARCOAT_BUMP=!1,O.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===x._DefaultIndexOfRefraction,this._isTintEnabled?(O.CLEARCOAT_TINT=!0,this._tintTexture&&L.b.ClearCoatTintTextureEnabled?((0,U.J)(this._tintTexture,O,"CLEARCOAT_TINT_TEXTURE"),O.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):O.CLEARCOAT_TINT_TEXTURE=!1):(O.CLEARCOAT_TINT=!1,O.CLEARCOAT_TINT_TEXTURE=!1))):(O.CLEARCOAT=!1,O.CLEARCOAT_TEXTURE=!1,O.CLEARCOAT_TEXTURE_ROUGHNESS=!1,O.CLEARCOAT_BUMP=!1,O.CLEARCOAT_TINT=!1,O.CLEARCOAT_TINT_TEXTURE=!1,O.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,O.CLEARCOAT_DEFAULTIOR=!1,O.CLEARCOAT_TEXTUREDIRECTUV=0,O.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,O.CLEARCOAT_BUMPDIRECTUV=0,O.CLEARCOAT_REMAP_F0=!1,O.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,O.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(O,f,y,S){if(!this._isEnabled)return;const H=S.materialDefines,b=this._material.isFrozen,h=this._material._disableBumpMap,v=this._material._invertNormalMapX,N=this._material._invertNormalMapY;if(!O.useUbo||!b||!O.isSync){var m,t,q,F;if((this._texture||this._textureRoughness)&&L.b.ClearCoatTextureEnabled)O.updateFloat4("vClearCoatInfos",(null===(m=this._texture)||void 0===m?void 0:m.coordinatesIndex)??0,(null===(t=this._texture)||void 0===t?void 0:t.level)??0,(null===(q=this._textureRoughness)||void 0===q?void 0:q.coordinatesIndex)??0,(null===(F=this._textureRoughness)||void 0===F?void 0:F.level)??0),this._texture&&(0,U.r)(this._texture,O,"clearCoat"),this._textureRoughness&&!H.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,U.r)(this._textureRoughness,O,"clearCoatRoughness");this._bumpTexture&&y.getCaps().standardDerivatives&&L.b.ClearCoatTextureEnabled&&!h&&(O.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,U.r)(this._bumpTexture,O,"clearCoatBump"),f._mirroredCameraPosition?O.updateFloat2("vClearCoatTangentSpaceParams",v?1:-1,N?1:-1):O.updateFloat2("vClearCoatTangentSpaceParams",v?-1:1,N?-1:1)),this._tintTexture&&L.b.ClearCoatTintTextureEnabled&&(O.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,U.r)(this._tintTexture,O,"clearCoatTint")),O.updateFloat2("vClearCoatParams",this.Yi,this.roughness);const S=1-this._indexOfRefraction,b=1+this._indexOfRefraction,I=Math.pow(-S/b,2),A=1/this._indexOfRefraction;O.updateFloat4("vClearCoatRefractionParams",I,A,S,b),this._isTintEnabled&&(O.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),O.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}f.texturesEnabled&&(this._texture&&L.b.ClearCoatTextureEnabled&&O.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!H.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&L.b.ClearCoatTextureEnabled&&O.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&y.getCaps().standardDerivatives&&L.b.ClearCoatBumpTextureEnabled&&!h&&O.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&L.b.ClearCoatTintTextureEnabled&&O.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(O){return this._texture===O||(this._textureRoughness===O||(this._bumpTexture===O||this._tintTexture===O))}getActiveTextures(O){this._texture&&O.push(this._texture),this._textureRoughness&&O.push(this._textureRoughness),this._bumpTexture&&O.push(this._bumpTexture),this._tintTexture&&O.push(this._tintTexture)}getAnimatables(O){this._texture&&this._texture.animations&&this._texture.animations.length>0&&O.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&O.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&O.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&O.push(this._tintTexture)}dispose(O){var f,y,S,H;O&&(null===(f=this._texture)||void 0===f||f.dispose(),null===(y=this._textureRoughness)||void 0===y||y.dispose(),null===(S=this._bumpTexture)||void 0===S||S.dispose(),null===(H=this._tintTexture)||void 0===H||H.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(O,f,y){return O.CLEARCOAT_BUMP&&f.addFallback(y++,"CLEARCOAT_BUMP"),O.CLEARCOAT_TINT&&f.addFallback(y++,"CLEARCOAT_TINT"),O.CLEARCOAT&&f.addFallback(y++,"CLEARCOAT"),y}getSamplers(O){O.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}x._DefaultIndexOfRefraction=1.5,(0,S.b)([(0,H.L)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"isEnabled",void 0),(0,S.b)([(0,H.L)()],x.prototype,"intensity",void 0),(0,S.b)([(0,H.L)()],x.prototype,"roughness",void 0),(0,S.b)([(0,H.L)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"indexOfRefraction",void 0),(0,S.b)([(0,H.C)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"texture",void 0),(0,S.b)([(0,H.L)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useRoughnessFromMainTexture",void 0),(0,S.b)([(0,H.C)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"textureRoughness",void 0),(0,S.b)([(0,H.L)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"remapF0OnInterfaceChange",void 0),(0,S.b)([(0,H.C)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"bumpTexture",void 0),(0,S.b)([(0,H.L)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"isTintEnabled",void 0),(0,S.b)([(0,H.h)()],x.prototype,"tintColor",void 0),(0,S.b)([(0,H.L)()],x.prototype,"tintColorAtDistance",void 0),(0,S.b)([(0,H.L)()],x.prototype,"tintThickness",void 0),(0,S.b)([(0,H.C)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"tintTexture",void 0);class W extends q.e{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class E extends F.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(O,"PBRIridescence",110,new W,f),this._isEnabled=!1,this.isEnabled=!1,this.Yi=1,this.minimumThickness=E._DefaultMinimumThickness,this.maximumThickness=E._DefaultMaximumThickness,this.indexOfRefraction=E._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=O._dirtyCallbacks[1]}isReadyForSubMesh(O,f){if(!this._isEnabled)return!0;if(O._areTexturesDirty&&f.texturesEnabled){if(this._texture&&L.b.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&L.b.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(O,f){this._isEnabled?(O.IRIDESCENCE=!0,O._areTexturesDirty&&f.texturesEnabled&&(this._texture&&L.b.IridescenceTextureEnabled?(0,U.J)(this._texture,O,"IRIDESCENCE_TEXTURE"):O.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&L.b.IridescenceTextureEnabled?(0,U.J)(this._thicknessTexture,O,"IRIDESCENCE_THICKNESS_TEXTURE"):O.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(O.IRIDESCENCE=!1,O.IRIDESCENCE_TEXTURE=!1,O.IRIDESCENCE_THICKNESS_TEXTURE=!1,O.IRIDESCENCE_TEXTUREDIRECTUV=0,O.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(O,f){if(!this._isEnabled)return;const y=this._material.isFrozen;if(!O.useUbo||!y||!O.isSync){var S,H,b,h;if((this._texture||this._thicknessTexture)&&L.b.IridescenceTextureEnabled)O.updateFloat4("vIridescenceInfos",(null===(S=this._texture)||void 0===S?void 0:S.coordinatesIndex)??0,(null===(H=this._texture)||void 0===H?void 0:H.level)??0,(null===(b=this._thicknessTexture)||void 0===b?void 0:b.coordinatesIndex)??0,(null===(h=this._thicknessTexture)||void 0===h?void 0:h.level)??0),this._texture&&(0,U.r)(this._texture,O,"iridescence"),this._thicknessTexture&&(0,U.r)(this._thicknessTexture,O,"iridescenceThickness");O.updateFloat4("vIridescenceParams",this.Yi,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}f.texturesEnabled&&(this._texture&&L.b.IridescenceTextureEnabled&&O.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&L.b.IridescenceTextureEnabled&&O.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(O){return this._texture===O||this._thicknessTexture===O}getActiveTextures(O){this._texture&&O.push(this._texture),this._thicknessTexture&&O.push(this._thicknessTexture)}getAnimatables(O){this._texture&&this._texture.animations&&this._texture.animations.length>0&&O.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&O.push(this._thicknessTexture)}dispose(O){var f,y;O&&(null===(f=this._texture)||void 0===f||f.dispose(),null===(y=this._thicknessTexture)||void 0===y||y.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(O,f,y){return O.IRIDESCENCE&&f.addFallback(y++,"IRIDESCENCE"),y}getSamplers(O){O.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}E._DefaultMinimumThickness=100,E._DefaultMaximumThickness=400,E._DefaultIndexOfRefraction=1.3,(0,S.b)([(0,H.L)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"isEnabled",void 0),(0,S.b)([(0,H.L)()],E.prototype,"intensity",void 0),(0,S.b)([(0,H.L)()],E.prototype,"minimumThickness",void 0),(0,S.b)([(0,H.L)()],E.prototype,"maximumThickness",void 0),(0,S.b)([(0,H.L)()],E.prototype,"indexOfRefraction",void 0),(0,S.b)([(0,H.C)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"texture",void 0),(0,S.b)([(0,H.C)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"thicknessTexture",void 0);class o extends q.e{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class i extends F.b{set angle(O){this.direction.x=Math.cos(O),this.direction.y=Math.sin(O)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(O,"PBRAnisotropic",110,new o,f),this._isEnabled=!1,this.isEnabled=!1,this.Yi=1,this.direction=new m.i(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=O._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=O._dirtyCallbacks[16]}isReadyForSubMesh(O,f){return!this._isEnabled||!(O._areTexturesDirty&&f.texturesEnabled&&this._texture&&L.b.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(O,f,y){this._isEnabled?(O.ANISOTROPIC=this._isEnabled,this._isEnabled&&!y.isVerticesDataPresent(t.f.TangentKind)&&(O._needUVs=!0,O.MAINUV1=!0),O._areTexturesDirty&&f.texturesEnabled&&(this._texture&&L.b.AnisotropicTextureEnabled?(0,U.J)(this._texture,O,"ANISOTROPIC_TEXTURE"):O.ANISOTROPIC_TEXTURE=!1),O._areMiscDirty&&(O.ANISOTROPIC_LEGACY=this._legacy)):(O.ANISOTROPIC=!1,O.ANISOTROPIC_TEXTURE=!1,O.ANISOTROPIC_TEXTUREDIRECTUV=0,O.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(O,f){if(!this._isEnabled)return;const y=this._material.isFrozen;O.useUbo&&y&&O.isSync||(this._texture&&L.b.AnisotropicTextureEnabled&&(O.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,U.r)(this._texture,O,"anisotropy")),O.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.Yi)),f.texturesEnabled&&this._texture&&L.b.AnisotropicTextureEnabled&&O.setTexture("anisotropySampler",this._texture)}hasTexture(O){return this._texture===O}getActiveTextures(O){this._texture&&O.push(this._texture)}getAnimatables(O){this._texture&&this._texture.animations&&this._texture.animations.length>0&&O.push(this._texture)}dispose(O){O&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(O,f,y){return O.ANISOTROPIC&&f.addFallback(y++,"ANISOTROPIC"),y}getSamplers(O){O.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(O,f,y){super.parse(O,f,y),void 0===O.legacy&&(this.legacy=!0)}}(0,S.b)([(0,H.L)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isEnabled",void 0),(0,S.b)([(0,H.L)()],i.prototype,"intensity",void 0),(0,S.b)([(0,H.F)()],i.prototype,"direction",void 0),(0,S.b)([(0,H.C)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"texture",void 0),(0,S.b)([(0,H.L)(),(0,H.d)("_markAllSubMeshesAsMiscDirty")],i.prototype,"legacy",void 0);class D extends q.e{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class V extends F.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(O,"Sheen",120,new D,f),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.Yi=1,this.color=X.d.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=O._dirtyCallbacks[1]}isReadyForSubMesh(O,f){if(!this._isEnabled)return!0;if(O._areTexturesDirty&&f.texturesEnabled){if(this._texture&&L.b.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&L.b.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(O,f){this._isEnabled?(O.SHEEN=!0,O.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,O.SHEEN_ROUGHNESS=null!==this._roughness,O.SHEEN_ALBEDOSCALING=this._albedoScaling,O.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,O._areTexturesDirty&&f.texturesEnabled&&(this._texture&&L.b.SheenTextureEnabled?((0,U.J)(this._texture,O,"SHEEN_TEXTURE"),O.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):O.SHEEN_TEXTURE=!1,this._textureRoughness&&L.b.SheenTextureEnabled?(0,U.J)(this._textureRoughness,O,"SHEEN_TEXTURE_ROUGHNESS"):O.SHEEN_TEXTURE_ROUGHNESS=!1)):(O.SHEEN=!1,O.SHEEN_TEXTURE=!1,O.SHEEN_TEXTURE_ROUGHNESS=!1,O.SHEEN_LINKWITHALBEDO=!1,O.SHEEN_ROUGHNESS=!1,O.SHEEN_ALBEDOSCALING=!1,O.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,O.SHEEN_GAMMATEXTURE=!1,O.SHEEN_TEXTUREDIRECTUV=0,O.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(O,f,y,S){if(!this._isEnabled)return;const H=S.materialDefines,b=this._material.isFrozen;if(!O.useUbo||!b||!O.isSync){var h,v,N,m;if((this._texture||this._textureRoughness)&&L.b.SheenTextureEnabled)O.updateFloat4("vSheenInfos",(null===(h=this._texture)||void 0===h?void 0:h.coordinatesIndex)??0,(null===(v=this._texture)||void 0===v?void 0:v.level)??0,(null===(N=this._textureRoughness)||void 0===N?void 0:N.coordinatesIndex)??0,(null===(m=this._textureRoughness)||void 0===m?void 0:m.level)??0),this._texture&&(0,U.r)(this._texture,O,"sheen"),this._textureRoughness&&!H.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,U.r)(this._textureRoughness,O,"sheenRoughness");O.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.Yi),null!==this._roughness&&O.updateFloat("vSheenRoughness",this._roughness)}f.texturesEnabled&&(this._texture&&L.b.SheenTextureEnabled&&O.setTexture("sheenSampler",this._texture),this._textureRoughness&&!H.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&L.b.SheenTextureEnabled&&O.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(O){return this._texture===O||this._textureRoughness===O}getActiveTextures(O){this._texture&&O.push(this._texture),this._textureRoughness&&O.push(this._textureRoughness)}getAnimatables(O){this._texture&&this._texture.animations&&this._texture.animations.length>0&&O.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&O.push(this._textureRoughness)}dispose(O){var f,y;O&&(null===(f=this._texture)||void 0===f||f.dispose(),null===(y=this._textureRoughness)||void 0===y||y.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(O,f,y){return O.SHEEN&&f.addFallback(y++,"SHEEN"),y}getSamplers(O){O.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,S.b)([(0,H.L)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"isEnabled",void 0),(0,S.b)([(0,H.L)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"linkSheenWithAlbedo",void 0),(0,S.b)([(0,H.L)()],V.prototype,"intensity",void 0),(0,S.b)([(0,H.h)()],V.prototype,"color",void 0),(0,S.b)([(0,H.C)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"texture",void 0),(0,S.b)([(0,H.L)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useRoughnessFromMainTexture",void 0),(0,S.b)([(0,H.L)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"roughness",void 0),(0,S.b)([(0,H.C)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"textureRoughness",void 0),(0,S.b)([(0,H.L)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"albedoScaling",void 0);class g extends q.e{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1}}class R extends F.b{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(O){this._scene.enableSubSurfaceForPrePass()&&O&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(O))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(O){this._volumeIndexOfRefraction=O>=1?O:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(O,"PBRSubSurface",130,new g,f),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=X.d.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=X.d.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this._scene=O.va(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=O._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=O._dirtyCallbacks[32]}isReadyForSubMesh(O,f){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(O._areTexturesDirty&&f.texturesEnabled){if(this._thicknessTexture&&L.b.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&L.b.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&L.b.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const O=this._getRefractionTexture(f);if(O&&L.b.RefractionTextureEnabled&&!O.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(O,f){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return O.SUBSURFACE=!1,O.SS_DISPERSION=!1,O.SS_TRANSLUCENCY=!1,O.SS_SCATTERING=!1,O.SS_REFRACTION=!1,O.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,O.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,O.SS_THICKNESSANDMASK_TEXTURE=!1,O.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,O.SS_HAS_THICKNESS=!1,O.SS_REFRACTIONINTENSITY_TEXTURE=!1,O.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,O.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,O.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,O.SS_REFRACTIONMAP_3D=!1,O.SS_REFRACTIONMAP_OPPOSITEZ=!1,O.SS_LODINREFRACTIONALPHA=!1,O.SS_GAMMAREFRACTION=!1,O.SS_RGBDREFRACTION=!1,O.SS_LINEARSPECULARREFRACTION=!1,O.SS_LINKREFRACTIONTOTRANSPARENCY=!1,O.SS_ALBEDOFORREFRACTIONTINT=!1,O.SS_ALBEDOFORTRANSLUCENCYTINT=!1,O.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,O.SS_USE_THICKNESS_AS_DEPTH=!1,O.SS_USE_GLTF_TEXTURES=!1,O.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,void(O.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0);if(O._areTexturesDirty){if(O.SUBSURFACE=!0,O.SS_DISPERSION=this._isDispersionEnabled,O.SS_TRANSLUCENCY=this._isTranslucencyEnabled,O.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,O.SS_SCATTERING=this._isScatteringEnabled,O.SS_THICKNESSANDMASK_TEXTURE=!1,O.SS_REFRACTIONINTENSITY_TEXTURE=!1,O.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,O.SS_HAS_THICKNESS=!1,O.SS_USE_GLTF_TEXTURES=!1,O.SS_REFRACTION=!1,O.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,O.SS_REFRACTIONMAP_3D=!1,O.SS_GAMMAREFRACTION=!1,O.SS_RGBDREFRACTION=!1,O.SS_LINEARSPECULARREFRACTION=!1,O.SS_REFRACTIONMAP_OPPOSITEZ=!1,O.SS_LODINREFRACTIONALPHA=!1,O.SS_LINKREFRACTIONTOTRANSPARENCY=!1,O.SS_ALBEDOFORREFRACTIONTINT=!1,O.SS_ALBEDOFORTRANSLUCENCYTINT=!1,O.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,O.SS_USE_THICKNESS_AS_DEPTH=!1,O.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,O._areTexturesDirty&&f.texturesEnabled&&(this._thicknessTexture&&L.b.ThicknessTextureEnabled&&(0,U.J)(this._thicknessTexture,O,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&L.b.RefractionIntensityTextureEnabled&&(0,U.J)(this._refractionIntensityTexture,O,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&L.b.TranslucencyIntensityTextureEnabled&&(0,U.J)(this._translucencyIntensityTexture,O,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&L.b.TranslucencyColorTextureEnabled&&(0,U.J)(this._translucencyColorTexture,O,"SS_TRANSLUCENCYCOLOR_TEXTURE")),O.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,O.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,O.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,O.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&f.texturesEnabled){const y=this._getRefractionTexture(f);y&&L.b.RefractionTextureEnabled&&(O.SS_REFRACTION=!0,O.SS_REFRACTIONMAP_3D=y.isCube,O.SS_GAMMAREFRACTION=y.gammaSpace,O.SS_RGBDREFRACTION=y.isRGBD,O.SS_LINEARSPECULARREFRACTION=y.linearSpecularLOD,O.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&y.isCube?!y.invertZ:y.invertZ,O.SS_LODINREFRACTIONALPHA=y.lodLevelInAlpha,O.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,O.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,O.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=y.isCube&&y.boundingBoxSize,O.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(O.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(O,f,y,S){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)O.updateFloat2("vThicknessParam",0,0);else{S.getRenderingMesh().getWorldMatrix().decompose(m.g.fb[0]);const f=Math.max(Math.abs(m.g.fb[0].x),Math.abs(m.g.fb[0].y),Math.abs(m.g.fb[0].z));O.updateFloat2("vThicknessParam",this.minimumThickness*f,(this.maximumThickness-this.minimumThickness)*f)}}bindForSubMesh(O,f,y,S){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const H=S.materialDefines,b=this._material.isFrozen,h=this._material.realTimeFiltering,v=H.LODBASEDMICROSFURACE,N=this._getRefractionTexture(f);if(!O.useUbo||!b||!O.isSync){if(this._thicknessTexture&&L.b.ThicknessTextureEnabled&&(O.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,U.r)(this._thicknessTexture,O,"thickness")),this._refractionIntensityTexture&&L.b.RefractionIntensityTextureEnabled&&H.SS_REFRACTIONINTENSITY_TEXTURE&&(O.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,U.r)(this._refractionIntensityTexture,O,"refractionIntensity")),this._translucencyColorTexture&&L.b.TranslucencyColorTextureEnabled&&H.SS_TRANSLUCENCYCOLOR_TEXTURE&&(O.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,U.r)(this._translucencyColorTexture,O,"translucencyColor")),this._translucencyIntensityTexture&&L.b.TranslucencyIntensityTextureEnabled&&H.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(O.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,U.r)(this._translucencyIntensityTexture,O,"translucencyIntensity")),N&&L.b.RefractionTextureEnabled){O.Fj("refractionMatrix",N.getRefractionTextureMatrix());let f=1;N.isCube||N.depth&&(f=N.depth);const y=N.getSize().width,S=this.volumeIndexOfRefraction;if(O.updateFloat4("vRefractionInfos",N.level,1/S,f,this._invertRefractionY?-1:1),O.updateFloat4("vRefractionMicrosurfaceInfos",y,N.lodGenerationScale,N.lodGenerationOffset,1/this.indexOfRefraction),h&&O.updateFloat2("vRefractionFilteringInfo",y,Math.log2(y)),N.boundingBoxSize){const f=N;O.updateVector3("vRefractionPosition",f.boundingBoxPosition),O.updateVector3("vRefractionSize",f.boundingBoxSize)}}this._isScatteringEnabled&&O.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),O.updateColor3("vDiffusionDistance",this.diffusionDistance),O.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),O.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),O.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),O.updateFloat("dispersion",this.dispersion)}f.texturesEnabled&&(this._thicknessTexture&&L.b.ThicknessTextureEnabled&&O.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&L.b.RefractionIntensityTextureEnabled&&H.SS_REFRACTIONINTENSITY_TEXTURE&&O.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&L.b.TranslucencyIntensityTextureEnabled&&H.SS_TRANSLUCENCYINTENSITY_TEXTURE&&O.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&L.b.TranslucencyColorTextureEnabled&&H.SS_TRANSLUCENCYCOLOR_TEXTURE&&O.setTexture("translucencyColorSampler",this._translucencyColorTexture),N&&L.b.RefractionTextureEnabled&&(v?O.setTexture("refractionSampler",N):(O.setTexture("refractionSampler",N._lodTextureMid||N),O.setTexture("refractionSamplerLow",N._lodTextureLow||N),O.setTexture("refractionSamplerHigh",N._lodTextureHigh||N))))}_getRefractionTexture(O){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?O.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(O){L.b.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&O.push(this._refractionTexture)}hasTexture(O){return this._thicknessTexture===O||(this._refractionTexture===O||(this._refractionIntensityTexture===O||(this._translucencyIntensityTexture===O||this._translucencyColorTexture===O)))}hasRenderTargetTextures(){return!!(L.b.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(O){this._thicknessTexture&&O.push(this._thicknessTexture),this._refractionTexture&&O.push(this._refractionTexture),this._translucencyColorTexture&&O.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&O.push(this._translucencyIntensityTexture)}getAnimatables(O){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&O.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&O.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&O.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&O.push(this._translucencyIntensityTexture)}dispose(O){O&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(O,f,y){return O.SS_SCATTERING&&f.addFallback(y++,"SS_SCATTERING"),O.SS_TRANSLUCENCY&&f.addFallback(y++,"SS_TRANSLUCENCY"),y}getSamplers(O){O.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}(0,S.b)([(0,H.L)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"isRefractionEnabled",void 0),(0,S.b)([(0,H.L)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"isTranslucencyEnabled",void 0),(0,S.b)([(0,H.L)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"isDispersionEnabled",void 0),(0,S.b)([(0,H.L)(),(0,H.d)("_markScenePrePassDirty")],R.prototype,"isScatteringEnabled",void 0),(0,S.b)([(0,H.L)()],R.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,S.b)([(0,H.L)()],R.prototype,"refractionIntensity",void 0),(0,S.b)([(0,H.L)()],R.prototype,"translucencyIntensity",void 0),(0,S.b)([(0,H.L)()],R.prototype,"useAlbedoToTintRefraction",void 0),(0,S.b)([(0,H.L)()],R.prototype,"useAlbedoToTintTranslucency",void 0),(0,S.b)([(0,H.C)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"thicknessTexture",void 0),(0,S.b)([(0,H.C)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"refractionTexture",void 0),(0,S.b)([(0,H.L)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"indexOfRefraction",void 0),(0,S.b)([(0,H.L)()],R.prototype,"_volumeIndexOfRefraction",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"volumeIndexOfRefraction",null),(0,S.b)([(0,H.L)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"invertRefractionY",void 0),(0,S.b)([(0,H.L)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"linkRefractionWithTransparency",void 0),(0,S.b)([(0,H.L)()],R.prototype,"minimumThickness",void 0),(0,S.b)([(0,H.L)()],R.prototype,"maximumThickness",void 0),(0,S.b)([(0,H.L)()],R.prototype,"useThicknessAsDepth",void 0),(0,S.b)([(0,H.h)()],R.prototype,"tintColor",void 0),(0,S.b)([(0,H.L)()],R.prototype,"tintColorAtDistance",void 0),(0,S.b)([(0,H.L)()],R.prototype,"dispersion",void 0),(0,S.b)([(0,H.h)()],R.prototype,"diffusionDistance",void 0),(0,S.b)([(0,H.L)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"useMaskFromThicknessTexture",void 0),(0,S.b)([(0,H.C)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"refractionIntensityTexture",void 0),(0,S.b)([(0,H.C)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"translucencyIntensityTexture",void 0),(0,S.b)([(0,H.h)()],R.prototype,"translucencyColor",void 0),(0,S.b)([(0,H.C)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"translucencyColorTexture",void 0),(0,S.b)([(0,H.L)(),(0,H.d)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"useGltfStyleTextures",void 0);var s=y(11538),k=y(11494),z=y(11549);const c={effect:null,subMesh:null};class d extends q.e{constructor(O){super(O),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class G extends j.e{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(O){this._realTimeFiltering=O,this.Dg(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(O){this._realTimeFilteringQuality=O,this.Dg(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(O){O!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=O||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(O,f){super(O,f,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||G.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new m.q(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=G.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=X.d.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new X.d(0,0,0),this._albedoColor=new X.d(1,1,1),this._reflectivityColor=new X.d(1,1,1),this._reflectionColor=new X.d(1,1,1),this._emissiveColor=new X.d(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=G.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._forceAlphaTest=!1,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new h.g(16),this._globalAmbientColor=new X.d(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new A(this),this.clearCoat=new x(this),this.iridescence=new E(this),this.anisotropy=new i(this),this.sheen=new V(this),this.subSurface=new R(this),this.detailMap=new s.c(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),L.b.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,v.b)(this.va()),this.prePassConfiguration=new J.e}get hasRenderTargetTextures(){return!!(L.b.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var O;return this._transparencyMode===G.PBRMATERIAL_OPAQUE||this._transparencyMode===G.PBRMATERIAL_ALPHATEST||(null===(O=this.subSurface)||void 0===O?void 0:O.disableAlphaBlending)}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var O;return!!this._forceAlphaTest||(null===(O=this.subSurface)||void 0===O||!O.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===G.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.ke&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==G.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.ke||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(O,f,y){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const S=f._drawWrapper;if(S.effect&&this.isFrozen&&S._wasPreviouslyReady&&S._wasPreviouslyUsingInstances===y)return!0;f.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),f.materialDefines=new d(this._eventInfo.defineNames));const H=f.materialDefines;if(this._isReadyForSubMesh(f))return!0;const h=this.va(),v=h.getEngine();if(H._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,h.texturesEnabled)){if(this._albedoTexture&&L.b.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&L.b.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&L.b.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const O=this._getReflectionTexture();if(O&&L.b.ReflectionTextureEnabled){if(!O.isReadyOrNotBlocking())return!1;var N;if(O.irradianceTexture){if(!O.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!O.sphericalPolynomial&&null!==(N=O.getInternalTexture())&&void 0!==N&&N._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&L.b.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&L.b.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(L.b.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(v.getCaps().standardDerivatives&&this._bumpTexture&&L.b.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&L.b.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=H,this._eventInfo.subMesh=f,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(H._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;v.getCaps().standardDerivatives||O.isVerticesDataPresent(t.f.NormalKind)||(O.createNormals(!0),b.e.Warn("PBRMaterial: Normals have been created for the mesh: "+O.name));const m=f.effect,q=H._areLightsDisposed;let F=this._prepareEffect(O,H,this.onCompiled,this.onError,y,null,f.getRenderingMesh().hasThinInstances),I=!1;if(F)if(this._onEffectCreatedObservable&&(c.effect=F,c.subMesh=f,this._onEffectCreatedObservable.notifyObservers(c)),this.allowShaderHotSwapping&&m&&!F.isReady()){if(F=m,H.markAsUnprocessed(),I=this.isFrozen,q)return H._areLightsDisposed=!0,!1}else h.resetCachedMaterial(),f.setEffect(F,H,this._materialContext);return!(!f.effect||!f.effect.isReady())&&(H._renderId=h.getRenderId(),S._wasPreviouslyReady=!I,S._wasPreviouslyUsingInstances=!!y,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(O,f){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(O,f,b,h,v),!f.isDirty)return null;f.markAsProcessed();const N=this.va().getEngine(),m=new p.c;let q=0;f.USESPHERICALINVERTEX&&m.addFallback(q++,"USESPHERICALINVERTEX"),f.FOG&&m.addFallback(q,"FOG"),f.SPECULARAA&&m.addFallback(q,"SPECULARAA"),f.POINTSIZE&&m.addFallback(q,"POINTSIZE"),f.LOGARITHMICDEPTH&&m.addFallback(q,"LOGARITHMICDEPTH"),f.PARALLAX&&m.addFallback(q,"PARALLAX"),f.PARALLAX_RHS&&m.addFallback(q,"PARALLAX_RHS"),f.PARALLAXOCCLUSION&&m.addFallback(q++,"PARALLAXOCCLUSION"),f.ENVIRONMENTBRDF&&m.addFallback(q++,"ENVIRONMENTBRDF"),f.TANGENT&&m.addFallback(q++,"TANGENT"),f.BUMP&&m.addFallback(q++,"BUMP"),q=(0,U.s)(f,m,this._maxSimultaneousLights,q++),f.SPECULARTERM&&m.addFallback(q++,"SPECULARTERM"),f.USESPHERICALFROMREFLECTIONMAP&&m.addFallback(q++,"USESPHERICALFROMREFLECTIONMAP"),f.USEIRRADIANCEMAP&&m.addFallback(q++,"USEIRRADIANCEMAP"),f.LIGHTMAP&&m.addFallback(q++,"LIGHTMAP"),f.NORMAL&&m.addFallback(q++,"NORMAL"),f.AMBIENT&&m.addFallback(q++,"AMBIENT"),f.EMISSIVE&&m.addFallback(q++,"EMISSIVE"),f.VERTEXCOLOR&&m.addFallback(q++,"VERTEXCOLOR"),f.MORPHTARGETS&&m.addFallback(q++,"MORPHTARGETS"),f.MULTIVIEW&&m.addFallback(0,"MULTIVIEW");const F=[t.f.PositionKind];f.NORMAL&&F.push(t.f.NormalKind),f.TANGENT&&F.push(t.f.TangentKind);for(let y=1;y<=6;++y)f["UV"+y]&&F.push(`uv${1===y?"":y}`);f.VERTEXCOLOR&&F.push(t.f.ColorKind),(0,U.w)(F,O,f,m),(0,U.x)(F,f),(0,U.z)(F,O,f),(0,U.u)(F,O,f);let I="pbr";const A=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],X=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],B=["Material","Scene","Mesh"],j={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:f.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=m,this._eventInfo.fallbackRank=q,this._eventInfo.defines=f,this._eventInfo.uniforms=A,this._eventInfo.attributes=F,this._eventInfo.samplers=X,this._eventInfo.uniformBuffersNames=B,this._eventInfo.customCode=void 0,this._eventInfo.mesh=O,this._eventInfo.indexParameters=j,this._callbackPluginEventGeneric(128,this._eventInfo),z.d.AddUniformsAndSamplers(A,X),J.e.AddUniforms(A),J.e.AddSamplers(X),(0,k.b)(A),w.c&&(w.c.PrepareUniforms(A,f),w.c.PrepareSamplers(X,f)),(0,U._)({uniformsNames:A,uniformBuffersNames:B,samplers:X,defines:f,maxSimultaneousLights:this._maxSimultaneousLights});const u={};this.customShaderNameResolve&&(I=this.customShaderNameResolve(I,A,B,X,f,F,u));const L=f.toString(),l=N.createEffect(I,{attributes:F,uniformsNames:A,uniformBuffersNames:B,samplers:X,defines:L,fallbacks:m,onCompiled:S,onError:H,indexParameters:j,processFinalCode:u.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:f.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([y.e(21),y.e(43)]).then(y.bind(y,13492)),Promise.all([y.e(22),y.e(44)]).then(y.bind(y,13510))]):await Promise.all([Promise.all([y.e(25),y.e(45)]).then(y.bind(y,13519)),Promise.all([y.e(27),y.e(46)]).then(y.bind(y,13539))]),this._shadersLoaded=!0}},N);return this._eventInfo.customCode=void 0,l}_prepareDefines(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,H=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const b=this.va(),h=b.getEngine();(0,U.G)(b,O,f,!0,this._maxSimultaneousLights,this._disableLighting),f._needNormals=!0,(0,U.Q)(b,f);const v=this.needAlphaBlendingForMesh(O)&&this.va().useOrderIndependentTransparency;if((0,U.W)(b,f,this.canRenderToMRT&&!v),(0,U.T)(b,f,v),z.d.PrepareDefines(h.currentRenderPassId,O,f),f.METALLICWORKFLOW=this.isMetallicWorkflow(),f._areTexturesDirty){f._needUVs=!1;for(let O=1;O<=6;++O)f["MAINUV"+O]=!1;if(b.texturesEnabled){f.ALBEDODIRECTUV=0,f.AMBIENTDIRECTUV=0,f.OPACITYDIRECTUV=0,f.EMISSIVEDIRECTUV=0,f.REFLECTIVITYDIRECTUV=0,f.MICROSURFACEMAPDIRECTUV=0,f.METALLIC_REFLECTANCEDIRECTUV=0,f.REFLECTANCEDIRECTUV=0,f.BUMPDIRECTUV=0,f.LIGHTMAPDIRECTUV=0,h.getCaps().textureLOD&&(f.LODBASEDMICROSFURACE=!0),this._albedoTexture&&L.b.DiffuseTextureEnabled?((0,U.J)(this._albedoTexture,f,"ALBEDO"),f.GAMMAALBEDO=this._albedoTexture.gammaSpace):f.ALBEDO=!1,this._ambientTexture&&L.b.AmbientTextureEnabled?((0,U.J)(this._ambientTexture,f,"AMBIENT"),f.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):f.AMBIENT=!1,this._opacityTexture&&L.b.OpacityTextureEnabled?((0,U.J)(this._opacityTexture,f,"OPACITY"),f.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):f.OPACITY=!1;const O=this._getReflectionTexture();if(O&&L.b.ReflectionTextureEnabled){switch(f.REFLECTION=!0,f.GAMMAREFLECTION=O.gammaSpace,f.RGBDREFLECTION=O.isRGBD,f.LODINREFLECTIONALPHA=O.lodLevelInAlpha,f.LINEARSPECULARREFLECTION=O.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(f.NUM_SAMPLES=""+this.realTimeFilteringQuality,h._features.needTypeSuffixInShaderConstants&&(f.NUM_SAMPLES=f.NUM_SAMPLES+"u"),f.REALTIME_FILTERING=!0):f.REALTIME_FILTERING=!1,f.INVERTCUBICMAP=O.coordinatesMode===u.e.INVCUBIC_MODE,f.REFLECTIONMAP_3D=O.isCube,f.REFLECTIONMAP_OPPOSITEZ=f.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!O.invertZ:O.invertZ,f.REFLECTIONMAP_CUBIC=!1,f.REFLECTIONMAP_EXPLICIT=!1,f.REFLECTIONMAP_PLANAR=!1,f.REFLECTIONMAP_PROJECTION=!1,f.REFLECTIONMAP_SKYBOX=!1,f.REFLECTIONMAP_SPHERICAL=!1,f.REFLECTIONMAP_EQUIRECTANGULAR=!1,f.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,f.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,O.coordinatesMode){case u.e.EXPLICIT_MODE:f.REFLECTIONMAP_EXPLICIT=!0;break;case u.e.PLANAR_MODE:f.REFLECTIONMAP_PLANAR=!0;break;case u.e.PROJECTION_MODE:f.REFLECTIONMAP_PROJECTION=!0;break;case u.e.SKYBOX_MODE:f.REFLECTIONMAP_SKYBOX=!0;break;case u.e.SPHERICAL_MODE:f.REFLECTIONMAP_SPHERICAL=!0;break;case u.e.EQUIRECTANGULAR_MODE:f.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case u.e.FIXED_EQUIRECTANGULAR_MODE:f.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case u.e.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:f.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case u.e.CUBIC_MODE:case u.e.INVCUBIC_MODE:default:f.REFLECTIONMAP_CUBIC=!0,f.USE_LOCAL_REFLECTIONMAP_CUBIC=!!O.boundingBoxSize}O.coordinatesMode!==u.e.SKYBOX_MODE&&(O.irradianceTexture?(f.USEIRRADIANCEMAP=!0,f.USESPHERICALFROMREFLECTIONMAP=!1):O.isCube&&(f.USESPHERICALFROMREFLECTIONMAP=!0,f.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||h.getCaps().maxVaryingVectors<=8?f.USESPHERICALINVERTEX=!1:f.USESPHERICALINVERTEX=!0))}else f.REFLECTION=!1,f.REFLECTIONMAP_3D=!1,f.REFLECTIONMAP_SPHERICAL=!1,f.REFLECTIONMAP_PLANAR=!1,f.REFLECTIONMAP_CUBIC=!1,f.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,f.REFLECTIONMAP_PROJECTION=!1,f.REFLECTIONMAP_SKYBOX=!1,f.REFLECTIONMAP_EXPLICIT=!1,f.REFLECTIONMAP_EQUIRECTANGULAR=!1,f.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,f.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,f.INVERTCUBICMAP=!1,f.USESPHERICALFROMREFLECTIONMAP=!1,f.USEIRRADIANCEMAP=!1,f.USESPHERICALINVERTEX=!1,f.REFLECTIONMAP_OPPOSITEZ=!1,f.LODINREFLECTIONALPHA=!1,f.GAMMAREFLECTION=!1,f.RGBDREFLECTION=!1,f.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&L.b.LightmapTextureEnabled?((0,U.J)(this._lightmapTexture,f,"LIGHTMAP"),f.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,f.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,f.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):f.LIGHTMAP=!1,this._emissiveTexture&&L.b.EmissiveTextureEnabled?((0,U.J)(this._emissiveTexture,f,"EMISSIVE"),f.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):f.EMISSIVE=!1,L.b.SpecularTextureEnabled?(this._metallicTexture?((0,U.J)(this._metallicTexture,f,"REFLECTIVITY"),f.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,f.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,f.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,f.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,f.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,U.J)(this._reflectivityTexture,f,"REFLECTIVITY"),f.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,f.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,f.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):f.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(f.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,U.J)(this._metallicReflectanceTexture,f,"METALLIC_REFLECTANCE"),f.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):f.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,U.J)(this._reflectanceTexture,f,"REFLECTANCE"),f.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):f.REFLECTANCE=!1):(f.METALLIC_REFLECTANCE=!1,f.REFLECTANCE=!1),this._microSurfaceTexture?(0,U.J)(this._microSurfaceTexture,f,"MICROSURFACEMAP"):f.MICROSURFACEMAP=!1):(f.REFLECTIVITY=!1,f.MICROSURFACEMAP=!1),h.getCaps().standardDerivatives&&this._bumpTexture&&L.b.BumpTextureEnabled&&!this._disableBumpMap?((0,U.J)(this._bumpTexture,f,"BUMP"),this._useParallax&&this._albedoTexture&&L.b.DiffuseTextureEnabled?(f.PARALLAX=!0,f.PARALLAX_RHS=b.useRightHandedSystem,f.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):f.PARALLAX=!1,f.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(f.BUMP=!1,f.PARALLAX=!1,f.PARALLAX_RHS=!1,f.PARALLAXOCCLUSION=!1,f.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&L.b.ReflectionTextureEnabled?(f.ENVIRONMENTBRDF=!0,f.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(f.ENVIRONMENTBRDF=!1,f.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?f.ALPHAFROMALBEDO=!0:f.ALPHAFROMALBEDO=!1}f.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===G.LIGHTFALLOFF_STANDARD?(f.USEPHYSICALLIGHTFALLOFF=!1,f.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===G.LIGHTFALLOFF_GLTF?(f.USEPHYSICALLIGHTFALLOFF=!1,f.USEGLTFLIGHTFALLOFF=!0):(f.USEPHYSICALLIGHTFALLOFF=!0,f.USEGLTFLIGHTFALLOFF=!1),f.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.Wg&&this._twoSidedLighting?f.TWOSIDEDLIGHTING=!0:f.TWOSIDEDLIGHTING=!1,f.SPECULARAA=h.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(f._areTexturesDirty||f._areMiscDirty)&&(f.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,f.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,f.ALPHABLEND=this.needAlphaBlendingForMesh(O),f.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,f.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),f._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(f),f.FORCENORMALFORWARD=this._forceNormalForward,f.RADIANCEOCCLUSION=this._useRadianceOcclusion,f.HORIZONOCCLUSION=this._useHorizonOcclusion,f._areMiscDirty&&((0,U.N)(O,b,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(O)||this._forceAlphaTest,f,this._applyDecalMapAfterDetailMap),f.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!O.isVerticesDataPresent(t.f.NormalKind),f.DEBUGMODE=this._debugMode),(0,U.D)(b,h,this,f,!!y,S,H),this._eventInfo.defines=f,this._eventInfo.mesh=O,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,U.A)(O,f,!0,!0,!0,this._transparencyMode!==G.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(O,f,y){const S={clipPlane:!1,useInstances:!1,...y};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const y=new d(this._eventInfo.defineNames),H=this._prepareEffect(O,y,void 0,void 0,S.useInstances,S.clipPlane,O.hasThinInstances);this._onEffectCreatedObservable&&(c.effect=H,c.subMesh=null,this._onEffectCreatedObservable.notifyObservers(c)),H.isReady()?f&&f(this):H.onCompileObservable.add((()=>{f&&f(this)}))})()}buildUniformLayout(){const O=this._uniformBuffer;O.addUniform("vAlbedoInfos",2),O.addUniform("vAmbientInfos",4),O.addUniform("vOpacityInfos",2),O.addUniform("vEmissiveInfos",2),O.addUniform("vLightmapInfos",2),O.addUniform("vReflectivityInfos",3),O.addUniform("vMicroSurfaceSamplerInfos",2),O.addUniform("vReflectionInfos",2),O.addUniform("vReflectionFilteringInfo",2),O.addUniform("vReflectionPosition",3),O.addUniform("vReflectionSize",3),O.addUniform("vBumpInfos",3),O.addUniform("albedoMatrix",16),O.addUniform("ambientMatrix",16),O.addUniform("opacityMatrix",16),O.addUniform("emissiveMatrix",16),O.addUniform("lightmapMatrix",16),O.addUniform("reflectivityMatrix",16),O.addUniform("microSurfaceSamplerMatrix",16),O.addUniform("bumpMatrix",16),O.addUniform("vTangentSpaceParams",2),O.addUniform("reflectionMatrix",16),O.addUniform("vReflectionColor",3),O.addUniform("vAlbedoColor",4),O.addUniform("vLightingIntensity",4),O.addUniform("vReflectionMicrosurfaceInfos",3),O.addUniform("pointSize",1),O.addUniform("vReflectivityColor",4),O.addUniform("vEmissiveColor",3),O.addUniform("vAmbientColor",3),O.addUniform("vDebugMode",2),O.addUniform("vMetallicReflectanceFactors",4),O.addUniform("vMetallicReflectanceInfos",2),O.addUniform("metallicReflectanceMatrix",16),O.addUniform("vReflectanceInfos",2),O.addUniform("reflectanceMatrix",16),O.addUniform("vSphericalL00",3),O.addUniform("vSphericalL1_1",3),O.addUniform("vSphericalL10",3),O.addUniform("vSphericalL11",3),O.addUniform("vSphericalL2_2",3),O.addUniform("vSphericalL2_1",3),O.addUniform("vSphericalL20",3),O.addUniform("vSphericalL21",3),O.addUniform("vSphericalL22",3),O.addUniform("vSphericalX",3),O.addUniform("vSphericalY",3),O.addUniform("vSphericalZ",3),O.addUniform("vSphericalXX_ZZ",3),O.addUniform("vSphericalYY_ZZ",3),O.addUniform("vSphericalZZ",3),O.addUniform("vSphericalXY",3),O.addUniform("vSphericalYZ",3),O.addUniform("vSphericalZX",3),super.buildUniformLayout()}bindForSubMesh(O,f,y){const S=this.va(),H=y.materialDefines;if(!H)return;const b=y.effect;if(!b)return;this._activeEffect=b,f.getMeshUniformBuffer().bindToEffect(b,"Mesh"),f.transferToEffect(O);const h=S.getEngine();this._uniformBuffer.bindToEffect(b,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,S,f,O,this.isFrozen),z.d.Bind(h.currentRenderPassId,this._activeEffect,f,O),this._eventInfo.subMesh=y,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),H.OBJECTSPACE_NORMALMAP&&(O.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const v=this._mustRebind(S,b,y,f.visibility);(0,U.c)(f,this._activeEffect,this.prePassConfiguration);let m=null;const t=this._uniformBuffer;if(v){if(this.bindViewProjection(b),m=this._getReflectionTexture(),!t.useUbo||!this.isFrozen||!t.isSync||y._drawWrapper._forceRebindOnNextCall){var q;if(S.texturesEnabled){if(this._albedoTexture&&L.b.DiffuseTextureEnabled&&(t.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,U.r)(this._albedoTexture,t,"albedo")),this._ambientTexture&&L.b.AmbientTextureEnabled&&(t.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,U.r)(this._ambientTexture,t,"ambient")),this._opacityTexture&&L.b.OpacityTextureEnabled&&(t.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,U.r)(this._opacityTexture,t,"opacity")),m&&L.b.ReflectionTextureEnabled){if(t.Fj("reflectionMatrix",m.getReflectionTextureMatrix()),t.updateFloat2("vReflectionInfos",m.level,0),m.boundingBoxSize){const O=m;t.updateVector3("vReflectionPosition",O.boundingBoxPosition),t.updateVector3("vReflectionSize",O.boundingBoxSize)}if(this.realTimeFiltering){const O=m.getSize().width;t.updateFloat2("vReflectionFilteringInfo",O,Math.log2(O))}if(!H.USEIRRADIANCEMAP){const O=m.sphericalPolynomial;if(H.USESPHERICALFROMREFLECTIONMAP&&O)if(H.SPHERICAL_HARMONICS){const f=O.preScaledHarmonics;t.updateVector3("vSphericalL00",f.l00),t.updateVector3("vSphericalL1_1",f.l1_1),t.updateVector3("vSphericalL10",f.l10),t.updateVector3("vSphericalL11",f.l11),t.updateVector3("vSphericalL2_2",f.l2_2),t.updateVector3("vSphericalL2_1",f.l2_1),t.updateVector3("vSphericalL20",f.l20),t.updateVector3("vSphericalL21",f.l21),t.updateVector3("vSphericalL22",f.l22)}else t.updateFloat3("vSphericalX",O.x.x,O.x.y,O.x.z),t.updateFloat3("vSphericalY",O.y.x,O.y.y,O.y.z),t.updateFloat3("vSphericalZ",O.z.x,O.z.y,O.z.z),t.updateFloat3("vSphericalXX_ZZ",O.xx.x-O.zz.x,O.xx.y-O.zz.y,O.xx.z-O.zz.z),t.updateFloat3("vSphericalYY_ZZ",O.yy.x-O.zz.x,O.yy.y-O.zz.y,O.yy.z-O.zz.z),t.updateFloat3("vSphericalZZ",O.zz.x,O.zz.y,O.zz.z),t.updateFloat3("vSphericalXY",O.xy.x,O.xy.y,O.xy.z),t.updateFloat3("vSphericalYZ",O.yz.x,O.yz.y,O.yz.z),t.updateFloat3("vSphericalZX",O.zx.x,O.zx.y,O.zx.z)}t.updateFloat3("vReflectionMicrosurfaceInfos",m.getSize().width,m.lodGenerationScale,m.lodGenerationOffset)}this._emissiveTexture&&L.b.EmissiveTextureEnabled&&(t.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,U.r)(this._emissiveTexture,t,"emissive")),this._lightmapTexture&&L.b.LightmapTextureEnabled&&(t.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,U.r)(this._lightmapTexture,t,"lightmap")),L.b.SpecularTextureEnabled&&(this._metallicTexture?(t.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,U.r)(this._metallicTexture,t,"reflectivity")):this._reflectivityTexture&&(t.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,U.r)(this._reflectivityTexture,t,"reflectivity")),this._metallicReflectanceTexture&&(t.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,U.r)(this._metallicReflectanceTexture,t,"metallicReflectance")),this._reflectanceTexture&&H.REFLECTANCE&&(t.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,U.r)(this._reflectanceTexture,t,"reflectance")),this._microSurfaceTexture&&(t.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,U.r)(this._microSurfaceTexture,t,"microSurfaceSampler"))),this._bumpTexture&&h.getCaps().standardDerivatives&&L.b.BumpTextureEnabled&&!this._disableBumpMap&&(t.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,U.r)(this._bumpTexture,t,"bump"),S._mirroredCameraPosition?t.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):t.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&t.updateFloat("pointSize",this.pointSize),H.METALLICWORKFLOW){var F;X.k.gb[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,X.k.gb[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,t.updateColor4("vReflectivityColor",X.k.gb[0],1);const O=(null===(F=this.subSurface)||void 0===F?void 0:F._indexOfRefraction)??1.5,f=1,y=Math.pow((O-f)/(O+f),2);this._metallicReflectanceColor.scaleToRef(y*this._metallicF0Factor,X.k.gb[0]);const S=this._metallicF0Factor;t.updateColor4("vMetallicReflectanceFactors",X.k.gb[0],S)}else t.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);t.updateColor3("vEmissiveColor",L.b.EmissiveTextureEnabled?this._emissiveColor:X.d.BlackReadOnly),t.updateColor3("vReflectionColor",this._reflectionColor),!H.SS_REFRACTION&&null!==(q=this.subSurface)&&void 0!==q&&q._linkRefractionWithTransparency?t.updateColor4("vAlbedoColor",this._albedoColor,1):t.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*S.environmentIntensity,this._lightingInfos.w=this._specularIntensity,t.updateVector4("vLightingIntensity",this._lightingInfos),S.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),t.updateColor3("vAmbientColor",this._globalAmbientColor),t.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}S.texturesEnabled&&(this._albedoTexture&&L.b.DiffuseTextureEnabled&&t.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&L.b.AmbientTextureEnabled&&t.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&L.b.OpacityTextureEnabled&&t.setTexture("opacitySampler",this._opacityTexture),m&&L.b.ReflectionTextureEnabled&&(H.LODBASEDMICROSFURACE?t.setTexture("reflectionSampler",m):(t.setTexture("reflectionSampler",m._lodTextureMid||m),t.setTexture("reflectionSamplerLow",m._lodTextureLow||m),t.setTexture("reflectionSamplerHigh",m._lodTextureHigh||m)),H.USEIRRADIANCEMAP&&t.setTexture("irradianceSampler",m.irradianceTexture)),H.ENVIRONMENTBRDF&&t.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&L.b.EmissiveTextureEnabled&&t.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&L.b.LightmapTextureEnabled&&t.setTexture("lightmapSampler",this._lightmapTexture),L.b.SpecularTextureEnabled&&(this._metallicTexture?t.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&t.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&t.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&H.REFLECTANCE&&t.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&t.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&h.getCaps().standardDerivatives&&L.b.BumpTextureEnabled&&!this._disableBumpMap&&t.setTexture("bumpSampler",this._bumpTexture)),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(f)&&this.va().depthPeelingRenderer.bind(b),this._eventInfo.subMesh=y,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,k.f)(this._activeEffect,this,S),this.bindEyePosition(b)}else S.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(v||!this.isFrozen){var I;if(S.lightsEnabled&&!this._disableLighting&&(0,U.g)(S,f,this._activeEffect,H,this._maxSimultaneousLights),(S.fogEnabled&&f.applyFog&&S.fogMode!==N.c.FOGMODE_NONE||m||this.subSurface.refractionTexture||f.receiveShadows||H.PREPASS)&&this.bindView(b),(0,U.e)(S,f,this._activeEffect,!0),H.NUM_MORPH_INFLUENCERS&&(0,U.l)(f,this._activeEffect),H.BAKED_VERTEX_ANIMATION_TEXTURE)null===(I=f.bakedVertexAnimationManager)||void 0===I||I.bind(b,H.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,U.j)(H,this._activeEffect,S)}this._afterBind(f,this._activeEffect,y),t.update()}getAnimatables(){const O=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&O.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&O.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&O.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&O.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&O.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?O.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&O.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&O.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&O.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&O.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&O.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&O.push(this._microSurfaceTexture),O}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.va().environmentTexture}getActiveTextures(){const O=super.getActiveTextures();return this._albedoTexture&&O.push(this._albedoTexture),this._ambientTexture&&O.push(this._ambientTexture),this._opacityTexture&&O.push(this._opacityTexture),this._reflectionTexture&&O.push(this._reflectionTexture),this._emissiveTexture&&O.push(this._emissiveTexture),this._reflectivityTexture&&O.push(this._reflectivityTexture),this._metallicTexture&&O.push(this._metallicTexture),this._metallicReflectanceTexture&&O.push(this._metallicReflectanceTexture),this._reflectanceTexture&&O.push(this._reflectanceTexture),this._microSurfaceTexture&&O.push(this._microSurfaceTexture),this._bumpTexture&&O.push(this._bumpTexture),this._lightmapTexture&&O.push(this._lightmapTexture),O}hasTexture(O){return!!super.hasTexture(O)||(this._albedoTexture===O||(this._ambientTexture===O||(this._opacityTexture===O||(this._reflectionTexture===O||(this._emissiveTexture===O||(this._reflectivityTexture===O||(this._metallicTexture===O||(this._metallicReflectanceTexture===O||(this._reflectanceTexture===O||(this._microSurfaceTexture===O||(this._bumpTexture===O||this._lightmapTexture===O)))))))))))}setPrePassRenderer(){var O;if(null===(O=this.subSurface)||void 0===O||!O.isScatteringEnabled)return!1;const f=this.va().enableSubSurfaceForPrePass();return f&&(f.enabled=!0),!0}dispose(O,f){var y,S,H,b,h,v,N,m,t,q,F,I;(this._breakShaderLoadedCheck=!0,f)&&(this._environmentBRDFTexture&&this.va().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(y=this._albedoTexture)||void 0===y||y.dispose(),null===(S=this._ambientTexture)||void 0===S||S.dispose(),null===(H=this._opacityTexture)||void 0===H||H.dispose(),null===(b=this._reflectionTexture)||void 0===b||b.dispose(),null===(h=this._emissiveTexture)||void 0===h||h.dispose(),null===(v=this._metallicTexture)||void 0===v||v.dispose(),null===(N=this._reflectivityTexture)||void 0===N||N.dispose(),null===(m=this._bumpTexture)||void 0===m||m.dispose(),null===(t=this._lightmapTexture)||void 0===t||t.dispose(),null===(q=this._metallicReflectanceTexture)||void 0===q||q.dispose(),null===(F=this._reflectanceTexture)||void 0===F||F.dispose(),null===(I=this._microSurfaceTexture)||void 0===I||I.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(O,f)}}G.PBRMATERIAL_OPAQUE=B.c.MATERIAL_OPAQUE,G.PBRMATERIAL_ALPHATEST=B.c.MATERIAL_ALPHATEST,G.PBRMATERIAL_ALPHABLEND=B.c.MATERIAL_ALPHABLEND,G.PBRMATERIAL_ALPHATESTANDBLEND=B.c.MATERIAL_ALPHATESTANDBLEND,G.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,G.LIGHTFALLOFF_PHYSICAL=0,G.LIGHTFALLOFF_GLTF=1,G.LIGHTFALLOFF_STANDARD=2,G.ForceGLSL=!1,(0,S.b)([(0,H.o)()],G.prototype,"_imageProcessingConfiguration",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsMiscDirty")],G.prototype,"debugMode",void 0)},11141:(O,f,y)=>{"use strict";y.d(f,{c:()=>h});var S=y(11017);const H=new Map;function b(O,f){(function(O){return H.delete(O)})(O)&&S.e.Warn(`Extension with the name '${name}' already exists`),H.set(O,f)}function h(O,f){"image/ktx"!==f&&"image/ktx2"!==f||(O=".ktx"),H.has(O)||(O.endsWith(".dds")&&b(".dds",(()=>y.e(12).then(y.bind(y,12900)).then((O=>new O._DDSTextureLoader)))),O.endsWith(".basis")&&b(".basis",(()=>y.e(13).then(y.bind(y,12909)).then((O=>new O._BasisTextureLoader)))),O.endsWith(".env")&&b(".env",(()=>y.e(14).then(y.bind(y,12915)).then((O=>new O._ENVTextureLoader)))),O.endsWith(".hdr")&&b(".hdr",(()=>y.e(15).then(y.bind(y,12918)).then((O=>new O._HDRTextureLoader)))),(O.endsWith(".ktx")||O.endsWith(".ktx2"))&&(b(".ktx",(()=>y.e(16).then(y.bind(y,12925)).then((O=>new O._KTXTextureLoader)))),b(".ktx2",(()=>y.e(16).then(y.bind(y,12925)).then((O=>new O._KTXTextureLoader))))),O.endsWith(".tga")&&b(".tga",(()=>y.e(17).then(y.bind(y,12927)).then((O=>new O._TGATextureLoader)))),O.endsWith(".exr")&&b(".exr",(()=>y.e(18).then(y.bind(y,12934)).then((O=>new O._ExrTextureLoader)))));const S=H.get(O);return S?Promise.resolve(S(f)):null}},11513:(O,f,y)=>{"use strict";y.d(f,{d:()=>F});var S=y(11289),H=y(11294),b=y(11004),h=y(11324),v=y(11042),N=y(11158),m=(y(11051),y(11520));class t{get wrapU(){return this._wrapU}set wrapU(O){this._wrapU=O}get wrapV(){return this._wrapV}set wrapV(O){this._wrapV=O}get coordinatesMode(){return 0}get isCube(){return!!this._texture&&this._texture.isCube}set isCube(O){this._texture&&(this._texture.isCube=O)}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(O){this._texture&&(this._texture.is3D=O)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(O){this._texture&&(this._texture.is2DArray=O)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(O){return void 0!==(null===O||void 0===O?void 0:O.shareDepth)}constructor(O){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=m.e.Zero(),this._cachedBaseSize=m.e.Zero(),this._initialSamplingMode=2,this._texture=t._IsRenderTargetWrapper(O)?O.texture:O,this._texture&&(this._engine=this._texture.getEngine())}isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(O){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(O,this._texture)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}var q=y(11362);class F extends t{set ke(O){this._hasAlpha!==O&&(this._hasAlpha=O,this._scene&&this._scene.markAllMaterialsAsDirty(1,(O=>O.hasTexture(this))))}get ke(){return this._hasAlpha}set getAlphaFromRGB(O){this._getAlphaFromRGB!==O&&(this._getAlphaFromRGB=O,this._scene&&this._scene.markAllMaterialsAsDirty(1,(O=>O.hasTexture(this))))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(O){this._coordinatesIndex!==O&&(this._coordinatesIndex=O,this._scene&&this._scene.markAllMaterialsAsDirty(1,(O=>O.hasTexture(this))))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(O){this._coordinatesMode!==O&&(this._coordinatesMode=O,this._scene&&this._scene.markAllMaterialsAsDirty(1,(O=>O.hasTexture(this))))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(O){this._wrapU=O}get wrapV(){return this._wrapV}set wrapV(O){this._wrapV=O}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(O){this._texture?this._texture.isCube=O:this._isCube=O}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(O){this._texture&&(this._texture.is3D=O)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(O){this._texture&&(this._texture.is2DArray=O)}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set gammaSpace(O){var f;if(this._texture){if(this._texture._gammaSpace===O)return;this._texture._gammaSpace=O}else{if(this._gammaSpace===O)return;this._gammaSpace=O}null===(f=this.va())||void 0===f||f.markAllMaterialsAsDirty(1,(O=>O.hasTexture(this)))}get isRGBD(){return null!=this._texture&&this._texture._isRGBD}set isRGBD(O){var f;O!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=O),null===(f=this.va())||void 0===f||f.markAllMaterialsAsDirty(1,(O=>O.hasTexture(this))))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(O){this._texture&&(this._texture._lodGenerationOffset=O)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(O){this._texture&&(this._texture._lodGenerationScale=O)}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}set linearSpecularLOD(O){this._texture&&(this._texture._linearSpecularLOD=O)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(O){this._texture&&(this._texture._irradianceTexture=O)}get uid(){return this._uid||(this._uid=(0,N.d)()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(O){this._onDisposeObserver&&this.hj.remove(this._onDisposeObserver),this._onDisposeObserver=this.hj.add(O)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=F.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.hj=new b.d,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,O?F._IsScene(O)?this._scene=O:this._engine=O:this._scene=v.c.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=f,this._uid=null}va(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return h.b.IdentityReadOnly}getReflectionTextureMatrix(){return h.b.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(O){}get canRescale(){return!1}_getFromCache(O,f,y,S,H,b){const h=this._getEngine();if(!h)return null;const v=h._getUseSRGBBuffer(!!H,f),N=h.getLoadedTexturesCache();for(let m=0;m<N.length;m++){const h=N[m];if((void 0===H||v===h._useSRGBBuffer)&&(void 0===S||S===h.invertY)&&h.url===O&&h.generateMipMaps===!f&&(!y||y===h.samplingMode)&&(void 0===b||b===h.isCube))return h.incrementReferences(),h}return null}_rebuild(){}clone(){return null}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const O=this.va();O&&O.markAllMaterialsAsDirty(1)}readPixels(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],H=arguments.length>4&&void 0!==arguments[4]&&arguments[4],b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,v=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Number.MAX_VALUE,N=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Number.MAX_VALUE;if(!this._texture)return null;const m=this._getEngine();if(!m)return null;const t=this.getSize();let q=t.width,F=t.height;0!==f&&(q/=Math.pow(2,f),F/=Math.pow(2,f),q=Math.round(q),F=Math.round(F)),v=Math.min(q,v),N=Math.min(F,N);try{return this._texture.isCube?m._readTexturePixels(this._texture,v,N,O,f,y,S,H,b,h):m._readTexturePixels(this._texture,v,N,-1,f,y,S,H,b,h)}catch(I){return null}}_readPixelsSync(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],H=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!this._texture)return null;const b=this.getSize();let h=b.width,v=b.height;const N=this._getEngine();if(!N)return null;0!=f&&(h/=Math.pow(2,f),v/=Math.pow(2,f),h=Math.round(h),v=Math.round(v));try{return this._texture.isCube?N._readTexturePixelsSync(this._texture,h,v,O,f,y,S,H):N._readTexturePixelsSync(this._texture,h,v,-1,f,y,S,H)}catch(m){return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const O=this._scene.textures.indexOf(this);if(O>=0&&this._scene.textures.splice(O,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const O=this._parentContainer.textures.indexOf(this);O>-1&&this._parentContainer.textures.splice(O,1),this._parentContainer=null}}this.hj.notifyObservers(this),this.hj.clear(),this.metadata=null,super.dispose()}serialize(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.name&&!O)return null;const f=q.b.Serialize(this);return q.b.AppendSerializedAnimations(this,f),f}static WhenAllReady(O,f){let y=O.length;if(0!==y)for(let S=0;S<O.length;S++){const H=O[S];if(H.isReady())0===--y&&f();else{const O=H.onLoadObservable;O?O.addOnce((()=>{0===--y&&f()})):0===--y&&f()}}else f()}static _IsScene(O){return"Scene"===O.getClassName()}}F.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,S.b)([(0,H.L)()],F.prototype,"uniqueId",void 0),(0,S.b)([(0,H.L)()],F.prototype,"name",void 0),(0,S.b)([(0,H.L)()],F.prototype,"metadata",void 0),(0,S.b)([(0,H.L)("ke")],F.prototype,"_hasAlpha",void 0),(0,S.b)([(0,H.L)("getAlphaFromRGB")],F.prototype,"_getAlphaFromRGB",void 0),(0,S.b)([(0,H.L)()],F.prototype,"level",void 0),(0,S.b)([(0,H.L)("coordinatesIndex")],F.prototype,"_coordinatesIndex",void 0),(0,S.b)([(0,H.L)()],F.prototype,"optimizeUVAllocation",void 0),(0,S.b)([(0,H.L)("coordinatesMode")],F.prototype,"_coordinatesMode",void 0),(0,S.b)([(0,H.L)()],F.prototype,"wrapU",null),(0,S.b)([(0,H.L)()],F.prototype,"wrapV",null),(0,S.b)([(0,H.L)()],F.prototype,"wrapR",void 0),(0,S.b)([(0,H.L)()],F.prototype,"anisotropicFilteringLevel",void 0),(0,S.b)([(0,H.L)()],F.prototype,"isCube",null),(0,S.b)([(0,H.L)()],F.prototype,"is3D",null),(0,S.b)([(0,H.L)()],F.prototype,"is2DArray",null),(0,S.b)([(0,H.L)()],F.prototype,"gammaSpace",null),(0,S.b)([(0,H.L)()],F.prototype,"invertZ",void 0),(0,S.b)([(0,H.L)()],F.prototype,"lodLevelInAlpha",void 0),(0,S.b)([(0,H.L)()],F.prototype,"lodGenerationOffset",null),(0,S.b)([(0,H.L)()],F.prototype,"lodGenerationScale",null),(0,S.b)([(0,H.L)()],F.prototype,"linearSpecularLOD",null),(0,S.b)([(0,H.C)()],F.prototype,"irradianceTexture",null),(0,S.b)([(0,H.L)()],F.prototype,"isRenderTarget",void 0)},12237:(O,f,y)=>{"use strict";var S=y(11793),H=y(11513);H.d.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(H.d.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=S.c.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((O=>{this._texture._sphericalPolynomial=O,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(O){this._texture&&(this._texture._sphericalPolynomial=O)},enumerable:!0,configurable:!0})},12271:(O,f,y)=>{"use strict";y.d(f,{c:()=>F});var S=y(11289),H=y(11294),b=y(10995),h=y(11324),v=y(11513),N=y(11509),m=y(11153),t=y(11004),q=y(11362);y(11828);class F extends v.d{set boundingBoxSize(O){if(this._boundingBoxSize&&this._boundingBoxSize.equals(O))return;this._boundingBoxSize=O;const f=this.va();f&&f.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(O){this._rotationY=O,this.setReflectionTextureMatrix(h.b.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(O,f,y){let S="";return O.forEach((O=>S+=O)),new F(S,f,null,y,O)}static CreateFromPrefilteredData(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const H=f.useDelayedTextureLoading;f.useDelayedTextureLoading=!1;const b=new F(O,f,null,!1,null,null,null,void 0,!0,y,S);return f.useDelayedTextureLoading=H,b}constructor(O,f){var y;let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,H=arguments.length>3&&void 0!==arguments[3]&&arguments[3],b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,v=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,F=arguments.length>8&&void 0!==arguments[8]&&arguments[8],I=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,A=arguments.length>10&&void 0!==arguments[10]&&arguments[10],J=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,X=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,w=arguments.length>13?arguments[13]:void 0,B=arguments.length>14?arguments[14]:void 0;super(f),this.onLoadObservable=new t.d,this.boundingBoxPosition=h.m.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new h.b,this._buffer=null,this.name=O,this.url=O,this._noMipmap=H,this.ke=!1,this.isCube=!0,this._textureMatrix=h.b.Identity(),this.coordinatesMode=N.e.CUBIC_MODE;let j=null,u=null;null===S||Array.isArray(S)?(this._noMipmap=H,this._format=q,this._createPolynomials=A,j=S,this._loaderOptions=w,this._useSRGBBuffer=B,this._lodScale=J,this._lodOffset=X):(j=S.extensions??null,this._noMipmap=S.noMipmap??!1,b=S.files??null,u=S.buffer??null,this._format=S.format??5,F=S.prefiltered??!1,I=S.forcedExtension??null,this._createPolynomials=S.createPolynomials??!1,this._lodScale=S.lodScale??.8,this._lodOffset=S.lodOffset??0,this._loaderOptions=S.loaderOptions,this._useSRGBBuffer=S.useSRGBBuffer,v=S.X??null,m=S.onError??null),(O||b)&&this.updateURL(O,I,v,F,m,j,null===(y=this.va())||void 0===y?void 0:y.useDelayedTextureLoading,b,u)}getClassName(){return"CubeTexture"}updateURL(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,h=arguments.length>6&&void 0!==arguments[6]&&arguments[6],v=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,N=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=O),this.url=O,f&&(this._forcedExtension=f);const m=O.lastIndexOf("."),t=f||(m>-1?O.substring(m).toLowerCase():""),q=0===t.indexOf(".dds"),F=0===t.indexOf(".env"),I=0===t.indexOf(".basis");if(F?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=S,S&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),v)this._files=v;else if(I||F||q||b||(b=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,b){for(let f=0;f<b.length;f++)this._files.push(O+b[f]);this._extensions=b}this._buffer=N,h?(this.delayLoadState=4,this._delayedOnLoad=y,this._delayedOnError=H):this._loadTexture(y,H)}delayLoad(O){4===this.delayLoadState&&(O&&(this._forcedExtension=O),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(O){var f,y;if(O.updateFlag===this._textureMatrix.updateFlag)return;O.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(y=this.va())||void 0===y||y.markAllMaterialsAsDirty(1,(O=>-1!==O.getActiveTextures().indexOf(this))));if(this._textureMatrix=O,null===(f=this.va())||void 0===f||!f.useRightHandedSystem)return;const S=h.g.fb[0],H=h.g.Quaternion[0],b=h.g.fb[1];this._textureMatrix.decompose(S,H,b),H.z*=-1,H.w*=-1,h.b.ComposeToRef(S,H,b,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var O;return null!==(O=this.va())&&void 0!==O&&O.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const y=this.va(),S=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const H=()=>{var f;(this.onLoadObservable.notifyObservers(this),S)&&(S.dispose(),null===(f=this.va())||void 0===f||f.markAllMaterialsAsDirty(1));O&&O()},h=(O,y)=>{this._loadingError=!0,this._errorObject={message:O,exception:y},f&&f(O,y),N.e.OnTextureLoadErrorObservable.notifyObservers(this)};var v;this._texture?this._texture.isReady?b.d.SetImmediate((()=>H())):this._texture.onLoadedObservable.add((()=>H())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,y,this._lodScale,this._lodOffset,O,h,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,y,this._files,this._noMipmap,O,h,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(v=this._texture)||void 0===v||v.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(O,f,y){const S=q.b.Parse((()=>{let S=!1;return O.prefiltered&&(S=O.prefiltered),new F(y+(O.url??O.name),f,O.extensions,!1,O.files||null,null,null,void 0,S,O.forcedExtension)}),O,f);if(O.boundingBoxPosition&&(S.boundingBoxPosition=h.m.Ng(O.boundingBoxPosition)),O.boundingBoxSize&&(S.boundingBoxSize=h.m.Ng(O.boundingBoxSize)),O.animations)for(let H=0;H<O.animations.length;H++){const f=O.animations[H],y=(0,m.c)("BABYLON.Animation");y&&S.animations.push(y.Parse(f))}return S}clone(){let O=0;const f=q.b.Clone((()=>{const f=new F(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return O=f.uniqueId,f}),this);return f.uniqueId=O,f}}(0,S.b)([(0,H.L)()],F.prototype,"url",void 0),(0,S.b)([(0,H.J)()],F.prototype,"boundingBoxPosition",void 0),(0,S.b)([(0,H.J)()],F.prototype,"boundingBoxSize",null),(0,S.b)([(0,H.L)("rotationY")],F.prototype,"rotationY",null),(0,S.b)([(0,H.L)("files")],F.prototype,"_files",void 0),(0,S.b)([(0,H.L)("forcedExtension")],F.prototype,"_forcedExtension",void 0),(0,S.b)([(0,H.L)("extensions")],F.prototype,"_extensions",void 0),(0,S.b)([(0,H.s)("textureMatrix")],F.prototype,"_textureMatrix",void 0),(0,S.b)([(0,H.s)("textureMatrixRefraction")],F.prototype,"_textureMatrixRefraction",void 0),N.e._CubeTextureParser=F.Parse,(0,m.g)("BABYLON.CubeTexture",F)},12652:(O,f,y)=>{"use strict";y.d(f,{d:()=>N});var S=y(11017),H=y(11509),b=y(11161),h=y(11712),v=y(11126);h.ThinEngine.prototype.createDynamicTexture=function(O,f,y,S){const H=new v.c(this,4);return H.baseWidth=O,H.baseHeight=f,y&&(O=this.needPOTTextures?(0,b.h)(O,this._caps.maxTextureSize):O,f=this.needPOTTextures?(0,b.h)(f,this._caps.maxTextureSize):f),H.width=O,H.height=f,H.isReady=!1,H.generateMipMaps=y,H.samplingMode=S,this.updateTextureSamplingMode(S,H),this._internalTexturesCache.push(H),H},h.ThinEngine.prototype.updateDynamicTexture=function(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],H=arguments.length>4?arguments[4]:void 0,b=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!O)return;const h=this._gl,v=h.TEXTURE_2D,N=this._bindTextureDirectly(v,O,!0,b);this._unpackFlipY(void 0===y?O.invertY:y),S&&h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const m=this._getWebGLTextureType(O.type),t=this._getInternalFormat(H||O.format),q=this._getRGBABufferInternalSizedFormat(O.type,t);h.texImage2D(v,0,q,t,m,f),O.generateMipMaps&&h.generateMipmap(v),N||this._bindTextureDirectly(v,null),S&&h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),H&&(O.format=H),O._dynamicTextureSource=f,O._premulAlpha=S,O.invertY=y||!1,O.isReady=!0};class N extends H.e{constructor(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,v=arguments.length>6?arguments[6]:void 0;const N=!y||y._isScene;super(null,N?y:null===y||void 0===y?void 0:y.yd,N?!S:y,v,b,void 0,void 0,void 0,void 0,h),this.name=O,this.wrapU=H.e.CLAMP_ADDRESSMODE,this.wrapV=H.e.CLAMP_ADDRESSMODE,this._generateMipMaps=S;const m=this._getEngine();if(!m)return;if(f.getContext)this._canvas=f,this._ownCanvas=!1,this._texture=m.createDynamicTexture(this._canvas.width,this._canvas.height,S,b);else{this._canvas=m.createCanvas(1,1),this._ownCanvas=!0;const O=f;O.width||0===O.width?this._texture=m.createDynamicTexture(O.width,O.height,S,b):this._texture=m.createDynamicTexture(f,f,S,b)}const t=this.getSize();this._canvas.width!==t.width&&(this._canvas.width=t.width),this._canvas.height!==t.height&&(this._canvas.height=t.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(O){this._canvas.width=O.width,this._canvas.height=O.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(O.width,O.height,this._generateMipMaps,this.samplingMode)}scale(O){const f=this.getSize();f.width*=O,f.height*=O,this._recreate(f)}scaleTo(O,f){const y=this.getSize();y.width=O,y.height=f,this._recreate(y)}getContext(){return this._context}clear(O){const f=this.getSize();O&&(this._context.fillStyle=O),this._context.clearRect(0,0,f.width,f.height)}update(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===O||O,f,this._format||void 0,void 0,y)}drawText(O,f,y,S,H,b,h){let v=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const N=this.getSize();if(b&&(this._context.fillStyle=b,this._context.fillRect(0,0,N.width,N.height)),this._context.font=S,null===f||void 0===f){const y=this._context.measureText(O);f=(N.width-y.width)/2}if(null===y||void 0===y){const O=parseInt(S.replace(/\D/g,""));y=N.height/2+O/3.65}this._context.fillStyle=H||"",this._context.fillText(O,f,y),v&&this.update(h)}dispose(){var O,f;(super.dispose(),this._ownCanvas)&&(null===(O=this._canvas)||void 0===O||null===(f=O.remove)||void 0===f||f.call(O));this._canvas=null,this._context=null}clone(){const O=this.va();if(!O)return this;const f=this.getSize(),y=new N(this.name,f,O,this._generateMipMaps);return y.ke=this.ke,y.level=this.level,y.wrapU=this.wrapU,y.wrapV=this.wrapV,y}serialize(){const O=this.va();O&&!O.isReady()&&S.e.Warn("The scene must be ready before serializing the dynamic texture");const f=super.serialize();return N._IsCanvasElement(this._canvas)&&(f.base64String=this._canvas.toDataURL()),f.invertY=this._invertY,f.samplingMode=this.samplingMode,f}static _IsCanvasElement(O){return void 0!==O.toDataURL}_rebuild(){this.update()}}},11126:(O,f,y)=>{"use strict";y.d(f,{c:()=>h});var S,H=y(11004),b=y(11134);!function(O){O[O.Unknown=0]="Unknown",O[O.Url=1]="Url",O[O.Temp=2]="Temp",O[O.Raw=3]="Raw",O[O.Dynamic=4]="Dynamic",O[O.RenderTarget=5]="RenderTarget",O[O.MultiRenderTarget=6]="MultiRenderTarget",O[O.Cube=7]="Cube",O[O.CubeRaw=8]="CubeRaw",O[O.CubePrefiltered=9]="CubePrefiltered",O[O.Raw3D=10]="Raw3D",O[O.Raw2DArray=11]="Raw2DArray",O[O.DepthStencil=12]="DepthStencil",O[O.CubeRawRGBD=13]="CubeRawRGBD",O[O.Depth=14]="Depth"}(S||(S={}));class h extends b.d{get useMipMaps(){return this.generateMipMaps}set useMipMaps(O){this.generateMipMaps=O}get uniqueId(){return this._uniqueId}_setUniqueId(O){this._uniqueId=O}getEngine(){return this._engine}get source(){return this._source}constructor(O,f){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new H.d,this.onErrorObservable=new H.d,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._engine=O,this._source=f,this._uniqueId=h._Counter++,y||(this._hardwareTexture=O._createHardwareTexture())}incrementReferences(){this._references++}updateSize(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._engine.updateTextureDimensions(this,O,f,y),this.width=O,this.height=f,this.depth=y,this.baseWidth=O,this.baseHeight=f,this.baseDepth=y,this._size=O*f*y}_rebuild(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const O=this.onRebuildCallback(this),f=f=>{f._swapAndDie(this,!1),this.isReady=O.isReady};return void(O.isAsync?O.proxy.then(f):f(O.proxy))}let O;switch(this.source){case 2:case 12:case 14:break;case 1:return void(O=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(O=>{O._swapAndDie(this,!1),this.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case 3:O=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),O._swapAndDie(this,!1),this.isReady=!0;break;case 10:O=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),O._swapAndDie(this,!1),this.isReady=!0;break;case 11:O=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),O._swapAndDie(this,!1),this.isReady=!0;break;case 4:O=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),O._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:return void(O=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(()=>{O._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null));case 8:O=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),O._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:return O=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(O=>{O&&O._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension),void(O._sphericalPolynomial=this._sphericalPolynomial)}}_swapAndDie(O){var f;let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null===(f=this._hardwareTexture)||void 0===f||f.setUsage(O._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),O._hardwareTexture=this._hardwareTexture,y&&(O._isRGBD=this._isRGBD),this._lodTextureHigh&&(O._lodTextureHigh&&O._lodTextureHigh.dispose(),O._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(O._lodTextureMid&&O._lodTextureMid.dispose(),O._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(O._lodTextureLow&&O._lodTextureLow.dispose(),O._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(O._irradianceTexture&&O._irradianceTexture.dispose(),O._irradianceTexture=this._irradianceTexture);const S=this._engine.getLoadedTexturesCache();let H=S.indexOf(this);-1!==H&&S.splice(H,1),H=S.indexOf(O),-1===H&&S.push(O)}dispose(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),0===this._references&&(this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}}h._Counter=0},11744:(O,f,y)=>{"use strict";y.d(f,{c:()=>H});var S=y(11509);class H extends S.e{constructor(O,f,y,H,b){let h=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],v=arguments.length>6&&void 0!==arguments[6]&&arguments[6],N=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,m=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,t=arguments.length>9?arguments[9]:void 0,q=arguments.length>10?arguments[10]:void 0;super(null,b,!h,v,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,t),this.format=H,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==m||(N=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==m||(N=1),this._texture=this._engine.createRawTexture(O,f,y,H,h,v,N,null,m,t??0,q??!1),this.wrapU=S.e.CLAMP_ADDRESSMODE,this.wrapV=S.e.CLAMP_ADDRESSMODE)}update(O){this._getEngine().updateRawTexture(this._texture,O,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)}clone(){if(!this._texture)return super.clone();const O=new H(null,this.getSize().width,this.getSize().height,this.format,this.va(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return O._texture=this._texture,this._texture.incrementReferences(),O}static CreateLuminanceTexture(O,f,y,S){return new H(O,f,y,1,S,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(O,f,y,S){return new H(O,f,y,2,S,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(O,f,y,S){return new H(O,f,y,0,S,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(O,f,y,S){return new H(O,f,y,4,S,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(O,f,y,S){return new H(O,f,y,5,S,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBAStorageTexture(O,f,y,S){return new H(O,f,y,5,S,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(O,f,y,b){let h=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],v=arguments.length>5&&void 0!==arguments[5]&&arguments[5],N=arguments.length>6&&void 0!==arguments[6]?arguments[6]:S.e.TRILINEAR_SAMPLINGMODE;return new H(O,f,y,6,b,h,v,N,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(O,f,y,b){let h=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],v=arguments.length>5&&void 0!==arguments[5]&&arguments[5],N=arguments.length>6&&void 0!==arguments[6]?arguments[6]:S.e.TRILINEAR_SAMPLINGMODE;return new H(O,f,y,6,b,h,v,N,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},12099:(O,f,y)=>{"use strict";y.d(f,{d:()=>H});var S=y(11509);class H extends S.e{get depth(){return this._depth}constructor(O,f,y,H,b,h){let v=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],N=arguments.length>7&&void 0!==arguments[7]&&arguments[7],m=arguments.length>8&&void 0!==arguments[8]?arguments[8]:S.e.TRILINEAR_SAMPLINGMODE,t=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,q=arguments.length>10?arguments[10]:void 0;super(null,h,!v,N),this.format=b,this._texture=h.getEngine().createRawTexture2DArray(O,f,y,H,b,v,N,m,null,t,q),this._depth=H,this.is2DArray=!0}update(O){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,O,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(O,f,y,S,b){return new H(O,f,y,S,5,b,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},11803:(O,f,y)=>{"use strict";y.d(f,{d:()=>F});var S=y(11004),H=y(11324),b=y(11509),h=y(11398),v=y(11400),N=y(11338),m=y(11161),t=y(11098),q=y(11017);t.b.prototype.setDepthStencilTexture=function(O,f){this._engine.setDepthStencilTexture(this._samplers[O],this._uniforms[O],f,O)};class F extends b.e{get renderList(){return this._renderList}set renderList(O){this._renderList!==O&&(this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),O&&(this._unObserveRenderList=(0,N.i)(O,this._renderListHasChanged)),this._renderList=O)}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(O){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(O)}set onBeforeRender(O){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(O)}set onAfterRender(O){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(O)}set onClear(O){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(O)}get renderPassIds(){return this._renderPassIds}get currentRefreshId(){return this._currentRefreshId}setMaterialForRendering(O,f){let y;y=Array.isArray(O)?O:[O];for(let S=0;S<y.length;++S)for(let O=0;O<this._renderPassIds.length;++O)y[S].setMaterialForRenderPass(this._renderPassIds[O],void 0!==f?Array.isArray(f)?f[O]:f:void 0)}get isMulti(){var O;return(null===(O=this._renderTarget)||void 0===O?void 0:O.isMulti)??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(O){if(this._boundingBoxSize&&this._boundingBoxSize.equals(O))return;this._boundingBoxSize=O;const f=this.va();f&&f.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){var O;return(null===(O=this._renderTarget)||void 0===O?void 0:O._depthStencilTexture)??null}constructor(O,f,y){let h,N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],m=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:b.e.TRILINEAR_SAMPLINGMODE,I=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],A=arguments.length>9&&void 0!==arguments[9]&&arguments[9],J=arguments.length>10&&void 0!==arguments[10]&&arguments[10],X=arguments.length>11&&void 0!==arguments[11]?arguments[11]:5,w=arguments.length>12&&void 0!==arguments[12]&&arguments[12],B=arguments.length>13?arguments[13]:void 0,j=arguments.length>14?arguments[14]:void 0,u=arguments.length>15&&void 0!==arguments[15]&&arguments[15],L=arguments.length>16&&void 0!==arguments[16]&&arguments[16],p=!0;if("object"===typeof N){const O=N;N=!!O.generateMipMaps,m=O.doNotChangeAspectRatio??!0,t=O.type??0,q=!!O.isCube,F=O.samplingMode??b.e.TRILINEAR_SAMPLINGMODE,I=O.generateDepthBuffer??!0,A=!!O.generateStencilBuffer,J=!!O.isMulti,X=O.format??5,w=!!O.delayAllocation,B=O.samples,j=O.creationFlags,u=!!O.noColorAttachment,L=!!O.useSRGBBuffer,h=O.colorAttachment,p=O.gammaSpace??p}if(super(null,y,!N,void 0,F,void 0,void 0,void 0,void 0,X),this._unObserveRenderList=null,this._renderListHasChanged=(O,f)=>{const y=this._renderList?this._renderList.length:0;var S;(0===f&&y>0||0===y)&&(null===(S=this.va())||void 0===S||S.meshes.forEach((O=>{O._markSubMeshesAsLightDirty()})))},this.particleSystemList=null,this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new S.d,this.onAfterUnbindObservable=new S.d,this.onBeforeRenderObservable=new S.d,this.onAfterRenderObservable=new S.d,this.onClearObservable=new S.d,this.onResizeObservable=new S.d,this._cleared=!1,this.skipInitialClear=!1,this._currentRefreshId=-1,this._refreshRate=1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this.boundingBoxPosition=H.m.Zero(),this._dumpToolsLoading=!1,!(y=this.va()))return;const U=this.va().getEngine();this._gammaSpace=p,this._coordinatesMode=b.e.PROJECTION_MODE,this.renderList=[],this.name=O,this.isRenderTarget=!0,this._initialSizeParameter=f,this._renderPassIds=[],this._isCubeData=q,this._processSizeParameter(f),this.renderPassId=this._renderPassIds[0],this._resizeObserver=U.onResizeObservable.add((()=>{})),this._generateMipMaps=!!N,this._doNotChangeAspectRatio=m,this._renderingManager=new v.d(y),this._renderingManager._useSceneAutoClearSetup=!0,J||(this._renderTargetOptions={generateMipMaps:N,type:t,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:I,generateStencilBuffer:A,samples:B,creationFlags:j,noColorAttachment:u,useSRGBBuffer:L,colorAttachment:h,label:this.name},this.samplingMode===b.e.NEAREST_SAMPLINGMODE&&(this.wrapU=b.e.CLAMP_ADDRESSMODE,this.wrapV=b.e.CLAMP_ADDRESSMODE),w||(q?(this._renderTarget=y.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=b.e.INVCUBIC_MODE,this._textureMatrix=H.b.Identity()):this._renderTarget=y.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==B&&(this.samples=B)))}createDepthStencilTexture(){var O;let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],S=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,h=arguments.length>5?arguments[5]:void 0;null===(O=this._renderTarget)||void 0===O||O.createDepthStencilTexture(f,y,S,H,b,h)}_releaseRenderPassId(){if(this._scene){const O=this._scene.getEngine();for(let f=0;f<this._renderPassIds.length;++f)O.releaseRenderPassId(this._renderPassIds[f])}this._renderPassIds=[]}_createRenderPassId(){this._releaseRenderPassId();const O=this._scene.getEngine(),f=this._isCubeData?6:this.getRenderLayers()||1;for(let y=0;y<f;++y)this._renderPassIds[y]=O.createRenderPassId(`RenderTargetTexture - ${this.name}#${y}`)}_processSizeParameter(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(O.ratio){this._sizeRatio=O.ratio;const f=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(f.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(f.getRenderHeight(),this._sizeRatio)}}else this._size=O;f&&this._createRenderPassId()}get samples(){var O;return(null===(O=this._renderTarget)||void 0===O?void 0:O.samples)??this._samples}set samples(O){this._renderTarget&&(this._samples=this._renderTarget.setSamples(O))}resetRefreshCounter(){this._currentRefreshId=-1}get refreshRate(){return this._refreshRate}set refreshRate(O){this._refreshRate=O,this.resetRefreshCounter()}addPostProcess(O){if(!this._postProcessManager){const O=this.va();if(!O)return;this._postProcessManager=new h.e(O),this._postProcesses=new Array}this._postProcesses.push(O),this._postProcesses[0].Ri=!1}clearPostProcesses(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._postProcesses){if(O)for(const O of this._postProcesses)O.dispose();this._postProcesses=[]}}removePostProcess(O){if(!this._postProcesses)return;const f=this._postProcesses.indexOf(O);-1!==f&&(this._postProcesses.splice(f,1),this._postProcesses.length>0&&(this._postProcesses[0].Ri=!1))}_shouldRender(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){const O=this._size.layers;if(O)return O;const f=this._size.depth;return f||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(O){const f=Math.max(1,this.getRenderSize()*O);this.resize(f)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(O){var f;const y=this.isCube;null===(f=this._renderTarget)||void 0===f||f.dispose(),this._renderTarget=null;const S=this.va();S&&(this._processSizeParameter(O,!1),this._renderTarget=y?S.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):S.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._render(O,f)}isReadyForRendering(){return this._dumpToolsLoading||(this._dumpToolsLoading=!0,Promise.resolve().then(y.bind(y,12263)).then((O=>this._dumpTools=O))),this._render(!1,!1,!0)}_render(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S=this.va();if(!S)return y;const H=S.getEngine();if(void 0!==this.useCameraPostProcesses&&(O=this.useCameraPostProcesses),this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(let O=0;O<this._waitingRenderList.length;O++){const f=this._waitingRenderList[O],y=S.getMeshById(f);y&&this.renderList.push(y)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];const O=this.va();if(!O)return y;const f=O.meshes;for(let y=0;y<f.length;y++){const O=f[y];this.renderListPredicate(O)&&this.renderList.push(O)}}const b=H.currentRenderPassId;this.onBeforeBindObservable.notifyObservers(this);const h=this.activeCamera??S.activeCamera,v=S.activeCamera;h&&(h!==S.activeCamera&&(S.setTransformMatrix(h.getViewMatrix(),h.getProjectionMatrix(!0)),S.activeCamera=h),H.setViewport(h.rigParent?h.rigParent.viewport:h.viewport,this.getRenderWidth(),this.getRenderHeight())),this._defaultRenderListPrepared=!1;let N=y;if(y){S.getViewMatrix()||S.updateTransformMatrix();const O=this.is2DArray||this.is3D?this.getRenderLayers():this.isCube?6:1;for(let b=0;b<O&&N;b++){let O=null;const f=this.renderList?this.renderList:S.getActiveMeshes().data,h=this.renderList?this.renderList.length:S.getActiveMeshes().length;H.currentRenderPassId=this._renderPassIds[b],this.onBeforeRenderObservable.notifyObservers(b),this.getCustomRenderList&&(O=this.getCustomRenderList(b,f,h)),O||(O=f),this._doNotChangeAspectRatio||S.updateTransformMatrix(!0);for(let S=0;S<O.length&&N;++S){const f=O[S];if(f.isEnabled()&&!f.isBlocked&&f.isVisible&&f.Yf)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(f,this.refreshRate,y)){N=!1;continue}}else if(!f.isReady(!0)){N=!1;continue}}this.onAfterRenderObservable.notifyObservers(b),(this.is2DArray||this.is3D||this.isCube)&&(S.incrementRenderId(),S.resetCachedMaterial())}const f=this.particleSystemList||S.oj;for(const y of f)y.isReady()||(N=!1)}else if(!this.is2DArray&&!this.is3D||this.isMulti)if(this.isCube&&!this.isMulti)for(let m=0;m<6;m++)this._renderToTarget(m,O,f,void 0,h),S.incrementRenderId(),S.resetCachedMaterial();else this._renderToTarget(0,O,f,void 0,h);else for(let m=0;m<this.getRenderLayers();m++)this._renderToTarget(0,O,f,m,h),S.incrementRenderId(),S.resetCachedMaterial();return this.onAfterUnbindObservable.notifyObservers(this),H.currentRenderPassId=b,S.activeCamera=v,v&&(this.activeCamera&&this.activeCamera!==S.activeCamera&&S.setTransformMatrix(v.getViewMatrix(),v.getProjectionMatrix(!0)),H.setViewport(v.viewport)),S.resetCachedMaterial(),N}_bestReflectionRenderTargetDimension(O,f){const y=O*f,S=(0,m.o)(y+16384/(128+y));return Math.min((0,m.d)(O),S)}_prepareRenderingManager(O,f,y,S){const H=this.va();if(!H)return;this._renderingManager.reset();const b=H.getRenderId();for(let v=0;v<f;v++){const f=O[v];if(f&&!f.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(f,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!f.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}if(!f._internalAbstractMeshDataInfo._currentLODIsUpToDate&&y&&(f._internalAbstractMeshDataInfo._currentLOD=H.customLODSelector?H.customLODSelector(f,y):f.getLOD(y),f._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!f._internalAbstractMeshDataInfo._currentLOD)continue;let O,h=f._internalAbstractMeshDataInfo._currentLOD;if(h!==f&&0!==h.billboardMode&&h.Mj(),h._preActivateForIntermediateRendering(b),O=!(!S||!y)&&0===(f.layerMask&y.layerMask),f.isEnabled()&&f.isVisible&&f.Yf&&!O){if(h!==f&&h._activate(b,!0),f._activate(b,!0)&&f.Yf.length){f.isAnInstance?f._internalAbstractMeshDataInfo._actAsRegularMesh&&(h=f):h._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,h._internalAbstractMeshDataInfo._isActiveIntermediate=!0,H._prepareSkeleton(h);for(let O=0;O<h.Yf.length;O++){const f=h.Yf[O];this._renderingManager.dispatch(f,h)}}f._postActivate()}}}const h=this.particleSystemList||H.oj;for(let v=0;v<h.length;v++){const O=h[v],f=O.j;O.isStarted()&&f&&(!f.position||f.isEnabled())&&this._renderingManager.dispatchParticles(O)}}_bindFrameBuffer(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const y=this.va();if(!y)return;const S=y.getEngine();this._renderTarget&&S.bindFramebuffer(this._renderTarget,this.isCube?O:void 0,void 0,void 0,this.ignoreCameraViewport,0,f)}_unbindFrameBuffer(O,f){this._renderTarget&&O.unBindFramebuffer(this._renderTarget,this.isCube,(()=>{this.onAfterRenderObservable.notifyObservers(f)}))}_prepareFrame(O,f,y,S){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses):S&&O.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(f,y)}_renderToTarget(O,f,y){var S,H;let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const v=this.va();if(!v)return;const N=v.getEngine();this._prepareFrame(v,O,b,f),null===(S=N._debugPushGroup)||void 0===S||S.call(N,`render to face #${O} layer #${b}`,2),this.is2DArray||this.is3D?(N.currentRenderPassId=this._renderPassIds[b],this.onBeforeRenderObservable.notifyObservers(b)):(N.currentRenderPassId=this._renderPassIds[O],this.onBeforeRenderObservable.notifyObservers(O));if(N.snapshotRendering&&1===N.snapshotRenderingMode)this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(N):this.skipInitialClear||N.clear(this.clearColor||v.clearColor,!0,!0,!0);else{var m;let S=null;const H=this.renderList?this.renderList:v.getActiveMeshes().data,t=this.renderList?this.renderList.length:v.getActiveMeshes().length;this.getCustomRenderList&&(S=this.getCustomRenderList(this.is2DArray||this.is3D?b:O,H,t)),S?this._prepareRenderingManager(S,S.length,h,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(H,t,h,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),S=H);for(const f of v._beforeRenderTargetClearStage)f.action(this,O,b);this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(N):this.skipInitialClear||N.clear(this.clearColor||v.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||v.updateTransformMatrix(!0);for(const f of v._beforeRenderTargetDrawStage)f.action(this,O,b);this._renderingManager.render(this.customRenderFunction,S,this.renderParticles,this.renderSprites);for(const f of v._afterRenderTargetDrawStage)f.action(this,O,b);const F=(null===(m=this._texture)||void 0===m?void 0:m.generateMipMaps)??!1;this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,O,this._postProcesses,this.ignoreCameraViewport):f&&v.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,O);for(const f of v._afterRenderTargetPostProcessStage)f.action(this,O,b);this._texture&&(this._texture.generateMipMaps=F),this._doNotChangeAspectRatio||v.updateTransformMatrix(!0),y&&(this._dumpTools?this._dumpTools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),N):q.e.Error("dumpTools module is still being loaded. To speed up the process import dump tools directly in your project"))}null===(H=N._debugPopGroup)||void 0===H||H.call(N,2),this._unbindFrameBuffer(N,O),this._texture&&this.isCube&&5===O&&N.generateMipMapsForCubemap(this._texture,!0)}setRenderingOrder(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(O,f,y,S)}setRenderingAutoClearDepthStencil(O,f){this._renderingManager.setRenderingAutoClearDepthStencil(O,f),this._renderingManager._useSceneAutoClearSetup=!1}clone(){const O=this.getSize(),f=new F(this.name,O,this.va(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return f.ke=this.ke,f.level=this.level,f.coordinatesMode=this.coordinatesMode,this.renderList&&(f.renderList=this.renderList.slice(0)),f}serialize(){if(!this.name)return null;const O=super.serialize();if(O.renderTargetSize=this.getRenderSize(),O.renderList=[],this.renderList)for(let f=0;f<this.renderList.length;f++)O.renderList.push(this.renderList[f].id);return O}disposeFramebufferObjects(){var O;null===(O=this._renderTarget)||void 0===O||O.dispose(!0)}releaseInternalTexture(){var O;null===(O=this._renderTarget)||void 0===O||O.releaseTextures(),this._texture=null}dispose(){var O;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._releaseRenderPassId(),this.clearPostProcesses(!0),this._resizeObserver&&(this.va().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;const f=this.va();if(!f)return;let y=f.customRenderTargets.indexOf(this);y>=0&&f.customRenderTargets.splice(y,1);for(const S of f.cameras)y=S.customRenderTargets.indexOf(this),y>=0&&S.customRenderTargets.splice(y,1);null===(O=this._renderTarget)||void 0===O||O.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this.refreshRate===F.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=F.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}getViewCount(){return 1}}F.REFRESHRATE_RENDER_ONCE=0,F.REFRESHRATE_RENDER_ONEVERYFRAME=1,F.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,b.e._CreateRenderTargetTexture=(O,f,y,S,H)=>new F(O,f,y,S)},11509:(O,f,y)=>{"use strict";y.d(f,{e:()=>j});var S=y(11289),H=y(11294),b=y(11004),h=y(11324),v=y(11513),N=y(11153),m=y(11030),t=y(11085),q=y(11145),F=y(11434),I=y(11063);function A(O,f){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S=f.width,H=f.height;if(O instanceof Float32Array){let f=O.byteLength/O.BYTES_PER_ELEMENT;const y=new Uint8Array(f);for(;--f>=0;){let S=O[f];S<0?S=0:S>1&&(S=1),y[f]=255*S}O=y}const b=document.createElement("canvas");b.width=S,b.height=H;const h=b.getContext("2d");if(!h)return null;const v=h.createImageData(S,H);if(v.data.set(O),h.putImageData(v,0,0),y){const O=document.createElement("canvas");O.width=S,O.height=H;const f=O.getContext("2d");return f?(f.translate(0,H),f.scale(1,-1),f.drawImage(b,0,0),O.toDataURL("image/png")):null}return b.toDataURL("image/png")}function J(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const S=O.getInternalTexture();if(!S)return null;const H=O._readPixelsSync(f,y);return H?A(H,O.getSize(),S.invertY):null}async function X(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const S=O.getInternalTexture();if(!S)return null;const H=await O.readPixels(f,y);return H?A(H,O.getSize(),S.invertY):null}var w=y(11526),B=y(11362);class j extends v.d{static _CreateVideoTexture(O,f,y){arguments.length>5&&void 0!==arguments[5]||j.TRILINEAR_SAMPLINGMODE;throw(0,m.d)("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(O){this._isBlocking=O}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(O,f,y,S){let H,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:j.TRILINEAR_SAMPLINGMODE,v=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,N=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,m=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,q=arguments.length>8&&void 0!==arguments[8]&&arguments[8],F=arguments.length>9?arguments[9]:void 0,I=arguments.length>10?arguments[10]:void 0,A=arguments.length>11?arguments[11]:void 0,J=arguments.length>12?arguments[12]:void 0,X=arguments.length>13?arguments[13]:void 0;super(f),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new b.d,this._isBlocking=!0,this.name=O||"",this.url=O;let B=!1,u=null,L=!0;"object"===typeof y&&null!==y?(H=y.noMipmap??!1,S=y.invertY??!w.b,h=y.samplingMode??j.TRILINEAR_SAMPLINGMODE,v=y.X??null,N=y.onError??null,m=y.buffer??null,q=y.deleteBuffer??!1,F=y.format,I=y.mimeType,A=y.loaderOptions,J=y.creationFlags,B=y.useSRGBBuffer??!1,u=y.internalTexture??null,L=y.gammaSpace??L):H=!!y,this._gammaSpace=L,this._noMipmap=H,this._invertY=void 0===S?!w.b:S,this._initialSamplingMode=h,this._buffer=m,this._deleteBuffer=q,this._mimeType=I,this._loaderOptions=A,this._creationFlags=J,this._useSRGBBuffer=B,this._forcedExtension=X,F&&(this._format=F);const p=this.va(),U=this._getEngine();if(!U)return;U.onBeforeTextureInitObservable.notifyObservers(this);const l=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),v&&v(),!this.isBlocking&&p&&p.resetCachedMaterial()},x=(O,f)=>{this._loadingError=!0,this._errorObject={message:O,exception:f},N&&N(O,f),j.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!u)return this._delayedOnLoad=l,void(this._delayedOnError=x);if(this._texture=u??this._getFromCache(this.url,H,h,this._invertY,B,this.isCube),this._texture)if(this._texture.isReady)t.d.SetImmediate((()=>l()));else{const O=this._texture.onLoadedObservable.add(l);this._texture.onErrorObservable.add((f=>{var y;x(f.message,f.exception),null===(y=this._texture)||void 0===y||y.onLoadedObservable.remove(O)}))}else if(p&&p.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=l,this._delayedOnError=x;else{try{this._texture=U.createTexture(this.url,H,this._invertY,p,h,l,x,this._buffer,void 0,this._format,this._forcedExtension,I,A,J,B)}catch(W){throw x("error loading",W),W}q&&(this._buffer=null)}}updateURL(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2?arguments[2]:void 0,S=arguments.length>3?arguments[3]:void 0;this.url&&(this.releaseInternalTexture(),this.va().markAllMaterialsAsDirty(1,(O=>O.hasTexture(this)))),this.name&&!this.name.startsWith("data:")||(this.name=O),this.url=O,this._buffer=f,this._forcedExtension=S,this.delayLoadState=4,y&&(this._delayedOnLoad=y),this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;const O=this.va();O&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?t.d.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=O.getEngine().createTexture(this.url,this._noMipmap,this._invertY,O,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(O,f,y,S){O*=this._cachedUScale,f*=this._cachedVScale,O-=this.uRotationCenter*this._cachedUScale,f-=this.vRotationCenter*this._cachedVScale,y-=this.wRotationCenter,h.m.TransformCoordinatesFromFloatsToRef(O,f,y,this._rowGenerationMatrix,S),S.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,S.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,S.z+=this.wRotationCenter}getTextureMatrix(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*O===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*O,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=h.b.Zero(),this._rowGenerationMatrix=new h.b,this._t0=h.m.Zero(),this._t1=h.m.Zero(),this._t2=h.m.Zero()),h.b.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(h.b.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,h.g.Matrix[0]),h.b.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,h.g.Matrix[1]),h.b.ScalingToRef(this._cachedUScale,this._cachedVScale,0,h.g.Matrix[2]),h.b.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,h.g.Matrix[3]),h.g.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(h.g.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(h.g.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(h.g.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.ni(this._t0),this._t2.ni(this._t0),h.b.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const f=this.va();if(!f)return this._cachedTextureMatrix;const y=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&y!==this._cachedIdentity3x2&&f.markAllMaterialsAsDirty(1,(O=>O.hasTexture(this))),this._cachedTextureMatrix}getReflectionTextureMatrix(){const O=this.va();if(!O)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==j.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===O.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=h.b.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=h.b.Zero());const f=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case j.PLANAR_MODE:h.b.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case j.PROJECTION_MODE:{h.b.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const f=O.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=f.updateFlag,f.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:h.b.IdentityToRef(this._cachedReflectionTextureMatrix)}return f&&O.markAllMaterialsAsDirty(1,(O=>O.hasTexture(this))),this._cachedReflectionTextureMatrix}clone(){const O={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,X:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return B.b.Clone((()=>new j(this._texture?this._texture.url:null,this.va(),O)),this)}serialize(){var O;const f=this.name;j.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const y=super.serialize(j._SerializeInternalTextureUniqueId);if(!y)return null;var S;((j.SerializeBuffers||j.ForceSerializeBuffers)&&("string"===typeof this._buffer&&"data:"===this._buffer.substring(0,5)?(y.base64String=this._buffer,y.name=y.name.replace("data:","")):this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array?y.base64String="data:image/png;base64,"+(0,I.k)(this._buffer):(j.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(y.base64String=!this._engine||this._engine._features.supportSyncTextureRead?J(this):X(this))),y.invertY=this._invertY,y.samplingMode=this.samplingMode,y._creationFlags=this._creationFlags,y._useSRGBBuffer=this._useSRGBBuffer,j._SerializeInternalTextureUniqueId)&&(y.internalTextureUniqueId=null===(S=this._texture)||void 0===S?void 0:S.uniqueId);return y.internalTextureLabel=null===(O=this._texture)||void 0===O?void 0:O.label,y.noMipmap=this._noMipmap,this.name=f,y}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(O,f,y){if(O.customType){const S=q.c.Instantiate(O.customType).Parse(O,f,y);return O.samplingMode&&S.updateSamplingMode&&S._samplingMode&&S._samplingMode!==O.samplingMode&&S.updateSamplingMode(O.samplingMode),S}if(O.isCube&&!O.isRenderTarget)return j._CubeTextureParser(O,f,y);const S=void 0!==O.internalTextureUniqueId;if(!O.name&&!O.isRenderTarget&&!S)return null;let H;if(S){const y=f.getEngine().getLoadedTexturesCache();for(const f of y)if(f.uniqueId===O.internalTextureUniqueId){H=f;break}}const b=f=>{if(f&&f._texture&&(f._texture._cachedWrapU=null,f._texture._cachedWrapV=null,f._texture._cachedWrapR=null),O.samplingMode){const y=O.samplingMode;f&&f.samplingMode!==y&&f.updateSamplingMode(y)}if(f&&O.animations)for(let y=0;y<O.animations.length;y++){const S=O.animations[y],H=(0,N.c)("BABYLON.Animation");H&&f.animations.push(H.Parse(S))}f&&f._texture&&(S&&!H&&f._texture._setUniqueId(O.internalTextureUniqueId),f._texture.label=O.internalTextureLabel)};return B.b.Parse((()=>{let S=!0;if(O.noMipmap&&(S=!1),O.mirrorPlane){const y=j._CreateMirror(O.name,O.renderTargetSize,f,S);return y._waitingRenderList=O.renderList,y.mirrorPlane=F.b.Ng(O.mirrorPlane),b(y),y}if(O.isRenderTarget){let y=null;if(O.isCube){if(f.reflectionProbes)for(let S=0;S<f.reflectionProbes.length;S++){const y=f.reflectionProbes[S];if(y.name===O.name)return y.cubeTexture}}else y=j._CreateRenderTargetTexture(O.name,O.renderTargetSize,f,S,O._creationFlags??0),y._waitingRenderList=O.renderList;return b(y),y}if(O.isVideo){const H=j._CreateVideoTexture(y+(O.url||O.name),y+(O.src||O.url),f,S,O.invertY,O.samplingMode,O.settings||{});return b(H),H}{let h;if(O.base64String&&!H)h=j.CreateFromBase64String(O.base64String,O.base64String,f,!S,O.invertY,O.samplingMode,(()=>{b(h)}),O._creationFlags??0,O._useSRGBBuffer??!1),h.name=O.name;else{let v;v=O.name&&(O.name.indexOf("://")>0||O.name.startsWith("data:"))?O.name:y+O.name,O.url&&(O.url.startsWith("data:")||j.UseSerializedUrlIfAny)&&(v=O.url);const N={noMipmap:!S,invertY:O.invertY,samplingMode:O.samplingMode,X:()=>{b(h)},internalTexture:H};h=new j(v,f,N)}return h}}),O,f)}static CreateFromBase64String(O,f,y,S,H){let b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:j.TRILINEAR_SAMPLINGMODE;return new j("data:"+f,y,S,H,b,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,O,!1,arguments.length>8&&void 0!==arguments[8]?arguments[8]:5,void 0,void 0,arguments.length>9?arguments[9]:void 0,arguments.length>10?arguments[10]:void 0)}static LoadFromDataString(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],H=arguments.length>4?arguments[4]:void 0,b=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:j.TRILINEAR_SAMPLINGMODE,v=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,N=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,m=arguments.length>9&&void 0!==arguments[9]?arguments[9]:5,t=arguments.length>10?arguments[10]:void 0,q=arguments.length>11?arguments[11]:void 0;return"data:"!==O.substring(0,5)&&(O="data:"+O),new j(O,y,H,b,h,v,N,f,S,m,void 0,void 0,t,q)}}j.SerializeBuffers=!0,j.ForceSerializeBuffers=!1,j.OnTextureLoadErrorObservable=new b.d,j._SerializeInternalTextureUniqueId=!1,j._CubeTextureParser=(O,f,y)=>{throw(0,m.d)("CubeTexture")},j._CreateMirror=(O,f,y,S)=>{throw(0,m.d)("MirrorTexture")},j._CreateRenderTargetTexture=(O,f,y,S,H)=>{throw(0,m.d)("RenderTargetTexture")},j.NEAREST_SAMPLINGMODE=1,j.NEAREST_NEAREST_MIPLINEAR=8,j.BILINEAR_SAMPLINGMODE=2,j.LINEAR_LINEAR_MIPNEAREST=11,j.TRILINEAR_SAMPLINGMODE=3,j.LINEAR_LINEAR_MIPLINEAR=3,j.NEAREST_NEAREST_MIPNEAREST=4,j.NEAREST_LINEAR_MIPNEAREST=5,j.NEAREST_LINEAR_MIPLINEAR=6,j.NEAREST_LINEAR=7,j.NEAREST_NEAREST=1,j.LINEAR_NEAREST_MIPNEAREST=9,j.LINEAR_NEAREST_MIPLINEAR=10,j.LINEAR_LINEAR=2,j.LINEAR_NEAREST=12,j.EXPLICIT_MODE=0,j.SPHERICAL_MODE=1,j.PLANAR_MODE=2,j.CUBIC_MODE=3,j.PROJECTION_MODE=4,j.SKYBOX_MODE=5,j.INVCUBIC_MODE=6,j.EQUIRECTANGULAR_MODE=7,j.FIXED_EQUIRECTANGULAR_MODE=8,j.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,j.CLAMP_ADDRESSMODE=0,j.WRAP_ADDRESSMODE=1,j.MIRROR_ADDRESSMODE=2,j.UseSerializedUrlIfAny=!1,(0,S.b)([(0,H.L)()],j.prototype,"url",void 0),(0,S.b)([(0,H.L)()],j.prototype,"uOffset",void 0),(0,S.b)([(0,H.L)()],j.prototype,"vOffset",void 0),(0,S.b)([(0,H.L)()],j.prototype,"uScale",void 0),(0,S.b)([(0,H.L)()],j.prototype,"vScale",void 0),(0,S.b)([(0,H.L)()],j.prototype,"uAng",void 0),(0,S.b)([(0,H.L)()],j.prototype,"vAng",void 0),(0,S.b)([(0,H.L)()],j.prototype,"wAng",void 0),(0,S.b)([(0,H.L)()],j.prototype,"uRotationCenter",void 0),(0,S.b)([(0,H.L)()],j.prototype,"vRotationCenter",void 0),(0,S.b)([(0,H.L)()],j.prototype,"wRotationCenter",void 0),(0,S.b)([(0,H.L)()],j.prototype,"homogeneousRotationInUVTransform",void 0),(0,S.b)([(0,H.L)()],j.prototype,"isBlocking",null),(0,N.g)("BABYLON.Texture",j),B.b._TextureParser=j.Parse},11134:(O,f,y)=>{"use strict";y.d(f,{d:()=>S});class S{get wrapU(){return this._cachedWrapU}set wrapU(O){this._cachedWrapU=O}get wrapV(){return this._cachedWrapV}set wrapV(O){this._cachedWrapV=O}get wrapR(){return this._cachedWrapR}set wrapR(O){this._cachedWrapR=O}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(O){this._cachedAnisotropicFilteringLevel=O}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(O){this._comparisonFunction=O}get useMipMaps(){return this._useMipMaps}set useMipMaps(O){this._useMipMaps=O}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this._cachedWrapU=O,this._cachedWrapV=f,this._cachedWrapR=y,this._cachedAnisotropicFilteringLevel=S,this.samplingMode=H,this._comparisonFunction=b,this}compareSampler(O){return this._cachedWrapU===O._cachedWrapU&&this._cachedWrapV===O._cachedWrapV&&this._cachedWrapR===O._cachedWrapR&&this._cachedAnisotropicFilteringLevel===O._cachedAnisotropicFilteringLevel&&this.samplingMode===O.samplingMode&&this._comparisonFunction===O._comparisonFunction&&this._useMipMaps===O._useMipMaps}}},11494:(O,f,y)=>{"use strict";function S(O){-1===O.indexOf("vClipPlane")&&O.push("vClipPlane"),-1===O.indexOf("vClipPlane2")&&O.push("vClipPlane2"),-1===O.indexOf("vClipPlane3")&&O.push("vClipPlane3"),-1===O.indexOf("vClipPlane4")&&O.push("vClipPlane4"),-1===O.indexOf("vClipPlane5")&&O.push("vClipPlane5"),-1===O.indexOf("vClipPlane6")&&O.push("vClipPlane6")}function H(O,f,y){const S=!!(O.clipPlane??f.clipPlane),H=!!(O.clipPlane2??f.clipPlane2),b=!!(O.clipPlane3??f.clipPlane3),h=!!(O.clipPlane4??f.clipPlane4),v=!!(O.clipPlane5??f.clipPlane5),N=!!(O.clipPlane6??f.clipPlane6);S&&y.push("#define CLIPPLANE"),H&&y.push("#define CLIPPLANE2"),b&&y.push("#define CLIPPLANE3"),h&&y.push("#define CLIPPLANE4"),v&&y.push("#define CLIPPLANE5"),N&&y.push("#define CLIPPLANE6")}function b(O,f,y){let S=!1;const H=!!(O.clipPlane??f.clipPlane),b=!!(O.clipPlane2??f.clipPlane2),h=!!(O.clipPlane3??f.clipPlane3),v=!!(O.clipPlane4??f.clipPlane4),N=!!(O.clipPlane5??f.clipPlane5),m=!!(O.clipPlane6??f.clipPlane6);return y.CLIPPLANE!==H&&(y.CLIPPLANE=H,S=!0),y.CLIPPLANE2!==b&&(y.CLIPPLANE2=b,S=!0),y.CLIPPLANE3!==h&&(y.CLIPPLANE3=h,S=!0),y.CLIPPLANE4!==v&&(y.CLIPPLANE4=v,S=!0),y.CLIPPLANE5!==N&&(y.CLIPPLANE5=N,S=!0),y.CLIPPLANE6!==m&&(y.CLIPPLANE6=m,S=!0),S}function h(O,f,y){let S=f.clipPlane??y.clipPlane;v(O,"vClipPlane",S),S=f.clipPlane2??y.clipPlane2,v(O,"vClipPlane2",S),S=f.clipPlane3??y.clipPlane3,v(O,"vClipPlane3",S),S=f.clipPlane4??y.clipPlane4,v(O,"vClipPlane4",S),S=f.clipPlane5??y.clipPlane5,v(O,"vClipPlane5",S),S=f.clipPlane6??y.clipPlane6,v(O,"vClipPlane6",S)}function v(O,f,y){y&&O.setFloat4(f,y.k.x,y.k.y,y.k.z,y.d)}y.d(f,{b:()=>S,f:()=>h,h:()=>b,l:()=>H})},11369:(O,f,y)=>{"use strict";function S(O){O.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}y.d(f,{e:()=>S})},11720:(O,f,y)=>{"use strict";function S(O){return void 0===O.getPipelineContext}y.d(f,{c:()=>S})},11488:(O,f,y)=>{"use strict";y.d(f,{b:()=>S});class S{static GetEffect(O){return void 0===O.getPipelineContext?O.effect:O}constructor(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=O.createDrawContext(),f&&(this.materialContext=O.createMaterialContext())}setEffect(O,f){let y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var S;(this.effect=O,void 0!==f&&(this.defines=f),y)&&(null===(S=this.drawContext)||void 0===S||S.reset())}dispose(){var O;null===(O=this.drawContext)||void 0===O||O.dispose()}}},11104:(O,f,y)=>{"use strict";y.d(f,{c:()=>q,e:()=>I,f:()=>m,g:()=>t});var S=y(11009),H=y(11113),b=y(11101),h=y(11017),v=y(11070),N=y(11079);function m(O,f){return(0,H.C)(f).cachedPipelines[O]}function t(O){const f=O._name,y=O.context;if(f&&y){const O=(0,H.C)(y),S=O.cachedPipelines[f];null===S||void 0===S||S.dispose(),delete O.cachedPipelines[f]}}function q(O,f,y,H,b,h,N){let m,t;const q=(0,S.h)()?null===h||void 0===h?void 0:h.getHostDocument():null;m="string"===typeof f?f:f.vertexSource?"source:"+f.vertexSource:f.vertexElement?(null===q||void 0===q?void 0:q.getElementById(f.vertexElement))||f.vertexElement:f.vertex||f,t="string"===typeof f?f:f.fragmentSource?"source:"+f.fragmentSource:f.fragmentElement?(null===q||void 0===q?void 0:q.getElementById(f.fragmentElement))||f.fragmentElement:f.fragment||f;const I=[void 0,void 0],A=()=>{if(I[0]&&I[1]){O.isFragment=!0;const[S,m]=I;(0,v.h)(m,O,((h,m)=>{N&&(N._fragmentSourceCodeBeforeMigration=m),y&&(h=y("fragment",h));const t=(0,v.e)(S,h,O);O=null;const q=function(O,f,y,S){if(y){return{vertexSourceCode:(1===S?"//":"")+"#define SHADER_NAME vertex:"+(y.vertexElement||y.vertex||y.spectorName||y)+"\n"+O,fragmentSourceCode:(1===S?"//":"")+"#define SHADER_NAME fragment:"+(y.fragmentElement||y.fragment||y.spectorName||y)+"\n"+f}}return{vertexSourceCode:O,fragmentSourceCode:f}}(t.vertexCode,t.fragmentCode,f,b);null===H||void 0===H||H(q.vertexSourceCode,q.fragmentSourceCode)}),h)}};F(m,"Vertex","",(f=>{(0,v.g)(O),(0,v.h)(f,O,((O,S)=>{N&&(N._rawVertexSourceCode=f,N._vertexSourceCodeBeforeMigration=S),y&&(O=y("vertex",O)),I[0]=O,A()}),h)}),b),F(t,"Fragment","Pixel",(O=>{N&&(N._rawFragmentSourceCode=O),I[1]=O,A()}),b)}function F(O,f,y,H,h,v){if("undefined"!==typeof HTMLElement&&O instanceof HTMLElement){return void H((0,S.b)(O))}if("source:"===O.substring(0,7))return void H(O.substring(7));if("base64:"===O.substring(0,7)){return void H(window.atob(O.substring(7)))}const m=b.c.GetShadersStore(h);if(m[O+f+"Shader"])return void H(m[O+f+"Shader"]);if(y&&m[O+y+"Shader"])return void H(m[O+y+"Shader"]);let t;if(t="."===O[0]||"/"===O[0]||O.indexOf("http")>-1?O:b.c.GetShadersRepository(h)+O,!(v=v||N.j))throw new Error("loadFileInjection is not defined");v(t+"."+f.toLowerCase()+".fx",H)}const I=(O,f,y,S)=>{try{const b=O.existingPipelineContext||f(O.shaderProcessingContext);if(b._name=O.name,O.name&&O.context){(0,H.C)(O.context).cachedPipelines[O.name]=b}return y(b,O.vertex,O.fragment,!!O.createAsRaw,"","",O.rebuildRebind,O.defines,O.transformFeedbackVaryings,"",(()=>{S(b,(()=>{var f;null===(f=O.onRenderingStateCompiled)||void 0===f||f.call(O,b)}))})),b}catch(b){throw h.e.Error("Error compiling effect"),b}}},11098:(O,f,y)=>{"use strict";y.d(f,{b:()=>v});var S=y(11004),H=y(11017),b=y(11101),h=y(11104);class v{static get ShadersRepository(){return b.c.ShadersRepository}static set ShadersRepository(O){b.c.ShadersRepository=O}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new S.d),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(O,f,y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>4?arguments[4]:void 0,N=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,F=arguments.length>9?arguments[9]:void 0,I=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",A=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,J=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new S.d,this.onErrorObservable=new S.d,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=O,this._key=I;const X=this._key.replace(/\r/g,"").replace(/\n/g,"|");let w;if(f.attributes){const O=f;if(this._engine=y,this._attributesNames=O.attributes,this._uniformsNames=O.uniformsNames.concat(O.samplers),this._samplerList=O.samplers.slice(),this.defines=O.defines,this.onError=O.onError,this.onCompiled=O.onCompiled,this._fallbacks=O.fallbacks,this._indexParameters=O.indexParameters,this._transformFeedbackVaryings=O.transformFeedbackVaryings||null,this._multiTarget=!!O.multiTarget,this._shaderLanguage=O.shaderLanguage??0,O.uniformBuffersNames){this._uniformBuffersNamesList=O.uniformBuffersNames.slice();for(let f=0;f<O.uniformBuffersNames.length;f++)this._uniformBuffersNames[O.uniformBuffersNames[f]]=f}this._processFinalCode=O.processFinalCode??null,this._processCodeAfterIncludes=O.processCodeAfterIncludes??void 0,w=O.existingPipelineContext}else this._engine=b,this.defines=null==N?"":N,this._uniformsNames=y.concat(H),this._samplerList=H?H.slice():[],this._attributesNames=f,this._uniformBuffersNamesList=[],this._shaderLanguage=A,this.onError=q,this.onCompiled=t,this._indexParameters=F,this._fallbacks=m;"WEBGL2"===this._engine.shaderPlatformName&&(w=(0,h.f)(X,this._engine._gl)??w),this._attributeLocationByName={},this.uniqueId=v._UniqueIdSeed++,w?(this._pipelineContext=w,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,J)}async _processShaderCodeAsync(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3?arguments[3]:void 0;S&&await S(),this._processingContext=y||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const H={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:O??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:b.c.GetShadersRepository(this._shaderLanguage),includesShadersStore:b.c.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,h.c)(H,this.name,this._processFinalCode,((O,y)=>{this._vertexSourceCode=O,this._fragmentSourceCode=y,this._prepareEffect(f)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.u||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(O){return this._attributes[O]}getAttributeLocationByName(O){return this._attributeLocationByName[O]}getAttributesCount(){return this._attributes.length}getUniformIndex(O){return this._uniformsNames.indexOf(O)}getUniform(O){return this._uniforms[O]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}executeWhenCompiled(O){this.isReady()?O(this):(this.onCompileObservable.add((f=>{O(f)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((()=>{this._checkIsReady(null)}),16))}_checkIsReady(O){try{if(this._isReadyInternal())return}catch(f){return void this._processCompilationErrors(f,O)}this._isDisposed||setTimeout((()=>{this._checkIsReady(O)}),16)}get vertexSourceCode(){var O;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(O=this._pipelineContext)||void 0===O?void 0:O._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var O;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(O=this._pipelineContext)||void 0===O?void 0:O._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(O,f,y,S){this._isReady=!1,this._vertexSourceCodeOverride=O,this._fragmentSourceCodeOverride=f,this.onError=(O,f)=>{S&&S(f)},this.onCompiled=()=>{var O,f;const S=this.getEngine().scenes;if(S)for(let y=0;y<S.length;y++)S[y].markAllMaterialsAsDirty(63);null===(O=(f=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===O||O.call(f,y)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(O){if(this._pipelineContext=O,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let f=0;f<this._attributesNames.length;f++){const O=this._attributesNames[f];this._attributeLocationByName[O]=this._attributes[f]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),v.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const f=this._pipelineContext;this._isReady=!1;try{const y=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),S=y?null:this.defines,H=y?this._vertexSourceCodeOverride:this._vertexSourceCode,b=y?this._fragmentSourceCodeOverride:this._fragmentSourceCode,v=this._engine;this._pipelineContext=(0,h.e)({existingPipelineContext:O?f:null,vertex:H,fragment:b,context:"WEBGL2"===v.shaderPlatformName?v._gl:void 0,rebuildRebind:(O,f,y,S)=>this._rebuildProgram(O,f,y,S),defines:S,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:y,parallelShaderCompile:v._caps.parallelShaderCompile,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:y=>{f&&!O&&this._engine._deletePipelineContext(f),y&&this._onRenderingStateCompiled(y)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContext.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(f)}catch(y){this._processCompilationErrors(y,f)}}_getShaderCodeAndErrorLine(O,f,y){const S=y?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let H=null;if(f&&O){const b=f.match(S);if(b&&2===b.length){const f=parseInt(b[1]),S=O.split("\n",-1);S.length>=f&&(H=`Offending line [${f}] in ${y?"fragment":"vertex"} code: ${S[f-1]}`)}}return[O,H]}_processCompilationErrors(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=O.message;const y=this._attributesNames,S=this._fallbacks;if(H.e.Error("Unable to compile effect:"),H.e.Error("Uniforms: "+this._uniformsNames.map((function(O){return" "+O}))),H.e.Error("Attributes: "+y.map((function(O){return" "+O}))),H.e.Error("Defines:\n"+this.defines),v.LogShaderCodeOnCompilationError){var b,h;let O=null,f=null,y=null;var N;if(null!==(b=this._pipelineContext)&&void 0!==b&&b._getVertexShaderCode()&&([y,O]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),y&&(H.e.Error("Vertex code:"),H.e.Error(y))),null!==(h=this._pipelineContext)&&void 0!==h&&h._getFragmentShaderCode())[y,f]=this._getShaderCodeAndErrorLine(null===(N=this._pipelineContext)||void 0===N?void 0:N._getFragmentShaderCode(),this._compilationError,!0),y&&(H.e.Error("Fragment code:"),H.e.Error(y));O&&H.e.Error(O),f&&H.e.Error(f)}H.e.Error("Error: "+this._compilationError);const m=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)};f&&(this._pipelineContext=f,this._isReady=!0,m()),S?(this._pipelineContext=null,S.hasMoreFallbacks?(this._allFallbacksProcessed=!1,H.e.Error("Trying next fallback."),this.defines=S.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,m(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,f||m())}get isSupported(){return""===this._compilationError}_bindTexture(O,f){this._engine._bindTexture(this._samplers[O],f,O)}setTexture(O,f){this._engine.setTexture(this._samplers[O],this._uniforms[O],f,O)}setTextureArray(O,f){const y=O+"Ex";if(-1===this._samplerList.indexOf(y+"0")){const S=this._samplerList.indexOf(O);for(let O=1;O<f.length;O++){const f=y+(O-1).toString();this._samplerList.splice(S+O,0,f)}let H=0;for(const O of this._samplerList)this._samplers[O]=H,H+=1}this._engine.setTextureArray(this._samplers[O],this._uniforms[O],f,O)}bindUniformBuffer(O,f){const y=this._uniformBuffersNames[f];void 0===y||v._BaseCache[y]===O&&this._engine._features.useUBOBindingCache||(v._BaseCache[y]=O,this._engine.bindUniformBufferBase(O,y,f))}bindUniformBlock(O,f){this._engine.bindUniformBlock(this._pipelineContext,O,f)}setInt(O,f){return this._pipelineContext.setInt(O,f),this}setInt2(O,f,y){return this._pipelineContext.setInt2(O,f,y),this}setInt3(O,f,y,S){return this._pipelineContext.setInt3(O,f,y,S),this}setInt4(O,f,y,S,H){return this._pipelineContext.setInt4(O,f,y,S,H),this}setIntArray(O,f){return this._pipelineContext.setIntArray(O,f),this}setIntArray2(O,f){return this._pipelineContext.setIntArray2(O,f),this}setIntArray3(O,f){return this._pipelineContext.setIntArray3(O,f),this}setIntArray4(O,f){return this._pipelineContext.setIntArray4(O,f),this}setUInt(O,f){return this._pipelineContext.setUInt(O,f),this}setUInt2(O,f,y){return this._pipelineContext.setUInt2(O,f,y),this}setUInt3(O,f,y,S){return this._pipelineContext.setUInt3(O,f,y,S),this}setUInt4(O,f,y,S,H){return this._pipelineContext.setUInt4(O,f,y,S,H),this}setUIntArray(O,f){return this._pipelineContext.setUIntArray(O,f),this}setUIntArray2(O,f){return this._pipelineContext.setUIntArray2(O,f),this}setUIntArray3(O,f){return this._pipelineContext.setUIntArray3(O,f),this}setUIntArray4(O,f){return this._pipelineContext.setUIntArray4(O,f),this}setFloatArray(O,f){return this._pipelineContext.setArray(O,f),this}setFloatArray2(O,f){return this._pipelineContext.setArray2(O,f),this}setFloatArray3(O,f){return this._pipelineContext.setArray3(O,f),this}setFloatArray4(O,f){return this._pipelineContext.setArray4(O,f),this}setArray(O,f){return this._pipelineContext.setArray(O,f),this}setArray2(O,f){return this._pipelineContext.setArray2(O,f),this}setArray3(O,f){return this._pipelineContext.setArray3(O,f),this}setArray4(O,f){return this._pipelineContext.setArray4(O,f),this}setMatrices(O,f){return this._pipelineContext.setMatrices(O,f),this}setMatrix(O,f){return this._pipelineContext.setMatrix(O,f),this}setMatrix3x3(O,f){return this._pipelineContext.setMatrix3x3(O,f),this}setMatrix2x2(O,f){return this._pipelineContext.setMatrix2x2(O,f),this}setFloat(O,f){return this._pipelineContext.setFloat(O,f),this}setBool(O,f){return this._pipelineContext.setInt(O,f?1:0),this}setVector2(O,f){return this._pipelineContext.setVector2(O,f),this}setFloat2(O,f,y){return this._pipelineContext.setFloat2(O,f,y),this}setVector3(O,f){return this._pipelineContext.setVector3(O,f),this}setFloat3(O,f,y,S){return this._pipelineContext.setFloat3(O,f,y,S),this}setVector4(O,f){return this._pipelineContext.setVector4(O,f),this}setQuaternion(O,f){return this._pipelineContext.setQuaternion(O,f),this}setFloat4(O,f,y,S,H){return this._pipelineContext.setFloat4(O,f,y,S,H),this}setColor3(O,f){return this._pipelineContext.setColor3(O,f),this}setColor4(O,f,y){return this._pipelineContext.setColor4(O,f,y),this}setDirectColor4(O,f){return this._pipelineContext.setDirectColor4(O,f),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){this._refCount--,this._refCount>0||(this._pipelineContext&&(0,h.g)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;f&&(b.c.GetShadersStore(S)[`${O}PixelShader`]=f),y&&(b.c.GetShadersStore(S)[`${O}VertexShader`]=y)}static ResetCache(){v._BaseCache={}}}v.LogShaderCodeOnCompilationError=!0,v.AutomaticallyClearCodeCache=!1,v._UniqueIdSeed=0,v._BaseCache={},v.ShadersStore=b.c.ShadersStore,v.IncludesShadersStore=b.c.IncludesShadersStore},11536:(O,f,y)=>{"use strict";y.d(f,{c:()=>S});class S{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(O,f){this._defines[O]||(O<this._currentRank&&(this._currentRank=O),O>this._maxRank&&(this._maxRank=O),this._defines[O]=new Array),this._defines[O].push(f)}addCPUSkinningFallback(O,f){this._mesh=f,O<this._currentRank&&(this._currentRank=O),O>this._maxRank&&(this._maxRank=O)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(O,f){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,O=O.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),f._bonesComputationForcedToCPU=!0;const y=this._mesh.va();for(let O=0;O<y.meshes.length;O++){const S=y.meshes[O];if(S.material){if(S.computeBonesUsingShaders&&0!==S.numBoneInfluencers)if(S.material.getEffect()===f)S.computeBonesUsingShaders=!1;else if(S.Yf)for(const O of S.Yf){if(O.effect===f){S.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&S.computeBonesUsingShaders&&S.numBoneInfluencers>0&&(S.computeBonesUsingShaders=!1)}}else{const f=this._defines[this._currentRank];if(f)for(let y=0;y<f.length;y++)O=O.replace("#define "+f[y],"");this._currentRank++}return O}}},11816:(O,f,y)=>{"use strict";y.d(f,{e:()=>m,f:()=>t});var S=y(11392),H=y(11574),b=y(11004),h=y(11098),v=y(11488);y(11823);const N={xa:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class m{constructor(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N;this._fullscreenViewport=new H.c(0,0,1,1);const y=f.xa??N.xa,b=f.indices??N.indices;this.ad=O,this._vertexBuffers={[S.f.PositionKind]:new S.f(O,y,S.f.PositionKind,!1,!1,2)},this._indexBuffer=O.createIndexBuffer(b),this._onContextRestoredObserver=O.onContextRestoredObservable.add((()=>{this._indexBuffer=O.createIndexBuffer(b);for(const O in this._vertexBuffers){this._vertexBuffers[O]._rebuild()}}))}setViewport(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._fullscreenViewport;this.ad.setViewport(O)}bindBuffers(O){this.ad.bindBuffers(this._vertexBuffers,this._indexBuffer,O)}applyEffectWrapper(O){this.ad.setState(!0),this.ad.depthCullingState.depthTest=!1,this.ad.stencilState.stencilTest=!1,this.ad.enableEffect(O.drawWrapper),this.bindBuffers(O.effect),O.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.ad.depthCullingState.depthTest,this._savedStateStencilTest=this.ad.stencilState.stencilTest}restoreStates(){this.ad.depthCullingState.depthTest=this._savedStateDepthTest,this.ad.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.ad.drawElementsType(0,0,6)}_isRenderTargetTexture(O){return void 0!==O.renderTarget}render(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!O.effect.isReady())return;this.saveStates(),this.setViewport();const y=null===f?null:this._isRenderTargetTexture(f)?f.renderTarget:f;y&&this.ad.bindFramebuffer(y),this.applyEffectWrapper(O),this.draw(),y&&this.ad.unBindFramebuffer(y),this.restoreStates()}dispose(){const O=this._vertexBuffers[S.f.PositionKind];O&&(O.dispose(),delete this._vertexBuffers[S.f.PositionKind]),this._indexBuffer&&this.ad._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.ad.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class t{static RegisterShaderCodeProcessing(O,f){f?t._CustomShaderCodeProcessing[O??""]=f:delete t._CustomShaderCodeProcessing[O??""]}static _GetShaderCodeProcessing(O){return t._CustomShaderCodeProcessing[O]??t._CustomShaderCodeProcessing[""]}get name(){return this.options.name}set name(O){this.options.name=O}isReady(){var O;return(null===(O=this._drawWrapper.effect)||void 0===O?void 0:O.isReady())??!1}get drawWrapper(){return this._drawWrapper}get effect(){return this._drawWrapper.effect}set effect(O){this._drawWrapper.effect=O}constructor(O){this.alphaMode=0,this.onEffectCreatedObservable=new b.d(void 0,!0),this.onApplyObservable=new b.d,this._shadersLoaded=!1,this._webGPUReady=!1,this._importPromises=[],this.options={...O,name:O.name||"effectWrapper",ad:O.ad,uniforms:O.uniforms||O.uniformNames||[],uniformNames:void 0,samplers:O.samplers||O.samplerNames||[],samplerNames:void 0,attributeNames:O.attributeNames||["position"],uniformBuffers:O.uniformBuffers||[],defines:O.defines||"",useShaderStore:O.useShaderStore||!1,vertexUrl:O.vertexUrl||O.vertexShader||"postprocess",vertexShader:void 0,fragmentShader:O.fragmentShader||"pass",indexParameters:O.indexParameters,blockCompilation:O.blockCompilation||!1,shaderLanguage:O.shaderLanguage||0,onCompiled:O.onCompiled||void 0,extraInitializations:O.extraInitializations||void 0,extraInitializationsAsync:O.extraInitializationsAsync||void 0,useAsPostProcess:O.useAsPostProcess??!1},this.options.uniformNames=this.options.uniforms,this.options.samplerNames=this.options.samplers,this.options.vertexShader=this.options.vertexUrl,this.options.useAsPostProcess&&(-1===this.options.samplers.indexOf("textureSampler")&&this.options.samplers.push("textureSampler"),-1===this.options.uniforms.indexOf("scale")&&this.options.uniforms.push("scale")),O.vertexUrl||O.vertexShader?this._shaderPath={vertexSource:this.options.vertexShader}:(this.options.useAsPostProcess||(this.options.uniforms.push("scale"),this.onApplyObservable.add((()=>{this.effect.setFloat2("scale",1,1)}))),this._shaderPath={vertex:this.options.vertexShader}),this._shaderPath.fragmentSource=this.options.fragmentShader,this._shaderPath.spectorName=this.options.name,this.options.useShaderStore&&(this._shaderPath.fragment=this._shaderPath.fragmentSource,this._shaderPath.vertex||(this._shaderPath.vertex=this._shaderPath.vertexSource),delete this._shaderPath.fragmentSource,delete this._shaderPath.vertexSource),this.onApplyObservable.add((()=>{this.bind()})),this.options.useShaderStore||(this._onContextRestoredObserver=this.options.ad.onContextRestoredObservable.add((()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()}))),this._drawWrapper=new v.b(this.options.ad),this._webGPUReady=1===this.options.shaderLanguage;const f=Array.isArray(this.options.defines)?this.options.defines.join("\n"):this.options.defines;this._postConstructor(this.options.blockCompilation,f,this.options.extraInitializations)}_gatherImports(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1?arguments[1]:void 0;this.options.useAsPostProcess&&(O&&this._webGPUReady?f.push(Promise.all([y.e(37).then(y.bind(y,13460))])):f.push(Promise.all([Promise.resolve().then(y.bind(y,11823))])))}_postConstructor(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2?arguments[2]:void 0,S=arguments.length>3?arguments[3]:void 0;this._importPromises.length=0,S&&this._importPromises.push(...S);const H=this.options.ad.isWebGPU&&!t.ForceGLSL;this._gatherImports(H,this._importPromises),void 0!==y&&y(H,this._importPromises),H&&this._webGPUReady&&(this.options.shaderLanguage=1),O||this.updateEffect(f)}updateEffect(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3?arguments[3]:void 0,H=arguments.length>4?arguments[4]:void 0,b=arguments.length>5?arguments[5]:void 0,v=arguments.length>6?arguments[6]:void 0,N=arguments.length>7?arguments[7]:void 0;const m=t._GetShaderCodeProcessing(this.name);if(null!==m&&void 0!==m&&m.defineCustomBindings){var q,F;const S=(null===(q=f)||void 0===q?void 0:q.slice())??[];S.push(...this.options.uniforms);const H=(null===(F=y)||void 0===F?void 0:F.slice())??[];H.push(...this.options.samplers),O=m.defineCustomBindings(this.name,O,S,H),f=S,y=H}this.options.defines=O||"";const I=this._shadersLoaded||0===this._importPromises.length?void 0:async()=>{await Promise.all(this._importPromises),this._shadersLoaded=!0};let A;A=this.options.extraInitializationsAsync?async()=>{null===I||void 0===I||I(),await this.options.extraInitializationsAsync}:I,this.options.useShaderStore?this._drawWrapper.effect=this.options.ad.createEffect({vertex:v??this._shaderPath.vertex,fragment:N??this._shaderPath.fragment},{attributes:this.options.attributeNames,uniformsNames:f||this.options.uniforms,uniformBuffersNames:this.options.uniformBuffers,samplers:y||this.options.samplers,defines:null!==O?O:"",fallbacks:null,onCompiled:H??this.options.onCompiled,onError:b??null,indexParameters:S||this.options.indexParameters,processCodeAfterIncludes:null!==m&&void 0!==m&&m.processCodeAfterIncludes?(O,f)=>m.processCodeAfterIncludes(this.name,O,f):null,processFinalCode:null!==m&&void 0!==m&&m.processFinalCode?(O,f)=>m.processFinalCode(this.name,O,f):null,shaderLanguage:this.options.shaderLanguage,extraInitializationsAsync:A},this.options.ad):this._drawWrapper.effect=new h.b(this._shaderPath,this.options.attributeNames,f||this.options.uniforms,y||this.options.samplerNames,this.options.ad,O,void 0,H||this.options.onCompiled,void 0,void 0,void 0,this.options.shaderLanguage,A),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)}bind(){var O,f;this.options.useAsPostProcess&&(this.options.ad.setAlphaMode(this.alphaMode),this.drawWrapper.effect.setFloat2("scale",1,1)),null===(O=t._GetShaderCodeProcessing(this.name))||void 0===O||null===(f=O.bindCustomBindings)||void 0===f||f.call(O,this.name,this._drawWrapper.effect)}dispose(){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.onEffectCreatedObservable.clear(),this.effect.dispose()}}t.ForceGLSL=!1,t._CustomShaderCodeProcessing={}},11373:(O,f,y)=>{"use strict";y.d(f,{d:()=>b,g:()=>H});var S=y(11369);function H(O,f){f.EXPOSURE&&O.push("exposureLinear"),f.CONTRAST&&O.push("contrast"),f.COLORGRADING&&O.push("colorTransformSettings"),(f.VIGNETTE||f.DITHER)&&O.push("vInverseScreenSize"),f.VIGNETTE&&(O.push("vignetteSettings1"),O.push("vignetteSettings2")),f.COLORCURVES&&(0,S.e)(O),f.DITHER&&O.push("ditherIntensity")}function b(O,f){f.COLORGRADING&&O.push("txColorTransform")}},11352:(O,f,y)=>{"use strict";y.d(f,{c:()=>I});var S=y(11289),H=y(11294),b=y(11004),h=y(11359),v=y(11362),N=y(11369);class m{constructor(){this._dirty=!0,this._tempColor=new h.g(0,0,0,0),this._globalCurve=new h.g(0,0,0,0),this._highlightsCurve=new h.g(0,0,0,0),this._midtonesCurve=new h.g(0,0,0,0),this._shadowsCurve=new h.g(0,0,0,0),this._positiveCurve=new h.g(0,0,0,0),this._negativeCurve=new h.g(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get globalHue(){return this._globalHue}set globalHue(O){this._globalHue=O,this._dirty=!0}get globalDensity(){return this._globalDensity}set globalDensity(O){this._globalDensity=O,this._dirty=!0}get globalSaturation(){return this._globalSaturation}set globalSaturation(O){this._globalSaturation=O,this._dirty=!0}get globalExposure(){return this._globalExposure}set globalExposure(O){this._globalExposure=O,this._dirty=!0}get highlightsHue(){return this._highlightsHue}set highlightsHue(O){this._highlightsHue=O,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}set highlightsDensity(O){this._highlightsDensity=O,this._dirty=!0}get highlightsSaturation(){return this._highlightsSaturation}set highlightsSaturation(O){this._highlightsSaturation=O,this._dirty=!0}get highlightsExposure(){return this._highlightsExposure}set highlightsExposure(O){this._highlightsExposure=O,this._dirty=!0}get midtonesHue(){return this._midtonesHue}set midtonesHue(O){this._midtonesHue=O,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesDensity(O){this._midtonesDensity=O,this._dirty=!0}get midtonesSaturation(){return this._midtonesSaturation}set midtonesSaturation(O){this._midtonesSaturation=O,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set midtonesExposure(O){this._midtonesExposure=O,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set shadowsHue(O){this._shadowsHue=O,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set shadowsDensity(O){this._shadowsDensity=O,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}set shadowsSaturation(O){this._shadowsSaturation=O,this._dirty=!0}get shadowsExposure(){return this._shadowsExposure}set shadowsExposure(O){this._shadowsExposure=O,this._dirty=!0}getClassName(){return"ColorCurves"}static Bind(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vCameraColorCurvePositive",S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vCameraColorCurveNeutral",H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"vCameraColorCurveNegative";O._dirty&&(O._dirty=!1,O._getColorGradingDataToRef(O._globalHue,O._globalDensity,O._globalSaturation,O._globalExposure,O._globalCurve),O._getColorGradingDataToRef(O._highlightsHue,O._highlightsDensity,O._highlightsSaturation,O._highlightsExposure,O._tempColor),O._tempColor.multiplyToRef(O._globalCurve,O._highlightsCurve),O._getColorGradingDataToRef(O._midtonesHue,O._midtonesDensity,O._midtonesSaturation,O._midtonesExposure,O._tempColor),O._tempColor.multiplyToRef(O._globalCurve,O._midtonesCurve),O._getColorGradingDataToRef(O._shadowsHue,O._shadowsDensity,O._shadowsSaturation,O._shadowsExposure,O._tempColor),O._tempColor.multiplyToRef(O._globalCurve,O._shadowsCurve),O._highlightsCurve.subtractToRef(O._midtonesCurve,O._positiveCurve),O._midtonesCurve.subtractToRef(O._shadowsCurve,O._negativeCurve)),f&&(f.setFloat4(y,O._positiveCurve.r,O._positiveCurve.g,O._positiveCurve.b,O._positiveCurve.a),f.setFloat4(S,O._midtonesCurve.r,O._midtonesCurve.g,O._midtonesCurve.b,O._midtonesCurve.a),f.setFloat4(H,O._negativeCurve.r,O._negativeCurve.g,O._negativeCurve.b,O._negativeCurve.a))}_getColorGradingDataToRef(O,f,y,S,H){null!=O&&(O=m._Clamp(O,0,360),f=m._Clamp(f,-100,100),y=m._Clamp(y,-100,100),S=m._Clamp(S,-100,100),f=m._ApplyColorGradingSliderNonlinear(f),f*=.5,S=m._ApplyColorGradingSliderNonlinear(S),f<0&&(f*=-1,O=(O+180)%360),m._FromHSBToRef(O,f,50+.25*S,H),H.scaleToRef(2,H),H.a=1+.01*y)}static _ApplyColorGradingSliderNonlinear(O){O/=100;let f=Math.abs(O);return f=Math.pow(f,2),O<0&&(f*=-1),f*=100,f}static _FromHSBToRef(O,f,y,S){let H=m._Clamp(O,0,360);const b=m._Clamp(f/100,0,1),h=m._Clamp(y/100,0,1);if(0===b)S.r=h,S.g=h,S.b=h;else{H/=60;const O=Math.floor(H),f=H-O,y=h*(1-b),v=h*(1-b*f),N=h*(1-b*(1-f));switch(O){case 0:S.r=h,S.g=N,S.b=y;break;case 1:S.r=v,S.g=h,S.b=y;break;case 2:S.r=y,S.g=h,S.b=N;break;case 3:S.r=y,S.g=v,S.b=h;break;case 4:S.r=N,S.g=y,S.b=h;break;default:S.r=h,S.g=y,S.b=v}}S.a=1}static _Clamp(O,f,y){return Math.min(Math.max(O,f),y)}clone(){return v.b.Clone((()=>new m),this)}serialize(){return v.b.Serialize(this)}static Parse(O){return v.b.Parse((()=>new m),O,null,null)}}m.PrepareUniforms=N.e,(0,S.b)([(0,H.L)()],m.prototype,"_globalHue",void 0),(0,S.b)([(0,H.L)()],m.prototype,"_globalDensity",void 0),(0,S.b)([(0,H.L)()],m.prototype,"_globalSaturation",void 0),(0,S.b)([(0,H.L)()],m.prototype,"_globalExposure",void 0),(0,S.b)([(0,H.L)()],m.prototype,"_highlightsHue",void 0),(0,S.b)([(0,H.L)()],m.prototype,"_highlightsDensity",void 0),(0,S.b)([(0,H.L)()],m.prototype,"_highlightsSaturation",void 0),(0,S.b)([(0,H.L)()],m.prototype,"_highlightsExposure",void 0),(0,S.b)([(0,H.L)()],m.prototype,"_midtonesHue",void 0),(0,S.b)([(0,H.L)()],m.prototype,"_midtonesDensity",void 0),(0,S.b)([(0,H.L)()],m.prototype,"_midtonesSaturation",void 0),(0,S.b)([(0,H.L)()],m.prototype,"_midtonesExposure",void 0),v.b._ColorCurvesParser=m.Parse;var t=y(11161),q=y(11373),F=y(11153);class I{constructor(){this.colorCurves=new m,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=I.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new h.g(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=I.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new b.d}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(O){this._colorCurvesEnabled!==O&&(this._colorCurvesEnabled=O,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(O){this._colorGradingTexture!==O&&(this._colorGradingTexture=O,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(O){this._colorGradingEnabled!==O&&(this._colorGradingEnabled=O,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(O){this._colorGradingWithGreenDepth!==O&&(this._colorGradingWithGreenDepth=O,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(O){this._colorGradingBGR!==O&&(this._colorGradingBGR=O,this._updateParameters())}get exposure(){return this._exposure}set exposure(O){this._exposure!==O&&(this._exposure=O,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(O){this._toneMappingEnabled!==O&&(this._toneMappingEnabled=O,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(O){this._toneMappingType!==O&&(this._toneMappingType=O,this._updateParameters())}get contrast(){return this._contrast}set contrast(O){this._contrast!==O&&(this._contrast=O,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(O){this.vignetteCenterY=O}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(O){this.vignetteCenterX=O}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(O){this._vignetteBlendMode!==O&&(this._vignetteBlendMode=O,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(O){this._vignetteEnabled!==O&&(this._vignetteEnabled=O,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(O){this._ditheringEnabled!==O&&(this._ditheringEnabled=O,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(O){this._ditheringIntensity!==O&&(this._ditheringIntensity=O,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(O){this._skipFinalColorClamp!==O&&(this._skipFinalColorClamp=O,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(O){this._applyByPostProcess!==O&&(this._applyByPostProcess=O,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(O){this._isEnabled!==O&&(this._isEnabled=O,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}prepareDefines(O){if((arguments.length>1&&void 0!==arguments[1]&&arguments[1])!==this.applyByPostProcess||!this._isEnabled)return O.VIGNETTE=!1,O.TONEMAPPING=0,O.CONTRAST=!1,O.EXPOSURE=!1,O.COLORCURVES=!1,O.COLORGRADING=!1,O.COLORGRADING3D=!1,O.DITHER=!1,O.IMAGEPROCESSING=!1,O.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(O.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(O.VIGNETTE=this.vignetteEnabled,O.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===I._VIGNETTEMODE_MULTIPLY,O.VIGNETTEBLENDMODEOPAQUE=!O.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case I.TONEMAPPING_KHR_PBR_NEUTRAL:O.TONEMAPPING=3;break;case I.TONEMAPPING_ACES:O.TONEMAPPING=2;break;default:O.TONEMAPPING=1}else O.TONEMAPPING=0;O.CONTRAST=1!==this.contrast,O.EXPOSURE=1!==this.exposure,O.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,O.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,O.COLORGRADING?O.COLORGRADING3D=this.colorGradingTexture.is3D:O.COLORGRADING3D=!1,O.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,O.SAMPLER3DBGRMAP=this.colorGradingBGR,O.DITHER=this._ditheringEnabled,O.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,O.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,O.IMAGEPROCESSING=O.VIGNETTE||!!O.TONEMAPPING||O.CONTRAST||O.EXPOSURE||O.COLORCURVES||O.COLORGRADING||O.DITHER}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(O,f){if(this._colorCurvesEnabled&&this.colorCurves&&m.Bind(this.colorCurves,O),this._vignetteEnabled||this._ditheringEnabled){const y=1/O.getEngine().getRenderWidth(),S=1/O.getEngine().getRenderHeight();if(O.setFloat2("vInverseScreenSize",y,S),this._ditheringEnabled&&O.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const H=null!=f?f:S/y;let b=Math.tan(.5*this.vignetteCameraFov),h=b*H;const v=Math.sqrt(h*b);h=(0,t.k)(h,v,this.vignetteStretch),b=(0,t.k)(b,v,this.vignetteStretch),O.setFloat4("vignetteSettings1",h,b,-h*this.vignetteCenterX,-b*this.vignetteCenterY);const N=-2*this.vignetteWeight;O.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,N)}}if(O.setFloat("exposureLinear",this.exposure),O.setFloat("contrast",this.contrast),this.colorGradingTexture){O.setTexture("txColorTransform",this.colorGradingTexture);const f=this.colorGradingTexture.getSize().height;O.setFloat4("colorTransformSettings",(f-1)/f,.5/f,f,this.colorGradingTexture.level)}}clone(){return v.b.Clone((()=>new I),this)}serialize(){return v.b.Serialize(this)}static Parse(O){const f=v.b.Parse((()=>new I),O,null,null);return void 0!==O.vignetteCentreX&&(f.vignetteCenterX=O.vignetteCentreX),void 0!==O.vignetteCentreY&&(f.vignetteCenterY=O.vignetteCentreY),f}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}I.TONEMAPPING_STANDARD=0,I.TONEMAPPING_ACES=1,I.TONEMAPPING_KHR_PBR_NEUTRAL=2,I.PrepareUniforms=q.g,I.PrepareSamplers=q.d,I._VIGNETTEMODE_MULTIPLY=0,I._VIGNETTEMODE_OPAQUE=1,(0,S.b)([(0,H.f)()],I.prototype,"colorCurves",void 0),(0,S.b)([(0,H.L)()],I.prototype,"_colorCurvesEnabled",void 0),(0,S.b)([(0,H.C)("colorGradingTexture")],I.prototype,"_colorGradingTexture",void 0),(0,S.b)([(0,H.L)()],I.prototype,"_colorGradingEnabled",void 0),(0,S.b)([(0,H.L)()],I.prototype,"_colorGradingWithGreenDepth",void 0),(0,S.b)([(0,H.L)()],I.prototype,"_colorGradingBGR",void 0),(0,S.b)([(0,H.L)()],I.prototype,"_exposure",void 0),(0,S.b)([(0,H.L)()],I.prototype,"_toneMappingEnabled",void 0),(0,S.b)([(0,H.L)()],I.prototype,"_toneMappingType",void 0),(0,S.b)([(0,H.L)()],I.prototype,"_contrast",void 0),(0,S.b)([(0,H.L)()],I.prototype,"vignetteStretch",void 0),(0,S.b)([(0,H.L)()],I.prototype,"vignetteCenterX",void 0),(0,S.b)([(0,H.L)()],I.prototype,"vignetteCenterY",void 0),(0,S.b)([(0,H.L)()],I.prototype,"vignetteWeight",void 0),(0,S.b)([(0,H.j)()],I.prototype,"vignetteColor",void 0),(0,S.b)([(0,H.L)()],I.prototype,"vignetteCameraFov",void 0),(0,S.b)([(0,H.L)()],I.prototype,"_vignetteBlendMode",void 0),(0,S.b)([(0,H.L)()],I.prototype,"_vignetteEnabled",void 0),(0,S.b)([(0,H.L)()],I.prototype,"_ditheringEnabled",void 0),(0,S.b)([(0,H.L)()],I.prototype,"_ditheringIntensity",void 0),(0,S.b)([(0,H.L)()],I.prototype,"_skipFinalColorClamp",void 0),(0,S.b)([(0,H.L)()],I.prototype,"_applyByPostProcess",void 0),(0,S.b)([(0,H.L)()],I.prototype,"_isEnabled",void 0),v.b._ImageProcessingConfigurationParser=I.Parse,(0,F.g)("BABYLON.ImageProcessingConfiguration",I)},11538:(O,f,y)=>{"use strict";y.d(f,{c:()=>q});var S=y(11289),H=y(11455),b=y(11294),h=y(11532),v=y(11497),N=y(11544),m=y(11490);class t extends v.e{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class q extends N.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(O,"DetailMap",140,new t,f),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=H.c.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=O._dirtyCallbacks[1]}isReadyForSubMesh(O,f,y){return!this._isEnabled||!(O._areTexturesDirty&&f.texturesEnabled&&y.getCaps().standardDerivatives&&this._texture&&h.b.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(O,f){if(this._isEnabled){O.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const y=f.getEngine();O._areTexturesDirty&&(y.getCaps().standardDerivatives&&this._texture&&h.b.DetailTextureEnabled&&this._isEnabled?((0,m.J)(this._texture,O,"DETAIL"),O.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):O.DETAIL=!1)}else O.DETAIL=!1}bindForSubMesh(O,f){if(!this._isEnabled)return;const y=this._material.isFrozen;O.useUbo&&y&&O.isSync||this._texture&&h.b.DetailTextureEnabled&&(O.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),(0,m.r)(this._texture,O,"detail")),f.texturesEnabled&&this._texture&&h.b.DetailTextureEnabled&&O.setTexture("detailSampler",this._texture)}hasTexture(O){return this._texture===O}getActiveTextures(O){this._texture&&O.push(this._texture)}getAnimatables(O){this._texture&&this._texture.animations&&this._texture.animations.length>0&&O.push(this._texture)}dispose(O){var f;O&&(null===(f=this._texture)||void 0===f||f.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(O){O.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,S.b)([(0,b.C)("detailTexture"),(0,b.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"texture",void 0),(0,S.b)([(0,b.L)()],q.prototype,"diffuseBlendLevel",void 0),(0,S.b)([(0,b.L)()],q.prototype,"roughnessBlendLevel",void 0),(0,S.b)([(0,b.L)()],q.prototype,"bumpLevel",void 0),(0,S.b)([(0,b.L)(),(0,b.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"normalBlendMethod",void 0),(0,S.b)([(0,b.L)(),(0,b.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"isEnabled",void 0)},11455:(O,f,y)=>{"use strict";y.d(f,{c:()=>X});var S=y(11289),H=y(11294),b=y(10995),h=y(11004),v=y(11042),N=y(11458),m=y(11380),t=y(11017),q=y(11434),F=y(11488),I=y(11362);class A{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(O){this._func=O}get funcRef(){return this._funcRef}set funcRef(O){this._funcRef=O}get funcMask(){return this._funcMask}set funcMask(O){this._funcMask=O}get opStencilFail(){return this._opStencilFail}set opStencilFail(O){this._opStencilFail=O}get opDepthFail(){return this._opDepthFail}set opDepthFail(O){this._opDepthFail=O}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(O){this._opStencilDepthPass=O}get mask(){return this._mask}set mask(O){this._mask=O}get enabled(){return this._enabled}set enabled(O){this._enabled=O}getClassName(){return"MaterialStencilState"}copyTo(O){I.b.Clone((()=>O),this)}serialize(){return I.b.Serialize(this)}parse(O,f,y){I.b.Parse((()=>this),O,f,y)}}(0,S.b)([(0,H.L)()],A.prototype,"func",null),(0,S.b)([(0,H.L)()],A.prototype,"funcRef",null),(0,S.b)([(0,H.L)()],A.prototype,"funcMask",null),(0,S.b)([(0,H.L)()],A.prototype,"opStencilFail",null),(0,S.b)([(0,H.L)()],A.prototype,"opDepthFail",null),(0,S.b)([(0,H.L)()],A.prototype,"opStencilDepthPass",null),(0,S.b)([(0,H.L)()],A.prototype,"mask",null),(0,S.b)([(0,H.L)()],A.prototype,"enabled",null);var J=y(11490);class X{get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(O){if(this._alpha===O)return;const f=this._alpha;this._alpha=O,1!==f&&1!==O||this.Dg(X.MiscDirtyFlag+X.PrePassDirtyFlag)}get alpha(){return this._alpha}set Wg(O){this._backFaceCulling!==O&&(this._backFaceCulling=O,this.Dg(X.TextureDirtyFlag))}get Wg(){return this._backFaceCulling}set cullBackFaces(O){this._cullBackFaces!==O&&(this._cullBackFaces=O,this.Dg(X.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(O){this._blockDirtyMechanism!==O&&(this._blockDirtyMechanism=O,O||this.bj())}atomicMaterialsUpdate(O){this.blockDirtyMechanism=!0;try{O(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(O){this._onDisposeObserver&&this.hj.remove(this._onDisposeObserver),this._onDisposeObserver=this.hj.add(O)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new h.d),this._onBindObservable}set onBind(O){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(O)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new h.d),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new h.d),this._onEffectCreatedObservable}set alphaMode(O){this._alphaMode!==O&&(this._alphaMode=O,this.Dg(X.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(O){this._needDepthPrePass!==O&&(this._needDepthPrePass=O,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(O){this._fogEnabled!==O&&(this._fogEnabled=O,this.Dg(X.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case X.WireFrameFillMode:case X.LineListDrawMode:case X.LineLoopDrawMode:case X.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(O){this.fillMode=O?X.WireFrameFillMode:X.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case X.PointFillMode:case X.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(O){this.fillMode=O?X.PointFillMode:X.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(O){this._fillMode!==O&&(this._fillMode=O,this.Dg(X.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(O){const f=this.va().getEngine().getCaps().fragmentDepthSupported;O&&!f&&t.e.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=O&&f,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(O){this._drawWrapper=O}constructor(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.hj=new h.d,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new A,this._useUBO=!1,this._fillMode=X.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._forceAlphaTest=!1,this._transparencyMode=null,this.name=O;const H=f||v.c.LastCreatedScene;H&&(this._scene=H,this._dirtyCallbacks={},this._forceGLSL=S,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[63]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=O||b.d.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new F.b(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new m.b(this._scene.getEngine(),void 0,void 0,O),this._useUBO=this.va().getEngine().supportsUniformBuffers,this._createUniformBuffer(),y||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),X.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var O;const f=this.va().getEngine();null===(O=this._uniformBuffer)||void 0===O||O.dispose(),f.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new m.b(f,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new m.b(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(O){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.bj(),this.checkReadyOnlyOnce=!0}unfreeze(){this.bj(),this.checkReadyOnlyOnce=!1}isReady(O,f){return!0}isReadyForSubMesh(O,f,y){const S=f.materialDefines;return!!S&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=S,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}va(){return this._scene}_getEffectiveOrientation(O){return null!==this.sideOrientation?this.sideOrientation:O.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(O){this._transparencyMode!==O&&(this._transparencyMode=O,this._forceAlphaTest=O===X.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _disableAlphaBlending(){return this._transparencyMode===X.MATERIAL_OPAQUE||this._transparencyMode===X.MATERIAL_ALPHATEST}needAlphaBlending(){return!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(O){return O.visibility<1||!this._disableAlphaBlending&&(O.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._forceAlphaTest}_shouldTurnAlphaTestOn(O){return!this.needAlphaBlendingForMesh(O)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}bj(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const f=this.va().meshes;for(const y of f)if(y.Yf)for(const f of y.Yf)if(f.Ha()===this)for(const y of f._drawWrappers)y&&this._materialContext===y.materialContext&&(y._wasPreviouslyReady=!1,y._wasPreviouslyUsingInstances=null,y._forceRebindOnNextCall=O);O&&this.Dg(X.AllDirtyFlag)}_preBind(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const y=this._scene.getEngine(),S=(null==f?this.sideOrientation:f)===X.ClockWiseSideOrientation;return y.enableEffect(O||this._getDrawWrapper()),y.setState(this.Wg,this.zOffset,!1,S,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),S}bind(O,f){}buildUniformLayout(){const O=this._uniformBuffer;this._eventInfo.ubo=O,this._callbackPluginEventGeneric(8,this._eventInfo),O.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(O,f,y){const S=y._drawWrapper;this._eventInfo.subMesh=y,this._callbackPluginEventBindForSubMesh(this._eventInfo),S._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(O){}bindView(O){this._useUBO?this._needToBindSceneUbo=!0:O.setMatrix("view",this.va().getViewMatrix())}bindViewProjection(O){this._useUBO?this._needToBindSceneUbo=!0:(O.setMatrix("viewProjection",this.va().getTransformMatrix()),O.setMatrix("projection",this.va().getProjectionMatrix()))}bindEyePosition(O,f){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(O,f)}_afterBind(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&f&&(this._needToBindSceneUbo=!1,(0,J.n)(f,this.va().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=O?O.visibility:1,this._onBindObservable&&O&&this._onBindObservable.notifyObservers(O),this.disableDepthWrite){const O=this._scene.getEngine();this._cachedDepthWriteState=O.getDepthWrite(),O.setDepthWrite(!1)}if(this.disableColorWrite){const O=this._scene.getEngine();this._cachedColorWriteState=O.getColorWrite(),O.setColorWrite(!1)}if(0!==this.depthFunction){const O=this._scene.getEngine();this._cachedDepthFunctionState=O.getDepthFunction()||0,O.setDepthFunction(this.depthFunction)}}unbind(){if(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(O){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=O,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(O){return null}_clonePlugins(O,f){const y={};if(this._serializePlugins(y),X._ParsePlugins(y,O,this._scene,f),this.pluginManager)for(const S of this.pluginManager._plugins){const f=O.pluginManager.getPlugin(S.name);f&&S.copyTo(f)}}getBindedMeshes(){if(this.meshMap){const O=[];for(const f in this.meshMap){const y=this.meshMap[f];y&&O.push(y)}return O}return this._scene.meshes.filter((O=>O.material===this))}forceCompilation(O,f,y,S){const H={clipPlane:!1,useInstances:!1,...y},b=this.va(),h=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const v=()=>{if(!this._scene||!this._scene.getEngine())return;const y=b.clipPlane;if(H.clipPlane&&(b.clipPlane=new q.b(0,0,0,1)),this._storeEffectOnSubMeshes){let y=!0,b=null;if(O.Yf){const f=new N.b(0,0,0,0,0,O,void 0,!1,!1);f.materialDefines&&(f.materialDefines._renderId=-1),this.isReadyForSubMesh(O,f,H.useInstances)||(f.effect&&f.effect.getCompilationError()&&f.effect.allFallbacksProcessed()?b=f.effect.getCompilationError():(y=!1,setTimeout(v,16)))}y&&(this.allowShaderHotSwapping=h,b&&S&&S(b),f&&f(this))}else this.isReady()?(this.allowShaderHotSwapping=h,f&&f(this)):setTimeout(v,16);H.clipPlane&&(b.clipPlane=y)};v()}forceCompilationAsync(O,f){return new Promise(((y,S)=>{this.forceCompilation(O,(()=>{y()}),f,(O=>{S(O)}))}))}Dg(O){this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(X._DirtyCallbackArray.length=0,O&X.TextureDirtyFlag&&X._DirtyCallbackArray.push(X._TextureDirtyCallBack),O&X.LightDirtyFlag&&X._DirtyCallbackArray.push(X._LightsDirtyCallBack),O&X.FresnelDirtyFlag&&X._DirtyCallbackArray.push(X._FresnelDirtyCallBack),O&X.AttributesDirtyFlag&&X._DirtyCallbackArray.push(X._AttributeDirtyCallBack),O&X.MiscDirtyFlag&&X._DirtyCallbackArray.push(X._MiscDirtyCallBack),O&X.PrePassDirtyFlag&&X._DirtyCallbackArray.push(X._PrePassDirtyCallBack),X._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(X._RunDirtyCallBacks),this.va().resetCachedMaterial())}resetDrawCache(){const O=this.va().meshes;for(const f of O)if(f.Yf)for(const O of f.Yf)O.Ha()===this&&O.resetDrawCache()}_markAllSubMeshesAsDirty(O){if(this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const f=this.va().meshes;for(const y of f)if(y.Yf)for(const f of y.Yf)if(f.Ha(!1)===this)for(const y of f._drawWrappers)y&&y.defines&&y.defines.markAllAsDirty&&this._materialContext===y.materialContext&&O(y.defines)}_markScenePrePassDirty(){if(this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const O=this.va().enablePrePassRenderer();O&&O.Dg()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(X._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(X._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(X._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(X._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(X._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(X._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(X._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(X._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(X._MiscDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(X._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const O=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.hj.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(O)}))}}setPrePassRenderer(O){return!1}dispose(O,f,y){const S=this.va();if(S.stopAnimation(this),S.freeProcessedMaterials(),S.removeMaterial(this),this._eventInfo.forceDisposeTextures=f,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const O=this._parentContainer.materials.indexOf(this);O>-1&&this._parentContainer.materials.splice(O,1),this._parentContainer=null}if(!0!==y)if(this.meshMap)for(const H in this.meshMap){const f=this.meshMap[H];f&&(f.material=null,this.releaseVertexArrayObject(f,O))}else{const f=S.meshes;for(const y of f)y.material!==this||y.sourceMesh||(y.material=null,this.releaseVertexArrayObject(y,O))}this._uniformBuffer.dispose(),O&&this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.hj.notifyObservers(this),this.hj.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}releaseVertexArrayObject(O,f){const y=O.Bj;if(y)if(this._storeEffectOnSubMeshes){if(O.Yf)for(const S of O.Yf)y._releaseVertexArrayObject(S.effect),f&&S.effect&&S.effect.dispose()}else y._releaseVertexArrayObject(this._drawWrapper.effect)}serialize(){const O=I.b.Serialize(this);return O.stencil=this.stencil.serialize(),O.uniqueId=this.uniqueId,this._serializePlugins(O),O}_serializePlugins(O){if(O.plugins={},this.pluginManager)for(const f of this.pluginManager._plugins)O.plugins[f.getClassName()]=f.serialize()}static Parse(O,f,y){if(O.customType){if("BABYLON.PBRMaterial"===O.customType&&O.overloadedAlbedo&&(O.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return t.e.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else O.customType="BABYLON.StandardMaterial";const S=b.d.Instantiate(O.customType).Parse(O,f,y);return S._loadedUniqueId=O.uniqueId,S}static _ParsePlugins(O,f,y,S){if(O.plugins)for(const v in O.plugins){var H,h;const N=O.plugins[v];let m=null===(H=f.pluginManager)||void 0===H?void 0:H.getPlugin(N.name);if(!m){const O=b.d.Instantiate("BABYLON."+v);O&&(m=new O(f))}null===(h=m)||void 0===h||h.parse(N,y,S)}}}X.TriangleFillMode=0,X.WireFrameFillMode=1,X.PointFillMode=2,X.PointListDrawMode=3,X.LineListDrawMode=4,X.LineLoopDrawMode=5,X.LineStripDrawMode=6,X.TriangleStripDrawMode=7,X.TriangleFanDrawMode=8,X.ClockWiseSideOrientation=0,X.CounterClockWiseSideOrientation=1,X.TextureDirtyFlag=1,X.LightDirtyFlag=2,X.FresnelDirtyFlag=4,X.AttributesDirtyFlag=8,X.MiscDirtyFlag=16,X.PrePassDirtyFlag=32,X.AllDirtyFlag=63,X.MATERIAL_OPAQUE=0,X.MATERIAL_ALPHATEST=1,X.MATERIAL_ALPHABLEND=2,X.MATERIAL_ALPHATESTANDBLEND=3,X.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,X.MATERIAL_NORMALBLENDMETHOD_RNM=1,X.OnEventObservable=new h.d,X._AllDirtyCallBack=O=>O.markAllAsDirty(),X._ImageProcessingDirtyCallBack=O=>O.markAsImageProcessingDirty(),X._TextureDirtyCallBack=O=>O.markAsTexturesDirty(),X._FresnelDirtyCallBack=O=>O.markAsFresnelDirty(),X._MiscDirtyCallBack=O=>O.markAsMiscDirty(),X._PrePassDirtyCallBack=O=>O.markAsPrePassDirty(),X._LightsDirtyCallBack=O=>O.markAsLightDirty(),X._AttributeDirtyCallBack=O=>O.markAsAttributesDirty(),X._FresnelAndMiscDirtyCallBack=O=>{X._FresnelDirtyCallBack(O),X._MiscDirtyCallBack(O)},X._TextureAndMiscDirtyCallBack=O=>{X._TextureDirtyCallBack(O),X._MiscDirtyCallBack(O)},X._DirtyCallbackArray=[],X._RunDirtyCallBacks=O=>{for(const f of X._DirtyCallbackArray)f(O)},(0,S.b)([(0,H.L)()],X.prototype,"id",void 0),(0,S.b)([(0,H.L)()],X.prototype,"uniqueId",void 0),(0,S.b)([(0,H.L)()],X.prototype,"name",void 0),(0,S.b)([(0,H.L)()],X.prototype,"metadata",void 0),(0,S.b)([(0,H.L)()],X.prototype,"checkReadyOnEveryCall",void 0),(0,S.b)([(0,H.L)()],X.prototype,"checkReadyOnlyOnce",void 0),(0,S.b)([(0,H.L)()],X.prototype,"state",void 0),(0,S.b)([(0,H.L)("alpha")],X.prototype,"_alpha",void 0),(0,S.b)([(0,H.L)("Wg")],X.prototype,"_backFaceCulling",void 0),(0,S.b)([(0,H.L)("cullBackFaces")],X.prototype,"_cullBackFaces",void 0),(0,S.b)([(0,H.L)()],X.prototype,"sideOrientation",void 0),(0,S.b)([(0,H.L)("alphaMode")],X.prototype,"_alphaMode",void 0),(0,S.b)([(0,H.L)()],X.prototype,"_needDepthPrePass",void 0),(0,S.b)([(0,H.L)()],X.prototype,"disableDepthWrite",void 0),(0,S.b)([(0,H.L)()],X.prototype,"disableColorWrite",void 0),(0,S.b)([(0,H.L)()],X.prototype,"forceDepthWrite",void 0),(0,S.b)([(0,H.L)()],X.prototype,"depthFunction",void 0),(0,S.b)([(0,H.L)()],X.prototype,"separateCullingPass",void 0),(0,S.b)([(0,H.L)("fogEnabled")],X.prototype,"_fogEnabled",void 0),(0,S.b)([(0,H.L)()],X.prototype,"pointSize",void 0),(0,S.b)([(0,H.L)()],X.prototype,"zOffset",void 0),(0,S.b)([(0,H.L)()],X.prototype,"zOffsetUnits",void 0),(0,S.b)([(0,H.L)()],X.prototype,"pointsCloud",null),(0,S.b)([(0,H.L)()],X.prototype,"fillMode",null),(0,S.b)([(0,H.L)()],X.prototype,"useLogarithmicDepth",null),(0,S.b)([(0,H.L)()],X.prototype,"transparencyMode",null)},11497:(O,f,y)=>{"use strict";y.d(f,{e:()=>S});class S{constructor(O){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=O,O)for(const f in O)Object.prototype.hasOwnProperty.call(O,f)&&this._setDefaultValue(f)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!1,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||O,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const O of Object.keys(this))"_"!==O[0]&&this._keys.push(O);if(this._externalProperties)for(const O in this._externalProperties)-1===this._keys.indexOf(O)&&this._keys.push(O)}isEqual(O){if(this._keys.length!==O._keys.length)return!1;for(let f=0;f<this._keys.length;f++){const y=this._keys[f];if(this[y]!==O[y])return!1}return!0}cloneTo(O){this._keys.length!==O._keys.length&&(O._keys=this._keys.slice(0));for(let f=0;f<this._keys.length;f++){const y=this._keys[f];O[y]=this[y]}}reset(){this._keys.forEach((O=>this._setDefaultValue(O)))}_setDefaultValue(O){var f,y,S,H;const b=(null===(f=this._externalProperties)||void 0===f||null===(y=f[O])||void 0===y?void 0:y.type)??typeof this[O],h=null===(S=this._externalProperties)||void 0===S||null===(H=S[O])||void 0===H?void 0:H.default;switch(b){case"number":this[O]=h??0;break;case"string":this[O]=h??"";break;default:this[O]=h??!1}}toString(){let O="";for(let f=0;f<this._keys.length;f++){const y=this._keys[f],S=this[y];switch(typeof S){case"number":case"string":O+="#define "+y+" "+S+"\n";break;default:S&&(O+="#define "+y+"\n")}}return O}}},11532:(O,f,y)=>{"use strict";y.d(f,{b:()=>H});var S=y(11092);class H{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(O){this._DiffuseTextureEnabled!==O&&(this._DiffuseTextureEnabled=O,S.c.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(O){this._DetailTextureEnabled!==O&&(this._DetailTextureEnabled=O,S.c.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(O){this._DecalMapEnabled!==O&&(this._DecalMapEnabled=O,S.c.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(O){this._AmbientTextureEnabled!==O&&(this._AmbientTextureEnabled=O,S.c.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(O){this._OpacityTextureEnabled!==O&&(this._OpacityTextureEnabled=O,S.c.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(O){this._ReflectionTextureEnabled!==O&&(this._ReflectionTextureEnabled=O,S.c.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(O){this._EmissiveTextureEnabled!==O&&(this._EmissiveTextureEnabled=O,S.c.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(O){this._SpecularTextureEnabled!==O&&(this._SpecularTextureEnabled=O,S.c.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(O){this._BumpTextureEnabled!==O&&(this._BumpTextureEnabled=O,S.c.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(O){this._LightmapTextureEnabled!==O&&(this._LightmapTextureEnabled=O,S.c.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(O){this._RefractionTextureEnabled!==O&&(this._RefractionTextureEnabled=O,S.c.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(O){this._ColorGradingTextureEnabled!==O&&(this._ColorGradingTextureEnabled=O,S.c.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(O){this._FresnelEnabled!==O&&(this._FresnelEnabled=O,S.c.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(O){this._ClearCoatTextureEnabled!==O&&(this._ClearCoatTextureEnabled=O,S.c.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(O){this._ClearCoatBumpTextureEnabled!==O&&(this._ClearCoatBumpTextureEnabled=O,S.c.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(O){this._ClearCoatTintTextureEnabled!==O&&(this._ClearCoatTintTextureEnabled=O,S.c.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(O){this._SheenTextureEnabled!==O&&(this._SheenTextureEnabled=O,S.c.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(O){this._AnisotropicTextureEnabled!==O&&(this._AnisotropicTextureEnabled=O,S.c.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(O){this._ThicknessTextureEnabled!==O&&(this._ThicknessTextureEnabled=O,S.c.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(O){this._RefractionIntensityTextureEnabled!==O&&(this._RefractionIntensityTextureEnabled=O,S.c.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(O){this._TranslucencyIntensityTextureEnabled!==O&&(this._TranslucencyIntensityTextureEnabled=O,S.c.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(O){this._TranslucencyColorTextureEnabled!==O&&(this._TranslucencyColorTextureEnabled=O,S.c.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(O){this._IridescenceTextureEnabled!==O&&(this._IridescenceTextureEnabled=O,S.c.MarkAllMaterialsAsDirty(1))}}H._DiffuseTextureEnabled=!0,H._DetailTextureEnabled=!0,H._DecalMapEnabled=!0,H._AmbientTextureEnabled=!0,H._OpacityTextureEnabled=!0,H._ReflectionTextureEnabled=!0,H._EmissiveTextureEnabled=!0,H._SpecularTextureEnabled=!0,H._BumpTextureEnabled=!0,H._LightmapTextureEnabled=!0,H._RefractionTextureEnabled=!0,H._ColorGradingTextureEnabled=!0,H._FresnelEnabled=!0,H._ClearCoatTextureEnabled=!0,H._ClearCoatBumpTextureEnabled=!0,H._ClearCoatTintTextureEnabled=!0,H._SheenTextureEnabled=!0,H._AnisotropicTextureEnabled=!0,H._ThicknessTextureEnabled=!0,H._RefractionIntensityTextureEnabled=!0,H._TranslucencyIntensityTextureEnabled=!0,H._TranslucencyColorTextureEnabled=!0,H._IridescenceTextureEnabled=!0},11490:(O,f,y)=>{"use strict";y.d(f,{$:()=>F,A:()=>o,D:()=>E,G:()=>x,J:()=>J,N:()=>l,Q:()=>i,T:()=>D,W:()=>V,_:()=>R,c:()=>B,e:()=>t,g:()=>u,j:()=>m,l:()=>I,n:()=>A,r:()=>X,s:()=>U,u:()=>w,w:()=>L,x:()=>p,z:()=>q});var S=y(11017),H=y(11359),b=y(11042),h=y(11445),v=y(11494);const N=H.d.Black();function m(O,f,y){if(!O||O.LOGARITHMICDEPTH||O.indexOf&&O.indexOf("LOGARITHMICDEPTH")>=0){const O=y.activeCamera;1===O.mode&&S.e.Error("Logarithmic depth is not compatible with orthographic cameras!",20),f.setFloat("logarithmicDepthConstant",2/(Math.log(O.maxZ+1)/Math.LN2))}}function t(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];y&&O.fogEnabled&&(!f||f.applyFog)&&0!==O.fogMode&&(y.setFloat4("vFogInfos",O.fogMode,O.fogStart,O.fogEnd,O.fogDensity),S?(O.fogColor.toLinearSpaceToRef(N,O.getEngine().useExactSrgbConversions),y.setColor3("vFogColor",N)):y.setColor3("vFogColor",O.fogColor))}function q(O,f,y){const H=y.NUM_MORPH_INFLUENCERS;if(H>0&&b.c.LastCreatedEngine){const h=b.c.LastCreatedEngine.getCaps().maxVertexAttribs,v=f.morphTargetManager;if(null!==v&&void 0!==v&&v.isUsingTextureForTargets)return;const N=v&&v.supportsNormals&&y.NORMAL,m=v&&v.supportsTangents&&y.TANGENT,t=v&&v.supportsUVs&&y.UV1;for(let y=0;y<H;y++)O.push("position"+y),N&&O.push("normal"+y),m&&O.push("tangent"+y),t&&O.push("uv_"+y),O.length>h&&S.e.Error("Cannot add more vertex attributes for mesh "+f.name)}}function F(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];O.push("world0"),O.push("world1"),O.push("world2"),O.push("world3"),f&&(O.push("previousWorld0"),O.push("previousWorld1"),O.push("previousWorld2"),O.push("previousWorld3"))}function I(O,f){const y=O.morphTargetManager;O&&y&&f.setFloatArray("morphTargetInfluences",y.influences)}function A(O,f){f.bindToEffect(O,"Scene")}function J(O,f,y){f._needUVs=!0,f[y]=!0,O.optimizeUVAllocation&&O.getTextureMatrix().isIdentityAs3x2()?(f[y+"DIRECTUV"]=O.coordinatesIndex+1,f["MAINUV"+(O.coordinatesIndex+1)]=!0):f[y+"DIRECTUV"]=0}function X(O,f,y){const S=O.getTextureMatrix();f.Fj(y+"Matrix",S)}function w(O,f,y){y.BAKED_VERTEX_ANIMATION_TEXTURE&&y.INSTANCES&&O.push("bakedVertexAnimationSettingsInstanced")}function B(O,f,y){var S;if(f&&O&&(O.computeBonesUsingShaders&&f._bonesComputationForcedToCPU&&(O.computeBonesUsingShaders=!1),O.useBones&&O.computeBonesUsingShaders&&O.skeleton)){const H=O.skeleton;if(H.isUsingTextureForMatrices&&f.getUniformIndex("boneTextureWidth")>-1){const y=H.getTransformMatrixTexture(O);f.setTexture("boneSampler",y),f.setFloat("boneTextureWidth",4*(H.bones.length+1))}else{const b=H.getTransformMatrices(O);b&&(f.setMatrices("mBones",b),y&&O.va().prePassRenderer&&O.va().prePassRenderer.getIndex(2)&&(y.previousBones[O.uniqueId]||(y.previousBones[O.uniqueId]=b.slice()),f.setMatrices("mPreviousBones",y.previousBones[O.uniqueId]),S=b,y.previousBones[O.uniqueId].set(S)))}}}function j(O,f,y,S,H){let b=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];O._bindLight(f,y,S,H,b)}function u(O,f,y,S){let H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const b=Math.min(f.lightSources.length,H);for(let h=0;h<b;h++){j(f.lightSources[h],h,O,y,"boolean"===typeof S?S:S.SPECULARTERM,f.receiveShadows)}}function L(O,f,y,S){y.NUM_BONE_INFLUENCERS>0&&(S.addCPUSkinningFallback(0,f),O.push("matricesIndices"),O.push("matricesWeights"),y.NUM_BONE_INFLUENCERS>4&&(O.push("matricesIndicesExtra"),O.push("matricesWeightsExtra")))}function p(O,f){(f.INSTANCES||f.THIN_INSTANCES)&&F(O,!!f.PREPASS_VELOCITY),f.INSTANCESCOLOR&&O.push("instanceColor")}function U(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,H=0;for(let b=0;b<y&&O["LIGHT"+b];b++)b>0&&(H=S+b,f.addFallback(H,"LIGHT"+b)),O.SHADOWS||(O["SHADOW"+b]&&f.addFallback(S,"SHADOW"+b),O["SHADOWPCF"+b]&&f.addFallback(S,"SHADOWPCF"+b),O["SHADOWPCSS"+b]&&f.addFallback(S,"SHADOWPCSS"+b),O["SHADOWPOISSON"+b]&&f.addFallback(S,"SHADOWPOISSON"+b),O["SHADOWESM"+b]&&f.addFallback(S,"SHADOWESM"+b),O["SHADOWCLOSEESM"+b]&&f.addFallback(S,"SHADOWCLOSEESM"+b));return H++}function l(O,f,y,S,H,b,h){let v=arguments.length>7&&void 0!==arguments[7]&&arguments[7];h._areMiscDirty&&(h.LOGARITHMICDEPTH=y,h.POINTSIZE=S,h.FOG=H&&function(O,f){return f.fogEnabled&&O.applyFog&&0!==f.fogMode}(O,f),h.NONUNIFORMSCALING=O.nonUniformScaling,h.ALPHATEST=b,h.DECAL_AFTER_DETAIL=v)}function x(O,f,y,S){let H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,b=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!y._areLightsDirty)return y._needNormals;let h=0;const v={needNormals:y._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(O.lightsEnabled&&!b)for(const m of f.lightSources)if(W(O,f,m,h,y,S,v),h++,h===H)break;y.SPECULARTERM=v.specularEnabled,y.SHADOWS=v.shadowEnabled;for(let m=h;m<H;m++)void 0!==y["LIGHT"+m]&&(y["LIGHT"+m]=!1,y["HEMILIGHT"+m]=!1,y["POINTLIGHT"+m]=!1,y["DIRLIGHT"+m]=!1,y["SPOTLIGHT"+m]=!1,y["SHADOW"+m]=!1,y["SHADOWCSM"+m]=!1,y["SHADOWCSMDEBUG"+m]=!1,y["SHADOWCSMNUM_CASCADES"+m]=!1,y["SHADOWCSMUSESHADOWMAXZ"+m]=!1,y["SHADOWCSMNOBLEND"+m]=!1,y["SHADOWCSM_RIGHTHANDED"+m]=!1,y["SHADOWPCF"+m]=!1,y["SHADOWPCSS"+m]=!1,y["SHADOWPOISSON"+m]=!1,y["SHADOWESM"+m]=!1,y["SHADOWCLOSEESM"+m]=!1,y["SHADOWCUBE"+m]=!1,y["SHADOWLOWQUALITY"+m]=!1,y["SHADOWMEDIUMQUALITY"+m]=!1);const N=O.getEngine().getCaps();return void 0===y.SHADOWFLOAT&&(v.needRebuild=!0),y.SHADOWFLOAT=v.shadowEnabled&&(N.textureFloatRender&&N.textureFloatLinearFiltering||N.textureHalfFloatRender&&N.textureHalfFloatLinearFiltering),y.LIGHTMAPEXCLUDED=v.lightmapMode,v.needRebuild&&y.rebuild(),v.needNormals}function W(O,f,y,S,H,b,v){switch(v.needNormals=!0,void 0===H["LIGHT"+S]&&(v.needRebuild=!0),H["LIGHT"+S]=!0,H["SPOTLIGHT"+S]=!1,H["HEMILIGHT"+S]=!1,H["POINTLIGHT"+S]=!1,H["DIRLIGHT"+S]=!1,y.prepareLightSpecificDefines(H,S),H["LIGHT_FALLOFF_PHYSICAL"+S]=!1,H["LIGHT_FALLOFF_GLTF"+S]=!1,H["LIGHT_FALLOFF_STANDARD"+S]=!1,y.falloffType){case h.d.FALLOFF_GLTF:H["LIGHT_FALLOFF_GLTF"+S]=!0;break;case h.d.FALLOFF_PHYSICAL:H["LIGHT_FALLOFF_PHYSICAL"+S]=!0;break;case h.d.FALLOFF_STANDARD:H["LIGHT_FALLOFF_STANDARD"+S]=!0}if(b&&!y.ph.equalsFloats(0,0,0)&&(v.specularEnabled=!0),H["SHADOW"+S]=!1,H["SHADOWCSM"+S]=!1,H["SHADOWCSMDEBUG"+S]=!1,H["SHADOWCSMNUM_CASCADES"+S]=!1,H["SHADOWCSMUSESHADOWMAXZ"+S]=!1,H["SHADOWCSMNOBLEND"+S]=!1,H["SHADOWCSM_RIGHTHANDED"+S]=!1,H["SHADOWPCF"+S]=!1,H["SHADOWPCSS"+S]=!1,H["SHADOWPOISSON"+S]=!1,H["SHADOWESM"+S]=!1,H["SHADOWCLOSEESM"+S]=!1,H["SHADOWCUBE"+S]=!1,H["SHADOWLOWQUALITY"+S]=!1,H["SHADOWMEDIUMQUALITY"+S]=!1,f&&f.receiveShadows&&O.shadowsEnabled&&y.shadowEnabled){const f=y.getShadowGenerator(O.activeCamera)??y.getShadowGenerator();if(f){const O=f.getShadowMap();O&&O.renderList&&O.renderList.length>0&&(v.shadowEnabled=!0,f.prepareDefines(H,S))}}y.lightmapMode!=h.d.LIGHTMAP_DEFAULT?(v.lightmapMode=!0,H["LIGHTMAPEXCLUDED"+S]=!0,H["LIGHTMAPNOSPECULAR"+S]=y.lightmapMode==h.d.LIGHTMAP_SHADOWSONLY):(H["LIGHTMAPEXCLUDED"+S]=!1,H["LIGHTMAPNOSPECULAR"+S]=!1)}function E(O,f,y,S,H){let b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,h=arguments.length>6&&void 0!==arguments[6]&&arguments[6],N=function(O,f){let y=!1;if(O.activeCamera){const S=f.CAMERA_ORTHOGRAPHIC?1:0,H=f.CAMERA_PERSPECTIVE?1:0,b=1===O.activeCamera.mode?1:0,h=0===O.activeCamera.mode?1:0;(S^b||H^h)&&(f.CAMERA_ORTHOGRAPHIC=1===b,f.CAMERA_PERSPECTIVE=1===h,y=!0)}return y}(O,S);!1!==b&&(N=(0,v.h)(y,O,S)),S.DEPTHPREPASS!==!f.getColorWrite()&&(S.DEPTHPREPASS=!S.DEPTHPREPASS,N=!0),S.INSTANCES!==H&&(S.INSTANCES=H,N=!0),S.THIN_INSTANCES!==h&&(S.THIN_INSTANCES=h,N=!0),N&&S.markAsUnprocessed()}function o(O,f,y,S){let H=arguments.length>4&&void 0!==arguments[4]&&arguments[4],b=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],h=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!f._areAttributesDirty&&f._needNormals===f._normals&&f._needUVs===f._uvs)return!1;f._normals=f._needNormals,f._uvs=f._needUVs,f.NORMAL=f._needNormals&&O.isVerticesDataPresent("normal"),f._needNormals&&O.isVerticesDataPresent("tangent")&&(f.TANGENT=!0);for(let v=1;v<=6;++v)f["UV"+v]=!!f._needUVs&&O.isVerticesDataPresent(`uv${1===v?"":v}`);if(y){const y=O.useVertexColors&&O.isVerticesDataPresent("color");f.VERTEXCOLOR=y,f.VERTEXALPHA=O.hasVertexAlpha&&y&&b}return O.isVerticesDataPresent("instanceColor")&&(O.hasInstances||O.hasThinInstances)&&(f.INSTANCESCOLOR=!0),S&&function(O,f){if(O.useBones&&O.computeBonesUsingShaders&&O.skeleton){f.NUM_BONE_INFLUENCERS=O.numBoneInfluencers;const y=void 0!==f.BONETEXTURE;if(O.skeleton.isUsingTextureForMatrices&&y)f.BONETEXTURE=!0;else{f.BonesPerMesh=O.skeleton.bones.length+1,f.BONETEXTURE=!y&&void 0;const S=O.va().prePassRenderer;if(S&&S.enabled){const y=-1===S.excludedSkinnedMesh.indexOf(O);f.BONES_VELOCITY_ENABLED=y}}}else f.NUM_BONE_INFLUENCERS=0,f.BonesPerMesh=0,void 0!==f.BONETEXTURE&&(f.BONETEXTURE=!1)}(O,f),H&&function(O,f){const y=O.morphTargetManager;y?(f.MORPHTARGETS_UV=y.supportsUVs&&f.UV1,f.MORPHTARGETS_TANGENT=y.supportsTangents&&f.TANGENT,f.MORPHTARGETS_NORMAL=y.supportsNormals&&f.NORMAL,f.NUM_MORPH_INFLUENCERS=y.numMaxInfluencers||y.numInfluencers,f.MORPHTARGETS=f.NUM_MORPH_INFLUENCERS>0,f.MORPHTARGETS_TEXTURE=y.isUsingTextureForTargets):(f.MORPHTARGETS_UV=!1,f.MORPHTARGETS_TANGENT=!1,f.MORPHTARGETS_NORMAL=!1,f.MORPHTARGETS=!1,f.NUM_MORPH_INFLUENCERS=0)}(O,f),h&&function(O,f){const y=O.bakedVertexAnimationManager;f.BAKED_VERTEX_ANIMATION_TEXTURE=!(!y||!y.isEnabled)}(O,f),!0}function i(O,f){if(O.activeCamera){const y=f.MULTIVIEW;f.MULTIVIEW=null!==O.activeCamera.outputRenderTarget&&O.activeCamera.outputRenderTarget.getViewCount()>1,f.MULTIVIEW!=y&&f.markAsUnprocessed()}}function D(O,f,y){const S=f.ORDER_INDEPENDENT_TRANSPARENCY,H=f.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;f.ORDER_INDEPENDENT_TRANSPARENCY=O.useOrderIndependentTransparency&&y,f.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!O.getEngine().getCaps().textureFloatLinearFiltering,S===f.ORDER_INDEPENDENT_TRANSPARENCY&&H===f.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||f.markAsUnprocessed()}function V(O,f,y){const S=f.PREPASS;if(!f._arePrePassDirty)return;const H=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(O.prePassRenderer&&O.prePassRenderer.enabled&&y){f.PREPASS=!0,f.SCENE_MRT_COUNT=O.prePassRenderer.mrtCount,f.PREPASS_NORMAL_WORLDSPACE=O.prePassRenderer.generateNormalsInWorldSpace,f.PREPASS_COLOR=!0,f.PREPASS_COLOR_INDEX=0;for(let y=0;y<H.length;y++){const S=O.prePassRenderer.getIndex(H[y].type);-1!==S?(f[H[y].define]=!0,f[H[y].index]=S):f[H[y].define]=!1}}else{f.PREPASS=!1;for(let O=0;O<H.length;O++)f[H[O].define]=!1}f.PREPASS!=S&&(f.markAsUnprocessed(),f.markAsImageProcessingDirty())}function g(O,f,y,S){let H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5&&void 0!==arguments[5]&&arguments[5];H&&H.push("Light"+O),b||(f.push("vLightData"+O,"vLightDiffuse"+O,"vLightSpecular"+O,"vLightDirection"+O,"vLightFalloff"+O,"vLightGround"+O,"lightMatrix"+O,"shadowsInfo"+O,"depthValues"+O),y.push("shadowTexture"+O),y.push("depthTexture"+O),f.push("viewFrustumZ"+O,"cascadeBlendFactor"+O,"lightSizeUVCorrection"+O,"depthCorrection"+O,"penumbraDarkness"+O,"frustumLengths"+O),S&&(y.push("projectionLightTexture"+O),f.push("textureProjectionMatrix"+O)))}function R(O,f,y){let S,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4,b=null;if(O.uniformsNames){const h=O;S=h.uniformsNames,b=h.uniformBuffersNames,f=h.samplers,y=h.defines,H=h.maxSimultaneousLights||0}else S=O,f||(f=[]);for(let h=0;h<H&&y["LIGHT"+h];h++)g(h,S,f,y["PROJECTEDLIGHTTEXTURE"+h],b);y.NUM_MORPH_INFLUENCERS&&(S.push("morphTargetInfluences"),S.push("morphTargetCount")),y.BAKED_VERTEX_ANIMATION_TEXTURE&&(S.push("bakedVertexAnimationSettings"),S.push("bakedVertexAnimationTextureSizeInverted"),S.push("bakedVertexAnimationTime"),f.push("bakedVertexAnimationTexture"))}},11549:(O,f,y)=>{"use strict";y.d(f,{d:()=>b});var S,H=y(11324);!function(O){O[O.Zero=0]="Zero",O[O.One=1]="One",O[O.MaxViewZ=2]="MaxViewZ"}(S||(S={}));class b{static CreateConfiguration(O){return b._Configurations[O]={defines:{},previousWorldMatrices:{},previousViewProjection:H.b.Zero(),currentViewProjection:H.b.Zero(),previousBones:{},lastUpdateFrameId:-1,excludedSkinnedMesh:[]},b._Configurations[O]}static DeleteConfiguration(O){delete b._Configurations[O]}static GetConfiguration(O){return b._Configurations[O]}static AddUniformsAndSamplers(O,f){O.push("previousWorld","previousViewProjection","mPreviousBones")}static MarkAsDirty(O,f){for(const y of f)if(y.Yf)for(const f of y.Yf)f._removeDrawWrapper(O)}static PrepareDefines(O,f,y){if(!y._arePrePassDirty)return;const S=b._Configurations[O];if(!S)return;y.PREPASS=!0,y.PREPASS_COLOR=!1,y.PREPASS_COLOR_INDEX=-1;let H=0;for(let h=0;h<b.GeometryTextureDescriptions.length;h++){const O=b.GeometryTextureDescriptions[h],f=O.define,v=O.defineIndex,N=S.defines[v];void 0!==N?(y[f]=!0,y[v]=N,H++):(y[f]=!1,delete y[v])}y.SCENE_MRT_COUNT=H,y.BONES_VELOCITY_ENABLED=f.useBones&&f.computeBonesUsingShaders&&f.skeleton&&!f.skeleton.isUsingTextureForMatrices&&-1===S.excludedSkinnedMesh.indexOf(f)}static Bind(O,f,y,S){const H=b._Configurations[O];if(H&&(void 0!==H.defines.PREPASS_VELOCITY_INDEX||void 0!==H.defines.PREPASS_VELOCITY_LINEAR_INDEX)){H.previousWorldMatrices[y.uniqueId]||(H.previousWorldMatrices[y.uniqueId]=S.clone());const O=y.va();H.previousViewProjection||(H.previousViewProjection=O.getTransformMatrix().clone(),H.currentViewProjection=O.getTransformMatrix().clone());const b=O.getEngine();if(H.currentViewProjection.updateFlag!==O.getTransformMatrix().updateFlag?(H.lastUpdateFrameId=b.frameId,H.previousViewProjection.p(H.currentViewProjection),H.currentViewProjection.p(O.getTransformMatrix())):H.lastUpdateFrameId!==b.frameId&&(H.lastUpdateFrameId=b.frameId,H.previousViewProjection.p(H.currentViewProjection)),f.setMatrix("previousWorld",H.previousWorldMatrices[y.uniqueId]),f.setMatrix("previousViewProjection",H.previousViewProjection),H.previousWorldMatrices[y.uniqueId]=S.clone(),y.useBones&&y.computeBonesUsingShaders&&y.skeleton){const O=y.skeleton;if(!O.isUsingTextureForMatrices||-1===f.getUniformIndex("boneTextureWidth")){const S=O.getTransformMatrices(y);S&&(H.previousBones[y.uniqueId]||(H.previousBones[y.uniqueId]=S.slice()),f.setMatrices("mPreviousBones",H.previousBones[y.uniqueId]),H.previousBones[y.uniqueId].set(S))}}}}}b.GeometryTextureDescriptions=[{type:0,name:"Irradiance",clearType:0,define:"PREPASS_IRRADIANCE",defineIndex:"PREPASS_IRRADIANCE_INDEX"},{type:1,name:"WorldPosition",clearType:0,define:"PREPASS_POSITION",defineIndex:"PREPASS_POSITION_INDEX"},{type:2,name:"Velocity",clearType:0,define:"PREPASS_VELOCITY",defineIndex:"PREPASS_VELOCITY_INDEX"},{type:3,name:"Reflectivity",clearType:0,define:"PREPASS_REFLECTIVITY",defineIndex:"PREPASS_REFLECTIVITY_INDEX"},{type:5,name:"ViewDepth",clearType:2,define:"PREPASS_DEPTH",defineIndex:"PREPASS_DEPTH_INDEX"},{type:6,name:"ViewNormal",clearType:0,define:"PREPASS_NORMAL",defineIndex:"PREPASS_NORMAL_INDEX"},{type:7,name:"AlbedoSqrt",clearType:0,define:"PREPASS_ALBEDO_SQRT",defineIndex:"PREPASS_ALBEDO_SQRT_INDEX"},{type:8,name:"WorldNormal",clearType:0,define:"PREPASS_WORLD_NORMAL",defineIndex:"PREPASS_WORLD_NORMAL_INDEX"},{type:9,name:"LocalPosition",clearType:0,define:"PREPASS_LOCAL_POSITION",defineIndex:"PREPASS_LOCAL_POSITION_INDEX"},{type:10,name:"ScreenDepth",clearType:1,define:"PREPASS_SCREENSPACE_DEPTH",defineIndex:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:11,name:"LinearVelocity",clearType:0,define:"PREPASS_VELOCITY_LINEAR",defineIndex:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:12,name:"Albedo",clearType:0,define:"PREPASS_ALBEDO",defineIndex:"PREPASS_ALBEDO_INDEX"}],b._Configurations={}},11544:(O,f,y)=>{"use strict";y.d(f,{b:()=>w});var S=y(11289),H=y(11294),b=y(11455),h=y(11042),v=y(11070),N=y(11101);const m=new RegExp("^([gimus]+)!");class t{constructor(O){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=O,this._scene=O.va(),this._engine=this._scene.getEngine()}_addPlugin(O){for(let S=0;S<this._plugins.length;++S)if(this._plugins[S].name===O.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!O.isCompatible(this._material.shaderLanguage))throw`The plugin "${O.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const f=O.getClassName();t._MaterialPluginClassToMainDefine[f]||(t._MaterialPluginClassToMainDefine[f]="MATERIALPLUGIN_"+ ++t._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(O,f)=>this._handlePluginEvent(O,f),this._plugins.push(O),this._plugins.sort(((O,f)=>O.priority-f.priority)),this._codeInjectionPoints={};const y={};y[t._MaterialPluginClassToMainDefine[f]]={type:"boolean",default:!0};for(const S of this._plugins)S.collectDefines(y),this._collectPointNames("vertex",S.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",S.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=y,!0}_activatePlugin(O){-1===this._activePlugins.indexOf(O)&&(this._activePlugins.push(O),this._activePlugins.sort(((O,f)=>O.priority-f.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),O.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(O),this._activePluginsForExtraEvents.sort(((O,f)=>O.priority-f.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(O){for(let f=0;f<this._plugins.length;++f)if(this._plugins[f].name===O)return this._plugins[f];return null}_handlePluginEventIsReadyForSubMesh(O){let f=!0;for(const y of this._activePlugins)f=f&&y.isReadyForSubMesh(O.defines,this._scene,this._engine,O.subMesh);O.isReadyForSubMesh=f}_handlePluginEventPrepareDefinesBeforeAttributes(O){for(const f of this._activePlugins)f.prepareDefinesBeforeAttributes(O.defines,this._scene,O.mesh)}_handlePluginEventPrepareDefines(O){for(const f of this._activePlugins)f.prepareDefines(O.defines,this._scene,O.mesh)}_handlePluginEventHardBindForSubMesh(O){for(const f of this._activePluginsForExtraEvents)f.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,O.subMesh)}_handlePluginEventBindForSubMesh(O){for(const f of this._activePlugins)f.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,O.subMesh)}_handlePluginEventHasRenderTargetTextures(O){let f=!1;for(const y of this._activePluginsForExtraEvents)if(f=y.hasRenderTargetTextures(),f)break;O.hasRenderTargetTextures=f}_handlePluginEventFillRenderTargetTextures(O){for(const f of this._activePluginsForExtraEvents)f.fillRenderTargetTextures(O.renderTargets)}_handlePluginEvent(O,f){switch(O){case 512:{const O=f;for(const f of this._activePlugins)f.getActiveTextures(O.activeTextures);break}case 256:{const O=f;for(const f of this._activePlugins)f.getAnimatables(O.animatables);break}case 1024:{const O=f;let y=!1;for(const f of this._activePlugins)if(y=f.hasTexture(O.texture),y)break;O.hasTexture=y;break}case 2:{const O=f;for(const f of this._plugins)f.dispose(O.forceDisposeTextures);break}case 4:f.defineNames=this._defineNamesFromPlugins;break;case 128:{const O=f;for(const f of this._activePlugins)O.fallbackRank=f.addFallbacks(O.defines,O.fallbacks,O.fallbackRank),f.getAttributes(O.attributes,this._scene,O.mesh);this._uniformList.length>0&&O.uniforms.push(...this._uniformList),this._samplerList.length>0&&O.samplers.push(...this._samplerList),this._uboList.length>0&&O.uniformBuffersNames.push(...this._uboList),O.customCode=this._injectCustomCode(O,O.customCode);break}case 8:{const O=f;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const y=1===this._material.shaderLanguage;for(const f of this._plugins){const S=f.getUniforms(this._material.shaderLanguage);if(S){if(S.ubo)for(const f of S.ubo){if(f.size&&f.type){const S=f.arraySize??0;if(O.ubo.addUniform(f.name,f.size,S),y){let O;switch(f.type){case"mat4":O="mat4x4f";break;case"float":O="f32";break;default:O=`${f.type}f`}this._uboDeclaration+=`uniform ${f.name}: ${O}${S>0?`[${S}]`:""};\n`}else this._uboDeclaration+=`${f.type} ${f.name}${S>0?`[${S}]`:""};\n`}this._uniformList.push(f.name)}S.vertex&&(this._vertexDeclaration+=S.vertex+"\n"),S.fragment&&(this._fragmentDeclaration+=S.fragment+"\n")}f.getSamplers(this._samplerList),f.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(O,f){if(f)for(const y in f)this._codeInjectionPoints[O]||(this._codeInjectionPoints[O]={}),this._codeInjectionPoints[O][y]=!0}_injectCustomCode(O,f){return(y,S)=>{var H;f&&(S=f(y,S)),this._uboDeclaration&&(S=S.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(S=S.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(S=S.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const b=null===(H=this._codeInjectionPoints)||void 0===H?void 0:H[y];if(!b)return S;let h=null;for(let f in b){let H="";for(const S of this._activePlugins){var t;let b=null===(t=S.getCustomCode(y,this._material.shaderLanguage))||void 0===t?void 0:t[f];if(b){if(S.resolveIncludes){if(null===h){const f=0;h={defines:[],indexParameters:O.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:N.c.GetShadersRepository(f),includesShadersStore:N.c.GetIncludesShadersStore(f),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}h.isFragment="fragment"===y,(0,v.j)(b,h,(O=>b=O))}H+=b+"\n"}}if(H.length>0)if("!"===f.charAt(0)){f=f.substring(1);let O="g";if("!"===f.charAt(0))O="",f=f.substring(1);else{const y=m.exec(f);y&&y.length>=2&&(O=y[1],f=f.substring(O.length+1))}O.indexOf("g")<0&&(O+="g");const y=S,b=new RegExp(f,O);let h=b.exec(y);for(;null!==h;){let O=H;for(let f=0;f<h.length;++f)O=O.replace("$"+f,h[f]);S=S.replace(h[0],O),h=b.exec(y)}}else{const O="#define "+f;S=S.replace(O,"\n"+H+"\n"+O)}}return S}}}t._MaterialPluginClassToMainDefine={},t._MaterialPluginCounter=0,h.c.OnEnginesDisposedObservable.add((()=>{A()}));const q=[];let F=!1,I=null;function A(){q.length=0,F=!1,b.c.OnEventObservable.remove(I),I=null}var J=y(11362),X=y(11153);class w{isCompatible(O){return 0===O}_enable(O){O&&this._pluginManager._activatePlugin(this)}constructor(O,f,y,S){let H=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],b=arguments.length>5&&void 0!==arguments[5]&&arguments[5],h=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this._material=O,this.name=f,this.priority=y,this.resolveIncludes=h,O.pluginManager||(O.pluginManager=new t(O),O.hj.add((()=>{O.pluginManager=void 0}))),this._pluginDefineNames=S,this._pluginManager=O.pluginManager,H&&this._pluginManager._addPlugin(this),b&&this._enable(!0),this.markAllDefinesAsDirty=O._dirtyCallbacks[63]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(O,f,y,S){return!0}hardBindForSubMesh(O,f,y,S){}bindForSubMesh(O,f,y,S){}dispose(O){}getCustomCode(O){return null}collectDefines(O){if(this._pluginDefineNames)for(const f of Object.keys(this._pluginDefineNames)){if("_"===f[0])continue;const y=typeof this._pluginDefineNames[f];O[f]={type:"number"===y?"number":"string"===y?"string":"boolean"===y?"boolean":"object",default:this._pluginDefineNames[f]}}}prepareDefinesBeforeAttributes(O,f,y){}prepareDefines(O,f,y){}hasTexture(O){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(O){}getActiveTextures(O){}getAnimatables(O){}addFallbacks(O,f,y){return y}getSamplers(O){}getAttributes(O,f,y){}getUniformBuffersNames(O){}getUniforms(){return{}}copyTo(O){J.b.Clone((()=>O),this)}serialize(){return J.b.Serialize(this)}parse(O,f,y){J.b.Parse((()=>this),O,f,y)}}(0,S.b)([(0,H.L)()],w.prototype,"name",void 0),(0,S.b)([(0,H.L)()],w.prototype,"priority",void 0),(0,S.b)([(0,H.L)()],w.prototype,"resolveIncludes",void 0),(0,S.b)([(0,H.L)()],w.prototype,"registerForExtraEvents",void 0),(0,X.g)("BABYLON.MaterialPluginBase",w)},11615:(O,f,y)=>{"use strict";y.d(f,{d:()=>h});var S=y(11455),H=y(11317),b=y(11153);class h extends S.c{get $f(){return this._subMaterials}set $f(O){this._subMaterials=O,this._hookArray(O)}getChildren(){return this.$f}constructor(O,f){super(O,f,!0),this._waitingSubMaterialsUniqueIds=[],this.va().addMultiMaterial(this),this.$f=[],this._storeEffectOnSubMeshes=!0}_hookArray(O){var f=this;const y=O.push;O.push=function(){for(var S=arguments.length,H=new Array(S),b=0;b<S;b++)H[b]=arguments[b];const h=y.apply(O,H);return f._markAllSubMeshesAsTexturesDirty(),h};const S=O.splice;O.splice=(f,y)=>{const H=S.apply(O,[f,y]);return this._markAllSubMeshesAsTexturesDirty(),H}}getSubMaterial(O){return O<0||O>=this.$f.length?this.va().defaultMaterial:this.$f[O]}getActiveTextures(){return super.getActiveTextures().concat(...this.$f.map((O=>O?O.getActiveTextures():[])))}hasTexture(O){if(super.hasTexture(O))return!0;for(let y=0;y<this.$f.length;y++){var f;if(null!==(f=this.$f[y])&&void 0!==f&&f.hasTexture(O))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(O,f,y){for(let S=0;S<this.$f.length;S++){const H=this.$f[S];if(H){if(H._storeEffectOnSubMeshes){if(!H.isReadyForSubMesh(O,f,y))return!1;continue}if(!H.isReady(O))return!1}}return!0}clone(O,f){const y=new h(O,this.va());for(let S=0;S<this.$f.length;S++){let H=null;const b=this.$f[S];H=f&&b?b.clone(O+"-"+b.name):this.$f[S],y.$f.push(H)}return y}serialize(){const O={};O.name=this.name,O.id=this.id,O.uniqueId=this.uniqueId,H.d&&(O.tags=H.d.GetTags(this)),O.materialsUniqueIds=[],O.materials=[];for(let f=0;f<this.$f.length;f++){const y=this.$f[f];y?(O.materialsUniqueIds.push(y.uniqueId),O.materials.push(y.id)):(O.materialsUniqueIds.push(null),O.materials.push(null))}return O}dispose(O,f,y){const S=this.va();if(!S)return;if(y)for(let b=0;b<this.$f.length;b++){const y=this.$f[b];y&&y.dispose(O,f)}const H=S.multiMaterials.indexOf(this);H>=0&&S.multiMaterials.splice(H,1),super.dispose(O,f)}static ParseMultiMaterial(O,f){const y=new h(O.name,f);return y.id=O.id,y._loadedUniqueId=O.uniqueId,H.d&&H.d.AddTagsTo(y,O.tags),O.materialsUniqueIds?y._waitingSubMaterialsUniqueIds=O.materialsUniqueIds:O.materials.forEach((O=>y.$f.push(f.getLastMaterialById(O)))),y}}(0,b.g)("BABYLON.MultiMaterial",h)},11451:(O,f,y)=>{"use strict";y.d(f,{e:()=>S});class S{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(O){O.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(O){}bindForSubMesh(O,f,y,S,H){if(f.prePassRenderer&&f.prePassRenderer.enabled&&f.prePassRenderer.currentRTisSceneRT&&(-1!==f.prePassRenderer.getIndex(2)||-1!==f.prePassRenderer.getIndex(11))){this.previousWorldMatrices[y.uniqueId]||(this.previousWorldMatrices[y.uniqueId]=S.clone()),this.previousViewProjection||(this.previousViewProjection=f.getTransformMatrix().clone(),this.currentViewProjection=f.getTransformMatrix().clone());const H=f.getEngine();this.currentViewProjection.updateFlag!==f.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=H.frameId,this.previousViewProjection.p(this.currentViewProjection),this.currentViewProjection.p(f.getTransformMatrix())):this._lastUpdateFrameId!==H.frameId&&(this._lastUpdateFrameId=H.frameId,this.previousViewProjection.p(this.currentViewProjection)),O.setMatrix("previousWorld",this.previousWorldMatrices[y.uniqueId]),O.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[y.uniqueId]=S.clone()}}}},11506:(O,f,y)=>{"use strict";y.d(f,{e:()=>b});var S=y(11324),H=y(11455);class b extends H.c{constructor(O,f){let y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(O,f,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new S.b,this._storeEffectOnSubMeshes=y}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(O,f){return!!O&&(!this._storeEffectOnSubMeshes||(!O.Yf||0===O.Yf.length||this.isReadyForSubMesh(O,O.Yf[0],f)))}_isReadyForSubMesh(O){const f=O.materialDefines;return!(this.checkReadyOnEveryCall||!O.effect||!f||f._renderId!==this.va().getRenderId())}bindOnlyWorldMatrix(O){this._activeEffect.setMatrix("world",O)}bindOnlyNormalMatrix(O){this._activeEffect.setMatrix("normalMatrix",O)}bind(O,f){f&&this.bindForSubMesh(O,f,f.Yf[0])}_afterBind(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2?arguments[2]:void 0;super._afterBind(O,f,y),this.va()._cachedEffect=f,y?y._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return y._drawWrapper._forceRebindOnNextCall||O.isCachedMaterialInvalid(this,f,S)}dispose(O,f,y){this._activeEffect=void 0,super.dispose(O,f,y)}}},11284:(O,f,y)=>{"use strict";y.d(f,{b:()=>W});var S=y(11289),H=y(11294),b=y(11302),h=y(11311),v=y(11324),N=y(11359),m=y(11392),t=y(11451),q=y(11352),F=y(11455),I=y(11497),A=y(11506),J=y(11509),X=y(11153),w=y(11532),B=y(11536),j=y(11538),u=y(11494),L=y(11490),p=y(11362),U=y(11549);const l={effect:null,subMesh:null};class x extends I.e{constructor(O){super(O),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(O){const f=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const y of f)this[y]=y===O}}class W extends A.e{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(O){this._attachImageProcessingConfiguration(O),this._markAllSubMeshesAsTexturesDirty()}_attachImageProcessingConfiguration(O){O!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=O||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(O){this.imageProcessingConfiguration.colorCurvesEnabled=O}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(O){this.imageProcessingConfiguration.colorGradingEnabled=O}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(O){this._imageProcessingConfiguration.toneMappingEnabled=O}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(O){this._imageProcessingConfiguration.exposure=O}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(O){this._imageProcessingConfiguration.contrast=O}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(O){this._imageProcessingConfiguration.colorGradingTexture=O}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(O){this._imageProcessingConfiguration.colorCurves=O}get canRenderToMRT(){return!0}constructor(O,f){super(O,f,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||W.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new N.d(0,0,0),this.diffuseColor=new N.d(1,1,1),this.specularColor=new N.d(1,1,1),this.emissiveColor=new N.d(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new b.g(16),this._worldViewProjectionMatrix=v.b.Zero(),this._globalAmbientColor=new N.d(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new j.c(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new t.e,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),W.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),W.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(W.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(W.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}getClassName(){return"ob"}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return!!this._forceAlphaTest||this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===F.c.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.ke&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==F.c.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.ke||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(O,f){let S=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._uniformBufferLayoutBuilt||this.buildUniformLayout();const H=f._drawWrapper;if(H.effect&&this.isFrozen&&H._wasPreviouslyReady&&H._wasPreviouslyUsingInstances===S)return!0;f.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),f.materialDefines=new x(this._eventInfo.defineNames));const b=this.va(),h=f.materialDefines;if(this._isReadyForSubMesh(f))return!0;const v=b.getEngine();h._needNormals=(0,L.G)(b,O,h,!0,this._maxSimultaneousLights,this._disableLighting),(0,L.Q)(b,h);const N=this.needAlphaBlendingForMesh(O)&&this.va().useOrderIndependentTransparency;if((0,L.W)(b,h,this.canRenderToMRT&&!N),(0,L.T)(b,h,N),U.d.PrepareDefines(v.currentRenderPassId,O,h),h._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,h._needUVs=!1;for(let O=1;O<=6;++O)h["MAINUV"+O]=!1;if(b.texturesEnabled){if(h.DIFFUSEDIRECTUV=0,h.BUMPDIRECTUV=0,h.AMBIENTDIRECTUV=0,h.OPACITYDIRECTUV=0,h.EMISSIVEDIRECTUV=0,h.SPECULARDIRECTUV=0,h.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&W.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,L.J)(this._diffuseTexture,h,"DIFFUSE")}else h.DIFFUSE=!1;if(this._ambientTexture&&W.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;(0,L.J)(this._ambientTexture,h,"AMBIENT")}else h.AMBIENT=!1;if(this._opacityTexture&&W.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;(0,L.J)(this._opacityTexture,h,"OPACITY"),h.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else h.OPACITY=!1;if(this._reflectionTexture&&W.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(h._needNormals=!0,h.REFLECTION=!0,h.ROUGHNESS=this._roughness>0,h.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,h.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===J.e.INVCUBIC_MODE,h.REFLECTIONMAP_3D=this._reflectionTexture.isCube,h.REFLECTIONMAP_OPPOSITEZ=h.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,h.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case J.e.EXPLICIT_MODE:h.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case J.e.PLANAR_MODE:h.setReflectionMode("REFLECTIONMAP_PLANAR");break;case J.e.PROJECTION_MODE:h.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case J.e.SKYBOX_MODE:h.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case J.e.SPHERICAL_MODE:h.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case J.e.EQUIRECTANGULAR_MODE:h.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case J.e.FIXED_EQUIRECTANGULAR_MODE:h.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case J.e.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:h.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case J.e.CUBIC_MODE:case J.e.INVCUBIC_MODE:default:h.setReflectionMode("REFLECTIONMAP_CUBIC")}h.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else h.REFLECTION=!1,h.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&W.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;(0,L.J)(this._emissiveTexture,h,"EMISSIVE")}else h.EMISSIVE=!1;if(this._lightmapTexture&&W.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;(0,L.J)(this._lightmapTexture,h,"LIGHTMAP"),h.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,h.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else h.LIGHTMAP=!1;if(this._specularTexture&&W.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;(0,L.J)(this._specularTexture,h,"SPECULAR"),h.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else h.SPECULAR=!1;if(b.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&W.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,L.J)(this._bumpTexture,h,"BUMP"),h.PARALLAX=this._useParallax,h.PARALLAX_RHS=b.useRightHandedSystem,h.PARALLAXOCCLUSION=this._useParallaxOcclusion,h.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else h.BUMP=!1,h.PARALLAX=!1,h.PARALLAX_RHS=!1,h.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&W.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;h._needUVs=!0,h.REFRACTION=!0,h.REFRACTIONMAP_3D=this._refractionTexture.isCube,h.RGBDREFRACTION=this._refractionTexture.isRGBD,h.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else h.REFRACTION=!1;h.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else h.DIFFUSE=!1,h.AMBIENT=!1,h.OPACITY=!1,h.REFLECTION=!1,h.EMISSIVE=!1,h.LIGHTMAP=!1,h.BUMP=!1,h.REFRACTION=!1;h.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),h.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,h.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,h.SPECULAROVERALPHA=this._useSpecularOverAlpha,h.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,h.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,h.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(O)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=h,this._eventInfo.subMesh=f,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(h._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(h),h.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,h.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}h._areFresnelDirty&&(W.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(h.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,h.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,h.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,h.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,h.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,h.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,h._needNormals=!0,h.FRESNEL=!0):h.FRESNEL=!1),(0,L.N)(O,b,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(O)||this._forceAlphaTest,h,this._applyDecalMapAfterDetailMap),(0,L.D)(b,v,this,h,S,null,f.getRenderingMesh().hasThinInstances),this._eventInfo.defines=h,this._eventInfo.mesh=O,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,L.A)(O,h,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let F=!1;if(h.isDirty){const S=h._areLightsDisposed;h.markAsProcessed();const H=new B.c;h.REFLECTION&&H.addFallback(0,"REFLECTION"),h.SPECULAR&&H.addFallback(0,"SPECULAR"),h.BUMP&&H.addFallback(0,"BUMP"),h.PARALLAX&&H.addFallback(1,"PARALLAX"),h.PARALLAX_RHS&&H.addFallback(1,"PARALLAX_RHS"),h.PARALLAXOCCLUSION&&H.addFallback(0,"PARALLAXOCCLUSION"),h.SPECULAROVERALPHA&&H.addFallback(0,"SPECULAROVERALPHA"),h.FOG&&H.addFallback(1,"FOG"),h.POINTSIZE&&H.addFallback(0,"POINTSIZE"),h.LOGARITHMICDEPTH&&H.addFallback(0,"LOGARITHMICDEPTH"),(0,L.s)(h,H,this._maxSimultaneousLights),h.SPECULARTERM&&H.addFallback(0,"SPECULARTERM"),h.DIFFUSEFRESNEL&&H.addFallback(1,"DIFFUSEFRESNEL"),h.OPACITYFRESNEL&&H.addFallback(2,"OPACITYFRESNEL"),h.REFLECTIONFRESNEL&&H.addFallback(3,"REFLECTIONFRESNEL"),h.EMISSIVEFRESNEL&&H.addFallback(4,"EMISSIVEFRESNEL"),h.FRESNEL&&H.addFallback(4,"FRESNEL"),h.MULTIVIEW&&H.addFallback(0,"MULTIVIEW");const N=[m.f.PositionKind];h.NORMAL&&N.push(m.f.NormalKind),h.TANGENT&&N.push(m.f.TangentKind);for(let O=1;O<=6;++O)h["UV"+O]&&N.push(`uv${1===O?"":O}`);h.VERTEXCOLOR&&N.push(m.f.ColorKind),(0,L.w)(N,O,h,H),(0,L.x)(N,h),(0,L.z)(N,O,h),(0,L.u)(N,O,h);let I="default";const A=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices"],J=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],X=["Material","Scene","Mesh"],w={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:h.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=H,this._eventInfo.fallbackRank=0,this._eventInfo.defines=h,this._eventInfo.uniforms=A,this._eventInfo.attributes=N,this._eventInfo.samplers=J,this._eventInfo.uniformBuffersNames=X,this._eventInfo.customCode=void 0,this._eventInfo.mesh=O,this._eventInfo.indexParameters=w,this._callbackPluginEventGeneric(128,this._eventInfo),U.d.AddUniformsAndSamplers(A,J),t.e.AddUniforms(A),t.e.AddSamplers(J),q.c&&(q.c.PrepareUniforms(A,h),q.c.PrepareSamplers(J,h)),(0,L._)({uniformsNames:A,uniformBuffersNames:X,samplers:J,defines:h,maxSimultaneousLights:this._maxSimultaneousLights}),(0,u.b)(A);const j={};this.customShaderNameResolve&&(I=this.customShaderNameResolve(I,A,X,J,h,N,j));const p=h.toString(),x=f.effect;let W=b.getEngine().createEffect(I,{attributes:N,uniformsNames:A,uniformBuffersNames:X,samplers:J,defines:p,fallbacks:H,onCompiled:this.onCompiled,onError:this.onError,indexParameters:w,processFinalCode:j.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:h.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([y.e(21),y.e(19)]).then(y.bind(y,12940)),Promise.all([y.e(22),y.e(20)]).then(y.bind(y,13096))]):await Promise.all([Promise.all([y.e(25),y.e(24)]).then(y.bind(y,13180)),Promise.all([y.e(27),y.e(26)]).then(y.bind(y,13341))]),this._shadersLoaded=!0}},v);if(this._eventInfo.customCode=void 0,W)if(this._onEffectCreatedObservable&&(l.effect=W,l.subMesh=f,this._onEffectCreatedObservable.notifyObservers(l)),this.allowShaderHotSwapping&&x&&!W.isReady()){if(W=x,h.markAsUnprocessed(),F=this.isFrozen,S)return h._areLightsDisposed=!0,!1}else b.resetCachedMaterial(),f.setEffect(W,h,this._materialContext)}return!(!f.effect||!f.effect.isReady())&&(h._renderId=b.getRenderId(),H._wasPreviouslyReady=!F,H._wasPreviouslyUsingInstances=S,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const O=this._uniformBuffer;O.addUniform("diffuseLeftColor",4),O.addUniform("diffuseRightColor",4),O.addUniform("opacityParts",4),O.addUniform("reflectionLeftColor",4),O.addUniform("reflectionRightColor",4),O.addUniform("refractionLeftColor",4),O.addUniform("refractionRightColor",4),O.addUniform("emissiveLeftColor",4),O.addUniform("emissiveRightColor",4),O.addUniform("vDiffuseInfos",2),O.addUniform("vAmbientInfos",2),O.addUniform("vOpacityInfos",2),O.addUniform("vReflectionInfos",2),O.addUniform("vReflectionPosition",3),O.addUniform("vReflectionSize",3),O.addUniform("vEmissiveInfos",2),O.addUniform("vLightmapInfos",2),O.addUniform("vSpecularInfos",2),O.addUniform("vBumpInfos",3),O.addUniform("diffuseMatrix",16),O.addUniform("ambientMatrix",16),O.addUniform("opacityMatrix",16),O.addUniform("reflectionMatrix",16),O.addUniform("emissiveMatrix",16),O.addUniform("lightmapMatrix",16),O.addUniform("specularMatrix",16),O.addUniform("bumpMatrix",16),O.addUniform("vTangentSpaceParams",2),O.addUniform("pointSize",1),O.addUniform("alphaCutOff",1),O.addUniform("refractionMatrix",16),O.addUniform("vRefractionInfos",4),O.addUniform("vRefractionPosition",3),O.addUniform("vRefractionSize",3),O.addUniform("vSpecularColor",4),O.addUniform("vEmissiveColor",3),O.addUniform("vDiffuseColor",4),O.addUniform("vAmbientColor",3),super.buildUniformLayout()}bindForSubMesh(O,f,y){const S=this.va(),H=y.materialDefines;if(!H)return;const b=y.effect;if(!b)return;this._activeEffect=b,f.getMeshUniformBuffer().bindToEffect(b,"Mesh"),f.transferToEffect(O),this._uniformBuffer.bindToEffect(b,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,S,f,O,this.isFrozen),U.d.Bind(S.getEngine().currentRenderPassId,this._activeEffect,f,O),this._eventInfo.subMesh=y,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),H.OBJECTSPACE_NORMALMAP&&(O.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const v=this._mustRebind(S,b,y,f.visibility);(0,L.c)(f,b);const m=this._uniformBuffer;if(v){if(this.bindViewProjection(b),!m.useUbo||!this.isFrozen||!m.isSync||y._drawWrapper._forceRebindOnNextCall){if(W.FresnelEnabled&&H.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(m.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),m.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&m.updateColor4("opacityParts",new N.d(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(m.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),m.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(m.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),m.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(m.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),m.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),S.texturesEnabled){if(this._diffuseTexture&&W.DiffuseTextureEnabled&&(m.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,L.r)(this._diffuseTexture,m,"diffuse")),this._ambientTexture&&W.AmbientTextureEnabled&&(m.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,L.r)(this._ambientTexture,m,"ambient")),this._opacityTexture&&W.OpacityTextureEnabled&&(m.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,L.r)(this._opacityTexture,m,"opacity")),this._hasAlphaChannel()&&m.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&W.ReflectionTextureEnabled&&(m.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),m.Fj("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){const O=this._reflectionTexture;m.updateVector3("vReflectionPosition",O.boundingBoxPosition),m.updateVector3("vReflectionSize",O.boundingBoxSize)}if(this._emissiveTexture&&W.EmissiveTextureEnabled&&(m.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,L.r)(this._emissiveTexture,m,"emissive")),this._lightmapTexture&&W.LightmapTextureEnabled&&(m.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,L.r)(this._lightmapTexture,m,"lightmap")),this._specularTexture&&W.SpecularTextureEnabled&&(m.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,L.r)(this._specularTexture,m,"specular")),this._bumpTexture&&S.getEngine().getCaps().standardDerivatives&&W.BumpTextureEnabled&&(m.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,L.r)(this._bumpTexture,m,"bump"),S._mirroredCameraPosition?m.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):m.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&W.RefractionTextureEnabled){let O=1;if(this._refractionTexture.isCube||(m.Fj("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(O=this._refractionTexture.depth)),m.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,O,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const O=this._refractionTexture;m.updateVector3("vRefractionPosition",O.boundingBoxPosition),m.updateVector3("vRefractionSize",O.boundingBoxSize)}}}this.pointsCloud&&m.updateFloat("pointSize",this.pointSize),m.updateColor4("vSpecularColor",this.specularColor,this.specularPower),m.updateColor3("vEmissiveColor",W.EmissiveTextureEnabled?this.emissiveColor:N.d.BlackReadOnly),m.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),S.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),m.updateColor3("vAmbientColor",this._globalAmbientColor)}S.texturesEnabled&&(this._diffuseTexture&&W.DiffuseTextureEnabled&&b.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&W.AmbientTextureEnabled&&b.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&W.OpacityTextureEnabled&&b.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&W.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?b.setTexture("reflectionCubeSampler",this._reflectionTexture):b.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&W.EmissiveTextureEnabled&&b.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&W.LightmapTextureEnabled&&b.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&W.SpecularTextureEnabled&&b.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&S.getEngine().getCaps().standardDerivatives&&W.BumpTextureEnabled&&b.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&W.RefractionTextureEnabled&&(this._refractionTexture.isCube?b.setTexture("refractionCubeSampler",this._refractionTexture):b.setTexture("refraction2DSampler",this._refractionTexture))),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(f)&&this.va().depthPeelingRenderer.bind(b),this._eventInfo.subMesh=y,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,u.f)(b,this,S),this.bindEyePosition(b)}else S.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(v||!this.isFrozen){var t;if(S.lightsEnabled&&!this._disableLighting&&(0,L.g)(S,f,b,H,this._maxSimultaneousLights),(S.fogEnabled&&f.applyFog&&S.fogMode!==h.c.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||f.receiveShadows||H.PREPASS)&&this.bindView(b),(0,L.e)(S,f,b),H.NUM_MORPH_INFLUENCERS&&(0,L.l)(f,b),H.BAKED_VERTEX_ANIMATION_TEXTURE)null===(t=f.bakedVertexAnimationManager)||void 0===t||t.bind(b,H.INSTANCES);this.useLogarithmicDepth&&(0,L.j)(H,b,S),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)}this._afterBind(f,this._activeEffect,y),m.update()}getAnimatables(){const O=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&O.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&O.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&O.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&O.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&O.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&O.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&O.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&O.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&O.push(this._refractionTexture),O}getActiveTextures(){const O=super.getActiveTextures();return this._diffuseTexture&&O.push(this._diffuseTexture),this._ambientTexture&&O.push(this._ambientTexture),this._opacityTexture&&O.push(this._opacityTexture),this._reflectionTexture&&O.push(this._reflectionTexture),this._emissiveTexture&&O.push(this._emissiveTexture),this._specularTexture&&O.push(this._specularTexture),this._bumpTexture&&O.push(this._bumpTexture),this._lightmapTexture&&O.push(this._lightmapTexture),this._refractionTexture&&O.push(this._refractionTexture),O}hasTexture(O){return!!super.hasTexture(O)||(this._diffuseTexture===O||(this._ambientTexture===O||(this._opacityTexture===O||(this._reflectionTexture===O||(this._emissiveTexture===O||(this._specularTexture===O||(this._bumpTexture===O||(this._lightmapTexture===O||this._refractionTexture===O))))))))}dispose(O,f){var y,S,H,b,h,v,N,m,t;f&&(null===(y=this._diffuseTexture)||void 0===y||y.dispose(),null===(S=this._ambientTexture)||void 0===S||S.dispose(),null===(H=this._opacityTexture)||void 0===H||H.dispose(),null===(b=this._reflectionTexture)||void 0===b||b.dispose(),null===(h=this._emissiveTexture)||void 0===h||h.dispose(),null===(v=this._specularTexture)||void 0===v||v.dispose(),null===(N=this._bumpTexture)||void 0===N||N.dispose(),null===(m=this._lightmapTexture)||void 0===m||m.dispose(),null===(t=this._refractionTexture)||void 0===t||t.dispose());this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(O,f)}clone(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const S=p.b.Clone((()=>new W(O,this.va())),this,{cloneTexturesOnlyOnce:f});return S.name=O,S.id=O,this.stencil.copyTo(S.stencil),this._clonePlugins(S,y),S}static Parse(O,f,y){const S=p.b.Parse((()=>new W(O.name,f)),O,f,y);return O.stencil&&S.stencil.parse(O.stencil,f,y),F.c._ParsePlugins(O,S,f,y),S}static get DiffuseTextureEnabled(){return w.b.DiffuseTextureEnabled}static set DiffuseTextureEnabled(O){w.b.DiffuseTextureEnabled=O}static get DetailTextureEnabled(){return w.b.DetailTextureEnabled}static set DetailTextureEnabled(O){w.b.DetailTextureEnabled=O}static get AmbientTextureEnabled(){return w.b.AmbientTextureEnabled}static set AmbientTextureEnabled(O){w.b.AmbientTextureEnabled=O}static get OpacityTextureEnabled(){return w.b.OpacityTextureEnabled}static set OpacityTextureEnabled(O){w.b.OpacityTextureEnabled=O}static get ReflectionTextureEnabled(){return w.b.ReflectionTextureEnabled}static set ReflectionTextureEnabled(O){w.b.ReflectionTextureEnabled=O}static get EmissiveTextureEnabled(){return w.b.EmissiveTextureEnabled}static set EmissiveTextureEnabled(O){w.b.EmissiveTextureEnabled=O}static get SpecularTextureEnabled(){return w.b.SpecularTextureEnabled}static set SpecularTextureEnabled(O){w.b.SpecularTextureEnabled=O}static get BumpTextureEnabled(){return w.b.BumpTextureEnabled}static set BumpTextureEnabled(O){w.b.BumpTextureEnabled=O}static get LightmapTextureEnabled(){return w.b.LightmapTextureEnabled}static set LightmapTextureEnabled(O){w.b.LightmapTextureEnabled=O}static get RefractionTextureEnabled(){return w.b.RefractionTextureEnabled}static set RefractionTextureEnabled(O){w.b.RefractionTextureEnabled=O}static get ColorGradingTextureEnabled(){return w.b.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(O){w.b.ColorGradingTextureEnabled=O}static get FresnelEnabled(){return w.b.FresnelEnabled}static set FresnelEnabled(O){w.b.FresnelEnabled=O}}W.ForceGLSL=!1,(0,S.b)([(0,H.C)("diffuseTexture")],W.prototype,"_diffuseTexture",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],W.prototype,"diffuseTexture",void 0),(0,S.b)([(0,H.C)("ambientTexture")],W.prototype,"_ambientTexture",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"ambientTexture",void 0),(0,S.b)([(0,H.C)("opacityTexture")],W.prototype,"_opacityTexture",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],W.prototype,"opacityTexture",void 0),(0,S.b)([(0,H.C)("reflectionTexture")],W.prototype,"_reflectionTexture",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"reflectionTexture",void 0),(0,S.b)([(0,H.C)("emissiveTexture")],W.prototype,"_emissiveTexture",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"emissiveTexture",void 0),(0,S.b)([(0,H.C)("specularTexture")],W.prototype,"_specularTexture",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"specularTexture",void 0),(0,S.b)([(0,H.C)("bumpTexture")],W.prototype,"_bumpTexture",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"bumpTexture",void 0),(0,S.b)([(0,H.C)("lightmapTexture")],W.prototype,"_lightmapTexture",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"lightmapTexture",void 0),(0,S.b)([(0,H.C)("refractionTexture")],W.prototype,"_refractionTexture",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"refractionTexture",void 0),(0,S.b)([(0,H.h)("ambient")],W.prototype,"ambientColor",void 0),(0,S.b)([(0,H.h)("diffuse")],W.prototype,"diffuseColor",void 0),(0,S.b)([(0,H.h)("specular")],W.prototype,"specularColor",void 0),(0,S.b)([(0,H.h)("emissive")],W.prototype,"emissiveColor",void 0),(0,S.b)([(0,H.L)()],W.prototype,"specularPower",void 0),(0,S.b)([(0,H.L)("useAlphaFromDiffuseTexture")],W.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],W.prototype,"useAlphaFromDiffuseTexture",void 0),(0,S.b)([(0,H.L)("useEmissiveAsIllumination")],W.prototype,"_useEmissiveAsIllumination",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"useEmissiveAsIllumination",void 0),(0,S.b)([(0,H.L)("linkEmissiveWithDiffuse")],W.prototype,"_linkEmissiveWithDiffuse",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"linkEmissiveWithDiffuse",void 0),(0,S.b)([(0,H.L)("useSpecularOverAlpha")],W.prototype,"_useSpecularOverAlpha",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"useSpecularOverAlpha",void 0),(0,S.b)([(0,H.L)("useReflectionOverAlpha")],W.prototype,"_useReflectionOverAlpha",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"useReflectionOverAlpha",void 0),(0,S.b)([(0,H.L)("disableLighting")],W.prototype,"_disableLighting",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsLightsDirty")],W.prototype,"disableLighting",void 0),(0,S.b)([(0,H.L)("useObjectSpaceNormalMap")],W.prototype,"_useObjectSpaceNormalMap",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"useObjectSpaceNormalMap",void 0),(0,S.b)([(0,H.L)("useParallax")],W.prototype,"_useParallax",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"useParallax",void 0),(0,S.b)([(0,H.L)("useParallaxOcclusion")],W.prototype,"_useParallaxOcclusion",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"useParallaxOcclusion",void 0),(0,S.b)([(0,H.L)()],W.prototype,"parallaxScaleBias",void 0),(0,S.b)([(0,H.L)("roughness")],W.prototype,"_roughness",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"roughness",void 0),(0,S.b)([(0,H.L)()],W.prototype,"indexOfRefraction",void 0),(0,S.b)([(0,H.L)()],W.prototype,"invertRefractionY",void 0),(0,S.b)([(0,H.L)()],W.prototype,"alphaCutOff",void 0),(0,S.b)([(0,H.L)("useLightmapAsShadowmap")],W.prototype,"_useLightmapAsShadowmap",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"useLightmapAsShadowmap",void 0),(0,S.b)([(0,H.m)("diffuseFresnelParameters")],W.prototype,"_diffuseFresnelParameters",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsFresnelDirty")],W.prototype,"diffuseFresnelParameters",void 0),(0,S.b)([(0,H.m)("opacityFresnelParameters")],W.prototype,"_opacityFresnelParameters",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsFresnelAndMiscDirty")],W.prototype,"opacityFresnelParameters",void 0),(0,S.b)([(0,H.m)("reflectionFresnelParameters")],W.prototype,"_reflectionFresnelParameters",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsFresnelDirty")],W.prototype,"reflectionFresnelParameters",void 0),(0,S.b)([(0,H.m)("refractionFresnelParameters")],W.prototype,"_refractionFresnelParameters",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsFresnelDirty")],W.prototype,"refractionFresnelParameters",void 0),(0,S.b)([(0,H.m)("emissiveFresnelParameters")],W.prototype,"_emissiveFresnelParameters",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsFresnelDirty")],W.prototype,"emissiveFresnelParameters",void 0),(0,S.b)([(0,H.L)("useReflectionFresnelFromSpecular")],W.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsFresnelDirty")],W.prototype,"useReflectionFresnelFromSpecular",void 0),(0,S.b)([(0,H.L)("useGlossinessFromSpecularMapAlpha")],W.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,S.b)([(0,H.L)("maxSimultaneousLights")],W.prototype,"_maxSimultaneousLights",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsLightsDirty")],W.prototype,"maxSimultaneousLights",void 0),(0,S.b)([(0,H.L)("invertNormalMapX")],W.prototype,"_invertNormalMapX",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"invertNormalMapX",void 0),(0,S.b)([(0,H.L)("invertNormalMapY")],W.prototype,"_invertNormalMapY",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"invertNormalMapY",void 0),(0,S.b)([(0,H.L)("twoSidedLighting")],W.prototype,"_twoSidedLighting",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"twoSidedLighting",void 0),(0,S.b)([(0,H.L)("applyDecalMapAfterDetailMap")],W.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,S.b)([(0,H.d)("_markAllSubMeshesAsMiscDirty")],W.prototype,"applyDecalMapAfterDetailMap",void 0),(0,X.g)("BABYLON.StandardMaterial",W),h.c.DefaultMaterialFactory=O=>new W("default material",O)},11380:(O,f,y)=>{"use strict";y.d(f,{b:()=>b});var S=y(11017),H=y(10995);class b{constructor(O,f,y,S){let H=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._valueCache={},this._engine=O,this._noUBO=!O.supportsUniformBuffers||H,this._dynamic=y,this._name=S??"no-name",this._data=f||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.Fj=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.Fj=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get useUbo(){return!this._noUBO}get isSync(){return!this._needSync}isDynamic(){return void 0!==this._dynamic}getData(){return this._bufferData}getBuffer(){return this._buffer}_fillAlignment(O){let f;if(f=O<=2?O:4,this._uniformLocationPointer%f!==0){const O=this._uniformLocationPointer;this._uniformLocationPointer+=f-this._uniformLocationPointer%f;const y=this._uniformLocationPointer-O;for(let f=0;f<y;f++)this._data.push(0)}}addUniform(O,f){let y,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this._noUBO&&void 0===this._uniformLocations[O]){if(S>0){if(f instanceof Array)throw"addUniform should not be use with Array in UBO: "+O;if(this._fillAlignment(4),this._uniformArraySizes[O]={strideSize:f,arraySize:S},16==f)f*=S;else{f=f*S+(4-f)*S}y=[];for(let O=0;O<f;O++)y.push(0)}else{if(f instanceof Array)y=f,f=y.length;else{y=[];for(let O=0;O<f;O++)y.push(0)}this._fillAlignment(f)}this._uniformSizes[O]=f,this._uniformLocations[O]=this._uniformLocationPointer,this._uniformLocationPointer+=f;for(let O=0;O<f;O++)this._data.push(y[O]);this._needSync=!0}}addMatrix(O,f){this.addUniform(O,Array.prototype.slice.call(f.gj()))}addFloat2(O,f,y){const S=[f,y];this.addUniform(O,S)}addFloat3(O,f,y,S){const H=[f,y,S];this.addUniform(O,H)}addColor3(O,f){const y=[f.r,f.g,f.b];this.addUniform(O,y)}addColor4(O,f,y){const S=[f.r,f.g,f.b,y];this.addUniform(O,S)}addVector3(O,f){const y=[f.x,f.y,f.z];this.addUniform(O,y)}addMatrix3x3(O){this.addUniform(O,12)}addMatrix2x2(O){this.addUniform(O,8)}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}_getNames(){const O=[];let f=0;for(const y in this._uniformLocations)if(O.push(y),10===++f)break;return O.join(",")}_rebuild(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}get _numBuffers(){return this._buffers.length}get _indexBuffer(){return this._bufferIndex}get name(){return this._name}get currentEffect(){return this._currentEffect}_buffersEqual(O,f){for(let y=0;y<O.length;++y)if(O[y]!==f[y])return!1;return!0}_copyBuffer(O,f){for(let y=0;y<O.length;++y)f[y]=O[y]}update(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(b._UpdatedUbosInFrame[this._name]||(b._UpdatedUbosInFrame[this._name]=0),b._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}updateUniform(O,f,y){this._checkNewFrame();let H=this._uniformLocations[O];if(void 0===H){if(this._buffer)return void S.e.Error("Cannot add an uniform after UBO has been created. uniformName="+O);this.addUniform(O,y),H=this._uniformLocations[O]}if(this._buffer||this.create(),this._dynamic)for(let S=0;S<y;S++)this._bufferData[H+S]=f[S];else{let O=!1;for(let S=0;S<y;S++)(16===y&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[H+S]!==Math.fround(f[S]))&&(O=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[H+S]=f[S]);this._needSync=this._needSync||O}}updateUniformArray(O,f,y){this._checkNewFrame();const b=this._uniformLocations[O];if(void 0===b)return void S.e.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");this._buffer||this.create();const h=this._uniformArraySizes[O];if(this._dynamic)for(let S=0;S<y;S++)this._bufferData[b+S]=f[S];else{let O=!1,S=0,v=0;for(let N=0;N<y;N++)if(this._bufferData[b+4*v+S]!==H.d.FloatRound(f[N])&&(O=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[b+4*v+S]=f[N]),S++,S===h.strideSize){for(;S<4;S++)this._bufferData[b+4*v+S]=0;S=0,v++}this._needSync=this._needSync||O}}_cacheMatrix(O,f){this._checkNewFrame();const y=this._valueCache[O],S=f.updateFlag;return(void 0===y||y!==S)&&(this._valueCache[O]=S,!0)}_updateMatrix3x3ForUniform(O,f){for(let y=0;y<3;y++)b._TempBuffer[4*y]=f[3*y],b._TempBuffer[4*y+1]=f[3*y+1],b._TempBuffer[4*y+2]=f[3*y+2],b._TempBuffer[4*y+3]=0;this.updateUniform(O,b._TempBuffer,12)}_updateMatrix3x3ForEffect(O,f){this._currentEffect.setMatrix3x3(O,f)}_updateMatrix2x2ForEffect(O,f){this._currentEffect.setMatrix2x2(O,f)}_updateMatrix2x2ForUniform(O,f){for(let y=0;y<2;y++)b._TempBuffer[4*y]=f[2*y],b._TempBuffer[4*y+1]=f[2*y+1],b._TempBuffer[4*y+2]=0,b._TempBuffer[4*y+3]=0;this.updateUniform(O,b._TempBuffer,8)}_updateFloatForEffect(O,f){this._currentEffect.setFloat(O,f)}_updateFloatForUniform(O,f){b._TempBuffer[0]=f,this.updateUniform(O,b._TempBuffer,1)}_updateFloat2ForEffect(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setFloat2(O+S,f,y)}_updateFloat2ForUniform(O,f,y){b._TempBuffer[0]=f,b._TempBuffer[1]=y,this.updateUniform(O,b._TempBuffer,2)}_updateFloat3ForEffect(O,f,y,S){let H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setFloat3(O+H,f,y,S)}_updateFloat3ForUniform(O,f,y,S){b._TempBuffer[0]=f,b._TempBuffer[1]=y,b._TempBuffer[2]=S,this.updateUniform(O,b._TempBuffer,3)}_updateFloat4ForEffect(O,f,y,S,H){let b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setFloat4(O+b,f,y,S,H)}_updateFloat4ForUniform(O,f,y,S,H){b._TempBuffer[0]=f,b._TempBuffer[1]=y,b._TempBuffer[2]=S,b._TempBuffer[3]=H,this.updateUniform(O,b._TempBuffer,4)}_updateFloatArrayForEffect(O,f){this._currentEffect.setFloatArray(O,f)}_updateFloatArrayForUniform(O,f){this.updateUniformArray(O,f,f.length)}_updateArrayForEffect(O,f){this._currentEffect.setArray(O,f)}_updateArrayForUniform(O,f){this.updateUniformArray(O,f,f.length)}_updateIntArrayForEffect(O,f){this._currentEffect.setIntArray(O,f)}_updateIntArrayForUniform(O,f){b._TempBufferInt32View.set(f),this.updateUniformArray(O,b._TempBuffer,f.length)}_updateUIntArrayForEffect(O,f){this._currentEffect.setUIntArray(O,f)}_updateUIntArrayForUniform(O,f){b._TempBufferUInt32View.set(f),this.updateUniformArray(O,b._TempBuffer,f.length)}_updateMatrixForEffect(O,f){this._currentEffect.setMatrix(O,f)}_updateMatrixForUniform(O,f){this._cacheMatrix(O,f)&&this.updateUniform(O,f.gj(),16)}_updateMatricesForEffect(O,f){this._currentEffect.setMatrices(O,f)}_updateMatricesForUniform(O,f){this.updateUniform(O,f,f.length)}_updateVector3ForEffect(O,f){this._currentEffect.setVector3(O,f)}_updateVector3ForUniform(O,f){b._TempBuffer[0]=f.x,b._TempBuffer[1]=f.y,b._TempBuffer[2]=f.z,this.updateUniform(O,b._TempBuffer,3)}_updateVector4ForEffect(O,f){this._currentEffect.setVector4(O,f)}_updateVector4ForUniform(O,f){b._TempBuffer[0]=f.x,b._TempBuffer[1]=f.y,b._TempBuffer[2]=f.z,b._TempBuffer[3]=f.w,this.updateUniform(O,b._TempBuffer,4)}_updateColor3ForEffect(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setColor3(O+y,f)}_updateColor3ForUniform(O,f){b._TempBuffer[0]=f.r,b._TempBuffer[1]=f.g,b._TempBuffer[2]=f.b,this.updateUniform(O,b._TempBuffer,3)}_updateColor4ForEffect(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setColor4(O+S,f,y)}_updateDirectColor4ForEffect(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setDirectColor4(O+y,f)}_updateColor4ForUniform(O,f,y){b._TempBuffer[0]=f.r,b._TempBuffer[1]=f.g,b._TempBuffer[2]=f.b,b._TempBuffer[3]=y,this.updateUniform(O,b._TempBuffer,4)}_updateDirectColor4ForUniform(O,f){b._TempBuffer[0]=f.r,b._TempBuffer[1]=f.g,b._TempBuffer[2]=f.b,b._TempBuffer[3]=f.a,this.updateUniform(O,b._TempBuffer,4)}_updateIntForEffect(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setInt(O+y,f)}_updateIntForUniform(O,f){b._TempBufferInt32View[0]=f,this.updateUniform(O,b._TempBuffer,1)}_updateInt2ForEffect(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setInt2(O+S,f,y)}_updateInt2ForUniform(O,f,y){b._TempBufferInt32View[0]=f,b._TempBufferInt32View[1]=y,this.updateUniform(O,b._TempBuffer,2)}_updateInt3ForEffect(O,f,y,S){let H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setInt3(O+H,f,y,S)}_updateInt3ForUniform(O,f,y,S){b._TempBufferInt32View[0]=f,b._TempBufferInt32View[1]=y,b._TempBufferInt32View[2]=S,this.updateUniform(O,b._TempBuffer,3)}_updateInt4ForEffect(O,f,y,S,H){let b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setInt4(O+b,f,y,S,H)}_updateInt4ForUniform(O,f,y,S,H){b._TempBufferInt32View[0]=f,b._TempBufferInt32View[1]=y,b._TempBufferInt32View[2]=S,b._TempBufferInt32View[3]=H,this.updateUniform(O,b._TempBuffer,4)}_updateUIntForEffect(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setUInt(O+y,f)}_updateUIntForUniform(O,f){b._TempBufferUInt32View[0]=f,this.updateUniform(O,b._TempBuffer,1)}_updateUInt2ForEffect(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setUInt2(O+S,f,y)}_updateUInt2ForUniform(O,f,y){b._TempBufferUInt32View[0]=f,b._TempBufferUInt32View[1]=y,this.updateUniform(O,b._TempBuffer,2)}_updateUInt3ForEffect(O,f,y,S){let H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setUInt3(O+H,f,y,S)}_updateUInt3ForUniform(O,f,y,S){b._TempBufferUInt32View[0]=f,b._TempBufferUInt32View[1]=y,b._TempBufferUInt32View[2]=S,this.updateUniform(O,b._TempBuffer,3)}_updateUInt4ForEffect(O,f,y,S,H){let b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setUInt4(O+b,f,y,S,H)}_updateUInt4ForUniform(O,f,y,S,H){b._TempBufferUInt32View[0]=f,b._TempBufferUInt32View[1]=y,b._TempBufferUInt32View[2]=S,b._TempBufferUInt32View[3]=H,this.updateUniform(O,b._TempBuffer,4)}setTexture(O,f){this._currentEffect.setTexture(O,f)}setTextureArray(O,f){this._currentEffect.setTextureArray(O,f)}bindTexture(O,f){this._currentEffect._bindTexture(O,f)}updateUniformDirectly(O,f){this.updateUniform(O,f,f.length),this.update()}bindToEffect(O,f){this._currentEffect=O,this._currentEffectName=f}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}setDataBuffer(O){if(!this._buffers)return this._buffer===O;for(let f=0;f<this._buffers.length;++f){if(this._buffers[f][0]===O)return this._bufferIndex=f,this._buffer=O,this._createBufferOnWrite=!1,this._currentEffect=void 0,!0}return!1}dispose(){if(this._noUBO)return;const O=this._engine._uniformBuffers,f=O.indexOf(this);if(-1!==f&&(O[f]=O[O.length-1],O.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let y=0;y<this._buffers.length;++y){const O=this._buffers[y][0];this._engine._releaseBuffer(O)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}b._UpdatedUbosInFrame={},b._MAX_UNIFORM_SIZE=256,b._TempBuffer=new Float32Array(b._MAX_UNIFORM_SIZE),b._TempBufferInt32View=new Int32Array(b._TempBuffer.buffer),b._TempBufferUInt32View=new Uint32Array(b._TempBuffer.buffer)},11606:(O,f,y)=>{"use strict";y.d(f,{c:()=>h,g:()=>S});var S,H,b=y(11324);!function(O){O[O.LOCAL=0]="LOCAL",O[O.WORLD=1]="WORLD",O[O.BONE=2]="BONE"}(S||(S={}));class h{}h.X=new b.m(1,0,0),h.Y=new b.m(0,1,0),h.Z=new b.m(0,0,1),function(O){O[O.X=0]="X",O[O.Y=1]="Y",O[O.Z=2]="Z"}(H||(H={}))},11359:(O,f,y)=>{"use strict";y.d(f,{d:()=>q,g:()=>F,k:()=>I});var S=y(11338),H=y(11153),b=y(11330),h=y(11345);function v(O){return Math.pow(O,b.k)}function N(O){return O<=.04045?.0773993808*O:Math.pow(.947867299*(O+.055),2.4)}function m(O){return Math.pow(O,b.i)}function t(O){return O<=.0031308?12.92*O:1.055*Math.pow(O,.41666)-.055}class q{constructor(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.r=O,this.g=f,this.b=y}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"gb"}getHashCode(){let O=255*this.r|0;return O=397*O^255*this.g,O=397*O^255*this.b,O}toArray(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return O[f]=this.r,O[f+1]=this.g,O[f+2]=this.b,this}Ac(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return q.FromArrayToRef(O,f,this),this}toColor4(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new F(this.r,this.g,this.b,O)}gj(){return[this.r,this.g,this.b]}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(O){return new q(this.r*O.r,this.g*O.g,this.b*O.b)}multiplyToRef(O,f){return f.r=this.r*O.r,f.g=this.g*O.g,f.b=this.b*O.b,f}multiplyInPlace(O){return this.r*=O.r,this.g*=O.g,this.b*=O.b,this}multiplyByFloats(O,f,y){return new q(this.r*O,this.g*f,this.b*y)}divide(O){throw new ReferenceError("Can not divide a color")}divideToRef(O,f){throw new ReferenceError("Can not divide a color")}divideInPlace(O){throw new ReferenceError("Can not divide a color")}minimizeInPlace(O){return this.minimizeInPlaceFromFloats(O.r,O.g,O.b)}maximizeInPlace(O){return this.maximizeInPlaceFromFloats(O.r,O.g,O.b)}minimizeInPlaceFromFloats(O,f,y){return this.r=Math.min(O,this.r),this.g=Math.min(f,this.g),this.b=Math.min(y,this.b),this}maximizeInPlaceFromFloats(O,f,y){return this.r=Math.max(O,this.r),this.g=Math.max(f,this.g),this.b=Math.max(y,this.b),this}floorToRef(O){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(O){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}equals(O){return O&&this.r===O.r&&this.g===O.g&&this.b===O.b}equalsFloats(O,f,y){return this.equalsToFloats(O,f,y)}equalsToFloats(O,f,y){return this.r===O&&this.g===f&&this.b===y}equalsWithEpsilon(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b.d;return(0,h.A)(this.r,O.r,f)&&(0,h.A)(this.g,O.g,f)&&(0,h.A)(this.b,O.b,f)}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(O){throw new ReferenceError("Can not negate a color")}scale(O){return new q(this.r*O,this.g*O,this.b*O)}scaleInPlace(O){return this.r*=O,this.g*=O,this.b*=O,this}scaleToRef(O,f){return f.r=this.r*O,f.g=this.g*O,f.b=this.b*O,f}scaleAndAddToRef(O,f){return f.r+=this.r*O,f.g+=this.g*O,f.b+=this.b*O,f}clampToRef(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,y=arguments.length>2?arguments[2]:void 0;return y.r=(0,h.c)(this.r,O,f),y.g=(0,h.c)(this.g,O,f),y.b=(0,h.c)(this.b,O,f),y}add(O){return new q(this.r+O.r,this.g+O.g,this.b+O.b)}addInPlace(O){return this.r+=O.r,this.g+=O.g,this.b+=O.b,this}addInPlaceFromFloats(O,f,y){return this.r+=O,this.g+=f,this.b+=y,this}addToRef(O,f){return f.r=this.r+O.r,f.g=this.g+O.g,f.b=this.b+O.b,f}xc(O){return new q(this.r-O.r,this.g-O.g,this.b-O.b)}subtractToRef(O,f){return f.r=this.r-O.r,f.g=this.g-O.g,f.b=this.b-O.b,f}ni(O){return this.r-=O.r,this.g-=O.g,this.b-=O.b,this}subtractFromFloats(O,f,y){return new q(this.r-O,this.g-f,this.b-y)}subtractFromFloatsToRef(O,f,y,S){return S.r=this.r-O,S.g=this.g-f,S.b=this.b-y,S}clone(){return new q(this.r,this.g,this.b)}p(O){return this.r=O.r,this.g=O.g,this.b=O.b,this}Xd(O,f,y){return this.r=O,this.g=f,this.b=y,this}set(O,f,y){return this.Xd(O,f,y)}Wd(O){return this.r=this.g=this.b=O,this}toHexString(){const O=Math.round(255*this.r),f=Math.round(255*this.g),y=Math.round(255*this.b);return"#"+(0,h.w)(O)+(0,h.w)(f)+(0,h.w)(y)}fromHexString(O){return"#"!==O.substring(0,1)||7!==O.length||(this.r=parseInt(O.substring(1,3),16)/255,this.g=parseInt(O.substring(3,5),16)/255,this.b=parseInt(O.substring(5,7),16)/255),this}toHSV(){return this.toHSVToRef(new q)}toHSVToRef(O){const f=this.r,y=this.g,S=this.b,H=Math.max(f,y,S),b=Math.min(f,y,S);let h=0,v=0;const N=H,m=H-b;return 0!==H&&(v=m/H),H!=b&&(H==f?(h=(y-S)/m,y<S&&(h+=6)):H==y?h=(S-f)/m+2:H==S&&(h=(f-y)/m+4),h*=60),O.r=h,O.g=v,O.b=N,O}toLinearSpace(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const f=new q;return this.toLinearSpaceToRef(f,O),f}toLinearSpaceToRef(O){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(O.r=N(this.r),O.g=N(this.g),O.b=N(this.b)):(O.r=v(this.r),O.g=v(this.g),O.b=v(this.b)),this}toGammaSpace(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const f=new q;return this.toGammaSpaceToRef(f,O),f}toGammaSpaceToRef(O){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(O.r=t(this.r),O.g=t(this.g),O.b=t(this.b)):(O.r=m(this.r),O.g=m(this.g),O.b=m(this.b)),this}static HSVtoRGBToRef(O,f,y,S){const H=y*f,b=O/60,h=H*(1-Math.abs(b%2-1));let v=0,N=0,m=0;b>=0&&b<=1?(v=H,N=h):b>=1&&b<=2?(v=h,N=H):b>=2&&b<=3?(N=H,m=h):b>=3&&b<=4?(N=h,m=H):b>=4&&b<=5?(v=h,m=H):b>=5&&b<=6&&(v=H,m=h);const t=y-H;return S.r=v+t,S.g=N+t,S.b=m+t,S}static FromHSV(O,f,y){const S=new q(0,0,0);return q.HSVtoRGBToRef(O,f,y,S),S}static FromHexString(O){return new q(0,0,0).fromHexString(O)}static Ng(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new q(O[f],O[f+1],O[f+2])}static FromArrayToRef(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0;y.r=O[f],y.g=O[f+1],y.b=O[f+2]}static FromInts(O,f,y){return new q(O/255,f/255,y/255)}static Lerp(O,f,y){const S=new q(0,0,0);return q.LerpToRef(O,f,y,S),S}static LerpToRef(O,f,y,S){S.r=O.r+(f.r-O.r)*y,S.g=O.g+(f.g-O.g)*y,S.b=O.b+(f.b-O.b)*y}static Hermite(O,f,y,S,H){const b=H*H,h=H*b,v=2*h-3*b+1,N=-2*h+3*b,m=h-2*b+H,t=h-b,F=O.r*v+y.r*N+f.r*m+S.r*t,I=O.g*v+y.g*N+f.g*m+S.g*t,A=O.b*v+y.b*N+f.b*m+S.b*t;return new q(F,I,A)}static Hermite1stDerivative(O,f,y,S,H){const b=q.Black();return this.Hermite1stDerivativeToRef(O,f,y,S,H,b),b}static Hermite1stDerivativeToRef(O,f,y,S,H,b){const h=H*H;b.r=6*(h-H)*O.r+(3*h-4*H+1)*f.r+6*(-h+H)*y.r+(3*h-2*H)*S.r,b.g=6*(h-H)*O.g+(3*h-4*H+1)*f.g+6*(-h+H)*y.g+(3*h-2*H)*S.g,b.b=6*(h-H)*O.b+(3*h-4*H+1)*f.b+6*(-h+H)*y.b+(3*h-2*H)*S.b}static Red(){return new q(1,0,0)}static Green(){return new q(0,1,0)}static Blue(){return new q(0,0,1)}static Black(){return new q(0,0,0)}static get BlackReadOnly(){return q._BlackReadOnly}static White(){return new q(1,1,1)}static Purple(){return new q(.5,0,.5)}static Magenta(){return new q(1,0,1)}static Yellow(){return new q(1,1,0)}static Gray(){return new q(.5,.5,.5)}static Teal(){return new q(0,1,1)}static Random(){return new q(Math.random(),Math.random(),Math.random())}}q._BlackReadOnly=q.Black(),Object.defineProperties(q.prototype,{dimension:{value:[3]},rank:{value:1}});class F{constructor(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=O,this.g=f,this.b=y,this.a=S}gj(){return[this.r,this.g,this.b,this.a]}toArray(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return O[f]=this.r,O[f+1]=this.g,O[f+2]=this.b,O[f+3]=this.a,this}Ac(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=O[f],this.g=O[f+1],this.b=O[f+2],this.a=O[f+3],this}equals(O){return O&&this.r===O.r&&this.g===O.g&&this.b===O.b&&this.a===O.a}add(O){return new F(this.r+O.r,this.g+O.g,this.b+O.b,this.a+O.a)}addToRef(O,f){return f.r=this.r+O.r,f.g=this.g+O.g,f.b=this.b+O.b,f.a=this.a+O.a,f}addInPlace(O){return this.r+=O.r,this.g+=O.g,this.b+=O.b,this.a+=O.a,this}addInPlaceFromFloats(O,f,y,S){return this.r+=O,this.g+=f,this.b+=y,this.a+=S,this}xc(O){return new F(this.r-O.r,this.g-O.g,this.b-O.b,this.a-O.a)}subtractToRef(O,f){return f.r=this.r-O.r,f.g=this.g-O.g,f.b=this.b-O.b,f.a=this.a-O.a,f}ni(O){return this.r-=O.r,this.g-=O.g,this.b-=O.b,this.a-=O.a,this}subtractFromFloats(O,f,y,S){return new F(this.r-O,this.g-f,this.b-y,this.a-S)}subtractFromFloatsToRef(O,f,y,S,H){return H.r=this.r-O,H.g=this.g-f,H.b=this.b-y,H.a=this.a-S,H}scale(O){return new F(this.r*O,this.g*O,this.b*O,this.a*O)}scaleInPlace(O){return this.r*=O,this.g*=O,this.b*=O,this.a*=O,this}scaleToRef(O,f){return f.r=this.r*O,f.g=this.g*O,f.b=this.b*O,f.a=this.a*O,f}scaleAndAddToRef(O,f){return f.r+=this.r*O,f.g+=this.g*O,f.b+=this.b*O,f.a+=this.a*O,f}clampToRef(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,y=arguments.length>2?arguments[2]:void 0;return y.r=(0,h.c)(this.r,O,f),y.g=(0,h.c)(this.g,O,f),y.b=(0,h.c)(this.b,O,f),y.a=(0,h.c)(this.a,O,f),y}multiply(O){return new F(this.r*O.r,this.g*O.g,this.b*O.b,this.a*O.a)}multiplyToRef(O,f){return f.r=this.r*O.r,f.g=this.g*O.g,f.b=this.b*O.b,f.a=this.a*O.a,f}multiplyInPlace(O){return this.r*=O.r,this.g*=O.g,this.b*=O.b,this.a*=O.a,this}multiplyByFloats(O,f,y,S){return new F(this.r*O,this.g*f,this.b*y,this.a*S)}divide(O){throw new ReferenceError("Can not divide a color")}divideToRef(O,f){throw new ReferenceError("Can not divide a color")}divideInPlace(O){throw new ReferenceError("Can not divide a color")}minimizeInPlace(O){return this.r=Math.min(this.r,O.r),this.g=Math.min(this.g,O.g),this.b=Math.min(this.b,O.b),this.a=Math.min(this.a,O.a),this}maximizeInPlace(O){return this.r=Math.max(this.r,O.r),this.g=Math.max(this.g,O.g),this.b=Math.max(this.b,O.b),this.a=Math.max(this.a,O.a),this}minimizeInPlaceFromFloats(O,f,y,S){return this.r=Math.min(O,this.r),this.g=Math.min(f,this.g),this.b=Math.min(y,this.b),this.a=Math.min(S,this.a),this}maximizeInPlaceFromFloats(O,f,y,S){return this.r=Math.max(O,this.r),this.g=Math.max(f,this.g),this.b=Math.max(y,this.b),this.a=Math.max(S,this.a),this}floorToRef(O){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(O){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(O){throw new ReferenceError("Can not negate a color")}equalsWithEpsilon(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b.d;return(0,h.A)(this.r,O.r,f)&&(0,h.A)(this.g,O.g,f)&&(0,h.A)(this.b,O.b,f)&&(0,h.A)(this.a,O.a,f)}equalsToFloats(O,f,y,S){return this.r===O&&this.g===f&&this.b===y&&this.a===S}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"rb"}getHashCode(){let O=255*this.r|0;return O=397*O^255*this.g,O=397*O^255*this.b,O=397*O^255*this.a,O}clone(){return(new F).p(this)}p(O){return this.r=O.r,this.g=O.g,this.b=O.b,this.a=O.a,this}Xd(O,f,y,S){return this.r=O,this.g=f,this.b=y,this.a=S,this}set(O,f,y,S){return this.Xd(O,f,y,S)}Wd(O){return this.r=this.g=this.b=this.a=O,this}toHexString(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const f=Math.round(255*this.r),y=Math.round(255*this.g),S=Math.round(255*this.b);if(O)return"#"+(0,h.w)(f)+(0,h.w)(y)+(0,h.w)(S);const H=Math.round(255*this.a);return"#"+(0,h.w)(f)+(0,h.w)(y)+(0,h.w)(S)+(0,h.w)(H)}fromHexString(O){return"#"!==O.substring(0,1)||9!==O.length&&7!==O.length||(this.r=parseInt(O.substring(1,3),16)/255,this.g=parseInt(O.substring(3,5),16)/255,this.b=parseInt(O.substring(5,7),16)/255,9===O.length&&(this.a=parseInt(O.substring(7,9),16)/255)),this}toLinearSpace(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const f=new F;return this.toLinearSpaceToRef(f,O),f}toLinearSpaceToRef(O){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(O.r=N(this.r),O.g=N(this.g),O.b=N(this.b)):(O.r=v(this.r),O.g=v(this.g),O.b=v(this.b)),O.a=this.a,this}toGammaSpace(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const f=new F;return this.toGammaSpaceToRef(f,O),f}toGammaSpaceToRef(O){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(O.r=t(this.r),O.g=t(this.g),O.b=t(this.b)):(O.r=m(this.r),O.g=m(this.g),O.b=m(this.b)),O.a=this.a,this}static FromHexString(O){return"#"!==O.substring(0,1)||9!==O.length&&7!==O.length?new F(0,0,0,0):new F(0,0,0,1).fromHexString(O)}static Lerp(O,f,y){return F.LerpToRef(O,f,y,new F)}static LerpToRef(O,f,y,S){return S.r=O.r+(f.r-O.r)*y,S.g=O.g+(f.g-O.g)*y,S.b=O.b+(f.b-O.b)*y,S.a=O.a+(f.a-O.a)*y,S}static Hermite(O,f,y,S,H){const b=H*H,h=H*b,v=2*h-3*b+1,N=-2*h+3*b,m=h-2*b+H,t=h-b,q=O.r*v+y.r*N+f.r*m+S.r*t,I=O.g*v+y.g*N+f.g*m+S.g*t,A=O.b*v+y.b*N+f.b*m+S.b*t,J=O.a*v+y.a*N+f.a*m+S.a*t;return new F(q,I,A,J)}static Hermite1stDerivative(O,f,y,S,H){const b=new F;return this.Hermite1stDerivativeToRef(O,f,y,S,H,b),b}static Hermite1stDerivativeToRef(O,f,y,S,H,b){const h=H*H;b.r=6*(h-H)*O.r+(3*h-4*H+1)*f.r+6*(-h+H)*y.r+(3*h-2*H)*S.r,b.g=6*(h-H)*O.g+(3*h-4*H+1)*f.g+6*(-h+H)*y.g+(3*h-2*H)*S.g,b.b=6*(h-H)*O.b+(3*h-4*H+1)*f.b+6*(-h+H)*y.b+(3*h-2*H)*S.b,b.a=6*(h-H)*O.a+(3*h-4*H+1)*f.a+6*(-h+H)*y.a+(3*h-2*H)*S.a}static FromColor3(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new F(O.r,O.g,O.b,f)}static Ng(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new F(O[f],O[f+1],O[f+2],O[f+3])}static FromArrayToRef(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0;y.r=O[f],y.g=O[f+1],y.b=O[f+2],y.a=O[f+3]}static FromInts(O,f,y,S){return new F(O/255,f/255,y/255,S/255)}static CheckColors4(O,f){if(O.length===3*f){const f=[];for(let y=0;y<O.length;y+=3){const S=y/3*4;f[S]=O[y],f[S+1]=O[y+1],f[S+2]=O[y+2],f[S+3]=1}return f}return O}}Object.defineProperties(F.prototype,{dimension:{value:[4]},rank:{value:1}});class I{}I.gb=(0,S.d)(3,q.Black),I.rb=(0,S.d)(3,(()=>new F(0,0,0,0))),(0,H.g)("BABYLON.Color3",q),(0,H.g)("BABYLON.Color4",F)},11330:(O,f,y)=>{"use strict";y.d(f,{d:()=>h,f:()=>b,i:()=>S,k:()=>H});const S=1/2.2,H=2.2,b=(1+Math.sqrt(5))/2,h=.001},11430:(O,f,y)=>{"use strict";y.d(f,{c:()=>H});var S=y(11434);class H{static GetPlanes(O){const f=[];for(let y=0;y<6;y++)f.push(new S.b(0,0,0,0));return H.GetPlanesToRef(O,f),f}static GetNearPlaneToRef(O,f){const y=O.m;f.k.x=y[3]+y[2],f.k.y=y[7]+y[6],f.k.z=y[11]+y[10],f.d=y[15]+y[14],f.normalize()}static GetFarPlaneToRef(O,f){const y=O.m;f.k.x=y[3]-y[2],f.k.y=y[7]-y[6],f.k.z=y[11]-y[10],f.d=y[15]-y[14],f.normalize()}static GetLeftPlaneToRef(O,f){const y=O.m;f.k.x=y[3]+y[0],f.k.y=y[7]+y[4],f.k.z=y[11]+y[8],f.d=y[15]+y[12],f.normalize()}static GetRightPlaneToRef(O,f){const y=O.m;f.k.x=y[3]-y[0],f.k.y=y[7]-y[4],f.k.z=y[11]-y[8],f.d=y[15]-y[12],f.normalize()}static GetTopPlaneToRef(O,f){const y=O.m;f.k.x=y[3]-y[1],f.k.y=y[7]-y[5],f.k.z=y[11]-y[9],f.d=y[15]-y[13],f.normalize()}static GetBottomPlaneToRef(O,f){const y=O.m;f.k.x=y[3]+y[1],f.k.y=y[7]+y[5],f.k.z=y[11]+y[9],f.d=y[15]+y[13],f.normalize()}static GetPlanesToRef(O,f){H.GetNearPlaneToRef(O,f[0]),H.GetFarPlaneToRef(O,f[1]),H.GetLeftPlaneToRef(O,f[2]),H.GetRightPlaneToRef(O,f[3]),H.GetTopPlaneToRef(O,f[4]),H.GetBottomPlaneToRef(O,f[5])}static IsPointInFrustum(O,f){for(let y=0;y<6;y++)if(f[y].dotCoordinate(O)<0)return!1;return!0}}},11484:(O,f,y)=>{"use strict";y.d(f,{d:()=>v,f:()=>N});var S=y(11289),H=y(11324),b=y(11294);class h{static extractMinAndMaxIndexed(O,f,y,S,H,b){for(let h=y;h<y+S;h++){const y=3*f[h],S=O[y],v=O[y+1],N=O[y+2];H.minimizeInPlaceFromFloats(S,v,N),b.maximizeInPlaceFromFloats(S,v,N)}}static extractMinAndMax(O,f,y,S,H,b){for(let h=f,v=f*S;h<f+y;h++,v+=S){const f=O[v],y=O[v+1],S=O[v+2];H.minimizeInPlaceFromFloats(f,y,S),b.maximizeInPlaceFromFloats(f,y,S)}}}function v(O,f,y,S){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const v=new H.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),N=new H.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return h.extractMinAndMaxIndexed(O,f,y,S,v,N),b&&(v.x-=v.x*b.x+b.y,v.y-=v.y*b.x+b.y,v.z-=v.z*b.x+b.y,N.x+=N.x*b.x+b.y,N.y+=N.y*b.x+b.y,N.z+=N.z*b.x+b.y),{minimum:v,maximum:N}}function N(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>4?arguments[4]:void 0;const v=new H.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),N=new H.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return b||(b=3),h.extractMinAndMax(O,f,y,b,v,N),S&&(v.x-=v.x*S.x+S.y,v.y-=v.y*S.x+S.y,v.z-=v.z*S.x+S.y,N.x+=N.x*S.x+S.y,N.y+=N.y*S.x+S.y,N.z+=N.z*S.x+S.y),{minimum:v,maximum:N}}(0,S.b)([b.e.filter((function(){for(var O=arguments.length,f=new Array(O),y=0;y<O;y++)f[y]=arguments[y];let[S,H]=f;return!Array.isArray(S)&&!Array.isArray(H)}))],h,"extractMinAndMaxIndexed",null),(0,S.b)([b.e.filter((function(){for(var O=arguments.length,f=new Array(O),y=0;y<O;y++)f[y]=arguments[y];let[S]=f;return!Array.isArray(S)}))],h,"extractMinAndMax",null)},11782:(O,f,y)=>{"use strict";y.d(f,{b:()=>S.g});y(11606),y(11359),y(11330),y(11430),y(11786),y(11434),y(11520);var S=y(11324);y(11574)},11786:(O,f,y)=>{"use strict";y.d(f,{e:()=>v,i:()=>t,m:()=>q});var S,H=y(11345),b=y(11324),h=y(11330);!function(O){O[O.CW=0]="CW",O[O.CCW=1]="CCW"}(S||(S={}));class v{static Interpolate(O,f,y,S,H){const b=1-3*S+3*f,h=3*S-6*f,v=3*f;let N=O;for(let m=0;m<5;m++){const f=N*N;N-=(b*(f*N)+h*f+v*N-O)*(1/(3*b*f+2*h*N+v)),N=Math.min(1,Math.max(0,N))}return 3*Math.pow(1-N,2)*N*y+3*(1-N)*Math.pow(N,2)*H+Math.pow(N,3)}}class N{constructor(O){this._radians=O,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}static BetweenTwoPoints(O,f){const y=f.xc(O),S=Math.atan2(y.y,y.x);return new N(S)}static BetweenTwoVectors(O,f){let y=O.lengthSquared()*f.lengthSquared();if(0===y)return new N(Math.PI/2);y=Math.sqrt(y);let S=O.dot(f)/y;S=(0,H.c)(S,-1,1);const b=Math.acos(S);return new N(b)}static FromRadians(O){return new N(O)}static FromDegrees(O){return new N(O*Math.PI/180)}}class m{constructor(O,f,y){this.startPoint=O,this.midPoint=f,this.endPoint=y;const S=Math.pow(f.x,2)+Math.pow(f.y,2),H=(Math.pow(O.x,2)+Math.pow(O.y,2)-S)/2,h=(S-Math.pow(y.x,2)-Math.pow(y.y,2))/2,v=(O.x-f.x)*(f.y-y.y)-(f.x-y.x)*(O.y-f.y);this.centerPoint=new b.i((H*(f.y-y.y)-h*(O.y-f.y))/v,((O.x-f.x)*h-(f.x-y.x)*H)/v),this.radius=this.centerPoint.xc(this.startPoint).length(),this.startAngle=N.BetweenTwoPoints(this.centerPoint,this.startPoint);const m=this.startAngle.degrees();let t=N.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),q=N.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();t-m>180&&(t-=360),t-m<-180&&(t+=360),q-t>180&&(q-=360),q-t<-180&&(q+=360),this.orientation=t-m<0?0:1,this.angle=N.FromDegrees(0===this.orientation?m-q:q-m)}}class t{constructor(O,f){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new b.i(O,f))}addLineTo(O,f){if(this.closed)return this;const y=new b.i(O,f),S=this._points[this._points.length-1];return this._points.push(y),this._length+=y.xc(S).length(),this}addArcTo(O,f,y,S){let H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const h=this._points[this._points.length-1],v=new b.i(O,f),N=new b.i(y,S),t=new m(h,v,N);let q=t.angle.radians()/H;0===t.orientation&&(q*=-1);let F=t.startAngle.radians()+q;for(let b=0;b<H;b++){const O=Math.cos(F)*t.radius+t.centerPoint.x,f=Math.sin(F)*t.radius+t.centerPoint.y;this.addLineTo(O,f),F+=q}return this}addQuadraticCurveTo(O,f,y,S){let H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const b=(O,f,y,S)=>(1-O)*(1-O)*f+2*O*(1-O)*y+O*O*S,h=this._points[this._points.length-1];for(let v=0;v<=H;v++){const N=v/H,m=b(N,h.x,O,y),t=b(N,h.y,f,S);this.addLineTo(m,t)}return this}addBezierCurveTo(O,f,y,S,H,b){let h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:36;if(this.closed)return this;const v=(O,f,y,S,H)=>(1-O)*(1-O)*(1-O)*f+3*O*(1-O)*(1-O)*y+3*O*O*(1-O)*S+O*O*O*H,N=this._points[this._points.length-1];for(let m=0;m<=h;m++){const t=m/h,q=v(t,N.x,O,y,H),F=v(t,N.y,f,S,b);this.addLineTo(q,F)}return this}isPointInside(O){let f=!1;const y=this._points.length;for(let S=y-1,H=0;H<y;S=H++){let y=this._points[S],b=this._points[H],h=b.x-y.x,v=b.y-y.y;if(Math.abs(v)>Number.EPSILON){if(v<0&&(y=this._points[H],h=-h,b=this._points[S],v=-v),O.y<y.y||O.y>b.y)continue;if(O.y===y.y&&O.x===y.x)return!0;{const S=v*(O.x-y.x)-h*(O.y-y.y);if(0===S)return!0;if(S<0)continue;f=!f}}else{if(O.y!==y.y)continue;if(b.x<=O.x&&O.x<=y.x||y.x<=O.x&&O.x<=b.x)return!0}}return f}close(){return this.closed=!0,this}length(){let O=this._length;if(this.closed){const f=this._points[this._points.length-1];O+=this._points[0].xc(f).length()}return O}area(){const O=this._points.length;let f=0;for(let y=O-1,S=0;S<O;y=S++)f+=this._points[y].x*this._points[S].y-this._points[S].x*this._points[y].y;return.5*f}getPoints(){return this._points}getPointAtLengthPosition(O){if(O<0||O>1)return b.i.Zero();const f=O*this.length();let y=0;for(let S=0;S<this._points.length;S++){const O=(S+1)%this._points.length,H=this._points[S],h=this._points[O].xc(H),v=h.length()+y;if(f>=y&&f<=v){const O=h.normalize(),S=f-y;return new b.i(H.x+O.x*S,H.y+O.y*S)}y=v}return b.i.Zero()}static StartingAt(O,f){return new t(O,f)}}class q{constructor(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2?arguments[2]:void 0,S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.path=O,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:b.m.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:b.b.Identity()};for(let H=0;H<O.length;H++)this._curve[H]=O[H].clone();this._raw=y||!1,this._alignTangentsWithPath=S,this._compute(f,S)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(O){return this._updatePointAtData(O).point}getTangentAt(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(O,f),f?b.m.TransformCoordinates(b.m.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(O,f),f?b.m.TransformCoordinates(b.m.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(O,f),f?b.m.TransformCoordinates(b.m.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(O){return this.length()*O}getPreviousPointIndexAt(O){return this._updatePointAtData(O),this._pointAtData.previousPointArrayIndex}getSubPositionAt(O){return this._updatePointAtData(O),this._pointAtData.subPosition}getClosestPositionTo(O){let f=Number.MAX_VALUE,y=0;for(let S=0;S<this._curve.length-1;S++){const H=this._curve[S+0],h=this._curve[S+1].xc(H).normalize(),v=this._distances[S+1]-this._distances[S+0],N=Math.min(Math.max(b.m.Dot(h,O.xc(H).normalize()),0)*b.m.Distance(H,O)/v,1),m=b.m.Distance(H.add(h.scale(N*v)),O);m<f&&(f=m,y=(this._distances[S+0]+v*N)/this.length())}return y}slice(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(O<0&&(O=1- -1*O%1),f<0&&(f=1- -1*f%1),O>f){const y=O;O=f,f=y}const y=this.getCurve(),S=this.getPointAt(O);let H=this.getPreviousPointIndexAt(O);const b=this.getPointAt(f),h=this.getPreviousPointIndexAt(f)+1,v=[];return 0!==O&&(H++,v.push(S)),v.push(...y.slice(H,h)),1===f&&1!==O||v.push(b),new q(v,this.getNormalAt(O),this._raw,this._alignTangentsWithPath)}update(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(let S=0;S<O.length;S++)this._curve[S].x=O[S].x,this._curve[S].y=O[S].y,this._curve[S].z=O[S].z;return this._compute(f,y),this}_compute(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const y=this._curve.length;if(y<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[y-1]=this._curve[y-1].xc(this._curve[y-2]),this._raw||this._tangents[y-1].normalize();const S=this._tangents[0],H=this._normalVector(S,O);let h,v,N,m,t;this._normals[0]=H,this._raw||this._normals[0].normalize(),this._binormals[0]=b.m.Cross(S,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let q=1;q<y;q++)h=this._getLastNonNullVector(q),q<y-1&&(v=this._getFirstNonNullVector(q),this._tangents[q]=f?v:h.add(v),this._tangents[q].normalize()),this._distances[q]=this._distances[q-1]+this._curve[q].xc(this._curve[q-1]).length(),N=this._tangents[q],t=this._binormals[q-1],this._normals[q]=b.m.Cross(t,N),this._raw||(0===this._normals[q].length()?(m=this._normals[q-1],this._normals[q]=m.clone()):this._normals[q].normalize()),this._binormals[q]=b.m.Cross(N,this._normals[q]),this._raw||this._binormals[q].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(O){let f=1,y=this._curve[O+f].xc(this._curve[O]);for(;0===y.length()&&O+f+1<this._curve.length;)f++,y=this._curve[O+f].xc(this._curve[O]);return y}_getLastNonNullVector(O){let f=1,y=this._curve[O].xc(this._curve[O-f]);for(;0===y.length()&&O>f+1;)f++,y=this._curve[O].xc(this._curve[O-f]);return y}_normalVector(O,f){let y,S=O.length();if(0===S&&(S=1),void 0===f||null===f){let f;f=(0,H.A)(Math.abs(O.y)/S,1,h.d)?(0,H.A)(Math.abs(O.x)/S,1,h.d)?(0,H.A)(Math.abs(O.z)/S,1,h.d)?b.m.Zero():new b.m(0,0,1):new b.m(1,0,0):new b.m(0,-1,0),y=b.m.Cross(O,f)}else y=b.m.Cross(O,f),b.m.CrossToRef(y,O,y);return y.normalize(),y}_updatePointAtData(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._pointAtData.id===O)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=O;const y=this.getPoints();if(O<=0)return this._setPointAtData(0,0,y[0],0,f);if(O>=1)return this._setPointAtData(1,1,y[y.length-1],y.length-1,f);let S,H=y[0],h=0;const v=O*this.length();for(let N=1;N<y.length;N++){S=y[N];const m=b.m.Distance(H,S);if(h+=m,h===v)return this._setPointAtData(O,1,S,N,f);if(h>v){const y=(h-v)/m,b=H.xc(S),t=S.add(b.scaleInPlace(y));return this._setPointAtData(O,1-y,t,N-1,f)}H=S}return this._pointAtData}_setPointAtData(O,f,y,S,H){return this._pointAtData.point=y,this._pointAtData.position=O,this._pointAtData.subPosition=f,this._pointAtData.previousPointArrayIndex=S,this._pointAtData.interpolateReady=H,H&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=b.b.Identity();const O=this._pointAtData.previousPointArrayIndex;if(O!==this._tangents.length-1){const f=O+1,y=this._tangents[O].clone(),S=this._normals[O].clone(),H=this._binormals[O].clone(),h=this._tangents[f].clone(),v=this._normals[f].clone(),N=this._binormals[f].clone(),m=b.c.RotationQuaternionFromAxis(S,H,y),t=b.c.RotationQuaternionFromAxis(v,N,h);b.c.Slerp(m,t,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}},11434:(O,f,y)=>{"use strict";y.d(f,{b:()=>H});var S=y(11324);class H{constructor(O,f,y,H){this.k=new S.m(O,f,y),this.d=H}gj(){return[this.k.x,this.k.y,this.k.z,this.d]}clone(){return new H(this.k.x,this.k.y,this.k.z,this.d)}getClassName(){return"Plane"}getHashCode(){let O=this.k.getHashCode();return O=397*O^this.d,O}normalize(){const O=Math.sqrt(this.k.x*this.k.x+this.k.y*this.k.y+this.k.z*this.k.z);let f=0;return 0!==O&&(f=1/O),this.k.x*=f,this.k.y*=f,this.k.z*=f,this.d*=f,this}transform(O){const f=H._TmpMatrix;O.invertToRef(f);const y=f.m,S=this.k.x,b=this.k.y,h=this.k.z,v=this.d,N=S*y[0]+b*y[1]+h*y[2]+v*y[3],m=S*y[4]+b*y[5]+h*y[6]+v*y[7],t=S*y[8]+b*y[9]+h*y[10]+v*y[11],q=S*y[12]+b*y[13]+h*y[14]+v*y[15];return new H(N,m,t,q)}dotCoordinate(O){return this.k.x*O.x+this.k.y*O.y+this.k.z*O.z+this.d}copyFromPoints(O,f,y){const S=f.x-O.x,H=f.y-O.y,b=f.z-O.z,h=y.x-O.x,v=y.y-O.y,N=y.z-O.z,m=H*N-b*v,t=b*h-S*N,q=S*v-H*h,F=Math.sqrt(m*m+t*t+q*q);let I;return I=0!==F?1/F:0,this.k.x=m*I,this.k.y=t*I,this.k.z=q*I,this.d=-(this.k.x*O.x+this.k.y*O.y+this.k.z*O.z),this}isFrontFacingTo(O,f){return S.m.Dot(this.k,O)<=f}signedDistanceTo(O){return S.m.Dot(O,this.k)+this.d}static Ng(O){return new H(O[0],O[1],O[2],O[3])}static FromPoints(O,f,y){const S=new H(0,0,0,0);return S.copyFromPoints(O,f,y),S}static FromPositionAndNormal(O,f){const y=new H(0,0,0,0);return this.FromPositionAndNormalToRef(O,f,y)}static FromPositionAndNormalToRef(O,f,y){return y.k.p(f),y.k.normalize(),y.d=-O.dot(y.k),y}static SignedDistanceToPlaneFromPositionAndNormal(O,f,y){const H=-(f.x*O.x+f.y*O.y+f.z*O.z);return S.m.Dot(y,f)+H}}H._TmpMatrix=S.b.Identity()},11345:(O,f,y)=>{"use strict";function S(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1401298e-51;return Math.abs(O-f)<=y}function H(O,f){return O===f?O:Math.random()*(f-O)+O}function b(O,f,y){return O+(f-O)*y}function h(O,f,y,S,H){const b=H*H,h=H*b;return O*(2*h-3*b+1)+y*(-2*h+3*b)+f*(h-2*b+H)+S*(h-b)}function v(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(y,Math.max(f,O))}function N(O){return O-=2*Math.PI*Math.floor((O+Math.PI)/(2*Math.PI))}function m(O){const f=O.toString(16);return O<=15?("0"+f).toUpperCase():f.toUpperCase()}function t(O){if(Math.log2)return Math.floor(Math.log2(O));if(O<0)return NaN;if(0===O)return-1/0;let f=0;if(O<1){for(;O<1;)f++,O*=2;f=-f}else if(O>1)for(;O>1;)f++,O=Math.floor(O/2);return f}function q(O,f){const y=O%f;return 0===y?f:q(f,y)}y.d(f,{A:()=>S,c:()=>v,f:()=>h,j:()=>q,n:()=>t,o:()=>b,q:()=>N,s:()=>H,w:()=>m})},11520:(O,f,y)=>{"use strict";y.d(f,{e:()=>S});class S{constructor(O,f){this.width=O,this.height=f}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let O=0|this.width;return O=397*O^this.height,O}p(O){this.width=O.width,this.height=O.height}Xd(O,f){return this.width=O,this.height=f,this}set(O,f){return this.Xd(O,f)}multiplyByFloats(O,f){return new S(this.width*O,this.height*f)}clone(){return new S(this.width,this.height)}equals(O){return!!O&&(this.width===O.width&&this.height===O.height)}get surface(){return this.width*this.height}static Zero(){return new S(0,0)}add(O){return new S(this.width+O.width,this.height+O.height)}xc(O){return new S(this.width-O.width,this.height-O.height)}scale(O){return new S(this.width*O,this.height*O)}static Lerp(O,f,y){const H=O.width+(f.width-O.width)*y,b=O.height+(f.height-O.height)*y;return new S(H,b)}}},11324:(O,f,y)=>{"use strict";y.d(f,{b:()=>A,c:()=>I,g:()=>X,i:()=>t,m:()=>q,q:()=>F});var S=y(11330),H=y(11338),b=y(11153),h=y(11118),v=y(11042),N=y(11345);const m=O=>parseInt(O.toString().replace(/\W/g,""));class t{constructor(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=O,this.y=f}toString(){return`{X: ${this.x} Y: ${this.y}}`}getClassName(){return"Vector2"}getHashCode(){let O=m(this.x);return O=397*O^m(this.y),O}toArray(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return O[f]=this.x,O[f+1]=this.y,this}Ac(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.FromArrayToRef(O,f,this),this}gj(){return[this.x,this.y]}p(O){return this.x=O.x,this.y=O.y,this}Xd(O,f){return this.x=O,this.y=f,this}set(O,f){return this.Xd(O,f)}Wd(O){return this.Xd(O,O)}add(O){return new t(this.x+O.x,this.y+O.y)}addToRef(O,f){return f.x=this.x+O.x,f.y=this.y+O.y,f}addInPlace(O){return this.x+=O.x,this.y+=O.y,this}addInPlaceFromFloats(O,f){return this.x+=O,this.y+=f,this}addVector3(O){return new t(this.x+O.x,this.y+O.y)}xc(O){return new t(this.x-O.x,this.y-O.y)}subtractToRef(O,f){return f.x=this.x-O.x,f.y=this.y-O.y,f}ni(O){return this.x-=O.x,this.y-=O.y,this}multiplyInPlace(O){return this.x*=O.x,this.y*=O.y,this}multiply(O){return new t(this.x*O.x,this.y*O.y)}multiplyToRef(O,f){return f.x=this.x*O.x,f.y=this.y*O.y,f}multiplyByFloats(O,f){return new t(this.x*O,this.y*f)}divide(O){return new t(this.x/O.x,this.y/O.y)}divideToRef(O,f){return f.x=this.x/O.x,f.y=this.y/O.y,f}divideInPlace(O){return this.x=this.x/O.x,this.y=this.y/O.y,this}minimizeInPlace(O){return this.minimizeInPlaceFromFloats(O.x,O.y)}maximizeInPlace(O){return this.maximizeInPlaceFromFloats(O.x,O.y)}minimizeInPlaceFromFloats(O,f){return this.x=Math.min(O,this.x),this.y=Math.min(f,this.y),this}maximizeInPlaceFromFloats(O,f){return this.x=Math.max(O,this.x),this.y=Math.max(f,this.y),this}subtractFromFloats(O,f){return new t(this.x-O,this.y-f)}subtractFromFloatsToRef(O,f,y){return y.x=this.x-O,y.y=this.y-f,y}negate(){return new t(-this.x,-this.y)}negateInPlace(){return this.x*=-1,this.y*=-1,this}negateToRef(O){return O.x=-this.x,O.y=-this.y,O}scaleInPlace(O){return this.x*=O,this.y*=O,this}scale(O){return new t(this.x*O,this.y*O)}scaleToRef(O,f){return f.x=this.x*O,f.y=this.y*O,f}scaleAndAddToRef(O,f){return f.x+=this.x*O,f.y+=this.y*O,f}equals(O){return O&&this.x===O.x&&this.y===O.y}equalsWithEpsilon(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S.d;return O&&(0,N.A)(this.x,O.x,f)&&(0,N.A)(this.y,O.y,f)}equalsToFloats(O,f){return this.x===O&&this.y===f}floor(){return new t(Math.floor(this.x),Math.floor(this.y))}floorToRef(O){return O.x=Math.floor(this.x),O.y=Math.floor(this.y),O}fract(){return new t(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}fractToRef(O){return O.x=this.x-Math.floor(this.x),O.y=this.y-Math.floor(this.y),O}rotateToRef(O,f){const y=Math.cos(O),S=Math.sin(O),H=y*this.x-S*this.y,b=S*this.x+y*this.y;return f.x=H,f.y=b,f}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(O){return 0===O||1===O?this:this.scaleInPlace(1/O)}normalizeToNew(){const O=new t;return this.normalizeToRef(O),O}normalizeToRef(O){const f=this.length();return 0===f&&(O.x=this.x,O.y=this.y),this.scaleToRef(1/f,O)}clone(){return new t(this.x,this.y)}dot(O){return this.x*O.x+this.y*O.y}static Zero(){return new t(0,0)}static One(){return new t(1,1)}static Random(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new t((0,N.s)(O,f),(0,N.s)(O,f))}static RandomToRef(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).Xd((0,N.s)(O,f),(0,N.s)(O,f))}static get ZeroReadOnly(){return t._ZeroReadOnly}static Ng(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new t(O[f],O[f+1])}static FromArrayToRef(O,f,y){return y.x=O[f],y.y=O[f+1],y}static FromFloatsToRef(O,f,y){return y.Xd(O,f),y}static CatmullRom(O,f,y,S,H){const b=H*H,h=H*b,v=.5*(2*f.x+(-O.x+y.x)*H+(2*O.x-5*f.x+4*y.x-S.x)*b+(-O.x+3*f.x-3*y.x+S.x)*h),N=.5*(2*f.y+(-O.y+y.y)*H+(2*O.y-5*f.y+4*y.y-S.y)*b+(-O.y+3*f.y-3*y.y+S.y)*h);return new t(v,N)}static ClampToRef(O,f,y,S){return S.x=(0,N.c)(O.x,f.x,y.x),S.y=(0,N.c)(O.y,f.y,y.y),S}static Clamp(O,f,y){const S=(0,N.c)(O.x,f.x,y.x),H=(0,N.c)(O.y,f.y,y.y);return new t(S,H)}static Hermite(O,f,y,S,H){const b=H*H,h=H*b,v=2*h-3*b+1,N=-2*h+3*b,m=h-2*b+H,q=h-b,F=O.x*v+y.x*N+f.x*m+S.x*q,I=O.y*v+y.y*N+f.y*m+S.y*q;return new t(F,I)}static Hermite1stDerivative(O,f,y,S,H){return this.Hermite1stDerivativeToRef(O,f,y,S,H,new t)}static Hermite1stDerivativeToRef(O,f,y,S,H,b){const h=H*H;return b.x=6*(h-H)*O.x+(3*h-4*H+1)*f.x+6*(-h+H)*y.x+(3*h-2*H)*S.x,b.y=6*(h-H)*O.y+(3*h-4*H+1)*f.y+6*(-h+H)*y.y+(3*h-2*H)*S.y,b}static Lerp(O,f,y){return t.LerpToRef(O,f,y,new t)}static LerpToRef(O,f,y,S){return S.x=O.x+(f.x-O.x)*y,S.y=O.y+(f.y-O.y)*y,S}static Dot(O,f){return O.x*f.x+O.y*f.y}static Normalize(O){return t.NormalizeToRef(O,new t)}static NormalizeToRef(O,f){return O.normalizeToRef(f),f}static Minimize(O,f){const y=O.x<f.x?O.x:f.x,S=O.y<f.y?O.y:f.y;return new t(y,S)}static Maximize(O,f){const y=O.x>f.x?O.x:f.x,S=O.y>f.y?O.y:f.y;return new t(y,S)}static Transform(O,f){return t.TransformToRef(O,f,new t)}static TransformToRef(O,f,y){const S=f.m,H=O.x*S[0]+O.y*S[4]+S[12],b=O.x*S[1]+O.y*S[5]+S[13];return y.x=H,y.y=b,y}static PointInTriangle(O,f,y,S){const H=.5*(-y.y*S.x+f.y*(-y.x+S.x)+f.x*(y.y-S.y)+y.x*S.y),b=H<0?-1:1,h=(f.y*S.x-f.x*S.y+(S.y-f.y)*O.x+(f.x-S.x)*O.y)*b,v=(f.x*y.y-f.y*y.x+(f.y-y.y)*O.x+(y.x-f.x)*O.y)*b;return h>0&&v>0&&h+v<2*H*b}static Distance(O,f){return Math.sqrt(t.DistanceSquared(O,f))}static DistanceSquared(O,f){const y=O.x-f.x,S=O.y-f.y;return y*y+S*S}static Center(O,f){return t.CenterToRef(O,f,new t)}static CenterToRef(O,f,y){return y.Xd((O.x+f.x)/2,(O.y+f.y)/2)}static DistanceOfPointFromSegment(O,f,y){const S=t.DistanceSquared(f,y);if(0===S)return t.Distance(O,f);const H=y.xc(f),b=Math.max(0,Math.min(1,t.Dot(O.xc(f),H)/S)),h=f.add(H.multiplyByFloats(b,b));return t.Distance(O,h)}}t._ZeroReadOnly=t.Zero(),Object.defineProperties(t.prototype,{dimension:{value:[2]},rank:{value:1}});class q{get x(){return this._x}set x(O){this._x=O,this._isDirty=!0}get y(){return this._y}set y(O){this._y=O,this._isDirty=!0}get z(){return this._z}set z(O){this._z=O,this._isDirty=!0}constructor(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._isDirty=!0,this._x=O,this._y=f,this._z=y}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z}}`}getClassName(){return"fb"}getHashCode(){let O=m(this._x);return O=397*O^m(this._y),O=397*O^m(this._z),O}gj(){return[this._x,this._y,this._z]}toArray(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return O[f]=this._x,O[f+1]=this._y,O[f+2]=this._z,this}Ac(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return q.FromArrayToRef(O,f,this),this}toQuaternion(){return I.RotationYawPitchRoll(this._y,this._x,this._z)}addInPlace(O){return this._x+=O._x,this._y+=O._y,this._z+=O._z,this._isDirty=!0,this}addInPlaceFromFloats(O,f,y){return this._x+=O,this._y+=f,this._z+=y,this._isDirty=!0,this}add(O){return new q(this._x+O._x,this._y+O._y,this._z+O._z)}addToRef(O,f){return f._x=this._x+O._x,f._y=this._y+O._y,f._z=this._z+O._z,f._isDirty=!0,f}ni(O){return this._x-=O._x,this._y-=O._y,this._z-=O._z,this._isDirty=!0,this}xc(O){return new q(this._x-O._x,this._y-O._y,this._z-O._z)}subtractToRef(O,f){return this.subtractFromFloatsToRef(O._x,O._y,O._z,f)}subtractFromFloats(O,f,y){return new q(this._x-O,this._y-f,this._z-y)}subtractFromFloatsToRef(O,f,y,S){return S._x=this._x-O,S._y=this._y-f,S._z=this._z-y,S._isDirty=!0,S}negate(){return new q(-this._x,-this._y,-this._z)}negateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}negateToRef(O){return O._x=-1*this._x,O._y=-1*this._y,O._z=-1*this._z,O._isDirty=!0,O}scaleInPlace(O){return this._x*=O,this._y*=O,this._z*=O,this._isDirty=!0,this}scale(O){return new q(this._x*O,this._y*O,this._z*O)}scaleToRef(O,f){return f._x=this._x*O,f._y=this._y*O,f._z=this._z*O,f._isDirty=!0,f}getNormalToRef(O){const f=this.length();let y=Math.acos(this.y/f);const S=Math.atan2(this.z,this.x);y>Math.PI/2?y-=Math.PI/2:y+=Math.PI/2;const H=f*Math.sin(y)*Math.cos(S),b=f*Math.cos(y),h=f*Math.sin(y)*Math.sin(S);return O.set(H,b,h),O}applyRotationQuaternionToRef(O,f){const y=this._x,S=this._y,H=this._z,b=O._x,h=O._y,v=O._z,N=O._w,m=2*(h*H-v*S),t=2*(v*y-b*H),q=2*(b*S-h*y);return f._x=y+N*m+h*q-v*t,f._y=S+N*t+v*m-b*q,f._z=H+N*q+b*t-h*m,f._isDirty=!0,f}applyRotationQuaternionInPlace(O){return this.applyRotationQuaternionToRef(O,this)}applyRotationQuaternion(O){return this.applyRotationQuaternionToRef(O,new q)}scaleAndAddToRef(O,f){return f._x+=this._x*O,f._y+=this._y*O,f._z+=this._z*O,f._isDirty=!0,f}projectOnPlane(O,f){return this.projectOnPlaneToRef(O,f,new q)}projectOnPlaneToRef(O,f,y){const S=O.k,H=O.d,b=J.fb[0];this.subtractToRef(f,b),b.normalize();const h=q.Dot(b,S);if(Math.abs(h)<1e-10)y.Wd(1/0);else{const O=-(q.Dot(f,S)+H)/h,v=b.scaleInPlace(O);f.addToRef(v,y)}return y}equals(O){return O&&this._x===O._x&&this._y===O._y&&this._z===O._z}equalsWithEpsilon(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S.d;return O&&(0,N.A)(this._x,O._x,f)&&(0,N.A)(this._y,O._y,f)&&(0,N.A)(this._z,O._z,f)}equalsToFloats(O,f,y){return this._x===O&&this._y===f&&this._z===y}multiplyInPlace(O){return this._x*=O._x,this._y*=O._y,this._z*=O._z,this._isDirty=!0,this}multiply(O){return this.multiplyByFloats(O._x,O._y,O._z)}multiplyToRef(O,f){return f._x=this._x*O._x,f._y=this._y*O._y,f._z=this._z*O._z,f._isDirty=!0,f}multiplyByFloats(O,f,y){return new q(this._x*O,this._y*f,this._z*y)}divide(O){return new q(this._x/O._x,this._y/O._y,this._z/O._z)}divideToRef(O,f){return f._x=this._x/O._x,f._y=this._y/O._y,f._z=this._z/O._z,f._isDirty=!0,f}divideInPlace(O){return this._x=this._x/O._x,this._y=this._y/O._y,this._z=this._z/O._z,this._isDirty=!0,this}minimizeInPlace(O){return this.minimizeInPlaceFromFloats(O._x,O._y,O._z)}maximizeInPlace(O){return this.maximizeInPlaceFromFloats(O._x,O._y,O._z)}minimizeInPlaceFromFloats(O,f,y){return O<this._x&&(this.x=O),f<this._y&&(this.y=f),y<this._z&&(this.z=y),this}maximizeInPlaceFromFloats(O,f,y){return O>this._x&&(this.x=O),f>this._y&&(this.y=f),y>this._z&&(this.z=y),this}isNonUniformWithinEpsilon(O){const f=Math.abs(this._x),y=Math.abs(this._y);if(!(0,N.A)(f,y,O))return!0;const S=Math.abs(this._z);return!(0,N.A)(f,S,O)||!(0,N.A)(y,S,O)}get isNonUniform(){const O=Math.abs(this._x);if(O!==Math.abs(this._y))return!0;return O!==Math.abs(this._z)}floorToRef(O){return O._x=Math.floor(this._x),O._y=Math.floor(this._y),O._z=Math.floor(this._z),O._isDirty=!0,O}floor(){return new q(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}fractToRef(O){return O._x=this.x-Math.floor(this._x),O._y=this.y-Math.floor(this._y),O._z=this.z-Math.floor(this._z),O._isDirty=!0,O}fract(){return new q(this.x-Math.floor(this._x),this.y-Math.floor(this._y),this.z-Math.floor(this._z))}length(){return Math.sqrt(this.lengthSquared())}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z}get hasAZeroComponent(){return this._x*this._y*this._z===0}normalize(){return this.normalizeFromLength(this.length())}reorderInPlace(O){if("xyz"===(O=O.toLowerCase()))return this;const f=J.fb[0].p(this);return this.x=f[O[0]],this.y=f[O[1]],this.z=f[O[2]],this}rotateByQuaternionToRef(O,f){return O.toRotationMatrix(J.Matrix[0]),q.TransformCoordinatesToRef(this,J.Matrix[0],f),f}rotateByQuaternionAroundPointToRef(O,f,y){return this.subtractToRef(f,J.fb[0]),J.fb[0].rotateByQuaternionToRef(O,J.fb[0]),f.addToRef(J.fb[0],y),y}cross(O){return q.CrossToRef(this,O,new q)}normalizeFromLength(O){return 0===O||1===O?this:this.scaleInPlace(1/O)}normalizeToNew(){return this.normalizeToRef(new q)}normalizeToRef(O){const f=this.length();return 0===f||1===f?(O._x=this._x,O._y=this._y,O._z=this._z,O._isDirty=!0,O):this.scaleToRef(1/f,O)}clone(){return new q(this._x,this._y,this._z)}p(O){return this.Xd(O._x,O._y,O._z)}Xd(O,f,y){return this._x=O,this._y=f,this._z=y,this._isDirty=!0,this}set(O,f,y){return this.Xd(O,f,y)}Wd(O){return this._x=this._y=this._z=O,this._isDirty=!0,this}static GetClipFactor(O,f,y,S){const H=q.Dot(O,y);return(H-S)/(H-q.Dot(f,y))}static GetAngleBetweenVectors(O,f,y){const S=O.normalizeToRef(J.fb[1]),H=f.normalizeToRef(J.fb[2]);let b=q.Dot(S,H);b=(0,N.c)(b,-1,1);const h=Math.acos(b),v=J.fb[3];return q.CrossToRef(S,H,v),q.Dot(v,y)>0?isNaN(h)?0:h:isNaN(h)?-Math.PI:-Math.acos(b)}static GetAngleBetweenVectorsOnPlane(O,f,y){J.fb[0].p(O);const S=J.fb[0];J.fb[1].p(f);const H=J.fb[1];J.fb[2].p(y);const b=J.fb[2],h=J.fb[3],v=J.fb[4];S.normalize(),H.normalize(),b.normalize(),q.CrossToRef(b,S,h),q.CrossToRef(h,b,v);const m=Math.atan2(q.Dot(H,h),q.Dot(H,v));return(0,N.q)(m)}static PitchYawRollToMoveBetweenPointsToRef(O,f,y){const S=X.fb[0];return f.subtractToRef(O,S),y._y=Math.atan2(S.x,S.z)||0,y._x=Math.atan2(Math.sqrt(S.x**2+S.z**2),S.y)||0,y._z=0,y._isDirty=!0,y}static PitchYawRollToMoveBetweenPoints(O,f){const y=q.Zero();return q.PitchYawRollToMoveBetweenPointsToRef(O,f,y)}static SlerpToRef(O,f,y,H){y=(0,N.c)(y,0,1);const b=J.fb[0],h=J.fb[1];b.p(O);const v=b.length();b.normalizeFromLength(v),h.p(f);const m=h.length();h.normalizeFromLength(m);const t=q.Dot(b,h);let F,I;if(t<1-S.d){const O=Math.acos(t),f=1/Math.sin(O);F=Math.sin((1-y)*O)*f,I=Math.sin(y*O)*f}else F=1-y,I=y;return b.scaleInPlace(F),h.scaleInPlace(I),H.p(b).addInPlace(h),H.scaleInPlace((0,N.o)(v,m,y)),H}static SmoothToRef(O,f,y,S,H){return q.SlerpToRef(O,f,0===S?1:y/S,H),H}static Ng(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new q(O[f],O[f+1],O[f+2])}static FromFloatArray(O,f){return q.Ng(O,f)}static FromArrayToRef(O,f,y){return y._x=O[f],y._y=O[f+1],y._z=O[f+2],y._isDirty=!0,y}static FromFloatArrayToRef(O,f,y){return q.FromArrayToRef(O,f,y)}static FromFloatsToRef(O,f,y,S){return S.Xd(O,f,y),S}static Zero(){return new q(0,0,0)}static One(){return new q(1,1,1)}static Up(){return new q(0,1,0)}static get UpReadOnly(){return q._UpReadOnly}static get DownReadOnly(){return q._DownReadOnly}static get RightReadOnly(){return q._RightReadOnly}static get LeftReadOnly(){return q._LeftReadOnly}static get LeftHandedForwardReadOnly(){return q._LeftHandedForwardReadOnly}static get RightHandedForwardReadOnly(){return q._RightHandedForwardReadOnly}static get LeftHandedBackwardReadOnly(){return q._LeftHandedBackwardReadOnly}static get RightHandedBackwardReadOnly(){return q._RightHandedBackwardReadOnly}static get ZeroReadOnly(){return q._ZeroReadOnly}static get OneReadOnly(){return q._OneReadOnly}static Down(){return new q(0,-1,0)}static Forward(){return new q(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?-1:1)}static Backward(){return new q(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?1:-1)}static Right(){return new q(1,0,0)}static Left(){return new q(-1,0,0)}static Random(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new q((0,N.s)(O,f),(0,N.s)(O,f),(0,N.s)(O,f))}static RandomToRef(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).Xd((0,N.s)(O,f),(0,N.s)(O,f),(0,N.s)(O,f))}static TransformCoordinates(O,f){const y=q.Zero();return q.TransformCoordinatesToRef(O,f,y),y}static TransformCoordinatesToRef(O,f,y){return q.TransformCoordinatesFromFloatsToRef(O._x,O._y,O._z,f,y),y}static TransformCoordinatesFromFloatsToRef(O,f,y,S,H){const b=S.m,h=O*b[0]+f*b[4]+y*b[8]+b[12],v=O*b[1]+f*b[5]+y*b[9]+b[13],N=O*b[2]+f*b[6]+y*b[10]+b[14],m=1/(O*b[3]+f*b[7]+y*b[11]+b[15]);return H._x=h*m,H._y=v*m,H._z=N*m,H._isDirty=!0,H}static TransformNormal(O,f){const y=q.Zero();return q.TransformNormalToRef(O,f,y),y}static TransformNormalToRef(O,f,y){return this.TransformNormalFromFloatsToRef(O._x,O._y,O._z,f,y),y}static TransformNormalFromFloatsToRef(O,f,y,S,H){const b=S.m;return H._x=O*b[0]+f*b[4]+y*b[8],H._y=O*b[1]+f*b[5]+y*b[9],H._z=O*b[2]+f*b[6]+y*b[10],H._isDirty=!0,H}static CatmullRom(O,f,y,S,H){const b=H*H,h=H*b,v=.5*(2*f._x+(-O._x+y._x)*H+(2*O._x-5*f._x+4*y._x-S._x)*b+(-O._x+3*f._x-3*y._x+S._x)*h),N=.5*(2*f._y+(-O._y+y._y)*H+(2*O._y-5*f._y+4*y._y-S._y)*b+(-O._y+3*f._y-3*y._y+S._y)*h),m=.5*(2*f._z+(-O._z+y._z)*H+(2*O._z-5*f._z+4*y._z-S._z)*b+(-O._z+3*f._z-3*y._z+S._z)*h);return new q(v,N,m)}static Clamp(O,f,y){const S=new q;return q.ClampToRef(O,f,y,S),S}static ClampToRef(O,f,y,S){let H=O._x;H=H>y._x?y._x:H,H=H<f._x?f._x:H;let b=O._y;b=b>y._y?y._y:b,b=b<f._y?f._y:b;let h=O._z;return h=h>y._z?y._z:h,h=h<f._z?f._z:h,S.Xd(H,b,h),S}static CheckExtends(O,f,y){f.minimizeInPlace(O),y.maximizeInPlace(O)}static Hermite(O,f,y,S,H){const b=H*H,h=H*b,v=2*h-3*b+1,N=-2*h+3*b,m=h-2*b+H,t=h-b,F=O._x*v+y._x*N+f._x*m+S._x*t,I=O._y*v+y._y*N+f._y*m+S._y*t,A=O._z*v+y._z*N+f._z*m+S._z*t;return new q(F,I,A)}static Hermite1stDerivative(O,f,y,S,H){const b=new q;return this.Hermite1stDerivativeToRef(O,f,y,S,H,b),b}static Hermite1stDerivativeToRef(O,f,y,S,H,b){const h=H*H;return b._x=6*(h-H)*O._x+(3*h-4*H+1)*f._x+6*(-h+H)*y._x+(3*h-2*H)*S._x,b._y=6*(h-H)*O._y+(3*h-4*H+1)*f._y+6*(-h+H)*y._y+(3*h-2*H)*S._y,b._z=6*(h-H)*O._z+(3*h-4*H+1)*f._z+6*(-h+H)*y._z+(3*h-2*H)*S._z,b._isDirty=!0,b}static Lerp(O,f,y){const S=new q(0,0,0);return q.LerpToRef(O,f,y,S),S}static LerpToRef(O,f,y,S){return S._x=O._x+(f._x-O._x)*y,S._y=O._y+(f._y-O._y)*y,S._z=O._z+(f._z-O._z)*y,S._isDirty=!0,S}static Dot(O,f){return O._x*f._x+O._y*f._y+O._z*f._z}dot(O){return this._x*O._x+this._y*O._y+this._z*O._z}static Cross(O,f){const y=new q;return q.CrossToRef(O,f,y),y}static CrossToRef(O,f,y){const S=O._y*f._z-O._z*f._y,H=O._z*f._x-O._x*f._z,b=O._x*f._y-O._y*f._x;return y.Xd(S,H,b),y}static Normalize(O){const f=q.Zero();return q.NormalizeToRef(O,f),f}static NormalizeToRef(O,f){return O.normalizeToRef(f),f}static Project(O,f,y,S){const H=new q;return q.ProjectToRef(O,f,y,S,H),H}static ProjectToRef(O,f,y,S,H){var b;const h=S.width,N=S.height,m=S.x,t=S.y,F=J.Matrix[1],I=null===(b=v.c.LastCreatedEngine)||void 0===b?void 0:b.isNDCHalfZRange,X=I?1:.5,w=I?0:.5;A.FromValuesToRef(h/2,0,0,0,0,-N/2,0,0,0,0,X,0,m+h/2,N/2+t,w,1,F);const B=J.Matrix[0];return f.multiplyToRef(y,B),B.multiplyToRef(F,B),q.TransformCoordinatesToRef(O,B,H),H}static Reflect(O,f){return this.ReflectToRef(O,f,new q)}static ReflectToRef(O,f,y){const S=X.fb[0];return S.p(f).scaleInPlace(2*q.Dot(O,f)),y.p(O).ni(S)}static _UnprojectFromInvertedMatrixToRef(O,f,y){q.TransformCoordinatesToRef(O,f,y);const S=f.m,H=O._x*S[3]+O._y*S[7]+O._z*S[11]+S[15];return(0,N.A)(H,1)&&y.scaleInPlace(1/H),y}static UnprojectFromTransform(O,f,y,S,H){return this.Unproject(O,f,y,S,H,A.IdentityReadOnly)}static Unproject(O,f,y,S,H,b){const h=new q;return q.UnprojectToRef(O,f,y,S,H,b,h),h}static UnprojectToRef(O,f,y,S,H,b,h){return q.UnprojectFloatsToRef(O._x,O._y,O._z,f,y,S,H,b,h),h}static UnprojectFloatsToRef(O,f,y,S,H,b,h,N,m){var t;const F=J.Matrix[0];b.multiplyToRef(h,F),F.multiplyToRef(N,F),F.invert();const I=J.fb[0];return I.x=O/S*2-1,I.y=-(f/H*2-1),null!==(t=v.c.LastCreatedEngine)&&void 0!==t&&t.isNDCHalfZRange?I.z=y:I.z=2*y-1,q._UnprojectFromInvertedMatrixToRef(I,F,m),m}static Minimize(O,f){const y=new q;return y.p(O),y.minimizeInPlace(f),y}static Maximize(O,f){const y=new q;return y.p(O),y.maximizeInPlace(f),y}static Distance(O,f){return Math.sqrt(q.DistanceSquared(O,f))}static DistanceSquared(O,f){const y=O._x-f._x,S=O._y-f._y,H=O._z-f._z;return y*y+S*S+H*H}static ProjectOnTriangleToRef(O,f,y,H,b){const h=J.fb[0],v=J.fb[1],m=J.fb[2],t=J.fb[3],F=J.fb[4];y.subtractToRef(f,h),H.subtractToRef(f,v),H.subtractToRef(y,m);const I=h.length(),A=v.length(),X=m.length();if(I<S.d||A<S.d||X<S.d)return b.p(f),q.Distance(O,f);O.subtractToRef(f,F),q.CrossToRef(h,v,t);const w=t.length();if(w<S.d)return b.p(f),q.Distance(O,f);t.normalizeFromLength(w);let B=F.length();if(B<S.d)return b.p(f),0;F.normalizeFromLength(B);const j=q.Dot(t,F),u=J.fb[5],L=J.fb[6];u.p(t).scaleInPlace(-B*j),L.p(O).addInPlace(u);const p=J.fb[4],U=J.fb[5],l=J.fb[7],x=J.fb[8];p.p(h).scaleInPlace(1/I),x.p(v).scaleInPlace(1/A),p.addInPlace(x).scaleInPlace(-1),U.p(h).scaleInPlace(-1/I),x.p(m).scaleInPlace(1/X),U.addInPlace(x).scaleInPlace(-1),l.p(m).scaleInPlace(-1/X),x.p(v).scaleInPlace(-1/A),l.addInPlace(x).scaleInPlace(-1);const W=J.fb[9];let E;W.p(L).ni(f),q.CrossToRef(p,W,x),E=q.Dot(x,t);const o=E;W.p(L).ni(y),q.CrossToRef(U,W,x),E=q.Dot(x,t);const i=E;W.p(L).ni(H),q.CrossToRef(l,W,x),E=q.Dot(x,t);const D=E,V=J.fb[10];let g,R;o>0&&i<0?(V.p(h),g=f,R=y):i>0&&D<0?(V.p(m),g=y,R=H):(V.p(v).scaleInPlace(-1),g=H,R=f);const s=J.fb[9],k=J.fb[4];g.subtractToRef(L,x),R.subtractToRef(L,s),q.CrossToRef(x,s,k);if(!(q.Dot(k,t)<0))return b.p(L),Math.abs(B*j);const z=J.fb[5];q.CrossToRef(V,k,z),z.normalize();const c=J.fb[9];c.p(g).ni(L);const d=c.length();if(d<S.d)return b.p(g),q.Distance(O,g);c.normalizeFromLength(d);const G=q.Dot(z,c),Y=J.fb[7];Y.p(L).addInPlace(z.scaleInPlace(d*G)),x.p(Y).ni(g),B=V.length(),V.normalizeFromLength(B);let Z=q.Dot(x,V)/Math.max(B,S.d);return Z=(0,N.c)(Z,0,1),Y.p(g).addInPlace(V.scaleInPlace(Z*B)),b.p(Y),q.Distance(O,Y)}static Center(O,f){return q.CenterToRef(O,f,q.Zero())}static CenterToRef(O,f,y){return y.Xd((O._x+f._x)/2,(O._y+f._y)/2,(O._z+f._z)/2)}static RotationFromAxis(O,f,y){const S=new q;return q.RotationFromAxisToRef(O,f,y,S),S}static RotationFromAxisToRef(O,f,y,S){const H=J.Quaternion[0];return I.RotationQuaternionFromAxisToRef(O,f,y,H),H.toEulerAnglesToRef(S),S}}q._UpReadOnly=q.Up(),q._DownReadOnly=q.Down(),q._LeftHandedForwardReadOnly=q.Forward(!1),q._RightHandedForwardReadOnly=q.Forward(!0),q._LeftHandedBackwardReadOnly=q.Backward(!1),q._RightHandedBackwardReadOnly=q.Backward(!0),q._RightReadOnly=q.Right(),q._LeftReadOnly=q.Left(),q._ZeroReadOnly=q.Zero(),q._OneReadOnly=q.One(),Object.defineProperties(q.prototype,{dimension:{value:[3]},rank:{value:1}});class F{constructor(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.x=O,this.y=f,this.z=y,this.w=S}toString(){return`{X: ${this.x} Y: ${this.y} Z: ${this.z} W: ${this.w}}`}getClassName(){return"Vector4"}getHashCode(){let O=m(this.x);return O=397*O^m(this.y),O=397*O^m(this.z),O=397*O^m(this.w),O}gj(){return[this.x,this.y,this.z,this.w]}toArray(O,f){return void 0===f&&(f=0),O[f]=this.x,O[f+1]=this.y,O[f+2]=this.z,O[f+3]=this.w,this}Ac(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return F.FromArrayToRef(O,f,this),this}addInPlace(O){return this.x+=O.x,this.y+=O.y,this.z+=O.z,this.w+=O.w,this}addInPlaceFromFloats(O,f,y,S){return this.x+=O,this.y+=f,this.z+=y,this.w+=S,this}add(O){return new F(this.x+O.x,this.y+O.y,this.z+O.z,this.w+O.w)}addToRef(O,f){return f.x=this.x+O.x,f.y=this.y+O.y,f.z=this.z+O.z,f.w=this.w+O.w,f}ni(O){return this.x-=O.x,this.y-=O.y,this.z-=O.z,this.w-=O.w,this}xc(O){return new F(this.x-O.x,this.y-O.y,this.z-O.z,this.w-O.w)}subtractToRef(O,f){return f.x=this.x-O.x,f.y=this.y-O.y,f.z=this.z-O.z,f.w=this.w-O.w,f}subtractFromFloats(O,f,y,S){return new F(this.x-O,this.y-f,this.z-y,this.w-S)}subtractFromFloatsToRef(O,f,y,S,H){return H.x=this.x-O,H.y=this.y-f,H.z=this.z-y,H.w=this.w-S,H}negate(){return new F(-this.x,-this.y,-this.z,-this.w)}negateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}negateToRef(O){return O.x=-this.x,O.y=-this.y,O.z=-this.z,O.w=-this.w,O}scaleInPlace(O){return this.x*=O,this.y*=O,this.z*=O,this.w*=O,this}scale(O){return new F(this.x*O,this.y*O,this.z*O,this.w*O)}scaleToRef(O,f){return f.x=this.x*O,f.y=this.y*O,f.z=this.z*O,f.w=this.w*O,f}scaleAndAddToRef(O,f){return f.x+=this.x*O,f.y+=this.y*O,f.z+=this.z*O,f.w+=this.w*O,f}equals(O){return O&&this.x===O.x&&this.y===O.y&&this.z===O.z&&this.w===O.w}equalsWithEpsilon(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S.d;return O&&(0,N.A)(this.x,O.x,f)&&(0,N.A)(this.y,O.y,f)&&(0,N.A)(this.z,O.z,f)&&(0,N.A)(this.w,O.w,f)}equalsToFloats(O,f,y,S){return this.x===O&&this.y===f&&this.z===y&&this.w===S}multiplyInPlace(O){return this.x*=O.x,this.y*=O.y,this.z*=O.z,this.w*=O.w,this}multiply(O){return new F(this.x*O.x,this.y*O.y,this.z*O.z,this.w*O.w)}multiplyToRef(O,f){return f.x=this.x*O.x,f.y=this.y*O.y,f.z=this.z*O.z,f.w=this.w*O.w,f}multiplyByFloats(O,f,y,S){return new F(this.x*O,this.y*f,this.z*y,this.w*S)}divide(O){return new F(this.x/O.x,this.y/O.y,this.z/O.z,this.w/O.w)}divideToRef(O,f){return f.x=this.x/O.x,f.y=this.y/O.y,f.z=this.z/O.z,f.w=this.w/O.w,f}divideInPlace(O){return this.divideToRef(O,this)}minimizeInPlace(O){return O.x<this.x&&(this.x=O.x),O.y<this.y&&(this.y=O.y),O.z<this.z&&(this.z=O.z),O.w<this.w&&(this.w=O.w),this}maximizeInPlace(O){return O.x>this.x&&(this.x=O.x),O.y>this.y&&(this.y=O.y),O.z>this.z&&(this.z=O.z),O.w>this.w&&(this.w=O.w),this}minimizeInPlaceFromFloats(O,f,y,S){return this.x=Math.min(O,this.x),this.y=Math.min(f,this.y),this.z=Math.min(y,this.z),this.w=Math.min(S,this.w),this}maximizeInPlaceFromFloats(O,f,y,S){return this.x=Math.max(O,this.x),this.y=Math.max(f,this.y),this.z=Math.max(y,this.z),this.w=Math.max(S,this.w),this}floorToRef(O){return O.x=Math.floor(this.x),O.y=Math.floor(this.y),O.z=Math.floor(this.z),O.w=Math.floor(this.w),O}floor(){return new F(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}fractToRef(O){return O.x=this.x-Math.floor(this.x),O.y=this.y-Math.floor(this.y),O.z=this.z-Math.floor(this.z),O.w=this.w-Math.floor(this.w),O}fract(){return new F(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(O){return 0===O||1===O?this:this.scaleInPlace(1/O)}normalizeToNew(){return this.normalizeToRef(new F)}normalizeToRef(O){const f=this.length();return 0===f||1===f?(O.x=this.x,O.y=this.y,O.z=this.z,O.w=this.w,O):this.scaleToRef(1/f,O)}toVector3(){return new q(this.x,this.y,this.z)}clone(){return new F(this.x,this.y,this.z,this.w)}p(O){return this.x=O.x,this.y=O.y,this.z=O.z,this.w=O.w,this}Xd(O,f,y,S){return this.x=O,this.y=f,this.z=y,this.w=S,this}set(O,f,y,S){return this.Xd(O,f,y,S)}Wd(O){return this.x=this.y=this.z=this.w=O,this}dot(O){return this.x*O.x+this.y*O.y+this.z*O.z+this.w*O.w}static Ng(O,f){return f||(f=0),new F(O[f],O[f+1],O[f+2],O[f+3])}static FromArrayToRef(O,f,y){return y.x=O[f],y.y=O[f+1],y.z=O[f+2],y.w=O[f+3],y}static FromFloatArrayToRef(O,f,y){return F.FromArrayToRef(O,f,y),y}static FromFloatsToRef(O,f,y,S,H){return H.x=O,H.y=f,H.z=y,H.w=S,H}static Zero(){return new F(0,0,0,0)}static One(){return new F(1,1,1,1)}static Random(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new F((0,N.s)(O,f),(0,N.s)(O,f),(0,N.s)(O,f),(0,N.s)(O,f))}static RandomToRef(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,y=arguments.length>2?arguments[2]:void 0;return y.x=(0,N.s)(O,f),y.y=(0,N.s)(O,f),y.z=(0,N.s)(O,f),y.w=(0,N.s)(O,f),y}static Clamp(O,f,y){return F.ClampToRef(O,f,y,new F)}static ClampToRef(O,f,y,S){return S.x=(0,N.c)(O.x,f.x,y.x),S.y=(0,N.c)(O.y,f.y,y.y),S.z=(0,N.c)(O.z,f.z,y.z),S.w=(0,N.c)(O.w,f.w,y.w),S}static CheckExtends(O,f,y){f.minimizeInPlace(O),y.maximizeInPlace(O)}static get ZeroReadOnly(){return F._ZeroReadOnly}static Normalize(O){return F.NormalizeToRef(O,new F)}static NormalizeToRef(O,f){return O.normalizeToRef(f),f}static Minimize(O,f){const y=new F;return y.p(O),y.minimizeInPlace(f),y}static Maximize(O,f){const y=new F;return y.p(O),y.maximizeInPlace(f),y}static Distance(O,f){return Math.sqrt(F.DistanceSquared(O,f))}static DistanceSquared(O,f){const y=O.x-f.x,S=O.y-f.y,H=O.z-f.z,b=O.w-f.w;return y*y+S*S+H*H+b*b}static Center(O,f){return F.CenterToRef(O,f,new F)}static CenterToRef(O,f,y){return y.x=(O.x+f.x)/2,y.y=(O.y+f.y)/2,y.z=(O.z+f.z)/2,y.w=(O.w+f.w)/2,y}static TransformCoordinates(O,f){return F.TransformCoordinatesToRef(O,f,new F)}static TransformCoordinatesToRef(O,f,y){return F.TransformCoordinatesFromFloatsToRef(O._x,O._y,O._z,f,y),y}static TransformCoordinatesFromFloatsToRef(O,f,y,S,H){const b=S.m,h=O*b[0]+f*b[4]+y*b[8]+b[12],v=O*b[1]+f*b[5]+y*b[9]+b[13],N=O*b[2]+f*b[6]+y*b[10]+b[14],m=O*b[3]+f*b[7]+y*b[11]+b[15];return H.x=h,H.y=v,H.z=N,H.w=m,H}static TransformNormal(O,f){return F.TransformNormalToRef(O,f,new F)}static TransformNormalToRef(O,f,y){const S=f.m,H=O.x*S[0]+O.y*S[4]+O.z*S[8],b=O.x*S[1]+O.y*S[5]+O.z*S[9],h=O.x*S[2]+O.y*S[6]+O.z*S[10];return y.x=H,y.y=b,y.z=h,y.w=O.w,y}static TransformNormalFromFloatsToRef(O,f,y,S,H,b){const h=H.m;return b.x=O*h[0]+f*h[4]+y*h[8],b.y=O*h[1]+f*h[5]+y*h[9],b.z=O*h[2]+f*h[6]+y*h[10],b.w=S,b}static FromVector3(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new F(O._x,O._y,O._z,f)}static Dot(O,f){return O.x*f.x+O.y*f.y+O.z*f.z+O.w*f.w}}F._ZeroReadOnly=F.Zero(),Object.defineProperties(F.prototype,{dimension:{value:[4]},rank:{value:1}});class I{get x(){return this._x}set x(O){this._x=O,this._isDirty=!0}get y(){return this._y}set y(O){this._y=O,this._isDirty=!0}get z(){return this._z}set z(O){this._z=O,this._isDirty=!0}get w(){return this._w}set w(O){this._w=O,this._isDirty=!0}constructor(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this._isDirty=!0,this._x=O,this._y=f,this._z=y,this._w=S}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Quaternion"}getHashCode(){let O=m(this._x);return O=397*O^m(this._y),O=397*O^m(this._z),O=397*O^m(this._w),O}gj(){return[this._x,this._y,this._z,this._w]}toArray(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return O[f]=this._x,O[f+1]=this._y,O[f+2]=this._z,O[f+3]=this._w,this}Ac(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return I.FromArrayToRef(O,f,this)}equals(O){return O&&this._x===O._x&&this._y===O._y&&this._z===O._z&&this._w===O._w}equalsWithEpsilon(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S.d;return O&&(0,N.A)(this._x,O._x,f)&&(0,N.A)(this._y,O._y,f)&&(0,N.A)(this._z,O._z,f)&&(0,N.A)(this._w,O._w,f)}clone(){return new I(this._x,this._y,this._z,this._w)}p(O){return this._x=O._x,this._y=O._y,this._z=O._z,this._w=O._w,this._isDirty=!0,this}Xd(O,f,y,S){return this._x=O,this._y=f,this._z=y,this._w=S,this._isDirty=!0,this}set(O,f,y,S){return this.Xd(O,f,y,S)}Wd(O){return this.Xd(O,O,O,O)}add(O){return new I(this._x+O._x,this._y+O._y,this._z+O._z,this._w+O._w)}addInPlace(O){return this._x+=O._x,this._y+=O._y,this._z+=O._z,this._w+=O._w,this._isDirty=!0,this}addToRef(O,f){return f._x=this._x+O._x,f._y=this._y+O._y,f._z=this._z+O._z,f._w=this._w+O._w,f._isDirty=!0,f}addInPlaceFromFloats(O,f,y,S){return this._x+=O,this._y+=f,this._z+=y,this._w+=S,this._isDirty=!0,this}subtractToRef(O,f){return f._x=this._x-O._x,f._y=this._y-O._y,f._z=this._z-O._z,f._w=this._w-O._w,f._isDirty=!0,f}subtractFromFloats(O,f,y,S){return this.subtractFromFloatsToRef(O,f,y,S,new I)}subtractFromFloatsToRef(O,f,y,S,H){return H._x=this._x-O,H._y=this._y-f,H._z=this._z-y,H._w=this._w-S,H._isDirty=!0,H}xc(O){return new I(this._x-O._x,this._y-O._y,this._z-O._z,this._w-O._w)}ni(O){return this._x-=O._x,this._y-=O._y,this._z-=O._z,this._w-=O._w,this._isDirty=!0,this}scale(O){return new I(this._x*O,this._y*O,this._z*O,this._w*O)}scaleToRef(O,f){return f._x=this._x*O,f._y=this._y*O,f._z=this._z*O,f._w=this._w*O,f._isDirty=!0,f}scaleInPlace(O){return this._x*=O,this._y*=O,this._z*=O,this._w*=O,this._isDirty=!0,this}scaleAndAddToRef(O,f){return f._x+=this._x*O,f._y+=this._y*O,f._z+=this._z*O,f._w+=this._w*O,f._isDirty=!0,f}multiply(O){const f=new I(0,0,0,1);return this.multiplyToRef(O,f),f}multiplyToRef(O,f){const y=this._x*O._w+this._y*O._z-this._z*O._y+this._w*O._x,S=-this._x*O._z+this._y*O._w+this._z*O._x+this._w*O._y,H=this._x*O._y-this._y*O._x+this._z*O._w+this._w*O._z,b=-this._x*O._x-this._y*O._y-this._z*O._z+this._w*O._w;return f.Xd(y,S,H,b),f}multiplyInPlace(O){return this.multiplyToRef(O,this)}multiplyByFloats(O,f,y,S){return this._x*=O,this._y*=f,this._z*=y,this._w*=S,this._isDirty=!0,this}divide(O){throw new ReferenceError("Can not divide a quaternion")}divideToRef(O,f){throw new ReferenceError("Can not divide a quaternion")}divideInPlace(O){throw new ReferenceError("Can not divide a quaternion")}minimizeInPlace(){throw new ReferenceError("Can not minimize a quaternion")}minimizeInPlaceFromFloats(){throw new ReferenceError("Can not minimize a quaternion")}maximizeInPlace(){throw new ReferenceError("Can not maximize a quaternion")}maximizeInPlaceFromFloats(){throw new ReferenceError("Can not maximize a quaternion")}negate(){return this.negateToRef(new I)}negateInPlace(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._isDirty=!0,this}negateToRef(O){return O._x=-this._x,O._y=-this._y,O._z=-this._z,O._w=-this._w,O._isDirty=!0,O}equalsToFloats(O,f,y,S){return this._x===O&&this._y===f&&this._z===y&&this._w===S}floorToRef(O){throw new ReferenceError("Can not floor a quaternion")}floor(){throw new ReferenceError("Can not floor a quaternion")}fractToRef(O){throw new ReferenceError("Can not fract a quaternion")}fract(){throw new ReferenceError("Can not fract a quaternion")}conjugateToRef(O){return O.Xd(-this._x,-this._y,-this._z,this._w),O}conjugateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}conjugate(){return new I(-this._x,-this._y,-this._z,this._w)}invert(){const O=this.conjugate(),f=this.lengthSquared();return 0==f||1==f||O.scaleInPlace(1/f),O}invertInPlace(){this.conjugateInPlace();const O=this.lengthSquared();return 0==O||1==O||this.scaleInPlace(1/O),this}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this.lengthSquared())}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(O){return 0===O||1===O?this:this.scaleInPlace(1/O)}normalizeToNew(){const O=new I(0,0,0,1);return this.normalizeToRef(O),O}normalizeToRef(O){const f=this.length();return 0===f||1===f?O.Xd(this._x,this._y,this._z,this._w):this.scaleToRef(1/f,O)}toEulerAngles(){const O=q.Zero();return this.toEulerAnglesToRef(O),O}toEulerAnglesToRef(O){const f=this._z,y=this._x,S=this._y,H=this._w,b=S*f-y*H,h=.4999999;if(b<-h)O._y=2*Math.atan2(S,H),O._x=Math.PI/2,O._z=0,O._isDirty=!0;else if(b>h)O._y=2*Math.atan2(S,H),O._x=-Math.PI/2,O._z=0,O._isDirty=!0;else{const h=H*H,v=f*f,N=y*y,m=S*S;O._z=Math.atan2(2*(y*S+f*H),-v-N+m+h),O._x=Math.asin(-2*b),O._y=Math.atan2(2*(f*y+S*H),v-N-m+h),O._isDirty=!0}return O}toAlphaBetaGammaToRef(O){const f=this._z,y=this._x,S=this._y,H=this._w,b=Math.sqrt(y*y+S*S),h=Math.sqrt(f*f+H*H),v=2*Math.atan2(b,h),N=2*Math.atan2(f,H),m=2*Math.atan2(S,y),t=(N+m)/2,q=(N-m)/2;return O.set(q,v,t),O}toRotationMatrix(O){return A.FromQuaternionToRef(this,O),O}fromRotationMatrix(O){return I.FromRotationMatrixToRef(O,this),this}dot(O){return this._x*O._x+this._y*O._y+this._z*O._z+this._w*O._w}static FromRotationMatrix(O){const f=new I;return I.FromRotationMatrixToRef(O,f),f}static FromRotationMatrixToRef(O,f){const y=O.m,S=y[0],H=y[4],b=y[8],h=y[1],v=y[5],N=y[9],m=y[2],t=y[6],q=y[10],F=S+v+q;let I;return F>0?(I=.5/Math.sqrt(F+1),f._w=.25/I,f._x=(t-N)*I,f._y=(b-m)*I,f._z=(h-H)*I,f._isDirty=!0):S>v&&S>q?(I=2*Math.sqrt(1+S-v-q),f._w=(t-N)/I,f._x=.25*I,f._y=(H+h)/I,f._z=(b+m)/I,f._isDirty=!0):v>q?(I=2*Math.sqrt(1+v-S-q),f._w=(b-m)/I,f._x=(H+h)/I,f._y=.25*I,f._z=(N+t)/I,f._isDirty=!0):(I=2*Math.sqrt(1+q-S-v),f._w=(h-H)/I,f._x=(b+m)/I,f._y=(N+t)/I,f._z=.25*I,f._isDirty=!0),f}static Dot(O,f){return O._x*f._x+O._y*f._y+O._z*f._z+O._w*f._w}static AreClose(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1;const S=I.Dot(O,f);return 1-S*S<=y}static SmoothToRef(O,f,y,S,H){let b=0===S?1:y/S;return b=(0,N.c)(b,0,1),I.SlerpToRef(O,f,b,H),H}static Zero(){return new I(0,0,0,0)}static Inverse(O){return new I(-O._x,-O._y,-O._z,O._w)}static InverseToRef(O,f){return f.set(-O._x,-O._y,-O._z,O._w),f}static Identity(){return new I(0,0,0,1)}static IsIdentity(O){return O&&0===O._x&&0===O._y&&0===O._z&&1===O._w}static RotationAxis(O,f){return I.RotationAxisToRef(O,f,new I)}static RotationAxisToRef(O,f,y){y._w=Math.cos(f/2);const S=Math.sin(f/2)/O.length();return y._x=O._x*S,y._y=O._y*S,y._z=O._z*S,y._isDirty=!0,y}static Ng(O,f){return f||(f=0),new I(O[f],O[f+1],O[f+2],O[f+3])}static FromArrayToRef(O,f,y){return y._x=O[f],y._y=O[f+1],y._z=O[f+2],y._w=O[f+3],y._isDirty=!0,y}static FromFloatsToRef(O,f,y,S,H){return H.Xd(O,f,y,S),H}static FromEulerAngles(O,f,y){const S=new I;return I.RotationYawPitchRollToRef(f,O,y,S),S}static FromEulerAnglesToRef(O,f,y,S){return I.RotationYawPitchRollToRef(f,O,y,S),S}static FromEulerVector(O){const f=new I;return I.RotationYawPitchRollToRef(O._y,O._x,O._z,f),f}static FromEulerVectorToRef(O,f){return I.RotationYawPitchRollToRef(O._y,O._x,O._z,f),f}static FromUnitVectorsToRef(O,f,y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:S.d;const b=q.Dot(O,f)+1;return b<H?Math.abs(O.x)>Math.abs(O.z)?y.set(-O.y,O.x,0,0):y.set(0,-O.z,O.y,0):(q.CrossToRef(O,f,X.fb[0]),y.set(X.fb[0].x,X.fb[0].y,X.fb[0].z,b)),y.normalize()}static RotationYawPitchRoll(O,f,y){const S=new I;return I.RotationYawPitchRollToRef(O,f,y,S),S}static RotationYawPitchRollToRef(O,f,y,S){const H=.5*y,b=.5*f,h=.5*O,v=Math.sin(H),N=Math.cos(H),m=Math.sin(b),t=Math.cos(b),q=Math.sin(h),F=Math.cos(h);return S._x=F*m*N+q*t*v,S._y=q*t*N-F*m*v,S._z=F*t*v-q*m*N,S._w=F*t*N+q*m*v,S._isDirty=!0,S}static RotationAlphaBetaGamma(O,f,y){const S=new I;return I.RotationAlphaBetaGammaToRef(O,f,y,S),S}static RotationAlphaBetaGammaToRef(O,f,y,S){const H=.5*(y+O),b=.5*(y-O),h=.5*f;return S._x=Math.cos(b)*Math.sin(h),S._y=Math.sin(b)*Math.sin(h),S._z=Math.sin(H)*Math.cos(h),S._w=Math.cos(H)*Math.cos(h),S._isDirty=!0,S}static RotationQuaternionFromAxis(O,f,y){const S=new I(0,0,0,0);return I.RotationQuaternionFromAxisToRef(O,f,y,S),S}static RotationQuaternionFromAxisToRef(O,f,y,S){const H=J.Matrix[0];return O=O.normalizeToRef(J.fb[0]),f=f.normalizeToRef(J.fb[1]),y=y.normalizeToRef(J.fb[2]),A.FromXYZAxesToRef(O,f,y,H),I.FromRotationMatrixToRef(H,S),S}static FromLookDirectionLH(O,f){const y=new I;return I.FromLookDirectionLHToRef(O,f,y),y}static FromLookDirectionLHToRef(O,f,y){const S=J.Matrix[0];return A.LookDirectionLHToRef(O,f,S),I.FromRotationMatrixToRef(S,y),y}static FromLookDirectionRH(O,f){const y=new I;return I.FromLookDirectionRHToRef(O,f,y),y}static FromLookDirectionRHToRef(O,f,y){const S=J.Matrix[0];return A.LookDirectionRHToRef(O,f,S),I.FromRotationMatrixToRef(S,y)}static Slerp(O,f,y){const S=I.Identity();return I.SlerpToRef(O,f,y,S),S}static SlerpToRef(O,f,y,S){let H,b,h=O._x*f._x+O._y*f._y+O._z*f._z+O._w*f._w,v=!1;if(h<0&&(v=!0,h=-h),h>.999999)b=1-y,H=v?-y:y;else{const O=Math.acos(h),f=1/Math.sin(O);b=Math.sin((1-y)*O)*f,H=v?-Math.sin(y*O)*f:Math.sin(y*O)*f}return S._x=b*O._x+H*f._x,S._y=b*O._y+H*f._y,S._z=b*O._z+H*f._z,S._w=b*O._w+H*f._w,S._isDirty=!0,S}static Hermite(O,f,y,S,H){const b=H*H,h=H*b,v=2*h-3*b+1,N=-2*h+3*b,m=h-2*b+H,t=h-b,q=O._x*v+y._x*N+f._x*m+S._x*t,F=O._y*v+y._y*N+f._y*m+S._y*t,A=O._z*v+y._z*N+f._z*m+S._z*t,J=O._w*v+y._w*N+f._w*m+S._w*t;return new I(q,F,A,J)}static Hermite1stDerivative(O,f,y,S,H){const b=new I;return this.Hermite1stDerivativeToRef(O,f,y,S,H,b),b}static Hermite1stDerivativeToRef(O,f,y,S,H,b){const h=H*H;return b._x=6*(h-H)*O._x+(3*h-4*H+1)*f._x+6*(-h+H)*y._x+(3*h-2*H)*S._x,b._y=6*(h-H)*O._y+(3*h-4*H+1)*f._y+6*(-h+H)*y._y+(3*h-2*H)*S._y,b._z=6*(h-H)*O._z+(3*h-4*H+1)*f._z+6*(-h+H)*y._z+(3*h-2*H)*S._z,b._w=6*(h-H)*O._w+(3*h-4*H+1)*f._w+6*(-h+H)*y._w+(3*h-2*H)*S._w,b._isDirty=!0,b}static Normalize(O){const f=I.Zero();return I.NormalizeToRef(O,f),f}static NormalizeToRef(O,f){return O.normalizeToRef(f),f}static Clamp(O,f,y){const S=new I;return I.ClampToRef(O,f,y,S),S}static ClampToRef(O,f,y,S){return S.Xd((0,N.c)(O.x,f.x,y.x),(0,N.c)(O.y,f.y,y.y),(0,N.c)(O.z,f.z,y.z),(0,N.c)(O.w,f.w,y.w))}static Random(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new I((0,N.s)(O,f),(0,N.s)(O,f),(0,N.s)(O,f),(0,N.s)(O,f))}static RandomToRef(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).Xd((0,N.s)(O,f),(0,N.s)(O,f),(0,N.s)(O,f),(0,N.s)(O,f))}static Minimize(){throw new ReferenceError("Quaternion.Minimize does not make sense")}static Maximize(){throw new ReferenceError("Quaternion.Maximize does not make sense")}static Distance(O,f){return Math.sqrt(I.DistanceSquared(O,f))}static DistanceSquared(O,f){const y=O.x-f.x,S=O.y-f.y,H=O.z-f.z,b=O.w-f.w;return y*y+S*S+H*H+b*b}static Center(O,f){return I.CenterToRef(O,f,I.Zero())}static CenterToRef(O,f,y){return y.Xd((O.x+f.x)/2,(O.y+f.y)/2,(O.z+f.z)/2,(O.w+f.w)/2)}}Object.defineProperties(I.prototype,{dimension:{value:[4]},rank:{value:1}});class A{static get Use64Bits(){return h.c.MatrixUse64Bits}get m(){return this.Nj}markAsUpdated(){this.updateFlag=A._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}_updateIdentityStatus(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._isIdentity=O,this._isIdentity3x2=O||y,this._isIdentityDirty=!this._isIdentity&&f,this._isIdentity3x2Dirty=!this._isIdentity3x2&&S}constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,h.c.MatrixTrackPrecisionChange&&h.c.MatrixTrackedMatrices.push(this),this.Nj=new h.c.MatrixCurrentType(16),this.markAsUpdated()}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const O=this.Nj;this._isIdentity=1===O[0]&&0===O[1]&&0===O[2]&&0===O[3]&&0===O[4]&&1===O[5]&&0===O[6]&&0===O[7]&&0===O[8]&&0===O[9]&&1===O[10]&&0===O[11]&&0===O[12]&&0===O[13]&&0===O[14]&&1===O[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this.Nj[0]||1!==this.Nj[5]||1!==this.Nj[15]||0!==this.Nj[1]||0!==this.Nj[2]||0!==this.Nj[3]||0!==this.Nj[4]||0!==this.Nj[6]||0!==this.Nj[7]||0!==this.Nj[8]||0!==this.Nj[9]||0!==this.Nj[10]||0!==this.Nj[11]||0!==this.Nj[12]||0!==this.Nj[13]||0!==this.Nj[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const O=this.Nj,f=O[0],y=O[1],S=O[2],H=O[3],b=O[4],h=O[5],v=O[6],N=O[7],m=O[8],t=O[9],q=O[10],F=O[11],I=O[12],A=O[13],J=O[14],X=O[15],w=q*X-J*F,B=t*X-A*F,j=t*J-A*q,u=m*X-I*F,L=m*J-q*I,p=m*A-I*t;return f*+(h*w-v*B+N*j)+y*-(b*w-v*u+N*L)+S*+(b*B-h*u+N*p)+H*-(b*j-h*L+v*p)}toString(){return`{${this.m[0]}, ${this.m[1]}, ${this.m[2]}, ${this.m[3]}\n${this.m[4]}, ${this.m[5]}, ${this.m[6]}, ${this.m[7]}\n${this.m[8]}, ${this.m[9]}, ${this.m[10]}, ${this.m[11]}\n${this.m[12]}, ${this.m[13]}, ${this.m[14]}, ${this.m[15]}}`}toArray(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!O)return this.Nj;const y=this.Nj;for(let S=0;S<16;S++)O[f+S]=y[S];return this}gj(){return this.Nj}Ac(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return A.FromArrayToRef(O,f,this)}Xd(){for(var O=arguments.length,f=new Array(O),y=0;y<O;y++)f[y]=arguments[y];return A.FromArrayToRef(f,0,this)}set(){const O=this.Nj;for(let f=0;f<16;f++)O[f]=f<0||arguments.length<=f?void 0:arguments[f];return this.markAsUpdated(),this}Wd(O){const f=this.Nj;for(let y=0;y<16;y++)f[y]=O;return this.markAsUpdated(),this}invert(){return this.invertToRef(this),this}reset(){return A.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(O){const f=new A;return this.addToRef(O,f),f}addToRef(O,f){const y=this.Nj,S=f.Nj,H=O.m;for(let b=0;b<16;b++)S[b]=y[b]+H[b];return f.markAsUpdated(),f}addToSelf(O){const f=this.Nj,y=O.m;return f[0]+=y[0],f[1]+=y[1],f[2]+=y[2],f[3]+=y[3],f[4]+=y[4],f[5]+=y[5],f[6]+=y[6],f[7]+=y[7],f[8]+=y[8],f[9]+=y[9],f[10]+=y[10],f[11]+=y[11],f[12]+=y[12],f[13]+=y[13],f[14]+=y[14],f[15]+=y[15],this.markAsUpdated(),this}addInPlace(O){const f=this.Nj,y=O.m;for(let S=0;S<16;S++)f[S]+=y[S];return this.markAsUpdated(),this}addInPlaceFromFloats(){const O=this.Nj;for(let f=0;f<16;f++)O[f]+=f<0||arguments.length<=f?void 0:arguments[f];return this.markAsUpdated(),this}xc(O){const f=this.Nj,y=O.m;for(let S=0;S<16;S++)f[S]-=y[S];return this.markAsUpdated(),this}subtractToRef(O,f){const y=this.Nj,S=O.m,H=f.Nj;for(let b=0;b<16;b++)H[b]=y[b]-S[b];return f.markAsUpdated(),f}ni(O){const f=this.Nj,y=O.m;for(let S=0;S<16;S++)f[S]-=y[S];return this.markAsUpdated(),this}subtractFromFloats(){for(var O=arguments.length,f=new Array(O),y=0;y<O;y++)f[y]=arguments[y];return this.subtractFromFloatsToRef(...f,new A)}subtractFromFloatsToRef(){for(var O=arguments.length,f=new Array(O),y=0;y<O;y++)f[y]=arguments[y];const S=f.pop(),H=this.Nj,b=S.Nj,h=f;for(let v=0;v<16;v++)b[v]=H[v]-h[v];return S.markAsUpdated(),S}invertToRef(O){if(!0===this._isIdentity)return A.IdentityToRef(O),O;const f=this.Nj,y=f[0],S=f[1],H=f[2],b=f[3],h=f[4],v=f[5],N=f[6],m=f[7],t=f[8],q=f[9],F=f[10],I=f[11],J=f[12],X=f[13],w=f[14],B=f[15],j=F*B-w*I,u=q*B-X*I,L=q*w-X*F,p=t*B-J*I,U=t*w-F*J,l=t*X-J*q,x=+(v*j-N*u+m*L),W=-(h*j-N*p+m*U),E=+(h*u-v*p+m*l),o=-(h*L-v*U+N*l),i=y*x+S*W+H*E+b*o;if(0===i)return O.p(this),O;const D=1/i,V=N*B-w*m,g=v*B-X*m,R=v*w-X*N,s=h*B-J*m,k=h*w-J*N,z=h*X-J*v,c=N*I-F*m,d=v*I-q*m,G=v*F-q*N,Y=h*I-t*m,Z=h*F-t*N,a=h*q-t*v,M=-(S*j-H*u+b*L),P=+(y*j-H*p+b*U),e=-(y*u-S*p+b*l),K=+(y*L-S*U+H*l),T=+(S*V-H*g+b*R),Q=-(y*V-H*s+b*k),C=+(y*g-S*s+b*z),r=-(y*R-S*k+H*z),n=-(S*c-H*d+b*G),OO=+(y*c-H*Y+b*Z),fO=-(y*d-S*Y+b*a),yO=+(y*G-S*Z+H*a);return A.FromValuesToRef(x*D,M*D,T*D,n*D,W*D,P*D,Q*D,OO*D,E*D,e*D,C*D,fO*D,o*D,K*D,r*D,yO*D,O),O}addAtIndex(O,f){return this.Nj[O]+=f,this.markAsUpdated(),this}multiplyAtIndex(O,f){return this.Nj[O]*=f,this.markAsUpdated(),this}setTranslationFromFloats(O,f,y){return this.Nj[12]=O,this.Nj[13]=f,this.Nj[14]=y,this.markAsUpdated(),this}addTranslationFromFloats(O,f,y){return this.Nj[12]+=O,this.Nj[13]+=f,this.Nj[14]+=y,this.markAsUpdated(),this}setTranslation(O){return this.setTranslationFromFloats(O._x,O._y,O._z)}getTranslation(){return new q(this.Nj[12],this.Nj[13],this.Nj[14])}getTranslationToRef(O){return O.x=this.Nj[12],O.y=this.Nj[13],O.z=this.Nj[14],O}removeRotationAndScaling(){const O=this.m;return A.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,O[12],O[13],O[14],O[15],this),this._updateIdentityStatus(0===O[12]&&0===O[13]&&0===O[14]&&1===O[15]),this}p(O){O.copyToArray(this.Nj);const f=O;return this.updateFlag=f.updateFlag,this._updateIdentityStatus(f._isIdentity,f._isIdentityDirty,f._isIdentity3x2,f._isIdentity3x2Dirty),this}copyToArray(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const y=this.Nj;return O[f]=y[0],O[f+1]=y[1],O[f+2]=y[2],O[f+3]=y[3],O[f+4]=y[4],O[f+5]=y[5],O[f+6]=y[6],O[f+7]=y[7],O[f+8]=y[8],O[f+9]=y[9],O[f+10]=y[10],O[f+11]=y[11],O[f+12]=y[12],O[f+13]=y[13],O[f+14]=y[14],O[f+15]=y[15],this}multiply(O){const f=new A;return this.multiplyToRef(O,f),f}multiplyInPlace(O){const f=this.Nj,y=O.m;for(let S=0;S<16;S++)f[S]*=y[S];return this.markAsUpdated(),this}multiplyByFloats(){const O=this.Nj;for(let f=0;f<16;f++)O[f]*=f<0||arguments.length<=f?void 0:arguments[f];return this.markAsUpdated(),this}multiplyByFloatsToRef(){for(var O=arguments.length,f=new Array(O),y=0;y<O;y++)f[y]=arguments[y];const S=f.pop(),H=this.Nj,b=S.Nj,h=f;for(let v=0;v<16;v++)b[v]=H[v]*h[v];return S.markAsUpdated(),S}multiplyToRef(O,f){return this._isIdentity?(f.p(O),f):O._isIdentity?(f.p(this),f):(this.multiplyToArray(O,f.Nj,0),f.markAsUpdated(),f)}multiplyToArray(O,f,y){const S=this.Nj,H=O.m,b=S[0],h=S[1],v=S[2],N=S[3],m=S[4],t=S[5],q=S[6],F=S[7],I=S[8],A=S[9],J=S[10],X=S[11],w=S[12],B=S[13],j=S[14],u=S[15],L=H[0],p=H[1],U=H[2],l=H[3],x=H[4],W=H[5],E=H[6],o=H[7],i=H[8],D=H[9],V=H[10],g=H[11],R=H[12],s=H[13],k=H[14],z=H[15];return f[y]=b*L+h*x+v*i+N*R,f[y+1]=b*p+h*W+v*D+N*s,f[y+2]=b*U+h*E+v*V+N*k,f[y+3]=b*l+h*o+v*g+N*z,f[y+4]=m*L+t*x+q*i+F*R,f[y+5]=m*p+t*W+q*D+F*s,f[y+6]=m*U+t*E+q*V+F*k,f[y+7]=m*l+t*o+q*g+F*z,f[y+8]=I*L+A*x+J*i+X*R,f[y+9]=I*p+A*W+J*D+X*s,f[y+10]=I*U+A*E+J*V+X*k,f[y+11]=I*l+A*o+J*g+X*z,f[y+12]=w*L+B*x+j*i+u*R,f[y+13]=w*p+B*W+j*D+u*s,f[y+14]=w*U+B*E+j*V+u*k,f[y+15]=w*l+B*o+j*g+u*z,this}divide(O){return this.divideToRef(O,new A)}divideToRef(O,f){const y=this.Nj,S=O.m,H=f.Nj;for(let b=0;b<16;b++)H[b]=y[b]/S[b];return f.markAsUpdated(),f}divideInPlace(O){const f=this.Nj,y=O.m;for(let S=0;S<16;S++)f[S]/=y[S];return this.markAsUpdated(),this}minimizeInPlace(O){const f=this.Nj,y=O.m;for(let S=0;S<16;S++)f[S]=Math.min(f[S],y[S]);return this.markAsUpdated(),this}minimizeInPlaceFromFloats(){const O=this.Nj;for(let f=0;f<16;f++)O[f]=Math.min(O[f],f<0||arguments.length<=f?void 0:arguments[f]);return this.markAsUpdated(),this}maximizeInPlace(O){const f=this.Nj,y=O.m;for(let S=0;S<16;S++)f[S]=Math.min(f[S],y[S]);return this.markAsUpdated(),this}maximizeInPlaceFromFloats(){const O=this.Nj;for(let f=0;f<16;f++)O[f]=Math.min(O[f],f<0||arguments.length<=f?void 0:arguments[f]);return this.markAsUpdated(),this}negate(){return this.negateToRef(new A)}negateInPlace(){const O=this.Nj;for(let f=0;f<16;f++)O[f]=-O[f];return this.markAsUpdated(),this}negateToRef(O){const f=this.Nj,y=O.Nj;for(let S=0;S<16;S++)y[S]=-f[S];return O.markAsUpdated(),O}equals(O){const f=O;if(!f)return!1;if((this._isIdentity||f._isIdentity)&&!this._isIdentityDirty&&!f._isIdentityDirty)return this._isIdentity&&f._isIdentity;const y=this.m,S=f.m;return y[0]===S[0]&&y[1]===S[1]&&y[2]===S[2]&&y[3]===S[3]&&y[4]===S[4]&&y[5]===S[5]&&y[6]===S[6]&&y[7]===S[7]&&y[8]===S[8]&&y[9]===S[9]&&y[10]===S[10]&&y[11]===S[11]&&y[12]===S[12]&&y[13]===S[13]&&y[14]===S[14]&&y[15]===S[15]}equalsWithEpsilon(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const y=this.Nj,S=O.m;for(let H=0;H<16;H++)if(!(0,N.A)(y[H],S[H],f))return!1;return!0}equalsToFloats(){const O=this.Nj;for(let f=0;f<16;f++)if(O[f]!=(f<0||arguments.length<=f?void 0:arguments[f]))return!1;return!0}floor(){return this.floorToRef(new A)}floorToRef(O){const f=this.Nj,y=O.Nj;for(let S=0;S<16;S++)y[S]=Math.floor(f[S]);return O.markAsUpdated(),O}fract(){return this.fractToRef(new A)}fractToRef(O){const f=this.Nj,y=O.Nj;for(let S=0;S<16;S++)y[S]=f[S]-Math.floor(f[S]);return O.markAsUpdated(),O}clone(){const O=new A;return O.p(this),O}getClassName(){return"Matrix"}getHashCode(){let O=m(this.Nj[0]);for(let f=1;f<16;f++)O=397*O^m(this.Nj[f]);return O}decomposeToTransformNode(O){return O.rotationQuaternion=O.rotationQuaternion||new I,this.decompose(O.Yd,O.rotationQuaternion,O.position)}decompose(O,f,y,S){let H=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._isIdentity)return y&&y.Wd(0),O&&O.Wd(1),f&&f.Xd(0,0,0,1),!0;const b=this.Nj;if(y&&y.Xd(b[12],b[13],b[14]),(O=O||J.fb[0]).x=Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2]),O.y=Math.sqrt(b[4]*b[4]+b[5]*b[5]+b[6]*b[6]),O.z=Math.sqrt(b[8]*b[8]+b[9]*b[9]+b[10]*b[10]),S){const f=(H?S.absoluteScaling.x:S.Yd.x)<0?-1:1,y=(H?S.absoluteScaling.y:S.Yd.y)<0?-1:1,b=(H?S.absoluteScaling.z:S.Yd.z)<0?-1:1;O.x*=f,O.y*=y,O.z*=b}else this.determinant()<=0&&(O.y*=-1);if(0===O._x||0===O._y||0===O._z)return f&&f.Xd(0,0,0,1),!1;if(f){const y=1/O._x,S=1/O._y,H=1/O._z;A.FromValuesToRef(b[0]*y,b[1]*y,b[2]*y,0,b[4]*S,b[5]*S,b[6]*S,0,b[8]*H,b[9]*H,b[10]*H,0,0,0,0,1,J.Matrix[0]),I.FromRotationMatrixToRef(J.Matrix[0],f)}return!0}getRow(O){if(O<0||O>3)return null;const f=4*O;return new F(this.Nj[f+0],this.Nj[f+1],this.Nj[f+2],this.Nj[f+3])}getRowToRef(O,f){if(O>=0&&O<=3){const y=4*O;f.x=this.Nj[y+0],f.y=this.Nj[y+1],f.z=this.Nj[y+2],f.w=this.Nj[y+3]}return f}setRow(O,f){return this.setRowFromFloats(O,f.x,f.y,f.z,f.w)}transpose(){const O=new A;return A.TransposeToRef(this,O),O}transposeToRef(O){return A.TransposeToRef(this,O),O}setRowFromFloats(O,f,y,S,H){if(O<0||O>3)return this;const b=4*O;return this.Nj[b+0]=f,this.Nj[b+1]=y,this.Nj[b+2]=S,this.Nj[b+3]=H,this.markAsUpdated(),this}scale(O){const f=new A;return this.scaleToRef(O,f),f}scaleToRef(O,f){for(let y=0;y<16;y++)f.Nj[y]=this.Nj[y]*O;return f.markAsUpdated(),f}scaleAndAddToRef(O,f){for(let y=0;y<16;y++)f.Nj[y]+=this.Nj[y]*O;return f.markAsUpdated(),f}scaleInPlace(O){const f=this.Nj;for(let y=0;y<16;y++)f[y]*=O;return this.markAsUpdated(),this}toNormalMatrix(O){const f=J.Matrix[0];this.invertToRef(f),f.transposeToRef(O);const y=O.Nj;return A.FromValuesToRef(y[0],y[1],y[2],0,y[4],y[5],y[6],0,y[8],y[9],y[10],0,0,0,0,1,O),O}getRotationMatrix(){const O=new A;return this.getRotationMatrixToRef(O),O}getRotationMatrixToRef(O){const f=J.fb[0];if(!this.decompose(f))return A.IdentityToRef(O),O;const y=this.Nj,S=1/f._x,H=1/f._y,b=1/f._z;return A.FromValuesToRef(y[0]*S,y[1]*S,y[2]*S,0,y[4]*H,y[5]*H,y[6]*H,0,y[8]*b,y[9]*b,y[10]*b,0,0,0,0,1,O),O}toggleModelMatrixHandInPlace(){const O=this.Nj;return O[2]*=-1,O[6]*=-1,O[8]*=-1,O[9]*=-1,O[14]*=-1,this.markAsUpdated(),this}toggleProjectionMatrixHandInPlace(){const O=this.Nj;return O[8]*=-1,O[9]*=-1,O[10]*=-1,O[11]*=-1,this.markAsUpdated(),this}static Ng(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const y=new A;return A.FromArrayToRef(O,f,y),y}static FromArrayToRef(O,f,y){for(let S=0;S<16;S++)y.Nj[S]=O[S+f];return y.markAsUpdated(),y}static FromFloat32ArrayToRefScaled(O,f,y,S){return S.Nj[0]=O[0+f]*y,S.Nj[1]=O[1+f]*y,S.Nj[2]=O[2+f]*y,S.Nj[3]=O[3+f]*y,S.Nj[4]=O[4+f]*y,S.Nj[5]=O[5+f]*y,S.Nj[6]=O[6+f]*y,S.Nj[7]=O[7+f]*y,S.Nj[8]=O[8+f]*y,S.Nj[9]=O[9+f]*y,S.Nj[10]=O[10+f]*y,S.Nj[11]=O[11+f]*y,S.Nj[12]=O[12+f]*y,S.Nj[13]=O[13+f]*y,S.Nj[14]=O[14+f]*y,S.Nj[15]=O[15+f]*y,S.markAsUpdated(),S}static get IdentityReadOnly(){return A._IdentityReadOnly}static FromValuesToRef(O,f,y,S,H,b,h,v,N,m,t,q,F,I,A,J,X){const w=X.Nj;w[0]=O,w[1]=f,w[2]=y,w[3]=S,w[4]=H,w[5]=b,w[6]=h,w[7]=v,w[8]=N,w[9]=m,w[10]=t,w[11]=q,w[12]=F,w[13]=I,w[14]=A,w[15]=J,X.markAsUpdated()}static FromValues(O,f,y,S,H,b,h,v,N,m,t,q,F,I,J,X){const w=new A,B=w.Nj;return B[0]=O,B[1]=f,B[2]=y,B[3]=S,B[4]=H,B[5]=b,B[6]=h,B[7]=v,B[8]=N,B[9]=m,B[10]=t,B[11]=q,B[12]=F,B[13]=I,B[14]=J,B[15]=X,w.markAsUpdated(),w}static Compose(O,f,y){const S=new A;return A.ComposeToRef(O,f,y,S),S}static ComposeToRef(O,f,y,S){const H=S.Nj,b=f._x,h=f._y,v=f._z,N=f._w,m=b+b,t=h+h,q=v+v,F=b*m,I=b*t,A=b*q,J=h*t,X=h*q,w=v*q,B=N*m,j=N*t,u=N*q,L=O._x,p=O._y,U=O._z;return H[0]=(1-(J+w))*L,H[1]=(I+u)*L,H[2]=(A-j)*L,H[3]=0,H[4]=(I-u)*p,H[5]=(1-(F+w))*p,H[6]=(X+B)*p,H[7]=0,H[8]=(A+j)*U,H[9]=(X-B)*U,H[10]=(1-(F+J))*U,H[11]=0,H[12]=y._x,H[13]=y._y,H[14]=y._z,H[15]=1,S.markAsUpdated(),S}static Identity(){const O=A.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return O._updateIdentityStatus(!0),O}static IdentityToRef(O){return A.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,O),O._updateIdentityStatus(!0),O}static Zero(){const O=A.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return O._updateIdentityStatus(!1),O}static RotationX(O){const f=new A;return A.RotationXToRef(O,f),f}static Invert(O){const f=new A;return O.invertToRef(f),f}static RotationXToRef(O,f){const y=Math.sin(O),S=Math.cos(O);return A.FromValuesToRef(1,0,0,0,0,S,y,0,0,-y,S,0,0,0,0,1,f),f._updateIdentityStatus(1===S&&0===y),f}static RotationY(O){const f=new A;return A.RotationYToRef(O,f),f}static RotationYToRef(O,f){const y=Math.sin(O),S=Math.cos(O);return A.FromValuesToRef(S,0,-y,0,0,1,0,0,y,0,S,0,0,0,0,1,f),f._updateIdentityStatus(1===S&&0===y),f}static RotationZ(O){const f=new A;return A.RotationZToRef(O,f),f}static RotationZToRef(O,f){const y=Math.sin(O),S=Math.cos(O);return A.FromValuesToRef(S,y,0,0,-y,S,0,0,0,0,1,0,0,0,0,1,f),f._updateIdentityStatus(1===S&&0===y),f}static RotationAxis(O,f){const y=new A;return A.RotationAxisToRef(O,f,y),y}static RotationAxisToRef(O,f,y){const S=Math.sin(-f),H=Math.cos(-f),b=1-H;O=O.normalizeToRef(J.fb[0]);const h=y.Nj;return h[0]=O._x*O._x*b+H,h[1]=O._x*O._y*b-O._z*S,h[2]=O._x*O._z*b+O._y*S,h[3]=0,h[4]=O._y*O._x*b+O._z*S,h[5]=O._y*O._y*b+H,h[6]=O._y*O._z*b-O._x*S,h[7]=0,h[8]=O._z*O._x*b-O._y*S,h[9]=O._z*O._y*b+O._x*S,h[10]=O._z*O._z*b+H,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,y.markAsUpdated(),y}static RotationAlignToRef(O,f,y){let H=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const b=q.Dot(f,O),h=y.Nj;if(b<-1+S.d)h[0]=-1,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=H?1:-1,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=H?-1:1,h[11]=0;else{const y=q.Cross(f,O),S=1/(1+b);h[0]=y._x*y._x*S+b,h[1]=y._y*y._x*S-y._z,h[2]=y._z*y._x*S+y._y,h[3]=0,h[4]=y._x*y._y*S+y._z,h[5]=y._y*y._y*S+b,h[6]=y._z*y._y*S-y._x,h[7]=0,h[8]=y._x*y._z*S-y._y,h[9]=y._y*y._z*S+y._x,h[10]=y._z*y._z*S+b,h[11]=0}return h[12]=0,h[13]=0,h[14]=0,h[15]=1,y.markAsUpdated(),y}static RotationYawPitchRoll(O,f,y){const S=new A;return A.RotationYawPitchRollToRef(O,f,y,S),S}static RotationYawPitchRollToRef(O,f,y,S){return I.RotationYawPitchRollToRef(O,f,y,J.Quaternion[0]),J.Quaternion[0].toRotationMatrix(S),S}static Scaling(O,f,y){const S=new A;return A.ScalingToRef(O,f,y,S),S}static ScalingToRef(O,f,y,S){return A.FromValuesToRef(O,0,0,0,0,f,0,0,0,0,y,0,0,0,0,1,S),S._updateIdentityStatus(1===O&&1===f&&1===y),S}static Translation(O,f,y){const S=new A;return A.TranslationToRef(O,f,y,S),S}static TranslationToRef(O,f,y,S){return A.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,O,f,y,1,S),S._updateIdentityStatus(0===O&&0===f&&0===y),S}static Lerp(O,f,y){const S=new A;return A.LerpToRef(O,f,y,S),S}static LerpToRef(O,f,y,S){const H=S.Nj,b=O.m,h=f.m;for(let v=0;v<16;v++)H[v]=b[v]*(1-y)+h[v]*y;return S.markAsUpdated(),S}static DecomposeLerp(O,f,y){const S=new A;return A.DecomposeLerpToRef(O,f,y,S),S}static DecomposeLerpToRef(O,f,y,S){const H=J.fb[0],b=J.Quaternion[0],h=J.fb[1];O.decompose(H,b,h);const v=J.fb[2],N=J.Quaternion[1],m=J.fb[3];f.decompose(v,N,m);const t=J.fb[4];q.LerpToRef(H,v,y,t);const F=J.Quaternion[2];I.SlerpToRef(b,N,y,F);const X=J.fb[5];return q.LerpToRef(h,m,y,X),A.ComposeToRef(t,F,X,S),S}static LookAtLH(O,f,y){const S=new A;return A.LookAtLHToRef(O,f,y,S),S}static LookAtLHToRef(O,f,y,S){const H=J.fb[0],b=J.fb[1],h=J.fb[2];f.subtractToRef(O,h),h.normalize(),q.CrossToRef(y,h,H);const v=H.lengthSquared();0===v?H.x=1:H.normalizeFromLength(Math.sqrt(v)),q.CrossToRef(h,H,b),b.normalize();const N=-q.Dot(H,O),m=-q.Dot(b,O),t=-q.Dot(h,O);return A.FromValuesToRef(H._x,b._x,h._x,0,H._y,b._y,h._y,0,H._z,b._z,h._z,0,N,m,t,1,S),S}static LookAtRH(O,f,y){const S=new A;return A.LookAtRHToRef(O,f,y,S),S}static LookAtRHToRef(O,f,y,S){const H=J.fb[0],b=J.fb[1],h=J.fb[2];O.subtractToRef(f,h),h.normalize(),q.CrossToRef(y,h,H);const v=H.lengthSquared();0===v?H.x=1:H.normalizeFromLength(Math.sqrt(v)),q.CrossToRef(h,H,b),b.normalize();const N=-q.Dot(H,O),m=-q.Dot(b,O),t=-q.Dot(h,O);return A.FromValuesToRef(H._x,b._x,h._x,0,H._y,b._y,h._y,0,H._z,b._z,h._z,0,N,m,t,1,S),S}static LookDirectionLH(O,f){const y=new A;return A.LookDirectionLHToRef(O,f,y),y}static LookDirectionLHToRef(O,f,y){const S=J.fb[0];S.p(O),S.scaleInPlace(-1);const H=J.fb[1];return q.CrossToRef(f,S,H),A.FromValuesToRef(H._x,H._y,H._z,0,f._x,f._y,f._z,0,S._x,S._y,S._z,0,0,0,0,1,y),y}static LookDirectionRH(O,f){const y=new A;return A.LookDirectionRHToRef(O,f,y),y}static LookDirectionRHToRef(O,f,y){const S=J.fb[2];return q.CrossToRef(f,O,S),A.FromValuesToRef(S._x,S._y,S._z,0,f._x,f._y,f._z,0,O._x,O._y,O._z,0,0,0,0,1,y),y}static OrthoLH(O,f,y,S,H){const b=new A;return A.OrthoLHToRef(O,f,y,S,b,H),b}static OrthoLHToRef(O,f,y,S,H,b){const h=2/O,v=2/f,N=2/(S-y),m=-(S+y)/(S-y);return A.FromValuesToRef(h,0,0,0,0,v,0,0,0,0,N,0,0,0,m,1,H),b&&H.multiplyToRef(w,H),H._updateIdentityStatus(1===h&&1===v&&1===N&&0===m),H}static OrthoOffCenterLH(O,f,y,S,H,b,h){const v=new A;return A.OrthoOffCenterLHToRef(O,f,y,S,H,b,v,h),v}static OrthoOffCenterLHToRef(O,f,y,S,H,b,h,v){const N=2/(f-O),m=2/(S-y),t=2/(b-H),q=-(b+H)/(b-H),F=(O+f)/(O-f),I=(S+y)/(y-S);return A.FromValuesToRef(N,0,0,0,0,m,0,0,0,0,t,0,F,I,q,1,h),v&&h.multiplyToRef(w,h),h.markAsUpdated(),h}static ObliqueOffCenterLHToRef(O,f,y,S,H,b,h,v,N,m,t){const q=-h*Math.cos(v),F=-h*Math.sin(v);return A.TranslationToRef(0,0,-N,J.Matrix[1]),A.FromValuesToRef(1,0,0,0,0,1,0,0,q,F,1,0,0,0,0,1,J.Matrix[0]),J.Matrix[1].multiplyToRef(J.Matrix[0],J.Matrix[0]),A.TranslationToRef(0,0,N,J.Matrix[1]),J.Matrix[0].multiplyToRef(J.Matrix[1],J.Matrix[0]),A.OrthoOffCenterLHToRef(O,f,y,S,H,b,m,t),J.Matrix[0].multiplyToRef(m,m),m}static OrthoOffCenterRH(O,f,y,S,H,b,h){const v=new A;return A.OrthoOffCenterRHToRef(O,f,y,S,H,b,v,h),v}static OrthoOffCenterRHToRef(O,f,y,S,H,b,h,v){return A.OrthoOffCenterLHToRef(O,f,y,S,H,b,h,v),h.Nj[10]*=-1,h}static ObliqueOffCenterRHToRef(O,f,y,S,H,b,h,v,N,m,t){const q=h*Math.cos(v),F=h*Math.sin(v);return A.TranslationToRef(0,0,N,J.Matrix[1]),A.FromValuesToRef(1,0,0,0,0,1,0,0,q,F,1,0,0,0,0,1,J.Matrix[0]),J.Matrix[1].multiplyToRef(J.Matrix[0],J.Matrix[0]),A.TranslationToRef(0,0,-N,J.Matrix[1]),J.Matrix[0].multiplyToRef(J.Matrix[1],J.Matrix[0]),A.OrthoOffCenterRHToRef(O,f,y,S,H,b,m,t),J.Matrix[0].multiplyToRef(m,m),m}static PerspectiveLH(O,f,y,S,H){let b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const h=new A,v=2*y/O,N=2*y/f,m=(S+y)/(S-y),t=-2*S*y/(S-y),q=Math.tan(b);return A.FromValuesToRef(v,0,0,0,0,N,0,q,0,0,m,1,0,0,t,0,h),H&&h.multiplyToRef(w,h),h._updateIdentityStatus(!1),h}static PerspectiveFovLH(O,f,y,S,H){let b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,h=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const v=new A;return A.PerspectiveFovLHToRef(O,f,y,S,v,!0,H,b,h),v}static PerspectiveFovLHToRef(O,f,y,S,H){let b=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],h=arguments.length>6?arguments[6]:void 0,v=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,N=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const m=y,t=S,q=1/Math.tan(.5*O),F=b?q/f:q,I=b?q:q*f,J=N&&0===m?-1:0!==t?(t+m)/(t-m):1,X=N&&0===m?2*t:0!==t?-2*t*m/(t-m):-2*m,B=Math.tan(v);return A.FromValuesToRef(F,0,0,0,0,I,0,B,0,0,J,1,0,0,X,0,H),h&&H.multiplyToRef(w,H),H._updateIdentityStatus(!1),H}static PerspectiveFovReverseLHToRef(O,f,y,S,H){let b=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],h=arguments.length>6?arguments[6]:void 0,v=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const N=1/Math.tan(.5*O),m=b?N/f:N,t=b?N:N*f,q=Math.tan(v);return A.FromValuesToRef(m,0,0,0,0,t,0,q,0,0,-y,1,0,0,1,0,H),h&&H.multiplyToRef(w,H),H._updateIdentityStatus(!1),H}static PerspectiveFovRH(O,f,y,S,H){let b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,h=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const v=new A;return A.PerspectiveFovRHToRef(O,f,y,S,v,!0,H,b,h),v}static PerspectiveFovRHToRef(O,f,y,S,H){let b=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],h=arguments.length>6?arguments[6]:void 0,v=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,N=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const m=y,t=S,q=1/Math.tan(.5*O),F=b?q/f:q,I=b?q:q*f,J=N&&0===m?1:0!==t?-(t+m)/(t-m):-1,X=N&&0===m?2*t:0!==t?-2*t*m/(t-m):-2*m,B=Math.tan(v);return A.FromValuesToRef(F,0,0,0,0,I,0,B,0,0,J,-1,0,0,X,0,H),h&&H.multiplyToRef(w,H),H._updateIdentityStatus(!1),H}static PerspectiveFovReverseRHToRef(O,f,y,S,H){let b=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],h=arguments.length>6?arguments[6]:void 0,v=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const N=1/Math.tan(.5*O),m=b?N/f:N,t=b?N:N*f,q=Math.tan(v);return A.FromValuesToRef(m,0,0,0,0,t,0,q,0,0,-y,-1,0,0,-1,0,H),h&&H.multiplyToRef(w,H),H._updateIdentityStatus(!1),H}static GetFinalMatrix(O,f,y,S,H,b){const h=O.width,v=O.height,N=O.x,m=O.y,t=A.FromValues(h/2,0,0,0,0,-v/2,0,0,0,0,b-H,0,N+h/2,v/2+m,H,1),q=new A;return f.multiplyToRef(y,q),q.multiplyToRef(S,q),q.multiplyToRef(t,q)}static GetAsMatrix2x2(O){const f=O.m,y=[f[0],f[1],f[4],f[5]];return h.c.MatrixUse64Bits?y:new Float32Array(y)}static GetAsMatrix3x3(O){const f=O.m,y=[f[0],f[1],f[2],f[4],f[5],f[6],f[8],f[9],f[10]];return h.c.MatrixUse64Bits?y:new Float32Array(y)}static Transpose(O){const f=new A;return A.TransposeToRef(O,f),f}static TransposeToRef(O,f){const y=O.m,S=y[0],H=y[4],b=y[8],h=y[12],v=y[1],N=y[5],m=y[9],t=y[13],q=y[2],F=y[6],I=y[10],A=y[14],J=y[3],X=y[7],w=y[11],B=y[15],j=f.Nj;return j[0]=S,j[1]=H,j[2]=b,j[3]=h,j[4]=v,j[5]=N,j[6]=m,j[7]=t,j[8]=q,j[9]=F,j[10]=I,j[11]=A,j[12]=J,j[13]=X,j[14]=w,j[15]=B,f.markAsUpdated(),f._updateIdentityStatus(O._isIdentity,O._isIdentityDirty),f}static Reflection(O){const f=new A;return A.ReflectionToRef(O,f),f}static ReflectionToRef(O,f){O.normalize();const y=O.k.x,S=O.k.y,H=O.k.z,b=-2*y,h=-2*S,v=-2*H;return A.FromValuesToRef(b*y+1,h*y,v*y,0,b*S,h*S+1,v*S,0,b*H,h*H,v*H+1,0,b*O.d,h*O.d,v*O.d,1,f),f}static FromXYZAxesToRef(O,f,y,S){return A.FromValuesToRef(O._x,O._y,O._z,0,f._x,f._y,f._z,0,y._x,y._y,y._z,0,0,0,0,1,S),S}static FromQuaternionToRef(O,f){const y=O._x*O._x,S=O._y*O._y,H=O._z*O._z,b=O._x*O._y,h=O._z*O._w,v=O._z*O._x,N=O._y*O._w,m=O._y*O._z,t=O._x*O._w;return f.Nj[0]=1-2*(S+H),f.Nj[1]=2*(b+h),f.Nj[2]=2*(v-N),f.Nj[3]=0,f.Nj[4]=2*(b-h),f.Nj[5]=1-2*(H+y),f.Nj[6]=2*(m+t),f.Nj[7]=0,f.Nj[8]=2*(v+N),f.Nj[9]=2*(m-t),f.Nj[10]=1-2*(S+y),f.Nj[11]=0,f.Nj[12]=0,f.Nj[13]=0,f.Nj[14]=0,f.Nj[15]=1,f.markAsUpdated(),f}}A._UpdateFlagSeed=0,A._IdentityReadOnly=A.Identity(),Object.defineProperties(A.prototype,{dimension:{value:[4,4]},rank:{value:2}});class J{}J.fb=(0,H.g)(11,q.Zero),J.Matrix=(0,H.g)(2,A.Identity),J.Quaternion=(0,H.g)(3,I.Zero);class X{}X.Vector2=(0,H.g)(3,t.Zero),X.fb=(0,H.g)(13,q.Zero),X.Vector4=(0,H.g)(3,F.Zero),X.Quaternion=(0,H.g)(3,I.Zero),X.Matrix=(0,H.g)(8,A.Identity),(0,b.g)("BABYLON.Vector2",t),(0,b.g)("BABYLON.Vector3",q),(0,b.g)("BABYLON.Vector4",F),(0,b.g)("BABYLON.Matrix",A);const w=A.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)},11574:(O,f,y)=>{"use strict";y.d(f,{c:()=>S});class S{constructor(O,f,y,S){this.x=O,this.y=f,this.width=y,this.height=S}toGlobal(O,f){return new S(this.x*O,this.y*f,this.width*O,this.height*f)}toGlobalToRef(O,f,y){return y.x=this.x*O,y.y=this.y*f,y.width=this.width*O,y.height=this.height*f,this}clone(){return new S(this.x,this.y,this.width,this.height)}}},11776:(O,f,y)=>{"use strict";y.d(f,{e:()=>m,h:()=>t});var S=y(11324),H=y(11782);const b=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],h=[()=>1,O=>O.y,O=>O.z,O=>O.x,O=>O.x*O.y,O=>O.y*O.z,O=>3*O.z*O.z-1,O=>O.x*O.z,O=>O.x*O.x-O.y*O.y],v=(O,f)=>b[O]*h[O](f),N=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class m{constructor(){this.preScaled=!1,this.l00=S.m.Zero(),this.l1_1=S.m.Zero(),this.l10=S.m.Zero(),this.l11=S.m.Zero(),this.l2_2=S.m.Zero(),this.l2_1=S.m.Zero(),this.l20=S.m.Zero(),this.l21=S.m.Zero(),this.l22=S.m.Zero()}addLight(O,f,y){H.b.fb[0].set(f.r,f.g,f.b);const S=H.b.fb[0],b=H.b.fb[1];S.scaleToRef(y,b),b.scaleToRef(v(0,O),H.b.fb[2]),this.l00.addInPlace(H.b.fb[2]),b.scaleToRef(v(1,O),H.b.fb[2]),this.l1_1.addInPlace(H.b.fb[2]),b.scaleToRef(v(2,O),H.b.fb[2]),this.l10.addInPlace(H.b.fb[2]),b.scaleToRef(v(3,O),H.b.fb[2]),this.l11.addInPlace(H.b.fb[2]),b.scaleToRef(v(4,O),H.b.fb[2]),this.l2_2.addInPlace(H.b.fb[2]),b.scaleToRef(v(5,O),H.b.fb[2]),this.l2_1.addInPlace(H.b.fb[2]),b.scaleToRef(v(6,O),H.b.fb[2]),this.l20.addInPlace(H.b.fb[2]),b.scaleToRef(v(7,O),H.b.fb[2]),this.l21.addInPlace(H.b.fb[2]),b.scaleToRef(v(8,O),H.b.fb[2]),this.l22.addInPlace(H.b.fb[2])}scaleInPlace(O){this.l00.scaleInPlace(O),this.l1_1.scaleInPlace(O),this.l10.scaleInPlace(O),this.l11.scaleInPlace(O),this.l2_2.scaleInPlace(O),this.l2_1.scaleInPlace(O),this.l20.scaleInPlace(O),this.l21.scaleInPlace(O),this.l22.scaleInPlace(O)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(N[0]),this.l1_1.scaleInPlace(N[1]),this.l10.scaleInPlace(N[2]),this.l11.scaleInPlace(N[3]),this.l2_2.scaleInPlace(N[4]),this.l2_1.scaleInPlace(N[5]),this.l20.scaleInPlace(N[6]),this.l21.scaleInPlace(N[7]),this.l22.scaleInPlace(N[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(b[0]),this.l1_1.scaleInPlace(b[1]),this.l10.scaleInPlace(b[2]),this.l11.scaleInPlace(b[3]),this.l2_2.scaleInPlace(b[4]),this.l2_1.scaleInPlace(b[5]),this.l20.scaleInPlace(b[6]),this.l21.scaleInPlace(b[7]),this.l22.scaleInPlace(b[8])}updateFromArray(O){return S.m.FromArrayToRef(O[0],0,this.l00),S.m.FromArrayToRef(O[1],0,this.l1_1),S.m.FromArrayToRef(O[2],0,this.l10),S.m.FromArrayToRef(O[3],0,this.l11),S.m.FromArrayToRef(O[4],0,this.l2_2),S.m.FromArrayToRef(O[5],0,this.l2_1),S.m.FromArrayToRef(O[6],0,this.l20),S.m.FromArrayToRef(O[7],0,this.l21),S.m.FromArrayToRef(O[8],0,this.l22),this}updateFromFloatsArray(O){return S.m.FromFloatsToRef(O[0],O[1],O[2],this.l00),S.m.FromFloatsToRef(O[3],O[4],O[5],this.l1_1),S.m.FromFloatsToRef(O[6],O[7],O[8],this.l10),S.m.FromFloatsToRef(O[9],O[10],O[11],this.l11),S.m.FromFloatsToRef(O[12],O[13],O[14],this.l2_2),S.m.FromFloatsToRef(O[15],O[16],O[17],this.l2_1),S.m.FromFloatsToRef(O[18],O[19],O[20],this.l20),S.m.FromFloatsToRef(O[21],O[22],O[23],this.l21),S.m.FromFloatsToRef(O[24],O[25],O[26],this.l22),this}static Ng(O){return(new m).updateFromArray(O)}static FromPolynomial(O){const f=new m;return f.l00=O.xx.scale(.376127).add(O.yy.scale(.376127)).add(O.zz.scale(.376126)),f.l1_1=O.y.scale(.977204),f.l10=O.z.scale(.977204),f.l11=O.x.scale(.977204),f.l2_2=O.xy.scale(1.16538),f.l2_1=O.yz.scale(1.16538),f.l20=O.zz.scale(1.34567).xc(O.xx.scale(.672834)).xc(O.yy.scale(.672834)),f.l21=O.zx.scale(1.16538),f.l22=O.xx.scale(1.16538).xc(O.yy.scale(1.16538)),f.l1_1.scaleInPlace(-1),f.l11.scaleInPlace(-1),f.l2_1.scaleInPlace(-1),f.l21.scaleInPlace(-1),f.scaleInPlace(Math.PI),f}}class t{constructor(){this.x=S.m.Zero(),this.y=S.m.Zero(),this.z=S.m.Zero(),this.xx=S.m.Zero(),this.yy=S.m.Zero(),this.zz=S.m.Zero(),this.xy=S.m.Zero(),this.yz=S.m.Zero(),this.zx=S.m.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=m.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(O){H.b.fb[0].Xd(O.r,O.g,O.b);const f=H.b.fb[0];this.xx.addInPlace(f),this.yy.addInPlace(f),this.zz.addInPlace(f)}scaleInPlace(O){this.x.scaleInPlace(O),this.y.scaleInPlace(O),this.z.scaleInPlace(O),this.xx.scaleInPlace(O),this.yy.scaleInPlace(O),this.zz.scaleInPlace(O),this.yz.scaleInPlace(O),this.zx.scaleInPlace(O),this.xy.scaleInPlace(O)}updateFromHarmonics(O){return this._harmonics=O,this.x.p(O.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.p(O.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.p(O.l10),this.z.scaleInPlace(1.02333),this.xx.p(O.l00),H.b.fb[0].p(O.l20).scaleInPlace(.247708),H.b.fb[1].p(O.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).ni(H.b.fb[0]).addInPlace(H.b.fb[1]),this.yy.p(O.l00),this.yy.scaleInPlace(.886277).ni(H.b.fb[0]).ni(H.b.fb[1]),this.zz.p(O.l00),H.b.fb[0].p(O.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(H.b.fb[0]),this.yz.p(O.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.p(O.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.p(O.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(O){return(new t).updateFromHarmonics(O)}static Ng(O){const f=new t;return S.m.FromArrayToRef(O[0],0,f.x),S.m.FromArrayToRef(O[1],0,f.y),S.m.FromArrayToRef(O[2],0,f.z),S.m.FromArrayToRef(O[3],0,f.xx),S.m.FromArrayToRef(O[4],0,f.yy),S.m.FromArrayToRef(O[5],0,f.zz),S.m.FromArrayToRef(O[6],0,f.yz),S.m.FromArrayToRef(O[7],0,f.zx),S.m.FromArrayToRef(O[8],0,f.xy),f}}},11617:(O,f,y)=>{"use strict";y.d(f,{b:()=>m});var S=y(11324),H=y(11359),b=y(11557),h=y(11577),v=y(11526);y(11624);function N(O){let f=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const y=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],b=[];let N=[];const m=O.width||O.size||1,t=O.height||O.size||1,q=O.depth||O.size||1,F=O.wrap||!1;let I=void 0===O.topBaseAt?1:O.topBaseAt,A=void 0===O.bottomBaseAt?0:O.bottomBaseAt;I=(I+4)%4,A=(A+4)%4;let J=[2,0,3,1][I],X=[2,0,1,3][A],w=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(F){f=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],w=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let O=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],y=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const S=[17,18,19,16],H=[22,23,20,21];for(;J>0;)O.unshift(O.pop()),S.unshift(S.pop()),J--;for(;X>0;)y.unshift(y.pop()),H.unshift(H.pop()),X--;O=O.flat(),y=y.flat(),w=w.concat(O).concat(y),f.push(S[0],S[2],S[3],S[0],S[1],S[2]),f.push(H[0],H[2],H[3],H[0],H[1],H[2])}const B=[m/2,t/2,q/2];N=w.reduce(((O,f,y)=>O.concat(f*B[y%3])),[]);const j=0===O.sideOrientation?0:O.sideOrientation||h.c.DEFAULTSIDE,u=O.faceUV||new Array(6),L=O.faceColors,p=[];for(let h=0;h<6;h++)void 0===u[h]&&(u[h]=new S.q(0,0,1,1)),L&&void 0===L[h]&&(L[h]=new H.g(1,1,1,1));for(let S=0;S<6;S++)if(b.push(u[S].z,v.b?1-u[S].w:u[S].w),b.push(u[S].x,v.b?1-u[S].w:u[S].w),b.push(u[S].x,v.b?1-u[S].y:u[S].y),b.push(u[S].z,v.b?1-u[S].y:u[S].y),L)for(let O=0;O<4;O++)p.push(L[S].r,L[S].g,L[S].b,L[S].a);h.c._ComputeSides(j,N,f,y,b,O.frontUVs,O.backUVs);const U=new h.c;if(U.indices=f,U.xa=N,U.ya=y,U.Aa=b,L){const O=j===h.c.DOUBLESIDE?p.concat(p):p;U.za=O}return U}function m(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new b.d(O,y);f.sideOrientation=b.d._GetDefaultSideOrientation(f.sideOrientation),S._originalBuilderSideOrientation=f.sideOrientation;return N(f).Ca(S,f.updatable),S}h.c.CreateBox=N,b.d.CreateBox=function(O,f){return m(O,{size:f,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},11915:(O,f,y)=>{"use strict";y.d(f,{d:()=>v});var S=y(11557),H=y(11577),b=y(11526);function h(O){const f=[],y=[],S=[],h=[],v=O.radius||.5,N=O.tessellation||64,m=O.arc&&(O.arc<=0||O.arc>1)?1:O.arc||1,t=0===O.sideOrientation?0:O.sideOrientation||H.c.DEFAULTSIDE;f.push(0,0,0),h.push(.5,.5);const q=2*Math.PI*m,F=1===m?q/N:q/(N-1);let I=0;for(let H=0;H<N;H++){const O=Math.cos(I),y=Math.sin(I),S=(O+1)/2,H=(1-y)/2;f.push(v*O,v*y,0),h.push(S,b.b?1-H:H),I+=F}1===m&&(f.push(f[3],f[4],f[5]),h.push(h[2],b.b?1-h[3]:h[3]));const A=f.length/3;for(let H=1;H<A-1;H++)y.push(H+1,0,H);H.c.ComputeNormals(f,y,S),H.c._ComputeSides(t,f,y,S,h,O.frontUVs,O.backUVs);const J=new H.c;return J.indices=y,J.xa=f,J.ya=S,J.Aa=h,J}function v(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=new S.d(O,y);f.sideOrientation=S.d._GetDefaultSideOrientation(f.sideOrientation),H._originalBuilderSideOrientation=f.sideOrientation;return h(f).Ca(H,f.updatable),H}H.c.CreateDisc=h,S.d.CreateDisc=function(O,f,y){return v(O,{radius:f,tessellation:y,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},11624:(O,f,y)=>{"use strict";y.d(f,{g:()=>X,c:()=>B,k:()=>w});var S=y(11324),H=y(11359),b=y(11557),h=y(11577),v=y(11392);b.d._GroundMeshParser=(O,f)=>N.Parse(O,f);class N extends b.d{constructor(O,f){super(O,f),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=O,this._subdivisionsY=O,this.subdivide(O);const y=this;y.createOrUpdateSubmeshesOctree&&y.createOrUpdateSubmeshesOctree(f)}getHeightAtCoordinates(O,f){const y=this.getWorldMatrix(),H=S.g.Matrix[5];y.invertToRef(H);const b=S.g.fb[8];if(S.m.TransformCoordinatesFromFloatsToRef(O,0,f,H,b),O=b.x,f=b.z,O<this._minX||O>=this._maxX||f<=this._minZ||f>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const h=this._getFacetAt(O,f),v=-(h.x*O+h.z*f+h.w)/h.y;return S.m.TransformCoordinatesFromFloatsToRef(0,v,0,y,b),b.y}getNormalAtCoordinates(O,f){const y=new S.m(0,1,0);return this.getNormalAtCoordinatesToRef(O,f,y),y}getNormalAtCoordinatesToRef(O,f,y){const H=this.getWorldMatrix(),b=S.g.Matrix[5];H.invertToRef(b);const h=S.g.fb[8];if(S.m.TransformCoordinatesFromFloatsToRef(O,0,f,b,h),O=h.x,f=h.z,O<this._minX||O>this._maxX||f<this._minZ||f>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const v=this._getFacetAt(O,f);return S.m.TransformNormalFromFloatsToRef(v.x,v.y,v.z,H,y),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(O,f){const y=Math.floor((O+this._maxX)*this._subdivisionsX/this._width),S=Math.floor(-(f+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),H=this._heightQuads[S*this._subdivisionsX+y];let b;return b=f<H.slope.x*O+H.slope.y?H.facet1:H.facet2,b}_initHeightQuads(){const O=this._subdivisionsX,f=this._subdivisionsY;this._heightQuads=new Array;for(let y=0;y<f;y++)for(let f=0;f<O;f++){const H={slope:S.i.Zero(),facet1:new S.q(0,0,0,0),facet2:new S.q(0,0,0,0)};this._heightQuads[y*O+f]=H}return this}_computeHeightQuads(){const O=this.getVerticesData(v.f.PositionKind);if(!O)return this;const f=S.g.fb[3],y=S.g.fb[2],H=S.g.fb[1],b=S.g.fb[0],h=S.g.fb[4],N=S.g.fb[5],m=S.g.fb[6],t=S.g.fb[7],q=S.g.fb[8];let F=0,I=0,A=0,J=0,X=0,w=0,B=0;const j=this._subdivisionsX,u=this._subdivisionsY;for(let v=0;v<u;v++)for(let u=0;u<j;u++){F=3*u,I=v*(j+1)*3,A=(v+1)*(j+1)*3,f.x=O[I+F],f.y=O[I+F+1],f.z=O[I+F+2],y.x=O[I+F+3],y.y=O[I+F+4],y.z=O[I+F+5],H.x=O[A+F],H.y=O[A+F+1],H.z=O[A+F+2],b.x=O[A+F+3],b.y=O[A+F+4],b.z=O[A+F+5],J=(b.z-f.z)/(b.x-f.x),X=f.z-J*f.x,y.subtractToRef(f,h),H.subtractToRef(f,N),b.subtractToRef(f,m),S.m.CrossToRef(m,N,t),S.m.CrossToRef(h,m,q),t.normalize(),q.normalize(),w=-(t.x*f.x+t.y*f.y+t.z*f.z),B=-(q.x*y.x+q.y*y.y+q.z*y.z);const L=this._heightQuads[v*j+u];L.slope.Xd(J,X),L.facet1.Xd(t.x,t.y,t.z,w),L.facet2.Xd(q.x,q.y,q.z,B)}return this}serialize(O){super.serialize(O),O.subdivisionsX=this._subdivisionsX,O.subdivisionsY=this._subdivisionsY,O.minX=this._minX,O.maxX=this._maxX,O.Ui=this._minZ,O.maxZ=this._maxZ,O.width=this._width,O.height=this._height}static Parse(O,f){const y=new N(O.name,f);return y._subdivisionsX=O.subdivisionsX||1,y._subdivisionsY=O.subdivisionsY||1,y._minX=O.minX,y._maxX=O.maxX,y._minZ=O.Ui,y._maxZ=O.maxZ,y._width=O.width,y._height=O.height,y}}var m=y(10995),t=y(11042),q=y(11330),F=y(11526);function I(O){const f=[],y=[],H=[],b=[];let v,N;const m=O.width||O.size||1,t=O.height||O.size||1,q=0|(O.subdivisionsX||O.subdivisions||1),I=0|(O.subdivisionsY||O.subdivisions||1);for(v=0;v<=I;v++)for(N=0;N<=q;N++){const O=new S.m(N*m/q-m/2,0,(I-v)*t/I-t/2),f=new S.m(0,1,0);y.push(O.x,O.y,O.z),H.push(f.x,f.y,f.z),b.push(N/q,F.b?v/I:1-v/I)}for(v=0;v<I;v++)for(N=0;N<q;N++)f.push(N+1+(v+1)*(q+1)),f.push(N+1+v*(q+1)),f.push(N+v*(q+1)),f.push(N+(v+1)*(q+1)),f.push(N+1+(v+1)*(q+1)),f.push(N+v*(q+1));const A=new h.c;return A.indices=f,A.xa=y,A.ya=H,A.Aa=b,A}function A(O){const f=void 0!==O.xmin&&null!==O.xmin?O.xmin:-1,y=void 0!==O.zmin&&null!==O.zmin?O.zmin:-1,H=void 0!==O.xmax&&null!==O.xmax?O.xmax:1,b=void 0!==O.zmax&&null!==O.zmax?O.zmax:1,v=O.subdivisions||{w:1,h:1},N=O.precision||{w:1,h:1},m=[],t=[],q=[],F=[];let I,A,J,X;v.h=v.h<1?1:v.h,v.w=v.w<1?1:v.w,N.w=N.w<1?1:N.w,N.h=N.h<1?1:N.h;const w=(H-f)/v.w,B=(b-y)/v.h;function j(O,f,y,H){const b=t.length/3,h=N.w+1;for(I=0;I<N.h;I++)for(A=0;A<N.w;A++){const O=[b+A+I*h,b+(A+1)+I*h,b+(A+1)+(I+1)*h,b+A+(I+1)*h];m.push(O[1]),m.push(O[2]),m.push(O[3]),m.push(O[0]),m.push(O[1]),m.push(O[3])}const v=S.m.Zero(),J=new S.m(0,1,0);for(I=0;I<=N.h;I++)for(v.z=I*(H-f)/N.h+f,A=0;A<=N.w;A++)v.x=A*(y-O)/N.w+O,v.y=0,t.push(v.x,v.y,v.z),q.push(J.x,J.y,J.z),F.push(A/N.w,I/N.h)}for(J=0;J<v.h;J++)for(X=0;X<v.w;X++)j(f+X*w,y+J*B,f+(X+1)*w,y+(J+1)*B);const u=new h.c;return u.indices=m,u.xa=t,u.ya=q,u.Aa=F,u}function J(O){const f=[],y=[],b=[],v=[];let N,m;const t=O.colorFilter||new H.d(.3,.59,.11),F=O.alphaFilter||0;let I=!1;if(O.minHeight>O.maxHeight){I=!0;const f=O.maxHeight;O.maxHeight=O.minHeight,O.minHeight=f}for(N=0;N<=O.subdivisions;N++)for(m=0;m<=O.subdivisions;m++){const f=new S.m(m*O.width/O.subdivisions-O.width/2,0,(O.subdivisions-N)*O.height/O.subdivisions-O.height/2),H=4*(((f.x+O.width/2)/O.width*(O.bufferWidth-1)|0)+((1-(f.z+O.height/2)/O.height)*(O.bufferHeight-1)|0)*O.bufferWidth);let h=O.buffer[H]/255,A=O.buffer[H+1]/255,J=O.buffer[H+2]/255;const X=O.buffer[H+3]/255;I&&(h=1-h,A=1-A,J=1-J);const w=h*t.r+A*t.g+J*t.b;f.y=X>=F?O.minHeight+(O.maxHeight-O.minHeight)*w:O.minHeight-q.d,O.heightBuffer&&(O.heightBuffer[N*(O.subdivisions+1)+m]=f.y),y.push(f.x,f.y,f.z),b.push(0,0,0),v.push(m/O.subdivisions,1-N/O.subdivisions)}for(N=0;N<O.subdivisions;N++)for(m=0;m<O.subdivisions;m++){const S=m+1+(N+1)*(O.subdivisions+1),H=m+1+N*(O.subdivisions+1),b=m+N*(O.subdivisions+1),h=m+(N+1)*(O.subdivisions+1),v=y[3*S+1]>=O.minHeight,t=y[3*H+1]>=O.minHeight,q=y[3*b+1]>=O.minHeight;v&&t&&q&&(f.push(S),f.push(H),f.push(b));y[3*h+1]>=O.minHeight&&v&&q&&(f.push(h),f.push(S),f.push(b))}h.c.ComputeNormals(y,f,b);const A=new h.c;return A.indices=f,A.xa=y,A.ya=b,A.Aa=v,A}function X(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const y=new N(O,arguments.length>2?arguments[2]:void 0);y._setReady(!1),y._subdivisionsX=f.subdivisionsX||f.subdivisions||1,y._subdivisionsY=f.subdivisionsY||f.subdivisions||1,y._width=f.width||1,y._height=f.height||1,y._maxX=y._width/2,y._maxZ=y._height/2,y._minX=-y._maxX,y._minZ=-y._maxZ;return I(f).Ca(y,f.updatable),y._setReady(!0),y}function w(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new b.d(O,y);return A(f).Ca(S,f.updatable),S}function B(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const b=y.width||10,h=y.height||10,v=y.subdivisions||1,q=y.minHeight||0,F=y.maxHeight||1,I=y.colorFilter||new H.d(.3,.59,.11),A=y.alphaFilter||0,X=y.updatable,w=y.onReady;S=S||t.c.LastCreatedScene;const B=new N(O,S);let j;B._subdivisionsX=v,B._subdivisionsY=v,B._width=b,B._height=h,B._maxX=B._width/2,B._maxZ=B._height/2,B._minX=-B._maxX,B._minZ=-B._maxZ,B._setReady(!1),y.passHeightBufferInCallback&&(j=new Float32Array((v+1)*(v+1)));const u=(O,f,y)=>{J({width:b,height:h,subdivisions:v,minHeight:q,maxHeight:F,colorFilter:I,buffer:O,bufferWidth:f,bufferHeight:y,alphaFilter:A,heightBuffer:j}).Ca(B,X),w&&w(B,j),B._setReady(!0)};if("string"===typeof f){const O=O=>{var f;const y=O.width,H=O.height;if(S.u)return;const b=null===(f=S)||void 0===f?void 0:f.getEngine().resizeImageBitmap(O,y,H);u(b,y,H)};m.d.LoadImage(f,O,y.onError?y.onError:()=>{},S.offlineProvider)}else u(f.data,f.width,f.height);return B}h.c.CreateGround=I,h.c.CreateTiledGround=A,h.c.CreateGroundFromHeightMap=J,b.d.CreateGround=(O,f,y,S,H,b)=>X(O,{width:f,height:y,subdivisions:S,updatable:b},H),b.d.CreateTiledGround=(O,f,y,S,H,b,h,v,N)=>w(O,{xmin:f,zmin:y,xmax:S,zmax:H,subdivisions:b,precision:h,updatable:N},v),b.d.CreateGroundFromHeightMap=(O,f,y,S,H,b,h,v,N,m,t)=>B(O,f,{width:y,height:S,subdivisions:H,minHeight:b,maxHeight:h,updatable:N,onReady:m,alphaFilter:t},v)},12648:(O,f,y)=>{"use strict";y.d(f,{d:()=>i,g:()=>E,j:()=>o});var S=y(11324),H=y(11557),b=y(11577),h=y(11359),v=y(11392),N=y(12247),m=y(11455),t=y(11362),q=y(11311),F=y(11509),I=y(11153),A=y(11536),J=y(11037),X=y(11506),w=y(11042),B=y(11494),j=y(11490);const u={effect:null,subMesh:null};class L extends X.e{constructor(O,f,y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(O,f,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new S.b,this._cachedWorldViewProjectionMatrix=new S.b,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=y,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","k","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...H}}get shaderPath(){return this._shaderPath}set shaderPath(O){this._shaderPath=O}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(O){-1===this._options.uniforms.indexOf(O)&&this._options.uniforms.push(O)}setTexture(O,f){return-1===this._options.samplers.indexOf(O)&&this._options.samplers.push(O),this._textures[O]=f,this}removeTexture(O){delete this._textures[O]}setTextureArray(O,f){return-1===this._options.samplers.indexOf(O)&&this._options.samplers.push(O),this._checkUniform(O),this._textureArrays[O]=f,this}setExternalTexture(O,f){return-1===this._options.externalTextures.indexOf(O)&&this._options.externalTextures.push(O),this._externalTextures[O]=f,this}setFloat(O,f){return this._checkUniform(O),this._floats[O]=f,this}setInt(O,f){return this._checkUniform(O),this._ints[O]=f,this}setUInt(O,f){return this._checkUniform(O),this._uints[O]=f,this}setFloats(O,f){return this._checkUniform(O),this._floatsArrays[O]=f,this}setColor3(O,f){return this._checkUniform(O),this._colors3[O]=f,this}setColor3Array(O,f){return this._checkUniform(O),this._colors3Arrays[O]=f.reduce(((O,f)=>(f.toArray(O,O.length),O)),[]),this}setColor4(O,f){return this._checkUniform(O),this._colors4[O]=f,this}setColor4Array(O,f){return this._checkUniform(O),this._colors4Arrays[O]=f.reduce(((O,f)=>(f.toArray(O,O.length),O)),[]),this}setVector2(O,f){return this._checkUniform(O),this._vectors2[O]=f,this}setVector3(O,f){return this._checkUniform(O),this._vectors3[O]=f,this}setVector4(O,f){return this._checkUniform(O),this._vectors4[O]=f,this}setQuaternion(O,f){return this._checkUniform(O),this._quaternions[O]=f,this}setQuaternionArray(O,f){return this._checkUniform(O),this._quaternionsArrays[O]=f.reduce(((O,f)=>(f.toArray(O,O.length),O)),[]),this}setMatrix(O,f){return this._checkUniform(O),this._matrices[O]=f,this}setMatrices(O,f){this._checkUniform(O);const y=new Float32Array(16*f.length);for(let S=0;S<f.length;S++){f[S].copyToArray(y,16*S)}return this._matrixArrays[O]=y,this}setMatrix3x3(O,f){return this._checkUniform(O),this._matrices3x3[O]=f,this}setMatrix2x2(O,f){return this._checkUniform(O),this._matrices2x2[O]=f,this}setArray2(O,f){return this._checkUniform(O),this._vectors2Arrays[O]=f,this}setArray3(O,f){return this._checkUniform(O),this._vectors3Arrays[O]=f,this}setArray4(O,f){return this._checkUniform(O),this._vectors4Arrays[O]=f,this}setUniformBuffer(O,f){return-1===this._options.uniformBuffers.indexOf(O)&&this._options.uniformBuffers.push(O),this._uniformBuffers[O]=f,this}setTextureSampler(O,f){return-1===this._options.samplerObjects.indexOf(O)&&this._options.samplerObjects.push(O),this._textureSamplers[O]=f,this}setStorageBuffer(O,f){return-1===this._options.storageBuffers.indexOf(O)&&this._options.storageBuffers.push(O),this._storageBuffers[O]=f,this}setDefine(O,f){const y=O.trimEnd()+" ",S=this.options.defines.findIndex((f=>f===O||f.startsWith(y)));return S>=0&&this.options.defines.splice(S,1),("boolean"!==typeof f||f)&&this.options.defines.push(y+f),this}isReadyForSubMesh(O,f,y){return this.isReady(O,y,f)}isReady(O,f,y){var S;const H=y&&this._storeEffectOnSubMeshes;if(this.isFrozen){const O=H?y._drawWrapper:this._drawWrapper;if(O.effect&&O._wasPreviouslyReady&&O._wasPreviouslyUsingInstances===f)return!0}const b=this.va(),h=b.getEngine(),N=[],m=[],t=new A.c;let F=this._shaderPath,I=this._options.uniforms,J=this._options.uniformBuffers,X=this._options.samplers;h.getCaps().multiview&&b.activeCamera&&b.activeCamera.outputRenderTarget&&b.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,N.push("#define MULTIVIEW"),-1!==I.indexOf("viewProjection")&&-1===I.indexOf("viewProjectionR")&&I.push("viewProjectionR"));for(let v=0;v<this._options.defines.length;v++){const O=0===this._options.defines[v].indexOf("#define")?this._options.defines[v]:`#define ${this._options.defines[v]}`;N.push(O)}for(let v=0;v<this._options.attributes.length;v++)m.push(this._options.attributes[v]);if(O&&O.isVerticesDataPresent(v.f.ColorKind)&&(-1===m.indexOf(v.f.ColorKind)&&m.push(v.f.ColorKind),N.push("#define VERTEXCOLOR")),f&&(N.push("#define INSTANCES"),(0,j.$)(m,this._materialHelperNeedsPreviousMatrices),null!==O&&void 0!==O&&O.hasThinInstances&&(N.push("#define THIN_INSTANCES"),O&&O.isVerticesDataPresent(v.f.ColorInstanceKind)&&(m.push(v.f.ColorInstanceKind),N.push("#define INSTANCESCOLOR")))),O&&O.useBones&&O.computeBonesUsingShaders&&O.skeleton){m.push(v.f.MatricesIndicesKind),m.push(v.f.MatricesWeightsKind),O.numBoneInfluencers>4&&(m.push(v.f.MatricesIndicesExtraKind),m.push(v.f.MatricesWeightsExtraKind));const f=O.skeleton;N.push("#define NUM_BONE_INFLUENCERS "+O.numBoneInfluencers),t.addCPUSkinningFallback(0,O),f.isUsingTextureForMatrices?(N.push("#define BONETEXTURE"),-1===I.indexOf("boneTextureWidth")&&I.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(N.push("#define BonesPerMesh "+(f.bones.length+1)),-1===I.indexOf("mBones")&&I.push("mBones"))}else N.push("#define NUM_BONE_INFLUENCERS 0");let w=0;const L=O?O.morphTargetManager:null;if(L){const O=L.supportsUVs&&-1!==N.indexOf("#define UV1"),f=L.supportsTangents&&-1!==N.indexOf("#define TANGENT"),y=L.supportsNormals&&-1!==N.indexOf("#define NORMAL");w=L.numMaxInfluencers||L.numInfluencers,O&&N.push("#define MORPHTARGETS_UV"),f&&N.push("#define MORPHTARGETS_TANGENT"),y&&N.push("#define MORPHTARGETS_NORMAL"),w>0&&N.push("#define MORPHTARGETS"),L.isUsingTextureForTargets&&(N.push("#define MORPHTARGETS_TEXTURE"),-1===I.indexOf("morphTargetTextureIndices")&&I.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),N.push("#define NUM_MORPH_INFLUENCERS "+w);for(let S=0;S<w;S++)m.push(v.f.PositionKind+S),y&&m.push(v.f.NormalKind+S),f&&m.push(v.f.TangentKind+S),O&&m.push(v.f.UVKind+"_"+S);w>0&&(I=I.slice(),I.push("morphTargetInfluences"),I.push("morphTargetCount"),I.push("morphTargetTextureInfo"),I.push("morphTargetTextureIndices"))}else N.push("#define NUM_MORPH_INFLUENCERS 0");if(O){const f=O.bakedVertexAnimationManager;f&&f.isEnabled&&(N.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===I.indexOf("bakedVertexAnimationSettings")&&I.push("bakedVertexAnimationSettings"),-1===I.indexOf("bakedVertexAnimationTextureSizeInverted")&&I.push("bakedVertexAnimationTextureSizeInverted"),-1===I.indexOf("bakedVertexAnimationTime")&&I.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,j.u)(m,O,N)}for(const v in this._textures)if(!this._textures[v].isReady())return!1;O&&this._shouldTurnAlphaTestOn(O)&&N.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,B.b)(I),(0,B.l)(this,b,N)),b.fogEnabled&&null!==O&&void 0!==O&&O.applyFog&&b.fogMode!==q.c.FOGMODE_NONE&&(N.push("#define FOG"),-1===I.indexOf("view")&&I.push("view"),-1===I.indexOf("vFogInfos")&&I.push("vFogInfos"),-1===I.indexOf("vFogColor")&&I.push("vFogColor")),this._useLogarithmicDepth&&(N.push("#define LOGARITHMICDEPTH"),-1===I.indexOf("logarithmicDepthConstant")&&I.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(I=I.slice(),J=J.slice(),X=X.slice(),F=this.customShaderNameResolve(this.name,I,J,X,N,m));const p=H?y._getDrawWrapper(void 0,!0):this._drawWrapper,U=(null===p||void 0===p?void 0:p.effect)??null,l=(null===p||void 0===p?void 0:p.defines)??null,x=N.join("\n");let W=U;return l!==x&&(W=h.createEffect(F,{attributes:m,uniformsNames:I,uniformBuffersNames:J,samplers:X,defines:x,fallbacks:t,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:w},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},h),H?y.setEffect(W,x,this._materialContext):p&&p.setEffect(W,x),this._onEffectCreatedObservable&&(u.effect=W,u.subMesh=y??(null===O||void 0===O?void 0:O.Yf[0])??null,this._onEffectCreatedObservable.notifyObservers(u))),p._wasPreviouslyUsingInstances=!!f,!((null===(S=W)||void 0===S||!S.isReady())??1)&&(U!==W&&b.resetCachedMaterial(),p._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(O,f){const y=this.va(),S=f??this.getEffect();S&&(-1!==this._options.uniforms.indexOf("world")&&S.setMatrix("world",O),-1!==this._options.uniforms.indexOf("worldView")&&(O.multiplyToRef(y.getViewMatrix(),this._cachedWorldViewMatrix),S.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(O.multiplyToRef(y.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),S.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==this._options.uniforms.indexOf("view")&&S.setMatrix("view",y.getViewMatrix()))}bindForSubMesh(O,f,y){var S;this.bind(O,f,null===(S=y._drawWrapperOverride)||void 0===S?void 0:S.effect,y)}bind(O,f,y,S){const H=S&&this._storeEffectOnSubMeshes,b=y??(H?S.effect:this.getEffect());if(!b)return;const h=this.va();this._activeEffect=b,this.bindOnlyWorldMatrix(O,y);const v=this._options.uniformBuffers;let N=!1;if(b&&v&&v.length>0&&h.getEngine().supportsUniformBuffers)for(let q=0;q<v.length;++q){switch(v[q]){case"Mesh":f&&(f.getMeshUniformBuffer().bindToEffect(b,"Mesh"),f.transferToEffect(O));break;case"Scene":(0,j.n)(b,h.getSceneUniformBuffer()),h.finalizeSceneUbo(),N=!0}}const m=f&&H?this._mustRebind(h,b,S,f.visibility):h.getCachedMaterial()!==this;if(b&&m){let O;for(O in N||-1===this._options.uniforms.indexOf("view")||b.setMatrix("view",h.getViewMatrix()),N||-1===this._options.uniforms.indexOf("projection")||b.setMatrix("projection",h.getProjectionMatrix()),N||-1===this._options.uniforms.indexOf("viewProjection")||(b.setMatrix("viewProjection",h.getTransformMatrix()),this._multiview&&b.setMatrix("viewProjectionR",h._transformMatrixR)),h.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&b.setVector3("cameraPosition",h.activeCamera.globalPosition),(0,j.c)(f,b),(0,B.f)(b,this,h),this._useLogarithmicDepth&&(0,j.j)(H?S.materialDefines:b.defines,b,h),f&&(0,j.e)(h,f,b),this._textures)b.setTexture(O,this._textures[O]);for(O in this._textureArrays)b.setTextureArray(O,this._textureArrays[O]);for(O in this._ints)b.setInt(O,this._ints[O]);for(O in this._uints)b.setUInt(O,this._uints[O]);for(O in this._floats)b.setFloat(O,this._floats[O]);for(O in this._floatsArrays)b.setArray(O,this._floatsArrays[O]);for(O in this._colors3)b.setColor3(O,this._colors3[O]);for(O in this._colors3Arrays)b.setArray3(O,this._colors3Arrays[O]);for(O in this._colors4){const f=this._colors4[O];b.setFloat4(O,f.r,f.g,f.b,f.a)}for(O in this._colors4Arrays)b.setArray4(O,this._colors4Arrays[O]);for(O in this._vectors2)b.setVector2(O,this._vectors2[O]);for(O in this._vectors3)b.setVector3(O,this._vectors3[O]);for(O in this._vectors4)b.setVector4(O,this._vectors4[O]);for(O in this._quaternions)b.setQuaternion(O,this._quaternions[O]);for(O in this._matrices)b.setMatrix(O,this._matrices[O]);for(O in this._matrixArrays)b.setMatrices(O,this._matrixArrays[O]);for(O in this._matrices3x3)b.setMatrix3x3(O,this._matrices3x3[O]);for(O in this._matrices2x2)b.setMatrix2x2(O,this._matrices2x2[O]);for(O in this._vectors2Arrays)b.setArray2(O,this._vectors2Arrays[O]);for(O in this._vectors3Arrays)b.setArray3(O,this._vectors3Arrays[O]);for(O in this._vectors4Arrays)b.setArray4(O,this._vectors4Arrays[O]);for(O in this._quaternionsArrays)b.setArray4(O,this._quaternionsArrays[O]);for(O in this._uniformBuffers){const f=this._uniformBuffers[O].getBuffer();f&&b.bindUniformBuffer(f,O)}const y=h.getEngine(),v=y.setExternalTexture;if(v)for(O in this._externalTextures)v.call(y,O,this._externalTextures[O]);const m=y.setTextureSampler;if(m)for(O in this._textureSamplers)m.call(y,O,this._textureSamplers[O]);const t=y.setStorageBuffer;if(t)for(O in this._storageBuffers)t.call(y,O,this._storageBuffers[O])}if(b&&f&&(m||!this.isFrozen)){const O=f.morphTargetManager;O&&O.numInfluencers>0&&(0,j.l)(f,b);const y=f.bakedVertexAnimationManager;if(y&&y.isEnabled){var t;const O=H?S._drawWrapper:this._drawWrapper;null===(t=f.bakedVertexAnimationManager)||void 0===t||t.bind(b,!!O._wasPreviouslyUsingInstances)}}this._afterBind(f,b,S)}getActiveTextures(){const O=super.getActiveTextures();for(const f in this._textures)O.push(this._textures[f]);for(const f in this._textureArrays){const y=this._textureArrays[f];for(let f=0;f<y.length;f++)O.push(y[f])}return O}hasTexture(O){if(super.hasTexture(O))return!0;for(const f in this._textures)if(this._textures[f]===O)return!0;for(const f in this._textureArrays){const y=this._textureArrays[f];for(let f=0;f<y.length;f++)if(y[f]===O)return!0}return!1}clone(O){const f=t.b.Clone((()=>new L(O,this.va(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);f.name=O,f.id=O,"object"===typeof f._shaderPath&&(f._shaderPath={...f._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach((O=>{const f=this._options[O];Array.isArray(f)&&(this._options[O]=f.slice(0))})),this.stencil.copyTo(f.stencil);for(const y in this._textures)f.setTexture(y,this._textures[y]);for(const y in this._textureArrays)f.setTextureArray(y,this._textureArrays[y]);for(const y in this._externalTextures)f.setExternalTexture(y,this._externalTextures[y]);for(const y in this._ints)f.setInt(y,this._ints[y]);for(const y in this._uints)f.setUInt(y,this._uints[y]);for(const y in this._floats)f.setFloat(y,this._floats[y]);for(const y in this._floatsArrays)f.setFloats(y,this._floatsArrays[y]);for(const y in this._colors3)f.setColor3(y,this._colors3[y]);for(const y in this._colors3Arrays)f._colors3Arrays[y]=this._colors3Arrays[y];for(const y in this._colors4)f.setColor4(y,this._colors4[y]);for(const y in this._colors4Arrays)f._colors4Arrays[y]=this._colors4Arrays[y];for(const y in this._vectors2)f.setVector2(y,this._vectors2[y]);for(const y in this._vectors3)f.setVector3(y,this._vectors3[y]);for(const y in this._vectors4)f.setVector4(y,this._vectors4[y]);for(const y in this._quaternions)f.setQuaternion(y,this._quaternions[y]);for(const y in this._quaternionsArrays)f._quaternionsArrays[y]=this._quaternionsArrays[y];for(const y in this._matrices)f.setMatrix(y,this._matrices[y]);for(const y in this._matrixArrays)f._matrixArrays[y]=this._matrixArrays[y].slice();for(const y in this._matrices3x3)f.setMatrix3x3(y,this._matrices3x3[y]);for(const y in this._matrices2x2)f.setMatrix2x2(y,this._matrices2x2[y]);for(const y in this._vectors2Arrays)f.setArray2(y,this._vectors2Arrays[y]);for(const y in this._vectors3Arrays)f.setArray3(y,this._vectors3Arrays[y]);for(const y in this._vectors4Arrays)f.setArray4(y,this._vectors4Arrays[y]);for(const y in this._uniformBuffers)f.setUniformBuffer(y,this._uniformBuffers[y]);for(const y in this._textureSamplers)f.setTextureSampler(y,this._textureSamplers[y]);for(const y in this._storageBuffers)f.setStorageBuffer(y,this._storageBuffers[y]);return f}dispose(O,f,y){if(f){let O;for(O in this._textures)this._textures[O].dispose();for(O in this._textureArrays){const f=this._textureArrays[O];for(let O=0;O<f.length;O++)f[O].dispose()}}this._textures={},super.dispose(O,f,y)}serialize(){const O=t.b.Serialize(this);let f;for(f in O.customType="BABYLON.ShaderMaterial",O.uniqueId=this.uniqueId,O.options=this._options,O.shaderPath=this._shaderPath,O.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,O.stencil=this.stencil.serialize(),O.textures={},this._textures)O.textures[f]=this._textures[f].serialize();for(f in O.textureArrays={},this._textureArrays){O.textureArrays[f]=[];const y=this._textureArrays[f];for(let S=0;S<y.length;S++)O.textureArrays[f].push(y[S].serialize())}for(f in O.ints={},this._ints)O.ints[f]=this._ints[f];for(f in O.uints={},this._uints)O.uints[f]=this._uints[f];for(f in O.floats={},this._floats)O.floats[f]=this._floats[f];for(f in O.floatsArrays={},this._floatsArrays)O.floatsArrays[f]=this._floatsArrays[f];for(f in O.colors3={},this._colors3)O.colors3[f]=this._colors3[f].gj();for(f in O.colors3Arrays={},this._colors3Arrays)O.colors3Arrays[f]=this._colors3Arrays[f];for(f in O.colors4={},this._colors4)O.colors4[f]=this._colors4[f].gj();for(f in O.colors4Arrays={},this._colors4Arrays)O.colors4Arrays[f]=this._colors4Arrays[f];for(f in O.vectors2={},this._vectors2)O.vectors2[f]=this._vectors2[f].gj();for(f in O.vectors3={},this._vectors3)O.vectors3[f]=this._vectors3[f].gj();for(f in O.vectors4={},this._vectors4)O.vectors4[f]=this._vectors4[f].gj();for(f in O.quaternions={},this._quaternions)O.quaternions[f]=this._quaternions[f].gj();for(f in O.matrices={},this._matrices)O.matrices[f]=this._matrices[f].gj();for(f in O.matrixArray={},this._matrixArrays)O.matrixArray[f]=this._matrixArrays[f];for(f in O.matrices3x3={},this._matrices3x3)O.matrices3x3[f]=this._matrices3x3[f];for(f in O.matrices2x2={},this._matrices2x2)O.matrices2x2[f]=this._matrices2x2[f];for(f in O.vectors2Arrays={},this._vectors2Arrays)O.vectors2Arrays[f]=this._vectors2Arrays[f];for(f in O.vectors3Arrays={},this._vectors3Arrays)O.vectors3Arrays[f]=this._vectors3Arrays[f];for(f in O.vectors4Arrays={},this._vectors4Arrays)O.vectors4Arrays[f]=this._vectors4Arrays[f];for(f in O.quaternionsArrays={},this._quaternionsArrays)O.quaternionsArrays[f]=this._quaternionsArrays[f];return O}static Parse(O,f,y){const H=t.b.Parse((()=>new L(O.name,f,O.shaderPath,O.options,O.storeEffectOnSubMeshes)),O,f,y);let b;for(b in O.stencil&&H.stencil.parse(O.stencil,f,y),O.textures)H.setTexture(b,F.e.Parse(O.textures[b],f,y));for(b in O.textureArrays){const S=O.textureArrays[b],h=[];for(let O=0;O<S.length;O++)h.push(F.e.Parse(S[O],f,y));H.setTextureArray(b,h)}for(b in O.ints)H.setInt(b,O.ints[b]);for(b in O.uints)H.setUInt(b,O.uints[b]);for(b in O.floats)H.setFloat(b,O.floats[b]);for(b in O.floatsArrays)H.setFloats(b,O.floatsArrays[b]);for(b in O.colors3)H.setColor3(b,h.d.Ng(O.colors3[b]));for(b in O.colors3Arrays){const f=O.colors3Arrays[b].reduce(((O,f,y)=>(y%3===0?O.push([f]):O[O.length-1].push(f),O)),[]).map((O=>h.d.Ng(O)));H.setColor3Array(b,f)}for(b in O.colors4)H.setColor4(b,h.g.Ng(O.colors4[b]));for(b in O.colors4Arrays){const f=O.colors4Arrays[b].reduce(((O,f,y)=>(y%4===0?O.push([f]):O[O.length-1].push(f),O)),[]).map((O=>h.g.Ng(O)));H.setColor4Array(b,f)}for(b in O.vectors2)H.setVector2(b,S.i.Ng(O.vectors2[b]));for(b in O.vectors3)H.setVector3(b,S.m.Ng(O.vectors3[b]));for(b in O.vectors4)H.setVector4(b,S.q.Ng(O.vectors4[b]));for(b in O.quaternions)H.setQuaternion(b,S.c.Ng(O.quaternions[b]));for(b in O.matrices)H.setMatrix(b,S.b.Ng(O.matrices[b]));for(b in O.matrixArray)H._matrixArrays[b]=new Float32Array(O.matrixArray[b]);for(b in O.matrices3x3)H.setMatrix3x3(b,O.matrices3x3[b]);for(b in O.matrices2x2)H.setMatrix2x2(b,O.matrices2x2[b]);for(b in O.vectors2Arrays)H.setArray2(b,O.vectors2Arrays[b]);for(b in O.vectors3Arrays)H.setArray3(b,O.vectors3Arrays[b]);for(b in O.vectors4Arrays)H.setArray4(b,O.vectors4Arrays[b]);for(b in O.quaternionsArrays)H.setArray4(b,O.quaternionsArrays[b]);return H}static ParseFromFileAsync(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return new Promise(((H,b)=>{const h=new J.e;h.addEventListener("readystatechange",(()=>{if(4==h.readyState)if(200==h.status){const f=JSON.parse(h.responseText),b=this.Parse(f,y||w.c.LastCreatedScene,S);O&&(b.name=O),H(b)}else b("Unable to load the ShaderMaterial")})),h.open("GET",f),h.send()}))}static ParseFromSnippetAsync(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Promise(((S,H)=>{const b=new J.e;b.addEventListener("readystatechange",(()=>{if(4==b.readyState)if(200==b.status){const H=JSON.parse(JSON.parse(b.responseText).jsonPayload),h=JSON.parse(H.shaderMaterial),v=this.Parse(h,f||w.c.LastCreatedScene,y);v.snippetId=O,S(v)}else H("Unable to load the snippet "+O)})),b.open("GET",this.SnippetUrl+"/"+O.replace(/#/g,"/")),b.send()}))}}L.SnippetUrl="https://snippet.babylonjs.com",L.CreateFromSnippetAsync=L.ParseFromSnippetAsync,(0,I.g)("BABYLON.ShaderMaterial",L),H.d._LinesMeshParser=(O,f)=>p.Parse(O,f);class p extends H.d{_isShaderMaterial(O){return"ShaderMaterial"===O.getClassName()}constructor(O){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,S=arguments.length>5?arguments[5]:void 0,H=arguments.length>6?arguments[6]:void 0,b=arguments.length>7?arguments[7]:void 0;super(O,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,f,arguments.length>4?arguments[4]:void 0),this.useVertexColor=S,this.useVertexAlpha=H,this.color=new h.d(1,1,1),this.alpha=1,this._shaderLanguage=0,f&&(this.color=f.color.clone(),this.alpha=f.alpha,this.useVertexColor=f.useVertexColor,this.useVertexAlpha=f.useVertexAlpha),this.intersectionThreshold=.1;const N={attributes:[v.f.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(!1===H?N.needAlphaBlending=!1:N.defines.push("#define VERTEXALPHA"),S?(N.defines.push("#define VERTEXCOLOR"),N.attributes.push(v.f.ColorKind)):(N.uniforms.push("color"),this._color4=new h.g),b)this.material=b;else{this.va().getEngine().isWebGPU&&!p.ForceGLSL&&(this._shaderLanguage=1),N.shaderLanguage=this._shaderLanguage,N.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([y.e(23).then(y.bind(y,13544)),y.e(47).then(y.bind(y,13548))]):await Promise.all([y.e(28).then(y.bind(y,13553)),y.e(48).then(y.bind(y,13560))])},this.material=new L("colorShader",this.va(),"color",N,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(O){this._lineMaterial=O,this._lineMaterial.fillMode=m.c.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(O){}_bind(O,f){if(!this._geometry)return this;const y=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(f,y):this._geometry._bind(f,y,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:O,g:f,b:y}=this.color;this._color4.set(O,f,y,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(O,f,y){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const S=this.va().getEngine();return this._unIndexed?S.drawArraysType(m.c.LineListDrawMode,O.verticesStart,O.verticesCount,y):S.drawElementsType(m.c.LineListDrawMode,O.indexStart,O.indexCount,y),this}dispose(O){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(O)}clone(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2?arguments[2]:void 0;return new p(O,this.va(),f,this,y)}createInstance(O){const f=new U(O,this);if(this.instancedBuffers){f.instancedBuffers={};for(const O in this.instancedBuffers)f.instancedBuffers[O]=this.instancedBuffers[O]}return f}serialize(O){super.serialize(O),O.color=this.color.gj(),O.alpha=this.alpha}static Parse(O,f){const y=new p(O.name,f);return y.color=h.d.Ng(O.color),y.alpha=O.alpha,y}}p.ForceGLSL=!1;class U extends N.d{constructor(O,f){super(O,f),this.intersectionThreshold=f.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}var l=y(11017);function x(O){const f=[],y=[],S=O.lines,H=O.za,h=[];let v=0;for(let b=0;b<S.length;b++){const O=S[b];for(let S=0;S<O.length;S++){const{x:N,y:m,z:t}=O[S];if(y.push(N,m,t),H){const O=H[b],{r:f,g:y,b:v,a:N}=O[S];h.push(f,y,v,N)}S>0&&(f.push(v-1),f.push(v)),v++}}const N=new b.c;return N.indices=f,N.xa=y,H&&(N.za=h),N}function W(O){const f=O.dashSize||3,y=O.gapSize||1,H=O.dashNb||200,h=O.points,v=[],N=[],m=S.m.Zero();let t=0,q=0,F=0,I=0,A=0,J=0,X=0;for(X=0;X<h.length-1;X++)h[X+1].subtractToRef(h[X],m),t+=m.length();for(F=t/H,I=f*F/(f+y),X=0;X<h.length-1;X++){h[X+1].subtractToRef(h[X],m),q=Math.floor(m.length()/F),m.normalize();for(let O=0;O<q;O++)A=F*O,v.push(h[X].x+A*m.x,h[X].y+A*m.y,h[X].z+A*m.z),v.push(h[X].x+(A+I)*m.x,h[X].y+(A+I)*m.y,h[X].z+(A+I)*m.z),N.push(J,J+1),J+=2}const w=new b.c;return w.xa=v,w.indices=N,w}function E(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=f.instance,H=f.lines,b=f.za;if(S){const O=S.getVerticesData(v.f.PositionKind);let f,y;b&&(f=S.getVerticesData(v.f.ColorKind));let h=0,N=0;for(let S=0;S<H.length;S++){const v=H[S];for(let H=0;H<v.length;H++)O[h]=v[H].x,O[h+1]=v[H].y,O[h+2]=v[H].z,b&&f&&(y=b[S],f[N]=y[H].r,f[N+1]=y[H].g,f[N+2]=y[H].b,f[N+3]=y[H].a,N+=4),h+=3}return S.updateVerticesData(v.f.PositionKind,O,!1,!1),b&&f&&S.updateVerticesData(v.f.ColorKind,f,!1,!1),S.refreshBoundingInfo(),S}const h=new p(O,y,null,void 0,void 0,!!b,f.useVertexAlpha,f.material);return x(f).Ca(h,f.updatable),h}function o(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=f.za?[f.za]:null;return E(O,{lines:[f.points],updatable:f.updatable,instance:f.instance,za:S,useVertexAlpha:f.useVertexAlpha,material:f.material},y)}function i(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=f.points,h=f.instance,v=f.gapSize||1,N=f.dashSize||3;if(h){const O=O=>{const f=S.m.Zero(),y=O.length/6;let H=0,v=0,N=0,m=0,t=0,q=0,F=0,I=0;for(F=0;F<b.length-1;F++)b[F+1].subtractToRef(b[F],f),H+=f.length();N=H/y;const A=h._creationDataStorage.dashSize;for(m=A*N/(A+h._creationDataStorage.gapSize),F=0;F<b.length-1;F++)for(b[F+1].subtractToRef(b[F],f),v=Math.floor(f.length()/N),f.normalize(),I=0;I<v&&q<O.length;)t=N*I,O[q]=b[F].x+t*f.x,O[q+1]=b[F].y+t*f.y,O[q+2]=b[F].z+t*f.z,O[q+3]=b[F].x+(t+m)*f.x,O[q+4]=b[F].y+(t+m)*f.y,O[q+5]=b[F].z+(t+m)*f.z,q+=6,I++;for(;q<O.length;)O[q]=b[F].x,O[q+1]=b[F].y,O[q+2]=b[F].z,q+=3};return(f.dashNb||f.dashSize||f.gapSize||f.useVertexAlpha||f.material)&&l.e.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),h.updateMeshPositions(O,!1),h}const m=new p(O,y,null,void 0,void 0,void 0,f.useVertexAlpha,f.material);return W(f).Ca(m,f.updatable),m._creationDataStorage=new H.g,m._creationDataStorage.dashSize=N,m._creationDataStorage.gapSize=v,m}b.c.CreateLineSystem=x,b.c.CreateDashedLines=W,H.d.sb=function(O,f){return o(O,{points:f,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},H.d.CreateDashedLines=function(O,f,y,S,H){return i(O,{points:f,dashSize:y,gapSize:S,dashNb:H,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},11672:(O,f,y)=>{"use strict";y.d(f,{d:()=>v,h:()=>N});var S=y(11557),H=y(11577),b=y(11526);function h(O){const f=[],y=[],S=[],h=[],v=O.width||O.size||1,N=O.height||O.size||1,m=0===O.sideOrientation?0:O.sideOrientation||H.c.DEFAULTSIDE,t=v/2,q=N/2;y.push(-t,-q,0),S.push(0,0,-1),h.push(0,b.b?1:0),y.push(t,-q,0),S.push(0,0,-1),h.push(1,b.b?1:0),y.push(t,q,0),S.push(0,0,-1),h.push(1,b.b?0:1),y.push(-t,q,0),S.push(0,0,-1),h.push(0,b.b?0:1),f.push(0),f.push(1),f.push(2),f.push(0),f.push(2),f.push(3),H.c._ComputeSides(m,y,f,S,h,O.frontUVs,O.backUVs);const F=new H.c;return F.indices=f,F.xa=y,F.ya=S,F.Aa=h,F}function v(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=new S.d(O,y);f.sideOrientation=S.d._GetDefaultSideOrientation(f.sideOrientation),H._originalBuilderSideOrientation=f.sideOrientation;return h(f).Ca(H,f.updatable),f.sourcePlane&&(H.translate(f.sourcePlane.k,-f.sourcePlane.d),H.setDirection(f.sourcePlane.k.scale(-1))),H}const N={_f:v};H.c._f=h,S.d._f=(O,f,y,S,H)=>v(O,{size:f,width:f,height:f,sideOrientation:H,updatable:S},y)},11907:(O,f,y)=>{"use strict";y.d(f,{c:()=>N});var S=y(11324),H=y(11557),b=y(11577),h=y(11526);function v(O){const f=0|(O.segments||32),y=O.diameterX||O.diameter||1,H=O.diameterY||O.diameter||1,v=O.diameterZ||O.diameter||1,N=O.arc&&(O.arc<=0||O.arc>1)?1:O.arc||1,m=O.slice&&O.slice<=0?1:O.slice||1,t=0===O.sideOrientation?0:O.sideOrientation||b.c.DEFAULTSIDE,q=!!O.dedupTopBottomIndices,F=new S.m(y/2,H/2,v/2),I=2+f,A=2*I,J=[],X=[],w=[],B=[];for(let b=0;b<=I;b++){const O=b/I,f=O*Math.PI*m;for(let y=0;y<=A;y++){const H=y/A,b=H*Math.PI*2*N,v=S.b.RotationZ(-f),m=S.b.RotationY(b),t=S.m.TransformCoordinates(S.m.Up(),v),q=S.m.TransformCoordinates(t,m),I=q.multiply(F),J=q.divide(F).normalize();X.push(I.x,I.y,I.z),w.push(J.x,J.y,J.z),B.push(H,h.b?1-O:O)}if(b>0){const O=X.length/3;for(let f=O-2*(A+1);f+A+2<O;f++)q?(b>1&&(J.push(f),J.push(f+1),J.push(f+A+1)),(b<I||m<1)&&(J.push(f+A+1),J.push(f+1),J.push(f+A+2))):(J.push(f),J.push(f+1),J.push(f+A+1),J.push(f+A+1),J.push(f+1),J.push(f+A+2))}}b.c._ComputeSides(t,X,J,w,B,O.frontUVs,O.backUVs);const j=new b.c;return j.indices=J,j.xa=X,j.ya=w,j.Aa=B,j}function N(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new H.d(O,y);f.sideOrientation=H.d._GetDefaultSideOrientation(f.sideOrientation),S._originalBuilderSideOrientation=f.sideOrientation;return v(f).Ca(S,f.updatable),S}b.c.CreateSphere=v,H.d.CreateSphere=(O,f,y,S,H,b)=>N(O,{segments:f,diameterX:y,diameterY:y,diameterZ:y,sideOrientation:b,updatable:H},S)},12277:(O,f,y)=>{"use strict";y.d(f,{b:()=>q});var S=y(10995),H=y(12283),b=y(11585),h=y(11392),v=y(11577),N=y(11017);function m(O,f,y,S,H){let b=null,h=null,v=null;try{let N;b=new O.Decoder,h=new O.DecoderBuffer,h.Init(f,f.byteLength);const m=b.GetEncodedGeometryType(h);switch(m){case O.TRIANGULAR_MESH:{const f=new O.Mesh;if(N=b.DecodeBufferToMesh(h,f),!N.ok()||0===f.ptr)throw new Error(N.error_msg());const y=3*f.num_faces(),H=4*y,m=O._malloc(H);try{b.GetTrianglesUInt32Array(f,H,m);const h=new Uint32Array(y);h.set(new Uint32Array(O.HEAPF32.buffer,m,y)),S(h)}finally{O._free(m)}v=f;break}case O.POINT_CLOUD:{const f=new O.PointCloud;if(N=b.DecodeBufferToPointCloud(h,f),!N.ok()||!f.ptr)throw new Error(N.error_msg());v=f;break}default:throw new Error(`Invalid geometry type ${m}`)}const t=v.num_points(),q=(f,y,S,b)=>{const h=b.data_type(),v=b.num_components(),N=b.normalized(),m=b.byte_stride(),q=b.byte_offset(),F={[O.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:O.HEAPF32},[O.DT_INT8]:{typedArrayConstructor:Int8Array,heap:O.HEAP8},[O.DT_INT16]:{typedArrayConstructor:Int16Array,heap:O.HEAP16},[O.DT_INT32]:{typedArrayConstructor:Int32Array,heap:O.HEAP32},[O.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:O.HEAPU8},[O.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:O.HEAPU16},[O.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:O.HEAPU32}}[h];if(!F)throw new Error(`Invalid data type ${h}`);const I=t*v,A=I*F.typedArrayConstructor.BYTES_PER_ELEMENT,J=O._malloc(A);try{f.GetAttributeDataArrayForAllPoints(y,b,h,A,J);const O=new F.typedArrayConstructor(F.heap.buffer,J,I);H(S,O.slice(),v,q,m,N)}finally{O._free(J)}};if(y)for(const O in y){const f=y[O],S=b.GetAttributeByUniqueId(v,f);q(b,v,O,S)}else{const f={position:O.POSITION,k:O.NORMAL,color:O.COLOR,uv:O.TEX_COORD};for(const O in f){const y=b.GetAttributeId(v,f[O]);if(-1!==y){const f=b.GetAttribute(v,y);q(b,v,O,f)}}}return t}finally{v&&O.destroy(v),h&&O.destroy(h),b&&O.destroy(b)}}function t(){let O;onmessage=f=>{const y=f.data;switch(y.id){case"init":{const f=y.decoder;f.url&&importScripts(f.url);const S=f.wasmBinary?{wasmBinary:f.wasmBinary}:{};O=DracoDecoderModule(S),postMessage({id:"initDone"});break}case"decodeMesh":if(!O)throw new Error("Draco decoder module is not available");O.then((O=>{const f=m(O,y.dataView,y.attributes,(O=>{postMessage({id:"indices",data:O},[O.buffer])}),((O,f,y,S,H,b)=>{postMessage({id:"attribute",kind:O,data:f,size:y,byteOffset:S,byteStride:H,normalized:b},[f.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:f})}))}}}class q{static get DecoderAvailable(){const O=q.Configuration.decoder;return!!(O.wasmUrl&&O.wasmBinaryUrl&&"object"===typeof WebAssembly||O.fallbackUrl)}static GetDefaultNumWorkers(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static get Default(){return q._Default||(q._Default=new q),q._Default}static ResetDefault(O){q._Default&&(O||q._Default.dispose(),q._Default=null)}constructor(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q.DefaultNumWorkers;const f=q.Configuration.decoder;if(f.workerPool||"object"===typeof O&&O.workerPool)this._workerPoolPromise=Promise.resolve(f.workerPool||O.workerPool);else{const y=f.wasmBinary||"object"===typeof O&&O.wasmBinary,b="number"===typeof O?O:O.numWorkers,h=b&&"function"===typeof Worker&&"function"===typeof URL,v=h||!h&&!f.jsModule,N=f.wasmUrl&&f.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:v?S.d.GetBabylonScriptURL(f.wasmUrl,!0):"",wasmBinaryPromise:y?Promise.resolve(y):S.d.LoadFileAsync(S.d.GetBabylonScriptURL(f.wasmBinaryUrl,!0))}:{url:v?S.d.GetBabylonScriptURL(f.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};h?this._workerPoolPromise=N.wasmBinaryPromise.then((O=>{const f=`${m}(${t})()`,y=URL.createObjectURL(new Blob([f],{type:"application/javascript"}));return new H.c(b,(()=>function(O,f,y){return new Promise(((S,H)=>{const b=f=>{O.removeEventListener("error",b),O.removeEventListener("message",h),H(f)},h=f=>{"initDone"===f.data.id&&(O.removeEventListener("error",b),O.removeEventListener("message",h),S(O))};if(O.addEventListener("error",b),O.addEventListener("message",h),f){const S=f.slice(0);O.postMessage({id:"init",decoder:{url:y,wasmBinary:S}},[S])}else O.postMessage({id:"init",decoder:{url:y}})}))}(new Worker(y),O,N.url)))})):this._decoderModulePromise=N.wasmBinaryPromise.then((async O=>{if("undefined"===typeof DracoDecoderModule&&!f.jsModule){if(!N.url)throw new Error("Draco decoder module is not available");await S.d.LoadBabylonScriptAsync(N.url)}return await(y=O,H=f.jsModule,new Promise((O=>{(H||DracoDecoderModule)({wasmBinary:y}).then((f=>{O({module:f})}))})));var y,H}))}}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((O=>{O.dispose()})),delete this._workerPoolPromise,delete this._decoderModulePromise}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._decoderModulePromise&&await this._decoderModulePromise}decodeMeshToMeshDataAsync(O,f,y){const S=O instanceof ArrayBuffer?new Int8Array(O):new Int8Array(O.buffer,O.byteOffset,O.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((O=>new Promise(((H,b)=>{O.push(((O,h)=>{let v=null;const m=[],t=f=>{O.removeEventListener("error",t),O.removeEventListener("message",q),b(f),h()},q=f=>{const S=f.data;switch(S.id){case"decodeMeshDone":O.removeEventListener("error",t),O.removeEventListener("message",q),H({indices:v,attributes:m,totalVertices:S.totalVertices}),h();break;case"indices":v=S.data;break;case"attribute":m.push({kind:S.kind,data:S.data,size:S.size,byteOffset:S.byteOffset,byteStride:S.byteStride,normalized:(b=S.kind,F=S.normalized,y&&void 0!==y[b]?(F!==y[b]&&N.e.Warn(`Normalized flag from Draco data (${F}) does not match normalized flag from glTF accessor (${y[b]}). Using flag from glTF accessor.`),y[b]):F)})}var b,F};O.addEventListener("error",t),O.addEventListener("message",q);const F=S.slice();O.postMessage({id:"decodeMesh",dataView:F,attributes:f},[F.buffer])}))}))));if(this._decoderModulePromise)return this._decoderModulePromise.then((O=>{let y=null;const H=[],b=m(O.module,S,f,(O=>{y=O}),((O,f,y,S,b,h)=>{H.push({kind:O,data:f,size:y,byteOffset:S,byteStride:b,normalized:h})}));return{indices:y,attributes:H,totalVertices:b}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(O,f,y,S){const H=await this.decodeMeshToMeshDataAsync(y,S),v=new b.e(O,f);H.indices&&v.setIndices(H.indices);for(const b of H.attributes)v.setVerticesBuffer(new h.f(f.getEngine(),b.data,b.kind,!1,void 0,b.byteStride,void 0,b.byteOffset,b.size,void 0,b.normalized,!0),H.totalVertices);return v}async _decodeMeshToGeometryForGltfAsync(O,f,y,S,H){const v=await this.decodeMeshToMeshDataAsync(y,S,H),N=new b.e(O,f);v.indices&&N.setIndices(v.indices);for(const b of v.attributes)N.setVerticesBuffer(new h.f(f.getEngine(),b.data,b.kind,!1,void 0,b.byteStride,void 0,b.byteOffset,b.size,void 0,b.normalized,!0),v.totalVertices);return N}async decodeMeshAsync(O,f){const y=await this.decodeMeshToMeshDataAsync(O,f),S=new v.c;y.indices&&(S.indices=y.indices);for(const H of y.attributes){const O=h.f.GetFloatData(H.data,H.size,h.f.GetDataType(H.data),H.byteOffset,H.byteStride,H.normalized,y.totalVertices);S.set(O,H.kind)}return S}}q.Configuration={decoder:{wasmUrl:`${S.d._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${S.d._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${S.d._DefaultCdnUrl}/draco_decoder_gltf.js`}},q.DefaultNumWorkers=q.GetDefaultNumWorkers(),q._Default=null},11728:(O,f,y)=>{"use strict";y.d(f,{c:()=>H});var S=y(11394);class H extends S.c{constructor(O){super(),this._buffer=O}get underlyingResource(){return this._buffer}}},11593:(O,f,y)=>{"use strict";y.d(f,{c:()=>U});var S=y(11289),H=y(11004),b=y(11324),h=y(11392),v=y(11577),N=y(11598),m=y(11383),t=y(11466),q=y(11380);class F{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new b.m(0,0,0),this._diffPositionForCollisions=new b.m(0,0,0),this._collisionResponse=!0}}var I=y(11030),A=y(11484),J=y(11359),X=y(11330),w=y(11606),B=y(11153),j=y(11294),u=y(11092);class L{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=b.m.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class p{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new L,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new F,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class U extends N.b{static get BILLBOARDMODE_NONE(){return N.b.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return N.b.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return N.b.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return N.b.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return N.b.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return N.b.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(O){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=O}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(O){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=O}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(O){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=O}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(O){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=O}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(O){this._internalAbstractMeshDataInfo._collisionRetryCount=O}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(O){this._internalAbstractMeshDataInfo._morphTargetManager!==O&&(this._internalAbstractMeshDataInfo._morphTargetManager=O,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(O){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==O&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=O,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(O){return!!super._updateNonUniformScalingState(O)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(O){this._internalAbstractMeshDataInfo._rawBoundingInfo=O}set Gk(O){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(O)}set onCollisionPositionChange(O){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(O)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(O){if(this._internalAbstractMeshDataInfo._visibility===O)return;const f=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=O,(1===f&&1!==O||1!==f&&1===O)&&this._markSubMeshesAsDirty((O=>{O.markAsMiscDirty(),O.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(O){this._internalAbstractMeshDataInfo._inheritVisibility=O}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let O=this._parentNode;for(;O;){const f=O.isVisible;if("undefined"!==typeof f)return f;O=O.parent}}return this._isVisible}set isVisible(O){this._isVisible=O}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(O){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=O}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(O){this._internalAbstractMeshDataInfo._renderingGroupId=O}get material(){return this._internalAbstractMeshDataInfo._material}set material(O){this._setMaterial(O)}_setMaterial(O){this._internalAbstractMeshDataInfo._material!==O&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=O,O&&O.meshMap&&(O.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.Yf&&(this.resetDrawCache(),this._unBindEffect()))}getMaterialForRenderPass(O){var f;return null===(f=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===f?void 0:f[O]}setMaterialForRenderPass(O,f){this.resetDrawCache(O),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[O]=f}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(O){this._internalAbstractMeshDataInfo._receiveShadows!==O&&(this._internalAbstractMeshDataInfo._receiveShadows=O,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(O){this._internalAbstractMeshDataInfo._hasVertexAlpha!==O&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=O,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(O){this._internalAbstractMeshDataInfo._useVertexColors!==O&&(this._internalAbstractMeshDataInfo._useVertexColors=O,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(O){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==O&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=O,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(O){this._internalAbstractMeshDataInfo._numBoneInfluencers!==O&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=O,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(O){this._internalAbstractMeshDataInfo._applyFog!==O&&(this._internalAbstractMeshDataInfo._applyFog=O,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(O){this._internalAbstractMeshDataInfo._enableDistantPicking=O}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(O){O!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=O,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(O){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(O)?-1:O}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(O){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=O}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(O){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(O)?-1:O}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(O){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=O}get lightSources(){return this._lightSources}set skeleton(O){const f=this._internalAbstractMeshDataInfo._skeleton;f&&f.needInitialSkinMatrix&&f._unregisterMeshWithPoseMatrix(this),O&&O.needInitialSkinMatrix&&O._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=O,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(O){var f;let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(O,y,!1),f=this,this._internalAbstractMeshDataInfo=new p,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.Bi=U.Ci,this.onCollideObservable=new H.d,this.onCollisionPositionChangeObservable=new H.d,this.onMaterialChangedObservable=new H.d,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.Mb=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=J.d.Red(),this.outlineWidth=.02,this.overlayColor=J.d.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.qb=!1,this.Da=!1,this.actionManager=null,this.ellipsoid=new b.m(.5,1,.5),this.ellipsoidOffset=new b.m(0,0,0),this.edgesWidth=1,this.edgesColor=new J.g(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,sd:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new H.d,this._onCollisionPositionChange=function(O,y){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;y.subtractToRef(f._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,f._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),f._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>u.c.CollisionsEpsilon&&f.position.addInPlace(f._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),S&&f.onCollideObservable.notifyObservers(S),f.onCollisionPositionChangeObservable.notifyObservers(f.position)},y=this.va(),y.ji(this),this._resyncLightSources(),this._uniformBuffer=new q.b(this.va().getEngine(),void 0,void 0,O,!this.va().getEngine().isWebGPU),this._buildUniformLayout(),y.performancePriority){case 2:this.Da=!0;case 1:this.qb=!0,this.Mb=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(O){const f=this._uniformBuffer;f.Fj("world",O),f.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),f.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(O){let f="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");f+=", # of submeshes: "+(this.Yf?this.Yf.length:0);const y=this._internalAbstractMeshDataInfo._skeleton;return y&&(f+=", skeleton: "+y.name),O&&(f+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],f+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.sd?"YES":"NO")),f}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==N.b.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(f||this.actionManager.isRecursive)){if(!O)return this.actionManager;if(this.actionManager.hasSpecificTrigger(O))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(O,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.Yf){for(const O of this.Yf)O._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const O of this.va().lights)O.isEnabled()&&O.canAffectMesh(this)&&this._lightSources.push(O);this._markSubMeshesAsLightDirty()}_resyncLightSource(O){const f=O.isEnabled()&&O.canAffectMesh(this),y=this._lightSources.indexOf(O);let S=!1;if(-1===y){if(!f)return;this._lightSources.push(O)}else{if(f)return;S=!0,this._lightSources.splice(y,1)}this._markSubMeshesAsLightDirty(S)}_unBindEffect(){for(const O of this.Yf)O.setEffect(null)}_removeLightSource(O,f){const y=this._lightSources.indexOf(O);-1!==y&&(this._lightSources.splice(y,1),this._markSubMeshesAsLightDirty(f))}_markSubMeshesAsDirty(O){if(this.Yf)for(const f of this.Yf)for(let y=0;y<f._drawWrappers.length;++y){const S=f._drawWrappers[y];S&&S.defines&&S.defines.markAllAsDirty&&O(S.defines)}}_markSubMeshesAsLightDirty(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((f=>f.markAsLightDirty(O)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((O=>O.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((O=>O.markAsMiscDirty()))}Dg(O){return this._currentRenderId=Number.MAX_VALUE,super.Dg(O),this._isDirty=!0,this}resetDrawCache(O){if(this.Yf)for(const f of this.Yf)f.resetDrawCache(O)}get isBlocked(){return!1}getLOD(O){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}Pf(){return null}getVerticesData(O){return null}Ga(O,f,y,S){return this}updateVerticesData(O,f,y,S){return this}setIndices(O,f){return this}isVerticesDataPresent(O){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.Ea()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(O){return this._boundingInfo=O,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(O,f,y){return this._boundingInfo=new t.e(O,f,y),this._boundingInfo}normalizeToUnitCube(){let O=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(O,f,y)}get useBones(){return this.skeleton&&this.va().skeletonsEnabled&&this.isVerticesDataPresent(h.f.MatricesIndicesKind)&&this.isVerticesDataPresent(h.f.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(O){}_activate(O,f){return this._renderId=O,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===N.b.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(O,f,y){return this.position.addInPlace(this.calcMovePOV(O,f,y)),this}calcMovePOV(O,f,y){const S=new b.b;(this.rotationQuaternion?this.rotationQuaternion:b.c.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(S);const H=b.m.Zero(),h=this.definedFacingForward?-1:1;return b.m.TransformCoordinatesFromFloatsToRef(O*h,f,y*h,S,H),H}rotatePOV(O,f,y){return this.rotation.addInPlace(this.calcRotatePOV(O,f,y)),this}calcRotatePOV(O,f,y){const S=this.definedFacingForward?1:-1;return new b.m(O*S,f,y*S)}Fa(O,f){if(O){const y=(0,A.f)(O,0,this.getTotalVertices(),f);this._boundingInfo?this._boundingInfo.reConstruct(y.minimum,y.maximum):this._boundingInfo=new t.e(y.minimum,y.maximum)}if(this.Yf)for(let y=0;y<this.Yf.length;y++)this.Yf[y].refreshBoundingInfo(O);this.Ea()}_refreshBoundingInfoDirect(O){if(this._boundingInfo?this._boundingInfo.reConstruct(O.minimum,O.maximum):this._boundingInfo=new t.e(O.minimum,O.maximum),this.Yf)for(let f=0;f<this.Yf.length;f++)this.Yf[f].refreshBoundingInfo(null);this.Ea()}static _ApplySkeleton(O,f,y,S,H,v,N){!function(O,f,y,S,H,v,N){const m=b.g.fb[0],t=b.g.Matrix[0],q=b.g.Matrix[1],F=f===h.f.NormalKind?b.m.TransformNormalFromFloatsToRef:b.m.TransformCoordinatesFromFloatsToRef;for(let h=0,I=0;h<O.length;h+=3,I+=4){let f,A;for(t.reset(),f=0;f<4;f++)A=H[I+f],A>0&&(b.b.FromFloat32ArrayToRefScaled(y,Math.floor(16*S[I+f]),A,q),t.addToSelf(q));if(v&&N)for(f=0;f<4;f++)A=N[I+f],A>0&&(b.b.FromFloat32ArrayToRefScaled(y,Math.floor(16*v[I+f]),A,q),t.addToSelf(q));F(O[h],O[h+1],O[h+2],t,m),m.toArray(O,h)}}(O,f,y,S,H,v,N)}_getData(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h.f.PositionKind;const S=O.cache,H=O=>{if(S){const f=S._vertexData||(S._vertexData={});return f[O]||this.copyVerticesData(O,f),f[O]}return this.getVerticesData(O)};if(f||(f=H(y)),!f)return null;if(S?(S._outputData?S._outputData.set(f):S._outputData=new Float32Array(f),f=S._outputData):(O.applyMorph&&this.morphTargetManager||O.applySkeleton&&this.skeleton)&&(f=f.slice()),O.applyMorph&&this.morphTargetManager&&function(O,f,y){let S=null;switch(f){case h.f.PositionKind:S=O=>O.getPositions();break;case h.f.NormalKind:S=O=>O.getNormals();break;case h.f.TangentKind:S=O=>O.getTangents();break;case h.f.UVKind:S=O=>O.getUVs();break;default:return}for(let H=0;H<O.length;H++){let f=O[H];for(let b=0;b<y.numTargets;b++){const h=y.getTarget(b),v=h.influence;if(0!==v){const y=S(h);y&&(f+=(y[H]-O[H])*v)}}O[H]=f}}(f,y,this.morphTargetManager),O.applySkeleton&&this.skeleton){const O=H(h.f.MatricesIndicesKind),S=H(h.f.MatricesWeightsKind);if(S&&O){const b=this.numBoneInfluencers>4,v=b?H(h.f.MatricesIndicesExtraKind):null,N=b?H(h.f.MatricesWeightsExtraKind):null,m=this.skeleton.getTransformMatrices(this);U._ApplySkeleton(f,y,m,O,S,v,N)}}if(!1!==O.updatePositionsArray&&y===h.f.PositionKind){const O=this._internalAbstractMeshDataInfo._positions||[],y=O.length;if(O.length=f.length/3,y<O.length)for(let f=y;f<O.length;f++)O[f]=new b.m;for(let S=0,H=0;S<O.length;S++,H+=3)O[S].Xd(f[H],f[H+1],f[H+2]);this._internalAbstractMeshDataInfo._positions=O}return f}getNormalsData(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:O,applyMorph:f,updatePositionsArray:!1},null,h.f.NormalKind)}Ed(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:O,applyMorph:f,updatePositionsArray:!1},y,h.f.PositionKind)}Ea(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new t.e(b.m.Zero(),b.m.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(O){if(!this.Yf)return this;const f=this.Yf.length;for(let y=0;y<f;y++){const S=this.Yf[y];(f>1||!S.IsGlobal)&&S.updateBoundingInfo(O)}return this}_afterComputeWorldMatrix(){this.Da||(this._boundingInfoIsDirty=!0)}isInFrustum(O){return this.getBoundingInfo().isInFrustum(O,this.Bi)}isCompletelyInFrustum(O){return this.getBoundingInfo().isCompletelyInFrustum(O)}intersectsMesh(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2?arguments[2]:void 0;const S=this.getBoundingInfo(),H=O.getBoundingInfo();if(S.intersects(H,f))return!0;if(y)for(const b of this.getChildMeshes())if(b.intersectsMesh(O,f,!0))return!0;return!1}intersectsPoint(O){return this.getBoundingInfo().intersectsPoint(O)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(O){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=O}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(O){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const f=this.va().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=f.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,f.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,O,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}_collideForSubMesh(O,f,y){var S;if(this._generatePointsArray(),!this._positions)return this;if(!O._lastColliderWorldVertices||!O._lastColliderTransformMatrix.equals(f)){O._lastColliderTransformMatrix=f.clone(),O._lastColliderWorldVertices=[],O._trianglePlanes=[];const y=O.verticesStart,S=O.verticesStart+O.verticesCount;for(let H=y;H<S;H++)O._lastColliderWorldVertices.push(b.m.TransformCoordinates(this._positions[H],f))}return y._collide(O._trianglePlanes,O._lastColliderWorldVertices,this.Pf(),O.indexStart,O.indexStart+O.indexCount,O.verticesStart,!!O.Ha(),this,this._shouldConvertRHS(),7===(null===(S=O.Ha())||void 0===S?void 0:S.fillMode)),this}_processCollisionsForSubMeshes(O,f){const y=this._scene.getCollidingSubMeshCandidates(this,O),S=y.length;for(let H=0;H<S;H++){const b=y.data[H];S>1&&!b._checkCollision(O)||this._collideForSubMesh(b,f,O)}return this}_shouldConvertRHS(){return!1}_checkCollision(O){if(!this.getBoundingInfo()._checkCollision(O))return this;const f=b.g.Matrix[0],y=b.g.Matrix[1];return b.b.ScalingToRef(1/O._radius.x,1/O._radius.y,1/O._radius.z,f),this.worldMatrixFromCache.multiplyToRef(f,y),this._processCollisionsForSubMeshes(O,y),this}_generatePointsArray(){return!1}intersects(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],H=arguments.length>4?arguments[4]:void 0,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const v=new m.b,N=this.getClassName(),t="InstancedLinesMesh"===N||"LinesMesh"===N||"GreasedLineMesh"===N?this.intersectionThreshold:0,q=this.getBoundingInfo();if(!this.Yf)return v;if(!h&&(!O.intersectsSphere(q.boundingSphere,t)||!O.intersectsBox(q.boundingBox,t)))return v;if(S)return v.hit=!h,v.pickedMesh=h?null:this,v.distance=h?0:b.m.Distance(O.origin,q.boundingSphere.center),v.subMeshId=0,v;if(!this._generatePointsArray())return v;let F=null;const I=this._scene.getIntersectingSubMeshCandidates(this,O),A=I.length;let J=!1;for(let b=0;b<A;b++){const O=I.data[b].Ha();if(O&&(7==O.fillMode||0==O.fillMode||1==O.fillMode||2==O.fillMode||4==O.fillMode)){J=!0;break}}if(!J)return v.hit=!0,v.pickedMesh=this,v.distance=b.m.Distance(O.origin,q.boundingSphere.center),v.subMeshId=-1,v;for(let b=0;b<A;b++){const S=I.data[b];if(A>1&&!h&&!S.canIntersects(O))continue;const H=S.intersects(O,this._positions,this.Pf(),f,y);if(H&&(f||!F||H.distance<F.distance)&&(F=H,F.subMeshId=b,f))break}if(F){const f=H??this.getWorldMatrix(),y=b.g.fb[0],S=b.g.fb[1];b.m.TransformCoordinatesToRef(O.origin,f,y),O.direction.scaleToRef(F.distance,S);const h=b.m.TransformNormal(S,f).addInPlace(y);return v.hit=!0,v.distance=b.m.Distance(y,h),v.pickedPoint=h,v.pickedMesh=this,v.bu=F.bu||0,v.bv=F.bv||0,v.subMeshFaceId=F.faceId,v.faceId=F.faceId+I.data[F.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),v.subMeshId=F.subMeshId,v}return v}clone(O,f,y){return null}releaseSubMeshes(){if(this.Yf)for(;this.Yf.length;)this.Yf[0].dispose();else this.Yf=[];return this}dispose(O){let f,y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const S=this.va();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),S.freeActiveMeshes(),S.freeRenderingGroups(),S.renderingManager.maintainStateBetweenFrames&&S.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((O=>O!==this&&O.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),f=0;f<this._intersectionsInProgress.length;f++){const O=this._intersectionsInProgress[f],y=O._intersectionsInProgress.indexOf(this);O._intersectionsInProgress.splice(y,1)}this._intersectionsInProgress.length=0;S.lights.forEach((O=>{let f=O.includedOnlyMeshes.indexOf(this);-1!==f&&O.includedOnlyMeshes.splice(f,1),f=O.excludedMeshes.indexOf(this),-1!==f&&O.excludedMeshes.splice(f,1);const y=O.getShadowGenerators();if(y){const O=y.values();for(let y=O.next();!0!==y.done;y=O.next()){const O=y.value.getShadowMap();O&&O.renderList&&(f=O.renderList.indexOf(this),-1!==f&&O.renderList.splice(f,1))}}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();const H=S.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,H.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),H.wipeCaches(),S.xd(this),this._parentContainer){const O=this._parentContainer.meshes.indexOf(this);O>-1&&this._parentContainer.meshes.splice(O,1),this._parentContainer=null}if(y&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!O)for(f=0;f<S.oj.length;f++)S.oj[f].j===this&&(S.oj[f].dispose(),f--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(O,y)}_initFacetData(){const O=this._internalAbstractMeshDataInfo._facetData;O.facetNormals||(O.facetNormals=[]),O.facetPositions||(O.facetPositions=[]),O.facetPartitioning||(O.facetPartitioning=new Array),O.facetNb=this.Pf().length/3|0,O.partitioningSubdivisions=O.partitioningSubdivisions?O.partitioningSubdivisions:10,O.partitioningBBoxRatio=O.partitioningBBoxRatio?O.partitioningBBoxRatio:1.01;for(let f=0;f<O.facetNb;f++)O.facetNormals[f]=b.m.Zero(),O.facetPositions[f]=b.m.Zero();return O.facetDataEnabled=!0,this}updateFacetData(){const O=this._internalAbstractMeshDataInfo._facetData;O.facetDataEnabled||this._initFacetData();const f=this.getVerticesData(h.f.PositionKind),y=this.Pf(),S=this.getVerticesData(h.f.NormalKind),H=this.getBoundingInfo();if(O.facetDepthSort&&!O.facetDepthSortEnabled){if(O.facetDepthSortEnabled=!0,y instanceof Uint16Array)O.depthSortedIndices=new Uint16Array(y);else if(y instanceof Uint32Array)O.depthSortedIndices=new Uint32Array(y);else{let f=!1;for(let O=0;O<y.length;O++)if(y[O]>65535){f=!0;break}O.depthSortedIndices=f?new Uint32Array(y):new Uint16Array(y)}if(O.facetDepthSortFunction=function(O,f){return f.sqDistance-O.sqDistance},!O.facetDepthSortFrom){const f=this.va().activeCamera;O.facetDepthSortFrom=f?f.position:b.m.Zero()}O.depthSortedFacets=[];for(let f=0;f<O.facetNb;f++){const y={ind:3*f,sqDistance:0};O.depthSortedFacets.push(y)}O.invertedMatrix=b.b.Identity(),O.facetDepthSortOrigin=b.m.Zero()}O.bbSize.x=H.maximum.x-H.minimum.x>X.d?H.maximum.x-H.minimum.x:X.d,O.bbSize.y=H.maximum.y-H.minimum.y>X.d?H.maximum.y-H.minimum.y:X.d,O.bbSize.z=H.maximum.z-H.minimum.z>X.d?H.maximum.z-H.minimum.z:X.d;let N=O.bbSize.x>O.bbSize.y?O.bbSize.x:O.bbSize.y;if(N=N>O.bbSize.z?N:O.bbSize.z,O.subDiv.max=O.partitioningSubdivisions,O.subDiv.X=Math.floor(O.subDiv.max*O.bbSize.x/N),O.subDiv.Y=Math.floor(O.subDiv.max*O.bbSize.y/N),O.subDiv.Z=Math.floor(O.subDiv.max*O.bbSize.z/N),O.subDiv.X=O.subDiv.X<1?1:O.subDiv.X,O.subDiv.Y=O.subDiv.Y<1?1:O.subDiv.Y,O.subDiv.Z=O.subDiv.Z<1?1:O.subDiv.Z,O.facetParameters.facetNormals=this.getFacetLocalNormals(),O.facetParameters.facetPositions=this.getFacetLocalPositions(),O.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),O.facetParameters.bInfo=H,O.facetParameters.bbSize=O.bbSize,O.facetParameters.subDiv=O.subDiv,O.facetParameters.ratio=this.partitioningBBoxRatio,O.facetParameters.depthSort=O.facetDepthSort,O.facetDepthSort&&O.facetDepthSortEnabled&&(this.Mj(!0),this._worldMatrix.invertToRef(O.invertedMatrix),b.m.TransformCoordinatesToRef(O.facetDepthSortFrom,O.invertedMatrix,O.facetDepthSortOrigin),O.facetParameters.distanceTo=O.facetDepthSortOrigin),O.facetParameters.depthSortedFacets=O.depthSortedFacets,S&&v.c.ComputeNormals(f,y,S,O.facetParameters),O.facetDepthSort&&O.facetDepthSortEnabled){O.depthSortedFacets.sort(O.facetDepthSortFunction);const f=O.depthSortedIndices.length/3|0;for(let S=0;S<f;S++){const f=O.depthSortedFacets[S].ind;O.depthSortedIndices[3*S]=y[f],O.depthSortedIndices[3*S+1]=y[f+1],O.depthSortedIndices[3*S+2]=y[f+2]}this.updateIndices(O.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const O=this._internalAbstractMeshDataInfo._facetData;return O.facetNormals||this.updateFacetData(),O.facetNormals}getFacetLocalPositions(){const O=this._internalAbstractMeshDataInfo._facetData;return O.facetPositions||this.updateFacetData(),O.facetPositions}getFacetLocalPartitioning(){const O=this._internalAbstractMeshDataInfo._facetData;return O.facetPartitioning||this.updateFacetData(),O.facetPartitioning}getFacetPosition(O){const f=b.m.Zero();return this.getFacetPositionToRef(O,f),f}getFacetPositionToRef(O,f){const y=this.getFacetLocalPositions()[O],S=this.getWorldMatrix();return b.m.TransformCoordinatesToRef(y,S,f),this}getFacetNormal(O){const f=b.m.Zero();return this.getFacetNormalToRef(O,f),f}getFacetNormalToRef(O,f){const y=this.getFacetLocalNormals()[O];return b.m.TransformNormalToRef(y,this.getWorldMatrix(),f),this}getFacetsAtLocalCoordinates(O,f,y){const S=this.getBoundingInfo(),H=this._internalAbstractMeshDataInfo._facetData,b=Math.floor((O-S.minimum.x*H.partitioningBBoxRatio)*H.subDiv.X*H.partitioningBBoxRatio/H.bbSize.x),h=Math.floor((f-S.minimum.y*H.partitioningBBoxRatio)*H.subDiv.Y*H.partitioningBBoxRatio/H.bbSize.y),v=Math.floor((y-S.minimum.z*H.partitioningBBoxRatio)*H.subDiv.Z*H.partitioningBBoxRatio/H.bbSize.z);return b<0||b>H.subDiv.max||h<0||h>H.subDiv.max||v<0||v>H.subDiv.max?null:H.facetPartitioning[b+H.subDiv.max*h+H.subDiv.max*H.subDiv.max*v]}getClosestFacetAtCoordinates(O,f,y,S){let H=arguments.length>4&&void 0!==arguments[4]&&arguments[4],h=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const v=this.getWorldMatrix(),N=b.g.Matrix[5];v.invertToRef(N);const m=b.g.fb[8];b.m.TransformCoordinatesFromFloatsToRef(O,f,y,N,m);const t=this.getClosestFacetAtLocalCoordinates(m.x,m.y,m.z,S,H,h);return S&&b.m.TransformCoordinatesFromFloatsToRef(S.x,S.y,S.z,v,S),t}getClosestFacetAtLocalCoordinates(O,f,y,S){let H=arguments.length>4&&void 0!==arguments[4]&&arguments[4],b=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],h=null,v=0,N=0,m=0,t=0,q=0,F=0,I=0,A=0;const J=this.getFacetLocalPositions(),X=this.getFacetLocalNormals(),w=this.getFacetsAtLocalCoordinates(O,f,y);if(!w)return null;let B,j,u,L=Number.MAX_VALUE,p=L;for(let U=0;U<w.length;U++)B=w[U],j=X[B],u=J[B],t=(O-u.x)*j.x+(f-u.y)*j.y+(y-u.z)*j.z,(!H||H&&b&&t>=0||H&&!b&&t<=0)&&(t=j.x*u.x+j.y*u.y+j.z*u.z,q=-(j.x*O+j.y*f+j.z*y-t)/(j.x*j.x+j.y*j.y+j.z*j.z),F=O+j.x*q,I=f+j.y*q,A=y+j.z*q,v=F-O,N=I-f,m=A-y,p=v*v+N*N+m*m,p<L&&(L=p,h=B,S&&(S.x=F,S.y=I,S.z=A)));return h}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const O=this._internalAbstractMeshDataInfo._facetData;return O.facetDataEnabled&&(O.facetDataEnabled=!1,O.facetPositions=[],O.facetNormals=[],O.facetPartitioning=new Array,O.facetParameters=null,O.depthSortedIndices=new Uint32Array(0)),this}updateIndices(O,f){return this}createNormals(O){const f=this.getVerticesData(h.f.PositionKind),y=this.Pf();let S;return S=this.isVerticesDataPresent(h.f.NormalKind)?this.getVerticesData(h.f.NormalKind):[],v.c.ComputeNormals(f,y,S,{useRightHandedSystem:this.va().useRightHandedSystem}),this.Ga(h.f.NormalKind,S,O),this}alignWithNormal(O,f){f||(f=w.c.Y);const y=b.g.fb[0],S=b.g.fb[1];return b.m.CrossToRef(f,O,S),b.m.CrossToRef(O,S,y),this.rotationQuaternion?b.c.RotationQuaternionFromAxisToRef(y,O,S,this.rotationQuaternion):b.m.RotationFromAxisToRef(y,O,S,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,I.d)("EdgesRenderer")}enableEdgesRendering(O,f,y){throw(0,I.d)("EdgesRenderer")}pj(){return this._scene.oj.filter((O=>O.j===this))}}U.OCCLUSION_TYPE_NONE=0,U.OCCLUSION_TYPE_OPTIMISTIC=1,U.OCCLUSION_TYPE_STRICT=2,U.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,U.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,U.CULLINGSTRATEGY_STANDARD=0,U.Ci=1,U.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,U.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,S.b)([j.e.filter((function(){for(var O=arguments.length,f=new Array(O),y=0;y<O;y++)f[y]=arguments[y];let[S,H,b,h,v]=f;return!Array.isArray(S)&&!Array.isArray(H)&&!Array.isArray(b)&&!Array.isArray(h)&&!Array.isArray(v)}))],U,"_ApplySkeleton",null),(0,B.g)("BABYLON.AbstractMesh",U)},11585:(O,f,y)=>{"use strict";y.d(f,{e:()=>X});var S=y(11324),H=y(11359),b=y(11577),h=y(11392),v=y(11458),N=y(11588),m=y(11466),t=y(10995),q=y(11317),F=y(11484),I=y(11042),A=y(11526),J=y(11017);class X{get boundingBias(){return this._boundingBias}set boundingBias(O){this._boundingBias?this._boundingBias.p(O):this._boundingBias=O.clone(),this.Ea(!0,null)}static CreateGeometryForMesh(O){const f=new X(X.RandomId(),O.va());return f.Ca(O),f}get meshes(){return this._meshes}constructor(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=f||I.c.LastCreatedScene,this._scene&&(this.id=O,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=S,y?this.setAllVerticesData(y,S):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),H&&(this.Ca(H),H.Mj(!0)))}get extend(){return this._extend}va(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let O=0;O<this._meshes.length;O++)if(!this._meshes[O].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const O=new Set;for(const f in this._vertexBuffers)O.add(this._vertexBuffers[f].getWrapperBuffer());O.forEach((O=>{O._rebuild()}))}setAllVerticesData(O,f){O.applyToGeometry(this,f),this._notifyUpdate()}Ga(O,f){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3?arguments[3]:void 0;y&&Array.isArray(f)&&(f=new Float32Array(f));const H=new h.f(this._engine,f,O,{updatable:y,postponeInternalCreation:0===this._meshes.length,stride:S,label:"Geometry_"+this.id+"_"+O});this.setVerticesBuffer(H)}removeVerticesData(O){this._vertexBuffers[O]&&(this._vertexBuffers[O].dispose(),delete this._vertexBuffers[O]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const H=O.getKind();this._vertexBuffers[H]&&y&&this._vertexBuffers[H].dispose(),O._buffer&&O._buffer._increaseReferences(),this._vertexBuffers[H]=O;const b=this._meshes,v=b.length;if(H===h.f.PositionKind){this._totalVertices=f??O._maxVerticesCount,this._updateExtend(O.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const y=this._extend&&this._extend.minimum||new S.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),H=this._extend&&this._extend.maximum||new S.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let O=0;O<v;O++){const f=b[O];f.buildBoundingInfo(y,H),f._createGlobalSubMesh(f.isUnIndexed),f.Mj(!0),f.synchronizeInstances()}}this._notifyUpdate(H)}updateVerticesDataDirectly(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const H=this.getVertexBuffer(O);H&&(H.updateDirectly(f,y,S),this._notifyUpdate(O))}updateVerticesData(O,f){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S=this.getVertexBuffer(O);S&&(S.update(f),O===h.f.PositionKind&&this.Ea(y,f),this._notifyUpdate(O))}Ea(O,f){if(O&&this._updateExtend(f),this._resetPointsArrayCache(),O){const O=this._meshes;for(const f of O){f.hasBoundingInfo?f.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):f.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const O=f.Yf;for(const f of O)f.refreshBoundingInfo()}}}_bind(O,f,y,S){if(!O)return;void 0===f&&(f=this._indexBuffer);const H=this.getVertexBuffers();if(!H)return;if(f!=this._indexBuffer||!this._vertexArrayObjects&&!S)return void this._engine.bindBuffers(H,f,O,y);const b=S||this._vertexArrayObjects,h=this._engine;b[O.key]||(b[O.key]=h.recordVertexArrayObject(H,f,O,y)),h.bindVertexArrayObject(b[O.key],f)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(O,f,y){const S=this.getVertexBuffer(O);return S?S.getFloatData(this._totalVertices,y||f&&1!==this._meshes.length):null}copyVerticesData(O,f){const y=this.getVertexBuffer(O);if(!y)return;f[O]||(f[O]=new Float32Array(this._totalVertices*y.getSize()));const S=y.getData();S&&function(O,f,y,S,H,b,v,N){const m=f*h.f.GetTypeByteLength(y),t=v*f;if(N.length!==t)throw new Error("Output length is not valid");if(y===h.f.FLOAT&&H===m)if(O instanceof Array){const f=S/4;N.set(O,f)}else if(O instanceof ArrayBuffer){const f=new Float32Array(O,S,t);N.set(f)}else{const f=O.byteOffset+S;if(f%4)return J.e.Warn("CopyFloatData: copied misaligned data."),void N.set(new Float32Array(O.buffer.slice(f,f+4*t)));const y=new Float32Array(O.buffer,f,t);N.set(y)}else h.f.ForEach(O,S,H,f,y,t,b,((O,f)=>N[f]=O))}(S,y.getSize(),y.type,y.byteOffset,y.byteStride,y.normalized,this._totalVertices,f[O])}isVertexBufferUpdatable(O){const f=this._vertexBuffers[O];return!!f&&f.isUpdatable()}getVertexBuffer(O){return this.isReady()?this._vertexBuffers[O]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(O){return this._vertexBuffers?void 0!==this._vertexBuffers[O]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(O)}getVerticesDataKinds(){const O=[];let f;if(!this._vertexBuffers&&this._delayInfo)for(f in this._delayInfo)O.push(f);else for(f in this._vertexBuffers)O.push(f);return O}updateIndices(O,f){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const S=O.length!==this._indices.length;if(y||(this._indices=O.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,O,f),S)for(const O of this._meshes)O._createGlobalSubMesh(!0)}else this.setIndices(O,null,!0)}setIndexBuffer(O,f,y){this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=O,this._totalVertices=f,this._totalIndices=y,O.is32Bits||(O.is32Bits=this._totalIndices>65535);for(const S of this._meshes)S._createGlobalSubMesh(!0),S.synchronizeInstances();this._notifyUpdate()}setIndices(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=O,this._indexBufferIsUpdatable=y,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,y,"Geometry_"+this.id+"_IndexBuffer")),void 0!=f&&(this._totalVertices=f);for(const H of this._meshes)H._createGlobalSubMesh(!S),H.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}Pf(O,f){if(!this.isReady())return null;const y=this._indices;return f||O&&1!==this._meshes.length?y.slice():y}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;O&&this._vertexArrayObjects&&this._vertexArrayObjects[O.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[O.key]),delete this._vertexArrayObjects[O.key])}releaseForMesh(O,f){const y=this._meshes,S=y.indexOf(O);-1!==S&&(y.splice(S,1),this._vertexArrayObjects&&O._invalidateInstanceVertexArrayObject(),O._geometry=null,0===y.length&&f&&this.dispose())}Ca(O){if(O._geometry===this)return;const f=O._geometry;f&&f.releaseForMesh(O),this._vertexArrayObjects&&O._invalidateInstanceVertexArrayObject();const y=this._meshes;O._geometry=this,O._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),y.push(O),this.isReady()?this._applyToMesh(O):this._boundingInfo&&O.setBoundingInfo(this._boundingInfo)}_updateExtend(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!O&&(O=this.getVerticesData(h.f.PositionKind),!O))return;this._extend=(0,F.f)(O,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(O){const f=this._meshes.length;for(const y in this._vertexBuffers)1===f&&this._vertexBuffers[y].create(),y===h.f.PositionKind&&(this._extend||this._updateExtend(),O.buildBoundingInfo(this._extend.minimum,this._extend.maximum),O._createGlobalSubMesh(O.isUnIndexed),O.Ea());1===f&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),O._syncGeometryWithMorphTargetManager(),O.synchronizeInstances()}_notifyUpdate(O){this.onGeometryUpdated&&this.onGeometryUpdated(this,O),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const f of this._meshes)f._markSubMeshesAsAttributesDirty()}load(O,f){2!==this.delayLoadState&&(this.isReady()?f&&f():(this.delayLoadState=2,this._queueLoad(O,f)))}_queueLoad(O,f){this.delayLoadingFile&&(O.addPendingData(this),O._loadFile(this.delayLoadingFile,(y=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(y),this),this.delayLoadState=1,this._delayInfo=[],O.removePendingData(this);const S=this._meshes,H=S.length;for(let O=0;O<H;O++)this._applyToMesh(S[O]);f&&f()}),void 0,!0))}toLeftHanded(){const O=this.Pf(!1);if(null!=O&&O.length>0){for(let f=0;f<O.length;f+=3){const y=O[f+0];O[f+0]=O[f+2],O[f+2]=y}this.setIndices(O)}const f=this.getVerticesData(h.f.PositionKind,!1);if(null!=f&&f.length>0){for(let O=0;O<f.length;O+=3)f[O+2]=-f[O+2];this.Ga(h.f.PositionKind,f,!1)}const y=this.getVerticesData(h.f.NormalKind,!1);if(null!=y&&y.length>0){for(let O=0;O<y.length;O+=3)y[O+2]=-y[O+2];this.Ga(h.f.NormalKind,y,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const O=this.getVerticesData(h.f.PositionKind);if(!O||0===O.length)return!1;for(let f=3*this._positionsCache.length,y=this._positionsCache.length;f<O.length;f+=3,++y)this._positionsCache[y]=S.m.Ng(O,f);for(let f=0,y=0;f<O.length;f+=3,++y)this._positionsCache[y].set(O[0+f],O[1+f],O[2+f]);return this._positionsCache.length=O.length/3,this._positions=this._positionsCache,!0}u(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const y in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[y]);this._vertexArrayObjects={};const O=this._meshes,f=O.length;for(let y=0;y<f;y++)O[y]._invalidateInstanceVertexArrayObject()}}dispose(){const O=this._meshes,f=O.length;let y;for(y=0;y<f;y++)this.releaseForMesh(O[y]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const S in this._vertexBuffers)this._vertexBuffers[S].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const O=this._parentContainer.geometries.indexOf(this);O>-1&&this._parentContainer.geometries.splice(O,1),this._parentContainer=null}this._isDisposed=!0}i(O){const f=new b.c;f.indices=[];const y=this.Pf();if(y)for(let b=0;b<y.length;b++)f.indices.push(y[b]);let S,H=!1,h=!1;for(S in this._vertexBuffers){const O=this.getVerticesData(S);if(O&&(O instanceof Float32Array?f.set(new Float32Array(O),S):f.set(O.slice(0),S),!h)){const O=this.getVertexBuffer(S);O&&(H=O.isUpdatable(),h=!H)}}const v=new X(O,this._scene,f,H);for(S in v.delayLoadState=this.delayLoadState,v.delayLoadingFile=this.delayLoadingFile,v._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)v._delayInfo=v._delayInfo||[],v._delayInfo.push(S);return v._boundingInfo=new m.e(this._extend.minimum,this._extend.maximum),v}serialize(){const O={};return O.id=this.id,O.uniqueId=this.uniqueId,O.updatable=this._updatable,q.d&&q.d.HasTags(this)&&(O.tags=q.d.GetTags(this)),O}_toNumberArray(O){return Array.isArray(O)?O:Array.prototype.slice.call(O)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const O in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,O)&&(this._vertexBuffers[O]._buffer._data=null)}serializeVerticeData(){const O=this.serialize();return this.isVerticesDataPresent(h.f.PositionKind)&&(O.xa=this._toNumberArray(this.getVerticesData(h.f.PositionKind)),this.isVertexBufferUpdatable(h.f.PositionKind)&&(O.xa._updatable=!0)),this.isVerticesDataPresent(h.f.NormalKind)&&(O.ya=this._toNumberArray(this.getVerticesData(h.f.NormalKind)),this.isVertexBufferUpdatable(h.f.NormalKind)&&(O.ya._updatable=!0)),this.isVerticesDataPresent(h.f.TangentKind)&&(O.tangents=this._toNumberArray(this.getVerticesData(h.f.TangentKind)),this.isVertexBufferUpdatable(h.f.TangentKind)&&(O.tangents._updatable=!0)),this.isVerticesDataPresent(h.f.UVKind)&&(O.Aa=this._toNumberArray(this.getVerticesData(h.f.UVKind)),this.isVertexBufferUpdatable(h.f.UVKind)&&(O.Aa._updatable=!0)),this.isVerticesDataPresent(h.f.UV2Kind)&&(O.uvs2=this._toNumberArray(this.getVerticesData(h.f.UV2Kind)),this.isVertexBufferUpdatable(h.f.UV2Kind)&&(O.uvs2._updatable=!0)),this.isVerticesDataPresent(h.f.UV3Kind)&&(O.uvs3=this._toNumberArray(this.getVerticesData(h.f.UV3Kind)),this.isVertexBufferUpdatable(h.f.UV3Kind)&&(O.uvs3._updatable=!0)),this.isVerticesDataPresent(h.f.UV4Kind)&&(O.uvs4=this._toNumberArray(this.getVerticesData(h.f.UV4Kind)),this.isVertexBufferUpdatable(h.f.UV4Kind)&&(O.uvs4._updatable=!0)),this.isVerticesDataPresent(h.f.UV5Kind)&&(O.uvs5=this._toNumberArray(this.getVerticesData(h.f.UV5Kind)),this.isVertexBufferUpdatable(h.f.UV5Kind)&&(O.uvs5._updatable=!0)),this.isVerticesDataPresent(h.f.UV6Kind)&&(O.uvs6=this._toNumberArray(this.getVerticesData(h.f.UV6Kind)),this.isVertexBufferUpdatable(h.f.UV6Kind)&&(O.uvs6._updatable=!0)),this.isVerticesDataPresent(h.f.ColorKind)&&(O.za=this._toNumberArray(this.getVerticesData(h.f.ColorKind)),this.isVertexBufferUpdatable(h.f.ColorKind)&&(O.za._updatable=!0)),this.isVerticesDataPresent(h.f.MatricesIndicesKind)&&(O.matricesIndices=this._toNumberArray(this.getVerticesData(h.f.MatricesIndicesKind)),O.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(h.f.MatricesIndicesKind)&&(O.matricesIndices._updatable=!0)),this.isVerticesDataPresent(h.f.MatricesWeightsKind)&&(O.matricesWeights=this._toNumberArray(this.getVerticesData(h.f.MatricesWeightsKind)),this.isVertexBufferUpdatable(h.f.MatricesWeightsKind)&&(O.matricesWeights._updatable=!0)),O.indices=this._toNumberArray(this.Pf()),O}static ExtractFromMesh(O,f){const y=O._geometry;return y?y.i(f):null}static RandomId(){return t.d.RandomId()}static _GetGeometryByLoadedUniqueId(O,f){for(let y=0;y<f.geometries.length;y++)if(f.geometries[y]._loadedUniqueId===O)return f.geometries[y];return null}static _ImportGeometry(O,f){const y=f.va(),S=O.geometryUniqueId,b=O.geometryId;if(S||b){const O=S?this._GetGeometryByLoadedUniqueId(S,y):y.getGeometryById(b);O&&O.Ca(f)}else if(O instanceof ArrayBuffer){const y=f._binaryInfo;if(y.positionsAttrDesc&&y.positionsAttrDesc.count>0){const S=new Float32Array(O,y.positionsAttrDesc.offset,y.positionsAttrDesc.count);f.Ga(h.f.PositionKind,S,!1)}if(y.normalsAttrDesc&&y.normalsAttrDesc.count>0){const S=new Float32Array(O,y.normalsAttrDesc.offset,y.normalsAttrDesc.count);f.Ga(h.f.NormalKind,S,!1)}if(y.tangetsAttrDesc&&y.tangetsAttrDesc.count>0){const S=new Float32Array(O,y.tangetsAttrDesc.offset,y.tangetsAttrDesc.count);f.Ga(h.f.TangentKind,S,!1)}if(y.uvsAttrDesc&&y.uvsAttrDesc.count>0){const S=new Float32Array(O,y.uvsAttrDesc.offset,y.uvsAttrDesc.count);if(A.b)for(let O=1;O<S.length;O+=2)S[O]=1-S[O];f.Ga(h.f.UVKind,S,!1)}if(y.uvs2AttrDesc&&y.uvs2AttrDesc.count>0){const S=new Float32Array(O,y.uvs2AttrDesc.offset,y.uvs2AttrDesc.count);if(A.b)for(let O=1;O<S.length;O+=2)S[O]=1-S[O];f.Ga(h.f.UV2Kind,S,!1)}if(y.uvs3AttrDesc&&y.uvs3AttrDesc.count>0){const S=new Float32Array(O,y.uvs3AttrDesc.offset,y.uvs3AttrDesc.count);if(A.b)for(let O=1;O<S.length;O+=2)S[O]=1-S[O];f.Ga(h.f.UV3Kind,S,!1)}if(y.uvs4AttrDesc&&y.uvs4AttrDesc.count>0){const S=new Float32Array(O,y.uvs4AttrDesc.offset,y.uvs4AttrDesc.count);if(A.b)for(let O=1;O<S.length;O+=2)S[O]=1-S[O];f.Ga(h.f.UV4Kind,S,!1)}if(y.uvs5AttrDesc&&y.uvs5AttrDesc.count>0){const S=new Float32Array(O,y.uvs5AttrDesc.offset,y.uvs5AttrDesc.count);if(A.b)for(let O=1;O<S.length;O+=2)S[O]=1-S[O];f.Ga(h.f.UV5Kind,S,!1)}if(y.uvs6AttrDesc&&y.uvs6AttrDesc.count>0){const S=new Float32Array(O,y.uvs6AttrDesc.offset,y.uvs6AttrDesc.count);if(A.b)for(let O=1;O<S.length;O+=2)S[O]=1-S[O];f.Ga(h.f.UV6Kind,S,!1)}if(y.colorsAttrDesc&&y.colorsAttrDesc.count>0){const S=new Float32Array(O,y.colorsAttrDesc.offset,y.colorsAttrDesc.count);f.Ga(h.f.ColorKind,S,!1,y.colorsAttrDesc.stride)}if(y.matricesIndicesAttrDesc&&y.matricesIndicesAttrDesc.count>0){const S=new Int32Array(O,y.matricesIndicesAttrDesc.offset,y.matricesIndicesAttrDesc.count),H=[];for(let O=0;O<S.length;O++){const f=S[O];H.push(255&f),H.push((65280&f)>>8),H.push((16711680&f)>>16),H.push(f>>24&255)}f.Ga(h.f.MatricesIndicesKind,H,!1)}if(y.matricesIndicesExtraAttrDesc&&y.matricesIndicesExtraAttrDesc.count>0){const S=new Int32Array(O,y.matricesIndicesExtraAttrDesc.offset,y.matricesIndicesExtraAttrDesc.count),H=[];for(let O=0;O<S.length;O++){const f=S[O];H.push(255&f),H.push((65280&f)>>8),H.push((16711680&f)>>16),H.push(f>>24&255)}f.Ga(h.f.MatricesIndicesExtraKind,H,!1)}if(y.matricesWeightsAttrDesc&&y.matricesWeightsAttrDesc.count>0){const S=new Float32Array(O,y.matricesWeightsAttrDesc.offset,y.matricesWeightsAttrDesc.count);f.Ga(h.f.MatricesWeightsKind,S,!1)}if(y.indicesAttrDesc&&y.indicesAttrDesc.count>0){const S=new Int32Array(O,y.indicesAttrDesc.offset,y.indicesAttrDesc.count);f.setIndices(S,null)}if(y.subMeshesAttrDesc&&y.subMeshesAttrDesc.count>0){const S=new Int32Array(O,y.subMeshesAttrDesc.offset,5*y.subMeshesAttrDesc.count);f.Yf=[];for(let O=0;O<y.subMeshesAttrDesc.count;O++){const y=S[5*O+0],H=S[5*O+1],b=S[5*O+2],h=S[5*O+3],N=S[5*O+4];v.b.AddToMesh(y,H,b,h,N,f)}}}else if(O.xa&&O.ya&&O.indices){if(f.Ga(h.f.PositionKind,O.xa,O.xa._updatable),f.Ga(h.f.NormalKind,O.ya,O.ya._updatable),O.tangents&&f.Ga(h.f.TangentKind,O.tangents,O.tangents._updatable),O.Aa&&f.Ga(h.f.UVKind,O.Aa,O.Aa._updatable),O.uvs2&&f.Ga(h.f.UV2Kind,O.uvs2,O.uvs2._updatable),O.uvs3&&f.Ga(h.f.UV3Kind,O.uvs3,O.uvs3._updatable),O.uvs4&&f.Ga(h.f.UV4Kind,O.uvs4,O.uvs4._updatable),O.uvs5&&f.Ga(h.f.UV5Kind,O.uvs5,O.uvs5._updatable),O.uvs6&&f.Ga(h.f.UV6Kind,O.uvs6,O.uvs6._updatable),O.za&&f.Ga(h.f.ColorKind,H.g.CheckColors4(O.za,O.xa.length/3),O.za._updatable),O.matricesIndices)if(O.matricesIndices._isExpanded)delete O.matricesIndices._isExpanded,f.Ga(h.f.MatricesIndicesKind,O.matricesIndices,O.matricesIndices._updatable);else{const y=[];for(let f=0;f<O.matricesIndices.length;f++){const S=O.matricesIndices[f];y.push(255&S),y.push((65280&S)>>8),y.push((16711680&S)>>16),y.push(S>>24&255)}f.Ga(h.f.MatricesIndicesKind,y,O.matricesIndices._updatable)}if(O.matricesIndicesExtra)if(O.matricesIndicesExtra._isExpanded)delete O.matricesIndices._isExpanded,f.Ga(h.f.MatricesIndicesExtraKind,O.matricesIndicesExtra,O.matricesIndicesExtra._updatable);else{const y=[];for(let f=0;f<O.matricesIndicesExtra.length;f++){const S=O.matricesIndicesExtra[f];y.push(255&S),y.push((65280&S)>>8),y.push((16711680&S)>>16),y.push(S>>24&255)}f.Ga(h.f.MatricesIndicesExtraKind,y,O.matricesIndicesExtra._updatable)}O.matricesWeights&&(X._CleanMatricesWeights(O,f),f.Ga(h.f.MatricesWeightsKind,O.matricesWeights,O.matricesWeights._updatable)),O.matricesWeightsExtra&&f.Ga(h.f.MatricesWeightsExtraKind,O.matricesWeightsExtra,O.matricesWeights._updatable),f.setIndices(O.indices,null)}if(O.Yf){f.Yf=[];for(let y=0;y<O.Yf.length;y++){const S=O.Yf[y];v.b.AddToMesh(S.materialIndex,S.verticesStart,S.verticesCount,S.indexStart,S.indexCount,f)}}f._shouldGenerateFlatShading&&(f.convertToFlatShadedMesh(),f._shouldGenerateFlatShading=!1),f.Mj(!0),y.onMeshImportedObservable.notifyObservers(f)}static _CleanMatricesWeights(O,f){const y=.001;if(!N.d.CleanBoneMatrixWeights)return;let S=0;if(!(O.skeletonId>-1))return;{const y=f.va().getLastSkeletonById(O.skeletonId);if(!y)return;S=y.bones.length}const H=f.getVerticesData(h.f.MatricesIndicesKind),b=f.getVerticesData(h.f.MatricesIndicesExtraKind),v=O.matricesWeights,m=O.matricesWeightsExtra,t=O.numBoneInfluencer,q=v.length;for(let h=0;h<q;h+=4){let O=0,f=-1;for(let S=0;S<4;S++){const H=v[h+S];O+=H,H<y&&f<0&&(f=S)}if(m)for(let S=0;S<4;S++){const H=m[h+S];O+=H,H<y&&f<0&&(f=S+4)}if((f<0||f>t-1)&&(f=t-1),O>y){const f=1/O;for(let O=0;O<4;O++)v[h+O]*=f;if(m)for(let O=0;O<4;O++)m[h+O]*=f}else f>=4?(m[h+f-4]=1-O,b[h+f-4]=S):(v[h+f]=1-O,H[h+f]=S)}f.Ga(h.f.MatricesIndicesKind,H),O.matricesWeightsExtra&&f.Ga(h.f.MatricesIndicesExtraKind,b)}static Parse(O,f,y){const H=new X(O.id,f,void 0,O.updatable);return H._loadedUniqueId=O.uniqueId,q.d&&q.d.AddTagsTo(H,O.tags),O.delayLoadingFile?(H.delayLoadState=4,H.delayLoadingFile=y+O.delayLoadingFile,H._boundingInfo=new m.e(S.m.Ng(O.boundingBoxMinimum),S.m.Ng(O.boundingBoxMaximum)),H._delayInfo=[],O.hasUVs&&H._delayInfo.push(h.f.UVKind),O.hasUVs2&&H._delayInfo.push(h.f.UV2Kind),O.hasUVs3&&H._delayInfo.push(h.f.UV3Kind),O.hasUVs4&&H._delayInfo.push(h.f.UV4Kind),O.hasUVs5&&H._delayInfo.push(h.f.UV5Kind),O.hasUVs6&&H._delayInfo.push(h.f.UV6Kind),O.hasColors&&H._delayInfo.push(h.f.ColorKind),O.hasMatricesIndices&&H._delayInfo.push(h.f.MatricesIndicesKind),O.hasMatricesWeights&&H._delayInfo.push(h.f.MatricesWeightsKind),H._delayLoadingFunction=b.c.ImportVertexData):b.c.ImportVertexData(O,H),f.pushGeometry(H,!0),H}}},12247:(O,f,y)=>{"use strict";y.d(f,{d:()=>F});var S=y(11324),H=y(11017),b=y(11593),h=y(11557),v=y(11019),N=y(11598),m=y(11392),t=y(10995),q=y(11153);h.d._instancedMeshFactory=(O,f)=>{const y=new F(O,f);if(f.instancedBuffers){y.instancedBuffers={};for(const O in f.instancedBuffers)y.instancedBuffers[O]=f.instancedBuffers[O]}return y};class F extends b.c{constructor(O,f){super(O,f.va()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,f.Ej(this),this._sourceMesh=f,this._unIndexed=f._unIndexed,this.position.p(f.position),this.rotation.p(f.rotation),this.Yd.p(f.Yd),f.rotationQuaternion&&(this.rotationQuaternion=f.rotationQuaternion.clone()),this.animations=f.animations.slice();for(const y of f.getAnimationRanges())null!=y&&this.createAnimationRange(y.name,y.from,y.to);this.infiniteDistance=f.infiniteDistance,this.setPivotMatrix(f.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(O){var f;(null===(f=this._sourceMesh)||void 0===f?void 0:f.receiveShadows)!==O&&t.d.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(O){var f;(null===(f=this._sourceMesh)||void 0===f?void 0:f.material)!==O&&t.d.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(O){var f;(null===(f=this._sourceMesh)||void 0===f?void 0:f.visibility)!==O&&t.d.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(O){var f;(null===(f=this._sourceMesh)||void 0===f?void 0:f.skeleton)!==O&&t.d.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(O){this._sourceMesh&&O!==this._sourceMesh.renderingGroupId&&H.e.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}createInstance(O){return this._sourceMesh.createInstance(O)}isReady(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(O,!0)}getVerticesData(O,f,y){return this._sourceMesh.getVerticesData(O,f,y)}copyVerticesData(O,f){this._sourceMesh.copyVerticesData(O,f)}Ga(O,f,y,S){return this.sourceMesh&&this.sourceMesh.Ga(O,f,y,S),this.sourceMesh}updateVerticesData(O,f,y,S){return this.sourceMesh&&this.sourceMesh.updateVerticesData(O,f,y,S),this.sourceMesh}setIndices(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(O,f),this.sourceMesh}isVerticesDataPresent(O){return this._sourceMesh.isVerticesDataPresent(O)}Pf(){return this._sourceMesh.Pf()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let O,f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;O="object"===typeof f?f:{applySkeleton:f,applyMorph:y};const S=this._sourceMesh.Bj?this._sourceMesh.Bj.boundingBias:null;return this.Fa(this._sourceMesh._getData(O,null,m.f.PositionKind),S),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(O,f){if(super._activate(O,f),this._sourceMesh.Yf||H.e.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,O),f){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==N.b.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new S.b);const O=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,S.g.fb[7].p(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.p(this._currentLOD.Mj(!0)),this._currentLOD.position.p(S.g.fb[7]),this._currentLOD._masterMesh=O,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(O){if(!O)return this;const f=this.sourceMesh.getLODLevels();if(f&&0!==f.length){const f=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(O,f.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(O){return this.sourceMesh._preActivateForIntermediateRendering(O)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.Yf)for(let O=0;O<this._sourceMesh.Yf.length;O++)this._sourceMesh.Yf[O].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Ea(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2?arguments[2]:void 0;const S=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).createInstance(O);if(v.e.DeepCopy(this,S,["name","Yf","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","nj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),f&&(S.parent=f),!y)for(let H=0;H<this.va().meshes.length;H++){const O=this.va().meshes[H];O.parent===this&&O.clone(O.name,S)}return S.Mj(!0),this.onClonedObservable.notifyObservers(S),S}dispose(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.Dj(this),super.dispose(O,f)}_serializeAsParent(O){super._serializeAsParent(O),O.parentId=this._sourceMesh.uniqueId,O.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,f=arguments.length>1?arguments[1]:void 0,y=arguments.length>2?arguments[2]:void 0;const S=this.clone("Clone of "+(this.name||this.id),O||this.parent,!0,f&&f.newSourcedMesh);S&&y&&y(this,S);for(const H of this.getChildTransformNodes(!0))H.instantiateHierarchy(S,f,y);return S}}h.d.prototype.registerInstancedBuffer=function(O,f){var y,S;if(null===(y=this._userInstancedBuffersStorage)||void 0===y||null===(S=y.vertexBuffers[O])||void 0===S||S.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const O of this.instances)O.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[O]=null,this._userInstancedBuffersStorage.strides[O]=f,this._userInstancedBuffersStorage.sizes[O]=32*f,this._userInstancedBuffersStorage.data[O]=new Float32Array(this._userInstancedBuffersStorage.sizes[O]),this._userInstancedBuffersStorage.vertexBuffers[O]=new m.f(this.getEngine(),this._userInstancedBuffersStorage.data[O],O,!0,!1,f,!0);for(const H of this.instances)H.instancedBuffers[O]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},h.d.prototype._processInstancedBuffers=function(O,f){const y=O?O.length:0;for(const S in this.instancedBuffers){let H=this._userInstancedBuffersStorage.sizes[S];const b=this._userInstancedBuffersStorage.strides[S],h=(y+1)*b;for(;H<h;)H*=2;this._userInstancedBuffersStorage.data[S].length!=H&&(this._userInstancedBuffersStorage.data[S]=new Float32Array(H),this._userInstancedBuffersStorage.sizes[S]=H,this._userInstancedBuffersStorage.vertexBuffers[S]&&(this._userInstancedBuffersStorage.vertexBuffers[S].dispose(),this._userInstancedBuffersStorage.vertexBuffers[S]=null));const v=this._userInstancedBuffersStorage.data[S];let N=0;if(f){const O=this.instancedBuffers[S];O.toArray?O.toArray(v,N):O.copyToArray?O.copyToArray(v,N):v[N]=O,N+=b}for(let f=0;f<y;f++){const y=O[f].instancedBuffers[S];y.toArray?y.toArray(v,N):y.copyToArray?y.copyToArray(v,N):v[N]=y,N+=b}this._userInstancedBuffersStorage.vertexBuffers[S]?this._userInstancedBuffersStorage.vertexBuffers[S].updateDirectly(v,0):(this._userInstancedBuffersStorage.vertexBuffers[S]=new m.f(this.getEngine(),this._userInstancedBuffersStorage.data[S],S,!0,!1,b,!0),this._invalidateInstanceVertexArrayObject())}},h.d.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const O in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[O]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},h.d.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const O in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[O]&&this._userInstancedBuffersStorage.vertexBuffers[O].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,q.g)("BABYLON.InstancedMesh",F)},11557:(O,f,y)=>{"use strict";y.d(f,{d:()=>V,g:()=>W});var S=y(11004),H=y(10995),b=y(11019),h=y(11317),v=y(11559),N=y(11561),m=y(11324),t=y(11359),q=y(11568),F=y(11392),I=y(11577),A=y(11585),J=y(11593),X=y(11458),w=y(11455),B=y(11615),j=y(11588),u=y(11362),L=y(11017),p=y(11153),U=y(11030),l=y(11402);class x{constructor(O,f){this.distanceOrScreenCoverage=O,this.mesh=f}}class W{}class E{constructor(){this.visibleInstances={},this.batchCache=new o,this.batchCacheReplacementModeInFrozenMode=new o,this.instancesBufferSize=2048}}class o{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class i{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class D{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}class V extends J.c{static _GetDefaultSideOrientation(O){return O||V.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(O){this._internalMeshDataInfo._useLODScreenCoverage=O,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(O){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==O&&(O&&this._internalMeshDataInfo._sourcePositions&&(this.Ga(F.f.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.Ga(F.f.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=O,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new S.d),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new S.d),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new S.d),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new S.d),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new S.d),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(O){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(O)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(O){this._internalMeshDataInfo._forcedInstanceCount=O}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(O){this._internalMeshDataInfo._sideOrientation=O,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===O||!this._scene.useRightHandedSystem&&0===O}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(O){this.sideOrientation=O,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(O){this._internalMeshDataInfo._overrideRenderingFillMode=O}get material(){return this._internalAbstractMeshDataInfo._material}set material(O){O&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(O.sideOrientation=null),this._setMaterial(O)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(O){this._unIndexed!==O&&(this._unIndexed=O,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(O){this._instanceDataStorage.manualUpdate=O}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(O){this._instanceDataStorage.previousManualUpdate=O}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(O){this._instanceDataStorage.forceMatrixUpdates=O}_copySource(O,f){let y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const S=this.va();if(O._geometry&&O._geometry.Ca(this),b.e.DeepCopy(O,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","Bj","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","nj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=O,S.useClonedMeshMap&&(O._internalMeshDataInfo.meshMap||(O._internalMeshDataInfo.meshMap={}),O._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=O._originalBuilderSideOrientation,this._creationDataStorage=O._creationDataStorage,O._ranges){const f=O._ranges;for(const O in f)Object.prototype.hasOwnProperty.call(f,O)&&f[O]&&this.createAnimationRange(O,f[O].from,f[O].to)}if(O.metadata&&O.metadata.clone?this.metadata=O.metadata.clone():this.metadata=O.metadata,this._internalMetadata=O._internalMetadata,h.d&&h.d.HasTags(O)&&h.d.AddTagsTo(this,h.d.GetTags(O,!0)),this.$b(O.isEnabled(!1)),this.parent=O.parent,this.setPivotMatrix(O.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+O.id,this.material=O.material,!f){const f=O.getDescendants(!0);for(let O=0;O<f.length;O++){const y=f[O];y.clone&&y.clone(this.name+"."+y.name,this)}}if(O.morphTargetManager&&(this.morphTargetManager=O.morphTargetManager),S.getPhysicsEngine){const f=S.getPhysicsEngine();if(y&&f)if(1===f.getPluginVersion()){const y=f.getImpostorForPhysicsObject(O);y&&(this.physicsImpostor=y.clone(this))}else 2===f.getPluginVersion()&&O.physicsBody&&O.physicsBody.clone(this)}for(let H=0;H<S.oj.length;H++){const f=S.oj[H];f.j===O&&f.clone(f.name,this)}this.skeleton=O.skeleton,this.refreshBoundingInfo(!0,!0),this.Mj(!0)}constructor(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>4?arguments[4]:void 0,h=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(O,f),this._internalMeshDataInfo=new D,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new E,this._thinInstanceDataStorage=new i,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=V.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,f=this.va(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(O,f,y)=>{O&&y&&(this._uniformBuffer?this.transferToEffect(f):y.bindOnlyWorldMatrix(f))},H&&this._copySource(H,b,h),null!==y&&(this.parent=y),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=O=>{O.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new S.d(this._internalMeshDataInfo._onMeshReadyObserverAdded),H&&H.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,f=arguments.length>1?arguments[1]:void 0,y=arguments.length>2?arguments[2]:void 0;const S=0===this.getTotalVertices()||f&&f.doNotInstantiate&&(!0===f.doNotInstantiate||f.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),O||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));S.parent=O||this.parent,S.position=this.position.clone(),S.Yd=this.Yd.clone(),this.rotationQuaternion?S.rotationQuaternion=this.rotationQuaternion.clone():S.rotation=this.rotation.clone(),y&&y(this,S);for(const H of this.getChildTransformNodes(!0))"InstancedMesh"===H.getClassName()&&"Mesh"===S.getClassName()&&H.sourceMesh===this?H.instantiateHierarchy(S,{doNotInstantiate:f&&f.doNotInstantiate||!1,newSourcedMesh:S},y):H.instantiateHierarchy(S,f,y);return S}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(O){let f=super.toString(O);if(f+=", n vertices: "+this.getTotalVertices(),f+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let y=0;y<this.animations.length;y++)f+=", animation[0]: "+this.animations[y].toString(O);if(O)if(this._geometry){const O=this.Pf(),y=this.getVerticesData(F.f.PositionKind);y&&O&&(f+=", flat shading: "+(y.length/3===O.length?"YES":"NO"))}else f+=", flat shading: UNKNOWN";return f}_unBindEffect(){super._unBindEffect();for(const O of this.instances)O._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const O=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((f,y)=>f.distanceOrScreenCoverage<y.distanceOrScreenCoverage?O:f.distanceOrScreenCoverage>y.distanceOrScreenCoverage?-O:0))}addLODLevel(O,f){if(f&&f._masterMesh)return L.e.Warn("You cannot use a mesh as LOD level twice"),this;const y=new x(O,f);return this._internalMeshDataInfo._LODLevels.push(y),f&&(f._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(O){const f=this._internalMeshDataInfo;for(let y=0;y<f._LODLevels.length;y++){const S=f._LODLevels[y];if(S.distanceOrScreenCoverage===O)return S.mesh}return null}removeLODLevel(O){const f=this._internalMeshDataInfo;for(let y=0;y<f._LODLevels.length;y++)f._LODLevels[y].mesh===O&&(f._LODLevels.splice(y,1),O&&(O._masterMesh=null));return this._sortLODLevels(),this}getLOD(O,f){const y=this._internalMeshDataInfo;if(!y._LODLevels||0===y._LODLevels.length)return this;const S=f||this.getBoundingInfo().boundingSphere,H=O.mode===N.c.ORTHOGRAPHIC_CAMERA?O.Ui:S.centerWorld.xc(O.globalPosition).length();let b=H,h=1;if(y._useLODScreenCoverage){const f=O.screenArea;let y=S.radiusWorld*O.Ui/H;y=y*y*Math.PI,b=y/f,h=-1}if(h*y._LODLevels[y._LODLevels.length-1].distanceOrScreenCoverage>h*b)return this.onLODLevelSelection&&this.onLODLevelSelection(b,this,this),this;for(let v=0;v<y._LODLevels.length;v++){const O=y._LODLevels[v];if(h*O.distanceOrScreenCoverage<h*b){if(O.mesh){if(4===O.mesh.delayLoadState)return O.mesh._checkDelayState(),this;if(2===O.mesh.delayLoadState)return this;O.mesh._preActivate(),O.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(b,this,O.mesh),O.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(b,this,this),this}get Bj(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(O,f,y,S){var H,b;if(!this._geometry)return null;let h=S||null===(H=this._userInstancedBuffersStorage)||void 0===H||null===(b=H.vertexBuffers[O])||void 0===b?void 0:b.getFloatData(this.instances.length+1,y||f&&1!==this._geometry.meshes.length);return h||(h=this._geometry.getVerticesData(O,f,y)),h}copyVerticesData(O,f){this._geometry&&this._geometry.copyVerticesData(O,f)}getVertexBuffer(O,f){var y;return this._geometry?(f||null===(y=this._userInstancedBuffersStorage)||void 0===y?void 0:y.vertexBuffers[O])??this._geometry.getVertexBuffer(O):null}isVerticesDataPresent(O,f){var y;return this._geometry?!f&&void 0!==(null===(y=this._userInstancedBuffersStorage)||void 0===y?void 0:y.vertexBuffers[O])||this._geometry.isVerticesDataPresent(O):!!this._delayInfo&&-1!==this._delayInfo.indexOf(O)}isVertexBufferUpdatable(O,f){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(O);if(!f){var y;const f=null===(y=this._userInstancedBuffersStorage)||void 0===y?void 0:y.vertexBuffers[O];if(f)return f.isUpdatable()}return this._geometry.isVertexBufferUpdatable(O)}getVerticesDataKinds(O){if(!this._geometry){const O=[];return this._delayInfo&&this._delayInfo.forEach((function(f){O.push(f)})),O}const f=this._geometry.getVerticesDataKinds();if(!O&&this._userInstancedBuffersStorage)for(const y in this._userInstancedBuffersStorage.vertexBuffers)-1===f.indexOf(y)&&f.push(y);return f}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}Pf(O,f){return this._geometry?this._geometry.Pf(O,f):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(O))return!1;if(!this.Yf||0===this.Yf.length)return!0;if(!O)return!0;const y=this.getEngine(),S=this.va(),H=f||y.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.Mj();const b=this.material||S.defaultMaterial;if(b)if(b._storeEffectOnSubMeshes)for(const F of this.Yf){const O=F.Ha();if(O)if(O._storeEffectOnSubMeshes){if(!O.isReadyForSubMesh(this,F,H))return!1}else if(!O.isReady(this,H))return!1}else if(!b.isReady(this,H))return!1;const h=y.currentRenderPassId;for(const F of this.lightSources){const O=F.getShadowGenerators();if(!O)continue;const f=O.values();for(let S=f.next();!0!==S.done;S=f.next()){var v,N,m,t;const O=S.value;if(O&&(null===(v=O.getShadowMap())||void 0===v||!v.renderList||null!==(N=O.getShadowMap())&&void 0!==N&&N.renderList&&-1!==(null===(m=O.getShadowMap())||void 0===m||null===(t=m.renderList)||void 0===t?void 0:t.indexOf(this)))){const f=O.getShadowMap().renderPassIds??[y.currentRenderPassId];for(let S=0;S<f.length;++S){y.currentRenderPassId=f[S];for(const f of this.Yf){var q;if(!O.isReady(f,H,(null===(q=f.Ha())||void 0===q?void 0:q.needAlphaBlendingForMesh(this))??!1))return y.currentRenderPassId=h,!1}}y.currentRenderPassId=h}}}for(const F of this._internalMeshDataInfo._LODLevels)if(F.mesh&&!F.mesh.isReady(H))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}Dh(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(O){this._instanceDataStorage.overridenInstanceCount=O}_preActivate(){const O=this._internalMeshDataInfo,f=this.va().getRenderId();return O._preActivateId===f||(O._preActivateId=f,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(O){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=O),this}_registerInstanceForRenderId(O,f){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:f,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[f]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=f,this._instanceDataStorage.visibleInstances[f]=new Array),this._instanceDataStorage.visibleInstances[f].push(O),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.Da||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let O,f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;O="object"===typeof f?f:{applySkeleton:f,applyMorph:y};const S=this.Bj?this.Bj.boundingBias:null;return this.Fa(this._getData(O,null,F.f.PositionKind),S),this}_createGlobalSubMesh(O){const f=this.getTotalVertices();if(!f||!this.Pf())return null;if(this.Yf&&this.Yf.length>0){const y=this.Pf();if(!y)return null;const S=y.length;let H=!1;if(O)H=!0;else for(const O of this.Yf){if(O.indexStart+O.indexCount>S){H=!0;break}if(O.verticesStart+O.verticesCount>f){H=!0;break}}if(!H)return this.Yf[0]}return this.releaseSubMeshes(),new X.b(0,0,f,0,this.getTotalIndices(),this)}subdivide(O){if(O<1)return;const f=this.getTotalIndices();let y=f/O|0,S=0;for(;y%3!==0;)y++;this.releaseSubMeshes();for(let H=0;H<O&&!(S>=f);H++)X.b.CreateFromIndices(0,S,H===O-1?f-S:y,this,void 0,!1),S+=y;this.refreshBoundingInfo(),this.synchronizeInstances()}Ga(O,f){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.Ga(O,f,y,S);else{const S=new I.c;S.set(f,O);const H=this.va();new A.e(A.e.RandomId(),H,S,y,this)}return this}removeVerticesData(O){this._geometry&&this._geometry.removeVerticesData(O)}markVerticesDataAsUpdatable(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const y=this.getVertexBuffer(O);y&&y.isUpdatable()!==f&&this.Ga(O,this.getVerticesData(O),f)}setVerticesBuffer(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=A.e.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(O,null,f),this}updateVerticesData(O,f,y,S){return this._geometry?(S?(this.makeGeometryUnique(),this.updateVerticesData(O,f,y,!1)):this._geometry.updateVerticesData(O,f,y),this):this}updateMeshPositions(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const y=this.getVerticesData(F.f.PositionKind);if(!y)return this;if(O(y),this.updateVerticesData(F.f.PositionKind,y,!1,!1),f){const O=this.Pf(),f=this.getVerticesData(F.f.NormalKind);if(!f)return this;I.c.ComputeNormals(y,O,f),this.updateVerticesData(F.f.NormalKind,f,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const O=this._geometry,f=this._geometry.i(A.e.RandomId());return O.releaseForMesh(this,!0),f.Ca(this),this}setIndexBuffer(O,f,y){let S=this._geometry;S||(S=new A.e(A.e.RandomId(),this.va(),void 0,void 0,this)),S.setIndexBuffer(O,f,y)}setIndices(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(O,f,y,S);else{const f=new I.c;f.indices=O;const S=this.va();new A.e(A.e.RandomId(),S,f,y,this)}return this}updateIndices(O,f){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(O,f,y),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(O,f,y){let S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const H=this.va().getEngine();let b;if(this._unIndexed)if(this._getRenderingFillMode(y)===w.c.WireFrameFillMode)b=O._getLinesIndexBuffer(this.Pf(),H);else b=null;else switch(this._getRenderingFillMode(y)){case w.c.PointFillMode:b=null;break;case w.c.WireFrameFillMode:b=O._getLinesIndexBuffer(this.Pf(),H);break;default:case w.c.TriangleFillMode:b=this._geometry.getIndexBuffer()}return this._bindDirect(f,b,S)}_bindDirect(O,f){let y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(O),y&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(O,f,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(O,f),this):this}_draw(O,f,y){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const S=this.va().getEngine();return this._unIndexed&&f!==w.c.WireFrameFillMode||f==w.c.PointFillMode?S.drawArraysType(f,O.verticesStart,O.verticesCount,this.forcedInstanceCount||y):f==w.c.WireFrameFillMode?S.drawElementsType(f,0,O._linesIndexCount,this.forcedInstanceCount||y):S.drawElementsType(f,O.indexStart,O.indexCount,this.forcedInstanceCount||y),this}registerBeforeRender(O){return this.onBeforeRenderObservable.add(O),this}unregisterBeforeRender(O){return this.onBeforeRenderObservable.removeCallback(O),this}registerAfterRender(O){return this.onAfterRenderObservable.add(O),this}unregisterAfterRender(O){return this.onAfterRenderObservable.removeCallback(O),this}_getInstancesRenderList(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(f)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[O]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[O]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const y=this.va(),S=y._isInIntermediateRendering(),H=S?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,b=this._instanceDataStorage.batchCache;if(b.mustReturn=!1,b.renderSelf[O]=f||!H&&this.isEnabled()&&this.isVisible,b.visibleInstances[O]=null,this._instanceDataStorage.visibleInstances&&!f){const f=this._instanceDataStorage.visibleInstances,H=y.getRenderId(),h=S?f.intermediateDefaultRenderId:f.defaultRenderId;b.visibleInstances[O]=f[H],!b.visibleInstances[O]&&h&&(b.visibleInstances[O]=f[h])}return b.hardwareInstancedRendering[O]=!f&&this._instanceDataStorage.hardwareInstancedRendering&&null!==b.visibleInstances[O]&&void 0!==b.visibleInstances[O],this._instanceDataStorage.previousBatch=b,b}_renderWithInstances(O,f,y,S,H){const b=y.visibleInstances[O._id],h=b?b.length:0,v=this._instanceDataStorage,N=v.instancesBufferSize;let t=v.instancesBuffer,q=v.instancesPreviousBuffer;const I=16*(h+1)*4;for(;v.instancesBufferSize<I;)v.instancesBufferSize*=2;v.instancesData&&N==v.instancesBufferSize||(v.instancesData=new Float32Array(v.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!v.instancesPreviousData||N!=v.instancesBufferSize)&&(v.instancesPreviousData=new Float32Array(v.instancesBufferSize/4));let A=0,J=0;const X=y.renderSelf[O._id],w=!t||N!==v.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!v.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||v.isFrozen&&!w)J=(X?1:0)+h;else{const f=this.getWorldMatrix();if(X&&(this._scene.needsPreviousWorldMatrices&&(v.masterMeshPreviousWorldMatrix?(v.masterMeshPreviousWorldMatrix.copyToArray(v.instancesPreviousData,A),v.masterMeshPreviousWorldMatrix.p(f)):(v.masterMeshPreviousWorldMatrix=f.clone(),v.masterMeshPreviousWorldMatrix.copyToArray(v.instancesPreviousData,A))),f.copyToArray(v.instancesData,A),A+=16,J++),b){var B;if(V.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(B=O.Ha())&&void 0!==B&&B.needAlphaBlendingForMesh(O.getRenderingMesh())){const O=this._scene.activeCamera.globalPosition;for(let f=0;f<b.length;f++){const y=b[f];y._distanceToCamera=m.m.Distance(y.getBoundingInfo().boundingSphere.centerWorld,O)}b.sort(((O,f)=>O._distanceToCamera>f._distanceToCamera?-1:O._distanceToCamera<f._distanceToCamera?1:0))}for(let O=0;O<b.length;O++){const f=b[O],y=f.getWorldMatrix();y.copyToArray(v.instancesData,A),this._scene.needsPreviousWorldMatrices&&(f._previousWorldMatrix?(f._previousWorldMatrix.copyToArray(v.instancesPreviousData,A),f._previousWorldMatrix.p(y)):(f._previousWorldMatrix=y.clone(),f._previousWorldMatrix.copyToArray(v.instancesPreviousData,A))),A+=16,J++}}}return w?(t&&t.dispose(),q&&q.dispose(),t=new F.d(H,v.instancesData,!0,16,!1,!0),v.instancesBuffer=t,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=t.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=t.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=t.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=t.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(q=new F.d(H,v.instancesPreviousData,!0,16,!1,!0),v.instancesPreviousBuffer=q,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=q.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=q.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=q.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=q.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(t.updateDirectly(v.instancesData,0,J),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||q.updateDirectly(v.instancesPreviousData,0,J)),this._processInstancedBuffers(b,X),this.va()._activeIndices.addCount(O.indexCount*J,!1),H._currentDrawContext&&(H._currentDrawContext.useInstancing=!0),this._bind(O,S,f),this._draw(O,f,J),!this._scene.needsPreviousWorldMatrices||w||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||q.updateDirectly(v.instancesData,0,J),H.unbindInstanceAttributes(),this}_renderWithThinInstances(O,f,y,S){var H;const b=(null===(H=this._thinInstanceDataStorage)||void 0===H?void 0:H.instancesCount)??0;this.va()._activeIndices.addCount(O.indexCount*b,!1),S._currentDrawContext&&(S._currentDrawContext.useInstancing=!0),this._bind(O,y,f),this._draw(O,f,b),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,b):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),S.unbindInstanceAttributes()}_processInstancedBuffers(O,f){}_processRendering(O,f,y,S,H,b,h,v){const N=this.va(),m=N.getEngine();if(S=this._getRenderingFillMode(S),b&&f.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(f,S,y,m),this;if(b)this._renderWithInstances(f,S,H,y,m);else{m._currentDrawContext&&(m._currentDrawContext.useInstancing=!1);let y=0;H.renderSelf[f._id]&&(h&&h(!1,O.getWorldMatrix(),v),y++,this._draw(f,S,this._instanceDataStorage.overridenInstanceCount));const b=H.visibleInstances[f._id];if(b){const O=b.length;y+=O;for(let y=0;y<O;y++){const O=b[y].getWorldMatrix();h&&h(!0,O,v),this._draw(f,S)}}N._activeIndices.addCount(f.indexCount*y,!1)}return this}_rebuild(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(O&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const f in this._userInstancedBuffersStorage.vertexBuffers){const y=this._userInstancedBuffersStorage.vertexBuffers[f];y&&(O&&y.dispose(),this._userInstancedBuffersStorage.vertexBuffers[f]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(O)}_freeze(){if(this.Yf){for(let O=0;O<this.Yf.length;O++)this._getInstancesRenderList(O);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(O,f,y,S){let H=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const b=this._scene.getEngine(),h=b.currentRenderPassId;if(void 0!==O&&(b.currentRenderPassId=O),S)(!H||H&&S.isInFrustum(this._scene._frustumPlanes))&&this.render(S,!!f,y);else for(let v=0;v<this.Yf.length;v++){const O=this.Yf[v];(!H||H&&O.isInFrustum(this._scene._frustumPlanes))&&this.render(O,!!f,y)}return void 0!==O&&(b.currentRenderPassId=h),this}directRender(){if(!this.Yf)return this;for(const O of this.Yf)this.render(O,!1);return this}render(O,f,y){var S,H,b;const h=this.va();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const v=(null===(S=h.activeCameras)||void 0===S?void 0:S.length)??0;if((v>1&&h.activeCamera===h.activeCameras[0]||v<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const N=this._getInstancesRenderList(O._id,!!y);if(N.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const m=h.getEngine();let t=0,q=null;this.ignoreCameraMaxZ&&h.activeCamera&&!h._isInIntermediateRendering()&&(t=h.activeCamera.maxZ,q=h.activeCamera,h.activeCamera.maxZ=0,h.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const F=O.getRenderingMesh(),I=N.hardwareInstancedRendering[O._id]||F.hasThinInstances||!!this._userInstancedBuffersStorage&&!O.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,A=this._instanceDataStorage,J=O.Ha();if(!J)return q&&(q.maxZ=t,h.updateTransformMatrix(!0)),this;if(A.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===J){if(J._storeEffectOnSubMeshes&&(null===(H=O._drawWrapper)||void 0===H||!H._wasPreviouslyReady)||!J._storeEffectOnSubMeshes&&!J._getDrawWrapper()._wasPreviouslyReady)return q&&(q.maxZ=t,h.updateTransformMatrix(!0)),this}else{if(J._storeEffectOnSubMeshes){if(!J.isReadyForSubMesh(this,O,I))return q&&(q.maxZ=t,h.updateTransformMatrix(!0)),this}else if(!J.isReady(this,I))return q&&(q.maxZ=t,h.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=J}let X;f&&m.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),X=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?O._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const B=(null===(b=X)||void 0===b?void 0:b.effect)??null;for(const w of h._beforeRenderingMeshStage)w.action(this,O,N,B);if(!X||!B)return q&&(q.maxZ=t,h.updateTransformMatrix(!0)),this;const j=y||this;let u;if(A.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.Wg&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)u=A.sideOrientation;else{const O=j._getWorldMatrixDeterminant();u=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),O<0&&(u=u===w.c.ClockWiseSideOrientation?w.c.CounterClockWiseSideOrientation:w.c.ClockWiseSideOrientation),A.sideOrientation=u}const L=this._internalMeshDataInfo._effectiveMaterial._preBind(X,u);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&m.setDepthWrite(!0);const p=this._internalMeshDataInfo._effectiveMaterial,U=p.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),I||this._bind(O,B,U,!1);const l=j.getWorldMatrix();p._storeEffectOnSubMeshes?p.bindForSubMesh(l,this,O):p.bind(l,this),!p.Wg&&p.separateCullingPass&&(m.setState(!0,p.zOffset,!1,!L,p.cullBackFaces,p.stencil,p.zOffsetUnits),this._processRendering(this,O,B,U,N,I,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),m.setState(!0,p.zOffset,!1,L,p.cullBackFaces,p.stencil,p.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(O)),this._processRendering(this,O,B,U,N,I,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const w of h._afterRenderingMeshStage)w.action(this,O,N,B);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),q&&(q.maxZ=t,h.updateTransformMatrix(!0)),2!==h.performancePriority||A.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(F.f.MatricesWeightsKind)&&(this.isVerticesDataPresent(F.f.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const O=this.getVerticesData(F.f.MatricesWeightsKind),f=O.length;for(let y=0;y<f;y+=4){const f=O[y]+O[y+1]+O[y+2]+O[y+3];if(0===f)O[y]=1;else{const S=1/f;O[y]*=S,O[y+1]*=S,O[y+2]*=S,O[y+3]*=S}}this.Ga(F.f.MatricesWeightsKind,O)}_normalizeSkinWeightsAndExtra(){const O=this.getVerticesData(F.f.MatricesWeightsExtraKind),f=this.getVerticesData(F.f.MatricesWeightsKind),y=f.length;for(let S=0;S<y;S+=4){let y=f[S]+f[S+1]+f[S+2]+f[S+3];if(y+=O[S]+O[S+1]+O[S+2]+O[S+3],0===y)f[S]=1;else{const H=1/y;f[S]*=H,f[S+1]*=H,f[S+2]*=H,f[S+3]*=H,O[S]*=H,O[S+1]*=H,O[S+2]*=H,O[S+3]*=H}}this.Ga(F.f.MatricesWeightsKind,f),this.Ga(F.f.MatricesWeightsKind,O)}validateSkinning(){const O=this.getVerticesData(F.f.MatricesWeightsExtraKind),f=this.getVerticesData(F.f.MatricesWeightsKind);if(null===f||null==this.skeleton)return{skinned:!1,valid:!0,hm:"not skinned"};const y=f.length;let S=0,H=0,b=0,h=0;const v=null===O?4:8,N=[];for(let F=0;F<=v;F++)N[F]=0;for(let F=0;F<y;F+=4){let y=f[F],m=y,t=0===m?0:1;for(let H=1;H<v;H++){const b=H<4?f[F+H]:O[F+H-4];b>y&&S++,0!==b&&t++,m+=b,y=b}if(N[t]++,t>b&&(b=t),0===m)H++;else{const y=1/m;let S=0;for(let H=0;H<v;H++)S+=H<4?Math.abs(f[F+H]-f[F+H]*y):Math.abs(O[F+H-4]-O[F+H-4]*y);S>.001&&h++}}const m=this.skeleton.bones.length,t=this.getVerticesData(F.f.MatricesIndicesKind),q=this.getVerticesData(F.f.MatricesIndicesExtraKind);let I=0;for(let F=0;F<y;F+=4)for(let O=0;O<v;O++){const f=O<4?t[F+O]:q[F+O-4];(f>=m||f<0)&&I++}return{skinned:!0,valid:0===H&&0===h&&0===I,hm:"Number of Weights = "+y/4+"\nMaximum influences = "+b+"\nMissing Weights = "+H+"\nNot Sorted = "+S+"\nNot Normalized = "+h+"\nWeightCounts = ["+N+"]\nNumber of bones = "+m+"\nBad Bone Indices = "+I}}_checkDelayState(){const O=this.va();return this._geometry?this._geometry.load(O):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(O)),this}_queueLoad(O){O.addPendingData(this);const f=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return H.d.LoadFile(this.delayLoadingFile,(f=>{f instanceof ArrayBuffer?this._delayLoadingFunction(f,this):this._delayLoadingFunction(JSON.parse(f),this),this.instances.forEach((O=>{O.refreshBoundingInfo(),O._syncSubMeshes()})),this.delayLoadState=1,O.removePendingData(this)}),(()=>{}),O.offlineProvider,f),this}isInFrustum(O){return 2!==this.delayLoadState&&(!!super.isInFrustum(O)&&(this._checkDelayState(),!0))}setMaterialById(O){const f=this.va().materials;let y;for(y=f.length-1;y>-1;y--)if(f[y].id===O)return this.material=f[y],this;const S=this.va().multiMaterials;for(y=S.length-1;y>-1;y--)if(S[y].id===O)return this.material=S[y],this;return this}getAnimatables(){const O=[];return this.material&&O.push(this.material),this.skeleton&&O.push(this.skeleton),O}bakeTransformIntoVertices(O){if(!this.isVerticesDataPresent(F.f.PositionKind))return this;const f=this.Yf.splice(0);this._resetPointsArrayCache();let y=this.getVerticesData(F.f.PositionKind);const S=m.m.Zero();let H;for(H=0;H<y.length;H+=3)m.m.TransformCoordinatesFromFloatsToRef(y[H],y[H+1],y[H+2],O,S).toArray(y,H);if(this.Ga(F.f.PositionKind,y,this.getVertexBuffer(F.f.PositionKind).isUpdatable()),this.isVerticesDataPresent(F.f.NormalKind)){for(y=this.getVerticesData(F.f.NormalKind),H=0;H<y.length;H+=3)m.m.TransformNormalFromFloatsToRef(y[H],y[H+1],y[H+2],O,S).normalize().toArray(y,H);this.Ga(F.f.NormalKind,y,this.getVertexBuffer(F.f.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(F.f.TangentKind)){for(y=this.getVerticesData(F.f.TangentKind),H=0;H<y.length;H+=4)m.m.TransformNormalFromFloatsToRef(y[H],y[H+1],y[H+2],O,S).normalize().toArray(y,H);this.Ga(F.f.TangentKind,y,this.getVertexBuffer(F.f.TangentKind).isUpdatable())}return O.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.Yf=f,this}bakeCurrentTransformIntoVertices(){let O=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.bakeTransformIntoVertices(this.Mj(!0)),this.resetLocalMatrix(O),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2?arguments[2]:void 0,y=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new V(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",this.va(),O,this,f,y)}dispose(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const y=this._internalMeshDataInfo;if(y._onBeforeDrawObservable&&y._onBeforeDrawObservable.clear(),y._onBeforeBindObservable&&y._onBeforeBindObservable.clear(),y._onBeforeRenderObservable&&y._onBeforeRenderObservable.clear(),y._onAfterRenderObservable&&y._onAfterRenderObservable.clear(),y._onBetweenPassObservable&&y._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(y.meshMap)for(const O in y.meshMap){const f=y.meshMap[O];f&&(f._internalMeshDataInfo._source=null,y.meshMap[O]=void 0)}y._source&&y._source._internalMeshDataInfo.meshMap&&(y._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const O=this.va().meshes;for(const f of O){const O=f;O._internalMeshDataInfo&&O._internalMeshDataInfo._source&&O._internalMeshDataInfo._source===this&&(O._internalMeshDataInfo._source=null)}}y._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(O,f)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(O,f,y,S,b,h){let v=arguments.length>6&&void 0!==arguments[6]&&arguments[6],N=arguments.length>7?arguments[7]:void 0;const m=this.va();return H.d.LoadImage(O,(O=>{const H=O.width,N=O.height,m=this.getEngine().createCanvas(H,N).getContext("2d");m.drawImage(O,0,0);const t=m.getImageData(0,0,H,N).data;this.applyDisplacementMapFromBuffer(t,H,N,f,y,b,h,v),S&&S(this)}),N||(()=>{}),m.offlineProvider),this}applyDisplacementMapFromBuffer(O,f,y,S,H,b,h){let v=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(F.f.PositionKind)||!this.isVerticesDataPresent(F.f.NormalKind)||!this.isVerticesDataPresent(F.f.UVKind))return L.e.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const N=this.getVerticesData(F.f.PositionKind,!0,!0),t=this.getVerticesData(F.f.NormalKind),q=this.getVerticesData(F.f.UVKind);let A=m.m.Zero();const J=m.m.Zero(),X=m.i.Zero();b=b||m.i.Zero(),h=h||new m.i(1,1);for(let F=0;F<N.length;F+=3){m.m.FromArrayToRef(N,F,A),m.m.FromArrayToRef(t,F,J),m.i.FromArrayToRef(q,F/3*2,X);const v=4*((Math.abs(X.x*h.x+b.x%1)*(f-1)%f|0)+(Math.abs(X.y*h.y+b.y%1)*(y-1)%y|0)*f),I=.3*(O[v]/255)+.59*(O[v+1]/255)+.11*(O[v+2]/255);J.normalize(),J.scaleInPlace(S+(H-S)*I),A=A.add(J),A.toArray(N,F)}return I.c.ComputeNormals(N,this.Pf(),t),v?(this.Ga(F.f.PositionKind,N),this.Ga(F.f.NormalKind,t),this.Ga(F.f.UVKind,q)):(this.updateVerticesData(F.f.PositionKind,N),this.updateVerticesData(F.f.NormalKind,t)),this}_getFlattenedNormals(O,f){const y=new Float32Array(3*O.length);let S=0;const H=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let b=0;b<O.length;b+=3){const h=m.m.Ng(f,3*O[b]),v=m.m.Ng(f,3*O[b+1]),N=m.m.Ng(f,3*O[b+2]),t=h.xc(v),q=N.xc(v),F=m.m.Normalize(m.m.Cross(t,q));H&&F.scaleInPlace(-1);for(let O=0;O<3;O++)y[S++]=F.x,y[S++]=F.y,y[S++]=F.z}return y}_convertToUnIndexedMesh(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const f=this.getVerticesDataKinds().filter((O=>{var f;return!(null!==(f=this.getVertexBuffer(O))&&void 0!==f&&f.getIsInstanced())})),y=this.Pf(),S={},H=(O,f)=>{const S=new Float32Array(y.length*f);let H=0;for(let b=0;b<y.length;b++)for(let h=0;h<f;h++)S[H++]=O[y[b]*f+h];return S},b=this.getBoundingInfo(),h=this.Bj?this.Yf.slice(0):[];for(const v of f)S[v]=this.getVerticesData(v);for(const v of f){const f=this.getVertexBuffer(v),b=f.getSize();if(O&&v===F.f.NormalKind){const O=this._getFlattenedNormals(y,S[F.f.PositionKind]);this.Ga(F.f.NormalKind,O,f.isUpdatable(),b)}else this.Ga(v,H(S[v],b),f.isUpdatable(),b)}if(this.morphTargetManager){for(let f=0;f<this.morphTargetManager.numTargets;f++){const S=this.morphTargetManager.getTarget(f),b=S.getPositions();S.setPositions(H(b,3));const h=S.getNormals();h&&S.setNormals(O?this._getFlattenedNormals(y,b):H(h,3));const v=S.getTangents();v&&S.setTangents(H(v,3));const N=S.getUVs();N&&S.setUVs(H(N,2))}this.morphTargetManager.synchronize()}for(let v=0;v<y.length;v++)y[v]=v;this.setIndices(y),this._unIndexed=!0,this.releaseSubMeshes();for(const v of h){const O=v.getBoundingInfo();X.b.AddToMesh(v.materialIndex,v.indexStart,v.indexCount,v.indexStart,v.indexCount,this).setBoundingInfo(O)}return this.setBoundingInfo(b),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const f=I.c.ExtractFromMesh(this);let y;if(O&&this.isVerticesDataPresent(F.f.NormalKind)&&f.ya){for(y=0;y<f.ya.length;y++)f.ya[y]*=-1;this.Ga(F.f.NormalKind,f.ya,this.isVertexBufferUpdatable(F.f.NormalKind))}if(f.indices){let O;for(y=0;y<f.indices.length;y+=3)O=f.indices[y+1],f.indices[y+1]=f.indices[y+2],f.indices[y+2]=O;this.setIndices(f.indices,null,this.isVertexBufferUpdatable(F.f.PositionKind),!0)}return this}increaseVertices(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const f=I.c.ExtractFromMesh(this),y=f.indices&&!Array.isArray(f.indices)&&Array.from?Array.from(f.indices):f.indices,S=f.xa&&!Array.isArray(f.xa)&&Array.from?Array.from(f.xa):f.xa,H=f.Aa&&!Array.isArray(f.Aa)&&Array.from?Array.from(f.Aa):f.Aa,b=f.ya&&!Array.isArray(f.ya)&&Array.from?Array.from(f.ya):f.ya;if(y&&S){f.indices=y,f.xa=S,H&&(f.Aa=H),b&&(f.ya=b);const h=O+1,v=new Array;for(let O=0;O<h+1;O++)v[O]=new Array;let N,t;const q=new m.m(0,0,0),I=new m.m(0,0,0),A=new m.i(0,0),J=new Array,X=new Array,w=new Array;let B,j,u,L=S.length;H&&(j=H.length),b&&(u=b.length);for(let O=0;O<y.length;O+=3){X[0]=y[O],X[1]=y[O+1],X[2]=y[O+2];for(let O=0;O<3;O++)if(N=X[O],t=X[(O+1)%3],void 0===w[N]&&void 0===w[t]?(w[N]=new Array,w[t]=new Array):(void 0===w[N]&&(w[N]=new Array),void 0===w[t]&&(w[t]=new Array)),void 0===w[N][t]&&void 0===w[t][N]){w[N][t]=[],q.x=(S[3*t]-S[3*N])/h,q.y=(S[3*t+1]-S[3*N+1])/h,q.z=(S[3*t+2]-S[3*N+2])/h,b&&(I.x=(b[3*t]-b[3*N])/h,I.y=(b[3*t+1]-b[3*N+1])/h,I.z=(b[3*t+2]-b[3*N+2])/h),H&&(A.x=(H[2*t]-H[2*N])/h,A.y=(H[2*t+1]-H[2*N+1])/h),w[N][t].push(N);for(let O=1;O<h;O++)w[N][t].push(S.length/3),S[L++]=S[3*N]+O*q.x,S[L++]=S[3*N+1]+O*q.y,S[L++]=S[3*N+2]+O*q.z,b&&(b[u++]=b[3*N]+O*I.x,b[u++]=b[3*N+1]+O*I.y,b[u++]=b[3*N+2]+O*I.z),H&&(H[j++]=H[2*N]+O*A.x,H[j++]=H[2*N+1]+O*A.y);w[N][t].push(t),w[t][N]=new Array,B=w[N][t].length;for(let O=0;O<B;O++)w[t][N][O]=w[N][t][B-1-O]}v[0][0]=y[O],v[1][0]=w[y[O]][y[O+1]][1],v[1][1]=w[y[O]][y[O+2]][1];for(let f=2;f<h;f++){v[f][0]=w[y[O]][y[O+1]][f],v[f][f]=w[y[O]][y[O+2]][f],q.x=(S[3*v[f][f]]-S[3*v[f][0]])/f,q.y=(S[3*v[f][f]+1]-S[3*v[f][0]+1])/f,q.z=(S[3*v[f][f]+2]-S[3*v[f][0]+2])/f,b&&(I.x=(b[3*v[f][f]]-b[3*v[f][0]])/f,I.y=(b[3*v[f][f]+1]-b[3*v[f][0]+1])/f,I.z=(b[3*v[f][f]+2]-b[3*v[f][0]+2])/f),H&&(A.x=(H[2*v[f][f]]-H[2*v[f][0]])/f,A.y=(H[2*v[f][f]+1]-H[2*v[f][0]+1])/f);for(let O=1;O<f;O++)v[f][O]=S.length/3,S[L++]=S[3*v[f][0]]+O*q.x,S[L++]=S[3*v[f][0]+1]+O*q.y,S[L++]=S[3*v[f][0]+2]+O*q.z,b&&(b[u++]=b[3*v[f][0]]+O*I.x,b[u++]=b[3*v[f][0]+1]+O*I.y,b[u++]=b[3*v[f][0]+2]+O*I.z),H&&(H[j++]=H[2*v[f][0]]+O*A.x,H[j++]=H[2*v[f][0]+1]+O*A.y)}v[h]=w[y[O+1]][y[O+2]],J.push(v[0][0],v[1][0],v[1][1]);for(let O=1;O<h;O++){let f;for(f=0;f<O;f++)J.push(v[O][f],v[O+1][f],v[O+1][f+1]),J.push(v[O][f],v[O+1][f+1],v[O][f+1]);J.push(v[O][f],v[O+1][f],v[O+1][f+1])}}f.indices=J,f.Ca(this,this.isVertexBufferUpdatable(F.f.PositionKind))}else L.e.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const O=I.c.ExtractFromMesh(this),f=O.Aa,y=O.indices,S=O.xa,H=O.za,b=O.matricesIndices,h=O.matricesWeights,v=O.matricesIndicesExtra,N=O.matricesWeightsExtra;if(void 0===y||void 0===S||null===y||null===S)L.e.Warn("VertexData contains empty entries");else{const m=new Array,t=new Array,q=new Array,A=new Array,J=new Array,X=new Array,w=new Array,B=new Array;let j=new Array,u=0;const L={};let p,U;for(let O=0;O<y.length;O+=3){U=[y[O],y[O+1],y[O+2]],j=[];for(let O=0;O<3;O++){j[O]="";for(let f=0;f<3;f++)Math.abs(S[3*U[O]+f])<1e-8&&(S[3*U[O]+f]=0),j[O]+=S[3*U[O]+f]+"|"}if(j[0]!=j[1]&&j[0]!=j[2]&&j[1]!=j[2])for(let O=0;O<3;O++){if(p=L[j[O]],void 0===p){L[j[O]]=u,p=u++;for(let f=0;f<3;f++)m.push(S[3*U[O]+f]);if(null!==H&&void 0!==H)for(let f=0;f<4;f++)A.push(H[4*U[O]+f]);if(null!==f&&void 0!==f)for(let y=0;y<2;y++)q.push(f[2*U[O]+y]);if(null!==b&&void 0!==b)for(let f=0;f<4;f++)J.push(b[4*U[O]+f]);if(null!==h&&void 0!==h)for(let f=0;f<4;f++)X.push(h[4*U[O]+f]);if(null!==v&&void 0!==v)for(let f=0;f<4;f++)w.push(v[4*U[O]+f]);if(null!==N&&void 0!==N)for(let f=0;f<4;f++)B.push(N[4*U[O]+f])}t.push(p)}}const l=new Array;I.c.ComputeNormals(m,t,l),O.xa=m,O.indices=t,O.ya=l,null!==f&&void 0!==f&&(O.Aa=q),null!==H&&void 0!==H&&(O.za=A),null!==b&&void 0!==b&&(O.matricesIndices=J),null!==h&&void 0!==h&&(O.matricesWeights=X),null!==v&&void 0!==v&&(O.matricesIndicesExtra=w),null!==h&&void 0!==h&&(O.matricesWeightsExtra=B),O.Ca(this,this.isVertexBufferUpdatable(F.f.PositionKind))}}static _instancedMeshFactory(O,f){throw(0,U.d)("InstancedMesh")}static _PhysicsImpostorParser(O,f,y){throw(0,U.d)("PhysicsImpostor")}createInstance(O){const f=V._instancedMeshFactory(O,this);return f.parent=this.parent,f}synchronizeInstances(){for(let O=0;O<this.instances.length;O++){this.instances[O]._syncSubMeshes()}return this}optimizeIndices(O){const f=this.Pf(),y=this.getVerticesData(F.f.PositionKind);if(!y||!f)return this;const S=[];for(let H=0;H<y.length;H+=3)S.push(m.m.Ng(y,H));const b=[];return H.b.SyncAsyncForLoop(S.length,40,(O=>{const f=S.length-1-O,y=S[f];for(let H=0;H<f;++H){const O=S[H];if(y.equals(O)){b[f]=H;break}}}),(()=>{for(let O=0;O<f.length;++O)f[O]=b[f[O]]||f[O];const y=this.Yf.slice(0);this.setIndices(f),this.Yf=y,O&&O(this)})),this}serialize(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};O.name=this.name,O.id=this.id,O.uniqueId=this.uniqueId,O.type=this.getClassName(),h.d&&h.d.HasTags(this)&&(O.tags=h.d.GetTags(this)),O.position=this.position.gj(),this.rotationQuaternion?O.rotationQuaternion=this.rotationQuaternion.gj():this.rotation&&(O.rotation=this.rotation.gj()),O.Yd=this.Yd.gj(),this._postMultiplyPivotMatrix?O.pivotMatrix=this.getPivotMatrix().gj():O.localMatrix=this.getPivotMatrix().gj(),O.isEnabled=this.isEnabled(!1),O.isVisible=this.isVisible,O.infiniteDistance=this.infiniteDistance,O.pickable=this.Mb,O.receiveShadows=this.receiveShadows,O.billboardMode=this.billboardMode,O.visibility=this.visibility,O.qb=this.qb,O.checkCollisions=this.checkCollisions,O.ellipsoid=this.ellipsoid.gj(),O.ellipsoidOffset=this.ellipsoidOffset.gj(),O.Da=this.Da,O.isBlocker=this.isBlocker,O.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(O),O.isUnIndexed=this.isUnIndexed;const f=this._geometry;if(f&&this.Yf){O.geometryUniqueId=f.uniqueId,O.geometryId=f.id,O.Yf=[];for(let f=0;f<this.Yf.length;f++){const y=this.Yf[f];O.Yf.push({materialIndex:y.materialIndex,verticesStart:y.verticesStart,verticesCount:y.verticesCount,indexStart:y.indexStart,indexCount:y.indexCount})}}if(this.material?this.material.doNotSerialize||(O.materialUniqueId=this.material.uniqueId,O.materialId=this.material.id):(this.material=null,O.materialUniqueId=this._scene.defaultMaterial.uniqueId,O.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(O.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(O.skeletonId=this.skeleton.id,O.numBoneInfluencers=this.numBoneInfluencers),this.va()._getComponent(l.b.NAME_PHYSICSENGINE)){const f=this.getPhysicsImpostor();f&&(O.physicsMass=f.getParam("mass"),O.physicsFriction=f.getParam("friction"),O.physicsRestitution=f.getParam("mass"),O.physicsImpostor=f.type)}this.metadata&&(O.metadata=this.metadata),O.instances=[];for(let y=0;y<this.instances.length;y++){const f=this.instances[y];if(f.doNotSerialize)continue;const S={name:f.name,id:f.id,isEnabled:f.isEnabled(!1),isVisible:f.isVisible,Mb:f.Mb,checkCollisions:f.checkCollisions,position:f.position.gj(),Yd:f.Yd.gj()};if(f.parent&&f.parent._serializeAsParent(S),f.rotationQuaternion?S.rotationQuaternion=f.rotationQuaternion.gj():f.rotation&&(S.rotation=f.rotation.gj()),this.va()._getComponent(l.b.NAME_PHYSICSENGINE)){const O=f.getPhysicsImpostor();O&&(S.physicsMass=O.getParam("mass"),S.physicsFriction=O.getParam("friction"),S.physicsRestitution=O.getParam("mass"),S.physicsImpostor=O.type)}f.metadata&&(S.metadata=f.metadata),f.actionManager&&(S.actions=f.actionManager.serialize(f.name)),O.instances.push(S),u.b.AppendSerializedAnimations(f,S),S.ranges=f.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(O.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const f={data:{},sizes:{},strides:{}};for(const O in this._userThinInstanceBuffersStorage.data)f.data[O]=Array.from(this._userThinInstanceBuffersStorage.data[O]),f.sizes[O]=this._userThinInstanceBuffersStorage.sizes[O],f.strides[O]=this._userThinInstanceBuffersStorage.strides[O];O.thinInstances.userThinInstance=f}return u.b.AppendSerializedAnimations(this,O),O.ranges=this.serializeAnimationRanges(),O.layerMask=this.layerMask,O.alphaIndex=this.alphaIndex,O.hasVertexAlpha=this.hasVertexAlpha,O.overlayAlpha=this.overlayAlpha,O.overlayColor=this.overlayColor.gj(),O.renderOverlay=this.renderOverlay,O.applyFog=this.applyFog,this.actionManager&&(O.actions=this.actionManager.serialize(this.name)),O}_syncGeometryWithMorphTargetManager(){if(!this.Bj)return;this._markSubMeshesAsAttributesDirty();const O=this._internalAbstractMeshDataInfo._morphTargetManager;if(O&&O.vertexCount){if(O.vertexCount!==this.getTotalVertices())return L.e.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(O.isUsingTextureForTargets)return;for(let f=0;f<O.numInfluencers;f++){const y=O.getActiveTarget(f),S=y.getPositions();if(!S)return void L.e.Error("Invalid morph target. Target must have positions.");this.Bj.Ga(F.f.PositionKind+f,S,!1,3);const H=y.getNormals();H&&this.Bj.Ga(F.f.NormalKind+f,H,!1,3);const b=y.getTangents();b&&this.Bj.Ga(F.f.TangentKind+f,b,!1,3);const h=y.getUVs();h&&this.Bj.Ga(F.f.UVKind+"_"+f,h,!1,2)}}else{let O=0;for(;this.Bj.isVerticesDataPresent(F.f.PositionKind+O);)this.Bj.removeVerticesData(F.f.PositionKind+O),this.Bj.isVerticesDataPresent(F.f.NormalKind+O)&&this.Bj.removeVerticesData(F.f.NormalKind+O),this.Bj.isVerticesDataPresent(F.f.TangentKind+O)&&this.Bj.removeVerticesData(F.f.TangentKind+O),this.Bj.isVerticesDataPresent(F.f.UVKind+O)&&this.Bj.removeVerticesData(F.f.UVKind+"_"+O),O++}}static Parse(O,f,y){let S;if(S=O.type&&"LinesMesh"===O.type?V._LinesMeshParser(O,f):O.type&&"GroundMesh"===O.type?V._GroundMeshParser(O,f):O.type&&"GoldbergMesh"===O.type?V._GoldbergMeshParser(O,f):O.type&&"GreasedLineMesh"===O.type?V._GreasedLineMeshParser(O,f):O.type&&"TrailMesh"===O.type?V._TrailMeshParser(O,f):new V(O.name,f),S.id=O.id,S._waitingParsedUniqueId=O.uniqueId,h.d&&h.d.AddTagsTo(S,O.tags),S.position=m.m.Ng(O.position),void 0!==O.metadata&&(S.metadata=O.metadata),O.rotationQuaternion?S.rotationQuaternion=m.c.Ng(O.rotationQuaternion):O.rotation&&(S.rotation=m.m.Ng(O.rotation)),S.Yd=m.m.Ng(O.Yd),O.localMatrix?S.setPreTransformMatrix(m.b.Ng(O.localMatrix)):O.pivotMatrix&&S.setPivotMatrix(m.b.Ng(O.pivotMatrix)),S.$b(O.isEnabled),S.isVisible=O.isVisible,S.infiniteDistance=O.infiniteDistance,S.qb=!!O.qb,S.showBoundingBox=O.showBoundingBox,S.showSubMeshesBoundingBox=O.showSubMeshesBoundingBox,void 0!==O.applyFog&&(S.applyFog=O.applyFog),void 0!==O.pickable&&(S.Mb=O.pickable),void 0!==O.alphaIndex&&(S.alphaIndex=O.alphaIndex),S.receiveShadows=O.receiveShadows,void 0!==O.billboardMode&&(S.billboardMode=O.billboardMode),void 0!==O.visibility&&(S.visibility=O.visibility),S.checkCollisions=O.checkCollisions,S.Da=!!O.Da,O.ellipsoid&&(S.ellipsoid=m.m.Ng(O.ellipsoid)),O.ellipsoidOffset&&(S.ellipsoidOffset=m.m.Ng(O.ellipsoidOffset)),null!=O.overrideMaterialSideOrientation&&(S.sideOrientation=O.overrideMaterialSideOrientation),void 0!==O.sideOrientation&&(S.sideOrientation=O.sideOrientation),void 0!==O.isBlocker&&(S.isBlocker=O.isBlocker),S._shouldGenerateFlatShading=O.useFlatShading,O.sd&&(S._waitingData.sd=O.sd),void 0!==O.parentId&&(S._waitingParentId=O.parentId),void 0!==O.parentInstanceIndex&&(S._waitingParentInstanceIndex=O.parentInstanceIndex),void 0!==O.actions&&(S._waitingData.actions=O.actions),void 0!==O.overlayAlpha&&(S.overlayAlpha=O.overlayAlpha),void 0!==O.overlayColor&&(S.overlayColor=t.d.Ng(O.overlayColor)),void 0!==O.renderOverlay&&(S.renderOverlay=O.renderOverlay),S.isUnIndexed=!!O.isUnIndexed,S.hasVertexAlpha=O.hasVertexAlpha,O.delayLoadingFile?(S.delayLoadState=4,S.delayLoadingFile=y+O.delayLoadingFile,S.buildBoundingInfo(m.m.Ng(O.boundingBoxMinimum),m.m.Ng(O.boundingBoxMaximum)),O._binaryInfo&&(S._binaryInfo=O._binaryInfo),S._delayInfo=[],O.hasUVs&&S._delayInfo.push(F.f.UVKind),O.hasUVs2&&S._delayInfo.push(F.f.UV2Kind),O.hasUVs3&&S._delayInfo.push(F.f.UV3Kind),O.hasUVs4&&S._delayInfo.push(F.f.UV4Kind),O.hasUVs5&&S._delayInfo.push(F.f.UV5Kind),O.hasUVs6&&S._delayInfo.push(F.f.UV6Kind),O.hasColors&&S._delayInfo.push(F.f.ColorKind),O.hasMatricesIndices&&S._delayInfo.push(F.f.MatricesIndicesKind),O.hasMatricesWeights&&S._delayInfo.push(F.f.MatricesWeightsKind),S._delayLoadingFunction=A.e._ImportGeometry,j.d.ForceFullSceneLoadingForIncremental&&S._checkDelayState()):A.e._ImportGeometry(O,S),O.materialUniqueId?S._waitingMaterialId=O.materialUniqueId:O.materialId&&(S._waitingMaterialId=O.materialId),O.morphTargetManagerId>-1&&(S._waitingMorphTargetManagerId=O.morphTargetManagerId),void 0!==O.skeletonId&&null!==O.skeletonId&&(S.skeleton=f.getLastSkeletonById(O.skeletonId),O.numBoneInfluencers&&(S.numBoneInfluencers=O.numBoneInfluencers)),O.animations){for(let f=0;f<O.animations.length;f++){const y=O.animations[f],H=(0,p.c)("BABYLON.Animation");H&&S.animations.push(H.Parse(y))}q.c.ParseAnimationRanges(S,O,f)}if(O.autoAnimate&&f.beginAnimation(S,O.autoAnimateFrom,O.autoAnimateTo,O.autoAnimateLoop,O.autoAnimateSpeed||1),O.layerMask&&!isNaN(O.layerMask)?S.layerMask=Math.abs(parseInt(O.layerMask)):S.layerMask=268435455,O.physicsImpostor&&(S.physicsImpostor=V._PhysicsImpostorParser(f,S,O)),O.lodMeshIds&&(S._waitingData.lods={ids:O.lodMeshIds,distances:O.lodDistances?O.lodDistances:null,coverages:O.lodCoverages?O.lodCoverages:null}),O.instances)for(let H=0;H<O.instances.length;H++){const y=O.instances[H],b=S.createInstance(y.name);if(y.id&&(b.id=y.id),h.d&&(y.tags?h.d.AddTagsTo(b,y.tags):h.d.AddTagsTo(b,O.tags)),b.position=m.m.Ng(y.position),void 0!==y.metadata&&(b.metadata=y.metadata),void 0!==y.parentId&&(b._waitingParentId=y.parentId),void 0!==y.parentInstanceIndex&&(b._waitingParentInstanceIndex=y.parentInstanceIndex),void 0!==y.isEnabled&&null!==y.isEnabled&&b.$b(y.isEnabled),void 0!==y.isVisible&&null!==y.isVisible&&(b.isVisible=y.isVisible),void 0!==y.Mb&&null!==y.Mb&&(b.Mb=y.Mb),y.rotationQuaternion?b.rotationQuaternion=m.c.Ng(y.rotationQuaternion):y.rotation&&(b.rotation=m.m.Ng(y.rotation)),b.Yd=m.m.Ng(y.Yd),void 0!=y.checkCollisions&&null!=y.checkCollisions&&(b.checkCollisions=y.checkCollisions),void 0!=y.pickable&&null!=y.pickable&&(b.Mb=y.pickable),void 0!=y.showBoundingBox&&null!=y.showBoundingBox&&(b.showBoundingBox=y.showBoundingBox),void 0!=y.showSubMeshesBoundingBox&&null!=y.showSubMeshesBoundingBox&&(b.showSubMeshesBoundingBox=y.showSubMeshesBoundingBox),void 0!=y.alphaIndex&&null!=y.showSubMeshesBoundingBox&&(b.alphaIndex=y.alphaIndex),y.physicsImpostor&&(b.physicsImpostor=V._PhysicsImpostorParser(f,b,y)),void 0!==y.actions&&(b._waitingData.actions=y.actions),y.animations){for(let O=0;O<y.animations.length;O++){const f=y.animations[O],S=(0,p.c)("BABYLON.Animation");S&&b.animations.push(S.Parse(f))}q.c.ParseAnimationRanges(b,y,f),y.autoAnimate&&f.beginAnimation(b,y.autoAnimateFrom,y.autoAnimateTo,y.autoAnimateLoop,y.autoAnimateSpeed||1)}}if(O.thinInstances){const f=O.thinInstances;if(S.thinInstanceEnablePicking=!!f.enablePicking,f.matrixData?(S.lc("matrix",new Float32Array(f.matrixData),16,!1),S._thinInstanceDataStorage.matrixBufferSize=f.matrixBufferSize,S._thinInstanceDataStorage.instancesCount=f.instancesCount):S._thinInstanceDataStorage.matrixBufferSize=f.matrixBufferSize,O.thinInstances.userThinInstance){const f=O.thinInstances.userThinInstance;for(const O in f.data)S.lc(O,new Float32Array(f.data[O]),f.strides[O],!1),S._userThinInstanceBuffersStorage.sizes[O]=f.sizes[O]}}return S}setPositionsForCPUSkinning(){const O=this._internalMeshDataInfo;if(!O._sourcePositions){const f=this.getVerticesData(F.f.PositionKind);if(!f)return O._sourcePositions;O._sourcePositions=new Float32Array(f),this.isVertexBufferUpdatable(F.f.PositionKind)||this.Ga(F.f.PositionKind,f,!0)}return O._sourcePositions}setNormalsForCPUSkinning(){const O=this._internalMeshDataInfo;if(!O._sourceNormals){const f=this.getVerticesData(F.f.NormalKind);if(!f)return O._sourceNormals;O._sourceNormals=new Float32Array(f),this.isVertexBufferUpdatable(F.f.NormalKind)||this.Ga(F.f.NormalKind,f,!0)}return O._sourceNormals}applySkeleton(O){if(!this.Bj)return this;if(this.Bj._softwareSkinningFrameId==this.va().getFrameId())return this;if(this.Bj._softwareSkinningFrameId=this.va().getFrameId(),!this.isVerticesDataPresent(F.f.PositionKind))return this;if(!this.isVerticesDataPresent(F.f.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(F.f.MatricesWeightsKind))return this;const f=this.isVerticesDataPresent(F.f.NormalKind),y=this._internalMeshDataInfo;if(!y._sourcePositions){const O=this.Yf.slice();this.setPositionsForCPUSkinning(),this.Yf=O}f&&!y._sourceNormals&&this.setNormalsForCPUSkinning();let S=this.getVerticesData(F.f.PositionKind);if(!S)return this;S instanceof Float32Array||(S=new Float32Array(S));let H=this.getVerticesData(F.f.NormalKind);if(f){if(!H)return this;H instanceof Float32Array||(H=new Float32Array(H))}const b=this.getVerticesData(F.f.MatricesIndicesKind),h=this.getVerticesData(F.f.MatricesWeightsKind);if(!h||!b)return this;const v=this.numBoneInfluencers>4,N=v?this.getVerticesData(F.f.MatricesIndicesExtraKind):null,t=v?this.getVerticesData(F.f.MatricesWeightsExtraKind):null,q=O.getTransformMatrices(this),I=m.m.Zero(),A=new m.b,J=new m.b;let X,w=0;for(let F=0;F<S.length;F+=3,w+=4){let O;for(X=0;X<4;X++)O=h[w+X],O>0&&(m.b.FromFloat32ArrayToRefScaled(q,Math.floor(16*b[w+X]),O,J),A.addToSelf(J));if(v)for(X=0;X<4;X++)O=t[w+X],O>0&&(m.b.FromFloat32ArrayToRefScaled(q,Math.floor(16*N[w+X]),O,J),A.addToSelf(J));m.m.TransformCoordinatesFromFloatsToRef(y._sourcePositions[F],y._sourcePositions[F+1],y._sourcePositions[F+2],A,I),I.toArray(S,F),f&&(m.m.TransformNormalFromFloatsToRef(y._sourceNormals[F],y._sourceNormals[F+1],y._sourceNormals[F+2],A,I),I.toArray(H,F)),A.reset()}return this.updateVerticesData(F.f.PositionKind,S),f&&this.updateVerticesData(F.f.NormalKind,H),this}static MinMax(O){let f=null,y=null;return O.forEach((function(O){const S=O.getBoundingInfo().boundingBox;f&&y?(f.minimizeInPlace(S.minimumWorld),y.maximizeInPlace(S.maximumWorld)):(f=S.minimumWorld,y=S.maximumWorld)})),f&&y?{min:f,max:y}:{min:m.m.Zero(),max:m.m.Zero()}}static Center(O){const f=O instanceof Array?V.MinMax(O):O;return m.m.Center(f.min,f.max)}static MergeMeshes(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],y=arguments.length>2?arguments[2]:void 0,S=arguments.length>3?arguments[3]:void 0,H=arguments.length>4?arguments[4]:void 0,b=arguments.length>5?arguments[5]:void 0;return(0,v.k)(V._MergeMeshesCoroutine(O,f,y,S,H,b,!1))}static MergeMeshesAsync(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],y=arguments.length>2?arguments[2]:void 0,S=arguments.length>3?arguments[3]:void 0,H=arguments.length>4?arguments[4]:void 0,b=arguments.length>5?arguments[5]:void 0;return(0,v.g)(V._MergeMeshesCoroutine(O,f,y,S,H,b,!0),(0,v.b)())}static*_MergeMeshesCoroutine(O){let f,y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],S=arguments.length>2?arguments[2]:void 0,H=arguments.length>3?arguments[3]:void 0,b=arguments.length>4?arguments[4]:void 0,h=arguments.length>5?arguments[5]:void 0,v=arguments.length>6?arguments[6]:void 0;if(0===(O=O.filter(Boolean)).length)return null;if(!S){let y=0;for(f=0;f<O.length;f++)if(y+=O[f].getTotalVertices(),y>=65536)return L.e.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}h&&(b=!1);const N=new Array,m=new Array,t=new Array,q=O[0].sideOrientation;for(f=0;f<O.length;f++){const y=O[f];if(y.isAnInstance)return L.e.Warn("Cannot merge instance meshes."),null;if(q!==y.sideOrientation)return L.e.Warn("Cannot merge meshes with different sideOrientation values."),null;if(b&&t.push(y.getTotalIndices()),h)if(y.material){const O=y.material;if(O instanceof B.d){for(let f=0;f<O.$f.length;f++)N.indexOf(O.$f[f])<0&&N.push(O.$f[f]);for(let f=0;f<y.Yf.length;f++)m.push(N.indexOf(O.$f[y.Yf[f].materialIndex])),t.push(y.Yf[f].indexCount)}else{N.indexOf(O)<0&&N.push(O);for(let f=0;f<y.Yf.length;f++)m.push(N.indexOf(O)),t.push(y.Yf[f].indexCount)}}else for(let O=0;O<y.Yf.length;O++)m.push(0),t.push(y.Yf[O].indexCount)}const F=O[0],A=O=>{const f=O.Mj(!0);return{vertexData:I.c.ExtractFromMesh(O,!1,!1),transform:f}},{vertexData:J,transform:w}=A(F);v&&(yield);const j=new Array(O.length-1);for(let I=1;I<O.length;I++)j[I-1]=A(O[I]),v&&(yield);const u=J._mergeCoroutine(w,j,S,v,!y);let p=u.next();for(;!p.done;)v&&(yield),p=u.next();const U=p.value;H||(H=new V(F.name+"_merged",F.va()));const l=U._applyToCoroutine(H,void 0,v);let x=l.next();for(;!x.done;)v&&(yield),x=l.next();if(H.checkCollisions=F.checkCollisions,H.sideOrientation=F.sideOrientation,y)for(f=0;f<O.length;f++)O[f].dispose();if(b||h){H.releaseSubMeshes(),f=0;let O=0;for(;f<t.length;)X.b.CreateFromIndices(0,O,t[f],H,void 0,!1),O+=t[f],f++;for(const f of H.Yf)f.refreshBoundingInfo();H.Mj(!0)}if(h){const O=new B.d(F.name+"_merged",F.va());O.$f=N;for(let f=0;f<H.Yf.length;f++)H.Yf[f].materialIndex=m[f];H.material=O}else H.material=F.material;return H}Ej(O){O._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(O)}Dj(O){const f=O._indexInSourceMeshInstanceArray;if(-1!=f){if(f!==this.instances.length-1){const O=this.instances[this.instances.length-1];this.instances[f]=O,O._indexInSourceMeshInstanceArray=f}O._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===w.c.CounterClockWiseSideOrientation}_getRenderingFillMode(O){const f=this.va();return f.forcePointsCloud?w.c.PointFillMode:f.forceWireframe?w.c.WireFrameFillMode:this.overrideRenderingFillMode??O}setMaterialByID(O){return this.setMaterialById(O)}static CreateRibbon(O,f,y,S,H,b,h,v,N){throw new Error("Import MeshBuilder to populate this function")}static CreateDisc(O,f,y,S,H,b){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(O,f,y,S,H){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(O,f,y,S,H,b){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(O,f,y,S){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(O,f,y,S,H,b,h,v,N){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(O,f,y,S,H,b,h){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(O,f,y,S,H,b,h,v,N,m){throw new Error("Import MeshBuilder to populate this function")}static sb(O,f,y,S,H){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(O,f,y,S,H,b,h,v){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(O,f,y,S,H,b,h){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(O,f,y,S,H,b,h,v){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(O,f,y,S,H,b,h,v,N,m){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(O,f,y,S,H,b,h,v,N,m,t,q){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(O,f,y,S,H,b,h){throw new Error("Import MeshBuilder to populate this function")}static _f(O,f,y,S,H){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(O,f,y,S,H,b){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(O,f,y,S,H,b,h,v,N){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(O,f,y,S,H,b,h,v,N,m,t){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(O,f,y,S,H,b,h,v,N,m){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(O,f,y){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(O,f,y){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(O,f,y,S,H,b){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(O,f,y){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(O){throw new Error("Import MeshBuilder to populate this function")}}V.FRONTSIDE=I.c.FRONTSIDE,V.BACKSIDE=I.c.BACKSIDE,V.DOUBLESIDE=I.c.DOUBLESIDE,V.DEFAULTSIDE=I.c.DEFAULTSIDE,V.NO_CAP=0,V.CAP_START=1,V.CAP_END=2,V.CAP_ALL=3,V.NO_FLIP=0,V.FLIP_TILE=1,V.ROTATE_TILE=2,V.FLIP_ROW=3,V.ROTATE_ROW=4,V.FLIP_N_ROTATE_TILE=5,V.FLIP_N_ROTATE_ROW=6,V.CENTER=0,V.LEFT=1,V.RIGHT=2,V.TOP=3,V.BOTTOM=4,V.INSTANCEDMESH_SORT_TRANSPARENT=!1,V._GroundMeshParser=(O,f)=>{throw(0,U.d)("GroundMesh")},V._GoldbergMeshParser=(O,f)=>{throw(0,U.d)("GoldbergMesh")},V._LinesMeshParser=(O,f)=>{throw(0,U.d)("LinesMesh")},V._GreasedLineMeshParser=(O,f)=>{throw(0,U.d)("GreasedLineMesh")},V._GreasedLineRibbonMeshParser=(O,f)=>{throw(0,U.d)("GreasedLineRibbonMesh")},V._TrailMeshParser=(O,f)=>{throw(0,U.d)("TrailMesh")},(0,p.g)("BABYLON.Mesh",V)},11577:(O,f,y)=>{"use strict";y.d(f,{c:()=>A});var S=y(11289),H=y(11324),b=y(11392),h=y(11030),v=y(11359),N=y(11017),m=y(11294),t=y(11559),q=y(11059),F=y(11458);class I{}class A{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,t.c)(this._applyToCoroutine.bind(this)),this.uniqueId=A._UniqueIDGenerator,A._UniqueIDGenerator++}set(O,f){switch(O.length||N.e.Warn(`Setting vertex data kind '${f}' with an empty array`),f){case b.f.PositionKind:this.xa=O;break;case b.f.NormalKind:this.ya=O;break;case b.f.TangentKind:this.tangents=O;break;case b.f.UVKind:this.Aa=O;break;case b.f.UV2Kind:this.uvs2=O;break;case b.f.UV3Kind:this.uvs3=O;break;case b.f.UV4Kind:this.uvs4=O;break;case b.f.UV5Kind:this.uvs5=O;break;case b.f.UV6Kind:this.uvs6=O;break;case b.f.ColorKind:this.za=O;break;case b.f.MatricesIndicesKind:this.matricesIndices=O;break;case b.f.MatricesWeightsKind:this.matricesWeights=O;break;case b.f.MatricesIndicesExtraKind:this.matricesIndicesExtra=O;break;case b.f.MatricesWeightsExtraKind:this.matricesWeightsExtra=O}}Ca(O,f){return this._applyTo(O,f,!1),this}applyToGeometry(O,f){return this._applyTo(O,f,!1),this}updateMesh(O){return this._update(O),this}updateGeometry(O){return this._update(O),this}*_applyToCoroutine(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2?arguments[2]:void 0;if(this.xa&&(O.Ga(b.f.PositionKind,this.xa,f),y&&(yield)),this.ya&&(O.Ga(b.f.NormalKind,this.ya,f),y&&(yield)),this.tangents&&(O.Ga(b.f.TangentKind,this.tangents,f),y&&(yield)),this.Aa&&(O.Ga(b.f.UVKind,this.Aa,f),y&&(yield)),this.uvs2&&(O.Ga(b.f.UV2Kind,this.uvs2,f),y&&(yield)),this.uvs3&&(O.Ga(b.f.UV3Kind,this.uvs3,f),y&&(yield)),this.uvs4&&(O.Ga(b.f.UV4Kind,this.uvs4,f),y&&(yield)),this.uvs5&&(O.Ga(b.f.UV5Kind,this.uvs5,f),y&&(yield)),this.uvs6&&(O.Ga(b.f.UV6Kind,this.uvs6,f),y&&(yield)),this.za&&(O.Ga(b.f.ColorKind,this.za,f),this.hasVertexAlpha&&void 0!==O.hasVertexAlpha&&(O.hasVertexAlpha=!0),y&&(yield)),this.matricesIndices&&(O.Ga(b.f.MatricesIndicesKind,this.matricesIndices,f),y&&(yield)),this.matricesWeights&&(O.Ga(b.f.MatricesWeightsKind,this.matricesWeights,f),y&&(yield)),this.matricesIndicesExtra&&(O.Ga(b.f.MatricesIndicesExtraKind,this.matricesIndicesExtra,f),y&&(yield)),this.matricesWeightsExtra&&(O.Ga(b.f.MatricesWeightsExtraKind,this.matricesWeightsExtra,f),y&&(yield)),this.indices?(O.setIndices(this.indices,null,f),y&&(yield)):O.setIndices([],null),O.Yf&&this.materialInfos&&this.materialInfos.length>1){const f=O;f.Yf=[];for(const O of this.materialInfos)new F.b(O.materialIndex,O.verticesStart,O.verticesCount,O.indexStart,O.indexCount,f)}return this}_update(O,f,y){return this.xa&&O.updateVerticesData(b.f.PositionKind,this.xa,f,y),this.ya&&O.updateVerticesData(b.f.NormalKind,this.ya,f,y),this.tangents&&O.updateVerticesData(b.f.TangentKind,this.tangents,f,y),this.Aa&&O.updateVerticesData(b.f.UVKind,this.Aa,f,y),this.uvs2&&O.updateVerticesData(b.f.UV2Kind,this.uvs2,f,y),this.uvs3&&O.updateVerticesData(b.f.UV3Kind,this.uvs3,f,y),this.uvs4&&O.updateVerticesData(b.f.UV4Kind,this.uvs4,f,y),this.uvs5&&O.updateVerticesData(b.f.UV5Kind,this.uvs5,f,y),this.uvs6&&O.updateVerticesData(b.f.UV6Kind,this.uvs6,f,y),this.za&&O.updateVerticesData(b.f.ColorKind,this.za,f,y),this.matricesIndices&&O.updateVerticesData(b.f.MatricesIndicesKind,this.matricesIndices,f,y),this.matricesWeights&&O.updateVerticesData(b.f.MatricesWeightsKind,this.matricesWeights,f,y),this.matricesIndicesExtra&&O.updateVerticesData(b.f.MatricesIndicesExtraKind,this.matricesIndicesExtra,f,y),this.matricesWeightsExtra&&O.updateVerticesData(b.f.MatricesWeightsExtraKind,this.matricesWeightsExtra,f,y),this.indices&&O.setIndices(this.indices,null),this}static _TransformVector3Coordinates(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:O.length;const b=H.g.fb[0],h=H.g.fb[1];for(let v=y;v<y+S;v+=3)H.m.FromArrayToRef(O,v,b),H.m.TransformCoordinatesToRef(b,f,h),O[v]=h.x,O[v+1]=h.y,O[v+2]=h.z}static _TransformVector3Normals(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:O.length;const b=H.g.fb[0],h=H.g.fb[1];for(let v=y;v<y+S;v+=3)H.m.FromArrayToRef(O,v,b),H.m.TransformNormalToRef(b,f,h),O[v]=h.x,O[v+1]=h.y,O[v+2]=h.z}static _TransformVector4Normals(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:O.length;const b=H.g.Vector4[0],h=H.g.Vector4[1];for(let v=y;v<y+S;v+=4)H.q.FromArrayToRef(O,v,b),H.q.TransformNormalToRef(b,f,h),O[v]=h.x,O[v+1]=h.y,O[v+2]=h.z,O[v+3]=h.w}static _FlipFaces(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O.length;for(let S=f;S<f+y;S+=3){const f=O[S+1];O[S+1]=O[S+2],O[S+2]=f}}transform(O){const f=O.determinant()<0;return this.xa&&A._TransformVector3Coordinates(this.xa,O),this.ya&&A._TransformVector3Normals(this.ya,O),this.tangents&&A._TransformVector4Normals(this.tangents,O),f&&this.indices&&A._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const O=[];for(const f of this.materialInfos){const y=new A;if(this.xa&&(y.xa=this.xa.slice(3*f.verticesStart,3*(f.verticesCount+f.verticesStart))),this.ya&&(y.ya=this.ya.slice(3*f.verticesStart,3*(f.verticesCount+f.verticesStart))),this.tangents&&(y.tangents=this.tangents.slice(4*f.verticesStart,4*(f.verticesCount+f.verticesStart))),this.za&&(y.za=this.za.slice(4*f.verticesStart,4*(f.verticesCount+f.verticesStart))),this.Aa&&(y.Aa=this.Aa.slice(2*f.verticesStart,2*(f.verticesCount+f.verticesStart))),this.uvs2&&(y.uvs2=this.uvs2.slice(2*f.verticesStart,2*(f.verticesCount+f.verticesStart))),this.uvs3&&(y.uvs3=this.uvs3.slice(2*f.verticesStart,2*(f.verticesCount+f.verticesStart))),this.uvs4&&(y.uvs4=this.uvs4.slice(2*f.verticesStart,2*(f.verticesCount+f.verticesStart))),this.uvs5&&(y.uvs5=this.uvs5.slice(2*f.verticesStart,2*(f.verticesCount+f.verticesStart))),this.uvs6&&(y.uvs6=this.uvs6.slice(2*f.verticesStart,2*(f.verticesCount+f.verticesStart))),this.matricesIndices&&(y.matricesIndices=this.matricesIndices.slice(4*f.verticesStart,4*(f.verticesCount+f.verticesStart))),this.matricesIndicesExtra&&(y.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*f.verticesStart,4*(f.verticesCount+f.verticesStart))),this.matricesWeights&&(y.matricesWeights=this.matricesWeights.slice(4*f.verticesStart,4*(f.verticesCount+f.verticesStart))),this.matricesWeightsExtra&&(y.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*f.verticesStart,4*(f.verticesCount+f.verticesStart))),this.indices){y.indices=[];for(let O=f.indexStart;O<f.indexStart+f.indexCount;O++)y.indices.push(this.indices[O]-f.verticesStart)}const S=new I;S.indexStart=0,S.indexCount=y.indices?y.indices.length:0,S.materialIndex=f.materialIndex,S.verticesStart=0,S.verticesCount=(y.xa?y.xa.length:0)/3,y.materialInfos=[S],O.push(y)}return O}merge(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],H=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const b=Array.isArray(O)?O.map((O=>({vertexData:O}))):[{vertexData:O}];return(0,t.k)(this._mergeCoroutine(void 0,b,f,!1,y,S,H))}*_mergeCoroutine(O,f){var y,S;let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],h=arguments.length>3?arguments[3]:void 0,v=arguments.length>4?arguments[4]:void 0,N=arguments.length>5&&void 0!==arguments[5]&&arguments[5],m=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let t=f.map((O=>O.vertexData)),q=this;if(m)for(const b of t)b&&(b._validate(),!this.ya&&b.ya&&(this.ya=new Float32Array(this.xa.length)),!this.tangents&&b.tangents&&(this.tangents=new Float32Array(this.xa.length/3*4)),!this.Aa&&b.Aa&&(this.Aa=new Float32Array(this.xa.length/3*2)),!this.uvs2&&b.uvs2&&(this.uvs2=new Float32Array(this.xa.length/3*2)),!this.uvs3&&b.uvs3&&(this.uvs3=new Float32Array(this.xa.length/3*2)),!this.uvs4&&b.uvs4&&(this.uvs4=new Float32Array(this.xa.length/3*2)),!this.uvs5&&b.uvs5&&(this.uvs5=new Float32Array(this.xa.length/3*2)),!this.uvs6&&b.uvs6&&(this.uvs6=new Float32Array(this.xa.length/3*2)),!this.za&&b.za&&(this.za=new Float32Array(this.xa.length/3*4),this.za.fill(1)),!this.matricesIndices&&b.matricesIndices&&(this.matricesIndices=new Float32Array(this.xa.length/3*4)),!this.matricesWeights&&b.matricesWeights&&(this.matricesWeights=new Float32Array(this.xa.length/3*4)),!this.matricesIndicesExtra&&b.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.xa.length/3*4)),!this.matricesWeightsExtra&&b.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.xa.length/3*4)));for(const b of t)if(b)if(m)this.ya&&!b.ya&&(b.ya=new Float32Array(b.xa.length)),this.tangents&&!b.tangents&&(b.tangents=new Float32Array(b.xa.length/3*4)),this.Aa&&!b.Aa&&(b.Aa=new Float32Array(b.xa.length/3*2)),this.uvs2&&!b.uvs2&&(b.uvs2=new Float32Array(b.xa.length/3*2)),this.uvs3&&!b.uvs3&&(b.uvs3=new Float32Array(b.xa.length/3*2)),this.uvs4&&!b.uvs4&&(b.uvs4=new Float32Array(b.xa.length/3*2)),this.uvs5&&!b.uvs5&&(b.uvs5=new Float32Array(b.xa.length/3*2)),this.uvs6&&!b.uvs6&&(b.uvs6=new Float32Array(b.xa.length/3*2)),this.za&&!b.za&&(b.za=new Float32Array(b.xa.length/3*4),b.za.fill(1)),this.matricesIndices&&!b.matricesIndices&&(b.matricesIndices=new Float32Array(b.xa.length/3*4)),this.matricesWeights&&!b.matricesWeights&&(b.matricesWeights=new Float32Array(b.xa.length/3*4)),this.matricesIndicesExtra&&!b.matricesIndicesExtra&&(b.matricesIndicesExtra=new Float32Array(b.xa.length/3*4)),this.matricesWeightsExtra&&!b.matricesWeightsExtra&&(b.matricesWeightsExtra=new Float32Array(b.xa.length/3*4));else if(b._validate(),!this.ya!==!b.ya||!this.tangents!==!b.tangents||!this.Aa!==!b.Aa||!this.uvs2!==!b.uvs2||!this.uvs3!==!b.uvs3||!this.uvs4!==!b.uvs4||!this.uvs5!==!b.uvs5||!this.uvs6!==!b.uvs6||!this.za!==!b.za||!this.matricesIndices!==!b.matricesIndices||!this.matricesWeights!==!b.matricesWeights||!this.matricesIndicesExtra!==!b.matricesIndicesExtra||!this.matricesWeightsExtra!==!b.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(N){let y=0,S=0,H=0;const b=[];let h=null;const v=[];for(const f of this.splitBasedOnMaterialID())v.push({vertexData:f,transform:O});for(const O of f)if(O.vertexData)for(const f of O.vertexData.splitBasedOnMaterialID())v.push({vertexData:f,transform:O.transform});v.sort(((O,f)=>{const y=O.vertexData.materialInfos?O.vertexData.materialInfos[0].materialIndex:0,S=f.vertexData.materialInfos?f.vertexData.materialInfos[0].materialIndex:0;return y>S?1:y===S?0:-1}));for(const O of v){const f=O.vertexData;if(y=f.materialInfos?f.materialInfos[0].materialIndex:0,h&&h.materialIndex===y)h.indexCount+=f.indices.length,h.verticesCount+=f.xa.length/3;else{const O=new I;O.materialIndex=y,O.indexStart=S,O.indexCount=f.indices.length,O.verticesStart=H,O.verticesCount=f.xa.length/3,b.push(O),h=O}S+=f.indices.length,H+=f.xa.length/3}const N=v.splice(0,1)[0];q=N.vertexData,O=N.transform,t=v.map((O=>O.vertexData)),f=v,this.materialInfos=b}const F=t.reduce(((O,f)=>{var y;return O+((null===(y=f.indices)||void 0===y?void 0:y.length)??0)}),(null===(y=q.indices)||void 0===y?void 0:y.length)??0);let J=v||t.some((O=>O.indices===q.indices))?null===(S=q.indices)||void 0===S?void 0:S.slice():q.indices;if(F>0){var X;let y=(null===(X=J)||void 0===X?void 0:X.length)??0;if(J||(J=new Array(F)),J.length!==F){if(Array.isArray(J))J.length=F;else{const O=H||J instanceof Uint32Array?new Uint32Array(F):new Uint16Array(F);O.set(J),J=O}O&&O.determinant()<0&&A._FlipFaces(J,0,y)}let S=q.xa?q.xa.length/3:0;for(const{vertexData:O,transform:H}of f)if(O.indices){for(let f=0;f<O.indices.length;f++)J[y+f]=O.indices[f]+S;H&&H.determinant()<0&&A._FlipFaces(J,y,O.indices.length),S+=O.xa.length/3,y+=O.indices.length,h&&(yield)}}return this.indices=J,this.xa=A._MergeElement(b.f.PositionKind,q.xa,O,f.map((O=>[O.vertexData.xa,O.transform]))),h&&(yield),q.ya&&(this.ya=A._MergeElement(b.f.NormalKind,q.ya,O,f.map((O=>[O.vertexData.ya,O.transform]))),h&&(yield)),q.tangents&&(this.tangents=A._MergeElement(b.f.TangentKind,q.tangents,O,f.map((O=>[O.vertexData.tangents,O.transform]))),h&&(yield)),q.Aa&&(this.Aa=A._MergeElement(b.f.UVKind,q.Aa,O,f.map((O=>[O.vertexData.Aa,O.transform]))),h&&(yield)),q.uvs2&&(this.uvs2=A._MergeElement(b.f.UV2Kind,q.uvs2,O,f.map((O=>[O.vertexData.uvs2,O.transform]))),h&&(yield)),q.uvs3&&(this.uvs3=A._MergeElement(b.f.UV3Kind,q.uvs3,O,f.map((O=>[O.vertexData.uvs3,O.transform]))),h&&(yield)),q.uvs4&&(this.uvs4=A._MergeElement(b.f.UV4Kind,q.uvs4,O,f.map((O=>[O.vertexData.uvs4,O.transform]))),h&&(yield)),q.uvs5&&(this.uvs5=A._MergeElement(b.f.UV5Kind,q.uvs5,O,f.map((O=>[O.vertexData.uvs5,O.transform]))),h&&(yield)),q.uvs6&&(this.uvs6=A._MergeElement(b.f.UV6Kind,q.uvs6,O,f.map((O=>[O.vertexData.uvs6,O.transform]))),h&&(yield)),q.za&&(this.za=A._MergeElement(b.f.ColorKind,q.za,O,f.map((O=>[O.vertexData.za,O.transform]))),(void 0!==q.hasVertexAlpha||f.some((O=>void 0!==O.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=q.hasVertexAlpha||f.some((O=>O.vertexData.hasVertexAlpha))),h&&(yield)),q.matricesIndices&&(this.matricesIndices=A._MergeElement(b.f.MatricesIndicesKind,q.matricesIndices,O,f.map((O=>[O.vertexData.matricesIndices,O.transform]))),h&&(yield)),q.matricesWeights&&(this.matricesWeights=A._MergeElement(b.f.MatricesWeightsKind,q.matricesWeights,O,f.map((O=>[O.vertexData.matricesWeights,O.transform]))),h&&(yield)),q.matricesIndicesExtra&&(this.matricesIndicesExtra=A._MergeElement(b.f.MatricesIndicesExtraKind,q.matricesIndicesExtra,O,f.map((O=>[O.vertexData.matricesIndicesExtra,O.transform]))),h&&(yield)),q.matricesWeightsExtra&&(this.matricesWeightsExtra=A._MergeElement(b.f.MatricesWeightsExtraKind,q.matricesWeightsExtra,O,f.map((O=>[O.vertexData.matricesWeightsExtra,O.transform])))),this}static _MergeElement(O,f,y,S){const H=S.filter((O=>null!==O[0]&&void 0!==O[0]));if(!f&&0==H.length)return f;if(!f)return this._MergeElement(O,H[0][0],H[0][1],H.slice(1));const h=H.reduce(((O,f)=>O+f[0].length),f.length),v=O===b.f.PositionKind?A._TransformVector3Coordinates:O===b.f.NormalKind?A._TransformVector3Normals:O===b.f.TangentKind?A._TransformVector4Normals:()=>{};if(f instanceof Float32Array){const O=new Float32Array(h);O.set(f),y&&v(O,y,0,f.length);let S=f.length;for(const[f,y]of H)O.set(f,S),y&&v(O,y,S,f.length),S+=f.length;return O}{const O=new Array(h);for(let y=0;y<f.length;y++)O[y]=f[y];y&&v(O,y,0,f.length);let S=f.length;for(const[f,y]of H){for(let y=0;y<f.length;y++)O[S+y]=f[y];y&&v(O,y,S,f.length),S+=f.length}return O}}_validate(){if(!this.xa)throw new q.l("Positions are required",q.i.MeshInvalidPositionsError);const O=(O,f)=>{const y=b.f.DeduceStride(O);if(f.length%y!==0)throw new Error("The "+O+"s array count must be a multiple of "+y);return f.length/y},f=O(b.f.PositionKind,this.xa),y=(y,S)=>{const H=O(y,S);if(H!==f)throw new Error("The "+y+"s element count ("+H+") does not match the positions count ("+f+")")};this.ya&&y(b.f.NormalKind,this.ya),this.tangents&&y(b.f.TangentKind,this.tangents),this.Aa&&y(b.f.UVKind,this.Aa),this.uvs2&&y(b.f.UV2Kind,this.uvs2),this.uvs3&&y(b.f.UV3Kind,this.uvs3),this.uvs4&&y(b.f.UV4Kind,this.uvs4),this.uvs5&&y(b.f.UV5Kind,this.uvs5),this.uvs6&&y(b.f.UV6Kind,this.uvs6),this.za&&y(b.f.ColorKind,this.za),this.matricesIndices&&y(b.f.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&y(b.f.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&y(b.f.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&y(b.f.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const O=this.serialize();return A.Parse(O)}serialize(){const O={};if(this.xa&&(O.xa=Array.from(this.xa)),this.ya&&(O.ya=Array.from(this.ya)),this.tangents&&(O.tangents=Array.from(this.tangents)),this.Aa&&(O.Aa=Array.from(this.Aa)),this.uvs2&&(O.uvs2=Array.from(this.uvs2)),this.uvs3&&(O.uvs3=Array.from(this.uvs3)),this.uvs4&&(O.uvs4=Array.from(this.uvs4)),this.uvs5&&(O.uvs5=Array.from(this.uvs5)),this.uvs6&&(O.uvs6=Array.from(this.uvs6)),this.za&&(O.za=Array.from(this.za),O.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(O.matricesIndices=Array.from(this.matricesIndices),O.matricesIndices._isExpanded=!0),this.matricesWeights&&(O.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(O.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),O.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(O.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),O.indices=Array.from(this.indices),this.materialInfos){O.materialInfos=[];for(const f of this.materialInfos){const y={indexStart:f.indexStart,indexCount:f.indexCount,materialIndex:f.materialIndex,verticesStart:f.verticesStart,verticesCount:f.verticesCount};O.materialInfos.push(y)}}return O}static ExtractFromMesh(O,f,y){return A._ExtractFrom(O,f,y)}static ExtractFromGeometry(O,f,y){return A._ExtractFrom(O,f,y)}static _ExtractFrom(O,f,y){const S=new A;if(O.isVerticesDataPresent(b.f.PositionKind)&&(S.xa=O.getVerticesData(b.f.PositionKind,f,y)),O.isVerticesDataPresent(b.f.NormalKind)&&(S.ya=O.getVerticesData(b.f.NormalKind,f,y)),O.isVerticesDataPresent(b.f.TangentKind)&&(S.tangents=O.getVerticesData(b.f.TangentKind,f,y)),O.isVerticesDataPresent(b.f.UVKind)&&(S.Aa=O.getVerticesData(b.f.UVKind,f,y)),O.isVerticesDataPresent(b.f.UV2Kind)&&(S.uvs2=O.getVerticesData(b.f.UV2Kind,f,y)),O.isVerticesDataPresent(b.f.UV3Kind)&&(S.uvs3=O.getVerticesData(b.f.UV3Kind,f,y)),O.isVerticesDataPresent(b.f.UV4Kind)&&(S.uvs4=O.getVerticesData(b.f.UV4Kind,f,y)),O.isVerticesDataPresent(b.f.UV5Kind)&&(S.uvs5=O.getVerticesData(b.f.UV5Kind,f,y)),O.isVerticesDataPresent(b.f.UV6Kind)&&(S.uvs6=O.getVerticesData(b.f.UV6Kind,f,y)),O.isVerticesDataPresent(b.f.ColorKind)){const H=O.Bj||O,h=H.getVertexBuffer(b.f.ColorKind),v=H.getVerticesData(b.f.ColorKind,f,y);if(3===h.getSize()){const O=new Float32Array(4*v.length/3);for(let f=0,y=0;f<v.length;f+=3,y+=4)O[y]=v[f],O[y+1]=v[f+1],O[y+2]=v[f+2],O[y+3]=1;S.za=O}else{if(4!==h.getSize())throw new Error(`Unexpected number of color components: ${h.getSize()}`);S.za=v}}return O.isVerticesDataPresent(b.f.MatricesIndicesKind)&&(S.matricesIndices=O.getVerticesData(b.f.MatricesIndicesKind,f,y)),O.isVerticesDataPresent(b.f.MatricesWeightsKind)&&(S.matricesWeights=O.getVerticesData(b.f.MatricesWeightsKind,f,y)),O.isVerticesDataPresent(b.f.MatricesIndicesExtraKind)&&(S.matricesIndicesExtra=O.getVerticesData(b.f.MatricesIndicesExtraKind,f,y)),O.isVerticesDataPresent(b.f.MatricesWeightsExtraKind)&&(S.matricesWeightsExtra=O.getVerticesData(b.f.MatricesWeightsExtraKind,f,y)),S.indices=O.Pf(f,y),S}static CreateRibbon(O){throw(0,h.d)("ribbonBuilder")}static CreateBox(O){throw(0,h.d)("boxBuilder")}static CreateTiledBox(O){throw(0,h.d)("tiledBoxBuilder")}static CreateTiledPlane(O){throw(0,h.d)("tiledPlaneBuilder")}static CreateSphere(O){throw(0,h.d)("sphereBuilder")}static CreateCylinder(O){throw(0,h.d)("cylinderBuilder")}static CreateTorus(O){throw(0,h.d)("torusBuilder")}static CreateLineSystem(O){throw(0,h.d)("linesBuilder")}static CreateDashedLines(O){throw(0,h.d)("linesBuilder")}static CreateGround(O){throw(0,h.d)("groundBuilder")}static CreateTiledGround(O){throw(0,h.d)("groundBuilder")}static CreateGroundFromHeightMap(O){throw(0,h.d)("groundBuilder")}static _f(O){throw(0,h.d)("planeBuilder")}static CreateDisc(O){throw(0,h.d)("discBuilder")}static CreatePolygon(O,f,y,S,H,b,v){throw(0,h.d)("polygonBuilder")}static CreateIcoSphere(O){throw(0,h.d)("icoSphereBuilder")}static CreatePolyhedron(O){throw(0,h.d)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||H.m.Up();throw(0,h.d)("capsuleBuilder")}static CreateTorusKnot(O){throw(0,h.d)("torusKnotBuilder")}static ComputeNormals(O,f,y,S){let b=0,h=0,v=0,N=0,m=0,t=0,q=0,F=0,I=0,A=0,J=0,X=0,w=0,B=0,j=0,u=0,L=0,p=0,U=0,l=0,x=!1,W=!1,E=!1,o=!1,i=1,D=0,V=null;S&&(x=!!S.facetNormals,W=!!S.facetPositions,E=!!S.facetPartitioning,i=!0===S.useRightHandedSystem?-1:1,D=S.ratio||0,o=!!S.depthSort,V=S.distanceTo,o&&void 0===V&&(V=H.m.Zero()));let g=0,R=0,s=0,k=0;for(E&&S&&S.bbSize&&(g=S.subDiv.X*D/S.bbSize.x,R=S.subDiv.Y*D/S.bbSize.y,s=S.subDiv.Z*D/S.bbSize.z,k=S.subDiv.max*S.subDiv.max,S.facetPartitioning.length=0),b=0;b<O.length;b++)y[b]=0;const z=f.length/3|0;for(b=0;b<z;b++){if(X=3*f[3*b],w=X+1,B=X+2,j=3*f[3*b+1],u=j+1,L=j+2,p=3*f[3*b+2],U=p+1,l=p+2,h=O[X]-O[j],v=O[w]-O[u],N=O[B]-O[L],m=O[p]-O[j],t=O[U]-O[u],q=O[l]-O[L],F=i*(v*q-N*t),I=i*(N*m-h*q),A=i*(h*t-v*m),J=Math.sqrt(F*F+I*I+A*A),J=0===J?1:J,F/=J,I/=J,A/=J,x&&S&&(S.facetNormals[b].x=F,S.facetNormals[b].y=I,S.facetNormals[b].z=A),W&&S&&(S.facetPositions[b].x=(O[X]+O[j]+O[p])/3,S.facetPositions[b].y=(O[w]+O[u]+O[U])/3,S.facetPositions[b].z=(O[B]+O[L]+O[l])/3),E&&S){const f=Math.floor((S.facetPositions[b].x-S.bInfo.minimum.x*D)*g),y=Math.floor((S.facetPositions[b].y-S.bInfo.minimum.y*D)*R),H=Math.floor((S.facetPositions[b].z-S.bInfo.minimum.z*D)*s),h=Math.floor((O[X]-S.bInfo.minimum.x*D)*g),v=Math.floor((O[w]-S.bInfo.minimum.y*D)*R),N=Math.floor((O[B]-S.bInfo.minimum.z*D)*s),m=Math.floor((O[j]-S.bInfo.minimum.x*D)*g),t=Math.floor((O[u]-S.bInfo.minimum.y*D)*R),q=Math.floor((O[L]-S.bInfo.minimum.z*D)*s),F=Math.floor((O[p]-S.bInfo.minimum.x*D)*g),I=Math.floor((O[U]-S.bInfo.minimum.y*D)*R),A=Math.floor((O[l]-S.bInfo.minimum.z*D)*s),J=h+S.subDiv.max*v+k*N,x=m+S.subDiv.max*t+k*q,W=F+S.subDiv.max*I+k*A,E=f+S.subDiv.max*y+k*H;S.facetPartitioning[E]=S.facetPartitioning[E]?S.facetPartitioning[E]:new Array,S.facetPartitioning[J]=S.facetPartitioning[J]?S.facetPartitioning[J]:new Array,S.facetPartitioning[x]=S.facetPartitioning[x]?S.facetPartitioning[x]:new Array,S.facetPartitioning[W]=S.facetPartitioning[W]?S.facetPartitioning[W]:new Array,S.facetPartitioning[J].push(b),x!=J&&S.facetPartitioning[x].push(b),W!=x&&W!=J&&S.facetPartitioning[W].push(b),E!=J&&E!=x&&E!=W&&S.facetPartitioning[E].push(b)}if(o&&S&&S.facetPositions){const O=S.depthSortedFacets[b];O.ind=3*b,O.sqDistance=H.m.DistanceSquared(S.facetPositions[b],V)}y[X]+=F,y[w]+=I,y[B]+=A,y[j]+=F,y[u]+=I,y[L]+=A,y[p]+=F,y[U]+=I,y[l]+=A}for(b=0;b<y.length/3;b++)F=y[3*b],I=y[3*b+1],A=y[3*b+2],J=Math.sqrt(F*F+I*I+A*A),J=0===J?1:J,F/=J,I/=J,A/=J,y[3*b]=F,y[3*b+1]=I,y[3*b+2]=A}static _ComputeSides(O,f,y,S,b,h,v){const N=y.length,m=S.length;let t,q;switch(O=O||A.DEFAULTSIDE){case A.FRONTSIDE:break;case A.BACKSIDE:for(t=0;t<N;t+=3){const O=y[t];y[t]=y[t+2],y[t+2]=O}for(q=0;q<m;q++)S[q]=-S[q];break;case A.DOUBLESIDE:{const O=f.length,F=O/3;for(let y=0;y<O;y++)f[O+y]=f[y];for(t=0;t<N;t+=3)y[t+N]=y[t+2]+F,y[t+1+N]=y[t+1]+F,y[t+2+N]=y[t]+F;for(q=0;q<m;q++)S[m+q]=-S[q];const I=b.length;let A=0;for(A=0;A<I;A++)b[A+I]=b[A];for(h=h||new H.q(0,0,1,1),v=v||new H.q(0,0,1,1),A=0,t=0;t<I/2;t++)b[A]=h.x+(h.z-h.x)*b[A],b[A+1]=h.y+(h.w-h.y)*b[A+1],b[A+I]=v.x+(v.z-v.x)*b[A+I],b[A+I+1]=v.y+(v.w-v.y)*b[A+I+1],A+=2;break}}}static Parse(O){const f=new A,y=O.xa;y&&f.set(y,b.f.PositionKind);const S=O.ya;S&&f.set(S,b.f.NormalKind);const H=O.tangents;H&&f.set(H,b.f.TangentKind);const h=O.Aa;h&&f.set(h,b.f.UVKind);const N=O.uvs2;N&&f.set(N,b.f.UV2Kind);const m=O.uvs3;m&&f.set(m,b.f.UV3Kind);const t=O.uvs4;t&&f.set(t,b.f.UV4Kind);const q=O.uvs5;q&&f.set(q,b.f.UV5Kind);const F=O.uvs6;F&&f.set(F,b.f.UV6Kind);const J=O.za;J&&(f.set(v.g.CheckColors4(J,y.length/3),b.f.ColorKind),void 0!==O.hasVertexAlpha&&(f.hasVertexAlpha=O.hasVertexAlpha));const X=O.matricesIndices;X&&f.set(X,b.f.MatricesIndicesKind);const w=O.matricesWeights;w&&f.set(w,b.f.MatricesWeightsKind);const B=O.indices;B&&(f.indices=B);const j=O.materialInfos;if(j){f.materialInfos=[];for(const O of j){const y=new I;y.indexCount=O.indexCount,y.indexStart=O.indexStart,y.verticesCount=O.verticesCount,y.verticesStart=O.verticesStart,y.materialIndex=O.materialIndex,f.materialInfos.push(y)}}return f}static ImportVertexData(O,f){const y=A.Parse(O);f.setAllVerticesData(y,O.updatable)}}A.FRONTSIDE=0,A.BACKSIDE=1,A.DOUBLESIDE=2,A.DEFAULTSIDE=0,A._UniqueIDGenerator=0,(0,S.b)([m.e.filter((function(){for(var O=arguments.length,f=new Array(O),y=0;y<O;y++)f[y]=arguments[y];let[S]=f;return!Array.isArray(S)}))],A,"_TransformVector3Coordinates",null),(0,S.b)([m.e.filter((function(){for(var O=arguments.length,f=new Array(O),y=0;y<O;y++)f[y]=arguments[y];let[S]=f;return!Array.isArray(S)}))],A,"_TransformVector3Normals",null),(0,S.b)([m.e.filter((function(){for(var O=arguments.length,f=new Array(O),y=0;y<O;y++)f[y]=arguments[y];let[S]=f;return!Array.isArray(S)}))],A,"_TransformVector4Normals",null),(0,S.b)([m.e.filter((function(){for(var O=arguments.length,f=new Array(O),y=0;y<O;y++)f[y]=arguments[y];let[S]=f;return!Array.isArray(S)}))],A,"_FlipFaces",null)},12646:(O,f,y)=>{"use strict";y.d(f,{e:()=>JO});var S=y(11324),H=y(11557),b=y(11392),h=y(11577),v=y(11526);function N(O){let f=O.pathArray;const y=O.closeArray||!1,S=O.closePath||!1,H=O.invertUV||!1,N=Math.floor(f[0].length/2);let m=O.offset||N;m=m>N?N:Math.floor(m);const t=0===O.sideOrientation?0:O.sideOrientation||h.c.DEFAULTSIDE,q=O.Aa,F=O.za,I=[],A=[],J=[],X=[],w=[],B=[],j=[],u=[];let L;const p=[],U=[];let l,x,W;if(f.length<2){const O=[],y=[];for(x=0;x<f[0].length-m;x++)O.push(f[0][x]),y.push(f[0][x+m]);f=[O,y]}let E=0;const o=S?1:0,i=y?1:0;let D,V,g,R,s,k;for(L=f[0].length,l=0;l<f.length+i;l++){for(j[l]=0,w[l]=[0],D=l===f.length?f[0]:f[l],V=D.length,L=L<V?L:V,W=0;W<V;)I.push(D[W].x,D[W].y,D[W].z),W>0&&(g=D[W].xc(D[W-1]).length(),R=g+j[l],w[l].push(R),j[l]=R),W++;S&&(W--,I.push(D[0].x,D[0].y,D[0].z),g=D[W].xc(D[0]).length(),R=g+j[l],w[l].push(R),j[l]=R),p[l]=V+o,U[l]=E,E+=V+o}let z,c,d=null,G=null;for(x=0;x<L+o;x++)for(u[x]=0,B[x]=[0],l=0;l<f.length-1+i;l++)s=f[l],k=l===f.length-1?f[0]:f[l+1],x===L?(d=s[0],G=k[0]):(d=s[x],G=k[x]),g=G.xc(d).length(),R=g+u[x],B[x].push(R),u[x]=R;if(q)for(l=0;l<q.length;l++)X.push(q[l].x,v.b?1-q[l].y:q[l].y);else for(l=0;l<f.length+i;l++)for(x=0;x<L+o;x++)z=0!=j[l]?w[l][x]/j[l]:0,c=0!=u[x]?B[x][l]/u[x]:0,H?X.push(c,z):X.push(z,v.b?1-c:c);l=0;let Y=0,Z=p[l]-1,a=p[l+1]-1,M=Z<a?Z:a,P=U[1]-U[0];const e=p.length-1;for(;Y<=M&&l<e;)A.push(Y,Y+P,Y+1),A.push(Y+P+1,Y+1,Y+P),Y+=1,Y===M&&(l++,P=U[l+1]-U[l],Z=p[l]-1,a=p[l+1]-1,Y=U[l],M=Z<a?Z+Y:a+Y);if(h.c.ComputeNormals(I,A,J),S){let O=0,y=0;for(l=0;l<f.length;l++){O=3*U[l],y=l+1<f.length?3*(U[l+1]-1):J.length-3,J[O]=.5*(J[O]+J[y]),J[O+1]=.5*(J[O+1]+J[y+1]),J[O+2]=.5*(J[O+2]+J[y+2]);const S=Math.sqrt(J[O]*J[O]+J[O+1]*J[O+1]+J[O+2]*J[O+2]);J[O]/=S,J[O+1]/=S,J[O+2]/=S,J[y]=J[O],J[y+1]=J[O+1],J[y+2]=J[O+2]}}if(y){let O=3*U[0],y=3*U[f.length];for(x=0;x<L+o;x++){J[O]=.5*(J[O]+J[y]),J[O+1]=.5*(J[O+1]+J[y+1]),J[O+2]=.5*(J[O+2]+J[y+2]);const f=Math.sqrt(J[O]*J[O]+J[O+1]*J[O+1]+J[O+2]*J[O+2]);J[O]/=f,J[O+1]/=f,J[O+2]/=f,J[y]=J[O],J[y+1]=J[O+1],J[y+2]=J[O+2],O+=3,y+=3}}h.c._ComputeSides(t,I,A,J,X,O.frontUVs,O.backUVs);let K=null;if(F){K=new Float32Array(4*F.length);for(let O=0;O<F.length;O++)K[4*O]=F[O].r,K[4*O+1]=F[O].g,K[4*O+2]=F[O].b,K[4*O+3]=F[O].a}const T=new h.c,Q=new Float32Array(I),C=new Float32Array(J),r=new Float32Array(X);return T.indices=A,T.xa=Q,T.ya=C,T.Aa=r,K&&T.set(K,b.f.ColorKind),S&&(T._idx=U),T}function m(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const m=f.pathArray,t=f.closeArray,q=f.closePath,F=H.d._GetDefaultSideOrientation(f.sideOrientation),I=f.instance,A=f.updatable;if(I){const O=S.g.fb[0].Wd(Number.MAX_VALUE),y=S.g.fb[1].Wd(-Number.MAX_VALUE),N=f=>{let S=m[0].length;const b=I;let h=0;const v=b._originalBuilderSideOrientation===H.d.DOUBLESIDE?2:1;for(let H=1;H<=v;++H)for(let v=0;v<m.length;++v){const H=m[v],N=H.length;S=S<N?S:N;for(let b=0;b<S;++b){const S=H[b];f[h]=S.x,f[h+1]=S.y,f[h+2]=S.z,O.minimizeInPlaceFromFloats(S.x,S.y,S.z),y.maximizeInPlaceFromFloats(S.x,S.y,S.z),h+=3}if(b._creationDataStorage&&b._creationDataStorage.closePath){const O=H[0];f[h]=O.x,f[h+1]=O.y,f[h+2]=O.z,h+=3}}},t=I.getVerticesData(b.f.PositionKind);if(N(t),I.hasBoundingInfo?I.getBoundingInfo().reConstruct(O,y,I._worldMatrix):I.buildBoundingInfo(O,y,I._worldMatrix),I.updateVerticesData(b.f.PositionKind,t,!1,!1),f.za){const O=I.getVerticesData(b.f.ColorKind);for(let y=0,S=0;y<f.za.length;y++,S+=4){const H=f.za[y];O[S]=H.r,O[S+1]=H.g,O[S+2]=H.b,O[S+3]=H.a}I.updateVerticesData(b.f.ColorKind,O,!1,!1)}if(f.Aa){const O=I.getVerticesData(b.f.UVKind);for(let y=0;y<f.Aa.length;y++)O[2*y]=f.Aa[y].x,O[2*y+1]=v.b?1-f.Aa[y].y:f.Aa[y].y;I.updateVerticesData(b.f.UVKind,O,!1,!1)}if(!I.areNormalsFrozen||I.isFacetDataEnabled){const O=I.Pf(),f=I.getVerticesData(b.f.NormalKind),y=I.isFacetDataEnabled?I.getFacetDataParameters():null;if(h.c.ComputeNormals(t,O,f,y),I._creationDataStorage&&I._creationDataStorage.closePath){let O=0,y=0;for(let S=0;S<m.length;S++)O=3*I._creationDataStorage.idx[S],y=S+1<m.length?3*(I._creationDataStorage.idx[S+1]-1):f.length-3,f[O]=.5*(f[O]+f[y]),f[O+1]=.5*(f[O+1]+f[y+1]),f[O+2]=.5*(f[O+2]+f[y+2]),f[y]=f[O],f[y+1]=f[O+1],f[y+2]=f[O+2]}I.areNormalsFrozen||I.updateVerticesData(b.f.NormalKind,f,!1,!1)}return I}{const S=new H.d(O,y);S._originalBuilderSideOrientation=F,S._creationDataStorage=new H.g;const b=N(f);return q&&(S._creationDataStorage.idx=b._idx),S._creationDataStorage.closePath=q,S._creationDataStorage.closeArray=t,b.Ca(S,A),S}}h.c.CreateRibbon=N,H.d.CreateRibbon=function(O,f){return m(O,{pathArray:f,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var t=y(11915),q=y(11617),F=y(11359);function I(O){const f=O.pattern||H.d.NO_FLIP,y=O.tileWidth||O.tileSize||1,S=O.tileHeight||O.tileSize||1,b=O.alignHorizontal||0,v=O.alignVertical||0,N=O.width||O.size||1,m=Math.floor(N/y);let t=N-m*y;const q=O.height||O.size||1,F=Math.floor(q/S);let I=q-F*S;const A=y*m/2,J=S*F/2;let X=0,w=0,B=0,j=0,u=0,L=0;if(t>0||I>0){switch(B=-A,j=-J,u=A,L=J,b){case H.d.CENTER:t/=2,B-=t,u+=t;break;case H.d.LEFT:u+=t,X=-t/2;break;case H.d.RIGHT:B-=t,X=t/2}switch(v){case H.d.CENTER:I/=2,j-=I,L+=I;break;case H.d.BOTTOM:L+=I,w=-I/2;break;case H.d.TOP:j-=I,w=I/2}}const p=[],U=[],l=[];l[0]=[0,0,1,0,1,1,0,1],l[1]=[0,0,1,0,1,1,0,1],f!==H.d.ROTATE_TILE&&f!==H.d.ROTATE_ROW||(l[1]=[1,1,0,1,0,0,1,0]),f!==H.d.FLIP_TILE&&f!==H.d.FLIP_ROW||(l[1]=[1,0,0,0,0,1,1,1]),f!==H.d.FLIP_N_ROTATE_TILE&&f!==H.d.FLIP_N_ROTATE_ROW||(l[1]=[0,1,1,1,1,0,0,0]);let x=[];const W=[],E=[];let o=0;for(let h=0;h<F;h++)for(let O=0;O<m;O++)p.push(O*y-A+X,h*S-J+w,0),p.push((O+1)*y-A+X,h*S-J+w,0),p.push((O+1)*y-A+X,(h+1)*S-J+w,0),p.push(O*y-A+X,(h+1)*S-J+w,0),E.push(o,o+1,o+3,o+1,o+2,o+3),x=f===H.d.FLIP_TILE||f===H.d.ROTATE_TILE||f===H.d.FLIP_N_ROTATE_TILE?x.concat(l[(O%2+h%2)%2]):f===H.d.FLIP_ROW||f===H.d.ROTATE_ROW||f===H.d.FLIP_N_ROTATE_ROW?x.concat(l[h%2]):x.concat(l[0]),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),U.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),o+=4;if(t>0||I>0){const O=I>0&&(v===H.d.CENTER||v===H.d.TOP),h=I>0&&(v===H.d.CENTER||v===H.d.BOTTOM),N=t>0&&(b===H.d.CENTER||b===H.d.RIGHT),q=t>0&&(b===H.d.CENTER||b===H.d.LEFT);let l,i,D,V,g=[];if(O&&N&&(p.push(B+X,j+w,0),p.push(-A+X,j+w,0),p.push(-A+X,j+I+w,0),p.push(B+X,j+I+w,0),E.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,l=1-t/y,i=1-I/S,D=1,V=1,g=[l,i,D,i,D,V,l,V],f===H.d.ROTATE_ROW&&(g=[1-l,1-i,1-D,1-i,1-D,1-V,1-l,1-V]),f===H.d.FLIP_ROW&&(g=[1-l,i,1-D,i,1-D,V,1-l,V]),f===H.d.FLIP_N_ROTATE_ROW&&(g=[l,1-i,D,1-i,D,1-V,l,1-V]),x=x.concat(g),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),U.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),O&&q&&(p.push(A+X,j+w,0),p.push(u+X,j+w,0),p.push(u+X,j+I+w,0),p.push(A+X,j+I+w,0),E.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,l=0,i=1-I/S,D=t/y,V=1,g=[l,i,D,i,D,V,l,V],(f===H.d.ROTATE_ROW||f===H.d.ROTATE_TILE&&m%2===0)&&(g=[1-l,1-i,1-D,1-i,1-D,1-V,1-l,1-V]),(f===H.d.FLIP_ROW||f===H.d.FLIP_TILE&&m%2===0)&&(g=[1-l,i,1-D,i,1-D,V,1-l,V]),(f===H.d.FLIP_N_ROTATE_ROW||f===H.d.FLIP_N_ROTATE_TILE&&m%2===0)&&(g=[l,1-i,D,1-i,D,1-V,l,1-V]),x=x.concat(g),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),U.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),h&&N&&(p.push(B+X,J+w,0),p.push(-A+X,J+w,0),p.push(-A+X,L+w,0),p.push(B+X,L+w,0),E.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,l=1-t/y,i=0,D=1,V=I/S,g=[l,i,D,i,D,V,l,V],(f===H.d.ROTATE_ROW&&F%2===1||f===H.d.ROTATE_TILE&&F%1===0)&&(g=[1-l,1-i,1-D,1-i,1-D,1-V,1-l,1-V]),(f===H.d.FLIP_ROW&&F%2===1||f===H.d.FLIP_TILE&&F%2===0)&&(g=[1-l,i,1-D,i,1-D,V,1-l,V]),(f===H.d.FLIP_N_ROTATE_ROW&&F%2===1||f===H.d.FLIP_N_ROTATE_TILE&&F%2===0)&&(g=[l,1-i,D,1-i,D,1-V,l,1-V]),x=x.concat(g),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),U.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),h&&q&&(p.push(A+X,J+w,0),p.push(u+X,J+w,0),p.push(u+X,L+w,0),p.push(A+X,L+w,0),E.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,l=0,i=0,D=t/y,V=I/S,g=[l,i,D,i,D,V,l,V],(f===H.d.ROTATE_ROW&&F%2===1||f===H.d.ROTATE_TILE&&(F+m)%2===1)&&(g=[1-l,1-i,1-D,1-i,1-D,1-V,1-l,1-V]),(f===H.d.FLIP_ROW&&F%2===1||f===H.d.FLIP_TILE&&(F+m)%2===1)&&(g=[1-l,i,1-D,i,1-D,V,1-l,V]),(f===H.d.FLIP_N_ROTATE_ROW&&F%2===1||f===H.d.FLIP_N_ROTATE_TILE&&(F+m)%2===1)&&(g=[l,1-i,D,1-i,D,1-V,l,1-V]),x=x.concat(g),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),U.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),O){const O=[];l=0,i=1-I/S,D=1,V=1,O[0]=[l,i,D,i,D,V,l,V],O[1]=[l,i,D,i,D,V,l,V],f!==H.d.ROTATE_TILE&&f!==H.d.ROTATE_ROW||(O[1]=[1-l,1-i,1-D,1-i,1-D,1-V,1-l,1-V]),f!==H.d.FLIP_TILE&&f!==H.d.FLIP_ROW||(O[1]=[1-l,i,1-D,i,1-D,V,1-l,V]),f!==H.d.FLIP_N_ROTATE_TILE&&f!==H.d.FLIP_N_ROTATE_ROW||(O[1]=[l,1-i,D,1-i,D,1-V,l,1-V]);for(let S=0;S<m;S++)p.push(S*y-A+X,j+w,0),p.push((S+1)*y-A+X,j+w,0),p.push((S+1)*y-A+X,j+I+w,0),p.push(S*y-A+X,j+I+w,0),E.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,x=f===H.d.FLIP_TILE||f===H.d.ROTATE_TILE||f===H.d.FLIP_N_ROTATE_TILE?x.concat(O[(S+1)%2]):f===H.d.FLIP_ROW||f===H.d.ROTATE_ROW||f===H.d.FLIP_N_ROTATE_ROW?x.concat(O[1]):x.concat(O[0]),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),U.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(h){const O=[];l=0,i=0,D=1,V=I/S,O[0]=[l,i,D,i,D,V,l,V],O[1]=[l,i,D,i,D,V,l,V],f!==H.d.ROTATE_TILE&&f!==H.d.ROTATE_ROW||(O[1]=[1-l,1-i,1-D,1-i,1-D,1-V,1-l,1-V]),f!==H.d.FLIP_TILE&&f!==H.d.FLIP_ROW||(O[1]=[1-l,i,1-D,i,1-D,V,1-l,V]),f!==H.d.FLIP_N_ROTATE_TILE&&f!==H.d.FLIP_N_ROTATE_ROW||(O[1]=[l,1-i,D,1-i,D,1-V,l,1-V]);for(let S=0;S<m;S++)p.push(S*y-A+X,L-I+w,0),p.push((S+1)*y-A+X,L-I+w,0),p.push((S+1)*y-A+X,L+w,0),p.push(S*y-A+X,L+w,0),E.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,x=f===H.d.FLIP_TILE||f===H.d.ROTATE_TILE||f===H.d.FLIP_N_ROTATE_TILE?x.concat(O[(S+F)%2]):f===H.d.FLIP_ROW||f===H.d.ROTATE_ROW||f===H.d.FLIP_N_ROTATE_ROW?x.concat(O[F%2]):x.concat(O[0]),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),U.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(N){const O=[];l=1-t/y,i=0,D=1,V=1,O[0]=[l,i,D,i,D,V,l,V],O[1]=[l,i,D,i,D,V,l,V],f!==H.d.ROTATE_TILE&&f!==H.d.ROTATE_ROW||(O[1]=[1-l,1-i,1-D,1-i,1-D,1-V,1-l,1-V]),f!==H.d.FLIP_TILE&&f!==H.d.FLIP_ROW||(O[1]=[1-l,i,1-D,i,1-D,V,1-l,V]),f!==H.d.FLIP_N_ROTATE_TILE&&f!==H.d.FLIP_N_ROTATE_ROW||(O[1]=[l,1-i,D,1-i,D,1-V,l,1-V]);for(let y=0;y<F;y++)p.push(B+X,y*S-J+w,0),p.push(B+t+X,y*S-J+w,0),p.push(B+t+X,(y+1)*S-J+w,0),p.push(B+X,(y+1)*S-J+w,0),E.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,x=f===H.d.FLIP_TILE||f===H.d.ROTATE_TILE||f===H.d.FLIP_N_ROTATE_TILE?x.concat(O[(y+1)%2]):f===H.d.FLIP_ROW||f===H.d.ROTATE_ROW||f===H.d.FLIP_N_ROTATE_ROW?x.concat(O[y%2]):x.concat(O[0]),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),U.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(q){const O=[];l=0,i=0,D=t/S,V=1,O[0]=[l,i,D,i,D,V,l,V],O[1]=[l,i,D,i,D,V,l,V],f!==H.d.ROTATE_TILE&&f!==H.d.ROTATE_ROW||(O[1]=[1-l,1-i,1-D,1-i,1-D,1-V,1-l,1-V]),f!==H.d.FLIP_TILE&&f!==H.d.FLIP_ROW||(O[1]=[1-l,i,1-D,i,1-D,V,1-l,V]),f!==H.d.FLIP_N_ROTATE_TILE&&f!==H.d.FLIP_N_ROTATE_ROW||(O[1]=[l,1-i,D,1-i,D,1-V,l,1-V]);for(let y=0;y<F;y++)p.push(u-t+X,y*S-J+w,0),p.push(u+X,y*S-J+w,0),p.push(u+X,(y+1)*S-J+w,0),p.push(u-t+X,(y+1)*S-J+w,0),E.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,x=f===H.d.FLIP_TILE||f===H.d.ROTATE_TILE||f===H.d.FLIP_N_ROTATE_TILE?x.concat(O[(y+m)%2]):f===H.d.FLIP_ROW||f===H.d.ROTATE_ROW||f===H.d.FLIP_N_ROTATE_ROW?x.concat(O[y%2]):x.concat(O[0]),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),U.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const i=0===O.sideOrientation?0:O.sideOrientation||h.c.DEFAULTSIDE;h.c._ComputeSides(i,p,E,U,x,O.frontUVs,O.backUVs);const D=new h.c;D.indices=E,D.xa=p,D.ya=U,D.Aa=x;const V=i===h.c.DOUBLESIDE?W.concat(W):W;return D.za=V,D}function A(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new H.d(O,y);f.sideOrientation=H.d._GetDefaultSideOrientation(f.sideOrientation),S._originalBuilderSideOrientation=f.sideOrientation;return I(f).Ca(S,f.updatable),S}function J(O){const f=O.faceUV||new Array(6),y=O.faceColors,b=O.pattern||H.d.NO_FLIP,N=O.width||O.size||1,m=O.height||O.size||1,t=O.depth||O.size||1,q=O.tileWidth||O.tileSize||1,A=O.tileHeight||O.tileSize||1,J=O.alignHorizontal||0,X=O.alignVertical||0,w=0===O.sideOrientation?0:O.sideOrientation||h.c.DEFAULTSIDE;for(let H=0;H<6;H++)void 0===f[H]&&(f[H]=new S.q(0,0,1,1)),y&&void 0===y[H]&&(y[H]=new F.g(1,1,1,1));const B=N/2,j=m/2,u=t/2,L=[];for(let S=0;S<2;S++)L[S]=I({pattern:b,tileWidth:q,tileHeight:A,width:N,height:m,alignVertical:X,alignHorizontal:J,sideOrientation:w});for(let S=2;S<4;S++)L[S]=I({pattern:b,tileWidth:q,tileHeight:A,width:t,height:m,alignVertical:X,alignHorizontal:J,sideOrientation:w});let p=X;X===H.d.BOTTOM?p=H.d.TOP:X===H.d.TOP&&(p=H.d.BOTTOM);for(let S=4;S<6;S++)L[S]=I({pattern:b,tileWidth:q,tileHeight:A,width:N,height:t,alignVertical:p,alignHorizontal:J,sideOrientation:w});let U=[],l=[],x=[],W=[];const E=[],o=[],i=[],D=[];let V=0,g=0;for(let H=0;H<6;H++){const O=L[H].xa.length;o[H]=[],i[H]=[];for(let f=0;f<O/3;f++)o[H].push(new S.m(L[H].xa[3*f],L[H].xa[3*f+1],L[H].xa[3*f+2])),i[H].push(new S.m(L[H].ya[3*f],L[H].ya[3*f+1],L[H].ya[3*f+2]));V=L[H].Aa.length,D[H]=[];for(let y=0;y<V;y+=2)D[H][y]=f[H].x+(f[H].z-f[H].x)*L[H].Aa[y],D[H][y+1]=f[H].y+(f[H].w-f[H].y)*L[H].Aa[y+1],v.b&&(D[H][y+1]=1-D[H][y+1]);if(x=x.concat(D[H]),W=W.concat(L[H].indices.map((O=>O+g))),g+=o[H].length,y)for(let f=0;f<4;f++)E.push(y[H].r,y[H].g,y[H].b,y[H].a)}const R=new S.m(0,0,u),s=S.b.RotationY(Math.PI);U=o[0].map((O=>S.m.TransformNormal(O,s).add(R))).map((O=>[O.x,O.y,O.z])).reduce(((O,f)=>O.concat(f)),[]),l=i[0].map((O=>S.m.TransformNormal(O,s))).map((O=>[O.x,O.y,O.z])).reduce(((O,f)=>O.concat(f)),[]),U=U.concat(o[1].map((O=>O.xc(R))).map((O=>[O.x,O.y,O.z])).reduce(((O,f)=>O.concat(f)),[])),l=l.concat(i[1].map((O=>[O.x,O.y,O.z])).reduce(((O,f)=>O.concat(f)),[]));const k=new S.m(B,0,0),z=S.b.RotationY(-Math.PI/2);U=U.concat(o[2].map((O=>S.m.TransformNormal(O,z).add(k))).map((O=>[O.x,O.y,O.z])).reduce(((O,f)=>O.concat(f)),[])),l=l.concat(i[2].map((O=>S.m.TransformNormal(O,z))).map((O=>[O.x,O.y,O.z])).reduce(((O,f)=>O.concat(f)),[]));const c=S.b.RotationY(Math.PI/2);U=U.concat(o[3].map((O=>S.m.TransformNormal(O,c).xc(k))).map((O=>[O.x,O.y,O.z])).reduce(((O,f)=>O.concat(f)),[])),l=l.concat(i[3].map((O=>S.m.TransformNormal(O,c))).map((O=>[O.x,O.y,O.z])).reduce(((O,f)=>O.concat(f)),[]));const d=new S.m(0,j,0),G=S.b.RotationX(Math.PI/2);U=U.concat(o[4].map((O=>S.m.TransformNormal(O,G).add(d))).map((O=>[O.x,O.y,O.z])).reduce(((O,f)=>O.concat(f)),[])),l=l.concat(i[4].map((O=>S.m.TransformNormal(O,G))).map((O=>[O.x,O.y,O.z])).reduce(((O,f)=>O.concat(f)),[]));const Y=S.b.RotationX(-Math.PI/2);U=U.concat(o[5].map((O=>S.m.TransformNormal(O,Y).xc(d))).map((O=>[O.x,O.y,O.z])).reduce(((O,f)=>O.concat(f)),[])),l=l.concat(i[5].map((O=>S.m.TransformNormal(O,Y))).map((O=>[O.x,O.y,O.z])).reduce(((O,f)=>O.concat(f)),[])),h.c._ComputeSides(w,U,W,l,x);const Z=new h.c;if(Z.indices=W,Z.xa=U,Z.ya=l,Z.Aa=x,y){const O=w===h.c.DOUBLESIDE?E.concat(E):E;Z.za=O}return Z}function X(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new H.d(O,y);f.sideOrientation=H.d._GetDefaultSideOrientation(f.sideOrientation),S._originalBuilderSideOrientation=f.sideOrientation;return J(f).Ca(S,f.updatable),S}h.c.CreateTiledPlane=I;h.c.CreateTiledBox=J;var w=y(11907),B=y(11311),j=y(11606);function u(O){const f=O.height||2;let y=0===O.diameterTop?0:O.diameterTop||O.diameter||1,b=0===O.diameterBottom?0:O.diameterBottom||O.diameter||1;y=y||1e-5,b=b||1e-5;const N=0|(O.tessellation||24),m=0|(O.subdivisions||1),t=!!O.hasRings,q=!!O.enclose,I=0===O.cap?0:O.cap||H.d.CAP_ALL,A=O.arc&&(O.arc<=0||O.arc>1)?1:O.arc||1,J=0===O.sideOrientation?0:O.sideOrientation||h.c.DEFAULTSIDE,X=O.faceUV||new Array(3),w=O.faceColors,B=2+(1+(1!==A&&q?2:0))*(t?m:1);let u;for(u=0;u<B;u++)w&&void 0===w[u]&&(w[u]=new F.g(1,1,1,1));for(u=0;u<B;u++)X&&void 0===X[u]&&(X[u]=new S.q(0,0,1,1));const L=[],p=[],U=[],l=[],x=[],W=2*Math.PI*A/N;let E,o,i;const D=(b-y)/2/f,V=S.m.Zero(),g=S.m.Zero(),R=S.m.Zero(),s=S.m.Zero(),k=S.m.Zero(),z=j.c.Y;let c,d,G,Y=1,Z=1,a=0,M=0;for(c=0;c<=m;c++)for(o=c/m,i=(o*(y-b)+b)/2,Y=t&&0!==c&&c!==m?2:1,G=0;G<Y;G++){for(t&&(Z+=G),q&&(Z+=2*G),d=0;d<=N;d++)E=d*W,V.x=Math.cos(-E)*i,V.y=-f/2+o*f,V.z=Math.sin(-E)*i,0===y&&c===m?(g.x=U[U.length-3*(N+1)],g.y=U[U.length-3*(N+1)+1],g.z=U[U.length-3*(N+1)+2]):(g.x=V.x,g.z=V.z,g.y=Math.sqrt(g.x*g.x+g.z*g.z)*D,g.normalize()),0===d&&(R.p(V),s.p(g)),p.push(V.x,V.y,V.z),U.push(g.x,g.y,g.z),M=t?a!==Z?X[Z].y:X[Z].w:X[Z].y+(X[Z].w-X[Z].y)*o,l.push(X[Z].x+(X[Z].z-X[Z].x)*d/N,v.b?1-M:M),w&&x.push(w[Z].r,w[Z].g,w[Z].b,w[Z].a);1!==A&&q&&(p.push(V.x,V.y,V.z),p.push(0,V.y,0),p.push(0,V.y,0),p.push(R.x,R.y,R.z),S.m.CrossToRef(z,g,k),k.normalize(),U.push(k.x,k.y,k.z,k.x,k.y,k.z),S.m.CrossToRef(s,z,k),k.normalize(),U.push(k.x,k.y,k.z,k.x,k.y,k.z),M=t?a!==Z?X[Z+1].y:X[Z+1].w:X[Z+1].y+(X[Z+1].w-X[Z+1].y)*o,l.push(X[Z+1].x,v.b?1-M:M),l.push(X[Z+1].z,v.b?1-M:M),M=t?a!==Z?X[Z+2].y:X[Z+2].w:X[Z+2].y+(X[Z+2].w-X[Z+2].y)*o,l.push(X[Z+2].x,v.b?1-M:M),l.push(X[Z+2].z,v.b?1-M:M),w&&(x.push(w[Z+1].r,w[Z+1].g,w[Z+1].b,w[Z+1].a),x.push(w[Z+1].r,w[Z+1].g,w[Z+1].b,w[Z+1].a),x.push(w[Z+2].r,w[Z+2].g,w[Z+2].b,w[Z+2].a),x.push(w[Z+2].r,w[Z+2].g,w[Z+2].b,w[Z+2].a))),a!==Z&&(a=Z)}const P=1!==A&&q?N+4:N;for(c=0,Z=0;Z<m;Z++){let O=0,f=0,y=0,S=0;for(d=0;d<N;d++)O=c*(P+1)+d,f=(c+1)*(P+1)+d,y=c*(P+1)+(d+1),S=(c+1)*(P+1)+(d+1),L.push(O,f,y),L.push(S,y,f);1!==A&&q&&(L.push(O+2,f+2,y+2),L.push(S+2,y+2,f+2),L.push(O+4,f+4,y+4),L.push(S+4,y+4,f+4)),c=t?c+2:c+1}const e=O=>{const H=O?y/2:b/2;if(0===H)return;let h,m,t;const q=O?X[B-1]:X[0];let F=null;w&&(F=O?w[B-1]:w[0]);const I=p.length/3,J=O?f/2:-f/2,j=new S.m(0,J,0);p.push(j.x,j.y,j.z),U.push(0,O?1:-1,0);const u=q.y+.5*(q.w-q.y);l.push(q.x+.5*(q.z-q.x),v.b?1-u:u),F&&x.push(F.r,F.g,F.b,F.a);const W=new S.i(.5,.5);for(t=0;t<=N;t++){h=2*Math.PI*t*A/N;const f=Math.cos(-h),y=Math.sin(-h);m=new S.m(f*H,J,y*H);const b=new S.i(f*W.x+.5,y*W.y+.5);p.push(m.x,m.y,m.z),U.push(0,O?1:-1,0);const I=q.y+(q.w-q.y)*b.y;l.push(q.x+(q.z-q.x)*b.x,v.b?1-I:I),F&&x.push(F.r,F.g,F.b,F.a)}for(t=0;t<N;t++)O?(L.push(I),L.push(I+(t+2)),L.push(I+(t+1))):(L.push(I),L.push(I+(t+1)),L.push(I+(t+2)))};I!==H.d.CAP_START&&I!==H.d.CAP_ALL||e(!1),I!==H.d.CAP_END&&I!==H.d.CAP_ALL||e(!0),h.c._ComputeSides(J,p,L,U,l,O.frontUVs,O.backUVs);const K=new h.c;return K.indices=L,K.xa=p,K.ya=U,K.Aa=l,w&&(K.za=x),K}function L(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;const S=new H.d(O,y);f.sideOrientation=H.d._GetDefaultSideOrientation(f.sideOrientation),S._originalBuilderSideOrientation=f.sideOrientation;return u(f).Ca(S,f.updatable),S}function p(O){const f=[],y=[],H=[],b=[],N=O.diameter||1,m=O.thickness||.5,t=0|(O.tessellation||16),q=0===O.sideOrientation?0:O.sideOrientation||h.c.DEFAULTSIDE,F=t+1;for(let h=0;h<=t;h++){const O=h/t,q=h*Math.PI*2/t-Math.PI/2,I=S.b.Translation(N/2,0,0).multiply(S.b.RotationY(q));for(let N=0;N<=t;N++){const q=1-N/t,A=N*Math.PI*2/t+Math.PI,J=Math.cos(A),X=Math.sin(A);let w=new S.m(J,X,0),B=w.scale(m/2);const j=new S.i(O,q);B=S.m.TransformCoordinates(B,I),w=S.m.TransformNormal(w,I),y.push(B.x,B.y,B.z),H.push(w.x,w.y,w.z),b.push(j.x,v.b?1-j.y:j.y);const u=(h+1)%F,L=(N+1)%F;f.push(h*F+N),f.push(h*F+L),f.push(u*F+N),f.push(h*F+L),f.push(u*F+L),f.push(u*F+N)}}h.c._ComputeSides(q,y,f,H,b,O.frontUVs,O.backUVs);const I=new h.c;return I.indices=f,I.xa=y,I.ya=H,I.Aa=b,I}function U(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;const S=new H.d(O,y);f.sideOrientation=H.d._GetDefaultSideOrientation(f.sideOrientation),S._originalBuilderSideOrientation=f.sideOrientation;return p(f).Ca(S,f.updatable),S}h.c.CreateCylinder=u,H.d.CreateCylinder=(O,f,y,S,b,h,v,N,m)=>{void 0!==v&&v instanceof B.c||(void 0!==v&&(m=N||H.d.DEFAULTSIDE,N=v),v=h,h=1);return L(O,{height:f,diameterTop:y,diameterBottom:S,tessellation:b,subdivisions:h,sideOrientation:m,updatable:N},v)};function l(O){const f=[],y=[],H=[],b=[],N=O.radius||2,m=O.tube||.5,t=O.radialSegments||32,q=O.tubularSegments||32,F=O.p||2,I=O.q||3,A=0===O.sideOrientation?0:O.sideOrientation||h.c.DEFAULTSIDE,J=O=>{const f=Math.cos(O),y=Math.sin(O),H=I/F*O,b=Math.cos(H),h=N*(2+b)*.5*f,v=N*(2+b)*y*.5,m=N*Math.sin(H)*.5;return new S.m(h,v,m)};let X,w;for(X=0;X<=t;X++){const O=X%t/t*2*F*Math.PI,f=J(O),H=J(O+.01),h=H.xc(f);let N=H.add(f);const I=S.m.Cross(h,N);for(N=S.m.Cross(I,h),I.normalize(),N.normalize(),w=0;w<q;w++){const O=w%q/q*2*Math.PI,S=-m*Math.cos(O),H=m*Math.sin(O);y.push(f.x+S*N.x+H*I.x),y.push(f.y+S*N.y+H*I.y),y.push(f.z+S*N.z+H*I.z),b.push(X/t),b.push(v.b?1-w/q:w/q)}}for(X=0;X<t;X++)for(w=0;w<q;w++){const O=(w+1)%q,y=X*q+w,S=(X+1)*q+w,H=(X+1)*q+O,b=X*q+O;f.push(b),f.push(S),f.push(y),f.push(b),f.push(H),f.push(S)}h.c.ComputeNormals(y,f,H),h.c._ComputeSides(A,y,f,H,b,O.frontUVs,O.backUVs);const B=new h.c;return B.indices=f,B.xa=y,B.ya=H,B.Aa=b,B}function x(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;const S=new H.d(O,y);f.sideOrientation=H.d._GetDefaultSideOrientation(f.sideOrientation),S._originalBuilderSideOrientation=f.sideOrientation;return l(f).Ca(S,f.updatable),S}h.c.CreateTorus=p,H.d.CreateTorus=(O,f,y,S,H,b,h)=>U(O,{diameter:f,thickness:y,tessellation:S,sideOrientation:h,updatable:b},H);h.c.CreateTorusKnot=l,H.d.CreateTorusKnot=(O,f,y,S,H,b,h,v,N,m)=>x(O,{radius:f,tube:y,radialSegments:S,tubularSegments:H,p:b,q:h,sideOrientation:m,updatable:N},v);var W=y(12648),E=y(11017),o=y(11786),i=y(11330),D=y(11042);class V extends S.i{constructor(O,f){super(O.x,O.y),this.index=f}}class g{constructor(){this.elements=[]}add(O){const f=[];return O.forEach((O=>{const y=new V(O,this.elements.length);f.push(y),this.elements.push(y)})),f}computeBounds(){const O=new S.i(this.elements[0].x,this.elements[0].y),f=new S.i(this.elements[0].x,this.elements[0].y);return this.elements.forEach((y=>{y.x<O.x?O.x=y.x:y.x>f.x&&(f.x=y.x),y.y<O.y?O.y=y.y:y.y>f.y&&(f.y=y.y)})),{min:O,max:f,width:f.x-O.x,height:f.y-O.y}}}class R{_addToepoint(O){for(const f of O)this._epoints.push(f.x,f.y)}constructor(O,f,y){let S,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new g,this._outlinepoints=new g,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=H,this._name=O,this._scene=y||D.c.LastCreatedScene,S=f instanceof o.i?f.getPoints():f,this._addToepoint(S),this._points.add(S),this._outlinepoints.add(S),"undefined"===typeof this.bjsEarcut&&E.e.Warn("Earcut was not found, the polygon will not be built.")}addHole(O){this._points.add(O);const f=new g;return f.add(O),this._holes.push(f),this._eholes.push(this._epoints.length/2),this._addToepoint(O),this}build(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const S=new H.d(this._name,this._scene),h=this.buildVertexData(f,y);return S.Ga(b.f.PositionKind,h.xa,O),S.Ga(b.f.NormalKind,h.ya,O),S.Ga(b.f.UVKind,h.Aa,O),S.setIndices(h.indices),S}buildVertexData(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const y=new h.c,S=[],H=[],b=[],v=this._points.computeBounds();this._points.elements.forEach((O=>{S.push(0,1,0),H.push(O.x,0,O.y),b.push((O.x-v.min.x)/v.width,(O.y-v.min.y)/v.height)}));const N=[],m=this.bjsEarcut(this._epoints,this._eholes,2);for(let h=0;h<m.length;h++)N.push(m[h]);if(O>0){const y=H.length/3;this._points.elements.forEach((f=>{S.push(0,-1,0),H.push(f.x,-O,f.y),b.push(1-(f.x-v.min.x)/v.width,1-(f.y-v.min.y)/v.height)}));const h=N.length;for(let O=0;O<h;O+=3){const f=N[O+0],S=N[O+1],H=N[O+2];N.push(H+y),N.push(S+y),N.push(f+y)}this._addSide(H,S,b,N,v,this._outlinepoints,O,!1,f),this._holes.forEach((y=>{this._addSide(H,S,b,N,v,y,O,!0,f)}))}return y.indices=N,y.xa=H,y.ya=S,y.Aa=b,y}_addSide(O,f,y,H,b,h,v,N,m){let t=O.length/3,q=0;for(let F=0;F<h.elements.length;F++){const I=h.elements[F],A=h.elements[(F+1)%h.elements.length];O.push(I.x,0,I.y),O.push(I.x,-v,I.y),O.push(A.x,0,A.y),O.push(A.x,-v,A.y);const J=h.elements[(F+h.elements.length-1)%h.elements.length],X=h.elements[(F+2)%h.elements.length];let w=new S.m(-(A.y-I.y),0,A.x-I.x),B=new S.m(-(I.y-J.y),0,I.x-J.x),j=new S.m(-(X.y-A.y),0,X.x-A.x);N||(w=w.scale(-1),B=B.scale(-1),j=j.scale(-1));const u=w.normalizeToNew();let L=B.normalizeToNew(),p=j.normalizeToNew();const U=S.m.Dot(L,u);L=U>m?U<i.d-1?new S.m(I.x,0,I.y).xc(new S.m(A.x,0,A.y)).normalize():B.add(w).normalize():u;const l=S.m.Dot(j,w);p=l>m?l<i.d-1?new S.m(A.x,0,A.y).xc(new S.m(I.x,0,I.y)).normalize():j.add(w).normalize():u,y.push(q/b.width,0),y.push(q/b.width,1),q+=w.length(),y.push(q/b.width,0),y.push(q/b.width,1),f.push(L.x,L.y,L.z),f.push(L.x,L.y,L.z),f.push(p.x,p.y,p.z),f.push(p.x,p.y,p.z),N?(H.push(t),H.push(t+2),H.push(t+1),H.push(t+1),H.push(t+2),H.push(t+3)):(H.push(t),H.push(t+1),H.push(t+2),H.push(t+1),H.push(t+3),H.push(t+2)),t+=4}}}function s(O,f,y,H,N,m,t){const q=y||new Array(3),I=H,A=[],J=t||!1;for(let b=0;b<3;b++)void 0===q[b]&&(q[b]=new S.q(0,0,1,1)),I&&void 0===I[b]&&(I[b]=new F.g(1,1,1,1));const X=O.getVerticesData(b.f.PositionKind),w=O.getVerticesData(b.f.NormalKind),B=O.getVerticesData(b.f.UVKind),j=O.Pf(),u=X.length/9;let L=0,p=0,U=0,l=0,x=0;const W=[0];if(J)for(let S=u;S<X.length/3;S+=4)p=X[3*(S+2)]-X[3*S],U=X[3*(S+2)+2]-X[3*S+2],l=Math.sqrt(p*p+U*U),x+=l,W.push(x);let E=0,o=0;for(let S=0;S<w.length;S+=3)Math.abs(w[S+1])<.001&&(o=1),Math.abs(w[S+1]-1)<.001&&(o=0),Math.abs(w[S+1]+1)<.001&&(o=2),E=S/3,1===o?(L=E-u,B[2*E]=L%4<1.5?J?q[o].x+(q[o].z-q[o].x)*W[Math.floor(L/4)]/x:q[o].x:J?q[o].x+(q[o].z-q[o].x)*W[Math.floor(L/4)+1]/x:q[o].z,B[2*E+1]=L%2===0?v.b?1-q[o].w:q[o].w:v.b?1-q[o].y:q[o].y):(B[2*E]=(1-B[2*E])*q[o].x+B[2*E]*q[o].z,B[2*E+1]=(1-B[2*E+1])*q[o].y+B[2*E+1]*q[o].w,v.b&&(B[2*E+1]=1-B[2*E+1])),I&&A.push(I[o].r,I[o].g,I[o].b,I[o].a);h.c._ComputeSides(f,X,j,w,B,N,m);const i=new h.c;if(i.indices=j,i.xa=X,i.ya=w,i.Aa=B,I){const O=f===h.c.DOUBLESIDE?A.concat(A):A;i.za=O}return i}function k(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;f.sideOrientation=H.d._GetDefaultSideOrientation(f.sideOrientation);const h=f.shape,v=f.holes||[],N=f.depth||0,m=f.smoothingThreshold||2,t=[];let q=[];for(let H=0;H<h.length;H++)t[H]=new S.i(h[H].x,h[H].z);t[0].equalsWithEpsilon(t[t.length-1],1e-8)&&t.pop();const F=new R(O,t,y||D.c.LastCreatedScene,b);for(let H=0;H<v.length;H++){q=[];for(let O=0;O<v[H].length;O++)q.push(new S.i(v[H][O].x,v[H][O].z));F.addHole(q)}const I=F.build(!1,N,m);I._originalBuilderSideOrientation=f.sideOrientation;return s(I,f.sideOrientation,f.faceUV,f.faceColors,f.frontUVs,f.backUVs,f.wrap).Ca(I,f.updatable),I}function z(O,f){return k(O,f,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}function c(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=f.path,b=f.shape,h=f.scale||1,v=f.rotation||0,N=0===f.cap?0:f.cap||H.d.NO_CAP,m=f.updatable,t=H.d._GetDefaultSideOrientation(f.sideOrientation),q=f.instance||null,F=f.invertUV||!1,I=f.closeShape||!1;return G(O,b,S,h,v,null,null,f.closePath||!1,I,N,!1,y,!!m,t,q,F,f.frontUVs||null,f.backUVs||null,f.firstNormal||null,!!f.adjustFrame)}function d(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=f.path,b=f.shape,h=f.scaleFunction||(()=>1),v=f.rotationFunction||(()=>0),N=f.closePath||f.ribbonCloseArray||!1,m=f.closeShape||f.ribbonClosePath||!1,t=0===f.cap?0:f.cap||H.d.NO_CAP,q=f.updatable,F=f.firstNormal||null,I=f.adjustFrame||!1;return G(O,b,S,null,null,h,v,N,m,t,!0,y,!!q,H.d._GetDefaultSideOrientation(f.sideOrientation),f.instance||null,f.invertUV||!1,f.frontUVs||null,f.backUVs||null,F,I)}function G(O,f,y,b,h,v,N,t,q,F,I,A,J,X,w,B,j,u,L,p){const U=(O,f,y,b,h,v,N,m,t,q,F)=>{const I=y.getTangents(),A=y.getNormals(),J=y.getBinormals(),X=y.getDistances();if(F)for(let H=0;H<I.length;H++)if(0==I[H].x&&0==I[H].y&&0==I[H].z&&I[H].p(I[H-1]),0==A[H].x&&0==A[H].y&&0==A[H].z&&A[H].p(A[H-1]),0==J[H].x&&0==J[H].y&&0==J[H].z&&J[H].p(J[H-1]),H>0){let O=I[H-1];S.m.Dot(O,I[H])<0&&I[H].scaleInPlace(-1),O=A[H-1],S.m.Dot(O,A[H])<0&&A[H].scaleInPlace(-1),O=J[H-1],S.m.Dot(O,J[H])<0&&J[H].scaleInPlace(-1)}let w=0;const B=q&&m?m:()=>null!==v?v:0,j=q&&N?N:()=>null!==h?h:1;let u=t===H.d.NO_CAP||t===H.d.CAP_END?0:2;const L=S.g.Matrix[0];for(let H=0;H<f.length;H++){const y=[],h=B(H,X[H]),v=j(H,X[H]);S.b.RotationAxisToRef(I[H],w,L);for(let b=0;b<O.length;b++){const h=I[H].scale(O[b].z).add(A[H].scale(O[b].x)).add(J[H].scale(O[b].y)),N=S.m.Zero();S.m.TransformCoordinatesToRef(h,L,N),N.scaleInPlace(v).addInPlace(f[H]),y[b]=N}b[u]=y,w+=h,u++}const p=O=>{const f=Array(),y=S.m.Zero();let H;for(H=0;H<O.length;H++)y.addInPlace(O[H]);for(y.scaleInPlace(1/O.length),H=0;H<O.length;H++)f.push(y);return f};switch(t){case H.d.NO_CAP:break;case H.d.CAP_START:b[0]=p(b[2]),b[1]=b[2];break;case H.d.CAP_END:b[u]=b[u-1],b[u+1]=p(b[u-1]);break;case H.d.CAP_ALL:b[0]=p(b[2]),b[1]=b[2],b[u]=b[u-1],b[u+1]=p(b[u-1])}return b};let l,x;if(w){const O=w._creationDataStorage;return l=L?O.path3D.update(y,L):O.path3D.update(y),x=U(f,y,O.path3D,O.pathArray,b,h,v,N,O.cap,I,p),w=m("",{pathArray:x,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:w},A||void 0)}l=L?new o.m(y,L):new o.m(y);x=U(f,y,l,new Array,b,h,v,N,F=F<0||F>3?0:F,I,p);const W=m(O,{pathArray:x,closeArray:t,closePath:q,updatable:J,sideOrientation:X,invertUV:B,frontUVs:j||void 0,backUVs:u||void 0},A);return W._creationDataStorage.pathArray=x,W._creationDataStorage.path3D=l,W._creationDataStorage.cap=F,W}h.c.CreatePolygon=s,H.d.CreatePolygon=function(O,f,y,S,H,b){return k(O,{shape:f,holes:S,updatable:H,sideOrientation:b},y,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},H.d.ExtrudePolygon=function(O,f,y,S,H,b,h){return z(O,{shape:f,holes:H,depth:y,updatable:b,sideOrientation:h},S,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)};function Y(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=f.arc?f.arc<=0||f.arc>1?1:f.arc:1,h=void 0===f.closed||f.closed,v=f.shape,N=f.radius||1,t=f.tessellation||64,q=f.clip||0,F=f.updatable,I=H.d._GetDefaultSideOrientation(f.sideOrientation),A=f.cap||H.d.NO_CAP,J=2*Math.PI,X=[],w=f.invertUV||!1;let B=0,j=0;const u=J/t*b;let L,p;for(B=0;B<=t-q;B++){for(p=[],A!=H.d.CAP_START&&A!=H.d.CAP_ALL||(p.push(new S.m(0,v[0].y,0)),p.push(new S.m(Math.cos(B*u)*v[0].x*N,v[0].y,Math.sin(B*u)*v[0].x*N))),j=0;j<v.length;j++)L=new S.m(Math.cos(B*u)*v[j].x*N,v[j].y,Math.sin(B*u)*v[j].x*N),p.push(L);A!=H.d.CAP_END&&A!=H.d.CAP_ALL||(p.push(new S.m(Math.cos(B*u)*v[v.length-1].x*N,v[v.length-1].y,Math.sin(B*u)*v[v.length-1].x*N)),p.push(new S.m(0,v[v.length-1].y,0))),X.push(p)}return m(O,{pathArray:X,closeArray:h,sideOrientation:I,updatable:F,invertUV:w,frontUVs:f.frontUVs,backUVs:f.backUVs},y)}H.d.ExtrudeShape=function(O,f,y,S,b,h){let v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,N=arguments.length>7?arguments[7]:void 0,m=arguments.length>8?arguments[8]:void 0,t=arguments.length>9?arguments[9]:void 0;return c(O,{shape:f,path:y,scale:S,rotation:b,cap:0===h?0:h||H.d.NO_CAP,sideOrientation:m,instance:t,updatable:N},v)},H.d.ExtrudeShapeCustom=(O,f,y,S,b,h,v,N,m,t,q,F)=>d(O,{shape:f,path:y,scaleFunction:S,rotationFunction:b,ribbonCloseArray:h,ribbonClosePath:v,cap:0===N?0:N||H.d.NO_CAP,sideOrientation:q,instance:F,updatable:t},m);H.d.CreateLathe=(O,f,y,S,H,b,h)=>Y(O,{shape:f,radius:y,tessellation:S,sideOrientation:h,updatable:b},H);var Z=y(11672),a=y(11624);function M(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=f.path;let h=f.instance,v=1;void 0!==f.radius?v=f.radius:h&&(v=h._creationDataStorage.radius);const N=f.tessellation||64,t=f.radiusFunction||null;let q=f.cap||H.d.NO_CAP;const F=f.invertUV||!1,I=f.updatable,A=H.d._GetDefaultSideOrientation(f.sideOrientation);f.arc=f.arc&&(f.arc<=0||f.arc>1)?1:f.arc||1;const J=(O,f,y,b,h,v,N,m)=>{const t=f.getTangents(),q=f.getNormals(),F=f.getDistances(),I=2*Math.PI/h*m,A=v||(()=>b);let J,X,w,B;const j=S.g.Matrix[0];let u=N===H.d.NO_CAP||N===H.d.CAP_END?0:2;for(let H=0;H<O.length;H++){X=A(H,F[H]),J=Array(),w=q[H];for(let f=0;f<h;f++)S.b.RotationAxisToRef(t[H],I*f,j),B=J[f]?J[f]:S.m.Zero(),S.m.TransformCoordinatesToRef(w,j,B),B.scaleInPlace(X).addInPlace(O[H]),J[f]=B;y[u]=J,u++}const L=(f,y)=>{const S=Array();for(let H=0;H<f;H++)S.push(O[y]);return S};switch(N){case H.d.NO_CAP:break;case H.d.CAP_START:y[0]=L(h,0),y[1]=y[2].slice(0);break;case H.d.CAP_END:y[u]=y[u-1].slice(0),y[u+1]=L(h,O.length-1);break;case H.d.CAP_ALL:y[0]=L(h,0),y[1]=y[2].slice(0),y[u]=y[u-1].slice(0),y[u+1]=L(h,O.length-1)}return y};let X,w;if(h){const O=h._creationDataStorage,y=f.arc||O.arc;return X=O.path3D.update(b),w=J(b,X,O.pathArray,v,O.tessellation,t,O.cap,y),h=m("",{pathArray:w,instance:h}),O.path3D=X,O.pathArray=w,O.arc=y,O.radius=v,h}X=new o.m(b);q=q<0||q>3?0:q,w=J(b,X,new Array,v,N,t,q,f.arc);const B=m(O,{pathArray:w,closePath:!0,closeArray:!1,updatable:I,sideOrientation:A,invertUV:F,frontUVs:f.frontUVs,backUVs:f.backUVs},y);return B._creationDataStorage.pathArray=w,B._creationDataStorage.path3D=X,B._creationDataStorage.tessellation=N,B._creationDataStorage.cap=q,B._creationDataStorage.arc=f.arc,B._creationDataStorage.radius=v,B}function P(O){const f=[];f[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},f[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},f[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},f[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},f[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},f[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},f[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},f[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},f[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},f[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},f[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},f[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},f[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},f[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},f[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const y=O.type&&(O.type<0||O.type>=f.length)?0:O.type||0,H=O.size,b=O.sizeX||H||1,N=O.sizeY||H||1,m=O.sizeZ||H||1,t=O.custom||f[y],q=t.face.length,I=O.faceUV||new Array(q),A=O.faceColors,J=void 0===O.flat||O.flat,X=0===O.sideOrientation?0:O.sideOrientation||h.c.DEFAULTSIDE,w=[],B=[],j=[],u=[],L=[];let p=0,U=0;const l=[];let x,W,E,o,i,D,V=0,g=0;if(J)for(g=0;g<q;g++)A&&void 0===A[g]&&(A[g]=new F.g(1,1,1,1)),I&&void 0===I[g]&&(I[g]=new S.q(0,0,1,1));if(J)for(g=0;g<q;g++){const O=t.face[g].length;for(E=2*Math.PI/O,o=.5*Math.tan(E/2),i=.5,V=0;V<O;V++)w.push(t.vertex[t.face[g][V]][0]*b,t.vertex[t.face[g][V]][1]*N,t.vertex[t.face[g][V]][2]*m),l.push(p),p++,x=I[g].x+(I[g].z-I[g].x)*(.5+o),W=I[g].y+(I[g].w-I[g].y)*(i-.5),u.push(x,v.b?1-W:W),D=o*Math.cos(E)-i*Math.sin(E),i=o*Math.sin(E)+i*Math.cos(E),o=D,A&&L.push(A[g].r,A[g].g,A[g].b,A[g].a);for(V=0;V<O-2;V++)B.push(l[0+U],l[V+2+U],l[V+1+U]);U+=O}else{for(V=0;V<t.vertex.length;V++)w.push(t.vertex[V][0]*b,t.vertex[V][1]*N,t.vertex[V][2]*m),u.push(0,v.b?1:0);for(g=0;g<q;g++)for(V=0;V<t.face[g].length-2;V++)B.push(t.face[g][0],t.face[g][V+2],t.face[g][V+1])}h.c.ComputeNormals(w,B,j),h.c._ComputeSides(X,w,B,j,u,O.frontUVs,O.backUVs);const R=new h.c;return R.xa=w,R.indices=B,R.ya=j,R.Aa=u,A&&J&&(R.za=L),R}function e(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new H.d(O,y);f.sideOrientation=H.d._GetDefaultSideOrientation(f.sideOrientation),S._originalBuilderSideOrientation=f.sideOrientation;return P(f).Ca(S,f.updatable),S}H.d.CreateTube=(O,f,y,S,H,b,h,v,N,m)=>M(O,{path:f,radius:y,tessellation:S,radiusFunction:H,arc:1,cap:b,updatable:v,sideOrientation:N,instance:m},h);function K(O){const f=O.sideOrientation||h.c.DEFAULTSIDE,y=O.radius||1,H=void 0===O.flat||O.flat,b=0|(O.subdivisions||4),N=O.radiusX||y,m=O.radiusY||y,t=O.radiusZ||y,q=(1+Math.sqrt(5))/2,F=[-1,q,-0,1,q,0,-1,-q,0,1,-q,0,0,-1,-q,0,1,-q,0,-1,q,0,1,q,q,0,1,q,0,-1,-q,0,1,-q,0,-1],I=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],A=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],J=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],X=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],w=[],B=[],j=[],u=[];let L=0;const p=new Array(3),U=new Array(3);let l;for(l=0;l<3;l++)p[l]=S.m.Zero(),U[l]=S.i.Zero();for(let h=0;h<20;h++){for(l=0;l<3;l++){const O=I[3*h+l];p[l].Xd(F[3*A[O]],F[3*A[O]+1],F[3*A[O]+2]),p[l].normalize(),U[l].Xd(.134765625*J[2*O]+.05859375+-.0390625*X[h],.2333984375*J[2*O+1]+.025390625+.01953125*X[h])}const O=(O,f,y,h)=>{const q=S.m.Lerp(p[0],p[2],f/b),F=S.m.Lerp(p[1],p[2],f/b),I=b===f?p[2]:S.m.Lerp(q,F,O/(b-f));let A;if(I.normalize(),H){const O=S.m.Lerp(p[0],p[2],h/b),f=S.m.Lerp(p[1],p[2],h/b);A=S.m.Lerp(O,f,y/(b-h))}else A=new S.m(I.x,I.y,I.z);A.x/=N,A.y/=m,A.z/=t,A.normalize();const J=S.i.Lerp(U[0],U[2],f/b),X=S.i.Lerp(U[1],U[2],f/b),l=b===f?U[2]:S.i.Lerp(J,X,O/(b-f));B.push(I.x*N,I.y*m,I.z*t),j.push(A.x,A.y,A.z),u.push(l.x,v.b?1-l.y:l.y),w.push(L),L++};for(let f=0;f<b;f++)for(let y=0;y+f<b;y++)O(y,f,y+1/3,f+1/3),O(y+1,f,y+1/3,f+1/3),O(y,f+1,y+1/3,f+1/3),y+f+1<b&&(O(y+1,f,y+2/3,f+2/3),O(y+1,f+1,y+2/3,f+2/3),O(y,f+1,y+2/3,f+2/3))}h.c._ComputeSides(f,B,w,j,u,O.frontUVs,O.backUVs);const x=new h.c;return x.indices=w,x.xa=B,x.ya=j,x.Aa=u,x}function T(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new H.d(O,y);f.sideOrientation=H.d._GetDefaultSideOrientation(f.sideOrientation),S._originalBuilderSideOrientation=f.sideOrientation;return K(f).Ca(S,f.updatable),S}h.c.CreatePolyhedron=P,H.d.CreatePolyhedron=(O,f,y)=>e(O,f,y);h.c.CreateIcoSphere=K,H.d.CreateIcoSphere=(O,f,y)=>T(O,f,y);var Q=y(11345);const C=new S.m(1,0,0),r=new S.m(-1,0,0),n=new S.m(0,1,0),OO=new S.m(0,-1,0),fO=new S.m(0,0,1),yO=new S.m(0,0,-1);class SO{constructor(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S.m.Zero(),f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S.m.Up(),y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.i.Zero(),H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,N=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,m=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=O,this.k=f,this.uv=y,this.vertexIdx=H,this.vertexIdxForBones=b,this.localPositionOverride=h,this.localNormalOverride=v,this.matrixIndicesOverride=N,this.matrixWeightsOverride=m}clone(){var O,f,y,S;return new SO(this.position.clone(),this.k.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(O=this.localPositionOverride)||void 0===O?void 0:O.slice(),null===(f=this.localNormalOverride)||void 0===f?void 0:f.slice(),null===(y=this.matrixIndicesOverride)||void 0===y?void 0:y.slice(),null===(S=this.matrixWeightsOverride)||void 0===S?void 0:S.slice())}}function HO(O,f,y){var N,m,t,q;const F=!!f.skeleton,I=y.localMode||F,A=f.Pf(),J=F?f.Ed(!0,!0):f.getVerticesData(b.f.PositionKind),X=F?f.getNormalsData(!0,!0):f.getVerticesData(b.f.NormalKind),w=I?F?f.getVerticesData(b.f.PositionKind):J:null,B=I?F?f.getVerticesData(b.f.NormalKind):X:null,j=f.getVerticesData(b.f.UVKind),u=F?f.getVerticesData(b.f.MatricesIndicesKind):null,L=F?f.getVerticesData(b.f.MatricesWeightsKind):null,p=F?f.getVerticesData(b.f.MatricesIndicesExtraKind):null,U=F?f.getVerticesData(b.f.MatricesWeightsExtraKind):null,l=y.position||S.m.Zero();let x=y.k||S.m.Up();const W=y.size||S.m.One(),E=y.angle||0;if(!x){const O=new S.m(0,0,1),y=f.va().activeCamera,H=S.m.TransformCoordinates(O,y.getWorldMatrix());x=y.globalPosition.xc(H)}const o=-Math.atan2(x.z,x.x)-Math.PI/2,i=Math.sqrt(x.x*x.x+x.z*x.z),D=Math.atan2(x.y,i),V=new h.c;V.indices=[],V.xa=[],V.ya=[],V.Aa=[],V.matricesIndices=F?[]:null,V.matricesWeights=F?[]:null,V.matricesIndicesExtra=p?[]:null,V.matricesWeightsExtra=U?[]:null;let g=0;const R=(O,f)=>{const H=new SO;if(!A||!J||!X)return H;const b=A[O];if(H.vertexIdx=3*b,H.vertexIdxForBones=4*b,H.position=new S.m(J[3*b],J[3*b+1],J[3*b+2]),S.m.TransformCoordinatesToRef(H.position,f,H.position),H.k=new S.m(X[3*b],X[3*b+1],X[3*b+2]),S.m.TransformNormalToRef(H.k,f,H.k),y.captureUVS&&j){const O=j[2*b+1];H.uv=new S.i(j[2*b],v.b?1-O:O)}return H},s=[0,0,0,0],k=(O,f)=>{if(0===O.length)return O;const y=.5*Math.abs(S.m.Dot(W,f)),H=(O,f,y,S)=>{for(let H=0;H<S;++H)if(O[y+H]===f)return y+H;return-1},b=(O,b)=>{const h=S.m.GetClipFactor(O.position,b.position,f,y);let v=s,N=s;if(u&&L){const f=O.matrixIndicesOverride?0:O.vertexIdxForBones,y=O.matrixIndicesOverride??u,S=O.matrixWeightsOverride??L,m=b.matrixIndicesOverride?0:b.vertexIdxForBones,t=b.matrixIndicesOverride??u,q=b.matrixWeightsOverride??L;v=[0,0,0,0],N=[0,0,0,0];let F=0;for(let O=0;O<4;++O)if(S[f+O]>0){const b=H(t,y[f+O],m,4);v[F]=y[f+O],N[F]=(0,Q.o)(S[f+O],b>=0?q[b]:0,h),F++}for(let O=0;O<4&&F<4;++O){const S=t[m+O];-1===H(y,S,f,4)&&(v[F]=S,N[F]=(0,Q.o)(0,q[m+O],h),F++)}const I=N[0]+N[1]+N[2]+N[3];N[0]/=I,N[1]/=I,N[2]/=I,N[3]/=I}const m=O.localPositionOverride?O.localPositionOverride[0]:(null===w||void 0===w?void 0:w[O.vertexIdx])??0,t=O.localPositionOverride?O.localPositionOverride[1]:(null===w||void 0===w?void 0:w[O.vertexIdx+1])??0,q=O.localPositionOverride?O.localPositionOverride[2]:(null===w||void 0===w?void 0:w[O.vertexIdx+2])??0,F=b.localPositionOverride?b.localPositionOverride[0]:(null===w||void 0===w?void 0:w[b.vertexIdx])??0,I=b.localPositionOverride?b.localPositionOverride[1]:(null===w||void 0===w?void 0:w[b.vertexIdx+1])??0,A=b.localPositionOverride?b.localPositionOverride[2]:(null===w||void 0===w?void 0:w[b.vertexIdx+2])??0,J=O.localNormalOverride?O.localNormalOverride[0]:(null===B||void 0===B?void 0:B[O.vertexIdx])??0,X=O.localNormalOverride?O.localNormalOverride[1]:(null===B||void 0===B?void 0:B[O.vertexIdx+1])??0,j=O.localNormalOverride?O.localNormalOverride[2]:(null===B||void 0===B?void 0:B[O.vertexIdx+2])??0,p=J+((b.localNormalOverride?b.localNormalOverride[0]:(null===B||void 0===B?void 0:B[b.vertexIdx])??0)-J)*h,U=X+((b.localNormalOverride?b.localNormalOverride[1]:(null===B||void 0===B?void 0:B[b.vertexIdx+1])??0)-X)*h,l=j+((b.localNormalOverride?b.localNormalOverride[2]:(null===B||void 0===B?void 0:B[b.vertexIdx+2])??0)-j)*h,x=Math.sqrt(p*p+U*U+l*l);return new SO(S.m.Lerp(O.position,b.position,h),S.m.Lerp(O.k,b.k,h).normalize(),S.i.Lerp(O.uv,b.uv,h),-1,-1,w?[m+(F-m)*h,t+(I-t)*h,q+(A-q)*h]:null,B?[p/x,U/x,l/x]:null,v,N)};let h=null;O.length>3&&(h=[]);for(let v=0;v<O.length;v+=3){let H=0,N=null,m=null,t=null,q=null;const F=S.m.Dot(O[v].position,f)-y>0,I=S.m.Dot(O[v+1].position,f)-y>0,A=S.m.Dot(O[v+2].position,f)-y>0;switch(H=(F?1:0)+(I?1:0)+(A?1:0),H){case 0:O.length>3?(h.push(O[v]),h.push(O[v+1]),h.push(O[v+2])):h=O;break;case 1:if(h=h??new Array,F&&(N=O[v+1],m=O[v+2],t=b(O[v],N),q=b(O[v],m)),I){N=O[v],m=O[v+2],t=b(O[v+1],N),q=b(O[v+1],m),h.push(t),h.push(m.clone()),h.push(N.clone()),h.push(m.clone()),h.push(t.clone()),h.push(q);break}A&&(N=O[v],m=O[v+1],t=b(O[v+2],N),q=b(O[v+2],m)),N&&m&&t&&q&&(h.push(N.clone()),h.push(m.clone()),h.push(t),h.push(q),h.push(t.clone()),h.push(m.clone()));break;case 2:h=h??new Array,F||(N=O[v].clone(),m=b(N,O[v+1]),t=b(N,O[v+2]),h.push(N),h.push(m),h.push(t)),I||(N=O[v+1].clone(),m=b(N,O[v+2]),t=b(N,O[v]),h.push(N),h.push(m),h.push(t)),A||(N=O[v+2].clone(),m=b(N,O[v]),t=b(N,O[v+1]),h.push(N),h.push(m),h.push(t))}}return h},z=f instanceof H.d?f:null,c=null===z||void 0===z?void 0:z._thinInstanceDataStorage.matrixData,d=(null===z||void 0===z?void 0:z.tc)||1,G=S.g.Matrix[0];G.p(S.b.IdentityReadOnly);for(let H=0;H<d;++H){if(null!==z&&void 0!==z&&z.hasThinInstances&&c){const O=16*H;G.setRowFromFloats(0,c[O+0],c[O+1],c[O+2],c[O+3]),G.setRowFromFloats(1,c[O+4],c[O+5],c[O+6],c[O+7]),G.setRowFromFloats(2,c[O+8],c[O+9],c[O+10],c[O+11]),G.setRowFromFloats(3,c[O+12],c[O+13],c[O+14],c[O+15])}const O=S.b.RotationYawPitchRoll(o,D,E).multiply(S.b.Translation(l.x,l.y,l.z)),b=S.b.Invert(O),h=f.getWorldMatrix(),N=G.multiply(h).multiply(b),m=new Array(3);for(let f=0;f<A.length;f+=3){let O=m;if(O[0]=R(f,N),O[1]=R(f+1,N),O[2]=R(f+2,N),!(y.cullBackFaces&&-O[0].k.z<=0&&-O[1].k.z<=0&&-O[2].k.z<=0)&&(O=k(O,C),O&&(O=k(O,r),O&&(O=k(O,n),O&&(O=k(O,OO),O&&(O=k(O,fO),O&&(O=k(O,yO),O)))))))for(let f=0;f<O.length;f++){const S=O[f];if(V.indices.push(g),I?(S.localPositionOverride?(V.xa[3*g]=S.localPositionOverride[0],V.xa[3*g+1]=S.localPositionOverride[1],V.xa[3*g+2]=S.localPositionOverride[2]):w&&(V.xa[3*g]=w[S.vertexIdx],V.xa[3*g+1]=w[S.vertexIdx+1],V.xa[3*g+2]=w[S.vertexIdx+2]),S.localNormalOverride?(V.ya[3*g]=S.localNormalOverride[0],V.ya[3*g+1]=S.localNormalOverride[1],V.ya[3*g+2]=S.localNormalOverride[2]):B&&(V.ya[3*g]=B[S.vertexIdx],V.ya[3*g+1]=B[S.vertexIdx+1],V.ya[3*g+2]=B[S.vertexIdx+2])):(S.position.toArray(V.xa,3*g),S.k.toArray(V.ya,3*g)),V.matricesIndices&&V.matricesWeights&&(S.matrixIndicesOverride?(V.matricesIndices[4*g]=S.matrixIndicesOverride[0],V.matricesIndices[4*g+1]=S.matrixIndicesOverride[1],V.matricesIndices[4*g+2]=S.matrixIndicesOverride[2],V.matricesIndices[4*g+3]=S.matrixIndicesOverride[3]):(u&&(V.matricesIndices[4*g]=u[S.vertexIdxForBones],V.matricesIndices[4*g+1]=u[S.vertexIdxForBones+1],V.matricesIndices[4*g+2]=u[S.vertexIdxForBones+2],V.matricesIndices[4*g+3]=u[S.vertexIdxForBones+3]),p&&V.matricesIndicesExtra&&(V.matricesIndicesExtra[4*g]=p[S.vertexIdxForBones],V.matricesIndicesExtra[4*g+1]=p[S.vertexIdxForBones+1],V.matricesIndicesExtra[4*g+2]=p[S.vertexIdxForBones+2],V.matricesIndicesExtra[4*g+3]=p[S.vertexIdxForBones+3])),S.matrixWeightsOverride?(V.matricesWeights[4*g]=S.matrixWeightsOverride[0],V.matricesWeights[4*g+1]=S.matrixWeightsOverride[1],V.matricesWeights[4*g+2]=S.matrixWeightsOverride[2],V.matricesWeights[4*g+3]=S.matrixWeightsOverride[3]):(L&&(V.matricesWeights[4*g]=L[S.vertexIdxForBones],V.matricesWeights[4*g+1]=L[S.vertexIdxForBones+1],V.matricesWeights[4*g+2]=L[S.vertexIdxForBones+2],V.matricesWeights[4*g+3]=L[S.vertexIdxForBones+3]),U&&V.matricesWeightsExtra&&(V.matricesWeightsExtra[4*g]=U[S.vertexIdxForBones],V.matricesWeightsExtra[4*g+1]=U[S.vertexIdxForBones+1],V.matricesWeightsExtra[4*g+2]=U[S.vertexIdxForBones+2],V.matricesWeightsExtra[4*g+3]=U[S.vertexIdxForBones+3]))),y.captureUVS)S.uv.toArray(V.Aa,2*g);else{V.Aa.push(.5+S.position.x/W.x);const O=.5+S.position.y/W.y;V.Aa.push(v.b?1-O:O)}g++}}}0===V.indices.length&&(V.indices=null),0===V.xa.length&&(V.xa=null),0===V.ya.length&&(V.ya=null),0===V.Aa.length&&(V.Aa=null),0===(null===(N=V.matricesIndices)||void 0===N?void 0:N.length)&&(V.matricesIndices=null),0===(null===(m=V.matricesWeights)||void 0===m?void 0:m.length)&&(V.matricesWeights=null),0===(null===(t=V.matricesIndicesExtra)||void 0===t?void 0:t.length)&&(V.matricesIndicesExtra=null),0===(null===(q=V.matricesWeightsExtra)||void 0===q?void 0:q.length)&&(V.matricesWeightsExtra=null);const Y=new H.d(O,f.va());return V.Ca(Y),I?(Y.skeleton=f.skeleton,Y.parent=f):(Y.position=l.clone(),Y.rotation=new S.m(D,o,E)),Y.Mj(!0),Y.refreshBoundingInfo(!0,!0),Y}function bO(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const f=0|Math.max(O.subdivisions?O.subdivisions:2,1),y=0|Math.max(O.tessellation?O.tessellation:16,3),H=Math.max(O.height?O.height:1,0),b=Math.max(O.radius?O.radius:.25,0),N=0|Math.max(O.capSubdivisions?O.capSubdivisions:6,1),m=y,t=f,q=Math.max(O.radiusTop?O.radiusTop:b,0),F=Math.max(O.radiusBottom?O.radiusBottom:b,0),I=H-(q+F),A=2*Math.PI,J=Math.max(O.topCapSubdivisions?O.topCapSubdivisions:N,1),X=Math.max(O.bottomCapSubdivisions?O.bottomCapSubdivisions:N,1),w=Math.acos((F-q)/H);let B=[];const j=[],u=[],L=[];let p=0;const U=[],l=.5*I,x=.5*Math.PI;let W,E;const o=S.m.Zero(),i=S.m.Zero(),D=Math.cos(w),V=Math.sin(w),g=new S.i(q*V,l+q*D).xc(new S.i(F*V,F*D-l)).length(),R=q*w+g+F*(x-w);let s=0;for(E=0;E<=J;E++){const O=[],f=x-w*(E/J);s+=q*w/J;const y=Math.cos(f),S=Math.sin(f),H=y*q;for(W=0;W<=m;W++){const f=W/m,b=f*A+0,h=Math.sin(b),N=Math.cos(b);i.x=H*h,i.y=l+S*q,i.z=H*N,j.push(i.x,i.y,i.z),o.set(y*h,S,y*N),u.push(o.x,o.y,o.z),L.push(f,v.b?s/R:1-s/R),O.push(p),p++}U.push(O)}const k=H-q-F+D*q-D*F,z=V*(F-q)/k;for(E=1;E<=t;E++){const O=[];s+=g/t;const f=V*(E*(F-q)/t+q);for(W=0;W<=m;W++){const y=W/m,S=y*A+0,H=Math.sin(S),b=Math.cos(S);i.x=f*H,i.y=l+D*q-E*k/t,i.z=f*b,j.push(i.x,i.y,i.z),o.set(H,z,b).normalize(),u.push(o.x,o.y,o.z),L.push(y,v.b?s/R:1-s/R),O.push(p),p++}U.push(O)}for(E=1;E<=X;E++){const O=[],f=x-w-(Math.PI-w)*(E/X);s+=F*w/X;const y=Math.cos(f),S=Math.sin(f),H=y*F;for(W=0;W<=m;W++){const f=W/m,b=f*A+0,h=Math.sin(b),N=Math.cos(b);i.x=H*h,i.y=S*F-l,i.z=H*N,j.push(i.x,i.y,i.z),o.set(y*h,S,y*N),u.push(o.x,o.y,o.z),L.push(f,v.b?s/R:1-s/R),O.push(p),p++}U.push(O)}for(W=0;W<m;W++)for(E=0;E<J+t+X;E++){const O=U[E][W],f=U[E+1][W],y=U[E+1][W+1],S=U[E][W+1];B.push(O),B.push(f),B.push(S),B.push(f),B.push(y),B.push(S)}if(B=B.reverse(),O.orientation&&!O.orientation.equals(S.m.Up())){const f=new S.b;O.orientation.clone().scale(.5*Math.PI).cross(S.m.Up()).toQuaternion().toRotationMatrix(f);const y=S.m.Zero();for(let O=0;O<j.length;O+=3)y.set(j[O],j[O+1],j[O+2]),S.m.TransformCoordinatesToRef(y.clone(),f,y),j[O]=y.x,j[O+1]=y.y,j[O+2]=y.z}const c=new h.c;return c.xa=j,c.ya=u,c.Aa=L,c.indices=B,c}function hO(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:S.m.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=new H.d(O,y);return bO(f).Ca(b,f.updatable),b}H.d.CreateDecal=(O,f,y,S,H,b)=>HO(O,f,{position:y,k:S,size:H,angle:b});H.d.CreateCapsule=(O,f,y)=>hO(O,f,y),h.c.CreateCapsule=bO;class vO{constructor(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=O,this.y=f,O!==Math.floor(O)&&(O=Math.floor(O),E.e.Warn("x is not an integer, floor(x) used")),f!==Math.floor(f)&&(f=Math.floor(f),E.e.Warn("y is not an integer, floor(y) used"))}clone(){return new vO(this.x,this.y)}rotate60About(O){const f=this.x;return this.x=O.x+O.y-this.y,this.y=f+this.y-O.x,this}rotateNeg60About(O){const f=this.x;return this.x=f+this.y-O.y,this.y=O.x+O.y-f,this}rotate120(O,f){O!==Math.floor(O)&&(O=Math.floor(O),E.e.Warn("m not an integer only floor(m) used")),f!==Math.floor(f)&&(f=Math.floor(f),E.e.Warn("n not an integer only floor(n) used"));const y=this.x;return this.x=O-y-this.y,this.y=f+y,this}rotateNeg120(O,f){O!==Math.floor(O)&&(O=Math.floor(O),E.e.Warn("m is not an integer, floor(m) used")),f!==Math.floor(f)&&(f=Math.floor(f),E.e.Warn("n is not an integer,   floor(n) used"));const y=this.x;return this.x=this.y-f,this.y=O+f-y-this.y,this}toCartesianOrigin(O,f){const y=S.m.Zero();return y.x=O.x+2*this.x*f+this.y*f,y.y=O.y+Math.sqrt(3)*this.y*f,y}static Zero(){return new vO(0,0)}}class NO{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new mO("icosahedron","Regular",[[0,i.f,-1],[-i.f,1,0],[-1,0,-i.f],[1,0,-i.f],[i.f,1,0],[0,i.f,1],[-1,0,i.f],[-i.f,-1,0],[0,-i.f,-1],[i.f,-1,0],[1,0,i.f],[0,-i.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let O=12;const f={},y=this.m,S=this.n;let H,b,h,v,N,m=y,t=1,q=0;0!==S&&(m=(0,Q.j)(y,S)),t=y/m,q=S/m;const F=vO.Zero(),I=new vO(y,S),A=new vO(-S,y+S),J=vO.Zero(),X=vO.Zero(),w=vO.Zero();let B,j,u,L,p=[];const U=[],l=this.vertByDist,x=(y,S,H,b)=>{B=y+"|"+H,j=S+"|"+b,B in f||j in f?B in f&&!(j in f)?f[j]=f[B]:j in f&&!(B in f)&&(f[B]=f[j]):(f[B]=O,f[j]=O,O++),l[H][0]>2?U[f[B]]=[-l[H][0],l[H][1],f[B]]:U[f[B]]=[p[l[H][0]],l[H][1],f[B]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let W=0;W<20;W++){if(p=this.IDATA.face[W],h=p[2],v=p[1],N=p[0],u=F.x+"|"+F.y,B=W+"|"+u,B in f||(f[B]=h,U[h]=[p[l[u][0]],l[u][1]]),u=I.x+"|"+I.y,B=W+"|"+u,B in f||(f[B]=v,U[v]=[p[l[u][0]],l[u][1]]),u=A.x+"|"+A.y,B=W+"|"+u,B in f||(f[B]=N,U[N]=[p[l[u][0]],l[u][1]]),H=this.IDATA.edgematch[W][0],b=this.IDATA.edgematch[W][1],"B"===b)for(let O=1;O<m;O++)X.x=y-O*(t+q),X.y=S+O*t,w.x=-O*q,w.y=O*(t+q),u=X.x+"|"+X.y,L=w.x+"|"+w.y,x(W,H,u,L);if("O"===b)for(let O=1;O<m;O++)w.x=-O*q,w.y=O*(t+q),J.x=O*t,J.y=O*q,u=w.x+"|"+w.y,L=J.x+"|"+J.y,x(W,H,u,L);if(H=this.IDATA.edgematch[W][2],b=this.IDATA.edgematch[W][3],b&&"A"===b)for(let O=1;O<m;O++)J.x=O*t,J.y=O*q,X.x=y-(m-O)*(t+q),X.y=S+(m-O)*t,u=J.x+"|"+J.y,L=X.x+"|"+X.y,x(W,H,u,L);for(let y=0;y<this.vertices.length;y++)u=this.vertices[y].x+"|"+this.vertices[y].y,B=W+"|"+u,B in f||(f[B]=O++,l[u][0]>2?U[f[B]]=[-l[u][0],l[u][1],f[B]]:U[f[B]]=[p[l[u][0]],l[u][1],f[B]])}this.closestTo=U,this.vecToidx=f}calcCoeffs(){const O=this.m,f=this.n,y=Math.sqrt(3)/3,S=O*O+f*f+O*f;this.coau=(O+f)/S,this.cobu=-f/S,this.coav=-y*(O-f)/S,this.cobv=y*(2*O+f)/S}createInnerFacets(){const O=this.m,f=this.n;for(let y=0;y<f+O+1;y++)for(let O=this.min[y];O<this.max[y]+1;O++)O<this.max[y]&&O<this.max[y+1]+1&&this.innerFacets.push(["|"+O+"|"+y,"|"+O+"|"+(y+1),"|"+(O+1)+"|"+y]),y>0&&O<this.max[y-1]&&O+1<this.max[y]+1&&this.innerFacets.push(["|"+O+"|"+y,"|"+(O+1)+"|"+y,"|"+(O+1)+"|"+(y-1)])}edgeVecsABOB(){const O=this.m,f=this.n,y=new vO(-f,O+f);for(let S=1;S<O+f;S++){const O=new vO(this.min[S],S),f=new vO(this.min[S-1],S-1),H=new vO(this.min[S+1],S+1),b=O.clone(),h=f.clone(),v=H.clone();b.rotate60About(y),h.rotate60About(y),v.rotate60About(y);const N=new vO(this.max[b.y],b.y),m=new vO(this.max[b.y-1],b.y-1),t=new vO(this.max[b.y-1]-1,b.y-1);b.x===N.x&&b.y===N.y||(b.x!==m.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([O,m,t]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([O,t,N])):b.y===v.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([O,f,m]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([O,m,H])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([O,f,m]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([O,m,N])))}}mapABOBtoOBOA(){const O=new vO(0,0);for(let f=0;f<this.isoVecsABOB.length;f++){const y=[];for(let S=0;S<3;S++)O.x=this.isoVecsABOB[f][S].x,O.y=this.isoVecsABOB[f][S].y,0===this.vertexTypes[f][S]&&O.rotateNeg120(this.m,this.n),y.push(O.clone());this.isoVecsOBOA.push(y)}}mapABOBtoBAOA(){const O=new vO(0,0);for(let f=0;f<this.isoVecsABOB.length;f++){const y=[];for(let S=0;S<3;S++)O.x=this.isoVecsABOB[f][S].x,O.y=this.isoVecsABOB[f][S].y,1===this.vertexTypes[f][S]&&O.rotate120(this.m,this.n),y.push(O.clone());this.isoVecsBAOA.push(y)}}MapToFace(O,f){const y=this.IDATA.face[O],H=y[2],b=y[1],h=y[0],v=S.m.Ng(this.IDATA.vertex[H]),N=S.m.Ng(this.IDATA.vertex[b]),m=S.m.Ng(this.IDATA.vertex[h]),t=N.xc(v),q=m.xc(v),F=t.scale(this.coau).add(q.scale(this.cobu)),I=t.scale(this.coav).add(q.scale(this.cobv)),A=[];let J,X=S.g.fb[0];for(let S=0;S<this.cartesian.length;S++)X=F.scale(this.cartesian[S].x).add(I.scale(this.cartesian[S].y)).add(v),A[S]=[X.x,X.y,X.z],J=O+"|"+this.vertices[S].x+"|"+this.vertices[S].y,f.vertex[this.vecToidx[J]]=[X.x,X.y,X.z]}build(O,f){const y=[],S=vO.Zero(),H=new vO(O,f),b=new vO(-f,O+f);y.push(S,H,b);for(let u=f;u<O+1;u++)for(let f=0;f<O+1-u;f++)y.push(new vO(f,u));if(f>0){const S=(0,Q.j)(O,f),H=O/S,b=f/S;for(let v=1;v<S;v++)y.push(new vO(v*H,v*b)),y.push(new vO(-v*b,v*(H+b))),y.push(new vO(O-v*(H+b),f+v*H));const h=O/f;for(let v=1;v<f;v++)for(let S=0;S<v*h;S++)y.push(new vO(S,v)),y.push(new vO(S,v).rotate120(O,f)),y.push(new vO(S,v).rotateNeg120(O,f))}y.sort(((O,f)=>O.x-f.x)),y.sort(((O,f)=>O.y-f.y));const h=new Array(O+f+1),v=new Array(O+f+1);for(let u=0;u<h.length;u++)h[u]=1/0,v[u]=-1/0;let N=0,m=0;const t=y.length;for(let u=0;u<t;u++)m=y[u].x,N=y[u].y,h[N]=Math.min(m,h[N]),v[N]=Math.max(m,v[N]);const q=(y,S)=>{const H=y.clone();return"A"===S&&H.rotateNeg120(O,f),"B"===S&&H.rotate120(O,f),H.x<0?H.y:H.x+H.y},F=[],I=[],A=[],J=[],X={},w=[];let B=-1,j=-1;for(let u=0;u<t;u++)F[u]=y[u].toCartesianOrigin(new vO(0,0),.5),I[u]=q(y[u],"O"),A[u]=q(y[u],"A"),J[u]=q(y[u],"B"),I[u]===A[u]&&A[u]===J[u]?(B=3,j=I[u]):I[u]===A[u]?(B=4,j=I[u]):A[u]===J[u]?(B=5,j=A[u]):J[u]===I[u]&&(B=6,j=I[u]),I[u]<A[u]&&I[u]<J[u]&&(B=2,j=I[u]),A[u]<I[u]&&A[u]<J[u]&&(B=1,j=A[u]),J[u]<A[u]&&J[u]<I[u]&&(B=0,j=J[u]),w.push([B,j,y[u].x,y[u].y]);w.sort(((O,f)=>O[2]-f[2])),w.sort(((O,f)=>O[3]-f[3])),w.sort(((O,f)=>O[1]-f[1])),w.sort(((O,f)=>O[0]-f[0]));for(let u=0;u<w.length;u++)X[w[u][2]+"|"+w[u][3]]=[w[u][0],w[u][1],u];return this.m=O,this.n=f,this.vertices=y,this.vertByDist=X,this.cartesian=F,this.min=h,this.max=v,this}}class mO{constructor(O,f,y,S){this.name=O,this.category=f,this.vertex=y,this.face=S}}class tO extends mO{innerToData(O,f){for(let y=0;y<f.innerFacets.length;y++)this.face.push(f.innerFacets[y].map((y=>f.vecToidx[O+y])))}mapABOBtoDATA(O,f){const y=f.IDATA.edgematch[O][0];for(let S=0;S<f.isoVecsABOB.length;S++){const H=[];for(let b=0;b<3;b++)0===f.vertexTypes[S][b]?H.push(O+"|"+f.isoVecsABOB[S][b].x+"|"+f.isoVecsABOB[S][b].y):H.push(y+"|"+f.isoVecsABOB[S][b].x+"|"+f.isoVecsABOB[S][b].y);this.face.push([f.vecToidx[H[0]],f.vecToidx[H[1]],f.vecToidx[H[2]]])}}mapOBOAtoDATA(O,f){const y=f.IDATA.edgematch[O][0];for(let S=0;S<f.isoVecsOBOA.length;S++){const H=[];for(let b=0;b<3;b++)1===f.vertexTypes[S][b]?H.push(O+"|"+f.isoVecsOBOA[S][b].x+"|"+f.isoVecsOBOA[S][b].y):H.push(y+"|"+f.isoVecsOBOA[S][b].x+"|"+f.isoVecsOBOA[S][b].y);this.face.push([f.vecToidx[H[0]],f.vecToidx[H[1]],f.vecToidx[H[2]]])}}mapBAOAtoDATA(O,f){const y=f.IDATA.edgematch[O][2];for(let S=0;S<f.isoVecsBAOA.length;S++){const H=[];for(let b=0;b<3;b++)1===f.vertexTypes[S][b]?H.push(O+"|"+f.isoVecsBAOA[S][b].x+"|"+f.isoVecsBAOA[S][b].y):H.push(y+"|"+f.isoVecsBAOA[S][b].x+"|"+f.isoVecsBAOA[S][b].y);this.face.push([f.vecToidx[H[0]],f.vecToidx[H[1]],f.vecToidx[H[2]]])}}orderData(O){const f=[];for(let b=0;b<13;b++)f[b]=[];const y=O.closestTo;for(let b=0;b<y.length;b++)y[b][0]>-1?y[b][1]>0&&f[y[b][0]].push([b,y[b][1]]):f[12].push([b,y[b][0]]);const S=[];for(let b=0;b<12;b++)S[b]=b;let H=12;for(let b=0;b<12;b++){f[b].sort(((O,f)=>O[1]-f[1]));for(let O=0;O<f[b].length;O++)S[f[b][O][0]]=H++}for(let b=0;b<f[12].length;b++)S[f[12][b][0]]=H++;for(let b=0;b<this.vertex.length;b++)this.vertex[b].push(S[b]);this.vertex.sort(((O,f)=>O[3]-f[3]));for(let b=0;b<this.vertex.length;b++)this.vertex[b].pop();for(let b=0;b<this.face.length;b++)for(let O=0;O<this.face[b].length;O++)this.face[b][O]=S[this.face[b][O]];this.sharedNodes=f[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(O,f){const y=[],S=[];let H=f.pop();S.push(H);let b=this.face[H].indexOf(O);b=(b+2)%3;let h=this.face[H][b];y.push(h);let v=0;for(;f.length>0;)H=f[v],this.face[H].indexOf(h)>-1?(b=(this.face[H].indexOf(h)+1)%3,h=this.face[H][b],y.push(h),S.push(H),f.splice(v,1),v=0):v++;return this.adjacentFaces.push(y),S}toGoldbergPolyhedronData(){const O=new mO("GeoDual","Goldberg",[],[]);O.name="GD dual";const f=this.vertex.length,y=new Array(f);for(let N=0;N<f;N++)y[N]=[];for(let N=0;N<this.face.length;N++)for(let O=0;O<3;O++)y[this.face[N][O]].push(N);let S=0,H=0,b=0,h=[],v=[];this.adjacentFaces=[];for(let N=0;N<y.length;N++)O.face[N]=this.setOrder(N,y[N].concat([])),y[N].forEach((f=>{S=0,H=0,b=0,h=this.face[f];for(let O=0;O<3;O++)v=this.vertex[h[O]],S+=v[0],H+=v[1],b+=v[2];O.vertex[f]=[S/3,H/3,b/3]}));return O}static BuildGeodesicData(O){const f=new tO("Geodesic-m-n","Geodesic",[[0,i.f,-1],[-i.f,1,0],[-1,0,-i.f],[1,0,-i.f],[i.f,1,0],[0,i.f,1],[-1,0,i.f],[-i.f,-1,0],[0,-i.f,-1],[i.f,-1,0],[1,0,i.f],[0,-i.f,1]],[]);O.setIndices(),O.calcCoeffs(),O.createInnerFacets(),O.edgeVecsABOB(),O.mapABOBtoOBOA(),O.mapABOBtoBAOA();for(let y=0;y<O.IDATA.face.length;y++)O.MapToFace(y,f),f.innerToData(y,O),"B"===O.IDATA.edgematch[y][1]&&f.mapABOBtoDATA(y,O),"O"===O.IDATA.edgematch[y][1]&&f.mapOBOAtoDATA(y,O),"A"===O.IDATA.edgematch[y][3]&&f.mapBAOAtoDATA(y,O);f.orderData(O);return f.vertex=f.vertex.map((function(O){const f=O[0],y=O[1],S=O[2],H=Math.sqrt(f*f+y*y+S*S);return O[0]*=1/H,O[1]*=1/H,O[2]*=1/H,O})),f}}H.d._GoldbergMeshParser=(O,f)=>qO.Parse(O,f);class qO extends H.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(O,f){return void 0===f?(O>this.goldbergData.nbUnsharedFaces-1&&(E.e.Warn("Maximum number of unshared faces used"),O=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+O):(O>11&&(E.e.Warn("Last pole used"),O=11),f>this.goldbergData.nbFacesAtPole-1&&(E.e.Warn("Maximum number of faces at a pole used"),f=this.goldbergData.nbFacesAtPole-1),12+O*this.goldbergData.nbFacesAtPole+f)}_changeGoldbergFaceColors(O){for(let y=0;y<O.length;y++){const f=O[y][0],S=O[y][1],H=O[y][2];for(let O=f;O<S+1;O++)this.goldbergData.faceColors[O]=H}const f=[];for(let y=0;y<12;y++)for(let O=0;O<5;O++)f.push(this.goldbergData.faceColors[y].r,this.goldbergData.faceColors[y].g,this.goldbergData.faceColors[y].b,this.goldbergData.faceColors[y].a);for(let y=12;y<this.goldbergData.faceColors.length;y++)for(let O=0;O<6;O++)f.push(this.goldbergData.faceColors[y].r,this.goldbergData.faceColors[y].g,this.goldbergData.faceColors[y].b,this.goldbergData.faceColors[y].a);return f}setGoldbergFaceColors(O){const f=this._changeGoldbergFaceColors(O);this.Ga(b.f.ColorKind,f)}updateGoldbergFaceColors(O){const f=this._changeGoldbergFaceColors(O);this.updateVerticesData(b.f.ColorKind,f)}_changeGoldbergFaceUVs(O){const f=this.getVerticesData(b.f.UVKind);for(let y=0;y<O.length;y++){const S=O[y][0],H=O[y][1],b=O[y][2],h=O[y][3],v=O[y][4],N=[],m=[];let t,q;for(let O=0;O<5;O++)t=b.x+h*Math.cos(v+O*Math.PI/2.5),q=b.y+h*Math.sin(v+O*Math.PI/2.5),t<0&&(t=0),t>1&&(t=1),N.push(t,q);for(let O=0;O<6;O++)t=b.x+h*Math.cos(v+O*Math.PI/3),q=b.y+h*Math.sin(v+O*Math.PI/3),t<0&&(t=0),t>1&&(t=1),m.push(t,q);for(let O=S;O<Math.min(12,H+1);O++)for(let y=0;y<5;y++)f[10*O+2*y]=N[2*y],f[10*O+2*y+1]=N[2*y+1];for(let O=Math.max(12,S);O<H+1;O++)for(let y=0;y<6;y++)f[12*O-24+2*y]=m[2*y],f[12*O-23+2*y]=m[2*y+1]}return f}setGoldbergFaceUVs(O){const f=this._changeGoldbergFaceUVs(O);this.Ga(b.f.UVKind,f)}updateGoldbergFaceUVs(O){const f=this._changeGoldbergFaceUVs(O);this.updateVerticesData(b.f.UVKind,f)}placeOnGoldbergFaceAt(O,f,y){const H=S.m.RotationFromAxis(this.goldbergData.faceXaxis[f],this.goldbergData.faceYaxis[f],this.goldbergData.faceZaxis[f]);O.rotation=H,O.position=this.goldbergData.faceCenters[f].add(this.goldbergData.faceXaxis[f].scale(y.x)).add(this.goldbergData.faceYaxis[f].scale(y.y)).add(this.goldbergData.faceZaxis[f].scale(y.z))}serialize(O){super.serialize(O),O.type="GoldbergMesh";const f={};if(f.adjacentFaces=this.goldbergData.adjacentFaces,f.nbSharedFaces=this.goldbergData.nbSharedFaces,f.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,f.nbFaces=this.goldbergData.nbFaces,f.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){f.faceColors=[];for(const O of this.goldbergData.faceColors)f.faceColors.push(O.gj())}if(this.goldbergData.faceCenters){f.faceCenters=[];for(const O of this.goldbergData.faceCenters)f.faceCenters.push(O.gj())}if(this.goldbergData.faceZaxis){f.faceZaxis=[];for(const O of this.goldbergData.faceZaxis)f.faceZaxis.push(O.gj())}if(this.goldbergData.faceYaxis){f.faceYaxis=[];for(const O of this.goldbergData.faceYaxis)f.faceYaxis.push(O.gj())}if(this.goldbergData.faceXaxis){f.faceXaxis=[];for(const O of this.goldbergData.faceXaxis)f.faceXaxis.push(O.gj())}O.goldbergData=f}static Parse(O,f){const y=O.goldbergData;y.faceColors=y.faceColors.map((O=>F.g.Ng(O))),y.faceCenters=y.faceCenters.map((O=>S.m.Ng(O))),y.faceZaxis=y.faceZaxis.map((O=>S.m.Ng(O))),y.faceXaxis=y.faceXaxis.map((O=>S.m.Ng(O))),y.faceYaxis=y.faceYaxis.map((O=>S.m.Ng(O)));const H=new qO(O.name,f);return H.goldbergData=y,H}}var FO=y(11598);class IO{constructor(O){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=O}moveTo(O,f){this._currentPath=new o.i(O,f),this._tempPaths.push(this._currentPath)}lineTo(O,f){this._currentPath.addLineTo(O,f)}quadraticCurveTo(O,f,y,S){this._currentPath.addQuadraticCurveTo(O,f,y,S,this._resolution)}bezierCurveTo(O,f,y,S,H,b){this._currentPath.addBezierCurveTo(O,f,y,S,H,b,this._resolution)}extractHoles(){for(const O of this._tempPaths)O.area()>0?this._holes.push(O):this._paths.push(O);if(!this._paths.length&&this._holes.length){const O=this._holes;this._holes=this._paths,this._paths=O}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function AO(O,f,y,S,H,b){const h=b.glyphs[O]||b.glyphs["?"];if(!h)return null;const v=new IO(H);if(h.o){const O=h.o.split(" ");for(let H=0,b=O.length;H<b;){switch(O[H++]){case"m":{const b=parseInt(O[H++])*f+y,h=parseInt(O[H++])*f+S;v.moveTo(b,h);break}case"l":{const b=parseInt(O[H++])*f+y,h=parseInt(O[H++])*f+S;v.lineTo(b,h);break}case"q":{const b=parseInt(O[H++])*f+y,h=parseInt(O[H++])*f+S,N=parseInt(O[H++])*f+y,m=parseInt(O[H++])*f+S;v.quadraticCurveTo(N,m,b,h);break}case"b":{const b=parseInt(O[H++])*f+y,h=parseInt(O[H++])*f+S,N=parseInt(O[H++])*f+y,m=parseInt(O[H++])*f+S,t=parseInt(O[H++])*f+y,q=parseInt(O[H++])*f+S;v.bezierCurveTo(N,m,t,q,b,h);break}}}}return v.extractHoles(),{offsetX:h.ha*f,shapePath:v}}const JO={CreateBox:q.b,CreateTiledBox:X,CreateSphere:w.c,CreateDisc:t.d,CreateIcoSphere:T,CreateRibbon:m,CreateCylinder:L,CreateTorus:U,CreateTorusKnot:x,CreateLineSystem:W.g,sb:W.j,CreateDashedLines:W.d,ExtrudeShape:c,ExtrudeShapeCustom:d,CreateLathe:Y,CreateTiledPlane:A,_f:Z.d,CreateGround:a.g,CreateTiledGround:a.k,CreateGroundFromHeightMap:a.c,CreatePolygon:k,ExtrudePolygon:z,CreateTube:M,CreatePolyhedron:e,CreateGeodesic:function(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=f.m||1;S!==Math.floor(S)&&(S=Math.floor(S),E.e.Warn("m not an integer only floor(m) used"));let H=f.n||0;if(H!==Math.floor(H)&&(H=Math.floor(H),E.e.Warn("n not an integer only floor(n) used")),H>S){const O=H;H=S,S=O,E.e.Warn("n > m therefore m and n swapped")}const b=new NO;return b.build(S,H),e(O,{custom:tO.BuildGeodesicData(b),size:f.size,sizeX:f.sizeX,sizeY:f.sizeY,sizeZ:f.sizeZ,faceUV:f.faceUV,faceColors:f.faceColors,flat:f.flat,updatable:f.updatable,sideOrientation:f.sideOrientation,frontUVs:f.frontUVs,backUVs:f.backUVs},y)},CreateGoldberg:function(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=f.size,N=f.sizeX||b||1,m=f.sizeY||b||1,t=f.sizeZ||b||1;let q=f.m||1;q!==Math.floor(q)&&(q=Math.floor(q),E.e.Warn("m not an integer only floor(m) used"));let I=f.n||0;if(I!==Math.floor(I)&&(I=Math.floor(I),E.e.Warn("n not an integer only floor(n) used")),I>q){const O=I;I=q,q=O,E.e.Warn("n > m therefore m and n swapped")}const A=new NO;A.build(q,I);const J=tO.BuildGeodesicData(A),X=J.toGoldbergPolyhedronData(),w=new qO(O,y);f.sideOrientation=H.d._GetDefaultSideOrientation(f.sideOrientation),w._originalBuilderSideOrientation=f.sideOrientation;(function(O,f){const y=O.size,H=O.sizeX||y||1,b=O.sizeY||y||1,N=O.sizeZ||y||1,m=0===O.sideOrientation?0:O.sideOrientation||h.c.DEFAULTSIDE,t=[],q=[],F=[],I=[];let A=1/0,J=-1/0,X=1/0,w=-1/0;for(let S=0;S<f.vertex.length;S++)A=Math.min(A,f.vertex[S][0]*H),J=Math.max(J,f.vertex[S][0]*H),X=Math.min(X,f.vertex[S][1]*b),w=Math.max(w,f.vertex[S][1]*b);let B=0;for(let h=0;h<f.face.length;h++){const O=f.face[h],y=S.m.Ng(f.vertex[O[0]]),m=S.m.Ng(f.vertex[O[2]]),j=S.m.Ng(f.vertex[O[1]]),u=m.xc(y),L=j.xc(y),p=S.m.Cross(L,u).normalize();for(let S=0;S<O.length;S++){F.push(p.x,p.y,p.z);const y=f.vertex[O[S]];t.push(y[0]*H,y[1]*b,y[2]*N);const h=(y[1]*b-X)/(w-X);I.push((y[0]*H-A)/(J-A),v.b?1-h:h)}for(let f=0;f<O.length-2;f++)q.push(B,B+f+2,B+f+1);B+=O.length}h.c._ComputeSides(m,t,q,F,I);const j=new h.c;return j.xa=t,j.indices=q,j.ya=F,j.Aa=I,j})(f,X).Ca(w,f.updatable),w.goldbergData.nbSharedFaces=J.sharedNodes,w.goldbergData.nbUnsharedFaces=J.poleNodes,w.goldbergData.adjacentFaces=J.adjacentFaces,w.goldbergData.nbFaces=w.goldbergData.nbSharedFaces+w.goldbergData.nbUnsharedFaces,w.goldbergData.nbFacesAtPole=(w.goldbergData.nbUnsharedFaces-12)/12;for(let H=0;H<J.vertex.length;H++)w.goldbergData.faceCenters.push(S.m.Ng(J.vertex[H])),w.goldbergData.faceCenters[H].x*=N,w.goldbergData.faceCenters[H].y*=m,w.goldbergData.faceCenters[H].z*=t,w.goldbergData.faceColors.push(new F.g(1,1,1,1));for(let H=0;H<X.face.length;H++){const O=X.face[H],f=S.m.Ng(X.vertex[O[0]]),y=S.m.Ng(X.vertex[O[2]]),b=S.m.Ng(X.vertex[O[1]]),h=y.xc(f),v=b.xc(f),N=S.m.Cross(v,h).normalize(),m=S.m.Cross(v,N).normalize();w.goldbergData.faceXaxis.push(v.normalize()),w.goldbergData.faceYaxis.push(N),w.goldbergData.faceZaxis.push(m)}return w},CreateDecal:HO,CreateCapsule:hO,CreateText:function(O,f,y){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,v=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const N=function(O,f,y,S){const H=Array.from(O),b=f/S.resolution,h=(S.boundingBox.yMax-S.boundingBox.yMin+S.underlineThickness)*b,v=[];let N=0,m=0;for(let t=0;t<H.length;t++){const O=H[t];if("\n"===O)N=0,m-=h;else{const f=AO(O,b,N,m,y,S);f&&(N+=f.offsetX,v.push(f.shapePath))}}return v}(f,b.size||50,b.resolution||8,y),m=[];let t=0;for(const A of N){if(!A.paths.length)continue;const f=A.holes.slice();for(const y of A.paths){var q,F;const N=[],I=[],A=y.getPoints();for(const O of A)I.push(new S.m(O.x,0,O.y));const J=f.slice();for(const O of J){const H=O.getPoints();let b=!1;for(const O of H)if(y.isPointInside(O)){b=!0;break}if(!b)continue;const h=[];for(const O of H)h.push(new S.m(O.x,0,O.y));N.push(h),f.splice(f.indexOf(O),1)}if(!N.length&&f.length)for(const O of f){const f=O.getPoints(),y=[];for(const O of f)y.push(new S.m(O.x,0,O.y));N.push(y)}const X=z(O,{shape:I,holes:N.length?N:void 0,depth:b.depth||1,faceUV:b.faceUV||(null===(q=b.perLetterFaceUV)||void 0===q?void 0:q.call(b,t)),faceColors:b.faceColors||(null===(F=b.perLetterFaceColors)||void 0===F?void 0:F.call(b,t)),sideOrientation:H.d._GetDefaultSideOrientation(b.sideOrientation||H.d.DOUBLESIDE)},h,v);m.push(X),t++}}const I=H.d.MergeMeshes(m,!0,!0);if(I){const f=I.getBoundingInfo().boundingBox;I.position.x+=-(f.minimumWorld.x+f.maximumWorld.x)/2,I.position.y+=-(f.minimumWorld.y+f.maximumWorld.y)/2,I.position.z+=-(f.minimumWorld.z+f.maximumWorld.z)/2+f.extendSize.z,I.name=O;const y=new FO.b("pivot",h);y.rotation.x=-Math.PI/2,I.parent=y,I.bakeCurrentTransformIntoVertices(),I.parent=null,y.dispose()}return I}}},11458:(O,f,y)=>{"use strict";y.d(f,{b:()=>N});var S=y(11392),H=y(11463),b=y(11466),h=y(11484),v=y(11488);class N{get materialDefines(){var O;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(O=this._getDrawWrapper())||void 0===O?void 0:O.defines}set materialDefines(O){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=O}_getDrawWrapper(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];O=O??this._engine.currentRenderPassId;let y=this._drawWrappers[O];return!y&&f&&(this._drawWrappers[O]=y=new v.b(this._mesh.va().getEngine())),y}_removeDrawWrapper(O){var f;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(f=this._drawWrappers[O])||void 0===f||f.dispose());this._drawWrappers[O]=void 0}get effect(){var O;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(O=this._getDrawWrapper())||void 0===O?void 0:O.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(O){this._mainDrawWrapperOverride=O}setEffect(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2?arguments[2]:void 0,S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const H=this._drawWrapper;H.setEffect(O,f,S),void 0!==y&&(H.materialContext=y),O||(H.defines=null,H.materialContext=void 0)}resetDrawCache(O){if(this._drawWrappers){if(void 0!==O)return void this._removeDrawWrapper(O);for(const O of this._drawWrappers)null===O||void 0===O||O.dispose()}this._drawWrappers=[]}static AddToMesh(O,f,y,S,H,b,h){return new N(O,f,y,S,H,b,h,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(O,f,y,S,H,b,h){let v=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],N=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=O,this.verticesStart=f,this.verticesCount=y,this.indexStart=S,this.indexCount=H,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=b,this._renderingMesh=h||b,N&&b.Yf.push(this),this._engine=this._mesh.va().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=b.Yf.length-1,v&&(this.refreshBoundingInfo(),b.Mj(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(O){return this._boundingInfo=O,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const O=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return O||this._renderingMesh}Ha(){let O=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const f=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!f)return O?this._mesh.va().defaultMaterial:null;if(this._isMultiMaterial(f)){const O=f.getSubMaterial(this.materialIndex);return this._currentMaterial!==O&&(this._currentMaterial=O,this.resetDrawCache()),O}return f}_isMultiMaterial(O){return void 0!==O.getSubMaterial}refreshBoundingInfo(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.Bj)return this;if(O||(O=this._renderingMesh.getVerticesData(S.f.PositionKind)),!O)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const f=this._renderingMesh.Pf();let y;if(0===this.indexStart&&this.indexCount===f.length){const O=this._renderingMesh.getBoundingInfo();y={minimum:O.minimum.clone(),maximum:O.maximum.clone()}}else y=(0,h.d)(O,f,this.indexStart,this.indexCount,this._renderingMesh.Bj.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(y.minimum,y.maximum):this._boundingInfo=new b.e(y.minimum,y.maximum),this}_checkCollision(O){return this.getBoundingInfo()._checkCollision(O)}updateBoundingInfo(O){let f=this.getBoundingInfo();return f||(this.refreshBoundingInfo(),f=this.getBoundingInfo()),f&&f.update(O),this}isInFrustum(O){const f=this.getBoundingInfo();return!!f&&f.isInFrustum(O,this._mesh.Bi)}isCompletelyInFrustum(O){const f=this.getBoundingInfo();return!!f&&f.isCompletelyInFrustum(O)}render(O){return this._renderingMesh.render(this,O,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(O,f){if(!this._linesIndexBuffer){const y=[];for(let f=this.indexStart;f<this.indexStart+this.indexCount;f+=3)y.push(O[f],O[f+1],O[f+1],O[f+2],O[f+2],O[f]);this._linesIndexBuffer=f.createIndexBuffer(y),this._linesIndexCount=y.length}return this._linesIndexBuffer}canIntersects(O){const f=this.getBoundingInfo();return!!f&&O.intersectsBox(f.boundingBox)}intersects(O,f,y,S,H){const b=this.Ha();if(!b)return null;let h=3,v=!1;switch(b.fillMode){case 3:case 5:case 6:case 8:return null;case 7:h=1,v=!0}return 4===b.fillMode?y.length?this._intersectLines(O,f,y,this._mesh.intersectionThreshold,S):this._intersectUnIndexedLines(O,f,y,this._mesh.intersectionThreshold,S):!y.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(O,f,y,S,H):this._intersectTriangles(O,f,y,h,v,S,H)}_intersectLines(O,f,y,S,b){let h=null;for(let v=this.indexStart;v<this.indexStart+this.indexCount;v+=2){const N=f[y[v]],m=f[y[v+1]],t=O.intersectionSegment(N,m,S);if(!(t<0)&&((b||!h||t<h.distance)&&(h=new H.b(null,null,t),h.faceId=v/2,b)))break}return h}_intersectUnIndexedLines(O,f,y,S,b){let h=null;for(let v=this.verticesStart;v<this.verticesStart+this.verticesCount;v+=2){const y=f[v],N=f[v+1],m=O.intersectionSegment(y,N,S);if(!(m<0)&&((b||!h||m<h.distance)&&(h=new H.b(null,null,m),h.faceId=v/2,b)))break}return h}_intersectTriangles(O,f,y,S,H,b,h){let v=null,N=-1;for(let m=this.indexStart;m<this.indexStart+this.indexCount-(3-S);m+=S){N++;const S=y[m],t=y[m+1],q=y[m+2];if(H&&4294967295===q){m+=2;continue}const F=f[S],I=f[t],A=f[q];if(!F||!I||!A)continue;if(h&&!h(F,I,A,O,S,t,q))continue;const J=O.intersectsTriangle(F,I,A);if(J){if(J.distance<0)continue;if((b||!v||J.distance<v.distance)&&(v=J,v.faceId=N,b))break}}return v}_intersectUnIndexedTriangles(O,f,y,S,H){let b=null;for(let h=this.verticesStart;h<this.verticesStart+this.verticesCount;h+=3){const y=f[h],v=f[h+1],N=f[h+2];if(H&&!H(y,v,N,O,-1,-1,-1))continue;const m=O.intersectsTriangle(y,v,N);if(m){if(m.distance<0)continue;if((S||!b||m.distance<b.distance)&&(b=m,b.faceId=h/3,S))break}}return b}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(O,f){const y=new N(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,O,f,!1);if(!this.IsGlobal){const O=this.getBoundingInfo();if(!O)return y;y._boundingInfo=new b.e(O.minimum,O.maximum)}return y}dispose(){this._linesIndexBuffer&&(this._mesh.va().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const O=this._mesh.Yf.indexOf(this);this._mesh.Yf.splice(O,1),this.resetDrawCache()}getClassName(){return"SubMesh"}static CreateFromIndices(O,f,y,S,H){let b=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],h=Number.MAX_VALUE,v=-Number.MAX_VALUE;const m=(H||S).Pf();for(let N=f;N<f+y;N++){const O=m[N];O<h&&(h=O),O>v&&(v=O)}return new N(O,h,v-h+1,f,y,S,H,b)}}},12274:(O,f,y)=>{"use strict";var S=y(11557),H=y(11392),b=y(11324),h=y(11017),v=y(11466);S.d.prototype.thinInstanceAdd=function(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.va().getEngine().getCaps().instancedArrays)return h.e.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(O)?O.length:1);const y=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(O))for(let S=0;S<O.length;++S)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,O[S],S===O.length-1&&f);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,O,f);return y},S.d.prototype.thinInstanceAddSelf=function(){let O=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(b.b.IdentityReadOnly,O)},S.d.prototype.thinInstanceRegisterAttribute=function(O,f){O===H.f.ColorKind&&(O=H.f.ColorInstanceKind),this.removeVerticesData(O),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[O]=f,this._userThinInstanceBuffersStorage.sizes[O]=f*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[O]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[O]),this._userThinInstanceBuffersStorage.vertexBuffers[O]=new H.f(this.getEngine(),this._userThinInstanceBuffersStorage.data[O],O,!0,!1,f,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[O])},S.d.prototype.thinInstanceSetMatrixAt=function(O,f){let y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||O>=this._thinInstanceDataStorage.instancesCount)return!1;const S=this._thinInstanceDataStorage.matrixData;return f.copyToArray(S,16*O),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[O]=f),y&&(this.vc("matrix"),this.Da||this.thinInstanceRefreshBoundingInfo(!1)),!0},S.d.prototype.thinInstanceSetAttributeAt=function(O,f,y){let S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return O===H.f.ColorKind&&(O=H.f.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[O]||f>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(O,0),this._userThinInstanceBuffersStorage.data[O].set(y,f*this._userThinInstanceBuffersStorage.strides[O]),S&&this.vc(O),!0)},Object.defineProperty(S.d.prototype,"tc",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(O){var f;const y=this._thinInstanceDataStorage.matrixData??(null===(f=this.source)||void 0===f?void 0:f._thinInstanceDataStorage.matrixData);O<=(y?y.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=O)},enumerable:!0,configurable:!0}),S.d.prototype._thinInstanceCreateMatrixBuffer=function(O,f){let y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const S=new H.d(this.getEngine(),f,!y,16,!1,!0);for(let H=0;H<4;H++)this.setVerticesBuffer(S.createVertexBuffer(O+H,4*H,4));return S},S.d.prototype.lc=function(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var b;if(y=y||16,"matrix"===O)null===(b=this._thinInstanceDataStorage.matrixBuffer)||void 0===b||b.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=f?f.length:32*y,this._thinInstanceDataStorage.matrixData=f,this._thinInstanceDataStorage.worldMatrices=null,null!==f?(this._thinInstanceDataStorage.instancesCount=f.length/y,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",f,S),this.Da||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.Da||this.refreshBoundingInfo());else if("previousMatrix"===O){var h;null===(h=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===h||h.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=f,null!==f&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",f,S))}else{var v;if(O===H.f.ColorKind&&(O=H.f.ColorInstanceKind),null===f)null!==(v=this._userThinInstanceBuffersStorage)&&void 0!==v&&v.data[O]&&(this.removeVerticesData(O),delete this._userThinInstanceBuffersStorage.data[O],delete this._userThinInstanceBuffersStorage.strides[O],delete this._userThinInstanceBuffersStorage.sizes[O],delete this._userThinInstanceBuffersStorage.vertexBuffers[O]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[O]=f,this._userThinInstanceBuffersStorage.strides[O]=y,this._userThinInstanceBuffersStorage.sizes[O]=f.length,this._userThinInstanceBuffersStorage.vertexBuffers[O]=new H.f(this.getEngine(),f,O,!S,!1,y,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[O])}},S.d.prototype.vc=function(O){var f;if("matrix"===O)this.Kj&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(O),null===(f=this._thinInstanceDataStorage.matrixBuffer)||void 0===f||f.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===O){var y;this.Kj&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(O),null===(y=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===y||y.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var S;O===H.f.ColorKind&&(O=H.f.ColorInstanceKind),null!==(S=this._userThinInstanceBuffersStorage)&&void 0!==S&&S.vertexBuffers[O]&&(this.Kj&&!this._userThinInstanceBuffersStorage.vertexBuffers[O].isUpdatable()&&this._thinInstanceRecreateBuffer(O),this._userThinInstanceBuffersStorage.vertexBuffers[O].updateDirectly(this._userThinInstanceBuffersStorage.data[O],0))}},S.d.prototype.thinInstancePartialBufferUpdate=function(O,f,y){var S;"matrix"===O?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(f,y):(O===H.f.ColorKind&&(O=H.f.ColorInstanceKind),null!==(S=this._userThinInstanceBuffersStorage)&&void 0!==S&&S.vertexBuffers[O]&&this._userThinInstanceBuffersStorage.vertexBuffers[O].updateDirectly(f,y))},S.d.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const O=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let f=0;f<this._thinInstanceDataStorage.instancesCount;++f)this._thinInstanceDataStorage.worldMatrices[f]=b.b.Ng(O,16*f)}return this._thinInstanceDataStorage.worldMatrices},S.d.prototype.thinInstanceRefreshBoundingInfo=function(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const S=this._thinInstanceDataStorage.boundingVectors;if(O||!this.rawBoundingInfo){S.length=0,this.refreshBoundingInfo(f,y);const O=this.getBoundingInfo();this.rawBoundingInfo=new v.e(O.minimum,O.maximum)}const H=this.getBoundingInfo(),h=this._thinInstanceDataStorage.matrixData;if(0===S.length)for(let b=0;b<H.boundingBox.vectors.length;++b)S.push(H.boundingBox.vectors[b].clone());b.g.fb[0].Wd(Number.POSITIVE_INFINITY),b.g.fb[1].Wd(Number.NEGATIVE_INFINITY);for(let v=0;v<this._thinInstanceDataStorage.instancesCount;++v){b.b.FromArrayToRef(h,16*v,b.g.Matrix[0]);for(let O=0;O<S.length;++O)b.m.TransformCoordinatesToRef(S[O],b.g.Matrix[0],b.g.fb[2]),b.g.fb[0].minimizeInPlace(b.g.fb[2]),b.g.fb[1].maximizeInPlace(b.g.fb[2])}H.reConstruct(b.g.fb[0],b.g.fb[1]),this.Ea()},S.d.prototype._thinInstanceRecreateBuffer=function(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var y;if("matrix"===O)null===(y=this._thinInstanceDataStorage.matrixBuffer)||void 0===y||y.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,f);else if("previousMatrix"===O){var S;if(this._scene.needsPreviousWorldMatrices)null===(S=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===S||S.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,f)}else{var b;O===H.f.ColorKind&&(O=H.f.ColorInstanceKind),null===(b=this._userThinInstanceBuffersStorage.vertexBuffers[O])||void 0===b||b.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[O]=new H.f(this.getEngine(),this._userThinInstanceBuffersStorage.data[O],O,!f,!1,this._userThinInstanceBuffersStorage.strides[O],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[O])}},S.d.prototype._thinInstanceUpdateBufferSize=function(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;O===H.f.ColorKind&&(O=H.f.ColorInstanceKind);const y="matrix"===O;if(!y&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[O]))return;const S=y?16:this._userThinInstanceBuffersStorage.strides[O],b=y?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[O];let h=y?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[O];const v=(this._thinInstanceDataStorage.instancesCount+f)*S;let N=b;for(;N<v;)N*=2;if(!h||b!=N){if(h){const O=new Float32Array(N);O.set(h,0),h=O}else h=new Float32Array(N);var m,t,q;if(y){if(null===(m=this._thinInstanceDataStorage.matrixBuffer)||void 0===m||m.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",h,!1),this._thinInstanceDataStorage.matrixData=h,this._thinInstanceDataStorage.matrixBufferSize=N,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(t=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===t||t.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",h,!1)}else null===(q=this._userThinInstanceBuffersStorage.vertexBuffers[O])||void 0===q||q.dispose(),this._userThinInstanceBuffersStorage.data[O]=h,this._userThinInstanceBuffersStorage.sizes[O]=N,this._userThinInstanceBuffersStorage.vertexBuffers[O]=new H.f(this.getEngine(),h,O,!0,!1,S,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[O])}},S.d.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},S.d.prototype._disposeThinInstanceSpecificData=function(){var O;null!==(O=this._thinInstanceDataStorage)&&void 0!==O&&O.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},11598:(O,f,y)=>{"use strict";y.d(f,{b:()=>q});var S=y(11289),H=y(11294),b=y(11362),h=y(11004),v=y(11324),N=y(11568),m=y(11153);const t=v.b.Compose(v.m.One(),v.c.FromEulerAngles(0,Math.PI,0),v.m.Zero());class q extends N.c{get billboardMode(){return this._billboardMode}set billboardMode(O){this._billboardMode!==O&&(this._billboardMode=O,this._cache.useBillboardPosition=0!==(this._billboardMode&q.BILLBOARDMODE_USE_POSITION),this._computeUseBillboardPath())}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set preserveParentRotationForBillboard(O){O!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=O,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==q.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(O){this._infiniteDistance!==O&&(this._infiniteDistance=O)}constructor(O){let f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(O,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new v.m(0,0,1),this._up=new v.m(0,1,0),this._right=new v.m(1,0,0),this._position=v.m.Zero(),this._rotation=v.m.Zero(),this._rotationQuaternion=null,this._scaling=v.m.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=q.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.Oj=v.b.Zero(),this._usePivotMatrix=!1,this._absolutePosition=v.m.Zero(),this._absoluteScaling=v.m.Zero(),this._absoluteRotationQuaternion=v.c.Identity(),this._pivotMatrix=v.b.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new h.d,this._nonUniformScaling=!1,f&&this.va().addTransformNode(this)}getClassName(){return"tb"}get position(){return this._position}set position(O){this._position=O,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(O){this._rotation=O,this._rotationQuaternion=null,this._markAsDirtyInternal()}get Yd(){return this._scaling}set Yd(O){this._scaling=O,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(O){this._rotationQuaternion=O,O&&this._rotation.Wd(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return v.m.TransformNormalFromFloatsToRef(0,0,this.va().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return v.m.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return v.m.TransformNormalFromFloatsToRef(this.va().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(O){return this._poseMatrix?(this._poseMatrix.p(O),this):(this._poseMatrix=O.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=v.b.Identity()),this._poseMatrix}_isSynchronized(){const O=this._cache;return this._billboardMode===O.billboardMode&&this._billboardMode===q.BILLBOARDMODE_NONE&&(!O.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const O=this._cache;O.localMatrixUpdated=!1,O.billboardMode=-1,O.infiniteDistance=!1,O.useBillboardPosition=!1,O.useBillboardPath=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(O){return this.setPivotMatrix(O,!1)}setPivotMatrix(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.p(O),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=f,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=v.b.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,f=arguments.length>1?arguments[1]:void 0,y=arguments.length>2?arguments[2]:void 0;const S=this.clone("Clone of "+(this.name||this.id),O||this.parent,!0);S&&y&&y(this,S);for(const H of this.getChildTransformNodes(!0))H.instantiateHierarchy(S,f,y);return S}sd(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return O?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.Wd(0),this._rotationQuaternion=this._rotationQuaternion||v.c.Identity(),O.decompose(this._scaling,this._rotationQuaternion,this._position),this.Mj(!0)):(this._worldMatrix=O,this._absolutePosition.Xd(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.Mj(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.Mj(!0),this}get nj(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.Mj(),this._absolutePosition}setAbsolutePosition(O){if(!O)return this;let f,y,S;if(void 0===O.x){if(arguments.length<3)return this;f=arguments[0],y=arguments[1],S=arguments[2]}else f=O.x,y=O.y,S=O.z;if(this.parent){const O=v.g.Matrix[0];this.parent.getWorldMatrix().invertToRef(O),v.m.TransformCoordinatesFromFloatsToRef(f,y,S,O,this.position)}else this.position.x=f,this.position.y=y,this.position.z=S;return this._absolutePosition.p(O),this}setPositionWithLocalVector(O){return this.Mj(),this.position=v.m.TransformNormal(O,this.Oj),this}getPositionExpressedInLocalSpace(){this.Mj();const O=v.g.Matrix[0];return this.Oj.invertToRef(O),v.m.TransformNormal(this.position,O)}locallyTranslate(O){return this.Mj(!0),this.position=v.m.TransformCoordinates(O,this.Oj),this}lookAt(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const b=q._LookAtVectorCache,h=0===H?this.position:this.getAbsolutePosition();if(O.subtractToRef(h,b),this.setDirection(b,f,y,S),1===H&&this.parent)if(this.rotationQuaternion){const O=v.g.Matrix[0];this.rotationQuaternion.toRotationMatrix(O);const f=v.g.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(f),f.invert(),O.multiplyToRef(f,O),this.rotationQuaternion.fromRotationMatrix(O)}else{const O=v.g.Quaternion[0];v.c.FromEulerVectorToRef(this.rotation,O);const f=v.g.Matrix[0];O.toRotationMatrix(f);const y=v.g.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(y),y.invert(),f.multiplyToRef(y,f),O.fromRotationMatrix(f),O.toEulerAnglesToRef(this.rotation)}return this}Oe(O){const f=v.m.Zero();return this.getDirectionToRef(O,f),f}getDirectionToRef(O,f){return v.m.TransformNormalToRef(O,this.getWorldMatrix(),f),this}setDirection(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const H=-Math.atan2(O.z,O.x)+Math.PI/2,b=Math.sqrt(O.x*O.x+O.z*O.z),h=-Math.atan2(O.y,b);return this.rotationQuaternion?v.c.RotationYawPitchRollToRef(H+f,h+y,S,this.rotationQuaternion):(this.rotation.x=h+y,this.rotation.y=H+f,this.rotation.z=S),this}setPivotPoint(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.va().getRenderId()&&this.Mj(!0);const y=this.getWorldMatrix();if(1==f){const f=v.g.Matrix[0];y.invertToRef(f),O=v.m.TransformCoordinates(O,f)}return this.setPivotMatrix(v.b.Translation(-O.x,-O.y,-O.z),!0)}getPivotPoint(){const O=v.m.Zero();return this.getPivotPointToRef(O),O}getPivotPointToRef(O){return O.x=-this._pivotMatrix.m[12],O.y=-this._pivotMatrix.m[13],O.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const O=v.m.Zero();return this.getAbsolutePivotPointToRef(O),O}getAbsolutePivotPointToRef(O){return this.getPivotPointToRef(O),v.m.TransformCoordinatesToRef(O,this.getWorldMatrix(),O),this}Dg(O){if(this._isDirty)return this;if(this._children)for(const f of this._children)f.Dg(O);return super.Dg(O)}setParent(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!O&&!this.parent)return this;const S=v.g.Quaternion[0],H=v.g.fb[0],b=v.g.fb[1],h=v.g.Matrix[1];v.b.IdentityToRef(h);const N=v.g.Matrix[0];this.Mj(!0);let m=this.rotationQuaternion;return m||(m=q._TmpRotation,v.c.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,m)),v.b.ComposeToRef(this.Yd,m,this.position,N),this.parent&&N.multiplyToRef(this.parent.Mj(!0),N),O&&(O.Mj(!0).invertToRef(h),N.multiplyToRef(h,N)),N.decompose(b,S,H,f?this:void 0),this.rotationQuaternion?this.rotationQuaternion.p(S):S.toEulerAnglesToRef(this.rotation),this.Yd.p(b),this.position.p(H),this.parent=O,y&&this.setPivotMatrix(v.b.Identity()),this}addChild(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return O.setParent(this,f),this}removeChild(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return O.setParent(null,f),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(O){return this._nonUniformScaling!==O&&(this._nonUniformScaling=O,!0)}attachToBone(O,f){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=f,this.parent=O,O.getSkeleton().prepare(!0),O.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=O?this._currentParentWhenAttachingToBone:null,this):(O&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(O,f,y){let S;if(O.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.Wd(0)),y&&0!==y){if(this.parent){const y=this.parent.getWorldMatrix(),S=v.g.Matrix[0];y.invertToRef(S),O=v.m.TransformNormal(O,S),y.determinant()<0&&(f*=-1)}S=v.c.RotationAxisToRef(O,f,q._RotationAxisCache),S.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else S=v.c.RotationAxisToRef(O,f,q._RotationAxisCache),this.rotationQuaternion.multiplyToRef(S,this.rotationQuaternion);return this}rotateAround(O,f,y){f.normalize(),this.rotationQuaternion||(this.rotationQuaternion=v.c.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.Wd(0));const S=v.g.fb[0],H=v.g.fb[1],b=v.g.fb[2],h=v.g.Quaternion[0],N=v.g.Matrix[0],m=v.g.Matrix[1],t=v.g.Matrix[2],q=v.g.Matrix[3];return O.subtractToRef(this.position,S),v.b.TranslationToRef(S.x,S.y,S.z,N),v.b.TranslationToRef(-S.x,-S.y,-S.z,m),v.b.RotationAxisToRef(f,y,t),m.multiplyToRef(t,q),q.multiplyToRef(N,q),q.decompose(H,h,b),this.position.addInPlace(b),h.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(O,f,y){const S=O.scale(f);if(y&&0!==y)this.setAbsolutePosition(this.getAbsolutePosition().add(S));else{const O=this.getPositionExpressedInLocalSpace().add(S);this.setPositionWithLocalVector(O)}return this}addRotation(O,f,y){let S;this.rotationQuaternion?S=this.rotationQuaternion:(S=v.g.Quaternion[1],v.c.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,S));const H=v.g.Quaternion[0];return v.c.RotationYawPitchRollToRef(f,O,y,H),S.multiplyInPlace(H),this.rotationQuaternion||S.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==q.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}Mj(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const y=this.va().getRenderId();if(!this._isDirty&&!O&&(this._currentRenderId===y||this.isSynchronized()))return this._currentRenderId=y,this._worldMatrix;f=f||this.va().activeCamera,this._updateCache();const S=this._cache;S.pivotMatrixUpdated=!1,S.billboardMode=this.billboardMode,S.infiniteDistance=this.infiniteDistance,S.parent=this._parentNode,this._currentRenderId=y,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const H=this._getEffectiveParent(),b=q._TmpScaling;let h,N=this._position;if(this._infiniteDistance&&!this.parent&&f){const O=f.getWorldMatrix(),y=new v.m(O.m[12],O.m[13],O.m[14]);N=q._TmpTranslation,N.Xd(this._position.x+y.x,this._position.y+y.y,this._position.z+y.z)}if(b.Xd(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,h=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(v.c.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.Xd(0,0,0))}}else h=q._TmpRotation,v.c.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,h);if(this._usePivotMatrix){const O=v.g.Matrix[1];v.b.ScalingToRef(b.x,b.y,b.z,O);const f=v.g.Matrix[0];h.toRotationMatrix(f),this._pivotMatrix.multiplyToRef(O,v.g.Matrix[4]),v.g.Matrix[4].multiplyToRef(f,this.Oj),this._postMultiplyPivotMatrix&&this.Oj.multiplyToRef(this._pivotMatrixInverse,this.Oj),this.Oj.addTranslationFromFloats(N.x,N.y,N.z)}else v.b.ComposeToRef(b,h,N,this.Oj);if(H&&H.getWorldMatrix){if(O&&H.Mj(O),S.useBillboardPath){if(this._transformToBoneReferal){const O=this.parent;O.getSkeleton().prepare(),O.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),v.g.Matrix[7])}else v.g.Matrix[7].p(H.getWorldMatrix());const O=v.g.fb[5],f=v.g.fb[6],y=v.g.Quaternion[0];v.g.Matrix[7].decompose(f,y,O),v.b.ScalingToRef(f.x,f.y,f.z,v.g.Matrix[7]),v.g.Matrix[7].setTranslation(O),q.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(y,O),this.Oj.setTranslation(O)),this.Oj.multiplyToRef(v.g.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const O=this.parent;O.getSkeleton().prepare(),this.Oj.multiplyToRef(O.getFinalMatrix(),v.g.Matrix[6]),v.g.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.Oj.multiplyToRef(H.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.p(this.Oj);if(S.useBillboardPath&&f&&this.billboardMode&&!S.useBillboardPosition){const O=v.g.fb[0];if(this._worldMatrix.getTranslationToRef(O),v.g.Matrix[1].p(f.getViewMatrix()),this._scene.useRightHandedSystem&&v.g.Matrix[1].multiplyToRef(t,v.g.Matrix[1]),v.g.Matrix[1].setTranslationFromFloats(0,0,0),v.g.Matrix[1].invertToRef(v.g.Matrix[0]),(this.billboardMode&q.BILLBOARDMODE_ALL)!==q.BILLBOARDMODE_ALL){v.g.Matrix[0].decompose(void 0,v.g.Quaternion[0],void 0);const O=v.g.fb[1];v.g.Quaternion[0].toEulerAnglesToRef(O),(this.billboardMode&q.BILLBOARDMODE_X)!==q.BILLBOARDMODE_X&&(O.x=0),(this.billboardMode&q.BILLBOARDMODE_Y)!==q.BILLBOARDMODE_Y&&(O.y=0),(this.billboardMode&q.BILLBOARDMODE_Z)!==q.BILLBOARDMODE_Z&&(O.z=0),v.b.RotationYawPitchRollToRef(O.y,O.x,O.z,v.g.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(v.g.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(v.g.fb[0])}else if(S.useBillboardPath&&f&&S.useBillboardPosition){const O=v.g.fb[0];this._worldMatrix.getTranslationToRef(O);const y=f.globalPosition;this._worldMatrix.invertToRef(v.g.Matrix[1]);const S=v.g.fb[1];v.m.TransformCoordinatesToRef(y,v.g.Matrix[1],S),S.normalize();const H=-Math.atan2(S.z,S.x)+Math.PI/2,b=Math.sqrt(S.x*S.x+S.z*S.z),h=-Math.atan2(S.y,b);if(v.c.RotationYawPitchRollToRef(H,h,0,v.g.Quaternion[0]),(this.billboardMode&q.BILLBOARDMODE_ALL)!==q.BILLBOARDMODE_ALL){const O=v.g.fb[1];v.g.Quaternion[0].toEulerAnglesToRef(O),(this.billboardMode&q.BILLBOARDMODE_X)!==q.BILLBOARDMODE_X&&(O.x=0),(this.billboardMode&q.BILLBOARDMODE_Y)!==q.BILLBOARDMODE_Y&&(O.y=0),(this.billboardMode&q.BILLBOARDMODE_Z)!==q.BILLBOARDMODE_Z&&(O.z=0),v.b.RotationYawPitchRollToRef(O.y,O.x,O.z,v.g.Matrix[0])}else v.b.FromQuaternionToRef(v.g.Quaternion[0],v.g.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(v.g.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(v.g.fb[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):H&&H._nonUniformScaling?this._updateNonUniformScalingState(H._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.Xd(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=v.b.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let O=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.Mj(),O){const O=this.getChildren();for(let f=0;f<O.length;++f){const y=O[f];if(y){y.Mj();const O=v.g.Matrix[0];y.Oj.multiplyToRef(this.Oj,O);const f=v.g.Quaternion[0];O.decompose(y.Yd,f,y.position),y.rotationQuaternion?y.rotationQuaternion.p(f):f.toEulerAnglesToRef(y.rotation)}}}this.Yd.Xd(1,1,1),this.position.Xd(0,0,0),this.rotation.Xd(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=v.c.Identity()),this._worldMatrix=v.b.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(O){return this.onAfterWorldMatrixUpdateObservable.add(O),this}unregisterAfterWorldMatrixUpdate(O){return this.onAfterWorldMatrixUpdateObservable.removeCallback(O),this}getPositionInCameraSpace(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return O||(O=this.va().activeCamera),v.m.TransformCoordinates(this.getAbsolutePosition(),O.getViewMatrix())}getDistanceToCamera(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return O||(O=this.va().activeCamera),this.getAbsolutePosition().xc(O.globalPosition).length()}clone(O,f,y){const S=b.b.Clone((()=>new q(O,this.va())),this);if(S.name=O,S.id=O,f&&(S.parent=f),!y){const f=this.getDescendants(!0);for(let y=0;y<f.length;y++){const H=f[y];H.clone&&H.clone(O+"."+H.name,S)}}return S}serialize(O){const f=b.b.Serialize(this,O);return f.type=this.getClassName(),f.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(f),f.localMatrix=this.getPivotMatrix().gj(),f.isEnabled=this.isEnabled(),b.b.AppendSerializedAnimations(this,f),f.ranges=this.serializeAnimationRanges(),f}static Parse(O,f,y){const S=b.b.Parse((()=>new q(O.name,f)),O,f,y);if(O.localMatrix?S.setPreTransformMatrix(v.b.Ng(O.localMatrix)):O.pivotMatrix&&S.setPivotMatrix(v.b.Ng(O.pivotMatrix)),S.$b(O.isEnabled),S._waitingParsedUniqueId=O.uniqueId,void 0!==O.parentId&&(S._waitingParentId=O.parentId),void 0!==O.parentInstanceIndex&&(S._waitingParentInstanceIndex=O.parentInstanceIndex),O.animations){for(let f=0;f<O.animations.length;f++){const y=O.animations[f],H=(0,m.c)("BABYLON.Animation");H&&S.animations.push(H.Parse(y))}N.c.ParseAnimationRanges(S,O,f)}return O.autoAnimate&&f.beginAnimation(S,O.autoAnimateFrom,O.autoAnimateTo,O.autoAnimateLoop,O.autoAnimateSpeed||1),S}getChildTransformNodes(O,f){const y=[];return this._getDescendants(y,O,(O=>(!f||f(O))&&O instanceof q)),y}dispose(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.va().stopAnimation(this),this.va().removeTransformNode(this),this._parentContainer){const O=this._parentContainer.transformNodes.indexOf(this);O>-1&&this._parentContainer.transformNodes.splice(O,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),O){const O=this.getChildTransformNodes(!0);for(const f of O)f.parent=null,f.Mj(!0)}super.dispose(O,f)}normalizeToUnitCube(){let O=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2?arguments[2]:void 0,S=null,H=null;f&&(this.rotationQuaternion?(H=this.rotationQuaternion.clone(),this.rotationQuaternion.Xd(0,0,0,1)):this.rotation&&(S=this.rotation.clone(),this.rotation.Xd(0,0,0)));const b=this.getHierarchyBoundingVectors(O,y),h=b.max.xc(b.min),v=Math.max(h.x,h.y,h.z);if(0===v)return this;const N=1/v;return this.Yd.scaleInPlace(N),f&&(this.rotationQuaternion&&H?this.rotationQuaternion.p(H):this.rotation&&S&&this.rotation.p(S)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}q.BILLBOARDMODE_NONE=0,q.BILLBOARDMODE_X=1,q.BILLBOARDMODE_Y=2,q.BILLBOARDMODE_Z=4,q.BILLBOARDMODE_ALL=7,q.BILLBOARDMODE_USE_POSITION=128,q.BillboardUseParentOrientation=!1,q._TmpRotation=v.c.Zero(),q._TmpScaling=v.m.Zero(),q._TmpTranslation=v.m.Zero(),q._LookAtVectorCache=new v.m(0,0,0),q._RotationAxisCache=new v.c,(0,S.b)([(0,H.J)("position")],q.prototype,"_position",void 0),(0,S.b)([(0,H.J)("rotation")],q.prototype,"_rotation",void 0),(0,S.b)([(0,H.z)("rotationQuaternion")],q.prototype,"_rotationQuaternion",void 0),(0,S.b)([(0,H.J)("Yd")],q.prototype,"_scaling",void 0),(0,S.b)([(0,H.L)("billboardMode")],q.prototype,"_billboardMode",void 0),(0,S.b)([(0,H.L)()],q.prototype,"scalingDeterminant",void 0),(0,S.b)([(0,H.L)("infiniteDistance")],q.prototype,"_infiniteDistance",void 0),(0,S.b)([(0,H.L)()],q.prototype,"ignoreNonUniformScaling",void 0),(0,S.b)([(0,H.L)()],q.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},11793:(O,f,y)=>{"use strict";y.d(f,{c:()=>m});var S=y(11324),H=y(11345),b=y(11776),h=y(11330),v=y(11359);class N{constructor(O,f,y,S){this.name=O,this.worldAxisForNormal=f,this.worldAxisForFileX=y,this.worldAxisForFileY=S}}class m{static ConvertCubeMapTextureToSphericalPolynomial(O){var f;if(!O.isCube)return null;null===(f=O.va())||void 0===f||f.getEngine().flushFramebuffer();const y=O.getSize().width,S=O.readPixels(0,void 0,void 0,!1),H=O.readPixels(1,void 0,void 0,!1);let b,h;O.isRenderTarget?(b=O.readPixels(3,void 0,void 0,!1),h=O.readPixels(2,void 0,void 0,!1)):(b=O.readPixels(2,void 0,void 0,!1),h=O.readPixels(3,void 0,void 0,!1));const v=O.readPixels(4,void 0,void 0,!1),N=O.readPixels(5,void 0,void 0,!1),m=O.gammaSpace;let t=0;return 1!=O.textureType&&2!=O.textureType||(t=1),new Promise((O=>{Promise.all([H,S,b,h,v,N]).then((f=>{let[S,H,b,h,v,N]=f;const q={size:y,right:H,left:S,up:b,down:h,front:v,back:N,format:5,type:t,gammaSpace:m};O(this.ConvertCubeMapToSphericalPolynomial(q))}))}))}static _AreaElement(O,f){return Math.atan2(O*f,Math.sqrt(O*O+f*f+1))}static ConvertCubeMapToSphericalPolynomial(O){const f=new b.e;let y=0;const S=2/O.size,N=S,m=.5*S,t=m-1;for(let b=0;b<6;b++){const q=this._FileFaces[b],F=O[q.name];let I=t;const A=5===O.format?4:3;for(let b=0;b<O.size;b++){let J=t;for(let N=0;N<O.size;N++){const t=q.worldAxisForFileX.scale(J).add(q.worldAxisForFileY.scale(I)).add(q.worldAxisForNormal);t.normalize();const X=this._AreaElement(J-m,I-m)-this._AreaElement(J-m,I+m)-this._AreaElement(J+m,I-m)+this._AreaElement(J+m,I+m);let w=F[b*O.size*A+N*A+0],B=F[b*O.size*A+N*A+1],j=F[b*O.size*A+N*A+2];isNaN(w)&&(w=0),isNaN(B)&&(B=0),isNaN(j)&&(j=0),0===O.type&&(w/=255,B/=255,j/=255),O.gammaSpace&&(w=Math.pow((0,H.c)(w),h.k),B=Math.pow((0,H.c)(B),h.k),j=Math.pow((0,H.c)(j),h.k));const u=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const O=Math.max(w,B,j);if(O>u){const f=u/O;w*=f,B*=f,j*=f}}else w=(0,H.c)(w,0,u),B=(0,H.c)(B,0,u),j=(0,H.c)(j,0,u);const L=new v.d(w,B,j);f.addLight(t,L,X),y+=X,J+=S}I+=N}}const q=6*(4*Math.PI)/6/y;return f.scaleInPlace(q),f.convertIncidentRadianceToIrradiance(),f.convertIrradianceToLambertianRadiance(),b.h.FromHarmonics(f)}}m._FileFaces=[new N("right",new S.m(1,0,0),new S.m(0,0,-1),new S.m(0,-1,0)),new N("left",new S.m(-1,0,0),new S.m(0,0,1),new S.m(0,-1,0)),new N("up",new S.m(0,1,0),new S.m(1,0,0),new S.m(0,0,1)),new N("down",new S.m(0,-1,0),new S.m(1,0,0),new S.m(0,0,-1)),new N("front",new S.m(0,0,1),new S.m(1,0,0),new S.m(0,-1,0)),new N("back",new S.m(0,0,-1),new S.m(-1,0,0),new S.m(0,-1,0))],m.MAX_HDRI_VALUE=4096,m.PRESERVE_CLAMPED_COLORS=!1},11338:(O,f,y)=>{"use strict";function S(O,f){const y=[];for(let S=0;S<O;++S)y.push(f());return y}function H(O,f){return S(O,f)}y.d(f,{d:()=>S,g:()=>H,i:()=>h});const b=["push","splice","pop","shift","unshift"];function h(O,f){const y=b.map((y=>function(O,f,y){const S=O[f];if("function"!==typeof S)return null;const H=function(){const S=O.length,b=H.previous.apply(O,arguments);return y(f,S),b};return S.next=H,H.previous=S,O[f]=H,()=>{const y=H.previous;if(!y)return;const S=H.next;S?(y.next=S,S.previous=y):(y.next=void 0,O[f]=y),H.next=void 0,H.previous=void 0}}(O,y,f)));return()=>{y.forEach((O=>{null===O||void 0===O||O()}))}}},12223:(O,f,y)=>{"use strict";y.d(f,{b:()=>h});var S=y(11509),H=y(12227);let b=0;const h=O=>{if(!O.environmentBRDFTexture){const f=O.useDelayedTextureLoading;O.useDelayedTextureLoading=!1;const y=O._blockEntityCollection;O._blockEntityCollection=!1;const h=S.e.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+b++,O,!0,!1,S.e.BILINEAR_SAMPLINGMODE);O._blockEntityCollection=y;const v=O.getEngine().getLoadedTexturesCache(),N=v.indexOf(h.getInternalTexture());-1!==N&&v.splice(N,1),h.isRGBD=!0,h.wrapU=S.e.CLAMP_ADDRESSMODE,h.wrapV=S.e.CLAMP_ADDRESSMODE,O.environmentBRDFTexture=h,O.useDelayedTextureLoading=f,H.e.ExpandRGBDTexture(h);const m=O.getEngine().onContextRestoredObservable.add((()=>{h.isRGBD=!0;const f=O.onBeforeRenderObservable.add((()=>{h.isReady()&&(O.onBeforeRenderObservable.remove(f),H.e.ExpandRGBDTexture(h))}))}));O.hj.add((()=>{O.getEngine().onContextRestoredObservable.remove(m)}))}return O.environmentBRDFTexture}},11559:(O,f,y)=>{"use strict";function S(O,f,y){try{const S=O.next();S.done?f(S):S.value?S.value.then((()=>{S.value=void 0,f(S)}),y):f(S)}catch(S){y(S)}}function H(){let O,f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(y,H,b)=>{const h=performance.now();void 0===O||h-O>f?(O=h,setTimeout((()=>{S(y,H,b)}),0)):S(y,H,b)}}function b(O,f,y,S,H){const b=()=>{let h;const v=O=>{O.done?y(O.value):void 0===h?h=!0:b()};do{h=void 0,H&&H.aborted?S(new Error("Aborted")):f(O,v,S),void 0===h&&(h=!1)}while(h)};b()}function h(O,f){let y;return b(O,S,(O=>y=O),(O=>{throw O}),f),y}function v(O,f,y){return new Promise(((S,H)=>{b(O,f,S,H,y)}))}function N(O,f){return function(){return h(O(...arguments),f)}}y.d(f,{b:()=>H,c:()=>N,g:()=>v,k:()=>h})},11789:(O,f,y)=>{"use strict";y.d(f,{c:()=>A});var S=y(11345),H=y(11017),b=y(11793),h=y(11795);y(11828);const v=131072,N=131072;function m(O){return O.charCodeAt(0)+(O.charCodeAt(1)<<8)+(O.charCodeAt(2)<<16)+(O.charCodeAt(3)<<24)}const t=m("DXT1"),q=m("DXT3"),F=m("DXT5"),I=m("DX10");class A{static GetDDSInfo(O){const f=new Int32Array(O.buffer,O.byteOffset,31),y=new Int32Array(O.buffer,O.byteOffset,35);let S=1;f[2]&v&&(S=Math.max(1,f[7]));const H=f[21],b=H===I?y[32]:0;let h=0;switch(H){case 113:h=2;break;case 116:h=1;break;case I:if(10===b){h=2;break}if(2===b){h=1;break}}return{width:f[4],height:f[3],mipmapCount:S,isFourCC:4===(4&f[20]),isRGB:64===(64&f[20]),isLuminance:(f[20]&N)===N,isCube:512===(512&f[28]),isCompressed:H===t||H===q||H===F,dxgiFormat:b,textureType:h}}static _GetHalfFloatAsFloatRGBAArrayBuffer(O,f,y,S,H,b){const v=new Float32Array(S),N=new Uint16Array(H,y);let m=0;for(let t=0;t<f;t++)for(let f=0;f<O;f++){const y=4*(f+t*O);v[m]=(0,h.i)(N[y]),v[m+1]=(0,h.i)(N[y+1]),v[m+2]=(0,h.i)(N[y+2]),A.StoreLODInAlphaChannel?v[m+3]=b:v[m+3]=(0,h.i)(N[y+3]),m+=4}return v}static _GetHalfFloatRGBAArrayBuffer(O,f,y,S,H,b){if(A.StoreLODInAlphaChannel){const v=new Uint16Array(S),N=new Uint16Array(H,y);let m=0;for(let y=0;y<f;y++)for(let f=0;f<O;f++){const S=4*(f+y*O);v[m]=N[S],v[m+1]=N[S+1],v[m+2]=N[S+2],v[m+3]=(0,h.k)(b),m+=4}return v}return new Uint16Array(H,y,S)}static _GetFloatRGBAArrayBuffer(O,f,y,S,H,b){if(A.StoreLODInAlphaChannel){const h=new Float32Array(S),v=new Float32Array(H,y);let N=0;for(let y=0;y<f;y++)for(let f=0;f<O;f++){const S=4*(f+y*O);h[N]=v[S],h[N+1]=v[S+1],h[N+2]=v[S+2],h[N+3]=b,N+=4}return h}return new Float32Array(H,y,S)}static _GetFloatAsHalfFloatRGBAArrayBuffer(O,f,y,S,H,b){const v=new Uint16Array(S),N=new Float32Array(H,y);let m=0;for(let t=0;t<f;t++)for(let f=0;f<O;f++)v[m]=(0,h.k)(N[m]),v[m+1]=(0,h.k)(N[m+1]),v[m+2]=(0,h.k)(N[m+2]),A.StoreLODInAlphaChannel?v[m+3]=(0,h.k)(b):v[m+3]=(0,h.k)(N[m+3]),m+=4;return v}static _GetFloatAsUIntRGBAArrayBuffer(O,f,y,H,b,h){const v=new Uint8Array(H),N=new Float32Array(b,y);let m=0;for(let t=0;t<f;t++)for(let f=0;f<O;f++){const y=4*(f+t*O);v[m]=255*(0,S.c)(N[y]),v[m+1]=255*(0,S.c)(N[y+1]),v[m+2]=255*(0,S.c)(N[y+2]),A.StoreLODInAlphaChannel?v[m+3]=h:v[m+3]=255*(0,S.c)(N[y+3]),m+=4}return v}static _GetHalfFloatAsUIntRGBAArrayBuffer(O,f,y,H,b,v){const N=new Uint8Array(H),m=new Uint16Array(b,y);let t=0;for(let q=0;q<f;q++)for(let f=0;f<O;f++){const y=4*(f+q*O);N[t]=255*(0,S.c)((0,h.i)(m[y])),N[t+1]=255*(0,S.c)((0,h.i)(m[y+1])),N[t+2]=255*(0,S.c)((0,h.i)(m[y+2])),A.StoreLODInAlphaChannel?N[t+3]=v:N[t+3]=255*(0,S.c)((0,h.i)(m[y+3])),t+=4}return N}static _GetRGBAArrayBuffer(O,f,y,S,H,b,h,v,N){const m=new Uint8Array(S),t=new Uint8Array(H,y);let q=0;for(let F=0;F<f;F++)for(let f=0;f<O;f++){const y=4*(f+F*O);m[q]=t[y+b],m[q+1]=t[y+h],m[q+2]=t[y+v],m[q+3]=t[y+N],q+=4}return m}static _ExtractLongWordOrder(O){return 0===O||255===O||-16777216===O?0:1+A._ExtractLongWordOrder(O>>8)}static _GetRGBArrayBuffer(O,f,y,S,H,b,h,v){const N=new Uint8Array(S),m=new Uint8Array(H,y);let t=0;for(let q=0;q<f;q++)for(let f=0;f<O;f++){const y=3*(f+q*O);N[t]=m[y+b],N[t+1]=m[y+h],N[t+2]=m[y+v],t+=3}return N}static _GetLuminanceArrayBuffer(O,f,y,S,H){const b=new Uint8Array(S),h=new Uint8Array(H,y);let v=0;for(let N=0;N<f;N++)for(let f=0;f<O;f++){const y=f+N*O;b[v]=h[y],v++}return b}static UploadDDSLevels(O,f,y,S,h,N){let m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:-1,J=arguments.length>7?arguments[7]:void 0,X=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],w=null;S.sphericalPolynomial&&(w=[]);const B=!!O.getCaps().s3tc;f.generateMipMaps=h;const j=new Int32Array(y.buffer,y.byteOffset,31);let u,L,p,U,l,x,W,E=0,o=0,i=1;if(542327876!==j[0])return void H.e.Error("Invalid magic number in DDS header");if(!S.isFourCC&&!S.isRGB&&!S.isLuminance)return void H.e.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(S.isCompressed&&!B)return void H.e.Error("Compressed textures are not supported on this platform.");let D=j[22];U=j[1]+4;let V=!1;if(S.isFourCC)switch(u=j[21],u){case t:i=8,o=33777;break;case q:i=16,o=33778;break;case F:i=16,o=33779;break;case 113:V=!0,D=64;break;case 116:V=!0,D=128;break;case I:{U+=20;let O=!1;switch(S.dxgiFormat){case 10:V=!0,D=64,O=!0;break;case 2:V=!0,D=128,O=!0;break;case 88:S.isRGB=!0,S.isFourCC=!1,D=32,O=!0}if(O)break}default:return void H.e.Error(["Unsupported FourCC code:",(g=u,String.fromCharCode(255&g,g>>8&255,g>>16&255,g>>24&255))])}var g;const R=A._ExtractLongWordOrder(j[23]),s=A._ExtractLongWordOrder(j[24]),k=A._ExtractLongWordOrder(j[25]),z=A._ExtractLongWordOrder(j[26]);V&&(o=O._getRGBABufferInternalSizedFormat(S.textureType)),x=1,j[2]&v&&!1!==h&&(x=Math.max(1,j[7]));const c=J||0,d=O.getCaps();for(let H=c;H<N;H++){for(L=j[4],p=j[3],W=0;W<x;++W){if(-1===m||m===W){const b=-1===m?W:0;if(!S.isCompressed&&S.isFourCC){f.format=5,E=L*p*4;let S=null;if(O._badOS||O._badDesktopOS||!d.textureHalfFloat&&!d.textureFloat)128===D?(S=A._GetFloatAsUIntRGBAArrayBuffer(L,p,y.byteOffset+U,E,y.buffer,b),w&&0==b&&w.push(A._GetFloatRGBAArrayBuffer(L,p,y.byteOffset+U,E,y.buffer,b))):64===D&&(S=A._GetHalfFloatAsUIntRGBAArrayBuffer(L,p,y.byteOffset+U,E,y.buffer,b),w&&0==b&&w.push(A._GetHalfFloatAsFloatRGBAArrayBuffer(L,p,y.byteOffset+U,E,y.buffer,b))),f.type=0;else{const O=d.textureFloat&&(X&&d.textureFloatLinearFiltering||!X),H=d.textureHalfFloat&&(X&&d.textureHalfFloatLinearFiltering||!X),h=(128===D||64===D&&!H)&&O?1:(64===D||128===D&&!O)&&H?2:0;let v,N=null;if(128===D)switch(h){case 1:v=A._GetFloatRGBAArrayBuffer,N=null;break;case 2:v=A._GetFloatAsHalfFloatRGBAArrayBuffer,N=A._GetFloatRGBAArrayBuffer;break;case 0:v=A._GetFloatAsUIntRGBAArrayBuffer,N=A._GetFloatRGBAArrayBuffer}else switch(h){case 1:v=A._GetHalfFloatAsFloatRGBAArrayBuffer,N=null;break;case 2:v=A._GetHalfFloatRGBAArrayBuffer,N=A._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:v=A._GetHalfFloatAsUIntRGBAArrayBuffer,N=A._GetHalfFloatAsFloatRGBAArrayBuffer}f.type=h,S=v(L,p,y.byteOffset+U,E,y.buffer,b),w&&0==b&&w.push(N?N(L,p,y.byteOffset+U,E,y.buffer,b):S)}S&&O._uploadDataToTextureDirectly(f,S,H,b)}else if(S.isRGB)f.type=0,24===D?(f.format=4,E=L*p*3,l=A._GetRGBArrayBuffer(L,p,y.byteOffset+U,E,y.buffer,R,s,k),O._uploadDataToTextureDirectly(f,l,H,b)):(f.format=5,E=L*p*4,l=A._GetRGBAArrayBuffer(L,p,y.byteOffset+U,E,y.buffer,R,s,k,z),O._uploadDataToTextureDirectly(f,l,H,b));else if(S.isLuminance){const S=O._getUnpackAlignement(),h=L;E=Math.floor((L+S-1)/S)*S*(p-1)+h,l=A._GetLuminanceArrayBuffer(L,p,y.byteOffset+U,E,y.buffer),f.format=1,f.type=0,O._uploadDataToTextureDirectly(f,l,H,b)}else E=Math.max(4,L)/4*Math.max(4,p)/4*i,l=new Uint8Array(y.buffer,y.byteOffset+U,E),f.type=0,O._uploadCompressedDataToTextureDirectly(f,o,L,p,l,H,b)}U+=D?L*p*(D/8):E,L*=.5,p*=.5,L=Math.max(1,L),p=Math.max(1,p)}if(void 0!==J)break}w&&w.length>0?S.sphericalPolynomial=b.c.ConvertCubeMapToSphericalPolynomial({size:j[4],right:w[0],left:w[1],up:w[2],down:w[3],front:w[4],back:w[5],format:5,type:1,gammaSpace:!1}):S.sphericalPolynomial=void 0}}A.StoreLODInAlphaChannel=!1},11300:(O,f,y)=>{"use strict";y.d(f,{b:()=>b,e:()=>h});const S={},H={};function b(O){const f=O.getClassName();return H[f]||(H[f]={}),H[f]}function h(O){const f=O.getClassName();if(S[f])return S[f];S[f]={};const y=S[f];let b=O,h=f;for(;h;){const O=H[h];for(const H in O)y[H]=O[H];let f,S=!1;do{if(f=Object.getPrototypeOf(b),!f.getClassName){S=!0;break}if(f.getClassName()!==h)break;b=f}while(f);if(S)break;h=f.getClassName(),b=f}return y}},11294:(O,f,y)=>{"use strict";y.d(f,{C:()=>v,F:()=>t,J:()=>q,L:()=>h,d:()=>b,e:()=>B,f:()=>I,h:()=>N,j:()=>A,m:()=>m,o:()=>J,s:()=>w,w:()=>F,z:()=>X});var S=y(11300);function H(O,f){return(y,H)=>{const b=(0,S.b)(y);b[H]||(b[H]={type:O,sourceName:f})}}function b(O){return function(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(y,S)=>{const H=f||"_"+S;Object.defineProperty(y,S,{get:function(){return this[H]},set:function(f){"function"===typeof this.equals&&this.equals(f)||this[H]!==f&&(this[H]=f,y[O].apply(this))},enumerable:!0,configurable:!0})}}(O,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)}function h(O){return H(0,O)}function v(O){return H(1,O)}function N(O){return H(2,O)}function m(O){return H(3,O)}function t(O){return H(4,O)}function q(O){return H(5,O)}function F(O){return H(6,O)}function I(O){return H(7,O)}function A(O){return H(8,O)}function J(O){return H(9,O)}function X(O){return H(10,O)}function w(O){return H(12,O)}function B(O,f,y,S){const H=y.value;y.value=function(){let y=H;if("undefined"!==typeof _native&&_native[f]){const O=_native[f];y=S?function(){return S(...arguments)?O(...arguments):H(...arguments)}:O}return O[f]=y,y(...arguments)}}B.filter=function(O){return(f,y,S)=>B(f,y,S,O)}},11362:(O,f,y)=>{"use strict";y.d(f,{b:()=>m});var S=y(11030),H=y(11317),b=y(11359),h=y(11324),v=y(11300);const N=function(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const b=O();H.d&&H.d.HasTags(f)&&H.d.AddTagsTo(b,H.d.GetTags(f,!0));const h=(0,v.e)(b),N={};for(const H in h){const O=h[H],v=f[H],t=O.type;if(void 0!==v&&null!==v&&("uniqueId"!==H||m.AllowLoadingUniqueId))switch(t){case 0:case 6:case 11:b[H]=v;break;case 1:S.cloneTexturesOnlyOnce&&N[v.uniqueId]?b[H]=N[v.uniqueId]:(b[H]=y||v.isRenderTarget?v:v.clone(),N[v.uniqueId]=b[H]);break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:b[H]=y?v:v.clone()}}return b};class m{static AppendSerializedAnimations(O,f){if(O.animations){f.animations=[];for(let y=0;y<O.animations.length;y++){const S=O.animations[y];f.animations.push(S.serialize())}}}static Serialize(O,f){f||(f={}),H.d&&(f.tags=H.d.GetTags(O));const y=(0,v.e)(O);for(const S in y){const H=y[S],b=H.sourceName||S,h=H.type,v=O[S];if(void 0!==v&&null!==v&&("uniqueId"!==S||m.AllowLoadingUniqueId))switch(h){case 0:f[b]=v;break;case 1:case 3:case 7:case 9:f[b]=v.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:f[b]=v.gj();break;case 6:case 11:f[b]=v.id}}return f}static ParseProperties(O,f,y,S){S||(S="");const H=(0,v.e)(f);for(const v in H){const N=H[v],t=O[N.sourceName||v],q=N.type;if(void 0!==t&&null!==t&&("uniqueId"!==v||m.AllowLoadingUniqueId)){const O=f;switch(q){case 0:O[v]=t;break;case 1:y&&(O[v]=m._TextureParser(t,y,S));break;case 2:O[v]=b.d.Ng(t);break;case 3:O[v]=m._FresnelParametersParser(t);break;case 4:O[v]=h.i.Ng(t);break;case 5:O[v]=h.m.Ng(t);break;case 6:y&&(O[v]=y.getLastMeshById(t));break;case 7:O[v]=m._ColorCurvesParser(t);break;case 8:O[v]=b.g.Ng(t);break;case 9:O[v]=m._ImageProcessingConfigurationParser(t);break;case 10:O[v]=h.c.Ng(t);break;case 11:y&&(O[v]=y.getCameraById(t));break;case 12:O[v]=h.b.Ng(t)}}}}static Parse(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const b=O();return H.d&&H.d.AddTagsTo(b,f.tags),m.ParseProperties(f,b,y,S),b}static Clone(O,f){return N(O,f,!1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}static Instanciate(O,f){return N(O,f,!0)}}m.AllowLoadingUniqueId=!1,m._ImageProcessingConfigurationParser=O=>{throw(0,S.d)("ImageProcessingConfiguration")},m._FresnelParametersParser=O=>{throw(0,S.d)("FresnelParameters")},m._ColorCurvesParser=O=>{throw(0,S.d)("ColorCurves")},m._TextureParser=(O,f,y)=>{throw(0,S.d)("Texture")}},11019:(O,f,y)=>{"use strict";y.d(f,{e:()=>b});var S=y(11017);const H=(O,f,y)=>O?O.getClassName&&"Mesh"===O.getClassName()?null:!O.getClassName||"SubMesh"!==O.getClassName()&&"PhysicsBody"!==O.getClassName()?O.clone?O.clone():Array.isArray(O)?O.slice():y&&"object"===typeof O?{...O}:null:O.clone(f):null;class b{static DeepCopy(O,f,y,b){let h=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const v=function(O){const f=[];do{Object.getOwnPropertyNames(O).forEach((function(O){-1===f.indexOf(O)&&f.push(O)}))}while(O=Object.getPrototypeOf(O));return f}(O);for(const m of v){if("_"===m[0]&&(!b||-1===b.indexOf(m)))continue;if(m.endsWith("Observable"))continue;if(y&&-1!==y.indexOf(m))continue;const v=O[m],t=typeof v;if("function"!==t)try{if("object"===t)if(v instanceof Uint8Array)f[m]=Uint8Array.from(v);else if(v instanceof Array){if(f[m]=[],v.length>0)if("object"==typeof v[0])for(let O=0;O<v.length;O++){const y=H(v[O],f,h);-1===f[m].indexOf(y)&&f[m].push(y)}else f[m]=v.slice(0)}else f[m]=H(v,f,h);else f[m]=v}catch(N){S.e.Warn(N.message)}}}}},11030:(O,f,y)=>{"use strict";y.d(f,{d:()=>H});const S={};function H(O){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!S[O])return S[O]=!0,`${O} needs to be imported before as it contains a side-effect required by your code.`}},11009:(O,f,y)=>{"use strict";function S(){return"undefined"!==typeof window}function H(){return"undefined"!==typeof navigator}function b(){return"undefined"!==typeof document}function h(O){let f="",y=O.firstChild;for(;y;)3===y.nodeType&&(f+=y.textContent),y=y.nextSibling;return f}y.d(f,{b:()=>h,c:()=>b,d:()=>H,h:()=>S})},12263:(O,f,y)=>{"use strict";y.r(f),y.d(f,{Dispose:()=>F,DumpData:()=>q,DumpDataAsync:()=>t,DumpFramebuffer:()=>m,DumpTools:()=>I});var S=y(11816),H=y(10995),b=y(11345),h=y(11042);let v,N=null;async function m(O,f,y,S){let H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",b=arguments.length>5?arguments[5]:void 0,h=arguments.length>6?arguments[6]:void 0;const v=await y.readPixels(0,0,O,f);q(O,f,new Uint8Array(v.buffer),S,H,b,!0,void 0,h)}function t(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",H=arguments.length>4?arguments[4]:void 0,b=arguments.length>5&&void 0!==arguments[5]&&arguments[5],h=arguments.length>6&&void 0!==arguments[6]&&arguments[6],v=arguments.length>7?arguments[7]:void 0;return new Promise((N=>{q(O,f,y,(O=>N(O)),S,H,b,h,v)}))}function q(O,f,m,t){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",I=arguments.length>5?arguments[5]:void 0,A=arguments.length>6&&void 0!==arguments[6]&&arguments[6],J=arguments.length>7&&void 0!==arguments[7]&&arguments[7],X=arguments.length>8?arguments[8]:void 0;(async function(){return N||(N=new Promise(((O,f)=>{let H,b=null;const N={kh:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(y.bind(y,11712)).then((m=>{let{ThinEngine:t}=m;try{H=new OffscreenCanvas(100,100),b=new t(H,!1,N)}catch(I){H=document.createElement("canvas"),b=new t(H,!1,N)}h.c.Instances.pop(),h.c.OnEnginesDisposedObservable.add((O=>{b&&O!==b&&!b.u&&0===h.c.Instances.length&&F()})),b.getCaps().parallelShaderCompile=void 0;const q=new S.e(b);y.e(34).then(y.bind(y,13448)).then((y=>{let{passPixelShader:h}=y;if(!b)return void f("Engine is not defined");const N=new S.f({ad:b,name:h.name,fragmentShader:h.shader,samplerNames:["textureSampler"]});v={canvas:H,ad:b,renderer:q,wrapper:N},O(v)}))})).catch(f)}))),await N})().then((y=>{if(y.ad.setSize(O,f,!0),m instanceof Float32Array){const O=new Uint8Array(m.length);let f=m.length;for(;f--;){const y=m[f];O[f]=Math.round(255*(0,b.c)(y))}m=O}const S=y.ad.createRawTexture(m,O,f,5,!1,!A,1);y.renderer.setViewport(),y.renderer.applyEffectWrapper(y.wrapper),y.wrapper.effect._bindTexture("textureSampler",S),y.renderer.draw(),J?H.d.ToBlob(y.canvas,(O=>{const f=new FileReader;f.onload=O=>{const f=O.target.result;t&&t(f)},f.readAsArrayBuffer(O)}),q,X):H.d.EncodeScreenshotCanvasData(y.canvas,t,q,I,X),S.dispose()}))}function F(){var O;v?(v.wrapper.dispose(),v.renderer.dispose(),v.ad.dispose()):null===(O=N)||void 0===O||O.then((O=>{O.wrapper.dispose(),O.renderer.dispose(),O.ad.dispose()}));N=null,v=null}const I={DumpData:q,DumpDataAsync:t,DumpFramebuffer:m,Dispose:F};H.d.DumpData=q,H.d.DumpDataAsync=t,H.d.DumpFramebuffer=m},12258:(O,f,y)=>{"use strict";y.d(f,{d:()=>A,h:()=>w,i:()=>u,l:()=>L});var S=y(10995),H=y(11324),b=y(11345),h=y(11776),v=y(11126),N=y(11513),m=(y(11311),y(11808)),t=y(11017);y(12227),y(12237),y(12263);const q="image/png",F=2,I=[134,22,135,150,246,214,150,54];function A(O){const f=new DataView(O.buffer,O.byteOffset,O.byteLength);let y=0;for(let h=0;h<I.length;h++)if(f.getUint8(y++)!==I[h])return t.e.Error("Not a babylon environment map"),null;let S="",H=0;for(;H=f.getUint8(y++);)S+=String.fromCharCode(H);let b=JSON.parse(S);return b=J(b),b.ph&&(b.ph.specularDataPosition=y,b.ph.lodGenerationScale=b.ph.lodGenerationScale||.8),b}function J(O){if(O.version>F)throw new Error(`Unsupported babylon environment map version "${O.version}". Latest supported version is "${F}".`);return 2===O.version?O:O={...O,version:2,imageType:q}}function X(O,f){const y=(f=J(f)).ph;let S=Math.log2(f.width);if(S=Math.round(S)+1,y.mipmaps.length!==6*S)throw new Error(`Unsupported specular mipmaps number "${y.mipmaps.length}"`);const H=new Array(S);for(let b=0;b<S;b++){H[b]=new Array(6);for(let f=0;f<6;f++){const S=y.mipmaps[6*b+f];H[b][f]=new Uint8Array(O.buffer,O.byteOffset+y.specularDataPosition+S.position,S.length)}}return H}function w(O,f,y){const S=(y=J(y)).ph;if(!S)return Promise.resolve();O._lodGenerationScale=S.lodGenerationScale;return j(O,X(f,y),y.imageType)}function B(O,f,y,S,H,b,h,v,N,m,t){return new Promise(((q,F)=>{if(y){const y=f.createTexture(null,!0,!0,null,1,null,(O=>{F(O)}),O);null===S||void 0===S||S.onEffectCreatedObservable.addOnce((v=>{v.executeWhenCompiled((()=>{S.externalTextureSamplerBinding=!0,S.onApply=S=>{S._bindTexture("textureSampler",y),S.setFloat2("scale",1,f._features.needsInvertingBitmap&&O instanceof ImageBitmap?-1:1)},f.scenes.length&&(f.scenes[0].postProcessManager.directRender([S],m,!0,b,h),f.restoreDefaultFramebuffer(),y.dispose(),URL.revokeObjectURL(H),q())}))}))}else{if(f._uploadImageToTexture(t,O,b,h),v){const y=N[h];y&&f._uploadImageToTexture(y._texture,O,b,0)}q()}}))}async function j(O,f){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:q;if(!S.d.IsExponentOfTwo(O.width))throw new Error("Texture size must be a power of two");const h=(0,b.n)(O.width)+1,t=O.getEngine();let F=!1,I=!1,A=null,J=null,X=null;const w=t.getCaps();O.format=5,O.type=0,O.generateMipMaps=!0,O._cachedAnisotropicFilteringLevel=null,t.updateTextureSamplingMode(3,O),w.textureLOD?t._features.supportRenderAndCopyToLodForFloatTextures?w.textureHalfFloatRender&&w.textureHalfFloatLinearFiltering?(F=!0,O.type=2):w.textureFloatRender&&w.textureFloatLinearFiltering&&(F=!0,O.type=1):F=!1:(F=!1,I=!0,X={});let j=0;if(F)t.isWebGPU?(j=1,await y.e(39).then(y.bind(y,13468))):await y.e(41).then(y.bind(y,13484)),A=new m.c("rgbdDecode","rgbdDecode",null,null,1,null,3,t,!1,void 0,O.type,void 0,null,!1,void 0,j),O._isRGBD=!1,O.invertY=!1,J=t.createRenderTargetCubeTexture(O.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:O.type,format:5});else if(O._isRGBD=!0,O.invertY=!0,I){const f=3,y=O._lodGenerationScale,S=O._lodGenerationOffset;for(let H=0;H<f;H++){const b=(h-1)*y+S,m=S+(b-S)*(1-H/(f-1)),q=Math.round(Math.min(Math.max(m,0),b)),F=new v.c(t,2);F.isCube=!0,F.invertY=!0,F.generateMipMaps=!1,t.updateTextureSamplingMode(2,F);const I=new N.d(null);switch(I._isCube=!0,I._texture=F,X[q]=I,H){case 0:O._lodTextureLow=I;break;case 1:O._lodTextureMid=I;break;case 2:O._lodTextureHigh=I}}}const u=[];for(let y=0;y<f.length;y++)for(let S=0;S<6;S++){const b=f[y][S],h=new Blob([b],{type:H}),v=URL.createObjectURL(h);let N;if(t._features.forceBitmapOverHTMLImageElement)N=t.createImageBitmap(h,{premultiplyAlpha:"none"}).then((f=>B(f,t,F,A,v,S,y,I,X,J,O)));else{const f=new Image;f.src=v,N=new Promise(((H,b)=>{f.onload=()=>{B(f,t,F,A,v,S,y,I,X,J,O).then((()=>H())).catch((O=>{b(O)}))},f.onerror=O=>{b(O)}}))}u.push(N)}if(f.length<h){let y;const S=Math.pow(2,h-1-f.length),H=S*S*4;switch(O.type){case 0:y=new Uint8Array(H);break;case 2:y=new Uint16Array(H);break;case 1:y=new Float32Array(H)}for(let b=f.length;b<h;b++)for(let f=0;f<6;f++)t._uploadArrayBufferViewToTexture(O,y,f,b)}return Promise.all(u).then((()=>{J&&(t._releaseTexture(O),J._swapAndDie(O)),A&&A.dispose(),I&&(O._lodTextureHigh&&O._lodTextureHigh._texture&&(O._lodTextureHigh._texture.isReady=!0),O._lodTextureMid&&O._lodTextureMid._texture&&(O._lodTextureMid._texture.isReady=!0),O._lodTextureLow&&O._lodTextureLow._texture&&(O._lodTextureLow._texture.isReady=!0))}))}function u(O,f){const y=(f=J(f)).irradiance;if(!y)return;const S=new h.h;H.m.FromArrayToRef(y.x,0,S.x),H.m.FromArrayToRef(y.y,0,S.y),H.m.FromArrayToRef(y.z,0,S.z),H.m.FromArrayToRef(y.xx,0,S.xx),H.m.FromArrayToRef(y.yy,0,S.yy),H.m.FromArrayToRef(y.zz,0,S.zz),H.m.FromArrayToRef(y.yz,0,S.yz),H.m.FromArrayToRef(y.zx,0,S.zx),H.m.FromArrayToRef(y.xy,0,S.xy),O._sphericalPolynomial=S}function L(O,f,y,S,H){const b=j(O.getEngine().createRawCubeTexture(null,O.width,O.format,O.type,O.generateMipMaps,O.invertY,O.samplingMode,O._compression),f).then((()=>O));return O.onRebuildCallback=O=>({proxy:b,isReady:!0,isAsync:!0}),O._source=13,O._bufferViewArrayArray=f,O._lodGenerationScale=S,O._lodGenerationOffset=H,O._sphericalPolynomial=y,j(O,f).then((()=>(O.isReady=!0,O)))}},11059:(O,f,y)=>{"use strict";y.d(f,{e:()=>S,i:()=>H,l:()=>b});class S extends Error{}S._setPrototypeOf=Object.setPrototypeOf||((O,f)=>(O.__proto__=f,O));const H={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};class b extends S{constructor(O,f,y){super(O),this.errorCode=f,this.innerError=y,this.name="RuntimeError",S._setPrototypeOf(this,b.prototype)}}},11051:(O,f,y)=>{"use strict";y.d(f,{c:()=>i,f:()=>j,g:()=>E,o:()=>l,k:()=>X,q:()=>p,r:()=>U,u:()=>x,y:()=>u});var S=y(11037),H=y(11009),b=y(11004);class h{}h.FilesToLoad={};var v=y(11059),N=y(11063),m=y(11070),t=y(11042),q=y(11017),F=y(11085),I=y(11079),A=y(11092);const J=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class X extends v.l{constructor(O,f){super(O,v.i.LoadFileError),this.name="LoadFileError",v.e._setPrototypeOf(this,X.prototype),f instanceof S.e?this.request=f:this.file=f}}class w extends v.l{constructor(O,f){super(O,v.i.RequestFileError),this.request=f,this.name="RequestFileError",v.e._setPrototypeOf(this,w.prototype)}}class B extends v.l{constructor(O,f){super(O,v.i.ReadFileError),this.file=f,this.name="ReadFileError",v.e._setPrototypeOf(this,B.prototype)}}const j={DefaultRetryStrategy:class{static ExponentialBackoff(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return(y,S,H)=>0!==S.status||H>=O||-1!==y.indexOf("file:")?-1:Math.pow(2,H)*f}}.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:O=>O,ScriptBaseUrl:"",ScriptPreprocessUrl:O=>O,CleanUrl:O=>O=O.replace(/#/gm,"%23")},u=(O,f)=>{if((!O||0!==O.indexOf("data:"))&&j.CorsBehavior)if("string"===typeof j.CorsBehavior||j.CorsBehavior instanceof String)f.crossOrigin=j.CorsBehavior;else{const y=j.CorsBehavior(O);y&&(f.crossOrigin=y)}},L={getRequiredSize:null},p=function(O,f,y,H){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",v=arguments.length>5?arguments[5]:void 0;const m=t.c.LastCreatedEngine;if("undefined"===typeof HTMLImageElement&&(null===m||void 0===m||!m._features.forceBitmapOverHTMLImageElement))return y("LoadImage is only supported in web or BabylonNative environments."),null;let q,F=!1;O instanceof ArrayBuffer||ArrayBuffer.isView(O)?"undefined"!==typeof Blob&&"undefined"!==typeof URL?(q=URL.createObjectURL(new Blob([O],{type:b})),F=!0):q=`data:${b};base64,`+(0,N.k)(O):O instanceof Blob?(q=URL.createObjectURL(O),F=!0):(q=j.CleanUrl(O),q=j.PreprocessUrl(q));const I=f=>{if(y){const S=q||O.toString();y(`Error while trying to load image: ${0===S.indexOf("http")||S.length<=128?S:S.slice(0,128)+"..."}`,f)}};if(null!==m&&void 0!==m&&m._features.forceBitmapOverHTMLImageElement)return l(q,(S=>{m.createImageBitmap(new Blob([S],{type:b}),{premultiplyAlpha:"none",...v}).then((O=>{f(O),F&&URL.revokeObjectURL(q)})).catch((f=>{y&&y("Error while trying to load image: "+O,f)}))}),void 0,H||void 0,!0,((O,f)=>{I(f)})),null;const A=new Image;if(L.getRequiredSize){const f=L.getRequiredSize(O);f.width&&(A.width=f.width),f.height&&(A.height=f.height)}u(q,A);const J=[],X=()=>{J.forEach((O=>{O.target.removeEventListener(O.name,O.handler)})),J.length=0};J.push({target:A,name:"load",handler:()=>{X(),f(A),F&&A.src&&URL.revokeObjectURL(A.src)}}),J.push({target:A,name:"error",handler:O=>{X(),I(O),F&&A.src&&URL.revokeObjectURL(A.src)}}),J.push({target:document,name:"securitypolicyviolation",handler:O=>{if(O.blockedURI!==A.src||"hm"===O.disposition)return;X();const f=new Error(`CSP violation of policy ${O.effectiveDirective} ${O.blockedURI}. Current policy is ${O.originalPolicy}`);t.c.UseFallbackTexture=!1,I(f),F&&A.src&&URL.revokeObjectURL(A.src),A.src=""}}),J.forEach((O=>{O.target.addEventListener(O.name,O.handler)}));const w="blob:"===q.substring(0,5),B="data:"===q.substring(0,5),p=()=>{w||B||!S.e.IsCustomRequestAvailable?A.src=q:l(q,((O,f,y)=>{const S=new Blob([O],{type:!b&&y?y:b}),H=URL.createObjectURL(S);F=!0,A.src=H}),void 0,H||void 0,!0,((O,f)=>{I(f)}))},U=()=>{H&&H.loadImage(q,A)};if(!w&&!B&&H&&H.enableTexturesOffline)H.open(U,p);else{if(-1!==q.indexOf("file:")){const O=decodeURIComponent(q.substring(5).toLowerCase());if(h.FilesToLoad[O]&&"undefined"!==typeof URL){try{let f;try{f=URL.createObjectURL(h.FilesToLoad[O])}catch(x){f=URL.createObjectURL(h.FilesToLoad[O])}A.src=f,F=!0}catch(W){A.src=""}return A}}p()}return A},U=(O,f,y,S,H)=>{const h=new FileReader,v={onCompleteObservable:new b.d,abort:()=>h.abort()};return h.onloadend=()=>v.onCompleteObservable.notifyObservers(v),H&&(h.onerror=()=>{H(new B(`Unable to read ${O.name}`,O))}),h.onload=O=>{f(O.target.result)},y&&(h.onprogress=y),S?h.readAsArrayBuffer(O):h.readAsText(O),v},l=(O,f,y,S,H,N,m)=>{if(O.name)return U(O,f,y,H,N?O=>{N(void 0,O)}:void 0);const t=O;if(-1!==t.indexOf("file:")){let O=decodeURIComponent(t.substring(5).toLowerCase());0===O.indexOf("./")&&(O=O.substring(2));const S=h.FilesToLoad[O];if(S)return U(S,f,y,H,N?O=>N(void 0,new X(O.message,O.file)):void 0)}const{match:I,type:A}=o(t);if(I){const O={onCompleteObservable:new b.d,abort:()=>()=>{}};try{const O=H?i(t):D(t);f(O,void 0,A)}catch(v){N?N(void 0,v):q.e.Error(v.message||"Failed to parse the Data URL")}return F.d.SetImmediate((()=>{O.onCompleteObservable.notifyObservers(O)})),O}return x(t,((O,y)=>{f(O,null===y||void 0===y?void 0:y.responseURL,null===y||void 0===y?void 0:y.getResponseHeader("content-type"))}),y,S,H,N?O=>{N(O.request,new X(O.message,O.request))}:void 0,m)},x=(O,f,y,h,v,N,m)=>{O=j.CleanUrl(O),O=j.PreprocessUrl(O);const t=j.BaseUrl+O;let F=!1;const I={onCompleteObservable:new b.d,abort:()=>F=!0},A=()=>{let O,b=new S.e,h=null;const A=()=>{b&&(y&&b.removeEventListener("progress",y),O&&b.removeEventListener("readystatechange",O),b.removeEventListener("loadend",J))};let J=()=>{A(),I.onCompleteObservable.notifyObservers(I),I.onCompleteObservable.clear(),y=void 0,O=null,J=null,N=void 0,m=void 0,f=void 0};I.abort=()=>{F=!0,J&&J(),b&&b.readyState!==(XMLHttpRequest.DONE||4)&&b.abort(),null!==h&&(clearTimeout(h),h=null),b=null};const X=O=>{const f=O.message||"Unknown error";N&&b?N(new w(f,b)):q.e.Error(f)},B=q=>{if(b){if(b.open("GET",t),m)try{m(b)}catch(I){return void X(I)}v&&(b.responseType="arraybuffer"),y&&b.addEventListener("progress",y),J&&b.addEventListener("loadend",J),O=()=>{if(!F&&b&&b.readyState===(XMLHttpRequest.DONE||4)){if(O&&b.removeEventListener("readystatechange",O),b.status>=200&&b.status<300||0===b.status&&(!(0,H.h)()||W())){try{f&&f(v?b.response:b.responseText,b)}catch(I){X(I)}return}const y=j.DefaultRetryStrategy;if(y){const O=y(t,b,q);if(-1!==O)return A(),b=new S.e,void(h=setTimeout((()=>B(q+1)),O))}const m=new w("Error status: "+b.status+" "+b.statusText+" - Unable to load "+t,b);N&&N(m)}},b.addEventListener("readystatechange",O),b.send()}};B(0)};if(h&&h.enableSceneOffline){const S=O=>{O&&O.status>400?N&&N(O):A()},H=()=>{h&&h.loadFile(j.BaseUrl+O,(O=>{!F&&f&&f(O),I.onCompleteObservable.notifyObservers(I)}),y?O=>{!F&&y&&y(O)}:void 0,S,v)};h.open(H,S)}else A();return I},W=()=>"undefined"!==typeof location&&"file:"===location.protocol,E=O=>J.test(O),o=O=>{const f=J.exec(O);if(null===f||0===f.length)return{match:!1,type:""};return{match:!0,type:f[0].replace("data:","").replace("base64,","")}};function i(O){return(0,N.d)(O.split(",")[1])}const D=O=>(0,N.g)(O.split(",")[1]);let V;A.c._FileToolsLoadImage=p,I.c.loadFile=l,m.k.loadFile=l;((O,f,y,S,H,b,h,v,N,m)=>{V={DecodeBase64UrlToBinary:O,DecodeBase64UrlToString:f,DefaultRetryStrategy:y.DefaultRetryStrategy,BaseUrl:y.BaseUrl,CorsBehavior:y.CorsBehavior,PreprocessUrl:y.PreprocessUrl,IsBase64DataUrl:S,IsFileURL:H,LoadFile:b,LoadImage:h,ReadFile:v,RequestFile:N,SetCorsBehavior:m},Object.defineProperty(V,"DefaultRetryStrategy",{get:function(){return y.DefaultRetryStrategy},set:function(O){y.DefaultRetryStrategy=O}}),Object.defineProperty(V,"BaseUrl",{get:function(){return y.BaseUrl},set:function(O){y.BaseUrl=O}}),Object.defineProperty(V,"PreprocessUrl",{get:function(){return y.PreprocessUrl},set:function(O){y.PreprocessUrl=O}}),Object.defineProperty(V,"CorsBehavior",{get:function(){return y.CorsBehavior},set:function(O){y.CorsBehavior=O}})})(i,D,j,E,W,l,p,U,x,u)},11158:(O,f,y)=>{"use strict";function S(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(O=>{const f=16*Math.random()|0;return("x"===O?f:3&f|8).toString(16)}))}y.d(f,{d:()=>S})},11145:(O,f,y)=>{"use strict";y.d(f,{c:()=>b});var S=y(11017),H=y(11153);class b{static Instantiate(O){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[O])return this.RegisteredExternalClasses[O];const f=(0,H.c)(O);if(f)return f;S.e.Warn(O+" not found, you may have missed an import.");const y=O.split(".");let b=window||this;for(let S=0,H=y.length;S<H;S++)b=b[y[S]];return"function"!==typeof b?null:b}}b.RegisteredExternalClasses={}},11017:(O,f,y)=>{"use strict";y.d(f,{e:()=>S});class S{static _CheckLimit(O,f){let y=S._LogLimitOutputs[O];return y?y.current++:(y={limit:f,current:1},S._LogLimitOutputs[O]=y),y.current<=y.limit}static _GenerateLimitMessage(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const y=S._LogLimitOutputs[O];if(!y||!S.MessageLimitReached)return;const H=this._Levels[f];y.current===y.limit&&S[H.name](S.MessageLimitReached.replace(/%LIMIT%/g,""+y.limit).replace(/%TYPE%/g,H.name??""))}static _AddLogEntry(O){S._LogCache=O+S._LogCache,S.OnNewCacheEntry&&S.OnNewCacheEntry(O)}static _FormatMessage(O){const f=O=>O<10?"0"+O:""+O,y=new Date;return"["+f(y.getHours())+":"+f(y.getMinutes())+":"+f(y.getSeconds())+"]: "+O}static _LogDisabled(O,f){}static _LogEnabled(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1?arguments[1]:void 0,y=arguments.length>2?arguments[2]:void 0;const H=Array.isArray(f)?f[0]:f;if(void 0!==y&&!S._CheckLimit(H,y))return;const b=S._FormatMessage(H),h=this._Levels[O],v=Array.isArray(f)?f.slice(1):[];h.logFunc&&h.logFunc("BJS - "+b,...v);const N=`<div style='color:${h.color}'>${b}</div><br>`;S._AddLogEntry(N),S._GenerateLimitMessage(H,O)}static get LogCache(){return S._LogCache}static ClearLogCache(){S._LogCache="",S._LogLimitOutputs={},S.errorsCount=0}static set LogLevels(O){S.Log=S._LogDisabled,S.Warn=S._LogDisabled,S.Error=S._LogDisabled,[S.MessageLogLevel,S.WarningLogLevel,S.ErrorLogLevel].forEach((f=>{if((O&f)===f){const O=this._Levels[f];S[O.name]=S._LogEnabled.bind(S,f)}}))}}S.NoneLogLevel=0,S.MessageLogLevel=1,S.WarningLogLevel=2,S.ErrorLogLevel=4,S.AllLogLevel=7,S.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",S._LogCache="",S._LogLimitOutputs={},S._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],S.errorsCount=0,S.Log=S._LogEnabled.bind(S,S.MessageLogLevel),S.Warn=S._LogEnabled.bind(S,S.WarningLogLevel),S.Error=S._LogEnabled.bind(S,S.ErrorLogLevel)},11004:(O,f,y)=>{"use strict";y.d(f,{d:()=>b});class S{constructor(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2?arguments[2]:void 0,S=arguments.length>3?arguments[3]:void 0;this.initialize(O,f,y,S)}initialize(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2?arguments[2]:void 0,S=arguments.length>3?arguments[3]:void 0;return this.mask=O,this.skipNextObservers=f,this.target=y,this.currentTarget=S,this}}class H{constructor(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=O,this.mask=f,this.scope=y,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){this._remove&&this._remove()}}class b{static FromPromise(O,f){const y=new b;return O.then((O=>{y.notifyObservers(O)})).catch((O=>{if(!f)throw O;f.notifyObservers(O)})),y}get observers(){return this._observers}constructor(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=f,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new S(0),O&&(this._onObserverAdded=O)}add(O){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],y=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!O)return null;const S=new H(O,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);return S.unregisterOnNextCall=y,f?this._observers.unshift(S):this._observers.push(S),this._onObserverAdded&&this._onObserverAdded(S),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(S,this._lastNotifiedValue),S._remove=()=>{this.remove(S)},S}addOnce(O){return this.add(O,void 0,void 0,void 0,!0)}remove(O){if(!O)return!1;O._remove=null;return-1!==this._observers.indexOf(O)&&(this._deferUnregister(O),!0)}removeCallback(O,f){for(let y=0;y<this._observers.length;y++){const S=this._observers[y];if(!S._willBeUnregistered&&(S.callback===O&&(!f||f===S.scope)))return this._deferUnregister(S),!0}return!1}_deferUnregister(O){O._willBeUnregistered||(this._numObserversMarkedAsDeleted++,O.unregisterOnNextCall=!1,O._willBeUnregistered=!0,setTimeout((()=>{this._remove(O)}),0))}_remove(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!O)return!1;const y=this._observers.indexOf(O);return-1!==y&&(f&&this._numObserversMarkedAsDeleted--,this._observers.splice(y,1),!0)}makeObserverTopPriority(O){this._remove(O,!1),this._observers.unshift(O)}makeObserverBottomPriority(O){this._remove(O,!1),this._observers.push(O)}notifyObservers(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,y=arguments.length>2?arguments[2]:void 0,S=arguments.length>3?arguments[3]:void 0,H=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=O),!this._observers.length)return!0;const b=this._eventState;b.mask=f,b.target=y,b.currentTarget=S,b.skipNextObservers=!1,b.lastReturnValue=O,b.userInfo=H;for(const h of this._observers)if(!h._willBeUnregistered&&(h.mask&f&&(h.unregisterOnNextCall&&this._deferUnregister(h),h.scope?b.lastReturnValue=h.callback.apply(h.scope,[O,b]):b.lastReturnValue=h.callback(O,b)),b.skipNextObservers))return!1;return!0}notifyObserver(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=f),O._willBeUnregistered)return;const S=this._eventState;S.mask=y,S.skipNextObservers=!1,O.unregisterOnNextCall&&this._deferUnregister(O),O.callback(f,S)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const O=this._observers.pop();O&&(O._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const O=new b;return O._observers=this._observers.slice(0),O}hasSpecificMask(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const f of this._observers)if(f.mask&O||f.mask===O)return!0;return!1}}},11166:(O,f,y)=>{"use strict";y.d(f,{d:()=>H});var S=y(11028);class H{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(O,f){H.Enabled&&(this._current+=O,f&&this._fetchResult())}beginMonitoring(){H.Enabled&&(this._startMonitoringTime=S.b.Now)}endMonitoring(){let O=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!H.Enabled)return;O&&this.fetchNewFrame();const f=S.b.Now;this._current=f-this._startMonitoringTime,O&&this._fetchResult()}dj(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const O=S.b.Now;O-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=O,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}H.Enabled=!0},11028:(O,f,y)=>{"use strict";y.d(f,{b:()=>H});var S=y(11009);class H{static get Now(){return(0,S.h)()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}},12227:(O,f,y)=>{"use strict";y.d(f,{e:()=>b});var S=y(11808),H=y(11795);class b{static ExpandRGBDTexture(O){const f=O._texture;if(!f||!O.isRGBD)return;const H=f.getEngine(),b=H.getCaps(),h=f.isReady;let v=!1;b.textureHalfFloatRender&&b.textureHalfFloatLinearFiltering?(v=!0,f.type=2):b.textureFloatRender&&b.textureFloatLinearFiltering&&(v=!0,f.type=1),v&&(f.isReady=!1,f._isRGBD=!1,f.invertY=!1);const N=async()=>{const b=H.isWebGPU,h=b?1:0;f.isReady=!1,b?await Promise.all([y.e(39).then(y.bind(y,13468)),y.e(40).then(y.bind(y,13475))]):await Promise.all([y.e(41).then(y.bind(y,13484)),y.e(42).then(y.bind(y,13488))]);const v=new S.c("rgbdDecode","rgbdDecode",null,null,1,null,3,H,!1,void 0,f.type,void 0,null,!1,void 0,h);v.externalTextureSamplerBinding=!0;const N=H.createRenderTargetTexture(f.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:f.samplingMode,type:f.type,format:5});v.onEffectCreatedObservable.addOnce((y=>{y.executeWhenCompiled((()=>{v.onApply=O=>{O._bindTexture("textureSampler",f),O.setFloat2("scale",1,1)},O.va().postProcessManager.directRender([v],N,!0),H.restoreDefaultFramebuffer(),H._releaseTexture(f),v&&v.dispose(),N._swapAndDie(f),f.isReady=!0}))}))};v&&(h?N():O.onLoadObservable.addOnce(N))}static EncodeTextureToRGBD(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,H.e)("rgbdEncode",O,f,y,1,5)}}},11302:(O,f,y)=>{"use strict";y.d(f,{c:()=>H,g:()=>S});class S{constructor(O){this.length=0,this.data=new Array(O),this._id=S._GlobalId++}push(O){this.data[this.length++]=O,this.length>this.data.length&&(this.data.length*=2)}forEach(O){for(let f=0;f<this.length;f++)O(this.data[f])}sort(O){this.data.sort(O)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(O){if(0!==O.length){this.length+O.length>this.data.length&&(this.data.length=2*(this.length+O.length));for(let f=0;f<O.length;f++)this.data[this.length++]=(O.data||O)[f]}}indexOf(O){const f=this.data.indexOf(O);return f>=this.length?-1:f}contains(O){return-1!==this.indexOf(O)}}S._GlobalId=0;class H extends S{constructor(){super(...arguments),this._duplicateId=0}push(O){super.push(O),O.__smartArrayFlags||(O.__smartArrayFlags={}),O.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(O){return(!O.__smartArrayFlags||O.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(O),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(O){if(0!==O.length){this.length+O.length>this.data.length&&(this.data.length=2*(this.length+O.length));for(let f=0;f<O.length;f++){const y=(O.data||O)[f];this.pushNoDuplicate(y)}}}}},11063:(O,f,y)=>{"use strict";y.d(f,{d:()=>h,g:()=>b,h:()=>S,k:()=>H});const S=O=>{if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(O);let f="";for(let y=0;y<O.byteLength;y++)f+=String.fromCharCode(O[y]);return f},H=O=>{const f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let y,S,H,b,h,v,N,m="",t=0;const q=ArrayBuffer.isView(O)?new Uint8Array(O.buffer,O.byteOffset,O.byteLength):new Uint8Array(O);for(;t<q.length;)y=q[t++],S=t<q.length?q[t++]:Number.NaN,H=t<q.length?q[t++]:Number.NaN,b=y>>2,h=(3&y)<<4|S>>4,v=(15&S)<<2|H>>6,N=63&H,isNaN(S)?v=N=64:isNaN(H)&&(N=64),m+=f.charAt(b)+f.charAt(h)+f.charAt(v)+f.charAt(N);return m},b=O=>atob(O),h=O=>{const f=b(O),y=f.length,S=new Uint8Array(new ArrayBuffer(y));for(let H=0;H<y;H++)S[H]=f.charCodeAt(H);return S.buffer}},11317:(O,f,y)=>{"use strict";y.d(f,{d:()=>H});class S{static Eval(O,f){return"true"===(O=O.match(/\([^()]*\)/g)?O.replace(/\([^()]*\)/g,(O=>(O=O.slice(1,O.length-1),S._HandleParenthesisContent(O,f)))):S._HandleParenthesisContent(O,f))||"false"!==O&&S.Eval(O,f)}static _HandleParenthesisContent(O,f){let y;f=f||(O=>"true"===O);const H=O.split("||");for(const b in H)if(Object.prototype.hasOwnProperty.call(H,b)){let O=S._SimplifyNegation(H[b].trim());const h=O.split("&&");if(h.length>1)for(let H=0;H<h.length;++H){const b=S._SimplifyNegation(h[H].trim());if(y="true"!==b&&"false"!==b?"!"===b[0]?!f(b.substring(1)):f(b):"true"===b,!y){O="false";break}}if(y||"true"===O){y=!0;break}y="true"!==O&&"false"!==O?"!"===O[0]?!f(O.substring(1)):f(O):"true"===O}return y?"true":"false"}static _SimplifyNegation(O){return"!true"===(O=(O=O.replace(/^[\s!]+/,(O=>(O=O.replace(/[\s]/g,(()=>""))).length%2?"!":""))).trim())?O="false":"!false"===O&&(O="true"),O}}class H{static EnableFor(O){O._tags=O._tags||{},O.hasTags=()=>H.HasTags(O),O.addTags=f=>H.AddTagsTo(O,f),O.removeTags=f=>H.RemoveTagsFrom(O,f),O.matchesTagsQuery=f=>H.MatchesQuery(O,f)}static DisableFor(O){delete O._tags,delete O.hasTags,delete O.addTags,delete O.removeTags,delete O.matchesTagsQuery}static HasTags(O){if(!O._tags)return!1;const f=O._tags;for(const y in f)if(Object.prototype.hasOwnProperty.call(f,y))return!0;return!1}static GetTags(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!O._tags)return null;if(f){const f=[];for(const y in O._tags)Object.prototype.hasOwnProperty.call(O._tags,y)&&!0===O._tags[y]&&f.push(y);return f.join(" ")}return O._tags}static AddTagsTo(O,f){if(!f)return;if("string"!==typeof f)return;f.split(" ").forEach((function(f){H._AddTagTo(O,f)}))}static _AddTagTo(O,f){""!==(f=f.trim())&&"true"!==f&&"false"!==f&&(f.match(/[\s]/)||f.match(/^([!]|([|]|[&]){2})/)||(H.EnableFor(O),O._tags[f]=!0))}static RemoveTagsFrom(O,f){if(!H.HasTags(O))return;const y=f.split(" ");for(const S in y)H._RemoveTagFrom(O,y[S])}static _RemoveTagFrom(O,f){delete O._tags[f]}static MatchesQuery(O,f){return void 0===f||(""===f?H.HasTags(O):S.Eval(f,(f=>H.HasTags(O)&&O._tags[f])))}}},11795:(O,f,y)=>{"use strict";y.d(f,{e:()=>N,i:()=>F,k:()=>q});y(11509),y(11803);var S=y(11808),H=y(11092),b=y(11153),h=y(11362);class v extends S.c{getClassName(){return"PassPostProcess"}constructor(O,f){super(O,"pass",null,null,f,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>5?arguments[5]:void 0,void 0,arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,void 0,null,arguments.length>7&&void 0!==arguments[7]&&arguments[7])}_gatherImports(O,f){O?(this._webGPUReady=!0,f.push(Promise.all([y.e(33).then(y.bind(y,13443))]))):f.push(Promise.all([y.e(34).then(y.bind(y,13448))])),super._gatherImports(O,f)}static _Parse(O,f,y,S){return h.b.Parse((()=>new v(O.name,O.options,f,O.renderTargetSamplingMode,O._engine,O.reusable)),O,y,S)}}(0,b.g)("BABYLON.PassPostProcess",v);S.c;function N(O,f,y,H,b,h,v,N){const m=f.getEngine();return f.isReady=!1,b=b??f.samplingMode,H=H??f.type,h=h??f.format,v=v??f.width,N=N??f.height,-1===H&&(H=0),new Promise((t=>{const q=new S.c("postprocess",O,null,null,1,null,b,m,!1,void 0,H,void 0,null,!1,h);q.externalTextureSamplerBinding=!0;const F=m.createRenderTargetTexture({width:v,height:N},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:b,type:H,format:h});q.onEffectCreatedObservable.addOnce((O=>{O.executeWhenCompiled((()=>{q.onApply=O=>{O._bindTexture("textureSampler",f),O.setFloat2("scale",1,1)},y.postProcessManager.directRender([q],F,!0),m.restoreDefaultFramebuffer(),m._releaseTexture(f),q&&q.dispose(),F._swapAndDie(f),f.type=H,f.format=5,f.isReady=!0,t(f)}))}))}))}let m,t;function q(O){m||(m=new Float32Array(1),t=new Int32Array(m.buffer)),m[0]=O;const f=t[0];let y=f>>16&32768,S=f>>12&2047;const H=f>>23&255;return H<103?y:H>142?(y|=31744,y|=(255==H?0:1)&&8388607&f,y):H<113?(S|=2048,y|=(S>>114-H)+(S>>113-H&1),y):(y|=H-112<<10|S>>1,y+=1&S,y)}function F(O){const f=(32768&O)>>15,y=(31744&O)>>10,S=1023&O;return 0===y?(f?-1:1)*Math.pow(2,-14)*(S/Math.pow(2,10)):31==y?S?NaN:1/0*(f?-1:1):(f?-1:1)*Math.pow(2,y-15)*(1+S/Math.pow(2,10))}H.c._RescalePostProcessFactory=O=>new v("rescale",1,null,2,O,!1,0)},11085:(O,f,y)=>{"use strict";y.d(f,{d:()=>H});var S=y(11009);class H{static SetImmediate(O){(0,S.h)()&&window.setImmediate?window.setImmediate(O):setTimeout(O,1)}}},11161:(O,f,y)=>{"use strict";function S(O){let f=1;do{f*=2}while(f<O);return f===O}function H(O,f,y){return O*(1-y)+f*y}function b(O){const f=h(O),y=v(O);return f-O>O-y?y:f}function h(O){return O--,O|=O>>1,O|=O>>2,O|=O>>4,O|=O>>8,O|=O>>16,++O}function v(O){return O|=O>>1,O|=O>>2,O|=O>>4,O|=O>>8,(O|=O>>16)-(O>>1)}function N(O,f){let y;switch(arguments.length>2&&void 0!==arguments[2]?arguments[2]:2){case 1:y=v(O);break;case 2:y=b(O);break;default:y=h(O)}return Math.min(y,f)}y.d(f,{d:()=>v,h:()=>N,j:()=>S,k:()=>H,o:()=>b})},10995:(O,f,y)=>{"use strict";y.d(f,{b:()=>w,d:()=>X});var S=y(11004),H=y(11009),b=y(11017),h=y(11019),v=y(11028),N=y(11030),m=y(11037),t=y(11042),q=y(11051),F=y(11085),I=y(11145),A=y(11158),J=y(11161);class X{static get BaseUrl(){return q.f.BaseUrl}static set BaseUrl(O){q.f.BaseUrl=O}static get CleanUrl(){return q.f.CleanUrl}static set CleanUrl(O){q.f.CleanUrl=O}static IsAbsoluteUrl(O){return 0===O.indexOf("//")||-1!==O.indexOf("://")&&(-1!==O.indexOf(".")&&(-1!==O.indexOf("/")&&(!(O.indexOf(":")>O.indexOf("/"))&&(O.indexOf("://")<O.indexOf(".")||(0===O.indexOf("data:")||0===O.indexOf("blob:"))))))}static set ScriptBaseUrl(O){q.f.ScriptBaseUrl=O}static get ScriptBaseUrl(){return q.f.ScriptBaseUrl}static set ScriptPreprocessUrl(O){q.f.ScriptPreprocessUrl=O}static get ScriptPreprocessUrl(){return q.f.ScriptPreprocessUrl}static get DefaultRetryStrategy(){return q.f.DefaultRetryStrategy}static set DefaultRetryStrategy(O){q.f.DefaultRetryStrategy=O}static get CorsBehavior(){return q.f.CorsBehavior}static set CorsBehavior(O){q.f.CorsBehavior=O}static get UseFallbackTexture(){return t.c.UseFallbackTexture}static set UseFallbackTexture(O){t.c.UseFallbackTexture=O}static get RegisteredExternalClasses(){return I.c.RegisteredExternalClasses}static set RegisteredExternalClasses(O){I.c.RegisteredExternalClasses=O}static get fallbackTexture(){return t.c.FallbackTexture}static set fallbackTexture(O){t.c.FallbackTexture=O}static FetchToRef(O,f,y,S,H,b){const h=4*((Math.abs(O)*y%y|0)+(Math.abs(f)*S%S|0)*y);b.r=H[h]/255,b.g=H[h+1]/255,b.b=H[h+2]/255,b.a=H[h+3]/255}static Mix(O,f,y){return 0}static Instantiate(O){return I.c.Instantiate(O)}static SetImmediate(O){F.d.SetImmediate(O)}static IsExponentOfTwo(O){return!0}static FloatRound(O){return Math.fround(O)}static GetFilename(O){const f=O.lastIndexOf("/");return f<0?O:O.substring(f+1)}static GetFolderPath(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const y=O.lastIndexOf("/");return y<0?f?O:"":O.substring(0,y+1)}static ToDegrees(O){return 180*O/Math.PI}static ToRadians(O){return O*Math.PI/180}static SmoothAngleChange(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9;const S=this.ToRadians(O),H=this.ToRadians(f);return this.ToDegrees(Math.atan2((1-y)*Math.sin(H)+y*Math.sin(S),(1-y)*Math.cos(H)+y*Math.cos(S)))}static MakeArray(O,f){return!0===f||void 0!==O&&null!=O?Array.isArray(O)?O:[O]:null}static GetPointerPrefix(O){return(0,H.h)()&&!window.PointerEvent?"mouse":"pointer"}static SetCorsBehavior(O,f){(0,q.y)(O,f)}static SetReferrerPolicyBehavior(O,f){f.referrerPolicy=O}static get PreprocessUrl(){return q.f.PreprocessUrl}static set PreprocessUrl(O){q.f.PreprocessUrl=O}static LoadImage(O,f,y,S,H,b){return(0,q.q)(O,f,y,S,H,b)}static LoadFile(O,f,y,S,H,b){return(0,q.o)(O,f,y,S,H,b)}static LoadFileAsync(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise(((y,S)=>{(0,q.o)(O,(O=>{y(O)}),void 0,void 0,f,((O,f)=>{S(f)}))}))}static GetBabylonScriptURL(O,f){if(!O)return"";if(X.ScriptBaseUrl&&O.startsWith(X._DefaultCdnUrl)){const f="/"===X.ScriptBaseUrl[X.ScriptBaseUrl.length-1]?X.ScriptBaseUrl.substring(0,X.ScriptBaseUrl.length-1):X.ScriptBaseUrl;O=O.replace(X._DefaultCdnUrl,f)}return O=X.ScriptPreprocessUrl(O),f&&(O=X.GetAbsoluteUrl(O)),O}static LoadBabylonScript(O,f,y,S){O=X.GetBabylonScriptURL(O),X.LoadScript(O,f,y)}static LoadBabylonScriptAsync(O){return O=X.GetBabylonScriptURL(O),X.LoadScriptAsync(O)}static LoadScript(O,f,y,S){let b=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("function"===typeof importScripts){try{importScripts(O),f&&f()}catch(N){null===y||void 0===y||y(`Unable to load script '${O}' in worker`,N)}return}if(!(0,H.h)())return void(null===y||void 0===y||y(`Cannot load script '${O}' outside of a window or a worker`));const h=document.getElementsByTagName("head")[0],v=document.createElement("script");b?(v.setAttribute("type","module"),v.innerText=O):(v.setAttribute("type","text/javascript"),v.setAttribute("src",O)),S&&(v.id=S),v.onload=()=>{f&&f()},v.onerror=f=>{y&&y(`Unable to load script '${O}'`,f)},h.appendChild(v)}static LoadScriptAsync(O,f){return new Promise(((y,S)=>{this.LoadScript(O,(()=>{y()}),((O,f)=>{S(f||new Error(O))}),f)}))}static ReadFileAsDataURL(O,f,y){const H=new FileReader,b={onCompleteObservable:new S.d,abort:()=>H.abort()};return H.onloadend=()=>{b.onCompleteObservable.notifyObservers(b)},H.onload=O=>{f(O.target.result)},H.onprogress=y,H.readAsDataURL(O),b}static ReadFile(O,f,y,S,H){return(0,q.r)(O,f,y,S,H)}static FileAsURL(O){const f=new Blob([O]);return window.URL.createObjectURL(f)}static Format(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return O.toFixed(f)}static DeepCopy(O,f,y,S){h.e.DeepCopy(O,f,y,S)}static IsEmpty(O){for(const f in O)if(Object.prototype.hasOwnProperty.call(O,f))return!1;return!0}static RegisterTopRootEvents(O,f){for(let S=0;S<f.length;S++){const H=f[S];O.addEventListener(H.name,H.handler,!1);try{window.parent&&window.parent.addEventListener(H.name,H.handler,!1)}catch(y){}}}static UnregisterTopRootEvents(O,f){for(let S=0;S<f.length;S++){const H=f[S];O.removeEventListener(H.name,H.handler);try{O.parent&&O.parent.removeEventListener(H.name,H.handler)}catch(y){}}}static async DumpFramebuffer(O,f,y,S){throw(0,N.d)("DumpTools")}static DumpData(O,f,y,S){throw(0,N.d)("DumpTools")}static DumpDataAsync(O,f,y){throw(0,N.d)("DumpTools")}static _IsOffScreenCanvas(O){return void 0!==O.convertToBlob}static ToBlob(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",S=arguments.length>3?arguments[3]:void 0;X._IsOffScreenCanvas(O)||O.toBlob||(O.toBlob=function(O,f,y){setTimeout((()=>{const S=atob(this.toDataURL(f,y).split(",")[1]),H=S.length,b=new Uint8Array(H);for(let O=0;O<H;O++)b[O]=S.charCodeAt(O);O(new Blob([b]))}))}),X._IsOffScreenCanvas(O)?O.convertToBlob({type:y,quality:S}).then((O=>f(O))):O.toBlob((function(O){f(O)}),y,S)}static DownloadBlob(O,f){if("download"in document.createElement("a")){if(!f){const O=new Date;f="screenshot_"+((O.getFullYear()+"-"+(O.getMonth()+1)).slice(2)+"-"+O.getDate()+"_"+O.getHours()+"-"+("0"+O.getMinutes()).slice(-2))+".png"}X.Download(O,f)}else if(O&&"undefined"!==typeof URL){const f=URL.createObjectURL(O),y=window.open("");if(!y)return;const S=y.document.createElement("img");S.onload=function(){URL.revokeObjectURL(f)},S.src=f,y.document.body.appendChild(S)}}static EncodeScreenshotCanvasData(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",S=arguments.length>3?arguments[3]:void 0,H=arguments.length>4?arguments[4]:void 0;if("string"!==typeof S&&f){if(f){if(X._IsOffScreenCanvas(O))return void O.convertToBlob({type:y,quality:H}).then((O=>{const y=new FileReader;y.readAsDataURL(O),y.onloadend=()=>{const O=y.result;f(O)}}));const S=O.toDataURL(y,H);f(S)}}else this.ToBlob(O,(function(O){O&&X.DownloadBlob(O,S),f&&f("")}),y,H)}static Download(O,f){if("undefined"===typeof URL)return;const y=window.URL.createObjectURL(O),S=document.createElement("a");document.body.appendChild(S),S.style.display="none",S.href=y,S.download=f,S.addEventListener("click",(()=>{S.parentElement&&S.parentElement.removeChild(S)})),S.click(),window.URL.revokeObjectURL(y)}static BackCompatCameraNoPreventDefault(O){return"boolean"===typeof O[0]?O[0]:"boolean"===typeof O[1]&&O[1]}static CreateScreenshot(O,f,y,S){throw(0,N.d)("ScreenshotTools")}static CreateScreenshotAsync(O,f,y){throw(0,N.d)("ScreenshotTools")}static CreateScreenshotUsingRenderTarget(O,f,y,S){throw(0,N.d)("ScreenshotTools")}static CreateScreenshotUsingRenderTargetAsync(O,f,y){throw(0,N.d)("ScreenshotTools")}static RandomId(){return(0,A.d)()}static IsBase64(O){return(0,q.g)(O)}static DecodeBase64(O){return(0,q.c)(O)}static get errorsCount(){return b.e.errorsCount}static Log(O){b.e.Log(O)}static Warn(O){b.e.Warn(O)}static Error(O){b.e.Error(O)}static get LogCache(){return b.e.LogCache}static ClearLogCache(){b.e.ClearLogCache()}static set LogLevels(O){b.e.LogLevels=O}static set PerformanceLogLevel(O){return(O&X.PerformanceUserMarkLogLevel)===X.PerformanceUserMarkLogLevel?(X.StartPerformanceCounter=X._StartUserMark,void(X.EndPerformanceCounter=X._EndUserMark)):(O&X.PerformanceConsoleLogLevel)===X.PerformanceConsoleLogLevel?(X.StartPerformanceCounter=X._StartPerformanceConsole,void(X.EndPerformanceCounter=X._EndPerformanceConsole)):(X.StartPerformanceCounter=X._StartPerformanceCounterDisabled,void(X.EndPerformanceCounter=X._EndPerformanceCounterDisabled))}static _StartPerformanceCounterDisabled(O,f){}static _EndPerformanceCounterDisabled(O,f){}static _StartUserMark(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!X._Performance){if(!(0,H.h)())return;X._Performance=window.performance}f&&X._Performance.mark&&X._Performance.mark(O+"-Begin")}static _EndUserMark(O){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&X._Performance.mark&&(X._Performance.mark(O+"-End"),X._Performance.measure(O,O+"-Begin",O+"-End"))}static _StartPerformanceConsole(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];f&&(X._StartUserMark(O,f),console.time&&console.time(O))}static _EndPerformanceConsole(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];f&&(X._EndUserMark(O,f),console.timeEnd(O))}static get Now(){return v.b.Now}static GetClassName(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=null;if(!f&&O.getClassName)y=O.getClassName();else{if(O instanceof Object){y=(f?O:Object.getPrototypeOf(O)).constructor.__bjsclassName__}y||(y=typeof O)}return y}static First(O,f){for(const y of O)if(f(y))return y;return null}static getFullClassName(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=null,S=null;if(!f&&O.getClassName)y=O.getClassName();else{if(O instanceof Object){const H=f?O:Object.getPrototypeOf(O);y=H.constructor.__bjsclassName__,S=H.constructor.__bjsmoduleName__}y||(y=typeof O)}return y?(null!=S?S+".":"")+y:null}static DelayAsync(O){return new Promise((f=>{setTimeout((()=>{f()}),O)}))}static IsSafari(){return!!(0,H.d)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}X.UseCustomRequestHeaders=!1,X.CustomRequestHeaders=m.e.CustomRequestHeaders,X.GetDOMTextContent=H.b,X._DefaultCdnUrl="https://cdn.babylonjs.com",X.GetAbsoluteUrl="object"===typeof document?O=>{const f=document.createElement("a");return f.href=O,f.href}:"function"===typeof URL&&"object"===typeof location?O=>new URL(O,location.origin).href:()=>{throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},X.NoneLogLevel=b.e.NoneLogLevel,X.MessageLogLevel=b.e.MessageLogLevel,X.WarningLogLevel=b.e.WarningLogLevel,X.ErrorLogLevel=b.e.ErrorLogLevel,X.AllLogLevel=b.e.AllLogLevel,X.IsWindowObjectExist=H.h,X.PerformanceNoneLogLevel=0,X.PerformanceUserMarkLogLevel=1,X.PerformanceConsoleLogLevel=2,X.StartPerformanceCounter=X._StartPerformanceCounterDisabled,X.EndPerformanceCounter=X._EndPerformanceCounterDisabled;class w{constructor(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.iterations=O,this.index=S-1,this._done=!1,this._fn=f,this._successCallback=y}executeNext(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}breakLoop(){this._done=!0,this._successCallback()}static Run(O,f,y){const S=new w(O,f,y,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return S.executeNext(),S}static SyncAsyncForLoop(O,f,y,S,H){let b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return w.Run(Math.ceil(O/f),(S=>{H&&H()?S.breakLoop():setTimeout((()=>{for(let b=0;b<f;++b){const h=S.index*f+b;if(h>=O)break;if(y(h),H&&H()){S.breakLoop();break}}S.executeNext()}),b)}),S)}}X.Mix=J.k,X.IsExponentOfTwo=J.j,t.c.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},11153:(O,f,y)=>{"use strict";y.d(f,{c:()=>b,g:()=>H});const S={};function H(O,f){S[O]=f}function b(O){return S[O]}},11438:(O,f,y)=>{"use strict";y.d(f,{b:()=>S});class S{static get UniqueId(){const O=this._UniqueIdCounter;return this._UniqueIdCounter++,O}}S._UniqueIdCounter=1},11037:(O,f,y)=>{"use strict";y.d(f,{e:()=>S});class S{constructor(){this._xhr="undefined"!==typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(S.CustomRequestHeaders).length>0||S.CustomRequestModifiers.length>0}get requestURL(){return this._requestURL}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const O in S.CustomRequestHeaders){const f=S.CustomRequestHeaders[O];f&&this._xhr.setRequestHeader(O,f)}}_shouldSkipRequestModifications(O){return S.SkipRequestModificationForBabylonCDN&&(O.includes("preview.babylonjs.com")||O.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(O){this._xhr.onprogress=O}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(O){this._xhr.responseType=O}get timeout(){return this._xhr.timeout}set timeout(O){this._xhr.timeout=O}addEventListener(O,f,y){this._xhr.addEventListener(O,f,y)}removeEventListener(O,f,y){this._xhr.removeEventListener(O,f,y)}abort(){this._xhr.abort()}send(O){S.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(O)}open(O,f){for(const y of S.CustomRequestModifiers){if(this._shouldSkipRequestModifications(f))return;y(this._xhr,f)}f=(f=f.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=f,this._xhr.open(O,f,!0)}setRequestHeader(O,f){this._xhr.setRequestHeader(O,f)}getResponseHeader(O){return this._xhr.getResponseHeader(O)}}S.CustomRequestHeaders={},S.CustomRequestModifiers=new Array,S.SkipRequestModificationForBabylonCDN=!0},12283:(O,f,y)=>{"use strict";y.d(f,{c:()=>H});class S{constructor(O){this._pendingActions=new Array,this._workerInfos=O.map((O=>({workerPromise:Promise.resolve(O),idle:!0})))}dispose(){for(const O of this._workerInfos)O.workerPromise.then((O=>{O.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(O){this._executeOnIdleWorker(O)||this._pendingActions.push(O)}_executeOnIdleWorker(O){for(const f of this._workerInfos)if(f.idle)return this._execute(f,O),!0;return!1}_execute(O,f){O.idle=!1,O.workerPromise.then((y=>{f(y,(()=>{const f=this._pendingActions.shift();f?this._execute(O,f):O.idle=!0}))}))}}class H extends S{constructor(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:H.DefaultOptions;super([]),this._maxWorkers=O,this._createWorkerAsync=f,this._options=y}push(O){if(!this._executeOnIdleWorker(O))if(this._workerInfos.length<this._maxWorkers){const f={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(f),this._execute(f,O)}else this._pendingActions.push(O)}_execute(O,f){O.timeoutId&&(clearTimeout(O.timeoutId),delete O.timeoutId),super._execute(O,((y,S)=>{f(y,(()=>{S(),O.idle&&(O.timeoutId=setTimeout((()=>{O.workerPromise.then((O=>{O.terminate()}));const f=this._workerInfos.indexOf(O);-1!==f&&this._workerInfos.splice(f,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}H.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},11705:(O,f,y)=>{"use strict";y.d(f,{e:()=>wO});var S=y(11324),H=y(11497);class b extends H.e{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var h=y(11359),v=(y(11707),y(11153));class N{get noiseTexture(){return this._noiseTexture}set noiseTexture(O){this._noiseTexture!==O&&(this._noiseTexture=O,this._reset())}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(O){this._isAnimationSheetEnabled!=O&&(this._isAnimationSheetEnabled=O,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(O){this._useLogarithmicDepth=O&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:S.m.Zero()}set direction1(O){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=O)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:S.m.Zero()}set direction2(O){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=O)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:S.m.Zero()}set minEmitBox(O){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=O)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:S.m.Zero()}set maxEmitBox(O){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=O)}get billboardMode(){return this._billboardMode}set billboardMode(O){this._billboardMode!==O&&(this._billboardMode=O,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(O){this._isBillboardBased!==O&&(this._isBillboardBased=O,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(O){this._attachImageProcessingConfiguration(O)}_attachImageProcessingConfiguration(O){O!==this._imageProcessingConfiguration&&(!O&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=O)}_reset(){}_removeGradientAndTexture(O,f,y){if(!f)return this;let S=0;for(const H of f){if(H.gradient===O){f.splice(S,1);break}S++}return y&&y.dispose(),this}constructor(O){this.animations=[],this.renderingGroupId=0,this.j=S.m.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new S.m(10,10,10),this.onAnimationEnd=null,this.blendMode=N.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new S.i(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.Of=new S.m(0,0,0),this._useLogarithmicDepth=!1,this.gravity=S.m.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new h.g(1,1,1,1),this.color2=new h.g(1,1,1,1),this.colorDead=new h.g(0,0,0,1),this.textureMask=new h.g(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new b,this.id=O,this.name=O}createPointEmitter(O,f){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new S.m(0,1,0),arguments.length>2&&void 0!==arguments[2]||new S.m(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new S.m(0,1,0),arguments.length>4&&void 0!==arguments[4]||new S.m(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new S.m(0,1,0),arguments.length>3&&void 0!==arguments[3]||new S.m(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(O,f,y,S){throw new Error("Method not implemented.")}}N.BLENDMODE_ONEONE=0,N.BLENDMODE_STANDARD=1,N.BLENDMODE_ADD=2,N.BLENDMODE_MULTIPLY=3,N.BLENDMODE_MULTIPLYADD=4,(0,v.g)("BABYLON.BaseParticleSystem",N);var m=y(11345),t=y(11019);class q{constructor(){this.direction1=new S.m(0,1,0),this.direction2=new S.m(0,1,0),this.minEmitBox=new S.m(-.5,-.5,-.5),this.maxEmitBox=new S.m(.5,.5,.5)}startDirectionFunction(O,f,y,H){const b=(0,m.s)(this.direction1.x,this.direction2.x),h=(0,m.s)(this.direction1.y,this.direction2.y),v=(0,m.s)(this.direction1.z,this.direction2.z);if(H)return f.x=b,f.y=h,void(f.z=v);S.m.TransformNormalFromFloatsToRef(b,h,v,O,f)}startPositionFunction(O,f,y,H){const b=(0,m.s)(this.minEmitBox.x,this.maxEmitBox.x),h=(0,m.s)(this.minEmitBox.y,this.maxEmitBox.y),v=(0,m.s)(this.minEmitBox.z,this.maxEmitBox.z);if(H)return f.x=b,f.y=h,void(f.z=v);S.m.TransformCoordinatesFromFloatsToRef(b,h,v,O,f)}clone(){const O=new q;return t.e.DeepCopy(this,O),O}applyToShader(O){O.setVector3("direction1",this.direction1),O.setVector3("direction2",this.direction2),O.setVector3("minEmitBox",this.minEmitBox),O.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(O){O.addUniform("direction1",3),O.addUniform("direction2",3),O.addUniform("minEmitBox",3),O.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const O={};return O.type=this.getClassName(),O.direction1=this.direction1.gj(),O.direction2=this.direction2.gj(),O.minEmitBox=this.minEmitBox.gj(),O.maxEmitBox=this.maxEmitBox.gj(),O}parse(O){S.m.FromArrayToRef(O.direction1,0,this.direction1),S.m.FromArrayToRef(O.direction2,0,this.direction2),S.m.FromArrayToRef(O.minEmitBox,0,this.minEmitBox),S.m.FromArrayToRef(O.maxEmitBox,0,this.maxEmitBox)}}class F{get radius(){return this._radius}set radius(O){this._radius=O,this._buildHeight()}get angle(){return this._angle}set angle(O){this._angle=O,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=y,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=f,this.radius=O}startDirectionFunction(O,f,y,H){H?S.g.fb[0].p(y.Td).normalize():y.position.subtractToRef(O.getTranslation(),S.g.fb[0]).normalize();const b=(0,m.s)(0,this.directionRandomizer),h=(0,m.s)(0,this.directionRandomizer),v=(0,m.s)(0,this.directionRandomizer);f.x=S.g.fb[0].x+b,f.y=S.g.fb[0].y+h,f.z=S.g.fb[0].z+v,f.normalize()}startPositionFunction(O,f,y,H){const b=(0,m.s)(0,2*Math.PI);let h;this.emitFromSpawnPointOnly?h=1e-4:(h=(0,m.s)(0,this.heightRange),h=1-h*h);let v=this._radius-(0,m.s)(0,this._radius*this.radiusRange);v*=h;const N=v*Math.sin(b),t=v*Math.cos(b),q=h*this._height;if(H)return f.x=N,f.y=q,void(f.z=t);S.m.TransformCoordinatesFromFloatsToRef(N,q,t,O,f)}clone(){const O=new F(this._radius,this._angle,this.directionRandomizer);return t.e.DeepCopy(this,O),O}applyToShader(O){O.setFloat2("radius",this._radius,this.radiusRange),O.setFloat("coneAngle",this._angle),O.setFloat2("height",this._height,this.heightRange),O.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(O){O.addUniform("radius",2),O.addUniform("coneAngle",1),O.addUniform("height",2),O.addUniform("directionRandomizer",1)}getEffectDefines(){let O="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(O+="\n#define CONEEMITTERSPAWNPOINT"),O}getClassName(){return"ConeParticleEmitter"}serialize(){const O={};return O.type=this.getClassName(),O.radius=this._radius,O.angle=this._angle,O.directionRandomizer=this.directionRandomizer,O.radiusRange=this.radiusRange,O.heightRange=this.heightRange,O.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,O}parse(O){this.radius=O.radius,this.angle=O.angle,this.directionRandomizer=O.directionRandomizer,this.radiusRange=void 0!==O.radiusRange?O.radiusRange:1,this.heightRange=void 0!==O.radiusRange?O.heightRange:1,this.emitFromSpawnPointOnly=void 0!==O.emitFromSpawnPointOnly&&O.emitFromSpawnPointOnly}}class I extends F{constructor(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.m(0,1,0),H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.m(0,1,0);super(O,f),this.direction1=y,this.direction2=H}startDirectionFunction(O,f){const y=(0,m.s)(this.direction1.x,this.direction2.x),H=(0,m.s)(this.direction1.y,this.direction2.y),b=(0,m.s)(this.direction1.z,this.direction2.z);S.m.TransformNormalFromFloatsToRef(y,H,b,O,f)}clone(){const O=new I(this.radius,this.angle,this.direction1,this.direction2);return t.e.DeepCopy(this,O),O}applyToShader(O){O.setFloat("radius",this.radius),O.setFloat("radiusRange",this.radiusRange),O.setVector3("direction1",this.direction1),O.setVector3("direction2",this.direction2)}buildUniformLayout(O){O.addUniform("radius",1),O.addUniform("radiusRange",1),O.addUniform("direction1",3),O.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const O=super.serialize();return O.direction1=this.direction1.gj(),O.direction2=this.direction2.gj(),O}parse(O){super.parse(O),this.direction1.p(O.direction1),this.direction2.p(O.direction2)}}class A{constructor(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=O,this.height=f,this.radiusRange=y,this.directionRandomizer=H,this._tempVector=S.m.Zero()}startDirectionFunction(O,f,y,H,b){y.position.subtractToRef(O.getTranslation(),this._tempVector),this._tempVector.normalize(),S.m.TransformNormalToRef(this._tempVector,b,this._tempVector);const h=(0,m.s)(-this.directionRandomizer/2,this.directionRandomizer/2);let v=Math.atan2(this._tempVector.x,this._tempVector.z);v+=(0,m.s)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=h,this._tempVector.x=Math.sin(v),this._tempVector.z=Math.cos(v),this._tempVector.normalize(),H?f.p(this._tempVector):S.m.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,O,f)}startPositionFunction(O,f,y,H){const b=(0,m.s)(-this.height/2,this.height/2),h=(0,m.s)(0,2*Math.PI),v=(0,m.s)((1-this.radiusRange)*(1-this.radiusRange),1),N=Math.sqrt(v)*this.radius,t=N*Math.cos(h),q=N*Math.sin(h);H?f.Xd(t,b,q):S.m.TransformCoordinatesFromFloatsToRef(t,b,q,O,f)}clone(){const O=new A(this.radius,this.directionRandomizer);return t.e.DeepCopy(this,O),O}applyToShader(O){O.setFloat("radius",this.radius),O.setFloat("height",this.height),O.setFloat("radiusRange",this.radiusRange),O.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(O){O.addUniform("radius",1),O.addUniform("height",1),O.addUniform("radiusRange",1),O.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const O={};return O.type=this.getClassName(),O.radius=this.radius,O.height=this.height,O.radiusRange=this.radiusRange,O.directionRandomizer=this.directionRandomizer,O}parse(O){this.radius=O.radius,this.height=O.height,this.radiusRange=O.radiusRange,this.directionRandomizer=O.directionRandomizer}}class J extends A{constructor(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.m(0,1,0),b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new S.m(0,1,0);super(O,f,y),this.direction1=H,this.direction2=b}startDirectionFunction(O,f,y,H){const b=(0,m.s)(this.direction1.x,this.direction2.x),h=(0,m.s)(this.direction1.y,this.direction2.y),v=(0,m.s)(this.direction1.z,this.direction2.z);H?f.Xd(b,h,v):S.m.TransformNormalFromFloatsToRef(b,h,v,O,f)}clone(){const O=new J(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return t.e.DeepCopy(this,O),O}applyToShader(O){O.setFloat("radius",this.radius),O.setFloat("height",this.height),O.setFloat("radiusRange",this.radiusRange),O.setVector3("direction1",this.direction1),O.setVector3("direction2",this.direction2)}buildUniformLayout(O){O.addUniform("radius",1),O.addUniform("height",1),O.addUniform("radiusRange",1),O.addUniform("direction1",3),O.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const O=super.serialize();return O.direction1=this.direction1.gj(),O.direction2=this.direction2.gj(),O}parse(O){super.parse(O),S.m.FromArrayToRef(O.direction1,0,this.direction1),S.m.FromArrayToRef(O.direction2,0,this.direction2)}}class X{constructor(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=O,this.radiusRange=f,this.directionRandomizer=y}startDirectionFunction(O,f,y,H){const b=y.position.xc(O.getTranslation()).normalize(),h=(0,m.s)(0,this.directionRandomizer),v=(0,m.s)(0,this.directionRandomizer),N=(0,m.s)(0,this.directionRandomizer);b.x+=h,b.y+=v,b.z+=N,b.normalize(),H?f.p(b):S.m.TransformNormalFromFloatsToRef(b.x,b.y,b.z,O,f)}startPositionFunction(O,f,y,H){const b=this.radius-(0,m.s)(0,this.radius*this.radiusRange),h=(0,m.s)(0,1),v=(0,m.s)(0,2*Math.PI),N=Math.acos(2*h-1),t=b*Math.cos(v)*Math.sin(N),q=b*Math.cos(N),F=b*Math.sin(v)*Math.sin(N);H?f.Xd(t,Math.abs(q),F):S.m.TransformCoordinatesFromFloatsToRef(t,Math.abs(q),F,O,f)}clone(){const O=new X(this.radius,this.directionRandomizer);return t.e.DeepCopy(this,O),O}applyToShader(O){O.setFloat("radius",this.radius),O.setFloat("radiusRange",this.radiusRange),O.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(O){O.addUniform("radius",1),O.addUniform("radiusRange",1),O.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const O={};return O.type=this.getClassName(),O.radius=this.radius,O.radiusRange=this.radiusRange,O.directionRandomizer=this.directionRandomizer,O}parse(O){this.radius=O.radius,this.radiusRange=O.radiusRange,this.directionRandomizer=O.directionRandomizer}}class w{constructor(){this.direction1=new S.m(0,1,0),this.direction2=new S.m(0,1,0)}startDirectionFunction(O,f,y,H){const b=(0,m.s)(this.direction1.x,this.direction2.x),h=(0,m.s)(this.direction1.y,this.direction2.y),v=(0,m.s)(this.direction1.z,this.direction2.z);H?f.Xd(b,h,v):S.m.TransformNormalFromFloatsToRef(b,h,v,O,f)}startPositionFunction(O,f,y,H){H?f.Xd(0,0,0):S.m.TransformCoordinatesFromFloatsToRef(0,0,0,O,f)}clone(){const O=new w;return t.e.DeepCopy(this,O),O}applyToShader(O){O.setVector3("direction1",this.direction1),O.setVector3("direction2",this.direction2)}buildUniformLayout(O){O.addUniform("direction1",3),O.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const O={};return O.type=this.getClassName(),O.direction1=this.direction1.gj(),O.direction2=this.direction2.gj(),O}parse(O){S.m.FromArrayToRef(O.direction1,0,this.direction1),S.m.FromArrayToRef(O.direction2,0,this.direction2)}}class B{constructor(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=O,this.radiusRange=f,this.directionRandomizer=y}startDirectionFunction(O,f,y,H){const b=y.position.xc(O.getTranslation()).normalize(),h=(0,m.s)(0,this.directionRandomizer),v=(0,m.s)(0,this.directionRandomizer),N=(0,m.s)(0,this.directionRandomizer);b.x+=h,b.y+=v,b.z+=N,b.normalize(),H?f.p(b):S.m.TransformNormalFromFloatsToRef(b.x,b.y,b.z,O,f)}startPositionFunction(O,f,y,H){const b=this.radius-(0,m.s)(0,this.radius*this.radiusRange),h=(0,m.s)(0,1),v=(0,m.s)(0,2*Math.PI),N=Math.acos(2*h-1),t=b*Math.cos(v)*Math.sin(N),q=b*Math.cos(N),F=b*Math.sin(v)*Math.sin(N);H?f.Xd(t,q,F):S.m.TransformCoordinatesFromFloatsToRef(t,q,F,O,f)}clone(){const O=new B(this.radius,this.directionRandomizer);return t.e.DeepCopy(this,O),O}applyToShader(O){O.setFloat("radius",this.radius),O.setFloat("radiusRange",this.radiusRange),O.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(O){O.addUniform("radius",1),O.addUniform("radiusRange",1),O.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const O={};return O.type=this.getClassName(),O.radius=this.radius,O.radiusRange=this.radiusRange,O.directionRandomizer=this.directionRandomizer,O}parse(O){this.radius=O.radius,this.radiusRange=O.radiusRange,this.directionRandomizer=O.directionRandomizer}}class j extends B{constructor(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S.m(0,1,0),y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.m(0,1,0);super(O),this.direction1=f,this.direction2=y}startDirectionFunction(O,f){const y=(0,m.s)(this.direction1.x,this.direction2.x),H=(0,m.s)(this.direction1.y,this.direction2.y),b=(0,m.s)(this.direction1.z,this.direction2.z);S.m.TransformNormalFromFloatsToRef(y,H,b,O,f)}clone(){const O=new j(this.radius,this.direction1,this.direction2);return t.e.DeepCopy(this,O),O}applyToShader(O){O.setFloat("radius",this.radius),O.setFloat("radiusRange",this.radiusRange),O.setVector3("direction1",this.direction1),O.setVector3("direction2",this.direction2)}buildUniformLayout(O){O.addUniform("radius",1),O.addUniform("radiusRange",1),O.addUniform("direction1",3),O.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const O=super.serialize();return O.direction1=this.direction1.gj(),O.direction2=this.direction2.gj(),O}parse(O){super.parse(O),this.direction1.p(O.direction1),this.direction2.p(O.direction2)}}class u{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{}}startDirectionFunction(O,f,y,H){const b=S.g.fb[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,y,b);const O=S.g.fb[1];b.subtractToRef(y.position,O),O.scaleToRef(1/y.lifeTime,b)}else b.set(0,0,0);H?f.p(b):S.m.TransformNormalToRef(b,O,f)}startPositionFunction(O,f,y,H){const b=S.g.fb[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,y,b):b.set(0,0,0),H?f.p(b):S.m.TransformCoordinatesToRef(b,O,f)}clone(){const O=new u;return t.e.DeepCopy(this,O),O}applyToShader(O){}buildUniformLayout(O){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const O={};return O.type=this.getClassName(),O.particlePositionGenerator=this.particlePositionGenerator,O.particleDestinationGenerator=this.particleDestinationGenerator,O}parse(O){O.particlePositionGenerator&&(this.particlePositionGenerator=O.particlePositionGenerator),O.particleDestinationGenerator&&(this.particleDestinationGenerator=O.particleDestinationGenerator)}}var L=y(11392);class p{get mesh(){return this._mesh}set mesh(O){this._mesh!==O&&(this._mesh=O,O?(this._indices=O.Pf(),this._positions=O.getVerticesData(L.f.PositionKind),this._normals=O.getVerticesData(L.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=S.m.Zero(),this._mesh=null,this.direction1=new S.m(0,1,0),this.direction2=new S.m(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=O}startDirectionFunction(O,f,y,H){if(this.useMeshNormalsForDirection&&this._normals)return void S.m.TransformNormalToRef(this._storedNormal,O,f);const b=(0,m.s)(this.direction1.x,this.direction2.x),h=(0,m.s)(this.direction1.y,this.direction2.y),v=(0,m.s)(this.direction1.z,this.direction2.z);H?f.Xd(b,h,v):S.m.TransformNormalFromFloatsToRef(b,h,v,O,f)}startPositionFunction(O,f,y,H){if(!this._indices||!this._positions)return;const b=3*Math.random()*(this._indices.length/3)|0,h=Math.random(),v=Math.random()*(1-h),N=1-h-v,m=this._indices[b],t=this._indices[b+1],q=this._indices[b+2],F=S.g.fb[0],I=S.g.fb[1],A=S.g.fb[2],J=S.g.fb[3];S.m.FromArrayToRef(this._positions,3*m,F),S.m.FromArrayToRef(this._positions,3*t,I),S.m.FromArrayToRef(this._positions,3*q,A),J.x=h*F.x+v*I.x+N*A.x,J.y=h*F.y+v*I.y+N*A.y,J.z=h*F.z+v*I.z+N*A.z,H?f.Xd(J.x,J.y,J.z):S.m.TransformCoordinatesFromFloatsToRef(J.x,J.y,J.z,O,f),this.useMeshNormalsForDirection&&this._normals&&(S.m.FromArrayToRef(this._normals,3*m,F),S.m.FromArrayToRef(this._normals,3*t,I),S.m.FromArrayToRef(this._normals,3*q,A),this._storedNormal.x=h*F.x+v*I.x+N*A.x,this._storedNormal.y=h*F.y+v*I.y+N*A.y,this._storedNormal.z=h*F.z+v*I.z+N*A.z)}clone(){const O=new p(this.mesh);return t.e.DeepCopy(this,O),O}applyToShader(O){O.setVector3("direction1",this.direction1),O.setVector3("direction2",this.direction2)}buildUniformLayout(O){O.addUniform("direction1",3),O.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var O;const f={};return f.type=this.getClassName(),f.direction1=this.direction1.gj(),f.direction2=this.direction2.gj(),f.meshId=null===(O=this.mesh)||void 0===O?void 0:O.id,f.useMeshNormalsForDirection=this.useMeshNormalsForDirection,f}parse(O,f){S.m.FromArrayToRef(O.direction1,0,this.direction1),S.m.FromArrayToRef(O.direction2,0,this.direction2),O.meshId&&f&&(this.mesh=f.getLastMeshById(O.meshId)),this.useMeshNormalsForDirection=O.useMeshNormalsForDirection}}var U=y(11098);class l{_isUbo(O){return void 0!==O.addUniform}constructor(O){this._isUbo(O)?(this.setMatrix3x3=O.updateMatrix3x3.bind(O),this.setMatrix2x2=O.updateMatrix2x2.bind(O),this.setFloat=O.updateFloat.bind(O),this.setFloat2=O.updateFloat2.bind(O),this.setFloat3=O.updateFloat3.bind(O),this.setFloat4=O.updateFloat4.bind(O),this.setFloatArray=O.updateFloatArray.bind(O),this.setArray=O.updateArray.bind(O),this.setIntArray=O.updateIntArray.bind(O),this.setMatrix=O.Fj.bind(O),this.setMatrices=O.updateMatrices.bind(O),this.setVector3=O.updateVector3.bind(O),this.setVector4=O.updateVector4.bind(O),this.setColor3=O.updateColor3.bind(O),this.setColor4=O.updateColor4.bind(O),this.setDirectColor4=O.updateDirectColor4.bind(O),this.setInt=O.updateInt.bind(O),this.setInt2=O.updateInt2.bind(O),this.setInt3=O.updateInt3.bind(O),this.setInt4=O.updateInt4.bind(O)):(this.setMatrix3x3=O.setMatrix3x3.bind(O),this.setMatrix2x2=O.setMatrix2x2.bind(O),this.setFloat=O.setFloat.bind(O),this.setFloat2=O.setFloat2.bind(O),this.setFloat3=O.setFloat3.bind(O),this.setFloat4=O.setFloat4.bind(O),this.setFloatArray=O.setFloatArray.bind(O),this.setArray=O.setArray.bind(O),this.setIntArray=O.setIntArray.bind(O),this.setMatrix=O.setMatrix.bind(O),this.setMatrices=O.setMatrices.bind(O),this.setVector3=O.setVector3.bind(O),this.setVector4=O.setVector4.bind(O),this.setColor3=O.setColor3.bind(O),this.setColor4=O.setColor4.bind(O),this.setDirectColor4=O.setDirectColor4.bind(O),this.setInt=O.setInt.bind(O),this.setInt2=O.setInt2.bind(O),this.setInt3=O.setInt3.bind(O),this.setInt4=O.setInt4.bind(O))}}var x=y(11101);const W="gpuUpdateParticlesPixelShader",E="#version 300 es\nvoid main() {discard;}\n";x.c.ShadersStore[W]=E;const o="gpuUpdateParticlesVertexShader",i="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";x.c.ShadersStore[o]=i;(0,v.g)("BABYLON.WebGL2ParticleSystem",class{constructor(O,f){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=O,this._engine=f,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var O;return(null===(O=this._updateEffect)||void 0===O?void 0:O.isReady())??!1}createUpdateBuffer(O){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof u&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=O,this._updateEffect=new U.b("gpuUpdateParticles",this._updateEffectOptions,this._engine),new l(this._updateEffect)}createVertexBuffers(O,f){this._updateVAO.push(this._createUpdateVAO(O)),this._renderVAO.push(this._engine.recordVertexArrayObject(f,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=f}createParticleBuffer(O){return O}bindDrawBuffers(O,f,y){y?this._engine.bindBuffers(this._renderVertexBuffers,y,f):this._engine.bindVertexArrayObject(this._renderVAO[O],null)}preUpdateParticleBuffer(){const O=this._engine;if(this._engine.enableEffect(this._updateEffect),!O.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(O,f,y){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[O],null);const S=this._engine;S.bindTransformFeedbackBuffer(f.getBuffer()),S.setRasterizerState(!1),S.beginTransformFeedback(!0),S.drawArraysType(3,0,y),S.endTransformFeedback(),S.setRasterizerState(!0),S.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let O=0;O<this._updateVAO.length;O++)this._engine.releaseVertexArrayObject(this._updateVAO[O]);this._updateVAO.length=0;for(let O=0;O<this._renderVAO.length;O++)this._engine.releaseVertexArrayObject(this._renderVAO[O]);this._renderVAO.length=0}_createUpdateVAO(O){const f={};f.position=O.createVertexBuffer("position",0,3);let y=3;f.age=O.createVertexBuffer("age",y,1),y+=1,f.size=O.createVertexBuffer("size",y,3),y+=3,f.life=O.createVertexBuffer("life",y,1),y+=1,f.seed=O.createVertexBuffer("seed",y,4),y+=4,f.direction=O.createVertexBuffer("direction",y,3),y+=3,this._parent.particleEmitterType instanceof u&&(f.initialPosition=O.createVertexBuffer("initialPosition",y,3),y+=3),this._parent._colorGradientsTexture||(f.color=O.createVertexBuffer("color",y,4),y+=4),this._parent._isBillboardBased||(f.initialDirection=O.createVertexBuffer("initialDirection",y,3),y+=3),this._parent.noiseTexture&&(f.noiseCoordinates1=O.createVertexBuffer("noiseCoordinates1",y,3),y+=3,f.noiseCoordinates2=O.createVertexBuffer("noiseCoordinates2",y,3),y+=3),this._parent._angularSpeedGradientsTexture?(f.angle=O.createVertexBuffer("angle",y,1),y+=1):(f.angle=O.createVertexBuffer("angle",y,2),y+=2),this._parent._isAnimationSheetEnabled&&(f.cellIndex=O.createVertexBuffer("cellIndex",y,1),y+=1,this._parent.spriteRandomStartCell&&(f.cellStartOffset=O.createVertexBuffer("cellStartOffset",y,1),y+=1));const S=this._engine.recordVertexArrayObject(f,null,this._updateEffect);return this._engine.bindArrayBuffer(null),S}});class D{constructor(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,S=arguments.length>3?arguments[3]:void 0;this._engine=O,this._label=S,this._engine._storageBuffers.push(this),this._create(f,y)}_create(O,f){this._bufferSize=O,this._creationFlags=f,this._buffer=this._engine.createStorageBuffer(O,f,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(O,f,y){this._buffer&&this._engine.updateStorageBuffer(this._buffer,O,f,y)}read(O,f,y,S){return this._engine.readFromStorageBuffer(this._buffer,O,f,y,S)}dispose(){const O=this._engine._storageBuffers,f=O.indexOf(this);-1!==f&&(O[f]=O[O.length-1],O.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var V=y(11289),g=y(11294),R=y(11362),s=y(11509),k=y(11438),z=y(11017),c=y(11134),d=y(11166);class G{constructor(){this._gpuTimeInFrameId=-1,this.counter=new d.d}_addDuration(O,f){O<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==O?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(f,!1),this._gpuTimeInFrameId=O):this.counter.addCount(f,!1))}}class Y{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=O,this._engine=f,this.uniqueId=k.b.UniqueId,f.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new G),this._engine.getCaps().supportComputeShaders?S.bindingsMapping?(this._context=f.createComputeContext(),this._shaderPath=y,this._options={bindingsMapping:{},defines:[],...S}):z.e.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):z.e.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(O,f){let y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const S=this._bindings[O];this._bindings[O]={type:y?0:4,object:f,indexInGroupEntries:null===S||void 0===S?void 0:S.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!S||S.object!==f||S.type!==this._bindings[O].type)}setStorageTexture(O,f){const y=this._bindings[O];this._contextIsDirty||(this._contextIsDirty=!y||y.object!==f),this._bindings[O]={type:1,object:f,indexInGroupEntries:null===y||void 0===y?void 0:y.indexInGroupEntries}}setExternalTexture(O,f){const y=this._bindings[O];this._contextIsDirty||(this._contextIsDirty=!y||y.object!==f),this._bindings[O]={type:6,object:f,indexInGroupEntries:null===y||void 0===y?void 0:y.indexInGroupEntries}}setVideoTexture(O,f){return!!f.externalTexture&&(this.setExternalTexture(O,f.externalTexture),!0)}setUniformBuffer(O,f){const y=this._bindings[O];this._contextIsDirty||(this._contextIsDirty=!y||y.object!==f),this._bindings[O]={type:Y._BufferIsDataBuffer(f)?7:2,object:f,indexInGroupEntries:null===y||void 0===y?void 0:y.indexInGroupEntries}}setStorageBuffer(O,f){const y=this._bindings[O];this._contextIsDirty||(this._contextIsDirty=!y||y.object!==f),this._bindings[O]={type:Y._BufferIsDataBuffer(f)?7:3,object:f,indexInGroupEntries:null===y||void 0===y?void 0:y.indexInGroupEntries}}setTextureSampler(O,f){const y=this._bindings[O];this._contextIsDirty||(this._contextIsDirty=!y||!f.compareSampler(y.object)),this._bindings[O]={type:5,object:f,indexInGroupEntries:null===y||void 0===y?void 0:y.indexInGroupEntries}}isReady(){let O=this._effect;for(const H in this._bindings){const O=this._bindings[H],f=O.type,y=O.object;switch(f){case 0:case 4:case 1:if(!y.isReady())return!1;break;case 6:if(!y.isReady())return!1;break}}const f=[],y=this._shaderPath;if(this._options.defines)for(let H=0;H<this._options.defines.length;H++)f.push(this._options.defines[H]);const S=f.join("\n");return this._cachedDefines!==S&&(this._cachedDefines=S,O=this._engine.createComputeEffect(y,{defines:S,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=O),!!O.isReady()}dispatch(O,f,y){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,O,f,y,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const y=Y._BufferIsDataBuffer(O)?O:O.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,y,f,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const f in this._bindings){const y=this._bindings[f];if(!this._options.bindingsMapping[f])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+f+"'");switch(y.type){case 0:{const S=this._samplers[f],H=y.object;var O;if(!S||!H._texture||!S.compareSampler(H._texture))this._samplers[f]=(new c.d).setParameters(H.wrapU,H.wrapV,H.wrapR,H.anisotropicFilteringLevel,H._texture.samplingMode,null===(O=H._texture)||void 0===O?void 0:O._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const O=y.object;O.getBuffer()!==y.buffer&&(y.buffer=O.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}dispatchWhenReady(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return new Promise((H=>{const b=()=>{this.dispatch(O,f,y)?H():setTimeout(b,S)};b()}))}serialize(){const O=R.b.Serialize(this);O.options=this._options,O.shaderPath=this._shaderPath,O.vj={},O.textures={};for(const f in this._bindings){const y=this._bindings[f],S=y.object;switch(y.type){case 0:case 4:case 1:{const H=S.serialize();H&&(O.textures[f]=H,O.vj[f]={type:y.type});break}}}return O}static Parse(O,f,y){const S=R.b.Parse((()=>new Y(O.name,f.getEngine(),O.shaderPath,O.options)),O,f,y);for(const H in O.textures){const b=O.vj[H],h=s.e.Parse(O.textures[H],f,y);0===b.type?S.setTexture(H,h):4===b.type?S.setTexture(H,h,!1):S.setStorageTexture(H,h)}return S}static _BufferIsDataBuffer(O){return void 0!==O.underlyingResource}}(0,V.b)([(0,g.L)()],Y.prototype,"name",void 0),(0,V.b)([(0,g.L)()],Y.prototype,"fastMode",void 0),(0,v.g)("BABYLON.ComputeShader",Y);var Z=y(11380);const a="gpuUpdateParticlesComputeShader",M="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";x.c.ShadersStoreWGSL[a]=M;(0,v.g)("BABYLON.ComputeShaderParticleSystem",class{constructor(O,f){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=O,this._engine=f}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var O;return(null===(O=this._updateComputeShader)||void 0===O?void 0:O.isReady())??!1}createUpdateBuffer(O){var f;const y={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(y.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(y.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(y.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(y.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(y.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(y.noiseTexture={group:1,binding:11}),this._updateComputeShader=new Y("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:y,defines:O.split("\n")}),null===(f=this._simParamsComputeShader)||void 0===f||f.dispose(),this._simParamsComputeShader=new Z.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new l(this._simParamsComputeShader)}createVertexBuffers(O,f){this._renderVertexBuffers.push(f)}createParticleBuffer(O){const f=new D(this._engine,4*O.length,11,"ComputeShaderParticleSystemBuffer");return f.update(O),this._bufferComputeShader.push(f),f.getBuffer()}bindDrawBuffers(O,f,y){this._engine.bindBuffers(this._renderVertexBuffers[O],y,f)}preUpdateParticleBuffer(){}updateParticleBuffer(O,f,y){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[O]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^O]),this._updateComputeShader.dispatch(Math.ceil(y/64))}releaseBuffers(){var O;for(let f=0;f<this._bufferComputeShader.length;++f)this._bufferComputeShader[f].dispose();this._bufferComputeShader.length=0,null===(O=this._simParamsComputeShader)||void 0===O||O.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class P{constructor(O,f,y){this.gradient=O,this.color1=f,this.color2=y}getColorToRef(O){this.color2?h.g.LerpToRef(this.color1,this.color2,Math.random(),O):O.p(this.color1)}}class e{constructor(O,f){this.gradient=O,this.color=f}}class K{constructor(O,f,y){this.gradient=O,this.factor1=f,this.factor2=y}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class T{static GetCurrentGradient(O,f,y){if(f[0].gradient>O)return void y(f[0],f[0],1);for(let H=0;H<f.length-1;H++){const S=f[H],b=f[H+1];if(O>=S.gradient&&O<=b.gradient){return void y(S,b,(O-S.gradient)/(b.gradient-S.gradient))}}const S=f.length-1;y(f[S],f[S],1)}}var Q=y(11004),C=y(11744),r=y(11042);class n{constructor(O){this.particleSystem=O,this.position=S.m.Zero(),this.direction=S.m.Zero(),this.color=new h.g(0,0,0,0),this.colorStep=new h.g(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new S.i(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new h.g(0,0,0,0),this._currentColor2=new h.g(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=n._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let O=this.age,f=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===f?(f=1,O=this._randomCellOffset):O+=this._randomCellOffset);const y=this._initialEndSpriteCellID-this._initialStartSpriteCellID+1;let S;S=this._initialSpriteCellLoop?(0,m.c)(O*f%this.lifeTime/this.lifeTime):(0,m.c)(O*f/this.lifeTime),this.cellIndex=this._initialStartSpriteCellID+S*y|0}_inheritParticleInfoToSubEmitter(O){if(O.particleSystem.j.position){const f=O.particleSystem.j;if(f.position.p(this.position),O.inheritDirection){const O=S.g.fb[0];this.direction.normalizeToRef(O),f.setDirection(O,0,Math.PI/2)}}else{O.particleSystem.j.p(this.position)}this.direction.scaleToRef(O.inheritedVelocityAmount/2,S.g.fb[0]),O.particleSystem._inheritedVelocityOffset.p(S.g.fb[0])}_inheritParticleInfoToSubEmitters(){this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach((O=>{this._inheritParticleInfoToSubEmitter(O)}))}_reset(){this.age=0,this.id=n._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(O){O.position.p(this.position),this._initialDirection?O._initialDirection?O._initialDirection.p(this._initialDirection):O._initialDirection=this._initialDirection.clone():O._initialDirection=null,O.direction.p(this.direction),this.Td&&(O.Td?O.Td.p(this.Td):O.Td=this.Td.clone()),O.color.p(this.color),O.colorStep.p(this.colorStep),O.lifeTime=this.lifeTime,O.age=this.age,O._randomCellOffset=this._randomCellOffset,O.size=this.size,O.scale.p(this.scale),O.angle=this.angle,O.angularSpeed=this.angularSpeed,O.particleSystem=this.particleSystem,O.cellIndex=this.cellIndex,O.id=this.id,O._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(O._currentColorGradient=this._currentColorGradient,O._currentColor1.p(this._currentColor1),O._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(O._currentSizeGradient=this._currentSizeGradient,O._currentSize1=this._currentSize1,O._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(O._currentAngularSpeedGradient=this._currentAngularSpeedGradient,O._currentAngularSpeed1=this._currentAngularSpeed1,O._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(O._currentVelocityGradient=this._currentVelocityGradient,O._currentVelocity1=this._currentVelocity1,O._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(O._currentLimitVelocityGradient=this._currentLimitVelocityGradient,O._currentLimitVelocity1=this._currentLimitVelocity1,O._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(O._currentDragGradient=this._currentDragGradient,O._currentDrag1=this._currentDrag1,O._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(O._initialStartSpriteCellID=this._initialStartSpriteCellID,O._initialEndSpriteCellID=this._initialEndSpriteCellID,O._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(O.remapData&&this.remapData?O.remapData.p(this.remapData):O.remapData=new S.q(0,0,0,0)),this._randomNoiseCoordinates1&&(O._randomNoiseCoordinates1?(O._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),O._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(O._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),O._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}n._Count=0;var OO=y(11488),fO=(y(11751),y(11494)),yO=y(11490),SO=y(11373);class HO extends N{set onDispose(O){this._onDisposeObserver&&this.hj.remove(this._onDisposeObserver),this._onDisposeObserver=this.hj.add(O)}get useRampGradients(){return this._useRampGradients}set useRampGradients(O){this._useRampGradients!==O&&(this._useRampGradients=O,this._resetEffect())}get particles(){return this.qj}get shaderLanguage(){return this._shaderLanguage}getActiveCount(){return this.qj.length}getClassName(){return"ub"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var O;let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(O=this._customWrappers[f])||void 0===O?void 0:O.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[O]??this._customWrappers[0]}setCustomEffect(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[f]=new OO.b(this._engine),this._customWrappers[f].effect=O,this._customWrappers[f].drawContext&&(this._customWrappers[f].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new Q.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}constructor(O,f,y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>4&&void 0!==arguments[4]&&arguments[4],v=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01;super(O),this._emitterInverseWorldMatrix=S.b.Identity(),this._inheritedVelocityOffset=new S.m,this.hj=new Q.d,this.onStoppedObservable=new Q.d,this.qj=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new h.g(0,0,0,0),this._colorDiff=new h.g(0,0,0,0),this._scaledDirection=S.m.Zero(),this._scaledGravity=S.m.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this.isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=O=>{},this.recycleParticle=O=>{const f=this.qj.pop();f!==O&&f.copyTo(O),this._stockParticles.push(f)},this._createParticle=()=>{let O;return 0!==this._stockParticles.length?(O=this._stockParticles.pop(),O._reset()):O=new n(this),this._prepareParticle(O),O},this._shadersLoaded=!1,this._capacity=f,this._epsilon=v,this._isAnimationSheetEnabled=b,y&&"Scene"!==y.getClassName()?(this._engine=y,this.defaultProjectionMatrix=S.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=y||r.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.oj.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._attachImageProcessingConfiguration(null),this._customWrappers={0:new OO.b(this._engine)},this._customWrappers[0].effect=H,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new q;let N=null;this.updateFunction=O=>{let f=null;var y;this.noiseTexture&&(f=this.noiseTexture.getSize(),null===(y=this.noiseTexture.getContent())||void 0===y||y.then((O=>{N=O})));const H=O===this.qj;for(let b=0;b<O.length;b++){const y=O[b];let v=this._scaledUpdateSpeed;const t=y.age;if(y.age+=v,y.age>y.lifeTime){const O=y.age-t;v=(y.lifeTime-t)*v/O,y.age=y.lifeTime}const q=y.age/y.lifeTime;this._colorGradients&&this._colorGradients.length>0?T.GetCurrentGradient(q,this._colorGradients,((O,f,S)=>{O!==y._currentColorGradient&&(y._currentColor1.p(y._currentColor2),f.getColorToRef(y._currentColor2),y._currentColorGradient=O),h.g.LerpToRef(y._currentColor1,y._currentColor2,S,y.color)})):(y.colorStep.scaleToRef(v,this._scaledColorStep),y.color.addInPlace(this._scaledColorStep),y.color.a<0&&(y.color.a=0)),this._angularSpeedGradients&&this._angularSpeedGradients.length>0&&T.GetCurrentGradient(q,this._angularSpeedGradients,((O,f,S)=>{O!==y._currentAngularSpeedGradient&&(y._currentAngularSpeed1=y._currentAngularSpeed2,y._currentAngularSpeed2=f.getFactor(),y._currentAngularSpeedGradient=O),y.angularSpeed=(0,m.o)(y._currentAngularSpeed1,y._currentAngularSpeed2,S)})),y.angle+=y.angularSpeed*v;let F=v;if(this._velocityGradients&&this._velocityGradients.length>0&&T.GetCurrentGradient(q,this._velocityGradients,((O,f,S)=>{O!==y._currentVelocityGradient&&(y._currentVelocity1=y._currentVelocity2,y._currentVelocity2=f.getFactor(),y._currentVelocityGradient=O),F*=(0,m.o)(y._currentVelocity1,y._currentVelocity2,S)})),y.direction.scaleToRef(F,this._scaledDirection),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&T.GetCurrentGradient(q,this._limitVelocityGradients,((O,f,S)=>{O!==y._currentLimitVelocityGradient&&(y._currentLimitVelocity1=y._currentLimitVelocity2,y._currentLimitVelocity2=f.getFactor(),y._currentLimitVelocityGradient=O);const H=(0,m.o)(y._currentLimitVelocity1,y._currentLimitVelocity2,S);y.direction.length()>H&&y.direction.scaleInPlace(this.limitVelocityDamping)})),this._dragGradients&&this._dragGradients.length>0&&T.GetCurrentGradient(q,this._dragGradients,((O,f,S)=>{O!==y._currentDragGradient&&(y._currentDrag1=y._currentDrag2,y._currentDrag2=f.getFactor(),y._currentDragGradient=O);const H=(0,m.o)(y._currentDrag1,y._currentDrag2,S);this._scaledDirection.scaleInPlace(1-H)})),this.isLocal&&y.Td?(y.Td.addInPlace(this._scaledDirection),S.m.TransformCoordinatesToRef(y.Td,this._emitterWorldMatrix,y.position)):y.position.addInPlace(this._scaledDirection),N&&f&&y._randomNoiseCoordinates1){const O=this._fetchR(y._randomNoiseCoordinates1.x,y._randomNoiseCoordinates1.y,f.width,f.height,N),H=this._fetchR(y._randomNoiseCoordinates1.z,y._randomNoiseCoordinates2.x,f.width,f.height,N),b=this._fetchR(y._randomNoiseCoordinates2.y,y._randomNoiseCoordinates2.z,f.width,f.height,N),h=S.g.fb[0],m=S.g.fb[1];h.Xd((2*O-1)*this.noiseStrength.x,(2*H-1)*this.noiseStrength.y,(2*b-1)*this.noiseStrength.z),h.scaleToRef(v,m),y.direction.addInPlace(m)}this.gravity.scaleToRef(v,this._scaledGravity),y.direction.addInPlace(this._scaledGravity),this._sizeGradients&&this._sizeGradients.length>0&&T.GetCurrentGradient(q,this._sizeGradients,((O,f,S)=>{O!==y._currentSizeGradient&&(y._currentSize1=y._currentSize2,y._currentSize2=f.getFactor(),y._currentSizeGradient=O),y.size=(0,m.o)(y._currentSize1,y._currentSize2,S)})),this._useRampGradients&&(this._colorRemapGradients&&this._colorRemapGradients.length>0&&T.GetCurrentGradient(q,this._colorRemapGradients,((O,f,S)=>{const H=(0,m.o)(O.factor1,f.factor1,S),b=(0,m.o)(O.factor2,f.factor2,S);y.remapData.x=H,y.remapData.y=b-H})),this._alphaRemapGradients&&this._alphaRemapGradients.length>0&&T.GetCurrentGradient(q,this._alphaRemapGradients,((O,f,S)=>{const H=(0,m.o)(O.factor1,f.factor1,S),b=(0,m.o)(O.factor2,f.factor2,S);y.remapData.z=H,y.remapData.w=b-H}))),this._isAnimationSheetEnabled&&y.updateCellIndex(),y._inheritParticleInfoToSubEmitters(),y.age>=y.lifeTime&&(this._emitFromParticle(y),y._attachedSubEmitters&&(y._attachedSubEmitters.forEach((O=>{O.particleSystem.disposeOnStop=!0,O.particleSystem.stop()})),y._attachedSubEmitters=null),this.recycleParticle(y),H&&b--)}}}serialize(O){throw new Error("Method not implemented.")}clone(O,f){throw new Error("Method not implemented.")}_addFactorGradient(O,f,y,S){const H=new K(f,y,S);O.push(H),O.sort(((O,f)=>O.gradient<f.gradient?-1:O.gradient>f.gradient?1:0))}_removeFactorGradient(O,f){if(!O)return;let y=0;for(const S of O){if(S.gradient===f){O.splice(y,1);break}y++}}addLifeTimeGradient(O,f,y){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,O,f,y),this}removeLifeTimeGradient(O){return this._removeFactorGradient(this._lifeTimeGradients,O),this}addSizeGradient(O,f,y){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,O,f,y),this}removeSizeGradient(O){return this._removeFactorGradient(this._sizeGradients,O),this}addColorRemapGradient(O,f,y){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,O,f,y),this}removeColorRemapGradient(O){return this._removeFactorGradient(this._colorRemapGradients,O),this}addAlphaRemapGradient(O,f,y){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,O,f,y),this}removeAlphaRemapGradient(O){return this._removeFactorGradient(this._alphaRemapGradients,O),this}addAngularSpeedGradient(O,f,y){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,O,f,y),this}removeAngularSpeedGradient(O){return this._removeFactorGradient(this._angularSpeedGradients,O),this}addVelocityGradient(O,f,y){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,O,f,y),this}removeVelocityGradient(O){return this._removeFactorGradient(this._velocityGradients,O),this}addLimitVelocityGradient(O,f,y){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,O,f,y),this}removeLimitVelocityGradient(O){return this._removeFactorGradient(this._limitVelocityGradients,O),this}addDragGradient(O,f,y){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,O,f,y),this}removeDragGradient(O){return this._removeFactorGradient(this._dragGradients,O),this}addEmitRateGradient(O,f,y){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,O,f,y),this}removeEmitRateGradient(O){return this._removeFactorGradient(this._emitRateGradients,O),this}addStartSizeGradient(O,f,y){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,O,f,y),this}removeStartSizeGradient(O){return this._removeFactorGradient(this._startSizeGradients,O),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const O=new Uint8Array(4*this._rawTextureWidth),f=h.k.gb[0];for(let y=0;y<this._rawTextureWidth;y++){const S=y/this._rawTextureWidth;T.GetCurrentGradient(S,this._rampGradients,((S,H,b)=>{h.d.LerpToRef(S.color,H.color,b,f),O[4*y]=255*f.r,O[4*y+1]=255*f.g,O[4*y+2]=255*f.b,O[4*y+3]=255}))}this._rampGradientsTexture=C.c.CreateRGBATexture(O,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((O,f)=>O.gradient<f.gradient?-1:O.gradient>f.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(O,f){this._rampGradients||(this._rampGradients=[]);const y=new e(O,f);return this._rampGradients.push(y),this._syncRampGradientTexture(),this}removeRampGradient(O){return this._removeGradientAndTexture(O,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(O,f,y){this._colorGradients||(this._colorGradients=[]);const S=new P(O,f,y);return this._colorGradients.push(S),this._colorGradients.sort(((O,f)=>O.gradient<f.gradient?-1:O.gradient>f.gradient?1:0)),this}removeColorGradient(O){if(!this._colorGradients)return this;let f=0;for(const y of this._colorGradients){if(y.gradient===O){this._colorGradients.splice(f,1);break}f++}return this}resetDrawCache(){for(const O of this._drawWrappers)if(O)for(const f of O)null===f||void 0===f||f.dispose();this._drawWrappers=[]}_fetchR(O,f,y,S,H){return H[4*(((O=.5*Math.abs(O)+.5)*y%y|0)+((f=.5*Math.abs(f)+.5)*S%S|0)*y)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const O=this._engine,f=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*f),this._vertexBuffer=new L.d(O,this._vertexData,!0,f);let y=0;const S=this._vertexBuffer.createVertexBuffer(L.f.PositionKind,y,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[L.f.PositionKind]=S,y+=3;const H=this._vertexBuffer.createVertexBuffer(L.f.ColorKind,y,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[L.f.ColorKind]=H,y+=4;const b=this._vertexBuffer.createVertexBuffer("angle",y,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=b,y+=1;const h=this._vertexBuffer.createVertexBuffer("size",y,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=h,y+=2,this._isAnimationSheetEnabled){const O=this._vertexBuffer.createVertexBuffer("cellIndex",y,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=O,y+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const O=this._vertexBuffer.createVertexBuffer("direction",y,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=O,y+=3}if(this._useRampGradients){const O=this._vertexBuffer.createVertexBuffer("remapData",y,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=O,y+=4}let v;if(this._useInstancing){const f=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new L.d(O,f,!1,2),v=this._spriteBuffer.createVertexBuffer("offset",0,2)}else v=this._vertexBuffer.createVertexBuffer("offset",y,2,this._vertexBufferSize,this._useInstancing),y+=2;this._vertexBuffers.offset=v,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const O=[],f=[];let y=0;for(let S=0;S<this._capacity;S++)O.push(y),O.push(y+1),O.push(y+2),O.push(y),O.push(y+2),O.push(y+3),f.push(y,y+1,y+1,y+2,y+2,y+3,y+3,y,y,y+3),y+=4;this._indexBuffer=this._engine.createIndexBuffer(O),this._linesIndexBuffer=this._engine.createIndexBuffer(f)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(O)setTimeout((()=>{this.start(0)}),O);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var f;-1!==(null===(f=this.j)||void 0===f?void 0:f.getClassName().indexOf("Mesh"))&&this.j.Mj(!0);const O=this.noiseTexture;if(O&&O.onGeneratedObservable)O.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let f=0;f<this.preWarmCycles;f++)this.animate(!0),O.render()}))}));else for(let f=0;f<this.preWarmCycles;f++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}}stop(){let O=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(O))}_postStop(O){}reset(){this._stockParticles.length=0,this.qj.length=0}_appendParticleVertex(O,f,y,H){let b=O*this._vertexBufferSize;if(this._vertexData[b++]=f.position.x+this.Of.x,this._vertexData[b++]=f.position.y+this.Of.y,this._vertexData[b++]=f.position.z+this.Of.z,this._vertexData[b++]=f.color.r,this._vertexData[b++]=f.color.g,this._vertexData[b++]=f.color.b,this._vertexData[b++]=f.color.a,this._vertexData[b++]=f.angle,this._vertexData[b++]=f.scale.x*f.size,this._vertexData[b++]=f.scale.y*f.size,this._isAnimationSheetEnabled&&(this._vertexData[b++]=f.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[b++]=f.direction.x,this._vertexData[b++]=f.direction.y,this._vertexData[b++]=f.direction.z);else if(f._initialDirection){let O=f._initialDirection;this.isLocal&&(S.m.TransformNormalToRef(O,this._emitterWorldMatrix,S.g.fb[0]),O=S.g.fb[0]),0===O.x&&0===O.z&&(O.x=.001),this._vertexData[b++]=O.x,this._vertexData[b++]=O.y,this._vertexData[b++]=O.z}else{let O=f.direction;this.isLocal&&(S.m.TransformNormalToRef(O,this._emitterWorldMatrix,S.g.fb[0]),O=S.g.fb[0]),0===O.x&&0===O.z&&(O.x=.001),this._vertexData[b++]=O.x,this._vertexData[b++]=O.y,this._vertexData[b++]=O.z}this._useRampGradients&&f.remapData&&(this._vertexData[b++]=f.remapData.x,this._vertexData[b++]=f.remapData.y,this._vertexData[b++]=f.remapData.z,this._vertexData[b++]=f.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===y?y=this._epsilon:1===y&&(y=1-this._epsilon),0===H?H=this._epsilon:1===H&&(H=1-this._epsilon)),this._vertexData[b++]=y,this._vertexData[b++]=H)}_prepareParticle(O){}_update(O){if(this._alive=this.qj.length>0,this.j.position){const O=this.j;this._emitterWorldMatrix=O.getWorldMatrix()}else{const O=this.j;this._emitterWorldMatrix=S.b.Translation(O.x,O.y,O.z)}let f;this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.qj);for(let y=0;y<O&&this.qj.length!==this._capacity;y++){if(f=this._createParticle(),this.qj.push(f),this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0){const O=(0,m.c)(this._actualFrame/this.targetStopDuration);T.GetCurrentGradient(O,this._lifeTimeGradients,((y,S)=>{const H=y,b=S,h=H.getFactor(),v=b.getFactor(),N=(O-H.gradient)/(b.gradient-H.gradient);f.lifeTime=(0,m.o)(h,v,N)}))}else f.lifeTime=(0,m.s)(this.minLifeTime,this.maxLifeTime);const O=(0,m.s)(this.minEmitPower,this.maxEmitPower);if(this.startPositionFunction?this.startPositionFunction(this._emitterWorldMatrix,f.position,f,this.isLocal):this.particleEmitterType.startPositionFunction(this._emitterWorldMatrix,f.position,f,this.isLocal),this.isLocal&&(f.Td?f.Td.p(f.position):f.Td=f.position.clone(),S.m.TransformCoordinatesToRef(f.Td,this._emitterWorldMatrix,f.position)),this.startDirectionFunction?this.startDirectionFunction(this._emitterWorldMatrix,f.direction,f,this.isLocal):this.particleEmitterType.startDirectionFunction(this._emitterWorldMatrix,f.direction,f,this.isLocal,this._emitterInverseWorldMatrix),0===O?f._initialDirection?f._initialDirection.p(f.direction):f._initialDirection=f.direction.clone():f._initialDirection=null,f.direction.scaleInPlace(O),this._sizeGradients&&0!==this._sizeGradients.length?(f._currentSizeGradient=this._sizeGradients[0],f._currentSize1=f._currentSizeGradient.getFactor(),f.size=f._currentSize1,this._sizeGradients.length>1?f._currentSize2=this._sizeGradients[1].getFactor():f._currentSize2=f._currentSize1):f.size=(0,m.s)(this.minSize,this.maxSize),f.scale.Xd((0,m.s)(this.minScaleX,this.maxScaleX),(0,m.s)(this.minScaleY,this.maxScaleY)),this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration){const O=this._actualFrame/this.targetStopDuration;T.GetCurrentGradient(O,this._startSizeGradients,((O,y,S)=>{O!==this._currentStartSizeGradient&&(this._currentStartSize1=this._currentStartSize2,this._currentStartSize2=y.getFactor(),this._currentStartSizeGradient=O);const H=(0,m.o)(this._currentStartSize1,this._currentStartSize2,S);f.scale.scaleInPlace(H)}))}if(this._angularSpeedGradients&&0!==this._angularSpeedGradients.length?(f._currentAngularSpeedGradient=this._angularSpeedGradients[0],f.angularSpeed=f._currentAngularSpeedGradient.getFactor(),f._currentAngularSpeed1=f.angularSpeed,this._angularSpeedGradients.length>1?f._currentAngularSpeed2=this._angularSpeedGradients[1].getFactor():f._currentAngularSpeed2=f._currentAngularSpeed1):f.angularSpeed=(0,m.s)(this.minAngularSpeed,this.maxAngularSpeed),f.angle=(0,m.s)(this.minInitialRotation,this.maxInitialRotation),this._velocityGradients&&this._velocityGradients.length>0&&(f._currentVelocityGradient=this._velocityGradients[0],f._currentVelocity1=f._currentVelocityGradient.getFactor(),this._velocityGradients.length>1?f._currentVelocity2=this._velocityGradients[1].getFactor():f._currentVelocity2=f._currentVelocity1),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&(f._currentLimitVelocityGradient=this._limitVelocityGradients[0],f._currentLimitVelocity1=f._currentLimitVelocityGradient.getFactor(),this._limitVelocityGradients.length>1?f._currentLimitVelocity2=this._limitVelocityGradients[1].getFactor():f._currentLimitVelocity2=f._currentLimitVelocity1),this._dragGradients&&this._dragGradients.length>0&&(f._currentDragGradient=this._dragGradients[0],f._currentDrag1=f._currentDragGradient.getFactor(),this._dragGradients.length>1?f._currentDrag2=this._dragGradients[1].getFactor():f._currentDrag2=f._currentDrag1),this._colorGradients&&0!==this._colorGradients.length)f._currentColorGradient=this._colorGradients[0],f._currentColorGradient.getColorToRef(f.color),f._currentColor1.p(f.color),this._colorGradients.length>1?this._colorGradients[1].getColorToRef(f._currentColor2):f._currentColor2.p(f.color);else{const O=(0,m.s)(0,1);h.g.LerpToRef(this.color1,this.color2,O,f.color),this.colorDead.subtractToRef(f.color,this._colorDiff),this._colorDiff.scaleToRef(1/f.lifeTime,f.colorStep)}this._isAnimationSheetEnabled&&(f._initialStartSpriteCellID=this.startSpriteCellID,f._initialEndSpriteCellID=this.endSpriteCellID,f._initialSpriteCellLoop=this.spriteCellLoop),f.direction.addInPlace(this._inheritedVelocityOffset),this._useRampGradients&&(f.remapData=new S.q(0,1,0,1)),this.noiseTexture&&(f._randomNoiseCoordinates1?(f._randomNoiseCoordinates1.Xd(Math.random(),Math.random(),Math.random()),f._randomNoiseCoordinates2.Xd(Math.random(),Math.random(),Math.random())):(f._randomNoiseCoordinates1=new S.m(Math.random(),Math.random(),Math.random()),f._randomNoiseCoordinates2=new S.m(Math.random(),Math.random(),Math.random()))),f._inheritParticleInfoToSubEmitters()}}static _GetAttributeNamesOrOptions(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S=[L.f.PositionKind,L.f.ColorKind,"angle","offset","size"];return O&&S.push("cellIndex"),f||S.push("direction"),y&&S.push("remapData"),S}static _GetEffectCreationOptions(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,fO.b)(S),O&&S.push("particlesInfos"),f&&S.push("logarithmicDepthConstant"),y&&(S.push("vFogInfos"),S.push("vFogColor")),S}fillDefines(O,f){let y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,fO.l)(this,this._scene,O),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&O.push("#define FOG")),this._isAnimationSheetEnabled&&O.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&O.push("#define LOGARITHMICDEPTH"),f===N.BLENDMODE_MULTIPLY&&O.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&O.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(O.push("#define BILLBOARD"),this.billboardMode){case 2:O.push("#define BILLBOARDY");break;case 8:case 9:O.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&O.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:O.push("#define BILLBOARDMODE_ALL")}y&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),O.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(O,f,y){f.push(...HO._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),O.push(...HO._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),y.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,SO.g)(O,this._imageProcessingConfigurationDefines),(0,SO.d)(y,this._imageProcessingConfigurationDefines))}_getWrapper(O){const f=this._getCustomDrawWrapper(O);if(null!==f&&void 0!==f&&f.effect)return f;const y=[];this.fillDefines(y,O);const S=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let H=this._drawWrappers[S];H||(H=this._drawWrappers[S]=[]);let b=H[O];b||(b=new OO.b(this._engine),b.drawContext&&(b.drawContext.useInstancing=this._useInstancing),H[O]=b);const h=y.join("\n");if(b.defines!==h){const O=[],f=[],y=[];this.fillUniformsAttributesAndSamplerNames(f,O,y),b.setEffect(this._engine.createEffect("particles",O,f,y,h,void 0,void 0,void 0,void 0,this._shaderLanguage),h)}return b}animate(){var O;let f,y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started){if(!y&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(y?this.preWarmStepOffset:(null===(O=this._scene)||void 0===O?void 0:O.getAnimationRatio())||1),this.manualEmitCount>-1)f=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let O=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const f=this._actualFrame/this.targetStopDuration;T.GetCurrentGradient(f,this._emitRateGradients,((f,y,S)=>{f!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=y.getFactor(),this._currentEmitRateGradient=f),O=(0,m.o)(this._currentEmitRate1,this._currentEmitRate2,S)}))}f=O*this._scaledUpdateSpeed|0,this._newPartsExcess+=O*this._scaledUpdateSpeed-f}if(this._newPartsExcess>1&&(f+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?f=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(f),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!y){let O=0;for(let f=0;f<this.qj.length;f++){const y=this.qj[f];this._appendParticleVertices(O,y),O+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.qj.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(O,f){this._appendParticleVertex(O++,f,0,0),this._useInstancing||(this._appendParticleVertex(O++,f,1,0),this._appendParticleVertex(O++,f,1,1),this._appendParticleVertex(O++,f,0,1))}rebuild(){var O;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(O=this._spriteBuffer)||void 0===O||O._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!HO.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(y.bind(y,11997)),Promise.resolve().then(y.bind(y,11942))])):await Promise.all([Promise.resolve().then(y.bind(y,11931)),Promise.resolve().then(y.bind(y,11919))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==N.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(N.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(N.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(O){const f=this._getWrapper(O),y=f.effect,H=this._engine;H.enableEffect(f);const b=this.defaultViewMatrix??this._scene.getViewMatrix();if(y.setTexture("diffuseSampler",this.particleTexture),y.setMatrix("view",b),y.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const O=this.particleTexture.getBaseSize();y.setFloat3("particlesInfos",this.spriteCellWidth/O.width,this.spriteCellHeight/O.height,this.spriteCellWidth/O.width)}if(y.setVector2("translationPivot",this.translationPivot),y.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const O=this._scene.activeCamera;y.setVector3("eyePosition",O.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),y.setTexture("rampSampler",this._rampGradientsTexture));const h=y.defines;var v,m,t,q,F,I;(this._scene&&((0,fO.f)(y,this,this._scene),this.applyFog&&(0,yO.e)(this._scene,void 0,y)),h.indexOf("#define BILLBOARDMODE_ALL")>=0&&(b.invertToRef(S.g.Matrix[0]),y.setMatrix("invView",S.g.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(v=this._scene)&&void 0!==v&&v.forceWireframe?H.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,y):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,y)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(m=this._scene)&&void 0!==m&&m.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?H.bindBuffers(this._vertexBuffers,null!==(t=this._scene)&&void 0!==t&&t.forceWireframe?this._linesIndexBuffer:this._indexBuffer,y):H.bindBuffers(this._vertexBuffers,null!==(q=this._scene)&&void 0!==q&&q.forceWireframe?this._linesIndexBufferUseInstancing:null,y);switch(this.useLogarithmicDepth&&this._scene&&(0,yO.j)(h,y,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(y),O){case N.BLENDMODE_ADD:H.setAlphaMode(1);break;case N.BLENDMODE_ONEONE:H.setAlphaMode(6);break;case N.BLENDMODE_STANDARD:H.setAlphaMode(2);break;case N.BLENDMODE_MULTIPLY:H.setAlphaMode(4)}(this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(y),this._useInstancing)?null!==(F=this._scene)&&void 0!==F&&F.forceWireframe?H.drawElementsType(6,0,10,this.qj.length):H.drawArraysType(7,0,4,this.qj.length):null!==(I=this._scene)&&void 0!==I&&I.forceWireframe?H.drawElementsType(1,0,10*this.qj.length):H.drawElementsType(0,0,6*this.qj.length);return this.qj.length}render(){if(!this.isReady()||!this.qj.length)return 0;const O=this._engine;O.setState&&(O.setState(!1),this.forceDepthWrite&&O.setDepthWrite(!0));let f=0;return f=this.blendMode===N.BLENDMODE_MULTIPLYADD?this._render(N.BLENDMODE_MULTIPLY)+this._render(N.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),f}_onDispose(){}dispose(){let O=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),O&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),O&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(f,y),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const O=this._scene.oj.indexOf(this);O>-1&&this._scene.oj.splice(O,1),this._scene._activeParticleSystems.dispose()}this.hj.notifyObservers(this),this.hj.clear(),this.onStoppedObservable.clear(),this.reset()}}HO.ForceGLSL=!1;var bO,hO=y(11030);!function(O){O[O.ATTACHED=0]="ATTACHED",O[O.END=1]="END"}(bO||(bO={}));class vO{constructor(O){if(this.particleSystem=O,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!O.j||!O.j.dispose){const f=(0,v.c)("BABYLON.AbstractMesh");O.j=new f("SubemitterSystemEmitter",O.va()),O._disposeEmitterOnDispose=!0}}clone(){let O=this.particleSystem.j;if(O){if(O instanceof S.m)O=O.clone();else if(-1!==O.getClassName().indexOf("Mesh")){O=new((0,v.c)("BABYLON.Mesh"))("",O.va()),O.isVisible=!1}}else O=new S.m;const f=new vO(this.particleSystem.clone(this.particleSystem.name,O));return f.particleSystem.name+="Clone",f.type=this.type,f.inheritDirection=this.inheritDirection,f.inheritedVelocityAmount=this.inheritedVelocityAmount,f.particleSystem._disposeEmitterOnDispose=!0,f.particleSystem.disposeOnStop=!0,f}serialize(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const f={};return f.type=this.type,f.inheritDirection=this.inheritDirection,f.inheritedVelocityAmount=this.inheritedVelocityAmount,f.particleSystem=this.particleSystem.serialize(O),f}static _ParseParticleSystem(O,f,y){throw(0,hO.d)("ParseParticle")}static Parse(O,f,y){const S=O.particleSystem,H=new vO(vO._ParseParticleSystem(S,f,y,!0));return H.type=O.type,H.inheritDirection=O.inheritDirection,H.inheritedVelocityAmount=O.inheritedVelocityAmount,H.particleSystem._isSubEmitter=!0,H}dispose(){this.particleSystem.dispose()}}var NO=y(11092);function mO(O,f){const y=new w;return y.direction1=O,y.direction2=f,y}function tO(){return new X(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function qO(){return new B(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function FO(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S.m(0,1,0),y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.m(0,1,0);return new j(O,f,y)}function IO(){return new A(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function AO(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.m(0,1,0),b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new S.m(0,1,0);return new J(O,f,y,H,b)}function JO(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new F(O,f)}function XO(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.m(0,1,0),H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.m(0,1,0);return new I(O,f,y,H)}class wO extends HO{constructor(){super(...arguments),this._disposeEmitterOnDispose=!1,this._emitFromParticle=O=>{if(!this._subEmitters||0===this._subEmitters.length)return;const f=Math.floor(Math.random()*this._subEmitters.length);this._subEmitters[f].forEach((f=>{if(1===f.type){const y=f.clone();O._inheritParticleInfoToSubEmitter(y),y.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(y.particleSystem),y.particleSystem.start()}}))}}createPointEmitter(O,f){const y=mO(O,f);return this.particleEmitterType=y,y}createHemisphericEmitter(){const O=tO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=O,O}createSphereEmitter(){const O=qO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=O,O}createDirectedSphereEmitter(){const O=FO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S.m(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.m(0,1,0));return this.particleEmitterType=O,O}createCylinderEmitter(){const O=IO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=O,O}createDirectedCylinderEmitter(){const O=AO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.m(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new S.m(0,1,0));return this.particleEmitterType=O,O}createConeEmitter(){const O=JO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=O,O}createDirectedConeEmitter(){const O=XO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.m(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.m(0,1,0));return this.particleEmitterType=O,O}createBoxEmitter(O,f,y,S){const H=new q;return this.particleEmitterType=H,this.direction1=O,this.direction2=f,this.minEmitBox=y,this.maxEmitBox=S,H}_prepareSubEmitterInternalArray(){this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach((O=>{O instanceof wO?this._subEmitters.push([new vO(O)]):O instanceof vO?this._subEmitters.push([O]):O instanceof Array&&this._subEmitters.push(O)}))}_stopSubEmitters(){this.activeSubSystems&&(this.activeSubSystems.forEach((O=>{O.stop(!0)})),this.activeSubSystems=[])}_removeFromRoot(){if(!this._rootParticleSystem)return;const O=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==O&&this._rootParticleSystem.activeSubSystems.splice(O,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(O){O&&this._stopSubEmitters()}_prepareParticle(O){if(this._subEmitters&&this._subEmitters.length>0){const f=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];O._attachedSubEmitters=[],f.forEach((f=>{if(0===f.type){const y=f.clone();O._attachedSubEmitters.push(y),y.particleSystem.start()}}))}}_onDispose(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var y;(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),O)&&(null===(y=this.particles)||void 0===y||y.forEach((O=>{if(O._attachedSubEmitters)for(let f=O._attachedSubEmitters.length-1;f>=0;f-=1)O._attachedSubEmitters[f].dispose()})));if(f&&this.activeSubSystems)for(let S=this.activeSubSystems.length-1;S>=0;S-=1)this.activeSubSystems[S].dispose();if(this._subEmitters&&this._subEmitters.length){for(let O=0;O<this._subEmitters.length;O++)for(const f of this._subEmitters[O])f.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.j&&this.j.dispose&&this.j.dispose(!0)}static _Parse(O,f,y,H){let b;b=y instanceof NO.c?null:y;const N=(0,v.c)("BABYLON.Texture");if(N&&b&&(O.texture?f.particleTexture=N.Parse(O.texture,b,H):O.textureName&&(f.particleTexture=new N(H+O.textureName,b,!1,void 0===O.invertY||O.invertY),f.particleTexture.name=O.textureName)),O.emitterId||0===O.emitterId||void 0!==O.j?O.emitterId&&b?f.j=b.getLastMeshById(O.emitterId):f.j=S.m.Ng(O.j):f.j=S.m.Zero(),f.isLocal=!!O.isLocal,void 0!==O.renderingGroupId&&(f.renderingGroupId=O.renderingGroupId),void 0!==O.isBillboardBased&&(f.isBillboardBased=O.isBillboardBased),void 0!==O.billboardMode&&(f.billboardMode=O.billboardMode),void 0!==O.useLogarithmicDepth&&(f.useLogarithmicDepth=O.useLogarithmicDepth),O.animations){for(let y=0;y<O.animations.length;y++){const S=O.animations[y],H=(0,v.c)("BABYLON.Animation");H&&f.animations.push(H.Parse(S))}f.beginAnimationOnStart=O.beginAnimationOnStart,f.beginAnimationFrom=O.beginAnimationFrom,f.beginAnimationTo=O.beginAnimationTo,f.beginAnimationLoop=O.beginAnimationLoop}if(O.autoAnimate&&b&&b.beginAnimation(f,O.autoAnimateFrom,O.autoAnimateTo,O.autoAnimateLoop,O.autoAnimateSpeed||1),f.startDelay=0|O.startDelay,f.minAngularSpeed=O.minAngularSpeed,f.maxAngularSpeed=O.maxAngularSpeed,f.minSize=O.minSize,f.maxSize=O.maxSize,O.minScaleX&&(f.minScaleX=O.minScaleX,f.maxScaleX=O.maxScaleX,f.minScaleY=O.minScaleY,f.maxScaleY=O.maxScaleY),void 0!==O.preWarmCycles&&(f.preWarmCycles=O.preWarmCycles,f.preWarmStepOffset=O.preWarmStepOffset),void 0!==O.minInitialRotation&&(f.minInitialRotation=O.minInitialRotation,f.maxInitialRotation=O.maxInitialRotation),f.minLifeTime=O.minLifeTime,f.maxLifeTime=O.maxLifeTime,f.minEmitPower=O.minEmitPower,f.maxEmitPower=O.maxEmitPower,f.emitRate=O.emitRate,f.gravity=S.m.Ng(O.gravity),O.noiseStrength&&(f.noiseStrength=S.m.Ng(O.noiseStrength)),f.color1=h.g.Ng(O.color1),f.color2=h.g.Ng(O.color2),f.colorDead=h.g.Ng(O.colorDead),f.updateSpeed=O.updateSpeed,f.targetStopDuration=O.targetStopDuration,f.blendMode=O.blendMode,O.colorGradients)for(const S of O.colorGradients)f.addColorGradient(S.gradient,h.g.Ng(S.color1),S.color2?h.g.Ng(S.color2):void 0);if(O.rampGradients){for(const y of O.rampGradients)f.addRampGradient(y.gradient,h.d.Ng(y.color));f.useRampGradients=O.useRampGradients}if(O.colorRemapGradients)for(const S of O.colorRemapGradients)f.addColorRemapGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(O.alphaRemapGradients)for(const S of O.alphaRemapGradients)f.addAlphaRemapGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(O.sizeGradients)for(const S of O.sizeGradients)f.addSizeGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(O.angularSpeedGradients)for(const S of O.angularSpeedGradients)f.addAngularSpeedGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(O.velocityGradients)for(const S of O.velocityGradients)f.addVelocityGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(O.dragGradients)for(const S of O.dragGradients)f.addDragGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(O.emitRateGradients)for(const S of O.emitRateGradients)f.addEmitRateGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(O.startSizeGradients)for(const S of O.startSizeGradients)f.addStartSizeGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(O.lifeTimeGradients)for(const S of O.lifeTimeGradients)f.addLifeTimeGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(O.limitVelocityGradients){for(const y of O.limitVelocityGradients)f.addLimitVelocityGradient(y.gradient,void 0!==y.factor1?y.factor1:y.factor,y.factor2);f.limitVelocityDamping=O.limitVelocityDamping}if(O.noiseTexture&&b){const y=(0,v.c)("BABYLON.ProceduralTexture");f.noiseTexture=y.Parse(O.noiseTexture,b,H)}let m;if(O.particleEmitterType){switch(O.particleEmitterType.type){case"SphereParticleEmitter":m=new B;break;case"SphereDirectedParticleEmitter":m=new j;break;case"ConeEmitter":case"ConeParticleEmitter":m=new F;break;case"ConeDirectedParticleEmitter":m=new I;break;case"CylinderParticleEmitter":m=new A;break;case"CylinderDirectedParticleEmitter":m=new J;break;case"HemisphericParticleEmitter":m=new X;break;case"PointParticleEmitter":m=new w;break;case"MeshParticleEmitter":m=new p;break;case"CustomParticleEmitter":m=new u;break;default:m=new q}m.parse(O.particleEmitterType,b)}else m=new q,m.parse(O,b);f.particleEmitterType=m,f.startSpriteCellID=O.startSpriteCellID,f.endSpriteCellID=O.endSpriteCellID,f.spriteCellLoop=O.spriteCellLoop??!0,f.spriteCellWidth=O.spriteCellWidth,f.spriteCellHeight=O.spriteCellHeight,f.spriteCellChangeSpeed=O.spriteCellChangeSpeed,f.spriteRandomStartCell=O.spriteRandomStartCell,f.disposeOnStop=O.disposeOnStop??!1,f.manualEmitCount=O.manualEmitCount??-1}static Parse(O,f,y){let H=arguments.length>3&&void 0!==arguments[3]&&arguments[3],b=arguments.length>4?arguments[4]:void 0;const v=O.name;let N,m,t=null,q=null;if(f instanceof NO.c?N=f:(m=f,N=m.getEngine()),O.customShader&&N.createEffectForParticles){q=O.customShader;const f=q.shaderOptions.defines.length>0?q.shaderOptions.defines.join("\n"):"";t=N.createEffectForParticles(q.shaderPath.fragmentElement,q.shaderOptions.uniforms,q.shaderOptions.samplers,f)}const F=new wO(v,b||O.kb,f,t,O.isAnimationSheetEnabled);if(F.customShader=q,F._rootUrl=y,O.id&&(F.id=O.id),O.subEmitters){F.subEmitters=[];for(const S of O.subEmitters){const O=[];for(const H of S)O.push(vO.Parse(H,f,y));F.subEmitters.push(O)}}return wO._Parse(O,F,f,y),O.textureMask&&(F.textureMask=h.g.Ng(O.textureMask)),O.Of&&(F.Of=S.m.Ng(O.Of)),O.preventAutoStart&&(F.preventAutoStart=O.preventAutoStart),H||F.preventAutoStart||F.start(),F}serialize(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const f={};if(wO._Serialize(f,this,O),f.textureMask=this.textureMask.gj(),f.customShader=this.customShader,f.preventAutoStart=this.preventAutoStart,f.Of=this.Of.gj(),this.subEmitters){f.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const y of this._subEmitters){const S=[];for(const f of y)S.push(f.serialize(O));f.subEmitters.push(S)}}return f}static _Serialize(O,f,y){if(O.name=f.name,O.id=f.id,O.kb=f.getCapacity(),O.disposeOnStop=f.disposeOnStop,O.manualEmitCount=f.manualEmitCount,f.j.position){const y=f.j;O.emitterId=y.id}else{const y=f.j;O.j=y.gj()}f.particleEmitterType&&(O.particleEmitterType=f.particleEmitterType.serialize()),f.particleTexture&&(y?O.texture=f.particleTexture.serialize():(O.textureName=f.particleTexture.name,O.invertY=!!f.particleTexture._invertY)),O.isLocal=f.isLocal,R.b.AppendSerializedAnimations(f,O),O.beginAnimationOnStart=f.beginAnimationOnStart,O.beginAnimationFrom=f.beginAnimationFrom,O.beginAnimationTo=f.beginAnimationTo,O.beginAnimationLoop=f.beginAnimationLoop,O.startDelay=f.startDelay,O.renderingGroupId=f.renderingGroupId,O.isBillboardBased=f.isBillboardBased,O.billboardMode=f.billboardMode,O.minAngularSpeed=f.minAngularSpeed,O.maxAngularSpeed=f.maxAngularSpeed,O.minSize=f.minSize,O.maxSize=f.maxSize,O.minScaleX=f.minScaleX,O.maxScaleX=f.maxScaleX,O.minScaleY=f.minScaleY,O.maxScaleY=f.maxScaleY,O.minEmitPower=f.minEmitPower,O.maxEmitPower=f.maxEmitPower,O.minLifeTime=f.minLifeTime,O.maxLifeTime=f.maxLifeTime,O.emitRate=f.emitRate,O.gravity=f.gravity.gj(),O.noiseStrength=f.noiseStrength.gj(),O.color1=f.color1.gj(),O.color2=f.color2.gj(),O.colorDead=f.colorDead.gj(),O.updateSpeed=f.updateSpeed,O.targetStopDuration=f.targetStopDuration,O.blendMode=f.blendMode,O.preWarmCycles=f.preWarmCycles,O.preWarmStepOffset=f.preWarmStepOffset,O.minInitialRotation=f.minInitialRotation,O.maxInitialRotation=f.maxInitialRotation,O.startSpriteCellID=f.startSpriteCellID,O.spriteCellLoop=f.spriteCellLoop,O.endSpriteCellID=f.endSpriteCellID,O.spriteCellChangeSpeed=f.spriteCellChangeSpeed,O.spriteCellWidth=f.spriteCellWidth,O.spriteCellHeight=f.spriteCellHeight,O.spriteRandomStartCell=f.spriteRandomStartCell,O.isAnimationSheetEnabled=f.isAnimationSheetEnabled,O.useLogarithmicDepth=f.useLogarithmicDepth;const S=f.getColorGradients();if(S){O.colorGradients=[];for(const f of S){const y={gradient:f.gradient,color1:f.color1.gj()};f.color2?y.color2=f.color2.gj():y.color2=f.color1.gj(),O.colorGradients.push(y)}}const H=f.getRampGradients();if(H){O.rampGradients=[];for(const f of H){const y={gradient:f.gradient,color:f.color.gj()};O.rampGradients.push(y)}O.useRampGradients=f.useRampGradients}const b=f.getColorRemapGradients();if(b){O.colorRemapGradients=[];for(const f of b){const y={gradient:f.gradient,factor1:f.factor1};void 0!==f.factor2?y.factor2=f.factor2:y.factor2=f.factor1,O.colorRemapGradients.push(y)}}const h=f.getAlphaRemapGradients();if(h){O.alphaRemapGradients=[];for(const f of h){const y={gradient:f.gradient,factor1:f.factor1};void 0!==f.factor2?y.factor2=f.factor2:y.factor2=f.factor1,O.alphaRemapGradients.push(y)}}const v=f.getSizeGradients();if(v){O.sizeGradients=[];for(const f of v){const y={gradient:f.gradient,factor1:f.factor1};void 0!==f.factor2?y.factor2=f.factor2:y.factor2=f.factor1,O.sizeGradients.push(y)}}const N=f.getAngularSpeedGradients();if(N){O.angularSpeedGradients=[];for(const f of N){const y={gradient:f.gradient,factor1:f.factor1};void 0!==f.factor2?y.factor2=f.factor2:y.factor2=f.factor1,O.angularSpeedGradients.push(y)}}const m=f.getVelocityGradients();if(m){O.velocityGradients=[];for(const f of m){const y={gradient:f.gradient,factor1:f.factor1};void 0!==f.factor2?y.factor2=f.factor2:y.factor2=f.factor1,O.velocityGradients.push(y)}}const t=f.getDragGradients();if(t){O.dragGradients=[];for(const f of t){const y={gradient:f.gradient,factor1:f.factor1};void 0!==f.factor2?y.factor2=f.factor2:y.factor2=f.factor1,O.dragGradients.push(y)}}const q=f.getEmitRateGradients();if(q){O.emitRateGradients=[];for(const f of q){const y={gradient:f.gradient,factor1:f.factor1};void 0!==f.factor2?y.factor2=f.factor2:y.factor2=f.factor1,O.emitRateGradients.push(y)}}const F=f.getStartSizeGradients();if(F){O.startSizeGradients=[];for(const f of F){const y={gradient:f.gradient,factor1:f.factor1};void 0!==f.factor2?y.factor2=f.factor2:y.factor2=f.factor1,O.startSizeGradients.push(y)}}const I=f.getLifeTimeGradients();if(I){O.lifeTimeGradients=[];for(const f of I){const y={gradient:f.gradient,factor1:f.factor1};void 0!==f.factor2?y.factor2=f.factor2:y.factor2=f.factor1,O.lifeTimeGradients.push(y)}}const A=f.getLimitVelocityGradients();if(A){O.limitVelocityGradients=[];for(const f of A){const y={gradient:f.gradient,factor1:f.factor1};void 0!==f.factor2?y.factor2=f.factor2:y.factor2=f.factor1,O.limitVelocityGradients.push(y)}O.limitVelocityDamping=f.limitVelocityDamping}f.noiseTexture&&(O.noiseTexture=f.noiseTexture.serialize())}clone(O,f){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S={...this._customWrappers};let H=null;const b=this._engine;if(b.createEffectForParticles&&null!=this.customShader){H=this.customShader;const O=H.shaderOptions.defines.length>0?H.shaderOptions.defines.join("\n"):"",f=b.createEffectForParticles(H.shaderPath.fragmentElement,H.shaderOptions.uniforms,H.shaderOptions.samplers,O);S[0]?S[0].effect=f:this.setCustomEffect(f,0)}const h=this.serialize(y),v=wO.Parse(h,this._scene||this._engine,this._rootUrl);return v.name=O,v.customShader=H,v._customWrappers=S,void 0===f&&(f=this.j),this.noiseTexture&&(v.noiseTexture=this.noiseTexture.clone()),v.j=f,this.preventAutoStart||v.start(),v}}wO.BILLBOARDMODE_Y=2,wO.BILLBOARDMODE_ALL=7,wO.BILLBOARDMODE_STRETCHED=8,wO.BILLBOARDMODE_STRETCHED_LOCAL=9,vO._ParseParticleSystem=wO.Parse;var BO=y(11352),jO=y(11311),uO=y(11754);uO.d.prototype.createTransformFeedback=function(){const O=this._gl.createTransformFeedback();if(!O)throw new Error("Unable to create Transform Feedback");return O},uO.d.prototype.deleteTransformFeedback=function(O){this._gl.deleteTransformFeedback(O)},uO.d.prototype.bindTransformFeedback=function(O){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,O)},uO.d.prototype.beginTransformFeedback=function(){let O=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(O?this._gl.POINTS:this._gl.TRIANGLES)},uO.d.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},uO.d.prototype.setTranformFeedbackVaryings=function(O,f){this._gl.transformFeedbackVaryings(O,f,this._gl.INTERLEAVED_ATTRIBS)},uO.d.prototype.bindTransformFeedbackBuffer=function(O){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,O?O.underlyingResource:null)},uO.d.prototype.readTransformFeedbackBuffer=function(O){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,O)};const LO="clipPlaneFragmentDeclaration2",pO="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";x.c.IncludesShadersStore[LO]=pO;y(11840),y(11848),y(11853),y(11859),y(11862),y(11868),y(11875),y(11877);const UO="gpuRenderParticlesPixelShader",lO="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";x.c.ShadersStore[UO]=lO;const xO="clipPlaneVertexDeclaration2",WO="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";x.c.IncludesShadersStore[xO]=WO;y(11886),y(11891),y(11899),y(11904);const EO="gpuRenderParticlesVertexShader",oO="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";x.c.ShadersStore[EO]=oO;class iO extends N{static get IsSupported(){if(!r.c.LastCreatedEngine)return!1;const O=r.c.LastCreatedEngine.getCaps();return O.supportTransformFeedbacks||O.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(O){this._maxActiveParticleCount=Math.min(O,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(O){this.maxActiveParticleCount=O}createPointEmitter(O,f){const y=mO(O,f);return this.particleEmitterType=y,y}createHemisphericEmitter(){const O=tO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=O,O}createSphereEmitter(){const O=qO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=O,O}createDirectedSphereEmitter(){const O=FO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S.m(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.m(0,1,0));return this.particleEmitterType=O,O}createCylinderEmitter(){const O=IO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=O,O}createDirectedCylinderEmitter(){const O=AO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.m(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new S.m(0,1,0));return this.particleEmitterType=O,O}createConeEmitter(){const O=JO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=O,O}createDirectedConeEmitter(){const O=XO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.m(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.m(0,1,0));return this.particleEmitterType=O,O}createBoxEmitter(O,f,y,S){const H=new q;return this.particleEmitterType=H,this.direction1=O,this.direction2=f,this.minEmitBox=y,this.maxEmitBox=S,H}isReady(){if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==wO.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(wO.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(wO.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";O?setTimeout((()=>{this.start(0)}),O):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var O;let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(O=this._customWrappers[f])||void 0===O?void 0:O.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[O]??this._customWrappers[0]}setCustomEffect(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[f]=new OO.b(this._engine),this._customWrappers[f].effect=O}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new Q.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(O,f,y){return super._removeGradientAndTexture(O,f,y),this._releaseBuffers(),this}addColorGradient(O,f){this._colorGradients||(this._colorGradients=[]);const y=new P(O,f);return this._colorGradients.push(y),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(O&&this._colorGradients.sort(((O,f)=>O.gradient<f.gradient?-1:O.gradient>f.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(O){return this._removeGradientAndTexture(O,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const f in this._drawWrappers){var O;null===(O=this._drawWrappers[f].drawContext)||void 0===O||O.reset()}}_addFactorGradient(O,f,y){const S=new K(f,y);O.push(S),this._releaseBuffers()}addSizeGradient(O,f){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,O,f),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(O){return this._removeGradientAndTexture(O,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(O,f){if(!O)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&O.sort(((O,f)=>O.gradient<f.gradient?-1:O.gradient>f.gradient?1:0));const y=this;y[f]&&(y[f].dispose(),y[f]=null)}addAngularSpeedGradient(O,f){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,O,f),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(O){return this._removeGradientAndTexture(O,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(O,f){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,O,f),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(O){return this._removeGradientAndTexture(O,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(O,f){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,O,f),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(O){return this._removeGradientAndTexture(O,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(O,f){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,O,f),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(O){return this._removeGradientAndTexture(O,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(O){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(O,f,y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(O),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.hj=new Q.d,this.onStoppedObservable=new Q.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._onBeforeDrawParticlesObservable=null,y&&"Scene"!==y.getClassName()?(this._engine=y,this.defaultProjectionMatrix=S.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=y||r.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.oj.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,v.c)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,v.c)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,v.c)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,v.c)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new OO.b(this._engine)},this._customWrappers[0].effect=H,this._drawWrappers={0:new OO.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(f=f??{}).randomTextureSize||delete f.randomTextureSize;const h={kb:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...f},N=f;isFinite(N)&&(h.kb=N),this._capacity=h.kb,this._maxActiveParticleCount=h.kb,this._currentActiveCount=0,this._isAnimationSheetEnabled=b,this.particleEmitterType=new q;const m=Math.min(this._engine.getCaps().maxTextureSize,h.randomTextureSize);let t=[];for(let S=0;S<m;++S)t.push(Math.random()),t.push(Math.random()),t.push(Math.random()),t.push(Math.random());this._randomTexture=new C.c(new Float32Array(t),m,1,5,y,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,t=[];for(let S=0;S<m;++S)t.push(Math.random()),t.push(Math.random()),t.push(Math.random()),t.push(Math.random());this._randomTexture2=new C.c(new Float32Array(t),m,1,5,y,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=m}_reset(){this._releaseBuffers()}_createVertexBuffers(O,f,y){const S={};S.position=f.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let H=3;S.age=f.createVertexBuffer("age",H,1,this._attributesStrideSize,!0),H+=1,S.size=f.createVertexBuffer("size",H,3,this._attributesStrideSize,!0),H+=3,S.life=f.createVertexBuffer("life",H,1,this._attributesStrideSize,!0),H+=1,H+=4,this.billboardMode===wO.BILLBOARDMODE_STRETCHED&&(S.direction=f.createVertexBuffer("direction",H,3,this._attributesStrideSize,!0)),H+=3,this._platform.alignDataInBuffer&&(H+=1),this.particleEmitterType instanceof u&&(H+=3,this._platform.alignDataInBuffer&&(H+=1)),this._colorGradientsTexture||(S.color=f.createVertexBuffer("color",H,4,this._attributesStrideSize,!0),H+=4),this._isBillboardBased||(S.initialDirection=f.createVertexBuffer("initialDirection",H,3,this._attributesStrideSize,!0),H+=3,this._platform.alignDataInBuffer&&(H+=1)),this.noiseTexture&&(S.noiseCoordinates1=f.createVertexBuffer("noiseCoordinates1",H,3,this._attributesStrideSize,!0),H+=3,this._platform.alignDataInBuffer&&(H+=1),S.noiseCoordinates2=f.createVertexBuffer("noiseCoordinates2",H,3,this._attributesStrideSize,!0),H+=3,this._platform.alignDataInBuffer&&(H+=1)),S.angle=f.createVertexBuffer("angle",H,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?H++:H+=2,this._isAnimationSheetEnabled&&(S.cellIndex=f.createVertexBuffer("cellIndex",H,1,this._attributesStrideSize,!0),H+=1,this.spriteRandomStartCell&&(S.cellStartOffset=f.createVertexBuffer("cellStartOffset",H,1,this._attributesStrideSize,!0),H+=1)),S.offset=y.createVertexBuffer("offset",0,2),S.uv=y.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(S),this._platform.createVertexBuffers(O,S),this.resetDrawCache()}_initialize(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!O)return;const f=this._engine,y=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof u&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const H=this.particleEmitterType instanceof u,b=S.g.fb[0];let h=0;for(let S=0;S<this._capacity;S++)if(y.push(0),y.push(0),y.push(0),y.push(0),y.push(0),y.push(0),y.push(0),y.push(0),y.push(Math.random()),y.push(Math.random()),y.push(Math.random()),y.push(Math.random()),H?(this.particleEmitterType.particleDestinationGenerator(S,null,b),y.push(b.x),y.push(b.y),y.push(b.z)):(y.push(0),y.push(0),y.push(0)),this._platform.alignDataInBuffer&&y.push(0),h+=16,H&&(this.particleEmitterType.particlePositionGenerator(S,null,b),y.push(b.x),y.push(b.y),y.push(b.z),this._platform.alignDataInBuffer&&y.push(0),h+=4),this._colorGradientsTexture||(y.push(0),y.push(0),y.push(0),y.push(0),h+=4),this.isBillboardBased||(y.push(0),y.push(0),y.push(0),this._platform.alignDataInBuffer&&y.push(0),h+=4),this.noiseTexture&&(y.push(Math.random()),y.push(Math.random()),y.push(Math.random()),this._platform.alignDataInBuffer&&y.push(0),y.push(Math.random()),y.push(Math.random()),y.push(Math.random()),this._platform.alignDataInBuffer&&y.push(0),h+=8),y.push(0),h+=1,this._angularSpeedGradientsTexture||(y.push(0),h+=1),this._isAnimationSheetEnabled&&(y.push(0),h+=1,this.spriteRandomStartCell&&(y.push(0),h+=1)),this._platform.alignDataInBuffer){let O=3-(h+3&3);for(h+=O;O-- >0;)y.push(0)}const v=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),N=this._platform.createParticleBuffer(y),m=this._platform.createParticleBuffer(y);this._buffer0=new L.d(f,N,!1,this._attributesStrideSize),this._buffer1=new L.d(f,m,!1,this._attributesStrideSize),this._spriteBuffer=new L.d(f,v,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let O=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(O+="\n#define BILLBOARD"),this._colorGradientsTexture&&(O+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(O+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(O+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(O+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(O+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(O+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(O+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(O+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(O+="\n#define NOISE"),this.isLocal&&(O+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===O||(this._cachedUpdateDefines=O,this._updateBuffer=this._platform.createUpdateBuffer(O)),this._platform.isUpdateBufferReady()}_getWrapper(O){const f=this._getCustomDrawWrapper(O);if(null!==f&&void 0!==f&&f.effect)return f;const y=[];this.fillDefines(y,O);let S=this._drawWrappers[O];S||(S=new OO.b(this._engine),S.drawContext&&(S.drawContext.useInstancing=!0),this._drawWrappers[O]=S);const H=y.join("\n");if(S.defines!==H){const O=[],f=[],y=[];this.fillUniformsAttributesAndSamplerNames(f,O,y),S.setEffect(this._engine.createEffect("gpuRenderParticles",O,f,y,H),H)}return S}static _GetAttributeNamesOrOptions(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const H=[L.f.PositionKind,"age","life","size","angle"];return O||H.push(L.f.ColorKind),f&&H.push("cellIndex"),y||H.push("initialDirection"),S&&H.push("direction"),H.push("offset",L.f.UVKind),H}static _GetEffectCreationOptions(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S=["emitterWM","Of","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,fO.b)(S),O&&S.push("sheetInfos"),f&&S.push("logarithmicDepthConstant"),y&&(S.push("vFogInfos"),S.push("vFogColor")),S}fillDefines(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,fO.l)(this,this._scene,O),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==jO.c.FOGMODE_NONE&&O.push("#define FOG")),f===wO.BLENDMODE_MULTIPLY&&O.push("#define BLENDMULTIPLYMODE"),this.isLocal&&O.push("#define LOCAL"),this.useLogarithmicDepth&&O.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(O.push("#define BILLBOARD"),this.billboardMode){case wO.BILLBOARDMODE_Y:O.push("#define BILLBOARDY");break;case wO.BILLBOARDMODE_STRETCHED:O.push("#define BILLBOARDSTRETCHED");break;case wO.BILLBOARDMODE_ALL:O.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&O.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&O.push("#define ANIMATESHEET"),y&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),O.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(O,f,y){f.push(...iO._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===wO.BILLBOARDMODE_STRETCHED)),O.push(...iO._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),y.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(BO.c.PrepareUniforms(O,this._imageProcessingConfigurationDefines),BO.c.PrepareSamplers(y,this._imageProcessingConfigurationDefines))}animate(){var O;let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(f?this.preWarmStepOffset:(null===(O=this._scene)||void 0===O?void 0:O.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(O,f){const y=this[f];if(!O||!O.length||y)return;const S=new Float32Array(this._rawTextureWidth);for(let H=0;H<this._rawTextureWidth;H++){const f=H/this._rawTextureWidth;T.GetCurrentGradient(f,O,((O,f,y)=>{S[H]=(0,m.o)(O.factor1,f.factor1,y)}))}this[f]=C.c.CreateRTexture(S,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[f].name=f.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const O=new Uint8Array(4*this._rawTextureWidth),f=h.k.rb[0];for(let y=0;y<this._rawTextureWidth;y++){const S=y/this._rawTextureWidth;T.GetCurrentGradient(S,this._colorGradients,((S,H,b)=>{h.g.LerpToRef(S.color1,H.color1,b,f),O[4*y]=255*f.r,O[4*y+1]=255*f.g,O[4*y+2]=255*f.b,O[4*y+3]=255*f.a}))}this._colorGradientsTexture=C.c.CreateRGBATexture(O,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(O,f){var y,H,b,h;const v=this._getWrapper(O),N=v.effect;this._engine.enableEffect(v);const m=(null===(y=this._scene)||void 0===y?void 0:y.getViewMatrix())||S.b.IdentityReadOnly;if(N.setMatrix("view",m),N.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),N.setTexture("diffuseSampler",this.particleTexture),N.setVector2("translationPivot",this.translationPivot),N.setVector3("Of",this.Of),this.isLocal&&N.setMatrix("emitterWM",f),this._colorGradientsTexture?N.setTexture("colorGradientSampler",this._colorGradientsTexture):N.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const O=this.particleTexture.getBaseSize();N.setFloat3("sheetInfos",this.spriteCellWidth/O.width,this.spriteCellHeight/O.height,O.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const O=this._scene.activeCamera;N.setVector3("eyePosition",O.globalPosition)}const t=N.defines;if(this._scene&&((0,fO.f)(N,this,this._scene),this.applyFog&&(0,yO.e)(this._scene,void 0,N)),t.indexOf("#define BILLBOARDMODE_ALL")>=0){const O=m.clone();O.invert(),N.setMatrix("invView",O)}switch(this.useLogarithmicDepth&&this._scene&&(0,yO.j)(t,N,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(N),O){case wO.BLENDMODE_ADD:this._engine.setAlphaMode(1);break;case wO.BLENDMODE_ONEONE:this._engine.setAlphaMode(6);break;case wO.BLENDMODE_STANDARD:this._engine.setAlphaMode(2);break;case wO.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(4)}return this._platform.bindDrawBuffers(this._targetIndex,N,null!==(H=this._scene)&&void 0!==H&&H.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(N),null!==(b=this._scene)&&void 0!==b&&b.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(h=this._scene)&&void 0!==h&&h.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(O){if(!this.j||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!O)if(this.j.position){O=this.j.getWorldMatrix()}else{const f=this.j;O=S.g.Matrix[0],S.b.TranslationToRef(f.x,f.y,f.z,O)}this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this.isLocal||this._updateBuffer.setMatrix("emitterWM",O),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const f=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=f}render(){let O,f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!f&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let O=0;O<this.preWarmCycles;O++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){const O=0|this._accumulatedCount;this._accumulatedCount-=O,this._currentActiveCount+=O}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.j.position){O=this.j.getWorldMatrix()}else{const f=this.j;O=S.g.Matrix[0],S.b.TranslationToRef(f.x,f.y,f.z,O)}const H=this._engine;this.updateInAnimate||this._update(O);let b=0;return f||y||(H.setState(!1),this.forceDepthWrite&&H.setDepthWrite(!0),b=this.blendMode===wO.BLENDMODE_MULTIPLYADD?this._render(wO.BLENDMODE_MULTIPLY,O)+this._render(wO.BLENDMODE_ADD,O):this._render(this.blendMode,O),this._engine.setAlphaMode(0)),b}rebuild(){const O=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(O,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,O()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let O=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const f in this._drawWrappers){this._drawWrappers[f].dispose()}if(this._drawWrappers={},this._scene){const O=this._scene.oj.indexOf(this);O>-1&&this._scene.oj.splice(O,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let f=0;f<this._renderVertexBuffers.length;++f){const O=this._renderVertexBuffers[f];for(const f in O)O[f].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),O&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),O&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.hj.notifyObservers(this),this.hj.clear()}clone(O,f){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S={...this._customWrappers};let H=null;const b=this._engine;if(b.createEffectForParticles&&null!=this.customShader){H=this.customShader;const O=H.shaderOptions.defines.length>0?H.shaderOptions.defines.join("\n"):"";S[0]=b.createEffectForParticles(H.shaderPath.fragmentElement,H.shaderOptions.uniforms,H.shaderOptions.samplers,O,void 0,void 0,void 0,this)}const h=this.serialize(y),v=iO.Parse(h,this._scene||this._engine,this._rootUrl);return v.name=O,v.customShader=H,v._customWrappers=S,void 0===f&&(f=this.j),this.noiseTexture&&(v.noiseTexture=this.noiseTexture.clone()),v.j=f,v}serialize(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const f={};return wO._Serialize(f,this,O),f.activeParticleCount=this.activeParticleCount,f.randomTextureSize=this._randomTextureSize,f.customShader=this.customShader,f}static Parse(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],H=arguments.length>4?arguments[4]:void 0;const b=O.name;let h,v;f instanceof NO.c?h=f:(v=f,h=v.getEngine());const N=new iO(b,{kb:H||O.kb,randomTextureSize:O.randomTextureSize},f,null,O.isAnimationSheetEnabled);if(N._rootUrl=y,O.customShader&&h.createEffectForParticles){const f=O.customShader,y=f.shaderOptions.defines.length>0?f.shaderOptions.defines.join("\n"):"",S=h.createEffectForParticles(f.shaderPath.fragmentElement,f.shaderOptions.uniforms,f.shaderOptions.samplers,y,void 0,void 0,void 0,N);N.setCustomEffect(S,0),N.customShader=f}return O.id&&(N.id=O.id),O.activeParticleCount&&(N.activeParticleCount=O.activeParticleCount),wO._Parse(O,N,f,y),O.preventAutoStart&&(N.preventAutoStart=O.preventAutoStart),S||N.preventAutoStart||N.start(),N}}var DO=y(10995),VO=y(11907),gO=y(11284);class RO{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(O){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const f of this.systems)f.j=O;this._emitterNode=O}setEmitterAsSphere(O,f,y){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:O,renderingGroupId:f};const S=(0,VO.c)("emitterSphere",{diameter:O.diameter,segments:O.segments},y);S.renderingGroupId=f;const H=new gO.b("emitterSphereMaterial",y);H.emissiveColor=O.color,S.material=H;for(const b of this.systems)b.j=S;this._emitterNode=S}start(O){for(const f of this.systems)O&&(f.j=O),f.start()}dispose(){for(const O of this.systems)O.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const f={systems:[]};for(const y of this.systems)f.systems.push(y.serialize(O));return this._emitterNode&&(f.j=this._emitterCreationOptions),f}static Parse(O,f){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3?arguments[3]:void 0;const H=new RO,b=this.BaseAssetsUrl+"/textures/";f=f||r.c.LastCreatedScene;for(const h of O.systems)H.systems.push(y?iO.Parse(h,f,b,!0,S):wO.Parse(h,f,b,!0,S));if(O.j){const y=O.j.options;if("Sphere"===O.j.kind)H.setEmitterAsSphere({diameter:y.diameter,segments:y.segments,color:h.d.Ng(y.color)},O.j.renderingGroupId,f)}return H}}RO.BaseAssetsUrl="https://assets.babylonjs.com/particles";var sO=y(11037);class kO{static CreateDefault(O){let f,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,S=arguments.length>2?arguments[2]:void 0;return f=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new iO("default system",{kb:y},S):new wO("default system",y,S),f.j=O,f.particleTexture=new s.e("https://assets.babylonjs.com/textures/flare.png",f.va()),f.createConeEmitter(.1,Math.PI/4),f.color1=new h.g(1,1,1,1),f.color2=new h.g(1,1,1,1),f.colorDead=new h.g(1,1,1,0),f.minSize=.1,f.maxSize=.1,f.minEmitPower=2,f.maxEmitPower=2,f.updateSpeed=1/60,f.emitRate=30,f}static CreateAsync(O,f){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3?arguments[3]:void 0;f||(f=r.c.LastCreatedScene);const H={};return f.addPendingData(H),new Promise(((b,h)=>{if(y&&!iO.IsSupported)return f.removePendingData(H),h("Particle system with GPU is not supported.");DO.d.LoadFile(`${kO.BaseAssetsUrl}/systems/${O}.json`,(O=>{f.removePendingData(H);const h=JSON.parse(O.toString());return b(RO.Parse(h,f,y,S))}),void 0,void 0,void 0,(()=>(f.removePendingData(H),h(`An error occurred with the creation of your particle system. Check if your type '${O}' exists.`))))}))}static ExportSet(O){const f=new RO;for(const y of O)f.systems.push(y);return f}static ParseFromFileAsync(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",b=arguments.length>5?arguments[5]:void 0;return new Promise(((h,v)=>{const N=new sO.e;N.addEventListener("readystatechange",(()=>{if(4==N.readyState)if(200==N.status){const f=JSON.parse(N.responseText);let v;v=S?iO.Parse(f,y,H,!1,b):wO.Parse(f,y,H,!1,b),O&&(v.name=O),h(v)}else v("Unable to load the particle system")})),N.open("GET",f),N.send()}))}static ParseFromSnippetAsync(O,f){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",H=arguments.length>4?arguments[4]:void 0;if("_BLANK"===O){const O=this.CreateDefault(null);return O.start(),Promise.resolve(O)}return new Promise(((b,h)=>{const v=new sO.e;v.addEventListener("readystatechange",(()=>{if(4==v.readyState)if(200==v.status){const h=JSON.parse(JSON.parse(v.responseText).jsonPayload),N=JSON.parse(h.particleSystem);let m;m=y?iO.Parse(N,f,S,!1,H):wO.Parse(N,f,S,!1,H),m.snippetId=O,b(m)}else h("Unable to load the snippet "+O)})),v.open("GET",this.SnippetUrl+"/"+O.replace(/#/g,"/")),v.send()}))}}kO.BaseAssetsUrl=RO.BaseAssetsUrl,kO.SnippetUrl="https://snippet.babylonjs.com",kO.CreateFromSnippetAsync=kO.ParseFromSnippetAsync;var zO=y(11557),cO=y(11402),dO=y(11910);(0,dO.d)(cO.b.NAME_PARTICLESYSTEM,((O,f,y,S)=>{const H=(0,dO.g)(cO.b.NAME_PARTICLESYSTEM);if(H&&void 0!==O.oj&&null!==O.oj)for(let b=0,h=O.oj.length;b<h;b++){const h=O.oj[b];y.oj.push(H(h,f,S))}})),(0,dO.b)(cO.b.NAME_PARTICLESYSTEM,((O,f,y)=>{if(O.activeParticleCount){return iO.Parse(O,f,y)}return wO.Parse(O,f,y)})),NO.c.prototype.createEffectForParticles=function(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",b=arguments.length>4?arguments[4]:void 0,h=arguments.length>5?arguments[5]:void 0,v=arguments.length>6?arguments[6]:void 0,N=arguments.length>7?arguments[7]:void 0,m=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,t=[],q=[];const F=[];return N?N.fillUniformsAttributesAndSamplerNames(q,t,F):(t=wO._GetAttributeNamesOrOptions(),q=wO._GetEffectCreationOptions()),-1===H.indexOf(" BILLBOARD")&&(H+="\n#define BILLBOARD\n"),null!==N&&void 0!==N&&N.isAnimationSheetEnabled&&-1===H.indexOf(" ANIMATESHEET")&&(H+="\n#define ANIMATESHEET\n"),-1===S.indexOf("diffuseSampler")&&S.push("diffuseSampler"),this.createEffect({vertex:(null===N||void 0===N?void 0:N.vertexShaderName)??"particles",fragmentElement:O},t,q.concat(f),F.concat(S),H,b,h,v,void 0,m,(async()=>{0===m?await Promise.resolve().then(y.bind(y,11931)):await Promise.resolve().then(y.bind(y,11997))}))},zO.d.prototype.getEmittedParticleSystems=function(){const O=[];for(let f=0;f<this.va().oj.length;f++){const y=this.va().oj[f];y.j===this&&O.push(y)}return O},zO.d.prototype.getHierarchyEmittedParticleSystems=function(){const O=[],f=this.getDescendants();f.push(this);for(let y=0;y<this.va().oj.length;y++){const S=this.va().oj[y],H=S.j;H.position&&-1!==f.indexOf(H)&&O.push(S)}return O};y(11466),y(11475),y(11593);y(11577),y(11915),y(11606),y(11458),y(11615);y(11782);var GO;y(11917),y(11513);!function(O){O[O.Color=2]="Color",O[O.UV=1]="UV",O[O.Random=0]="Random",O[O.Stated=3]="Stated"}(GO||(GO={}));y(11919),y(11931),y(11942),y(11997)},11808:(O,f,y)=>{"use strict";y.d(f,{c:()=>A});var S=y(11289),H=y(11302),b=y(11004),h=y(11324),v=y(11098),N=y(11294),m=y(11362),t=y(11153),q=y(11092),F=y(11161),I=y(11816);q.c.prototype.setTextureFromPostProcess=function(O,f,y){var S;let H=null;f&&(f._forcedOutputTexture?H=f._forcedOutputTexture:f._textures.data[f._currentRenderTextureInd]&&(H=f._textures.data[f._currentRenderTextureInd])),this._bindTexture(O,(null===(S=H)||void 0===S?void 0:S.texture)??null,y)},q.c.prototype.setTextureFromPostProcessOutput=function(O,f,y){var S;this._bindTexture(O,(null===f||void 0===f||null===(S=f._outputTexture)||void 0===S?void 0:S.texture)??null,y)},v.b.prototype.setTextureFromPostProcess=function(O,f){this._engine.setTextureFromPostProcess(this._samplers[O],f,O)},v.b.prototype.setTextureFromPostProcessOutput=function(O,f){this._engine.setTextureFromPostProcessOutput(this._samplers[O],f,O)};class A{static get ForceGLSL(){return I.f.ForceGLSL}static set ForceGLSL(O){I.f.ForceGLSL=O}static RegisterShaderCodeProcessing(O,f){I.f.RegisterShaderCodeProcessing(O,f)}get name(){return this._effectWrapper.name}set name(O){this._effectWrapper.name=O}get alphaMode(){return this._effectWrapper.alphaMode}set alphaMode(O){this._effectWrapper.alphaMode=O}get samples(){return this._samples}set samples(O){this._samples=Math.min(O,this._engine.getCaps().maxMSAASamples),this._textures.forEach((O=>{O.setSamples(this._samples)}))}get shaderLanguage(){return this._shaderLanguage}getEffectName(){return this._fragmentUrl}set onActivate(O){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),O&&(this._onActivateObserver=this.onActivateObservable.add(O))}set onSizeChanged(O){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(O)}set onApply(O){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(O)}set onBeforeRender(O){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(O)}set onAfterRender(O){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(O)}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}set inputTexture(O){this._forcedOutputTexture=O}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}getCamera(){return this._camera}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.Xd(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}constructor(O,f,y,S,v,N){var m;let t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,q=arguments.length>7?arguments[7]:void 0,F=arguments.length>8?arguments[8]:void 0,J=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,X=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,w=arguments.length>11&&void 0!==arguments[11]?arguments[11]:"postprocess",B=arguments.length>12?arguments[12]:void 0,j=arguments.length>13&&void 0!==arguments[13]&&arguments[13],u=arguments.length>14&&void 0!==arguments[14]?arguments[14]:5,L=arguments.length>15?arguments[15]:void 0,p=arguments.length>16?arguments[16]:void 0;this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.Ri=!0,this.forceAutoClearInAlphaMode=!1,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new H.g(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new h.i(1,1),this._texelSize=h.i.Zero(),this.onActivateObservable=new b.d,this.onSizeChangedObservable=new b.d,this.onApplyObservable=new b.d,this.onBeforeRenderObservable=new b.d,this.onAfterRenderObservable=new b.d;let U,l=1,x=null;if(y&&!Array.isArray(y)){const O=y;y=O.uniforms??null,S=O.samplers??null,l=O.size??1,N=O.camera??null,t=O.samplingMode??1,q=O.ad,F=O.reusable,J=Array.isArray(O.defines)?O.defines.join("\n"):O.defines??null,X=O.textureType??0,w=O.vertexUrl??"postprocess",B=O.indexParameters,j=O.blockCompilation??!1,u=O.textureFormat??5,L=O.shaderLanguage??0,x=O.uniformBuffers??null,p=O.extraInitializations,U=O.effectWrapper}else v&&(l="number"===typeof v?v:{width:v.width,height:v.height});const W=!!U;if(this._effectWrapper=U??new I.f({name:O,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:f,ad:q||(null===(m=N)||void 0===m?void 0:m.va().getEngine()),uniforms:y,samplers:S,uniformBuffers:x,defines:J,vertexUrl:w,indexParameters:B,blockCompilation:j,shaderLanguage:L,extraInitializations:p}),this.name=O,this.onEffectCreatedObservable=this._effectWrapper.onEffectCreatedObservable,null!=N?(this._camera=N,this._scene=N.va(),N.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):q&&(this._engine=q,this._engine.postProcesses.push(this)),this._options=l,this.renderTargetSamplingMode=t||1,this._reusable=F||!1,this._textureType=X,this._textureFormat=u,this._shaderLanguage=L||0,this._samplers=S||[],-1===this._samplers.indexOf("textureSampler")&&this._samplers.push("textureSampler"),this._fragmentUrl=f,this._vertexUrl=w,this._parameters=y||[],-1===this._parameters.indexOf("scale")&&this._parameters.push("scale"),this._uniformBuffers=x||[],this._indexParameters=B,!W){this._webGPUReady=1===this._shaderLanguage;const O=[];this._gatherImports(this._engine.isWebGPU&&!A.ForceGLSL,O),this._effectWrapper._webGPUReady=this._webGPUReady,this._effectWrapper._postConstructor(j,J,p,O)}}_gatherImports(){let O=arguments.length>1?arguments[1]:void 0;arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this._webGPUReady?O.push(Promise.all([y.e(37).then(y.bind(y,13460))])):O.push(Promise.all([Promise.resolve().then(y.bind(y,11823))]))}getClassName(){return"PostProcess"}getEngine(){return this._engine}getEffect(){return this._effectWrapper.drawWrapper.effect}shareOutputWith(O){return this._disposeTextures(),this._shareOutputWithPostProcess=O,this}useOwnOutput(){0==this._textures.length&&(this._textures=new H.g(2)),this._shareOutputWithPostProcess=null}updateEffect(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3?arguments[3]:void 0,H=arguments.length>4?arguments[4]:void 0,b=arguments.length>5?arguments[5]:void 0,h=arguments.length>6?arguments[6]:void 0,v=arguments.length>7?arguments[7]:void 0;this._effectWrapper.updateEffect(O,f,y,S,H,b,h,v),this._postProcessDefines=Array.isArray(this._effectWrapper.options.defines)?this._effectWrapper.options.defines.join("\n"):this._effectWrapper.options.defines}isReusable(){return this._reusable}markTextureDirty(){this.width=-1}_createRenderTargetTexture(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let H=0;H<this._textureCache.length;H++)if(this._textureCache[H].texture.width===O.width&&this._textureCache[H].texture.height===O.height&&this._textureCache[H].postProcessChannel===y&&this._textureCache[H].texture._generateDepthBuffer===f.generateDepthBuffer&&this._textureCache[H].texture.samples===f.samples)return this._textureCache[H].texture;const S=this._engine.createRenderTargetTexture(O,f);return this._textureCache.push({texture:S,postProcessChannel:y,lastUsedRenderId:-1}),S}_flushTextureCache(){const O=this._renderId;for(let f=this._textureCache.length-1;f>=0;f--)if(O-this._textureCache[f].lastUsedRenderId>100){let O=!1;for(let y=0;y<this._textures.length;y++)if(this._textures.data[y]===this._textureCache[f].texture){O=!0;break}O||(this._textureCache[f].texture.dispose(),this._textureCache.splice(f,1))}}resize(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],H=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._textures.length>0&&this._textures.reset(),this.width=O,this.height=f;let b=null;if(y)for(let N=0;N<y._postProcesses.length;N++)if(null!==y._postProcesses[N]){b=y._postProcesses[N];break}const h={width:this.width,height:this.height},v={generateMipMaps:S,generateDepthBuffer:H||b===this,generateStencilBuffer:(H||b===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(h,v,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(h,v,1)),this._texelSize.Xd(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}_getTarget(){let O;if(this._shareOutputWithPostProcess)O=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)O=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{let f;O=this.inputTexture;for(let y=0;y<this._textureCache.length;y++)if(this._textureCache[y].texture===O){f=this._textureCache[y];break}f&&(f.lastUsedRenderId=this._renderId)}return O}activate(O){var f,y;let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2?arguments[2]:void 0;const b=(O=O||this._camera).va(),h=b.getEngine(),v=h.getCaps().maxTextureSize,N=(S?S.width:this._engine.getRenderWidth(!0))*this._options|0,m=(S?S.height:this._engine.getRenderHeight(!0))*this._options|0;let t=this._options.width||N,q=this._options.height||m;const I=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;let A=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){const O=h.currentViewport;O&&(t*=O.width,q*=O.height)}(I||this.alwaysForcePOT)&&(this._options.width||(t=h.needPOTTextures?(0,F.h)(t,v,this.scaleMode):t),this._options.height||(q=h.needPOTTextures?(0,F.h)(q,v,this.scaleMode):q)),this.width===t&&this.height===q&&(A=this._getTarget())||this.resize(t,q,O,I,H),this._textures.forEach((O=>{O.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(O,this.samples)})),this._flushTextureCache(),this._renderId++}return A||(A=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.Xd(N/t,m/q),this._engine.bindFramebuffer(A,0,N,m,this.forceFullscreenViewport)):(this._scaleRatio.Xd(1,1),this._engine.bindFramebuffer(A,0,void 0,void 0,this.forceFullscreenViewport)),null===(f=(y=this._engine)._debugInsertMarker)||void 0===f||f.call(y,`post process ${this.name} input`),this.onActivateObservable.notifyObservers(O),this.Ri&&(0===this.alphaMode||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:b.clearColor,b._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),A}get isSupported(){return this._effectWrapper.drawWrapper.effect.isSupported}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}isReady(){return this._effectWrapper.isReady()}apply(){if(!this._effectWrapper.isReady())return null;let O;var f;(this._engine.enableEffect(this._effectWrapper.drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),O=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding)||this._effectWrapper.drawWrapper.effect._bindTexture("textureSampler",null===(f=O)||void 0===f?void 0:f.texture);return this._effectWrapper.drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effectWrapper.drawWrapper.effect),this._effectWrapper.bind(),this._effectWrapper.drawWrapper.effect}_disposeTextures(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())}_disposeTextureCache(){for(let O=this._textureCache.length-1;O>=0;O--)this._textureCache[O].texture.dispose();this._textureCache.length=0}setPrePassRenderer(O){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=O.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)}dispose(O){let f;if(O=O||this._camera,this._disposeTextures(),this._scene&&(f=this._scene.postProcesses.indexOf(this),-1!==f&&this._scene.postProcesses.splice(f,1)),this._parentContainer){const O=this._parentContainer.postProcesses.indexOf(this);O>-1&&this._parentContainer.postProcesses.splice(O,1),this._parentContainer=null}if(f=this._engine.postProcesses.indexOf(this),-1!==f&&this._engine.postProcesses.splice(f,1),O){if(O.detachPostProcess(this),f=O._postProcesses.indexOf(this),0===f&&O._postProcesses.length>0){const O=this._camera._getFirstPostProcess();O&&O.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}}serialize(){const O=m.b.Serialize(this),f=this.getCamera()||this._scene&&this._scene.activeCamera;return O.customType="BABYLON."+this.getClassName(),O.cameraId=f?f.id:null,O.reusable=this._reusable,O.textureType=this._textureType,O.fragmentUrl=this._fragmentUrl,O.parameters=this._parameters,O.samplers=this._samplers,O.uniformBuffers=this._uniformBuffers,O.options=this._options,O.defines=this._postProcessDefines,O.textureFormat=this._textureFormat,O.vertexUrl=this._vertexUrl,O.indexParameters=this._indexParameters,O}clone(){const O=this.serialize();O._engine=this._engine,O.cameraId=null;const f=A.Parse(O,this._scene,"");return f?(f.onActivateObservable=this.onActivateObservable.clone(),f.onSizeChangedObservable=this.onSizeChangedObservable.clone(),f.onApplyObservable=this.onApplyObservable.clone(),f.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),f.onAfterRenderObservable=this.onAfterRenderObservable.clone(),f._prePassEffectConfiguration=this._prePassEffectConfiguration,f):null}static Parse(O,f,y){const S=(0,t.c)(O.customType);if(!S||!S._Parse)return null;const H=f?f.getCameraById(O.cameraId):null;return S._Parse(O,H,f,y)}static _Parse(O,f,y,S){return m.b.Parse((()=>new A(O.name,O.fragmentUrl,O.parameters,O.samplers,O.options,f,O.renderTargetSamplingMode,O._engine,O.reusable,O.defines,O.textureType,O.vertexUrl,O.indexParameters,!1,O.textureFormat)),O,y,S)}}(0,S.b)([(0,N.L)()],A.prototype,"uniqueId",void 0),(0,S.b)([(0,N.L)()],A.prototype,"name",null),(0,S.b)([(0,N.L)()],A.prototype,"width",void 0),(0,S.b)([(0,N.L)()],A.prototype,"height",void 0),(0,S.b)([(0,N.L)()],A.prototype,"renderTargetSamplingMode",void 0),(0,S.b)([(0,N.j)()],A.prototype,"clearColor",void 0),(0,S.b)([(0,N.L)()],A.prototype,"Ri",void 0),(0,S.b)([(0,N.L)()],A.prototype,"forceAutoClearInAlphaMode",void 0),(0,S.b)([(0,N.L)()],A.prototype,"alphaMode",null),(0,S.b)([(0,N.L)()],A.prototype,"alphaConstants",void 0),(0,S.b)([(0,N.L)()],A.prototype,"enablePixelPerfectMode",void 0),(0,S.b)([(0,N.L)()],A.prototype,"forceFullscreenViewport",void 0),(0,S.b)([(0,N.L)()],A.prototype,"scaleMode",void 0),(0,S.b)([(0,N.L)()],A.prototype,"alwaysForcePOT",void 0),(0,S.b)([(0,N.L)("samples")],A.prototype,"_samples",void 0),(0,S.b)([(0,N.L)()],A.prototype,"adaptScaleToCurrentViewport",void 0),(0,t.g)("BABYLON.PostProcess",A)},11398:(O,f,y)=>{"use strict";y.d(f,{e:()=>b});var S=y(11392),H=y(11004);class b{constructor(O){this._vertexBuffers={},this.onBeforeRenderObservable=new H.d,this._scene=O}_prepareBuffers(){if(this._vertexBuffers[S.f.PositionKind])return;const O=[];O.push(1,1),O.push(-1,1),O.push(-1,-1),O.push(1,-1),this._vertexBuffers[S.f.PositionKind]=new S.f(this._scene.getEngine(),O,S.f.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const O=[];O.push(0),O.push(1),O.push(2),O.push(0),O.push(2),O.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(O)}_rebuild(){const O=this._vertexBuffers[S.f.PositionKind];O&&(O._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const y=this._scene.activeCamera;return!!y&&(f=f||y._postProcesses.filter((O=>null!=O)),!(!f||0===f.length||!this._scene.postProcessesEnabled)&&(f[0].activate(y,O,null!==f&&void 0!==f),!0))}directRender(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,b=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const h=this._scene.getEngine();for(let N=0;N<O.length;N++){var v;if(N<O.length-1)O[N+1].activate(this._scene.activeCamera,null===f||void 0===f?void 0:f.texture);else f?h.bindFramebuffer(f,S,void 0,void 0,y,H):b||h.restoreDefaultFramebuffer(),null===(v=h._debugInsertMarker)||void 0===v||v.call(h,`post process ${O[N].name} output`);const m=O[N],t=m.apply();t&&(m.onBeforeRenderObservable.notifyObservers(t),this._prepareBuffers(),h.bindBuffers(this._vertexBuffers,this._indexBuffer,t),h.drawElementsType(0,0,6),m.onAfterRenderObservable.notifyObservers(t))}h.setDepthBuffer(!0),h.setDepthWrite(!0)}_finalizeFrame(O,f,y,S){let H=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const b=this._scene.activeCamera;if(!b)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(S=S||b._postProcesses.filter((O=>null!=O))).length||!this._scene.postProcessesEnabled)return;const h=this._scene.getEngine();for(let N=0,m=S.length;N<m;N++){const t=S[N];var v;if(N<m-1)t._outputTexture=S[N+1].activate(b,null===f||void 0===f?void 0:f.texture);else f?(h.bindFramebuffer(f,y,void 0,void 0,H),t._outputTexture=f):(h.restoreDefaultFramebuffer(),t._outputTexture=null),null===(v=h._debugInsertMarker)||void 0===v||v.call(h,`post process ${S[N].name} output`);if(O)break;const q=t.apply();q&&(t.onBeforeRenderObservable.notifyObservers(q),this._prepareBuffers(),h.bindBuffers(this._vertexBuffers,this._indexBuffer,q),h.drawElementsType(0,0,6),t.onAfterRenderObservable.notifyObservers(q))}h.setDepthBuffer(!0),h.setDepthWrite(!0),h.setAlphaMode(0)}dispose(){const O=this._vertexBuffers[S.f.PositionKind];O&&(O.dispose(),this._vertexBuffers[S.f.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11400:(O,f,y)=>{"use strict";y.d(f,{d:()=>v});var S=y(11302),H=y(11324);class b{set opaqueSortCompareFn(O){this._opaqueSortCompareFn=O||b.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(O){this._alphaTestSortCompareFn=O||b.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(O){this._transparentSortCompareFn=O||b.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=O,this._opaqueSubMeshes=new S.g(256),this._transparentSubMeshes=new S.g(256),this._alphaTestSubMeshes=new S.g(256),this._depthOnlySubMeshes=new S.g(256),this._particleSystems=new S.g(256),this._spriteManagers=new S.g(256),this._empty=!0,this._edgesRenderers=new S.c(16),this._scene=f,this.opaqueSortCompareFn=y,this.alphaTestSortCompareFn=H,this.transparentSortCompareFn=b}render(O,f,y,S){if(O)return void O(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const H=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(H.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),H.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const b=H.getStencilBuffer();if(H.setStencilBuffer(!1),f&&this._renderSprites(),y&&this._renderParticles(S),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(H.setStencilBuffer(b),this._scene.useOrderIndependentTransparency){const O=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);O.length&&this._renderTransparent(O)}else this._renderTransparent(this._transparentSubMeshes);H.setAlphaMode(0)}if(H.setStencilBuffer(!1),this._edgesRenderers.length){for(let O=0;O<this._edgesRenderers.length;O++)this._edgesRenderers.data[O].render();H.setAlphaMode(0)}H.setStencilBuffer(b)}_renderOpaqueSorted(O){b._RenderSorted(O,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(O){b._RenderSorted(O,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(O){b._RenderSorted(O,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(O,f,y,S){let h,v=0;const N=y?y.globalPosition:b._ZeroVector;if(S)for(;v<O.length;v++)h=O.data[v],h._alphaIndex=h.getMesh().alphaIndex,h._distanceToCamera=H.m.Distance(h.getBoundingInfo().boundingSphere.centerWorld,N);const m=O.length===O.data.length?O.data:O.data.slice(0,O.length);f&&m.sort(f);const t=m[0].getMesh().va();for(v=0;v<m.length;v++)if(h=m[v],!t._activeMeshesFrozenButKeepClipping||h.isInFrustum(t._frustumPlanes)){if(S){const O=h.Ha();if(O&&O.needDepthPrePass){const f=O.va().getEngine();f.setColorWrite(!1),f.setAlphaMode(0),h.render(!1),f.setColorWrite(!0)}}h.render(S)}}static defaultTransparentSortCompare(O,f){return O._alphaIndex>f._alphaIndex?1:O._alphaIndex<f._alphaIndex?-1:b.backToFrontSortCompare(O,f)}static backToFrontSortCompare(O,f){return O._distanceToCamera<f._distanceToCamera?1:O._distanceToCamera>f._distanceToCamera?-1:0}static frontToBackSortCompare(O,f){return O._distanceToCamera<f._distanceToCamera?-1:O._distanceToCamera>f._distanceToCamera?1:0}static PainterSortCompare(O,f){const y=O.getMesh(),S=f.getMesh();return y.material&&S.material?y.material.uniqueId-S.material.uniqueId:y.uniqueId-S.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(O,f,y){void 0===f&&(f=O.getMesh()),void 0===y&&(y=O.Ha()),null!==y&&void 0!==y&&(y.needAlphaBlendingForMesh(f)?this._transparentSubMeshes.push(O):y.needAlphaTesting()?(y.needDepthPrePass&&this._depthOnlySubMeshes.push(O),this._alphaTestSubMeshes.push(O)):(y.needDepthPrePass&&this._depthOnlySubMeshes.push(O),this._opaqueSubMeshes.push(O)),f._renderingGroup=this,f._edgesRenderer&&f.isEnabled()&&f.isVisible&&f._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(f._edgesRenderer),this._empty=!1)}dispatchSprites(O){this._spriteManagers.push(O),this._empty=!1}dispatchParticles(O){this._particleSystems.push(O),this._empty=!1}_renderParticles(O){if(0===this._particleSystems.length)return;const f=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let y=0;y<this._particleSystems.length;y++){const S=this._particleSystems.data[y];if(0===(f&&f.layerMask&S.layerMask))continue;const H=S.j;H.position&&O&&-1===O.indexOf(H)||this._scene._activeParticles.addCount(S.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const O=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let f=0;f<this._spriteManagers.length;f++){const y=this._spriteManagers.data[f];0!==(O&&O.layerMask&y.layerMask)&&y.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}b._ZeroVector=H.m.Zero();class h{}class v{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(O){O!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=O,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const O of this._scene.meshes)if(O.Yf)for(const f of O.Yf)f._wasDispatched=!1;if(this._scene.spriteManagers)for(const O of this._scene.spriteManagers)O._wasDispatched=!1;for(const O of this._scene.oj)O._wasDispatched=!1}constructor(O){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new h,this._maintainStateBetweenFrames=!1,this._scene=O;for(let f=v.MIN_RENDERINGGROUPS;f<v.MAX_RENDERINGGROUPS;f++)this._autoClearDepthStencil[f]={Ri:!0,depth:!0,stencil:!0}}getRenderingGroup(O){const f=O||0;return this._prepareRenderingGroup(f),this._renderingGroups[f]}_clearDepthStencilBuffer(){let O=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,O,f),this._depthStencilBufferAlreadyCleaned=!0)}render(O,f,y,S){const H=this._renderingGroupInfo;if(H.yd=this._scene,H.camera=this._scene.activeCamera,this._scene.spriteManagers&&S)for(let b=0;b<this._scene.spriteManagers.length;b++){const O=this._scene.spriteManagers[b];this.dispatchSprites(O)}for(let b=v.MIN_RENDERINGGROUPS;b<v.MAX_RENDERINGGROUPS;b++){this._depthStencilBufferAlreadyCleaned=b===v.MIN_RENDERINGGROUPS;const h=this._renderingGroups[b];if(!h||h._empty)continue;const N=1<<b;if(H.renderingGroupId=b,this._scene.onBeforeRenderingGroupObservable.notifyObservers(H,N),v.AUTOCLEAR){const O=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(b):this._autoClearDepthStencil[b];O&&O.Ri&&this._clearDepthStencilBuffer(O.depth,O.stencil)}for(const O of this._scene._beforeRenderingGroupDrawStage)O.action(b);h.render(O,S,y,f);for(const O of this._scene._afterRenderingGroupDrawStage)O.action(b);this._scene.onAfterRenderingGroupObservable.notifyObservers(H,N)}}reset(){if(!this.maintainStateBetweenFrames)for(let O=v.MIN_RENDERINGGROUPS;O<v.MAX_RENDERINGGROUPS;O++){const f=this._renderingGroups[O];f&&f.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let O=v.MIN_RENDERINGGROUPS;O<v.MAX_RENDERINGGROUPS;O++){const f=this._renderingGroups[O];f&&f.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let O=v.MIN_RENDERINGGROUPS;O<v.MAX_RENDERINGGROUPS;O++){const f=this._renderingGroups[O];f&&f.dispose()}}_prepareRenderingGroup(O){void 0===this._renderingGroups[O]&&(this._renderingGroups[O]=new b(O,this._scene,this._customOpaqueSortCompareFn[O],this._customAlphaTestSortCompareFn[O],this._customTransparentSortCompareFn[O]))}dispatchSprites(O){this.maintainStateBetweenFrames&&O._wasDispatched||(O._wasDispatched=!0,this.getRenderingGroup(O.renderingGroupId).dispatchSprites(O))}dispatchParticles(O){this.maintainStateBetweenFrames&&O._wasDispatched||(O._wasDispatched=!0,this.getRenderingGroup(O.renderingGroupId).dispatchParticles(O))}dispatch(O,f,y){void 0===f&&(f=O.getMesh()),this.maintainStateBetweenFrames&&O._wasDispatched||(O._wasDispatched=!0,this.getRenderingGroup(f.renderingGroupId).dispatch(O,f,y))}setRenderingOrder(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[O]=f,this._customAlphaTestSortCompareFn[O]=y,this._customTransparentSortCompareFn[O]=S,this._renderingGroups[O]){const f=this._renderingGroups[O];f.opaqueSortCompareFn=this._customOpaqueSortCompareFn[O],f.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[O],f.transparentSortCompareFn=this._customTransparentSortCompareFn[O]}}setRenderingAutoClearDepthStencil(O,f){let y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[O]={Ri:f,depth:y,stencil:S}}getAutoClearDepthStencilSetup(O){return this._autoClearDepthStencil[O]}}v.MAX_RENDERINGGROUPS=4,v.MIN_RENDERINGGROUPS=0,v.AUTOCLEAR=!0},11981:(O,f,y)=>{"use strict";const S="clipPlaneFragment",H="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";y(11101).c.IncludesShadersStoreWGSL[S]=H},11949:(O,f,y)=>{"use strict";const S="clipPlaneFragmentDeclaration",H="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";y(11101).c.IncludesShadersStoreWGSL[S]=H},12023:(O,f,y)=>{"use strict";const S="clipPlaneVertex",H="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";y(11101).c.IncludesShadersStoreWGSL[S]=H},12005:(O,f,y)=>{"use strict";const S="clipPlaneVertexDeclaration",H="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";y(11101).c.IncludesShadersStoreWGSL[S]=H},11988:(O,f,y)=>{"use strict";const S="fogFragment",H="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";y(11101).c.IncludesShadersStoreWGSL[S]=H},11977:(O,f,y)=>{"use strict";const S="fogFragmentDeclaration",H="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";y(11101).c.IncludesShadersStoreWGSL[S]=H},12032:(O,f,y)=>{"use strict";const S="fogVertex",H="#ifdef FOG\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#endif\n";y(11101).c.IncludesShadersStoreWGSL[S]=H},12014:(O,f,y)=>{"use strict";const S="fogVertexDeclaration",H="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";y(11101).c.IncludesShadersStoreWGSL[S]=H},11964:(O,f,y)=>{"use strict";const S="helperFunctions",H="const PI: f32=3.1415926535897932384626433832795;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3<f32>=vec3<f32> (0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(0.0),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);} \nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3<f32>=inMatrix[0];let i1: vec3<f32>=inMatrix[1];let i2: vec3<f32>=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=0.0773993808*color;let remainingSection: vec3<f32>=pow(0.947867299*(color+vec3<f32>(0.055)),vec3<f32>(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.04045)));}\nfn toGammaSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=12.92*color;let remainingSection: vec3<f32>=1.055*pow(color,vec3<f32>(0.41666))-vec3<f32>(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3<f32>(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3<f32>)->vec3<f32>\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3<f32>)->f32\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3<f32>)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3<f32> =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(clamp(rgb,vec3<f32>(0.,0.,0.),vec3<f32>(1.,1.,1.)),D); }\nfn fromRGBD(rgbd: vec4<f32>)->vec3<f32> {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3<f32>,origVec: vec3<f32>,cubeSize: vec3<f32>,cubePos: vec3<f32>)->vec3<f32> {let invOrigVec: vec3<f32>=vec3<f32>(1.0,1.0,1.0)/origVec;let halfSize: vec3<f32>=cubeSize*0.5;let intersecAtMaxPlane: vec3<f32>=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3<f32>=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3<f32>=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3<f32>=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";y(11101).c.IncludesShadersStoreWGSL[S]=H},11953:(O,f,y)=>{"use strict";const S="imageProcessingDeclaration",H="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";y(11101).c.IncludesShadersStoreWGSL[S]=H},11968:(O,f,y)=>{"use strict";const S="imageProcessingFunctions",H="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";y(11101).c.IncludesShadersStoreWGSL[S]=H},11956:(O,f,y)=>{"use strict";const S="logDepthDeclaration",H="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";y(11101).c.IncludesShadersStoreWGSL[S]=H},11986:(O,f,y)=>{"use strict";const S="logDepthFragment",H="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";y(11101).c.IncludesShadersStoreWGSL[S]=H},12036:(O,f,y)=>{"use strict";const S="logDepthVertex",H="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";y(11101).c.IncludesShadersStoreWGSL[S]=H},11942:(O,f,y)=>{"use strict";y.r(f),y.d(f,{particlesPixelShaderWGSL:()=>h});var S=y(11101);y(11949),y(11953),y(11956),y(11964),y(11968),y(11977),y(11981),y(11986),y(11988);const H="particlesPixelShader",b="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";S.c.ShadersStoreWGSL[H]=b;const h={name:H,shader:b}},11997:(O,f,y)=>{"use strict";y.r(f),y.d(f,{particlesVertexShaderWGSL:()=>h});var S=y(11101);y(12005),y(12014),y(11956),y(12023),y(12032),y(12036);const H="particlesVertexShader",b="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return input.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";S.c.ShadersStoreWGSL[H]=b;const h={name:H,shader:b}},11868:(O,f,y)=>{"use strict";const S="clipPlaneFragment",H="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";y(11101).c.IncludesShadersStore[S]=H},11928:(O,f,y)=>{"use strict";const S="clipPlaneFragmentDeclaration",H="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";y(11101).c.IncludesShadersStore[S]=H},11891:(O,f,y)=>{"use strict";const S="clipPlaneVertex",H="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";y(11101).c.IncludesShadersStore[S]=H},11933:(O,f,y)=>{"use strict";const S="clipPlaneVertexDeclaration",H="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";y(11101).c.IncludesShadersStore[S]=H},11877:(O,f,y)=>{"use strict";const S="fogFragment",H="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";y(11101).c.IncludesShadersStore[S]=H},11862:(O,f,y)=>{"use strict";const S="fogFragmentDeclaration",H="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";y(11101).c.IncludesShadersStore[S]=H},11899:(O,f,y)=>{"use strict";const S="fogVertex",H="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";y(11101).c.IncludesShadersStore[S]=H},11886:(O,f,y)=>{"use strict";const S="fogVertexDeclaration",H="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";y(11101).c.IncludesShadersStore[S]=H},11853:(O,f,y)=>{"use strict";const S="helperFunctions",H="const float PI=3.1415926535897932384626433832795;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.0;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(clamp(rgb,0.,1.),D); }\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";y(11101).c.IncludesShadersStore[S]=H},11840:(O,f,y)=>{"use strict";const S="imageProcessingDeclaration",H="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";y(11101).c.IncludesShadersStore[S]=H},11859:(O,f,y)=>{"use strict";const S="imageProcessingFunctions",H="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";y(11101).c.IncludesShadersStore[S]=H},11848:(O,f,y)=>{"use strict";const S="logDepthDeclaration",H="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";y(11101).c.IncludesShadersStore[S]=H},11875:(O,f,y)=>{"use strict";const S="logDepthFragment",H="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";y(11101).c.IncludesShadersStore[S]=H},11904:(O,f,y)=>{"use strict";const S="logDepthVertex",H="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";y(11101).c.IncludesShadersStore[S]=H},11919:(O,f,y)=>{"use strict";y.r(f),y.d(f,{particlesPixelShader:()=>h});var S=y(11101);y(11928),y(11840),y(11848),y(11853),y(11859),y(11862),y(11868),y(11875),y(11877);const H="particlesPixelShader",b="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";S.c.ShadersStore[H]=b;const h={name:H,shader:b}},11931:(O,f,y)=>{"use strict";y.r(f),y.d(f,{particlesVertexShader:()=>h});var S=y(11101);y(11933),y(11886),y(11848),y(11891),y(11899),y(11904);const H="particlesVertexShader",b="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";S.c.ShadersStore[H]=b;const h={name:H,shader:b}},11823:(O,f,y)=>{"use strict";y.r(f),y.d(f,{postprocessVertexShader:()=>b});const S="postprocessVertexShader",H="attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";y(11101).c.ShadersStore[S]=H;const b={name:S,shader:H}},11423:(O,f,y)=>{"use strict";y.d(f,{d:()=>S});class S{}S._IsPickingAvailable=!1},11568:(O,f,y)=>{"use strict";y.d(f,{c:()=>q});var S=y(11289),H=y(11324),b=y(11294),h=y(11004),v=y(11042),N=y(11030),m=y(11362);class t{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new h.d,this._onClonedObservable=new h.d}}class q{static AddNodeConstructor(O,f){this._NodeConstructors[O]=f}static Construct(O,f,y,S){const H=this._NodeConstructors[O];return H?H(f,y,S):null}set accessibilityTag(O){this._accessibilityTag=O,this.onAccessibilityTagChangedObservable.notifyObservers(O)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(O){this._nodeDataStorage._doNotSerialize=O}u(){return this._nodeDataStorage._isDisposed}set parent(O){if(this._parentNode===O)return;const f=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const f=this._parentNode._children.indexOf(this);-1!==f&&this._parentNode._children.splice(f,1),O||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=O,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),f||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(O){O.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const O=this._scene.rootNodes,f=O.length-1;O[this._nodeDataStorage._sceneRootNodesIndex]=O[f],O[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(O){this._animationPropertiesOverride=O}getClassName(){return"Node"}set onDispose(O){this._onDisposeObserver&&this.hj.remove(this._onDisposeObserver),this._onDisposeObserver=this.hj.add(O)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new t,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new h.d,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=H.b.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.hj=new h.d,this._onDisposeObserver=null,this._behaviors=new Array,this.name=O,this.id=O,this._scene=f||v.c.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),y&&this._addToSceneRootNodes()}va(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(O)||(O.init(),this._scene.isLoading&&!f?this._scene.onDataLoadedObservable.addOnce((()=>{O.attach(this)})):O.attach(this),this._behaviors.push(O)),this}removeBehavior(O){const f=this._behaviors.indexOf(O);return-1===f||(this._behaviors[f].detach(),this._behaviors.splice(f,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(O){for(const f of this._behaviors)if(f.name===O)return f;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.Mj(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(O){!O&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(O){return this.parent?this.parent._getActionManagerForTrigger(O,!1):null}_updateCache(O){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}Dg(O){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((O=>{O._syncParentEnabledState()}))}$b(O){this._nodeDataStorage._isEnabled!==O&&(this._nodeDataStorage._isEnabled=O,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(O))}isDescendantOf(O){return!!this.parent&&(this.parent===O||this.parent.isDescendantOf(O))}_getDescendants(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2?arguments[2]:void 0;if(this._children)for(let S=0;S<this._children.length;S++){const H=this._children[S];y&&!y(H)||O.push(H),f||H._getDescendants(O,!1,y)}}getDescendants(O,f){const y=[];return this._getDescendants(y,O,f),y}getChildMeshes(O,f){const y=[];return this._getDescendants(y,O,(O=>(!f||f(O))&&void 0!==O.Bi)),y}getChildren(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(f,O)}_setReady(O){O!==this._nodeDataStorage._isReady&&(O?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(O){for(let f=0;f<this.animations.length;f++){const y=this.animations[f];if(y.name===O)return y}return null}createAnimationRange(O,f,y){if(!this._ranges[O]){this._ranges[O]=q._AnimationRangeFactory(O,f,y);for(let S=0,H=this.animations.length;S<H;S++)this.animations[S]&&this.animations[S].createRange(O,f,y)}}deleteAnimationRange(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let y=0,S=this.animations.length;y<S;y++)this.animations[y]&&this.animations[y].deleteRange(O,f);this._ranges[O]=null}getAnimationRange(O){return this._ranges[O]||null}clone(O,f,y){const S=m.b.Clone((()=>new q(O,this.va())),this);if(f&&(S.parent=f),!y){const f=this.getDescendants(!0);for(let y=0;y<f.length;y++){const H=f[y];H.clone(O+"."+H.name,S)}}return S}getAnimationRanges(){const O=[];let f;for(f in this._ranges)O.push(this._ranges[f]);return O}beginAnimation(O,f,y,S){const H=this.getAnimationRange(O);return H?this._scene.beginAnimation(this,H.from,H.to,f,y,S):null}serializeAnimationRanges(){const O=[];for(const f in this._ranges){const y=this._ranges[f];if(!y)continue;const S={};S.name=f,S.from=y.from,S.to=y.to,O.push(S)}return O}Mj(O){return this._worldMatrix||(this._worldMatrix=H.b.Identity()),this._worldMatrix}dispose(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!O){const y=this.getDescendants(!0);for(const S of y)S.dispose(O,f)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.hj.notifyObservers(this),this.hj.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const y of this._behaviors)y.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(O,f,y){if(f.ranges)for(let S=0;S<f.ranges.length;S++){const y=f.ranges[S];O.createAnimationRange(y.name,y.from,y.to)}}getHierarchyBoundingVectors(){let O,f,y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.va().incrementRenderId(),this.Mj(!0);const b=this;if(b.getBoundingInfo&&b.Yf){const y=b.getBoundingInfo();O=y.boundingBox.minimumWorld.clone(),f=y.boundingBox.maximumWorld.clone()}else O=new H.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),f=new H.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(y){const y=this.getDescendants(!1);for(const b of y){const y=b;if(y.Mj(!0),S&&!S(y))continue;if(!y.getBoundingInfo||0===y.getTotalVertices())continue;const h=y.getBoundingInfo().boundingBox,v=h.minimumWorld,N=h.maximumWorld;H.m.CheckExtends(v,O,f),H.m.CheckExtends(N,O,f)}}return{min:O,max:f}}}q._AnimationRangeFactory=(O,f,y)=>{throw(0,N.d)("AnimationRange")},q._NodeConstructors={},(0,S.b)([(0,b.L)()],q.prototype,"name",void 0),(0,S.b)([(0,b.L)()],q.prototype,"id",void 0),(0,S.b)([(0,b.L)()],q.prototype,"uniqueId",void 0),(0,S.b)([(0,b.L)()],q.prototype,"state",void 0),(0,S.b)([(0,b.L)()],q.prototype,"metadata",void 0)},11311:(O,f,y)=>{"use strict";y.d(f,{c:()=>OO});var S=y(10995),H=y(11028),b=y(11004),h=y(11302);class v{constructor(){this._count=0,this._data={}}p(O){this.clear(),O.forEach(((O,f)=>this.add(O,f)))}get(O){const f=this._data[O];if(void 0!==f)return f}getOrAddWithFactory(O,f){let y=this.get(O);return void 0!==y||(y=f(O),y&&this.add(O,y)),y}getOrAdd(O,f){const y=this.get(O);return void 0!==y?y:(this.add(O,f),f)}contains(O){return void 0!==this._data[O]}add(O,f){return void 0===this._data[O]&&(this._data[O]=f,++this._count,!0)}set(O,f){return void 0!==this._data[O]&&(this._data[O]=f,!0)}getAndRemove(O){const f=this.get(O);return void 0!==f?(delete this._data[O],--this._count,f):null}remove(O){return!!this.contains(O)&&(delete this._data[O],--this._count,!0)}clear(){this._data={},this._count=0}get count(){return this._count}forEach(O){for(const f in this._data){O(f,this._data[f])}}first(O){for(const f in this._data){const y=O(f,this._data[f]);if(y)return y}return null}}var N=y(11317),m=y(11324),t=y(11352),q=y(11380),F=y(11383);class I{constructor(O,f,y,S,H,b){this.source=O,this.pointerX=f,this.pointerY=y,this.meshUnderPointer=S,this.sourceEvent=H,this.additionalData=b}static CreateNew(O,f,y){const S=O.va();return new I(O,S.pointerX,S.pointerY,S.meshUnderPointer||O,f,y)}static CreateNewFromSprite(O,f,y,S){return new I(O,f.pointerX,f.pointerY,f.meshUnderPointer,y,S)}static CreateNewFromScene(O,f){return new I(null,O.pointerX,O.pointerY,O.meshUnderPointer,f)}static CreateNewFromPrimitive(O,f,y,S){return new I(O,f.x,f.y,null,y,S)}}var A=y(11398),J=y(11400),X=y(11402),w=y(11009),B=y(11042),j=y(11030),u=y(11406);class L{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasTriggers(){for(const O in L.Triggers)if(Object.prototype.hasOwnProperty.call(L.Triggers,O))return!0;return!1}static get HasPickTriggers(){for(const O in L.Triggers)if(Object.prototype.hasOwnProperty.call(L.Triggers,O)){const f=parseInt(O);if(f>=1&&f<=7)return!0}return!1}static HasSpecificTrigger(O){for(const f in L.Triggers)if(Object.prototype.hasOwnProperty.call(L.Triggers,f)){if(parseInt(f)===O)return!0}return!1}}L.Triggers={};var p,U,l,x,W,E,o,i=y(11411);!function(O){O[O.Generic=0]="Generic",O[O.Keyboard=1]="Keyboard",O[O.Mouse=2]="Mouse",O[O.Touch=3]="Touch",O[O.DualShock=4]="DualShock",O[O.Xbox=5]="Xbox",O[O.Switch=6]="Switch",O[O.DualSense=7]="DualSense"}(p||(p={})),function(O){O[O.Horizontal=0]="Horizontal",O[O.Vertical=1]="Vertical",O[O.LeftClick=2]="LeftClick",O[O.MiddleClick=3]="MiddleClick",O[O.RightClick=4]="RightClick",O[O.BrowserBack=5]="BrowserBack",O[O.BrowserForward=6]="BrowserForward",O[O.MouseWheelX=7]="MouseWheelX",O[O.MouseWheelY=8]="MouseWheelY",O[O.MouseWheelZ=9]="MouseWheelZ",O[O.Move=12]="Move"}(U||(U={})),function(O){O[O.Horizontal=0]="Horizontal",O[O.Vertical=1]="Vertical",O[O.LeftClick=2]="LeftClick",O[O.MiddleClick=3]="MiddleClick",O[O.RightClick=4]="RightClick",O[O.BrowserBack=5]="BrowserBack",O[O.BrowserForward=6]="BrowserForward",O[O.MouseWheelX=7]="MouseWheelX",O[O.MouseWheelY=8]="MouseWheelY",O[O.MouseWheelZ=9]="MouseWheelZ",O[O.DeltaHorizontal=10]="DeltaHorizontal",O[O.DeltaVertical=11]="DeltaVertical"}(l||(l={})),function(O){O[O.Cross=0]="Cross",O[O.Circle=1]="Circle",O[O.Square=2]="Square",O[O.Triangle=3]="Triangle",O[O.L1=4]="L1",O[O.R1=5]="R1",O[O.L2=6]="L2",O[O.R2=7]="R2",O[O.Share=8]="Share",O[O.Options=9]="Options",O[O.L3=10]="L3",O[O.R3=11]="R3",O[O.DPadUp=12]="DPadUp",O[O.DPadDown=13]="DPadDown",O[O.DPadLeft=14]="DPadLeft",O[O.DPadRight=15]="DPadRight",O[O.Home=16]="Home",O[O.TouchPad=17]="TouchPad",O[O.LStickXAxis=18]="LStickXAxis",O[O.LStickYAxis=19]="LStickYAxis",O[O.RStickXAxis=20]="RStickXAxis",O[O.RStickYAxis=21]="RStickYAxis"}(x||(x={})),function(O){O[O.Cross=0]="Cross",O[O.Circle=1]="Circle",O[O.Square=2]="Square",O[O.Triangle=3]="Triangle",O[O.L1=4]="L1",O[O.R1=5]="R1",O[O.L2=6]="L2",O[O.R2=7]="R2",O[O.Create=8]="Create",O[O.Options=9]="Options",O[O.L3=10]="L3",O[O.R3=11]="R3",O[O.DPadUp=12]="DPadUp",O[O.DPadDown=13]="DPadDown",O[O.DPadLeft=14]="DPadLeft",O[O.DPadRight=15]="DPadRight",O[O.Home=16]="Home",O[O.TouchPad=17]="TouchPad",O[O.LStickXAxis=18]="LStickXAxis",O[O.LStickYAxis=19]="LStickYAxis",O[O.RStickXAxis=20]="RStickXAxis",O[O.RStickYAxis=21]="RStickYAxis"}(W||(W={})),function(O){O[O.A=0]="A",O[O.B=1]="B",O[O.X=2]="X",O[O.Y=3]="Y",O[O.LB=4]="LB",O[O.RB=5]="RB",O[O.LT=6]="LT",O[O.RT=7]="RT",O[O.Back=8]="Back",O[O.Start=9]="Start",O[O.LS=10]="LS",O[O.RS=11]="RS",O[O.DPadUp=12]="DPadUp",O[O.DPadDown=13]="DPadDown",O[O.DPadLeft=14]="DPadLeft",O[O.DPadRight=15]="DPadRight",O[O.Home=16]="Home",O[O.LStickXAxis=17]="LStickXAxis",O[O.LStickYAxis=18]="LStickYAxis",O[O.RStickXAxis=19]="RStickXAxis",O[O.RStickYAxis=20]="RStickYAxis"}(E||(E={})),function(O){O[O.B=0]="B",O[O.A=1]="A",O[O.Y=2]="Y",O[O.X=3]="X",O[O.L=4]="L",O[O.R=5]="R",O[O.ZL=6]="ZL",O[O.ZR=7]="ZR",O[O.Minus=8]="Minus",O[O.Plus=9]="Plus",O[O.LS=10]="LS",O[O.RS=11]="RS",O[O.DPadUp=12]="DPadUp",O[O.DPadDown=13]="DPadDown",O[O.DPadLeft=14]="DPadLeft",O[O.DPadRight=15]="DPadRight",O[O.Home=16]="Home",O[O.Capture=17]="Capture",O[O.LStickXAxis=18]="LStickXAxis",O[O.LStickYAxis=19]="LStickYAxis",O[O.RStickXAxis=20]="RStickXAxis",O[O.RStickYAxis=21]="RStickYAxis"}(o||(o={}));var D=y(11417);class V{static CreateDeviceEvent(O,f,y,S,H,b,h){switch(O){case p.Keyboard:return this._CreateKeyboardEvent(y,S,H,b);case p.Mouse:if(y===U.MouseWheelX||y===U.MouseWheelY||y===U.MouseWheelZ)return this._CreateWheelEvent(O,f,y,S,H,b);case p.Touch:return this._CreatePointerEvent(O,f,y,S,H,b,h);default:throw`Unable to generate event for device ${p[O]}`}}static _CreatePointerEvent(O,f,y,S,H,b,h){const v=this._CreateMouseEvent(O,f,y,S,H,b);O===p.Mouse?(v.deviceType=p.Mouse,v.pointerId=1,v.pointerType="mouse"):(v.deviceType=p.Touch,v.pointerId=h??f,v.pointerType="touch");let N=0;return N+=H.pollInput(O,f,U.LeftClick),N+=2*H.pollInput(O,f,U.RightClick),N+=4*H.pollInput(O,f,U.MiddleClick),v.buttons=N,y===U.Move?v.type="pointermove":y>=U.LeftClick&&y<=U.RightClick&&(v.type=1===S?"pointerdown":"pointerup",v.button=y-2),v}static _CreateWheelEvent(O,f,y,S,H,b){const h=this._CreateMouseEvent(O,f,y,S,H,b);switch(h.pointerId=1,h.type="wheel",h.deltaMode=D.e.DOM_DELTA_PIXEL,h.deltaX=0,h.deltaY=0,h.deltaZ=0,y){case U.MouseWheelX:h.deltaX=S;break;case U.MouseWheelY:h.deltaY=S;break;case U.MouseWheelZ:h.deltaZ=S}return h}static _CreateMouseEvent(O,f,y,S,H,b){const h=this._CreateEvent(b),v=H.pollInput(O,f,U.Horizontal),N=H.pollInput(O,f,U.Vertical);return b?(h.movementX=0,h.movementY=0,h.offsetX=h.movementX-b.getBoundingClientRect().x,h.offsetY=h.movementY-b.getBoundingClientRect().y):(h.movementX=H.pollInput(O,f,10),h.movementY=H.pollInput(O,f,11),h.offsetX=0,h.offsetY=0),this._CheckNonCharacterKeys(h,H),h.clientX=v,h.clientY=N,h.x=v,h.y=N,h.deviceType=O,h.deviceSlot=f,h.inputIndex=y,h}static _CreateKeyboardEvent(O,f,y,S){const H=this._CreateEvent(S);return this._CheckNonCharacterKeys(H,y),H.deviceType=p.Keyboard,H.deviceSlot=0,H.inputIndex=O,H.type=1===f?"keydown":"keyup",H.key=String.fromCharCode(O),H.keyCode=O,H}static _CheckNonCharacterKeys(O,f){const y=f.isDeviceAvailable(p.Keyboard),S=y&&1===f.pollInput(p.Keyboard,0,18),H=y&&1===f.pollInput(p.Keyboard,0,17),b=y&&(1===f.pollInput(p.Keyboard,0,91)||1===f.pollInput(p.Keyboard,0,92)||1===f.pollInput(p.Keyboard,0,93)),h=y&&1===f.pollInput(p.Keyboard,0,16);O.altKey=S,O.ctrlKey=H,O.metaKey=b,O.shiftKey=h}static _CreateEvent(O){const f={preventDefault:()=>{}};return f.target=O,f}}class g{constructor(O,f,y){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(O,f,((O,f,S,H)=>{const b=V.CreateDeviceEvent(O,f,S,H,this);y(O,f,b)})):this._createDummyNativeInput()}pollInput(O,f,y){return this._nativeInput.pollInput(O,f,y)}isDeviceAvailable(O){return O===p.Mouse||O===p.Touch}dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}}const R=Object.keys(U).length/2;class s{constructor(O,f,y,H){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=S.d.IsSafari(),this._usingMacOS=(0,w.d)()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=O=>{},this._keyboardUpEvent=O=>{},this._keyboardBlurEvent=O=>{},this._pointerMoveEvent=O=>{},this._pointerDownEvent=O=>{},this._pointerUpEvent=O=>{},this._pointerCancelEvent=O=>{},this._pointerWheelEvent=O=>{},this._pointerBlurEvent=O=>{},this._pointerMacOSChromeOutEvent=O=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=(0,w.d)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=(0,w.d)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=O=>{},this._gamepadDisconnectedEvent=O=>{},this._eventPrefix=S.d.GetPointerPrefix(O),this._engine=O,this._onDeviceConnected=f,this._onDeviceDisconnected=y,this._onInputChanged=H,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOS&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}pollInput(O,f,y){const H=this._inputs[O][f];if(!H)throw`Unable to find device ${p[O]}`;O>=p.DualShock&&O<=p.DualSense&&this._updateDevice(O,f,y);const b=H[y];if(void 0===b)throw`Unable to find input ${y} for device ${p[O]} in slot ${f}`;return y===U.Move&&S.d.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),b}isDeviceAvailable(O){return void 0!==this._inputs[O]}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_enableEvents(){const O=null===this||void 0===this?void 0:this._engine.getInputElement();if(O&&(!this._eventsAttached||this._elementToAttachTo!==O)){if(this._disableEvents(),this._inputs)for(const O of this._inputs)if(O)for(const f in O){const y=O[+f];if(y)for(let O=0;O<y.length;O++)y[O]=0}this._elementToAttachTo=O,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOS&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_checkForConnectedDevices(){if(navigator.getGamepads){const O=navigator.getGamepads();for(const f of O)f&&this._addGamePad(f)}"function"===typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(p.Mouse,0,0,0)}_addGamePad(O){const f=this._getGamepadDeviceType(O.id),y=O.index;this._gamepads=this._gamepads||new Array(O.index+1),this._registerDevice(f,y,O.buttons.length+O.axes.length),this._gamepads[y]=f}_addPointerDevice(O,f,y,S){this._pointerActive||(this._pointerActive=!0),this._registerDevice(O,f,R);const H=this._inputs[O][f];H[0]=y,H[1]=S}_registerDevice(O,f,y){if(void 0===f)throw`Unable to register device ${p[O]} to undefined slot.`;if(this._inputs[O]||(this._inputs[O]={}),!this._inputs[O][f]){const S=new Array(y);S.fill(0),this._inputs[O][f]=S,this._onDeviceConnected(O,f)}}_unregisterDevice(O,f){this._inputs[O][f]&&(delete this._inputs[O][f],this._onDeviceDisconnected(O,f))}_handleKeyActions(){this._keyboardDownEvent=O=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(p.Keyboard,0,255));const f=this._inputs[p.Keyboard][0];if(f){f[O.keyCode]=1;const y=O;y.inputIndex=O.keyCode,this._usingMacOS&&O.metaKey&&"Meta"!==O.key&&(this._metaKeys.includes(O.keyCode)||this._metaKeys.push(O.keyCode)),this._onInputChanged(p.Keyboard,0,y)}},this._keyboardUpEvent=O=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(p.Keyboard,0,255));const f=this._inputs[p.Keyboard][0];if(f){f[O.keyCode]=0;const y=O;if(y.inputIndex=O.keyCode,this._usingMacOS&&"Meta"===O.key&&this._metaKeys.length>0){for(const O of this._metaKeys){const y=V.CreateDeviceEvent(p.Keyboard,0,O,0,this,this._elementToAttachTo);f[O]=0,this._onInputChanged(p.Keyboard,0,y)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(p.Keyboard,0,y)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const O=this._inputs[p.Keyboard][0];for(let f=0;f<O.length;f++)if(0!==O[f]){O[f]=0;const y=V.CreateDeviceEvent(p.Keyboard,0,f,0,this,this._elementToAttachTo);this._onInputChanged(p.Keyboard,0,y)}this._usingMacOS&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_handlePointerActions(){this._maxTouchPoints=(0,w.d)()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let S=0;S<this._maxTouchPoints;S++)this._activeTouchIds[S]=-1;this._pointerMoveEvent=O=>{const f=this._getPointerType(O);let y=f===p.Mouse?0:this._activeTouchIds.indexOf(O.pointerId);if(f===p.Touch&&-1===y){const H=this._activeTouchIds.indexOf(-1);if(!(H>=0))return void S.d.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);y=H,this._activeTouchIds[H]=O.pointerId,this._onDeviceConnected(f,y)}this._inputs[f]||(this._inputs[f]={}),this._inputs[f][y]||this._addPointerDevice(f,y,O.clientX,O.clientY);const H=this._inputs[f][y];if(H){const S=O;S.inputIndex=U.Move,H[U.Horizontal]=O.clientX,H[U.Vertical]=O.clientY,f===p.Touch&&0===H[U.LeftClick]&&(H[U.LeftClick]=1),void 0===O.pointerId&&(O.pointerId=this._mouseId),this._onInputChanged(f,y,S),this._usingSafari||-1===O.button||(S.inputIndex=O.button+2,H[O.button+2]=H[O.button+2]?0:1,this._onInputChanged(f,y,S))}},this._pointerDownEvent=O=>{const f=this._getPointerType(O);let y=f===p.Mouse?0:O.pointerId;if(f===p.Touch){let f=this._activeTouchIds.indexOf(O.pointerId);if(-1===f&&(f=this._activeTouchIds.indexOf(-1)),!(f>=0))return void S.d.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);y=f,this._activeTouchIds[f]=O.pointerId}this._inputs[f]||(this._inputs[f]={}),this._inputs[f][y]?f===p.Touch&&this._onDeviceConnected(f,y):this._addPointerDevice(f,y,O.clientX,O.clientY);const H=this._inputs[f][y];if(H){const S=H[U.Horizontal],h=H[U.Vertical];if(f===p.Mouse){if(void 0===O.pointerId&&(O.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(b){}}else if(O.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(O.pointerId)}catch(b){}H[U.Horizontal]=O.clientX,H[U.Vertical]=O.clientY,H[O.button+2]=1;const v=O;v.inputIndex=O.button+2,this._onInputChanged(f,y,v),S===O.clientX&&h===O.clientY||(v.inputIndex=U.Move,this._onInputChanged(f,y,v))}},this._pointerUpEvent=O=>{var f;const y=this._getPointerType(O),S=y===p.Mouse?0:this._activeTouchIds.indexOf(O.pointerId);if(y===p.Touch){if(-1===S)return;this._activeTouchIds[S]=-1}const H=null===(f=this._inputs[y])||void 0===f?void 0:f[S];if(H&&0!==H[O.button+2]){var b,h,v,N;const f=H[U.Horizontal],m=H[U.Vertical];H[U.Horizontal]=O.clientX,H[U.Vertical]=O.clientY,H[O.button+2]=0;const t=O;void 0===O.pointerId&&(O.pointerId=this._mouseId),f===O.clientX&&m===O.clientY||(t.inputIndex=U.Move,this._onInputChanged(y,S,t)),t.inputIndex=O.button+2,y===p.Mouse&&this._mouseId>=0&&null!==(b=(h=this._elementToAttachTo).hasPointerCapture)&&void 0!==b&&b.call(h,this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):O.pointerId&&null!==(v=(N=this._elementToAttachTo).hasPointerCapture)&&void 0!==v&&v.call(N,O.pointerId)&&this._elementToAttachTo.releasePointerCapture(O.pointerId),this._onInputChanged(y,S,t),y===p.Touch&&this._onDeviceDisconnected(y,S)}},this._pointerCancelEvent=O=>{if("mouse"===O.pointerType){var f,y;const O=this._inputs[p.Mouse][0];this._mouseId>=0&&null!==(f=(y=this._elementToAttachTo).hasPointerCapture)&&void 0!==f&&f.call(y,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let f=U.LeftClick;f<=U.BrowserForward;f++)if(1===O[f]){O[f]=0;const y=V.CreateDeviceEvent(p.Mouse,0,f,0,this,this._elementToAttachTo);this._onInputChanged(p.Mouse,0,y)}}else{var S,H;const f=this._activeTouchIds.indexOf(O.pointerId);if(-1===f)return;null!==(S=(H=this._elementToAttachTo).hasPointerCapture)&&void 0!==S&&S.call(H,O.pointerId)&&this._elementToAttachTo.releasePointerCapture(O.pointerId),this._inputs[p.Touch][f][U.LeftClick]=0;const y=V.CreateDeviceEvent(p.Touch,f,U.LeftClick,0,this,this._elementToAttachTo,O.pointerId);this._onInputChanged(p.Touch,f,y),this._activeTouchIds[f]=-1,this._onDeviceDisconnected(p.Touch,f)}},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let O=!1;const f=function(){};try{const y=Object.defineProperty({},"passive",{get:function(){O=!0}});this._elementToAttachTo.addEventListener("test",f,y),this._elementToAttachTo.removeEventListener("test",f,y)}catch(y){}this._pointerBlurEvent=()=>{if(this.isDeviceAvailable(p.Mouse)){var O,f;const y=this._inputs[p.Mouse][0];this._mouseId>=0&&null!==(O=(f=this._elementToAttachTo).hasPointerCapture)&&void 0!==O&&O.call(f,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let O=U.LeftClick;O<=U.BrowserForward;O++)if(1===y[O]){y[O]=0;const f=V.CreateDeviceEvent(p.Mouse,0,O,0,this,this._elementToAttachTo);this._onInputChanged(p.Mouse,0,f)}}if(this.isDeviceAvailable(p.Touch)){const O=this._inputs[p.Touch];for(let f=0;f<this._activeTouchIds.length;f++){var y,S,H;const b=this._activeTouchIds[f];if(null!==(y=(S=this._elementToAttachTo).hasPointerCapture)&&void 0!==y&&y.call(S,b)&&this._elementToAttachTo.releasePointerCapture(b),-1!==b&&1===(null===(H=O[f])||void 0===H?void 0:H[U.LeftClick])){O[f][U.LeftClick]=0;const y=V.CreateDeviceEvent(p.Touch,f,U.LeftClick,0,this,this._elementToAttachTo,b);this._onInputChanged(p.Touch,f,y),this._activeTouchIds[f]=-1,this._onDeviceDisconnected(p.Touch,f)}}}},this._pointerWheelEvent=O=>{const f=p.Mouse;this._inputs[f]||(this._inputs[f]=[]),this._inputs[f][0]||(this._pointerActive=!0,this._registerDevice(f,0,R));const y=this._inputs[f][0];if(y){y[U.MouseWheelX]=O.deltaX||0,y[U.MouseWheelY]=O.deltaY||O.wheelDelta||0,y[U.MouseWheelZ]=O.deltaZ||0;const S=O;void 0===O.pointerId&&(O.pointerId=this._mouseId),0!==y[U.MouseWheelX]&&(S.inputIndex=U.MouseWheelX,this._onInputChanged(f,0,S)),0!==y[U.MouseWheelY]&&(S.inputIndex=U.MouseWheelY,this._onInputChanged(f,0,S)),0!==y[U.MouseWheelZ]&&(S.inputIndex=U.MouseWheelZ,this._onInputChanged(f,0,S))}},this._usingMacOS&&this._isUsingChromium&&(this._pointerMacOSChromeOutEvent=O=>{O.buttons>1&&this._pointerCancelEvent(O)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!O&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((()=>{if(this.isDeviceAvailable(p.Mouse)){const O=this._inputs[p.Mouse][0];O[U.MouseWheelX]=0,O[U.MouseWheelY]=0,O[U.MouseWheelZ]=0}}))}_handleGamepadActions(){this._gamepadConnectedEvent=O=>{this._addGamePad(O.gamepad)},this._gamepadDisconnectedEvent=O=>{if(this._gamepads){const f=this._getGamepadDeviceType(O.gamepad.id),y=O.gamepad.index;this._unregisterDevice(f,y),delete this._gamepads[y]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_updateDevice(O,f,y){const S=navigator.getGamepads()[f];if(S&&O===this._gamepads[f]){const H=this._inputs[O][f];y>=S.buttons.length?H[y]=S.axes[y-S.buttons.length].valueOf():H[y]=S.buttons[y].value}}_getGamepadDeviceType(O){return-1!==O.indexOf("054c")?-1!==O.indexOf("0ce6")?p.DualSense:p.DualShock:-1!==O.indexOf("Xbox One")||-1!==O.search("Xbox 360")||-1!==O.search("xinput")?p.Xbox:-1!==O.indexOf("057e")?p.Switch:p.Generic}_getPointerType(O){let f=p.Mouse;return("touch"===O.pointerType||"pen"===O.pointerType||O.touches)&&(f=p.Touch),f}}class k{constructor(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.deviceType=f,this.deviceSlot=y,this.onInputChangedObservable=new b.d,this._deviceInputSystem=O}getInput(O){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,O)}}class z{constructor(O){this._registeredManagers=new Array,this._refCount=0,this.registerManager=O=>{for(let f=0;f<this._devices.length;f++){const y=this._devices[f];for(const S in y){const y=+S;O._addDevice(new k(this._deviceInputSystem,f,y))}}this._registeredManagers.push(O)},this.unregisterManager=O=>{const f=this._registeredManagers.indexOf(O);f>-1&&this._registeredManagers.splice(f,1)};const f=Object.keys(p).length/2;this._devices=new Array(f);const y=(O,f)=>{this._devices[O]||(this._devices[O]=new Array),this._devices[O][f]||(this._devices[O][f]=f);for(const y of this._registeredManagers){const S=new k(this._deviceInputSystem,O,f);y._addDevice(S)}},S=(O,f)=>{var y;null!==(y=this._devices[O])&&void 0!==y&&y[f]&&delete this._devices[O][f];for(const S of this._registeredManagers)S._removeDevice(O,f)},H=(O,f,y)=>{if(y)for(const S of this._registeredManagers)S._onInputChanged(O,f,y)};"undefined"!==typeof _native?this._deviceInputSystem=new g(y,S,H):this._deviceInputSystem=new s(O,y,S,H)}dispose(){this._deviceInputSystem.dispose()}}class c{getDeviceSource(O,f){if(void 0===f){if(void 0===this._firstDevice[O])return null;f=this._firstDevice[O]}return this._devices[O]&&void 0!==this._devices[O][f]?this._devices[O][f]:null}getDeviceSources(O){return this._devices[O]?this._devices[O].filter((O=>!!O)):[]}constructor(O){const f=Object.keys(p).length/2;this._devices=new Array(f),this._firstDevice=new Array(f),this._engine=O,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new z(O)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new b.d((O=>{for(const f of this._devices)if(f)for(const y of f)y&&this.onDeviceConnectedObservable.notifyObserver(O,y)})),this.onDeviceDisconnectedObservable=new b.d,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=O.hj.add((()=>{this.dispose()}))}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.hj.remove(this._onDisposeObserver)}_addDevice(O){this._devices[O.deviceType]||(this._devices[O.deviceType]=new Array),this._devices[O.deviceType][O.deviceSlot]||(this._devices[O.deviceType][O.deviceSlot]=O,this._updateFirstDevices(O.deviceType)),this.onDeviceConnectedObservable.notifyObservers(O)}_removeDevice(O,f){var y,S;const H=null===(y=this._devices[O])||void 0===y?void 0:y[f];this.onDeviceDisconnectedObservable.notifyObservers(H),null!==(S=this._devices[O])&&void 0!==S&&S[f]&&delete this._devices[O][f],this._updateFirstDevices(O)}_onInputChanged(O,f,y){var S,H;null===(S=this._devices[O])||void 0===S||null===(H=S[f])||void 0===H||H.onInputChangedObservable.notifyObservers(y)}_updateFirstDevices(O){switch(O){case p.Keyboard:case p.Mouse:this._firstDevice[O]=0;break;case p.Touch:case p.DualSense:case p.DualShock:case p.Xbox:case p.Switch:case p.Generic:{delete this._firstDevice[O];const f=this._devices[O];if(f)for(let y=0;y<f.length;y++)if(f[y]){this._firstDevice[O]=y;break}break}}}}var d=y(11423);class G{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get doubleClick(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(O){this._singleClick=O}set doubleClick(O){this._doubleClick=O}set hasSwiped(O){this._hasSwiped=O}set ignore(O){this._ignore=O}}class Y{constructor(O){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._activePointerIds=new Array,this._activePointerIdsCount=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new m.i(0,0),this._previousStartingPointerPosition=new m.i(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=O||B.c.LastCreatedScene,this._scene}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(O){return this._meshUnderPointerId[O]||null}get unTranslatedPointer(){return new m.i(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(O){this._pointerX=O}get pointerY(){return this._pointerY}set pointerY(O){this._pointerY=O}_updatePointerPosition(O){const f=this._scene.getEngine().getInputElementClientRect();f&&(this._pointerX=O.clientX-f.left,this._pointerY=O.clientY-f.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(O,f){const y=this._scene,S=y.getEngine(),H=S.getInputElement();H&&(H.tabIndex=S.canvasTabIndex,y.doNotHandleCursors||(H.style.cursor=y.defaultCursor)),this._setCursorAndPointerOverMesh(O,f,y);for(const N of y._pointerMoveStage){var b;const y=!(null===(b=O=O||this._pickMove(f))||void 0===b||!b.pickedMesh);O=N.action(this._unTranslatedPointerX,this._unTranslatedPointerY,O,y,H)}const h=f.inputIndex>=U.MouseWheelX&&f.inputIndex<=U.MouseWheelZ?u.b.POINTERWHEEL:u.b.POINTERMOVE;let v;y.onPointerMove&&(O=O||this._pickMove(f),y.onPointerMove(f,O,h)),O?(v=new u.j(h,f,O),this._setRayOnPointerInfo(O,f)):(v=new u.j(h,f,null,this),this._movePointerInfo=v),y.onPointerObservable.hasObservers()&&y.onPointerObservable.notifyObservers(v,h)}_setRayOnPointerInfo(O,f){const y=this._scene;O&&d.d._IsPickingAvailable&&(O.ray||(O.ray=y.createPickingRay(f.offsetX,f.offsetY,m.b.Identity(),y.activeCamera)))}_addCameraPointerObserver(O,f){return this._cameraObserverCount++,this._scene.onPointerObservable.add(O,f)}_removeCameraPointerObserver(O){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(O)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(O,f,y){const S=this._scene,H=new u.f(y,f,this._unTranslatedPointerX,this._unTranslatedPointerY);return O&&(H.originalPickingInfo=O,H.ray=O.ray,"xr-near"===f.pointerType&&O.originMesh&&(H.nearInteractionPickingInfo=O)),S.onPrePointerObservable.notifyObservers(H,y),!!H.skipOnPointerObservable}_pickMove(O){const f=this._scene,y=f.mc(this._unTranslatedPointerX,this._unTranslatedPointerY,f.pointerMovePredicate,f.pointerMoveFastCheck,f.cameraToUseForPointers,f.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(y,O,f),y}_setCursorAndPointerOverMesh(O,f,y){const S=y.getEngine().getInputElement();if(null!==O&&void 0!==O&&O.pickedMesh){if(this.setPointerOverMesh(O.pickedMesh,f.pointerId,O,f),!y.doNotHandleCursors&&S&&this._pointerOverMesh){const O=this._pointerOverMesh._getActionManagerForTrigger();O&&O.hasPointerTriggers&&(S.style.cursor=O.hoverCursor||y.hoverCursor)}}else this.setPointerOverMesh(null,f.pointerId,O,f)}simulatePointerMove(O,f){const y=new PointerEvent("pointermove",f);y.inputIndex=U.Move,this._checkPrePointerObservable(O,y,u.b.POINTERMOVE)||this._processPointerMove(O,y)}simulatePointerDown(O,f){const y=new PointerEvent("pointerdown",f);y.inputIndex=y.button+2,this._checkPrePointerObservable(O,y,u.b.POINTERDOWN)||this._processPointerDown(O,y)}_processPointerDown(O,f){var y;const S=this._scene;if(null!==(y=O)&&void 0!==y&&y.pickedMesh){this._pickedDownMesh=O.pickedMesh;const y=O.pickedMesh._getActionManagerForTrigger();if(y){if(y.hasPickTriggers)switch(y.processTrigger(5,I.CreateNew(O.pickedMesh,f,O)),f.button){case 0:y.processTrigger(2,I.CreateNew(O.pickedMesh,f,O));break;case 1:y.processTrigger(4,I.CreateNew(O.pickedMesh,f,O));break;case 2:y.processTrigger(3,I.CreateNew(O.pickedMesh,f,O))}y.hasSpecificTrigger(8)&&window.setTimeout((()=>{const O=S.mc(this._unTranslatedPointerX,this._unTranslatedPointerY,(O=>O.Mb&&O.isVisible&&O.isReady()&&O.actionManager&&O.actionManager.hasSpecificTrigger(8)&&O===this._pickedDownMesh),!1,S.cameraToUseForPointers);null!==O&&void 0!==O&&O.pickedMesh&&y&&0!==this._activePointerIdsCount&&Date.now()-this._startingPointerTime>Y.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,y.processTrigger(8,I.CreateNew(O.pickedMesh,f)))}),Y.LongPressDelay)}}else for(const h of S._pointerDownStage)O=h.action(this._unTranslatedPointerX,this._unTranslatedPointerY,O,f,!1);let H;const b=u.b.POINTERDOWN;O?(S.onPointerDown&&S.onPointerDown(f,O,b),H=new u.j(b,f,O),this._setRayOnPointerInfo(O,f)):H=new u.j(b,f,null,this),S.onPointerObservable.hasObservers()&&S.onPointerObservable.notifyObservers(H,b)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(O,f,y){const S=new PointerEvent("pointerup",f);S.inputIndex=U.Move;const H=new G;y?H.doubleClick=!0:H.singleClick=!0,this._checkPrePointerObservable(O,S,u.b.POINTERUP)||this._processPointerUp(O,S,H)}_processPointerUp(O,f,y){var S;const H=this._scene;if(null!==(S=O)&&void 0!==S&&S.pickedMesh){if(this._pickedUpMesh=O.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(H.onPointerPick&&H.onPointerPick(f,O),y.singleClick&&!y.ignore&&H.onPointerObservable.observers.length>this._cameraObserverCount)){const y=u.b.POINTERPICK,S=new u.j(y,f,O);this._setRayOnPointerInfo(O,f),H.onPointerObservable.notifyObservers(S,y)}const S=O.pickedMesh._getActionManagerForTrigger();if(S&&!y.ignore){S.processTrigger(7,I.CreateNew(O.pickedMesh,f,O)),!y.hasSwiped&&y.singleClick&&S.processTrigger(1,I.CreateNew(O.pickedMesh,f,O));const H=O.pickedMesh._getActionManagerForTrigger(6);y.doubleClick&&H&&H.processTrigger(6,I.CreateNew(O.pickedMesh,f,O))}}else if(!y.ignore)for(const b of H._pointerUpStage)O=b.action(this._unTranslatedPointerX,this._unTranslatedPointerY,O,f,y.doubleClick);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const O=this._pickedDownMesh._getActionManagerForTrigger(16);O&&O.processTrigger(16,I.CreateNew(this._pickedDownMesh,f))}if(!y.ignore){const S=new u.j(u.b.POINTERUP,f,O);if(this._setRayOnPointerInfo(O,f),H.onPointerObservable.notifyObservers(S,u.b.POINTERUP),H.onPointerUp&&H.onPointerUp(f,O,u.b.POINTERUP),!y.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let S=0;if(y.singleClick?S=u.b.POINTERTAP:y.doubleClick&&(S=u.b.POINTERDOUBLETAP),S){const y=new u.j(S,f,O);H.onPointerObservable.hasObservers()&&H.onPointerObservable.hasSpecificMask(S)&&H.onPointerObservable.notifyObservers(y,S)}}}}isPointerCaptured(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._pointerCaptures[O]}attachControl(){let O=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const H=this._scene,b=H.getEngine();S||(S=b.getInputElement()),this._alreadyAttached&&this.Qi(),S&&(this._alreadyAttachedTo=S),this._deviceSourceManager=new c(b),this._initActionManager=O=>{if(!this._meshPickProceed){const f=H.skipPointerUpPicking||0===H._registeredActions&&!this._checkForPicking()&&!H.onPointerUp?null:H.mc(this._unTranslatedPointerX,this._unTranslatedPointerY,H.pointerUpPredicate,H.pointerUpFastCheck,H.cameraToUseForPointers,H.pointerUpTrianglePredicate);this._currentPickResult=f,f&&(O=f.hit&&f.pickedMesh?f.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return O},this._delayedSimpleClick=(O,f,y)=>{if((Date.now()-this._previousStartingPointerTime>Y.DoubleClickDelay&&!this._doubleClickOccured||O!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,f.singleClick=!0,f.ignore=!1,this._delayedClicks[O])){const f=this._delayedClicks[O].evt,y=u.b.POINTERTAP,S=new u.j(y,f,this._currentPickResult);H.onPointerObservable.hasObservers()&&H.onPointerObservable.hasSpecificMask(y)&&H.onPointerObservable.notifyObservers(S,y),this._delayedClicks[O]=null}},this._initClickEvent=(O,f,y,S)=>{const H=new G;this._currentPickResult=null;let b=null,h=O.hasSpecificMask(u.b.POINTERPICK)||f.hasSpecificMask(u.b.POINTERPICK)||O.hasSpecificMask(u.b.POINTERTAP)||f.hasSpecificMask(u.b.POINTERTAP)||O.hasSpecificMask(u.b.POINTERDOUBLETAP)||f.hasSpecificMask(u.b.POINTERDOUBLETAP);!h&&L&&(b=this._initActionManager(b,H),b&&(h=b.hasPickTriggers));let v=!1;if(h){const h=y.button;if(H.hasSwiped=this._isPointerSwiping(),!H.hasSwiped){let t=!Y.ExclusiveDoubleClickMode;if(t||(t=!O.hasSpecificMask(u.b.POINTERDOUBLETAP)&&!f.hasSpecificMask(u.b.POINTERDOUBLETAP),t&&!L.HasSpecificTrigger(6)&&(b=this._initActionManager(b,H),b&&(t=!b.hasSpecificTrigger(6)))),t)(Date.now()-this._previousStartingPointerTime>Y.DoubleClickDelay||h!==this._previousButtonPressed)&&(H.singleClick=!0,S(H,this._currentPickResult),v=!0);else{const O={evt:y,clickInfo:H,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,h,H,S),Y.DoubleClickDelay)};this._delayedClicks[h]=O}let q=O.hasSpecificMask(u.b.POINTERDOUBLETAP)||f.hasSpecificMask(u.b.POINTERDOUBLETAP);if(!q&&L.HasSpecificTrigger(6)&&(b=this._initActionManager(b,H),b&&(q=b.hasSpecificTrigger(6))),q)if(h===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<Y.DoubleClickDelay&&!this._doubleClickOccured){if(H.hasSwiped||this._isPointerSwiping())if(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=h,Y.ExclusiveDoubleClickMode){var N;if(this._delayedClicks[h])clearTimeout(null===(N=this._delayedClicks[h])||void 0===N?void 0:N.timeoutId),this._delayedClicks[h]=null;S(H,this._previousPickResult)}else S(H,this._currentPickResult);else{var m;if(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,H.doubleClick=!0,H.ignore=!1,Y.ExclusiveDoubleClickMode&&this._delayedClicks[h])clearTimeout(null===(m=this._delayedClicks[h])||void 0===m?void 0:m.timeoutId),this._delayedClicks[h]=null;S(H,this._currentPickResult)}v=!0}else this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=h}}v||S(H,this._currentPickResult)},this._onPointerMove=O=>{if(this._updatePointerPosition(O),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>Y.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>Y.DragMovementThreshold),b.isPointerLock&&b._verifyPointerLock(),this._checkPrePointerObservable(null,O,O.inputIndex>=U.MouseWheelX&&O.inputIndex<=U.MouseWheelZ?u.b.POINTERWHEEL:u.b.POINTERMOVE))return;if(!H.cameraToUseForPointers&&!H.activeCamera)return;if(H.Zi)return void this._processPointerMove(new F.b,O);H.pointerMovePredicate||(H.pointerMovePredicate=O=>O.Mb&&O.isVisible&&O.isReady()&&O.isEnabled()&&(O.enablePointerMoveEvents||H.constantlyUpdateMeshUnderPointer||null!==O._getActionManagerForTrigger())&&(!H.cameraToUseForPointers||0!==(H.cameraToUseForPointers.layerMask&O.layerMask)));const f=H._registeredActions>0||H.constantlyUpdateMeshUnderPointer?this._pickMove(O):null;this._processPointerMove(f,O)},this._onPointerDown=O=>{const f=this._activePointerIds.indexOf(-1);if(-1===f?this._activePointerIds.push(O.pointerId):this._activePointerIds[f]=O.pointerId,this._activePointerIdsCount++,this._pickedDownMesh=null,this._meshPickProceed=!1,Y.ExclusiveDoubleClickMode)for(let S=0;S<this._delayedClicks.length;S++)if(this._delayedClicks[S])if(O.button===S){var y;clearTimeout(null===(y=this._delayedClicks[S])||void 0===y?void 0:y.timeoutId)}else{const O=this._delayedClicks[S].clickInfo;this._doubleClickOccured=!1,O.singleClick=!0,O.ignore=!1;const f=this._delayedClicks[S].evt,y=u.b.POINTERTAP,b=new u.j(y,f,this._currentPickResult);H.onPointerObservable.hasObservers()&&H.onPointerObservable.hasSpecificMask(y)&&H.onPointerObservable.notifyObservers(b,y),this._delayedClicks[S]=null}if(this._updatePointerPosition(O),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=O.button),H.preventDefaultOnPointerDown&&S&&(O.preventDefault(),S.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,O,u.b.POINTERDOWN))return;if(!H.cameraToUseForPointers&&!H.activeCamera)return;let b;this._pointerCaptures[O.pointerId]=!0,H.pointerDownPredicate||(H.pointerDownPredicate=O=>O.Mb&&O.isVisible&&O.isReady()&&O.isEnabled()&&(!H.cameraToUseForPointers||0!==(H.cameraToUseForPointers.layerMask&O.layerMask))),this._pickedDownMesh=null,b=H.skipPointerDownPicking||0===H._registeredActions&&!this._checkForPicking()&&!H.onPointerDown?new F.b:H.mc(this._unTranslatedPointerX,this._unTranslatedPointerY,H.pointerDownPredicate,H.pointerDownFastCheck,H.cameraToUseForPointers,H.pointerDownTrianglePredicate),this._processPointerDown(b,O)},this._onPointerUp=O=>{const f=this._activePointerIds.indexOf(O.pointerId);-1!==f&&(this._activePointerIds[f]=-1,this._activePointerIdsCount--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(O),H.preventDefaultOnPointerUp&&S&&(O.preventDefault(),S.focus()),this._initClickEvent(H.onPrePointerObservable,H.onPointerObservable,O,((f,y)=>{if(H.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!f.ignore)){if(this._checkPrePointerObservable(null,O,u.b.POINTERUP))return this._swipeButtonPressed===O.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),void(0===O.buttons&&(this._pointerCaptures[O.pointerId]=!1));f.hasSwiped||(f.singleClick&&H.onPrePointerObservable.hasSpecificMask(u.b.POINTERTAP)&&this._checkPrePointerObservable(null,O,u.b.POINTERTAP)&&(this._skipPointerTap=!0),f.doubleClick&&H.onPrePointerObservable.hasSpecificMask(u.b.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,O,u.b.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}this._pointerCaptures[O.pointerId]?(0===O.buttons&&(this._pointerCaptures[O.pointerId]=!1),(H.cameraToUseForPointers||H.activeCamera)&&(H.pointerUpPredicate||(H.pointerUpPredicate=O=>O.Mb&&O.isVisible&&O.isReady()&&O.isEnabled()&&(!H.cameraToUseForPointers||0!==(H.cameraToUseForPointers.layerMask&O.layerMask))),!this._meshPickProceed&&(L&&L.HasTriggers||this._checkForPicking()||H.onPointerUp)&&this._initActionManager(null,f),y||(y=this._currentPickResult),this._processPointerUp(y,O,f),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===O.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))):this._swipeButtonPressed===O.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1)})))},this._onKeyDown=O=>{const f=i.e.KEYDOWN;if(H.onPreKeyboardObservable.hasObservers()){const y=new i.f(f,O);if(H.onPreKeyboardObservable.notifyObservers(y,f),y.skipOnKeyboardObservable)return}if(H.onKeyboardObservable.hasObservers()){const y=new i.j(f,O);H.onKeyboardObservable.notifyObservers(y,f)}H.actionManager&&H.actionManager.processTrigger(14,I.CreateNewFromScene(H,O))},this._onKeyUp=O=>{const f=i.e.KEYUP;if(H.onPreKeyboardObservable.hasObservers()){const y=new i.f(f,O);if(H.onPreKeyboardObservable.notifyObservers(y,f),y.skipOnKeyboardObservable)return}if(H.onKeyboardObservable.hasObservers()){const y=new i.j(f,O);H.onKeyboardObservable.notifyObservers(y,f)}H.actionManager&&H.actionManager.processTrigger(15,I.CreateNewFromScene(H,O))},this._deviceSourceManager.onDeviceConnectedObservable.add((S=>{S.deviceType===p.Mouse?S.onInputChangedObservable.add((H=>{this._originMouseEvent=H,H.inputIndex===U.LeftClick||H.inputIndex===U.MiddleClick||H.inputIndex===U.RightClick||H.inputIndex===U.BrowserBack||H.inputIndex===U.BrowserForward?f&&1===S.getInput(H.inputIndex)?this._onPointerDown(H):O&&0===S.getInput(H.inputIndex)&&this._onPointerUp(H):y&&(H.inputIndex===U.Move?this._onPointerMove(H):H.inputIndex!==U.MouseWheelX&&H.inputIndex!==U.MouseWheelY&&H.inputIndex!==U.MouseWheelZ||this._onPointerMove(H))})):S.deviceType===p.Touch?S.onInputChangedObservable.add((H=>{H.inputIndex===U.LeftClick&&(f&&1===S.getInput(H.inputIndex)?(this._onPointerDown(H),this._activePointerIdsCount>1&&(this._isMultiTouchGesture=!0)):O&&0===S.getInput(H.inputIndex)&&(this._onPointerUp(H),0===this._activePointerIdsCount&&(this._isMultiTouchGesture=!1))),y&&H.inputIndex===U.Move&&this._onPointerMove(H)})):S.deviceType===p.Keyboard&&S.onInputChangedObservable.add((O=>{"keydown"===O.type?this._onKeyDown(O):"keyup"===O.type&&this._onKeyUp(O)}))})),this._alreadyAttached=!0}Qi(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0,S=arguments.length>3?arguments[3]:void 0;if(this._meshUnderPointerId[f]===O&&(!O||!O._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const H=this._meshUnderPointerId[f];let b;H&&(b=H._getActionManagerForTrigger(10),b&&b.processTrigger(10,I.CreateNew(H,S,{pointerId:f}))),O?(this._meshUnderPointerId[f]=O,this._pointerOverMesh=O,b=O._getActionManagerForTrigger(9),b&&b.processTrigger(9,I.CreateNew(O,S,{pointerId:f,pickResult:y}))):(delete this._meshUnderPointerId[f],this._pointerOverMesh=null)}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(O){this._pointerOverMesh===O&&(this._pointerOverMesh=null),this._pickedDownMesh===O&&(this._pickedDownMesh=null),this._pickedUpMesh===O&&(this._pickedUpMesh=null);for(const f in this._meshUnderPointerId)this._meshUnderPointerId[f]===O&&delete this._meshUnderPointerId[f]}}Y.DragMovementThreshold=10,Y.LongPressDelay=500,Y.DoubleClickDelay=300,Y.ExclusiveDoubleClickMode=!1;var Z=y(11166),a=y(11359),M=y(11430),P=y(11438),e=y(11051),K=y(11445),T=y(11338);class Q{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.Zi=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}var C,r=y(11017),n=y(11153);!function(O){O[O.BackwardCompatible=0]="BackwardCompatible",O[O.Intermediate=1]="Intermediate",O[O.Aggressive=2]="Aggressive"}(C||(C={}));class OO{static DefaultMaterialFactory(O){throw(0,j.d)("ob")}static CollisionCoordinatorFactory(){throw(0,j.d)("DefaultCollisionCoordinator")}get clearColor(){return this._clearColor}set clearColor(O){O!==this._clearColor&&(this._clearColor=O,this.onClearColorChangedObservable.notifyObservers(this._clearColor))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get performancePriority(){return this._performancePriority}set performancePriority(O){if(O!==this._performancePriority){switch(this._performancePriority=O,O){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.Zi=!1,this.Ri=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.Zi=!0,this.Ri=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.Zi=!0,this.Ri=!1}this.onScenePerformancePriorityChangedObservable.notifyObservers(O)}}set forceWireframe(O){this._forceWireframe!==O&&(this._forceWireframe=O,this.markAllMaterialsAsDirty(16))}get forceWireframe(){return this._forceWireframe}set skipFrustumClipping(O){this._skipFrustumClipping!==O&&(this._skipFrustumClipping=O)}get skipFrustumClipping(){return this._skipFrustumClipping}set forcePointsCloud(O){this._forcePointsCloud!==O&&(this._forcePointsCloud=O,this.markAllMaterialsAsDirty(16))}get forcePointsCloud(){return this._forcePointsCloud}get environmentTexture(){return this._environmentTexture}set environmentTexture(O){this._environmentTexture!==O&&(this._environmentTexture=O,this.markAllMaterialsAsDirty(1))}getNodes(){let O=[];return O=O.concat(this.meshes),O=O.concat(this.lights),O=O.concat(this.cameras),O=O.concat(this.transformNodes),this.skeletons.forEach((f=>O=O.concat(f.bones))),O}get animationPropertiesOverride(){return this._animationPropertiesOverride}set animationPropertiesOverride(O){this._animationPropertiesOverride=O}set onDispose(O){this._onDisposeObserver&&this.hj.remove(this._onDisposeObserver),this._onDisposeObserver=this.hj.add(O)}set beforeRender(O){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),O&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(O))}set afterRender(O){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),O&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(O))}set beforeCameraRender(O){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(O)}set afterCameraRender(O){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(O)}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}set pointerDownPredicate(O){this._pointerPickingConfiguration.pointerDownPredicate=O}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}set pointerUpPredicate(O){this._pointerPickingConfiguration.pointerUpPredicate=O}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}set pointerMovePredicate(O){this._pointerPickingConfiguration.pointerMovePredicate=O}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}set pointerDownFastCheck(O){this._pointerPickingConfiguration.pointerDownFastCheck=O}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}set pointerUpFastCheck(O){this._pointerPickingConfiguration.pointerUpFastCheck=O}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}set pointerMoveFastCheck(O){this._pointerPickingConfiguration.pointerMoveFastCheck=O}get Zi(){return this._pointerPickingConfiguration.Zi}set Zi(O){this._pointerPickingConfiguration.Zi=O}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}set skipPointerDownPicking(O){this._pointerPickingConfiguration.skipPointerDownPicking=O}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}set skipPointerUpPicking(O){this._pointerPickingConfiguration.skipPointerUpPicking=O}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}static get DragMovementThreshold(){return Y.DragMovementThreshold}static set DragMovementThreshold(O){Y.DragMovementThreshold=O}static get LongPressDelay(){return Y.LongPressDelay}static set LongPressDelay(O){Y.LongPressDelay=O}static get DoubleClickDelay(){return Y.DoubleClickDelay}static set DoubleClickDelay(O){Y.DoubleClickDelay=O}static get ExclusiveDoubleClickMode(){return Y.ExclusiveDoubleClickMode}static set ExclusiveDoubleClickMode(O){Y.ExclusiveDoubleClickMode=O}bindEyePosition(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vEyePosition",y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:this.activeCamera.globalPosition,H=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return m.g.Vector4[0].set(S.x,S.y,S.z,H?-1:1),O&&(y?O.setFloat3(f,m.g.Vector4[0].x,m.g.Vector4[0].y,m.g.Vector4[0].z):O.setVector4(f,m.g.Vector4[0])),m.g.Vector4[0]}finalizeSceneUbo(){const O=this.getSceneUniformBuffer(),f=this.bindEyePosition(null);return O.updateFloat4("vEyePosition",f.x,f.y,f.z,f.w),O.update(),O}set useRightHandedSystem(O){this._useRightHandedSystem!==O&&(this._useRightHandedSystem=O,this.markAllMaterialsAsDirty(16))}get useRightHandedSystem(){return this._useRightHandedSystem}setStepId(O){this._currentStepId=O}getStepId(){return this._currentStepId}getInternalStep(){return this._currentInternalStep}set fogEnabled(O){this._fogEnabled!==O&&(this._fogEnabled=O,this.markAllMaterialsAsDirty(16))}get fogEnabled(){return this._fogEnabled}set fogMode(O){this._fogMode!==O&&(this._fogMode=O,this.markAllMaterialsAsDirty(16))}get fogMode(){return this._fogMode}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set shadowsEnabled(O){this._shadowsEnabled!==O&&(this._shadowsEnabled=O,this.markAllMaterialsAsDirty(2))}get shadowsEnabled(){return this._shadowsEnabled}set lightsEnabled(O){this._lightsEnabled!==O&&(this._lightsEnabled=O,this.markAllMaterialsAsDirty(2))}get lightsEnabled(){return this._lightsEnabled}get activeCameras(){return this._activeCameras}set activeCameras(O){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),O&&(this._unObserveActiveCameras=(0,T.i)(O,(()=>{this.onActiveCamerasChanged.notifyObservers(this)}))),this._activeCameras=O}get activeCamera(){return this._activeCamera}set activeCamera(O){O!==this._activeCamera&&(this._activeCamera=O,this.onActiveCameraChanged.notifyObservers(this))}get defaultMaterial(){return this.si||(this.si=OO.DefaultMaterialFactory(this)),this.si}set defaultMaterial(O){this.si=O}set texturesEnabled(O){this._texturesEnabled!==O&&(this._texturesEnabled=O,this.markAllMaterialsAsDirty(1))}get texturesEnabled(){return this._texturesEnabled}get frameGraph(){return this._frameGraph}set frameGraph(O){if(this._frameGraph)return this._frameGraph=O,void(O||(this.customRenderFunction=this._currentCustomRenderFunction));this._frameGraph=O,O&&(this._currentCustomRenderFunction=this.customRenderFunction,this.customRenderFunction=this._renderWithFrameGraph)}set skeletonsEnabled(O){this._skeletonsEnabled!==O&&(this._skeletonsEnabled=O,this.markAllMaterialsAsDirty(8))}get skeletonsEnabled(){return this._skeletonsEnabled}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=OO.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get renderingManager(){return this._renderingManager}get frustumPlanes(){return this._frustumPlanes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const O of this._transientComponents)O.register();this._transientComponents.length=0}}o(O){this._components.push(O),this._transientComponents.push(O);const f=O;f.addFromContainer&&f.serialize&&this._serializableComponents.push(f)}_getComponent(O){for(const f of this._components)if(f.name===O)return f;return null}constructor(O,f){this._inputManager=new Y(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.Ri=!0,this.autoClearDepthAndStencil=!0,this._clearColor=new a.g(.2,.2,.3,1),this.onClearColorChangedObservable=new b.d,this.ambientColor=new a.d(0,0,0),this.environmentIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new b.d,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.oj=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.effectLayers=[],this.Zj=null,this.layers=[],this.lensFlareSystems=[],this.proceduralTextures=[],this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.hj=new b.d,this._onDisposeObserver=null,this.onBeforeRenderObservable=new b.d,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new b.d,this.onAfterRenderCameraObservable=new b.d,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new b.d,this.onAfterAnimationsObservable=new b.d,this.onBeforeDrawPhaseObservable=new b.d,this.onAfterDrawPhaseObservable=new b.d,this.onReadyObservable=new b.d,this.onBeforeCameraRenderObservable=new b.d,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new b.d,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new b.d,this.onAfterActiveMeshesEvaluationObservable=new b.d,this.onBeforeParticlesRenderingObservable=new b.d,this.onAfterParticlesRenderingObservable=new b.d,this.onDataLoadedObservable=new b.d,this.onNewCameraAddedObservable=new b.d,this.onCameraRemovedObservable=new b.d,this.onNewLightAddedObservable=new b.d,this.onLightRemovedObservable=new b.d,this.onNewGeometryAddedObservable=new b.d,this.onGeometryRemovedObservable=new b.d,this.onNewTransformNodeAddedObservable=new b.d,this.onTransformNodeRemovedObservable=new b.d,this.onNewMeshAddedObservable=new b.d,this.onMeshRemovedObservable=new b.d,this.onNewSkeletonAddedObservable=new b.d,this.onSkeletonRemovedObservable=new b.d,this.onNewMaterialAddedObservable=new b.d,this.onNewMultiMaterialAddedObservable=new b.d,this.onMaterialRemovedObservable=new b.d,this.onMultiMaterialRemovedObservable=new b.d,this.onNewTextureAddedObservable=new b.d,this.onTextureRemovedObservable=new b.d,this.onBeforeRenderTargetsRenderObservable=new b.d,this.onAfterRenderTargetsRenderObservable=new b.d,this.onBeforeStepObservable=new b.d,this.onAfterStepObservable=new b.d,this.onActiveCameraChanged=new b.d,this.onActiveCamerasChanged=new b.d,this.onBeforeRenderingGroupObservable=new b.d,this.onAfterRenderingGroupObservable=new b.d,this.onMeshImportedObservable=new b.d,this.onAnimationFileImportedObservable=new b.d,this._registeredForLateAnimationBindings=new h.c(256),this._pointerPickingConfiguration=new Q,this.onPrePointerObservable=new b.d,this.onPointerObservable=new b.d,this.onPreKeyboardObservable=new b.d,this.onKeyboardObservable=new b.d,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=OO.FOGMODE_NONE,this.fogColor=new a.d(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this._frameGraph=null,this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new m.m(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new h.c(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new Z.d,this._activeIndices=new Z.d,this._activeParticles=new Z.d,this._activeBones=new Z.d,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=new Array,this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new h.g(256),this._processedMaterials=new h.g(256),this._renderTargets=new h.c(256),this._materialsRenderTargets=new h.c(256),this._activeParticleSystems=new h.g(256),this._activeSkeletons=new h.c(32),this._softwareSkinnedMeshes=new h.c(32),this._activeAnimatables=new Array,this._transformMatrix=m.b.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=X.e.Create(),this._beforeClearStage=X.e.Create(),this._beforeRenderTargetClearStage=X.e.Create(),this._gatherRenderTargetsStage=X.e.Create(),this._gatherActiveCameraRenderTargetsStage=X.e.Create(),this._isReadyForMeshStage=X.e.Create(),this._beforeEvaluateActiveMeshStage=X.e.Create(),this._evaluateSubMeshStage=X.e.Create(),this._preActiveMeshStage=X.e.Create(),this._cameraDrawRenderTargetStage=X.e.Create(),this._beforeCameraDrawStage=X.e.Create(),this._beforeRenderTargetDrawStage=X.e.Create(),this._beforeRenderingGroupDrawStage=X.e.Create(),this._beforeRenderingMeshStage=X.e.Create(),this._afterRenderingMeshStage=X.e.Create(),this._afterRenderingGroupDrawStage=X.e.Create(),this._afterCameraDrawStage=X.e.Create(),this._afterCameraPostProcessStage=X.e.Create(),this._afterRenderTargetDrawStage=X.e.Create(),this._afterRenderTargetPostProcessStage=X.e.Create(),this._afterRenderStage=X.e.Create(),this._pointerMoveStage=X.e.Create(),this._pointerDownStage=X.e.Create(),this._pointerUpStage=X.e.Create(),this._geometriesByUniqueId=null,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[];const y={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...f};O=this._engine=O||B.c.LastCreatedEngine,y.virtual?O._virtualScenes.push(this):(B.c._LastCreatedScene=this,O.scenes.push(this)),this._uid=null,this._renderingManager=new J.d(this),A.e&&(this.postProcessManager=new A.e(this)),(0,w.h)()&&this.attachControl(),this._createUbo(),t.c&&(this._imageProcessingConfiguration=new t.c),this.setDefaultCandidateProviders(),y.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=y.useMaterialMeshMap,this.useClonedMeshMap=y.useClonedMeshMap,f&&f.virtual||O.onNewSceneAddedObservable.notifyObservers(this)}getClassName(){return"Scene"}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_getDefaultSubMeshCandidates(O){return this._defaultSubMeshCandidates.data=O.Yf,this._defaultSubMeshCandidates.length=O.Yf.length,this._defaultSubMeshCandidates}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=O=>this._getDefaultSubMeshCandidates(O),this.getIntersectingSubMeshCandidates=(O,f)=>this._getDefaultSubMeshCandidates(O),this.getCollidingSubMeshCandidates=(O,f)=>this._getDefaultSubMeshCandidates(O)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}get pointerX(){return this._inputManager.pointerX}set pointerX(O){this._inputManager.pointerX=O}get pointerY(){return this._inputManager.pointerY}set pointerY(O){this._inputManager.pointerY=O}getCachedMaterial(){return this._cachedMaterial}getCachedEffect(){return this._cachedEffect}getCachedVisibility(){return this._cachedVisibility}isCachedMaterialInvalid(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this._cachedEffect!==f||this._cachedMaterial!==O||this._cachedVisibility!==y}getEngine(){return this._engine}getTotalVertices(){return this._totalVertices.current}get totalVerticesPerfCounter(){return this._totalVertices}getActiveIndices(){return this._activeIndices.current}get totalActiveIndicesPerfCounter(){return this._activeIndices}getActiveParticles(){return this._activeParticles.current}get activeParticlesPerfCounter(){return this._activeParticles}getActiveBones(){return this._activeBones.current}get activeBonesPerfCounter(){return this._activeBones}getActiveMeshes(){return this._activeMeshes}getAnimationRatio(){return void 0!==this._animationRatio?this._animationRatio:1}getRenderId(){return this._renderId}getFrameId(){return this._frameId}incrementRenderId(){this._renderId++}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}simulatePointerMove(O,f){return this._inputManager.simulatePointerMove(O,f),this}simulatePointerDown(O,f){return this._inputManager.simulatePointerDown(O,f),this}simulatePointerUp(O,f,y){return this._inputManager.simulatePointerUp(O,f,y),this}isPointerCaptured(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._inputManager.isPointerCaptured(O)}attachControl(){let O=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._inputManager.attachControl(O,f,y)}Qi(){this._inputManager.Qi()}isReady(){var O,f;let y,S=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._isDisposed)return!1;const H=this.getEngine(),b=H.currentRenderPassId;H.currentRenderPassId=(null===(O=this.activeCamera)||void 0===O?void 0:O.renderPassId)??b;let h=!0;for(this._pendingData.length>0&&(h=!1),null===(f=this.prePassRenderer)||void 0===f||f.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&h&&(h=this.depthPeelingRenderer.isReady()),S&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),y=0;y<this.meshes.length;y++){const O=this.meshes[y];if(!O.Yf||0===O.Yf.length)continue;if(!O.isReady(!0)){h=!1;continue}const f=O.hasThinInstances||"InstancedMesh"===O.getClassName()||"InstancedLinesMesh"===O.getClassName()||H.getCaps().instancedArrays&&O.instances.length>0;for(const y of this._isReadyForMeshStage)y.action(O,f)||(h=!1);if(!S)continue;const b=O.material||this.defaultMaterial;if(b)if(b._storeEffectOnSubMeshes)for(const y of O.Yf){const O=y.Ha();O&&O.hasRenderTargetTextures&&null!=O.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(O)&&(this._processedMaterials.push(O),this._materialsRenderTargets.concatWithNoDuplicate(O.getRenderTargetTextures()))}else b.hasRenderTargetTextures&&null!=b.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(b)&&(this._processedMaterials.push(b),this._materialsRenderTargets.concatWithNoDuplicate(b.getRenderTargetTextures()))}if(S)for(y=0;y<this._materialsRenderTargets.length;++y){this._materialsRenderTargets.data[y].isReadyForRendering()||(h=!1)}for(y=0;y<this.geometries.length;y++){2===this.geometries[y].delayLoadState&&(h=!1)}if(this.activeCameras&&this.activeCameras.length>0)for(const v of this.activeCameras)v.isReady(!0)||(h=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(h=!1));for(const v of this.oj)v.isReady()||(h=!1);if(this.layers)for(const v of this.layers)v.isReady()||(h=!1);return H.areAllEffectsReady()||(h=!1),H.currentRenderPassId=b,h}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}registerBeforeRender(O){this.onBeforeRenderObservable.add(O)}unregisterBeforeRender(O){this.onBeforeRenderObservable.removeCallback(O)}registerAfterRender(O){this.onAfterRenderObservable.add(O)}unregisterAfterRender(O){this.onAfterRenderObservable.removeCallback(O)}_executeOnceBeforeRender(O){const f=()=>{O(),setTimeout((()=>{this.unregisterBeforeRender(f)}))};this.registerBeforeRender(f)}executeOnceBeforeRender(O,f){void 0!==f?setTimeout((()=>{this._executeOnceBeforeRender(O)}),f):this._executeOnceBeforeRender(O)}addPendingData(O){this._pendingData.push(O)}removePendingData(O){const f=this.isLoading,y=this._pendingData.indexOf(O);-1!==y&&this._pendingData.splice(y,1),f&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}getWaitingItemsCount(){return this._pendingData.length}get isLoading(){return this._pendingData.length>0}executeWhenReady(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.onReadyObservable.addOnce(O),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(f)}whenReadyAsync(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise((f=>{this.executeWhenReady((()=>{f()}),O)}))}_checkIsReady(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._registerTransientComponents(),this.isReady(O)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((()=>{this.incrementRenderId(),this._checkIsReady(O)}),100))}get animatables(){return this._activeAnimatables}resetLastAnimationTimeFrame(){this._animationTimeLast=H.b.Now}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projectionMatrix}getTransformMatrix(){return this._transformMatrix}setTransformMatrix(O,f,y,S){y||S||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===O.updateFlag&&this._projectionUpdateFlag===f.updateFlag||(this._viewUpdateFlag=O.updateFlag,this._projectionUpdateFlag=f.updateFlag,this._viewMatrix=O,this._projectionMatrix=f,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?M.c.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=M.c.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(y,S):this._sceneUbo.useUbo&&(this._sceneUbo.Fj("viewProjection",this._transformMatrix),this._sceneUbo.Fj("view",this._viewMatrix),this._sceneUbo.Fj("projection",this._projectionMatrix)))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}createSceneUniformBuffer(O){const f=new q.b(this._engine,void 0,!1,O??"yd");return f.addUniform("viewProjection",16),f.addUniform("view",16),f.addUniform("projection",16),f.addUniform("vEyePosition",4),f}setSceneUniformBuffer(O){this._sceneUbo=O,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}getUniqueId(){return P.b.UniqueId}ji(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._blockEntityCollection||(this.meshes.push(O),O._resyncLightSources(),O.parent||O._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(O),f&&O.getChildMeshes().forEach((O=>{this.ji(O)})))}xd(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const y=this.meshes.indexOf(O);return-1!==y&&(this.meshes.splice(y,1),O.parent||O._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(O),this.onMeshRemovedObservable.notifyObservers(O),f&&O.getChildMeshes().forEach((O=>{this.xd(O)})),y}addTransformNode(O){this._blockEntityCollection||O.va()===this&&-1!==O._indexInSceneTransformNodesArray||(O._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(O),O.parent||O._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(O))}removeTransformNode(O){const f=O._indexInSceneTransformNodesArray;if(-1!==f){if(f!==this.transformNodes.length-1){const O=this.transformNodes[this.transformNodes.length-1];this.transformNodes[f]=O,O._indexInSceneTransformNodesArray=f}O._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),O.parent||O._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(O),f}removeSkeleton(O){const f=this.skeletons.indexOf(O);return-1!==f&&(this.skeletons.splice(f,1),this.onSkeletonRemovedObservable.notifyObservers(O),this._executeActiveContainerCleanup(this._activeSkeletons)),f}removeMorphTargetManager(O){const f=this.morphTargetManagers.indexOf(O);return-1!==f&&this.morphTargetManagers.splice(f,1),f}removeLight(O){const f=this.lights.indexOf(O);if(-1!==f){for(const f of this.meshes)f._removeLightSource(O,!1);this.lights.splice(f,1),this.sortLightsByPriority(),O.parent||O._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(O),f}removeCamera(O){const f=this.cameras.indexOf(O);if(-1!==f&&(this.cameras.splice(f,1),O.parent||O._removeFromSceneRootNodes()),this.activeCameras){const f=this.activeCameras.indexOf(O);-1!==f&&this.activeCameras.splice(f,1)}return this.activeCamera===O&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(O),f}removeParticleSystem(O){const f=this.oj.indexOf(O);return-1!==f&&(this.oj.splice(f,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),f}removeAnimation(O){const f=this.animations.indexOf(O);return-1!==f&&this.animations.splice(f,1),f}stopAnimation(O,f,y){}removeAnimationGroup(O){const f=this.animationGroups.indexOf(O);return-1!==f&&this.animationGroups.splice(f,1),f}removeMultiMaterial(O){const f=this.multiMaterials.indexOf(O);return-1!==f&&this.multiMaterials.splice(f,1),this.onMultiMaterialRemovedObservable.notifyObservers(O),f}removeMaterial(O){const f=O._indexInSceneMaterialArray;if(-1!==f&&f<this.materials.length){if(f!==this.materials.length-1){const O=this.materials[this.materials.length-1];this.materials[f]=O,O._indexInSceneMaterialArray=f}O._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(O),f}removeActionManager(O){const f=this.actionManagers.indexOf(O);return-1!==f&&this.actionManagers.splice(f,1),f}removeTexture(O){const f=this.textures.indexOf(O);return-1!==f&&this.textures.splice(f,1),this.onTextureRemovedObservable.notifyObservers(O),f}addLight(O){if(!this._blockEntityCollection){this.lights.push(O),this.sortLightsByPriority(),O.parent||O._addToSceneRootNodes();for(const f of this.meshes)-1===f.lightSources.indexOf(O)&&(f.lightSources.push(O),f._resyncLightSources());this.onNewLightAddedObservable.notifyObservers(O)}}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(K.d.CompareLightsPriority)}addCamera(O){this._blockEntityCollection||(this.cameras.push(O),this.onNewCameraAddedObservable.notifyObservers(O),O.parent||O._addToSceneRootNodes())}addSkeleton(O){this._blockEntityCollection||(this.skeletons.push(O),this.onNewSkeletonAddedObservable.notifyObservers(O))}addParticleSystem(O){this._blockEntityCollection||this.oj.push(O)}addAnimation(O){this._blockEntityCollection||this.animations.push(O)}addAnimationGroup(O){this._blockEntityCollection||this.animationGroups.push(O)}addMultiMaterial(O){this._blockEntityCollection||(this.multiMaterials.push(O),this.onNewMultiMaterialAddedObservable.notifyObservers(O))}addMaterial(O){this._blockEntityCollection||O.va()===this&&-1!==O._indexInSceneMaterialArray||(O._indexInSceneMaterialArray=this.materials.length,this.materials.push(O),this.onNewMaterialAddedObservable.notifyObservers(O))}addMorphTargetManager(O){this._blockEntityCollection||this.morphTargetManagers.push(O)}addGeometry(O){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[O.uniqueId]=this.geometries.length),this.geometries.push(O))}addActionManager(O){this.actionManagers.push(O)}addTexture(O){this._blockEntityCollection||(this.textures.push(O),this.onNewTextureAddedObservable.notifyObservers(O))}switchActiveCamera(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.Qi(),this.activeCamera=O,f&&O.attachControl())}setActiveCameraById(O){const f=this.getCameraById(O);return f?(this.activeCamera=f,f):null}setActiveCameraByName(O){const f=this.getCameraByName(O);return f?(this.activeCamera=f,f):null}getAnimationGroupByName(O){for(let f=0;f<this.animationGroups.length;f++)if(this.animationGroups[f].name===O)return this.animationGroups[f];return null}_getMaterial(O,f){for(let y=0;y<this.materials.length;y++){const O=this.materials[y];if(f(O))return O}if(O)for(let y=0;y<this.multiMaterials.length;y++){const O=this.multiMaterials[y];if(f(O))return O}return null}getMaterialByUniqueID(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(f,(f=>f.uniqueId===O))}getMaterialById(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(f,(f=>f.id===O))}getMaterialByName(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(f,(f=>f.name===O))}getLastMaterialById(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(let y=this.materials.length-1;y>=0;y--)if(this.materials[y].id===O)return this.materials[y];if(f)for(let y=this.multiMaterials.length-1;y>=0;y--)if(this.multiMaterials[y].id===O)return this.multiMaterials[y];return null}getTextureByUniqueId(O){for(let f=0;f<this.textures.length;f++)if(this.textures[f].uniqueId===O)return this.textures[f];return null}getTextureByName(O){for(let f=0;f<this.textures.length;f++)if(this.textures[f].name===O)return this.textures[f];return null}getCameraById(O){for(let f=0;f<this.cameras.length;f++)if(this.cameras[f].id===O)return this.cameras[f];return null}getCameraByUniqueId(O){for(let f=0;f<this.cameras.length;f++)if(this.cameras[f].uniqueId===O)return this.cameras[f];return null}getCameraByName(O){for(let f=0;f<this.cameras.length;f++)if(this.cameras[f].name===O)return this.cameras[f];return null}getBoneById(O){for(let f=0;f<this.skeletons.length;f++){const y=this.skeletons[f];for(let f=0;f<y.bones.length;f++)if(y.bones[f].id===O)return y.bones[f]}return null}getBoneByName(O){for(let f=0;f<this.skeletons.length;f++){const y=this.skeletons[f];for(let f=0;f<y.bones.length;f++)if(y.bones[f].name===O)return y.bones[f]}return null}getLightByName(O){for(let f=0;f<this.lights.length;f++)if(this.lights[f].name===O)return this.lights[f];return null}getLightById(O){for(let f=0;f<this.lights.length;f++)if(this.lights[f].id===O)return this.lights[f];return null}getLightByUniqueId(O){for(let f=0;f<this.lights.length;f++)if(this.lights[f].uniqueId===O)return this.lights[f];return null}getParticleSystemById(O){for(let f=0;f<this.oj.length;f++)if(this.oj[f].id===O)return this.oj[f];return null}getGeometryById(O){for(let f=0;f<this.geometries.length;f++)if(this.geometries[f].id===O)return this.geometries[f];return null}_getGeometryByUniqueId(O){if(this._geometriesByUniqueId){const f=this._geometriesByUniqueId[O];if(void 0!==f)return this.geometries[f]}else for(let f=0;f<this.geometries.length;f++)if(this.geometries[f].uniqueId===O)return this.geometries[f];return null}pushGeometry(O,f){return!(!f&&this._getGeometryByUniqueId(O.uniqueId))&&(this.addGeometry(O),this.onNewGeometryAddedObservable.notifyObservers(O),!0)}removeGeometry(O){let f;if(this._geometriesByUniqueId){if(f=this._geometriesByUniqueId[O.uniqueId],void 0===f)return!1}else if(f=this.geometries.indexOf(O),f<0)return!1;if(f!==this.geometries.length-1){const O=this.geometries[this.geometries.length-1];O&&(this.geometries[f]=O,this._geometriesByUniqueId&&(this._geometriesByUniqueId[O.uniqueId]=f))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[O.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(O),!0}getGeometries(){return this.geometries}getMeshById(O){for(let f=0;f<this.meshes.length;f++)if(this.meshes[f].id===O)return this.meshes[f];return null}getMeshesById(O){return this.meshes.filter((function(f){return f.id===O}))}getTransformNodeById(O){for(let f=0;f<this.transformNodes.length;f++)if(this.transformNodes[f].id===O)return this.transformNodes[f];return null}getTransformNodeByUniqueId(O){for(let f=0;f<this.transformNodes.length;f++)if(this.transformNodes[f].uniqueId===O)return this.transformNodes[f];return null}getTransformNodesById(O){return this.transformNodes.filter((function(f){return f.id===O}))}getMeshByUniqueId(O){for(let f=0;f<this.meshes.length;f++)if(this.meshes[f].uniqueId===O)return this.meshes[f];return null}getLastMeshById(O){for(let f=this.meshes.length-1;f>=0;f--)if(this.meshes[f].id===O)return this.meshes[f];return null}getLastTransformNodeById(O){for(let f=this.transformNodes.length-1;f>=0;f--)if(this.transformNodes[f].id===O)return this.transformNodes[f];return null}getLastEntryById(O){let f;for(f=this.meshes.length-1;f>=0;f--)if(this.meshes[f].id===O)return this.meshes[f];for(f=this.transformNodes.length-1;f>=0;f--)if(this.transformNodes[f].id===O)return this.transformNodes[f];for(f=this.cameras.length-1;f>=0;f--)if(this.cameras[f].id===O)return this.cameras[f];for(f=this.lights.length-1;f>=0;f--)if(this.lights[f].id===O)return this.lights[f];return null}getNodeById(O){const f=this.getMeshById(O);if(f)return f;const y=this.getTransformNodeById(O);if(y)return y;const S=this.getLightById(O);if(S)return S;const H=this.getCameraById(O);if(H)return H;const b=this.getBoneById(O);return b||null}getNodeByName(O){const f=this.getMeshByName(O);if(f)return f;const y=this.getTransformNodeByName(O);if(y)return y;const S=this.getLightByName(O);if(S)return S;const H=this.getCameraByName(O);if(H)return H;const b=this.getBoneByName(O);return b||null}getMeshByName(O){for(let f=0;f<this.meshes.length;f++)if(this.meshes[f].name===O)return this.meshes[f];return null}getTransformNodeByName(O){for(let f=0;f<this.transformNodes.length;f++)if(this.transformNodes[f].name===O)return this.transformNodes[f];return null}getLastSkeletonById(O){for(let f=this.skeletons.length-1;f>=0;f--)if(this.skeletons[f].id===O)return this.skeletons[f];return null}getSkeletonByUniqueId(O){for(let f=0;f<this.skeletons.length;f++)if(this.skeletons[f].uniqueId===O)return this.skeletons[f];return null}getSkeletonById(O){for(let f=0;f<this.skeletons.length;f++)if(this.skeletons[f].id===O)return this.skeletons[f];return null}getSkeletonByName(O){for(let f=0;f<this.skeletons.length;f++)if(this.skeletons[f].name===O)return this.skeletons[f];return null}getMorphTargetManagerById(O){for(let f=0;f<this.morphTargetManagers.length;f++)if(this.morphTargetManagers[f].uniqueId===O)return this.morphTargetManagers[f];return null}getMorphTargetById(O){for(let f=0;f<this.morphTargetManagers.length;++f){const y=this.morphTargetManagers[f];for(let f=0;f<y.numTargets;++f){const S=y.getTarget(f);if(S.id===O)return S}}return null}getMorphTargetByName(O){for(let f=0;f<this.morphTargetManagers.length;++f){const y=this.morphTargetManagers[f];for(let f=0;f<y.numTargets;++f){const S=y.getTarget(f);if(S.name===O)return S}}return null}getPostProcessByName(O){for(let f=0;f<this.postProcesses.length;++f){const y=this.postProcesses[f];if(y.name===O)return y}return null}isActiveMesh(O){return-1!==this._activeMeshes.indexOf(O)}get uid(){return this._uid||(this._uid=S.d.RandomId()),this._uid}addExternalData(O,f){return this._externalData||(this._externalData=new v),this._externalData.add(O,f)}getExternalData(O){return this._externalData?this._externalData.get(O):null}getOrAddExternalDataWithFactory(O,f){return this._externalData||(this._externalData=new v),this._externalData.getOrAddWithFactory(O,f)}removeExternalData(O){return this._externalData.remove(O)}_evaluateSubMesh(O,f,y,S){if(S||O.isInFrustum(this._frustumPlanes)){for(const S of this._evaluateSubMeshStage)S.action(f,O);const y=O.Ha();null!==y&&void 0!==y&&(y.hasRenderTargetTextures&&null!=y.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(y)&&(this._processedMaterials.push(y),this._materialsRenderTargets.concatWithNoDuplicate(y.getRenderTargetTextures())),this._renderingManager.dispatch(O,f,y))}}freeProcessedMaterials(){this._processedMaterials.dispose()}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set blockfreeActiveMeshesAndRenderingGroups(O){this._preventFreeActiveMeshesAndRenderingGroups!==O&&(O&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=O)}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let O=0;O<this.activeCameras.length;O++){const f=this.activeCameras[O];f&&f._activeMeshes&&f._activeMeshes.dispose()}}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let O=0;O<this.textures.length;O++){const f=this.textures[O];f&&f.renderList&&f.freeRenderingGroups()}}_isInIntermediateRendering(){return this._intermediateRendering}freezeActiveMeshes(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1?arguments[1]:void 0,y=arguments.length>2?arguments[2]:void 0,S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],H=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.executeWhenReady((()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=H,this._skipEvaluateActiveMeshesCompletely=O,S)for(let O=0;O<this._activeMeshes.length;O++)this._activeMeshes.data[O]._freeze();f&&f()}else y&&y("No active camera found")})),this}unfreezeActiveMeshes(){for(let O=0;O<this.meshes.length;O++){const f=this.meshes[O];f._internalAbstractMeshDataInfo&&(f._internalAbstractMeshDataInfo._isActive=!1)}for(let O=0;O<this._activeMeshes.length;O++)this._activeMeshes.data[O]._unFreeze();return this._activeMeshesFrozen=!1,this}_executeActiveContainerCleanup(O){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((()=>O.dispose()))}_evaluateActiveMeshes(){if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode){var O;if(this._activeMeshes.length>0)null===(O=this.activeCamera)||void 0===O||O._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();return}if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const O=this._activeMeshes.length;for(let f=0;f<O;f++){this._activeMeshes.data[f].Mj()}}if(this._activeParticleSystems){const O=this._activeParticleSystems.length;for(let f=0;f<O;f++)this._activeParticleSystems.data[f].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const S of this._beforeEvaluateActiveMeshStage)S.action();const f=this.getActiveMeshCandidates(),y=f.length;for(let S=0;S<y;S++){const O=f.data[S];if(O._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,O.isBlocked)continue;if(this._totalVertices.addCount(O.getTotalVertices(),!1),!O.isReady()||!O.isEnabled()||O.Yd.hasAZeroComponent)continue;O.Mj(),O.actionManager&&O.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(O);let y=this.customLODSelector?this.customLODSelector(O,this.activeCamera):O.getLOD(this.activeCamera);if(O._internalAbstractMeshDataInfo._currentLOD=y,O._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,void 0!==y&&null!==y&&(y!==O&&0!==y.billboardMode&&y.Mj(),O._preActivate(),O.isVisible&&O.visibility>0&&0!==(O.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||O.qb||O.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(O),this.activeCamera._activeMeshes.push(O),y!==O&&y._activate(this._renderId,!1);for(const f of this._preActiveMeshStage)f.action(O);O._activate(this._renderId,!1)&&(O.isAnInstance?O._internalAbstractMeshDataInfo._actAsRegularMesh&&(y=O):y._internalAbstractMeshDataInfo._onlyForInstances=!1,y._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(O,y)),O._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let O=0;O<this.oj.length;O++){const f=this.oj[O];if(!f.isStarted()||!f.j)continue;const y=f.j;y.position&&!y.isEnabled()||(this._activeParticleSystems.push(f),f.animate(),this._renderingManager.dispatchParticles(f))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}_prepareSkeleton(O){this._skeletonsEnabled&&O.skeleton&&(this._activeSkeletons.pushNoDuplicate(O.skeleton)&&(O.skeleton.prepare(),this._activeBones.addCount(O.skeleton.bones.length,!1)),O.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(O)&&this.frameGraph&&O.applySkeleton(O.skeleton))}_activeMesh(O,f){this._prepareSkeleton(f);let y=O.hasInstances||O.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||f.qb;if(f&&f.Yf&&f.Yf.length>0){const S=this.getActiveSubMeshCandidates(f),H=S.length;y=y||1===H;for(let b=0;b<H;b++){const H=S.data[b];this._evaluateSubMesh(H,f,O,y)}}}updateTransformMatrix(O){const f=this.activeCamera;if(f)if(f._renderingMultiview){const y=f._rigCameras[0],S=f._rigCameras[1];this.setTransformMatrix(y.getViewMatrix(),y.getProjectionMatrix(O),S.getViewMatrix(),S.getProjectionMatrix(O))}else this.setTransformMatrix(f.getViewMatrix(),f.getProjectionMatrix(O))}_bindFrameBuffer(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];O&&O._multiviewTexture?O._multiviewTexture._bindFrameBuffer():O&&O.outputRenderTarget?O.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer(),f&&this._clearFrameBuffer(O)}_clearFrameBuffer(O){if(O&&O._multiviewTexture);else if(O&&O.outputRenderTarget&&!O._renderingMultiview){const f=O.outputRenderTarget;f.onClearObservable.hasObservers()?f.onClearObservable.notifyObservers(this._engine):f.skipInitialClear||O.isRightCamera||(this.Ri&&this._engine.clear(f.clearColor||this._clearColor,!f._cleared,!0,!0),f._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_renderForCamera(O,f){var y;let H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(O&&O._skipRendering)return;const b=this._engine;if(this._activeCamera=O,!this.activeCamera)throw new Error("Active camera not set");if(b.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&H){let f=!0;O._renderingMultiview&&O.outputRenderTarget&&(f=O.outputRenderTarget.skipInitialClear,this.Ri&&(this._defaultFrameBufferCleared=!1,O.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),O._renderingMultiview&&O.outputRenderTarget&&(O.outputRenderTarget.skipInitialClear=f)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let S=0;S<this._softwareSkinnedMeshes.length;S++){const O=this._softwareSkinnedMeshes.data[S];O.applySkeleton(O.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),O.customRenderTargets&&O.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(O.customRenderTargets),f&&f.customRenderTargets&&f.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(f.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const S of this._gatherActiveCameraRenderTargetsStage)S.action(this._renderTargets);let h=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){S.d.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let O=0;O<this._renderTargets.length;O++){const f=this._renderTargets.data[O];if(f._shouldRender()){this._renderId++;const O=f.activeCamera&&f.activeCamera!==this.activeCamera;f.render(O,this.dumpNextRenderTargets),h=!0}}S.d.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const O of this._cameraDrawRenderTargetStage)h=O.action(this.activeCamera)||h;this._intermediateRendering=!1}this._engine.currentRenderPassId=(null===(y=O.outputRenderTarget)||void 0===y?void 0:y.renderPassId)??O.renderPassId??0,h&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||O._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const S of this._beforeCameraDrawStage)S.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),b.snapshotRendering&&1===b.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const S of this._afterCameraDrawStage)S.action(this.activeCamera);if(this.postProcessManager&&!O._multiviewTexture){const f=O.outputRenderTarget?O.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(O.isIntermediate,f)}for(const S of this._afterCameraPostProcessStage)S.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}_processSubCameras(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(0===O.cameraRigMode||O._renderingMultiview)return O._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(O,void 0,f),void this.onAfterRenderCameraObservable.notifyObservers(O);if(O._useMultiviewToSingleView)this._renderMultiviewToSingleView(O);else{this.onBeforeCameraRenderObservable.notifyObservers(O);for(let f=0;f<O._rigCameras.length;f++)this._renderForCamera(O._rigCameras[f],O)}this._activeCamera=O,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(O)}_checkIntersections(){for(let O=0;O<this._meshesForIntersections.length;O++){const f=this._meshesForIntersections.data[O];if(f.actionManager)for(let O=0;f.actionManager&&O<f.actionManager.actions.length;O++){const y=f.actionManager.actions[O];if(12===y.trigger||13===y.trigger){const O=y.getTriggerParameter(),S=O.mesh?O.mesh:O,H=S.intersectsMesh(f,O.usePreciseIntersection),b=f._intersectionsInProgress.indexOf(S);H&&-1===b?12===y.trigger?(y._executeCurrent(I.CreateNew(f,void 0,S)),f._intersectionsInProgress.push(S)):13===y.trigger&&f._intersectionsInProgress.push(S):!H&&b>-1&&(13===y.trigger&&y._executeCurrent(I.CreateNew(f,void 0,S)),f.actionManager.hasSpecificTrigger(13,(O=>{const f=O.mesh?O.mesh:O;return S===f}))&&13!==y.trigger||f._intersectionsInProgress.splice(b,1))}}}}_advancePhysicsEngineStep(O){}_animate(O){}animate(){if(this._engine.isDeterministicLockStep()){let O=Math.max(OO.MinDeltaTime,Math.min(this._engine.getDeltaTime(),OO.MaxDeltaTime))+this._timeAccumulator;const f=this._engine.getTimeStep(),y=1e3/f/1e3;let S=0;const H=this._engine.getLockstepMaxSteps();let b=Math.floor(O/f);for(b=Math.min(b,H);O>0&&S<b;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=f*y,this._animate(f),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(f),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,S++,O-=f;this._timeAccumulator=O<0?0:O}else{const O=this.useConstantAnimationDeltaTime?16:Math.max(OO.MinDeltaTime,Math.min(this._engine.getDeltaTime(),OO.MaxDeltaTime));this._animationRatio=.06*O,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(O)}}_clear(){(this.autoClearDepthAndStencil||this.Ri)&&this._engine.clear(this._clearColor,this.Ri||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}_checkCameraRenderTarget(O){var f;if(null===O||void 0===O||!O.outputRenderTarget||null!==O&&void 0!==O&&O.isRigCamera||(O.outputRenderTarget._cleared=!1),null!==O&&void 0!==O&&null!==(f=O.rigCameras)&&void 0!==f&&f.length)for(let y=0;y<O.rigCameras.length;++y){const f=O.rigCameras[y].outputRenderTarget;f&&(f._cleared=!1)}}resetDrawCache(O){if(this.meshes)for(const f of this.meshes)f.resetDrawCache(O)}_renderWithFrameGraph(){var O;let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.activeCamera=null,this._activeParticleSystems.reset(),this._activeSkeletons.reset(),f)for(const H of this.cameras)if(H.update(),0!==H.cameraRigMode)for(let O=0;O<H._rigCameras.length;O++)H._rigCameras[O].update();for(const H of this._beforeClearStage)H.action();const y=this.getActiveMeshCandidates(),S=y.length;for(let H=0;H<S;H++){const O=y.data[H];O.isBlocked||(this._totalVertices.addCount(O.getTotalVertices(),!1),O.isReady()&&O.isEnabled()&&!O.Yd.hasAZeroComponent&&(O.Mj(),O.actionManager&&O.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(O)))}if(this.particlesEnabled)for(let H=0;H<this.oj.length;H++){const O=this.oj[H];if(!O.isStarted()||!O.j)continue;const f=O.j;f.position&&!f.isEnabled()||(this._activeParticleSystems.push(O),O.animate())}null===(O=this.frameGraph)||void 0===O||O.execute()}render(){var O;let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.u){this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),null!==(O=this.activeCameras)&&void 0!==O&&O.length&&this.activeCameras.forEach(this._checkCameraRenderTarget),this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),y||this.animate();for(const O of this._beforeCameraUpdateStage)O.action();if(f)if(this.activeCameras&&this.activeCameras.length>0)for(let O=0;O<this.activeCameras.length;O++){const f=this.activeCameras[O];if(f.update(),0!==f.cameraRigMode)for(let O=0;O<f._rigCameras.length;O++)f._rigCameras[O].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let O=0;O<this.activeCamera._rigCameras.length;O++)this.activeCamera._rigCameras[O].update();if(this.onBeforeRenderObservable.notifyObservers(this),this.customRenderFunction)this._renderId++,this._engine.currentRenderPassId=0,this.customRenderFunction(f,y);else{var H;const O=this.getEngine();this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const f=null!==(H=this.activeCameras)&&void 0!==H&&H.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){S.d.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(let y=0;y<this.customRenderTargets.length;y++){const S=this.customRenderTargets[y];if(S._shouldRender()){if(this._renderId++,this.activeCamera=S.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");O.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),S.render(f!==this.activeCamera,this.dumpNextRenderTargets)}}S.d.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this._engine.currentRenderPassId=(null===f||void 0===f?void 0:f.renderPassId)??0,this.activeCamera=f,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const y of this._beforeClearStage)y.action();this._clearFrameBuffer(this.activeCamera);for(const y of this._gatherRenderTargetsStage)y.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let y=0;y<this.activeCameras.length;y++)this._processSubCameras(this.activeCameras[y],y>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}}this._checkIntersections();for(const O of this._afterRenderStage)O.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let O=0;O<this._toBeDisposed.length;O++){const f=this._toBeDisposed[O];f&&f.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}}freezeMaterials(){for(let O=0;O<this.materials.length;O++)this.materials[O].freeze()}unfreezeMaterials(){for(let O=0;O<this.materials.length;O++)this.materials[O].unfreeze()}dispose(){if(this.u)return;this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this._activeAnimatables&&this.stopAllAnimations&&(this._activeAnimatables.forEach((O=>{O.onAnimationEndObservable.clear(),O.onAnimationEnd=null})),this.stopAllAnimations()),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const O=this._activeRequests.slice();for(const H of O)H.abort();this._activeRequests.length=0;try{this.hj.notifyObservers(this)}catch(S){r.e.Error("An error occurred while calling onDisposeObservable!",S)}this.Qi();if(this._engine.getInputElement())for(let H=0;H<this.cameras.length;H++)this.cameras[H].Qi();this._disposeList(this.animationGroups),this._disposeList(this.lights),this._disposeList(this.meshes,(O=>O.dispose(!0))),this._disposeList(this.transformNodes,(O=>O.dispose(!0)));const f=this.cameras;this._disposeList(f),this.si&&this.si.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.oj),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let y=this._engine.scenes.indexOf(this);y>-1&&this._engine.scenes.splice(y,1),B.c._LastCreatedScene===this&&(this._engine.scenes.length>0?B.c._LastCreatedScene=this._engine.scenes[this._engine.scenes.length-1]:B.c._LastCreatedScene=null),y=this._engine._virtualScenes.indexOf(this),y>-1&&this._engine._virtualScenes.splice(y,1),this._engine.wipeCaches(!0),this.hj.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this.onClearColorChangedObservable.clear(),this._isDisposed=!0}_disposeList(O,f){const y=O.slice(0);f=f??(O=>O.dispose());for(const S of y)f(S);O.length=0}get u(){return this._isDisposed}clearCachedVertexData(){for(let O=0;O<this.meshes.length;O++){const f=this.meshes[O].Bj;f&&f.clearCachedData()}}cleanCachedTextureBuffer(){for(const O of this.textures){O._buffer&&(O._buffer=null)}}getWorldExtends(O){const f=new m.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),y=new m.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return O=O||(()=>!0),this.meshes.filter(O).forEach((O=>{if(O.Mj(!0),!O.Yf||0===O.Yf.length||O.infiniteDistance)return;const S=O.getBoundingInfo(),H=S.boundingBox.minimumWorld,b=S.boundingBox.maximumWorld;m.m.CheckExtends(H,f,y),m.m.CheckExtends(b,f,y)})),{min:f,max:y}}createPickingRay(O,f,y,S){throw(0,j.d)("Ray")}createPickingRayToRef(O,f,y,S,H){throw(0,j.d)("Ray")}createPickingRayInCameraSpace(O,f,y){throw(0,j.d)("Ray")}createPickingRayInCameraSpaceToRef(O,f,y,S){throw(0,j.d)("Ray")}mc(O,f,y,S,H,b){const h=(0,j.d)("Ray",!0);return h&&r.e.Warn(h),new F.b}pickWithBoundingInfo(O,f,y,S,H){const b=(0,j.d)("Ray",!0);return b&&r.e.Warn(b),new F.b}pickWithRay(O,f,y,S){throw(0,j.d)("Ray")}multiPick(O,f,y,S,H){throw(0,j.d)("Ray")}multiPickWithRay(O,f,y){throw(0,j.d)("Ray")}setPointerOverMesh(O,f,y){this._inputManager.setPointerOverMesh(O,f,y)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_rebuildGeometries(){for(const O of this.geometries)O._rebuild();for(const O of this.meshes)O._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const O of this._components)O.rebuild();for(const O of this.oj)O.rebuild();if(this.spriteManagers)for(const O of this.spriteManagers)O.rebuild()}_rebuildTextures(){for(const O of this.textures)O._rebuild(!0);this.markAllMaterialsAsDirty(1)}_getByTags(O,f,y){if(void 0===f)return O;const S=[];for(const H in O){const b=O[H];N.d&&N.d.MatchesQuery(b,f)&&(!y||y(b))&&S.push(b)}return S}getMeshesByTags(O,f){return this._getByTags(this.meshes,O,f)}getCamerasByTags(O,f){return this._getByTags(this.cameras,O,f)}getLightsByTags(O,f){return this._getByTags(this.lights,O,f)}getMaterialByTags(O,f){return this._getByTags(this.materials,O,f).concat(this._getByTags(this.multiMaterials,O,f))}getTransformNodesByTags(O,f){return this._getByTags(this.transformNodes,O,f)}setRenderingOrder(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(O,f,y,S)}setRenderingAutoClearDepthStencil(O,f){let y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(O,f,y,S)}getAutoClearDepthStencilSetup(O){return this._renderingManager.getAutoClearDepthStencilSetup(O)}_forceBlockMaterialDirtyMechanism(O){this._blockMaterialDirtyMechanism=O}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set blockMaterialDirtyMechanism(O){this._blockMaterialDirtyMechanism!==O&&(this._blockMaterialDirtyMechanism=O,O||this.markAllMaterialsAsDirty(63))}markAllMaterialsAsDirty(O,f){if(!this._blockMaterialDirtyMechanism)for(const y of this.materials)f&&!f(y)||y.Dg(O)}_loadFile(O,f,y,S,H,b,h){const v=(0,e.o)(O,f,y,S?this.offlineProvider:void 0,H,b,h);return this._activeRequests.push(v),v.onCompleteObservable.add((O=>{this._activeRequests.splice(this._activeRequests.indexOf(O),1)})),v}_loadFileAsync(O,f,y,S,H){return new Promise(((b,h)=>{this._loadFile(O,(O=>{b(O)}),f,y,S,((O,f)=>{h(f)}),H)}))}_requestFile(O,f,y,S,H,b,h){const v=(0,e.u)(O,f,y,S?this.offlineProvider:void 0,H,b,h);return this._activeRequests.push(v),v.onCompleteObservable.add((O=>{this._activeRequests.splice(this._activeRequests.indexOf(O),1)})),v}_requestFileAsync(O,f,y,S,H){return new Promise(((b,h)=>{this._requestFile(O,(O=>{b(O)}),f,y,S,(O=>{h(O)}),H)}))}_readFile(O,f,y,S,H){const b=(0,e.r)(O,f,y,S,H);return this._activeRequests.push(b),b.onCompleteObservable.add((O=>{this._activeRequests.splice(this._activeRequests.indexOf(O),1)})),b}_readFileAsync(O,f,y){return new Promise(((S,H)=>{this._readFile(O,(O=>{S(O)}),f,y,(O=>{H(O)}))}))}getPerfCollector(){throw(0,j.d)("performanceViewerSceneExtension")}setActiveCameraByID(O){return this.setActiveCameraById(O)}getMaterialByID(O){return this.getMaterialById(O)}getLastMaterialByID(O){return this.getLastMaterialById(O)}getTextureByUniqueID(O){return this.getTextureByUniqueId(O)}getCameraByID(O){return this.getCameraById(O)}getCameraByUniqueID(O){return this.getCameraByUniqueId(O)}getBoneByID(O){return this.getBoneById(O)}getLightByID(O){return this.getLightById(O)}getLightByUniqueID(O){return this.getLightByUniqueId(O)}getParticleSystemByID(O){return this.getParticleSystemById(O)}getGeometryByID(O){return this.getGeometryById(O)}getMeshByID(O){return this.getMeshById(O)}getMeshByUniqueID(O){return this.getMeshByUniqueId(O)}getLastMeshByID(O){return this.getLastMeshById(O)}getMeshesByID(O){return this.getMeshesById(O)}getTransformNodeByID(O){return this.getTransformNodeById(O)}getTransformNodeByUniqueID(O){return this.getTransformNodeByUniqueId(O)}getTransformNodesByID(O){return this.getTransformNodesById(O)}getNodeByID(O){return this.getNodeById(O)}getLastEntryByID(O){return this.getLastEntryById(O)}getLastSkeletonByID(O){return this.getLastSkeletonById(O)}}OO.FOGMODE_NONE=0,OO.FOGMODE_EXP=1,OO.FOGMODE_EXP2=2,OO.FOGMODE_LINEAR=3,OO.MinDeltaTime=1,OO.MaxDeltaTime=1e3,(0,n.g)("BABYLON.Scene",OO)},11402:(O,f,y)=>{"use strict";y.d(f,{b:()=>S,e:()=>H});class S{}S.NAME_EFFECTLAYER="EffectLayer",S.NAME_LAYER="Layer",S.NAME_LENSFLARESYSTEM="LensFlareSystem",S.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",S.NAME_PARTICLESYSTEM="ub",S.NAME_GAMEPAD="Gamepad",S.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",S.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",S.NAME_PREPASSRENDERER="PrePassRenderer",S.NAME_DEPTHRENDERER="DepthRenderer",S.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",S.NAME_IBLSHADOWSRENDERER="IblShadowsRenderer",S.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",S.NAME_SPRITE="Sprite",S.NAME_SUBSURFACE="SubSurface",S.NAME_OUTLINERENDERER="Outline",S.NAME_PROCEDURALTEXTURE="ProceduralTexture",S.NAME_SHADOWGENERATOR="ShadowGenerator",S.NAME_OCTREE="wb",S.NAME_PHYSICSENGINE="PhysicsEngine",S.NAME_AUDIO="Audio",S.NAME_FLUIDRENDERER="FluidRenderer",S.STEP_ISREADYFORMESH_EFFECTLAYER=0,S.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,S.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,S.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,S.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,S.STEP_BEFORECAMERADRAW_PREPASS=0,S.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,S.STEP_BEFORECAMERADRAW_LAYER=2,S.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,S.STEP_BEFORERENDERTARGETDRAW_LAYER=1,S.STEP_BEFORERENDERINGMESH_PREPASS=0,S.STEP_BEFORERENDERINGMESH_OUTLINE=1,S.STEP_AFTERRENDERINGMESH_PREPASS=0,S.STEP_AFTERRENDERINGMESH_OUTLINE=1,S.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,S.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,S.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,S.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,S.STEP_BEFORECLEAR_PREPASS=1,S.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,S.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,S.STEP_AFTERRENDERTARGETDRAW_LAYER=1,S.STEP_AFTERCAMERADRAW_PREPASS=0,S.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,S.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,S.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,S.STEP_AFTERCAMERADRAW_LAYER=4,S.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,S.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,S.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,S.STEP_AFTERRENDER_AUDIO=0,S.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,S.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,S.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,S.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,S.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,S.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,S.STEP_POINTERMOVE_SPRITE=0,S.STEP_POINTERDOWN_SPRITE=0,S.STEP_POINTERUP_SPRITE=0;class H extends Array{constructor(O){super(...O)}static Create(){return Object.create(H.prototype)}registerStep(O,f,y){let S=0,H=Number.MAX_VALUE;for(;S<this.length;S++){if(H=this[S].index,O<H)break}this.splice(S,0,{index:O,component:f,action:y.bind(f)})}clear(){this.length=0}}},11289:(O,f,y)=>{"use strict";y.d(f,{b:()=>S});function S(O,f,y,S){var H,b=arguments.length,h=b<3?f:null===S?S=Object.getOwnPropertyDescriptor(f,y):S;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)h=Reflect.decorate(O,f,y,S);else for(var v=O.length-1;v>=0;v--)(H=O[v])&&(h=(b<3?H(h):b>3?H(f,y,h):H(f,y))||h);return b>3&&h&&Object.defineProperty(f,y,h),h}Object.create;Object.create},12187:(O,f,y)=>{"use strict";class S{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((O,f)=>{this._resolve=O,this._reject=f}))}}var H=y(11324),b=y(11359),h=y(10995),v=y(11561),N=y(12195),m=y(12207),t=y(11004),q=y(11744),F=y(12209),I=y(12215),A=y(11042),J=y(11017),X=y(11019);class w{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(O){this._useTextureToStoreBoneMatrices=O,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(O){this._animationPropertiesOverride=O}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(O,f,y){this.name=O,this.id=f,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=H.b.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new t.d,this.bones=[],this._scene=y||A.c.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const S=this._scene.getEngine().getCaps();this._canUseTextureForBones=S.textureFloat&&S.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((O=>!O.getParent()))}getTransformMatrices(O){if(this.needInitialSkinMatrix){if(!O)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return O._bonesTransformMatrices||this.prepare(!0),O._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(O){return this.needInitialSkinMatrix&&O._transformMatrixTexture?O._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(O){let f=`Name: ${this.name}, nBones: ${this.bones.length}`;if(f+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,O){f+=", Ranges: {";let O=!0;for(const y in this._ranges)O&&(f+=", ",O=!1),f+=y;f+="}"}return f}getBoneIndexByName(O){for(let f=0,y=this.bones.length;f<y;f++)if(this.bones[f].name===O)return f;return-1}createAnimationRange(O,f,y){if(!this._ranges[O]){this._ranges[O]=new I.b(O,f,y);for(let S=0,H=this.bones.length;S<H;S++)this.bones[S].animations[0]&&this.bones[S].animations[0].createRange(O,f,y)}}deleteAnimationRange(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let y=0,S=this.bones.length;y<S;y++)this.bones[y].animations[0]&&this.bones[y].animations[0].deleteRange(O,f);this._ranges[O]=null}getAnimationRange(O){return this._ranges[O]||null}getAnimationRanges(){const O=[];let f;for(f in this._ranges)O.push(this._ranges[f]);return O}copyAnimationRange(O,f){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[f]||!O.getAnimationRange(f))return!1;let S=!0;const H=this._getHighestAnimationFrame()+1,b={},h=O.bones;let v,N;for(N=0,v=h.length;N<v;N++)b[h[N].name]=h[N];this.bones.length!==h.length&&(J.e.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${h.length}`),S=!1);const m=y&&this.dimensionsAtRest&&O.dimensionsAtRest?this.dimensionsAtRest.divide(O.dimensionsAtRest):null;for(N=0,v=this.bones.length;N<v;N++){const O=this.bones[N].name,h=b[O];h?S=S&&this.bones[N].copyAnimationRange(h,f,H,y,m):(J.e.Warn("copyAnimationRange: not same rig, missing source bone "+O),S=!1)}const t=O.getAnimationRange(f);return t&&(this._ranges[f]=new I.b(f,t.from+H,t.to+H)),S}returnToRest(){for(const O of this.bones)-1!==O._index&&O.returnToRest()}_getHighestAnimationFrame(){let O=0;for(let f=0,y=this.bones.length;f<y;f++)if(this.bones[f].animations[0]){const y=this.bones[f].animations[0].getHighestFrame();O<y&&(O=y)}return O}beginAnimation(O,f,y,S){const H=this.getAnimationRange(O);return H?this._scene.beginAnimation(this,H.from,H.to,f,y,S):null}static MakeAnimationAdditive(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0;const S=O.getAnimationRange(y);if(!S)return null;const H=O._scene.getAllAnimatablesByTarget(O);let b=null;for(let v=0;v<H.length;v++){const O=H[v];if(O.fromFrame===(null===S||void 0===S?void 0:S.from)&&O.toFrame===(null===S||void 0===S?void 0:S.to)){b=O;break}}const h=O.getAnimatables();for(let v=0;v<h.length;v++){const O=h[v].animations;if(O)for(let S=0;S<O.length;S++)F.d.MakeAnimationAdditive(O[S],f,y)}return b&&(b.isAdditive=!0),O}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(O){this._meshesWithPoseMatrix.push(O)}_unregisterMeshWithPoseMatrix(O){const f=this._meshesWithPoseMatrix.indexOf(O);f>-1&&this._meshesWithPoseMatrix.splice(f,1)}_computeTransformMatrices(O,f){this.onBeforeComputeObservable.notifyObservers(this);for(let y=0;y<this.bones.length;y++){const S=this.bones[y];S._childUpdateId++;const H=S.getParent();if(H?S.getLocalMatrix().multiplyToRef(H.getFinalMatrix(),S.getFinalMatrix()):f?S.getLocalMatrix().multiplyToRef(f,S.getFinalMatrix()):S.getFinalMatrix().p(S.getLocalMatrix()),-1!==S._index){const f=null===S._index?y:S._index;S.getAbsoluteInverseBindMatrix().multiplyToArray(S.getFinalMatrix(),O,16*f)}}this._identity.copyToArray(O,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const O=this.va().getRenderId();if(this._currentRenderId===O)return;this._currentRenderId=O}if(this._numBonesWithLinkedTransformNode>0)for(const O of this.bones)if(O._linkedTransformNode){const f=O._linkedTransformNode;O.position=f.position,f.rotationQuaternion?O.rotationQuaternion=f.rotationQuaternion:O.rotation=f.rotation,O.Yd=f.Yd}if(this.needInitialSkinMatrix)for(const O of this._meshesWithPoseMatrix){const f=O.getPoseMatrix();let y=this._isDirty;if(O._bonesTransformMatrices&&O._bonesTransformMatrices.length===16*(this.bones.length+1)||(O._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),y=!0),y){if(this._synchronizedWithMesh!==O){this._synchronizedWithMesh=O;for(const O of this.bones)if(!O.getParent()){O.getBindMatrix().multiplyToRef(f,H.g.Matrix[1]),O._updateAbsoluteBindMatrices(H.g.Matrix[1])}if(this.isUsingTextureForMatrices){const f=4*(this.bones.length+1);O._transformMatrixTexture&&O._transformMatrixTexture.getSize().width===f||(O._transformMatrixTexture&&O._transformMatrixTexture.dispose(),O._transformMatrixTexture=q.c.CreateRGBATexture(O._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(O._bonesTransformMatrices,f),this.isUsingTextureForMatrices&&O._transformMatrixTexture&&O._transformMatrixTexture.update(O._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=q.c.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let O=0;O<this.bones.length;O++)this._animatables.push(this.bones[O])}return this._animatables}clone(O,f){const y=new w(O,f||O,this._scene);y.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let S=0;S<this.bones.length;S++){const O=this.bones[S];let f=null;const H=O.getParent();if(H){const O=this.bones.indexOf(H);f=y.bones[O]}const b=new m.b(O.name,y,f,O.getBindMatrix().clone(),O.getRestMatrix().clone());b._index=O._index,O._linkedTransformNode&&b.linkTransformNode(O._linkedTransformNode),X.e.DeepCopy(O.animations,b.animations)}if(this._ranges){y._ranges={};for(const O in this._ranges){const f=this._ranges[O];f&&(y._ranges[O]=f.clone())}}return this._isDirty=!0,y.prepare(!0),y}enableBlending(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;this.bones.forEach((f=>{f.animations.forEach((f=>{f.enableBlending=!0,f.blendingSpeed=O}))}))}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const O=this._parentContainer.skeletons.indexOf(this);O>-1&&this._parentContainer.skeletons.splice(O,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const O={};O.name=this.name,O.id=this.id,this.dimensionsAtRest&&(O.dimensionsAtRest=this.dimensionsAtRest.gj()),O.bones=[],O.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let y=0;y<this.bones.length;y++){var f;const S=this.bones[y],H=S.getParent(),b={parentBoneIndex:H?this.bones.indexOf(H):-1,index:S.getIndex(),name:S.name,id:S.id,matrix:S.getBindMatrix().gj(),rest:S.getRestMatrix().gj(),linkedTransformNodeId:null===(f=S.getTransformNode())||void 0===f?void 0:f.id};O.bones.push(b),S.length&&(b.length=S.length),S.metadata&&(b.metadata=S.metadata),S.animations&&S.animations.length>0&&(b.animation=S.animations[0].serialize()),O.ranges=[];for(const f in this._ranges){const y=this._ranges[f];if(!y)continue;const S={};S.name=f,S.from=y.from,S.to=y.to,O.ranges.push(S)}}return O}static Parse(O,f){const y=new w(O.name,O.id,f);let S;for(O.dimensionsAtRest&&(y.dimensionsAtRest=H.m.Ng(O.dimensionsAtRest)),y.needInitialSkinMatrix=O.needInitialSkinMatrix,S=0;S<O.bones.length;S++){const f=O.bones[S],b=O.bones[S].index;let h=null;f.parentBoneIndex>-1&&(h=y.bones[f.parentBoneIndex]);const v=f.rest?H.b.Ng(f.rest):null,N=new m.b(f.name,y,h,H.b.Ng(f.matrix),v,null,b);void 0!==f.id&&null!==f.id&&(N.id=f.id),f.length&&(N.length=f.length),f.metadata&&(N.metadata=f.metadata),f.animation&&N.animations.push(F.d.Parse(f.animation)),void 0!==f.linkedTransformNodeId&&null!==f.linkedTransformNodeId&&(y._hasWaitingData=!0,N._waitingTransformNodeId=f.linkedTransformNodeId)}if(O.ranges)for(S=0;S<O.ranges.length;S++){const f=O.ranges[S];y.createAnimationRange(f.name,f.from,f.to)}return y}computeAbsoluteMatrices(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||O)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(O)}getPoseMatrix(){let O=null;return this._meshesWithPoseMatrix.length>0&&(O=this._meshesWithPoseMatrix[0].getPoseMatrix()),O}sortBones(){const O=[],f=new Array(this.bones.length);for(let y=0;y<this.bones.length;y++)this._sortBones(y,O,f);this.bones=O}_sortBones(O,f,y){if(y[O])return;y[O]=!0;const S=this.bones[O];if(!S)return;void 0===S._index&&(S._index=O);const H=S.getParent();H&&this._sortBones(this.bones.indexOf(H),f,y),f.push(S)}setCurrentPoseAsRest(){this.bones.forEach((O=>{O.setCurrentPoseAsRest()}))}}var B=y(11455),j=y(11289),u=y(11294),L=y(12223),p=y(12231),U=y(11153),l=y(11362);class x extends p.d{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(O){this.subSurface.refractionTexture=O,O?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(O){this.subSurface.indexOfRefraction=O}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(O){this.subSurface.invertRefractionY=O}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(O){this.subSurface.linkRefractionWithTransparency=O,O&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===p.d.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(O){O!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=O?p.d.LIGHTFALLOFF_PHYSICAL:p.d.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===p.d.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(O){O!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=O?p.d.LIGHTFALLOFF_GLTF:p.d.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(O){this._attachImageProcessingConfiguration(O),this._markAllSubMeshesAsTexturesDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(O){this.imageProcessingConfiguration.colorCurvesEnabled=O}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(O){this.imageProcessingConfiguration.colorGradingEnabled=O}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(O){this._imageProcessingConfiguration.toneMappingEnabled=O}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(O){this._imageProcessingConfiguration.exposure=O}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(O){this._imageProcessingConfiguration.contrast=O}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(O){this._imageProcessingConfiguration.colorGradingTexture=O}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(O){this._imageProcessingConfiguration.colorCurves=O}constructor(O,f){super(O,f,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=x.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=b.d.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new b.d(0,0,0),this.albedoColor=new b.d(1,1,1),this.reflectivityColor=new b.d(1,1,1),this.reflectionColor=new b.d(1,1,1),this.emissiveColor=new b.d(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,L.b)(this.va())}getClassName(){return"PBRMaterial"}clone(O){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const S=l.b.Clone((()=>new x(O,this.va())),this,{cloneTexturesOnlyOnce:f});return S.id=O,S.name=O,this.stencil.copyTo(S.stencil),this._clonePlugins(S,y),S}serialize(){const O=super.serialize();return O.customType="BABYLON.PBRMaterial",O}static Parse(O,f,y){const S=l.b.Parse((()=>new x(O.name,f)),O,f,y);return O.stencil&&S.stencil.parse(O.stencil,f,y),B.c._ParsePlugins(O,S,f,y),O.clearCoat&&S.clearCoat.parse(O.clearCoat,f,y),O.anisotropy&&S.anisotropy.parse(O.anisotropy,f,y),O.brdf&&S.brdf.parse(O.brdf,f,y),O.sheen&&S.sheen.parse(O.sheen,f,y),O.subSurface&&S.subSurface.parse(O.subSurface,f,y),O.iridescence&&S.iridescence.parse(O.iridescence,f,y),S}}x.PBRMATERIAL_OPAQUE=p.d.PBRMATERIAL_OPAQUE,x.PBRMATERIAL_ALPHATEST=p.d.PBRMATERIAL_ALPHATEST,x.PBRMATERIAL_ALPHABLEND=p.d.PBRMATERIAL_ALPHABLEND,x.PBRMATERIAL_ALPHATESTANDBLEND=p.d.PBRMATERIAL_ALPHATESTANDBLEND,x.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=p.d.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"directIntensity",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"emissiveIntensity",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"environmentIntensity",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"specularIntensity",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"disableBumpMap",void 0),(0,j.b)([(0,u.C)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"albedoTexture",void 0),(0,j.b)([(0,u.C)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"ambientTexture",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"ambientTextureStrength",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,j.b)([(0,u.C)(),(0,u.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],x.prototype,"opacityTexture",void 0),(0,j.b)([(0,u.C)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"reflectionTexture",void 0),(0,j.b)([(0,u.C)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"emissiveTexture",void 0),(0,j.b)([(0,u.C)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"reflectivityTexture",void 0),(0,j.b)([(0,u.C)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"metallicTexture",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"metallic",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"roughness",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"metallicF0Factor",void 0),(0,j.b)([(0,u.h)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"metallicReflectanceColor",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,j.b)([(0,u.C)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"metallicReflectanceTexture",void 0),(0,j.b)([(0,u.C)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"reflectanceTexture",void 0),(0,j.b)([(0,u.C)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"microSurfaceTexture",void 0),(0,j.b)([(0,u.C)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"bumpTexture",void 0),(0,j.b)([(0,u.C)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty",null)],x.prototype,"lightmapTexture",void 0),(0,j.b)([(0,u.h)("ambient"),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"ambientColor",void 0),(0,j.b)([(0,u.h)("albedo"),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"albedoColor",void 0),(0,j.b)([(0,u.h)("reflectivity"),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"reflectivityColor",void 0),(0,j.b)([(0,u.h)("reflection"),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"reflectionColor",void 0),(0,j.b)([(0,u.h)("emissive"),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"emissiveColor",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"microSurface",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useLightmapAsShadowmap",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],x.prototype,"useAlphaFromAlbedoTexture",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],x.prototype,"forceAlphaTest",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],x.prototype,"alphaCutOff",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useSpecularOverAlpha",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useAmbientInGrayScale",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,j.b)([(0,u.L)()],x.prototype,"usePhysicalLightFalloff",null),(0,j.b)([(0,u.L)()],x.prototype,"useGLTFLightFalloff",null),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useRadianceOverAlpha",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useObjectSpaceNormalMap",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useParallax",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useParallaxOcclusion",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"parallaxScaleBias",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsLightsDirty")],x.prototype,"disableLighting",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"forceIrradianceInFragment",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsLightsDirty")],x.prototype,"maxSimultaneousLights",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"invertNormalMapX",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"invertNormalMapY",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"twoSidedLighting",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useAlphaFresnel",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useLinearAlphaFresnel",void 0),(0,j.b)([(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"environmentBRDFTexture",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"forceNormalForward",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"enableSpecularAntiAliasing",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useHorizonOcclusion",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useRadianceOcclusion",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsMiscDirty")],x.prototype,"unlit",void 0),(0,j.b)([(0,u.L)(),(0,u.d)("_markAllSubMeshesAsMiscDirty")],x.prototype,"applyDecalMapAfterDetailMap",void 0),(0,U.g)("BABYLON.PBRMaterial",x);var W=y(11509),E=y(11598),o=y(11392),i=y(11585),D=y(11593),V=y(11557);class g{get influence(){return this._influence}set influence(O){if(this._influence===O)return;const f=this._influence;this._influence=O,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===f||0===O)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(O){this._animationPropertiesOverride=O}constructor(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=O,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new t.d,this._onDataLayoutChanged=new t.d,this._animationPropertiesOverride=null,this.id=O,this._scene=y||A.c.LastCreatedScene,this.influence=f,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}setPositions(O){const f=this.hasPositions;this._positions=O,f!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(O){const f=this.hasNormals;this._normals=O,f!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(O){const f=this.hasTangents;this._tangents=O,f!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(O){const f=this.hasUVs;this._uvs=O,f!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}clone(){const O=l.b.Clone((()=>new g(this.name,this.influence,this._scene)),this);return O._positions=this._positions,O._normals=this._normals,O._tangents=this._tangents,O._uvs=this._uvs,O}serialize(){const O={};return O.name=this.name,O.influence=this.influence,O.xa=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(O.id=this.id),this.hasNormals&&(O.ya=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(O.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(O.Aa=Array.prototype.slice.call(this.getUVs())),l.b.AppendSerializedAnimations(this,O),O}getClassName(){return"MorphTarget"}static Parse(O,f){const y=new g(O.name,O.influence);if(y.setPositions(O.xa),null!=O.id&&(y.id=O.id),O.ya&&y.setNormals(O.ya),O.tangents&&y.setTangents(O.tangents),O.Aa&&y.setUVs(O.Aa),O.animations){for(let f=0;f<O.animations.length;f++){const S=O.animations[f],H=(0,U.c)("BABYLON.Animation");H&&y.animations.push(H.Parse(S))}O.autoAnimate&&f&&f.beginAnimation(y,O.autoAnimateFrom,O.autoAnimateTo,O.autoAnimateLoop,O.autoAnimateSpeed||1)}return y}static FromMesh(O,f,y){f||(f=O.name);const S=new g(f,y,O.va());return S.setPositions(O.getVerticesData(o.f.PositionKind)),O.isVerticesDataPresent(o.f.NormalKind)&&S.setNormals(O.getVerticesData(o.f.NormalKind)),O.isVerticesDataPresent(o.f.TangentKind)&&S.setTangents(O.getVerticesData(o.f.TangentKind)),O.isVerticesDataPresent(o.f.UVKind)&&S.setUVs(O.getVerticesData(o.f.UVKind)),S}}(0,j.b)([(0,u.L)()],g.prototype,"id",void 0);var R=y(11302),s=y(12099);class k{set areUpdatesFrozen(O){O?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(!0)))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new R.g(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,O||(O=A.c.LastCreatedScene),this._scene=O,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const O=this._scene.getEngine().getCaps();this._canUseTextureForTargets=O.canUseGLVertexID&&O.textureFloat&&O.maxVertexTextureImageUnits>0&&O.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return this._numMaxInfluencers}set numMaxInfluencers(O){this._numMaxInfluencers!==O&&(this._numMaxInfluencers=O,this._syncActiveTargets(!0))}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(O){this._useTextureToStoreTargets=O}get isUsingTextureForTargets(){var O;return k.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(O=this._scene)&&void 0!==O&&O.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(O){return this._activeTargets.data[O]}getTarget(O){return this._targets[O]}getTargetByName(O){for(const f of this._targets)if(f.name===O)return f;return null}addTarget(O){this._targets.push(O),this._targetInfluenceChangedObservers.push(O.onInfluenceChanged.add((O=>{this._syncActiveTargets(O)}))),this._targetDataLayoutChangedObservers.push(O._onDataLayoutChanged.add((()=>{this._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)}removeTarget(O){const f=this._targets.indexOf(O);f>=0&&(this._targets.splice(f,1),O.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(f,1)[0]),O._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(f,1)[0]),this._syncActiveTargets(!0)),this._scene&&this._scene.stopAnimation(O)}_bind(O){O.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),O.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),O.setTexture("morphTargets",this._targetStoreTexture),O.setInt("morphTargetCount",this.numInfluencers)}clone(){const O=new k(this._scene);for(const f of this._targets)O.addTarget(f.clone());return O.enableNormalMorphing=this.enableNormalMorphing,O.enableTangentMorphing=this.enableTangentMorphing,O.enableUVMorphing=this.enableUVMorphing,O}serialize(){const O={};O.id=this.uniqueId,O.targets=[];for(const f of this._targets)O.targets.push(f.serialize());return O}_syncActiveTargets(O){if(this.areUpdatesFrozen)return;let f=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,this._scene&&this._targets.length>this._scene.getEngine().getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let y=-1;for(const S of this._targets){if(y++,0===S.influence&&this.optimizeInfluencers)continue;if(this._activeTargets.length>=k.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(S),this._morphTargetTextureIndices[f]=y,this._tempInfluences[f++]=S.influence,this._supportsNormals=this._supportsNormals&&S.hasNormals,this._supportsTangents=this._supportsTangents&&S.hasTangents,this._supportsUVs=this._supportsUVs&&S.hasUVs;const O=S.getPositions();if(O){const f=O.length/3;if(0===this._vertexCount)this._vertexCount=f;else if(this._vertexCount!==f)return void J.e.Error("Incompatible target. Targets must all have the same vertices count.")}}this._morphTargetTextureIndices.length!==f&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,f)),this._influences&&this._influences.length===f||(this._influences=new Float32Array(f));for(let S=0;S<f;S++)this._influences[S]=this._tempInfluences[S];O&&this.synchronize()}synchronize(){if(this._scene&&!this.areUpdatesFrozen){if(this.isUsingTextureForTargets&&(this._vertexCount||this.numMaxInfluencers>0)){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const O=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>O&&(this._textureHeight=Math.ceil(this._textureWidth/O),this._textureWidth=O);let f=!0;if(this._targetStoreTexture){const O=this._targetStoreTexture.getSize();O.width===this._textureWidth&&O.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(f=!1)}if(f){this._targetStoreTexture&&this._targetStoreTexture.dispose();const O=this._targets.length,f=new Float32Array(O*this._textureWidth*this._textureHeight*4);let y=0;for(let S=0;S<O;S++){const O=this._targets[S],H=O.getPositions(),b=O.getNormals(),h=O.getUVs(),v=O.getTangents();if(!H)return void(0===S&&J.e.Error("Invalid morph target. Target must have positions."));y=S*this._textureWidth*this._textureHeight*4;for(let S=0;S<this._vertexCount;S++)f[y]=H[3*S],f[y+1]=H[3*S+1],f[y+2]=H[3*S+2],y+=4,this._supportsNormals&&b&&(f[y]=b[3*S],f[y+1]=b[3*S+1],f[y+2]=b[3*S+2],y+=4),this._supportsUVs&&h&&(f[y]=h[2*S],f[y+1]=h[2*S+1],y+=4),this._supportsTangents&&v&&(f[y]=v[3*S],f[y+1]=v[3*S+1],f[y+2]=v[3*S+2],y+=4)}this._targetStoreTexture=s.d.CreateRGBATexture(f,this._textureWidth,this._textureHeight,O,this._scene,!1,!1,1,1)}}for(const O of this._scene.meshes)O.morphTargetManager===this&&O._syncGeometryWithMorphTargetManager()}}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const O=this._parentContainer.morphTargetManagers.indexOf(this);O>-1&&this._parentContainer.morphTargetManagers.splice(O,1),this._parentContainer=null}for(const O of this._targets)this._scene.stopAnimation(O)}}static Parse(O,f){const y=new k(f);for(const S of O.targets)y.addTarget(g.Parse(S,f));return y}}k.EnableTextureStorage=!0,k.MaxActiveMorphTargetsInVertexAttributeMode=8;var z=y(12240),c=y(11051),d=y(11466);function G(O,f,y,S){return H.m.Ng(f,y).scaleInPlace(S)}class Y{constructor(O,f,y,S){this.type=O,this.name=f,this.getValue=y,this.getStride=S}_buildAnimation(O,f,y){const S=new F.d(O,this.name,f,this.type);return S.setKeys(y),S}}class Z extends Y{buildAnimations(O,f,y,S,H){H(O._babylonTransformNode,this._buildAnimation(f,y,S))}}const a={translation:[new Z(F.d.ANIMATIONTYPE_VECTOR3,"position",G,(()=>3))],rotation:[new Z(F.d.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",(function(O,f,y,S){return H.c.Ng(f,y).scaleInPlace(S)}),(()=>4))],scale:[new Z(F.d.ANIMATIONTYPE_VECTOR3,"Yd",G,(()=>3))],weights:[new class extends Y{buildAnimations(O,f,y,S,H){if(O._numMorphTargets)for(let b=0;b<O._numMorphTargets;b++){const h=new F.d(`${f}_${b}`,this.name,y,this.type);if(h.setKeys(S.map((O=>({frame:O.frame,inTangent:O.inTangent?O.inTangent[b]:void 0,value:O.value[b],outTangent:O.outTangent?O.outTangent[b]:void 0,interpolation:O.interpolation})))),O._primitiveBabylonMeshes)for(const f of O._primitiveBabylonMeshes)if(f.morphTargetManager){const O=f.morphTargetManager.getTarget(b),y=h.clone();O.animations.push(y),H(O,y)}}}}(F.d.ANIMATIONTYPE_FLOAT,"influence",(function(O,f,y,S){const H=new Array(O._numMorphTargets);for(let b=0;b<H.length;b++)H[b]=f[y++]*S;return H}),(O=>O._numMorphTargets))]},M=new Map,P=M;function e(O,f,y){K(O)&&J.e.Warn(`Extension with the name '${O}' already exists`),M.set(O,{isGLTFExtension:f,factory:y})}function K(O){return M.delete(O)}function T(){const O=O=>O&&"object"===typeof O;for(var f=arguments.length,y=new Array(f),S=0;S<f;S++)y[S]=arguments[S];return y.reduce(((f,y)=>(Object.keys(y).forEach((S=>{const H=f[S],b=y[S];Array.isArray(H)&&Array.isArray(b)?f[S]=H.concat(...b):O(H)&&O(b)?f[S]=T(H,b):f[S]=b})),f)),{})}class Q{static Get(O,f,y){if(!f||void 0==y||!f[y])throw new Error(`${O}: Failed to find index (${y})`);return f[y]}static TryGet(O,f){return O&&void 0!=f&&O[f]?O[f]:null}static Assign(O){if(O)for(let f=0;f<O.length;f++)O[f].index=f}}class C{static RegisterExtension(O,f){e(O,!1,f)}static UnregisterExtension(O){return K(O)}get Mi(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(O){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=O}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((O=>O.dispose&&O.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}importMeshAsync(O,f,y,S,H,b){let h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return Promise.resolve().then((()=>{this._babylonScene=f,this._assetContainer=y,this._loadData(S);let b=null;if(O){const f={};if(this._gltf.nodes)for(const O of this._gltf.nodes)O.name&&(f[O.name]=O.index);b=(O instanceof Array?O:[O]).map((O=>{const y=f[O];if(void 0===y)throw new Error(`Failed to find node '${O}'`);return y}))}return this._loadAsync(H,h,b,(()=>({meshes:this._getMeshes(),oj:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}loadAsync(O,f,y,S){let H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return Promise.resolve().then((()=>(this._babylonScene=O,this._loadData(f),this._loadAsync(y,H,null,(()=>{})))))}_loadAsync(O,f,y,S){return Promise.resolve().then((async()=>{this._rootUrl=O,this._uniqueRootUrl=!O.startsWith("file:")&&f?O:`${O}${Date.now()}/`,this._fileName=f,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const H=`${z.j[z.j.LOADING]} => ${z.j[z.j.READY]}`,b=`${z.j[z.j.LOADING]} => ${z.j[z.j.COMPLETE]}`;this._parent._startPerformanceCounter(H),this._parent._startPerformanceCounter(b),this._parent._setState(z.j.LOADING),this._extensionsOnLoading();const v=new Array;if(!this.parent.loadOnlyMaterials)if(y)v.push(this.loadSceneAsync("/nodes",{nodes:y,index:-1}));else if(void 0!=this._gltf.yd||this._gltf.scenes&&this._gltf.scenes[0]){const O=Q.Get("/scene",this._gltf.scenes,this._gltf.yd||0);v.push(this.loadSceneAsync(`/scenes/${O.index}`,O))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let O=0;O<this._gltf.materials.length;++O){const f=this._gltf.materials[O],y="/materials/"+O,S=B.c.TriangleFillMode;v.push(this._loadMaterialAsync(y,f,null,S,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&v.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&v.push(this._compileShadowGeneratorsAsync());return Promise.all(v).then((()=>(this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.$b(!0),this._extensionsOnReady(),this._parent._setState(z.j.READY),this._startAnimations(),S()))).then((O=>(this._parent._endPerformanceCounter(H),h.d.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(b),this._parent._setState(z.j.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(O=>{this._parent.onErrorObservable.notifyObservers(O),this._parent.onErrorObservable.clear(),this.dispose()}))})),O)))})).catch((O=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(O),this._parent.onErrorObservable.clear(),this.dispose()),O}))}_loadData(O){if(this._gltf=O.json,this._setupData(),O.bin){const f=this._gltf.buffers;if(f&&f[0]&&!f[0].uri){const y=f[0];(y.byteLength<O.bin.byteLength-3||y.byteLength>O.bin.byteLength)&&J.e.Warn(`Binary buffer length (${y.byteLength}) from JSON does not match chunk length (${O.bin.byteLength})`),this._bin=O.bin}else J.e.Warn("Unexpected BIN chunk")}}_setupData(){if(Q.Assign(this._gltf.accessors),Q.Assign(this._gltf.animations),Q.Assign(this._gltf.buffers),Q.Assign(this._gltf.bufferViews),Q.Assign(this._gltf.cameras),Q.Assign(this._gltf.images),Q.Assign(this._gltf.materials),Q.Assign(this._gltf.meshes),Q.Assign(this._gltf.nodes),Q.Assign(this._gltf.samplers),Q.Assign(this._gltf.scenes),Q.Assign(this._gltf.skins),Q.Assign(this._gltf.textures),this._gltf.nodes){const O={};for(const y of this._gltf.nodes)if(y.children)for(const f of y.children)O[f]=y.index;const f=this._createRootNode();for(const y of this._gltf.nodes){const S=O[y.index];y.parent=void 0===S?f:this._gltf.nodes[S]}}}async _loadExtensionsAsync(){const O=[];if(P.forEach(((f,y)=>{var S;!1===(null===(S=this.parent.extensionOptions[y])||void 0===S?void 0:S.enabled)?f.isGLTFExtension&&this.isExtensionUsed(y)&&J.e.Warn(`Extension ${y} is used but has been explicitly disabled.`):f.isGLTFExtension&&!this.isExtensionUsed(y)||O.push((async()=>{const O=await f.factory(this);return O.name!==y&&J.e.Warn(`The name of the glTF loader extension instance does not match the registered name: ${O.name} !== ${y}`),this._parent.onExtensionLoadedObservable.notifyObservers(O),O})())})),this._extensions.push(...await Promise.all(O)),this._extensions.sort(((O,f)=>(O.order||Number.MAX_VALUE)-(f.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const y of this._gltf.extensionsRequired){if(!this._extensions.some((O=>O.name===y&&O.enabled))){var f;if(!1===(null===(f=this.parent.extensionOptions[y])||void 0===f?void 0:f.enabled))throw new Error(`Required extension ${y} is disabled`);throw new Error(`Required extension ${y} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const O=new V.d("__root__",this._babylonScene);this._rootBabylonMesh=O,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.$b(!1);const f={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case z.g.AUTO:this._babylonScene.useRightHandedSystem||(f.rotation=[0,1,0,0],f.scale=[1,1,-1],C._LoadTransform(f,this._rootBabylonMesh));break;case z.g.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(O),f}loadSceneAsync(O,f){const y=this._extensionsLoadSceneAsync(O,f);if(y)return y;const S=new Array;if(this.logOpen(`${O} ${f.name||""}`),f.nodes)for(const H of f.nodes){const f=Q.Get(`${O}/nodes/${H}`,this._gltf.nodes,H);S.push(this.loadNodeAsync(`/nodes/${f.index}`,f,(O=>{O.parent=this._rootBabylonMesh})))}for(const H of this._postSceneLoadActions)H();return S.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(S).then((()=>{}))}_forEachPrimitive(O,f){if(O._primitiveBabylonMeshes)for(const y of O._primitiveBabylonMeshes)f(y)}_getGeometries(){const O=[],f=this._gltf.nodes;if(f)for(const y of f)this._forEachPrimitive(y,(f=>{const y=f.Bj;y&&-1===O.indexOf(y)&&O.push(y)}));return O}_getMeshes(){const O=[];this._rootBabylonMesh instanceof D.c&&O.push(this._rootBabylonMesh);const f=this._gltf.nodes;if(f)for(const y of f)this._forEachPrimitive(y,(f=>{O.push(f)}));return O}_getTransformNodes(){const O=[],f=this._gltf.nodes;if(f)for(const y of f)y._babylonTransformNode&&"tb"===y._babylonTransformNode.getClassName()&&O.push(y._babylonTransformNode),y._babylonTransformNodeForSkin&&O.push(y._babylonTransformNodeForSkin);return O}_getSkeletons(){const O=[],f=this._gltf.skins;if(f)for(const y of f)y._data&&O.push(y._data.babylonSkeleton);return O}_getAnimationGroups(){const O=[],f=this._gltf.animations;if(f)for(const y of f)y._babylonAnimationGroup&&O.push(y._babylonAnimationGroup);return O}_startAnimations(){switch(this._parent.animationStartMode){case z.f.NONE:break;case z.f.FIRST:{const O=this._getAnimationGroups();0!==O.length&&O[0].start(!0);break}case z.f.ALL:{const O=this._getAnimationGroups();for(const f of O)f.start(!0);break}default:return void J.e.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const S=this._extensionsLoadNodeAsync(O,f,y);if(S)return S;if(f._babylonTransformNode)throw new Error(`${O}: Invalid recursive node hierarchy`);const H=new Array;this.logOpen(`${O} ${f.name||""}`);const b=S=>{if(C.AddPointerMetadata(S,O),C._LoadTransform(f,S),void 0!=f.camera){const y=Q.Get(`${O}/camera`,this._gltf.cameras,f.camera);H.push(this.loadCameraAsync(`/cameras/${y.index}`,y,(O=>{O.parent=S})))}if(f.children)for(const y of f.children){const f=Q.Get(`${O}/children/${y}`,this._gltf.nodes,y);H.push(this.loadNodeAsync(`/nodes/${f.index}`,f,(O=>{O.parent=S})))}y(S)},h=void 0!=f.mesh,v=this._parent.loadSkins&&void 0!=f.skin;if(!h||v){const O=f.name||`node${f.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const y=new E.b(O,this._babylonScene);y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==f.mesh?f._babylonTransformNode=y:f._babylonTransformNodeForSkin=y,b(y)}if(h)if(v){const y=Q.Get(`${O}/mesh`,this._gltf.meshes,f.mesh);H.push(this._loadMeshAsync(`/meshes/${y.index}`,f,y,(y=>{const S=f._babylonTransformNodeForSkin;y.metadata=T(S.metadata,y.metadata||{});const b=Q.Get(`${O}/skin`,this._gltf.skins,f.skin);H.push(this._loadSkinAsync(`/skins/${b.index}`,f,b,(O=>{this._forEachPrimitive(f,(f=>{f.skeleton=O})),this._postSceneLoadActions.push((()=>{if(void 0!=b.skeleton){const O=Q.Get(`/skins/${b.index}/skeleton`,this._gltf.nodes,b.skeleton).parent;f.index===O.index?y.parent=S.parent:y.parent=O._babylonTransformNode}else y.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:S,skinnedNode:y})}))})))})))}else{const y=Q.Get(`${O}/mesh`,this._gltf.meshes,f.mesh);H.push(this._loadMeshAsync(`/meshes/${y.index}`,f,y,b))}return this.logClose(),Promise.all(H).then((()=>(this._forEachPrimitive(f,(O=>{O.Bj&&O.Bj.useBoundingInfoFromGeometry?O.Ea():O.refreshBoundingInfo(!0,!0)})),f._babylonTransformNode)))}_loadMeshAsync(O,f,y,S){const H=y.primitives;if(!H||!H.length)throw new Error(`${O}: Primitives are missing`);void 0==H[0].index&&Q.Assign(H);const b=new Array;this.logOpen(`${O} ${y.name||""}`);const h=f.name||`node${f.index}`;if(1===H.length){const S=y.primitives[0];b.push(this._loadMeshPrimitiveAsync(`${O}/primitives/${S.index}`,h,f,y,S,(O=>{f._babylonTransformNode=O,f._primitiveBabylonMeshes=[O]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,f._babylonTransformNode=new E.b(h,this._babylonScene),f._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,f._primitiveBabylonMeshes=[];for(const S of H)b.push(this._loadMeshPrimitiveAsync(`${O}/primitives/${S.index}`,`${h}_primitive${S.index}`,f,y,S,(O=>{O.parent=f._babylonTransformNode,f._primitiveBabylonMeshes.push(O)})))}return S(f._babylonTransformNode),this.logClose(),Promise.all(b).then((()=>f._babylonTransformNode))}_loadMeshPrimitiveAsync(O,f,y,S,H,b){const h=this._extensionsLoadMeshPrimitiveAsync(O,f,y,S,H,b);if(h)return h;this.logOpen(`${O}`);const v=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==y.skin&&!S.primitives[0].targets;let N,m;if(v&&H._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,N=H._instanceData.babylonSourceMesh.createInstance(f),N._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,m=H._instanceData.promise;else{const b=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const h=new V.d(f,this._babylonScene);h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,h.sideOrientation=this._babylonScene.useRightHandedSystem?B.c.CounterClockWiseSideOrientation:B.c.ClockWiseSideOrientation,this._createMorphTargets(O,y,S,H,h),b.push(this._loadVertexDataAsync(O,H,h).then((f=>this._loadMorphTargetsAsync(O,H,h,f).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,f.Ca(h),f._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const t=C._GetDrawMode(O,H.mode);if(void 0==H.material){let O=this._defaultBabylonMaterialData[t];O||(O=this._createDefaultMaterial("__GLTFLoader._default",t),this._parent.onMaterialLoadedObservable.notifyObservers(O),this._defaultBabylonMaterialData[t]=O),h.material=O}else if(!this.parent.skipMaterials){const f=Q.Get(`${O}/material`,this._gltf.materials,H.material);b.push(this._loadMaterialAsync(`/materials/${f.index}`,f,h,t,(O=>{h.material=O})))}m=Promise.all(b),v&&(H._instanceData={babylonSourceMesh:h,promise:m}),N=h}return C.AddPointerMetadata(N,O),this._parent.onMeshLoadedObservable.notifyObservers(N),b(N),this.logClose(),m.then((()=>N))}_loadVertexDataAsync(O,f,y){const S=this._extensionsLoadVertexDataAsync(O,f,y);if(S)return S;const b=f.attributes;if(!b)throw new Error(`${O}: Attributes are missing`);const h=new Array,v=new i.e(y.name,this._babylonScene);if(void 0==f.indices)y.isUnIndexed=!0;else{const y=Q.Get(`${O}/indices`,this._gltf.accessors,f.indices);h.push(this._loadIndicesAccessorAsync(`/accessors/${y.index}`,y).then((O=>{v.setIndices(O)})))}const N=(f,S,N)=>{if(void 0==b[f])return;y._delayInfo=y._delayInfo||[],-1===y._delayInfo.indexOf(S)&&y._delayInfo.push(S);const m=Q.Get(`${O}/attributes/${f}`,this._gltf.accessors,b[f]);h.push(this._loadVertexAccessorAsync(`/accessors/${m.index}`,m,S).then((O=>{if(O.getKind()===o.f.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!y.skeleton&&m.min&&m.max){const O=H.g.fb[0].Xd(...m.min),f=H.g.fb[1].Xd(...m.max);if(m.normalized&&5126!==m.componentType){let y=1;switch(m.componentType){case 5120:y=127;break;case 5121:y=255;break;case 5122:y=32767;break;case 5123:y=65535}const S=1/y;O.scaleInPlace(S),f.scaleInPlace(S)}v._boundingInfo=new d.e(O,f),v.useBoundingInfoFromGeometry=!0}v.setVerticesBuffer(O,m.count)}))),S==o.f.MatricesIndicesExtraKind&&(y.numBoneInfluencers=8),N&&N(m)};return N("POSITION",o.f.PositionKind),N("NORMAL",o.f.NormalKind),N("TANGENT",o.f.TangentKind),N("TEXCOORD_0",o.f.UVKind),N("TEXCOORD_1",o.f.UV2Kind),N("TEXCOORD_2",o.f.UV3Kind),N("TEXCOORD_3",o.f.UV4Kind),N("TEXCOORD_4",o.f.UV5Kind),N("TEXCOORD_5",o.f.UV6Kind),N("JOINTS_0",o.f.MatricesIndicesKind),N("WEIGHTS_0",o.f.MatricesWeightsKind),N("JOINTS_1",o.f.MatricesIndicesExtraKind),N("WEIGHTS_1",o.f.MatricesWeightsExtraKind),N("COLOR_0",o.f.ColorKind,(O=>{"VEC4"===O.type&&(y.hasVertexAlpha=!0)})),Promise.all(h).then((()=>v))}_createMorphTargets(O,f,y,S,H){if(!S.targets||!this._parent.loadMorphTargets)return;if(void 0==f._numMorphTargets)f._numMorphTargets=S.targets.length;else if(S.targets.length!==f._numMorphTargets)throw new Error(`${O}: Primitives do not have the same number of targets`);const b=y.extras?y.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,H.morphTargetManager=new k(this._babylonScene),H.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,H.morphTargetManager.areUpdatesFrozen=!0;for(let h=0;h<S.targets.length;h++){const O=f.weights?f.weights[h]:y.weights?y.weights[h]:0,S=b?b[h]:`morphTarget${h}`;H.morphTargetManager.addTarget(new g(S,O,H.va()))}}_loadMorphTargetsAsync(O,f,y,S){if(!f.targets||!this._parent.loadMorphTargets)return Promise.resolve();const H=new Array,b=y.morphTargetManager;for(let h=0;h<b.numTargets;h++){const y=b.getTarget(h);H.push(this._loadMorphTargetVertexDataAsync(`${O}/targets/${h}`,S,f.targets[h],y))}return Promise.all(H).then((()=>{b.areUpdatesFrozen=!1}))}_loadMorphTargetVertexDataAsync(O,f,y,S){const H=new Array,b=(S,b,h)=>{if(void 0==y[S])return;const v=f.getVertexBuffer(b);if(!v)return;const N=Q.Get(`${O}/${S}`,this._gltf.accessors,y[S]);H.push(this._loadFloatAccessorAsync(`/accessors/${N.index}`,N).then((O=>{h(v,O)})))};return b("POSITION",o.f.PositionKind,((O,f)=>{const y=new Float32Array(f.length);O.forEach(f.length,((O,S)=>{y[S]=f[S]+O})),S.setPositions(y)})),b("NORMAL",o.f.NormalKind,((O,f)=>{const y=new Float32Array(f.length);O.forEach(y.length,((O,S)=>{y[S]=f[S]+O})),S.setNormals(y)})),b("TANGENT",o.f.TangentKind,((O,f)=>{const y=new Float32Array(f.length/3*4);let H=0;O.forEach(f.length/3*4,((O,S)=>{(S+1)%4!==0&&(y[H]=f[H]+O,H++)})),S.setTangents(y)})),Promise.all(H).then((()=>{}))}static _LoadTransform(O,f){if(void 0!=O.skin)return;let y=H.m.Zero(),S=H.c.Identity(),b=H.m.One();if(O.matrix){H.b.Ng(O.matrix).decompose(b,S,y)}else O.translation&&(y=H.m.Ng(O.translation)),O.rotation&&(S=H.c.Ng(O.rotation)),O.scale&&(b=H.m.Ng(O.scale));f.position=y,f.rotationQuaternion=S,f.Yd=b}_loadSkinAsync(O,f,y,S){if(!this._parent.loadSkins)return Promise.resolve();const H=this._extensionsLoadSkinAsync(O,f,y);if(H)return H;if(y._data)return S(y._data.babylonSkeleton),y._data.promise;const b=`skeleton${y.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const h=new w(y.name||b,b,this._babylonScene);h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(O,y,h);const v=this._loadSkinInverseBindMatricesDataAsync(O,y).then((O=>{this._updateBoneMatrices(h,O)}));return y._data={babylonSkeleton:h,promise:v},S(h),v}_loadBones(O,f,y){if(void 0==f.skeleton||this._parent.alwaysComputeSkeletonRootNode){const y=this._findSkeletonRootNode(`${O}/joints`,f.joints);if(y)if(void 0===f.skeleton)f.skeleton=y.index;else{const S=(O,f)=>{for(;f.parent;f=f.parent)if(f.parent===O)return!0;return!1},H=Q.Get(`${O}/skeleton`,this._gltf.nodes,f.skeleton);H===y||S(H,y)||(J.e.Warn(`${O}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),f.skeleton=y.index)}else J.e.Warn(`${O}: Failed to find common root`)}const S={};for(const H of f.joints){const b=Q.Get(`${O}/joints/${H}`,this._gltf.nodes,H);this._loadBone(b,f,y,S)}}_findSkeletonRootNode(O,f){if(0===f.length)return null;const y={};for(const H of f){const f=[];let S=Q.Get(`${O}/${H}`,this._gltf.nodes,H);for(;-1!==S.index;)f.unshift(S),S=S.parent;y[H]=f}let S=null;for(let H=0;;++H){let O=y[f[0]];if(H>=O.length)return S;const b=O[H];for(let h=1;h<f.length;++h)if(O=y[f[h]],H>=O.length||b!==O[H])return S;S=b}}_loadBone(O,f,y,S){O._isJoint=!0;let H=S[O.index];if(H)return H;let b=null;O.index!==f.skeleton&&(O.parent&&-1!==O.parent.index?b=this._loadBone(O.parent,f,y,S):void 0!==f.skeleton&&J.e.Warn(`/skins/${f.index}/skeleton: Skeleton node is not a common root`));const h=f.joints.indexOf(O.index);return H=new m.b(O.name||`joint${O.index}`,y,b,this._getNodeMatrix(O),null,null,h),S[O.index]=H,this._postSceneLoadActions.push((()=>{H.linkTransformNode(O._babylonTransformNode)})),H}_loadSkinInverseBindMatricesDataAsync(O,f){if(void 0==f.inverseBindMatrices)return Promise.resolve(null);const y=Q.Get(`${O}/inverseBindMatrices`,this._gltf.accessors,f.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${y.index}`,y)}_updateBoneMatrices(O,f){for(const y of O.bones){const O=H.b.Identity(),S=y._index;f&&-1!==S&&(H.b.FromArrayToRef(f,16*S,O),O.invertToRef(O));const b=y.getParent();b&&O.multiplyToRef(b.getAbsoluteInverseBindMatrix(),O),y.Fj(O,!1,!1),y._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(O){return O.matrix?H.b.Ng(O.matrix):H.b.Compose(O.scale?H.m.Ng(O.scale):H.m.One(),O.rotation?H.c.Ng(O.rotation):H.c.Identity(),O.translation?H.m.Ng(O.translation):H.m.Zero())}loadCameraAsync(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const S=this._extensionsLoadCameraAsync(O,f,y);if(S)return S;const b=new Array;this.logOpen(`${O} ${f.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const h=new N.b(f.name||`camera${f.index}`,H.m.Zero(),this._babylonScene,!1);switch(h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,h.ignoreParentScaling=!0,f._babylonCamera=h,h.rotation.set(0,Math.PI,0),f.type){case"perspective":{const y=f.perspective;if(!y)throw new Error(`${O}: Camera perspective properties are missing`);h.fov=y.yfov,h.Ui=y.znear,h.maxZ=y.zfar||0;break}case"orthographic":if(!f.orthographic)throw new Error(`${O}: Camera orthographic properties are missing`);h.mode=v.c.ORTHOGRAPHIC_CAMERA,h.orthoLeft=-f.orthographic.xmag,h.orthoRight=f.orthographic.xmag,h.orthoBottom=-f.orthographic.ymag,h.orthoTop=f.orthographic.ymag,h.Ui=f.orthographic.znear,h.maxZ=f.orthographic.zfar;break;default:throw new Error(`${O}: Invalid camera type (${f.type})`)}return C.AddPointerMetadata(h,O),this._parent.onCameraLoadedObservable.notifyObservers(h),y(h),this.logClose(),Promise.all(b).then((()=>h))}_loadAnimationsAsync(){const O=this._gltf.animations;if(!O)return Promise.resolve();const f=new Array;for(let y=0;y<O.length;y++){const S=O[y];f.push(this.loadAnimationAsync(`/animations/${S.index}`,S).then((O=>{0===O.targetedAnimations.length&&O.dispose()})))}return Promise.all(f).then((()=>{}))}loadAnimationAsync(O,f){const S=this._extensionsLoadAnimationAsync(O,f);return S||y.e(38).then(y.bind(y,13462)).then((y=>{let{AnimationGroup:S}=y;this._babylonScene._blockEntityCollection=!!this._assetContainer;const H=new S(f.name||`animation${f.index}`,this._babylonScene);H._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,f._babylonAnimationGroup=H;const b=new Array;Q.Assign(f.channels),Q.Assign(f.samplers);for(const h of f.channels)b.push(this._loadAnimationChannelAsync(`${O}/channels/${h.index}`,O,f,h,((O,f)=>{O.animations=O.animations||[],O.animations.push(f),H.addTargetedAnimation(f,O)})));return Promise.all(b).then((()=>(H.normalize(0),H)))}))}_loadAnimationChannelAsync(O,f,y,S,H){const b=this._extensionsLoadAnimationChannelAsync(O,f,y,S,H);if(b)return b;if(void 0==S.target.node)return Promise.resolve();const h=Q.Get(`${O}/target/node`,this._gltf.nodes,S.target.node),v=S.target.path,N="weights"===v;if(N&&!h._numMorphTargets||!N&&!h._babylonTransformNode)return Promise.resolve();if(!this._parent.loadNodeAnimations&&!N&&!h._isJoint)return Promise.resolve();let m;switch(v){case"translation":m=a.translation;break;case"rotation":m=a.rotation;break;case"scale":m=a.scale;break;case"weights":m=a.weights;break;default:throw new Error(`${O}/target/path: Invalid value (${S.target.path})`)}const t={object:h,info:m};return this._loadAnimationChannelFromTargetInfoAsync(O,f,y,S,t,H)}_loadAnimationChannelFromTargetInfoAsync(O,f,y,S,H,b){const h=this.parent.targetFps,v=1/h,N=Q.Get(`${O}/sampler`,y.samplers,S.sampler);return this._loadAnimationSamplerAsync(`${f}/samplers/${S.sampler}`,N).then((O=>{let f=0;const N=H.object,m=H.info;for(const H of m){const m=H.getStride(N),t=O.input,q=O.output,F=new Array(t.length);let I=0;switch(O.interpolation){case"STEP":for(let O=0;O<t.length;O++){const f=H.getValue(N,q,I,1);I+=m,F[O]={frame:t[O]*h,value:f,interpolation:1}}break;case"CUBICSPLINE":for(let O=0;O<t.length;O++){const f=H.getValue(N,q,I,v);I+=m;const y=H.getValue(N,q,I,1);I+=m;const S=H.getValue(N,q,I,v);I+=m,F[O]={frame:t[O]*h,inTangent:f,value:y,outTangent:S}}break;case"LINEAR":for(let O=0;O<t.length;O++){const f=H.getValue(N,q,I,1);I+=m,F[O]={frame:t[O]*h,value:f}}}if(I>0){const O=`${y.name||`animation${y.index}`}_channel${S.index}_${f}`;H.buildAnimations(N,O,h,F,((O,y)=>{++f,b(O,y)}))}}}))}_loadAnimationSamplerAsync(O,f){if(f._data)return f._data;const y=f.interpolation||"LINEAR";switch(y){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${O}/interpolation: Invalid value (${f.interpolation})`)}const S=Q.Get(`${O}/input`,this._gltf.accessors,f.input),H=Q.Get(`${O}/output`,this._gltf.accessors,f.output);return f._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${S.index}`,S),this._loadFloatAccessorAsync(`/accessors/${H.index}`,H)]).then((O=>{let[f,S]=O;return{input:f,interpolation:y,output:S}})),f._data}loadBufferAsync(O,f,y,S){const H=this._extensionsLoadBufferAsync(O,f,y,S);if(H)return H;if(!f._data)if(f.uri)f._data=this.loadUriAsync(`${O}/uri`,f,f.uri);else{if(!this._bin)throw new Error(`${O}: Uri is missing or the binary glTF is missing its binary chunk`);f._data=this._bin.readAsync(0,f.byteLength)}return f._data.then((f=>{try{return new Uint8Array(f.buffer,f.byteOffset+y,S)}catch(H){throw new Error(`${O}: ${H.message}`)}}))}loadBufferViewAsync(O,f){const y=this._extensionsLoadBufferViewAsync(O,f);if(y)return y;if(f._data)return f._data;const S=Q.Get(`${O}/buffer`,this._gltf.buffers,f.buffer);return f._data=this.loadBufferAsync(`/buffers/${S.index}`,S,f.byteOffset||0,f.byteLength),f._data}_loadAccessorAsync(O,f,y){if(f._data)return f._data;const S=C._GetNumComponents(O,f.type),H=S*o.f.GetTypeByteLength(f.componentType),b=S*f.count;if(void 0==f.bufferView)f._data=Promise.resolve(new y(b));else{const h=Q.Get(`${O}/bufferView`,this._gltf.bufferViews,f.bufferView);f._data=this.loadBufferViewAsync(`/bufferViews/${h.index}`,h).then((v=>{if(5126!==f.componentType||f.normalized||h.byteStride&&h.byteStride!==H){const O=new y(b);return o.f.ForEach(v,f.byteOffset||0,h.byteStride||H,S,f.componentType,O.length,f.normalized||!1,((f,y)=>{O[y]=f})),O}return C._GetTypedArray(O,f.componentType,v,f.byteOffset,b)}))}if(f.sparse){const b=f.sparse;f._data=f._data.then((h=>{const v=h,N=Q.Get(`${O}/sparse/indices/bufferView`,this._gltf.bufferViews,b.indices.bufferView),m=Q.Get(`${O}/sparse/values/bufferView`,this._gltf.bufferViews,b.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${N.index}`,N),this.loadBufferViewAsync(`/bufferViews/${m.index}`,m)]).then((h=>{let[N,m]=h;const t=C._GetTypedArray(`${O}/sparse/indices`,b.indices.componentType,N,b.indices.byteOffset,b.count),q=S*b.count;let F;if(5126!==f.componentType||f.normalized){const h=C._GetTypedArray(`${O}/sparse/values`,f.componentType,m,b.values.byteOffset,q);F=new y(q),o.f.ForEach(h,0,H,S,f.componentType,F.length,f.normalized||!1,((O,f)=>{F[f]=O}))}else F=C._GetTypedArray(`${O}/sparse/values`,f.componentType,m,b.values.byteOffset,q);let I=0;for(let O=0;O<t.length;O++){let f=t[O]*S;for(let O=0;O<S;O++)v[f++]=F[I++]}return v}))}))}return f._data}_loadFloatAccessorAsync(O,f){return this._loadAccessorAsync(O,f,Float32Array)}_loadIndicesAccessorAsync(O,f){if("SCALAR"!==f.type)throw new Error(`${O}/type: Invalid value ${f.type}`);if(5121!==f.componentType&&5123!==f.componentType&&5125!==f.componentType)throw new Error(`${O}/componentType: Invalid value ${f.componentType}`);if(f._data)return f._data;if(f.sparse){const y=C._GetTypedArrayConstructor(`${O}/componentType`,f.componentType);f._data=this._loadAccessorAsync(O,f,y)}else{const y=Q.Get(`${O}/bufferView`,this._gltf.bufferViews,f.bufferView);f._data=this.loadBufferViewAsync(`/bufferViews/${y.index}`,y).then((y=>C._GetTypedArray(O,f.componentType,y,f.byteOffset,f.count)))}return f._data}_loadVertexBufferViewAsync(O){if(O._babylonBuffer)return O._babylonBuffer;const f=this._babylonScene.getEngine();return O._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${O.index}`,O).then((O=>new o.d(f,O,!1))),O._babylonBuffer}_loadVertexAccessorAsync(O,f,y){var S;if(null!==(S=f._babylonVertexBuffer)&&void 0!==S&&S[y])return f._babylonVertexBuffer[y];f._babylonVertexBuffer||(f._babylonVertexBuffer={});const H=this._babylonScene.getEngine();if(f.sparse||void 0==f.bufferView)f._babylonVertexBuffer[y]=this._loadFloatAccessorAsync(O,f).then((O=>new o.f(H,O,y,!1)));else{const S=Q.Get(`${O}/bufferView`,this._gltf.bufferViews,f.bufferView);f._babylonVertexBuffer[y]=this._loadVertexBufferViewAsync(S).then((b=>{const h=C._GetNumComponents(O,f.type);return new o.f(H,b,y,!1,void 0,S.byteStride,void 0,f.byteOffset,h,f.componentType,f.normalized,!0,void 0,!0)}))}return f._babylonVertexBuffer[y]}_loadMaterialMetallicRoughnessPropertiesAsync(O,f,y){if(!(y instanceof x))throw new Error(`${O}: Material type not supported`);const S=new Array;return f&&(f.baseColorFactor?(y.albedoColor=b.d.Ng(f.baseColorFactor),y.alpha=f.baseColorFactor[3]):y.albedoColor=b.d.White(),y.metallic=void 0==f.metallicFactor?1:f.metallicFactor,y.roughness=void 0==f.roughnessFactor?1:f.roughnessFactor,f.baseColorTexture&&S.push(this.loadTextureInfoAsync(`${O}/baseColorTexture`,f.baseColorTexture,(O=>{O.name=`${y.name} (Base Color)`,y.albedoTexture=O}))),f.metallicRoughnessTexture&&(f.metallicRoughnessTexture.nonColorData=!0,S.push(this.loadTextureInfoAsync(`${O}/metallicRoughnessTexture`,f.metallicRoughnessTexture,(O=>{O.name=`${y.name} (Metallic Roughness)`,y.metallicTexture=O}))),y.useMetallnessFromMetallicTextureBlue=!0,y.useRoughnessFromMetallicTextureGreen=!0,y.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(S).then((()=>{}))}_loadMaterialAsync(O,f,y,S){let H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const b=this._extensionsLoadMaterialAsync(O,f,y,S,H);if(b)return b;f._data=f._data||{};let h=f._data[S];if(!h){this.logOpen(`${O} ${f.name||""}`);const y=this.createMaterial(O,f,S);h={babylonMaterial:y,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(O,f,y)},f._data[S]=h,C.AddPointerMetadata(y,O),this._parent.onMaterialLoadedObservable.notifyObservers(y),this.logClose()}return y&&(h.babylonMeshes.push(y),y.hj.addOnce((()=>{const O=h.babylonMeshes.indexOf(y);-1!==O&&h.babylonMeshes.splice(O,1)}))),H(h.babylonMaterial),h.promise.then((()=>h.babylonMaterial))}_createDefaultMaterial(O,f){this._babylonScene._blockEntityCollection=!!this._assetContainer;const y=new x(O,this._babylonScene);return y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,y.fillMode=f,y.enableSpecularAntiAliasing=!0,y.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,y.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,y.transparencyMode=x.PBRMATERIAL_OPAQUE,y.metallic=1,y.roughness=1,y}createMaterial(O,f,y){const S=this._extensionsCreateMaterial(O,f,y);if(S)return S;const H=f.name||`material${f.index}`;return this._createDefaultMaterial(H,y)}loadMaterialPropertiesAsync(O,f,y){const S=this._extensionsLoadMaterialPropertiesAsync(O,f,y);if(S)return S;const H=new Array;return H.push(this.loadMaterialBasePropertiesAsync(O,f,y)),f.pbrMetallicRoughness&&H.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${O}/pbrMetallicRoughness`,f.pbrMetallicRoughness,y)),this.loadMaterialAlphaProperties(O,f,y),Promise.all(H).then((()=>{}))}loadMaterialBasePropertiesAsync(O,f,y){if(!(y instanceof x))throw new Error(`${O}: Material type not supported`);const S=new Array;return y.emissiveColor=f.emissiveFactor?b.d.Ng(f.emissiveFactor):new b.d(0,0,0),f.doubleSided&&(y.Wg=!1,y.twoSidedLighting=!0),f.normalTexture&&(f.normalTexture.nonColorData=!0,S.push(this.loadTextureInfoAsync(`${O}/normalTexture`,f.normalTexture,(O=>{O.name=`${y.name} (Normal)`,y.bumpTexture=O}))),y.invertNormalMapX=!this._babylonScene.useRightHandedSystem,y.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=f.normalTexture.scale&&y.bumpTexture&&(y.bumpTexture.level=f.normalTexture.scale),y.forceIrradianceInFragment=!0),f.occlusionTexture&&(f.occlusionTexture.nonColorData=!0,S.push(this.loadTextureInfoAsync(`${O}/occlusionTexture`,f.occlusionTexture,(O=>{O.name=`${y.name} (Occlusion)`,y.ambientTexture=O}))),y.useAmbientInGrayScale=!0,void 0!=f.occlusionTexture.strength&&(y.ambientTextureStrength=f.occlusionTexture.strength)),f.emissiveTexture&&S.push(this.loadTextureInfoAsync(`${O}/emissiveTexture`,f.emissiveTexture,(O=>{O.name=`${y.name} (Emissive)`,y.emissiveTexture=O}))),Promise.all(S).then((()=>{}))}loadMaterialAlphaProperties(O,f,y){if(!(y instanceof x))throw new Error(`${O}: Material type not supported`);switch(f.alphaMode||"OPAQUE"){case"OPAQUE":y.transparencyMode=x.PBRMATERIAL_OPAQUE,y.alpha=1;break;case"MASK":y.transparencyMode=x.PBRMATERIAL_ALPHATEST,y.alphaCutOff=void 0==f.alphaCutoff?.5:f.alphaCutoff,y.albedoTexture&&(y.albedoTexture.ke=!0);break;case"BLEND":y.transparencyMode=x.PBRMATERIAL_ALPHABLEND,y.albedoTexture&&(y.albedoTexture.ke=!0,y.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${O}/alphaMode: Invalid value (${f.alphaMode})`)}}loadTextureInfoAsync(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const S=this._extensionsLoadTextureInfoAsync(O,f,y);if(S)return S;if(this.logOpen(`${O}`),f.texCoord>=6)throw new Error(`${O}/texCoord: Invalid value (${f.texCoord})`);const H=Q.Get(`${O}/index`,this._gltf.textures,f.index);H._textureInfo=f;const b=this._loadTextureAsync(`/textures/${f.index}`,H,(S=>{S.coordinatesIndex=f.texCoord||0,C.AddPointerMetadata(S,O),this._parent.onTextureLoadedObservable.notifyObservers(S),y(S)}));return this.logClose(),b}_loadTextureAsync(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const S=this._extensionsLoadTextureAsync(O,f,y);if(S)return S;this.logOpen(`${O} ${f.name||""}`);const H=void 0==f.sampler?C.DefaultSampler:Q.Get(`${O}/sampler`,this._gltf.samplers,f.sampler),b=Q.Get(`${O}/source`,this._gltf.images,f.source),h=this._createTextureAsync(O,H,b,y,void 0,!f._textureInfo.nonColorData);return this.logClose(),h}_createTextureAsync(O,f,y){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},b=arguments.length>4?arguments[4]:void 0,h=arguments.length>5?arguments[5]:void 0;const v=this._loadSampler(`/samplers/${f.index}`,f),N=new Array,m=new S;this._babylonScene._blockEntityCollection=!!this._assetContainer;const t={noMipmap:v.noMipMaps,invertY:!1,samplingMode:v.samplingMode,X:()=>{this._disposed||m.resolve()},onError:(f,y)=>{this._disposed||m.reject(new Error(`${O}: ${y&&y.message?y.message:f||"Failed to load texture"}`))},mimeType:y.mimeType,loaderOptions:b,useSRGBBuffer:!!h&&this._parent.useSRGBBuffers},q=new W.e(null,this._babylonScene,t);return q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,N.push(m.promise),N.push(this.loadImageAsync(`/images/${y.index}`,y).then((O=>{const f=y.uri||`${this._fileName}#image${y.index}`,S=`data:${this._uniqueRootUrl}${f}`;q.updateURL(S,O);const H=q.getInternalTexture();H&&(H.label=y.name)}))),q.wrapU=v.wrapU,q.wrapV=v.wrapV,H(q),this._parent.useGltfTextureNames&&(q.name=y.name||y.uri||`image${y.index}`),Promise.all(N).then((()=>q))}_loadSampler(O,f){return f._data||(f._data={noMipMaps:9728===f.minFilter||9729===f.minFilter,samplingMode:C._GetTextureSamplingMode(O,f),wrapU:C._GetTextureWrapMode(`${O}/wrapS`,f.wrapS),wrapV:C._GetTextureWrapMode(`${O}/wrapT`,f.wrapT)}),f._data}loadImageAsync(O,f){if(!f._data){if(this.logOpen(`${O} ${f.name||""}`),f.uri)f._data=this.loadUriAsync(`${O}/uri`,f,f.uri);else{const y=Q.Get(`${O}/bufferView`,this._gltf.bufferViews,f.bufferView);f._data=this.loadBufferViewAsync(`/bufferViews/${y.index}`,y)}this.logClose()}return f._data}loadUriAsync(O,f,y){const S=this._extensionsLoadUriAsync(O,f,y);if(S)return S;if(!C._ValidateUri(y))throw new Error(`${O}: '${y}' is invalid`);if((0,c.g)(y)){const f=new Uint8Array((0,c.c)(y));return this.log(`${O}: Decoded ${y.substring(0,64)}... (${f.length} bytes)`),Promise.resolve(f)}return this.log(`${O}: Loading ${y}`),this._parent.preprocessUrlAsync(this._rootUrl+y).then((f=>new Promise(((S,H)=>{this._parent._loadFile(this._babylonScene,f,(f=>{this._disposed||(this.log(`${O}: Loaded ${y} (${f.byteLength} bytes)`),S(new Uint8Array(f)))}),!0,(f=>{H(new c.k(`${O}: Failed to load '${y}'${f?": "+f.status+" "+f.statusText:""}`,f))}))}))))}static AddPointerMetadata(O,f){O.metadata=O.metadata||{};const y=O._internalMetadata=O._internalMetadata||{},S=y.Mi=y.Mi||{};(S.pointers=S.pointers||[]).push(f)}static _GetTextureWrapMode(O,f){switch(f=void 0==f?10497:f){case 33071:return W.e.CLAMP_ADDRESSMODE;case 33648:return W.e.MIRROR_ADDRESSMODE;case 10497:return W.e.WRAP_ADDRESSMODE;default:return J.e.Warn(`${O}: Invalid value (${f})`),W.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(O,f){const y=void 0==f.magFilter?9729:f.magFilter,S=void 0==f.minFilter?9987:f.minFilter;if(9729===y)switch(S){case 9728:return W.e.LINEAR_NEAREST;case 9729:return W.e.LINEAR_LINEAR;case 9984:return W.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return W.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return W.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return W.e.LINEAR_LINEAR_MIPLINEAR;default:return J.e.Warn(`${O}/minFilter: Invalid value (${S})`),W.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==y&&J.e.Warn(`${O}/magFilter: Invalid value (${y})`),S){case 9728:return W.e.NEAREST_NEAREST;case 9729:return W.e.NEAREST_LINEAR;case 9984:return W.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return W.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return W.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return W.e.NEAREST_LINEAR_MIPLINEAR;default:return J.e.Warn(`${O}/minFilter: Invalid value (${S})`),W.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(O,f){switch(f){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`${O}: Invalid component type ${f}`)}}static _GetTypedArray(O,f,y,S,H){const b=y.buffer;S=y.byteOffset+(S||0);const h=C._GetTypedArrayConstructor(`${O}/componentType`,f),v=o.f.GetTypeByteLength(f);return S%v!==0?(J.e.Warn(`${O}: Copying buffer as byte offset (${S}) is not a multiple of component type byte length (${v})`),new h(b.slice(S,S+H*v),0)):new h(b,S,H)}static _GetNumComponents(O,f){switch(f){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${O}: Invalid type (${f})`)}static _ValidateUri(O){return h.d.IsBase64(O)||-1===O.indexOf("..")}static _GetDrawMode(O,f){switch(void 0==f&&(f=4),f){case 0:return B.c.PointListDrawMode;case 1:return B.c.LineListDrawMode;case 2:return B.c.LineLoopDrawMode;case 3:return B.c.LineStripDrawMode;case 4:return B.c.TriangleFillMode;case 5:return B.c.TriangleStripDrawMode;case 6:return B.c.TriangleFanDrawMode}throw new Error(`${O}: Invalid mesh primitive mode (${f})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const O=new Array;if(this._gltf.materials)for(const f of this._gltf.materials)if(f._data)for(const y in f._data){const S=f._data[y];for(const f of S.babylonMeshes){f.Mj(!0);const y=S.babylonMaterial;O.push(y.forceCompilationAsync(f)),O.push(y.forceCompilationAsync(f,{useInstances:!0})),this._parent.useClipPlane&&(O.push(y.forceCompilationAsync(f,{clipPlane:!0})),O.push(y.forceCompilationAsync(f,{clipPlane:!0,useInstances:!0})))}}return Promise.all(O).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const O=new Array,f=this._babylonScene.lights;for(const y of f){const f=y.getShadowGenerator();f&&O.push(f.forceCompilationAsync())}return Promise.all(O).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(O){for(const f of this._extensions)f.enabled&&O(f)}_applyExtensions(O,f,y){for(const S of this._extensions)if(S.enabled){const H=`${S.name}.${f}`,b=O;b._activeLoaderExtensionFunctions=b._activeLoaderExtensionFunctions||{};const h=b._activeLoaderExtensionFunctions;if(!h[H]){h[H]=!0;try{const O=y(S);if(O)return O}finally{delete h[H]}}}return null}_extensionsOnLoading(){this._forEachExtensions((O=>O.onLoading&&O.onLoading()))}_extensionsOnReady(){this._forEachExtensions((O=>O.onReady&&O.onReady()))}_extensionsLoadSceneAsync(O,f){return this._applyExtensions(f,"loadScene",(y=>y.loadSceneAsync&&y.loadSceneAsync(O,f)))}_extensionsLoadNodeAsync(O,f,y){return this._applyExtensions(f,"loadNode",(S=>S.loadNodeAsync&&S.loadNodeAsync(O,f,y)))}_extensionsLoadCameraAsync(O,f,y){return this._applyExtensions(f,"loadCamera",(S=>S.loadCameraAsync&&S.loadCameraAsync(O,f,y)))}_extensionsLoadVertexDataAsync(O,f,y){return this._applyExtensions(f,"loadVertexData",(S=>S._loadVertexDataAsync&&S._loadVertexDataAsync(O,f,y)))}_extensionsLoadMeshPrimitiveAsync(O,f,y,S,H,b){return this._applyExtensions(H,"loadMeshPrimitive",(h=>h._loadMeshPrimitiveAsync&&h._loadMeshPrimitiveAsync(O,f,y,S,H,b)))}_extensionsLoadMaterialAsync(O,f,y,S,H){return this._applyExtensions(f,"loadMaterial",(b=>b._loadMaterialAsync&&b._loadMaterialAsync(O,f,y,S,H)))}_extensionsCreateMaterial(O,f,y){return this._applyExtensions(f,"createMaterial",(S=>S.createMaterial&&S.createMaterial(O,f,y)))}_extensionsLoadMaterialPropertiesAsync(O,f,y){return this._applyExtensions(f,"loadMaterialProperties",(S=>S.loadMaterialPropertiesAsync&&S.loadMaterialPropertiesAsync(O,f,y)))}_extensionsLoadTextureInfoAsync(O,f,y){return this._applyExtensions(f,"loadTextureInfo",(S=>S.loadTextureInfoAsync&&S.loadTextureInfoAsync(O,f,y)))}_extensionsLoadTextureAsync(O,f,y){return this._applyExtensions(f,"loadTexture",(S=>S._loadTextureAsync&&S._loadTextureAsync(O,f,y)))}_extensionsLoadAnimationAsync(O,f){return this._applyExtensions(f,"loadAnimation",(y=>y.loadAnimationAsync&&y.loadAnimationAsync(O,f)))}_extensionsLoadAnimationChannelAsync(O,f,y,S,H){return this._applyExtensions(y,"loadAnimationChannel",(b=>b._loadAnimationChannelAsync&&b._loadAnimationChannelAsync(O,f,y,S,H)))}_extensionsLoadSkinAsync(O,f,y){return this._applyExtensions(y,"loadSkin",(S=>S._loadSkinAsync&&S._loadSkinAsync(O,f,y)))}_extensionsLoadUriAsync(O,f,y){return this._applyExtensions(f,"loadUri",(S=>S._loadUriAsync&&S._loadUriAsync(O,f,y)))}_extensionsLoadBufferViewAsync(O,f){return this._applyExtensions(f,"loadBufferView",(y=>y.loadBufferViewAsync&&y.loadBufferViewAsync(O,f)))}_extensionsLoadBufferAsync(O,f,y,S){return this._applyExtensions(f,"loadBuffer",(H=>H.loadBufferAsync&&H.loadBufferAsync(O,f,y,S)))}static LoadExtensionAsync(O,f,y,S){if(!f.extensions)return null;const H=f.extensions[y];return H?S(`${O}/extensions/${y}`,H):null}static LoadExtraAsync(O,f,y,S){if(!f.extras)return null;const H=f.extras[y];return H?S(`${O}/extras/${y}`,H):null}isExtensionUsed(O){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(O)}logOpen(O){this._parent._logOpen(O)}logClose(){this._parent._logClose()}log(O){this._parent._log(O)}startPerformanceCounter(O){this._parent._startPerformanceCounter(O)}endPerformanceCounter(O){this._parent._endPerformanceCounter(O)}}C.DefaultSampler={index:-1},z.d._CreateGLTF2Loader=O=>new C(O);var r=y(11776),n=y(12258),OO=y(12271);class fO extends OO.c{constructor(O,f,y){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,b=arguments.length>5&&void 0!==arguments[5]&&arguments[5],h=arguments.length>6&&void 0!==arguments[6]&&arguments[6],v=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,N=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",O),this._texture=O.getEngine().createRawCubeTexture(f,y,S,H,b,h,v,N)}update(O,f,y,S){let H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,O,f,y,S,H)}updateRGBDAsync(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,n.l)(this._texture,O,f,y,S).then((()=>{}))}clone(){return l.b.Clone((()=>{const O=this.va(),f=this._texture,y=new fO(O,f._bufferViewArray,f.width,f.format,f.type,f.generateMipMaps,f.invertY,f.samplingMode,f._compression);return 13===f.source&&y.updateRGBDAsync(f._bufferViewArrayArray,f._sphericalPolynomial,f._lodGenerationScale,f._lodGenerationOffset),y}),this)}}const yO="EXT_lights_image_based";class SO{constructor(O){this.name=yO,this._loader=O,this.enabled=this._loader.isExtensionUsed(yO)}dispose(){this._loader=null,delete this._lights}onLoading(){const O=this._loader.Mi.extensions;if(O&&O[this.name]){const f=O[this.name];this._lights=f.lights}}loadSceneAsync(O,f){return C.LoadExtensionAsync(O,f,this.name,((y,S)=>{this._loader._allMaterialsDirtyRequired=!0;const H=new Array;H.push(this._loader.loadSceneAsync(O,f)),this._loader.logOpen(`${y}`);const b=Q.Get(`${y}/light`,this._lights,S.eb);return H.push(this._loadLightAsync(`/extensions/${this.name}/lights/${S.eb}`,b).then((O=>{this._loader.babylonScene.environmentTexture=O}))),this._loader.logClose(),Promise.all(H).then((()=>{}))}))}_loadLightAsync(O,f){if(!f._loaded){const y=new Array;this._loader.logOpen(`${O}`);const S=new Array(f.specularImages.length);for(let H=0;H<f.specularImages.length;H++){const b=f.specularImages[H];S[H]=new Array(b.length);for(let f=0;f<b.length;f++){const h=`${O}/specularImages/${H}/${f}`;this._loader.logOpen(`${h}`);const v=b[f],N=Q.Get(h,this._loader.Mi.images,v);y.push(this._loader.loadImageAsync(`/images/${v}`,N).then((O=>{S[H][f]=O}))),this._loader.logClose()}}this._loader.logClose(),f._loaded=Promise.all(y).then((()=>{const y=new fO(this._loader.babylonScene,null,f.specularImageSize);if(y.name=f.name||"environment",f._babylonTexture=y,void 0!=f.Yi&&(y.level=f.Yi),f.rotation){let O=H.c.Ng(f.rotation);this._loader.babylonScene.useRightHandedSystem||(O=H.c.Inverse(O)),H.b.FromQuaternionToRef(O,y.getReflectionTextureMatrix())}if(!f.irradianceCoefficients)throw new Error(`${O}: Irradiance coefficients are missing`);const b=r.e.Ng(f.irradianceCoefficients);b.scaleInPlace(f.Yi),b.convertIrradianceToLambertianRadiance();const h=r.h.FromHarmonics(b),v=(S.length-1)/Math.log2(f.specularImageSize);return y.updateRGBDAsync(S,h,v)}))}return f._loaded.then((()=>f._babylonTexture))}}K(yO),e(yO,!0,(O=>new SO(O)));y(12274);const HO="EXT_mesh_gpu_instancing";class bO{constructor(O){this.name=HO,this._loader=O,this.enabled=this._loader.isExtensionUsed(HO)}dispose(){this._loader=null}loadNodeAsync(O,f,y){return C.LoadExtensionAsync(O,f,this.name,((O,S)=>{this._loader._disableInstancedMesh++;const b=this._loader.loadNodeAsync(`/nodes/${f.index}`,f,y);if(this._loader._disableInstancedMesh--,!f._primitiveBabylonMeshes)return b;const h=new Array;let v=0;const N=f=>{if(void 0==S.attributes[f])return void h.push(Promise.resolve(null));const y=Q.Get(`${O}/attributes/${f}`,this._loader.Mi.accessors,S.attributes[f]);if(h.push(this._loader._loadFloatAccessorAsync(`/accessors/${y.bufferView}`,y)),0===v)v=y.count;else if(v!==y.count)throw new Error(`${O}/attributes: Instance buffer accessors do not have the same count.`)};return N("TRANSLATION"),N("ROTATION"),N("SCALE"),b.then((O=>Promise.all(h).then((y=>{let[S,b,h]=y;const N=new Float32Array(16*v);H.g.fb[0].Xd(0,0,0),H.g.Quaternion[0].Xd(0,0,0,1),H.g.fb[1].Xd(1,1,1);for(let O=0;O<v;++O)S&&H.m.FromArrayToRef(S,3*O,H.g.fb[0]),b&&H.c.FromArrayToRef(b,4*O,H.g.Quaternion[0]),h&&H.m.FromArrayToRef(h,3*O,H.g.fb[1]),H.b.ComposeToRef(H.g.fb[1],H.g.Quaternion[0],H.g.fb[0],H.g.Matrix[0]),H.g.Matrix[0].copyToArray(N,16*O);for(const O of f._primitiveBabylonMeshes)O.lc("matrix",N,16,!0);return O}))))}))}}K(HO),e(HO,!0,(O=>new bO(O)));class hO{static get Default(){return hO._Default||(hO._Default=new hO),hO._Default}constructor(){const O=hO.Configuration.decoder;this._decoderModulePromise=h.d.LoadBabylonScriptAsync(O.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}decodeGltfBufferAsync(O,f,y,S,H){return this._decoderModulePromise.then((async()=>{MeshoptDecoder.useWorkers(1);const b=await MeshoptDecoder.decodeGltfBufferAsync(f,y,O,S,H);return MeshoptDecoder.useWorkers(0),b}))}}hO.Configuration={decoder:{url:`${h.d._DefaultCdnUrl}/meshopt_decoder.js`}},hO._Default=null;const vO="EXT_meshopt_compression";class NO{constructor(O){this.name=vO,this.enabled=O.isExtensionUsed(vO),this._loader=O}dispose(){this._loader=null}loadBufferViewAsync(O,f){return C.LoadExtensionAsync(O,f,this.name,((y,S)=>{const H=f;if(H._meshOptData)return H._meshOptData;const b=Q.Get(`${O}/buffer`,this._loader.Mi.buffers,S.buffer);return H._meshOptData=this._loader.loadBufferAsync(`/buffers/${b.index}`,b,S.byteOffset||0,S.byteLength).then((O=>hO.Default.decodeGltfBufferAsync(O,S.count,S.byteStride,S.mode,S.filter))),H._meshOptData}))}}K(vO),e(vO,!0,(O=>new NO(O)));const mO="EXT_texture_webp";class tO{constructor(O){this.name=mO,this._loader=O,this.enabled=O.isExtensionUsed(mO)}dispose(){this._loader=null}_loadTextureAsync(O,f,y){return C.LoadExtensionAsync(O,f,this.name,((S,H)=>{const b=void 0==f.sampler?C.DefaultSampler:Q.Get(`${O}/sampler`,this._loader.Mi.samplers,f.sampler),h=Q.Get(`${S}/source`,this._loader.Mi.images,H.source);return this._loader._createTextureAsync(O,b,h,(O=>{y(O)}),void 0,!f._textureInfo.nonColorData)}))}}K(mO),e(mO,!0,(O=>new tO(O)));const qO="EXT_texture_avif";class FO{constructor(O){this.name=qO,this._loader=O,this.enabled=O.isExtensionUsed(qO)}dispose(){this._loader=null}_loadTextureAsync(O,f,y){return C.LoadExtensionAsync(O,f,this.name,((S,H)=>{const b=void 0==f.sampler?C.DefaultSampler:Q.Get(`${O}/sampler`,this._loader.Mi.samplers,f.sampler),h=Q.Get(`${S}/source`,this._loader.Mi.images,H.source);return this._loader._createTextureAsync(O,b,h,(O=>{y(O)}),void 0,!f._textureInfo.nonColorData)}))}}K(qO),e(qO,!0,(O=>new FO(O)));var IO=y(12277);const AO="KHR_draco_mesh_compression";class JO{constructor(O){this.name=AO,this.useNormalizedFlagFromAccessor=!0,this._loader=O,this.enabled=IO.b.DecoderAvailable&&this._loader.isExtensionUsed(AO)}dispose(){delete this.dracoCompression,this._loader=null}_loadVertexDataAsync(O,f,y){return C.LoadExtensionAsync(O,f,this.name,((S,H)=>{if(void 0!=f.mode&&4!==f.mode&&5!==f.mode)throw new Error(`${O}: Unsupported mode ${f.mode}`);const b={},h={},v=(O,S)=>{const v=H.attributes[O];if(void 0!=v&&(y._delayInfo=y._delayInfo||[],-1===y._delayInfo.indexOf(S)&&y._delayInfo.push(S),b[S]=v,this.useNormalizedFlagFromAccessor)){const y=Q.TryGet(this._loader.Mi.accessors,f.attributes[O]);y&&(h[S]=y.normalized||!1)}};v("POSITION",o.f.PositionKind),v("NORMAL",o.f.NormalKind),v("TANGENT",o.f.TangentKind),v("TEXCOORD_0",o.f.UVKind),v("TEXCOORD_1",o.f.UV2Kind),v("TEXCOORD_2",o.f.UV3Kind),v("TEXCOORD_3",o.f.UV4Kind),v("TEXCOORD_4",o.f.UV5Kind),v("TEXCOORD_5",o.f.UV6Kind),v("JOINTS_0",o.f.MatricesIndicesKind),v("WEIGHTS_0",o.f.MatricesWeightsKind),v("COLOR_0",o.f.ColorKind);const N=Q.Get(S,this._loader.Mi.bufferViews,H.bufferView);return N._dracoBabylonGeometry||(N._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${N.index}`,N).then((f=>(this.dracoCompression||IO.b.Default)._decodeMeshToGeometryForGltfAsync(y.name,this._loader.babylonScene,f,b,h).catch((f=>{throw new Error(`${O}: ${f.message}`)}))))),N._dracoBabylonGeometry}))}}K(AO),e(AO,!0,(O=>new JO(O)));var XO=y(12288),wO=y(11568),BO=y(12250),jO=y(12293);wO.c.AddNodeConstructor("Light_Type_0",((O,f)=>()=>new uO(O,H.m.Zero(),f)));class uO extends jO.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(O){this._shadowAngle=O,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(O){const f=this.needCube();if(this._direction=O,this.needCube()!==f&&this._shadowGenerators){const O=this._shadowGenerators.values();for(let f=O.next();!0!==f.done;f=O.next()){f.value.recreateShadowMap()}}}constructor(O,f,y){super(O,y),this._shadowAngle=Math.PI/2,this.position=f}getClassName(){return"PointLight"}getTypeID(){return BO.d.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(O){if(this.direction)return super.getShadowDirection(O);switch(O){case 0:return new H.m(1,0,0);case 1:return new H.m(-1,0,0);case 2:return new H.m(0,-1,0);case 3:return new H.m(0,1,0);case 4:return new H.m(0,0,1);case 5:return new H.m(0,0,-1)}return H.m.Zero()}_setDefaultShadowProjectionMatrix(O,f,y){const S=this.va().activeCamera;if(!S)return;const b=void 0!==this.shadowMinZ?this.shadowMinZ:S.Ui,h=void 0!==this.shadowMaxZ?this.shadowMaxZ:S.maxZ,v=this.va().getEngine().useReverseDepthBuffer;H.b.PerspectiveFovLHToRef(this.shadowAngle,1,v?h:b,v?b:h,O,!0,this._scene.getEngine().isNDCHalfZRange,void 0,v)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(O,f){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,f):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,f),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,f),this}transferToNodeMaterialEffect(O,f){return this.computeTransformedInformation()?O.setFloat3(f,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):O.setFloat3(f,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(O,f){O["POINTLIGHT"+f]=!0}}(0,j.b)([(0,u.L)()],uO.prototype,"shadowAngle",null),(0,U.g)("BABYLON.PointLight",uO),wO.c.AddNodeConstructor("Light_Type_2",((O,f)=>()=>new LO(O,H.m.Zero(),H.m.Zero(),0,0,f)));class LO extends jO.b{get angle(){return this._angle}set angle(O){this._angle=O,this._cosHalfAngle=Math.cos(.5*O),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(O){this._innerAngle=O,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(O){this._shadowAngleScale=O,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(O){this._projectionTextureLightNear=O,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(O){this._projectionTextureLightFar=O,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(O){this._projectionTextureUpDirection=O,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(O){this._projectionTexture!==O&&(this._projectionTexture=O,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(LO._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):LO._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(O){return void 0!==O.onGeneratedObservable}static _IsTexture(O){return void 0!==O.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(O){this._projectionTextureProjectionLightMatrix=O,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(O,f,y,S,b,h){super(O,h),this._innerAngle=0,this._projectionTextureMatrix=H.b.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=H.m.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=H.m.Zero(),this._projectionTextureViewLightMatrix=H.b.Zero(),this._projectionTextureProjectionLightMatrix=H.b.Zero(),this._projectionTextureScalingMatrix=H.b.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=f,this.direction=y,this.angle=S,this.exponent=b}getClassName(){return"SpotLight"}getTypeID(){return BO.d.LIGHTTYPEID_SPOTLIGHT}_setDirection(O){super._setDirection(O),this._projectionTextureViewLightDirty=!0}_setPosition(O){super._setPosition(O),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(O,f,y){const S=this.va().activeCamera;if(!S)return;this._shadowAngleScale=this._shadowAngleScale||1;const b=this._shadowAngleScale*this._angle,h=void 0!==this.shadowMinZ?this.shadowMinZ:S.Ui,v=void 0!==this.shadowMaxZ?this.shadowMaxZ:S.maxZ,N=this.va().getEngine().useReverseDepthBuffer;H.b.PerspectiveFovLHToRef(b,1,N?v:h,N?h:v,O,!0,this._scene.getEngine().isNDCHalfZRange,void 0,N)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),H.b.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const O=this.projectionTextureLightFar,f=this.projectionTextureLightNear,y=O/(O-f),S=-y*f,b=1/Math.tan(this._angle/2);H.b.FromValuesToRef(b/1,0,0,0,0,b,0,0,0,0,y,1,0,0,S,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof W.e){const O=this._projectionTexture.uScale/2,f=this._projectionTexture.vScale/2;H.b.FromValuesToRef(O,0,0,0,0,f,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(O,f){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),O.setMatrix("textureProjectionMatrix"+f,this._projectionTextureMatrix),O.setTexture("projectionLightTexture"+f,this.projectionTexture)),this}transferToEffect(O,f){let y;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,f),y=H.m.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,f),y=H.m.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",y.x,y.y,y.z,this._cosHalfAngle,f),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,f),this}transferToNodeMaterialEffect(O,f){let y;return y=this.computeTransformedInformation()?H.m.Normalize(this.transformedDirection):H.m.Normalize(this.direction),this.va().useRightHandedSystem?O.setFloat3(f,-y.x,-y.y,-y.z):O.setFloat3(f,y.x,y.y,y.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose()}getDepthMinZ(O){const f=this._scene.getEngine(),y=void 0!==this.shadowMinZ?this.shadowMinZ:O.Ui;return f.useReverseDepthBuffer&&f.isNDCHalfZRange?y:this._scene.getEngine().isNDCHalfZRange?0:y}getDepthMaxZ(O){const f=this._scene.getEngine(),y=void 0!==this.shadowMaxZ?this.shadowMaxZ:O.maxZ;return f.useReverseDepthBuffer&&f.isNDCHalfZRange?0:y}prepareLightSpecificDefines(O,f){O["SPOTLIGHT"+f]=!0,O["PROJECTEDLIGHTTEXTURE"+f]=!(!this.projectionTexture||!this.projectionTexture.isReady())}}(0,j.b)([(0,u.L)()],LO.prototype,"angle",null),(0,j.b)([(0,u.L)()],LO.prototype,"innerAngle",null),(0,j.b)([(0,u.L)()],LO.prototype,"shadowAngleScale",null),(0,j.b)([(0,u.L)()],LO.prototype,"exponent",void 0),(0,j.b)([(0,u.L)()],LO.prototype,"projectionTextureLightNear",null),(0,j.b)([(0,u.L)()],LO.prototype,"projectionTextureLightFar",null),(0,j.b)([(0,u.L)()],LO.prototype,"projectionTextureUpDirection",null),(0,j.b)([(0,u.C)("projectedLightTexture")],LO.prototype,"_projectionTexture",void 0),(0,U.g)("BABYLON.SpotLight",LO);const pO="KHR_lights_punctual";class UO{constructor(O){this.name=pO,this._loader=O,this.enabled=this._loader.isExtensionUsed(pO)}dispose(){this._loader=null,delete this._lights}onLoading(){const O=this._loader.Mi.extensions;if(O&&O[this.name]){const f=O[this.name];this._lights=f.lights,Q.Assign(this._lights)}}loadNodeAsync(O,f,y){return C.LoadExtensionAsync(O,f,this.name,((S,h)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(O,f,(O=>{let f;const v=Q.Get(S,this._lights,h.eb),N=v.name||O.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,v.type){case"directional":{const O=new XO.d(N,H.m.Backward(),this._loader.babylonScene);O.position.Wd(0),f=O;break}case"point":f=new uO(N,H.m.Zero(),this._loader.babylonScene);break;case"spot":{const O=new LO(N,H.m.Zero(),H.m.Backward(),0,1,this._loader.babylonScene);O.angle=2*(v.spot&&v.spot.outerConeAngle||Math.PI/4),O.innerAngle=2*(v.spot&&v.spot.innerConeAngle||0),f=O;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${S}: Invalid light type (${v.type})`)}f._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,v._babylonLight=f,f.falloffType=BO.d.FALLOFF_GLTF,f.nh=v.color?b.d.Ng(v.color):b.d.White(),f.Yi=void 0==v.Yi?1:v.Yi,f.range=void 0==v.range?Number.MAX_VALUE:v.range,f.parent=O,this._loader._babylonLights.push(f),C.AddPointerMetadata(f,S),y(O)})))))}}K(pO),e(pO,!0,(O=>new UO(O)));const lO="KHR_materials_pbrSpecularGlossiness";class xO{constructor(O){this.name=lO,this.order=200,this._loader=O,this.enabled=this._loader.isExtensionUsed(lO)}dispose(){this._loader=null}loadMaterialPropertiesAsync(O,f,y){return C.LoadExtensionAsync(O,f,this.name,((S,H)=>{const b=new Array;return b.push(this._loader.loadMaterialBasePropertiesAsync(O,f,y)),b.push(this._loadSpecularGlossinessPropertiesAsync(S,H,y)),this._loader.loadMaterialAlphaProperties(O,f,y),Promise.all(b).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(O,f,y){if(!(y instanceof x))throw new Error(`${O}: Material type not supported`);const S=new Array;return y.metallic=null,y.roughness=null,f.diffuseFactor?(y.albedoColor=b.d.Ng(f.diffuseFactor),y.alpha=f.diffuseFactor[3]):y.albedoColor=b.d.White(),y.reflectivityColor=f.specularFactor?b.d.Ng(f.specularFactor):b.d.White(),y.microSurface=void 0==f.glossinessFactor?1:f.glossinessFactor,f.diffuseTexture&&S.push(this._loader.loadTextureInfoAsync(`${O}/diffuseTexture`,f.diffuseTexture,(O=>{O.name=`${y.name} (Diffuse)`,y.albedoTexture=O}))),f.specularGlossinessTexture&&(S.push(this._loader.loadTextureInfoAsync(`${O}/specularGlossinessTexture`,f.specularGlossinessTexture,(O=>{O.name=`${y.name} (Specular Glossiness)`,y.reflectivityTexture=O,y.reflectivityTexture.ke=!0}))),y.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(S).then((()=>{}))}}K(lO),e(lO,!0,(O=>new xO(O)));const WO="KHR_materials_unlit";class EO{constructor(O){this.name=WO,this.order=210,this._loader=O,this.enabled=this._loader.isExtensionUsed(WO)}dispose(){this._loader=null}loadMaterialPropertiesAsync(O,f,y){return C.LoadExtensionAsync(O,f,this.name,(()=>this._loadUnlitPropertiesAsync(O,f,y)))}_loadUnlitPropertiesAsync(O,f,y){if(!(y instanceof x))throw new Error(`${O}: Material type not supported`);const S=new Array;y.unlit=!0;const H=f.pbrMetallicRoughness;return H&&(H.baseColorFactor?(y.albedoColor=b.d.Ng(H.baseColorFactor),y.alpha=H.baseColorFactor[3]):y.albedoColor=b.d.White(),H.baseColorTexture&&S.push(this._loader.loadTextureInfoAsync(`${O}/baseColorTexture`,H.baseColorTexture,(O=>{O.name=`${y.name} (Base Color)`,y.albedoTexture=O})))),f.doubleSided&&(y.Wg=!1,y.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(O,f,y),Promise.all(S).then((()=>{}))}}K(WO),e(WO,!0,(O=>new EO(O)));const oO="KHR_materials_clearcoat";class iO{constructor(O){this.name=oO,this.order=190,this._loader=O,this.enabled=this._loader.isExtensionUsed(oO)}dispose(){this._loader=null}loadMaterialPropertiesAsync(O,f,y){return C.LoadExtensionAsync(O,f,this.name,((S,H)=>{const b=new Array;return b.push(this._loader.loadMaterialPropertiesAsync(O,f,y)),b.push(this._loadClearCoatPropertiesAsync(S,H,y)),Promise.all(b).then((()=>{}))}))}_loadClearCoatPropertiesAsync(O,f,y){if(!(y instanceof x))throw new Error(`${O}: Material type not supported`);const S=new Array;return y.clearCoat.isEnabled=!0,y.clearCoat.useRoughnessFromMainTexture=!1,y.clearCoat.remapF0OnInterfaceChange=!1,void 0!=f.clearcoatFactor?y.clearCoat.Yi=f.clearcoatFactor:y.clearCoat.Yi=0,f.clearcoatTexture&&S.push(this._loader.loadTextureInfoAsync(`${O}/clearcoatTexture`,f.clearcoatTexture,(O=>{O.name=`${y.name} (ClearCoat)`,y.clearCoat.texture=O}))),void 0!=f.clearcoatRoughnessFactor?y.clearCoat.roughness=f.clearcoatRoughnessFactor:y.clearCoat.roughness=0,f.clearcoatRoughnessTexture&&(f.clearcoatRoughnessTexture.nonColorData=!0,S.push(this._loader.loadTextureInfoAsync(`${O}/clearcoatRoughnessTexture`,f.clearcoatRoughnessTexture,(O=>{O.name=`${y.name} (ClearCoat Roughness)`,y.clearCoat.textureRoughness=O})))),f.clearcoatNormalTexture&&(f.clearcoatNormalTexture.nonColorData=!0,S.push(this._loader.loadTextureInfoAsync(`${O}/clearcoatNormalTexture`,f.clearcoatNormalTexture,(O=>{O.name=`${y.name} (ClearCoat Normal)`,y.clearCoat.bumpTexture=O}))),y.invertNormalMapX=!y.va().useRightHandedSystem,y.invertNormalMapY=y.va().useRightHandedSystem,void 0!=f.clearcoatNormalTexture.scale&&(y.clearCoat.bumpTexture.level=f.clearcoatNormalTexture.scale)),Promise.all(S).then((()=>{}))}}K(oO),e(oO,!0,(O=>new iO(O)));const DO="KHR_materials_iridescence";class VO{constructor(O){this.name=DO,this.order=195,this._loader=O,this.enabled=this._loader.isExtensionUsed(DO)}dispose(){this._loader=null}loadMaterialPropertiesAsync(O,f,y){return C.LoadExtensionAsync(O,f,this.name,((S,H)=>{const b=new Array;return b.push(this._loader.loadMaterialPropertiesAsync(O,f,y)),b.push(this._loadIridescencePropertiesAsync(S,H,y)),Promise.all(b).then((()=>{}))}))}_loadIridescencePropertiesAsync(O,f,y){if(!(y instanceof x))throw new Error(`${O}: Material type not supported`);const S=new Array;return y.iridescence.isEnabled=!0,y.iridescence.Yi=f.iridescenceFactor??0,y.iridescence.indexOfRefraction=f.iridescenceIor??f.iridescenceIOR??1.3,y.iridescence.minimumThickness=f.iridescenceThicknessMinimum??100,y.iridescence.maximumThickness=f.iridescenceThicknessMaximum??400,f.iridescenceTexture&&S.push(this._loader.loadTextureInfoAsync(`${O}/iridescenceTexture`,f.iridescenceTexture,(O=>{O.name=`${y.name} (Iridescence)`,y.iridescence.texture=O}))),f.iridescenceThicknessTexture&&S.push(this._loader.loadTextureInfoAsync(`${O}/iridescenceThicknessTexture`,f.iridescenceThicknessTexture,(O=>{O.name=`${y.name} (Iridescence Thickness)`,y.iridescence.thicknessTexture=O}))),Promise.all(S).then((()=>{}))}}K(DO),e(DO,!0,(O=>new VO(O)));const gO="KHR_materials_anisotropy";class RO{constructor(O){this.name=gO,this.order=195,this._loader=O,this.enabled=this._loader.isExtensionUsed(gO)}dispose(){this._loader=null}loadMaterialPropertiesAsync(O,f,y){return C.LoadExtensionAsync(O,f,this.name,((S,H)=>{const b=new Array;return b.push(this._loader.loadMaterialPropertiesAsync(O,f,y)),b.push(this._loadIridescencePropertiesAsync(S,H,y)),Promise.all(b).then((()=>{}))}))}_loadIridescencePropertiesAsync(O,f,y){if(!(y instanceof x))throw new Error(`${O}: Material type not supported`);const S=new Array;return y.anisotropy.isEnabled=!0,y.anisotropy.Yi=f.anisotropyStrength??0,y.anisotropy.angle=f.anisotropyRotation??0,f.anisotropyTexture&&(f.anisotropyTexture.nonColorData=!0,S.push(this._loader.loadTextureInfoAsync(`${O}/anisotropyTexture`,f.anisotropyTexture,(O=>{O.name=`${y.name} (Anisotropy Intensity)`,y.anisotropy.texture=O})))),Promise.all(S).then((()=>{}))}}K(gO),e(gO,!0,(O=>new RO(O)));const sO="KHR_materials_emissive_strength";class kO{constructor(O){this.name=sO,this.order=170,this._loader=O,this.enabled=this._loader.isExtensionUsed(sO)}dispose(){this._loader=null}loadMaterialPropertiesAsync(O,f,y){return C.LoadExtensionAsync(O,f,this.name,((S,H)=>this._loader.loadMaterialPropertiesAsync(O,f,y).then((()=>{this._loadEmissiveProperties(S,H,y)}))))}_loadEmissiveProperties(O,f,y){if(!(y instanceof x))throw new Error(`${O}: Material type not supported`);void 0!==f.emissiveStrength&&(y.emissiveIntensity=f.emissiveStrength)}}K(sO),e(sO,!0,(O=>new kO(O)));const zO="KHR_materials_sheen";class cO{constructor(O){this.name=zO,this.order=190,this._loader=O,this.enabled=this._loader.isExtensionUsed(zO)}dispose(){this._loader=null}loadMaterialPropertiesAsync(O,f,y){return C.LoadExtensionAsync(O,f,this.name,((S,H)=>{const b=new Array;return b.push(this._loader.loadMaterialPropertiesAsync(O,f,y)),b.push(this._loadSheenPropertiesAsync(S,H,y)),Promise.all(b).then((()=>{}))}))}_loadSheenPropertiesAsync(O,f,y){if(!(y instanceof x))throw new Error(`${O}: Material type not supported`);const S=new Array;return y.sheen.isEnabled=!0,y.sheen.Yi=1,void 0!=f.sheenColorFactor?y.sheen.color=b.d.Ng(f.sheenColorFactor):y.sheen.color=b.d.Black(),f.sheenColorTexture&&S.push(this._loader.loadTextureInfoAsync(`${O}/sheenColorTexture`,f.sheenColorTexture,(O=>{O.name=`${y.name} (Sheen Color)`,y.sheen.texture=O}))),void 0!==f.sheenRoughnessFactor?y.sheen.roughness=f.sheenRoughnessFactor:y.sheen.roughness=0,f.sheenRoughnessTexture&&(f.sheenRoughnessTexture.nonColorData=!0,S.push(this._loader.loadTextureInfoAsync(`${O}/sheenRoughnessTexture`,f.sheenRoughnessTexture,(O=>{O.name=`${y.name} (Sheen Roughness)`,y.sheen.textureRoughness=O})))),y.sheen.albedoScaling=!0,y.sheen.useRoughnessFromMainTexture=!1,Promise.all(S).then((()=>{}))}}K(zO),e(zO,!0,(O=>new cO(O)));const dO="KHR_materials_specular";class GO{constructor(O){this.name=dO,this.order=190,this._loader=O,this.enabled=this._loader.isExtensionUsed(dO)}dispose(){this._loader=null}loadMaterialPropertiesAsync(O,f,y){return C.LoadExtensionAsync(O,f,this.name,((S,H)=>{const b=new Array;return b.push(this._loader.loadMaterialPropertiesAsync(O,f,y)),b.push(this._loadSpecularPropertiesAsync(S,H,y)),Promise.all(b).then((()=>{}))}))}_loadSpecularPropertiesAsync(O,f,y){if(!(y instanceof x))throw new Error(`${O}: Material type not supported`);const S=new Array;return void 0!==f.specularFactor&&(y.metallicF0Factor=f.specularFactor),void 0!==f.specularColorFactor&&(y.metallicReflectanceColor=b.d.Ng(f.specularColorFactor)),f.specularTexture&&(f.specularTexture.nonColorData=!0,S.push(this._loader.loadTextureInfoAsync(`${O}/specularTexture`,f.specularTexture,(O=>{O.name=`${y.name} (Specular)`,y.metallicReflectanceTexture=O,y.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),f.specularColorTexture&&S.push(this._loader.loadTextureInfoAsync(`${O}/specularColorTexture`,f.specularColorTexture,(O=>{O.name=`${y.name} (Specular Color)`,y.reflectanceTexture=O}))),Promise.all(S).then((()=>{}))}}K(dO),e(dO,!0,(O=>new GO(O)));const YO="KHR_materials_ior";class ZO{constructor(O){this.name=YO,this.order=180,this._loader=O,this.enabled=this._loader.isExtensionUsed(YO)}dispose(){this._loader=null}loadMaterialPropertiesAsync(O,f,y){return C.LoadExtensionAsync(O,f,this.name,((S,H)=>{const b=new Array;return b.push(this._loader.loadMaterialPropertiesAsync(O,f,y)),b.push(this._loadIorPropertiesAsync(S,H,y)),Promise.all(b).then((()=>{}))}))}_loadIorPropertiesAsync(O,f,y){if(!(y instanceof x))throw new Error(`${O}: Material type not supported`);return void 0!==f.ior?y.indexOfRefraction=f.ior:y.indexOfRefraction=ZO._DEFAULT_IOR,Promise.resolve()}}ZO._DEFAULT_IOR=1.5,K(YO),e(YO,!0,(O=>new ZO(O)));const aO="KHR_materials_variants";class MO{constructor(O){this.name=aO,this._loader=O,this.enabled=this._loader.isExtensionUsed(aO)}dispose(){this._loader=null}static GetAvailableVariants(O){const f=this._GetExtensionMetadata(O);return f?Object.keys(f.variants):[]}getAvailableVariants(O){return MO.GetAvailableVariants(O)}static SelectVariant(O,f){const y=this._GetExtensionMetadata(O);if(!y)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${aO} extension`);const S=O=>{const f=y.variants[O];if(f)for(const y of f)y.mesh.material=y.material};if(f instanceof Array)for(const H of f)S(H);else S(f);y.lastSelected=f}selectVariant(O,f){MO.SelectVariant(O,f)}static Reset(O){const f=this._GetExtensionMetadata(O);if(!f)throw new Error(`Cannot reset on a glTF mesh that does not have the ${aO} extension`);for(const y of f.original)y.mesh.material=y.material;f.lastSelected=null}reset(O){MO.Reset(O)}static GetLastSelectedVariant(O){const f=this._GetExtensionMetadata(O);if(!f)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${aO} extension`);return f.lastSelected}getLastSelectedVariant(O){return MO.GetLastSelectedVariant(O)}static _GetExtensionMetadata(O){var f,y;return(null===O||void 0===O||null===(f=O._internalMetadata)||void 0===f||null===(y=f.Mi)||void 0===y?void 0:y[aO])||null}onLoading(){const O=this._loader.Mi.extensions;if(O&&O[this.name]){const f=O[this.name];this._variants=f.variants}}_loadMeshPrimitiveAsync(O,f,y,S,H,b){return C.LoadExtensionAsync(O,H,this.name,((h,v)=>{const N=new Array;return N.push(this._loader._loadMeshPrimitiveAsync(O,f,y,S,H,(f=>{if(b(f),f instanceof V.d){const y=C._GetDrawMode(O,H.mode),S=this._loader.rootBabylonMesh,b=S?S._internalMetadata=S._internalMetadata||{}:{},m=b.Mi=b.Mi||{},t=m[aO]=m[aO]||{lastSelected:null,original:[],variants:{}};t.original.push({mesh:f,material:f.material});for(let O=0;O<v.mappings.length;++O){const H=v.mappings[O],b=Q.Get(`${h}/mappings/${O}/material`,this._loader.Mi.materials,H.material);N.push(this._loader._loadMaterialAsync(`#/materials/${H.material}`,b,f,y,(O=>{for(let y=0;y<H.variants.length;++y){const b=H.variants[y],h=Q.Get(`/extensions/${aO}/variants/${b}`,this._variants,b);t.variants[h.name]=t.variants[h.name]||[],t.variants[h.name].push({mesh:f,material:O}),f.onClonedObservable.add((O=>{const y=O;let H=null,b=y;do{if(b=b.parent,!b)return;H=MO._GetExtensionMetadata(b)}while(null===H);if(S&&H===MO._GetExtensionMetadata(S)){b._internalMetadata={};for(const O in S._internalMetadata)b._internalMetadata[O]=S._internalMetadata[O];b._internalMetadata.Mi=[];for(const O in S._internalMetadata.Mi)b._internalMetadata.Mi[O]=S._internalMetadata.Mi[O];b._internalMetadata.Mi[aO]={lastSelected:null,original:[],variants:{}};for(const O of H.original)b._internalMetadata.Mi[aO].original.push({mesh:O.mesh,material:O.material});for(const O in H.variants)if(Object.prototype.hasOwnProperty.call(H.variants,O)){b._internalMetadata.Mi[aO].variants[O]=[];for(const f of H.variants[O])b._internalMetadata.Mi[aO].variants[O].push({mesh:f.mesh,material:f.material})}H=b._internalMetadata.Mi[aO]}for(const S of H.original)S.mesh===f&&(S.mesh=y);for(const S of H.variants[h.name])S.mesh===f&&(S.mesh=y)}))}})))}}}))),Promise.all(N).then((O=>{let[f]=O;return f}))}))}}K(aO),e(aO,!0,(O=>new MO(O)));var PO=y(11803);class eO{}eO.AUTOSAMPLERSUFFIX="Sampler",eO.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",eO.ALPHA_DISABLE=0,eO.ALPHA_ADD=1,eO.ALPHA_COMBINE=2,eO.ALPHA_SUBTRACT=3,eO.ALPHA_MULTIPLY=4,eO.ALPHA_MAXIMIZED=5,eO.ALPHA_ONEONE=6,eO.ALPHA_PREMULTIPLIED=7,eO.ALPHA_PREMULTIPLIED_PORTERDUFF=8,eO.ALPHA_INTERPOLATE=9,eO.ALPHA_SCREENMODE=10,eO.ALPHA_ONEONE_ONEONE=11,eO.ALPHA_ALPHATOCOLOR=12,eO.ALPHA_REVERSEONEMINUS=13,eO.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,eO.ALPHA_ONEONE_ONEZERO=15,eO.ALPHA_EXCLUSION=16,eO.ALPHA_LAYER_ACCUMULATE=17,eO.ALPHA_EQUATION_ADD=0,eO.ALPHA_EQUATION_SUBSTRACT=1,eO.ALPHA_EQUATION_REVERSE_SUBTRACT=2,eO.ALPHA_EQUATION_MAX=3,eO.ALPHA_EQUATION_MIN=4,eO.ALPHA_EQUATION_DARKEN=5,eO.DELAYLOADSTATE_NONE=0,eO.DELAYLOADSTATE_LOADED=1,eO.DELAYLOADSTATE_LOADING=2,eO.DELAYLOADSTATE_NOTLOADED=4,eO.NEVER=512,eO.ALWAYS=519,eO.LESS=513,eO.EQUAL=514,eO.LEQUAL=515,eO.GREATER=516,eO.GEQUAL=518,eO.NOTEQUAL=517,eO.KEEP=7680,eO.ZERO=0,eO.REPLACE=7681,eO.INCR=7682,eO.DECR=7683,eO.INVERT=5386,eO.INCR_WRAP=34055,eO.DECR_WRAP=34056,eO.TEXTURE_CLAMP_ADDRESSMODE=0,eO.TEXTURE_WRAP_ADDRESSMODE=1,eO.TEXTURE_MIRROR_ADDRESSMODE=2,eO.TEXTURE_CREATIONFLAG_STORAGE=1,eO.TEXTUREFORMAT_ALPHA=0,eO.TEXTUREFORMAT_LUMINANCE=1,eO.TEXTUREFORMAT_LUMINANCE_ALPHA=2,eO.TEXTUREFORMAT_RGB=4,eO.TEXTUREFORMAT_RGBA=5,eO.TEXTUREFORMAT_RED=6,eO.TEXTUREFORMAT_R=6,eO.TEXTUREFORMAT_RG=7,eO.TEXTUREFORMAT_RED_INTEGER=8,eO.TEXTUREFORMAT_R_INTEGER=8,eO.TEXTUREFORMAT_RG_INTEGER=9,eO.TEXTUREFORMAT_RGB_INTEGER=10,eO.TEXTUREFORMAT_RGBA_INTEGER=11,eO.TEXTUREFORMAT_BGRA=12,eO.TEXTUREFORMAT_DEPTH24_STENCIL8=13,eO.TEXTUREFORMAT_DEPTH32_FLOAT=14,eO.TEXTUREFORMAT_DEPTH16=15,eO.TEXTUREFORMAT_DEPTH24=16,eO.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,eO.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,eO.TEXTUREFORMAT_STENCIL8=19,eO.TEXTUREFORMAT_UNDEFINED=4294967295,eO.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,eO.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,eO.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,eO.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,eO.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,eO.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,eO.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,eO.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,eO.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,eO.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,eO.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,eO.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,eO.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,eO.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,eO.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,eO.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,eO.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,eO.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,eO.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,eO.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,eO.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,eO.TEXTURETYPE_UNSIGNED_BYTE=0,eO.TEXTURETYPE_UNSIGNED_INT=0,eO.TEXTURETYPE_FLOAT=1,eO.TEXTURETYPE_HALF_FLOAT=2,eO.TEXTURETYPE_BYTE=3,eO.TEXTURETYPE_SHORT=4,eO.TEXTURETYPE_UNSIGNED_SHORT=5,eO.TEXTURETYPE_INT=6,eO.TEXTURETYPE_UNSIGNED_INTEGER=7,eO.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,eO.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,eO.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,eO.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,eO.TEXTURETYPE_UNSIGNED_INT_24_8=12,eO.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,eO.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,eO.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,eO.TEXTURETYPE_UNDEFINED=16,eO.TEXTURE_2D=3553,eO.TEXTURE_2D_ARRAY=35866,eO.TEXTURE_CUBE_MAP=34067,eO.TEXTURE_CUBE_MAP_ARRAY=3735928559,eO.TEXTURE_3D=32879,eO.TEXTURE_NEAREST_SAMPLINGMODE=1,eO.TEXTURE_NEAREST_NEAREST=1,eO.TEXTURE_BILINEAR_SAMPLINGMODE=2,eO.TEXTURE_LINEAR_LINEAR=2,eO.TEXTURE_TRILINEAR_SAMPLINGMODE=3,eO.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,eO.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,eO.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,eO.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,eO.TEXTURE_NEAREST_LINEAR=7,eO.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,eO.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,eO.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,eO.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,eO.TEXTURE_LINEAR_NEAREST=12,eO.TEXTURE_EXPLICIT_MODE=0,eO.TEXTURE_SPHERICAL_MODE=1,eO.TEXTURE_PLANAR_MODE=2,eO.TEXTURE_CUBIC_MODE=3,eO.TEXTURE_PROJECTION_MODE=4,eO.TEXTURE_SKYBOX_MODE=5,eO.TEXTURE_INVCUBIC_MODE=6,eO.TEXTURE_EQUIRECTANGULAR_MODE=7,eO.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,eO.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,eO.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,eO.TEXTURE_FILTERING_QUALITY_HIGH=64,eO.TEXTURE_FILTERING_QUALITY_MEDIUM=16,eO.TEXTURE_FILTERING_QUALITY_LOW=8,eO.SCALEMODE_FLOOR=1,eO.SCALEMODE_NEAREST=2,eO.SCALEMODE_CEILING=3,eO.MATERIAL_TextureDirtyFlag=1,eO.MATERIAL_LightDirtyFlag=2,eO.MATERIAL_FresnelDirtyFlag=4,eO.MATERIAL_AttributesDirtyFlag=8,eO.MATERIAL_MiscDirtyFlag=16,eO.MATERIAL_PrePassDirtyFlag=32,eO.MATERIAL_AllDirtyFlag=63,eO.MATERIAL_TriangleFillMode=0,eO.MATERIAL_WireFrameFillMode=1,eO.MATERIAL_PointFillMode=2,eO.MATERIAL_PointListDrawMode=3,eO.MATERIAL_LineListDrawMode=4,eO.MATERIAL_LineLoopDrawMode=5,eO.MATERIAL_LineStripDrawMode=6,eO.MATERIAL_TriangleStripDrawMode=7,eO.MATERIAL_TriangleFanDrawMode=8,eO.MATERIAL_ClockWiseSideOrientation=0,eO.MATERIAL_CounterClockWiseSideOrientation=1,eO.ACTION_NothingTrigger=0,eO.ACTION_OnPickTrigger=1,eO.ACTION_OnLeftPickTrigger=2,eO.ACTION_OnRightPickTrigger=3,eO.ACTION_OnCenterPickTrigger=4,eO.ACTION_OnPickDownTrigger=5,eO.ACTION_OnDoublePickTrigger=6,eO.ACTION_OnPickUpTrigger=7,eO.ACTION_OnPickOutTrigger=16,eO.ACTION_OnLongPressTrigger=8,eO.ACTION_OnPointerOverTrigger=9,eO.ACTION_OnPointerOutTrigger=10,eO.ACTION_OnEveryFrameTrigger=11,eO.ACTION_OnIntersectionEnterTrigger=12,eO.ACTION_OnIntersectionExitTrigger=13,eO.ACTION_OnKeyDownTrigger=14,eO.ACTION_OnKeyUpTrigger=15,eO.PARTICLES_BILLBOARDMODE_Y=2,eO.PARTICLES_BILLBOARDMODE_ALL=7,eO.PARTICLES_BILLBOARDMODE_STRETCHED=8,eO.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,eO.MESHES_CULLINGSTRATEGY_STANDARD=0,eO.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,eO.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,eO.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,eO.SCENELOADER_NO_LOGGING=0,eO.SCENELOADER_MINIMAL_LOGGING=1,eO.SCENELOADER_SUMMARY_LOGGING=2,eO.SCENELOADER_DETAILED_LOGGING=3,eO.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,eO.PREPASS_POSITION_TEXTURE_TYPE=1,eO.PREPASS_VELOCITY_TEXTURE_TYPE=2,eO.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,eO.PREPASS_COLOR_TEXTURE_TYPE=4,eO.PREPASS_DEPTH_TEXTURE_TYPE=5,eO.PREPASS_NORMAL_TEXTURE_TYPE=6,eO.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,eO.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,eO.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,eO.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,eO.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,eO.PREPASS_ALBEDO_TEXTURE_TYPE=12,eO.BUFFER_CREATIONFLAG_READ=1,eO.BUFFER_CREATIONFLAG_WRITE=2,eO.BUFFER_CREATIONFLAG_READWRITE=3,eO.BUFFER_CREATIONFLAG_UNIFORM=4,eO.BUFFER_CREATIONFLAG_VERTEX=8,eO.BUFFER_CREATIONFLAG_INDEX=16,eO.BUFFER_CREATIONFLAG_STORAGE=32,eO.BUFFER_CREATIONFLAG_INDIRECT=64,eO.RENDERPASS_MAIN=0,eO.INPUT_ALT_KEY=18,eO.INPUT_CTRL_KEY=17,eO.INPUT_META_KEY1=91,eO.INPUT_META_KEY2=92,eO.INPUT_META_KEY3=93,eO.INPUT_SHIFT_KEY=16,eO.SNAPSHOTRENDERING_STANDARD=0,eO.SNAPSHOTRENDERING_FAST=1,eO.PERSPECTIVE_CAMERA=0,eO.ORTHOGRAPHIC_CAMERA=1,eO.FOVMODE_VERTICAL_FIXED=0,eO.FOVMODE_HORIZONTAL_FIXED=1,eO.RIG_MODE_NONE=0,eO.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,eO.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,eO.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,eO.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,eO.RIG_MODE_STEREOSCOPIC_INTERLACED=14,eO.RIG_MODE_VR=20,eO.RIG_MODE_CUSTOM=22,eO.MAX_SUPPORTED_UV_SETS=6,eO.GL_ALPHA_EQUATION_ADD=32774,eO.GL_ALPHA_EQUATION_MIN=32775,eO.GL_ALPHA_EQUATION_MAX=32776,eO.GL_ALPHA_EQUATION_SUBTRACT=32778,eO.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,eO.GL_ALPHA_FUNCTION_SRC=768,eO.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,eO.GL_ALPHA_FUNCTION_SRC_ALPHA=770,eO.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,eO.GL_ALPHA_FUNCTION_DST_ALPHA=772,eO.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,eO.GL_ALPHA_FUNCTION_DST_COLOR=774,eO.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,eO.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,eO.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,eO.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,eO.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,eO.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,eO.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,eO.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,eO.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,eO.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,eO.SnippetUrl="https://snippet.babylonjs.com",eO.FOGMODE_NONE=0,eO.FOGMODE_EXP=1,eO.FOGMODE_EXP2=2,eO.FOGMODE_LINEAR=3,eO.BYTE=5120,eO.UNSIGNED_BYTE=5121,eO.SHORT=5122,eO.UNSIGNED_SHORT=5123,eO.INT=5124,eO.UNSIGNED_INT=5125,eO.FLOAT=5126,eO.PositionKind="position",eO.NormalKind="k",eO.TangentKind="tangent",eO.UVKind="uv",eO.UV2Kind="uv2",eO.UV3Kind="uv3",eO.UV4Kind="uv4",eO.UV5Kind="uv5",eO.UV6Kind="uv6",eO.ColorKind="color",eO.ColorInstanceKind="instanceColor",eO.MatricesIndicesKind="matricesIndices",eO.MatricesWeightsKind="matricesWeights",eO.MatricesIndicesExtraKind="matricesIndicesExtra",eO.MatricesWeightsExtraKind="matricesWeightsExtra";class KO{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:eO.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(O,f){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...KO._GetDefaultOptions(),...O},this._scene=f,this._scene._transmissionHelper=this,this.onErrorObservable=new t.d,this._scene.hj.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(O){if(!Object.keys(O).filter((f=>this._options[f]!==O[f])).length)return;const f={...this._options,...O},y=this._options;this._options=f,f.renderSize===y.renderSize&&f.renderTargetTextureType===y.renderTargetTextureType&&f.generateMipmaps===y.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=f.samples,this._opaqueRenderTarget.lodGenerationScale=f.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=f.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(O){return!!O&&!!(O instanceof x&&O.subSurface.isRefractionEnabled)}_addMesh(O){this._materialObservers[O.uniqueId]=O.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),h.d.SetImmediate((()=>{this._shouldRenderAsTransmission(O.material)?(O.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(O)&&this._transparentMeshesCache.push(O)):-1===this._opaqueMeshesCache.indexOf(O)&&this._opaqueMeshesCache.push(O)}))}_removeMesh(O){O.onMaterialChangedObservable.remove(this._materialObservers[O.uniqueId]),delete this._materialObservers[O.uniqueId];let f=this._transparentMeshesCache.indexOf(O);-1!==f&&this._transparentMeshesCache.splice(f,1),f=this._opaqueMeshesCache.indexOf(O),-1!==f&&this._opaqueMeshesCache.splice(f,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(O){const f=this._transparentMeshesCache.indexOf(O),y=this._opaqueMeshesCache.indexOf(O);this._shouldRenderAsTransmission(O.material)?(O.material instanceof x&&(O.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==y?(this._opaqueMeshesCache.splice(y,1),this._transparentMeshesCache.push(O)):-1===f&&this._transparentMeshesCache.push(O)):-1!==f?(this._transparentMeshesCache.splice(f,1),this._opaqueMeshesCache.push(O)):-1===y&&this._opaqueMeshesCache.push(O)}_isRenderTargetValid(){var O;return null!==(null===(O=this._opaqueRenderTarget)||void 0===O?void 0:O.getInternalTexture())}_setupRenderTargets(){var O;let f,y;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new PO.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(O=this._options.clearColor)||void 0===O?void 0:O.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((O=>{y=this._scene.environmentIntensity,this._scene.environmentIntensity=1,f=this._scene.imageProcessingConfiguration.applyByPostProcess,this._options.clearColor?O.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(O.clearColor,this._scene.getEngine().useExactSrgbConversions),this._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=y,this._scene.imageProcessingConfiguration._applyByPostProcess=f})),this._transparentMeshesCache.forEach((O=>{this._shouldRenderAsTransmission(O.material)&&(O.material.refractionTexture=this._opaqueRenderTarget)}))}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const TO="KHR_materials_transmission";class QO{constructor(O){this.name=TO,this.order=175,this._loader=O,this.enabled=this._loader.isExtensionUsed(TO),this.enabled&&(O.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(O,f,y){return C.LoadExtensionAsync(O,f,this.name,((S,H)=>{const b=new Array;return b.push(this._loader.loadMaterialPropertiesAsync(O,f,y)),b.push(this._loadTransparentPropertiesAsync(S,f,y,H)),Promise.all(b).then((()=>{}))}))}_loadTransparentPropertiesAsync(O,f,y,S){if(!(y instanceof x))throw new Error(`${O}: Material type not supported`);const H=y;if(H.subSurface.isRefractionEnabled=!0,H.subSurface.volumeIndexOfRefraction=1,H.subSurface.useAlbedoToTintRefraction=!0,void 0===S.transmissionFactor)return H.subSurface.refractionIntensity=0,H.subSurface.isRefractionEnabled=!1,Promise.resolve();{var b;H.subSurface.refractionIntensity=S.transmissionFactor;const O=H.va();if(H.subSurface.refractionIntensity&&!O._transmissionHelper)new KO({},H.va());else if(H.subSurface.refractionIntensity&&(null===(b=O._transmissionHelper)||void 0===b||!b._isRenderTargetValid())){var h;null===(h=O._transmissionHelper)||void 0===h||h._setupRenderTargets()}}return H.subSurface.minimumThickness=0,H.subSurface.maximumThickness=0,S.transmissionTexture?(S.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${O}/transmissionTexture`,S.transmissionTexture,void 0).then((O=>{O.name=`${y.name} (Transmission)`,H.subSurface.refractionIntensityTexture=O,H.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}K(TO),e(TO,!0,(O=>new QO(O)));const CO="KHR_materials_diffuse_transmission";class rO{constructor(O){this.name=CO,this.order=174,this._loader=O,this.enabled=this._loader.isExtensionUsed(CO),this.enabled&&(O.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(O,f,y){return C.LoadExtensionAsync(O,f,this.name,((S,H)=>{const b=new Array;return b.push(this._loader.loadMaterialPropertiesAsync(O,f,y)),b.push(this._loadTranslucentPropertiesAsync(S,f,y,H)),Promise.all(b).then((()=>{}))}))}_loadTranslucentPropertiesAsync(O,f,y,S){if(!(y instanceof x))throw new Error(`${O}: Material type not supported`);const H=y;if(H.subSurface.isTranslucencyEnabled=!0,H.subSurface.volumeIndexOfRefraction=1,H.subSurface.minimumThickness=0,H.subSurface.maximumThickness=0,H.subSurface.useAlbedoToTintTranslucency=!1,void 0===S.diffuseTransmissionFactor)return H.subSurface.translucencyIntensity=0,H.subSurface.isTranslucencyEnabled=!1,Promise.resolve();H.subSurface.translucencyIntensity=S.diffuseTransmissionFactor;const h=new Array;return H.subSurface.useGltfStyleTextures=!0,S.diffuseTransmissionTexture&&(S.diffuseTransmissionTexture.nonColorData=!0,h.push(this._loader.loadTextureInfoAsync(`${O}/diffuseTransmissionTexture`,S.diffuseTransmissionTexture).then((O=>{O.name=`${y.name} (Diffuse Transmission)`,H.subSurface.translucencyIntensityTexture=O})))),void 0!==S.diffuseTransmissionColorFactor?H.subSurface.translucencyColor=b.d.Ng(S.diffuseTransmissionColorFactor):H.subSurface.translucencyColor=b.d.White(),S.diffuseTransmissionColorTexture&&h.push(this._loader.loadTextureInfoAsync(`${O}/diffuseTransmissionColorTexture`,S.diffuseTransmissionColorTexture).then((O=>{O.name=`${y.name} (Diffuse Transmission Color)`,H.subSurface.translucencyColorTexture=O}))),Promise.all(h).then((()=>{}))}}K(CO),e(CO,!0,(O=>new rO(O)));const nO="KHR_materials_volume";class Of{constructor(O){this.name=nO,this.order=173,this._loader=O,this.enabled=this._loader.isExtensionUsed(nO),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(O,f,y){return C.LoadExtensionAsync(O,f,this.name,((S,H)=>{const b=new Array;return b.push(this._loader.loadMaterialPropertiesAsync(O,f,y)),b.push(this._loadVolumePropertiesAsync(S,f,y,H)),Promise.all(b).then((()=>{}))}))}_loadVolumePropertiesAsync(O,f,y,S){if(!(y instanceof x))throw new Error(`${O}: Material type not supported`);if(!y.subSurface.isRefractionEnabled&&!y.subSurface.isTranslucencyEnabled||!S.thicknessFactor)return Promise.resolve();y.subSurface.volumeIndexOfRefraction=y.indexOfRefraction;const H=void 0!==S.attenuationDistance?S.attenuationDistance:Number.MAX_VALUE;return y.subSurface.tintColorAtDistance=H,void 0!==S.attenuationColor&&3==S.attenuationColor.length&&y.subSurface.tintColor.Xd(S.attenuationColor[0],S.attenuationColor[1],S.attenuationColor[2]),y.subSurface.minimumThickness=0,y.subSurface.maximumThickness=S.thicknessFactor,y.subSurface.useThicknessAsDepth=!0,S.thicknessTexture?(S.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${O}/thicknessTexture`,S.thicknessTexture).then((O=>{O.name=`${y.name} (Thickness)`,y.subSurface.thicknessTexture=O,y.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}K(nO),e(nO,!0,(O=>new Of(O)));const ff="KHR_materials_dispersion";class yf{constructor(O){this.name=ff,this.order=174,this._loader=O,this.enabled=this._loader.isExtensionUsed(ff)}dispose(){this._loader=null}loadMaterialPropertiesAsync(O,f,y){return C.LoadExtensionAsync(O,f,this.name,((S,H)=>{const b=new Array;return b.push(this._loader.loadMaterialPropertiesAsync(O,f,y)),b.push(this._loadDispersionPropertiesAsync(S,f,y,H)),Promise.all(b).then((()=>{}))}))}_loadDispersionPropertiesAsync(O,f,y,S){if(!(y instanceof x))throw new Error(`${O}: Material type not supported`);return y.subSurface.isRefractionEnabled&&S.dispersion?(y.subSurface.isDispersionEnabled=!0,y.subSurface.dispersion=S.dispersion,Promise.resolve()):Promise.resolve()}}K(ff),e(ff,!0,(O=>new yf(O)));const Sf="KHR_mesh_quantization";class Hf{constructor(O){this.name=Sf,this.enabled=O.isExtensionUsed(Sf)}dispose(){}}K(Sf),e(Sf,!0,(O=>new Hf(O)));const bf="KHR_texture_basisu";class hf{constructor(O){this.name=bf,this._loader=O,this.enabled=O.isExtensionUsed(bf)}dispose(){this._loader=null}_loadTextureAsync(O,f,y){return C.LoadExtensionAsync(O,f,this.name,((S,H)=>{const b=void 0==f.sampler?C.DefaultSampler:Q.Get(`${O}/sampler`,this._loader.Mi.samplers,f.sampler),h=Q.Get(`${S}/source`,this._loader.Mi.images,H.source);return this._loader._createTextureAsync(O,b,h,(O=>{y(O)}),f._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!f._textureInfo.nonColorData)}))}}K(bf),e(bf,!0,(O=>new hf(O)));const vf="KHR_texture_transform";class Nf{constructor(O){this.name=vf,this._loader=O,this.enabled=this._loader.isExtensionUsed(vf)}dispose(){this._loader=null}loadTextureInfoAsync(O,f,y){return C.LoadExtensionAsync(O,f,this.name,((S,H)=>this._loader.loadTextureInfoAsync(O,f,(O=>{if(!(O instanceof W.e))throw new Error(`${S}: Texture type not supported`);H.offset&&(O.uOffset=H.offset[0],O.vOffset=H.offset[1]),O.uRotationCenter=0,O.vRotationCenter=0,H.rotation&&(O.wAng=-H.rotation),H.scale&&(O.uScale=H.scale[0],O.vScale=H.scale[1]),void 0!=H.texCoord&&(O.coordinatesIndex=H.texCoord),y(O)}))))}}K(vf),e(vf,!0,(O=>new Nf(O)));const mf="KHR_xmp_json_ld";class tf{constructor(O){this.name=mf,this.order=100,this._loader=O,this.enabled=this._loader.isExtensionUsed(mf)}dispose(){this._loader=null}onLoading(){var O,f,y;if(null===this._loader.rootBabylonMesh)return;const S=null===(O=this._loader.Mi.extensions)||void 0===O?void 0:O.KHR_xmp_json_ld,H=null===(f=this._loader.Mi.asset)||void 0===f||null===(y=f.extensions)||void 0===y?void 0:y.KHR_xmp_json_ld;if(S&&H){const O=+H.packet;S.packets&&O<S.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=S.packets[O])}}}function qf(O,f,y,S){return b.d.Ng(f,y).scale(S)}function Ff(O,f,y,S){return f[y]*S}function If(O,f,y,S){return-f[y]*S}function Af(O,f,y,S){return f[y+1]*S}function Jf(O,f,y,S){return f[y]*S*2}function Xf(O){return{scale:[new Bf(F.d.ANIMATIONTYPE_FLOAT,`${O}.uScale`,Ff,(()=>2)),new Bf(F.d.ANIMATIONTYPE_FLOAT,`${O}.vScale`,Af,(()=>2))],offset:[new Bf(F.d.ANIMATIONTYPE_FLOAT,`${O}.uOffset`,Ff,(()=>2)),new Bf(F.d.ANIMATIONTYPE_FLOAT,`${O}.vOffset`,Af,(()=>2))],rotation:[new Bf(F.d.ANIMATIONTYPE_FLOAT,`${O}.wAng`,If,(()=>1))]}}K(mf),e(mf,!0,(O=>new tf(O)));class wf extends Y{buildAnimations(O,f,y,S,H){H(O._babylonCamera,this._buildAnimation(f,y,S))}}class Bf extends Y{buildAnimations(O,f,y,S,H){for(const b in O._data)H(O._data[b].babylonMaterial,this._buildAnimation(f,y,S))}}class jf extends Y{buildAnimations(O,f,y,S,H){H(O._babylonLight,this._buildAnimation(f,y,S))}}const uf={__array__:{__target__:!0,...a}},Lf={__array__:{__target__:!0,orthographic:{xmag:[new wf(F.d.ANIMATIONTYPE_FLOAT,"orthoLeft",If,(()=>1)),new wf(F.d.ANIMATIONTYPE_FLOAT,"orthoRight",Af,(()=>1))],ymag:[new wf(F.d.ANIMATIONTYPE_FLOAT,"orthoBottom",If,(()=>1)),new wf(F.d.ANIMATIONTYPE_FLOAT,"orthoTop",Af,(()=>1))],zfar:[new wf(F.d.ANIMATIONTYPE_FLOAT,"maxZ",Ff,(()=>1))],znear:[new wf(F.d.ANIMATIONTYPE_FLOAT,"Ui",Ff,(()=>1))]},perspective:{yfov:[new wf(F.d.ANIMATIONTYPE_FLOAT,"fov",Ff,(()=>1))],zfar:[new wf(F.d.ANIMATIONTYPE_FLOAT,"maxZ",Ff,(()=>1))],znear:[new wf(F.d.ANIMATIONTYPE_FLOAT,"Ui",Ff,(()=>1))]}}},pf={nodes:uf,materials:{__array__:{__target__:!0,pbrMetallicRoughness:{baseColorFactor:[new Bf(F.d.ANIMATIONTYPE_COLOR3,"albedoColor",qf,(()=>4)),new Bf(F.d.ANIMATIONTYPE_FLOAT,"alpha",(function(O,f,y,S){return f[y+3]*S}),(()=>4))],metallicFactor:[new Bf(F.d.ANIMATIONTYPE_FLOAT,"metallic",Ff,(()=>1))],roughnessFactor:[new Bf(F.d.ANIMATIONTYPE_FLOAT,"roughness",Ff,(()=>1))],baseColorTexture:{extensions:{KHR_texture_transform:Xf("albedoTexture")}},metallicRoughnessTexture:{extensions:{KHR_texture_transform:Xf("metallicTexture")}}},emissiveFactor:[new Bf(F.d.ANIMATIONTYPE_COLOR3,"emissiveColor",qf,(()=>3))],normalTexture:{scale:[new Bf(F.d.ANIMATIONTYPE_FLOAT,"bumpTexture.level",Ff,(()=>1))],extensions:{KHR_texture_transform:Xf("bumpTexture")}},occlusionTexture:{strength:[new Bf(F.d.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",Ff,(()=>1))],extensions:{KHR_texture_transform:Xf("ambientTexture")}},emissiveTexture:{extensions:{KHR_texture_transform:Xf("emissiveTexture")}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:[new Bf(F.d.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",Ff,(()=>1))],anisotropyRotation:[new Bf(F.d.ANIMATIONTYPE_FLOAT,"anisotropy.angle",Ff,(()=>1))],anisotropyTexture:{extensions:{KHR_texture_transform:Xf("anisotropy.texture")}}},KHR_materials_clearcoat:{clearcoatFactor:[new Bf(F.d.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",Ff,(()=>1))],clearcoatRoughnessFactor:[new Bf(F.d.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",Ff,(()=>1))],clearcoatTexture:{extensions:{KHR_texture_transform:Xf("clearCoat.texture")}},clearcoatNormalTexture:{scale:[new Bf(F.d.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",Ff,(()=>1))],extensions:{KHR_texture_transform:Xf("clearCoat.bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:Xf("clearCoat.textureRoughness")}}},KHR_materials_dispersion:{dispersion:[new Bf(F.d.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",Ff,(()=>1))]},KHR_materials_emissive_strength:{emissiveStrength:[new Bf(F.d.ANIMATIONTYPE_FLOAT,"emissiveIntensity",Ff,(()=>1))]},KHR_materials_ior:{ior:[new Bf(F.d.ANIMATIONTYPE_FLOAT,"indexOfRefraction",Ff,(()=>1))]},KHR_materials_iridescence:{iridescenceFactor:[new Bf(F.d.ANIMATIONTYPE_FLOAT,"iridescence.intensity",Ff,(()=>1))],iridescenceIor:[new Bf(F.d.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",Ff,(()=>1))],iridescenceThicknessMinimum:[new Bf(F.d.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",Ff,(()=>1))],iridescenceThicknessMaximum:[new Bf(F.d.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",Ff,(()=>1))],iridescenceTexture:{extensions:{KHR_texture_transform:Xf("iridescence.texture")}},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:Xf("iridescence.thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:[new Bf(F.d.ANIMATIONTYPE_COLOR3,"sheen.color",qf,(()=>3))],sheenRoughnessFactor:[new Bf(F.d.ANIMATIONTYPE_FLOAT,"sheen.roughness",Ff,(()=>1))],sheenColorTexture:{extensions:{KHR_texture_transform:Xf("sheen.texture")}},sheenRoughnessTexture:{extensions:{KHR_texture_transform:Xf("sheen.textureRoughness")}}},KHR_materials_specular:{specularFactor:[new Bf(F.d.ANIMATIONTYPE_FLOAT,"metallicF0Factor",Ff,(()=>1))],specularColorFactor:[new Bf(F.d.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",qf,(()=>3))],specularTexture:{extensions:{KHR_texture_transform:Xf("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:Xf("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:[new Bf(F.d.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",Ff,(()=>1))],transmissionTexture:{extensions:{KHR_texture_transform:Xf("subSurface.refractionIntensityTexture")}}},KHR_materials_volume:{attenuationColor:[new Bf(F.d.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",qf,(()=>3))],attenuationDistance:[new Bf(F.d.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",Ff,(()=>1))],thicknessFactor:[new Bf(F.d.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",Ff,(()=>1))],thicknessTexture:{extensions:{KHR_texture_transform:Xf("subSurface.thicknessTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:[new Bf(F.d.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",Ff,(()=>1))],diffuseTransmissionTexture:{extensions:{KHR_texture_transform:Xf("subSurface.translucencyIntensityTexture")}},diffuseTransmissionColorFactor:[new Bf(F.d.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",qf,(()=>3))],diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:Xf("subSurface.translucencyColorTexture")}}}}}},cameras:Lf,extensions:{KHR_lights_punctual:{lights:{__array__:{__target__:!0,color:[new jf(F.d.ANIMATIONTYPE_COLOR3,"diffuse",qf,(()=>3))],Yi:[new jf(F.d.ANIMATIONTYPE_FLOAT,"intensity",Ff,(()=>1))],range:[new jf(F.d.ANIMATIONTYPE_FLOAT,"range",Ff,(()=>1))],spot:{innerConeAngle:[new jf(F.d.ANIMATIONTYPE_FLOAT,"innerAngle",Jf,(()=>1))],outerConeAngle:[new jf(F.d.ANIMATIONTYPE_FLOAT,"angle",Jf,(()=>1))]}}}}}};class Uf{constructor(O,f){this._gltf=O,this._infoTree=f}convert(O){let f,y=this._gltf,S=this._infoTree;if(!O.startsWith("/"))throw new Error("Path must start with a /");const H=O.split("/");H.shift();for(const b of H){if(S.__array__)S=S.__array__;else if(S=S[b],!S)throw new Error(`Path ${O} is invalid`);if(void 0===y)throw new Error(`Path ${O} is invalid`);y=y[b],S.__target__&&(f=y)}return{object:f,info:S}}}const lf="KHR_animation_pointer";class xf extends Uf{constructor(O){super(O,pf)}}class Wf{constructor(O){this.name=lf,this._loader=O,this._pathToObjectConverter=new xf(this._loader.Mi)}get enabled(){return this._loader.isExtensionUsed(lf)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(O,f,y,S,H){var b;const h=null===(b=S.target.extensions)||void 0===b?void 0:b.KHR_animation_pointer;if(!h||!this._pathToObjectConverter)return null;"pointer"!==S.target.path&&J.e.Warn(`${O}/target/path: Value (${S.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=S.target.node&&J.e.Warn(`${O}/target/node: Value (${S.target.node}) must not be present when using the ${this.name} extension`);const v=`${O}/extensions/${this.name}`,N=h.pointer;if(!N)throw new Error(`${v}: Pointer is missing`);try{const b=this._pathToObjectConverter.convert(N);return this._loader._loadAnimationChannelFromTargetInfoAsync(O,f,y,S,b,H)}catch(m){return J.e.Warn(`${v}/pointer: Invalid pointer (${N}) skipped`),null}}}K(lf),e(lf,!0,(O=>new Wf(O)));class Ef{constructor(O,f,y){this.frame=O,this.action=f,this.onlyOnce=y,this.isDone=!1}_clone(){return new Ef(this.frame,this.action,this.onlyOnce)}}var of=y(11030),Df=y(11092);class Vf{get loop(){return this._loop}set loop(O){O!==this._loop&&(this._loop=O,this.updateOptions({loop:O}))}get currentTime(){var O;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(O=Df.c.audioEngine)&&void 0!==O&&O.audioContext&&(this.isPlaying||this.isPaused)){const O=this.isPaused?0:Df.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+O}return 0}get spatialSound(){return this._spatialSound}set spatialSound(O){if(O==this._spatialSound)return;const f=this.isPlaying;this.pause(),O?(this._spatialSound=O,this._updateSpatialParameters()):this._disableSpatialSound(),f&&this.play()}constructor(O,f,y){var S;let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,v=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new t.d,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=H.m.Zero(),this._localDirection=new H.m(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=O,y=y||A.c.LastCreatedScene)if(this._scene=y,Vf._SceneComponentInitialization(y),this._readyToPlayCallback=b,this._customAttenuationFunction=(O,f,y,S,H)=>f<y?O*(1-f/y):0,v&&(this.autoplay=v.autoplay||!1,this._loop=v.loop||!1,void 0!==v.volume&&(this._volume=v.volume),this._spatialSound=v.spatialSound??!1,this.maxDistance=v.maxDistance??100,this.useCustomAttenuation=v.useCustomAttenuation??!1,this.rolloffFactor=v.rolloffFactor||1,this.refDistance=v.refDistance||1,this.distanceModel=v.distanceModel||"linear",this._playbackRate=v.playbackRate||1,this._streaming=v.streaming??!1,this._length=v.length,this._offset=v.offset),null!==(S=Df.c.audioEngine)&&void 0!==S&&S.canUseWebAudio&&Df.c.audioEngine.audioContext){this._soundGain=Df.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let O=!0;if(f)try{"string"===typeof f?(this._urlType="String",this._url=f):f instanceof ArrayBuffer?this._urlType="ArrayBuffer":f instanceof HTMLMediaElement?this._urlType="MediaElement":f instanceof MediaStream?this._urlType="MediaStream":f instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(f)&&(this._urlType="Array");let y=[],S=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Df.c.audioEngine.audioContext.createMediaElementSource(f),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Df.c.audioEngine.audioContext.createMediaStreamSource(f),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":f.byteLength>0&&(S=!0,this._soundLoaded(f));break;case"AudioBuffer":this._audioBufferLoaded(f);break;case"String":y.push(f);case"Array":0===y.length&&(y=f);for(let O=0;O<y.length;O++){const f=y[O];if(S=v&&v.skipCodecCheck||-1!==f.indexOf(".mp3",f.length-4)&&Df.c.audioEngine.isMP3supported||-1!==f.indexOf(".ogg",f.length-4)&&Df.c.audioEngine.isOGGsupported||-1!==f.indexOf(".wav",f.length-4)||-1!==f.indexOf(".m4a",f.length-4)||-1!==f.indexOf(".mp4",f.length-4)||-1!==f.indexOf("blob:"),S){this._streaming?(this._htmlAudioElement=new Audio(f),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,h.d.SetCorsBehavior(f,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(f,(O=>{this._soundLoaded(O)}),void 0,!0,!0,(O=>{O&&J.e.Error("XHR "+O.status+" error on: "+f+"."),J.e.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:O=!1}O?S||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):J.e.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(N){J.e.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Df.c.audioEngine&&!Df.c.audioEngine.WarnedWebAudioUnsupported&&(J.e.Error("Web Audio is not supported by your browser."),Df.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var O;null!==(O=Df.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(O){var f;null!==(f=Df.c.audioEngine)&&void 0!==f&&f.audioContext&&(this._audioBuffer=O,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(O){var f;null!==(f=Df.c.audioEngine)&&void 0!==f&&f.audioContext&&Df.c.audioEngine.audioContext.decodeAudioData(O,(O=>{this._audioBufferLoaded(O)}),(O=>{J.e.Error("Error while decoding audio data for: "+this.name+" / Error: "+O)}))}setAudioBuffer(O){var f;null!==(f=Df.c.audioEngine)&&void 0!==f&&f.canUseWebAudio&&(this._audioBuffer=O,this._isReadyToPlay=!0)}updateOptions(O){O&&(this.loop=O.loop??this.loop,this.maxDistance=O.maxDistance??this.maxDistance,this.useCustomAttenuation=O.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=O.rolloffFactor??this.rolloffFactor,this.refDistance=O.refDistance??this.refDistance,this.distanceModel=O.distanceModel??this.distanceModel,this._playbackRate=O.playbackRate??this._playbackRate,this._length=O.length??void 0,this.spatialSound=O.spatialSound??this._spatialSound,this._setOffset(O.offset??void 0),this.setVolume(O.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var O;null!==(O=Df.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&Df.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Df.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var O;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(O=this._soundPanner)||void 0===O||O.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var O;null!==(O=Df.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(O){var f;null!==(f=Df.c.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(O),this._isOutputConnected=!0)}setDirectionalCone(O,f,y){f<O?J.e.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=O,this._coneOuterAngle=f,this._coneOuterGain=y,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(O){if(O!=this._coneInnerAngle){var f;if(this._coneOuterAngle<O)return void J.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=O,null!==(f=Df.c.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(O){if(O!=this._coneOuterAngle){var f;if(O<this._coneInnerAngle)return void J.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=O,null!==(f=Df.c.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(O){var f;O.equals(this._position)||(this._position.p(O),null!==(f=Df.c.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(O){var f;this._localDirection=O,null!==(f=Df.c.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const O=this._connectedTransformNode.getWorldMatrix(),f=H.m.TransformNormal(this._localDirection,O);f.normalize(),this._soundPanner.orientationX.value=f.x,this._soundPanner.orientationY.value=f.y,this._soundPanner.orientationZ.value=f.z}updateDistanceFromListener(){var O;if(null!==(O=Df.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const O=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.xc(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,O,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(O){this._customAttenuationFunction=O}play(O,f,y){var S;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(S=Df.c.audioEngine)&&void 0!==S&&S.audioContext)try{var H,b;this._clearTimeoutsAndObservers();let S=O?(null===(H=Df.c.audioEngine)||void 0===H?void 0:H.audioContext.currentTime)+O:null===(b=Df.c.audioEngine)||void 0===b?void 0:b.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Df.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const O=()=>{var y;if(null!==(y=Df.c.audioEngine)&&void 0!==y&&y.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=f??0;const y=this._htmlAudioElement.play();void 0!==y&&y.catch((()=>{var f,y;(null===(f=Df.c.audioEngine)||void 0===f||f.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(y=Df.c.audioEngine)||void 0===y?void 0:y.onAudioUnlockedObservable.addOnce((()=>{O()})))}))}else{var S;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(S=Df.c.audioEngine)||void 0===S?void 0:S.onAudioUnlockedObservable.addOnce((()=>{O()}))}};O()}}else{var h;const H=()=>{var H;if(null!==(H=Df.c.audioEngine)&&void 0!==H&&H.audioContext){var b;if(y=y||this._length,void 0!==f&&this._setOffset(f),this._soundSource){const O=this._soundSource;O.onended=()=>{O.disconnect()}}if(this._soundSource=null===(b=Df.c.audioEngine)||void 0===b?void 0:b.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var h;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==f&&(this._soundSource.loopStart=f),void 0!==y&&(this._soundSource.loopEnd=(0|f)+y),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},S=O?(null===(h=Df.c.audioEngine)||void 0===h?void 0:h.audioContext.currentTime)+O:Df.c.audioEngine.audioContext.currentTime;const H=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(S,H,this.loop?void 0:y)}}};"suspended"===(null===(h=Df.c.audioEngine)||void 0===h?void 0:h.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var O;"suspended"===(null===(O=Df.c.audioEngine)||void 0===O?void 0:O.audioContext.state)?(Df.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Df.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{H()})))):H()}),500):H()}this._startTime=S,this.isPlaying=!0,this.isPaused=!1}catch(v){J.e.Error("Error while trying to play audio: "+this.name+", "+v.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(O){var f;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var y;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(y=this._streamingSource)||void 0===y||y.disconnect();this.isPlaying=!1}else if(null!==(f=Df.c.audioEngine)&&void 0!==f&&f.audioContext&&this._soundSource){const f=O?Df.c.audioEngine.audioContext.currentTime+O:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(f)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var O;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var f;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(f=this._streamingSource)||void 0===f||f.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(O=Df.c.audioEngine)&&void 0!==O&&O.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Df.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(O,f){var y;null!==(y=Df.c.audioEngine)&&void 0!==y&&y.canUseWebAudio&&this._soundGain&&(f&&Df.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Df.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Df.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(O,Df.c.audioEngine.audioContext.currentTime+f)):this._soundGain.gain.value=O),this._volume=O}setPlaybackRate(O){this._playbackRate=O,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(O){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=O,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=O=>this._onRegisterAfterWorldMatrixUpdate(O),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(O){var f;if(O.getBoundingInfo){const f=O.getBoundingInfo();this.setPosition(f.boundingSphere.centerWorld)}else this.setPosition(O.absolutePosition);null!==(f=Df.c.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const O=()=>{this._isReadyToPlay?(y._audioBuffer=this.getAudioBuffer(),y._isReadyToPlay=!0,y.autoplay&&y.play(0,this._offset,this._length)):setTimeout(O,300)},f={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},y=new Vf(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,f);return this.useCustomAttenuation&&y.setAttenuationFunction(this._customAttenuationFunction),y.setPosition(this._position),y.setPlaybackRate(this._playbackRate),O(),y}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const O={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(O.connectedMeshId=this._connectedTransformNode.id),O.position=this._position.gj(),O.refDistance=this.refDistance,O.distanceModel=this.distanceModel,O.isDirectional=this._isDirectional,O.localDirectionToMesh=this._localDirection.gj(),O.coneInnerAngle=this._coneInnerAngle,O.coneOuterAngle=this._coneOuterAngle,O.coneOuterGain=this._coneOuterGain),O}static Parse(O,f,y,S){const b=O.name;let h;h=O.url?y+O.url:y+b;const v={autoplay:O.autoplay,loop:O.loop,volume:O.volume,spatialSound:O.spatialSound,maxDistance:O.maxDistance,rolloffFactor:O.rolloffFactor,refDistance:O.refDistance,distanceModel:O.distanceModel,playbackRate:O.playbackRate};let N;if(S){const O=()=>{S._isReadyToPlay?(N._audioBuffer=S.getAudioBuffer(),N._isReadyToPlay=!0,N.autoplay&&N.play(0,N._offset,N._length)):setTimeout(O,300)};N=new Vf(b,new ArrayBuffer(0),f,null,v),O()}else N=new Vf(b,h,f,(()=>{f.removePendingData(N)}),v),f.addPendingData(N);if(O.position){const f=H.m.Ng(O.position);N.setPosition(f)}if(O.isDirectional&&(N.setDirectionalCone(O.coneInnerAngle||360,O.coneOuterAngle||360,O.coneOuterGain||0),O.localDirectionToMesh)){const f=H.m.Ng(O.localDirectionToMesh);N.setLocalDirectionToMesh(f)}if(O.connectedMeshId){const y=f.getMeshById(O.connectedMeshId);y&&N.attachToMesh(y)}return O.metadata&&(N.metadata=O.metadata),N}_setOffset(O){this._offset!==O&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=O)}_clearTimeoutsAndObservers(){var O;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(O=Df.c.audioEngine)||void 0===O||O.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Vf._SceneComponentInitialization=O=>{throw(0,of.d)("AudioSceneComponent")},(0,U.g)("BABYLON.Sound",Vf);class gf{constructor(O,f,y){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],f.length!==y.length)throw new Error("Sounds length does not equal weights length");this.loop=O,this._weights=y;let S=0;for(const b of y)S+=b;const H=S>0?1/S:0;for(let b=0;b<this._weights.length;b++)this._weights[b]*=H;this._sounds=f;for(const b of this._sounds)b.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(O){if(O!==this._coneInnerAngle){if(this._coneOuterAngle<O)return void J.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=O;for(const f of this._sounds)f.directionalConeInnerAngle=O}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(O){if(O!==this._coneOuterAngle){if(O<this._coneInnerAngle)return void J.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=O;for(const f of this._sounds)f.directionalConeOuterAngle=O}}get volume(){return this._volume}set volume(O){if(O!==this._volume)for(const f of this._sounds)f.setVolume(O)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(O){if(!this.isPaused){this.stop();const O=Math.random();let f=0;for(let y=0;y<this._weights.length;y++)if(f+=this._weights[y],O<=f){this._currentIndex=y;break}}const f=this._sounds[this._currentIndex??0];f.isReady()?f.play(0,this.isPaused?void 0:O):f.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Rf{constructor(O){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(O=O||A.c.LastCreatedScene)&&(this._scene=O,this.soundCollection=[],this._options=f,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var O;null!==(O=Df.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&Df.c.audioEngine.audioContext&&(this._outputAudioNode=Df.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Df.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Df.c.audioEngine&&Df.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(O){var f;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(f=Df.c.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._outputAudioNode&&O.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==O.soundTrackId&&(-1===O.soundTrackId?this._scene.mainSoundTrack.removeSound(O):this._scene.soundTracks&&this._scene.soundTracks[O.soundTrackId].removeSound(O)),this.soundCollection.push(O),O.soundTrackId=this.id}removeSound(O){const f=this.soundCollection.indexOf(O);-1!==f&&this.soundCollection.splice(f,1)}setVolume(O){var f;null!==(f=Df.c.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=O)}switchPanningModelToHRTF(){var O;if(null!==(O=Df.c.audioEngine)&&void 0!==O&&O.canUseWebAudio)for(let f=0;f<this.soundCollection.length;f++)this.soundCollection[f].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var O;if(null!==(O=Df.c.audioEngine)&&void 0!==O&&O.canUseWebAudio)for(let f=0;f<this.soundCollection.length;f++)this.soundCollection[f].switchPanningModelToEqualPower()}connectToAnalyser(O){var f;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=O,null!==(f=Df.c.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Df.c.audioEngine.masterGain))}}var sf=y(11402),kf=y(11311),zf=(y(11831),y(11028));(0,y(11910).d)(sf.b.NAME_AUDIO,((O,f,y,S)=>{let H,b=[];if(y.Zj=y.Zj||[],void 0!==O.Zj&&null!==O.Zj)for(let v=0,N=O.Zj.length;v<N;v++){var h;const N=O.Zj[v];null!==(h=Df.c.audioEngine)&&void 0!==h&&h.canUseWebAudio?(N.url||(N.url=N.name),b[N.url]?y.Zj.push(Vf.Parse(N,f,S,b[N.url])):(H=Vf.Parse(N,f,S),b[N.url]=H,y.Zj.push(H))):y.Zj.push(new Vf(N.name,null,f))}b=[]})),Object.defineProperty(kf.c.prototype,"mainSoundTrack",{get:function(){let O=this._getComponent(sf.b.NAME_AUDIO);return O||(O=new cf(this),this.o(O)),this._mainSoundTrack||(this._mainSoundTrack=new Rf(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),kf.c.prototype.getSoundByName=function(O){let f;for(f=0;f<this.mainSoundTrack.soundCollection.length;f++)if(this.mainSoundTrack.soundCollection[f].name===O)return this.mainSoundTrack.soundCollection[f];if(this.soundTracks)for(let y=0;y<this.soundTracks.length;y++)for(f=0;f<this.soundTracks[y].soundCollection.length;f++)if(this.soundTracks[y].soundCollection[f].name===O)return this.soundTracks[y].soundCollection[f];return null},Object.defineProperty(kf.c.prototype,"audioEnabled",{get:function(){let O=this._getComponent(sf.b.NAME_AUDIO);return O||(O=new cf(this),this.o(O)),O.audioEnabled},set:function(O){let f=this._getComponent(sf.b.NAME_AUDIO);f||(f=new cf(this),this.o(f)),O?f.enableAudio():f.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(kf.c.prototype,"headphone",{get:function(){let O=this._getComponent(sf.b.NAME_AUDIO);return O||(O=new cf(this),this.o(O)),O.headphone},set:function(O){let f=this._getComponent(sf.b.NAME_AUDIO);f||(f=new cf(this),this.o(f)),O?f.switchAudioModeForHeadphones():f.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(kf.c.prototype,"audioListenerPositionProvider",{get:function(){let O=this._getComponent(sf.b.NAME_AUDIO);return O||(O=new cf(this),this.o(O)),O.audioListenerPositionProvider},set:function(O){let f=this._getComponent(sf.b.NAME_AUDIO);if(f||(f=new cf(this),this.o(f)),O&&"function"!==typeof O)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");f.audioListenerPositionProvider=O},enumerable:!0,configurable:!0}),Object.defineProperty(kf.c.prototype,"audioListenerRotationProvider",{get:function(){let O=this._getComponent(sf.b.NAME_AUDIO);return O||(O=new cf(this),this.o(O)),O.audioListenerRotationProvider},set:function(O){let f=this._getComponent(sf.b.NAME_AUDIO);if(f||(f=new cf(this),this.o(f)),O&&"function"!==typeof O)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");f.audioListenerRotationProvider=O},enumerable:!0,configurable:!0}),Object.defineProperty(kf.c.prototype,"audioPositioningRefreshRate",{get:function(){let O=this._getComponent(sf.b.NAME_AUDIO);return O||(O=new cf(this),this.o(O)),O.audioPositioningRefreshRate},set:function(O){let f=this._getComponent(sf.b.NAME_AUDIO);f||(f=new cf(this),this.o(f)),f.audioPositioningRefreshRate=O},enumerable:!0,configurable:!0});class cf{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(O){this.name=sf.b.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new H.m,this._cachedCameraPosition=new H.m,this._lastCheck=0,this._invertMatrixTemp=new H.b,this._cameraDirectionTemp=new H.m,(O=O||A.c.LastCreatedScene)&&(this.yd=O,O.soundTracks=[],O.Zj=[])}register(){this.yd._afterRenderStage.registerStep(sf.b.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(O){if(O.Zj=[],this.yd.soundTracks)for(let f=0;f<this.yd.soundTracks.length;f++){const y=this.yd.soundTracks[f];for(let f=0;f<y.soundCollection.length;f++)O.Zj.push(y.soundCollection[f].serialize())}}addFromContainer(O){O.Zj&&O.Zj.forEach((O=>{O.play(),O.autoplay=!0,this.yd.mainSoundTrack.addSound(O)}))}removeFromContainer(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];O.Zj&&O.Zj.forEach((O=>{O.stop(),O.autoplay=!1,this.yd.mainSoundTrack.removeSound(O),f&&O.dispose()}))}dispose(){const O=this.yd;if(O._mainSoundTrack&&O.mainSoundTrack.dispose(),O.soundTracks)for(let f=0;f<O.soundTracks.length;f++)O.soundTracks[f].dispose()}disableAudio(){const O=this.yd;let f;for(this._audioEnabled=!1,Df.c.audioEngine&&Df.c.audioEngine.audioContext&&Df.c.audioEngine.audioContext.suspend(),f=0;f<O.mainSoundTrack.soundCollection.length;f++)O.mainSoundTrack.soundCollection[f].pause();if(O.soundTracks)for(f=0;f<O.soundTracks.length;f++)for(let y=0;y<O.soundTracks[f].soundCollection.length;y++)O.soundTracks[f].soundCollection[y].pause()}enableAudio(){const O=this.yd;let f;for(this._audioEnabled=!0,Df.c.audioEngine&&Df.c.audioEngine.audioContext&&Df.c.audioEngine.audioContext.resume(),f=0;f<O.mainSoundTrack.soundCollection.length;f++)O.mainSoundTrack.soundCollection[f].isPaused&&O.mainSoundTrack.soundCollection[f].play();if(O.soundTracks)for(f=0;f<O.soundTracks.length;f++)for(let y=0;y<O.soundTracks[f].soundCollection.length;y++)O.soundTracks[f].soundCollection[y].isPaused&&O.soundTracks[f].soundCollection[y].play()}switchAudioModeForHeadphones(){const O=this.yd;if(this._headphone=!0,O.mainSoundTrack.switchPanningModelToHRTF(),O.soundTracks)for(let f=0;f<O.soundTracks.length;f++)O.soundTracks[f].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const O=this.yd;if(this._headphone=!1,O.mainSoundTrack.switchPanningModelToEqualPower(),O.soundTracks)for(let f=0;f<O.soundTracks.length;f++)O.soundTracks[f].switchPanningModelToEqualPower()}_afterRender(){const O=zf.b.Now;if(this._lastCheck&&O-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=O;const f=this.yd;if(!this._audioEnabled||!f._mainSoundTrack||!f.soundTracks||0===f._mainSoundTrack.soundCollection.length&&1===f.soundTracks.length)return;const y=Df.c.audioEngine;if(y&&y.audioContext){let O,S=f.activeCamera;if(f.activeCameras&&f.activeCameras.length>0&&(S=f.activeCameras[0]),this.audioListenerPositionProvider){const O=this.audioListenerPositionProvider();y.audioContext.listener.setPosition(O.x||0,O.y||0,O.z||0)}else S?this._cachedCameraPosition.equals(S.globalPosition)||(this._cachedCameraPosition.p(S.globalPosition),y.audioContext.listener.setPosition(S.globalPosition.x,S.globalPosition.y,S.globalPosition.z)):y.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const O=this.audioListenerRotationProvider();y.audioContext.listener.setOrientation(O.x||0,O.y||0,O.z||0,0,1,0)}else S?(S.rigCameras&&S.rigCameras.length>0&&(S=S.rigCameras[0]),S.getViewMatrix().invertToRef(this._invertMatrixTemp),H.m.TransformNormalToRef(cf._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),y.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):y.audioContext.listener.setOrientation(0,0,0,0,1,0);for(O=0;O<f.mainSoundTrack.soundCollection.length;O++){const y=f.mainSoundTrack.soundCollection[O];y.useCustomAttenuation&&y.updateDistanceFromListener()}if(f.soundTracks)for(O=0;O<f.soundTracks.length;O++)for(let y=0;y<f.soundTracks[O].soundCollection.length;y++){const S=f.soundTracks[O].soundCollection[y];S.useCustomAttenuation&&S.updateDistanceFromListener()}}}}cf._CameraDirection=new H.m(0,0,-1),Vf._SceneComponentInitialization=O=>{let f=O._getComponent(sf.b.NAME_AUDIO);f||(f=new cf(O),O.o(f))};const df="MSFT_audio_emitter";class Gf{constructor(O){this.name=df,this._loader=O,this.enabled=this._loader.isExtensionUsed(df)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const O=this._loader.Mi.extensions;if(O&&O[this.name]){const f=O[this.name];this._clips=f.clips,this._emitters=f.emitters,Q.Assign(this._clips),Q.Assign(this._emitters)}}loadSceneAsync(O,f){return C.LoadExtensionAsync(O,f,this.name,((y,S)=>{const H=new Array;H.push(this._loader.loadSceneAsync(O,f));for(const O of S.emitters){const f=Q.Get(`${y}/emitters`,this._emitters,O);if(void 0!=f.refDistance||void 0!=f.maxDistance||void 0!=f.rolloffFactor||void 0!=f.distanceModel||void 0!=f.innerAngle||void 0!=f.outerAngle)throw new Error(`${y}: Direction or Distance properties are not allowed on emitters attached to a scene`);H.push(this._loadEmitterAsync(`${y}/emitters/${f.index}`,f))}return Promise.all(H).then((()=>{}))}))}loadNodeAsync(O,f,y){return C.LoadExtensionAsync(O,f,this.name,((O,S)=>{const b=new Array;return this._loader.loadNodeAsync(O,f,(f=>{for(const y of S.emitters){const S=Q.Get(`${O}/emitters`,this._emitters,y);b.push(this._loadEmitterAsync(`${O}/emitters/${S.index}`,S).then((()=>{for(const O of S._babylonSounds)O.attachToMesh(f),void 0==S.innerAngle&&void 0==S.outerAngle||(O.setLocalDirectionToMesh(H.m.Forward()),O.setDirectionalCone(2*h.d.ToDegrees(void 0==S.innerAngle?Math.PI:S.innerAngle),2*h.d.ToDegrees(void 0==S.outerAngle?Math.PI:S.outerAngle),0))})))}y(f)})).then((O=>Promise.all(b).then((()=>O))))}))}loadAnimationAsync(O,f){return C.LoadExtensionAsync(O,f,this.name,((y,S)=>this._loader.loadAnimationAsync(O,f).then((H=>{const b=new Array;Q.Assign(S.events);for(const h of S.events)b.push(this._loadAnimationEventAsync(`${y}/events/${h.index}`,O,f,h,H));return Promise.all(b).then((()=>H))}))))}_loadClipAsync(O,f){if(f._objectURL)return f._objectURL;let y;if(f.uri)y=this._loader.loadUriAsync(O,f,f.uri);else{const S=Q.Get(`${O}/bufferView`,this._loader.Mi.bufferViews,f.bufferView);y=this._loader.loadBufferViewAsync(`/bufferViews/${S.index}`,S)}return f._objectURL=y.then((O=>URL.createObjectURL(new Blob([O],{type:f.mimeType})))),f._objectURL}_loadEmitterAsync(O,f){if(f._babylonSounds=f._babylonSounds||[],!f._babylonData){const O=new Array,y=f.name||`emitter${f.index}`,S={loop:!1,autoplay:!1,volume:void 0==f.volume?1:f.volume};for(let b=0;b<f.clips.length;b++){const H=`/extensions/${this.name}/clips`,h=Q.Get(H,this._clips,f.clips[b].clip);O.push(this._loadClipAsync(`${H}/${f.clips[b].clip}`,h).then((O=>{const H=f._babylonSounds[b]=new Vf(y,O,this._loader.babylonScene,null,S);H.refDistance=f.refDistance||1,H.maxDistance=f.maxDistance||256,H.rolloffFactor=f.rolloffFactor||1,H.distanceModel=f.distanceModel||"exponential"})))}const H=Promise.all(O).then((()=>{const O=f.clips.map((O=>O.weight||1)),y=new gf(f.loop||!1,f._babylonSounds,O);f.innerAngle&&(y.directionalConeInnerAngle=2*h.d.ToDegrees(f.innerAngle)),f.outerAngle&&(y.directionalConeOuterAngle=2*h.d.ToDegrees(f.outerAngle)),f.volume&&(y.volume=f.volume),f._babylonData.sound=y}));f._babylonData={loaded:H}}return f._babylonData.loaded}_getEventAction(O,f,y,S,H){switch(y){case"play":return O=>{const y=(H||0)+(O-S);f.play(y)};case"stop":return()=>{f.stop()};case"pause":return()=>{f.pause()};default:throw new Error(`${O}: Unsupported action ${y}`)}}_loadAnimationEventAsync(O,f,y,S,H){if(0==H.targetedAnimations.length)return Promise.resolve();const b=H.targetedAnimations[0],h=S.j,v=Q.Get(`/extensions/${this.name}/emitters`,this._emitters,h);return this._loadEmitterAsync(O,v).then((()=>{const f=v._babylonData.sound;if(f){const y=new Ef(S.time,this._getEventAction(O,f,S.action,S.time,S.startOffset));b.animation.addEvent(y),H.onAnimationGroupEndObservable.add((()=>{f.stop()})),H.onAnimationGroupPauseObservable.add((()=>{f.pause()}))}}))}}K(df),e(df,!0,(O=>new Gf(O)));const Yf="MSFT_lod";class Zf{constructor(O){var f;this.name=Yf,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new t.d,this.onMaterialLODsLoadedObservable=new t.d,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=O,this.maxLODsToLoad=(null===(f=this._loader.parent.extensionOptions[Yf])||void 0===f?void 0:f.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Yf)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let O=0;O<this._nodePromiseLODs.length;O++){const f=Promise.all(this._nodePromiseLODs[O]).then((()=>{0!==O&&(this._loader.endPerformanceCounter(`Node LOD ${O}`),this._loader.log(`Loaded node LOD ${O}`)),this.onNodeLODsLoadedObservable.notifyObservers(O),O!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${O+1}`),this._loadBufferLOD(this._nodeBufferLODs,O+1),this._nodeSignalLODs[O]&&this._nodeSignalLODs[O].resolve())}));this._loader._completePromises.push(f)}for(let O=0;O<this._materialPromiseLODs.length;O++){const f=Promise.all(this._materialPromiseLODs[O]).then((()=>{0!==O&&(this._loader.endPerformanceCounter(`Material LOD ${O}`),this._loader.log(`Loaded material LOD ${O}`)),this.onMaterialLODsLoadedObservable.notifyObservers(O),O!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${O+1}`),this._loadBufferLOD(this._materialBufferLODs,O+1),this._materialSignalLODs[O]&&this._materialSignalLODs[O].resolve())}));this._loader._completePromises.push(f)}}loadSceneAsync(O,f){const y=this._loader.loadSceneAsync(O,f);return this._loadBufferLOD(this._bufferLODs,0),y}loadNodeAsync(O,f,y){return C.LoadExtensionAsync(O,f,this.name,((O,H)=>{let b;const h=this._getLODs(O,f,this._loader.Mi.nodes,H.ids);this._loader.logOpen(`${O}`);for(let f=0;f<h.length;f++){const O=h[f];0!==f&&(this._nodeIndexLOD=f,this._nodeSignalLODs[f]=this._nodeSignalLODs[f]||new S);const H=O=>{y(O),O.$b(!1)},v=this._loader.loadNodeAsync(`/nodes/${O.index}`,O,H).then((O=>{if(0!==f){const O=h[f-1];O._babylonTransformNode&&(this._disposeTransformNode(O._babylonTransformNode),delete O._babylonTransformNode)}return O.$b(!0),O}));this._nodePromiseLODs[f]=this._nodePromiseLODs[f]||[],0===f?b=v:(this._nodeIndexLOD=null,this._nodePromiseLODs[f].push(v))}return this._loader.logClose(),b}))}_loadMaterialAsync(O,f,y,S,H){return this._nodeIndexLOD?null:C.LoadExtensionAsync(O,f,this.name,((O,b)=>{let h;const v=this._getLODs(O,f,this._loader.Mi.materials,b.ids);this._loader.logOpen(`${O}`);for(let f=0;f<v.length;f++){const O=v[f];0!==f&&(this._materialIndexLOD=f);const b=this._loader._loadMaterialAsync(`/materials/${O.index}`,O,y,S,(O=>{0===f&&H(O)})).then((O=>{if(0!==f){H(O);const y=v[f-1]._data;y[S]&&(this._disposeMaterials([y[S].babylonMaterial]),delete y[S])}return O}));this._materialPromiseLODs[f]=this._materialPromiseLODs[f]||[],0===f?h=b:(this._materialIndexLOD=null,this._materialPromiseLODs[f].push(b))}return this._loader.logClose(),h}))}_loadUriAsync(O,f,y){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const H=this._nodeIndexLOD-1;return this._nodeSignalLODs[H]=this._nodeSignalLODs[H]||new S,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((()=>this._loader.loadUriAsync(O,f,y)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const H=this._materialIndexLOD-1;return this._materialSignalLODs[H]=this._materialSignalLODs[H]||new S,this._materialSignalLODs[H].promise.then((()=>this._loader.loadUriAsync(O,f,y)))}return null}loadBufferAsync(O,f,y,H){if(this._loader.parent.useRangeRequests&&!f.uri){if(!this._loader.bin)throw new Error(`${O}: Uri is missing or the binary glTF is missing its binary chunk`);const f=(O,f)=>{const b=y,h=b+H-1;let v=O[f];return v?(v.start=Math.min(v.start,b),v.end=Math.max(v.end,h)):(v={start:b,end:h,loaded:new S},O[f]=v),v.loaded.promise.then((O=>new Uint8Array(O.buffer,O.byteOffset+y-v.start,H)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?f(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?f(this._materialBufferLODs,this._materialIndexLOD):f(this._bufferLODs,0)}return null}_loadBufferLOD(O,f){const y=O[f];y&&(this._loader.log(`Loading buffer range [${y.start}-${y.end}]`),this._loader.bin.readAsync(y.start,y.end-y.start+1).then((O=>{y.loaded.resolve(O)}),(O=>{y.loaded.reject(O)})))}_getLODs(O,f,y,S){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const H=[];for(let b=S.length-1;b>=0;b--)if(H.push(Q.Get(`${O}/ids/${S[b]}`,y,S[b])),H.length===this.maxLODsToLoad)return H;return H.push(f),H}_disposeTransformNode(O){const f=[],y=O.material;y&&f.push(y);for(const H of O.getChildMeshes())H.material&&f.push(H.material);O.dispose();const S=f.filter((O=>this._loader.babylonScene.meshes.every((f=>f.material!=O))));this._disposeMaterials(S)}_disposeMaterials(O){const f={};for(const y of O){for(const O of y.getActiveTextures())f[O.uniqueId]=O;y.dispose()}for(const y in f)for(const O of this._loader.babylonScene.materials)O.hasTexture(f[y])&&delete f[y];for(const y in f)f[y].dispose()}}K(Yf),e(Yf,!0,(O=>new Zf(O)));const af="MSFT_minecraftMesh";class Mf{constructor(O){this.name=af,this._loader=O,this.enabled=this._loader.isExtensionUsed(af)}dispose(){this._loader=null}loadMaterialPropertiesAsync(O,f,y){return C.LoadExtraAsync(O,f,this.name,((S,H)=>{if(H){if(!(y instanceof x))throw new Error(`${S}: Material type not supported`);const H=this._loader.loadMaterialPropertiesAsync(O,f,y);return y.needAlphaBlending()&&(y.forceDepthWrite=!0,y.separateCullingPass=!0),y.Wg=y.forceDepthWrite,y.twoSidedLighting=!0,H}return null}))}}K(af),e(af,!0,(O=>new Mf(O)));const Pf="MSFT_sRGBFactors";class ef{constructor(O){this.name=Pf,this._loader=O,this.enabled=this._loader.isExtensionUsed(Pf)}dispose(){this._loader=null}loadMaterialPropertiesAsync(O,f,y){return C.LoadExtraAsync(O,f,this.name,((S,H)=>{if(H){if(!(y instanceof x))throw new Error(`${S}: Material type not supported`);const H=this._loader.loadMaterialPropertiesAsync(O,f,y),b=y.va().getEngine().useExactSrgbConversions;return y.albedoTexture||y.albedoColor.toLinearSpaceToRef(y.albedoColor,b),y.reflectivityTexture||y.reflectivityColor.toLinearSpaceToRef(y.reflectivityColor,b),H}return null}))}}K(Pf),e(Pf,!0,(O=>new ef(O)));var Kf,Tf=y(11158);!function(O){O[O.Input=0]="Input",O[O.Output=1]="Output"}(Kf||(Kf={}));class Qf{constructor(O,f,y){this._ownerBlock=y,this._connectedPoint=[],this.uniqueId=(0,Tf.d)(),this.connectedPointIds=[],this.name=O,this._connectionType=f}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(O){if(this._connectionType===O._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||O._isSingularConnection()&&O._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(O),O._connectedPoint.push(this)}serialize(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};O.uniqueId=this.uniqueId,O.name=this.name,O._connectionType=this._connectionType,O.connectedPointIds=[],O.className=this.getClassName();for(const f of this._connectedPoint)O.connectedPointIds.push(f.uniqueId)}getClassName(){return"FGConnection"}deserialize(O){this.uniqueId=O.uniqueId,this.name=O.name,this._connectionType=O._connectionType,this.connectedPointIds=O.connectedPointIds}static Parse(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},f=arguments.length>1?arguments[1]:void 0;const y=new(h.d.Instantiate(O.className))(O.name,O._connectionType,f);return y.deserialize(O),y}}class Cf{constructor(O){this.value=this._toInt(O)}_toInt(O){return 0|O}add(O){return new Cf(this.value+O.value)}xc(O){return new Cf(this.value-O.value)}multiply(O){return new Cf(Math.imul(this.value,O.value))}divide(O){return new Cf(this.value/O.value)}getClassName(){return Cf.ClassName}equals(O){return this.value===O.value}static Parse(O){return new Cf(O.value)}}Cf.ClassName="FlowGraphInteger",(0,U.g)("FlowGraphInteger",Cf);class rf{constructor(O,f){this.typeName=O,this.defaultValue=f}serialize(O){O.typeName=this.typeName,O.defaultValue=this.defaultValue}static Parse(O){return new rf(O.typeName,O.defaultValue)}}const nf=new rf("any",void 0),Oy=(new rf("string",""),new rf("number",0)),fy=new rf("boolean",!1),yy=new rf("Vector2",H.i.Zero()),Sy=new rf("fb",H.m.Zero()),Hy=(new rf("Vector4",H.q.Zero()),new rf("Matrix",H.b.Identity())),by=(new rf("gb",b.d.Black()),new rf("rb",new b.g(0,0,0,0)),new rf("Quaternion",H.c.Identity()),new rf("FlowGraphInteger",new Cf(0)));class hy extends Qf{constructor(O,f,y,S){super(O,f,y),this.richType=S}_isSingularConnection(){return 0===this.connectionType}setValue(O,f){f._setConnectionValue(this,O)}connectTo(O){super.connectTo(O)}_getValueOrDefault(O){return O._hasConnectionValue(this)?O._getConnectionValue(this):this.richType.defaultValue}getValue(O){return 1===this.connectionType?(O._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(O),this._getValueOrDefault(O)):this.isConnected()?this._connectedPoint[0].getValue(O):this._getValueOrDefault(O)}getClassName(){return"FGDataConnection"}serialize(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(O),O.richType={},this.richType.serialize(O.richType)}static Parse(O,f){const y=Qf.Parse(O,f);return y.richType=rf.Parse(O.richType),y}}function vy(O){return"Mesh"===O||"AbstractMesh"===O||"GroundMesh"===O||"InstanceMesh"===O||"LinesMesh"===O||"GoldbergMesh"===O||"GreasedLineMesh"===O||"TrailMesh"===O}function Ny(O){return"Vector2"===O||"fb"===O||"Vector4"===O||"Quaternion"===O||"gb"===O||"rb"===O}function my(O,f,y){var S;const H=(null===f||void 0===f||null===(S=f.getClassName)||void 0===S?void 0:S.call(f))??"";vy(H)?y[O]={name:f.name,className:H}:Ny(H)?y[O]={value:f.gj(),className:H}:y[O]=f}function ty(O,f,y){const S=f[O];let h;const v=null===S||void 0===S?void 0:S.className;return h=vy(v)?y.getMeshByName(S.name):Ny(v)?function(O,f){if("Vector2"===O)return H.i.Ng(f);if("fb"===O)return H.m.Ng(f);if("Vector4"===O)return H.q.Ng(f);if("Quaternion"===O)return H.c.Ng(f);if("gb"===O)return new b.d(f[0],f[1],f[2]);if("rb"===O)return new b.g(f[0],f[1],f[2],f[3]);throw new Error(`Unknown vector class name ${O}`)}(v,S.value):"Matrix"===v?H.b.Ng(S.value):v===Cf.ClassName?Cf.Parse(S):S&&void 0!==S.value?S.value:S,h}(0,U.g)("FGDataConnection",hy);class qy{constructor(O){var f;this.config=O,this.uniqueId=(0,Tf.d)(),this.name=(null===(f=this.config)||void 0===f?void 0:f.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(O){}registerDataInput(O,f){const y=new hy(O,0,this,f);return this.dataInputs.push(y),y}registerDataOutput(O,f){const y=new hy(O,1,this,f);return this.dataOutputs.push(y),y}getDataInput(O){return this.dataInputs.find((f=>f.name===O))}getDataOutput(O){return this.dataOutputs.find((f=>f.name===O))}serialize(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};O.uniqueId=this.uniqueId,O.config={},this.config&&(O.config.name=this.config.name),O.dataInputs=[],O.dataOutputs=[],O.className=this.getClassName();for(const f of this.dataInputs){const y={};f.serialize(y),O.dataInputs.push(y)}for(const f of this.dataOutputs){const y={};f.serialize(y),O.dataOutputs.push(y)}}getClassName(){return"FGBlock"}static Parse(O,f){const y=h.d.Instantiate(O.className),S={},H=f.valueParseFunction??ty;if(O.config)for(const h in O.config)S[h]=H(h,O.config,f.yd);var b;("FGSetPropertyBlock"===(b=O.className)||"FGGetPropertyBlock"===b||"FGPlayAnimationBlock"===b||"FGMeshPickEventBlock"===b)&&(S.pathConverter=f.pathConverter);const v=new y(S);v.uniqueId=O.uniqueId;for(let h=0;h<O.dataInputs.length;h++){const f=v.getDataInput(O.dataInputs[h].name);if(!f)throw new Error("Could not find data input with name "+O.dataInputs[h].name+" in block "+O.className);f.deserialize(O.dataInputs[h])}for(let h=0;h<O.dataOutputs.length;h++){const f=v.getDataOutput(O.dataOutputs[h].name);if(!f)throw new Error("Could not find data output with name "+O.dataOutputs[h].name+" in block "+O.className);f.deserialize(O.dataOutputs[h])}return v.metadata=O.metadata,v.deserialize&&v.deserialize(O),v}}class Fy extends Qf{_isSingularConnection(){return 1===this.connectionType}_activateSignal(O){var f;0===this.connectionType?(O._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(O,this),O._increaseExecutionId()):null===(f=this._connectedPoint[0])||void 0===f||f._activateSignal(O)}}(0,U.g)("FlowGraphSignalConnection",Fy);class Iy extends qy{constructor(O){super(O),this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in")}_registerSignalInput(O){const f=new Fy(O,0,this);return this.signalInputs.push(f),f}_registerSignalOutput(O){const f=new Fy(O,1,this);return this.signalOutputs.push(f),f}getSignalInput(O){return this.signalInputs.find((f=>f.name===O))}getSignalOutput(O){return this.signalOutputs.find((f=>f.name===O))}serialize(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(O),O.signalInputs=[],O.signalOutputs=[];for(const f of this.signalInputs){const y={};f.serialize(y),O.signalInputs.push(y)}for(const f of this.signalOutputs){const y={};f.serialize(y),O.signalOutputs.push(y)}}deserialize(O){for(let f=0;f<O.signalInputs.length;f++){const y=this.getSignalInput(O.signalInputs[f].name);if(!y)throw new Error("Could not find signal input with name "+O.signalInputs[f].name+" in block "+O.className);y.deserialize(O.signalInputs[f])}for(let f=0;f<O.signalOutputs.length;f++){const y=this.getSignalOutput(O.signalOutputs[f].name);if(!y)throw new Error("Could not find signal output with name "+O.signalOutputs[f].name+" in block "+O.className);y.deserialize(O.signalOutputs[f])}}getClassName(){return"FGExecutionBlock"}}class Ay extends Iy{constructor(O){super(O),this.out=this._registerSignalOutput("out"),this.done=this._registerSignalOutput("done")}_startPendingTasks(O){this._preparePendingTasks(O),O._addPendingBlock(this)}}class Jy extends Ay{_execute(O){O._notifyExecuteNode(this),this.out._activateSignal(O)}}class Xy{constructor(O){this.uniqueId=(0,Tf.d)(),this._userVariables={},this._executionVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new t.d,this._configuration=O}hasVariable(O){return O in this._userVariables}setVariable(O,f){this._userVariables[O]=f}getVariable(O){return this._userVariables[O]}get userVariables(){return this._userVariables}_getUniqueIdPrefixedName(O,f){return`${O.uniqueId}_${f}`}_setExecutionVariable(O,f,y){this._executionVariables[this._getUniqueIdPrefixedName(O,f)]=y}_getExecutionVariable(O,f,y){return this._hasExecutionVariable(O,f)?this._executionVariables[this._getUniqueIdPrefixedName(O,f)]:y}_deleteExecutionVariable(O,f){delete this._executionVariables[this._getUniqueIdPrefixedName(O,f)]}_hasExecutionVariable(O,f){return this._getUniqueIdPrefixedName(O,f)in this._executionVariables}_hasConnectionValue(O){return O.uniqueId in this._connectionValues}_setConnectionValue(O,f){this._connectionValues[O.uniqueId]=f}_getConnectionValue(O){return this._connectionValues[O.uniqueId]}get configuration(){return this._configuration}_addPendingBlock(O){this._pendingBlocks.push(O)}_removePendingBlock(O){const f=this._pendingBlocks.indexOf(O);-1!==f&&this._pendingBlocks.splice(f,1)}_clearPendingBlocks(){for(const O of this._pendingBlocks)O._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(O){this.onNodeExecutedObservable.notifyObservers(O)}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:my;O.uniqueId=this.uniqueId,O._userVariables={};for(const y in this._userVariables)f(y,this._userVariables[y],O._userVariables);O._connectionValues={};for(const y in this._connectionValues)f(y,this._connectionValues[y],O._connectionValues)}getClassName(){return"FGContext"}static Parse(O,f){const y=f.graph.createContext(),S=f.valueParseFunction??ty;y.uniqueId=O.uniqueId;for(const H in O._userVariables){const f=S(H,O._userVariables,y._configuration.yd);y._userVariables[H]=f}for(const H in O._connectionValues){const f=S(H,O._connectionValues,y._configuration.yd);y._connectionValues[H]=f}return y}}(0,j.b)([(0,u.L)()],Xy.prototype,"uniqueId",void 0);var wy,By,jy=y(11406);function uy(O,f){return!(!O.parent||O.parent!==f&&!uy(O.parent,f))}class Ly extends Jy{constructor(O){super(O),this.config=O}_getReferencedMesh(){const O=this.config.pathConverter.convert(this.config.path),f=O.info.getObject(O.object);if(!f||!(f instanceof D.c))throw new Error("Mesh pick event block requires a valid mesh");return f}_preparePendingTasks(O){let f=O._getExecutionVariable(this,"meshPickObserver");if(!f){const y=this._getReferencedMesh();O._setExecutionVariable(this,"mesh",y),f=y.va().onPointerObservable.add((f=>{var S,H,b;f.type===jy.b.POINTERPICK&&null!==(S=f.pickInfo)&&void 0!==S&&S.pickedMesh&&((null===(H=f.pickInfo)||void 0===H?void 0:H.pickedMesh)===y||uy(null===(b=f.pickInfo)||void 0===b?void 0:b.pickedMesh,y))&&this._execute(O)}));const S=y.hj.add((()=>this._onDispose));O._setExecutionVariable(this,"meshPickObserver",f),O._setExecutionVariable(this,"meshDisposeObserver",S)}}_onDispose(O){this._cancelPendingTasks(O),O._removePendingBlock(this)}_cancelPendingTasks(O){const f=O._getExecutionVariable(this,"mesh"),y=O._getExecutionVariable(this,"meshPickObserver"),S=O._getExecutionVariable(this,"meshDisposeObserver");f.va().onPointerObservable.remove(y),f.hj.remove(S),O._deleteExecutionVariable(this,"mesh"),O._deleteExecutionVariable(this,"meshPickObserver"),O._deleteExecutionVariable(this,"meshDisposeObserver")}getClassName(){return Ly.ClassName}serialize(O){super.serialize(O),O.config.path=this.config.path}}Ly.ClassName="FGMeshPickEventBlock",(0,U.g)(Ly.ClassName,Ly),function(O){O[O.Stopped=0]="Stopped",O[O.Started=1]="Started"}(wy||(wy={}));class py{constructor(O){this._eventBlocks=[],this._executionContexts=[],this.state=0,this._scene=O.yd,this._coordinator=O.coordinator,this._sceneDisposeObserver=this._scene.hj.add((()=>this.dispose()))}createContext(){const O=new Xy({yd:this._scene,coordinator:this._coordinator});return this._executionContexts.push(O),O}getContext(O){return this._executionContexts[O]}addEventBlock(O){this._eventBlocks.push(O)}start(){if(1!==this.state){this.state=1,0===this._executionContexts.length&&this.createContext();for(const O of this._executionContexts){const f=this._getContextualOrder();for(const y of f)y._startPendingTasks(O)}}}_getContextualOrder(){const O=[];for(const f of this._eventBlocks)if(f.getClassName()===Ly.ClassName){const y=f._getReferencedMesh();let S=0;for(;S<O.length;S++){const f=O[S]._getReferencedMesh();if(y&&f&&uy(y,f))break}O.splice(S,0,f)}else O.push(f);return O}dispose(){if(0!==this.state){this.state=0;for(const O of this._executionContexts)O._clearPendingBlocks();this._executionContexts.length=0,this._eventBlocks.length=0,this._scene.hj.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null}}visitAllBlocks(O){const f=[],y=new Set;for(const S of this._eventBlocks)f.push(S),y.add(S.uniqueId);for(;f.length>0;){const S=f.pop();O(S);for(const O of S.dataInputs)for(const S of O._connectedPoint)y.has(S._ownerBlock.uniqueId)||(f.push(S._ownerBlock),y.add(S._ownerBlock.uniqueId));if(S instanceof Iy)for(const O of S.signalOutputs)for(const S of O._connectedPoint)y.has(S._ownerBlock.uniqueId)||(f.push(S._ownerBlock),y.add(S._ownerBlock.uniqueId))}}serialize(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},f=arguments.length>1?arguments[1]:void 0;O.allBlocks=[],this.visitAllBlocks((f=>{const y={};f.serialize(y),O.allBlocks.push(y)})),O.executionContexts=[];for(const y of this._executionContexts){const S={};y.serialize(S,f),O.executionContexts.push(S)}}static GetDataOutConnectionByUniqueId(O,f){for(const y of O)for(const O of y.dataOutputs)if(O.uniqueId===f)return O;throw new Error("Could not find data out connection with unique id "+f)}static GetSignalInConnectionByUniqueId(O,f){for(const y of O)if(y instanceof Iy)for(const O of y.signalInputs)if(O.uniqueId===f)return O;throw new Error("Could not find signal in connection with unique id "+f)}static Parse(O,f){const y=f.coordinator.createGraph(),S=[],H=f.valueParseFunction??ty;for(const b of O.allBlocks){const O=qy.Parse(b,{yd:f.coordinator.config.yd,pathConverter:f.pathConverter,valueParseFunction:H});S.push(O),O instanceof Jy&&y.addEventBlock(O)}for(const b of S){for(const O of b.dataInputs)for(const f of O.connectedPointIds){const y=py.GetDataOutConnectionByUniqueId(S,f);O.connectTo(y)}if(b instanceof Iy)for(const O of b.signalOutputs)for(const f of O.connectedPointIds){const y=py.GetSignalInConnectionByUniqueId(S,f);O.connectTo(y)}}for(const b of O.executionContexts)Xy.Parse(b,{graph:y,valueParseFunction:H});return y}}class Uy{constructor(O){this.config=O,this._flowGraphs=[],this._customEventsMap=new Map,this.config.yd.hj.add((()=>{this.dispose()}));(Uy.SceneCoordinators.get(this.config.yd)??[]).push(this)}createGraph(){const O=new py({yd:this.config.yd,coordinator:this});return this._flowGraphs.push(O),O}removeGraph(O){const f=this._flowGraphs.indexOf(O);-1!==f&&(O.dispose(),this._flowGraphs.splice(f,1))}start(){this._flowGraphs.forEach((O=>O.start()))}dispose(){this._flowGraphs.forEach((O=>O.dispose())),this._flowGraphs.length=0;const O=Uy.SceneCoordinators.get(this.config.yd)??[],f=O.indexOf(this);-1!==f&&O.splice(f,1)}serialize(O,f){O._flowGraphs=[],this._flowGraphs.forEach((y=>{const S={};y.serialize(S,f),O._flowGraphs.push(S)}))}static Parse(O,f){var y;const S=f.valueParseFunction??ty,H=new Uy({yd:f.yd});return null===(y=O._flowGraphs)||void 0===y||y.forEach((O=>{py.Parse(O,{coordinator:H,valueParseFunction:S,pathConverter:f.pathConverter})})),H}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(O){let f=this._customEventsMap.get(O);return f||(f=new t.d,this._customEventsMap.set(O,f)),f}notifyCustomEvent(O,f){const y=this._customEventsMap.get(O);y&&y.notifyObservers(f)}}Uy.SceneCoordinators=new Map;class ly extends Jy{_preparePendingTasks(O){if(!O._getExecutionVariable(this,"sceneReadyObserver")){const f=O.configuration.yd.onReadyObservable.add((()=>{this._execute(O)}));O._setExecutionVariable(this,"sceneReadyObserver",f)}}_cancelPendingTasks(O){const f=O._getExecutionVariable(this,"sceneReadyObserver");O.configuration.yd.onReadyObservable.remove(f),O._deleteExecutionVariable(this,"sceneReadyObserver")}getClassName(){return ly.ClassName}}ly.ClassName="FGSceneReadyEventBlock",(0,U.g)("FGSceneReadyEventBlock",ly);class xy extends Jy{_preparePendingTasks(O){if(!O._getExecutionVariable(this,"sceneBeforeRender")){const f=O.configuration.yd.onBeforeRenderObservable.add((()=>{this._execute(O)}));O._setExecutionVariable(this,"sceneBeforeRender",f)}}_cancelPendingTasks(O){const f=O._getExecutionVariable(this,"sceneBeforeRender");O.configuration.yd.onBeforeRenderObservable.remove(f),O._deleteExecutionVariable(this,"sceneBeforeRender")}getClassName(){return xy.ClassName}}xy.ClassName="FGSceneTickEventBlock",(0,U.g)(xy.ClassName,xy);class Wy extends Iy{constructor(O){super(O),this.out=this._registerSignalOutput("out")}}class Ey extends Wy{constructor(O){super(O),this.message=this.registerDataInput("message",nf)}_execute(O){const f=this.message.getValue(O);J.e.Log(f),this.out._activateSignal(O)}getClassName(){return Ey.ClassName}}Ey.ClassName="FGConsoleLogBlock",(0,U.g)(Ey.ClassName,Ey),function(O){O[O.INIT=0]="INIT",O[O.STARTED=1]="STARTED",O[O.ENDED=2]="ENDED"}(By||(By={}));class oy{constructor(O){this.onEachCountObservable=new t.d,this.onTimerAbortedObservable=new t.d,this.onTimerEndedObservable=new t.d,this.onStateChangedObservable=new t.d,this._observer=null,this._breakOnNextTick=!1,this._tick=O=>{const f=Date.now();this._timer=f-this._startTime;const y={startTime:this._startTime,currentTime:f,deltaTime:this._timer,completeRate:this._timer/this._timeToEnd,payload:O},S=this._breakOnNextTick||this._breakCondition(y);S||this._timer>=this._timeToEnd?this._stop(y,S):this.onEachCountObservable.notifyObservers(y)},this._setState(0),this._contextObservable=O.contextObservable,this._observableParameters=O.observableParameters??{},this._breakCondition=O.breakCondition??(()=>!1),this._timeToEnd=O.timeout,O.onEnded&&this.onTimerEndedObservable.add(O.onEnded),O.ai&&this.onEachCountObservable.add(O.ai),O.onAborted&&this.onTimerAbortedObservable.add(O.onAborted)}set breakCondition(O){this._breakCondition=O}clearObservables(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()}start(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._timeToEnd;if(1===this._state)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=O,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(1)}stop(){1===this._state&&(this._breakOnNextTick=!0)}dispose(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()}_setState(O){this._state=O,this.onStateChangedObservable.notifyObservers(this._state)}_stop(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._contextObservable.remove(this._observer),this._setState(2),f?this.onTimerAbortedObservable.notifyObservers(O):this.onTimerEndedObservable.notifyObservers(O)}}class iy extends Ay{constructor(O){super(O),this.timeout=this.registerDataInput("timeout",Oy)}_preparePendingTasks(O){const f=this.timeout.getValue(O);if(void 0!==f&&f>=0){const y=O._getExecutionVariable(this,"runningTimers")||[],S=O.configuration.yd,H=new oy({timeout:f,contextObservable:S.onBeforeRenderObservable,onEnded:()=>this._onEnded(H,O)});H.start(),y.push(H),O._setExecutionVariable(this,"runningTimers",y)}}_execute(O){this._startPendingTasks(O),this.out._activateSignal(O)}_onEnded(O,f){const y=f._getExecutionVariable(this,"runningTimers")||[],S=y.indexOf(O);-1!==S?y.splice(S,1):h.d.Warn("FlowGraphTimerBlock: Timer ended but was not found in the running timers list"),f._removePendingBlock(this),this.done._activateSignal(f)}_cancelPendingTasks(O){const f=O._getExecutionVariable(this,"runningTimers")||[];for(const y of f)y.dispose();O._deleteExecutionVariable(this,"runningTimers")}getClassName(){return iy.ClassName}}iy.ClassName="FGTimerBlock",(0,U.g)("FGTimerBlock",iy);class Dy extends Wy{constructor(O){super(O),this.config=O;for(let f=0;f<this.config.eventData.length;f++){const O=this.config.eventData[f];this.registerDataInput(O,nf)}}_execute(O){const f=this.config.eventId,y=this.dataInputs.map((f=>f.getValue(O)));O.configuration.coordinator.notifyCustomEvent(f,y),this.out._activateSignal(O)}getClassName(){return Dy.ClassName}}Dy.ClassName="FGSendCustomEventBlock",(0,U.g)("FGSendCustomEventBlock",Dy);class Vy extends Jy{constructor(O){super(O),this.config=O;for(let f=0;f<this.config.eventData.length;f++){const O=this.config.eventData[f];this.registerDataOutput(O,nf)}}_preparePendingTasks(O){const f=O.configuration.coordinator.getCustomEventObservable(this.config.eventId);this._eventObserver=f.add((f=>{for(let y=0;y<f.length;y++)this.dataOutputs[y].setValue(f[y],O);this._execute(O)}))}_cancelPendingTasks(O){const f=O.configuration.coordinator.getCustomEventObservable(this.config.eventId);f?f.remove(this._eventObserver):h.d.Warn(`FlowGraphReceiveCustomEventBlock: Missing observable for event ${this.config.eventId}`)}getClassName(){return Vy.ClassName}serialize(O){super.serialize(O),O.eventId=this.config.eventId,O.eventData=this.config.eventData}}Vy.ClassName="FGReceiveCustomEventBlock",(0,U.g)(Vy.ClassName,Vy);class gy extends Iy{constructor(O){super(O),this.config=O,this.outFlows=[];for(let f=0;f<this.config.numberOutputFlows;f++)this.outFlows.push(this._registerSignalOutput(`${f}`))}_execute(O){for(let f=0;f<this.config.numberOutputFlows;f++)this.outFlows[f]._activateSignal(O)}getClassName(){return gy.ClassName}}gy.ClassName="FGSequenceBlock",(0,U.g)(gy.ClassName,gy);const Ry=new RegExp(/\{(\w+)\}/g);class sy{constructor(O,f){this.path=O,this.ownerBlock=f,this.templatedInputs=[];let y=Ry.exec(O);for(;y;){const[,S]=y;this.templatedInputs.push(f.registerDataInput(S,by)),y=Ry.exec(O)}}getAccessor(O,f){let y=this.path;for(const S of this.templatedInputs){const O=S.getValue(f).value;y=y.replace(`{${S.name}}`,O.toString())}return O.convert(y)}}class ky extends qy{constructor(O){super(O),this.config=O,this.value=this.registerDataOutput("value",nf),this.templateComponent=new sy(O.path,this)}_updateOutputs(O){const f=this.templateComponent.getAccessor(this.config.pathConverter,O),y=f.info.get(f.object);this.value.setValue(y,O)}getClassName(){return ky.ClassName}serialize(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(O),O.config.path=this.config.path}}ky.ClassName="FGGetPropertyBlock",(0,U.g)(ky.ClassName,ky);class zy extends Wy{constructor(O){super(O),this.config=O,this.a=this.registerDataInput("a",nf),this.templateComponent=new sy(O.path,this)}_execute(O){const f=this.a.getValue(O),y=this.templateComponent.getAccessor(this.config.pathConverter,O);y.info.set(f,y.object),this.out._activateSignal(O)}serialize(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(O),O.config.path=this.config.path}getClassName(){return zy.ClassName}}zy.ClassName="FGSetPropertyBlock",(0,U.g)("FGSetPropertyBlock",zy);const cy="cachedOperationValue",dy="cachedExecutionId";class Gy extends qy{constructor(O,f){super(f),this.value=this.registerDataOutput("value",O)}_updateOutputs(O){const f=O._getExecutionVariable(this,dy),y=O._getExecutionVariable(this,cy);if(void 0!==y&&f===O.executionId)this.value.setValue(y,O);else{const f=this._doOperation(O);O._setExecutionVariable(this,cy,f),O._setExecutionVariable(this,dy,O.executionId),this.value.setValue(f,O)}}}class Yy extends Gy{constructor(O,f,y,S,H,b){super(y,b),this._operation=S,this._className=H,this.a=this.registerDataInput("a",O),this.b=this.registerDataInput("b",f)}_doOperation(O){return this._operation(this.a.getValue(O),this.b.getValue(O))}getClassName(){return this._className}}class Zy extends Gy{constructor(O,f,y,S){super(O,S),this._operation=f,this._className=y}_doOperation(O){return this._operation()}getClassName(){return this._className}}class ay extends Gy{constructor(O,f,y,S,H){super(f,H),this._operation=y,this._className=S,this.a=this.registerDataInput("a",O)}_doOperation(O){return this._operation(this.a.getValue(O))}getClassName(){return this._className}}class My extends Gy{constructor(O,f,y,S,H,b,h){super(S,h),this._operation=H,this._className=b,this.a=this.registerDataInput("a",O),this.b=this.registerDataInput("b",f),this.c=this.registerDataInput("c",y)}_doOperation(O){return this._operation(this.a.getValue(O),this.b.getValue(O),this.c.getValue(O))}getClassName(){return this._className}}function Py(O){return O.getClassName?O.getClassName():""}function ey(O,f){return"Vector2"===O&&"Vector2"===f||"fb"===O&&"fb"===f||"Vector4"===O&&"Vector4"===f}function Ky(O,f){return"Matrix"===O&&"Matrix"===f}function Ty(O,f){return"FlowGraphInteger"===O&&"FlowGraphInteger"===f}class Qy extends Yy{constructor(O){super(nf,nf,nf,((O,f)=>this._polymorphicAdd(O,f)),Qy.ClassName,O)}_polymorphicAdd(O,f){const y=Py(O),S=Py(f);return ey(y,S)||Ky(y,S)||Ty(y,S)?O.add(f):O+f}}Qy.ClassName="FGAddBlock",(0,U.g)(Qy.ClassName,Qy);class Cy extends Yy{constructor(O){super(nf,nf,nf,((O,f)=>this._polymorphicAdd(O,f)),Cy.ClassName,O)}_polymorphicAdd(O,f){const y=Py(O),S=Py(f);return ey(y,S)||Ty(y,S)?O.xc(f):Ky(y,S)?O.add(f.scale(-1)):O-f}}Cy.ClassName="FGSubBlock",(0,U.g)(Cy.ClassName,Cy);class ry extends Yy{constructor(O){super(nf,nf,nf,((O,f)=>this._polymorphicMultiply(O,f)),ry.ClassName,O)}_polymorphicMultiply(O,f){const y=Py(O),S=Py(f);return ey(y,S)||Ty(y,S)?O.multiply(f):Ky(y,S)?H.b.FromValues(O.m[0]*f.m[0],O.m[4]*f.m[4],O.m[8]*f.m[8],O.m[12]*f.m[12],O.m[1]*f.m[1],O.m[5]*f.m[5],O.m[9]*f.m[9],O.m[13]*f.m[13],O.m[2]*f.m[2],O.m[6]*f.m[6],O.m[10]*f.m[10],O.m[14]*f.m[14],O.m[3]*f.m[3],O.m[7]*f.m[7],O.m[11]*f.m[11],O.m[15]*f.m[15]):O*f}}ry.ClassName="FGMultiplyBlock",(0,U.g)(ry.ClassName,ry);class ny extends Yy{constructor(O){super(nf,nf,nf,((O,f)=>this._polymorphicDivide(O,f)),ny.ClassName,O)}_polymorphicDivide(O,f){const y=Py(O),S=Py(f);return ey(y,S)||Ty(y,S)?O.divide(f):Ky(y,S)?H.b.FromValues(O.m[0]/f.m[0],O.m[4]/f.m[4],O.m[8]/f.m[8],O.m[12]/f.m[12],O.m[1]/f.m[1],O.m[5]/f.m[5],O.m[9]/f.m[9],O.m[13]/f.m[13],O.m[2]/f.m[2],O.m[6]/f.m[6],O.m[10]/f.m[10],O.m[14]/f.m[14],O.m[3]/f.m[3],O.m[7]/f.m[7],O.m[11]/f.m[11],O.m[15]/f.m[15]):O/f}}ny.ClassName="FGDivideBlock",(0,U.g)(ny.ClassName,ny);class OS extends Zy{constructor(O){super(Oy,(()=>Math.random()),OS.ClassName,O)}}OS.ClassName="FGRandomBlock",(0,U.g)(OS.ClassName,OS);class fS extends Yy{constructor(O){super(nf,nf,Oy,((O,f)=>this._polymorphicDot(O,f)),fS.ClassName,O)}_polymorphicDot(O,f){switch(Py(O)){case"Vector2":return H.i.Dot(O,f);case"fb":return H.m.Dot(O,f);case"Vector4":return H.q.Dot(O,f);default:throw new Error(`Cannot get dot product of ${O} and ${f}`)}}}fS.ClassName="FGDotBlock",(0,U.g)(fS.ClassName,fS);class yS extends Zy{constructor(O){super(Oy,(()=>Math.E),yS.ClassName,O)}}yS.ClassName="FGEBlock",(0,U.g)(yS.ClassName,yS);class SS extends Zy{constructor(O){super(Oy,(()=>Math.PI),SS.ClassName,O)}}SS.ClassName="FGPIBlock",(0,U.g)(SS.ClassName,SS);class HS extends Zy{constructor(O){super(Oy,(()=>Number.POSITIVE_INFINITY),HS.ClassName,O)}}HS.ClassName="FGInfBlock",(0,U.g)(HS.ClassName,HS);class bS extends Zy{constructor(O){super(Oy,(()=>Number.NaN),bS.ClassName,O)}}function hS(O,f){switch(Py(O)){case"FlowGraphInteger":return new Cf(f(O.value));case"Vector2":return new H.i(f(O.x),f(O.y));case"fb":return new H.m(f(O.x),f(O.y),f(O.z));case"Vector4":return new H.q(f(O.x),f(O.y),f(O.z),f(O.w));case"Matrix":return H.b.FromValues(f(O.m[0]),f(O.m[4]),f(O.m[8]),f(O.m[12]),f(O.m[1]),f(O.m[5]),f(O.m[9]),f(O.m[13]),f(O.m[2]),f(O.m[6]),f(O.m[10]),f(O.m[14]),f(O.m[3]),f(O.m[7]),f(O.m[11]),f(O.m[15]));default:return f(O)}}bS.ClassName="FGNaNBlock",(0,U.g)(bS.ClassName,bS);class vS extends ay{constructor(O){super(nf,nf,(O=>this._polymorphicAbs(O)),vS.ClassName,O)}_polymorphicAbs(O){return hS(O,Math.abs)}}vS.ClassName="FGAbsBlock",(0,U.g)(vS.ClassName,vS);class NS extends ay{constructor(O){super(nf,nf,(O=>this._polymorphicSign(O)),NS.ClassName,O)}_polymorphicSign(O){return hS(O,Math.sign)}}NS.ClassName="FGSignBlock",(0,U.g)(NS.ClassName,NS);class mS extends ay{constructor(O){super(nf,nf,(O=>this._polymorphicTrunc(O)),mS.ClassName,O)}_polymorphicTrunc(O){return hS(O,Math.trunc)}}mS.ClassName="FGTruncBlock",(0,U.g)(mS.ClassName,mS);class tS extends ay{constructor(O){super(nf,nf,(O=>this._polymorphicFloor(O)),tS.ClassName,O)}_polymorphicFloor(O){return hS(O,Math.floor)}}tS.ClassName="FGFloorBlock",(0,U.g)(tS.ClassName,tS);class qS extends ay{constructor(O){super(nf,nf,(O=>this._polymorphicCeiling(O)),qS.ClassName,O)}_polymorphicCeiling(O){return hS(O,Math.ceil)}}qS.ClassName="FGCeilBlock",(0,U.g)(qS.ClassName,qS);class FS extends ay{constructor(O){super(nf,nf,(O=>this._polymorphicFract(O)),FS.ClassName,O)}_polymorphicFract(O){return hS(O,(O=>O-Math.floor(O)))}}FS.ClassName="FGFractBlock",(0,U.g)(FS.ClassName,FS);class IS extends ay{constructor(O){super(nf,nf,(O=>this._polymorphicNeg(O)),IS.ClassName,O)}_polymorphicNeg(O){return hS(O,(O=>-O))}}function AS(O,f,y){switch(Py(O)){case"FlowGraphInteger":return new Cf(y(O.value,f.value));case"Vector2":return new H.i(y(O.x,f.x),y(O.y,f.y));case"fb":return new H.m(y(O.x,f.x),y(O.y,f.y),y(O.z,f.z));case"Vector4":return new H.q(y(O.x,f.x),y(O.y,f.y),y(O.z,f.z),y(O.w,f.w));case"Matrix":return H.b.FromValues(y(O.m[0],f.m[0]),y(O.m[4],f.m[4]),y(O.m[8],f.m[8]),y(O.m[12],f.m[12]),y(O.m[1],f.m[1]),y(O.m[5],f.m[5]),y(O.m[9],f.m[9]),y(O.m[13],f.m[13]),y(O.m[2],f.m[2]),y(O.m[6],f.m[6]),y(O.m[10],f.m[10]),y(O.m[14],f.m[14]),y(O.m[3],f.m[3]),y(O.m[7],f.m[7]),y(O.m[11],f.m[11]),y(O.m[15],f.m[15]));default:return y(O,f)}}IS.ClassName="FGNegBlock",(0,U.g)(IS.ClassName,IS);class JS extends Yy{constructor(O){super(nf,nf,nf,((O,f)=>this._polymorphicRemainder(O,f)),JS.ClassName,O)}_polymorphicRemainder(O,f){return AS(O,f,((O,f)=>O%f))}}JS.ClassName="FGRemainderBlock",(0,U.g)(JS.ClassName,JS);class XS extends Yy{constructor(O){super(nf,nf,nf,((O,f)=>this._polymorphicMin(O,f)),XS.ClassName,O)}_polymorphicMin(O,f){return AS(O,f,Math.min)}}XS.ClassName="FGMinBlock",(0,U.g)(XS.ClassName,XS);class wS extends Yy{constructor(O){super(nf,nf,nf,((O,f)=>this._polymorphicMax(O,f)),wS.ClassName,O)}_polymorphicMax(O,f){return AS(O,f,Math.max)}}function BS(O,f,y){return Math.min(Math.max(O,Math.min(f,y)),Math.max(f,y))}function jS(O,f,y,S){switch(Py(O)){case"FlowGraphInteger":return new Cf(S(O.value,f.value,y.value));case"Vector2":return new H.i(S(O.x,f.x,y.x),S(O.y,f.y,y.y));case"fb":return new H.m(S(O.x,f.x,y.x),S(O.y,f.y,y.y),S(O.z,f.z,y.z));case"Vector4":return new H.q(S(O.x,f.x,y.x),S(O.y,f.y,y.y),S(O.z,f.z,y.z),S(O.w,f.w,y.w));case"Matrix":return H.b.FromValues(S(O.m[0],f.m[0],y.m[0]),S(O.m[4],f.m[4],y.m[4]),S(O.m[8],f.m[8],y.m[8]),S(O.m[12],f.m[12],y.m[12]),S(O.m[1],f.m[1],y.m[1]),S(O.m[5],f.m[5],y.m[5]),S(O.m[9],f.m[9],y.m[9]),S(O.m[13],f.m[13],y.m[13]),S(O.m[2],f.m[2],y.m[2]),S(O.m[6],f.m[6],y.m[6]),S(O.m[10],f.m[10],y.m[10]),S(O.m[14],f.m[14],y.m[14]),S(O.m[3],f.m[3],y.m[3]),S(O.m[7],f.m[7],y.m[7]),S(O.m[11],f.m[11],y.m[11]),S(O.m[15],f.m[15],y.m[15]));default:return S(O,f,y)}}wS.ClassName="FGMaxBlock",(0,U.g)(wS.ClassName,wS);class uS extends My{constructor(O){super(nf,nf,nf,nf,((O,f,y)=>this._polymorphicClamp(O,f,y)),uS.ClassName,O)}_polymorphicClamp(O,f,y){return jS(O,f,y,BS)}}function LS(O){return Math.min(Math.max(O,0),1)}uS.ClassName="FGClampBlock",(0,U.g)(uS.ClassName,uS);class pS extends ay{constructor(O){super(nf,nf,(O=>this._polymorphicSaturate(O)),pS.ClassName,O)}_polymorphicSaturate(O){return hS(O,LS)}}pS.ClassName="FGSaturateBlock",(0,U.g)(pS.ClassName,pS);class US extends My{constructor(O){super(nf,nf,nf,nf,((O,f,y)=>this._polymorphicInterpolate(O,f,y)),US.ClassName,O)}_interpolate(O,f,y){return(1-y)*O+y*f}_polymorphicInterpolate(O,f,y){return jS(O,f,y,this._interpolate)}}US.ClassName="FGInterpolateBlock",(0,U.g)(US.ClassName,US);class lS extends Yy{constructor(O){super(nf,nf,fy,((O,f)=>this._polymorphicEq(O,f)),lS.ClassName,O)}_polymorphicEq(O,f){const y=Py(O),S=Py(f);return ey(y,S)||Ky(y,S)||Ty(y,S)?O.equals(f):O===f}}function xS(O,f,y){const S=Py(O);if(S===Py(f)){if(""===S)return y(O,f);if("FlowGraphInteger"===S)return y(O.value,f.value);throw new Error(`Cannot compare ${O} and ${f}`)}throw new Error(`${O} and ${f} are of different types.`)}lS.ClassName="FGEqBlock",(0,U.g)(lS.ClassName,lS);class WS extends Yy{constructor(O){super(nf,nf,fy,((O,f)=>this._polymorphicLessThan(O,f)),WS.ClassName,O)}_polymorphicLessThan(O,f){return xS(O,f,((O,f)=>O<f))}}WS.ClassName="FGLessThanBlock",(0,U.g)(WS.ClassName,WS);class ES extends Yy{constructor(O){super(nf,nf,fy,((O,f)=>this._polymorphicLessThanOrEqual(O,f)),ES.ClassName,O)}_polymorphicLessThanOrEqual(O,f){return xS(O,f,((O,f)=>O<=f))}}ES.ClassName="FGLessThanOrEqualBlock";class oS extends Yy{constructor(O){super(nf,nf,fy,((O,f)=>this._polymorphicGreaterThan(O,f)),oS.ClassName,O)}_polymorphicGreaterThan(O,f){return xS(O,f,((O,f)=>O>f))}}oS.ClassName="FGGreaterThanBlock",(0,U.g)(oS.ClassName,oS);class iS extends Yy{constructor(O){super(nf,nf,fy,((O,f)=>this._polymorphicGreaterThanOrEqual(O,f)),iS.ClassName,O)}_polymorphicGreaterThanOrEqual(O,f){return xS(O,f,((O,f)=>O>=f))}}iS.ClassName="FGGreaterThanOrEqualBlock",(0,U.g)(iS.ClassName,iS);class DS extends ay{constructor(O){super(nf,fy,(O=>this._polymorphicIsNan(O)),DS.ClassName,O)}_polymorphicIsNan(O){const f=Py(O);if(""===f)return isNaN(O);if("FlowGraphInteger"===f)return isNaN(O.value);throw new Error(`Cannot get NaN of ${O}`)}}DS.ClassName="FGIsNanBlock",(0,U.g)(DS.ClassName,DS);class VS extends ay{constructor(O){super(nf,fy,(O=>this._polymorphicIsInf(O)),VS.ClassName,O)}_polymorphicIsInf(O){const f=Py(O);if(""===f)return!isFinite(O);if("FlowGraphInteger"===f)return!isFinite(O.value);throw new Error(`Cannot get isInf of ${O}`)}}VS.ClassName="FGIsInfBlock";class gS extends ay{constructor(O){super(nf,nf,(O=>this._polymorphicDegToRad(O)),gS.ClassName,O)}_degToRad(O){return O*Math.PI/180}_polymorphicDegToRad(O){return hS(O,this._degToRad)}}gS.ClassName="FGDegToRadBlock",(0,U.g)(gS.ClassName,gS);class RS extends ay{constructor(O){super(nf,nf,(O=>this._polymorphicRadToDeg(O)),RS.ClassName,O)}_radToDeg(O){return 180*O/Math.PI}_polymorphicRadToDeg(O){return hS(O,this._radToDeg)}}RS.ClassName="FGRadToDegBlock",(0,U.g)(RS.ClassName,RS);class sS extends ay{constructor(O){super(nf,nf,(O=>this._polymorphicSin(O)),sS.ClassName,O)}_polymorphicSin(O){return hS(O,Math.sin)}}sS.ClassName="FGSinBlock",(0,U.g)(sS.ClassName,sS);class kS extends ay{constructor(O){super(nf,nf,(O=>this._polymorphicCos(O)),kS.ClassName,O)}_polymorphicCos(O){return hS(O,Math.cos)}}kS.ClassName="FGCosBlock",(0,U.g)(kS.ClassName,kS);class zS extends ay{constructor(O){super(nf,nf,(O=>this._polymorphicTan(O)),zS.ClassName,O)}_polymorphicTan(O){return hS(O,Math.tan)}}zS.ClassName="FGTanBlock",(0,U.g)(zS.ClassName,zS);class cS extends ay{constructor(O){super(nf,nf,(O=>this._polymorphicAsin(O)),cS.ClassName,O)}_polymorphicAsin(O){return hS(O,Math.asin)}}cS.ClassName="FGAsinBlock",(0,U.g)(cS.ClassName,cS);class dS extends ay{constructor(O){super(nf,nf,(O=>this._polymorphicAcos(O)),dS.ClassName,O)}_polymorphicAcos(O){return hS(O,Math.acos)}}dS.ClassName="FGAcosBlock",(0,U.g)(dS.ClassName,dS);class GS extends ay{constructor(O){super(nf,nf,(O=>this._polymorphicAtan(O)),GS.ClassName,O)}_polymorphicAtan(O){return hS(O,Math.atan)}}GS.ClassName="FGAtanBlock",(0,U.g)(GS.ClassName,GS);class YS extends Yy{constructor(O){super(nf,nf,nf,((O,f)=>this._polymorphicAtan2(O,f)),YS.ClassName,O)}_polymorphicAtan2(O,f){return AS(O,f,Math.atan2)}}YS.ClassName="FGAtan2Block",(0,U.g)(YS.ClassName,YS);class ZS extends ay{constructor(O){super(nf,nf,(O=>this._polymorphicSinh(O)),ZS.ClassName,O)}_polymorphicSinh(O){return hS(O,Math.sinh)}}ZS.ClassName="FGSinhBlock",(0,U.g)(ZS.ClassName,ZS);class aS extends ay{constructor(O){super(nf,nf,(O=>this._polymorphicCosh(O)),aS.ClassName,O)}_polymorphicCosh(O){return hS(O,Math.cosh)}}aS.ClassName="FGCoshBlock",(0,U.g)(aS.ClassName,aS);class MS extends ay{constructor(O){super(nf,nf,(O=>this._polymorphicTanh(O)),MS.ClassName,O)}_polymorphicTanh(O){return hS(O,Math.tanh)}}MS.ClassName="FGTanhBlock",(0,U.g)(MS.ClassName,MS);class PS extends ay{constructor(O){super(nf,Oy,(O=>this._polymorphicAsinh(O)),PS.ClassName,O)}_polymorphicAsinh(O){return hS(O,Math.asinh)}}PS.ClassName="FGAsinhBlock",(0,U.g)(PS.ClassName,PS);class eS extends ay{constructor(O){super(nf,Oy,(O=>this._polymorphicAcosh(O)),eS.ClassName,O)}_polymorphicAcosh(O){return hS(O,Math.acosh)}}eS.ClassName="FGAcoshBlock",(0,U.g)(eS.ClassName,eS);class KS extends ay{constructor(O){super(nf,Oy,(O=>this._polymorphicAtanh(O)),KS.ClassName,O)}_polymorphicAtanh(O){return hS(O,Math.atanh)}}KS.ClassName="FGAtanhBlock",(0,U.g)(KS.ClassName,KS);class TS extends ay{constructor(O){super(nf,Oy,(O=>this._polymorphicExp(O)),TS.ClassName,O)}_polymorphicExp(O){return hS(O,Math.exp)}}TS.ClassName="FGExpBlock",(0,U.g)(TS.ClassName,TS);class QS extends ay{constructor(O){super(nf,Oy,(O=>this._polymorphicLog(O)),QS.ClassName,O)}_polymorphicLog(O){return hS(O,Math.log)}}QS.ClassName="FGLogBlock",(0,U.g)(QS.ClassName,QS);class CS extends ay{constructor(O){super(nf,Oy,(O=>this._polymorphicLog2(O)),CS.ClassName,O)}_polymorphicLog2(O){return hS(O,Math.log2)}}CS.ClassName="FGLog2Block",(0,U.g)(CS.ClassName,CS);class rS extends ay{constructor(O){super(nf,Oy,(O=>this._polymorphicLog10(O)),rS.ClassName,O)}_polymorphicLog10(O){return hS(O,Math.log10)}}rS.ClassName="FGLog10Block",(0,U.g)(rS.ClassName,rS);class nS extends ay{constructor(O){super(nf,Oy,(O=>this._polymorphicSqrt(O)),nS.ClassName,O)}_polymorphicSqrt(O){return hS(O,Math.sqrt)}}nS.ClassName="FGSqrtBlock",(0,U.g)(nS.ClassName,nS);class OH extends ay{constructor(O){super(nf,Oy,(O=>this._polymorphicCubeRoot(O)),OH.ClassName,O)}_polymorphicCubeRoot(O){return hS(O,Math.cbrt)}}OH.ClassName="FGCubeRootBlock",(0,U.g)(OH.ClassName,OH);class fH extends Yy{constructor(O){super(nf,Oy,Oy,((O,f)=>this._polymorphicPow(O,f)),fH.ClassName,O)}_polymorphicPow(O,f){return AS(O,f,Math.pow)}}fH.ClassName="FGPowBlock",(0,U.g)(fH.ClassName,fH);class yH extends ay{constructor(O){super(nf,Oy,(O=>this._polymorphicLength(O)),yH.ClassName,O)}_polymorphicLength(O){switch(Py(O)){case"Vector2":case"fb":case"Vector4":return O.length();default:throw new Error(`Cannot compute length of value ${O}`)}}}yH.ClassName="FGLengthBlock",(0,U.g)(yH.ClassName,yH);class SH extends ay{constructor(O){super(nf,nf,(O=>this._polymorphicNormalize(O)),SH.ClassName,O)}_polymorphicNormalize(O){switch(Py(O)){case"Vector2":case"fb":case"Vector4":return O.normalize();default:throw new Error(`Cannot normalize value ${O}`)}}}SH.ClassName="FGNormalizeBlock",(0,U.g)(SH.ClassName,SH);class HH extends Yy{constructor(O){super(Sy,Sy,Sy,((O,f)=>H.m.Cross(O,f)),HH.ClassName,O)}}HH.ClassName="FGCrossBlock",(0,U.g)(HH.ClassName,HH);class bH extends Yy{constructor(O){super(yy,Oy,yy,((O,f)=>H.i.Transform(O,H.b.RotationZ(f))),bH.ClassName,O)}}bH.ClassName="FGRotate2DBlock",(0,U.g)(bH.ClassName,bH);class hH extends My{constructor(O){super(Sy,Sy,Oy,Sy,((O,f,y)=>H.m.TransformCoordinates(O,H.b.RotationAxis(f,y))),hH.ClassName,O)}}hH.ClassName="FGRotate3DBlock",(0,U.g)(hH.ClassName,hH);class vH extends ay{constructor(O){super(Hy,Hy,(O=>H.b.Transpose(O)),vH.ClassName,O)}}vH.ClassName="FGTransposeBlock",(0,U.g)(vH.ClassName,vH);class NH extends ay{constructor(O){super(Hy,Oy,(O=>O.determinant()),NH.ClassName,O)}}NH.ClassName="FGDeterminantBlock",(0,U.g)(NH.ClassName,NH);class mH extends ay{constructor(O){super(Hy,Hy,(O=>H.b.Invert(O)),mH.ClassName,O)}}mH.ClassName="FGInvertMatrixBlock",(0,U.g)(mH.ClassName,mH);class tH extends Yy{constructor(O){super(Hy,Hy,Hy,((O,f)=>f.multiply(O)),tH.ClassName,O)}}tH.ClassName="FGMatMulBlock",(0,U.g)(tH.ClassName,tH);class qH extends ay{constructor(O){super(by,by,(O=>new Cf(~O.value)),qH.ClassName,O)}}qH.ClassName="FGBitwiseNotBlock",(0,U.g)(qH.ClassName,qH);class FH extends Yy{constructor(O){super(by,by,by,((O,f)=>new Cf(O.value&f.value)),FH.ClassName,O)}}FH.ClassName="FGBitwiseAndBlock",(0,U.g)(FH.ClassName,FH);class IH extends Yy{constructor(O){super(by,by,by,((O,f)=>new Cf(O.value|f.value)),IH.ClassName,O)}}IH.ClassName="FGBitwiseOrBlock",(0,U.g)(IH.ClassName,IH);class AH extends Yy{constructor(O){super(by,by,by,((O,f)=>new Cf(O.value^f.value)),AH.ClassName,O)}}AH.ClassName="FGBitwiseXorBlock",(0,U.g)(AH.ClassName,AH);class JH extends Yy{constructor(O){super(by,by,by,((O,f)=>new Cf(O.value<<f.value)),JH.ClassName,O)}}JH.ClassName="FGBitwiseLeftShiftBlock",(0,U.g)(JH.ClassName,JH);class XH extends Yy{constructor(O){super(by,by,by,((O,f)=>new Cf(O.value>>f.value)),XH.ClassName,O)}}XH.ClassName="FGBitwiseRightShiftBlock",(0,U.g)(XH.ClassName,XH);class wH extends ay{constructor(O){super(by,by,(O=>new Cf(Math.clz32(O.value))),wH.ClassName,O)}}wH.ClassName="FGCountLeadingZerosBlock",(0,U.g)(wH.ClassName,wH);class BH extends ay{constructor(O){super(by,by,(O=>new Cf(O.value?31-Math.clz32(O.value&-O.value):32)),BH.ClassName,O)}}BH.ClassName="FGCountTrailingZerosBlock",(0,U.g)(BH.ClassName,BH);class jH extends ay{constructor(O){super(by,by,(O=>new Cf(function(O){let f=0;for(;O;)f+=1&O,O>>=1;return f}(O.value))),jH.ClassName,O)}}jH.ClassName="FGCountOneBitsBlock",(0,U.g)(jH.ClassName,jH);class uH extends Wy{constructor(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startIndex:new Cf(0)};super(O),this.config=O,this.reset=this._registerSignalInput("reset"),this.n=this.registerDataInput("n",by),this.value=this.registerDataOutput("value",by)}_execute(O,f){if(f===this.reset)this.value.setValue(this.config.startIndex,O);else{const f=this.value.getValue(O);f.value<this.n.getValue(O).value&&(this.value.setValue(new Cf(f.value+1),O),this.out._activateSignal(O))}}getClassName(){return uH.ClassName}}uH.ClassName="FGDoNBlock",(0,U.g)(uH.ClassName,uH);class LH extends qy{constructor(O){super(O),this.config=O,this.output=this.registerDataOutput(O.variableName,nf)}_updateOutputs(O){const f=this.config.variableName;O.hasVariable(f)&&this.output.setValue(O.getVariable(f),O)}getClassName(){return LH.ClassName}serialize(O){super.serialize(O),O.config.variableName=this.config.variableName}}LH.ClassName="FGGetVariableBlock",(0,U.g)(LH.ClassName,LH);class pH extends Wy{constructor(O){super(O),this.config=O,this.input=this.registerDataInput(O.variableName,nf)}_execute(O){const f=this.config.variableName,y=this.input.getValue(O);O.setVariable(f,y),this.out._activateSignal(O)}getClassName(){return pH.ClassName}}pH.ClassName="FGSetVariableBlock",(0,U.g)(pH.ClassName,pH);class UH extends Wy{constructor(O){super(O),this.config=O,this.condition=this.registerDataInput("condition",fy),this.loopBody=this._registerSignalOutput("loopBody")}_execute(O,f){var y;let S=this.condition.getValue(O);for(null!==(y=this.config)&&void 0!==y&&y.isDo&&!S&&this.loopBody._activateSignal(O);S;)this.loopBody._activateSignal(O),S=this.condition.getValue(O);this.out._activateSignal(O)}getClassName(){return UH.ClassName}serialize(O){var f;super.serialize(O),O.isDo=null===(f=this.config)||void 0===f?void 0:f.isDo}}UH.ClassName="FGWhileLoopBlock",(0,U.g)(UH.ClassName,UH);const lH={"lifecycle/onStart":ly.ClassName,"lifecycle/onTick":xy.ClassName,log:Ey.ClassName,"flow/delay":iy.ClassName,"customEvent/send":Dy.ClassName,"customEvent/receive":Vy.ClassName,"flow/sequence":gy.ClassName,"world/get":ky.ClassName,"world/set":zy.ClassName,"flow/doN":uH.ClassName,"variable/get":LH.ClassName,"variable/set":pH.ClassName,"flow/whileLoop":UH.ClassName,"math/random":OS.ClassName,"math/e":yS.ClassName,"math/pi":SS.ClassName,"math/inf":HS.ClassName,"math/nan":bS.ClassName,"math/abs":vS.ClassName,"math/sign":NS.ClassName,"math/trunc":mS.ClassName,"math/floor":tS.ClassName,"math/ceil":qS.ClassName,"math/fract":FS.ClassName,"math/neg":IS.ClassName,"math/add":Qy.ClassName,"math/sub":Cy.ClassName,"math/mul":ry.ClassName,"math/div":ny.ClassName,"math/rem":JS.ClassName,"math/min":XS.ClassName,"math/max":wS.ClassName,"math/clamp":uS.ClassName,"math/saturate":pS.ClassName,"math/mix":US.ClassName,"math/eq":lS.ClassName,"math/lt":WS.ClassName,"math/le":ES.ClassName,"math/gt":oS.ClassName,"math/ge":iS.ClassName,"math/isnan":DS.ClassName,"math/isinf":VS.ClassName,"math/rad":gS.ClassName,"math/deg":RS.ClassName,"math/sin":sS.ClassName,"math/cos":kS.ClassName,"math/tan":zS.ClassName,"math/asin":cS.ClassName,"math/acos":dS.ClassName,"math/atan":GS.ClassName,"math/atan2":YS.ClassName,"math/sinh":ZS.ClassName,"math/cosh":aS.ClassName,"math/tanh":MS.ClassName,"math/asinh":PS.ClassName,"math/acosh":eS.ClassName,"math/atanh":KS.ClassName,"math/exp":TS.ClassName,"math/log":QS.ClassName,"math/log2":CS.ClassName,"math/log10":rS.ClassName,"math/sqrt":nS.ClassName,"math/cbrt":OH.ClassName,"math/pow":fH.ClassName,"math/length":yH.ClassName,"math/normalize":SH.ClassName,"math/dot":fS.ClassName,"math/cross":HH.ClassName,"math/rotate2d":bH.ClassName,"math/rotate3d":hH.ClassName,"math/transpose":vH.ClassName,"math/determinant":NH.ClassName,"math/inverse":mH.ClassName,"math/matmul":tH.ClassName,"math/not":qH.ClassName,"math/and":FH.ClassName,"math/or":IH.ClassName,"math/xor":AH.ClassName,"math/asr":XH.ClassName,"math/lsl":JH.ClassName,"math/clz":wH.ClassName,"math/ctz":BH.ClassName,"math/popcnt":jH.ClassName},xH={float2:"Vector2",float3:"fb",float4:"Vector4",float4x4:"Matrix",int:"FlowGraphInteger"};function WH(O,f,y){if(void 0!==O.type){const S=f.types&&f.types[O.type];if(!S)throw new Error(`${y}: Unknown type: ${O.type}`);const H=S.signature;if(!H)throw new Error(`${y}: Type ${O.type} has no signature`);const b=xH[H];return{value:O.value,className:b}}return O.value}function EH(O,f,y){const S=lH[f.type];if(!S)throw new Error(`/extensions/KHR_interactivity/nodes/${O}: Unknown block type: ${f.type}`);const H=O.toString(),b=function(O,f,y){const S={},H=O.configuration??[];for(const b of H)if("customEvent"===b.id){const O=f.customEvents&&f.customEvents[b.value];if(!O)throw new Error(`/extensions/KHR_interactivity/nodes/${y}: Unknown custom event: ${b.value}`);S.eventId=O.id,S.eventData=O.values.map((O=>O.id))}else if("variable"===b.id){const O=f.variables&&f.variables[b.value];if(!O)throw new Error(`/extensions/KHR_interactivity/nodes/${y}: Unknown variable: ${b.value}`);S.variableName=O.id}else if("path"===b.id){const O=b.value;S.path=O}else S[b.id]=WH(b,f,`/extensions/KHR_interactivity/nodes/${y}`);return S}(f,y,H);return{className:S,config:b,uniqueId:H,metadata:f.metadata,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[]}}class oH extends Uf{constructor(O){super(O,DH)}}const iH={__array__:{__target__:!0,translation:{type:"fb",get:O=>O._babylonTransformNode.position,set:(O,f)=>{f._babylonTransformNode.position=O},getObject:O=>O._babylonTransformNode}}},DH={nodes:iH},VH="KHR_interactivity";class gH{constructor(O){this._loader=O,this.name=VH,this.enabled=this._loader.isExtensionUsed(VH),this._pathConverter=new oH(this._loader.Mi)}dispose(){this._loader=null,delete this._pathConverter}onReady(){var O;if(!this._loader.babylonScene||!this._pathConverter)return;const f=this._loader.babylonScene,y=function(O){const f={uniqueId:(0,Tf.d)(),_userVariables:{},_connectionValues:{}},y=[f],S=[];for(let b=0;b<O.nodes.length;b++){const f=EH(b,O.nodes[b],O);S.push(f)}for(let b=0;b<O.nodes.length;b++){const y=O.nodes[b],H=S[b],h=y.flows??[];for(const O of h){const f=O.id,y={uniqueId:(0,Tf.d)(),name:f,_connectionType:1,connectedPointIds:[]};H.signalOutputs.push(y);const h=O.node,v=O.socket,N=S[h];if(!N)throw new Error(`/extensions/KHR_interactivity/nodes/${b}: Could not find node with id ${h} that connects its input with with node ${b}'s output ${f}`);let m=N.signalInputs.find((O=>O.name===v));m||(m={uniqueId:(0,Tf.d)(),name:v,_connectionType:0,connectedPointIds:[]},N.signalInputs.push(m)),m.connectedPointIds.push(y.uniqueId),y.connectedPointIds.push(m.uniqueId)}const v=y.values??[];for(const N of v){const y=N.id,h={uniqueId:(0,Tf.d)(),name:y,_connectionType:0,connectedPointIds:[]};if(H.dataInputs.push(h),void 0!==N.value){const y=WH(N,O,`/extensions/KHR_interactivity/nodes/${b}`);f._connectionValues[h.uniqueId]=y}else{if(void 0===N.node||void 0===N.socket)throw new Error(`/extensions/KHR_interactivity/nodes/${b}: Invalid socket ${y} in node ${b}`);{const O=N.node,f=N.socket,H=S[O];if(!H)throw new Error(`/extensions/KHR_interactivity/nodes/${b}: Could not find node with id ${O} that connects its output with node${b}'s input ${y}`);let v=H.dataOutputs.find((O=>O.name===f));v||(v={uniqueId:(0,Tf.d)(),name:f,_connectionType:1,connectedPointIds:[]},H.dataOutputs.push(v)),h.connectedPointIds.push(v.uniqueId),v.connectedPointIds.push(h.uniqueId)}}}}const H=O.variables??[];for(let b=0;b<H.length;b++){const y=H[b],S=y.id;f._userVariables[S]=WH(y,O,`/extensions/KHR_interactivity/variables/${b}`)}return{allBlocks:S,executionContexts:y}}(null===(O=this._loader.Mi.extensions)||void 0===O?void 0:O.KHR_interactivity),S=new Uy({yd:f});py.Parse(y,{coordinator:S,pathConverter:this._pathConverter}),S.start()}}K(VH),e(VH,!0,(O=>new gH(O)));const RH="KHR_node_visibility";class sH{constructor(O){this.name=RH,this._loader=O,this.enabled=O.isExtensionUsed(RH)}async onReady(){var O;null===(O=this._loader.Mi.nodes)||void 0===O||O.forEach((O=>{var f,y,S,H;(null===(f=O._primitiveBabylonMeshes)||void 0===f||f.forEach((O=>{O.inheritVisibility=!0})),null!==(y=O.extensions)&&void 0!==y&&y.KHR_node_visibility)&&(!1===(null===(S=O.extensions)||void 0===S?void 0:S.KHR_node_visibility.visible)&&(O._babylonTransformNode&&(O._babylonTransformNode.isVisible=!1),null===(H=O._primitiveBabylonMeshes)||void 0===H||H.forEach((O=>{O.isVisible=!1}))))}))}dispose(){this._loader=null}}K(RH),e(RH,!0,(O=>new sH(O)));const kH="ExtrasAsMetadata";class zH{_assignExtras(O,f){if(f.extras&&Object.keys(f.extras).length>0){const y=O.metadata=O.metadata||{};(y.Mi=y.Mi||{}).extras=f.extras}}constructor(O){this.name=kH,this.enabled=!0,this._loader=O}dispose(){this._loader=null}loadNodeAsync(O,f,y){return this._loader.loadNodeAsync(O,f,(O=>{this._assignExtras(O,f),y(O)}))}loadCameraAsync(O,f,y){return this._loader.loadCameraAsync(O,f,(O=>{this._assignExtras(O,f),y(O)}))}createMaterial(O,f,y){const S=this._loader.createMaterial(O,f,y);return this._assignExtras(S,f),S}}K(kH),e(kH,!1,(O=>new zH(O)))},12240:(O,f,y)=>{"use strict";y.d(f,{d:()=>D,f:()=>l,g:()=>U,j:()=>x});var S=y(11004),H=y(10995),b=y(11666),h=y(11557),v=y(11598),N=y(11593),m=y(11017),t=y(11042),q=y(12247),F=y(12250),I=y(11561);class A{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.oj=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Zj=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(O){this._environmentTexture=O}getNodes(){let O=[];return O=O.concat(this.meshes),O=O.concat(this.lights),O=O.concat(this.cameras),O=O.concat(this.transformNodes),this.skeletons.forEach((f=>O=O.concat(f.bones))),O}}class J extends A{}class X{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){this.rootNodes.slice(0).forEach((O=>{O.dispose()})),this.rootNodes.length=0,this.skeletons.slice(0).forEach((O=>{O.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((O=>{O.dispose()})),this.animationGroups.length=0}}class w extends A{constructor(O){super(),this._wasAddedToScene=!1,(O=O||t.c.LastCreatedScene)&&(this.yd=O,this.proceduralTextures=[],O.hj.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=O.getEngine().onContextRestoredObservable.add((()=>{for(const O of this.geometries)O._rebuild();for(const O of this.meshes)O._rebuild();for(const O of this.oj)O.rebuild();for(const O of this.textures)O._rebuild()})))}_topologicalSort(O){const f=new Map;for(const h of O)f.set(h.uniqueId,h);const y={dependsOn:new Map,dependedBy:new Map};for(const h of O){const O=h.uniqueId;y.dependsOn.set(O,new Set),y.dependedBy.set(O,new Set)}for(const h of O){const O=h.uniqueId,S=y.dependsOn.get(O);if(h instanceof q.d){const H=h.sourceMesh;f.has(H.uniqueId)&&(S.add(H.uniqueId),y.dependedBy.get(H.uniqueId).add(O))}const H=y.dependedBy.get(O);for(const b of h.getDescendants()){const S=b.uniqueId;if(f.has(S)){H.add(S);y.dependsOn.get(S).add(O)}}}const S=[],H=[];for(const h of O){const O=h.uniqueId;0===y.dependsOn.get(O).size&&(H.push(h),f.delete(O))}const b=H;for(;b.length>0;){const O=b.shift();S.push(O);const H=y.dependedBy.get(O.uniqueId);for(const S of Array.from(H.values())){const H=y.dependsOn.get(S);H.delete(O.uniqueId),0===H.size&&f.get(S)&&(b.push(f.get(S)),f.delete(S))}}return f.size>0&&(m.e.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),f.forEach((O=>m.e.Error(O.name)))),S}_addNodeAndDescendantsToList(O,f,y,S){if(y&&(!S||S(y))&&!f.has(y.uniqueId)){O.push(y),f.add(y.uniqueId);for(const H of y.getDescendants(!0))this._addNodeAndDescendantsToList(O,f,H,S)}}_isNodeInContainer(O){return O instanceof N.c&&-1!==this.meshes.indexOf(O)||(O instanceof v.b&&-1!==this.transformNodes.indexOf(O)||(O instanceof F.d&&-1!==this.lights.indexOf(O)||O instanceof I.c&&-1!==this.cameras.indexOf(O)))}_isValidHierarchy(){for(const O of this.meshes)if(O.parent&&!this._isNodeInContainer(O.parent))return m.e.Warn(`Node ${O.name} has a parent that is not in the container.`),!1;for(const O of this.transformNodes)if(O.parent&&!this._isNodeInContainer(O.parent))return m.e.Warn(`Node ${O.name} has a parent that is not in the container.`),!1;for(const O of this.lights)if(O.parent&&!this._isNodeInContainer(O.parent))return m.e.Warn(`Node ${O.name} has a parent that is not in the container.`),!1;for(const O of this.cameras)if(O.parent&&!this._isNodeInContainer(O.parent))return m.e.Warn(`Node ${O.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(O){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],y=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||H.d.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const S={},b={},v=new X,N=[],m=[],t={doNotInstantiate:!0,...y},q=[],F=new Set;for(const H of this.transformNodes)null===H.parent&&this._addNodeAndDescendantsToList(q,F,H,t.predicate);for(const H of this.meshes)null===H.parent&&this._addNodeAndDescendantsToList(q,F,H,t.predicate);const I=this._topologicalSort(q),A=(y,H)=>{if(((f,y)=>{if(S[f.uniqueId]=y.uniqueId,b[y.uniqueId]=y,O&&(y.name=O(f.name)),y instanceof h.d){const O=y;if(O.morphTargetManager){const y=f.morphTargetManager;O.morphTargetManager=y.clone();for(let f=0;f<y.numTargets;f++){const H=y.getTarget(f),h=O.morphTargetManager.getTarget(f);S[H.uniqueId]=h.uniqueId,b[h.uniqueId]=h}}}})(y,H),y.parent){const O=S[y.parent.uniqueId],f=b[O];H.parent=f||y.parent}if(H.position&&y.position&&H.position.p(y.position),H.rotationQuaternion&&y.rotationQuaternion&&H.rotationQuaternion.p(y.rotationQuaternion),H.rotation&&y.rotation&&H.rotation.p(y.rotation),H.Yd&&y.Yd&&H.Yd.p(y.Yd),H.material){const h=H;if(h.material)if(f){const f=y.material;if(-1===m.indexOf(f)){let y=f.clone(O?O(f.name):"Clone of "+f.name);if(m.push(f),S[f.uniqueId]=y.uniqueId,b[y.uniqueId]=y,"MultiMaterial"===f.getClassName()){const H=f;for(const f of H.$f)f&&(y=f.clone(O?O(f.name):"Clone of "+f.name),m.push(f),S[f.uniqueId]=y.uniqueId,b[y.uniqueId]=y);H.$f=H.$f.map((O=>O&&b[S[O.uniqueId]]))}}"InstancedMesh"!==h.getClassName()&&(h.material=b[S[f.uniqueId]])}else"MultiMaterial"===h.material.getClassName()?-1===this.yd.multiMaterials.indexOf(h.material)&&this.yd.addMultiMaterial(h.material):-1===this.yd.materials.indexOf(h.material)&&this.yd.addMaterial(h.material)}null===H.parent&&v.rootNodes.push(H)};return I.forEach((O=>{if("InstancedMesh"===O.getClassName()){const f=O,y=f.sourceMesh,H=S[y.uniqueId],h=("number"===typeof H?b[H]:y).createInstance(f.name);A(f,h)}else{let f=!0;"tb"===O.getClassName()||"Node"===O.getClassName()||O.skeleton||!O.getTotalVertices||0===O.getTotalVertices()?f=!1:t.doNotInstantiate&&(f="function"===typeof t.doNotInstantiate?!t.doNotInstantiate(O):!t.doNotInstantiate);const y=f?O.createInstance(`instance of ${O.name}`):O.clone(`Clone of ${O.name}`,null,!0);if(!y)throw new Error(`Could not clone or instantiate node on Asset Container ${O.name}`);A(O,y)}})),this.skeletons.forEach((f=>{if(t.predicate&&!t.predicate(f))return;const y=f.clone(O?O(f.name):"Clone of "+f.name);for(const O of this.meshes)if(O.skeleton===f&&!O.isAnInstance){const f=b[S[O.uniqueId]];if(!f||f.isAnInstance)continue;if(f.skeleton=y,-1!==N.indexOf(y))continue;N.push(y);for(const O of y.bones)O._linkedTransformNode&&(O._linkedTransformNode=b[S[O._linkedTransformNode.uniqueId]])}v.skeletons.push(y)})),this.animationGroups.forEach((f=>{if(t.predicate&&!t.predicate(f))return;const y=f.clone(O?O(f.name):"Clone of "+f.name,(O=>b[S[O.uniqueId]]||O));v.animationGroups.push(y)})),v}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||H.d.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.yd.environmentTexture=this.environmentTexture);for(const O of this.yd._serializableComponents)O.addFromContainer(this);this.yd.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const f=[];this.cameras.forEach((y=>{O&&!O(y)||(this.yd.addCamera(y),f.push(y))})),this.lights.forEach((y=>{O&&!O(y)||(this.yd.addLight(y),f.push(y))})),this.meshes.forEach((y=>{O&&!O(y)||(this.yd.ji(y),f.push(y))})),this.skeletons.forEach((f=>{O&&!O(f)||this.yd.addSkeleton(f)})),this.animations.forEach((f=>{O&&!O(f)||this.yd.addAnimation(f)})),this.animationGroups.forEach((f=>{O&&!O(f)||this.yd.addAnimationGroup(f)})),this.multiMaterials.forEach((f=>{O&&!O(f)||this.yd.addMultiMaterial(f)})),this.materials.forEach((f=>{O&&!O(f)||this.yd.addMaterial(f)})),this.morphTargetManagers.forEach((f=>{O&&!O(f)||this.yd.addMorphTargetManager(f)})),this.geometries.forEach((f=>{O&&!O(f)||this.yd.addGeometry(f)})),this.transformNodes.forEach((y=>{O&&!O(y)||(this.yd.addTransformNode(y),f.push(y))})),this.actionManagers.forEach((f=>{O&&!O(f)||this.yd.addActionManager(f)})),this.textures.forEach((f=>{O&&!O(f)||this.yd.addTexture(f)})),this.reflectionProbes.forEach((f=>{O&&!O(f)||this.yd.addReflectionProbe(f)}));for(const y of f)y.parent&&-1===this.yd.getNodes().indexOf(y.parent)&&(y.setParent?y.setParent(null):y.parent=null)}removeAllFromScene(){this._isValidHierarchy()||H.d.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.yd.environmentTexture&&(this.yd.environmentTexture=null);for(const O of this.yd._serializableComponents)O.removeFromContainer(this)}removeFromScene(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.cameras.forEach((f=>{O&&!O(f)||this.yd.removeCamera(f)})),this.lights.forEach((f=>{O&&!O(f)||this.yd.removeLight(f)})),this.meshes.forEach((f=>{O&&!O(f)||this.yd.xd(f,!0)})),this.skeletons.forEach((f=>{O&&!O(f)||this.yd.removeSkeleton(f)})),this.animations.forEach((f=>{O&&!O(f)||this.yd.removeAnimation(f)})),this.animationGroups.forEach((f=>{O&&!O(f)||this.yd.removeAnimationGroup(f)})),this.multiMaterials.forEach((f=>{O&&!O(f)||this.yd.removeMultiMaterial(f)})),this.materials.forEach((f=>{O&&!O(f)||this.yd.removeMaterial(f)})),this.morphTargetManagers.forEach((f=>{O&&!O(f)||this.yd.removeMorphTargetManager(f)})),this.geometries.forEach((f=>{O&&!O(f)||this.yd.removeGeometry(f)})),this.transformNodes.forEach((f=>{O&&!O(f)||this.yd.removeTransformNode(f)})),this.actionManagers.forEach((f=>{O&&!O(f)||this.yd.removeActionManager(f)})),this.textures.forEach((f=>{O&&!O(f)||this.yd.removeTexture(f)})),this.reflectionProbes.forEach((f=>{O&&!O(f)||this.yd.removeReflectionProbe(f)}))}dispose(){this.cameras.slice(0).forEach((O=>{O.dispose()})),this.cameras.length=0,this.lights.slice(0).forEach((O=>{O.dispose()})),this.lights.length=0,this.meshes.slice(0).forEach((O=>{O.dispose()})),this.meshes.length=0,this.skeletons.slice(0).forEach((O=>{O.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((O=>{O.dispose()})),this.animationGroups.length=0,this.multiMaterials.slice(0).forEach((O=>{O.dispose()})),this.multiMaterials.length=0,this.materials.slice(0).forEach((O=>{O.dispose()})),this.materials.length=0,this.geometries.slice(0).forEach((O=>{O.dispose()})),this.geometries.length=0,this.transformNodes.slice(0).forEach((O=>{O.dispose()})),this.transformNodes.length=0,this.actionManagers.slice(0).forEach((O=>{O.dispose()})),this.actionManagers.length=0,this.textures.slice(0).forEach((O=>{O.dispose()})),this.textures.length=0,this.reflectionProbes.slice(0).forEach((O=>{O.dispose()})),this.reflectionProbes.length=0,this.morphTargetManagers.slice(0).forEach((O=>{O.dispose()})),this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const O of this.yd._serializableComponents)O.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.yd.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(O,f,y){if(O&&f)for(const S of O){let O=!0;if(y)for(const f of y)if(S===f){O=!1;break}O&&(f.push(S),S._parentContainer=this)}}moveAllFromScene(O){this._wasAddedToScene=!1,void 0===O&&(O=new J);for(const f in this)Object.prototype.hasOwnProperty.call(this,f)&&(this[f]=this[f]||("_environmentTexture"===f?null:[]),this._moveAssets(this.yd[f],this[f],O[f]));this.environmentTexture=this.yd.environmentTexture,this.removeAllFromScene()}createRootMesh(){const O=new h.d("assetContainerRootMesh",this.yd);return this.meshes.forEach((f=>{f.parent||O.addChild(f)})),this.meshes.unshift(O),O}mergeAnimationsTo(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.c.LastCreatedScene,f=arguments.length>1?arguments[1]:void 0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!O)return m.e.Error("No scene available to merge animations to"),[];const S=y||(f=>{let y=null;const S=f.animations.length?f.animations[0].targetProperty:"",H=f.name.split(".").join("").split("_primitive")[0];switch(S){case"position":case"rotationQuaternion":y=O.getTransformNodeByName(f.name)||O.getTransformNodeByName(H);break;case"influence":y=O.getMorphTargetByName(f.name)||O.getMorphTargetByName(H);break;default:y=O.getNodeByName(f.name)||O.getNodeByName(H)}return y});this.getNodes().forEach((O=>{const f=S(O);if(null!==f){for(const y of O.animations){const O=f.animations.filter((O=>O.targetProperty===y.targetProperty));for(const y of O){const O=f.animations.indexOf(y,0);O>-1&&f.animations.splice(O,1)}}f.animations=f.animations.concat(O.animations)}}));const H=[];return this.animationGroups.slice().forEach((O=>{H.push(O.clone(O.name,S)),O.animatables.forEach((O=>{O.stop()}))})),f.forEach((f=>{const y=S(f.target);y&&(O.beginAnimation(y,f.fromFrame,f.toFrame,f.loopAnimation,f.speedRatio,f.onAnimationEnd?f.onAnimationEnd:void 0,void 0,!0,void 0,f.onAnimationLoop?f.onAnimationLoop:void 0),O.stopAnimation(f.target))})),H}populateRootNodes(){this.rootNodes.length=0,this.meshes.forEach((O=>{O.parent||-1!==this.rootNodes.indexOf(O)||this.rootNodes.push(O)})),this.transformNodes.forEach((O=>{O.parent||-1!==this.rootNodes.indexOf(O)||this.rootNodes.push(O)})),this.lights.forEach((O=>{O.parent||-1!==this.rootNodes.indexOf(O)||this.rootNodes.push(O)})),this.cameras.forEach((O=>{O.parent||-1!==this.rootNodes.indexOf(O)||this.rootNodes.push(O)}))}addAllAssetsToContainer(O){if(!O)return;const f=[],y=new Set;for(f.push(O);f.length>0;){const O=f.pop();if(O instanceof h.d?(O.Bj&&-1===this.geometries.indexOf(O.Bj)&&this.geometries.push(O.Bj),this.meshes.push(O)):O instanceof v.b?this.transformNodes.push(O):O instanceof F.d?this.lights.push(O):O instanceof I.c&&this.cameras.push(O),O instanceof N.c){if(O.material&&-1===this.materials.indexOf(O.material)){this.materials.push(O.material);for(const f of O.material.getActiveTextures())-1===this.textures.indexOf(f)&&this.textures.push(f)}O.skeleton&&-1===this.skeletons.indexOf(O.skeleton)&&this.skeletons.push(O.skeleton),O.morphTargetManager&&-1===this.morphTargetManagers.indexOf(O.morphTargetManager)&&this.morphTargetManagers.push(O.morphTargetManager)}for(const S of O.getChildren())y.has(S)||f.push(S);y.add(O)}this.populateRootNodes()}}var B=y(11063);class j{constructor(O){this.byteOffset=0,this.buffer=O}loadAsync(O){return this.buffer.readAsync(this.byteOffset,O).then((O=>{this._dataView=new DataView(O.buffer,O.byteOffset,O.byteLength),this._dataByteOffset=0}))}readUint32(){const O=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,O}readUint8Array(O){const f=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,O);return this._dataByteOffset+=O,this.byteOffset+=O,f}readString(O){return(0,B.h)(this.readUint8Array(O))}skipBytes(O){this._dataByteOffset+=O,this.byteOffset+=O}}var u=y(12255);const L="Z2xURg",p={name:"Mi",extensions:{".gltf":{isBinary:!1},".glb":{isBinary:!0}},canDirectLoad:O=>-1!==O.indexOf("asset")&&-1!==O.indexOf("version")||O.startsWith("data:base64,"+L)||O.startsWith("data:;base64,"+L)||O.startsWith("data:application/octet-stream;base64,"+L)||O.startsWith("data:model/gltf-binary;base64,"+L)};var U,l,x,W=y(11051),E=y(11059);function o(O,f,y){try{return Promise.resolve(new Uint8Array(O,f,y))}catch(S){return Promise.reject(S)}}!function(O){O[O.AUTO=0]="AUTO",O[O.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(U||(U={})),function(O){O[O.NONE=0]="NONE",O[O.FIRST=1]="FIRST",O[O.ALL=2]="ALL"}(l||(l={})),function(O){O[O.LOADING=0]="LOADING",O[O.READY=1]="READY",O[O.COMPLETE=2]="COMPLETE"}(x||(x={}));class i{constructor(){this.coordinateSystemMode=U.AUTO,this.animationStartMode=l.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=O=>Promise.resolve(O),this.extensionOptions={}}p(O){O&&(this.onParsed=O.onParsed,this.coordinateSystemMode=O.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=O.animationStartMode??this.animationStartMode,this.loadNodeAnimations=O.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=O.loadSkins??this.loadSkins,this.loadMorphTargets=O.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=O.compileMaterials??this.compileMaterials,this.useClipPlane=O.useClipPlane??this.useClipPlane,this.compileShadowGenerators=O.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=O.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=O.useRangeRequests??this.useRangeRequests,this.createInstances=O.createInstances??this.createInstances,this.alwaysComputeBoundingBox=O.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=O.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=O.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=O.skipMaterials??this.skipMaterials,this.useSRGBBuffers=O.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=O.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=O.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=O.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=O.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=O.customRootNode,this.onMeshLoaded=O.onMeshLoaded,this.onSkinLoaded=O.onSkinLoaded,this.onTextureLoaded=O.onTextureLoaded,this.onMaterialLoaded=O.onMaterialLoaded,this.onCameraLoaded=O.onCameraLoaded,this.extensionOptions=O.extensionOptions??this.extensionOptions)}}class D extends i{constructor(O){super(),this.onParsedObservable=new S.d,this.onMeshLoadedObservable=new S.d,this.onSkinLoadedObservable=new S.d,this.onTextureLoadedObservable=new S.d,this.onMaterialLoadedObservable=new S.d,this.onCameraLoadedObservable=new S.d,this.onCompleteObservable=new S.d,this.onErrorObservable=new S.d,this.hj=new S.d,this.onExtensionLoadedObservable=new S.d,this.validate=!1,this.onValidatedObservable=new S.d,this._loader=null,this._state=null,this._requests=new Array,this.name=p.name,this.extensions=p.extensions,this.onLoaderStateChangedObservable=new S.d,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(O)}set onParsed(O){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),O&&(this._onParsedObserver=this.onParsedObservable.add(O))}set onMeshLoaded(O){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),O&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(O))}set onSkinLoaded(O){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),O&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((f=>O(f.node,f.skinnedNode))))}set onTextureLoaded(O){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),O&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(O))}set onMaterialLoaded(O){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),O&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(O))}set onCameraLoaded(O){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),O&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(O))}set onComplete(O){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(O)}set onError(O){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(O)}set onDispose(O){this._onDisposeObserver&&this.hj.remove(this._onDisposeObserver),this._onDisposeObserver=this.hj.add(O)}set onExtensionLoaded(O){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(O)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(O){this._loggingEnabled!==O&&(this._loggingEnabled=O,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(O){this._capturePerformanceCounters!==O&&(this._capturePerformanceCounters=O,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(O){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(O)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const O of this._requests)O.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=O=>Promise.resolve(O),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.hj.notifyObservers(void 0),this.hj.clear()}loadFile(O,f,y,b,h,v,N,t){if(ArrayBuffer.isView(f))return this._loadBinary(O,f,y,b,N,t),null;this._progressCallback=h;const q=f.name||H.d.GetFilename(f);if(v){if(this.useRangeRequests){this.validate&&m.e.Warn("glTF validation is not supported when range requests are enabled");const y={abort:()=>{},onCompleteObservable:new S.d},H={readAsync:(y,S)=>new Promise(((H,b)=>{this._loadFile(O,f,(O=>{H(new Uint8Array(O))}),!0,(O=>{b(O)}),(O=>{O.setRequestHeader("Range",`bytes=${y}-${y+S-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new j(H)).then((O=>{y.onCompleteObservable.notifyObservers(y),b(O)}),N?O=>N(void 0,O):void 0),y}return this._loadFile(O,f,(f=>{this._validate(O,new Uint8Array(f,0,f.byteLength),y,q),this._unpackBinaryAsync(new j({readAsync:(O,y)=>o(f,O,y),byteLength:f.byteLength})).then((O=>{b(O)}),N?O=>N(void 0,O):void 0)}),!0,N)}return this._loadFile(O,f,(f=>{try{this._validate(O,f,y,q),b({json:this._parseJson(f)})}catch{N&&N()}}),!1,N)}_loadBinary(O,f,y,S,H,b){this._validate(O,new Uint8Array(f.buffer,f.byteOffset,f.byteLength),y,b),this._unpackBinaryAsync(new j({readAsync:(O,y)=>function(O,f,y){try{if(f<0||f>=O.byteLength)throw new RangeError("Offset is out of range.");if(f+y>O.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(O.buffer,O.byteOffset+f,y))}catch(S){return Promise.reject(S)}}(f,O,y),byteLength:f.byteLength})).then((O=>{S(O)}),H?O=>H(void 0,O):void 0)}importMeshAsync(O,f,y,S,H,b){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(y),this.onParsedObservable.clear(),this._log(`Loading ${b||""}`),this._loader=this._getLoader(y),this._loader.importMeshAsync(O,f,null,y,S,H,b))))}loadAsync(O,f,y,S,H){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(f),this.onParsedObservable.clear(),this._log(`Loading ${H||""}`),this._loader=this._getLoader(f),this._loader.loadAsync(O,f,y,S,H))))}loadAssetContainerAsync(O,f,y,S,H){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(f),this.onParsedObservable.clear(),this._log(`Loading ${H||""}`),this._loader=this._getLoader(f);const b=new w(O),h=[];this.onMaterialLoadedObservable.add((O=>{h.push(O)}));const v=[];this.onTextureLoadedObservable.add((O=>{v.push(O)}));const N=[];this.onCameraLoadedObservable.add((O=>{N.push(O)}));const m=[];return this.onMeshLoadedObservable.add((O=>{O.morphTargetManager&&m.push(O.morphTargetManager)})),this._loader.importMeshAsync(null,O,b,f,y,S,H).then((O=>(Array.prototype.push.apply(b.geometries,O.geometries),Array.prototype.push.apply(b.meshes,O.meshes),Array.prototype.push.apply(b.oj,O.oj),Array.prototype.push.apply(b.skeletons,O.skeletons),Array.prototype.push.apply(b.animationGroups,O.animationGroups),Array.prototype.push.apply(b.materials,h),Array.prototype.push.apply(b.textures,v),Array.prototype.push.apply(b.lights,O.lights),Array.prototype.push.apply(b.transformNodes,O.transformNodes),Array.prototype.push.apply(b.cameras,N),Array.prototype.push.apply(b.morphTargetManagers,m),b)))}))}canDirectLoad(O){return p.canDirectLoad(O)}directLoad(O,f){if(f.startsWith("base64,"+L)||f.startsWith(";base64,"+L)||f.startsWith("application/octet-stream;base64,"+L)||f.startsWith("model/gltf-binary;base64,"+L)){const y=(0,W.c)(f);return this._validate(O,new Uint8Array(y,0,y.byteLength)),this._unpackBinaryAsync(new j({readAsync:(O,f)=>o(y,O,f),byteLength:y.byteLength}))}return this._validate(O,f),Promise.resolve({json:this._parseJson(f)})}createPlugin(O){return new D(O[p.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((O,f)=>{this.onCompleteObservable.addOnce((()=>{O()})),this.onErrorObservable.addOnce((O=>{f(O)}))}))}_setState(O){this._state!==O&&(this._state=O,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(x[this._state]))}_loadFile(O,f,y,S,H,b){const h=O._loadFile(f,y,(O=>{this._onProgress(O,h)}),!0,S,H,b);return h.onCompleteObservable.add((()=>{h._lengthComputable=!0,h._total=h._loaded})),this._requests.push(h),h}_onProgress(O,f){if(!this._progressCallback)return;f._lengthComputable=O.lengthComputable,f._loaded=O.loaded,f._total=O.total;let y=!0,S=0,H=0;for(const b of this._requests){if(void 0===b._lengthComputable||void 0===b._loaded||void 0===b._total)return;y=y&&b._lengthComputable,S+=b._loaded,H+=b._total}this._progressCallback({lengthComputable:y,loaded:S,total:y?H:0})}_validate(O,f){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),u.e.ValidateAsync(f,y,S,(f=>this.preprocessUrlAsync(y+f).then((f=>O._loadFileAsync(f,void 0,!0,!0).then((O=>new Uint8Array(O,0,O.byteLength))))))).then((O=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(O),this.onValidatedObservable.clear()}),(O=>{this._endPerformanceCounter("Validate JSON"),H.d.Warn(`Failed to validate: ${O.message}`),this.onValidatedObservable.clear()})))}_getLoader(O){const f=O.json.asset||{};this._log(`Asset version: ${f.version}`),f.minVersion&&this._log(`Asset minimum version: ${f.minVersion}`),f.generator&&this._log(`Asset generator: ${f.generator}`);const y=D._parseVersion(f.version);if(!y)throw new Error("Invalid version: "+f.version);if(void 0!==f.minVersion){const O=D._parseVersion(f.minVersion);if(!O)throw new Error("Invalid minimum version: "+f.minVersion);if(D._compareVersion(O,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+f.minVersion)}const S={1:D._CreateGLTF1Loader,2:D._CreateGLTF2Loader}[y.major];if(!S)throw new Error("Unsupported version: "+f.version);return S(this)}_parseJson(O){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${O.length}`);const f=JSON.parse(O);return this._endPerformanceCounter("Parse JSON"),f}_unpackBinaryAsync(O){return this._startPerformanceCounter("Unpack Binary"),O.loadAsync(20).then((()=>{const f=O.readUint32();if(1179937895!==f)throw new E.l("Unexpected magic: "+f,E.i.GLTFLoaderUnexpectedMagicError);const y=O.readUint32();this.loggingEnabled&&this._log(`Binary version: ${y}`);const S=O.readUint32();let H;switch(this.useRangeRequests||S===O.buffer.byteLength||m.e.Warn(`Length in header does not match actual data length: ${S} != ${O.buffer.byteLength}`),y){case 1:H=this._unpackBinaryV1Async(O,S);break;case 2:H=this._unpackBinaryV2Async(O,S);break;default:throw new Error("Unsupported version: "+y)}return this._endPerformanceCounter("Unpack Binary"),H}))}_unpackBinaryV1Async(O,f){const y=O.readUint32(),S=O.readUint32();if(0!==S)throw new Error(`Unexpected content format: ${S}`);const H=f-O.byteOffset,b={json:this._parseJson(O.readString(y)),bin:null};if(0!==H){const f=O.byteOffset;b.bin={readAsync:(y,S)=>O.buffer.readAsync(f+y,S),byteLength:H}}return Promise.resolve(b)}_unpackBinaryV2Async(O,f){const y=1313821514,S=5130562,H=O.readUint32();if(O.readUint32()!==y)throw new Error("First chunk format is not JSON");return O.byteOffset+H===f?O.loadAsync(H).then((()=>({json:this._parseJson(O.readString(H)),bin:null}))):O.loadAsync(H+8).then((()=>{const b={json:this._parseJson(O.readString(H)),bin:null},h=()=>{const H=O.readUint32();switch(O.readUint32()){case y:throw new Error("Unexpected JSON chunk");case S:{const f=O.byteOffset;b.bin={readAsync:(y,S)=>O.buffer.readAsync(f+y,S),byteLength:H},O.skipBytes(H);break}default:O.skipBytes(H)}return O.byteOffset!==f?O.loadAsync(8).then(h):Promise.resolve(b)};return h()}))}static _parseVersion(O){if("1.0"===O||"1.0.1"===O)return{major:1,minor:0};const f=(O+"").match(/^(\d+)\.(\d+)/);return f?{major:parseInt(f[1]),minor:parseInt(f[2])}:null}static _compareVersion(O,f){return O.major>f.major?1:O.major<f.major?-1:O.minor>f.minor?1:O.minor<f.minor?-1:0}_logOpen(O){this._log(O),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(O){const f=D._logSpaces.substring(0,2*this._logIndentLevel);m.e.Log(`${f}${O}`)}_logDisabled(O){}_startPerformanceCounterEnabled(O){H.d.StartPerformanceCounter(O)}_startPerformanceCounterDisabled(O){}_endPerformanceCounterEnabled(O){H.d.EndPerformanceCounter(O)}_endPerformanceCounterDisabled(O){}}D.IncrementalLoading=!0,D.HomogeneousCoordinates=!1,D._logSpaces="                                ",(0,b.d)(new D)},12255:(O,f,y)=>{"use strict";y.d(f,{e:()=>h});var S=y(10995);function H(O,f,y,S){const H={externalResourceFunction:S};return y&&(H.uri="file:"===f?y:f+y),ArrayBuffer.isView(O)?GLTFValidator.validateBytes(O,H):GLTFValidator.validateString(O,H)}function b(){const O=[];onmessage=f=>{const y=f.data;switch(y.id){case"init":importScripts(y.url);break;case"validate":H(y.data,y.rootUrl,y.fileName,(f=>new Promise(((y,S)=>{const H=O.length;O.push({resolve:y,reject:S}),postMessage({id:"getExternalResource",index:H,uri:f})})))).then((O=>{postMessage({id:"validate.resolve",value:O})}),(O=>{postMessage({id:"validate.reject",reason:O})}));break;case"getExternalResource.resolve":O[y.index].resolve(y.value);break;case"getExternalResource.reject":O[y.index].reject(y.reason)}}}class h{static ValidateAsync(O,f,y,h){return"function"===typeof Worker?new Promise(((v,N)=>{const m=`${H}(${b})()`,t=URL.createObjectURL(new Blob([m],{type:"application/javascript"})),q=new Worker(t),F=O=>{q.removeEventListener("error",F),q.removeEventListener("message",I),N(O)},I=O=>{const f=O.data;switch(f.id){case"getExternalResource":h(f.uri).then((O=>{q.postMessage({id:"getExternalResource.resolve",index:f.index,value:O},[O.buffer])}),(O=>{q.postMessage({id:"getExternalResource.reject",index:f.index,reason:O})}));break;case"validate.resolve":q.removeEventListener("error",F),q.removeEventListener("message",I),v(f.value),q.terminate();break;case"validate.reject":q.removeEventListener("error",F),q.removeEventListener("message",I),N(f.reason),q.terminate()}};if(q.addEventListener("error",F),q.addEventListener("message",I),q.postMessage({id:"init",url:S.d.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(O)){const S=O.slice();q.postMessage({id:"validate",data:S,rootUrl:f,fileName:y},[S.buffer])}else q.postMessage({id:"validate",data:O,rootUrl:f,fileName:y})})):(this._LoadScriptPromise||(this._LoadScriptPromise=S.d.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>H(O,f,y,h))))}}h.Configuration={url:`${S.d._DefaultCdnUrl}/gltf_validator.js`}},12657:(O,f,y)=>{"use strict";y.d(f,{c:()=>U});var S=y(11289),H=y(11294),b=y(11362),h=y(11324),v=y(11497),N=y(11506),m=y(11392),t=y(11311),q=y(11153),F=y(11101);y(11928),y(11848),y(11862),y(11853),y(11868),y(11875),y(11877);const I="imageProcessingCompatibility",A="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";F.c.IncludesShadersStore[I]=A;const J="skyPixelShader",X="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";F.c.ShadersStore[J]=X;y(11933),y(11886),y(11891),y(11904),y(11899);const w="skyVertexShader",B="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";F.c.ShadersStore[w]=B;var j=y(11536),u=y(11494),L=y(11490);class p extends v.e{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class U extends N.e{constructor(O,f){super(O,f),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new h.m(0,100,0),this.useSunPosition=!1,this.cameraOffset=h.m.Zero(),this.up=h.m.Up(),this.dithering=!1,this._cameraPosition=h.m.Zero(),this._skyOrientation=new h.c}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(O,f){const y=f._drawWrapper;if(this.isFrozen&&y.effect&&y._wasPreviouslyReady)return!0;f.materialDefines||(f.materialDefines=new p);const S=f.materialDefines,H=this.va();if(this._isReadyForSubMesh(f))return!0;if((0,L.N)(O,H,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,S),(0,L.A)(O,S,!0,!1),S.IMAGEPROCESSINGPOSTPROCESS!==H.imageProcessingConfiguration.applyByPostProcess&&S.markAsMiscDirty(),S.DITHER!==this.dithering&&S.markAsMiscDirty(),S.isDirty){S.markAsProcessed(),H.resetCachedMaterial();const O=new j.c;S.FOG&&O.addFallback(1,"FOG"),S.IMAGEPROCESSINGPOSTPROCESS=H.imageProcessingConfiguration.applyByPostProcess,S.DITHER=this.dithering;const y=[m.f.PositionKind];S.VERTEXCOLOR&&y.push(m.f.ColorKind);const b="sky",h=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,u.b)(h);const v=S.toString();f.setEffect(H.getEngine().createEffect(b,y,h,[],v,O,this.onCompiled,this.onError),S,this._materialContext)}return!(!f.effect||!f.effect.isReady())&&(S._renderId=H.getRenderId(),y._wasPreviouslyReady=!0,!0)}bindForSubMesh(O,f,y){const S=this.va(),H=y.materialDefines;if(!H)return;const b=y.effect;if(!b)return;this._activeEffect=b,this.bindOnlyWorldMatrix(O),this._activeEffect.setMatrix("viewProjection",S.getTransformMatrix()),this._mustRebind(S,b,y)&&((0,u.f)(b,this,S),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,L.j)(H,b,S)),S.fogEnabled&&f.applyFog&&S.fogMode!==t.c.FOGMODE_NONE&&this._activeEffect.setMatrix("view",S.getViewMatrix()),(0,L.e)(S,f,this._activeEffect);const v=S.activeCamera;if(v){const O=v.getWorldMatrix();this._cameraPosition.x=O.m[12],this._cameraPosition.y=O.m[13],this._cameraPosition.z=O.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const O=Math.PI*(this.inclination-.5),f=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(f)*Math.cos(O),this.sunPosition.y=this.distance*Math.sin(-O),this.sunPosition.z=this.distance*Math.sin(f)*Math.cos(O),h.c.FromUnitVectorsToRef(h.m.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(f,this._activeEffect,y)}getAnimatables(){return[]}dispose(O){super.dispose(O)}clone(O){return b.b.Clone((()=>new U(O,this.va())),this)}serialize(){const O=super.serialize();return O.customType="BABYLON.SkyMaterial",O}getClassName(){return"SkyMaterial"}static Parse(O,f,y){return b.b.Parse((()=>new U(O.name,f)),O,f,y)}}(0,S.b)([(0,H.L)()],U.prototype,"luminance",void 0),(0,S.b)([(0,H.L)()],U.prototype,"turbidity",void 0),(0,S.b)([(0,H.L)()],U.prototype,"rayleigh",void 0),(0,S.b)([(0,H.L)()],U.prototype,"mieCoefficient",void 0),(0,S.b)([(0,H.L)()],U.prototype,"mieDirectionalG",void 0),(0,S.b)([(0,H.L)()],U.prototype,"distance",void 0),(0,S.b)([(0,H.L)()],U.prototype,"inclination",void 0),(0,S.b)([(0,H.L)()],U.prototype,"azimuth",void 0),(0,S.b)([(0,H.J)()],U.prototype,"sunPosition",void 0),(0,S.b)([(0,H.L)()],U.prototype,"useSunPosition",void 0),(0,S.b)([(0,H.J)()],U.prototype,"cameraOffset",void 0),(0,S.b)([(0,H.J)()],U.prototype,"up",void 0),(0,S.b)([(0,H.L)()],U.prototype,"dithering",void 0),(0,q.g)("BABYLON.SkyMaterial",U)},10855:(O,f,y)=>{"use strict";function S(O,f){f.headers=O.headers||{},f.statusMessage=O.statusText,f.statusCode=O.status,f.data=O.response}function H(O,f,y){return new Promise((function(H,b){y=y||{};var h,v,N,m=new XMLHttpRequest,t=y.body,q=y.headers||{};for(h in y.timeout&&(m.timeout=y.timeout),m.ontimeout=m.onerror=function(O){O.timeout="timeout"==O.type,b(O)},m.open(O,f.href||f),m.onload=function(){for(N=m.getAllResponseHeaders().trim().split(/[\r\n]+/),S(m,m);v=N.shift();)v=v.split(": "),m.headers[v.shift().toLowerCase()]=v.join(": ");if((v=m.headers["content-type"])&&~v.indexOf("application/json"))try{m.data=JSON.parse(m.data,y.reviver)}catch(O){return S(m,O),b(O)}(m.status>=400?b:H)(m)},typeof FormData<"u"&&t instanceof FormData||t&&"object"==typeof t&&(q["content-type"]="application/json",t=JSON.stringify(t)),m.withCredentials=!!y.withCredentials,q)m.setRequestHeader(h,q[h]);m.send(t)}))}y.r(f),y.d(f,{del:()=>N,get:()=>b,patch:()=>v,post:()=>h,put:()=>m,send:()=>H});var b=H.bind(H,"GET"),h=H.bind(H,"POST"),v=H.bind(H,"PATCH"),N=H.bind(H,"DELETE"),m=H.bind(H,"PUT")},12761:(O,f,y)=>{"use strict";y.d(f,{c:()=>q});const S=.5*(Math.sqrt(3)-1),H=(3-Math.sqrt(3))/6,b=1/3,h=1/6,v=(Math.sqrt(5)-1)/4,N=(5-Math.sqrt(5))/20,m=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),t=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const q=class{constructor(){let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const f="function"==typeof O?O:function(O){let f=0,y=0,S=0,H=1;const b=function(){let O=4022871197;return function(f){f=f.toString();for(let y=0;y<f.length;y++){O+=f.charCodeAt(y);let S=.02519603282416938*O;O=S>>>0,S-=O,S*=O,O=S>>>0,S-=O,O+=4294967296*S}return 2.3283064365386963e-10*(O>>>0)}}();f=b(" "),y=b(" "),S=b(" "),f-=b(O),f<0&&(f+=1);y-=b(O),y<0&&(y+=1);S-=b(O),S<0&&(S+=1);return function(){const O=2091639*f+2.3283064365386963e-10*H;return f=y,y=S,S=O-(H=0|O)}}(O);this.p=function(O){const f=new Uint8Array(256);for(let y=0;y<256;y++)f[y]=y;for(let y=0;y<255;y++){const S=y+~~(O()*(256-y)),H=f[y];f[y]=f[S],f[S]=H}return f}(f),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let y=0;y<512;y++)this.perm[y]=this.p[255&y],this.permMod12[y]=this.perm[y]%12}noise2D(O,f){const y=this.permMod12,b=this.perm;let h=0,v=0,N=0;const t=(O+f)*S,q=Math.floor(O+t),F=Math.floor(f+t),I=(q+F)*H,A=O-(q-I),J=f-(F-I);let X,w;A>J?(X=1,w=0):(X=0,w=1);const B=A-X+H,j=J-w+H,u=A-1+2*H,L=J-1+2*H,p=255&q,U=255&F;let l=.5-A*A-J*J;if(l>=0){const O=3*y[p+b[U]];l*=l,h=l*l*(m[O]*A+m[O+1]*J)}let x=.5-B*B-j*j;if(x>=0){const O=3*y[p+X+b[U+w]];x*=x,v=x*x*(m[O]*B+m[O+1]*j)}let W=.5-u*u-L*L;if(W>=0){const O=3*y[p+1+b[U+1]];W*=W,N=W*W*(m[O]*u+m[O+1]*L)}return 70*(h+v+N)}noise3D(O,f,y){const S=this.permMod12,H=this.perm;let v,N,t,q;const F=(O+f+y)*b,I=Math.floor(O+F),A=Math.floor(f+F),J=Math.floor(y+F),X=(I+A+J)*h,w=O-(I-X),B=f-(A-X),j=y-(J-X);let u,L,p,U,l,x;w>=B?B>=j?(u=1,L=0,p=0,U=1,l=1,x=0):w>=j?(u=1,L=0,p=0,U=1,l=0,x=1):(u=0,L=0,p=1,U=1,l=0,x=1):B<j?(u=0,L=0,p=1,U=0,l=1,x=1):w<j?(u=0,L=1,p=0,U=0,l=1,x=1):(u=0,L=1,p=0,U=1,l=1,x=0);const W=w-u+h,E=B-L+h,o=j-p+h,i=w-U+2*h,D=B-l+2*h,V=j-x+2*h,g=w-1+.5,R=B-1+.5,s=j-1+.5,k=255&I,z=255&A,c=255&J;let d=.6-w*w-B*B-j*j;if(d<0)v=0;else{const O=3*S[k+H[z+H[c]]];d*=d,v=d*d*(m[O]*w+m[O+1]*B+m[O+2]*j)}let G=.6-W*W-E*E-o*o;if(G<0)N=0;else{const O=3*S[k+u+H[z+L+H[c+p]]];G*=G,N=G*G*(m[O]*W+m[O+1]*E+m[O+2]*o)}let Y=.6-i*i-D*D-V*V;if(Y<0)t=0;else{const O=3*S[k+U+H[z+l+H[c+x]]];Y*=Y,t=Y*Y*(m[O]*i+m[O+1]*D+m[O+2]*V)}let Z=.6-g*g-R*R-s*s;if(Z<0)q=0;else{const O=3*S[k+1+H[z+1+H[c+1]]];Z*=Z,q=Z*Z*(m[O]*g+m[O+1]*R+m[O+2]*s)}return 32*(v+N+t+q)}noise4D(O,f,y,S){const H=this.perm;let b,h,m,q,F;const I=(O+f+y+S)*v,A=Math.floor(O+I),J=Math.floor(f+I),X=Math.floor(y+I),w=Math.floor(S+I),B=(A+J+X+w)*N,j=O-(A-B),u=f-(J-B),L=y-(X-B),p=S-(w-B);let U=0,l=0,x=0,W=0;j>u?U++:l++,j>L?U++:x++,j>p?U++:W++,u>L?l++:x++,u>p?l++:W++,L>p?x++:W++;const E=U>=3?1:0,o=l>=3?1:0,i=x>=3?1:0,D=W>=3?1:0,V=U>=2?1:0,g=l>=2?1:0,R=x>=2?1:0,s=W>=2?1:0,k=U>=1?1:0,z=l>=1?1:0,c=x>=1?1:0,d=W>=1?1:0,G=j-E+N,Y=u-o+N,Z=L-i+N,a=p-D+N,M=j-V+2*N,P=u-g+2*N,e=L-R+2*N,K=p-s+2*N,T=j-k+3*N,Q=u-z+3*N,C=L-c+3*N,r=p-d+3*N,n=j-1+4*N,OO=u-1+4*N,fO=L-1+4*N,yO=p-1+4*N,SO=255&A,HO=255&J,bO=255&X,hO=255&w;let vO=.6-j*j-u*u-L*L-p*p;if(vO<0)b=0;else{const O=H[SO+H[HO+H[bO+H[hO]]]]%32*4;vO*=vO,b=vO*vO*(t[O]*j+t[O+1]*u+t[O+2]*L+t[O+3]*p)}let NO=.6-G*G-Y*Y-Z*Z-a*a;if(NO<0)h=0;else{const O=H[SO+E+H[HO+o+H[bO+i+H[hO+D]]]]%32*4;NO*=NO,h=NO*NO*(t[O]*G+t[O+1]*Y+t[O+2]*Z+t[O+3]*a)}let mO=.6-M*M-P*P-e*e-K*K;if(mO<0)m=0;else{const O=H[SO+V+H[HO+g+H[bO+R+H[hO+s]]]]%32*4;mO*=mO,m=mO*mO*(t[O]*M+t[O+1]*P+t[O+2]*e+t[O+3]*K)}let tO=.6-T*T-Q*Q-C*C-r*r;if(tO<0)q=0;else{const O=H[SO+k+H[HO+z+H[bO+c+H[hO+d]]]]%32*4;tO*=tO,q=tO*tO*(t[O]*T+t[O+1]*Q+t[O+2]*C+t[O+3]*r)}let qO=.6-n*n-OO*OO-fO*fO-yO*yO;if(qO<0)F=0;else{const O=H[SO+1+H[HO+1+H[bO+1+H[hO+1]]]]%32*4;qO*=qO,F=qO*qO*(t[O]*n+t[O+1]*OO+t[O+2]*fO+t[O+3]*yO)}return 27*(b+h+m+q+F)}}}}]);