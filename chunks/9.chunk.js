"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[9],{11609:(q,f,j)=>{j.d(f,{e:()=>w,i:()=>t,j:()=>O,k:()=>z,l:()=>i,n:()=>D,o:()=>B});var d=j(10941),g=j(11210),h=j(10985),L=j(10965),Q=j(11616),H=j(11247),r=j(11411),u=j(11021),X=j(11199);const z=Object.freeze(new d.e(0,0,0,0)),B=Object.freeze(d.j.Zero()),D=Object.freeze(d.i.Zero()),i=Object.freeze(r.b.Zero()),t=Object.freeze(g.c.Black()),O=Object.freeze(new g.e(0,0,0,0)),N={key:0,repeatCount:0,loopMode:2};class w{static _PrepareAnimation(q,f,j,h,L,Q,H,u){let X;if(!isNaN(parseFloat(L))&&isFinite(L)?X=w.ANIMATIONTYPE_FLOAT:L instanceof d.e?X=w.ANIMATIONTYPE_QUATERNION:L instanceof d.j?X=w.ANIMATIONTYPE_VECTOR3:L instanceof d.i?X=w.ANIMATIONTYPE_VECTOR2:L instanceof g.c?X=w.ANIMATIONTYPE_COLOR3:L instanceof g.e?X=w.ANIMATIONTYPE_COLOR4:L instanceof r.b&&(X=w.ANIMATIONTYPE_SIZE),void 0==X)return null;const z=new w(q,f,j,X,H),B=[{frame:0,value:L},{frame:h,value:Q}];return z.setKeys(B),void 0!==u&&z.setEasingFunction(u),z}static CreateAnimation(q,f,j,d){const g=new w(q+"Animation",q,j,f,w.ANIMATIONLOOPMODE_CONSTANT);return g.setEasingFunction(d),g}static CreateAndStartAnimation(q,f,j,d,g,h,L,Q,H,r,u){const X=w._PrepareAnimation(q,j,d,g,h,L,Q,H);return X?(f.eq&&(u=f.eq()),u?u.beginDirectAnimation(f,[X],0,g,X.loopMode!==w.ANIMATIONLOOPMODE_CONSTANT,1,r):null):null}static CreateAndStartHierarchyAnimation(q,f,j,d,g,h,L,Q,H,r,u){const X=w._PrepareAnimation(q,d,g,h,L,Q,H,r);if(!X)return null;return f.eq().beginDirectHierarchyAnimation(f,j,[X],0,h,1===X.loopMode,1,u)}static CreateMergeAndStartAnimation(q,f,j,d,g,h,L,Q,H,r){const u=w._PrepareAnimation(q,j,d,g,h,L,Q,H);return u?(f.animations.push(u),f.eq().beginAnimation(f,0,g,1===u.loopMode,1,r)):null}static MakeAnimationAdditive(q,f,j){let g;g="object"===typeof f?f:{referenceFrame:f??0,range:j,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let h=q;if(g.cloneOriginalAnimation&&(h=q.clone(),h.name=g.clonedAnimationName||h.name),!h._keys.length)return h;const L=g.referenceFrame&&g.referenceFrame>=0?g.referenceFrame:0;let Q=0;const H=h._keys[0];let r=h._keys.length-1;const u=h._keys[r],X={referenceValue:H.value,referencePosition:d.f.kf[0],referenceQuaternion:d.f.Quaternion[0],referenceScaling:d.f.kf[1],keyPosition:d.f.kf[2],keyQuaternion:d.f.Quaternion[1],keyScaling:d.f.kf[3]};let z=H.frame,B=u.frame;if(g.range){const q=h.getRange(g.range);q&&(z=q.from,B=q.to)}else z=g.fromFrame??z,B=g.toFrame??B;if(z!==H.frame&&(Q=h.createKeyForFrame(z)),B!==u.frame&&(r=h.createKeyForFrame(B)),1===h._keys.length){const q=h._getKeyValue(h._keys[0]);X.referenceValue=q.clone?q.clone():q}else if(L<=H.frame){const q=h._getKeyValue(H.value);X.referenceValue=q.clone?q.clone():q}else if(L>=u.frame){const q=h._getKeyValue(u.value);X.referenceValue=q.clone?q.clone():q}else{N.key=0;const q=h._interpolate(L,N);X.referenceValue=q.clone?q.clone():q}h.dataType===w.ANIMATIONTYPE_QUATERNION?X.referenceValue.normalize().conjugateInPlace():h.dataType===w.ANIMATIONTYPE_MATRIX&&(X.referenceValue.decompose(X.referenceScaling,X.referenceQuaternion,X.referencePosition),X.referenceQuaternion.normalize().conjugateInPlace());let D=Number.MAX_VALUE;const i=g.clipKeys?[]:null;for(let t=Q;t<=r;t++){let q=h._keys[t];if((i||g.cloneOriginalAnimation)&&(q={frame:q.frame,value:q.value.clone?q.value.clone():q.value,inTangent:q.inTangent,outTangent:q.outTangent,interpolation:q.interpolation,lockedTangent:q.lockedTangent},i&&(D===Number.MAX_VALUE&&(D=q.frame),q.frame-=D,i.push(q))),!t||h.dataType===w.ANIMATIONTYPE_FLOAT||q.value!==H.value)switch(h.dataType){case w.ANIMATIONTYPE_MATRIX:q.value.decompose(X.keyScaling,X.keyQuaternion,X.keyPosition),X.keyPosition.eX(X.referencePosition),X.keyScaling.divideInPlace(X.referenceScaling),X.referenceQuaternion.multiplyToRef(X.keyQuaternion,X.keyQuaternion),d.b.ComposeToRef(X.keyScaling,X.keyQuaternion,X.keyPosition,q.value);break;case w.ANIMATIONTYPE_QUATERNION:X.referenceValue.multiplyToRef(q.value,q.value);break;case w.ANIMATIONTYPE_VECTOR2:case w.ANIMATIONTYPE_VECTOR3:case w.ANIMATIONTYPE_COLOR3:case w.ANIMATIONTYPE_COLOR4:q.value.subtractToRef(X.referenceValue,q.value);break;case w.ANIMATIONTYPE_SIZE:q.value.width-=X.referenceValue.width,q.value.height-=X.referenceValue.height;break;default:q.value-=X.referenceValue}}return i&&h.setKeys(i,!0),h}static TransitionTo(q,f,j,d,g,h,L){let Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(L<=0)return j[q]=f,Q&&Q(),null;const H=g*(L/1e3);h.setKeys([{frame:0,value:j[q].clone?j[q].clone():j[q]},{frame:H,value:f}]),j.animations||(j.animations=[]),j.animations.push(h);const r=d.beginAnimation(j,0,H,!1);return r.onAnimationEnd=Q,r}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const q of this._runtimeAnimations)if(!q.isStopped())return!0;return!1}constructor(q,f,j,d,g,h){this.name=q,this.targetProperty=f,this.framePerSecond=j,this.dataType=d,this.loopMode=g,this.enableBlending=h,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this._coreAnimation=null,this.targetPropertyPath=f.split("."),this.dataType=d,this.loopMode=void 0===g?w.ANIMATIONLOOPMODE_CYCLE:g,this.uniqueId=w._UniqueIdGenerator++}toString(q){let f="Name: "+this.name+", property: "+this.targetProperty;if(f+=", datatype: "+["Float","kf","Quaternion","Matrix","o","Vector2"][this.dataType],f+=", nKeys: "+(this._keys?this._keys.length:"none"),f+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),q){f+=", Ranges: {";let q=!0;for(const j in this._ranges)q&&(f+=", ",q=!1),f+=j;f+="}"}return f}addEvent(q){this._events.push(q),this._events.sort(((q,f)=>q.frame-f.frame))}removeEvents(q){for(let f=0;f<this._events.length;f++)this._events[f].frame===q&&(this._events.splice(f,1),f--)}getEvents(){return this._events}createRange(q,f,j){this._ranges[q]||(this._ranges[q]=new Q.b(q,f,j))}deleteRange(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const j=this._ranges[q];if(j){if(f){const q=j.from,f=j.to;for(let j=this._keys.length-1;j>=0;j--)this._keys[j].frame>=q&&this._keys[j].frame<=f&&this._keys.splice(j,1)}this._ranges[q]=null}}getRange(q){return this._ranges[q]}getKeys(){return this._keys}getHighestFrame(){let q=0;for(let f=0,j=this._keys.length;f<j;f++)q<this._keys[f].frame&&(q=this._keys[f].frame);return q}getEasingFunction(){return this._easingFunction}setEasingFunction(q){this._easingFunction=q}floatInterpolateFunction(q,f,j){return(0,h.Lerp)(q,f,j)}floatInterpolateFunctionWithTangents(q,f,j,d,g){return(0,h.Hermite)(q,f,j,d,g)}quaternionInterpolateFunction(q,f,j){return d.e.Slerp(q,f,j)}quaternionInterpolateFunctionWithTangents(q,f,j,g,h){return d.e.Hermite(q,f,j,g,h).normalize()}vector3InterpolateFunction(q,f,j){return d.j.Lerp(q,f,j)}vector3InterpolateFunctionWithTangents(q,f,j,g,h){return d.j.Hermite(q,f,j,g,h)}vector2InterpolateFunction(q,f,j){return d.i.Lerp(q,f,j)}vector2InterpolateFunctionWithTangents(q,f,j,g,h){return d.i.Hermite(q,f,j,g,h)}sizeInterpolateFunction(q,f,j){return r.b.Lerp(q,f,j)}color3InterpolateFunction(q,f,j){return g.c.Lerp(q,f,j)}color3InterpolateFunctionWithTangents(q,f,j,d,h){return g.c.Hermite(q,f,j,d,h)}color4InterpolateFunction(q,f,j){return g.e.Lerp(q,f,j)}color4InterpolateFunctionWithTangents(q,f,j,d,h){return g.e.Hermite(q,f,j,d,h)}_getKeyValue(q){return"function"===typeof q?q():q}evaluate(q){return N.key=0,this._interpolate(q,N)}_interpolate(q,f){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(f.loopMode===w.ANIMATIONLOOPMODE_CONSTANT&&f.repeatCount>0)return f.highLimitValue.clone?f.highLimitValue.clone():f.highLimitValue;const d=this._keys;let g;if(this._coreAnimation)g=this._coreAnimation._key;else{const h=d.length;for(g=f.key;g>=0&&q<d[g].frame;)--g;for(;g+1<=h-1&&q>=d[g+1].frame;)++g;if(f.key=g,g<0)return j?void 0:this._getKeyValue(d[0].value);if(g+1>h-1)return j?void 0:this._getKeyValue(d[h-1].value);this._key=g}const h=d[g],L=d[g+1];if(j&&(q===h.frame||q===L.frame))return;const Q=this._getKeyValue(h.value),H=this._getKeyValue(L.value);if(1===h.interpolation)return L.frame>q?Q:H;const r=void 0!==h.outTangent&&void 0!==L.inTangent,u=L.frame-h.frame;let X=(q-h.frame)/u;const N=h.easingFunction||this.getEasingFunction();switch(N&&(X=N.ease(X)),this.dataType){case w.ANIMATIONTYPE_FLOAT:{const q=r?this.floatInterpolateFunctionWithTangents(Q,h.outTangent*u,H,L.inTangent*u,X):this.floatInterpolateFunction(Q,H,X);switch(f.loopMode){case w.ANIMATIONLOOPMODE_CYCLE:case w.ANIMATIONLOOPMODE_CONSTANT:case w.ANIMATIONLOOPMODE_YOYO:return q;case w.ANIMATIONLOOPMODE_RELATIVE:case w.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(f.offsetValue??0)*f.repeatCount+q}break}case w.ANIMATIONTYPE_QUATERNION:{const q=r?this.quaternionInterpolateFunctionWithTangents(Q,h.outTangent.scale(u),H,L.inTangent.scale(u),X):this.quaternionInterpolateFunction(Q,H,X);switch(f.loopMode){case w.ANIMATIONLOOPMODE_CYCLE:case w.ANIMATIONLOOPMODE_CONSTANT:case w.ANIMATIONLOOPMODE_YOYO:return q;case w.ANIMATIONLOOPMODE_RELATIVE:case w.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return q.addInPlace((f.offsetValue||z).scale(f.repeatCount))}return q}case w.ANIMATIONTYPE_VECTOR3:{const q=r?this.vector3InterpolateFunctionWithTangents(Q,h.outTangent.scale(u),H,L.inTangent.scale(u),X):this.vector3InterpolateFunction(Q,H,X);switch(f.loopMode){case w.ANIMATIONLOOPMODE_CYCLE:case w.ANIMATIONLOOPMODE_CONSTANT:case w.ANIMATIONLOOPMODE_YOYO:return q;case w.ANIMATIONLOOPMODE_RELATIVE:case w.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return q.add((f.offsetValue||B).scale(f.repeatCount))}break}case w.ANIMATIONTYPE_VECTOR2:{const q=r?this.vector2InterpolateFunctionWithTangents(Q,h.outTangent.scale(u),H,L.inTangent.scale(u),X):this.vector2InterpolateFunction(Q,H,X);switch(f.loopMode){case w.ANIMATIONLOOPMODE_CYCLE:case w.ANIMATIONLOOPMODE_CONSTANT:case w.ANIMATIONLOOPMODE_YOYO:return q;case w.ANIMATIONLOOPMODE_RELATIVE:case w.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return q.add((f.offsetValue||D).scale(f.repeatCount))}break}case w.ANIMATIONTYPE_SIZE:switch(f.loopMode){case w.ANIMATIONLOOPMODE_CYCLE:case w.ANIMATIONLOOPMODE_CONSTANT:case w.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(Q,H,X);case w.ANIMATIONLOOPMODE_RELATIVE:case w.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(Q,H,X).add((f.offsetValue||i).scale(f.repeatCount))}break;case w.ANIMATIONTYPE_COLOR3:{const q=r?this.color3InterpolateFunctionWithTangents(Q,h.outTangent.scale(u),H,L.inTangent.scale(u),X):this.color3InterpolateFunction(Q,H,X);switch(f.loopMode){case w.ANIMATIONLOOPMODE_CYCLE:case w.ANIMATIONLOOPMODE_CONSTANT:case w.ANIMATIONLOOPMODE_YOYO:return q;case w.ANIMATIONLOOPMODE_RELATIVE:case w.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return q.add((f.offsetValue||t).scale(f.repeatCount))}break}case w.ANIMATIONTYPE_COLOR4:{const q=r?this.color4InterpolateFunctionWithTangents(Q,h.outTangent.scale(u),H,L.inTangent.scale(u),X):this.color4InterpolateFunction(Q,H,X);switch(f.loopMode){case w.ANIMATIONLOOPMODE_CYCLE:case w.ANIMATIONLOOPMODE_CONSTANT:case w.ANIMATIONLOOPMODE_YOYO:return q;case w.ANIMATIONLOOPMODE_RELATIVE:case w.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return q.add((f.offsetValue||O).scale(f.repeatCount))}break}case w.ANIMATIONTYPE_MATRIX:switch(f.loopMode){case w.ANIMATIONLOOPMODE_CYCLE:case w.ANIMATIONLOOPMODE_CONSTANT:case w.ANIMATIONLOOPMODE_YOYO:return w.AllowMatricesInterpolation?this.matrixInterpolateFunction(Q,H,X,f.workValue):Q;case w.ANIMATIONLOOPMODE_RELATIVE:case w.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return Q}}return 0}matrixInterpolateFunction(q,f,j,g){return w.AllowMatrixDecomposeForInterpolation?g?(d.b.DecomposeLerpToRef(q,f,j,g),g):d.b.DecomposeLerp(q,f,j):g?(d.b.LerpToRef(q,f,j,g),g):d.b.Lerp(q,f,j)}clone(){const q=new w(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(q.enableBlending=this.enableBlending,q.blendingSpeed=this.blendingSpeed,this._keys&&q.setKeys(this._keys),this._ranges){q._ranges={};for(const f in this._ranges){const j=this._ranges[f];j&&(q._ranges[f]=j.clone())}}return q}setKeys(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=f?q:q.slice(0)}createKeyForFrame(q){N.key=0;const f=this._interpolate(q,N,!0);if(!f)return this._keys[N.key].frame===q?N.key:N.key+1;const j={frame:q,value:f.clone?f.clone():f};return this._keys.splice(N.key+1,0,j),N.key+1}serialize(){const q={};q.name=this.name,q.property=this.targetProperty,q.framePerSecond=this.framePerSecond,q.dataType=this.dataType,q.loopBehavior=this.loopMode,q.enableBlending=this.enableBlending,q.blendingSpeed=this.blendingSpeed;const f=this.dataType;q.keys=[];const j=this.getKeys();for(let d=0;d<j.length;d++){const g=j[d],h={};switch(h.frame=g.frame,f){case w.ANIMATIONTYPE_FLOAT:h.values=[g.value],void 0!==g.inTangent&&h.values.push(g.inTangent),void 0!==g.outTangent&&(void 0===g.inTangent&&h.values.push(void 0),h.values.push(g.outTangent)),void 0!==g.interpolation&&(void 0===g.inTangent&&h.values.push(void 0),void 0===g.outTangent&&h.values.push(void 0),h.values.push(g.interpolation));break;case w.ANIMATIONTYPE_QUATERNION:case w.ANIMATIONTYPE_MATRIX:case w.ANIMATIONTYPE_VECTOR3:case w.ANIMATIONTYPE_COLOR3:case w.ANIMATIONTYPE_COLOR4:h.values=g.value.Yf(),void 0!=g.inTangent&&h.values.push(g.inTangent.Yf()),void 0!=g.outTangent&&(void 0===g.inTangent&&h.values.push(void 0),h.values.push(g.outTangent.Yf())),void 0!==g.interpolation&&(void 0===g.inTangent&&h.values.push(void 0),void 0===g.outTangent&&h.values.push(void 0),h.values.push(g.interpolation))}q.keys.push(h)}q.ranges=[];for(const d in this._ranges){const f=this._ranges[d];if(!f)continue;const j={};j.name=d,j.from=f.from,j.to=f.to,q.ranges.push(j)}return q}static _UniversalLerp(q,f,j){const d=q.constructor;return d.Lerp?d.Lerp(q,f,j):d.Slerp?d.Slerp(q,f,j):q.toFixed?q*(1-j)+j*f:f}static Parse(q){const f=new w(q.name,q.property,q.framePerSecond,q.dataType,q.loopBehavior),j=q.dataType,h=[];let L,Q;for(q.enableBlending&&(f.enableBlending=q.enableBlending),q.blendingSpeed&&(f.blendingSpeed=q.blendingSpeed),Q=0;Q<q.keys.length;Q++){const f=q.keys[Q];let H,r,u;switch(j){case w.ANIMATIONTYPE_FLOAT:L=f.values[0],f.values.length>=2&&(H=f.values[1]),f.values.length>=3&&(r=f.values[2]),f.values.length>=4&&(u=f.values[3]);break;case w.ANIMATIONTYPE_QUATERNION:if(L=d.e.Pf(f.values),f.values.length>=8){const q=d.e.Pf(f.values.slice(4,8));q.equals(d.e.Zero())||(H=q)}if(f.values.length>=12){const q=d.e.Pf(f.values.slice(8,12));q.equals(d.e.Zero())||(r=q)}f.values.length>=13&&(u=f.values[12]);break;case w.ANIMATIONTYPE_MATRIX:L=d.b.Pf(f.values),f.values.length>=17&&(u=f.values[16]);break;case w.ANIMATIONTYPE_COLOR3:L=g.c.Pf(f.values),f.values[3]&&(H=g.c.Pf(f.values[3])),f.values[4]&&(r=g.c.Pf(f.values[4])),f.values[5]&&(u=f.values[5]);break;case w.ANIMATIONTYPE_COLOR4:L=g.e.Pf(f.values),f.values[4]&&(H=g.e.Pf(f.values[4])),f.values[5]&&(r=g.e.Pf(f.values[5])),f.values[6]&&(u=g.e.Pf(f.values[6]));break;case w.ANIMATIONTYPE_VECTOR3:default:L=d.j.Pf(f.values),f.values[3]&&(H=d.j.Pf(f.values[3])),f.values[4]&&(r=d.j.Pf(f.values[4])),f.values[5]&&(u=f.values[5])}const X={};X.frame=f.frame,X.value=L,void 0!=H&&(X.inTangent=H),void 0!=r&&(X.outTangent=r),void 0!=u&&(X.interpolation=u),h.push(X)}if(f.setKeys(h),q.ranges)for(Q=0;Q<q.ranges.length;Q++)L=q.ranges[Q],f.createRange(L.name,L.from,L.to);return f}static AppendSerializedAnimations(q,f){X.d.AppendSerializedAnimations(q,f)}static async ParseFromFileAsync(q,f){return await new Promise(((j,d)=>{const g=new u.c;g.addEventListener("readystatechange",(()=>{if(4==g.readyState)if(200==g.status){let f=JSON.parse(g.responseText);if(f.animations&&(f=f.animations),f.length){const q=[];for(const j of f)q.push(this.Parse(j));j(q)}else{const d=this.Parse(f);q&&(d.name=q),j(d)}}else d("Unable to load the animation")})),g.open("GET",f),g.send()}))}static async ParseFromSnippetAsync(q){return await new Promise(((f,j)=>{const d=new u.c;d.addEventListener("readystatechange",(()=>{if(4==d.readyState)if(200==d.status){const j=JSON.parse(JSON.parse(d.responseText).jsonPayload);if(j.animations){const d=JSON.parse(j.animations),g=[];for(const f of d.animations){const j=this.Parse(f);j.snippetId=q,g.push(j)}f(g)}else{const d=JSON.parse(j.animation),g=this.Parse(d);g.snippetId=q,f(g)}}else j("Unable to load the snippet "+q)})),d.open("GET",this.SnippetUrl+"/"+q.replace(/#/g,"/")),d.send()}))}}w._UniqueIdGenerator=0,w.AllowMatricesInterpolation=!1,w.AllowMatrixDecomposeForInterpolation=!0,w.SnippetUrl="https://snippet.babylonjs.com",w.ANIMATIONTYPE_FLOAT=0,w.ANIMATIONTYPE_VECTOR3=1,w.ANIMATIONTYPE_QUATERNION=2,w.ANIMATIONTYPE_MATRIX=3,w.ANIMATIONTYPE_COLOR3=4,w.ANIMATIONTYPE_COLOR4=7,w.ANIMATIONTYPE_VECTOR2=5,w.ANIMATIONTYPE_SIZE=6,w.ANIMATIONLOOPMODE_RELATIVE=0,w.ANIMATIONLOOPMODE_CYCLE=1,w.ANIMATIONLOOPMODE_CONSTANT=2,w.ANIMATIONLOOPMODE_YOYO=4,w.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,w.CreateFromSnippetAsync=w.ParseFromSnippetAsync,(0,L.f)("BABYLON.Animation",w),H.d._AnimationRangeFactory=(q,f,j)=>new Q.b(q,f,j)},11616:(q,f,j)=>{j.d(f,{b:()=>d});class d{constructor(q,f,j){this.name=q,this.from=f,this.to=j}clone(){return new d(this.name,this.from,this.to)}}},11151:(q,f,j)=>{j.d(f,{e:()=>L,i:()=>Q});var d=j(11153),g=j(11005),h=j(11155);class L{get B(){return this._isDisposed}constructor(q,f,j){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,h=arguments.length>4&&void 0!==arguments[4]&&arguments[4],L=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],H=arguments.length>7?arguments[7]:void 0,r=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,q&&q.eq?this._engine=q.eq().getEngine():this._engine=q,this._updatable=j,this._instanced=L,this._divisor=H||1,this._label=r,f instanceof d.c?(this._data=null,this._buffer=f):(this._data=f,this._buffer=null),this.byteStride=Q?g:g*Float32Array.BYTES_PER_ELEMENT,h||this.create()}createVertexBuffer(q,f,j,d,g){let h=arguments.length>5&&void 0!==arguments[5]&&arguments[5],L=arguments.length>6?arguments[6]:void 0;const H=h?f:f*Float32Array.BYTES_PER_ELEMENT,r=d?h?d:d*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new Q(this._engine,this,q,this._updatable,!0,r,void 0===g?this._instanced:g,H,j,void 0,void 0,!0,this._divisor||L)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!q&&this._buffer||(q=q||this._data,q&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,q),this._data=q):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(q,this._label),this._data=q):this._buffer=this._engine.createVertexBuffer(q,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.Zf>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.Zf,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.Zf,void 0,this._label));g.e.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(q){this.create(q)}updateDirectly(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,q,d?f:f*Float32Array.BYTES_PER_ELEMENT,j?j*this.byteStride:void 0),this._data=0===f&&void 0===j?q:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class Q{get B(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(q){const f=0!=q;this._instanceDivisor=q,f!==this._instanced&&(this._instanced=f,this._computeHashCode())}get _maxVerticesCount(){const q=this.getData();return q?Array.isArray(q)?q.length/(this.byteStride/4)-this.byteOffset/4:(q.byteLength-this.byteOffset)/this.byteStride:0}constructor(q,f,j,d,g,H,r,u,X,z){let B=arguments.length>10&&void 0!==arguments[10]&&arguments[10],D=arguments.length>11&&void 0!==arguments[11]&&arguments[11],i=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,t=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let O=!1;if(this.gH=q,"object"===typeof d&&null!==d?(O=d.updatable??!1,g=d.postponeInternalCreation,H=d.stride,r=d.instanced,u=d.offset,X=d.size,z=d.type,B=d.normalized??!1,D=d.useBytes??!1,i=d.divisor??1,t=d.takeBufferOwnership??!1,this._label=d.label):O=!!d,f instanceof L?(this._buffer=f,this._ownsBuffer=t):(this._buffer=new L(q,f,O,H,g,r,D,i,this._label),this._ownsBuffer=!0),this.uniqueId=Q._Counter++,this._kind=j,void 0===z){const q=this.getData();this.type=q?Q.GetDataType(q):Q.FLOAT}else this.type=z;const N=(0,h.o)(this.type);D?(this._size=X||(H?H/N:Q.DeduceStride(j)),this.byteStride=H||this._buffer.byteStride||this._size*N,this.byteOffset=u||0):(this._size=X||H||Q.DeduceStride(j),this.byteStride=H?H*N:this._buffer.byteStride||this._size*N,this.byteOffset=(u||0)*N),this.normalized=B,this._instanced=void 0!==r&&r,this._instanceDivisor=r?i:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var q;null===(q=this._buffer)||void 0===q||q._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(q,f){const j=this.getData();return j?(0,h.m)(j,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,q,f):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,h.o)(this.type)}getOffset(){return this.byteOffset/(0,h.o)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,h.o)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(q){this._buffer.create(q),this._alignBuffer()}update(q){this._buffer.update(q),this._alignBuffer()}updateDirectly(q,f){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(q,f,void 0,j),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(q,f){(0,h.k)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,q,this.normalized,((q,j)=>{for(let d=0;d<this._size;d++)f(q[d],j+d)}))}_alignBuffer(){}static DeduceStride(q){switch(q){case Q.UVKind:case Q.UV2Kind:case Q.UV3Kind:case Q.UV4Kind:case Q.UV5Kind:case Q.UV6Kind:return 2;case Q.NormalKind:case Q.PositionKind:return 3;case Q.ColorKind:case Q.ColorInstanceKind:case Q.MatricesIndicesKind:case Q.MatricesIndicesExtraKind:case Q.MatricesWeightsKind:case Q.MatricesWeightsExtraKind:case Q.TangentKind:return 4;default:throw new Error("Invalid kind '"+q+"'")}}static GetDataType(q){return q instanceof Int8Array?Q.BYTE:q instanceof Uint8Array?Q.UNSIGNED_BYTE:q instanceof Int16Array?Q.SHORT:q instanceof Uint16Array?Q.UNSIGNED_SHORT:q instanceof Int32Array?Q.INT:q instanceof Uint32Array?Q.UNSIGNED_INT:Q.FLOAT}static GetTypeByteLength(q){return(0,h.o)(q)}static ForEach(q,f,j,d,g,L,Q,H){(0,h.k)(q,f,j,d,g,L,Q,((q,f)=>{for(let j=0;j<d;j++)H(q[j],f+j)}))}static GetFloatData(q,f,j,d,g,L,Q,H){return(0,h.m)(q,f,j,d,g,L,Q,H)}}Q._Counter=0,Q.BYTE=5120,Q.UNSIGNED_BYTE=5121,Q.SHORT=5122,Q.UNSIGNED_SHORT=5123,Q.INT=5124,Q.UNSIGNED_INT=5125,Q.FLOAT=5126,Q.PositionKind="position",Q.NormalKind="normal",Q.TangentKind="tangent",Q.UVKind="uv",Q.UV2Kind="uv2",Q.UV3Kind="uv3",Q.UV4Kind="uv4",Q.UV5Kind="uv5",Q.UV6Kind="uv6",Q.ColorKind="color",Q.ColorInstanceKind="instanceColor",Q.MatricesIndicesKind="matricesIndices",Q.MatricesWeightsKind="matricesWeights",Q.MatricesIndicesExtraKind="matricesIndicesExtra",Q.MatricesWeightsExtraKind="matricesWeightsExtra"},11155:(q,f,j)=>{j.d(f,{d:()=>z,g:()=>X,k:()=>H,m:()=>r,o:()=>L,q:()=>Q,t:()=>u});var d=j(11005);function g(q,f,j,d){switch(f){case 5120:{let f=q.getInt8(j);return d&&(f=Math.max(f/127,-1)),f}case 5121:{let f=q.getUint8(j);return d&&(f/=255),f}case 5122:{let f=q.getInt16(j,!0);return d&&(f=Math.max(f/32767,-1)),f}case 5123:{let f=q.getUint16(j,!0);return d&&(f/=65535),f}case 5124:return q.getInt32(j,!0);case 5125:return q.getUint32(j,!0);case 5126:return q.getFloat32(j,!0);default:throw new Error(`Invalid component type ${f}`)}}function h(q,f,j,d,g){switch(f){case 5120:d&&(g=Math.round(127*g)),q.setInt8(j,g);break;case 5121:d&&(g=Math.round(255*g)),q.setUint8(j,g);break;case 5122:d&&(g=Math.round(32767*g)),q.setInt16(j,g,!0);break;case 5123:d&&(g=Math.round(65535*g)),q.setUint16(j,g,!0);break;case 5124:q.setInt32(j,g,!0);break;case 5125:q.setUint32(j,g,!0);break;case 5126:q.setFloat32(j,g,!0);break;default:throw new Error(`Invalid component type ${f}`)}}function L(q){switch(q){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${q}'`)}}function Q(q){switch(q){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${q}'`)}}function H(q,f,j,d,Q,H,r,u){const X=new Array(d),z=new Array(d);if(q instanceof Array){let g=f/4;const h=j/4;for(let f=0;f<H;f+=d){for(let f=0;f<d;f++)X[f]=z[f]=q[g+f];u(z,f);for(let f=0;f<d;f++)X[f]!==z[f]&&(q[g+f]=z[f]);g+=h}}else{const B=ArrayBuffer.isView(q)?new DataView(q.buffer,q.byteOffset,q.byteLength):new DataView(q),D=L(Q);for(let q=0;q<H;q+=d){for(let q=0,j=f;q<d;q++,j+=D)X[q]=z[q]=g(B,Q,j,r);u(z,q);for(let q=0,j=f;q<d;q++,j+=D)X[q]!==z[q]&&h(B,Q,j,r,z[q]);f+=j}}}function r(q,f,j,g,h,Q,r,u){const X=f*L(j),z=r*f;if(5126!==j||h!==X){const d=new Float32Array(z);return H(q,g,h,f,j,z,Q,((q,j)=>{for(let g=0;g<f;g++)d[j+g]=q[g]})),d}if(!(q instanceof Array||q instanceof Float32Array)||0!==g||q.length!==z){if(q instanceof Array){const f=g/4;return q.slice(f,f+z)}if(q instanceof ArrayBuffer)return new Float32Array(q,g,z);{const f=q.byteOffset+g;return 0!==(3&f)&&(d.e.Warn("Float array must be aligned to 4-bytes border"),u=!0),u?new Float32Array(q.buffer.slice(f,f+z*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(q.buffer,f,z)}}return u?q.slice():q}function u(q,f,j,g,h,r,u,X){const z=L(j),B=Q(j),D=u*f;if(Array.isArray(q)){if(0!==(3&g)||0!==(3&h))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const d=g/4,L=h/4;if(d+(u-1)*L+f>q.length)throw new Error("Last accessed index is out of bounds.");if(L<f)throw new Error("Data stride cannot be smaller than the component size.");if(L!==f){const d=new B(D);return H(q,g,h,f,j,D,r,((q,j)=>{for(let g=0;g<f;g++)d[j+g]=q[g]})),d}return new B(q.slice(d,d+D))}let i,t=g;q instanceof ArrayBuffer?i=q:(i=q.buffer,t+=q.byteOffset);if(t+(u-1)*h+f*z>i.byteLength)throw new Error("Last accessed byte is out of bounds.");const O=f*z;if(h<O)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(h!==O){const q=new B(D);return H(i,t,h,f,j,D,r,((j,d)=>{for(let g=0;g<f;g++)q[d+g]=j[g]})),q}return 1!==z&&0!==(t&z-1)&&(d.e.Warn("Array must be aligned to border of element size. Data will be copied."),X=!0),X?new B(i.slice(t,t+D*z)):new B(i,t,D)}function X(q,f,j,g,h,Q,r,u){const X=f*L(j),z=r*f;if(u.length!==z)throw new Error("Output length is not valid");if(5126===j&&h===X)if(q instanceof Array){const f=g/4;u.set(q,f)}else if(q instanceof ArrayBuffer){const f=new Float32Array(q,g,z);u.set(f)}else{const f=q.byteOffset+g;if(0!==(3&f))return d.e.Warn("Float array must be aligned to 4-bytes border"),void u.set(new Float32Array(q.buffer.slice(f,f+z*Float32Array.BYTES_PER_ELEMENT)));const j=new Float32Array(q.buffer,f,z);u.set(j)}else H(q,g,h,f,j,z,Q,((q,j)=>{for(let d=0;d<f;d++)u[j+d]=q[d]}))}function z(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(q)){for(let g=0;g<f;g++)if(q[j+g]-d>65535)return!0;return!1}return 4===q.BYTES_PER_ELEMENT}},11153:(q,f,j)=>{j.d(f,{c:()=>d});class d{get underlyingResource(){return null}constructor(){this.references=0,this.Zf=0,this.is32Bits=!1,this.uniqueId=d._Counter++}}d._Counter=0},11293:(q,f,j)=>{j.d(f,{d:()=>t});var d=j(11125),g=j(11130),h=j(11298),L=j(10992),Q=j(10982),H=j(10941),r=j(11247),u=j(11005),X=j(10965),z=j(11016),B=j(11300),D=j(11303),i=j(11199);class t extends r.d{get position(){return this._position}set position(q){this._position=q}set upVector(q){this._upVector=q}get upVector(){return this._upVector}get screenArea(){let q=0,f=0;if(this.mode===t.PERSPECTIVE_CAMERA)this.fovMode===t.FOVMODE_VERTICAL_FIXED?(f=2*this.gd*Math.tan(this.fov/2),q=this.getEngine().getAspectRatio(this)*f):(q=2*this.gd*Math.tan(this.fov/2),f=q/this.getEngine().getAspectRatio(this));else{const j=this.getEngine().getRenderWidth()/2,d=this.getEngine().getRenderHeight()/2;q=(this.orthoRight??j)-(this.orthoLeft??-j),f=(this.orthoTop??d)-(this.orthoBottom??-d)}return q*f}set orthoLeft(q){this._orthoLeft=q;for(const f of this._rigCameras)f.orthoLeft=q}get orthoLeft(){return this._orthoLeft}set orthoRight(q){this._orthoRight=q;for(const f of this._rigCameras)f.orthoRight=q}get orthoRight(){return this._orthoRight}set orthoBottom(q){this._orthoBottom=q;for(const f of this._rigCameras)f.orthoBottom=q}get orthoBottom(){return this._orthoBottom}set orthoTop(q){this._orthoTop=q;for(const f of this._rigCameras)f.orthoTop=q}get orthoTop(){return this._orthoTop}setFocalLength(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:36;this.fov=2*Math.atan(f/(2*q))}set mode(q){this._mode=q;for(const f of this._rigCameras)f.mode=q}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(q,f,j){let d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(q,j,!1),this._position=H.j.Zero(),this._upVector=H.j.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.gd=1,this.maxZ=1e4,this.inertia=.9,this._mode=t.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new B.e(0,0,1,1),this.layerMask=268435455,this.fovMode=t.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=t.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new Q.d,this.onProjectionMatrixChangedObservable=new Q.d,this.onAfterCheckInputsObservable=new Q.d,this.onRestoreStateObservable=new Q.d,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new H.b,this._postProcesses=new Array,this._activeMeshes=new h.g(256),this._globalPosition=H.j.Zero(),this._computedViewMatrix=H.b.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=H.b.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=H.e.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.eq().addCamera(this),d&&!this.eq().activeCamera&&(this.eq().activeCamera=this),this.position=f,this.renderPassId=this.eq().getEngine().createRenderPassId(`Camera ${q}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"ou"}toString(q){let f="Name: "+this.name;if(f+=", type: "+this.getClassName(),this.animations)for(let j=0;j<this.animations.length;j++)f+=", animation[0]: "+this.animations[j].toString(q);return f}applyVerticalCorrection(){const q=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-q.x:q.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(q){return-1!==this._activeMeshes.indexOf(q)}isReady(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(q)for(const f of this._postProcesses)if(f&&!f.isReady())return!1;return super.isReady(q)}_initCache(){super._initCache(),this._cache.position=new H.j(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new H.j(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.gd=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(q){q||super._updateCache(),this._cache.position.H(this.position),this._cache.upVector.H(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let q=this._cache.mode===this.mode&&this._cache.gd===this.gd&&this._cache.maxZ===this.maxZ;if(!q)return!1;const f=this.getEngine();return this.mode===t.PERSPECTIVE_CAMERA?q=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===f.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(q=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===f.getRenderWidth()&&this._cache.renderHeight===f.getRenderHeight(),this.oblique&&(q=q&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),q}attachControl(q,f){}qz(q){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==t.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let q=0;q<this._postProcesses.length;q++)if(null!==this._postProcesses[q])return this._postProcesses[q];return null}_cascadePostProcessesToRigCams(){const q=this._getFirstPostProcess();q&&q.markTextureDirty();for(let f=0,j=this._rigCameras.length;f<j;f++){const q=this._rigCameras[f],j=q._rigPostProcess;if(j){"pass"===j.getEffectName()&&(q.isIntermediate=0===this._postProcesses.length),q._postProcesses=this._postProcesses.slice(0).concat(j),j.markTextureDirty()}else q._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!q.isReusable()&&this._postProcesses.indexOf(q)>-1?(u.e.Error("You're trying to reuse a post process not defined as reusable."),0):(null==f||f<0?this._postProcesses.push(q):null===this._postProcesses[f]?this._postProcesses[f]=q:this._postProcesses.splice(f,0,q),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.zu(),this._postProcesses.indexOf(q))}detachPostProcess(q){const f=this._postProcesses.indexOf(q);-1!==f&&(this._postProcesses[f]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.zu(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return H.b.Identity()}getViewMatrix(q){return!q&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.eq().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(q){this._doNotComputeProjectionMatrix=!0,void 0!==q&&(this._projectionMatrix=q)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(q){if(this._doNotComputeProjectionMatrix||!q&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.gd=this.gd,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const f=this.getEngine(),j=this.eq(),d=f.useReverseDepthBuffer;if(this.mode===t.PERSPECTIVE_CAMERA){let q;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=f.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.gd<=0&&(this.gd=.1),q=j.useRightHandedSystem?H.b.PerspectiveFovRHToRef:H.b.PerspectiveFovLHToRef,q(this.fov,f.getAspectRatio(this),d?this.maxZ:this.gd,d?this.gd:this.maxZ,this._projectionMatrix,this.fovMode===t.FOVMODE_VERTICAL_FIXED,f.isNDCHalfZRange,this.projectionPlaneTilt,d)}else{var g,h,L;const q=f.getRenderWidth()/2,Q=f.getRenderHeight()/2;j.useRightHandedSystem?this.oblique?H.b.ObliqueOffCenterRHToRef(this.orthoLeft??-q,this.orthoRight??q,this.orthoBottom??-Q,this.orthoTop??Q,d?this.maxZ:this.gd,d?this.gd:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,f.isNDCHalfZRange):H.b.OrthoOffCenterRHToRef(this.orthoLeft??-q,this.orthoRight??q,this.orthoBottom??-Q,this.orthoTop??Q,d?this.maxZ:this.gd,d?this.gd:this.maxZ,this._projectionMatrix,f.isNDCHalfZRange):this.oblique?H.b.ObliqueOffCenterLHToRef(this.orthoLeft??-q,this.orthoRight??q,this.orthoBottom??-Q,this.orthoTop??Q,d?this.maxZ:this.gd,d?this.gd:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,f.isNDCHalfZRange):H.b.OrthoOffCenterLHToRef(this.orthoLeft??-q,this.orthoRight??q,this.orthoBottom??-Q,this.orthoTop??Q,d?this.maxZ:this.gd,d?this.gd:this.maxZ,this._projectionMatrix,f.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(g=this.oblique)||void 0===g?void 0:g.angle,this._cache.obliqueLength=null===(h=this.oblique)||void 0===h?void 0:h.length,this._cache.obliqueOffset=null===(L=this.oblique)||void 0===L?void 0:L.offset,this._cache.renderWidth=f.getRenderWidth(),this._cache.renderHeight=f.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(q){return(this.radius||(this.target?H.j.Distance(this.position,this.target):this.position.length()))+q}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?D.d.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=D.d.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),f&&this.rigCameras.length>0){let f=!1;for(const j of this.rigCameras)j._updateFrustumPlanes(),f=f||q.isInFrustum(j._frustumPlanes);return f}return q.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(q){return this._updateFrustumPlanes(),q.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,z.c)("Ray")}getForwardRayToRef(q){throw(0,z.c)("Ray")}dispose(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.eq().stopAnimation(this),this.eq().removeCamera(this);this._rigCameras.length>0;){const q=this._rigCameras.pop();q&&q.dispose()}if(this._parentContainer){const q=this._parentContainer.cameras.indexOf(this);q>-1&&this._parentContainer.cameras.splice(q,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==t.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let q=this._postProcesses.length;for(;--q>=0;){const f=this._postProcesses[q];f&&f.dispose(this)}}let j=this.customRenderTargets.length;for(;--j>=0;)this.customRenderTargets[j].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.eq().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(q,f)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(q,f){if(this.cameraRigMode!==q){for(;this._rigCameras.length>0;){const q=this._rigCameras.pop();q&&q.dispose()}if(this.cameraRigMode=q,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=f.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=L.h.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==t.RIG_MODE_NONE){const q=this.createRigCamera(this.name+"_L",0);q&&(q._isLeftCamera=!0);const f=this.createRigCamera(this.name+"_R",1);f&&(f._isRightCamera=!0),q&&f&&(this._rigCameras.push(q),this._rigCameras.push(f))}this._setRigMode(f),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(q){}_getVRProjectionMatrix(){return H.b.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.gd,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(q,f){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[q]=f,"interaxialDistance"===q&&(this._cameraRigParams.stereoHalfAngle=L.h.ToRadians(f/.0637))}createRigCamera(q,f){return null}_updateRigCameras(){for(let q=0;q<this._rigCameras.length;q++)this._rigCameras[q].gd=this.gd,this._rigCameras[q].maxZ=this.maxZ,this._rigCameras[q].fov=this.fov,this._rigCameras[q].upVector.H(this.upVector);this.cameraRigMode===t.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const q=i.d.Serialize(this);return q.uniqueId=this.uniqueId,q.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(q),this.inputs&&this.inputs.serialize(q),i.d.AppendSerializedAnimations(this,q),q.ranges=this.serializeAnimationRanges(),q.isEnabled=this.isEnabled(),q}clone(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const j=i.d.Clone(t.GetConstructorFromName(this.getClassName(),q,this.eq(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return j.name=q,j.parent=f,this.onClonedObservable.notifyObservers(j),j}jr(q){const f=H.j.Zero();return this.getDirectionToRef(q,f),f}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(q,f){H.j.TransformNormalToRef(q,this.getWorldMatrix(),f)}static GetConstructorFromName(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,g=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const h=r.d.Construct(q,f,j,{interaxial_distance:d,isStereoscopicSideBySide:g});return h||(()=>t._CreateDefaultParsedCamera(f,j))}Nf(){return this.getWorldMatrix()}static Parse(q,f){const j=q.type,d=t.GetConstructorFromName(j,q.name,f,q.interaxial_distance,q.isStereoscopicSideBySide),g=i.d.Parse(d,q,f);if(void 0!==q.parentId&&(g._waitingParentId=q.parentId),void 0!==q.parentInstanceIndex&&(g._waitingParentInstanceIndex=q.parentInstanceIndex),g.inputs&&(g.inputs.parse(q),g._setupInputs()),q.upVector&&(g.upVector=H.j.Pf(q.upVector)),g.setPosition&&(g.position.Af(0,0,0),g.setPosition(H.j.Pf(q.position))),q.target&&g.setTarget&&g.setTarget(H.j.Pf(q.target)),q.cameraRigMode){const f=q.interaxial_distance?{interaxialDistance:q.interaxial_distance}:{};g.setCameraRigMode(q.cameraRigMode,f)}if(q.animations){for(let f=0;f<q.animations.length;f++){const j=q.animations[f],d=(0,X.c)("BABYLON.Animation");d&&g.animations.push(d.Parse(j))}r.d.ParseAnimationRanges(g,q,f)}return q.autoAnimate&&f.beginAnimation(g,q.autoAnimateFrom,q.autoAnimateTo,q.autoAnimateLoop,q.autoAnimateSpeed||1),void 0!==q.isEnabled&&g.DH(q.isEnabled),g}_calculateHandednessMultiplier(){let q=this.eq().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(q*=-1),q}}t._CreateDefaultParsedCamera=(q,f)=>{throw(0,z.c)("UniversalCamera")},t.PERSPECTIVE_CAMERA=0,t.ORTHOGRAPHIC_CAMERA=1,t.FOVMODE_VERTICAL_FIXED=0,t.FOVMODE_HORIZONTAL_FIXED=1,t.RIG_MODE_NONE=0,t.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,t.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,t.RIG_MODE_STEREOSCOPIC_INTERLACED=14,t.RIG_MODE_VR=20,t.RIG_MODE_CUSTOM=22,t.ForceAttachControlToAlwaysPreventDefault=!1,(0,d.b)([(0,g.M)("position")],t.prototype,"_position",void 0),(0,d.b)([(0,g.M)("upVector")],t.prototype,"_upVector",void 0),(0,d.b)([(0,g.O)()],t.prototype,"orthoLeft",null),(0,d.b)([(0,g.O)()],t.prototype,"orthoRight",null),(0,d.b)([(0,g.O)()],t.prototype,"orthoBottom",null),(0,d.b)([(0,g.O)()],t.prototype,"orthoTop",null),(0,d.b)([(0,g.O)()],t.prototype,"fov",void 0),(0,d.b)([(0,g.O)()],t.prototype,"projectionPlaneTilt",void 0),(0,d.b)([(0,g.O)()],t.prototype,"gd",void 0),(0,d.b)([(0,g.O)()],t.prototype,"maxZ",void 0),(0,d.b)([(0,g.O)()],t.prototype,"inertia",void 0),(0,d.b)([(0,g.O)()],t.prototype,"mode",null),(0,d.b)([(0,g.O)()],t.prototype,"layerMask",void 0),(0,d.b)([(0,g.O)()],t.prototype,"fovMode",void 0),(0,d.b)([(0,g.O)()],t.prototype,"cameraRigMode",void 0),(0,d.b)([(0,g.O)()],t.prototype,"interaxialDistance",void 0),(0,d.b)([(0,g.O)()],t.prototype,"isStereoscopicSideBySide",void 0)},11481:(q,f,j)=>{j.d(f,{b:()=>X});var d=j(11125),g=j(11130),h=j(11293),L=j(10941),Q=j(10950),H=j(11276);j(11247).d.AddNodeConstructor("TargetCamera",((q,f)=>()=>new X(q,L.j.Zero(),f)));const r=L.b.Zero(),u=L.e.Identity();class X extends h.d{constructor(q,f,j){super(q,f,j,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this.cameraDirection=new L.j(0,0,0),this.cameraRotation=new L.i(0,0),this.updateUpVectorFromRotation=!1,this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=L.j.Zero(),this._initialFocalDistance=1,this._viewMatrix=L.b.Zero(),this._cameraTransformMatrix=L.b.Zero(),this._cameraRotationMatrix=L.b.Zero(),this._transformedReferencePoint=L.j.Zero(),this._deferredPositionUpdate=new L.j,this._deferredRotationQuaternionUpdate=new L.e,this._deferredRotationUpdate=new L.j,this._deferredUpdated=!1,this._deferOnly=!1,this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0,this._referencePoint=L.j.Forward(this.eq().useRightHandedSystem),this.rotation=new L.j(0,this.eq().useRightHandedSystem?Math.PI:0,0)}getFrontPosition(q){this.getWorldMatrix();const f=L.f.kf[0],j=L.f.kf[1];return j.set(0,0,this._scene.useRightHandedSystem?-1:1),this.getDirectionToRef(j,f),f.scaleInPlace(q),this.globalPosition.add(f)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const q=this.lockedTarget;q.Nf().getTranslationToRef(q.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.Af(0,0,0),this.cameraRotation.Af(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new L.j(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new L.j(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new L.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(q){q||super._updateCache();const f=this._getLockedTargetPosition();f?this._cache.lockedTarget?this._cache.lockedTarget.H(f):this._cache.lockedTarget=f.clone():this._cache.lockedTarget=null,this._cache.rotation.H(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.H(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const q=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(q):!q)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const q=this.getEngine();return this.speed*Math.sqrt(q.getDeltaTime()/(100*q.getFps()))}setTarget(q){this.upVector.normalize(),this._initialFocalDistance=q.ej(this.position).length(),this.position.z===q.z&&(this.position.z+=Q.d),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),this.eq().useRightHandedSystem?L.b.LookAtRHToRef(this.position,q,L.j.UpReadOnly,r):L.b.LookAtLHToRef(this.position,q,L.j.UpReadOnly,r),r.invert();const f=this.rotationQuaternion||u;L.e.FromRotationMatrixToRef(r,f),f.toEulerAnglesToRef(this.rotation),this.rotation.z=0}get target(){return this.getTarget()}set target(q){this.setTarget(q)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(L.f.Matrix[0]),L.j.TransformNormalToRef(this.cameraDirection,L.f.Matrix[0],L.f.kf[0]),this._deferredPositionUpdate.addInPlace(L.f.kf[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.H(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.H(this._deferredPositionUpdate)}_checkInputs(){const q=this.invertRotation?-this.inverseRotationSpeed:1,f=this._decideIfNeedsToMove(),j=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.H(this.rotation),this._deferredPositionUpdate.H(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.H(this.rotationQuaternion),f&&this._updatePosition(),j){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*q,this._deferredRotationUpdate.y+=this.cameraRotation.y*q,!this.noRotationConstraint){const q=1.570796;this._deferredRotationUpdate.x>q&&(this._deferredRotationUpdate.x=q),this._deferredRotationUpdate.x<-q&&(this._deferredRotationUpdate.x=-q)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.H(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(L.e.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.H(this._deferredRotationQuaternionUpdate))}}f&&(Math.abs(this.cameraDirection.x)<this.speed*Q.d&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*Q.d&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*Q.d&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),j&&(Math.abs(this.cameraRotation.x)<this.speed*Q.d&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*Q.d&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):L.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return L.j.TransformNormalToRef(L.j.UpReadOnly,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),L.j.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?H.e.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(L.e.FromEulerVectorToRef(this.rotation,u),H.e.Y.rotateByQuaternionToRef(u,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(q,f,j){if(this.eq().useRightHandedSystem?L.b.LookAtRHToRef(q,f,j,this._viewMatrix):L.b.LookAtLHToRef(q,f,j,this._viewMatrix),this.parent){const q=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(q,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.H(q)}createRigCamera(q,f){if(this.cameraRigMode!==h.d.RIG_MODE_NONE){const f=new X(q,this.position.clone(),this.eq());return f.isRigCamera=!0,f.rigParent=this,this.cameraRigMode===h.d.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new L.e),f._cameraRigParams={},f.rotationQuaternion=new L.e),f.mode=this.mode,f.orthoLeft=this.orthoLeft,f.orthoRight=this.orthoRight,f.orthoTop=this.orthoTop,f.orthoBottom=this.orthoBottom,f}return null}_updateRigCameras(){const q=this._rigCameras[0],f=this._rigCameras[1];switch(this.Nf(),this.cameraRigMode){case h.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case h.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case h.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case h.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case h.d.RIG_MODE_STEREOSCOPIC_INTERLACED:{const j=this.cameraRigMode===h.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,d=this.cameraRigMode===h.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*j,q),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*d,f);break}case h.d.RIG_MODE_VR:q.rotationQuaternion?(q.rotationQuaternion.H(this.rotationQuaternion),f.rotationQuaternion.H(this.rotationQuaternion)):(q.rotation.H(this.rotation),f.rotation.H(this.rotation)),q.position.H(this.position),f.position.H(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(q,f){this.getTarget().subtractToRef(this.position,X._TargetFocalPoint),X._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const j=X._TargetFocalPoint.addInPlace(this.position);L.b.TranslationToRef(-j.x,-j.y,-j.z,X._TargetTransformMatrix),X._TargetTransformMatrix.multiplyToRef(L.b.RotationAxis(f.upVector,q),X._RigCamTransformMatrix),L.b.TranslationToRef(j.x,j.y,j.z,X._TargetTransformMatrix),X._RigCamTransformMatrix.multiplyToRef(X._TargetTransformMatrix,X._RigCamTransformMatrix),L.j.TransformCoordinatesToRef(this.position,X._RigCamTransformMatrix,f.position),f.setTarget(j)}getClassName(){return"TargetCamera"}}X._RigCamTransformMatrix=new L.b,X._TargetTransformMatrix=new L.b,X._TargetFocalPoint=new L.j,(0,d.b)([(0,g.O)()],X.prototype,"updateUpVectorFromRotation",void 0),(0,d.b)([(0,g.M)()],X.prototype,"rotation",void 0),(0,d.b)([(0,g.O)()],X.prototype,"speed",void 0),(0,d.b)([(0,g.x)("lockedTargetId")],X.prototype,"lockedTarget",void 0)},11161:(q,f,j)=>{j.d(f,{d:()=>d});class d{constructor(q,f,j){this.bu=q,this.bv=f,this.distance=j,this.faceId=0,this.subMeshId=0}}},11268:(q,f,j)=>{j.d(f,{d:()=>h});var d=j(10941),g=j(11151);class h{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(){var q;let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.pickedMesh||j&&!this.pickedMesh.isVerticesDataPresent(g.i.NormalKind))return null;let h,L=this.pickedMesh.sf();0===(null===(q=L)||void 0===q?void 0:q.length)&&(L=null);const Q=d.f.kf[0],H=d.f.kf[1],r=d.f.kf[2];if(j){const q=this.pickedMesh.getVerticesData(g.i.NormalKind);let f=L?d.j.FromArrayToRef(q,3*L[3*this.faceId],Q):Q.Af(q[3*this.faceId*3],q[3*this.faceId*3+1],q[3*this.faceId*3+2]),j=L?d.j.FromArrayToRef(q,3*L[3*this.faceId+1],H):H.Af(q[3*(3*this.faceId+1)],q[3*(3*this.faceId+1)+1],q[3*(3*this.faceId+1)+2]),u=L?d.j.FromArrayToRef(q,3*L[3*this.faceId+2],r):r.Af(q[3*(3*this.faceId+2)],q[3*(3*this.faceId+2)+1],q[3*(3*this.faceId+2)+2]);f=f.scale(this.bu),j=j.scale(this.bv),u=u.scale(1-this.bu-this.bv),h=new d.j(f.x+j.x+u.x,f.y+j.y+u.y,f.z+j.z+u.z)}else{const q=this.pickedMesh.getVerticesData(g.i.PositionKind),f=L?d.j.FromArrayToRef(q,3*L[3*this.faceId],Q):Q.Af(q[3*this.faceId*3],q[3*this.faceId*3+1],q[3*this.faceId*3+2]),j=L?d.j.FromArrayToRef(q,3*L[3*this.faceId+1],H):H.Af(q[3*(3*this.faceId+1)],q[3*(3*this.faceId+1)+1],q[3*(3*this.faceId+1)+2]),u=L?d.j.FromArrayToRef(q,3*L[3*this.faceId+2],r):r.Af(q[3*(3*this.faceId+2)],q[3*(3*this.faceId+2)+1],q[3*(3*this.faceId+2)+2]),X=f.ej(j),z=u.ej(j);h=d.j.Cross(X,z)}const u=(q,f)=>{if(-1!==this.thinInstanceIndex){const j=q.thinInstanceGetWorldMatrices()[this.thinInstanceIndex];j&&d.j.TransformNormalToRef(f,j,f)}let j=q.getWorldMatrix();q.nonUniformScaling&&(d.f.Matrix[0].H(j),j=d.f.Matrix[0],j.setTranslationFromFloats(0,0,0),j.invert(),j.transposeToRef(d.f.Matrix[1]),j=d.f.Matrix[1]),d.j.TransformNormalToRef(f,j,f)};if(f&&u(this.pickedMesh,h),this.ray){const q=d.f.kf[0].H(h);f||u(this.pickedMesh,q),d.j.Dot(q,this.ray.direction)>0&&h.negateInPlace()}return h.normalize(),h}getTextureCoordinates(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.i.UVKind;if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(q))return null;const f=this.pickedMesh.sf();if(!f)return null;const j=this.pickedMesh.getVerticesData(q);if(!j)return null;let h=d.i.Pf(j,2*f[3*this.faceId]),L=d.i.Pf(j,2*f[3*this.faceId+1]),Q=d.i.Pf(j,2*f[3*this.faceId+2]);return h=h.scale(this.bu),L=L.scale(this.bv),Q=Q.scale(1-this.bu-this.bv),new d.i(h.x+L.x+Q.x,h.y+L.y+Q.y)}}},11316:(q,f,j)=>{j.d(f,{b:()=>d});let d=!1},11166:(q,f,j)=>{j.d(f,{e:()=>L});var d=j(10958),g=j(10941),h=j(10950);class L{constructor(q,f,j){this.vectors=(0,d.e)(8,g.j.Zero),this.center=g.j.Zero(),this.centerWorld=g.j.Zero(),this.extendSize=g.j.Zero(),this.extendSizeWorld=g.j.Zero(),this.directions=(0,d.e)(3,g.j.Zero),this.vectorsWorld=(0,d.e)(8,g.j.Zero),this.minimumWorld=g.j.Zero(),this.maximumWorld=g.j.Zero(),this.minimum=g.j.Zero(),this.maximum=g.j.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(q,f,j)}reConstruct(q,f,j){const d=q.x,h=q.y,L=q.z,Q=f.x,H=f.y,r=f.z,u=this.vectors;this.minimum.Af(d,h,L),this.maximum.Af(Q,H,r),u[0].Af(d,h,L),u[1].Af(Q,H,r),u[2].Af(Q,h,L),u[3].Af(d,H,L),u[4].Af(d,h,r),u[5].Af(Q,H,L),u[6].Af(d,H,r),u[7].Af(Q,h,r),f.addToRef(q,this.center).scaleInPlace(.5),f.subtractToRef(q,this.extendSize).scaleInPlace(.5),this._worldMatrix=j||g.b.IdentityReadOnly,this._update(this._worldMatrix)}scale(q){const f=L._TmpVector3,j=this.maximum.subtractToRef(this.minimum,f[0]),d=j.length();j.normalizeFromLength(d);const g=d*q,h=j.scaleInPlace(.5*g),Q=this.center.subtractToRef(h,f[1]),H=this.center.addToRef(h,f[2]);return this.reConstruct(Q,H,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(q){const f=this.minimumWorld,j=this.maximumWorld,d=this.directions,h=this.vectorsWorld,L=this.vectors;if(q.isIdentity()){f.H(this.minimum),j.H(this.maximum);for(let q=0;q<8;++q)h[q].H(L[q]);this.extendSizeWorld.H(this.extendSize),this.centerWorld.H(this.center)}else{f.cf(Number.MAX_VALUE),j.cf(-Number.MAX_VALUE);for(let d=0;d<8;++d){const Q=h[d];g.j.TransformCoordinatesToRef(L[d],q,Q),f.minimizeInPlace(Q),j.maximizeInPlace(Q)}j.subtractToRef(f,this.extendSizeWorld).scaleInPlace(.5),j.addToRef(f,this.centerWorld).scaleInPlace(.5)}g.j.FromArrayToRef(q.m,0,d[0]),g.j.FromArrayToRef(q.m,4,d[1]),g.j.FromArrayToRef(q.m,8,d[2]),this._worldMatrix=q}isInFrustum(q){return L.IsInFrustum(this.vectorsWorld,q)}isCompletelyInFrustum(q){return L.IsCompletelyInFrustum(this.vectorsWorld,q)}intersectsPoint(q){const f=this.minimumWorld,j=this.maximumWorld,d=f.x,g=f.y,L=f.z,Q=j.x,H=j.y,r=j.z,u=q.x,X=q.y,z=q.z,B=-h.d;return!(Q-u<B||B>u-d)&&(!(H-X<B||B>X-g)&&!(r-z<B||B>z-L))}intersectsSphere(q){return L.IntersectsSphere(this.minimumWorld,this.maximumWorld,q.centerWorld,q.radiusWorld)}intersectsMinMax(q,f){const j=this.minimumWorld,d=this.maximumWorld,g=j.x,h=j.y,L=j.z,Q=d.x,H=d.y,r=d.z,u=q.x,X=q.y,z=q.z,B=f.x,D=f.y,i=f.z;return!(Q<u||g>B)&&(!(H<X||h>D)&&!(r<z||L>i))}dispose(){var q,f;null===(q=this._drawWrapperFront)||void 0===q||q.dispose(),null===(f=this._drawWrapperBack)||void 0===f||f.dispose()}static Intersects(q,f){return q.intersectsMinMax(f.minimumWorld,f.maximumWorld)}static IntersectsSphere(q,f,j,d){const h=L._TmpVector3[0];g.j.ClampToRef(j,q,f,h);return g.j.DistanceSquared(j,h)<=d*d}static IsCompletelyInFrustum(q,f){for(let j=0;j<6;++j){const d=f[j];for(let f=0;f<8;++f)if(d.dotCoordinate(q[f])<0)return!1}return!0}static IsInFrustum(q,f){for(let j=0;j<6;++j){let d=!0;const g=f[j];for(let f=0;f<8;++f)if(g.dotCoordinate(q[f])>=0){d=!1;break}if(d)return!1}return!0}}L._TmpVector3=(0,d.e)(3,g.j.Zero)},11164:(q,f,j)=>{j.d(f,{b:()=>X});var d=j(10958),g=j(10941),h=j(11166),L=j(11172);const Q={min:0,max:0},H={min:0,max:0},r=(q,f,j)=>{const d=g.j.Dot(f.centerWorld,q),h=Math.abs(g.j.Dot(f.directions[0],q))*f.extendSize.x+Math.abs(g.j.Dot(f.directions[1],q))*f.extendSize.y+Math.abs(g.j.Dot(f.directions[2],q))*f.extendSize.z;j.min=d-h,j.max=d+h},u=(q,f,j)=>(r(q,f,Q),r(q,j,H),!(Q.min>H.max||H.min>Q.max));class X{constructor(q,f,j){this._isLocked=!1,this.boundingBox=new h.e(q,f,j),this.boundingSphere=new L.c(q,f,j)}reConstruct(q,f,j){this.boundingBox.reConstruct(q,f,j),this.boundingSphere.reConstruct(q,f,j)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(q){this._isLocked=q}update(q){this._isLocked||(this.boundingBox._update(q),this.boundingSphere._update(q))}centerOn(q,f){const j=X._TmpVector3[0].H(q).eX(f),d=X._TmpVector3[1].H(q).addInPlace(f);return this.boundingBox.reConstruct(j,d,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(j,d,this.boundingBox.getWorldMatrix()),this}encapsulate(q){const f=g.j.Minimize(this.minimum,q),j=g.j.Maximize(this.maximum,q);return this.reConstruct(f,j,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(q){const f=g.f.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(f);const j=g.f.kf[0];return g.j.TransformCoordinatesToRef(q.boundingBox.minimumWorld,f,j),this.encapsulate(j),g.j.TransformCoordinatesToRef(q.boundingBox.maximumWorld,f,j),this.encapsulate(j),this}scale(q){return this.boundingBox.scale(q),this.boundingSphere.scale(q),this}isInFrustum(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===f||3===f)&&this.boundingSphere.isCenterInFrustum(q))return!0;if(!this.boundingSphere.isInFrustum(q))return!1;return!(1!==f&&3!==f)||this.boundingBox.isInFrustum(q)}get diagonalLength(){const q=this.boundingBox;return q.maximumWorld.subtractToRef(q.minimumWorld,X._TmpVector3[0]).length()}isCompletelyInFrustum(q){return this.boundingBox.isCompletelyInFrustum(q)}_checkCollision(q){return q._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(q){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(q)&&!!this.boundingBox.intersectsPoint(q))}intersects(q,f){if(!L.c.Intersects(this.boundingSphere,q.boundingSphere))return!1;if(!h.e.Intersects(this.boundingBox,q.boundingBox))return!1;if(!f)return!0;const j=this.boundingBox,d=q.boundingBox;return!!u(j.directions[0],j,d)&&(!!u(j.directions[1],j,d)&&(!!u(j.directions[2],j,d)&&(!!u(d.directions[0],j,d)&&(!!u(d.directions[1],j,d)&&(!!u(d.directions[2],j,d)&&(!!u(g.j.Cross(j.directions[0],d.directions[0]),j,d)&&(!!u(g.j.Cross(j.directions[0],d.directions[1]),j,d)&&(!!u(g.j.Cross(j.directions[0],d.directions[2]),j,d)&&(!!u(g.j.Cross(j.directions[1],d.directions[0]),j,d)&&(!!u(g.j.Cross(j.directions[1],d.directions[1]),j,d)&&(!!u(g.j.Cross(j.directions[1],d.directions[2]),j,d)&&(!!u(g.j.Cross(j.directions[2],d.directions[0]),j,d)&&(!!u(g.j.Cross(j.directions[2],d.directions[1]),j,d)&&!!u(g.j.Cross(j.directions[2],d.directions[2]),j,d))))))))))))))}}X._TmpVector3=(0,d.e)(2,g.j.Zero)},11172:(q,f,j)=>{j.d(f,{c:()=>h});var d=j(10958),g=j(10941);class h{constructor(q,f,j){this.center=g.j.Zero(),this.centerWorld=g.j.Zero(),this.minimum=g.j.Zero(),this.maximum=g.j.Zero(),this.reConstruct(q,f,j)}reConstruct(q,f,j){this.minimum.H(q),this.maximum.H(f);const d=g.j.Distance(q,f);f.addToRef(q,this.center).scaleInPlace(.5),this.radius=.5*d,this._update(j||g.b.IdentityReadOnly)}scale(q){const f=this.radius*q,j=h._TmpVector3,d=j[0].cf(f),g=this.center.subtractToRef(d,j[1]),L=this.center.addToRef(d,j[2]);return this.reConstruct(g,L,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(q){if(q.isIdentity())this.centerWorld.H(this.center),this.radiusWorld=this.radius;else{g.j.TransformCoordinatesToRef(this.center,q,this.centerWorld);const f=h._TmpVector3[0];g.j.TransformNormalFromFloatsToRef(1,1,1,q,f),this.radiusWorld=Math.max(Math.abs(f.x),Math.abs(f.y),Math.abs(f.z))*this.radius}}isInFrustum(q){const f=this.centerWorld,j=this.radiusWorld;for(let d=0;d<6;d++)if(q[d].dotCoordinate(f)<=-j)return!1;return!0}isCenterInFrustum(q){const f=this.centerWorld;for(let j=0;j<6;j++)if(q[j].dotCoordinate(f)<0)return!1;return!0}intersectsPoint(q){const f=g.j.DistanceSquared(this.centerWorld,q);return!(this.radiusWorld*this.radiusWorld<f)}static Intersects(q,f){const j=g.j.DistanceSquared(q.centerWorld,f.centerWorld),d=q.radiusWorld+f.radiusWorld;return!(d*d<j)}static CreateFromCenterAndRadius(q,f,j){this._TmpVector3[0].H(q),this._TmpVector3[1].Af(0,0,f),this._TmpVector3[2].H(q),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].eX(this._TmpVector3[1]);const d=new h(this._TmpVector3[0],this._TmpVector3[2]);return d._worldMatrix=j||g.b.Identity(),d}}h._TmpVector3=(0,d.e)(3,g.j.Zero)},11380:(q,f,j)=>{j(11065).b.prototype.createDepthStencilTexture=function(q,f,j){if(f.isCube){const j=q.width||q;return this._createDepthStencilCubeTexture(j,f)}return this._createDepthStencilTexture(q,f,j)}},11369:(q,f,j)=>{j(11337).ThinEngine.prototype.setAlphaMode=function(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._alphaMode!==q){switch(q){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}f||(this.depthCullingState.depthMask=0===q),this._alphaMode=q}else if(!f){const f=0===q;this.depthCullingState.depthMask!==f&&(this.depthCullingState.depthMask=f)}}},11371:(q,f,j)=>{var d=j(11337);d.ThinEngine.prototype.updateDynamicIndexBuffer=function(q,f){let j;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(q),j=q.is32Bits?f instanceof Uint32Array?f:new Uint32Array(f):f instanceof Uint16Array?f:new Uint16Array(f),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,j,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},d.ThinEngine.prototype.updateDynamicVertexBuffer=function(q,f,j,d){this.bindArrayBuffer(q),void 0===j&&(j=0);const g=f.byteLength||f.length;void 0===d||d>=g&&0===j?f instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,j,new Float32Array(f)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,j,f):f instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,j,new Float32Array(f).subarray(0,d/4)):(f=f instanceof ArrayBuffer?new Uint8Array(f,0,d):new Uint8Array(f.buffer,f.byteOffset,d),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,j,f)),this._resetVertexBufferBinding()}},11376:(q,f,j)=>{var d=j(11090),g=j(11005),h=j(11337),L=j(11378),Q=j(11362);class H extends L.c{setDepthStencilTexture(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(super.setDepthStencilTexture(q,f),!q)return;const j=this._engine,d=this._context,g=q._hardwareTexture;if(g&&q._autoMSAAManagement&&this._MSAAFramebuffer){const f=j._currentFramebuffer;j._bindUnboundFramebuffer(this._MSAAFramebuffer),d.framebufferRenderbuffer(d.FRAMEBUFFER,(0,Q.c)(q.format)?d.DEPTH_STENCIL_ATTACHMENT:d.DEPTH_ATTACHMENT,d.RENDERBUFFER,g.getMSAARenderBuffer()),j._bindUnboundFramebuffer(f)}}constructor(q,f,j,d,g){super(q,f,j,d),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=g}_cloneRenderTargetWrapper(){let q=null;return this._colorTextureArray&&this._depthStencilTextureArray?(q=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),q.texture.isReady=!0):q=super._cloneRenderTargetWrapper(),q}_swapRenderTargetWrapper(q){super._swapRenderTargetWrapper(q),q._framebuffer=this._framebuffer,q._depthStencilBuffer=this._depthStencilBuffer,q._MSAAFramebuffer=this._MSAAFramebuffer,q._colorTextureArray=this._colorTextureArray,q._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,h=arguments.length>5?arguments[5]:void 0;if(this._depthStencilBuffer){const q=this._engine,f=q._currentFramebuffer,j=this._context;q._bindUnboundFramebuffer(this._framebuffer),j.framebufferRenderbuffer(j.FRAMEBUFFER,j.DEPTH_STENCIL_ATTACHMENT,j.RENDERBUFFER,null),j.framebufferRenderbuffer(j.FRAMEBUFFER,j.DEPTH_ATTACHMENT,j.RENDERBUFFER,null),j.framebufferRenderbuffer(j.FRAMEBUFFER,j.STENCIL_ATTACHMENT,j.RENDERBUFFER,null),q._bindUnboundFramebuffer(f),j.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(q,f,j,d,g,h)}shareDepth(q){super.shareDepth(q);const f=this._context,j=this._depthStencilBuffer,d=q._MSAAFramebuffer||q._framebuffer,g=this._engine;q._depthStencilBuffer&&q._depthStencilBuffer!==j&&f.deleteRenderbuffer(q._depthStencilBuffer),q._depthStencilBuffer=j;const h=q._generateStencilBuffer?f.DEPTH_STENCIL_ATTACHMENT:f.DEPTH_ATTACHMENT;g._bindUnboundFramebuffer(d),f.framebufferRenderbuffer(f.FRAMEBUFFER,h,f.RENDERBUFFER,j),g._bindUnboundFramebuffer(null)}_bindTextureRenderTarget(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2?arguments[2]:void 0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const g=q._hardwareTexture;if(!g)return;const h=this._framebuffer,L=this._engine,Q=L._currentFramebuffer;let H;if(L._bindUnboundFramebuffer(h),L.webGLVersion>1){const h=this._context;var r;if(H=h["COLOR_ATTACHMENT"+f],q.is2DArray||q.is3D)j=j??(null===(r=this.layerIndices)||void 0===r?void 0:r[f])??0,h.framebufferTextureLayer(h.FRAMEBUFFER,H,g.underlyingResource,d,j);else if(q.isCube){var u;j=j??(null===(u=this.faceIndices)||void 0===u?void 0:u[f])??0,h.framebufferTexture2D(h.FRAMEBUFFER,H,h.TEXTURE_CUBE_MAP_POSITIVE_X+j,g.underlyingResource,d)}else h.framebufferTexture2D(h.FRAMEBUFFER,H,h.TEXTURE_2D,g.underlyingResource,d)}else{const q=this._context;H=q["COLOR_ATTACHMENT"+f+"_WEBGL"];const h=void 0!==j?q.TEXTURE_CUBE_MAP_POSITIVE_X+j:q.TEXTURE_2D;q.framebufferTexture2D(q.FRAMEBUFFER,H,h,g.underlyingResource,d)}if(q._autoMSAAManagement&&this._MSAAFramebuffer){const q=this._context;L._bindUnboundFramebuffer(this._MSAAFramebuffer),q.framebufferRenderbuffer(q.FRAMEBUFFER,H,q.RENDERBUFFER,g.getMSAARenderBuffer())}L._bindUnboundFramebuffer(Q)}setTexture(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super.setTexture(q,f,j),this._bindTextureRenderTarget(q,f)}setLayerAndFaceIndices(q,f){var j;if(super.setLayerAndFaceIndices(q,f),!this.textures||!this.layerIndices||!this.faceIndices)return;const d=(null===(j=this._attachments)||void 0===j?void 0:j.length)??this.textures.length;for(let g=0;g<d;g++){const q=this.textures[g];q&&(q.is2DArray||q.is3D?this._bindTextureRenderTarget(q,g,this.layerIndices[g]):q.isCube?this._bindTextureRenderTarget(q,g,this.faceIndices[g]):this._bindTextureRenderTarget(q,g))}}setLayerAndFaceIndex(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1?arguments[1]:void 0,j=arguments.length>2?arguments[2]:void 0;if(super.setLayerAndFaceIndex(q,f,j),!this.textures||!this.layerIndices||!this.faceIndices)return;const d=this.textures[q];d.is2DArray||d.is3D?this._bindTextureRenderTarget(this.textures[q],q,this.layerIndices[q]):d.isCube&&this._bindTextureRenderTarget(this.textures[q],q,this.faceIndices[q])}resolveMSAATextures(){const q=this._engine,f=q._currentFramebuffer;q._bindUnboundFramebuffer(this._MSAAFramebuffer),super.resolveMSAATextures(),q._bindUnboundFramebuffer(f)}dispose(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._disposeOnlyFramebuffers;const f=this._context;q||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(f.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(f.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(f.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(q)}}j(11380);h.ThinEngine.prototype._createHardwareRenderTargetWrapper=function(q,f,j){const d=new H(q,f,j,this,this._gl);return this._renderTargetWrapperCache.push(d),d},h.ThinEngine.prototype.createRenderTargetTexture=function(q,f){const j=this._createHardwareRenderTargetWrapper(!1,!1,q);let d,g,h=!0,L=!1,Q=!1,H=1;void 0!==f&&"object"===typeof f&&(h=f.generateDepthBuffer??!0,L=!!f.generateStencilBuffer,Q=!!f.noColorAttachment,d=f.colorAttachment,H=f.samples??1,g=f.label);const r=d||(Q?null:this._createInternalTexture(q,f,!0,5)),u=q.width||q,X=q.height||q,z=this._currentFramebuffer,B=this._gl,D=B.createFramebuffer();if(this._bindUnboundFramebuffer(D),j._depthStencilBuffer=this._setupFramebufferDepthAttachments(L,h,u,X),!r||r.is2DArray||r.is3D||B.framebufferTexture2D(B.FRAMEBUFFER,B.COLOR_ATTACHMENT0,B.TEXTURE_2D,r._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(z),j.label=g??"RenderTargetWrapper",j._framebuffer=D,j._generateDepthBuffer=h,j._generateStencilBuffer=L,j.setTextures(r),d){if(j._samples=d.samples,d.samples>1){const q=d._hardwareTexture.getMSAARenderBuffer(0);j._MSAAFramebuffer=B.createFramebuffer(),this._bindUnboundFramebuffer(j._MSAAFramebuffer),B.framebufferRenderbuffer(B.FRAMEBUFFER,B.COLOR_ATTACHMENT0,B.RENDERBUFFER,q),this._bindUnboundFramebuffer(null)}}else this.updateRenderTargetTextureSampleCount(j,H);return j},h.ThinEngine.prototype._createDepthStencilTexture=function(q,f,j){const h=this._gl,L=q.layers||0,H=q.depth||0;let r=h.TEXTURE_2D;0!==L?r=h.TEXTURE_2D_ARRAY:0!==H&&(r=h.TEXTURE_3D);const u=new d.c(this,12);if(u.label=f.label,!this._caps.depthTextureExtension)return g.e.Error("Depth texture is not supported by your browser or hardware."),u;const X={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...f};if(this._bindTextureDirectly(r,u,!0),this._setupDepthStencilTexture(u,q,0!==X.comparisonFunction&&X.bilinearFiltering,X.comparisonFunction,X.samples),void 0!==X.depthTextureFormat){if(15!==X.depthTextureFormat&&16!==X.depthTextureFormat&&17!==X.depthTextureFormat&&13!==X.depthTextureFormat&&14!==X.depthTextureFormat&&18!==X.depthTextureFormat)return g.e.Error(`Depth texture ${X.depthTextureFormat} format is not supported.`),u;u.format=X.depthTextureFormat}else u.format=X.generateStencil?13:16;const z=(0,Q.c)(u.format),B=this._getWebGLTextureTypeFromDepthTextureFormat(u.format),D=z?h.DEPTH_STENCIL:h.DEPTH_COMPONENT,i=this._getInternalFormatFromDepthTextureFormat(u.format,!0,z);return u.is2DArray?h.texImage3D(r,0,i,u.width,u.height,L,0,D,B,null):u.is3D?h.texImage3D(r,0,i,u.width,u.height,H,0,D,B,null):h.texImage2D(r,0,i,u.width,u.height,0,D,B,null),this._bindTextureDirectly(r,null),this._internalTexturesCache.push(u),j._depthStencilBuffer&&(h.deleteRenderbuffer(j._depthStencilBuffer),j._depthStencilBuffer=null),this._bindUnboundFramebuffer(j._MSAAFramebuffer??j._framebuffer),j._generateStencilBuffer=z,j._depthStencilTextureWithStencil=z,j._depthStencilBuffer=this._setupFramebufferDepthAttachments(j._generateStencilBuffer,j._generateDepthBuffer,j.width,j.height,j.samples,u.format),this._bindUnboundFramebuffer(null),u},h.ThinEngine.prototype.updateRenderTargetTextureSampleCount=function(q,f){var j;if(this.webGLVersion<2||!q)return 1;if(q.samples===f)return f;const d=this._gl;f=Math.min(f,this.getCaps().maxMSAASamples),q._depthStencilBuffer&&(d.deleteRenderbuffer(q._depthStencilBuffer),q._depthStencilBuffer=null),q._MSAAFramebuffer&&(d.deleteFramebuffer(q._MSAAFramebuffer),q._MSAAFramebuffer=null);const g=null===(j=q.texture)||void 0===j?void 0:j._hardwareTexture;if(null===g||void 0===g||g.releaseMSAARenderBuffers(),q.texture&&f>1&&"function"===typeof d.renderbufferStorageMultisample){const j=d.createFramebuffer();if(!j)throw new Error("Unable to create multi sampled framebuffer");q._MSAAFramebuffer=j,this._bindUnboundFramebuffer(q._MSAAFramebuffer);const h=this._createRenderBuffer(q.texture.width,q.texture.height,f,-1,this._getRGBABufferInternalSizedFormat(q.texture.type,q.texture.format,q.texture._useSRGBBuffer),d.COLOR_ATTACHMENT0,!1);if(!h)throw new Error("Unable to create multi sampled framebuffer");null===g||void 0===g||g.addMSAARenderBuffer(h)}this._bindUnboundFramebuffer(q._MSAAFramebuffer??q._framebuffer),q.texture&&(q.texture.samples=f),q._samples=f;const h=q._depthStencilTexture?q._depthStencilTexture.format:void 0;return q._depthStencilBuffer=this._setupFramebufferDepthAttachments(q._generateStencilBuffer,q._generateDepthBuffer,q.width,q.height,f,h),this._bindUnboundFramebuffer(null),f},h.ThinEngine.prototype._setupDepthStencilTexture=function(q,f,j,d){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const h=f.width??f,L=f.height??f,Q=f.layers||0,H=f.depth||0;q.baseWidth=h,q.baseHeight=L,q.width=h,q.height=L,q.is2DArray=Q>0,q.depth=Q||H,q.isReady=!0,q.samples=g,q.generateMipMaps=!1,q.samplingMode=j?2:1,q.type=0,q._comparisonFunction=d;const r=this._gl,u=this._getTextureTarget(q),X=this._getSamplingParameters(q.samplingMode,!1);r.texParameteri(u,r.TEXTURE_MAG_FILTER,X.mag),r.texParameteri(u,r.TEXTURE_MIN_FILTER,X.min),r.texParameteri(u,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(u,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===d?(r.texParameteri(u,r.TEXTURE_COMPARE_FUNC,515),r.texParameteri(u,r.TEXTURE_COMPARE_MODE,r.NONE)):(r.texParameteri(u,r.TEXTURE_COMPARE_FUNC,d),r.texParameteri(u,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE)))}},11048:(q,f,j)=>{j.d(f,{c:()=>Z,d:()=>S,j:()=>e,g:()=>v,l:()=>F});class d{constructor(){this.children=[]}isValid(q){return!0}process(q,f,j){let d="";if(this.line){let j=this.line;const u=f.processor;if(u){var g,h,L,Q,H,r;u.lineProcessor&&(j=u.lineProcessor(j,f.isFragment,f.processingContext));const d=(null===(g=f.processor)||void 0===g?void 0:g.attributeKeywordName)??"attribute",X=f.isFragment&&null!==(h=f.processor)&&void 0!==h&&h.varyingFragmentKeywordName?null===(L=f.processor)||void 0===L?void 0:L.varyingFragmentKeywordName:!f.isFragment&&null!==(Q=f.processor)&&void 0!==Q&&Q.varyingVertexKeywordName?null===(H=f.processor)||void 0===H?void 0:H.varyingVertexKeywordName:"varying";if(!f.isFragment&&u.attributeProcessor&&this.line.startsWith(d))j=u.attributeProcessor(this.line,q,f.processingContext);else if(u.varyingProcessor&&(null!==(r=u.varyingCheck)&&void 0!==r&&r.call(u,this.line,f.isFragment)||!u.varyingCheck&&this.line.startsWith(X)))j=u.varyingProcessor(this.line,f.isFragment,q,f.processingContext);else if(u.uniformProcessor&&u.uniformRegexp&&u.uniformRegexp.test(this.line))f.lookForClosingBracketForUniformBuffer||(j=u.uniformProcessor(this.line,f.isFragment,q,f.processingContext));else if(u.uniformBufferProcessor&&u.uniformBufferRegexp&&u.uniformBufferRegexp.test(this.line))f.lookForClosingBracketForUniformBuffer||(j=u.uniformBufferProcessor(this.line,f.isFragment,f.processingContext),f.lookForClosingBracketForUniformBuffer=!0);else if(u.textureProcessor&&u.textureRegexp&&u.textureRegexp.test(this.line))j=u.textureProcessor(this.line,f.isFragment,q,f.processingContext);else if((u.uniformProcessor||u.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!f.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?u.uniformProcessor&&(j=u.uniformProcessor(this.line,f.isFragment,q,f.processingContext)):u.uniformBufferProcessor&&(j=u.uniformBufferProcessor(this.line,f.isFragment,f.processingContext),f.lookForClosingBracketForUniformBuffer=!0)}f.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(f.lookForClosingBracketForUniformBuffer=!1,u.endOfUniformBufferProcessor&&(j=u.endOfUniformBufferProcessor(this.line,f.isFragment,f.processingContext)))}d+=j+"\n"}for(const u of this.children)d+=u.process(q,f,j);return this.additionalDefineKey&&(q[this.additionalDefineKey]=this.additionalDefineValue||"true",j[this.additionalDefineKey]=q[this.additionalDefineKey]),d}}class g{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(q){this._lines.length=0;for(const f of q){if(!f||"\r"===f)continue;if("#"===f[0]){this._lines.push(f);continue}const q=f.trim();if(!q)continue;if(q.startsWith("//")){this._lines.push(f);continue}const j=q.indexOf(";");if(-1===j)this._lines.push(q);else if(j===q.length-1)q.length>1&&this._lines.push(q);else{const q=f.split(";");for(let f=0;f<q.length;f++){let j=q[f];j&&(j=j.trim(),j&&this._lines.push(j+(f!==q.length-1?";":"")))}}}}}class h extends d{process(q,f,j){for(let d=0;d<this.children.length;d++){const g=this.children[d];if(g.isValid(q))return g.process(q,f,j)}return""}}class L extends d{isValid(q){return this.testExpression.isTrue(q)}}class Q{isTrue(q){return!0}static postfixToInfix(q){const f=[];for(const j of q)if(void 0===Q._OperatorPriority[j])f.push(j);else{const q=f[f.length-1],d=f[f.length-2];f.length-=2,f.push(`(${d}${j}${q})`)}return f[f.length-1]}static infixToPostfix(q){const f=Q._InfixToPostfixCache.get(q);if(f)return f.accessTime=Date.now(),f.result;if(!q.includes("&&")&&!q.includes("||")&&!q.includes(")")&&!q.includes("("))return[q];const j=[];let d=-1;const g=()=>{u=u.trim(),""!==u&&(j.push(u),u="")},h=q=>{d<Q._Stack.length-1&&(Q._Stack[++d]=q)},L=()=>Q._Stack[d],H=()=>-1===d?"!!INVALID EXPRESSION!!":Q._Stack[d--];let r=0,u="";for(;r<q.length;){const f=q.charAt(r),X=r<q.length-1?q.substring(r,2+r):"";if("("===f)u="",h(f);else if(")"===f){for(g();-1!==d&&"("!==L();)j.push(H());H()}else if(Q._OperatorPriority[X]>1){for(g();-1!==d&&Q._OperatorPriority[L()]>=Q._OperatorPriority[X];)j.push(H());h(X),r++}else u+=f;r++}for(g();-1!==d;)"("===L()?H():j.push(H());return Q._InfixToPostfixCache.size>=Q.InfixToPostfixCacheLimitSize&&Q.ClearCache(),Q._InfixToPostfixCache.set(q,{result:j,accessTime:Date.now()}),j}static ClearCache(){const q=Array.from(Q._InfixToPostfixCache.entries()).sort(((q,f)=>q[1].accessTime-f[1].accessTime));for(let f=0;f<Q.InfixToPostfixCacheCleanupSize;f++)Q._InfixToPostfixCache.delete(q[f][0])}}Q.InfixToPostfixCacheLimitSize=5e4,Q.InfixToPostfixCacheCleanupSize=25e3,Q._InfixToPostfixCache=new Map,Q._OperatorPriority={")":0,"(":1,"||":2,"&&":3},Q._Stack=["","","","","","","","","","","","","","","","","","","",""];class H extends Q{constructor(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=q,this.not=f}isTrue(q){let f=void 0!==q[this.define];return this.not&&(f=!f),f}}class r extends Q{isTrue(q){return this.leftOperand.isTrue(q)||this.rightOperand.isTrue(q)}}class u extends Q{isTrue(q){return this.leftOperand.isTrue(q)&&this.rightOperand.isTrue(q)}}class X extends Q{constructor(q,f,j){super(),this.define=q,this.operand=f,this.testValue=j}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(q){let f=!1;const j=parseInt(void 0!=q[this.define]?q[this.define]:this.define),d=parseInt(void 0!=q[this.testValue]?q[this.testValue]:this.testValue);if(isNaN(j)||isNaN(d))return!1;switch(this.operand){case">":f=j>d;break;case"<":f=j<d;break;case"<=":f=j<=d;break;case">=":f=j>=d;break;case"==":f=j===d;break;case"!=":f=j!==d}return f}}var z=j(11016),B=j(11054);const D=/defined\s*?\((.+?)\)/g,i=/defined\s*?\[(.+?)\]/g,t=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,O=/__decl__/,N=/light\{X\}.(\w*)/g,w=/\{X\}/g,E=[],s=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function S(q){q.processor&&q.processor.initializeShaders&&q.processor.initializeShaders(q.processingContext)}function e(q,f,j,d){var g;null!==(g=f.processor)&&void 0!==g&&g.preProcessShaderCode&&(q=f.processor.preProcessShaderCode(q,f.isFragment)),v(q,f,(q=>{f.processCodeAfterIncludes&&(q=f.processCodeAfterIncludes(f.isFragment?"fragment":"vertex",q,f.defines));const g=function(q,f,j){let d=function(q,f){var j;if(null!==(j=f.processor)&&void 0!==j&&j.noPrecision)return q;const d=f.shouldUseHighPrecisionShader;-1===q.indexOf("precision highp float")?q=d?"precision highp float;\n"+q:"precision mediump float;\n"+q:d||(q=q.replace("precision highp float","precision mediump float"));return q}(q,f);if(!f.processor)return d;if(0===f.processor.shaderLanguage&&-1!==d.indexOf("#version 3")&&(d=d.replace("#version 300 es",""),!f.processor.parseGLES3))return d;const g=f.defines,h=Y(f,j);f.processor.preProcessor&&(d=f.processor.preProcessor(d,g,h,f.isFragment,f.processingContext));const L={};d=U(d,h,f,L),f.processor.postProcessor&&(d=f.processor.postProcessor(d,g,f.isFragment,f.processingContext,j?{drawBuffersExtensionDisabled:!j.getCaps().drawBuffersExtension}:{},h,L));null!==j&&void 0!==j&&j._features.needShaderCodeInlining&&(d=j.inlineShaderCode(d));return d}(q,f,d);j(g,q)}))}function Z(q,f,j){return j.processor&&j.processor.finalizeShaders?j.processor.finalizeShaders(q,f,j.processingContext):{vertexCode:q,fragmentCode:f}}function I(q){const f=/defined\((.+)\)/.exec(q);if(f&&f.length)return new H(f[1].trim(),"!"===q[0]);const j=["==","!=",">=","<=","<",">"];let d="",g=0;for(d of j)if(g=q.indexOf(d),g>-1)break;if(-1===g)return new H(q);const h=q.substring(0,g).trim(),L=q.substring(g+d.length).trim();return new X(h,d,L)}function T(q,f){const j=new L,d=q.substring(0,f);let g=q.substring(f);return g=g.substring(0,(g.indexOf("//")+1||g.length+1)-1).trim(),j.testExpression="#ifdef"===d?new H(g):"#ifndef"===d?new H(g,!0):function(q){q=q.replace(D,"defined[$1]");const f=Q.infixToPostfix(q),j=[];for(const g of f)if("||"!==g&&"&&"!==g)j.push(g);else if(j.length>=2){let q=j[j.length-1],f=j[j.length-2];j.length-=2;const d="&&"==g?new u:new r;"string"===typeof q&&(q=q.replace(i,"defined($1)")),"string"===typeof f&&(f=f.replace(i,"defined($1)")),d.leftOperand="string"===typeof f?I(f):f,d.rightOperand="string"===typeof q?I(q):q,j.push(d)}let d=j[j.length-1];return"string"===typeof d&&(d=d.replace(i,"defined($1)")),"string"===typeof d?I(d):d}(g),j}function W(q,f,j,g){let h=q.currentLine;for(;n(q,j,g);){h=q.currentLine;const L=h.substring(0,5).toLowerCase();if("#else"===L){const j=new d;return f.children.push(j),void n(q,j,g)}if("#elif"===L){const q=T(h,5);f.children.push(q),j=q}}}function n(q,f,j){for(;q.canRead;){q.lineIndex++;const g=q.currentLine;if(g.indexOf("#")>=0){const d=s.exec(g);if(d&&d.length){switch(d[0]){case"#ifdef":{const d=new h;f.children.push(d);const L=T(g,6);d.children.push(L),W(q,d,L,j);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const d=new h;f.children.push(d);const L=T(g,7);d.children.push(L),W(q,d,L,j);break}case"#if":{const d=new h,L=T(g,3);f.children.push(d),d.children.push(L),W(q,d,L,j);break}}continue}}const L=new d;if(L.line=g,f.children.push(L),"#"===g[0]&&"d"===g[1]){const q=g.replace(";","").split(" ");L.additionalDefineKey=q[1],3===q.length&&(L.additionalDefineValue=q[2])}}return!1}function U(q,f,j,h){const L=new d,Q=new g;return Q.lineIndex=-1,Q.lines=q.split("\n"),n(Q,L,h),L.process(f,j,h)}function Y(q,f){var j;const d=q.defines,g={};for(const h of d){const q=h.replace("#define","").replace(";","").trim().split(" ");g[q[0]]=q.length>1?q[1]:""}return 0===(null===(j=q.processor)||void 0===j?void 0:j.shaderLanguage)&&(g.GL_ES="true"),g.__VERSION__=q.version,g[q.platformName]="true",(0,B.l)(g,null===f||void 0===f?void 0:f.isNDCHalfZRange,null===f||void 0===f?void 0:f.useReverseDepthBuffer,null===f||void 0===f?void 0:f.useExactSrgbConversions),g}function v(q,f,j){let d;for(E.length=0;null!==(d=t.exec(q));)E.push(d);let g=String(q),h=[q],L=!1;for(const Q of E){let q=Q[1];if(-1!==q.indexOf("__decl__")&&(q=q.replace(O,""),f.supportsUniformBuffers&&(q=q.replace("Vertex","Ubo").replace("Fragment","Ubo")),q+="Declaration"),!f.includesShadersStore[q]){const d=f.shadersRepository+"ShadersInclude/"+q+".fx";return void F.loadFile(d,(d=>{f.includesShadersStore[q]=d,v(h.join(""),f,j)}))}{let j=f.includesShadersStore[q];if(Q[2]){const q=Q[3].split(",");for(let f=0;f<q.length;f+=2){const d=new RegExp(q[f],"g"),g=q[f+1];j=j.replace(d,g)}}if(Q[4]){const q=Q[5];if(-1!==q.indexOf("..")){const d=q.split(".."),g=parseInt(d[0]);let h=parseInt(d[1]),L=j.slice(0);j="",isNaN(h)&&(h=f.indexParameters[d[1]]);for(let q=g;q<h;q++)f.supportsUniformBuffers||(L=L.replace(N,((q,f)=>f+"{X}"))),j+=L.replace(w,q.toString())+"\n"}else f.supportsUniformBuffers||(j=j.replace(N,((q,f)=>f+"{X}"))),j=j.replace(w,q)}const d=[];for(const q of h){const f=q.split(Q[0]);for(let q=0;q<f.length-1;q++)d.push(f[q]),d.push(j);d.push(f[f.length-1])}h=d,L=L||j.indexOf("#include<")>=0||j.indexOf("#include <")>=0}}E.length=0,g=h.join(""),L?v(g.toString(),f,j):j(g)}const F={loadFile:(q,f,j,d,g,h)=>{throw(0,z.c)("FileTools")}}},11356:(q,f,j)=>{j.d(f,{c:()=>d});class d{get underlyingResource(){return this._webGLTexture}constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,f=arguments.length>1?arguments[1]:void 0;if(this._MSAARenderBuffers=null,this._context=f,!q&&(q=f.createTexture(),!q))throw new Error("Unable to create webGL texture");this.set(q)}setUsage(){}set(q){this._webGLTexture=q}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(q){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(q)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const q of this._MSAARenderBuffers)this._context.deleteRenderbuffer(q);this._MSAARenderBuffers=null}}getMSAARenderBuffer(){var q;let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(q=this._MSAARenderBuffers)||void 0===q?void 0:q[f])??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},11054:(q,f,j)=>{j.d(f,{e:()=>g,i:()=>h,l:()=>Q,p:()=>L,t:()=>H});var d=j(11016);j(10997);const g={};function h(q,f){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(f?f+"\n":"")+q}function L(q,f,j,h,L,Q,H){const r=H||g.loadFile;if(r){return r(q,f,j,h,L,Q)}throw(0,d.c)("FileTools")}function Q(q,f,j,d){if(q)return f?q.IS_NDC_HALF_ZRANGE="":delete q.IS_NDC_HALF_ZRANGE,j?q.USE_REVERSE_DEPTHBUFFER="":delete q.USE_REVERSE_DEPTHBUFFER,void(d?q.USE_EXACT_SRGB_CONVERSIONS="":delete q.USE_EXACT_SRGB_CONVERSIONS);{let q="";return f&&(q+="#define IS_NDC_HALF_ZRANGE"),j&&(q&&(q+="\n"),q+="#define USE_REVERSE_DEPTHBUFFER"),d&&(q&&(q+="\n"),q+="#define USE_EXACT_SRGB_CONVERSIONS"),q}}function H(q,f){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3?arguments[3]:void 0;switch(q){case 3:{const q=(ArrayBuffer,new Int8Array(f));return d&&q.set(new Int8Array(d)),q}case 0:{const q=(ArrayBuffer,new Uint8Array(f));return d&&q.set(new Uint8Array(d)),q}case 4:{const q=f instanceof ArrayBuffer?new Int16Array(f):new Int16Array(j?f/2:f);return d&&q.set(new Int16Array(d)),q}case 5:case 8:case 9:case 10:case 2:{const q=f instanceof ArrayBuffer?new Uint16Array(f):new Uint16Array(j?f/2:f);return d&&q.set(new Uint16Array(d)),q}case 6:{const q=f instanceof ArrayBuffer?new Int32Array(f):new Int32Array(j?f/4:f);return d&&q.set(new Int32Array(d)),q}case 7:case 11:case 12:case 13:case 14:case 15:{const q=f instanceof ArrayBuffer?new Uint32Array(f):new Uint32Array(j?f/4:f);return d&&q.set(new Uint32Array(d)),q}case 1:{const q=f instanceof ArrayBuffer?new Float32Array(f):new Float32Array(j?f/4:f);return d&&q.set(new Float32Array(d)),q}}const g=(ArrayBuffer,new Uint8Array(f));return d&&g.set(new Uint8Array(d)),g}},11065:(q,f,j)=>{j.d(f,{b:()=>w});var d=j(10980),g=j(11005),h=j(11067),L=j(10974),Q=j(11013);class H{constructor(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,q&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(q){this._zOffset!==q&&(this._zOffset=q,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(q){this._zOffsetUnits!==q&&(this._zOffsetUnits=q,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(q){this._cullFace!==q&&(this._cullFace=q,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(q){this._cull!==q&&(this._cull=q,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(q){this._depthFunc!==q&&(this._depthFunc=q,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(q){this._depthMask!==q&&(this._depthMask=q,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(q){this._depthTest!==q&&(this._depthTest=q,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(q){this._frontFace!==q&&(this._frontFace=q,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(q){this.isDirty&&(this._isCullDirty&&(this.cull?q.enable(q.CULL_FACE):q.disable(q.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(q.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(q.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?q.enable(q.DEPTH_TEST):q.disable(q.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(q.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(q.enable(q.POLYGON_OFFSET_FILL),q.polygonOffset(this.zOffset,this.zOffsetUnits)):q.disable(q.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(q.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}class r{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(q){this._func!==q&&(this._func=q,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(q){this._funcRef!==q&&(this._funcRef=q,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(q){this._funcMask!==q&&(this._funcMask=q,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(q){this._opStencilFail!==q&&(this._opStencilFail=q,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(q){this._opDepthFail!==q&&(this._opDepthFail=q,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(q){this._opStencilDepthPass!==q&&(this._opStencilDepthPass=q,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(q){this._mask!==q&&(this._mask=q,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(q){this._enabled!==q&&(this._enabled=q,this._isStencilTestDirty=!0)}constructor(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,q&&this.reset()}reset(){var q;this.stencilMaterial=void 0,null===(q=this.stencilGlobal)||void 0===q||q.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(q){var f;if(!q)return;const j=!this.useStencilGlobalOnly&&!(null===(f=this.stencilMaterial)||void 0===f||!f.enabled);this.enabled=j?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=j?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=j?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=j?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=j?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=j?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=j?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=j?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?q.enable(q.STENCIL_TEST):q.disable(q.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(q.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(q.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(q.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}class u{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=u.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=u.KEEP,this.opDepthFail=u.KEEP,this.opStencilDepthPass=u.REPLACE}get stencilFunc(){return this.func}set stencilFunc(q){this.func=q}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(q){this.funcRef=q}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(q){this.funcMask=q}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(q){this.opStencilFail=q}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(q){this.opDepthFail=q}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(q){this.opStencilDepthPass=q}get stencilMask(){return this.mask}set stencilMask(q){this.mask=q}get stencilTest(){return this.enabled}set stencilTest(q){this.enabled=q}}u.ALWAYS=519,u.KEEP=7680,u.REPLACE=7681;class X{constructor(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._alphaBlend}set alphaBlend(q){this._alphaBlend!==q&&(this._alphaBlend=q,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(q,f,j,d){this._blendConstants[0]===q&&this._blendConstants[1]===f&&this._blendConstants[2]===j&&this._blendConstants[3]===d||(this._blendConstants[0]=q,this._blendConstants[1]=f,this._blendConstants[2]=j,this._blendConstants[3]=d,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(q,f,j,d){this._blendFunctionParameters[0]===q&&this._blendFunctionParameters[1]===f&&this._blendFunctionParameters[2]===j&&this._blendFunctionParameters[3]===d||(this._blendFunctionParameters[0]=q,this._blendFunctionParameters[1]=f,this._blendFunctionParameters[2]=j,this._blendFunctionParameters[3]=d,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(q,f){this._blendEquationParameters[0]===q&&this._blendEquationParameters[1]===f||(this._blendEquationParameters[0]=q,this._blendEquationParameters[1]=f,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(q){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?q.enable(q.BLEND):q.disable(q.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(q.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(q.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(q.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}var z=j(11016),B=j(11090),D=j(10997),i=j(10982),t=j(11054),O=j(11096);function N(q,f){if((0,D.h)()){const{requestAnimationFrame:j}=f||window;if("function"===typeof j)return j(q)}else if("function"===typeof requestAnimationFrame)return requestAnimationFrame(q);return setTimeout(q,16)}class w{get frameId(){return this._frameId}get isWebGPU(){return this._isWebGPU}_getShaderProcessor(q){return this._shaderProcessor}get shaderPlatformName(){return this._shaderPlatformName}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}set useReverseDepthBuffer(q){q!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=q,this._depthCullingState.depthFunc=q?518:515)}setColorWrite(q){q!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=q)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}_getGlobalDefines(q){if(q)return this.isNDCHalfZRange?q.IS_NDC_HALF_ZRANGE="":delete q.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?q.USE_REVERSE_DEPTHBUFFER="":delete q.USE_REVERSE_DEPTHBUFFER,void(this.useExactSrgbConversions?q.USE_EXACT_SRGB_CONVERSIONS="":delete q.USE_EXACT_SRGB_CONVERSIONS);{let q="";return this.isNDCHalfZRange&&(q+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(q&&(q+="\n"),q+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(q&&(q+="\n"),q+="#define USE_EXACT_SRGB_CONVERSIONS"),q}}_rebuildInternalTextures(){const q=this._internalTexturesCache.slice();for(const f of q)f._rebuild()}_rebuildRenderTargetWrappers(){const q=this._renderTargetWrapperCache.slice();for(const f of q)f._rebuild()}_rebuildEffects(){for(const q in this._compiledEffects){const f=this._compiledEffects[q];f._pipelineContext=null,f._prepareEffect()}h.b.ResetCache()}_rebuildGraphicsResources(){var q;this.wipeCaches(!0),this._rebuildEffects(),null===(q=this._rebuildComputeEffects)||void 0===q||q.call(this),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_flagContextRestored(){g.e.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}_restoreEngineAfterContextLost(q){setTimeout((()=>{this._clearEmptyResources();const f=this._depthCullingState.depthTest,j=this._depthCullingState.depthFunc,d=this._depthCullingState.depthMask,g=this._stencilState.stencilTest;q(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=f,this._depthCullingState.depthFunc=j,this._depthCullingState.depthMask=d,this._stencilState.stencilTest=g,this._flagContextRestored()}),0)}get B(){return this._isDisposed}get snapshotRendering(){return!1}set snapshotRendering(q){}get snapshotRenderingMode(){return 0}set snapshotRenderingMode(q){}getClassName(){return"AbstractEngine"}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){const q=new Uint8Array(4),f=[q,q,q,q,q,q];this._emptyCubeTexture=this.createRawCubeTexture(f,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get activeRenderLoops(){return this._activeRenderLoops}stopRenderLoop(q){if(!q)return this._activeRenderLoops.length=0,void this._cancelFrame();const f=this._activeRenderLoops.indexOf(q);f>=0&&(this._activeRenderLoops.splice(f,1),0==this._activeRenderLoops.length&&this._cancelFrame())}_cancelFrame(){if(0!==this._frameHandler){const q=this._frameHandler;if(this._frameHandler=0,(0,D.h)()){const{cancelAnimationFrame:f}=this.getHostWindow()||window;if("function"===typeof f)return f(q)}else if("function"===typeof cancelAnimationFrame)return cancelAnimationFrame(q);return clearTimeout(q)}}Bz(){this.onBeginFrameObservable.notifyObservers(this)}Dz(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}get maxFPS(){return this._maxFPS}set maxFPS(q){this._maxFPS=q,void 0!==q&&(this._minFrameTime=q<=0?Number.MAX_VALUE:1e3/q)}_isOverFrameTime(q){if(!q||void 0===this._maxFPS)return!1;const f=q-this._lastFrameTime;return this._lastFrameTime=q,this._renderAccumulator+=f,this._renderAccumulator<this._minFrameTime||(this._renderAccumulator-=this._minFrameTime,this._renderAccumulator>this._minFrameTime&&(this._renderAccumulator=this._minFrameTime),!1)}_processFrame(q){if(this._frameHandler=0,!this._contextWasLost&&!this._isOverFrameTime(q)){let q=!0;(this.B||!this.renderEvenInBackground&&this._windowIsBackground)&&(q=!1),q&&(this.Bz(),this.skipFrameRender||this._renderViews()||this._renderFrame(),this.Dz())}}_renderLoop(q){this._processFrame(q),this._activeRenderLoops.length>0&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_renderFrame(){for(let q=0;q<this._activeRenderLoops.length;q++){(0,this._activeRenderLoops[q])()}}_renderViews(){return!1}_queueNewFrame(q,f){return N(q,f)}runRenderLoop(q){-1===this._activeRenderLoops.indexOf(q)&&(this._activeRenderLoops.push(q),1===this._activeRenderLoops.length&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(q){this._depthCullingState.depthTest=q}setZOffset(q){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-q:q}getZOffset(){const q=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-q:q}setZOffsetUnits(q){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-q:q}getZOffsetUnits(){const q=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-q:q}getHostWindow(){return(0,D.h)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(q){this._compatibilityMode=!0}_rebuildTextures(){for(const q of this.scenes)q._rebuildTextures();for(const q of this._virtualScenes)q._rebuildTextures()}_releaseRenderTargetWrapper(q){const f=this._renderTargetWrapperCache.indexOf(q);-1!==f&&this._renderTargetWrapperCache.splice(f,1)}get currentViewport(){return this._cachedViewport}setViewport(q,f,j){const d=f||this.getRenderWidth(),g=j||this.getRenderHeight(),h=q.x||0,L=q.y||0;this._cachedViewport=q,this._viewport(h*d,L*g,d*q.width,g*q.height)}createCanvasImage(){return document.createElement("img")}createCanvasPath2D(q){return new Path2D(q)}get description(){let q=this.name+this.version;return this._caps.parallelShaderCompile&&(q+=" - Parallel shader compilation"),q}_createTextureBase(q,f,j,h){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,r=arguments.length>7?arguments[7]:void 0,u=arguments.length>8?arguments[8]:void 0,X=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,z=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,D=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,i=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,t=arguments.length>13?arguments[13]:void 0,N=arguments.length>14?arguments[14]:void 0,E=arguments.length>15?arguments[15]:void 0;const s="data:"===(q=q||"").substring(0,5),S="blob:"===q.substring(0,5),e=s&&-1!==q.indexOf(";base64,"),Z=z||new B.c(this,1);Z!==z&&(Z.label=q.substring(0,60));const I=q;!this._transformTextureUrl||e||z||X||(q=this._transformTextureUrl(q)),I!==q&&(Z._originalUrl=I);const T=q.lastIndexOf(".");let W=i||(T>-1?q.substring(T).toLowerCase():"");W.indexOf("?")>-1&&(W=W.split("?")[0]);const n=(0,O.e)(W,t);h&&h.addPendingData(Z),Z.url=q,Z.generateMipMaps=!f,Z.samplingMode=L,Z.invertY=j,Z._useSRGBBuffer=this._getUseSRGBBuffer(!!E,f),this._doNotHandleContextLost||(Z._buffer=X);let U=null;Q&&!z&&(U=Z.onLoadedObservable.add(Q)),z||this._internalTexturesCache.push(Z);const Y=(j,z)=>{h&&h.removePendingData(Z),q===I?(U&&Z.onLoadedObservable.remove(U),d.d.UseFallbackTexture&&q!==d.d.FallbackTexture&&this._createTextureBase(d.d.FallbackTexture,f,Z.invertY,h,L,null,H,r,u,X,Z),j=(j||"Unknown error")+(d.d.UseFallbackTexture?" - Fallback texture was used":""),Z.onErrorObservable.notifyObservers({message:j,exception:z}),H&&H(j,z)):(g.e.Warn(`Failed to load ${q}, falling back to ${I}`),this._createTextureBase(I,f,Z.invertY,h,L,Q,H,r,u,X,Z,D,i,t,N,E))};if(n){const f=async q=>{(await n).loadData(q,Z,((q,f,j,d,g,Q)=>{Q?Y("TextureLoader failed to load data"):r(Z,W,h,{width:q,height:f},Z.invertY,!j,d,(()=>(g(),!1)),L)}),N)};X?X instanceof ArrayBuffer?f(new Uint8Array(X)):ArrayBuffer.isView(X)?f(X):H&&H("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(q,(q=>{f(new Uint8Array(q))}),void 0,h?h.offlineProvider:void 0,!0,((q,f)=>{Y("Unable to load "+(q&&q.responseURL,f))}))}else{const j=q=>{S&&!this._doNotHandleContextLost&&(Z._buffer=q),r(Z,W,h,q,Z.invertY,f,!1,u,L)};!s||e?X&&("string"===typeof X.decoding||X.close)?j(X):w._FileToolsLoadImage(q||"",j,Y,h?h.offlineProvider:null,t,Z.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0,this):"string"===typeof X||X instanceof ArrayBuffer||ArrayBuffer.isView(X)||X instanceof Blob?w._FileToolsLoadImage(X,j,Y,h?h.offlineProvider:null,t,Z.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0,this):X&&j(X)}return Z}_rebuildBuffers(){for(const q of this._uniformBuffers)q._rebuildAfterContextLost()}get _shouldUseHighPrecisionShader(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,D.c)()?document:null}getLoadedTexturesCache(){return this._internalTexturesCache}clearInternalTexturesCache(){this._internalTexturesCache.length=0}getCaps(){return this._caps}resetTextureCache(){for(const q in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,q)&&(this._boundTexturesCache[q]=null);this._currentTextureChannel=-1}get name(){return this._name}set name(q){this._name=q}static get NpmPackage(){return"babylonjs@8.13.0"}static get Version(){return"8.13.0"}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}setHardwareScalingLevel(q){this._hardwareScalingLevel=q,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(q){this._doNotHandleContextLost=q}get isStencilEnable(){return this._isStencilEnable}getCreationOptions(){return this._creationOptions}constructor(q,f,j){var g,h;this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new H,this._stencilStateComposer=new r,this._stencilState=new u,this._alphaState=new X,this._alphaMode=1,this._alphaEquation=0,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new i.d,this.onCanvasFocusObservable=new i.d,this.onNewSceneAddedObservable=new i.d,this.onResizeObservable=new i.d,this.onCanvasPointerOutObservable=new i.d,this.onEffectErrorObservable=new i.d,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new i.d,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=q=>this._renderLoop(q),this._lastFrameTime=0,this._renderAccumulator=0,this.skipFrameRender=!1,this.onBeforeShaderCompilationObservable=new i.d,this.onAfterShaderCompilationObservable=new i.d,this.onBeginFrameObservable=new i.d,this.onEndFrameObservable=new i.d,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new i.d,this.onContextRestoredObservable=new i.d,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.qd=new i.d,this.onReleaseEffectsObservable=new i.d,d.d.Instances.push(this),this.startTime=Q.c.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,L.b.SetMatrixPrecision(!!f.useHighPrecisionMatrix),(0,D.f)()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=j??!1,f.antialias=q??f.antialias,f.deterministicLockstep=f.deterministicLockstep??!1,f.lockstepMaxSteps=f.lockstepMaxSteps??4,f.timeStep=f.timeStep??1/60,f.stencil=f.stencil??!0,this._audioContext=(null===(g=f.audioEngineOptions)||void 0===g?void 0:g.audioContext)??null,this._audioDestination=(null===(h=f.audioEngineOptions)||void 0===h?void 0:h.audioDestination)??null,this.premultipliedAlpha=f.premultipliedAlpha??!0,this._doNotHandleContextLost=!!f.doNotHandleContextLost,this._isStencilEnable=!!f.stencil,this.useExactSrgbConversions=f.useExactSrgbConversions??!1;const z=(0,D.h)()&&window.devicePixelRatio||1,B=f.limitDeviceRatio||z;j=j||f.adaptToDeviceRatio||!1,this._hardwareScalingLevel=j?1/Math.min(B,z):1,this._lastDevicePixelRatio=z,this._creationOptions=f}resize(){let q,f,j=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.adaptToDeviceRatio){const q=(0,D.h)()&&window.devicePixelRatio||1,f=this._lastDevicePixelRatio/q;this._lastDevicePixelRatio=q,this._hardwareScalingLevel*=f}if((0,D.h)()&&(0,D.c)())if(this._renderingCanvas){var d,g;const j=null===(d=(g=this._renderingCanvas).getBoundingClientRect)||void 0===d?void 0:d.call(g);q=this._renderingCanvas.clientWidth||(null===j||void 0===j?void 0:j.width)||this._renderingCanvas.width*this._hardwareScalingLevel||100,f=this._renderingCanvas.clientHeight||(null===j||void 0===j?void 0:j.height)||this._renderingCanvas.height*this._hardwareScalingLevel||100}else q=window.innerWidth,f=window.innerHeight;else q=this._renderingCanvas?this._renderingCanvas.width:100,f=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(q/this._hardwareScalingLevel,f/this._hardwareScalingLevel,j)}setSize(q,f){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._renderingCanvas)return!1;if(q|=0,f|=0,!j&&this._renderingCanvas.width===q&&this._renderingCanvas.height===f)return!1;if(this._renderingCanvas.width=q,this._renderingCanvas.height=f,this.scenes){for(let q=0;q<this.scenes.length;q++){const f=this.scenes[q];for(let q=0;q<f.cameras.length;q++){f.cameras[q]._currentRenderId=0}}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}createRawTexture(q,f,j,d,g,h,L,Q,H,r,u){throw(0,z.c)("engine.rawTexture")}createRawCubeTexture(q,f,j,d,g,h,L,Q){throw(0,z.c)("engine.rawTexture")}createRawTexture3D(q,f,j,d,g,h,L,Q,H,r,u){throw(0,z.c)("engine.rawTexture")}createRawTexture2DArray(q,f,j,d,g,h,L,Q,H,r,u){throw(0,z.c)("engine.rawTexture")}_sharedInit(q){this._renderingCanvas=q}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const q=navigator.userAgent;this.hostInformation.isMobile=-1!==q.indexOf("Mobile")||-1!==q.indexOf("Mac")&&(0,D.c)()&&"ontouchend"in document},this._checkForMobile(),(0,D.h)()&&window.addEventListener("resize",this._checkForMobile))}createVideoElement(q){return document.createElement("video")}_reportDrawCall(){var q;let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;null===(q=this._drawCalls)||void 0===q||q.addCount(f,!1)}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return 1e3*this._timeStep}_createImageBitmapFromSource(q,f){throw new Error("createImageBitmapFromSource is not implemented")}createImageBitmap(q,f){return createImageBitmap(q,f)}resizeImageBitmap(q,f,j){throw new Error("resizeImageBitmap is not implemented")}getFontOffset(q){throw new Error("getFontOffset is not implemented")}static _CreateCanvas(q,f){if("undefined"===typeof document)return new OffscreenCanvas(q,f);const j=document.createElement("canvas");return j.width=q,j.height=f,j}createCanvas(q,f){return w._CreateCanvas(q,f)}static _FileToolsLoadImage(q,f,j,d,g,h,L){throw(0,z.c)("FileTools")}_loadFile(q,f,j,d,g,h){const L=(0,t.p)(q,f,j,d,g,h);return this._activeRequests.push(L),L.onCompleteObservable.add((()=>{const q=this._activeRequests.indexOf(L);-1!==q&&this._activeRequests.splice(q,1)})),L}static _FileToolsLoadFile(q,f,j,d,g,h){if(t.e.loadFile)return t.e.loadFile(q,f,j,d,g,h);throw(0,z.c)("FileTools")}dispose(){var q;for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();null===(q=this.releaseComputeEffects)||void 0===q||q.call(this),h.b.ResetCache();for(const j of this._activeRequests)j.abort();this._boundRenderFunction=null,this.qd.notifyObservers(this),this.qd.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),this.onEffectErrorObservable.clear(),(0,D.h)()&&window.removeEventListener("resize",this._checkForMobile);const f=d.d.Instances.indexOf(this);f>=0&&d.d.Instances.splice(f,1),d.d.Instances.length||(d.d.OnEnginesDisposedObservable.notifyObservers(this),d.d.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}static DefaultLoadingScreenFactory(q){throw(0,z.c)("LoadingScreen")}static MarkAllMaterialsAsDirty(q,f){for(let j=0;j<d.d.Instances.length;j++){const g=d.d.Instances[j];for(let j=0;j<g.scenes.length;j++)g.scenes[j].markAllMaterialsAsDirty(q,f)}}}w._RenderPassIdCounter=0,w._RescalePostProcessFactory=null,w.CollisionsEpsilon=.001,w.QueueNewFrame=N},11472:(q,f,j)=>{j.d(f,{b:()=>d});class d{}d.AUTOSAMPLERSUFFIX="Sampler",d.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",d.ALPHA_DISABLE=0,d.ALPHA_ADD=1,d.ALPHA_COMBINE=2,d.ALPHA_SUBTRACT=3,d.ALPHA_MULTIPLY=4,d.ALPHA_MAXIMIZED=5,d.ALPHA_ONEONE=6,d.ALPHA_PREMULTIPLIED=7,d.ALPHA_PREMULTIPLIED_PORTERDUFF=8,d.ALPHA_INTERPOLATE=9,d.ALPHA_SCREENMODE=10,d.ALPHA_ONEONE_ONEONE=11,d.ALPHA_ALPHATOCOLOR=12,d.ALPHA_REVERSEONEMINUS=13,d.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,d.ALPHA_ONEONE_ONEZERO=15,d.ALPHA_EXCLUSION=16,d.ALPHA_LAYER_ACCUMULATE=17,d.ALPHA_EQUATION_ADD=0,d.ALPHA_EQUATION_SUBSTRACT=1,d.ALPHA_EQUATION_REVERSE_SUBTRACT=2,d.ALPHA_EQUATION_MAX=3,d.ALPHA_EQUATION_MIN=4,d.ALPHA_EQUATION_DARKEN=5,d.DELAYLOADSTATE_NONE=0,d.DELAYLOADSTATE_LOADED=1,d.DELAYLOADSTATE_LOADING=2,d.DELAYLOADSTATE_NOTLOADED=4,d.NEVER=512,d.ALWAYS=519,d.LESS=513,d.EQUAL=514,d.LEQUAL=515,d.GREATER=516,d.GEQUAL=518,d.NOTEQUAL=517,d.KEEP=7680,d.ZERO=0,d.REPLACE=7681,d.INCR=7682,d.DECR=7683,d.INVERT=5386,d.INCR_WRAP=34055,d.DECR_WRAP=34056,d.TEXTURE_CLAMP_ADDRESSMODE=0,d.TEXTURE_WRAP_ADDRESSMODE=1,d.TEXTURE_MIRROR_ADDRESSMODE=2,d.TEXTURE_CREATIONFLAG_STORAGE=1,d.TEXTUREFORMAT_ALPHA=0,d.TEXTUREFORMAT_LUMINANCE=1,d.TEXTUREFORMAT_LUMINANCE_ALPHA=2,d.TEXTUREFORMAT_RGB=4,d.TEXTUREFORMAT_RGBA=5,d.TEXTUREFORMAT_RED=6,d.TEXTUREFORMAT_R=6,d.TEXTUREFORMAT_R16_UNORM=33322,d.TEXTUREFORMAT_RG16_UNORM=33324,d.TEXTUREFORMAT_RGB16_UNORM=32852,d.TEXTUREFORMAT_RGBA16_UNORM=32859,d.TEXTUREFORMAT_R16_SNORM=36760,d.TEXTUREFORMAT_RG16_SNORM=36761,d.TEXTUREFORMAT_RGB16_SNORM=36762,d.TEXTUREFORMAT_RGBA16_SNORM=36763,d.TEXTUREFORMAT_RG=7,d.TEXTUREFORMAT_RED_INTEGER=8,d.TEXTUREFORMAT_R_INTEGER=8,d.TEXTUREFORMAT_RG_INTEGER=9,d.TEXTUREFORMAT_RGB_INTEGER=10,d.TEXTUREFORMAT_RGBA_INTEGER=11,d.TEXTUREFORMAT_BGRA=12,d.TEXTUREFORMAT_DEPTH24_STENCIL8=13,d.TEXTUREFORMAT_DEPTH32_FLOAT=14,d.TEXTUREFORMAT_DEPTH16=15,d.TEXTUREFORMAT_DEPTH24=16,d.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,d.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,d.TEXTUREFORMAT_STENCIL8=19,d.TEXTUREFORMAT_UNDEFINED=4294967295,d.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,d.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,d.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,d.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,d.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,d.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,d.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,d.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,d.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,d.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,d.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,d.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,d.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,d.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,d.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,d.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,d.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,d.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,d.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,d.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,d.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,d.TEXTURETYPE_UNSIGNED_BYTE=0,d.TEXTURETYPE_UNSIGNED_INT=0,d.TEXTURETYPE_FLOAT=1,d.TEXTURETYPE_HALF_FLOAT=2,d.TEXTURETYPE_BYTE=3,d.TEXTURETYPE_SHORT=4,d.TEXTURETYPE_UNSIGNED_SHORT=5,d.TEXTURETYPE_INT=6,d.TEXTURETYPE_UNSIGNED_INTEGER=7,d.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,d.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,d.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,d.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,d.TEXTURETYPE_UNSIGNED_INT_24_8=12,d.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,d.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,d.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,d.TEXTURETYPE_UNDEFINED=16,d.TEXTURE_2D=3553,d.TEXTURE_2D_ARRAY=35866,d.TEXTURE_CUBE_MAP=34067,d.TEXTURE_CUBE_MAP_ARRAY=3735928559,d.TEXTURE_3D=32879,d.TEXTURE_NEAREST_SAMPLINGMODE=1,d.TEXTURE_NEAREST_NEAREST=1,d.TEXTURE_BILINEAR_SAMPLINGMODE=2,d.TEXTURE_LINEAR_LINEAR=2,d.TEXTURE_TRILINEAR_SAMPLINGMODE=3,d.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,d.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,d.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,d.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,d.TEXTURE_NEAREST_LINEAR=7,d.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,d.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,d.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,d.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,d.TEXTURE_LINEAR_NEAREST=12,d.TEXTURE_EXPLICIT_MODE=0,d.TEXTURE_SPHERICAL_MODE=1,d.TEXTURE_PLANAR_MODE=2,d.TEXTURE_CUBIC_MODE=3,d.TEXTURE_PROJECTION_MODE=4,d.TEXTURE_SKYBOX_MODE=5,d.TEXTURE_INVCUBIC_MODE=6,d.TEXTURE_EQUIRECTANGULAR_MODE=7,d.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,d.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,d.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,d.TEXTURE_FILTERING_QUALITY_HIGH=64,d.TEXTURE_FILTERING_QUALITY_MEDIUM=16,d.TEXTURE_FILTERING_QUALITY_LOW=8,d.SCALEMODE_FLOOR=1,d.SCALEMODE_NEAREST=2,d.SCALEMODE_CEILING=3,d.MATERIAL_TextureDirtyFlag=1,d.MATERIAL_LightDirtyFlag=2,d.MATERIAL_FresnelDirtyFlag=4,d.MATERIAL_AttributesDirtyFlag=8,d.MATERIAL_MiscDirtyFlag=16,d.MATERIAL_PrePassDirtyFlag=32,d.MATERIAL_ImageProcessingDirtyFlag=64,d.MATERIAL_AllDirtyFlag=127,d.MATERIAL_TriangleFillMode=0,d.MATERIAL_WireFrameFillMode=1,d.MATERIAL_PointFillMode=2,d.MATERIAL_PointListDrawMode=3,d.MATERIAL_LineListDrawMode=4,d.MATERIAL_LineLoopDrawMode=5,d.MATERIAL_LineStripDrawMode=6,d.MATERIAL_TriangleStripDrawMode=7,d.MATERIAL_TriangleFanDrawMode=8,d.MATERIAL_ClockWiseSideOrientation=0,d.MATERIAL_CounterClockWiseSideOrientation=1,d.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR=0,d.MATERIAL_DIFFUSE_MODEL_BURLEY=1,d.MATERIAL_DIFFUSE_MODEL_LAMBERT=2,d.MATERIAL_DIFFUSE_MODEL_LEGACY=3,d.MATERIAL_DIELECTRIC_SPECULAR_MODEL_GLTF=0,d.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR=1,d.MATERIAL_CONDUCTOR_SPECULAR_MODEL_GLTF=0,d.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR=1,d.ACTION_NothingTrigger=0,d.ACTION_OnPickTrigger=1,d.ACTION_OnLeftPickTrigger=2,d.ACTION_OnRightPickTrigger=3,d.ACTION_OnCenterPickTrigger=4,d.ACTION_OnPickDownTrigger=5,d.ACTION_OnDoublePickTrigger=6,d.ACTION_OnPickUpTrigger=7,d.ACTION_OnPickOutTrigger=16,d.ACTION_OnLongPressTrigger=8,d.ACTION_OnPointerOverTrigger=9,d.ACTION_OnPointerOutTrigger=10,d.ACTION_OnEveryFrameTrigger=11,d.ACTION_OnIntersectionEnterTrigger=12,d.ACTION_OnIntersectionExitTrigger=13,d.ACTION_OnKeyDownTrigger=14,d.ACTION_OnKeyUpTrigger=15,d.PARTICLES_BILLBOARDMODE_Y=2,d.PARTICLES_BILLBOARDMODE_ALL=7,d.PARTICLES_BILLBOARDMODE_STRETCHED=8,d.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,d.MESHES_CULLINGSTRATEGY_STANDARD=0,d.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,d.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,d.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,d.SCENELOADER_NO_LOGGING=0,d.SCENELOADER_MINIMAL_LOGGING=1,d.SCENELOADER_SUMMARY_LOGGING=2,d.SCENELOADER_DETAILED_LOGGING=3,d.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,d.PREPASS_POSITION_TEXTURE_TYPE=1,d.PREPASS_VELOCITY_TEXTURE_TYPE=2,d.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,d.PREPASS_COLOR_TEXTURE_TYPE=4,d.PREPASS_DEPTH_TEXTURE_TYPE=5,d.PREPASS_NORMAL_TEXTURE_TYPE=6,d.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,d.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,d.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,d.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,d.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,d.PREPASS_ALBEDO_TEXTURE_TYPE=12,d.PREPASS_NORMALIZED_VIEW_DEPTH_TEXTURE_TYPE=13,d.BUFFER_CREATIONFLAG_READ=1,d.BUFFER_CREATIONFLAG_WRITE=2,d.BUFFER_CREATIONFLAG_READWRITE=3,d.BUFFER_CREATIONFLAG_UNIFORM=4,d.BUFFER_CREATIONFLAG_VERTEX=8,d.BUFFER_CREATIONFLAG_INDEX=16,d.BUFFER_CREATIONFLAG_STORAGE=32,d.BUFFER_CREATIONFLAG_INDIRECT=64,d.RENDERPASS_MAIN=0,d.INPUT_ALT_KEY=18,d.INPUT_CTRL_KEY=17,d.INPUT_META_KEY1=91,d.INPUT_META_KEY2=92,d.INPUT_META_KEY3=93,d.INPUT_SHIFT_KEY=16,d.SNAPSHOTRENDERING_STANDARD=0,d.SNAPSHOTRENDERING_FAST=1,d.PERSPECTIVE_CAMERA=0,d.ORTHOGRAPHIC_CAMERA=1,d.FOVMODE_VERTICAL_FIXED=0,d.FOVMODE_HORIZONTAL_FIXED=1,d.RIG_MODE_NONE=0,d.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,d.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,d.RIG_MODE_STEREOSCOPIC_INTERLACED=14,d.RIG_MODE_VR=20,d.RIG_MODE_CUSTOM=22,d.MAX_SUPPORTED_UV_SETS=6,d.GL_ALPHA_EQUATION_ADD=32774,d.GL_ALPHA_EQUATION_MIN=32775,d.GL_ALPHA_EQUATION_MAX=32776,d.GL_ALPHA_EQUATION_SUBTRACT=32778,d.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,d.GL_ALPHA_FUNCTION_SRC=768,d.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,d.GL_ALPHA_FUNCTION_SRC_ALPHA=770,d.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,d.GL_ALPHA_FUNCTION_DST_ALPHA=772,d.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,d.GL_ALPHA_FUNCTION_DST_COLOR=774,d.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,d.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,d.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,d.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,d.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,d.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,d.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,d.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,d.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,d.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,d.SnippetUrl="https://snippet.babylonjs.com",d.FOGMODE_NONE=0,d.FOGMODE_EXP=1,d.FOGMODE_EXP2=2,d.FOGMODE_LINEAR=3,d.BYTE=5120,d.UNSIGNED_BYTE=5121,d.SHORT=5122,d.UNSIGNED_SHORT=5123,d.INT=5124,d.UNSIGNED_INT=5125,d.FLOAT=5126,d.PositionKind="position",d.NormalKind="df",d.TangentKind="tangent",d.UVKind="uv",d.UV2Kind="uv2",d.UV3Kind="uv3",d.UV4Kind="uv4",d.UV5Kind="uv5",d.UV6Kind="uv6",d.ColorKind="color",d.ColorInstanceKind="instanceColor",d.MatricesIndicesKind="matricesIndices",d.MatricesWeightsKind="matricesWeights",d.MatricesIndicesExtraKind="matricesIndicesExtra",d.MatricesWeightsExtraKind="matricesWeightsExtra",d.ANIMATIONTYPE_FLOAT=0,d.ANIMATIONTYPE_VECTOR3=1,d.ANIMATIONTYPE_QUATERNION=2,d.ANIMATIONTYPE_MATRIX=3,d.ANIMATIONTYPE_COLOR3=4,d.ANIMATIONTYPE_COLOR4=7,d.ANIMATIONTYPE_VECTOR2=5,d.ANIMATIONTYPE_SIZE=6,d.ShadowMinZ=0,d.ShadowMaxZ=1e4},11331:(q,f,j)=>{j.d(f,{d:()=>Z});var d=j(11090),g=j(10980),h=j(11337),L=j(11013);class Q{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;this._enabled=!0,this._rollingFrameTime=new H(q)}sampleFrame(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:L.c.Now;if(this._enabled){if(null!=this._lastFrameTimeMs){const f=q-this._lastFrameTimeMs;this._rollingFrameTime.add(f)}this._lastFrameTimeMs=q}}get averageFrameTime(){return this._rollingFrameTime.average}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFPS(){return 1e3/this._rollingFrameTime.average}get instantaneousFPS(){const q=this._rollingFrameTime.history(0);return 0===q?0:1e3/q}get isSaturated(){return this._rollingFrameTime.isSaturated()}enable(){this._enabled=!0}disable(){this._enabled=!1,this._lastFrameTimeMs=null}get isEnabled(){return this._enabled}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class H{constructor(q){this._samples=new Array(q),this.reset()}add(q){let f;if(this.isSaturated()){const q=this._samples[this._pos];f=q-this.average,this.average-=f/(this._sampleCount-1),this._m2-=f*(q-this.average)}else this._sampleCount++;f=q-this.average,this.average+=f/this._sampleCount,this._m2+=f*(q-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=q,this._pos++,this._pos%=this._samples.length}history(q){if(q>=this._sampleCount||q>=this._samples.length)return 0;const f=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(f-q)]}isSaturated(){return this._sampleCount>=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(q){const f=this._samples.length;return(q%f+f)%f}}var r=j(11354),u=j(11005),X=j(11356),z=(j(11369),j(11114));function B(q,f,j,d){let g,h=1;1===d?g=new Float32Array(f*j*4):2===d?(g=new Uint16Array(f*j*4),h=15360):g=7===d?new Uint32Array(f*j*4):new Uint8Array(f*j*4);for(let L=0;L<f;L++)for(let d=0;d<j;d++){const j=3*(d*f+L),Q=4*(d*f+L);g[Q+0]=q[j+0],g[Q+1]=q[j+1],g[Q+2]=q[j+2],g[Q+3]=h}return g}function D(q){return function(f,j,g,h,L,Q,H,r){let u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,X=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const z=q?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,B=q?10:11,D=new d.c(this,B);D.baseWidth=j,D.baseHeight=g,D.baseDepth=h,D.width=j,D.height=g,D.depth=h,D.format=L,D.type=X,D.generateMipMaps=Q,D.samplingMode=r,q?D.is3D=!0:D.is2DArray=!0,this._doNotHandleContextLost||(D._bufferView=f),q?this.updateRawTexture3D(D,f,L,H,u,X):this.updateRawTexture2DArray(D,f,L,H,u,X),this._bindTextureDirectly(z,D,!0);const i=this._getSamplingParameters(r,Q);return this._gl.texParameteri(z,this._gl.TEXTURE_MAG_FILTER,i.mag),this._gl.texParameteri(z,this._gl.TEXTURE_MIN_FILTER,i.min),Q&&this._gl.generateMipmap(z),this._bindTextureDirectly(z,null),this._internalTexturesCache.push(D),D}}function i(q){return function(f,j,d,g){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const Q=q?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,H=this._getWebGLTextureType(L),r=this._getInternalFormat(d),u=this._getRGBABufferInternalSizedFormat(L,d);this._bindTextureDirectly(Q,f,!0),this._unpackFlipY(void 0===g||!!g),this._doNotHandleContextLost||(f._bufferView=j,f.format=d,f.invertY=g,f._compression=h),f.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),h&&j?this._gl.compressedTexImage3D(Q,0,this.getCaps().s3tc[h],f.width,f.height,f.depth,0,j):this._gl.texImage3D(Q,0,u,f.width,f.height,f.depth,0,r,H,j),f.generateMipMaps&&this._gl.generateMipmap(Q),this._bindTextureDirectly(Q,null),f.isReady=!0}}h.ThinEngine.prototype.updateRawTexture=function(q,f,j,d){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,L=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!q)return;const Q=this._getRGBABufferInternalSizedFormat(h,j,L),H=this._getInternalFormat(j),r=this._getWebGLTextureType(h);this._bindTextureDirectly(this._gl.TEXTURE_2D,q,!0),this._unpackFlipY(void 0===d||!!d),this._doNotHandleContextLost||(q._bufferView=f,q.format=j,q.type=h,q.invertY=d,q._compression=g),q.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),g&&f?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[g],q.width,q.height,0,f):this._gl.texImage2D(this._gl.TEXTURE_2D,0,Q,q.width,q.height,0,H,r,f),q.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),q.isReady=!0},h.ThinEngine.prototype.createRawTexture=function(q,f,j,g,h,L,Q){let H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,u=arguments.length>10&&void 0!==arguments[10]&&arguments[10];const X=new d.c(this,3);X.baseWidth=f,X.baseHeight=j,X.width=f,X.height=j,X.format=g,X.generateMipMaps=h,X.samplingMode=Q,X.invertY=L,X._compression=H,X.type=r,X._useSRGBBuffer=this._getUseSRGBBuffer(u,!h),this._doNotHandleContextLost||(X._bufferView=q),this.updateRawTexture(X,q,g,L,H,r,X._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,X,!0);const z=this._getSamplingParameters(Q,h);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,z.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,z.min),h&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(X),X},h.ThinEngine.prototype.createRawCubeTexture=function(q,f,j,g,h,L,Q){let H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;const r=this._gl,X=new d.c(this,8);X.isCube=!0,X.format=j,X.type=g,this._doNotHandleContextLost||(X._bufferViewArray=q);const B=this._getWebGLTextureType(g);let D=this._getInternalFormat(j);D===r.RGB&&(D=r.RGBA),B!==r.FLOAT||this._caps.textureFloatLinearFiltering?B!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?B!==r.FLOAT||this._caps.textureFloatRender?B!==r.HALF_FLOAT||this._caps.colorBufferFloat||(h=!1,u.e.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(h=!1,u.e.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(h=!1,Q=1,u.e.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(h=!1,Q=1,u.e.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));const i=f,t=i;X.width=i,X.height=t,X.invertY=L,X._compression=H;if(!this.needPOTTextures||(0,z.i)(X.width)&&(0,z.i)(X.height)||(h=!1),q)this.updateRawCubeTexture(X,q,j,g,L,H);else{const q=this._getRGBABufferInternalSizedFormat(g),f=0;this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,X,!0);for(let j=0;j<6;j++)H?r.compressedTexImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+j,f,this.getCaps().s3tc[H],X.width,X.height,0,void 0):r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+j,f,q,X.width,X.height,0,D,B,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,X,!0),q&&h&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);const O=this._getSamplingParameters(Q,h);return r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAG_FILTER,O.mag),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,O.min),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,null),X.generateMipMaps=h,X.samplingMode=Q,X.isReady=!0,X},h.ThinEngine.prototype.updateRawCubeTexture=function(q,f,j,d,g){let h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;q._bufferViewArray=f,q.format=j,q.type=d,q.invertY=g,q._compression=h;const Q=this._gl,H=this._getWebGLTextureType(d);let r=this._getInternalFormat(j);const u=this._getRGBABufferInternalSizedFormat(d);let X=!1;r===Q.RGB&&(r=Q.RGBA,X=!0),this._bindTextureDirectly(Q.TEXTURE_CUBE_MAP,q,!0),this._unpackFlipY(void 0===g||!!g),q.width%4!==0&&Q.pixelStorei(Q.UNPACK_ALIGNMENT,1);for(let z=0;z<6;z++){let j=f[z];h?Q.compressedTexImage2D(Q.TEXTURE_CUBE_MAP_POSITIVE_X+z,L,this.getCaps().s3tc[h],q.width,q.height,0,j):(X&&(j=B(j,q.width,q.height,d)),Q.texImage2D(Q.TEXTURE_CUBE_MAP_POSITIVE_X+z,L,u,q.width,q.height,0,r,H,j))}(!this.needPOTTextures||(0,z.i)(q.width)&&(0,z.i)(q.height))&&q.generateMipMaps&&0===L&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),q.isReady=!0},h.ThinEngine.prototype.createRawCubeTextureFromUrl=function(q,f,j,d,g,h,L,Q){let H=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,r=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,u=arguments.length>10&&void 0!==arguments[10]?arguments[10]:3,X=arguments.length>11&&void 0!==arguments[11]&&arguments[11];const z=this._gl,D=this.createRawCubeTexture(null,j,d,g,!h,X,u,null);null===f||void 0===f||f.addPendingData(D),D.url=q,D.isReady=!1,this._internalTexturesCache.push(D);const i=q=>{if(!D._hardwareTexture)return;const j=D.width,h=L(q);if(h){if(Q){const q=this._getWebGLTextureType(g);let f=this._getInternalFormat(d);const L=this._getRGBABufferInternalSizedFormat(g);let H=!1;f===z.RGB&&(f=z.RGBA,H=!0),this._bindTextureDirectly(z.TEXTURE_CUBE_MAP,D,!0),this._unpackFlipY(!1);const r=Q(h);for(let d=0;d<r.length;d++){const h=j>>d;for(let j=0;j<6;j++){let Q=r[d][j];H&&(Q=B(Q,h,h,g)),z.texImage2D(j,d,L,h,h,0,f,q,Q)}}this._bindTextureDirectly(z.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(D,h,d,g,X);D.isReady=!0,null===f||void 0===f||f.removePendingData(D),D.onLoadedObservable.notifyObservers(D),D.onLoadedObservable.clear(),H&&H()}};return this._loadFile(q,(q=>{i(q)}),void 0,null===f||void 0===f?void 0:f.offlineProvider,!0,((q,j)=>{null===f||void 0===f||f.removePendingData(D),r&&q&&r(q.status+" "+q.statusText,j)})),D},h.ThinEngine.prototype.createRawTexture2DArray=D(!1),h.ThinEngine.prototype.createRawTexture3D=D(!0),h.ThinEngine.prototype.updateRawTexture2DArray=i(!1),h.ThinEngine.prototype.updateRawTexture3D=i(!0);var t=j(11054);h.ThinEngine.prototype._readTexturePixelsSync=function(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],Q=arguments.length>7&&void 0!==arguments[7]&&arguments[7],H=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,r=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const u=this._gl;if(!u)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const q=u.createFramebuffer();if(!q)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=q}var X,z;(u.bindFramebuffer(u.FRAMEBUFFER,this._dummyFramebuffer),d>-1)?u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_CUBE_MAP_POSITIVE_X+d,null===(X=q._hardwareTexture)||void 0===X?void 0:X.underlyingResource,g):u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,null===(z=q._hardwareTexture)||void 0===z?void 0:z.underlyingResource,g);let B=void 0!==q.type?this._getWebGLTextureType(q.type):u.UNSIGNED_BYTE;if(Q)h||(h=(0,t.t)(q.type,4*f*j));else if(B===u.UNSIGNED_BYTE)h||(h=new Uint8Array(4*f*j)),B=u.UNSIGNED_BYTE;else h||(h=new Float32Array(4*f*j)),B=u.FLOAT;return L&&this.flushFramebuffer(),u.readPixels(H,r,f,j,u.RGBA,B,h),u.bindFramebuffer(u.FRAMEBUFFER,this._currentFramebuffer),h},h.ThinEngine.prototype._readTexturePixels=function(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],Q=arguments.length>7&&void 0!==arguments[7]&&arguments[7],H=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,r=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;return Promise.resolve(this._readTexturePixelsSync(q,f,j,d,g,h,L,Q,H,r))};j(11371);h.ThinEngine.prototype._createDepthStencilCubeTexture=function(q,f){const j=new d.c(this,12);if(j.isCube=!0,1===this.webGLVersion)return u.e.Error("Depth cube texture is not supported by WebGL 1."),j;const g={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...f},h=this._gl;this._bindTextureDirectly(h.TEXTURE_CUBE_MAP,j,!0),this._setupDepthStencilTexture(j,q,g.bilinearFiltering,g.comparisonFunction);for(let d=0;d<6;d++)g.generateStencil?h.texImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+d,0,h.DEPTH24_STENCIL8,q,q,0,h.DEPTH_STENCIL,h.UNSIGNED_INT_24_8,null):h.texImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+d,0,h.DEPTH_COMPONENT24,q,q,0,h.DEPTH_COMPONENT,h.UNSIGNED_INT,null);return this._bindTextureDirectly(h.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(j),j},h.ThinEngine.prototype._setCubeMapTextureParams=function(q,f,j){const d=this._gl;d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MIN_FILTER,f?d.LINEAR_MIPMAP_LINEAR:d.LINEAR),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),q.samplingMode=f?3:2,f&&this.getCaps().textureMaxLevel&&void 0!==j&&j>0&&(d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MAX_LEVEL,j),q._maxLodLevel=j),this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,null)},h.ThinEngine.prototype.createCubeTexture=function(q,f,j,d){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=arguments.length>6?arguments[6]:void 0,Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,H=arguments.length>8&&void 0!==arguments[8]&&arguments[8],r=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,X=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,B=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,D=arguments.length>13&&void 0!==arguments[13]&&arguments[13],i=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null;const t=this._gl;return this.createCubeTextureBase(q,f,j,!!d,g,h,L,Q,H,r,X,B,(q=>this._bindTextureDirectly(t.TEXTURE_CUBE_MAP,q,!0)),((q,f)=>{const j=this.needPOTTextures?(0,z.g)(f[0].width,this._caps.maxCubemapTextureSize):f[0].width,h=j,Q=[t.TEXTURE_CUBE_MAP_POSITIVE_X,t.TEXTURE_CUBE_MAP_POSITIVE_Y,t.TEXTURE_CUBE_MAP_POSITIVE_Z,t.TEXTURE_CUBE_MAP_NEGATIVE_X,t.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(t.TEXTURE_CUBE_MAP,q,!0),this._unpackFlipY(!1);const H=L?this._getInternalFormat(L,q._useSRGBBuffer):q._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:t.RGBA;let r=L?this._getInternalFormat(L):t.RGBA;q._useSRGBBuffer&&1===this.webGLVersion&&(r=H);for(let d=0;d<Q.length;d++)if(f[d].width!==j||f[d].height!==h){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void u.e.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=j,this._workingCanvas.height=h,this._workingContext.drawImage(f[d],0,0,f[d].width,f[d].height,0,0,j,h),t.texImage2D(Q[d],0,H,r,t.UNSIGNED_BYTE,this._workingCanvas)}else t.texImage2D(Q[d],0,H,r,t.UNSIGNED_BYTE,f[d]);d||t.generateMipmap(t.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(q,!d),q.width=j,q.height=h,q.isReady=!0,L&&(q.format=L),q.onLoadedObservable.notifyObservers(q),q.onLoadedObservable.clear(),g&&g()}),!!D,i)},h.ThinEngine.prototype.generateMipMapsForCubemap=function(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(q.generateMipMaps){const j=this._gl;this._bindTextureDirectly(j.TEXTURE_CUBE_MAP,q,!0),j.generateMipmap(j.TEXTURE_CUBE_MAP),f&&this._bindTextureDirectly(j.TEXTURE_CUBE_MAP,null)}};j(11376);h.ThinEngine.prototype.setDepthStencilTexture=function(q,f,j,d){void 0!==q&&(f&&(this._boundUniforms[q]=f),j&&j.depthStencilTexture?this._setTexture(q,j,!1,!0,d):this._setTexture(q,null,void 0,void 0,d))},h.ThinEngine.prototype.createRenderTargetCubeTexture=function(q,f){const j=this._createHardwareRenderTargetWrapper(!1,!0,q),g={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...f};g.generateStencilBuffer=g.generateDepthBuffer&&g.generateStencilBuffer,(1!==g.type||this._caps.textureFloatLinearFiltering)&&(2!==g.type||this._caps.textureHalfFloatLinearFiltering)||(g.samplingMode=1);const h=this._gl,L=new d.c(this,5);this._bindTextureDirectly(h.TEXTURE_CUBE_MAP,L,!0);const Q=this._getSamplingParameters(g.samplingMode,g.generateMipMaps);1!==g.type||this._caps.textureFloat||(g.type=0,u.e.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MAG_FILTER,Q.mag),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MIN_FILTER,Q.min),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE);for(let d=0;d<6;d++)h.texImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+d,0,this._getRGBABufferInternalSizedFormat(g.type,g.format),q,q,0,this._getInternalFormat(g.format),this._getWebGLTextureType(g.type),null);const H=h.createFramebuffer();return this._bindUnboundFramebuffer(H),j._depthStencilBuffer=this._setupFramebufferDepthAttachments(g.generateStencilBuffer,g.generateDepthBuffer,q,q),g.generateMipMaps&&h.generateMipmap(h.TEXTURE_CUBE_MAP),this._bindTextureDirectly(h.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),j._framebuffer=H,j._generateDepthBuffer=g.generateDepthBuffer,j._generateStencilBuffer=g.generateStencilBuffer,L.width=q,L.height=q,L.isReady=!0,L.isCube=!0,L.samples=1,L.generateMipMaps=g.generateMipMaps,L.samplingMode=g.samplingMode,L.type=g.type,L.format=g.format,this._internalTexturesCache.push(L),j.setTextures(L),j};var O=j(11389),N=j(11417);h.ThinEngine.prototype.createPrefilteredCubeTexture=function(q,f,g,h){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,H=arguments.length>6?arguments[6]:void 0,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,X=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];return this.createCubeTexture(q,f,null,!1,(async q=>{if(!q)return void(L&&L(null));const Q=q.texture;if(X?q.info.sphericalPolynomial&&(Q._sphericalPolynomial=q.info.sphericalPolynomial):Q._sphericalPolynomial=new O.f,Q._source=9,this.getCaps().textureLOD)return void(L&&L(Q));const H=this._gl,r=q.width;if(!r)return;const{DDSTools:z}=await j.e(26).then(j.bind(j,13420)),B=[];for(let j=0;j<3;j++){const L=1-j/2,X=h,D=Math.log2(r)*g+h,i=X+(D-X)*L,t=Math.round(Math.min(Math.max(i,0),D)),O=new d.c(this,2);if(O.type=Q.type,O.format=Q.format,O.width=Math.pow(2,Math.max(Math.log2(r)-t,0)),O.height=O.width,O.isCube=!0,O._cachedWrapU=0,O._cachedWrapV=0,this._bindTextureDirectly(H.TEXTURE_CUBE_MAP,O,!0),O.samplingMode=2,H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MAG_FILTER,H.LINEAR),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MIN_FILTER,H.LINEAR),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_S,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_T,H.CLAMP_TO_EDGE),q.isDDS){const f=q.info,j=q.data;this._unpackFlipY(f.isCompressed),z.UploadDDSLevels(this,O,j,f,!0,6,t)}else u.e.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(H.TEXTURE_CUBE_MAP,null);const w=new N.b(f);w._isCube=!0,w._texture=O,O.isReady=!0,B.push(w)}Q._lodTextureHigh=B[2],Q._lodTextureMid=B[1],Q._lodTextureLow=B[0],L&&L(Q)}),Q,H,r,X,g,h)},h.ThinEngine.prototype.createUniformBuffer=function(q,f){const j=this._gl.createBuffer();if(!j)throw new Error("Unable to create uniform buffer");const d=new r.c(j);return this.bindUniformBuffer(d),q instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,q,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(q),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),d.references=1,d},h.ThinEngine.prototype.createDynamicUniformBuffer=function(q,f){const j=this._gl.createBuffer();if(!j)throw new Error("Unable to create dynamic uniform buffer");const d=new r.c(j);return this.bindUniformBuffer(d),q instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,q,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(q),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),d.references=1,d},h.ThinEngine.prototype.updateUniformBuffer=function(q,f,j,d){this.bindUniformBuffer(q),void 0===j&&(j=0),void 0===d?f instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,j,f):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,j,new Float32Array(f)):f instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,f.subarray(j,j+d)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(f).subarray(j,j+d)),this.bindUniformBuffer(null)},h.ThinEngine.prototype.bindUniformBuffer=function(q){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,q?q.underlyingResource:null)},h.ThinEngine.prototype.bindUniformBufferBase=function(q,f,j){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,f,q?q.underlyingResource:null)},h.ThinEngine.prototype.bindUniformBlock=function(q,f,j){const d=q.program,g=this._gl.getUniformBlockIndex(d,f);4294967295!==g&&this._gl.uniformBlockBinding(d,g,j)};var w=j(10997),E=j(11065);E.b.prototype.displayLoadingUI=function(){if(!(0,w.h)())return;const q=this.loadingScreen;q&&q.displayLoadingUI()},E.b.prototype.hideLoadingUI=function(){if(!(0,w.h)())return;const q=this._loadingScreen;q&&q.hideLoadingUI()},Object.defineProperty(E.b.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=E.b.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(q){this._loadingScreen=q},enumerable:!0,configurable:!0}),Object.defineProperty(E.b.prototype,"loadingUIText",{set:function(q){this.loadingScreen.loadingUIText=q},enumerable:!0,configurable:!0}),Object.defineProperty(E.b.prototype,"loadingUIBackgroundColor",{set:function(q){this.loadingScreen.loadingUIBackgroundColor=q},enumerable:!0,configurable:!0}),E.b.prototype.getInputElement=function(){return this._renderingCanvas},E.b.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},E.b.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},E.b.prototype.getAspectRatio=function(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const j=q.viewport;return this.getRenderWidth(f)*j.width/(this.getRenderHeight(f)*j.height)},E.b.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},E.b.prototype._verifyPointerLock=function(){var q;null===(q=this._onPointerLockChange)||void 0===q||q.call(this)},E.b.prototype.setAlphaEquation=function(q){if(this._alphaEquation!==q){switch(q){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=q}},E.b.prototype.getInputElement=function(){return this._renderingCanvas},E.b.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},E.b.prototype.setDepthFunction=function(q){this._depthCullingState.depthFunc=q},E.b.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},E.b.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},E.b.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},E.b.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},E.b.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},E.b.prototype.setDepthWrite=function(q){this._depthCullingState.depthMask=q},E.b.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},E.b.prototype.setStencilBuffer=function(q){this._stencilState.stencilTest=q},E.b.prototype.getStencilMask=function(){return this._stencilState.stencilMask},E.b.prototype.setStencilMask=function(q){this._stencilState.stencilMask=q},E.b.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},E.b.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},E.b.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},E.b.prototype.setStencilFunction=function(q){this._stencilState.stencilFunc=q},E.b.prototype.setStencilFunctionReference=function(q){this._stencilState.stencilFuncRef=q},E.b.prototype.setStencilFunctionMask=function(q){this._stencilState.stencilFuncMask=q},E.b.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},E.b.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},E.b.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},E.b.prototype.setStencilOperationFail=function(q){this._stencilState.stencilOpStencilFail=q},E.b.prototype.setStencilOperationDepthFail=function(q){this._stencilState.stencilOpDepthFail=q},E.b.prototype.setStencilOperationPass=function(q){this._stencilState.stencilOpStencilDepthPass=q},E.b.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},E.b.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},E.b.prototype.setAlphaConstants=function(q,f,j,d){this._alphaState.setAlphaBlendConstants(q,f,j,d)},E.b.prototype.getAlphaMode=function(){return this._alphaMode},E.b.prototype.getAlphaEquation=function(){return this._alphaEquation},E.b.prototype.getRenderPassNames=function(){return this._renderPassNames},E.b.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},E.b.prototype.createRenderPassId=function(q){const f=++E.b._RenderPassIdCounter;return this._renderPassNames[f]=q??"NONAME",f},E.b.prototype.releaseRenderPassId=function(q){this._renderPassNames[q]=void 0;for(let f=0;f<this.scenes.length;++f){const j=this.scenes[f];for(let f=0;f<j.meshes.length;++f){const d=j.meshes[f];if(d.Qd)for(let f=0;f<d.Qd.length;++f){d.Qd[f]._removeDrawWrapper(q)}}}};j(11380);function s(q){if(q.requestPointerLock){const f=q.requestPointerLock();f instanceof Promise?f.then((()=>{q.focus()})).catch((()=>{})):q.focus()}}var S=j(11425),e=j(11059);class Z extends h.ThinEngine{static get NpmPackage(){return E.b.NpmPackage}static get Version(){return E.b.Version}static get Instances(){return g.d.Instances}static get LastCreatedEngine(){return g.d.LastCreatedEngine}static get LastCreatedScene(){return g.d.LastCreatedScene}static DefaultLoadingScreenFactory(q){return E.b.DefaultLoadingScreenFactory(q)}get _supportsHardwareTextureRescaling(){return!!Z._RescalePostProcessFactory}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}get performanceMonitor(){return this._performanceMonitor}constructor(q,f,j){super(q,f,j,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this.customAnimationFrameRequester=null,this._performanceMonitor=new Q,this._drawCalls=new S.b,q&&(this._features.supportRenderPasses=!0,j=this._creationOptions)}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_sharedInit(q){super._sharedInit(q),function(q,f,j){q._onCanvasFocus=()=>{q.onCanvasFocusObservable.notifyObservers(q)},q._onCanvasBlur=()=>{q.onCanvasBlurObservable.notifyObservers(q)},q._onCanvasContextMenu=f=>{q.disableContextMenu&&f.preventDefault()},f.addEventListener("focus",q._onCanvasFocus),f.addEventListener("blur",q._onCanvasBlur),f.addEventListener("contextmenu",q._onCanvasContextMenu),q._onBlur=()=>{q.disablePerformanceMonitorInBackground&&q.performanceMonitor.disable(),q._windowIsBackground=!0},q._onFocus=()=>{q.disablePerformanceMonitorInBackground&&q.performanceMonitor.enable(),q._windowIsBackground=!1},q._onCanvasPointerOut=j=>{document.elementFromPoint(j.clientX,j.clientY)!==f&&q.onCanvasPointerOutObservable.notifyObservers(j)};const d=q.getHostWindow();d&&"function"===typeof d.addEventListener&&(d.addEventListener("blur",q._onBlur),d.addEventListener("focus",q._onFocus)),f.addEventListener("pointerout",q._onCanvasPointerOut),j.doNotHandleTouchAction||function(q){q&&q.setAttribute&&(q.setAttribute("touch-action","none"),q.style.touchAction="none",q.style.webkitTapHighlightColor="transparent")}(f),!E.b.audioEngine&&j.audioEngine&&E.b.AudioEngineFactory&&(E.b.audioEngine=E.b.AudioEngineFactory(q.getRenderingCanvas(),q.getAudioContext(),q.getAudioDestination())),(0,w.c)()&&(q._onFullscreenChange=()=>{q.isFullscreen=!!document.fullscreenElement,q.isFullscreen&&q._pointerLockRequested&&f&&s(f)},document.addEventListener("fullscreenchange",q._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",q._onFullscreenChange,!1),q._onPointerLockChange=()=>{q.isPointerLock=document.pointerLockElement===f},document.addEventListener("pointerlockchange",q._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",q._onPointerLockChange,!1)),q.enableOfflineSupport=void 0!==E.b.OfflineProviderFactory,q._deterministicLockstep=!!j.deterministicLockstep,q._lockstepMaxSteps=j.lockstepMaxSteps||0,q._timeStep=j.timeStep||1/60}(this,q,this._creationOptions)}resizeImageBitmap(q,f,j){return function(q,f,j,d){const g=q.createCanvas(j,d).getContext("2d");if(!g)throw new Error("Unable to get 2d context for resizeImageBitmap");return g.drawImage(f,0,0),g.getImageData(0,0,j,d).data}(this,q,f,j)}async _createImageBitmapFromSource(q,f){return await async function(q,f,j){return await new Promise(((d,g)=>{const h=new Image;h.onload=()=>{h.decode().then((()=>{q.createImageBitmap(h,j).then((q=>{d(q)}))}))},h.onerror=()=>{g(`Error loading image ${h.src}`)},h.src=f}))}(this,q,f)}switchFullscreen(q){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(q)}enterFullscreen(q){this.isFullscreen||(this._pointerLockRequested=q,this._renderingCanvas&&function(q){const f=q.requestFullscreen||q.webkitRequestFullscreen;f&&f.call(q)}(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&function(){const q=document;document.exitFullscreen?document.exitFullscreen():q.webkitCancelFullScreen&&q.webkitCancelFullScreen()}()}setDitheringState(q){q?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(q){q?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}setDirectViewport(q,f,j,d){const g=this._cachedViewport;return this._cachedViewport=null,this._viewport(q,f,j,d),g}scissorClear(q,f,j,d,g){this.enableScissor(q,f,j,d),this.clear(g,!0,!0,!0),this.disableScissor()}enableScissor(q,f,j,d){const g=this._gl;g.enable(g.SCISSOR_TEST),g.scissor(q,f,j,d)}disableScissor(){const q=this._gl;q.disable(q.SCISSOR_TEST)}async _loadFileAsync(q,f,j){return await new Promise(((d,g)=>{this._loadFile(q,(q=>{d(q)}),void 0,f,j,((q,f)=>{g(f)}))}))}getVertexShaderSource(q){const f=this._gl.getAttachedShaders(q);return f?this._gl.getShaderSource(f[0]):null}getFragmentShaderSource(q){const f=this._gl.getAttachedShaders(q);return f?this._gl.getShaderSource(f[1]):null}set framebufferDimensionsObject(q){this._framebufferDimensionsObject=q,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}_rebuildBuffers(){for(const q of this.scenes)q.resetCachedMaterial(),q._rebuildGeometries();for(const q of this._virtualScenes)q.resetCachedMaterial(),q._rebuildGeometries();super._rebuildBuffers()}getFontOffset(q){return function(q){const f=document.createElement("span");f.textContent="Hg",f.style.font=q;const j=document.createElement("div");j.style.display="inline-block",j.style.width="1px",j.style.height="0px",j.style.verticalAlign="bottom";const d=document.createElement("div");d.style.whiteSpace="nowrap",d.appendChild(f),d.appendChild(j),document.body.appendChild(d);let g=0,h=0;try{h=j.getBoundingClientRect().top-f.getBoundingClientRect().top,j.style.verticalAlign="baseline",g=j.getBoundingClientRect().top-f.getBoundingClientRect().top}finally{document.body.removeChild(d)}return{ascent:g,height:h,descent:h-g}}(q)}_cancelFrame(){if(this.customAnimationFrameRequester){if(0!==this._frameHandler){this._frameHandler=0;const{cancelAnimationFrame:q}=this.customAnimationFrameRequester;q&&q(this.customAnimationFrameRequester.D)}}else super._cancelFrame()}_renderLoop(q){this._processFrame(q),this._activeRenderLoops.length>0&&0===this._frameHandler&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.D=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.D):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}enterPointerlock(){this._renderingCanvas&&s(this._renderingCanvas)}exitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}Bz(){this._measureFps(),super.Bz()}_deletePipelineContext(q){const f=q;f&&f.program&&f.transformFeedback&&(this.deleteTransformFeedback(f.transformFeedback),f.transformFeedback=null),super._deletePipelineContext(q)}createShaderProgram(q,f,j,d,g){let h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;g=g||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const L=super.createShaderProgram(q,f,j,d,g,h);return this.onAfterShaderCompilationObservable.notifyObservers(this),L}_createShaderProgram(q,f,j,d){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const h=d.createProgram();if(q.program=h,!h)throw new Error("Unable to create program");if(d.attachShader(h,f),d.attachShader(h,j),this.webGLVersion>1&&g){const f=this.createTransformFeedback();this.bindTransformFeedback(f),this.setTranformFeedbackVaryings(h,g),q.transformFeedback=f}return d.linkProgram(h),this.webGLVersion>1&&g&&this.bindTransformFeedback(null),q.context=d,q.vertexShader=f,q.fragmentShader=j,q.isParallelCompiled||this._finalizePipelineContext(q),h}_releaseTexture(q){super._releaseTexture(q)}_releaseRenderTargetWrapper(q){super._releaseRenderTargetWrapper(q);for(const f of this.scenes){for(const j of f.postProcesses)j._outputTexture===q&&(j._outputTexture=null);for(const j of f.cameras)for(const f of j._postProcesses)f&&f._outputTexture===q&&(f._outputTexture=null)}}_rescaleTexture(q,f,j,d,g){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const h=this.createRenderTargetTexture({width:f.width,height:f.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});if(!this._rescalePostProcess&&Z._RescalePostProcessFactory&&(this._rescalePostProcess=Z._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;const L=()=>{this._rescalePostProcess.onApply=function(f){f._bindTexture("textureSampler",q)};let L=j;L||(L=this.scenes[this.scenes.length-1]),L.postProcessManager.directRender([this._rescalePostProcess],h,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,f,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,d,0,0,f.width,f.height,0),this.unBindFramebuffer(h),h.dispose(),g&&g()},Q=this._rescalePostProcess.getEffect();Q?Q.executeWhenCompiled(L):this._rescalePostProcess.onEffectCreatedObservable.addOnce((q=>{q.executeWhenCompiled(L)}))}}wrapWebGLTexture(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const L=new X.c(q,this._gl),Q=new d.c(this,0,!0);return Q._hardwareTexture=L,Q.baseWidth=g,Q.baseHeight=h,Q.width=g,Q.height=h,Q.isReady=!0,Q.useMipMaps=f,this.updateTextureSamplingMode(j,Q),Q}_uploadImageToTexture(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const g=this._gl,h=this._getWebGLTextureType(q.type),L=this._getInternalFormat(q.format),Q=this._getRGBABufferInternalSizedFormat(q.type,L),H=q.isCube?g.TEXTURE_CUBE_MAP:g.TEXTURE_2D;this._bindTextureDirectly(H,q,!0),this._unpackFlipY(q.invertY);let r=g.TEXTURE_2D;q.isCube&&(r=g.TEXTURE_CUBE_MAP_POSITIVE_X+j),g.texImage2D(r,d,Q,L,h,f),this._bindTextureDirectly(H,null,!0)}updateTextureComparisonFunction(q,f){if(1===this.webGLVersion)return void u.e.Error("WebGL 1 does not support texture comparison.");const j=this._gl;q.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,q,!0),0===f?(j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_COMPARE_FUNC,515),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_COMPARE_MODE,j.NONE)):(j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_COMPARE_FUNC,f),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_COMPARE_MODE,j.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,q,!0),0===f?(j.texParameteri(j.TEXTURE_2D,j.TEXTURE_COMPARE_FUNC,515),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_COMPARE_MODE,j.NONE)):(j.texParameteri(j.TEXTURE_2D,j.TEXTURE_COMPARE_FUNC,f),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_COMPARE_MODE,j.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),q._comparisonFunction=f}createInstancesBuffer(q){const f=this._gl.createBuffer();if(!f)throw new Error("Unable to create instance buffer");const j=new r.c(f);return j.Zf=q,this.bindArrayBuffer(j),this._gl.bufferData(this._gl.ARRAY_BUFFER,q,this._gl.DYNAMIC_DRAW),j.references=1,j}deleteInstancesBuffer(q){this._gl.deleteBuffer(q)}async _clientWaitAsync(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;const d=this._gl;return await new Promise(((g,h)=>{(0,e.d)((()=>{const j=d.clientWaitSync(q,f,0);if(j==d.WAIT_FAILED)throw new Error("clientWaitSync failed");return j!=d.TIMEOUT_EXPIRED}),g,h,j)}))}_readPixelsAsync(q,f,j,d,g,h,L){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const Q=this._gl,H=Q.createBuffer();Q.bindBuffer(Q.PIXEL_PACK_BUFFER,H),Q.bufferData(Q.PIXEL_PACK_BUFFER,L.byteLength,Q.STREAM_READ),Q.readPixels(q,f,j,d,g,h,0),Q.bindBuffer(Q.PIXEL_PACK_BUFFER,null);const r=Q.fenceSync(Q.SYNC_GPU_COMMANDS_COMPLETE,0);return r?(Q.flush(),this._clientWaitAsync(r,0,10).then((()=>(Q.deleteSync(r),Q.bindBuffer(Q.PIXEL_PACK_BUFFER,H),Q.getBufferSubData(Q.PIXEL_PACK_BUFFER,0,L),Q.bindBuffer(Q.PIXEL_PACK_BUFFER,null),Q.deleteBuffer(H),L)))):null}dispose(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),function(q,f){1===g.d.Instances.length&&E.b.audioEngine&&(E.b.audioEngine.dispose(),E.b.audioEngine=null);const j=q.getHostWindow();j&&"function"===typeof j.removeEventListener&&(j.removeEventListener("blur",q._onBlur),j.removeEventListener("focus",q._onFocus)),f&&(f.removeEventListener("focus",q._onCanvasFocus),f.removeEventListener("blur",q._onCanvasBlur),f.removeEventListener("pointerout",q._onCanvasPointerOut),f.removeEventListener("contextmenu",q._onCanvasContextMenu)),(0,w.c)()&&(document.removeEventListener("fullscreenchange",q._onFullscreenChange),document.removeEventListener("mozfullscreenchange",q._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",q._onFullscreenChange),document.removeEventListener("msfullscreenchange",q._onFullscreenChange),document.removeEventListener("pointerlockchange",q._onPointerLockChange),document.removeEventListener("mspointerlockchange",q._onPointerLockChange),document.removeEventListener("mozpointerlockchange",q._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",q._onPointerLockChange))}(this,this._renderingCanvas),super.dispose()}}Z.ALPHA_DISABLE=0,Z.ALPHA_ADD=1,Z.ALPHA_COMBINE=2,Z.ALPHA_SUBTRACT=3,Z.ALPHA_MULTIPLY=4,Z.ALPHA_MAXIMIZED=5,Z.ALPHA_ONEONE=6,Z.ALPHA_PREMULTIPLIED=7,Z.ALPHA_PREMULTIPLIED_PORTERDUFF=8,Z.ALPHA_INTERPOLATE=9,Z.ALPHA_SCREENMODE=10,Z.DELAYLOADSTATE_NONE=0,Z.DELAYLOADSTATE_LOADED=1,Z.DELAYLOADSTATE_LOADING=2,Z.DELAYLOADSTATE_NOTLOADED=4,Z.NEVER=512,Z.ALWAYS=519,Z.LESS=513,Z.EQUAL=514,Z.LEQUAL=515,Z.GREATER=516,Z.GEQUAL=518,Z.NOTEQUAL=517,Z.KEEP=7680,Z.REPLACE=7681,Z.INCR=7682,Z.DECR=7683,Z.INVERT=5386,Z.INCR_WRAP=34055,Z.DECR_WRAP=34056,Z.TEXTURE_CLAMP_ADDRESSMODE=0,Z.TEXTURE_WRAP_ADDRESSMODE=1,Z.TEXTURE_MIRROR_ADDRESSMODE=2,Z.TEXTUREFORMAT_ALPHA=0,Z.TEXTUREFORMAT_LUMINANCE=1,Z.TEXTUREFORMAT_LUMINANCE_ALPHA=2,Z.TEXTUREFORMAT_RGB=4,Z.TEXTUREFORMAT_RGBA=5,Z.TEXTUREFORMAT_RED=6,Z.TEXTUREFORMAT_R=6,Z.TEXTUREFORMAT_R16_UNORM=33322,Z.TEXTUREFORMAT_RG16_UNORM=33324,Z.TEXTUREFORMAT_RGB16_UNORM=32852,Z.TEXTUREFORMAT_RGBA16_UNORM=32859,Z.TEXTUREFORMAT_R16_SNORM=36760,Z.TEXTUREFORMAT_RG16_SNORM=36761,Z.TEXTUREFORMAT_RGB16_SNORM=36762,Z.TEXTUREFORMAT_RGBA16_SNORM=36763,Z.TEXTUREFORMAT_RG=7,Z.TEXTUREFORMAT_RED_INTEGER=8,Z.TEXTUREFORMAT_R_INTEGER=8,Z.TEXTUREFORMAT_RG_INTEGER=9,Z.TEXTUREFORMAT_RGB_INTEGER=10,Z.TEXTUREFORMAT_RGBA_INTEGER=11,Z.TEXTURETYPE_UNSIGNED_BYTE=0,Z.TEXTURETYPE_UNSIGNED_INT=0,Z.TEXTURETYPE_FLOAT=1,Z.TEXTURETYPE_HALF_FLOAT=2,Z.TEXTURETYPE_BYTE=3,Z.TEXTURETYPE_SHORT=4,Z.TEXTURETYPE_UNSIGNED_SHORT=5,Z.TEXTURETYPE_INT=6,Z.TEXTURETYPE_UNSIGNED_INTEGER=7,Z.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,Z.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,Z.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,Z.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,Z.TEXTURETYPE_UNSIGNED_INT_24_8=12,Z.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,Z.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,Z.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,Z.TEXTURE_NEAREST_SAMPLINGMODE=1,Z.TEXTURE_BILINEAR_SAMPLINGMODE=2,Z.TEXTURE_TRILINEAR_SAMPLINGMODE=3,Z.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,Z.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,Z.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,Z.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,Z.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,Z.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,Z.TEXTURE_NEAREST_LINEAR=7,Z.TEXTURE_NEAREST_NEAREST=1,Z.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,Z.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,Z.TEXTURE_LINEAR_LINEAR=2,Z.TEXTURE_LINEAR_NEAREST=12,Z.TEXTURE_EXPLICIT_MODE=0,Z.TEXTURE_SPHERICAL_MODE=1,Z.TEXTURE_PLANAR_MODE=2,Z.TEXTURE_CUBIC_MODE=3,Z.TEXTURE_PROJECTION_MODE=4,Z.TEXTURE_SKYBOX_MODE=5,Z.TEXTURE_INVCUBIC_MODE=6,Z.TEXTURE_EQUIRECTANGULAR_MODE=7,Z.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,Z.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,Z.SCALEMODE_FLOOR=1,Z.SCALEMODE_NEAREST=2,Z.SCALEMODE_CEILING=3},10980:(q,f,j)=>{j.d(f,{d:()=>g});var d=j(10982);class g{static get LastCreatedEngine(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}static get LastCreatedScene(){return this._LastCreatedScene}}g.Instances=[],g.OnEnginesDisposedObservable=new d.d,g._LastCreatedScene=null,g.UseFallbackTexture=!0,g.FallbackTexture=""},10974:(q,f,j)=>{j.d(f,{b:()=>d});class d{static SetMatrixPrecision(q){if(d.MatrixTrackPrecisionChange=!1,q&&!d.MatrixUse64Bits&&d.MatrixTrackedMatrices)for(let f=0;f<d.MatrixTrackedMatrices.length;++f){const q=d.MatrixTrackedMatrices[f],j=q.cz;q.cz=new Array(16);for(let f=0;f<16;++f)q.cz[f]=j[f]}d.MatrixUse64Bits=q,d.MatrixCurrentType=d.MatrixUse64Bits?Array:Float32Array,d.MatrixTrackedMatrices=null}}d.MatrixUse64Bits=!1,d.MatrixTrackPrecisionChange=!0,d.MatrixCurrentType=Float32Array,d.MatrixTrackedMatrices=[]},11378:(q,f,j)=>{j.d(f,{c:()=>g});var d=j(11362);class g{get depthStencilTexture(){return this._depthStencilTexture}setDepthStencilTexture(q){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this._depthStencilTexture&&this._depthStencilTexture.dispose(),this._depthStencilTexture=q,this._generateDepthBuffer=this._generateStencilBuffer=this._depthStencilTextureWithStencil=!1,q&&(this._generateDepthBuffer=!0,this._generateStencilBuffer=this._depthStencilTextureWithStencil=(0,d.c)(q.format))}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}get isCube(){return this._isCube}get isMulti(){return this._isMulti}get is2DArray(){return this.layers>0}get is3D(){return this.depth>0}get size(){return this.width}get width(){return this._size.width??this._size}get height(){return this._size.height??this._size}get layers(){return this._size.layers||0}get depth(){return this._size.depth||0}get texture(){var q;return(null===(q=this._textures)||void 0===q?void 0:q[0])??null}get textures(){return this._textures}get faceIndices(){return this._faceIndices}get layerIndices(){return this._layerIndices}getBaseArrayLayer(q){var f,j;if(!this._textures)return-1;const d=this._textures[q],g=(null===(f=this._layerIndices)||void 0===f?void 0:f[q])??0,h=(null===(j=this._faceIndices)||void 0===j?void 0:j[q])??0;return d.isCube?6*g+h:d.is3D?0:g}get samples(){return this._samples}setSamples(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.samples===q&&!j)return q;const d=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,q,f):this._engine.updateRenderTargetTextureSampleCount(this,q);return this._samples=q,d}resolveMSAATextures(){this.isMulti?this._engine.resolveMultiFramebuffer(this):this._engine.resolveFramebuffer(this)}generateMipMaps(){this._engine._currentRenderTarget===this&&this._engine.unBindFramebuffer(this,!0),this.isMulti?this._engine.generateMipMapsMultiFramebuffer(this):this._engine.generateMipMapsFramebuffer(this)}constructor(q,f,j,d,g){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this.disableAutomaticMSAAResolve=!1,this.resolveMSAAColors=!0,this.resolveMSAADepth=!1,this.resolveMSAAStencil=!1,this._isMulti=q,this._isCube=f,this._size=j,this._engine=d,this._depthStencilTexture=null,this.label=g}setTextures(q){Array.isArray(q)?this._textures=q:this._textures=q?[q]:null}setTexture(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._textures||(this._textures=[]),this._textures[f]!==q&&(this._textures[f]&&j&&this._textures[f].dispose(),this._textures[f]=q)}setLayerAndFaceIndices(q,f){this._layerIndices=q,this._faceIndices=f}setLayerAndFaceIndex(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1?arguments[1]:void 0,j=arguments.length>2?arguments[2]:void 0;this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),void 0!==f&&f>=0&&(this._layerIndices[q]=f),void 0!==j&&j>=0&&(this._faceIndices[q]=j)}createDepthStencilTexture(){var q;let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,L=arguments.length>5?arguments[5]:void 0;return null===(q=this._depthStencilTexture)||void 0===q||q.dispose(),this._depthStencilTextureWithStencil=d,this._depthStencilTextureLabel=L,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:j,comparisonFunction:f,generateStencil:d,isCube:this._isCube,samples:g,depthTextureFormat:h,label:L},this),this._depthStencilTexture}_shareDepth(q){this.shareDepth(q)}shareDepth(q){this._depthStencilTexture&&(q._depthStencilTexture&&q._depthStencilTexture.dispose(),q._depthStencilTexture=this._depthStencilTexture,q._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}_swapAndDie(q){this.texture&&this.texture._swapAndDie(q),this._textures=null,this.dispose(!0)}_cloneRenderTargetWrapper(){let q=null;if(this._isMulti){const f=this.textures;if(f&&f.length>0){let j=!1,d=f.length,g=-1;const h=f[f.length-1]._source;14!==h&&12!==h||(j=!0,g=f[f.length-1].format,d--);const L=[],Q=[],H=[],r=[],u=[],X=[],z=[],B={};for(let q=0;q<d;++q){const j=f[q];L.push(j.samplingMode),Q.push(j.type),H.push(j.format);void 0!==B[j.uniqueId]?(r.push(-1),z.push(0)):(B[j.uniqueId]=q,j.is2DArray?(r.push(35866),z.push(j.depth)):j.isCube?(r.push(34067),z.push(0)):j.is3D?(r.push(32879),z.push(j.depth)):(r.push(3553),z.push(0))),this._faceIndices&&u.push(this._faceIndices[q]??0),this._layerIndices&&X.push(this._layerIndices[q]??0)}const D={samplingModes:L,generateMipMaps:f[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:j,depthTextureFormat:g,types:Q,formats:H,textureCount:d,targetTypes:r,faceIndex:u,layerIndex:X,layerCounts:z,label:this.label},i={width:this.width,height:this.height,depth:this.depth};q=this._engine.createMultipleRenderTarget(i,D);for(let t=0;t<d;++t){if(-1!==r[t])continue;const j=B[f[t].uniqueId];q.setTexture(q.textures[j],t)}}}else{var f,j,d,g;const L={};if(L.generateDepthBuffer=this._generateDepthBuffer,L.generateMipMaps=(null===(f=this.texture)||void 0===f?void 0:f.generateMipMaps)??!1,L.generateStencilBuffer=this._generateStencilBuffer,L.samplingMode=null===(j=this.texture)||void 0===j?void 0:j.samplingMode,L.type=null===(d=this.texture)||void 0===d?void 0:d.type,L.format=null===(g=this.texture)||void 0===g?void 0:g.format,L.noColorAttachment=!this._textures,L.label=this.label,this.isCube)q=this._engine.createRenderTargetCubeTexture(this.width,L);else{var h;const f={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?null===(h=this.texture)||void 0===h?void 0:h.depth:void 0};q=this._engine.createRenderTargetTexture(f,L)}q.texture&&(q.texture.isReady=!0)}return q}_swapRenderTargetWrapper(q){if(this._textures&&q._textures)for(let f=0;f<this._textures.length;++f)this._textures[f]._swapAndDie(q._textures[f],!1),q._textures[f].isReady=!0;this._depthStencilTexture&&q._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(q._depthStencilTexture),q._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}_rebuild(){const q=this._cloneRenderTargetWrapper();if(q){if(this._depthStencilTexture){const f=this._depthStencilTexture.samplingMode,j=this._depthStencilTexture.format,d=2===f||3===f||11===f;q.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,d,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,j,this._depthStencilTextureLabel)}this.samples>1&&q.setSamples(this.samples),q._swapRenderTargetWrapper(this),q.dispose()}}releaseTextures(){if(this._textures)for(let q=0;q<this._textures.length;++q)this._textures[q].dispose();this._textures=null}dispose(){var q;arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(null===(q=this._depthStencilTexture)||void 0===q||q.dispose(),this._depthStencilTexture=null,this.releaseTextures());this._engine._releaseRenderTargetWrapper(this)}}},11075:(q,f,j)=>{j.d(f,{b:()=>d});class d{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?d.ShadersRepository:d.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?d.ShadersStore:d.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?d.IncludesShadersStore:d.IncludesShadersStoreWGSL}}d.ShadersRepository="src/Shaders/",d.ShadersStore={},d.IncludesShadersStore={},d.ShadersRepositoryWGSL="src/ShadersWGSL/",d.ShadersStoreWGSL={},d.IncludesShadersStoreWGSL={}},11084:(q,f,j)=>{j.d(f,{d:()=>z,e:()=>w,i:()=>D,j:()=>B,m:()=>i,o:()=>N,r:()=>X,v:()=>r,z:()=>u,D:()=>H,F:()=>Q});class d{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.gH._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(q){q&&this.program&&q(this.program)}setEngine(q){this.gH=q}_fillEffectInformation(q,f,j,d,g,h,L,Q){const H=this.gH;if(H.supportsUniformBuffers)for(const u in f)q.bindUniformBlock(u,f[u]);let r;for(this.gH.getUniforms(this,j).forEach(((q,f)=>{d[j[f]]=q})),this._uniforms=d,r=0;r<g.length;r++){null==q.getUniform(g[r])&&(g.splice(r,1),r--)}g.forEach(((q,f)=>{h[q]=f}));for(const u of H.getAttributes(this,L))Q.push(u)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(q,f){const j=this._valueCache[q],d=f.updateFlag;return(void 0===j||j!==d)&&(this._valueCache[q]=d,!0)}_cacheFloat2(q,f,j){let d=this._valueCache[q];if(!d||2!==d.length)return d=[f,j],this._valueCache[q]=d,!0;let g=!1;return d[0]!==f&&(d[0]=f,g=!0),d[1]!==j&&(d[1]=j,g=!0),g}_cacheFloat3(q,f,j,d){let g=this._valueCache[q];if(!g||3!==g.length)return g=[f,j,d],this._valueCache[q]=g,!0;let h=!1;return g[0]!==f&&(g[0]=f,h=!0),g[1]!==j&&(g[1]=j,h=!0),g[2]!==d&&(g[2]=d,h=!0),h}_cacheFloat4(q,f,j,d,g){let h=this._valueCache[q];if(!h||4!==h.length)return h=[f,j,d,g],this._valueCache[q]=h,!0;let L=!1;return h[0]!==f&&(h[0]=f,L=!0),h[1]!==j&&(h[1]=j,L=!0),h[2]!==d&&(h[2]=d,L=!0),h[3]!==g&&(h[3]=g,L=!0),L}setInt(q,f){const j=this._valueCache[q];void 0!==j&&j===f||this.gH.setInt(this._uniforms[q],f)&&(this._valueCache[q]=f)}setInt2(q,f,j){this._cacheFloat2(q,f,j)&&(this.gH.setInt2(this._uniforms[q],f,j)||(this._valueCache[q]=null))}setInt3(q,f,j,d){this._cacheFloat3(q,f,j,d)&&(this.gH.setInt3(this._uniforms[q],f,j,d)||(this._valueCache[q]=null))}setInt4(q,f,j,d,g){this._cacheFloat4(q,f,j,d,g)&&(this.gH.setInt4(this._uniforms[q],f,j,d,g)||(this._valueCache[q]=null))}setIntArray(q,f){this._valueCache[q]=null,this.gH.setIntArray(this._uniforms[q],f)}setIntArray2(q,f){this._valueCache[q]=null,this.gH.setIntArray2(this._uniforms[q],f)}setIntArray3(q,f){this._valueCache[q]=null,this.gH.setIntArray3(this._uniforms[q],f)}setIntArray4(q,f){this._valueCache[q]=null,this.gH.setIntArray4(this._uniforms[q],f)}setUInt(q,f){const j=this._valueCache[q];void 0!==j&&j===f||this.gH.setUInt(this._uniforms[q],f)&&(this._valueCache[q]=f)}setUInt2(q,f,j){this._cacheFloat2(q,f,j)&&(this.gH.setUInt2(this._uniforms[q],f,j)||(this._valueCache[q]=null))}setUInt3(q,f,j,d){this._cacheFloat3(q,f,j,d)&&(this.gH.setUInt3(this._uniforms[q],f,j,d)||(this._valueCache[q]=null))}setUInt4(q,f,j,d,g){this._cacheFloat4(q,f,j,d,g)&&(this.gH.setUInt4(this._uniforms[q],f,j,d,g)||(this._valueCache[q]=null))}setUIntArray(q,f){this._valueCache[q]=null,this.gH.setUIntArray(this._uniforms[q],f)}setUIntArray2(q,f){this._valueCache[q]=null,this.gH.setUIntArray2(this._uniforms[q],f)}setUIntArray3(q,f){this._valueCache[q]=null,this.gH.setUIntArray3(this._uniforms[q],f)}setUIntArray4(q,f){this._valueCache[q]=null,this.gH.setUIntArray4(this._uniforms[q],f)}setArray(q,f){this._valueCache[q]=null,this.gH.setArray(this._uniforms[q],f)}setArray2(q,f){this._valueCache[q]=null,this.gH.setArray2(this._uniforms[q],f)}setArray3(q,f){this._valueCache[q]=null,this.gH.setArray3(this._uniforms[q],f)}setArray4(q,f){this._valueCache[q]=null,this.gH.setArray4(this._uniforms[q],f)}setMatrices(q,f){f&&(this._valueCache[q]=null,this.gH.setMatrices(this._uniforms[q],f))}setMatrix(q,f){this._cacheMatrix(q,f)&&(this.gH.setMatrices(this._uniforms[q],f.Yf())||(this._valueCache[q]=null))}setMatrix3x3(q,f){this._valueCache[q]=null,this.gH.setMatrix3x3(this._uniforms[q],f)}setMatrix2x2(q,f){this._valueCache[q]=null,this.gH.setMatrix2x2(this._uniforms[q],f)}setFloat(q,f){const j=this._valueCache[q];void 0!==j&&j===f||this.gH.setFloat(this._uniforms[q],f)&&(this._valueCache[q]=f)}setVector2(q,f){this._cacheFloat2(q,f.x,f.y)&&(this.gH.setFloat2(this._uniforms[q],f.x,f.y)||(this._valueCache[q]=null))}setFloat2(q,f,j){this._cacheFloat2(q,f,j)&&(this.gH.setFloat2(this._uniforms[q],f,j)||(this._valueCache[q]=null))}setVector3(q,f){this._cacheFloat3(q,f.x,f.y,f.z)&&(this.gH.setFloat3(this._uniforms[q],f.x,f.y,f.z)||(this._valueCache[q]=null))}setFloat3(q,f,j,d){this._cacheFloat3(q,f,j,d)&&(this.gH.setFloat3(this._uniforms[q],f,j,d)||(this._valueCache[q]=null))}setVector4(q,f){this._cacheFloat4(q,f.x,f.y,f.z,f.w)&&(this.gH.setFloat4(this._uniforms[q],f.x,f.y,f.z,f.w)||(this._valueCache[q]=null))}setQuaternion(q,f){this._cacheFloat4(q,f.x,f.y,f.z,f.w)&&(this.gH.setFloat4(this._uniforms[q],f.x,f.y,f.z,f.w)||(this._valueCache[q]=null))}setFloat4(q,f,j,d,g){this._cacheFloat4(q,f,j,d,g)&&(this.gH.setFloat4(this._uniforms[q],f,j,d,g)||(this._valueCache[q]=null))}setColor3(q,f){this._cacheFloat3(q,f.r,f.g,f.b)&&(this.gH.setFloat3(this._uniforms[q],f.r,f.g,f.b)||(this._valueCache[q]=null))}setColor4(q,f,j){this._cacheFloat4(q,f.r,f.g,f.b,j)&&(this.gH.setFloat4(this._uniforms[q],f.r,f.g,f.b,j)||(this._valueCache[q]=null))}setDirectColor4(q,f){this._cacheFloat4(q,f.r,f.g,f.b,f.a)&&(this.gH.setFloat4(this._uniforms[q],f.r,f.g,f.b,f.a)||(this._valueCache[q]=null))}_getVertexShaderCode(){return this.vertexShader?this.gH._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.gH._getShaderSource(this.fragmentShader):null}}var g=j(11054);const h=new WeakMap,L={_webGLVersion:2,cachedPipelines:{}};function Q(q){let f=h.get(q);if(!f){if(!q)return L;f={_webGLVersion:q.TEXTURE_BINDING_3D?2:1,_context:q,parallelShaderCompile:q.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},h.set(q,f)}return f}function H(q){h.delete(q)}function r(q,f,j,d,g,h){const L=Q(d);h||(h=L._createShaderProgramInjection??z);return h(q,O(f,"vertex",d,L._contextWasLost),O(j,"fragment",d,L._contextWasLost),d,g,L.validateShaderPrograms)}function u(q,f,j,d,g){let h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=arguments.length>6?arguments[6]:void 0;const H=Q(g);L||(L=H._createShaderProgramInjection??z);const r=H._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return L(q,t(f,"vertex",d,r,g,H._contextWasLost),t(j,"fragment",d,r,g,H._contextWasLost),g,h,H.validateShaderPrograms)}function X(q,f){const j=new d,g=Q(q);return g.parallelShaderCompile&&!g.disableParallelShaderCompile&&(j.isParallelCompiled=!0),j.context=g._context,j}function z(q,f,j,d){let g=arguments.length>5?arguments[5]:void 0;const h=d.createProgram();if(q.program=h,!h)throw new Error("Unable to create program");return d.attachShader(h,f),d.attachShader(h,j),d.linkProgram(h),q.context=d,q.vertexShader=f,q.fragmentShader=j,q.isParallelCompiled||D(q,d,g),h}function B(q,f,j){const d=q;if(d._isDisposed)return!1;const g=Q(f);return!!(g&&g.parallelShaderCompile&&g.parallelShaderCompile.COMPLETION_STATUS_KHR&&d.program&&f.getProgramParameter(d.program,g.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(D(d,f,j),!0)}function D(q,f,j){const d=q.context,g=q.vertexShader,h=q.fragmentShader,L=q.program;if(!d.getProgramParameter(L,d.LINK_STATUS)){if(!f.getShaderParameter(g,f.COMPILE_STATUS)){const j=f.getShaderInfoLog(g);if(j)throw q.vertexCompilationError=j,new Error("VERTEX SHADER "+j)}if(!f.getShaderParameter(h,f.COMPILE_STATUS)){const j=f.getShaderInfoLog(h);if(j)throw q.fragmentCompilationError=j,new Error("FRAGMENT SHADER "+j)}const j=d.getProgramInfoLog(L);if(j)throw q.programLinkError=j,new Error(j)}if(j){d.validateProgram(L);if(!d.getProgramParameter(L,d.VALIDATE_STATUS)){const f=d.getProgramInfoLog(L);if(f)throw q.programValidationError=f,new Error(f)}}d.deleteShader(g),d.deleteShader(h),q.vertexShader=void 0,q.fragmentShader=void 0,q.onCompiled&&(q.onCompiled(),q.onCompiled=void 0)}function i(q,f,j,d,g,h,L,H,X){let z=arguments.length>10?arguments[10]:void 0,B=arguments.length>11?arguments[11]:void 0,D=arguments.length>12?arguments[12]:void 0;const i=Q(q.context);B||(B=i.createRawShaderProgramInjection??r),D||(D=i.createShaderProgramInjection??u);const t=q;t.program=d?B(t,f,j,t.context,X):D(t,f,j,H,t.context,X),t.program.__SPECTOR_rebuildProgram=L,z()}function t(q,f,j,d,h,L){return O((0,g.i)(q,j,d),f,h,L)}function O(q,f,j,d){const g=j.createShader("vertex"===f?j.VERTEX_SHADER:j.FRAGMENT_SHADER);if(!g){let q=j.NO_ERROR,g=j.NO_ERROR;for(;(g=j.getError())!==j.NO_ERROR;)q=g;throw new Error(`Something went wrong while creating a gl ${f} shader object. gl error=${q}, gl isContextLost=${j.isContextLost()}, _contextWasLost=${d}`)}return j.shaderSource(g,q),j.compileShader(g),g}function N(q,f){f.useProgram(q)}function w(q,f){const j=q;if(!j.isParallelCompiled)return void f(q);const d=j.onCompiled;j.onCompiled=()=>{null===d||void 0===d||d(),f(q)}}},11337:(q,f,j)=>{j.r(f),j.d(f,{ThinEngine:()=>E});var d=j(11084),g=j(11345),h=j(11005),L=j(10997);class Q{constructor(){this.shaderLanguage=0}postProcessor(q,f,j,d,g){if(g.drawBuffersExtensionDisabled){const f=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;q=q.replace(f,"")}return q}}const H=/(flat\s)?\s*varying\s*.*/;class r{constructor(){this.shaderLanguage=0}attributeProcessor(q){return q.replace("attribute","in")}varyingCheck(q,f){return H.test(q)}varyingProcessor(q,f){return q.replace("varying",f?"in":"out")}postProcessor(q,f,j){const d=-1!==q.search(/#extension.+GL_EXT_draw_buffers.+require/);if(q=(q=q.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),j){const f=-1!==q.search(/layout *\(location *= *0\) *out/g);q=(q=(q=(q=(q=(q=(q=q.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(d||f?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==f.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+q}return q}}var u=j(11354),X=j(11114),z=j(11065),B=j(11356),D=j(11090),i=j(11067),t=j(11054),O=j(11082),N=j(11362);class w{}class E extends z.b{get name(){return this._name}set name(q){this._name=q}get version(){return this._webGLVersion}static get ShadersRepository(){return i.b.ShadersRepository}static set ShadersRepository(q){i.b.ShadersRepository=q}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(q){this._framebufferDimensionsObject=q}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(q,f,j,g){if(j=j||{},super(f??j.antialias,j,g),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!q)return;let L=null;if(q.getContext){if(L=q,void 0===j.Mu&&(j.Mu=!1),void 0===j.xrCompatible&&(j.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const q=navigator.userAgent;for(const f of E.ExceptionList){const d=f.key,g=f.targets;if(new RegExp(d).test(q)){if(f.capture&&f.captureConstraint){const j=f.capture,d=f.captureConstraint,g=new RegExp(j).exec(q);if(g&&g.length>0){if(parseInt(g[g.length-1])>=d)continue}}for(const q of g)switch(q){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":j.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost?this._onContextLost=()=>{(0,d.D)(this._gl)}:(this._onContextLost=q=>{q.preventDefault(),this._contextWasLost=!0,(0,d.D)(this._gl),h.e.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},L.addEventListener("webglcontextrestored",this._onContextRestored,!1),j.powerPreference=j.powerPreference||"high-performance"),L.addEventListener("webglcontextlost",this._onContextLost,!1),this._badDesktopOS&&(j.xrCompatible=!1),!j.disableWebGL2Support)try{this._gl=L.getContext("webgl2",j)||L.getContext("experimental-webgl2",j),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(X){}if(!this._gl){if(!L)throw new Error("The provided canvas is null or undefined.");try{this._gl=L.getContext("webgl",j)||L.getContext("experimental-webgl",j)}catch(X){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=q,L=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const f=this._gl.getContextAttributes();f&&(j.stencil=f.stencil)}this._sharedInit(L),this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==j.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=j.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let d=0;d<this._caps.maxVertexAttribs;d++)this._currentBufferPointers[d]=new w;this._shaderProcessor=this.webGLVersion>1?new r:new Q;const H=`Babylon.js v${E.Version}`;h.e.Log(H+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",H);const u=(0,d.F)(this._gl);u.validateShaderPrograms=this.validateShaderPrograms,u.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(q){return null}areAllEffectsReady(){for(const q in this._compiledEffects){if(!this._compiledEffects[q].isReady())return!1}return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1,textureNorm16:!!this._gl.getExtension("EXT_texture_norm16")},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const q=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=q&&(this._glRenderer=this._gl.getParameter(q.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(q.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.textureNorm16&&(this._gl.R16_EXT=33322,this._gl.RG16_EXT=33324,this._gl.RGB16_EXT=32852,this._gl.RGBA16_EXT=32859,this._gl.R16_SNORM_EXT=36760,this._gl.RG16_SNORM_EXT=36761,this._gl.RGB16_SNORM_EXT=36762,this._gl.RGBA16_SNORM_EXT=36763),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{const q=this._gl.getExtension("WEBGL_draw_buffers");if(null!==q){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=q.drawBuffersWEBGL.bind(q),this._caps.maxDrawBuffers=this._gl.getParameter(q.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let f=0;f<16;f++)this._gl["COLOR_ATTACHMENT"+f+"_WEBGL"]=q["COLOR_ATTACHMENT"+f+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const q=this._gl.getExtension("WEBGL_depth_texture");null!=q&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=q.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const q=this._gl.getExtension("OES_vertex_array_object");null!=q&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=q.createVertexArrayOES.bind(q),this._gl.bindVertexArray=q.bindVertexArrayOES.bind(q),this._gl.deleteVertexArray=q.deleteVertexArrayOES.bind(q))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const q=this._gl.getExtension("ANGLE_instanced_arrays");null!=q?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=q.drawArraysInstancedANGLE.bind(q),this._gl.drawElementsInstanced=q.drawElementsInstancedANGLE.bind(q),this._gl.vertexAttribDivisor=q.vertexAttribDivisorANGLE.bind(q)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const q=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),f=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);q&&f&&(this._caps.highPrecisionShaderSupported=0!==q.precision&&0!==f.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const q=this._gl.getExtension("EXT_blend_minmax");null!=q&&(this._caps.blendMinMax=!0,this._gl.MAX=q.MAX_EXT,this._gl.MIN=q.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const q=this._gl.getExtension("EXT_sRGB");null!=q&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:q.SRGB_EXT,SRGB8:q.SRGB_ALPHA_EXT,SRGB8_ALPHA8:q.SRGB_ALPHA_EXT})}if(this._creationOptions){const q=this._creationOptions.forceSRGBBufferSupportState;void 0!==q&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&q)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let f=0;f<this._maxSimultaneousTextures;f++)this._nextFreeTextureSlots.push(f);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"===typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const q=this._workingCanvas.getContext("2d");q&&(this._workingContext=q)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const q=this.getGlInfo();return q&&q.renderer?q.renderer:""}getRenderWidth(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const g=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=g;let h=0;if(f&&q){let f=!0;if(this._currentRenderTarget){var L;const j=null===(L=this._currentRenderTarget.texture)||void 0===L?void 0:L.format;if(8===j||9===j||10===j||11===j){var Q;const j=null===(Q=this._currentRenderTarget.texture)||void 0===Q?void 0:Q.type;7===j||5===j?(E._TempClearColorUint32[0]=255*q.r,E._TempClearColorUint32[1]=255*q.g,E._TempClearColorUint32[2]=255*q.b,E._TempClearColorUint32[3]=255*q.a,this._gl.clearBufferuiv(this._gl.COLOR,0,E._TempClearColorUint32),f=!1):(E._TempClearColorInt32[0]=255*q.r,E._TempClearColorInt32[1]=255*q.g,E._TempClearColorInt32[2]=255*q.b,E._TempClearColorInt32[3]=255*q.a,this._gl.clearBufferiv(this._gl.COLOR,0,E._TempClearColorInt32),f=!1)}}f&&(this._gl.clearColor(q.r,q.g,q.b,void 0!==q.a?q.a:1),h|=this._gl.COLOR_BUFFER_BIT)}j&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),h|=this._gl.DEPTH_BUFFER_BIT),d&&(this._gl.clearStencil(0),h|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(h)}_viewport(q,f,j,d){q===this._viewportCached.x&&f===this._viewportCached.y&&j===this._viewportCached.z&&d===this._viewportCached.w||(this._viewportCached.x=q,this._viewportCached.y=f,this._viewportCached.z=j,this._viewportCached.w=d,this._gl.viewport(q,f,j,d))}Dz(){super.Dz(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2?arguments[2]:void 0,d=arguments.length>3?arguments[3]:void 0,g=arguments.length>4?arguments[4]:void 0,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const H=q;this._currentRenderTarget&&this._resolveAndGenerateMipMapsFramebuffer(this._currentRenderTarget),this._currentRenderTarget=q,this._bindUnboundFramebuffer(H._framebuffer);const r=this._gl;var u;if(!q.isMulti)if(q.is2DArray||q.is3D)r.framebufferTextureLayer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,null===(u=q.texture._hardwareTexture)||void 0===u?void 0:u.underlyingResource,L,Q),H._currentLOD=L;else if(q.isCube){var X;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+f,null===(X=q.texture._hardwareTexture)||void 0===X?void 0:X.underlyingResource,L)}else if(H._currentLOD!==L){var z;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,null===(z=q.texture._hardwareTexture)||void 0===z?void 0:z.underlyingResource,L),H._currentLOD=L}const B=q._depthStencilTexture;if(B){q.is3D&&(q.texture.width===B.width&&q.texture.height===B.height&&q.texture.depth===B.depth||h.e.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const j=q._depthStencilTextureWithStencil?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT;var D;if(q.is2DArray||q.is3D)r.framebufferTextureLayer(r.FRAMEBUFFER,j,null===(D=B._hardwareTexture)||void 0===D?void 0:D.underlyingResource,L,Q);else if(q.isCube){var i;r.framebufferTexture2D(r.FRAMEBUFFER,j,r.TEXTURE_CUBE_MAP_POSITIVE_X+f,null===(i=B._hardwareTexture)||void 0===i?void 0:i.underlyingResource,L)}else{var t;r.framebufferTexture2D(r.FRAMEBUFFER,j,r.TEXTURE_2D,null===(t=B._hardwareTexture)||void 0===t?void 0:t.underlyingResource,L)}}H._MSAAFramebuffer&&this._bindUnboundFramebuffer(H._MSAAFramebuffer),this._cachedViewport&&!g?this.setViewport(this._cachedViewport,j,d):(j||(j=q.width,L&&(j/=Math.pow(2,L))),d||(d=q.height,L&&(d/=Math.pow(2,L))),this._viewport(0,0,j,d)),this.wipeCaches()}setStateCullFaceType(q,f){const j=this.cullBackFaces??q??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==j||f)&&(this._depthCullingState.cullFace=j)}setState(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2?arguments[2]:void 0,d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],g=arguments.length>4?arguments[4]:void 0,h=arguments.length>5?arguments[5]:void 0,L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(this._depthCullingState.cull!==q||j)&&(this._depthCullingState.cull=q),this.setStateCullFaceType(g,j),this.setZOffset(f),this.setZOffsetUnits(L);const Q=d?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==Q||j)&&(this._depthCullingState.frontFace=Q),this._stencilStateComposer.stencilMaterial=h}_resolveAndGenerateMipMapsFramebuffer(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];q.disableAutomaticMSAAResolve||(q.isMulti?this.resolveMultiFramebuffer(q):this.resolveFramebuffer(q)),f||(q.isMulti?this.generateMipMapsMultiFramebuffer(q):this.generateMipMapsFramebuffer(q))}_bindUnboundFramebuffer(q){this._currentFramebuffer!==q&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,q),this._currentFramebuffer=q)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(q){const f=this._getTextureTarget(q);this._bindTextureDirectly(f,q,!0),this._gl.generateMipmap(f),this._bindTextureDirectly(f,null)}unBindFramebuffer(q,f,j){const d=q;this._currentRenderTarget=null,this._resolveAndGenerateMipMapsFramebuffer(q,f),j&&(d._MSAAFramebuffer&&this._bindUnboundFramebuffer(d._framebuffer),j()),this._bindUnboundFramebuffer(null)}generateMipMapsFramebuffer(q){var f;q.isMulti||null===(f=q.texture)||void 0===f||!f.generateMipMaps||q.isCube||this.generateMipmaps(q.texture)}resolveFramebuffer(q){const f=q,j=this._gl;if(!f._MSAAFramebuffer||f.isMulti)return;let d=f.resolveMSAAColors?j.COLOR_BUFFER_BIT:0;d|=f._generateDepthBuffer&&f.resolveMSAADepth?j.DEPTH_BUFFER_BIT:0,d|=f._generateStencilBuffer&&f.resolveMSAAStencil?j.STENCIL_BUFFER_BIT:0,j.bindFramebuffer(j.READ_FRAMEBUFFER,f._MSAAFramebuffer),j.bindFramebuffer(j.DRAW_FRAMEBUFFER,f._framebuffer),j.blitFramebuffer(0,0,q.width,q.height,0,0,q.width,q.height,d,j.NEAREST)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(q,f,j){return this._createVertexBuffer(q,this._gl.STATIC_DRAW)}_createVertexBuffer(q,f){const j=this._gl.createBuffer();if(!j)throw new Error("Unable to create vertex buffer");const d=new u.c(j);return this.bindArrayBuffer(d),"number"!==typeof q?q instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(q),f),d.Zf=4*q.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,q,f),d.Zf=q.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(q),f),d.Zf=q),this._resetVertexBufferBinding(),d.references=1,d}createDynamicVertexBuffer(q,f){return this._createVertexBuffer(q,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(q,f,j){const d=this._gl.createBuffer(),g=new u.c(d);if(!d)throw new Error("Unable to create index buffer");this.bindIndexBuffer(g);const h=this._normalizeIndexData(q);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,h,f?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),g.references=1,g.is32Bits=4===h.BYTES_PER_ELEMENT,g}_normalizeIndexData(q){if(2===q.BYTES_PER_ELEMENT)return q;if(this._caps.uintIndices){if(q instanceof Uint32Array)return q;for(let f=0;f<q.length;f++)if(q[f]>=65535)return new Uint32Array(q);return new Uint16Array(q)}return new Uint16Array(q)}bindArrayBuffer(q){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(q,this._gl.ARRAY_BUFFER)}bindUniformBlock(q,f,j){const d=q.program,g=this._gl.getUniformBlockIndex(d,f);this._gl.uniformBlockBinding(d,g,j)}bindIndexBuffer(q){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(q,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(q,f){(this._vaoRecordInProgress||this._currentBoundBuffer[f]!==q)&&(this._gl.bindBuffer(f,q?q.underlyingResource:null),this._currentBoundBuffer[f]=q)}updateArrayBuffer(q){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,q)}_vertexAttribPointer(q,f,j,d,g,h,L){const Q=this._currentBufferPointers[f];if(!Q)return;let H=!1;Q.active?(Q.buffer!==q&&(Q.buffer=q,H=!0),Q.size!==j&&(Q.size=j,H=!0),Q.type!==d&&(Q.type=d,H=!0),Q.normalized!==g&&(Q.normalized=g,H=!0),Q.stride!==h&&(Q.stride=h,H=!0),Q.offset!==L&&(Q.offset=L,H=!0)):(H=!0,Q.active=!0,Q.index=f,Q.size=j,Q.type=d,Q.normalized=g,Q.stride=h,Q.offset=L,Q.buffer=q),(H||this._vaoRecordInProgress)&&(this.bindArrayBuffer(q),d===this._gl.UNSIGNED_INT||d===this._gl.INT?this._gl.vertexAttribIPointer(f,j,d,h,L):this._gl.vertexAttribPointer(f,j,d,g,h,L))}_bindIndexBufferWithCache(q){null!=q&&this._cachedIndexBuffer!==q&&(this._cachedIndexBuffer=q,this.bindIndexBuffer(q),this._uintIndicesCurrentlySet=q.is32Bits)}_bindVertexBuffersAttributes(q,f,j){const d=f.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let g=0;g<d.length;g++){const h=f.getAttributeLocation(g);if(h>=0){const f=d[g];let L=null;if(j&&(L=j[f]),L||(L=q[f]),!L)continue;this._gl.enableVertexAttribArray(h),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[h]=!0);const Q=L.getBuffer();Q&&(this._vertexAttribPointer(Q,h,L.getSize(),L.type,L.normalized,L.byteStride,L.byteOffset),L.getIsInstanced()&&(this._gl.vertexAttribDivisor(h,L.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(h),this._currentInstanceBuffers.push(Q))))}}}recordVertexArrayObject(q,f,j,d){const g=this._gl.createVertexArray();if(!g)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(g),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(q,j,d),this.bindIndexBuffer(f),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),g}bindVertexArrayObject(q,f){this._cachedVertexArrayObject!==q&&(this._cachedVertexArrayObject=q,this._gl.bindVertexArray(q),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=f&&f.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(q,f,j,d,g){if(this._cachedVertexBuffers!==q||this._cachedEffectForVertexBuffers!==g){this._cachedVertexBuffers=q,this._cachedEffectForVertexBuffers=g;const f=g.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let h=0;for(let L=0;L<f;L++)if(L<j.length){const f=g.getAttributeLocation(L);f>=0&&(this._gl.enableVertexAttribArray(f),this._vertexAttribArraysEnabled[f]=!0,this._vertexAttribPointer(q,f,j[L],this._gl.FLOAT,!1,d,h)),h+=4*j[L]}}this._bindIndexBufferWithCache(f)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(q,f,j,d){this._cachedVertexBuffers===q&&this._cachedEffectForVertexBuffers===j||(this._cachedVertexBuffers=q,this._cachedEffectForVertexBuffers=j,this._bindVertexBuffersAttributes(q,j,d)),this._bindIndexBufferWithCache(f)}unbindInstanceAttributes(){let q;for(let f=0,j=this._currentInstanceLocations.length;f<j;f++){const j=this._currentInstanceBuffers[f];q!=j&&j.references&&(q=j,this.bindArrayBuffer(j));const d=this._currentInstanceLocations[f];this._gl.vertexAttribDivisor(d,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(q){this._gl.deleteVertexArray(q)}_releaseBuffer(q){return q.references--,0===q.references&&(this._deleteBuffer(q),!0)}_deleteBuffer(q){this._gl.deleteBuffer(q.underlyingResource)}updateAndBindInstancesBuffer(q,f,j){if(this.bindArrayBuffer(q),f&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,f),void 0!==j[0].index)this.bindInstancesBuffer(q,j,!0);else for(let d=0;d<4;d++){const f=j[d];this._vertexAttribArraysEnabled[f]||(this._gl.enableVertexAttribArray(f),this._vertexAttribArraysEnabled[f]=!0),this._vertexAttribPointer(q,f,4,this._gl.FLOAT,!1,64,16*d),this._gl.vertexAttribDivisor(f,1),this._currentInstanceLocations.push(f),this._currentInstanceBuffers.push(q)}}bindInstancesBuffer(q,f){let j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.bindArrayBuffer(q);let d=0;if(j)for(let g=0;g<f.length;g++){d+=4*f[g].attributeSize}for(let g=0;g<f.length;g++){const j=f[g];void 0===j.index&&(j.index=this._currentEffect.getAttributeLocationByName(j.attributeName)),j.index<0||(this._vertexAttribArraysEnabled[j.index]||(this._gl.enableVertexAttribArray(j.index),this._vertexAttribArraysEnabled[j.index]=!0),this._vertexAttribPointer(q,j.index,j.attributeSize,j.attributeType||this._gl.FLOAT,j.normalized||!1,d,j.offset),this._gl.vertexAttribDivisor(j.index,void 0===j.divisor?1:j.divisor),this._currentInstanceLocations.push(j.index),this._currentInstanceBuffers.push(q))}}disableInstanceAttributeByName(q){if(!this._currentEffect)return;const f=this._currentEffect.getAttributeLocationByName(q);this.disableInstanceAttribute(f)}disableInstanceAttribute(q){let f,j=!1;for(;-1!==(f=this._currentInstanceLocations.indexOf(q));)this._currentInstanceLocations.splice(f,1),this._currentInstanceBuffers.splice(f,1),j=!0,f=this._currentInstanceLocations.indexOf(q);j&&(this._gl.vertexAttribDivisor(q,0),this.disableAttributeByIndex(q))}disableAttributeByIndex(q){this._gl.disableVertexAttribArray(q),this._vertexAttribArraysEnabled[q]=!1,this._currentBufferPointers[q].active=!1}draw(q,f,j,d){this.drawElementsType(q?0:1,f,j,d)}drawPointClouds(q,f,j){this.drawArraysType(2,q,f,j)}drawUnIndexed(q,f,j,d){this.drawArraysType(q?0:1,f,j,d)}drawElementsType(q,f,j,d){this.applyStates(),this._reportDrawCall();const g=this._drawMode(q),h=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,L=this._uintIndicesCurrentlySet?4:2;d?this._gl.drawElementsInstanced(g,j,h,f*L,d):this._gl.drawElements(g,j,h,f*L)}drawArraysType(q,f,j,d){this.applyStates(),this._reportDrawCall();const g=this._drawMode(q);d?this._gl.drawArraysInstanced(g,f,j,d):this._gl.drawArrays(g,f,j)}_drawMode(q){switch(q){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(q){this._compiledEffects[q._key]&&delete this._compiledEffects[q._key];const f=q.getPipelineContext();f&&this._deletePipelineContext(f)}_deletePipelineContext(q){const f=q;f&&f.program&&(f.program.__SPECTOR_rebuildProgram=null,(0,O.l)(f),this._gl&&(this._currentProgram===f.program&&this._setProgram(null),this._gl.deleteProgram(f.program)))}_getGlobalDefines(q){return(0,t.l)(q,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(q,f,j,g,h,L,Q,H,r){let u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,X=arguments.length>10?arguments[10]:void 0;const z="string"===typeof q?q:q.vertexToken||q.vertexSource||q.vertexElement||q.vertex,B="string"===typeof q?q:q.fragmentToken||q.fragmentSource||q.fragmentElement||q.fragment,D=this._getGlobalDefines(),t=void 0!==f.attributes;let O=h??f.defines??"";D&&(O+=D);const N=z+"+"+B+"@"+O;if(this._compiledEffects[N]){const q=this._compiledEffects[N];return Q&&q.isReady()&&Q(q),q._refCount++,q}this._gl&&(0,d.F)(this._gl);const w=new i.b(q,f,t?this:j,g,this,h,L,Q,H,r,N,f.shaderLanguage??u,f.extraInitializationsAsync??X);return this._compiledEffects[N]=w,w}_getShaderSource(q){return this._gl.getShaderSource(q)}createRawShaderProgram(q,f,j,g){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const L=(0,d.F)(this._gl);return L._contextWasLost=this._contextWasLost,L.validateShaderPrograms=this.validateShaderPrograms,(0,d.v)(q,f,j,g||this._gl,h)}createShaderProgram(q,f,j,g,h){let L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const Q=(0,d.F)(this._gl);return Q._contextWasLost=this._contextWasLost,Q.validateShaderPrograms=this.validateShaderPrograms,(0,d.z)(q,f,j,g,h||this._gl,L)}inlineShaderCode(q){return q}createPipelineContext(q){if(this._gl){(0,d.F)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const f=(0,d.r)(this._gl,q);return f.gH=this,f}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(q){return(0,d.i)(q,this._gl,this.validateShaderPrograms)}_preparePipelineContextAsync(q,f,j,g,h,L,Q,H,r,u,X){const z=(0,d.F)(this._gl);return z._contextWasLost=this._contextWasLost,z.validateShaderPrograms=this.validateShaderPrograms,z._createShaderProgramInjection=this._createShaderProgram.bind(this),z.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),z.createShaderProgramInjection=this.createShaderProgram.bind(this),z.loadFileInjection=this._loadFile.bind(this),(0,d.m)(q,f,j,g,h,L,Q,H,r,u,X)}_createShaderProgram(q,f,j,g){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,d.d)(q,f,j,g,h)}_isRenderingStateCompiled(q){return!this._isDisposed&&(0,d.j)(q,this._gl,this.validateShaderPrograms)}_executeWhenRenderingStateIsCompiled(q,f){(0,d.e)(q,f)}getUniforms(q,f){const j=new Array,d=q;for(let g=0;g<f.length;g++)j.push(this._gl.getUniformLocation(d.program,f[g]));return j}getAttributes(q,f){const j=[],d=q;for(let h=0;h<f.length;h++)try{j.push(this._gl.getAttribLocation(d.program,f[h]))}catch(g){j.push(-1)}return j}enableEffect(q){(q=null!==q&&(0,g.d)(q)?q.effect:q)&&q!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(q),this._currentEffect=q,q.onBind&&q.onBind(q),q._onBindObservable&&q._onBindObservable.notifyObservers(q))}setInt(q,f){return!!q&&(this._gl.uniform1i(q,f),!0)}setInt2(q,f,j){return!!q&&(this._gl.uniform2i(q,f,j),!0)}setInt3(q,f,j,d){return!!q&&(this._gl.uniform3i(q,f,j,d),!0)}setInt4(q,f,j,d,g){return!!q&&(this._gl.uniform4i(q,f,j,d,g),!0)}setIntArray(q,f){return!!q&&(this._gl.uniform1iv(q,f),!0)}setIntArray2(q,f){return!(!q||f.length%2!==0)&&(this._gl.uniform2iv(q,f),!0)}setIntArray3(q,f){return!(!q||f.length%3!==0)&&(this._gl.uniform3iv(q,f),!0)}setIntArray4(q,f){return!(!q||f.length%4!==0)&&(this._gl.uniform4iv(q,f),!0)}setUInt(q,f){return!!q&&(this._gl.uniform1ui(q,f),!0)}setUInt2(q,f,j){return!!q&&(this._gl.uniform2ui(q,f,j),!0)}setUInt3(q,f,j,d){return!!q&&(this._gl.uniform3ui(q,f,j,d),!0)}setUInt4(q,f,j,d,g){return!!q&&(this._gl.uniform4ui(q,f,j,d,g),!0)}setUIntArray(q,f){return!!q&&(this._gl.uniform1uiv(q,f),!0)}setUIntArray2(q,f){return!(!q||f.length%2!==0)&&(this._gl.uniform2uiv(q,f),!0)}setUIntArray3(q,f){return!(!q||f.length%3!==0)&&(this._gl.uniform3uiv(q,f),!0)}setUIntArray4(q,f){return!(!q||f.length%4!==0)&&(this._gl.uniform4uiv(q,f),!0)}setArray(q,f){return!!q&&(!(f.length<1)&&(this._gl.uniform1fv(q,f),!0))}setArray2(q,f){return!(!q||f.length%2!==0)&&(this._gl.uniform2fv(q,f),!0)}setArray3(q,f){return!(!q||f.length%3!==0)&&(this._gl.uniform3fv(q,f),!0)}setArray4(q,f){return!(!q||f.length%4!==0)&&(this._gl.uniform4fv(q,f),!0)}setMatrices(q,f){return!!q&&(this._gl.uniformMatrix4fv(q,!1,f),!0)}setMatrix3x3(q,f){return!!q&&(this._gl.uniformMatrix3fv(q,!1,f),!0)}setMatrix2x2(q,f){return!!q&&(this._gl.uniformMatrix2fv(q,!1,f),!0)}setFloat(q,f){return!!q&&(this._gl.uniform1f(q,f),!0)}setFloat2(q,f,j){return!!q&&(this._gl.uniform2f(q,f,j),!0)}setFloat3(q,f,j,d){return!!q&&(this._gl.uniform3f(q,f,j,d),!0)}setFloat4(q,f,j,d,g){return!!q&&(this._gl.uniform4f(q,f,j,d,g),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const q=this._colorWrite;this._gl.colorMask(q,q,q,q)}}wipeCaches(q){this.preventCacheWipeBetweenFrames&&!q||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),q&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(q,f){const j=this._gl;let d=j.NEAREST,g=j.NEAREST,h=!1;switch(q){case 11:d=j.LINEAR,g=f?j.LINEAR_MIPMAP_NEAREST:j.LINEAR;break;case 3:d=j.LINEAR,h=!0,g=f?j.LINEAR_MIPMAP_LINEAR:j.LINEAR;break;case 8:h=!0,d=j.NEAREST,g=f?j.NEAREST_MIPMAP_LINEAR:j.NEAREST;break;case 4:d=j.NEAREST,g=f?j.NEAREST_MIPMAP_NEAREST:j.NEAREST;break;case 5:d=j.NEAREST,g=f?j.LINEAR_MIPMAP_NEAREST:j.LINEAR;break;case 6:h=!0,d=j.NEAREST,g=f?j.LINEAR_MIPMAP_LINEAR:j.LINEAR;break;case 7:d=j.NEAREST,g=j.LINEAR;break;case 1:d=j.NEAREST,g=j.NEAREST;break;case 9:d=j.LINEAR,g=f?j.NEAREST_MIPMAP_NEAREST:j.NEAREST;break;case 10:h=!0,d=j.LINEAR,g=f?j.NEAREST_MIPMAP_LINEAR:j.NEAREST;break;case 2:d=j.LINEAR,g=j.LINEAR;break;case 12:d=j.LINEAR,g=j.NEAREST}return{min:g,mag:d,hasMipMaps:h}}_createTexture(){const q=this._gl.createTexture();if(!q)throw new Error("Unable to create texture");return q}_createHardwareTexture(){return new B.c(this._createTexture(),this._gl)}_createInternalTexture(q,f){let j,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,g=!1,L=!1,Q=0,H=3,r=5,u=!1,X=1,z=!1,B=0;void 0!==f&&"object"===typeof f?(g=!!f.generateMipMaps,L=!!f.createMipMaps,Q=void 0===f.type?0:f.type,H=void 0===f.samplingMode?3:f.samplingMode,r=void 0===f.format?5:f.format,u=void 0!==f.useSRGBBuffer&&f.useSRGBBuffer,X=f.samples??1,j=f.label,z=!!f.createMSAATexture,B=f.comparisonFunction||0):g=!!f,u&&(u=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==Q||this._caps.textureFloatLinearFiltering)&&(2!==Q||this._caps.textureHalfFloatLinearFiltering)||(H=1),1!==Q||this._caps.textureFloat||(Q=0,h.e.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const i=(0,N.d)(r),t=(0,N.c)(r),O=this._gl,w=new D.c(this,d),E=q.width||q,s=q.height||q,S=q.depth||0,e=q.layers||0,Z=this._getSamplingParameters(H,(g||L)&&!i),I=0!==e?O.TEXTURE_2D_ARRAY:0!==S?O.TEXTURE_3D:O.TEXTURE_2D,T=i?this._getInternalFormatFromDepthTextureFormat(r,!0,t):this._getRGBABufferInternalSizedFormat(Q,r,u),W=i?t?O.DEPTH_STENCIL:O.DEPTH_COMPONENT:this._getInternalFormat(r),n=i?this._getWebGLTextureTypeFromDepthTextureFormat(r):this._getWebGLTextureType(Q);if(this._bindTextureDirectly(I,w),0!==e?(w.is2DArray=!0,O.texImage3D(I,0,T,E,s,e,0,W,n,null)):0!==S?(w.is3D=!0,O.texImage3D(I,0,T,E,s,S,0,W,n,null)):O.texImage2D(I,0,T,E,s,0,W,n,null),O.texParameteri(I,O.TEXTURE_MAG_FILTER,Z.mag),O.texParameteri(I,O.TEXTURE_MIN_FILTER,Z.min),O.texParameteri(I,O.TEXTURE_WRAP_S,O.CLAMP_TO_EDGE),O.texParameteri(I,O.TEXTURE_WRAP_T,O.CLAMP_TO_EDGE),i&&this.webGLVersion>1&&(0===B?(O.texParameteri(I,O.TEXTURE_COMPARE_FUNC,515),O.texParameteri(I,O.TEXTURE_COMPARE_MODE,O.NONE)):(O.texParameteri(I,O.TEXTURE_COMPARE_FUNC,B),O.texParameteri(I,O.TEXTURE_COMPARE_MODE,O.COMPARE_REF_TO_TEXTURE))),(g||L)&&this._gl.generateMipmap(I),this._bindTextureDirectly(I,null),w._useSRGBBuffer=u,w.baseWidth=E,w.baseHeight=s,w.width=E,w.height=s,w.depth=e||S,w.isReady=!0,w.samples=X,w.generateMipMaps=g,w.samplingMode=H,w.type=Q,w.format=r,w.label=j,w.comparisonFunction=B,this._internalTexturesCache.push(w),z){let q=null;if(q=(0,N.d)(w.format)?this._setupFramebufferDepthAttachments((0,N.c)(w.format),19!==w.format,w.width,w.height,X,w.format,!0):this._createRenderBuffer(w.width,w.height,X,-1,this._getRGBABufferInternalSizedFormat(w.type,w.format,w._useSRGBBuffer),-1),!q)throw new Error("Unable to create render buffer");w._autoMSAAManagement=!0;let f=w._hardwareTexture;f||(f=w._hardwareTexture=this._createHardwareTexture()),f.addMSAARenderBuffer(q)}return w}_getUseSRGBBuffer(q,f){return q&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||f)}createTexture(q,f,j,d){var g=this;let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,X=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,z=arguments.length>11?arguments[11]:void 0,B=arguments.length>12?arguments[12]:void 0,i=arguments.length>13?arguments[13]:void 0,t=arguments.length>14?arguments[14]:void 0;return this._createTextureBase(q,f,j,d,h,L,Q,(function(){for(var q=arguments.length,f=new Array(q),j=0;j<q;j++)f[j]=arguments[j];return g._prepareWebGLTexture(...f,u)}),((q,f,j,g,h,L)=>{const Q=this._gl,H=j.width===q&&j.height===f;h._creationFlags=i??0;const r=this._getTexImageParametersForCreateTexture(h.format,h._useSRGBBuffer);if(H)return Q.texImage2D(Q.TEXTURE_2D,0,r.internalFormat,r.format,r.type,j),!1;const u=this._caps.maxTextureSize;if(j.width>u||j.height>u||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=q,this._workingCanvas.height=f,this._workingContext.drawImage(j,0,0,j.width,j.height,0,0,q,f),Q.texImage2D(Q.TEXTURE_2D,0,r.internalFormat,r.format,r.type,this._workingCanvas),h.width=q,h.height=f,!1);{const q=new D.c(this,2);this._bindTextureDirectly(Q.TEXTURE_2D,q,!0),Q.texImage2D(Q.TEXTURE_2D,0,r.internalFormat,r.format,r.type,j),this._rescaleTexture(q,h,d,r.format,(()=>{this._releaseTexture(q),this._bindTextureDirectly(Q.TEXTURE_2D,h,!0),L()}))}return!0}),H,r,u,X,z,B,t)}_getTexImageParametersForCreateTexture(q,f){let j,d;return 1===this.webGLVersion?(j=this._getInternalFormat(q,f),d=j):(j=this._getInternalFormat(q,!1),d=this._getRGBABufferInternalSizedFormat(0,q,f)),{internalFormat:d,format:j,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(q,f,j,d,g){}_unpackFlipY(q){this._unpackFlipYCached!==q&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,q?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=q))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(q){return q.isCube?this._gl.TEXTURE_CUBE_MAP:q.is3D?this._gl.TEXTURE_3D:q.is2DArray||q.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(q,f){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const d=this._getTextureTarget(f),g=this._getSamplingParameters(q,f.useMipMaps||j);this._setTextureParameterInteger(d,this._gl.TEXTURE_MAG_FILTER,g.mag,f),this._setTextureParameterInteger(d,this._gl.TEXTURE_MIN_FILTER,g.min),j&&g.hasMipMaps&&(f.generateMipMaps=!0,this._gl.generateMipmap(d)),this._bindTextureDirectly(d,null),f.samplingMode=q}updateTextureDimensions(q,f,j){}updateTextureWrappingMode(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const g=this._getTextureTarget(q);null!==f&&(this._setTextureParameterInteger(g,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(f),q),q._cachedWrapU=f),null!==j&&(this._setTextureParameterInteger(g,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(j),q),q._cachedWrapV=j),(q.is2DArray||q.is3D)&&null!==d&&(this._setTextureParameterInteger(g,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(d),q),q._cachedWrapR=d),this._bindTextureDirectly(g,null)}_uploadCompressedDataToTextureDirectly(q,f,j,d,g){let h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const Q=this._gl;let H=Q.TEXTURE_2D;if(q.isCube&&(H=Q.TEXTURE_CUBE_MAP_POSITIVE_X+h),q._useSRGBBuffer)switch(f){case 37492:case 36196:this._caps.etc2?f=Q.COMPRESSED_SRGB8_ETC2:q._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?f=Q.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:q._useSRGBBuffer=!1;break;case 36492:f=Q.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:f=Q.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?f=Q.COMPRESSED_SRGB_S3TC_DXT1_EXT:q._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?f=Q.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:q._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?f=Q.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:q._useSRGBBuffer=!1;break;default:q._useSRGBBuffer=!1}this._gl.compressedTexImage2D(H,L,f,j,d,0,g)}_uploadDataToTextureDirectly(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,g=arguments.length>4?arguments[4]:void 0,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const L=this._gl,Q=this._getWebGLTextureType(q.type),H=this._getInternalFormat(q.format),r=void 0===g?this._getRGBABufferInternalSizedFormat(q.type,q.format,q._useSRGBBuffer):this._getInternalFormat(g,q._useSRGBBuffer);this._unpackFlipY(q.invertY);let u=L.TEXTURE_2D;q.isCube&&(u=L.TEXTURE_CUBE_MAP_POSITIVE_X+j);const X=Math.round(Math.log(q.width)*Math.LOG2E),z=Math.round(Math.log(q.height)*Math.LOG2E),B=h?q.width:Math.pow(2,Math.max(X-d,0)),D=h?q.height:Math.pow(2,Math.max(z-d,0));L.texImage2D(u,d,r,B,D,0,H,Q,f)}updateTextureData(q,f,j,d,g,h){let L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,H=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const r=this._gl,u=this._getWebGLTextureType(q.type),X=this._getInternalFormat(q.format);this._unpackFlipY(q.invertY);let z=r.TEXTURE_2D,B=r.TEXTURE_2D;q.isCube&&(B=r.TEXTURE_CUBE_MAP_POSITIVE_X+L,z=r.TEXTURE_CUBE_MAP),this._bindTextureDirectly(z,q,!0),r.texSubImage2D(B,Q,j,d,g,h,X,u,f),H&&this._gl.generateMipmap(B),this._bindTextureDirectly(z,null)}_uploadArrayBufferViewToTexture(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const g=this._gl,h=q.isCube?g.TEXTURE_CUBE_MAP:g.TEXTURE_2D;this._bindTextureDirectly(h,q,!0),this._uploadDataToTextureDirectly(q,f,j,d),this._bindTextureDirectly(h,null,!0)}_prepareWebGLTextureContinuation(q,f,j,d,g){const h=this._gl;if(!h)return;const L=this._getSamplingParameters(g,!j);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,L.mag),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,L.min),j||d||h.generateMipmap(h.TEXTURE_2D),this._bindTextureDirectly(h.TEXTURE_2D,null),f&&f.removePendingData(q),q.onLoadedObservable.notifyObservers(q),q.onLoadedObservable.clear()}_prepareWebGLTexture(q,f,j,d,g,h,L,Q,H,r){const u=this.getCaps().maxTextureSize,z=Math.min(u,this.needPOTTextures?(0,X.g)(d.width,u):d.width),B=Math.min(u,this.needPOTTextures?(0,X.g)(d.height,u):d.height),D=this._gl;D&&(q._hardwareTexture?(this._bindTextureDirectly(D.TEXTURE_2D,q,!0),this._unpackFlipY(void 0===g||!!g),q.baseWidth=d.width,q.baseHeight=d.height,q.width=z,q.height=B,q.isReady=!0,q.type=-1!==q.type?q.type:0,q.format=-1!==q.format?q.format:r??(".jpg"!==f||q._useSRGBBuffer?5:4),Q(z,B,d,f,q,(()=>{this._prepareWebGLTextureContinuation(q,j,h,L,H)}))||this._prepareWebGLTextureContinuation(q,j,h,L,H)):j&&j.removePendingData(q))}_getInternalFormatFromDepthTextureFormat(q,f,j){const d=this._gl;if(!f)return d.STENCIL_INDEX8;let g=j?d.DEPTH_STENCIL:d.DEPTH_COMPONENT;return this.webGLVersion>1?15===q?g=d.DEPTH_COMPONENT16:16===q?g=d.DEPTH_COMPONENT24:17===q||13===q?g=j?d.DEPTH24_STENCIL8:d.DEPTH_COMPONENT24:14===q?g=d.DEPTH_COMPONENT32F:18===q&&(g=j?d.DEPTH32F_STENCIL8:d.DEPTH_COMPONENT32F):g=d.DEPTH_COMPONENT16,g}_getWebGLTextureTypeFromDepthTextureFormat(q){const f=this._gl;let j=f.UNSIGNED_INT;return 15===q?j=f.UNSIGNED_SHORT:17===q||13===q?j=f.UNSIGNED_INT_24_8:14===q?j=f.FLOAT:18===q?j=f.FLOAT_32_UNSIGNED_INT_24_8_REV:19===q&&(j=f.UNSIGNED_BYTE),j}_setupFramebufferDepthAttachments(q,f,j,d){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,h=arguments.length>5?arguments[5]:void 0,L=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const Q=this._gl;h=h??(q?13:14);const H=this._getInternalFormatFromDepthTextureFormat(h,f,q);return q&&f?this._createRenderBuffer(j,d,g,Q.DEPTH_STENCIL,H,L?-1:Q.DEPTH_STENCIL_ATTACHMENT):f?this._createRenderBuffer(j,d,g,H,H,L?-1:Q.DEPTH_ATTACHMENT):q?this._createRenderBuffer(j,d,g,H,H,L?-1:Q.STENCIL_ATTACHMENT):null}_createRenderBuffer(q,f,j,d,g,h){let L=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const Q=this._gl.createRenderbuffer();return this._updateRenderBuffer(Q,q,f,j,d,g,h,L)}_updateRenderBuffer(q,f,j,d,g,h,L){let Q=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const H=this._gl;return H.bindRenderbuffer(H.RENDERBUFFER,q),d>1&&H.renderbufferStorageMultisample?H.renderbufferStorageMultisample(H.RENDERBUFFER,d,h,f,j):H.renderbufferStorage(H.RENDERBUFFER,g,f,j),-1!==L&&H.framebufferRenderbuffer(H.FRAMEBUFFER,L,H.RENDERBUFFER,q),Q&&H.bindRenderbuffer(H.RENDERBUFFER,null),q}_releaseTexture(q){this._deleteTexture(q._hardwareTexture),this.unbindAllTextures();const f=this._internalTexturesCache.indexOf(q);-1!==f&&this._internalTexturesCache.splice(f,1),q._lodTextureHigh&&q._lodTextureHigh.dispose(),q._lodTextureMid&&q._lodTextureMid.dispose(),q._lodTextureLow&&q._lodTextureLow.dispose(),q._irradianceTexture&&q._irradianceTexture.dispose()}_deleteTexture(q){null===q||void 0===q||q.release()}_setProgram(q){this._currentProgram!==q&&((0,d.o)(q,this._gl),this._currentProgram=q)}bindSamplers(q){const f=q.getPipelineContext();this._setProgram(f.program);const j=q.getSamplers();for(let d=0;d<j.length;d++){const f=q.getUniform(j[d]);f&&(this._boundUniforms[d]=f)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(q,f){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],g=!1;const L=f&&f._associatedChannel>-1;j&&L&&(this._activeChannel=f._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==f||d){if(this._activateCurrentTexture(),f&&f.isMultiview)throw h.e.Error(["_bindTextureDirectly called with a multiview texture!",q,f]),"_bindTextureDirectly called with a multiview texture!";var Q;this._gl.bindTexture(q,(null===f||void 0===f||null===(Q=f._hardwareTexture)||void 0===Q?void 0:Q.underlyingResource)??null),this._boundTexturesCache[this._activeChannel]=f,f&&(f._associatedChannel=this._activeChannel)}else j&&(g=!0,this._activateCurrentTexture());return L&&!j&&this._bindSamplerUniformToChannel(f._associatedChannel,this._activeChannel),g}_bindTexture(q,f,j){if(void 0===q)return;f&&(f._associatedChannel=q),this._activeChannel=q;const d=f?this._getTextureTarget(f):this._gl.TEXTURE_2D;this._bindTextureDirectly(d,f)}unbindAllTextures(){for(let q=0;q<this._maxSimultaneousTextures;q++)this._activeChannel=q,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(q,f,j,d){void 0!==q&&(f&&(this._boundUniforms[q]=f),this._setTexture(q,j))}_bindSamplerUniformToChannel(q,f){const j=this._boundUniforms[q];j&&j._currentState!==f&&(this._gl.uniform1i(j,f),j._currentState=f)}_getTextureWrapMode(q){switch(q){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(q,f){let j,d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],g=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!f)return null!=this._boundTexturesCache[q]&&(this._activeChannel=q,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(f.video){this._activeChannel=q;const j=f.getInternalTexture();j&&(j._associatedChannel=q),f.update()}else if(4===f.delayLoadState)return f.delayLoad(),!1;j=g?f.depthStencilTexture:f.isReady()?f.getInternalTexture():f.isCube?this.emptyCubeTexture:f.is3D?this.emptyTexture3D:f.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!d&&j&&(j._associatedChannel=q);let h=!0;this._boundTexturesCache[q]===j&&(d||this._bindSamplerUniformToChannel(j._associatedChannel,q),h=!1),this._activeChannel=q;const L=this._getTextureTarget(j);if(h&&this._bindTextureDirectly(L,j,d),j&&!j.isMultiview){if(j.isCube&&j._cachedCoordinatesMode!==f.coordinatesMode){j._cachedCoordinatesMode=f.coordinatesMode;const q=3!==f.coordinatesMode&&5!==f.coordinatesMode?1:0;f.wrapU=q,f.wrapV=q}j._cachedWrapU!==f.wrapU&&(j._cachedWrapU=f.wrapU,this._setTextureParameterInteger(L,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(f.wrapU),j)),j._cachedWrapV!==f.wrapV&&(j._cachedWrapV=f.wrapV,this._setTextureParameterInteger(L,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(f.wrapV),j)),j.is3D&&j._cachedWrapR!==f.wrapR&&(j._cachedWrapR=f.wrapR,this._setTextureParameterInteger(L,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(f.wrapR),j)),this._setAnisotropicLevel(L,j,f.anisotropicFilteringLevel)}return!0}setTextureArray(q,f,j,d){if(void 0!==q&&f){this._textureUnits&&this._textureUnits.length===j.length||(this._textureUnits=new Int32Array(j.length));for(let f=0;f<j.length;f++){const d=j[f].getInternalTexture();d?(this._textureUnits[f]=q+f,d._associatedChannel=q+f):this._textureUnits[f]=-1}this._gl.uniform1iv(f,this._textureUnits);for(let q=0;q<j.length;q++)this._setTexture(this._textureUnits[q],j[q],!0)}}_setAnisotropicLevel(q,f,j){const d=this._caps.textureAnisotropicFilterExtension;11!==f.samplingMode&&3!==f.samplingMode&&2!==f.samplingMode&&(j=1),d&&f._cachedAnisotropicFilteringLevel!==j&&(this._setTextureParameterFloat(q,d.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(j,this._caps.maxAnisotropy),f),f._cachedAnisotropicFilteringLevel=j)}_setTextureParameterFloat(q,f,j,d){this._bindTextureDirectly(q,d,!0,!0),this._gl.texParameterf(q,f,j)}_setTextureParameterInteger(q,f,j,d){d&&this._bindTextureDirectly(q,d,!0,!0),this._gl.texParameteri(q,f,j)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let q=0;q<this._caps.maxVertexAttribs;q++)this.disableAttributeByIndex(q)}else for(let q=0,f=this._vertexAttribArraysEnabled.length;q<f;q++)q>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[q]||this.disableAttributeByIndex(q)}releaseEffects(){this._compiledEffects={},this.onReleaseEffectsObservable.notifyObservers(this)}dispose(){var q;((0,L.h)()&&this._renderingCanvas&&(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._onContextRestored&&this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored)),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose)&&(null===(q=this._gl.getExtension("WEBGL_lose_context"))||void 0===q||q.loseContext());(0,d.D)(this._gl)}attachContextLostEvent(q){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",q,!1)}attachContextRestoredEvent(q){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",q,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(q){const f=this._gl;for(;f.getError()!==f.NO_ERROR;);let j=!0;const d=f.createTexture();f.bindTexture(f.TEXTURE_2D,d),f.texImage2D(f.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(q),1,1,0,f.RGBA,this._getWebGLTextureType(q),null),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST);const g=f.createFramebuffer();f.bindFramebuffer(f.FRAMEBUFFER,g),f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,d,0);const h=f.checkFramebufferStatus(f.FRAMEBUFFER);if(j=j&&h===f.FRAMEBUFFER_COMPLETE,j=j&&f.getError()===f.NO_ERROR,j&&(f.clear(f.COLOR_BUFFER_BIT),j=j&&f.getError()===f.NO_ERROR),j){f.bindFramebuffer(f.FRAMEBUFFER,null);const q=f.RGBA,d=f.UNSIGNED_BYTE,g=new Uint8Array(4);f.readPixels(0,0,1,1,q,d,g),j=j&&f.getError()===f.NO_ERROR}for(f.deleteTexture(d),f.deleteFramebuffer(g),f.bindFramebuffer(f.FRAMEBUFFER,null);!j&&f.getError()!==f.NO_ERROR;);return j}_getWebGLTextureType(q){if(1===this._webGLVersion){switch(q){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(q){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=f?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(q){case 0:j=this._gl.ALPHA;break;case 1:j=this._gl.LUMINANCE;break;case 2:j=this._gl.LUMINANCE_ALPHA;break;case 6:case 33322:case 36760:j=this._gl.RED;break;case 7:case 33324:case 36761:j=this._gl.RG;break;case 4:case 32852:case 36762:j=f?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:case 32859:case 36763:j=f?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(q){case 8:j=this._gl.RED_INTEGER;break;case 9:j=this._gl.RG_INTEGER;break;case 10:j=this._gl.RGB_INTEGER;break;case 11:j=this._gl.RGBA_INTEGER}return j}_getRGBABufferInternalSizedFormat(q,f){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(1===this._webGLVersion){if(void 0!==f)switch(f){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return j?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(q){case 3:switch(f){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(f){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return j?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return j?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(f){case 8:return this._gl.R16I;case 36760:return this._gl.R16_SNORM_EXT;case 36761:return this._gl.RG16_SNORM_EXT;case 36762:return this._gl.RGB16_SNORM_EXT;case 36763:return this._gl.RGBA16_SNORM_EXT;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(f){case 8:return this._gl.R16UI;case 33322:return this._gl.R16_EXT;case 33324:return this._gl.RG16_EXT;case 32852:return this._gl.RGB16_EXT;case 32859:return this._gl.RGBA16_EXT;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(f){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(f){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(f){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(f){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(f){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return j?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(q,f,j,d){let g=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],L=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;const H=g?4:3,r=g?this._gl.RGBA:this._gl.RGB,u=j*d*H;if(Q){if(Q.length<u)return h.e.Error(`Data buffer is too small to store the read pixels (${Q.length} should be more than ${u})`),Promise.resolve(Q)}else Q=new Uint8Array(u);return L&&this.flushFramebuffer(),this._gl.readPixels(q,f,j,d,r,this._gl.UNSIGNED_BYTE,Q),Promise.resolve(Q)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const q=z.b._CreateCanvas(1,1),f=q.getContext("webgl")||q.getContext("experimental-webgl");this._IsSupported=null!=f&&!!window.WebGLRenderingContext}catch(q){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const q=z.b._CreateCanvas(1,1),f=q.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||q.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!f}catch(q){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}E._TempClearColorUint32=new Uint32Array(4),E._TempClearColorInt32=new Int32Array(4),E.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],E._ConcatenateShader=t.i,E._IsSupported=null,E._HasMajorPerformanceCaveat=null},11529:(q,f,j)=>{var d;j.d(f,{c:()=>g}),function(q){q[q.PointerMove=0]="PointerMove",q[q.PointerDown=1]="PointerDown",q[q.PointerUp=2]="PointerUp"}(d||(d={}));class g{}g.DOM_DELTA_PIXEL=0,g.DOM_DELTA_LINE=1,g.DOM_DELTA_PAGE=2},11526:(q,f,j)=>{j.d(f,{c:()=>d,d:()=>h,h:()=>g});class d{}d.KEYDOWN=1,d.KEYUP=2;class g{constructor(q,f){this.type=q,this.event=f}}class h extends g{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(q){this.skipOnKeyboardObservable=q}constructor(q,f){super(q,f),this.type=q,this.event=f,this.skipOnKeyboardObservable=!1}}},11524:(q,f,j)=>{j.d(f,{b:()=>g,d:()=>L,f:()=>Q});var d=j(10941);class g{}g.POINTERDOWN=1,g.POINTERUP=2,g.POINTERMOVE=4,g.POINTERWHEEL=8,g.POINTERPICK=16,g.POINTERTAP=32,g.POINTERDOUBLETAP=64;class h{constructor(q,f){this.type=q,this.event=f}}class L extends h{constructor(q,f,j,g){super(q,f),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new d.i(j,g)}}class Q extends h{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}constructor(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(q,f),this._pickInfo=j,this._inputManager=d}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}},11632:(q,f,j)=>{j.d(f,{e:()=>z});var d=j(11125),g=j(11130),h=j(10941),L=j(11210),Q=j(11247),H=j(11190),r=j(10965),u=j(11228),X=j(11199);class z extends Q.d{get range(){return this._range}set range(q){this._range=q,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(q){this._intensityMode=q,this._computePhotometricScale()}get radius(){return this._radius}set radius(q){this._radius=q,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(q){this._shadowEnabled!==q&&(this._shadowEnabled=q,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(q){this._includedOnlyMeshes=q,this._hookArrayForIncludedOnly(q)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(q){this._excludedMeshes=q,this._hookArrayForExcluded(q)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(q){this._excludeWithLayerMask=q,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(q){this._includeOnlyWithLayerMask=q,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(q){this._lightmapMode!==q&&(this._lightmapMode=q,this._markMeshesAsLightDirty())}getViewMatrix(q){return null}getProjectionMatrix(q,f){return null}constructor(q,f){super(q,f,!1),this.zd=new L.c(1,1,1),this.bu=new L.c(1,1,1),this.falloffType=z.FALLOFF_DEFAULT,this.Xd=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=z.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.eq().addLight(this),this._uniformBuffer=new H.d(this.eq().getEngine(),void 0,void 0,q),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(q,f){return this}_bindLight(q,f,j,d){let g=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const h=q.toString();let Q=!1;if(this._uniformBuffer.bindToEffect(j,"Light"+h),this._renderId!==f.getRenderId()||this._lastUseSpecular!==d||!this._uniformBuffer.useUbo){this._renderId=f.getRenderId(),this._lastUseSpecular=d;const q=this.getScaledIntensity();this.transferToEffect(j,h),this.zd.scaleToRef(q,L.i.o[0]),this._uniformBuffer.updateColor4("vLightDiffuse",L.i.o[0],this.range,h),d&&(this.bu.scaleToRef(q,L.i.o[1]),this._uniformBuffer.updateColor4("vLightSpecular",L.i.o[1],this.radius,h)),Q=!0}if(this.transferTexturesToEffect(j,h),f.shadowsEnabled&&this.shadowEnabled&&g){const q=this.getShadowGenerator(f.activeCamera)??this.getShadowGenerator();q&&(q.bindShadowLight(h,j),Q=!0)}Q?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(q){let f="Name: "+this.name;if(f+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let j=0;j<this.animations.length;j++)f+=", animation[0]: "+this.animations[j].toString(q);return f}_syncParentEnabledState(){super._syncParentEnabledState(),this.B()||this._resyncMeshes()}DH(q){super.DH(q),this._resyncMeshes()}getShadowGenerator(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(q)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return h.j.Zero()}canAffectMesh(q){return!q||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(q))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(q))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&q.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&q.layerMask)))}dispose(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const q=this._shadowGenerators.values();for(let f=q.next();!0!==f.done;f=q.next()){f.value.dispose()}this._shadowGenerators=null}if(this.eq().stopAnimation(this),this._parentContainer){const q=this._parentContainer.lights.indexOf(this);q>-1&&this._parentContainer.lights.splice(q,1),this._parentContainer=null}for(const j of this.eq().meshes)j._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.eq().removeLight(this),super.dispose(q,f)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.Xd}clone(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const j=z.GetConstructorFromName(this.getTypeID(),q,this.eq());if(!j)return null;const d=X.d.Clone(j,this);return q&&(d.name=q),f&&(d.parent=f),d.DH(this.isEnabled()),this.onClonedObservable.notifyObservers(d),d}serialize(){const q=X.d.Serialize(this);if(q.uniqueId=this.uniqueId,q.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(q),this.excludedMeshes.length>0){q.excludedMeshesIds=[];for(const f of this.excludedMeshes)q.excludedMeshesIds.push(f.id)}if(this.includedOnlyMeshes.length>0){q.includedOnlyMeshesIds=[];for(const f of this.includedOnlyMeshes)q.includedOnlyMeshesIds.push(f.id)}return X.d.AppendSerializedAnimations(this,q),q.ranges=this.serializeAnimationRanges(),q.isEnabled=this.isEnabled(),q}static GetConstructorFromName(q,f,j){const d=Q.d.Construct("Light_Type_"+q,f,j);return d||null}static Parse(q,f){const j=z.GetConstructorFromName(q.type,q.name,f);if(!j)return null;const d=X.d.Parse(j,q,f);if(q.excludedMeshesIds&&(d._excludedMeshesIds=q.excludedMeshesIds),q.includedOnlyMeshesIds&&(d._includedOnlyMeshesIds=q.includedOnlyMeshesIds),void 0!==q.parentId&&(d._waitingParentId=q.parentId),void 0!==q.parentInstanceIndex&&(d._waitingParentInstanceIndex=q.parentInstanceIndex),void 0!==q.falloffType&&(d.falloffType=q.falloffType),void 0!==q.lightmapMode&&(d.lightmapMode=q.lightmapMode),q.animations){for(let f=0;f<q.animations.length;f++){const j=q.animations[f],g=(0,r.c)("BABYLON.Animation");g&&d.animations.push(g.Parse(j))}Q.d.ParseAnimationRanges(d,q,f)}return q.autoAnimate&&f.beginAnimation(d,q.autoAnimateFrom,q.autoAnimateTo,q.autoAnimateLoop,q.autoAnimateSpeed||1),void 0!==q.isEnabled&&d.DH(q.isEnabled),d}_hookArrayForExcluded(q){var f=this;const j=q.push;q.push=function(){for(var d=arguments.length,g=new Array(d),h=0;h<d;h++)g[h]=arguments[h];const L=j.apply(q,g);for(const q of g)q._resyncLightSource(f);return L};const d=q.splice;q.splice=(f,j)=>{const g=d.apply(q,[f,j]);for(const q of g)q._resyncLightSource(this);return g};for(const g of q)g._resyncLightSource(this)}_hookArrayForIncludedOnly(q){var f=this;const j=q.push;q.push=function(){for(var d=arguments.length,g=new Array(d),h=0;h<d;h++)g[h]=arguments[h];const L=j.apply(q,g);return f._resyncMeshes(),L};const d=q.splice;q.splice=(f,j)=>{const g=d.apply(q,[f,j]);return this._resyncMeshes(),g},this._resyncMeshes()}_resyncMeshes(){for(const q of this.eq().meshes)q._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const q of this.eq().meshes)-1!==q.lightSources.indexOf(this)&&q._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.eq().resetCachedMaterial()}_getPhotometricScale(){let q=0;const f=this.getTypeID();let j=this.intensityMode;switch(j===z.INTENSITYMODE_AUTOMATIC&&(j=f===z.LIGHTTYPEID_DIRECTIONALLIGHT?z.INTENSITYMODE_ILLUMINANCE:z.INTENSITYMODE_LUMINOUSINTENSITY),f){case z.LIGHTTYPEID_POINTLIGHT:case z.LIGHTTYPEID_SPOTLIGHT:switch(j){case z.INTENSITYMODE_LUMINOUSPOWER:q=1/(4*Math.PI);break;case z.INTENSITYMODE_LUMINOUSINTENSITY:q=1;break;case z.INTENSITYMODE_LUMINANCE:q=this.radius*this.radius}break;case z.LIGHTTYPEID_DIRECTIONALLIGHT:switch(j){case z.INTENSITYMODE_ILLUMINANCE:q=1;break;case z.INTENSITYMODE_LUMINANCE:{let f=this.radius;f=Math.max(f,.001);q=2*Math.PI*(1-Math.cos(f));break}}break;case z.LIGHTTYPEID_HEMISPHERICLIGHT:q=1}return q}_reorderLightsInScene(){const q=this.eq();0!=this._renderPriority&&(q.requireLightSorting=!0),this.eq().sortLightsByPriority()}_isReady(){return!0}}z.FALLOFF_DEFAULT=u.d.FALLOFF_DEFAULT,z.FALLOFF_PHYSICAL=u.d.FALLOFF_PHYSICAL,z.FALLOFF_GLTF=u.d.FALLOFF_GLTF,z.FALLOFF_STANDARD=u.d.FALLOFF_STANDARD,z.LIGHTMAP_DEFAULT=u.d.LIGHTMAP_DEFAULT,z.LIGHTMAP_SPECULAR=u.d.LIGHTMAP_SPECULAR,z.LIGHTMAP_SHADOWSONLY=u.d.LIGHTMAP_SHADOWSONLY,z.INTENSITYMODE_AUTOMATIC=u.d.INTENSITYMODE_AUTOMATIC,z.INTENSITYMODE_LUMINOUSPOWER=u.d.INTENSITYMODE_LUMINOUSPOWER,z.INTENSITYMODE_LUMINOUSINTENSITY=u.d.INTENSITYMODE_LUMINOUSINTENSITY,z.INTENSITYMODE_ILLUMINANCE=u.d.INTENSITYMODE_ILLUMINANCE,z.INTENSITYMODE_LUMINANCE=u.d.INTENSITYMODE_LUMINANCE,z.LIGHTTYPEID_POINTLIGHT=u.d.LIGHTTYPEID_POINTLIGHT,z.LIGHTTYPEID_DIRECTIONALLIGHT=u.d.LIGHTTYPEID_DIRECTIONALLIGHT,z.LIGHTTYPEID_SPOTLIGHT=u.d.LIGHTTYPEID_SPOTLIGHT,z.LIGHTTYPEID_HEMISPHERICLIGHT=u.d.LIGHTTYPEID_HEMISPHERICLIGHT,z.LIGHTTYPEID_RECT_AREALIGHT=u.d.LIGHTTYPEID_RECT_AREALIGHT,(0,d.b)([(0,g.i)()],z.prototype,"diffuse",void 0),(0,d.b)([(0,g.i)()],z.prototype,"specular",void 0),(0,d.b)([(0,g.O)()],z.prototype,"falloffType",void 0),(0,d.b)([(0,g.O)()],z.prototype,"intensity",void 0),(0,d.b)([(0,g.O)()],z.prototype,"range",null),(0,d.b)([(0,g.O)()],z.prototype,"intensityMode",null),(0,d.b)([(0,g.O)()],z.prototype,"radius",null),(0,d.b)([(0,g.O)()],z.prototype,"_renderPriority",void 0),(0,d.b)([(0,g.b)("_reorderLightsInScene")],z.prototype,"renderPriority",void 0),(0,d.b)([(0,g.O)("shadowEnabled")],z.prototype,"_shadowEnabled",void 0),(0,d.b)([(0,g.O)("excludeWithLayerMask")],z.prototype,"_excludeWithLayerMask",void 0),(0,d.b)([(0,g.O)("includeOnlyWithLayerMask")],z.prototype,"_includeOnlyWithLayerMask",void 0),(0,d.b)([(0,g.O)("lightmapMode")],z.prototype,"_lightmapMode",void 0)},11228:(q,f,j)=>{j.d(f,{d:()=>d});class d{static CompareLightsPriority(q,f){return q.shadowEnabled!==f.shadowEnabled?(f.shadowEnabled?1:0)-(q.shadowEnabled?1:0):f.renderPriority-q.renderPriority}}d.FALLOFF_DEFAULT=0,d.FALLOFF_PHYSICAL=1,d.FALLOFF_GLTF=2,d.FALLOFF_STANDARD=3,d.LIGHTMAP_DEFAULT=0,d.LIGHTMAP_SPECULAR=1,d.LIGHTMAP_SHADOWSONLY=2,d.INTENSITYMODE_AUTOMATIC=0,d.INTENSITYMODE_LUMINOUSPOWER=1,d.INTENSITYMODE_LUMINOUSINTENSITY=2,d.INTENSITYMODE_ILLUMINANCE=3,d.INTENSITYMODE_LUMINANCE=4,d.LIGHTTYPEID_POINTLIGHT=0,d.LIGHTTYPEID_DIRECTIONALLIGHT=1,d.LIGHTTYPEID_SPOTLIGHT=2,d.LIGHTTYPEID_HEMISPHERICLIGHT=3,d.LIGHTTYPEID_RECT_AREALIGHT=4},11698:(q,f,j)=>{j.d(f,{b:()=>H});var d=j(11125),g=j(11130),h=j(10941),L=j(11632),Q=j(11276);class H extends L.e{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=h.b.Identity(),this._projectionMatrix=h.b.Identity()}_setPosition(q){this._position=q}get position(){return this._position}set position(q){this._setPosition(q)}_setDirection(q){this._direction=q}get direction(){return this._direction}set direction(q){this._setDirection(q)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(q){this._shadowMinZ=q,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(q){this._shadowMaxZ=q,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=h.j.Zero()),h.j.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=h.j.Zero()),h.j.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(q){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(q){return this.direction=h.j.Normalize(q.ej(this.position)),this.direction}getRotation(){this.direction.normalize();const q=h.j.Cross(this.direction,Q.e.Y),f=h.j.Cross(q,this.direction);return h.j.RotationFromAxis(q,f,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=h.j.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}Nf(q){return!q&&this.isSynchronized()?(this._currentRenderId=this.eq().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.H(this.position),this._worldMatrix||(this._worldMatrix=h.b.Identity()),h.b.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(q){return void 0!==this.shadowMinZ?this.shadowMinZ:(null===q||void 0===q?void 0:q.gd)||0}getDepthMaxZ(q){return void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===q||void 0===q?void 0:q.maxZ)||1e4}setShadowProjectionMatrix(q,f,j){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(f,j,q):this._setDefaultShadowProjectionMatrix(q,f,j),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(q){const f=h.f.kf[0];let j=this.position;this.computeTransformedInformation()&&(j=this.transformedPosition),h.j.NormalizeToRef(this.getShadowDirection(q),f),1===Math.abs(h.j.Dot(f,h.j.Up()))&&(f.z=1e-13);const d=h.f.kf[1];return j.addToRef(f,d),h.b.LookAtLHToRef(j,d,h.j.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(q,f){return this.setShadowProjectionMatrix(this._projectionMatrix,q??this._viewMatrix,f??[]),this._projectionMatrix}}(0,d.b)([(0,g.M)()],H.prototype,"position",null),(0,d.b)([(0,g.M)()],H.prototype,"direction",null),(0,d.b)([(0,g.O)()],H.prototype,"shadowMinZ",null),(0,d.b)([(0,g.O)()],H.prototype,"shadowMaxZ",null)},11310:(q,f,j)=>{j.d(f,{c:()=>d});class d{static get ForceFullSceneLoadingForIncremental(){return d._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(q){d._ForceFullSceneLoadingForIncremental=q}static get ShowLoadingScreen(){return d._ShowLoadingScreen}static set ShowLoadingScreen(q){d._ShowLoadingScreen=q}static get loggingLevel(){return d._LoggingLevel}static set loggingLevel(q){d._LoggingLevel=q}static get CleanBoneMatrixWeights(){return d._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(q){d._CleanBoneMatrixWeights=q}}d._ForceFullSceneLoadingForIncremental=!1,d._ShowLoadingScreen=!0,d._CleanBoneMatrixWeights=!1,d._LoggingLevel=0},11502:(q,f,j)=>{j.d(f,{c:()=>k});var d=j(11125),g=j(11130),h=j(11005),L=j(11298),Q=j(11491),H=j(11506),r=j(10941),u=j(11151),X=j(11549),z=j(11551);class B extends X.b{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1,this.MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,this.LEGACY_SPECULAR_ENERGY_CONSERVATION=!1,this.BASE_DIFFUSE_MODEL=0,this.DIELECTRIC_SPECULAR_MODEL=0,this.CONDUCTOR_SPECULAR_MODEL=0}}class D extends z.e{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(q,"PBRBRDF",90,new B,f),this._useEnergyConservation=D.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=D.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=D.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=D.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=D.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=D.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=D.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=D.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._mixIblRadianceWithIrradiance=D.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this.mixIblRadianceWithIrradiance=D.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this._useLegacySpecularEnergyConservation=D.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this.useLegacySpecularEnergyConservation=D.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this._baseDiffuseModel=D.DEFAULT_DIFFUSE_MODEL,this.baseDiffuseModel=D.DEFAULT_DIFFUSE_MODEL,this._dielectricSpecularModel=D.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this.dielectricSpecularModel=D.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this._conductorSpecularModel=D.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this.conductorSpecularModel=D.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this._internalMarkAllSubMeshesAsMiscDirty=q._dirtyCallbacks[16],this._enable(!0)}prepareDefines(q){q.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,q.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,q.SPHERICAL_HARMONICS=this._useSphericalHarmonics,q.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation,q.MIX_IBL_RADIANCE_WITH_IRRADIANCE=this._mixIblRadianceWithIrradiance,q.LEGACY_SPECULAR_ENERGY_CONSERVATION=this._useLegacySpecularEnergyConservation,q.BASE_DIFFUSE_MODEL=this._baseDiffuseModel,q.DIELECTRIC_SPECULAR_MODEL=this._dielectricSpecularModel,q.CONDUCTOR_SPECULAR_MODEL=this._conductorSpecularModel}getClassName(){return"PBRBRDFConfiguration"}}D.DEFAULT_USE_ENERGY_CONSERVATION=!0,D.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,D.DEFAULT_USE_SPHERICAL_HARMONICS=!0,D.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,D.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,D.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION=!0,D.DEFAULT_DIFFUSE_MODEL=0,D.DEFAULT_DIELECTRIC_SPECULAR_MODEL=0,D.DEFAULT_CONDUCTOR_SPECULAR_MODEL=0,(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsMiscDirty")],D.prototype,"useEnergyConservation",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsMiscDirty")],D.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsMiscDirty")],D.prototype,"useSphericalHarmonics",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsMiscDirty")],D.prototype,"useSpecularGlossinessInputEnergyConservation",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsMiscDirty")],D.prototype,"mixIblRadianceWithIrradiance",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsMiscDirty")],D.prototype,"useLegacySpecularEnergyConservation",void 0),(0,d.b)([(0,g.O)("baseDiffuseModel"),(0,g.b)("_markAllSubMeshesAsMiscDirty")],D.prototype,"baseDiffuseModel",void 0),(0,d.b)([(0,g.O)("dielectricSpecularModel"),(0,g.b)("_markAllSubMeshesAsMiscDirty")],D.prototype,"dielectricSpecularModel",void 0),(0,d.b)([(0,g.O)("conductorSpecularModel"),(0,g.b)("_markAllSubMeshesAsMiscDirty")],D.prototype,"conductorSpecularModel",void 0);var i=j(11559),t=j(11210),O=j(11515),N=j(11118),w=j(11566),E=j(11438),s=j(11574),S=(j(11578),j(11588)),e=j(11219);class Z extends X.b{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class I extends z.e{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(q,"PBRClearCoat",100,new Z,f),this._isEnabled=!1,this.isEnabled=!1,this.Xd=1,this.roughness=0,this._indexOfRefraction=I._DefaultIndexOfRefraction,this.indexOfRefraction=I._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=t.c.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=q._dirtyCallbacks[1]}isReadyForSubMesh(q,f,j){if(!this._isEnabled)return!0;const d=this._material._disableBumpMap;if(q._areTexturesDirty&&f.texturesEnabled){if(this._texture&&s.e.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&s.e.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(j.getCaps().standardDerivatives&&this._bumpTexture&&s.e.ClearCoatBumpTextureEnabled&&!d&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&s.e.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(q,f){this._isEnabled?(q.CLEARCOAT=!0,q.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,q.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,q._areTexturesDirty&&f.texturesEnabled&&(this._texture&&s.e.ClearCoatTextureEnabled?(0,e.P)(this._texture,q,"CLEARCOAT_TEXTURE"):q.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&s.e.ClearCoatTextureEnabled?(0,e.P)(this._textureRoughness,q,"CLEARCOAT_TEXTURE_ROUGHNESS"):q.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&s.e.ClearCoatBumpTextureEnabled?(0,e.P)(this._bumpTexture,q,"CLEARCOAT_BUMP"):q.CLEARCOAT_BUMP=!1,q.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===I._DefaultIndexOfRefraction,this._isTintEnabled?(q.CLEARCOAT_TINT=!0,this._tintTexture&&s.e.ClearCoatTintTextureEnabled?((0,e.P)(this._tintTexture,q,"CLEARCOAT_TINT_TEXTURE"),q.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):q.CLEARCOAT_TINT_TEXTURE=!1):(q.CLEARCOAT_TINT=!1,q.CLEARCOAT_TINT_TEXTURE=!1))):(q.CLEARCOAT=!1,q.CLEARCOAT_TEXTURE=!1,q.CLEARCOAT_TEXTURE_ROUGHNESS=!1,q.CLEARCOAT_BUMP=!1,q.CLEARCOAT_TINT=!1,q.CLEARCOAT_TINT_TEXTURE=!1,q.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,q.CLEARCOAT_DEFAULTIOR=!1,q.CLEARCOAT_TEXTUREDIRECTUV=0,q.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,q.CLEARCOAT_BUMPDIRECTUV=0,q.CLEARCOAT_REMAP_F0=!1,q.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,q.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(q,f,j,d){if(!this._isEnabled)return;const g=d.materialDefines,h=this._material.isFrozen,L=this._material._disableBumpMap,Q=this._material._invertNormalMapX,H=this._material._invertNormalMapY;if(!q.useUbo||!h||!q.isSync){var r,u,X,z;if((this._texture||this._textureRoughness)&&s.e.ClearCoatTextureEnabled)q.updateFloat4("vClearCoatInfos",(null===(r=this._texture)||void 0===r?void 0:r.coordinatesIndex)??0,(null===(u=this._texture)||void 0===u?void 0:u.level)??0,(null===(X=this._textureRoughness)||void 0===X?void 0:X.coordinatesIndex)??0,(null===(z=this._textureRoughness)||void 0===z?void 0:z.level)??0),this._texture&&(0,e.q)(this._texture,q,"clearCoat"),this._textureRoughness&&!g.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,e.q)(this._textureRoughness,q,"clearCoatRoughness");this._bumpTexture&&j.getCaps().standardDerivatives&&s.e.ClearCoatTextureEnabled&&!L&&(q.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,e.q)(this._bumpTexture,q,"clearCoatBump"),f._mirroredCameraPosition?q.updateFloat2("vClearCoatTangentSpaceParams",Q?1:-1,H?1:-1):q.updateFloat2("vClearCoatTangentSpaceParams",Q?-1:1,H?-1:1)),this._tintTexture&&s.e.ClearCoatTintTextureEnabled&&(q.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,e.q)(this._tintTexture,q,"clearCoatTint")),q.updateFloat2("vClearCoatParams",this.Xd,this.roughness);const d=1-this._indexOfRefraction,h=1+this._indexOfRefraction,B=Math.pow(-d/h,2),D=1/this._indexOfRefraction;q.updateFloat4("vClearCoatRefractionParams",B,D,d,h),this._isTintEnabled&&(q.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),q.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}f.texturesEnabled&&(this._texture&&s.e.ClearCoatTextureEnabled&&q.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!g.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&s.e.ClearCoatTextureEnabled&&q.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&j.getCaps().standardDerivatives&&s.e.ClearCoatBumpTextureEnabled&&!L&&q.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&s.e.ClearCoatTintTextureEnabled&&q.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(q){return this._texture===q||(this._textureRoughness===q||(this._bumpTexture===q||this._tintTexture===q))}getActiveTextures(q){this._texture&&q.push(this._texture),this._textureRoughness&&q.push(this._textureRoughness),this._bumpTexture&&q.push(this._bumpTexture),this._tintTexture&&q.push(this._tintTexture)}getAnimatables(q){this._texture&&this._texture.animations&&this._texture.animations.length>0&&q.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&q.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&q.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&q.push(this._tintTexture)}dispose(q){var f,j,d,g;q&&(null===(f=this._texture)||void 0===f||f.dispose(),null===(j=this._textureRoughness)||void 0===j||j.dispose(),null===(d=this._bumpTexture)||void 0===d||d.dispose(),null===(g=this._tintTexture)||void 0===g||g.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(q,f,j){return q.CLEARCOAT_BUMP&&f.addFallback(j++,"CLEARCOAT_BUMP"),q.CLEARCOAT_TINT&&f.addFallback(j++,"CLEARCOAT_TINT"),q.CLEARCOAT&&f.addFallback(j++,"CLEARCOAT"),j}getSamplers(q){q.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}I._DefaultIndexOfRefraction=1.5,(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"isEnabled",void 0),(0,d.b)([(0,g.O)()],I.prototype,"intensity",void 0),(0,d.b)([(0,g.O)()],I.prototype,"roughness",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"indexOfRefraction",void 0),(0,d.b)([(0,g.F)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"texture",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useRoughnessFromMainTexture",void 0),(0,d.b)([(0,g.F)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"textureRoughness",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"remapF0OnInterfaceChange",void 0),(0,d.b)([(0,g.F)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"bumpTexture",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"isTintEnabled",void 0),(0,d.b)([(0,g.i)()],I.prototype,"tintColor",void 0),(0,d.b)([(0,g.O)()],I.prototype,"tintColorAtDistance",void 0),(0,d.b)([(0,g.O)()],I.prototype,"tintThickness",void 0),(0,d.b)([(0,g.F)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"tintTexture",void 0);class T extends X.b{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class W extends z.e{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(q,"PBRIridescence",110,new T,f),this._isEnabled=!1,this.isEnabled=!1,this.Xd=1,this.minimumThickness=W._DefaultMinimumThickness,this.maximumThickness=W._DefaultMaximumThickness,this.indexOfRefraction=W._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=q._dirtyCallbacks[1]}isReadyForSubMesh(q,f){if(!this._isEnabled)return!0;if(q._areTexturesDirty&&f.texturesEnabled){if(this._texture&&s.e.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&s.e.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(q,f){this._isEnabled?(q.IRIDESCENCE=!0,q._areTexturesDirty&&f.texturesEnabled&&(this._texture&&s.e.IridescenceTextureEnabled?(0,e.P)(this._texture,q,"IRIDESCENCE_TEXTURE"):q.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&s.e.IridescenceTextureEnabled?(0,e.P)(this._thicknessTexture,q,"IRIDESCENCE_THICKNESS_TEXTURE"):q.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(q.IRIDESCENCE=!1,q.IRIDESCENCE_TEXTURE=!1,q.IRIDESCENCE_THICKNESS_TEXTURE=!1,q.IRIDESCENCE_TEXTUREDIRECTUV=0,q.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(q,f){if(!this._isEnabled)return;const j=this._material.isFrozen;if(!q.useUbo||!j||!q.isSync){var d,g,h,L;if((this._texture||this._thicknessTexture)&&s.e.IridescenceTextureEnabled)q.updateFloat4("vIridescenceInfos",(null===(d=this._texture)||void 0===d?void 0:d.coordinatesIndex)??0,(null===(g=this._texture)||void 0===g?void 0:g.level)??0,(null===(h=this._thicknessTexture)||void 0===h?void 0:h.coordinatesIndex)??0,(null===(L=this._thicknessTexture)||void 0===L?void 0:L.level)??0),this._texture&&(0,e.q)(this._texture,q,"iridescence"),this._thicknessTexture&&(0,e.q)(this._thicknessTexture,q,"iridescenceThickness");q.updateFloat4("vIridescenceParams",this.Xd,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}f.texturesEnabled&&(this._texture&&s.e.IridescenceTextureEnabled&&q.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&s.e.IridescenceTextureEnabled&&q.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(q){return this._texture===q||this._thicknessTexture===q}getActiveTextures(q){this._texture&&q.push(this._texture),this._thicknessTexture&&q.push(this._thicknessTexture)}getAnimatables(q){this._texture&&this._texture.animations&&this._texture.animations.length>0&&q.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&q.push(this._thicknessTexture)}dispose(q){var f,j;q&&(null===(f=this._texture)||void 0===f||f.dispose(),null===(j=this._thicknessTexture)||void 0===j||j.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(q,f,j){return q.IRIDESCENCE&&f.addFallback(j++,"IRIDESCENCE"),j}getSamplers(q){q.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}W._DefaultMinimumThickness=100,W._DefaultMaximumThickness=400,W._DefaultIndexOfRefraction=1.3,(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"isEnabled",void 0),(0,d.b)([(0,g.O)()],W.prototype,"intensity",void 0),(0,d.b)([(0,g.O)()],W.prototype,"minimumThickness",void 0),(0,d.b)([(0,g.O)()],W.prototype,"maximumThickness",void 0),(0,d.b)([(0,g.O)()],W.prototype,"indexOfRefraction",void 0),(0,d.b)([(0,g.F)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"texture",void 0),(0,d.b)([(0,g.F)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"thicknessTexture",void 0);class n extends X.b{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class U extends z.e{set angle(q){this.direction.x=Math.cos(q),this.direction.y=Math.sin(q)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(q,"PBRAnisotropic",110,new n,f),this._isEnabled=!1,this.isEnabled=!1,this.Xd=1,this.direction=new r.i(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=q._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=q._dirtyCallbacks[16]}isReadyForSubMesh(q,f){return!this._isEnabled||!(q._areTexturesDirty&&f.texturesEnabled&&this._texture&&s.e.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(q,f,j){this._isEnabled?(q.ANISOTROPIC=this._isEnabled,this._isEnabled&&!j.isVerticesDataPresent(u.i.TangentKind)&&(q._needUVs=!0,q.MAINUV1=!0),q._areTexturesDirty&&f.texturesEnabled&&(this._texture&&s.e.AnisotropicTextureEnabled?(0,e.P)(this._texture,q,"ANISOTROPIC_TEXTURE"):q.ANISOTROPIC_TEXTURE=!1),q._areMiscDirty&&(q.ANISOTROPIC_LEGACY=this._legacy)):(q.ANISOTROPIC=!1,q.ANISOTROPIC_TEXTURE=!1,q.ANISOTROPIC_TEXTUREDIRECTUV=0,q.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(q,f){if(!this._isEnabled)return;const j=this._material.isFrozen;q.useUbo&&j&&q.isSync||(this._texture&&s.e.AnisotropicTextureEnabled&&(q.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,e.q)(this._texture,q,"anisotropy")),q.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.Xd)),f.texturesEnabled&&this._texture&&s.e.AnisotropicTextureEnabled&&q.setTexture("anisotropySampler",this._texture)}hasTexture(q){return this._texture===q}getActiveTextures(q){this._texture&&q.push(this._texture)}getAnimatables(q){this._texture&&this._texture.animations&&this._texture.animations.length>0&&q.push(this._texture)}dispose(q){q&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(q,f,j){return q.ANISOTROPIC&&f.addFallback(j++,"ANISOTROPIC"),j}getSamplers(q){q.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(q,f,j){super.parse(q,f,j),void 0===q.legacy&&(this.legacy=!0)}}(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"isEnabled",void 0),(0,d.b)([(0,g.O)()],U.prototype,"intensity",void 0),(0,d.b)([(0,g.I)()],U.prototype,"direction",void 0),(0,d.b)([(0,g.F)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"texture",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsMiscDirty")],U.prototype,"legacy",void 0);class Y extends X.b{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class v extends z.e{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(q,"Sheen",120,new Y,f),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.Xd=1,this.color=t.c.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=q._dirtyCallbacks[1]}isReadyForSubMesh(q,f){if(!this._isEnabled)return!0;if(q._areTexturesDirty&&f.texturesEnabled){if(this._texture&&s.e.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&s.e.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(q,f){this._isEnabled?(q.SHEEN=!0,q.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,q.SHEEN_ROUGHNESS=null!==this._roughness,q.SHEEN_ALBEDOSCALING=this._albedoScaling,q.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,q._areTexturesDirty&&f.texturesEnabled&&(this._texture&&s.e.SheenTextureEnabled?((0,e.P)(this._texture,q,"SHEEN_TEXTURE"),q.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):q.SHEEN_TEXTURE=!1,this._textureRoughness&&s.e.SheenTextureEnabled?(0,e.P)(this._textureRoughness,q,"SHEEN_TEXTURE_ROUGHNESS"):q.SHEEN_TEXTURE_ROUGHNESS=!1)):(q.SHEEN=!1,q.SHEEN_TEXTURE=!1,q.SHEEN_TEXTURE_ROUGHNESS=!1,q.SHEEN_LINKWITHALBEDO=!1,q.SHEEN_ROUGHNESS=!1,q.SHEEN_ALBEDOSCALING=!1,q.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,q.SHEEN_GAMMATEXTURE=!1,q.SHEEN_TEXTUREDIRECTUV=0,q.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(q,f,j,d){if(!this._isEnabled)return;const g=d.materialDefines,h=this._material.isFrozen;if(!q.useUbo||!h||!q.isSync){var L,Q,H,r;if((this._texture||this._textureRoughness)&&s.e.SheenTextureEnabled)q.updateFloat4("vSheenInfos",(null===(L=this._texture)||void 0===L?void 0:L.coordinatesIndex)??0,(null===(Q=this._texture)||void 0===Q?void 0:Q.level)??0,(null===(H=this._textureRoughness)||void 0===H?void 0:H.coordinatesIndex)??0,(null===(r=this._textureRoughness)||void 0===r?void 0:r.level)??0),this._texture&&(0,e.q)(this._texture,q,"sheen"),this._textureRoughness&&!g.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,e.q)(this._textureRoughness,q,"sheenRoughness");q.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.Xd),null!==this._roughness&&q.updateFloat("vSheenRoughness",this._roughness)}f.texturesEnabled&&(this._texture&&s.e.SheenTextureEnabled&&q.setTexture("sheenSampler",this._texture),this._textureRoughness&&!g.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&s.e.SheenTextureEnabled&&q.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(q){return this._texture===q||this._textureRoughness===q}getActiveTextures(q){this._texture&&q.push(this._texture),this._textureRoughness&&q.push(this._textureRoughness)}getAnimatables(q){this._texture&&this._texture.animations&&this._texture.animations.length>0&&q.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&q.push(this._textureRoughness)}dispose(q){var f,j;q&&(null===(f=this._texture)||void 0===f||f.dispose(),null===(j=this._textureRoughness)||void 0===j||j.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(q,f,j){return q.SHEEN&&f.addFallback(j++,"SHEEN"),j}getSamplers(q){q.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"isEnabled",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"linkSheenWithAlbedo",void 0),(0,d.b)([(0,g.O)()],v.prototype,"intensity",void 0),(0,d.b)([(0,g.i)()],v.prototype,"color",void 0),(0,d.b)([(0,g.F)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"texture",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useRoughnessFromMainTexture",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"roughness",void 0),(0,d.b)([(0,g.F)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"textureRoughness",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"albedoScaling",void 0);class F extends X.b{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1,this.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1,this.SS_TRANSLUCENCY_LEGACY=!1}}class M extends z.e{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(q){this._scene.enableSubSurfaceForPrePass()&&q&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(q))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(q){this._volumeIndexOfRefraction=q>=1?q:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(q,"PBRSubSurface",130,new F,f),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=t.c.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=t.c.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this.applyAlbedoAfterSubSurface=M.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE,this.legacyTransluceny=M.DEFAULT_LEGACY_TRANSLUCENCY,this._scene=q.eq(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=q._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=q._dirtyCallbacks[32]}isReadyForSubMesh(q,f){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(q._areTexturesDirty&&f.texturesEnabled){if(this._thicknessTexture&&s.e.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&s.e.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&s.e.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const q=this._getRefractionTexture(f);if(q&&s.e.RefractionTextureEnabled&&!q.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(q,f){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return q.SUBSURFACE=!1,q.SS_DISPERSION=!1,q.SS_TRANSLUCENCY=!1,q.SS_SCATTERING=!1,q.SS_REFRACTION=!1,q.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,q.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,q.SS_THICKNESSANDMASK_TEXTURE=!1,q.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,q.SS_HAS_THICKNESS=!1,q.SS_REFRACTIONINTENSITY_TEXTURE=!1,q.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,q.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,q.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,q.SS_REFRACTIONMAP_3D=!1,q.SS_REFRACTIONMAP_OPPOSITEZ=!1,q.SS_LODINREFRACTIONALPHA=!1,q.SS_GAMMAREFRACTION=!1,q.SS_RGBDREFRACTION=!1,q.SS_LINEARSPECULARREFRACTION=!1,q.SS_LINKREFRACTIONTOTRANSPARENCY=!1,q.SS_ALBEDOFORREFRACTIONTINT=!1,q.SS_ALBEDOFORTRANSLUCENCYTINT=!1,q.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,q.SS_USE_THICKNESS_AS_DEPTH=!1,q.SS_USE_GLTF_TEXTURES=!1,q.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,q.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,q.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,void(q.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1);if(q._areTexturesDirty){if(q.SUBSURFACE=!0,q.SS_DISPERSION=this._isDispersionEnabled,q.SS_TRANSLUCENCY=this._isTranslucencyEnabled,q.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,q.SS_TRANSLUCENCY_LEGACY=this.legacyTransluceny,q.SS_SCATTERING=this._isScatteringEnabled,q.SS_THICKNESSANDMASK_TEXTURE=!1,q.SS_REFRACTIONINTENSITY_TEXTURE=!1,q.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,q.SS_HAS_THICKNESS=!1,q.SS_USE_GLTF_TEXTURES=!1,q.SS_REFRACTION=!1,q.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,q.SS_REFRACTIONMAP_3D=!1,q.SS_GAMMAREFRACTION=!1,q.SS_RGBDREFRACTION=!1,q.SS_LINEARSPECULARREFRACTION=!1,q.SS_REFRACTIONMAP_OPPOSITEZ=!1,q.SS_LODINREFRACTIONALPHA=!1,q.SS_LINKREFRACTIONTOTRANSPARENCY=!1,q.SS_ALBEDOFORREFRACTIONTINT=!1,q.SS_ALBEDOFORTRANSLUCENCYTINT=!1,q.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,q.SS_USE_THICKNESS_AS_DEPTH=!1,q.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,q.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=this.applyAlbedoAfterSubSurface,q._areTexturesDirty&&f.texturesEnabled&&(this._thicknessTexture&&s.e.ThicknessTextureEnabled&&(0,e.P)(this._thicknessTexture,q,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&s.e.RefractionIntensityTextureEnabled&&(0,e.P)(this._refractionIntensityTexture,q,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&s.e.TranslucencyIntensityTextureEnabled&&(0,e.P)(this._translucencyIntensityTexture,q,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&s.e.TranslucencyColorTextureEnabled&&((0,e.P)(this._translucencyColorTexture,q,"SS_TRANSLUCENCYCOLOR_TEXTURE"),q.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=this._translucencyColorTexture.gammaSpace)),q.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,q.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,q.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,q.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&f.texturesEnabled){const j=this._getRefractionTexture(f);j&&s.e.RefractionTextureEnabled&&(q.SS_REFRACTION=!0,q.SS_REFRACTIONMAP_3D=j.isCube,q.SS_GAMMAREFRACTION=j.gammaSpace,q.SS_RGBDREFRACTION=j.isRGBD,q.SS_LINEARSPECULARREFRACTION=j.linearSpecularLOD,q.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&j.isCube?!j.invertZ:j.invertZ,q.SS_LODINREFRACTIONALPHA=j.lodLevelInAlpha,q.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,q.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,q.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=j.isCube&&j.boundingBoxSize,q.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(q.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(q,f,j,d){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)q.updateFloat2("vThicknessParam",0,0);else{d.getRenderingMesh().getWorldMatrix().decompose(r.f.kf[0]);const f=Math.max(Math.abs(r.f.kf[0].x),Math.abs(r.f.kf[0].y),Math.abs(r.f.kf[0].z));q.updateFloat2("vThicknessParam",this.minimumThickness*f,(this.maximumThickness-this.minimumThickness)*f)}}bindForSubMesh(q,f,j,d){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const g=d.materialDefines,h=this._material.isFrozen,L=this._material.realTimeFiltering,Q=g.LODBASEDMICROSFURACE,H=this._getRefractionTexture(f);if(!q.useUbo||!h||!q.isSync){if(this._thicknessTexture&&s.e.ThicknessTextureEnabled&&(q.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,e.q)(this._thicknessTexture,q,"thickness")),this._refractionIntensityTexture&&s.e.RefractionIntensityTextureEnabled&&g.SS_REFRACTIONINTENSITY_TEXTURE&&(q.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,e.q)(this._refractionIntensityTexture,q,"refractionIntensity")),this._translucencyColorTexture&&s.e.TranslucencyColorTextureEnabled&&g.SS_TRANSLUCENCYCOLOR_TEXTURE&&(q.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,e.q)(this._translucencyColorTexture,q,"translucencyColor")),this._translucencyIntensityTexture&&s.e.TranslucencyIntensityTextureEnabled&&g.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(q.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,e.q)(this._translucencyIntensityTexture,q,"translucencyIntensity")),H&&s.e.RefractionTextureEnabled){q.jd("refractionMatrix",H.getRefractionTextureMatrix());let f=1;H.isCube||H.depth&&(f=H.depth);const j=H.getSize().width,d=this.volumeIndexOfRefraction;if(q.updateFloat4("vRefractionInfos",H.level,1/d,f,this._invertRefractionY?-1:1),q.updateFloat4("vRefractionMicrosurfaceInfos",j,H.lodGenerationScale,H.lodGenerationOffset,1/this.indexOfRefraction),L&&q.updateFloat2("vRefractionFilteringInfo",j,Math.log2(j)),H.boundingBoxSize){const f=H;q.updateVector3("vRefractionPosition",f.boundingBoxPosition),q.updateVector3("vRefractionSize",f.boundingBoxSize)}}this._isScatteringEnabled&&q.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),q.updateColor3("vDiffusionDistance",this.diffusionDistance),q.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),q.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),q.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),q.updateFloat("dispersion",this.dispersion)}f.texturesEnabled&&(this._thicknessTexture&&s.e.ThicknessTextureEnabled&&q.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&s.e.RefractionIntensityTextureEnabled&&g.SS_REFRACTIONINTENSITY_TEXTURE&&q.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&s.e.TranslucencyIntensityTextureEnabled&&g.SS_TRANSLUCENCYINTENSITY_TEXTURE&&q.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&s.e.TranslucencyColorTextureEnabled&&g.SS_TRANSLUCENCYCOLOR_TEXTURE&&q.setTexture("translucencyColorSampler",this._translucencyColorTexture),H&&s.e.RefractionTextureEnabled&&(Q?q.setTexture("refractionSampler",H):(q.setTexture("refractionSampler",H._lodTextureMid||H),q.setTexture("refractionSamplerLow",H._lodTextureLow||H),q.setTexture("refractionSamplerHigh",H._lodTextureHigh||H))))}_getRefractionTexture(q){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?q.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(q){s.e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&q.push(this._refractionTexture)}hasTexture(q){return this._thicknessTexture===q||(this._refractionTexture===q||(this._refractionIntensityTexture===q||(this._translucencyIntensityTexture===q||this._translucencyColorTexture===q)))}hasRenderTargetTextures(){return!!(s.e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(q){this._thicknessTexture&&q.push(this._thicknessTexture),this._refractionTexture&&q.push(this._refractionTexture),this._translucencyColorTexture&&q.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&q.push(this._translucencyIntensityTexture)}getAnimatables(q){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&q.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&q.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&q.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&q.push(this._translucencyIntensityTexture)}dispose(q){q&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(q,f,j){return q.SS_SCATTERING&&f.addFallback(j++,"SS_SCATTERING"),q.SS_TRANSLUCENCY&&f.addFallback(j++,"SS_TRANSLUCENCY"),j}getSamplers(q){q.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}M.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE=!1,M.DEFAULT_LEGACY_TRANSLUCENCY=!1,(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"isRefractionEnabled",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"isTranslucencyEnabled",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"isDispersionEnabled",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markScenePrePassDirty")],M.prototype,"isScatteringEnabled",void 0),(0,d.b)([(0,g.O)()],M.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,d.b)([(0,g.O)()],M.prototype,"refractionIntensity",void 0),(0,d.b)([(0,g.O)()],M.prototype,"translucencyIntensity",void 0),(0,d.b)([(0,g.O)()],M.prototype,"useAlbedoToTintRefraction",void 0),(0,d.b)([(0,g.O)()],M.prototype,"useAlbedoToTintTranslucency",void 0),(0,d.b)([(0,g.F)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"thicknessTexture",void 0),(0,d.b)([(0,g.F)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"refractionTexture",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"indexOfRefraction",void 0),(0,d.b)([(0,g.O)()],M.prototype,"_volumeIndexOfRefraction",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"volumeIndexOfRefraction",null),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"invertRefractionY",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"linkRefractionWithTransparency",void 0),(0,d.b)([(0,g.O)()],M.prototype,"minimumThickness",void 0),(0,d.b)([(0,g.O)()],M.prototype,"maximumThickness",void 0),(0,d.b)([(0,g.O)()],M.prototype,"useThicknessAsDepth",void 0),(0,d.b)([(0,g.i)()],M.prototype,"tintColor",void 0),(0,d.b)([(0,g.O)()],M.prototype,"tintColorAtDistance",void 0),(0,d.b)([(0,g.O)()],M.prototype,"dispersion",void 0),(0,d.b)([(0,g.i)()],M.prototype,"diffusionDistance",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useMaskFromThicknessTexture",void 0),(0,d.b)([(0,g.F)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"refractionIntensityTexture",void 0),(0,d.b)([(0,g.F)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"translucencyIntensityTexture",void 0),(0,d.b)([(0,g.i)()],M.prototype,"translucencyColor",void 0),(0,d.b)([(0,g.F)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"translucencyColorTexture",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useGltfStyleTextures",void 0),(0,d.b)([(0,g.O)()],M.prototype,"applyAlbedoAfterSubSurface",void 0),(0,d.b)([(0,g.O)()],M.prototype,"legacyTransluceny",void 0);var o=j(11590),b=j(11236),x=j(11599);const R={effect:null,subMesh:null};class A extends X.b{constructor(q){super(q),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.IBL_CDF_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BASE_WEIGHT=!1,this.BASE_WEIGHTDIRECTUV=0,this.BASE_DIFFUSE_ROUGHNESS=!1,this.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.MIRRORED=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class k extends w.b{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(q){this._realTimeFiltering=q,this.zu(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(q){this._realTimeFilteringQuality=q,this.zu(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(q){q!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=q||this.eq().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(q,f){super(q,f,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||k.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new r.m(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._baseWeightTexture=null,this._baseDiffuseRoughnessTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=k.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=t.c.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new t.c(0,0,0),this._albedoColor=new t.c(1,1,1),this._baseWeight=1,this._baseDiffuseRoughness=null,this._reflectivityColor=new t.c(1,1,1),this._reflectionColor=new t.c(1,1,1),this._emissiveColor=new t.c(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=k.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new L.g(16),this._globalAmbientColor=new t.c(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new D(this),this.clearCoat=new I(this),this.iridescence=new W(this),this.anisotropy=new U(this),this.sheen=new v(this),this.subSurface=new M(this),this.detailMap=new o.d(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),s.e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,Q.d)(this.eq()),this.prePassConfiguration=new i.e}get hasRenderTargetTextures(){return!!(s.e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var q;return this._transparencyMode===k.PBRMATERIAL_OPAQUE||this._transparencyMode===k.PBRMATERIAL_ALPHATEST||(null===(q=this.subSurface)||void 0===q?void 0:q.disableAlphaBlending)}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var q;return this._hasTransparencyMode?this._transparencyModeIsTest:(null===(q=this.subSurface)||void 0===q||!q.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===k.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.Rf&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==k.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.Rf||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(q,f,j){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const d=f._drawWrapper;if(d.effect&&this.isFrozen&&d._wasPreviouslyReady&&d._wasPreviouslyUsingInstances===j)return!0;f.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),f.materialDefines=new A(this._eventInfo.defineNames));const g=f.materialDefines;if(this._isReadyForSubMesh(f))return!0;const L=this.eq(),Q=L.getEngine();if(g._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,L.texturesEnabled)){if(this._albedoTexture&&s.e.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._baseWeightTexture&&s.e.BaseWeightTextureEnabled&&!this._baseWeightTexture.isReadyOrNotBlocking())return!1;if(this._baseDiffuseRoughnessTexture&&s.e.BaseDiffuseRoughnessTextureEnabled&&!this._baseDiffuseRoughnessTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&s.e.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&s.e.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const q=this._getReflectionTexture();if(q&&s.e.ReflectionTextureEnabled){if(!q.isReadyOrNotBlocking())return!1;var H;if(q.irradianceTexture){if(!q.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!q.sphericalPolynomial&&null!==(H=q.getInternalTexture())&&void 0!==H&&H._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&s.e.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&s.e.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(s.e.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(Q.getCaps().standardDerivatives&&this._bumpTexture&&s.e.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&s.e.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=g,this._eventInfo.subMesh=f,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(g._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;if(g.AREALIGHTUSED)for(let h=0;h<q.lightSources.length;h++)if(!q.lightSources[h]._isReady())return!1;Q.getCaps().standardDerivatives||q.isVerticesDataPresent(u.i.NormalKind)||(q.createNormals(!0),h.e.Warn("PBRMaterial: Normals have been created for the mesh: "+q.name));const r=f.effect,X=g._areLightsDisposed;let z=this._prepareEffect(q,g,this.onCompiled,this.onError,j,null,f.getRenderingMesh().hasThinInstances),B=!1;if(z)if(this._onEffectCreatedObservable&&(R.effect=z,R.subMesh=f,this._onEffectCreatedObservable.notifyObservers(R)),this.allowShaderHotSwapping&&r&&!z.isReady()){if(z=r,g.markAsUnprocessed(),B=this.isFrozen,X)return g._areLightsDisposed=!0,!1}else L.resetCachedMaterial(),f.setEffect(z,g,this._materialContext);return!(!f.effect||!f.effect.isReady())&&(g._renderId=L.getRenderId(),d._wasPreviouslyReady=!B,d._wasPreviouslyUsingInstances=!!j,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(q,f){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(q,f,h,L,Q),!f.isDirty)return null;f.markAsProcessed();const H=this.eq().getEngine(),r=new S.d;let X=0;f.USESPHERICALINVERTEX&&r.addFallback(X++,"USESPHERICALINVERTEX"),f.FOG&&r.addFallback(X,"FOG"),f.SPECULARAA&&r.addFallback(X,"SPECULARAA"),f.POINTSIZE&&r.addFallback(X,"POINTSIZE"),f.LOGARITHMICDEPTH&&r.addFallback(X,"LOGARITHMICDEPTH"),f.PARALLAX&&r.addFallback(X,"PARALLAX"),f.PARALLAX_RHS&&r.addFallback(X,"PARALLAX_RHS"),f.PARALLAXOCCLUSION&&r.addFallback(X++,"PARALLAXOCCLUSION"),f.ENVIRONMENTBRDF&&r.addFallback(X++,"ENVIRONMENTBRDF"),f.TANGENT&&r.addFallback(X++,"TANGENT"),f.BUMP&&r.addFallback(X++,"BUMP"),X=(0,e.s)(f,r,this._maxSimultaneousLights,X++),f.SPECULARTERM&&r.addFallback(X++,"SPECULARTERM"),f.USESPHERICALFROMREFLECTIONMAP&&r.addFallback(X++,"USESPHERICALFROMREFLECTIONMAP"),f.USEIRRADIANCEMAP&&r.addFallback(X++,"USEIRRADIANCEMAP"),f.LIGHTMAP&&r.addFallback(X++,"LIGHTMAP"),f.NORMAL&&r.addFallback(X++,"NORMAL"),f.AMBIENT&&r.addFallback(X++,"AMBIENT"),f.EMISSIVE&&r.addFallback(X++,"EMISSIVE"),f.VERTEXCOLOR&&r.addFallback(X++,"VERTEXCOLOR"),f.MORPHTARGETS&&r.addFallback(X++,"MORPHTARGETS"),f.MULTIVIEW&&r.addFallback(0,"MULTIVIEW");const z=[u.i.PositionKind];f.NORMAL&&z.push(u.i.NormalKind),f.TANGENT&&z.push(u.i.TangentKind);for(let j=1;j<=6;++j)f["UV"+j]&&z.push(`uv${1===j?"":j}`);f.VERTEXCOLOR&&z.push(u.i.ColorKind),(0,e.y)(z,q,f,r),(0,e.C)(z,f),(0,e.D)(z,q,f),(0,e.w)(z,q,f);let B="pbr";const D=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","baseWeight","baseDiffuseRoughness","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vBaseWeightInfos","vBaseDiffuseRoughnessInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","baseWeightMatrix","baseDiffuseRoughnessMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vReflectionDominantDirection","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],t=["albedoSampler","baseWeightSampler","baseDiffuseRoughnessSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","icdfSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],N=["Material","Scene","Mesh"],w={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:f.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=r,this._eventInfo.fallbackRank=X,this._eventInfo.defines=f,this._eventInfo.uniforms=D,this._eventInfo.attributes=z,this._eventInfo.samplers=t,this._eventInfo.uniformBuffersNames=N,this._eventInfo.customCode=void 0,this._eventInfo.mesh=q,this._eventInfo.indexParameters=w,this._callbackPluginEventGeneric(128,this._eventInfo),x.d.AddUniformsAndSamplers(D,t),i.e.AddUniforms(D),i.e.AddSamplers(t),(0,b.c)(D),O.c&&(O.c.PrepareUniforms(D,f),O.c.PrepareSamplers(t,f)),(0,e.ab)({uniformsNames:D,uniformBuffersNames:N,samplers:t,defines:f,maxSimultaneousLights:this._maxSimultaneousLights});const E={};this.customShaderNameResolve&&(B=this.customShaderNameResolve(B,D,N,t,f,z,E));const s=f.toString(),Z=H.createEffect(B,{attributes:z,uniformsNames:D,uniformBuffersNames:N,samplers:t,defines:s,fallbacks:r,onCompiled:d,onError:g,indexParameters:w,processFinalCode:E.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:f.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([j.e(20),j.e(45)]).then(j.bind(j,13531)),Promise.all([j.e(18),j.e(46)]).then(j.bind(j,13699))]):await Promise.all([Promise.all([j.e(13),j.e(48)]).then(j.bind(j,13792)),Promise.all([j.e(12),j.e(49)]).then(j.bind(j,13939))]),this._shadersLoaded=!0}},H);return this._eventInfo.customCode=void 0,Z}_prepareDefines(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,g=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const h=this.eq(),L=h.getEngine();(0,e.M)(h,q,f,!0,this._maxSimultaneousLights,this._disableLighting),f._needNormals=!0,(0,e.V)(h,f);const Q=this.needAlphaBlendingForMesh(q)&&this.eq().useOrderIndependentTransparency;if((0,e._)(h,f,this.canRenderToMRT&&!Q),(0,e.X)(h,f,Q),x.d.PrepareDefines(L.currentRenderPassId,q,f),f.METALLICWORKFLOW=this.isMetallicWorkflow(),f._areTexturesDirty){f._needUVs=!1;for(let q=1;q<=6;++q)f["MAINUV"+q]=!1;if(h.texturesEnabled){f.ALBEDODIRECTUV=0,f.BASE_WEIGHTDIRECTUV=0,f.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,f.AMBIENTDIRECTUV=0,f.OPACITYDIRECTUV=0,f.EMISSIVEDIRECTUV=0,f.REFLECTIVITYDIRECTUV=0,f.MICROSURFACEMAPDIRECTUV=0,f.METALLIC_REFLECTANCEDIRECTUV=0,f.REFLECTANCEDIRECTUV=0,f.BUMPDIRECTUV=0,f.LIGHTMAPDIRECTUV=0,L.getCaps().textureLOD&&(f.LODBASEDMICROSFURACE=!0),this._albedoTexture&&s.e.DiffuseTextureEnabled?((0,e.P)(this._albedoTexture,f,"ALBEDO"),f.GAMMAALBEDO=this._albedoTexture.gammaSpace):f.ALBEDO=!1,this._baseWeightTexture&&s.e.BaseWeightTextureEnabled?(0,e.P)(this._baseWeightTexture,f,"BASE_WEIGHT"):f.BASE_WEIGHT=!1,this._baseDiffuseRoughnessTexture&&s.e.BaseDiffuseRoughnessTextureEnabled?(0,e.P)(this._baseDiffuseRoughnessTexture,f,"BASE_DIFFUSE_ROUGHNESS"):f.BASE_DIFFUSE_ROUGHNESS=!1,this._ambientTexture&&s.e.AmbientTextureEnabled?((0,e.P)(this._ambientTexture,f,"AMBIENT"),f.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):f.AMBIENT=!1,this._opacityTexture&&s.e.OpacityTextureEnabled?((0,e.P)(this._opacityTexture,f,"OPACITY"),f.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):f.OPACITY=!1;const q=this._getReflectionTexture();if(q&&s.e.ReflectionTextureEnabled){switch(f.REFLECTION=!0,f.GAMMAREFLECTION=q.gammaSpace,f.RGBDREFLECTION=q.isRGBD,f.LODINREFLECTIONALPHA=q.lodLevelInAlpha,f.LINEARSPECULARREFLECTION=q.linearSpecularLOD,f.USEIRRADIANCEMAP=!1,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(f.NUM_SAMPLES=""+this.realTimeFilteringQuality,L._features.needTypeSuffixInShaderConstants&&(f.NUM_SAMPLES=f.NUM_SAMPLES+"u"),f.REALTIME_FILTERING=!0,this.eq().iblCdfGenerator&&(f.IBL_CDF_FILTERING=!0)):f.REALTIME_FILTERING=!1,f.INVERTCUBICMAP=q.coordinatesMode===E.e.INVCUBIC_MODE,f.REFLECTIONMAP_3D=q.isCube,f.REFLECTIONMAP_OPPOSITEZ=f.REFLECTIONMAP_3D&&this.eq().useRightHandedSystem?!q.invertZ:q.invertZ,f.REFLECTIONMAP_CUBIC=!1,f.REFLECTIONMAP_EXPLICIT=!1,f.REFLECTIONMAP_PLANAR=!1,f.REFLECTIONMAP_PROJECTION=!1,f.REFLECTIONMAP_SKYBOX=!1,f.REFLECTIONMAP_SPHERICAL=!1,f.REFLECTIONMAP_EQUIRECTANGULAR=!1,f.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,f.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,q.coordinatesMode){case E.e.EXPLICIT_MODE:f.REFLECTIONMAP_EXPLICIT=!0;break;case E.e.PLANAR_MODE:f.REFLECTIONMAP_PLANAR=!0;break;case E.e.PROJECTION_MODE:f.REFLECTIONMAP_PROJECTION=!0;break;case E.e.SKYBOX_MODE:f.REFLECTIONMAP_SKYBOX=!0;break;case E.e.SPHERICAL_MODE:f.REFLECTIONMAP_SPHERICAL=!0;break;case E.e.EQUIRECTANGULAR_MODE:f.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case E.e.FIXED_EQUIRECTANGULAR_MODE:f.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case E.e.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:f.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case E.e.CUBIC_MODE:case E.e.INVCUBIC_MODE:default:f.REFLECTIONMAP_CUBIC=!0,f.USE_LOCAL_REFLECTIONMAP_CUBIC=!!q.boundingBoxSize}q.coordinatesMode!==E.e.SKYBOX_MODE&&(q.irradianceTexture?(f.USEIRRADIANCEMAP=!0,f.USESPHERICALFROMREFLECTIONMAP=!1,f.USESPHERICALINVERTEX=!1,q.irradianceTexture._dominantDirection&&(f.USE_IRRADIANCE_DOMINANT_DIRECTION=!0)):q.isCube&&(f.USESPHERICALFROMREFLECTIONMAP=!0,f.USEIRRADIANCEMAP=!1,f.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||L.getCaps().maxVaryingVectors<=8||this._baseDiffuseRoughnessTexture?f.USESPHERICALINVERTEX=!1:f.USESPHERICALINVERTEX=!0))}else f.REFLECTION=!1,f.REFLECTIONMAP_3D=!1,f.REFLECTIONMAP_SPHERICAL=!1,f.REFLECTIONMAP_PLANAR=!1,f.REFLECTIONMAP_CUBIC=!1,f.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,f.REFLECTIONMAP_PROJECTION=!1,f.REFLECTIONMAP_SKYBOX=!1,f.REFLECTIONMAP_EXPLICIT=!1,f.REFLECTIONMAP_EQUIRECTANGULAR=!1,f.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,f.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,f.INVERTCUBICMAP=!1,f.USESPHERICALFROMREFLECTIONMAP=!1,f.USEIRRADIANCEMAP=!1,f.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,f.USESPHERICALINVERTEX=!1,f.REFLECTIONMAP_OPPOSITEZ=!1,f.LODINREFLECTIONALPHA=!1,f.GAMMAREFLECTION=!1,f.RGBDREFLECTION=!1,f.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&s.e.LightmapTextureEnabled?((0,e.P)(this._lightmapTexture,f,"LIGHTMAP"),f.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,f.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,f.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):f.LIGHTMAP=!1,this._emissiveTexture&&s.e.EmissiveTextureEnabled?((0,e.P)(this._emissiveTexture,f,"EMISSIVE"),f.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):f.EMISSIVE=!1,s.e.SpecularTextureEnabled?(this._metallicTexture?((0,e.P)(this._metallicTexture,f,"REFLECTIVITY"),f.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,f.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,f.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,f.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,f.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,e.P)(this._reflectivityTexture,f,"REFLECTIVITY"),f.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,f.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,f.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):f.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(f.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,e.P)(this._metallicReflectanceTexture,f,"METALLIC_REFLECTANCE"),f.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):f.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,e.P)(this._reflectanceTexture,f,"REFLECTANCE"),f.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):f.REFLECTANCE=!1):(f.METALLIC_REFLECTANCE=!1,f.REFLECTANCE=!1),this._microSurfaceTexture?(0,e.P)(this._microSurfaceTexture,f,"MICROSURFACEMAP"):f.MICROSURFACEMAP=!1):(f.REFLECTIVITY=!1,f.MICROSURFACEMAP=!1),L.getCaps().standardDerivatives&&this._bumpTexture&&s.e.BumpTextureEnabled&&!this._disableBumpMap?((0,e.P)(this._bumpTexture,f,"BUMP"),this._useParallax&&this._albedoTexture&&s.e.DiffuseTextureEnabled?(f.PARALLAX=!0,f.PARALLAX_RHS=h.useRightHandedSystem,f.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):f.PARALLAX=!1,f.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(f.BUMP=!1,f.PARALLAX=!1,f.PARALLAX_RHS=!1,f.PARALLAXOCCLUSION=!1,f.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&s.e.ReflectionTextureEnabled?(f.ENVIRONMENTBRDF=!0,f.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(f.ENVIRONMENTBRDF=!1,f.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?f.ALPHAFROMALBEDO=!0:f.ALPHAFROMALBEDO=!1}f.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===k.LIGHTFALLOFF_STANDARD?(f.USEPHYSICALLIGHTFALLOFF=!1,f.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===k.LIGHTFALLOFF_GLTF?(f.USEPHYSICALLIGHTFALLOFF=!1,f.USEGLTFLIGHTFALLOFF=!0):(f.USEPHYSICALLIGHTFALLOFF=!0,f.USEGLTFLIGHTFALLOFF=!1),f.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.ef&&this._twoSidedLighting?f.TWOSIDEDLIGHTING=!0:f.TWOSIDEDLIGHTING=!1,f.MIRRORED=!!h._mirroredCameraPosition,f.SPECULARAA=L.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(f._areTexturesDirty||f._areMiscDirty)&&(f.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,f.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,f.ALPHABLEND=this.needAlphaBlendingForMesh(q),f.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,f.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),f._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(f),f.FORCENORMALFORWARD=this._forceNormalForward,f.RADIANCEOCCLUSION=this._useRadianceOcclusion,f.HORIZONOCCLUSION=this._useHorizonOcclusion,f._areMiscDirty&&((0,e.R)(q,h,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(q),f,this._applyDecalMapAfterDetailMap),f.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!q.isVerticesDataPresent(u.i.NormalKind),f.DEBUGMODE=this._debugMode),(0,e.K)(h,L,this,f,!!j,d,g),this._eventInfo.defines=f,this._eventInfo.mesh=q,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,e.I)(q,f,!0,!0,!0,this._transparencyMode!==k.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(q,f,j){const d={clipPlane:!1,useInstances:!1,...j};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const j=new A(this._eventInfo.defineNames),g=this._prepareEffect(q,j,void 0,void 0,d.useInstances,d.clipPlane,q.hasThinInstances);this._onEffectCreatedObservable&&(R.effect=g,R.subMesh=null,this._onEffectCreatedObservable.notifyObservers(R)),g.isReady()?f&&f(this):g.onCompileObservable.add((()=>{f&&f(this)}))})()}buildUniformLayout(){const q=this._uniformBuffer;q.addUniform("vAlbedoInfos",2),q.addUniform("vBaseWeightInfos",2),q.addUniform("vBaseDiffuseRoughnessInfos",2),q.addUniform("vAmbientInfos",4),q.addUniform("vOpacityInfos",2),q.addUniform("vEmissiveInfos",2),q.addUniform("vLightmapInfos",2),q.addUniform("vReflectivityInfos",3),q.addUniform("vMicroSurfaceSamplerInfos",2),q.addUniform("vReflectionInfos",2),q.addUniform("vReflectionFilteringInfo",2),q.addUniform("vReflectionPosition",3),q.addUniform("vReflectionSize",3),q.addUniform("vBumpInfos",3),q.addUniform("albedoMatrix",16),q.addUniform("baseWeightMatrix",16),q.addUniform("baseDiffuseRoughnessMatrix",16),q.addUniform("ambientMatrix",16),q.addUniform("opacityMatrix",16),q.addUniform("emissiveMatrix",16),q.addUniform("lightmapMatrix",16),q.addUniform("reflectivityMatrix",16),q.addUniform("microSurfaceSamplerMatrix",16),q.addUniform("bumpMatrix",16),q.addUniform("vTangentSpaceParams",2),q.addUniform("reflectionMatrix",16),q.addUniform("vReflectionColor",3),q.addUniform("vAlbedoColor",4),q.addUniform("baseWeight",1),q.addUniform("baseDiffuseRoughness",1),q.addUniform("vLightingIntensity",4),q.addUniform("vReflectionMicrosurfaceInfos",3),q.addUniform("vReflectionDominantDirection",3),q.addUniform("pointSize",1),q.addUniform("vReflectivityColor",4),q.addUniform("vEmissiveColor",3),q.addUniform("vAmbientColor",3),q.addUniform("vDebugMode",2),q.addUniform("vMetallicReflectanceFactors",4),q.addUniform("vMetallicReflectanceInfos",2),q.addUniform("metallicReflectanceMatrix",16),q.addUniform("vReflectanceInfos",2),q.addUniform("reflectanceMatrix",16),q.addUniform("vSphericalL00",3),q.addUniform("vSphericalL1_1",3),q.addUniform("vSphericalL10",3),q.addUniform("vSphericalL11",3),q.addUniform("vSphericalL2_2",3),q.addUniform("vSphericalL2_1",3),q.addUniform("vSphericalL20",3),q.addUniform("vSphericalL21",3),q.addUniform("vSphericalL22",3),q.addUniform("vSphericalX",3),q.addUniform("vSphericalY",3),q.addUniform("vSphericalZ",3),q.addUniform("vSphericalXX_ZZ",3),q.addUniform("vSphericalYY_ZZ",3),q.addUniform("vSphericalZZ",3),q.addUniform("vSphericalXY",3),q.addUniform("vSphericalYZ",3),q.addUniform("vSphericalZX",3),q.addUniform("cameraInfo",4),super.buildUniformLayout()}bindForSubMesh(q,f,j){const d=this.eq(),g=j.materialDefines;if(!g)return;const h=j.effect;if(!h)return;this._activeEffect=h,f.getMeshUniformBuffer().bindToEffect(h,"Mesh"),f.transferToEffect(q);const L=d.getEngine();this._uniformBuffer.bindToEffect(h,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,d,f,q,this.isFrozen),x.d.Bind(L.currentRenderPassId,this._activeEffect,f,q,this);const Q=d.activeCamera;Q?this._uniformBuffer.updateFloat4("cameraInfo",Q.gd,Q.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=j,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),g.OBJECTSPACE_NORMALMAP&&(q.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const r=this._mustRebind(d,h,j,f.visibility);(0,e.b)(f,this._activeEffect,this.prePassConfiguration);let u=null;const X=this._uniformBuffer;if(r){if(this.bindViewProjection(h),u=this._getReflectionTexture(),!X.useUbo||!this.isFrozen||!X.isSync||j._drawWrapper._forceRebindOnNextCall){var z;if(d.texturesEnabled){if(this._albedoTexture&&s.e.DiffuseTextureEnabled&&(X.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,e.q)(this._albedoTexture,X,"albedo")),this._baseWeightTexture&&s.e.BaseWeightTextureEnabled&&(X.updateFloat2("vBaseWeightInfos",this._baseWeightTexture.coordinatesIndex,this._baseWeightTexture.level),(0,e.q)(this._baseWeightTexture,X,"baseWeight")),this._baseDiffuseRoughnessTexture&&s.e.BaseDiffuseRoughnessTextureEnabled&&(X.updateFloat2("vBaseDiffuseRoughnessInfos",this._baseDiffuseRoughnessTexture.coordinatesIndex,this._baseDiffuseRoughnessTexture.level),(0,e.q)(this._baseDiffuseRoughnessTexture,X,"baseDiffuseRoughness")),this._ambientTexture&&s.e.AmbientTextureEnabled&&(X.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,e.q)(this._ambientTexture,X,"ambient")),this._opacityTexture&&s.e.OpacityTextureEnabled&&(X.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,e.q)(this._opacityTexture,X,"opacity")),u&&s.e.ReflectionTextureEnabled){if(X.jd("reflectionMatrix",u.getReflectionTextureMatrix()),X.updateFloat2("vReflectionInfos",u.level*d.iblIntensity,0),u.boundingBoxSize){const q=u;X.updateVector3("vReflectionPosition",q.boundingBoxPosition),X.updateVector3("vReflectionSize",q.boundingBoxSize)}if(this.realTimeFiltering){const q=u.getSize().width;X.updateFloat2("vReflectionFilteringInfo",q,Math.log2(q))}if(g.USEIRRADIANCEMAP)g.USEIRRADIANCEMAP&&g.USE_IRRADIANCE_DOMINANT_DIRECTION&&X.updateVector3("vReflectionDominantDirection",u.irradianceTexture._dominantDirection);else{const q=u.sphericalPolynomial;if(g.USESPHERICALFROMREFLECTIONMAP&&q)if(g.SPHERICAL_HARMONICS){const f=q.preScaledHarmonics;X.updateVector3("vSphericalL00",f.l00),X.updateVector3("vSphericalL1_1",f.l1_1),X.updateVector3("vSphericalL10",f.l10),X.updateVector3("vSphericalL11",f.l11),X.updateVector3("vSphericalL2_2",f.l2_2),X.updateVector3("vSphericalL2_1",f.l2_1),X.updateVector3("vSphericalL20",f.l20),X.updateVector3("vSphericalL21",f.l21),X.updateVector3("vSphericalL22",f.l22)}else X.updateFloat3("vSphericalX",q.x.x,q.x.y,q.x.z),X.updateFloat3("vSphericalY",q.y.x,q.y.y,q.y.z),X.updateFloat3("vSphericalZ",q.z.x,q.z.y,q.z.z),X.updateFloat3("vSphericalXX_ZZ",q.xx.x-q.zz.x,q.xx.y-q.zz.y,q.xx.z-q.zz.z),X.updateFloat3("vSphericalYY_ZZ",q.yy.x-q.zz.x,q.yy.y-q.zz.y,q.yy.z-q.zz.z),X.updateFloat3("vSphericalZZ",q.zz.x,q.zz.y,q.zz.z),X.updateFloat3("vSphericalXY",q.xy.x,q.xy.y,q.xy.z),X.updateFloat3("vSphericalYZ",q.yz.x,q.yz.y,q.yz.z),X.updateFloat3("vSphericalZX",q.zx.x,q.zx.y,q.zx.z)}X.updateFloat3("vReflectionMicrosurfaceInfos",u.getSize().width,u.lodGenerationScale,u.lodGenerationOffset)}this._emissiveTexture&&s.e.EmissiveTextureEnabled&&(X.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,e.q)(this._emissiveTexture,X,"emissive")),this._lightmapTexture&&s.e.LightmapTextureEnabled&&(X.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,e.q)(this._lightmapTexture,X,"lightmap")),s.e.SpecularTextureEnabled&&(this._metallicTexture?(X.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,e.q)(this._metallicTexture,X,"reflectivity")):this._reflectivityTexture&&(X.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,e.q)(this._reflectivityTexture,X,"reflectivity")),this._metallicReflectanceTexture&&(X.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,e.q)(this._metallicReflectanceTexture,X,"metallicReflectance")),this._reflectanceTexture&&g.REFLECTANCE&&(X.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,e.q)(this._reflectanceTexture,X,"reflectance")),this._microSurfaceTexture&&(X.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,e.q)(this._microSurfaceTexture,X,"microSurfaceSampler"))),this._bumpTexture&&L.getCaps().standardDerivatives&&s.e.BumpTextureEnabled&&!this._disableBumpMap&&(X.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,e.q)(this._bumpTexture,X,"bump"),d._mirroredCameraPosition?X.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):X.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&X.updateFloat("pointSize",this.pointSize),g.METALLICWORKFLOW){var B;t.i.wd[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,t.i.wd[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness;const q=(null===(B=this.subSurface)||void 0===B?void 0:B._indexOfRefraction)??1.5,f=1;t.i.wd[0].b=q;const j=Math.pow((q-f)/(q+f),2);t.i.wd[0].a=j,X.updateDirectColor4("vReflectivityColor",t.i.wd[0]),X.updateColor4("vMetallicReflectanceFactors",this._metallicReflectanceColor,this._metallicF0Factor)}else X.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);X.updateColor3("vEmissiveColor",s.e.EmissiveTextureEnabled?this._emissiveColor:t.c.BlackReadOnly),X.updateColor3("vReflectionColor",this._reflectionColor),!g.SS_REFRACTION&&null!==(z=this.subSurface)&&void 0!==z&&z._linkRefractionWithTransparency?X.updateColor4("vAlbedoColor",this._albedoColor,1):X.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),X.updateFloat("baseWeight",this._baseWeight),X.updateFloat("baseDiffuseRoughness",this._baseDiffuseRoughness||0),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*d.environmentIntensity,this._lightingInfos.w=this._specularIntensity,X.updateVector4("vLightingIntensity",this._lightingInfos),d.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),X.updateColor3("vAmbientColor",this._globalAmbientColor),X.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}if(d.texturesEnabled){if(this._albedoTexture&&s.e.DiffuseTextureEnabled&&X.setTexture("albedoSampler",this._albedoTexture),this._baseWeightTexture&&s.e.BaseWeightTextureEnabled&&X.setTexture("baseWeightSampler",this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&s.e.BaseDiffuseRoughnessTextureEnabled&&X.setTexture("baseDiffuseRoughnessSampler",this._baseDiffuseRoughnessTexture),this._ambientTexture&&s.e.AmbientTextureEnabled&&X.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&s.e.OpacityTextureEnabled&&X.setTexture("opacitySampler",this._opacityTexture),u&&s.e.ReflectionTextureEnabled){g.LODBASEDMICROSFURACE?X.setTexture("reflectionSampler",u):(X.setTexture("reflectionSampler",u._lodTextureMid||u),X.setTexture("reflectionSamplerLow",u._lodTextureLow||u),X.setTexture("reflectionSamplerHigh",u._lodTextureHigh||u)),g.USEIRRADIANCEMAP&&X.setTexture("irradianceSampler",u.irradianceTexture);const q=this.eq().iblCdfGenerator;this.realTimeFiltering&&q&&X.setTexture("icdfSampler",q.getIcdfTexture())}g.ENVIRONMENTBRDF&&X.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&s.e.EmissiveTextureEnabled&&X.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&s.e.LightmapTextureEnabled&&X.setTexture("lightmapSampler",this._lightmapTexture),s.e.SpecularTextureEnabled&&(this._metallicTexture?X.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&X.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&X.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&g.REFLECTANCE&&X.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&X.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&L.getCaps().standardDerivatives&&s.e.BumpTextureEnabled&&!this._disableBumpMap&&X.setTexture("bumpSampler",this._bumpTexture)}this.eq().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(f)&&this.eq().depthPeelingRenderer.bind(h),this._eventInfo.subMesh=j,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,b.f)(this._activeEffect,this,d),this.bindEyePosition(h)}else d.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(r||!this.isFrozen){var D;if(d.lightsEnabled&&!this._disableLighting&&(0,e.g)(d,f,this._activeEffect,g,this._maxSimultaneousLights),(d.fogEnabled&&f.applyFog&&d.fogMode!==H.b.FOGMODE_NONE||u||this.subSurface.refractionTexture||f.receiveShadows||g.PREPASS)&&this.bindView(h),(0,e.d)(d,f,this._activeEffect,!0),g.NUM_MORPH_INFLUENCERS&&(0,e.l)(f,this._activeEffect),g.BAKED_VERTEX_ANIMATION_TEXTURE)null===(D=f.bakedVertexAnimationManager)||void 0===D||D.bind(h,g.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,e.i)(g,this._activeEffect,d)}this._afterBind(f,this._activeEffect,j),X.update()}getAnimatables(){const q=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&q.push(this._albedoTexture),this._baseWeightTexture&&this._baseWeightTexture.animations&&this._baseWeightTexture.animations.length>0&&q.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&this._baseDiffuseRoughnessTexture.animations&&this._baseDiffuseRoughnessTexture.animations.length>0&&q.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&q.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&q.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&q.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&q.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?q.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&q.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&q.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&q.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&q.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&q.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&q.push(this._microSurfaceTexture),q}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.eq().environmentTexture}getActiveTextures(){const q=super.getActiveTextures();return this._albedoTexture&&q.push(this._albedoTexture),this._baseWeightTexture&&q.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&q.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&q.push(this._ambientTexture),this._opacityTexture&&q.push(this._opacityTexture),this._reflectionTexture&&q.push(this._reflectionTexture),this._emissiveTexture&&q.push(this._emissiveTexture),this._reflectivityTexture&&q.push(this._reflectivityTexture),this._metallicTexture&&q.push(this._metallicTexture),this._metallicReflectanceTexture&&q.push(this._metallicReflectanceTexture),this._reflectanceTexture&&q.push(this._reflectanceTexture),this._microSurfaceTexture&&q.push(this._microSurfaceTexture),this._bumpTexture&&q.push(this._bumpTexture),this._lightmapTexture&&q.push(this._lightmapTexture),q}hasTexture(q){return!!super.hasTexture(q)||(this._albedoTexture===q||(this._baseWeightTexture===q||(this._baseDiffuseRoughnessTexture===q||(this._ambientTexture===q||(this._opacityTexture===q||(this._reflectionTexture===q||(this._emissiveTexture===q||(this._reflectivityTexture===q||(this._metallicTexture===q||(this._metallicReflectanceTexture===q||(this._reflectanceTexture===q||(this._microSurfaceTexture===q||(this._bumpTexture===q||this._lightmapTexture===q)))))))))))))}setPrePassRenderer(){var q;if(null===(q=this.subSurface)||void 0===q||!q.isScatteringEnabled)return!1;const f=this.eq().enableSubSurfaceForPrePass();return f&&(f.enabled=!0),!0}dispose(q,f){var j,d,g,h,L,Q,H,r,u,X,z,B,D,i;(this._breakShaderLoadedCheck=!0,f)&&(this._environmentBRDFTexture&&this.eq().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(j=this._albedoTexture)||void 0===j||j.dispose(),null===(d=this._baseWeightTexture)||void 0===d||d.dispose(),null===(g=this._baseDiffuseRoughnessTexture)||void 0===g||g.dispose(),null===(h=this._ambientTexture)||void 0===h||h.dispose(),null===(L=this._opacityTexture)||void 0===L||L.dispose(),null===(Q=this._reflectionTexture)||void 0===Q||Q.dispose(),null===(H=this._emissiveTexture)||void 0===H||H.dispose(),null===(r=this._metallicTexture)||void 0===r||r.dispose(),null===(u=this._reflectivityTexture)||void 0===u||u.dispose(),null===(X=this._bumpTexture)||void 0===X||X.dispose(),null===(z=this._lightmapTexture)||void 0===z||z.dispose(),null===(B=this._metallicReflectanceTexture)||void 0===B||B.dispose(),null===(D=this._reflectanceTexture)||void 0===D||D.dispose(),null===(i=this._microSurfaceTexture)||void 0===i||i.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(q,f)}}k.PBRMATERIAL_OPAQUE=N.b.MATERIAL_OPAQUE,k.PBRMATERIAL_ALPHATEST=N.b.MATERIAL_ALPHATEST,k.PBRMATERIAL_ALPHABLEND=N.b.MATERIAL_ALPHABLEND,k.PBRMATERIAL_ALPHATESTANDBLEND=N.b.MATERIAL_ALPHATESTANDBLEND,k.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,k.LIGHTFALLOFF_PHYSICAL=0,k.LIGHTFALLOFF_GLTF=1,k.LIGHTFALLOFF_STANDARD=2,k.ForceGLSL=!1,(0,d.b)([(0,g.s)()],k.prototype,"_imageProcessingConfiguration",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsMiscDirty")],k.prototype,"debugMode",void 0)},11483:(q,f,j)=>{j.d(f,{d:()=>X});var d=j(11125),g=j(11130),h=j(11491),L=j(11210),Q=j(11502),H=j(10965),r=j(11118),u=j(11199);class X extends Q.c{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(q){this.subSurface.refractionTexture=q,q?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(q){this.subSurface.indexOfRefraction=q}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(q){this.subSurface.invertRefractionY=q}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(q){this.subSurface.linkRefractionWithTransparency=q,q&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===Q.c.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(q){q!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=q?Q.c.LIGHTFALLOFF_PHYSICAL:Q.c.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===Q.c.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(q){q!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=q?Q.c.LIGHTFALLOFF_GLTF:Q.c.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(q){this._attachImageProcessingConfiguration(q),this._markAllSubMeshesAsImageProcessingDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(q){this.imageProcessingConfiguration.colorCurvesEnabled=q}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(q){this.imageProcessingConfiguration.colorGradingEnabled=q}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(q){this._imageProcessingConfiguration.toneMappingEnabled=q}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(q){this._imageProcessingConfiguration.exposure=q}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(q){this._imageProcessingConfiguration.contrast=q}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(q){this._imageProcessingConfiguration.colorGradingTexture=q}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(q){this._imageProcessingConfiguration.colorCurves=q}constructor(q,f){super(q,f,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=X.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=L.c.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new L.c(0,0,0),this.albedoColor=new L.c(1,1,1),this.baseWeight=1,this.reflectivityColor=new L.c(1,1,1),this.reflectionColor=new L.c(1,1,1),this.emissiveColor=new L.c(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,h.d)(this.eq())}getClassName(){return"PBRMaterial"}clone(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const d=u.d.Clone((()=>new X(q,this.eq())),this,{cloneTexturesOnlyOnce:f});return d.id=q,d.name=q,this.stencil.copyTo(d.stencil),this._clonePlugins(d,j),d}serialize(){const q=super.serialize();return q.customType="BABYLON.PBRMaterial",q}static Parse(q,f,j){const d=u.d.Parse((()=>new X(q.name,f)),q,f,j);return q.stencil&&d.stencil.parse(q.stencil,f,j),r.b._ParsePlugins(q,d,f,j),q.clearCoat&&d.clearCoat.parse(q.clearCoat,f,j),q.anisotropy&&d.anisotropy.parse(q.anisotropy,f,j),q.brdf&&d.brdf.parse(q.brdf,f,j),q.sheen&&d.sheen.parse(q.sheen,f,j),q.subSurface&&d.subSurface.parse(q.subSurface,f,j),q.iridescence&&d.iridescence.parse(q.iridescence,f,j),d}}X.PBRMATERIAL_OPAQUE=Q.c.PBRMATERIAL_OPAQUE,X.PBRMATERIAL_ALPHATEST=Q.c.PBRMATERIAL_ALPHATEST,X.PBRMATERIAL_ALPHABLEND=Q.c.PBRMATERIAL_ALPHABLEND,X.PBRMATERIAL_ALPHATESTANDBLEND=Q.c.PBRMATERIAL_ALPHATESTANDBLEND,X.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=Q.c.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"directIntensity",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"emissiveIntensity",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"environmentIntensity",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"specularIntensity",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"disableBumpMap",void 0),(0,d.b)([(0,g.F)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"albedoTexture",void 0),(0,d.b)([(0,g.F)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"baseWeightTexture",void 0),(0,d.b)([(0,g.F)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"baseDiffuseRoughnessTexture",void 0),(0,d.b)([(0,g.F)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"ambientTexture",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"ambientTextureStrength",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,d.b)([(0,g.F)(),(0,g.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],X.prototype,"opacityTexture",void 0),(0,d.b)([(0,g.F)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"reflectionTexture",void 0),(0,d.b)([(0,g.F)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"emissiveTexture",void 0),(0,d.b)([(0,g.F)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"reflectivityTexture",void 0),(0,d.b)([(0,g.F)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"metallicTexture",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"metallic",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"roughness",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"metallicF0Factor",void 0),(0,d.b)([(0,g.i)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"metallicReflectanceColor",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,d.b)([(0,g.F)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"metallicReflectanceTexture",void 0),(0,d.b)([(0,g.F)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"reflectanceTexture",void 0),(0,d.b)([(0,g.F)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"microSurfaceTexture",void 0),(0,d.b)([(0,g.F)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"bumpTexture",void 0),(0,d.b)([(0,g.F)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty",null)],X.prototype,"lightmapTexture",void 0),(0,d.b)([(0,g.i)("ambient"),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"ambientColor",void 0),(0,d.b)([(0,g.i)("albedo"),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"albedoColor",void 0),(0,d.b)([(0,g.O)("baseWeight"),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"baseWeight",void 0),(0,d.b)([(0,g.O)("baseDiffuseRoughness"),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"baseDiffuseRoughness",void 0),(0,d.b)([(0,g.i)("reflectivity"),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"reflectivityColor",void 0),(0,d.b)([(0,g.i)("reflection"),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"reflectionColor",void 0),(0,d.b)([(0,g.i)("emissive"),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"emissiveColor",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"microSurface",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"useLightmapAsShadowmap",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],X.prototype,"useAlphaFromAlbedoTexture",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],X.prototype,"forceAlphaTest",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],X.prototype,"alphaCutOff",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"useSpecularOverAlpha",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"useAmbientInGrayScale",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,d.b)([(0,g.O)()],X.prototype,"usePhysicalLightFalloff",null),(0,d.b)([(0,g.O)()],X.prototype,"useGLTFLightFalloff",null),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"useRadianceOverAlpha",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"useObjectSpaceNormalMap",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"useParallax",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"useParallaxOcclusion",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"parallaxScaleBias",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsLightsDirty")],X.prototype,"disableLighting",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"forceIrradianceInFragment",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsLightsDirty")],X.prototype,"maxSimultaneousLights",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"invertNormalMapX",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"invertNormalMapY",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"twoSidedLighting",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"useAlphaFresnel",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"useLinearAlphaFresnel",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"environmentBRDFTexture",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"forceNormalForward",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"enableSpecularAntiAliasing",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"useHorizonOcclusion",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"useRadianceOcclusion",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsMiscDirty")],X.prototype,"unlit",void 0),(0,d.b)([(0,g.O)(),(0,g.b)("_markAllSubMeshesAsMiscDirty")],X.prototype,"applyDecalMapAfterDetailMap",void 0),(0,H.f)("BABYLON.PBRMaterial",X)},11096:(q,f,j)=>{j.d(f,{e:()=>L});var d=j(11005);const g=new Map;function h(q,f){(function(q){return g.delete(q)})(q)&&d.e.Warn(`Extension with the name '${q}' already exists`),g.set(q,f)}function L(q,f){"image/ktx"!==f&&"image/ktx2"!==f||(q=".ktx"),g.has(q)||(q.endsWith(".ies")&&h(".ies",(async()=>await j.e(28).then(j.bind(j,13411)).then((q=>new q._IESTextureLoader)))),q.endsWith(".dds")&&h(".dds",(async()=>await j.e(25).then(j.bind(j,13413)).then((q=>new q._DDSTextureLoader)))),q.endsWith(".basis")&&h(".basis",(async()=>await j.e(29).then(j.bind(j,13422)).then((q=>new q._BasisTextureLoader)))),q.endsWith(".env")&&h(".env",(async()=>await Promise.all([j.e(24),j.e(30)]).then(j.bind(j,13431)).then((q=>new q._ENVTextureLoader)))),q.endsWith(".hdr")&&h(".hdr",(async()=>await j.e(31).then(j.bind(j,13439)).then((q=>new q._HDRTextureLoader)))),(q.endsWith(".ktx")||q.endsWith(".ktx2"))&&(h(".ktx",(async()=>await j.e(32).then(j.bind(j,13444)).then((q=>new q._KTXTextureLoader)))),h(".ktx2",(async()=>await j.e(32).then(j.bind(j,13444)).then((q=>new q._KTXTextureLoader))))),q.endsWith(".tga")&&h(".tga",(async()=>await j.e(33).then(j.bind(j,13450)).then((q=>new q._TGATextureLoader)))),q.endsWith(".exr")&&h(".exr",(async()=>await j.e(34).then(j.bind(j,13456)).then((q=>new q._ExrTextureLoader)))));const d=g.get(q);return d?Promise.resolve(d(f)):null}},11417:(q,f,j)=>{j.d(f,{b:()=>z});var d=j(11125),g=j(11130),h=j(10982),L=j(10941),Q=j(10980),H=j(11105),r=(j(11030),j(11411));class u{get wrapU(){return this._wrapU}set wrapU(q){this._wrapU=q}get wrapV(){return this._wrapV}set wrapV(q){this._wrapV=q}get coordinatesMode(){return 0}get isCube(){return!!this._texture&&this._texture.isCube}set isCube(q){this._texture&&(this._texture.isCube=q)}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(q){this._texture&&(this._texture.is3D=q)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(q){this._texture&&(this._texture.is2DArray=q)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(q){return void 0!==(null===q||void 0===q?void 0:q.shareDepth)}constructor(q){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=r.b.Zero(),this._cachedBaseSize=r.b.Zero(),this._initialSamplingMode=2,this._texture=u._IsRenderTargetWrapper(q)?q.texture:q,this._texture&&(this._engine=this._texture.getEngine(),this.wrapU=this._texture._cachedWrapU??this.wrapU,this.wrapV=this._texture._cachedWrapV??this.wrapV,this.wrapR=this._texture._cachedWrapR??this.wrapR)}isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(q){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(q,this._texture,this._texture.generateMipMaps)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}var X=j(11199);class z extends u{set Rf(q){this._hasAlpha!==q&&(this._hasAlpha=q,this._scene&&this._scene.markAllMaterialsAsDirty(1,(q=>q.hasTexture(this))))}get Rf(){return this._hasAlpha}set getAlphaFromRGB(q){this._getAlphaFromRGB!==q&&(this._getAlphaFromRGB=q,this._scene&&this._scene.markAllMaterialsAsDirty(1,(q=>q.hasTexture(this))))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(q){this._coordinatesIndex!==q&&(this._coordinatesIndex=q,this._scene&&this._scene.markAllMaterialsAsDirty(1,(q=>q.hasTexture(this))))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(q){this._coordinatesMode!==q&&(this._coordinatesMode=q,this._scene&&this._scene.markAllMaterialsAsDirty(1,(q=>q.hasTexture(this))))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(q){this._wrapU=q}get wrapV(){return this._wrapV}set wrapV(q){this._wrapV=q}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(q){this._texture?this._texture.isCube=q:this._isCube=q}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(q){this._texture&&(this._texture.is3D=q)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(q){this._texture&&(this._texture.is2DArray=q)}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set gammaSpace(q){var f;if(this._texture){if(this._texture._gammaSpace===q)return;this._texture._gammaSpace=q}else{if(this._gammaSpace===q)return;this._gammaSpace=q}null===(f=this.eq())||void 0===f||f.markAllMaterialsAsDirty(1,(q=>q.hasTexture(this)))}get isRGBD(){return null!=this._texture&&this._texture._isRGBD}set isRGBD(q){var f;q!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=q),null===(f=this.eq())||void 0===f||f.markAllMaterialsAsDirty(1,(q=>q.hasTexture(this))))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(q){this._texture&&(this._texture._lodGenerationOffset=q)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(q){this._texture&&(this._texture._lodGenerationScale=q)}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}set linearSpecularLOD(q){this._texture&&(this._texture._linearSpecularLOD=q)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(q){this._texture&&(this._texture._irradianceTexture=q)}get uid(){return this._uid||(this._uid=(0,H.d)()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(q){this._onDisposeObserver&&this.qd.remove(this._onDisposeObserver),this._onDisposeObserver=this.qd.add(q)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=z.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this._dominantDirection=null,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.qd=new h.d,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,q?z._IsScene(q)?this._scene=q:this._engine=q:this._scene=Q.d.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=f,this._uid=null}eq(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return L.b.IdentityReadOnly}getReflectionTextureMatrix(){return L.b.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(q){}get canRescale(){return!1}_getFromCache(q,f,j,d,g,h){const L=this._getEngine();if(!L)return null;const Q=L._getUseSRGBBuffer(!!g,f),H=L.getLoadedTexturesCache();for(let r=0;r<H.length;r++){const L=H[r];if((void 0===g||Q===L._useSRGBBuffer)&&(void 0===d||d===L.invertY)&&L.url===q&&L.generateMipMaps===!f&&(!j||j===L.samplingMode)&&(void 0===h||h===L.isCube))return L.incrementReferences(),L}return null}_rebuild(){}clone(){return null}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const q=this.eq();q&&q.markAllMaterialsAsDirty(1)}readPixels(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],g=arguments.length>4&&void 0!==arguments[4]&&arguments[4],h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Number.MAX_VALUE,H=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Number.MAX_VALUE;if(!this._texture)return null;const r=this._getEngine();if(!r)return null;const u=this.getSize();let X=u.width,z=u.height;0!==f&&(X/=Math.pow(2,f),z/=Math.pow(2,f),X=Math.round(X),z=Math.round(z)),Q=Math.min(X,Q),H=Math.min(z,H);try{return this._texture.isCube?r._readTexturePixels(this._texture,Q,H,q,f,j,d,g,h,L):r._readTexturePixels(this._texture,Q,H,-1,f,j,d,g,h,L)}catch(B){return null}}_readPixelsSync(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],g=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!this._texture)return null;const h=this.getSize();let L=h.width,Q=h.height;const H=this._getEngine();if(!H)return null;0!=f&&(L/=Math.pow(2,f),Q/=Math.pow(2,f),L=Math.round(L),Q=Math.round(Q));try{return this._texture.isCube?H._readTexturePixelsSync(this._texture,L,Q,q,f,j,d,g):H._readTexturePixelsSync(this._texture,L,Q,-1,f,j,d,g)}catch(r){return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const q=this._scene.textures.indexOf(this);if(q>=0&&this._scene.textures.splice(q,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const q=this._parentContainer.textures.indexOf(this);q>-1&&this._parentContainer.textures.splice(q,1),this._parentContainer=null}}this.qd.notifyObservers(this),this.qd.clear(),this.metadata=null,super.dispose()}serialize(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.name&&!q)return null;const f=X.d.Serialize(this);return X.d.AppendSerializedAnimations(this,f),f}static WhenAllReady(q,f){let j=q.length;if(0!==j)for(let d=0;d<q.length;d++){const g=q[d];if(g.isReady())0===--j&&f();else{const q=g.onLoadObservable;q?q.addOnce((()=>{0===--j&&f()})):0===--j&&f()}}else f()}static _IsScene(q){return"Scene"===q.getClassName()}}z.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,d.b)([(0,g.O)()],z.prototype,"uniqueId",void 0),(0,d.b)([(0,g.O)()],z.prototype,"name",void 0),(0,d.b)([(0,g.O)()],z.prototype,"displayName",void 0),(0,d.b)([(0,g.O)()],z.prototype,"metadata",void 0),(0,d.b)([(0,g.O)("Rf")],z.prototype,"_hasAlpha",void 0),(0,d.b)([(0,g.O)("getAlphaFromRGB")],z.prototype,"_getAlphaFromRGB",void 0),(0,d.b)([(0,g.O)()],z.prototype,"level",void 0),(0,d.b)([(0,g.O)("coordinatesIndex")],z.prototype,"_coordinatesIndex",void 0),(0,d.b)([(0,g.O)()],z.prototype,"optimizeUVAllocation",void 0),(0,d.b)([(0,g.O)("coordinatesMode")],z.prototype,"_coordinatesMode",void 0),(0,d.b)([(0,g.O)()],z.prototype,"wrapU",null),(0,d.b)([(0,g.O)()],z.prototype,"wrapV",null),(0,d.b)([(0,g.O)()],z.prototype,"wrapR",void 0),(0,d.b)([(0,g.O)()],z.prototype,"anisotropicFilteringLevel",void 0),(0,d.b)([(0,g.O)()],z.prototype,"isCube",null),(0,d.b)([(0,g.O)()],z.prototype,"is3D",null),(0,d.b)([(0,g.O)()],z.prototype,"is2DArray",null),(0,d.b)([(0,g.O)()],z.prototype,"gammaSpace",null),(0,d.b)([(0,g.O)()],z.prototype,"invertZ",void 0),(0,d.b)([(0,g.O)()],z.prototype,"lodLevelInAlpha",void 0),(0,d.b)([(0,g.O)()],z.prototype,"lodGenerationOffset",null),(0,d.b)([(0,g.O)()],z.prototype,"lodGenerationScale",null),(0,d.b)([(0,g.O)()],z.prototype,"linearSpecularLOD",null),(0,d.b)([(0,g.F)()],z.prototype,"irradianceTexture",null),(0,d.b)([(0,g.O)()],z.prototype,"isRenderTarget",void 0)},11578:(q,f,j)=>{var d=j(11581),g=j(11417);g.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(g.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=d.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((q=>{this._texture._sphericalPolynomial=q,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(q){this._texture&&(this._texture._sphericalPolynomial=q)},enumerable:!0,configurable:!0})},11090:(q,f,j)=>{j.d(f,{c:()=>L});var d,g=j(10982),h=j(11093);!function(q){q[q.Unknown=0]="Unknown",q[q.Url=1]="Url",q[q.Temp=2]="Temp",q[q.Raw=3]="Raw",q[q.Dynamic=4]="Dynamic",q[q.RenderTarget=5]="RenderTarget",q[q.MultiRenderTarget=6]="MultiRenderTarget",q[q.Cube=7]="Cube",q[q.CubeRaw=8]="CubeRaw",q[q.CubePrefiltered=9]="CubePrefiltered",q[q.Raw3D=10]="Raw3D",q[q.Raw2DArray=11]="Raw2DArray",q[q.DepthStencil=12]="DepthStencil",q[q.CubeRawRGBD=13]="CubeRawRGBD",q[q.Depth=14]="Depth"}(d||(d={}));class L extends h.b{get useMipMaps(){return this.generateMipMaps}set useMipMaps(q){this.generateMipMaps=q}get uniqueId(){return this._uniqueId}_setUniqueId(q){this._uniqueId=q}getEngine(){return this._engine}get source(){return this._source}constructor(q,f){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new g.d,this.onErrorObservable=new g.d,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._autoMSAAManagement=!1,this._engine=q,this._source=f,this._uniqueId=L._Counter++,j||(this._hardwareTexture=q._createHardwareTexture())}incrementReferences(){this._references++}updateSize(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._engine.updateTextureDimensions(this,q,f,j),this.width=q,this.height=f,this.depth=j,this.baseWidth=q,this.baseHeight=f,this.baseDepth=j,this._size=q*f*j}_rebuild(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const q=this.onRebuildCallback(this),f=f=>{f._swapAndDie(this,!1),this.isReady=q.isReady};return void(q.isAsync?q.proxy.then(f):f(q.proxy))}let q;switch(this.source){case 2:case 12:case 14:break;case 1:return void(q=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(q=>{q._swapAndDie(this,!1),this.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case 3:q=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),q._swapAndDie(this,!1),this.isReady=!0;break;case 10:q=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),q._swapAndDie(this,!1),this.isReady=!0;break;case 11:q=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),q._swapAndDie(this,!1),this.isReady=!0;break;case 4:q=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),q._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:return void(q=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(()=>{q._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null));case 8:q=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),q._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:return q=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(q=>{q&&q._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension),void(q._sphericalPolynomial=this._sphericalPolynomial)}}_swapAndDie(q){var f;let j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null===(f=this._hardwareTexture)||void 0===f||f.setUsage(q._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),q._hardwareTexture=this._hardwareTexture,j&&(q._isRGBD=this._isRGBD),this._lodTextureHigh&&(q._lodTextureHigh&&q._lodTextureHigh.dispose(),q._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(q._lodTextureMid&&q._lodTextureMid.dispose(),q._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(q._lodTextureLow&&q._lodTextureLow.dispose(),q._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(q._irradianceTexture&&q._irradianceTexture.dispose(),q._irradianceTexture=this._irradianceTexture);const d=this._engine.getLoadedTexturesCache();let g=d.indexOf(this);-1!==g&&d.splice(g,1),g=d.indexOf(q),-1===g&&d.push(q)}dispose(){this._references--,0===this._references&&(this.onLoadedObservable.clear(),this.onErrorObservable.clear(),this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}}L._Counter=0},11468:(q,f,j)=>{j.d(f,{c:()=>g});var d=j(11438);class g extends d.e{constructor(q,f,j,g,h){let L=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],Q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,u=arguments.length>9?arguments[9]:void 0,X=arguments.length>10?arguments[10]:void 0,z=arguments.length>11?arguments[11]:void 0;super(null,h,!L,Q,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,u),this.format=g,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==r||(H=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==r||(H=1),this._texture=this._engine.createRawTexture(q,f,j,g,L,Q,H,null,r,u??0,X??!1),this.wrapU=d.e.CLAMP_ADDRESSMODE,this.wrapV=d.e.CLAMP_ADDRESSMODE,this._waitingForData=!!z&&!q)}update(q){this._getEngine().updateRawTexture(this._texture,q,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer),this._waitingForData=!1}clone(){if(!this._texture)return super.clone();const q=new g(null,this.getSize().width,this.getSize().height,this.format,this.eq(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return q._texture=this._texture,this._texture.incrementReferences(),q}isReady(){return super.isReady()&&!this._waitingForData}static CreateLuminanceTexture(q,f,j,d){return new g(q,f,j,1,d,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(q,f,j,d){return new g(q,f,j,2,d,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(q,f,j,d){return new g(q,f,j,0,d,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(q,f,j,d){return new g(q,f,j,4,d,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(q,f,j,d){return new g(q,f,j,5,d,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9],arguments.length>10&&void 0!==arguments[10]&&arguments[10])}static CreateRGBAStorageTexture(q,f,j,d){return new g(q,f,j,5,d,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(q,f,j,h){let L=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:d.e.TRILINEAR_SAMPLINGMODE;return new g(q,f,j,6,h,L,Q,H,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(q,f,j,h){let L=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:d.e.TRILINEAR_SAMPLINGMODE;return new g(q,f,j,6,h,L,Q,H,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},11440:(q,f,j)=>{j.d(f,{b:()=>B});var d=j(10982),g=j(10941),h=j(11438),L=j(11445),Q=j(11114),H=j(11067),r=j(11005),u=j(11454),X=j(10958);class z{get renderList(){return this._renderList}set renderList(q){this._renderList!==q&&(this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),q&&(this._unObserveRenderList=(0,X.j)(q,this._renderListHasChanged)),this._renderList=q)}get disableImageProcessing(){return this._disableImageProcessing}set disableImageProcessing(q){q!==this._disableImageProcessing&&(this._disableImageProcessing=q,this._scene.markAllMaterialsAsDirty(64))}get name(){return this._name}set name(q){if(this._name===q)return;if(this._name=q,!this._scene)return;const f=this._scene.getEngine();for(let j=0;j<this._renderPassIds.length;++j){const q=this._renderPassIds[j];f._renderPassNames[q]=`${this._name}#${j}`}}get renderPassIds(){return this._renderPassIds}get currentRefreshId(){return this._currentRefreshId}setMaterialForRendering(q,f){let j;j=Array.isArray(q)?q:[q];for(let d=0;d<j.length;++d)for(let q=0;q<this.options.numPasses;++q){let g=j[d];j[d].isAnInstance&&(g=j[d].sourceMesh),g.setMaterialForRenderPass(this._renderPassIds[q],void 0!==f?Array.isArray(f)?f[q]:f:void 0)}}constructor(q,f,j){this._unObserveRenderList=null,this._renderListHasChanged=(q,f)=>{const j=this._renderList?this._renderList.length:0;if(0===f&&j>0||0===j)for(const d of this._scene.meshes)d._markSubMeshesAsLightDirty()},this.particleSystemList=null,this.getCustomRenderList=null,this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this._disableImageProcessing=!1,this.onBeforeRenderObservable=new d.d,this.onAfterRenderObservable=new d.d,this.onBeforeRenderingManagerRenderObservable=new d.d,this.onAfterRenderingManagerRenderObservable=new d.d,this.onFastPathRenderObservable=new d.d,this._currentRefreshId=-1,this._refreshRate=1,this._currentApplyByPostProcessSetting=!1,this._currentSceneCamera=null,this.name=q,this._scene=f,this.renderList=[],this._renderPassIds=[],this.options={numPasses:1,doNotChangeAspectRatio:!0,...j},this._createRenderPassId(),this.renderPassId=this._renderPassIds[0],this._renderingManager=new u.c(f),this._renderingManager._useSceneAutoClearSetup=!0}_releaseRenderPassId(){const q=this._scene.getEngine();for(let f=0;f<this.options.numPasses;++f)q.releaseRenderPassId(this._renderPassIds[f]);this._renderPassIds.length=0}_createRenderPassId(){this._releaseRenderPassId();const q=this._scene.getEngine();for(let f=0;f<this.options.numPasses;++f)this._renderPassIds[f]=q.createRenderPassId(`${this.name}#${f}`)}resetRefreshCounter(){this._currentRefreshId=-1}get refreshRate(){return this._refreshRate}set refreshRate(q){this._refreshRate=q,this.resetRefreshCounter()}shouldRender(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}isReadyForRendering(q,f){this.prepareRenderList(),this.initRender(q,f);const j=this._checkReadiness();return this.finishRender(),j}prepareRenderList(){const q=this._scene;if(this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(let f=0;f<this._waitingRenderList.length;f++){const j=this._waitingRenderList[f],d=q.getMeshById(j);d&&this.renderList.push(d)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];const q=this._scene.meshes;for(let f=0;f<q.length;f++){const j=q[f];this.renderListPredicate(j)&&this.renderList.push(j)}}this._currentApplyByPostProcessSetting=this._scene.imageProcessingConfiguration.applyByPostProcess,this._disableImageProcessing&&(this._scene.imageProcessingConfiguration._applyByPostProcess=this._disableImageProcessing)}initRender(q,f){const j=this._scene.getEngine(),d=this.activeCamera??this._scene.activeCamera;this._currentSceneCamera=this._scene.activeCamera,d&&(d!==this._scene.activeCamera&&(this._scene.setTransformMatrix(d.getViewMatrix(),d.getProjectionMatrix(!0)),this._scene.activeCamera=d),j.setViewport(d.rigParent?d.rigParent.viewport:d.viewport,q,f)),this._defaultRenderListPrepared=!1}finishRender(){const q=this._scene;this._disableImageProcessing&&(q.imageProcessingConfiguration._applyByPostProcess=this._currentApplyByPostProcessSetting),q.activeCamera=this._currentSceneCamera,this._currentSceneCamera&&(this.activeCamera&&this.activeCamera!==q.activeCamera&&q.setTransformMatrix(this._currentSceneCamera.getViewMatrix(),this._currentSceneCamera.getProjectionMatrix(!0)),q.getEngine().setViewport(this._currentSceneCamera.viewport)),q.resetCachedMaterial()}render(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const j=this._scene,d=j.getEngine(),g=d.currentRenderPassId;d.currentRenderPassId=this._renderPassIds[q],this.onBeforeRenderObservable.notifyObservers(q);if(d.snapshotRendering&&1===d.snapshotRenderingMode)this.onFastPathRenderObservable.notifyObservers(q);else{let f=null;const d=this.renderList?this.renderList:j.getActiveMeshes().data,g=this.renderList?this.renderList.length:j.getActiveMeshes().length;this.getCustomRenderList&&(f=this.getCustomRenderList(q,d,g)),f?this._prepareRenderingManager(f,f.length,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(d,g,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),f=d),this.onBeforeRenderingManagerRenderObservable.notifyObservers(q),this._renderingManager.render(this.customRenderFunction,f,this.renderParticles,this.renderSprites),this.onAfterRenderingManagerRenderObservable.notifyObservers(q)}f||this.onAfterRenderObservable.notifyObservers(q),d.currentRenderPassId=g}_checkReadiness(){const q=this._scene,f=q.getEngine(),j=f.currentRenderPassId;let d=!0;q.getViewMatrix()||q.updateTransformMatrix();const g=this.options.numPasses;for(let L=0;L<g&&d;L++){let j=null;const h=this.renderList?this.renderList:q.getActiveMeshes().data,Q=this.renderList?this.renderList.length:q.getActiveMeshes().length;f.currentRenderPassId=this._renderPassIds[L],this.onBeforeRenderObservable.notifyObservers(L),this.getCustomRenderList&&(j=this.getCustomRenderList(L,h,Q)),j||(j=h),this.options.doNotChangeAspectRatio||q.updateTransformMatrix(!0);for(let q=0;q<j.length&&d;++q){const f=j[q];if(f.isEnabled()&&!f.isBlocked&&f.isVisible&&f.Qd)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(f,this.refreshRate,!0)){d=!1;continue}}else if(!f.isReady(!0)){d=!1;continue}}this.onAfterRenderObservable.notifyObservers(L),g>1&&(q.incrementRenderId(),q.resetCachedMaterial())}const h=this.particleSystemList||q.ez;for(const L of h)L.isReady()||(d=!1);return f.currentRenderPassId=j,d}_prepareRenderingManager(q,f,j){const d=this._scene,g=d.activeCamera,h=this.cameraForLOD??g;this._renderingManager.reset();const L=d.getRenderId(),Q=d.getFrameId();for(let r=0;r<f;r++){const f=q[r];if(f&&!f.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(f,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!f.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}let q,H=null;if(h){const q=f._internalAbstractMeshDataInfo._currentLOD.get(h);q&&q[1]===Q?H=q[0]:(H=d.customLODSelector?d.customLODSelector(f,h):f.getLOD(h),q?(q[0]=H,q[1]=Q):f._internalAbstractMeshDataInfo._currentLOD.set(h,[H,Q]))}else H=f;if(!H)continue;if(H!==f&&0!==H.billboardMode&&H.Nf(),H._preActivateForIntermediateRendering(L),q=!(!j||!g)&&0===(f.layerMask&g.layerMask),f.isEnabled()&&f.isVisible&&f.Qd&&!q){if(H!==f&&H._activate(L,!0),f._activate(L,!0)&&f.Qd.length){f.isAnInstance?f._internalAbstractMeshDataInfo._actAsRegularMesh&&(H=f):H._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,H._internalAbstractMeshDataInfo._isActiveIntermediate=!0,d._prepareSkeleton(H);for(let q=0;q<H.Qd.length;q++){const f=H.Qd[q];this._renderingManager.dispatch(f,H)}}f._postActivate()}}}const H=this.particleSystemList||d.ez;for(let r=0;r<H.length;r++){const q=H[r],f=q.k;q.isStarted()&&f&&(!f.position||f.isEnabled())&&this._renderingManager.dispatchParticles(q)}}setRenderingOrder(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(q,f,j,d)}setRenderingAutoClearDepthStencil(q,f){let j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(q,f,j,d),this._renderingManager._useSceneAutoClearSetup=!1}clone(){const q=new z(this.name,this._scene,this.options);return this.renderList&&(q.renderList=this.renderList.slice(0)),q}dispose(){const q=this.renderList?this.renderList:this._scene.getActiveMeshes().data,f=this.renderList?this.renderList.length:this._scene.getActiveMeshes().length;for(let j=0;j<f;j++){const f=q[j];f&&void 0!==f.getMaterialForRenderPass(this.renderPassId)&&f.setMaterialForRenderPass(this.renderPassId,void 0)}this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderingManagerRenderObservable.clear(),this.onAfterRenderingManagerRenderObservable.clear(),this.onFastPathRenderObservable.clear(),this._releaseRenderPassId(),this.renderList=null}_rebuild(){this.refreshRate===z.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=z.REFRESHRATE_RENDER_ONCE)}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}}z.REFRESHRATE_RENDER_ONCE=0,z.REFRESHRATE_RENDER_ONEVERYFRAME=1,z.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,H.b.prototype.setDepthStencilTexture=function(q,f){this._engine.setDepthStencilTexture(this._samplers[q],this._uniforms[q],f,q)};class B extends h.e{get renderListPredicate(){return this._objectRenderer.renderListPredicate}set renderListPredicate(q){this._objectRenderer.renderListPredicate=q}get renderList(){return this._objectRenderer.renderList}set renderList(q){this._objectRenderer.renderList=q}get particleSystemList(){return this._objectRenderer.particleSystemList}set particleSystemList(q){this._objectRenderer.particleSystemList=q}get getCustomRenderList(){return this._objectRenderer.getCustomRenderList}set getCustomRenderList(q){this._objectRenderer.getCustomRenderList=q}get renderParticles(){return this._objectRenderer.renderParticles}set renderParticles(q){this._objectRenderer.renderParticles=q}get renderSprites(){return this._objectRenderer.renderSprites}set renderSprites(q){this._objectRenderer.renderSprites=q}get forceLayerMaskCheck(){return this._objectRenderer.forceLayerMaskCheck}set forceLayerMaskCheck(q){this._objectRenderer.forceLayerMaskCheck=q}get activeCamera(){return this._objectRenderer.activeCamera}set activeCamera(q){this._objectRenderer.activeCamera=q}get cameraForLOD(){return this._objectRenderer.cameraForLOD}set cameraForLOD(q){this._objectRenderer.cameraForLOD=q}get disableImageProcessing(){return this._objectRenderer.disableImageProcessing}set disableImageProcessing(q){this._objectRenderer.disableImageProcessing=q}get customIsReadyFunction(){return this._objectRenderer.customIsReadyFunction}set customIsReadyFunction(q){this._objectRenderer.customIsReadyFunction=q}get customRenderFunction(){return this._objectRenderer.customRenderFunction}set customRenderFunction(q){this._objectRenderer.customRenderFunction=q}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(q){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(q)}get onBeforeRenderObservable(){return this._objectRenderer.onBeforeRenderObservable}set onBeforeRender(q){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(q)}get onAfterRenderObservable(){return this._objectRenderer.onAfterRenderObservable}set onAfterRender(q){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(q)}set onClear(q){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(q)}get _waitingRenderList(){return this._objectRenderer._waitingRenderList}set _waitingRenderList(q){this._objectRenderer._waitingRenderList=q}get renderPassId(){return this._objectRenderer.renderPassId}get renderPassIds(){return this._objectRenderer.renderPassIds}get currentRefreshId(){return this._objectRenderer.currentRefreshId}setMaterialForRendering(q,f){this._objectRenderer.setMaterialForRendering(q,f)}get isMulti(){var q;return(null===(q=this._renderTarget)||void 0===q?void 0:q.isMulti)??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(q){if(this._boundingBoxSize&&this._boundingBoxSize.equals(q))return;this._boundingBoxSize=q;const f=this.eq();f&&f.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){var q;return(null===(q=this._renderTarget)||void 0===q?void 0:q._depthStencilTexture)??null}constructor(q,f,j){let L,Q,H=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,B=arguments.length>6&&void 0!==arguments[6]&&arguments[6],D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:h.e.TRILINEAR_SAMPLINGMODE,i=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],t=arguments.length>9&&void 0!==arguments[9]&&arguments[9],O=arguments.length>10&&void 0!==arguments[10]&&arguments[10],N=arguments.length>11&&void 0!==arguments[11]?arguments[11]:5,w=arguments.length>12&&void 0!==arguments[12]&&arguments[12],E=arguments.length>13?arguments[13]:void 0,s=arguments.length>14?arguments[14]:void 0,S=arguments.length>15&&void 0!==arguments[15]&&arguments[15],e=arguments.length>16&&void 0!==arguments[16]&&arguments[16],Z=!0;if("object"===typeof H){const q=H;H=!!q.generateMipMaps,u=q.doNotChangeAspectRatio??!0,X=q.type??0,B=!!q.isCube,D=q.samplingMode??h.e.TRILINEAR_SAMPLINGMODE,i=q.generateDepthBuffer??!0,t=!!q.generateStencilBuffer,O=!!q.isMulti,N=q.format??5,w=!!q.delayAllocation,E=q.samples,s=q.creationFlags,S=!!q.noColorAttachment,e=!!q.useSRGBBuffer,L=q.colorAttachment,Z=q.gammaSpace??Z,Q=q.existingObjectRenderer}if(super(null,j,!H,void 0,D,void 0,void 0,void 0,void 0,N),this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new d.d,this.onAfterUnbindObservable=new d.d,this.onClearObservable=new d.d,this.onResizeObservable=new d.d,this._cleared=!1,this.skipInitialClear=!1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this._dontDisposeObjectRenderer=!1,this.boundingBoxPosition=g.j.Zero(),this._disableEngineStages=!1,this._dumpToolsLoading=!1,!(j=this.eq()))return;const I=this.eq().getEngine();this._gammaSpace=Z,this._coordinatesMode=h.e.PROJECTION_MODE,this.name=q,this.isRenderTarget=!0,this._initialSizeParameter=f,this._dontDisposeObjectRenderer=!!Q,this._processSizeParameter(f),this._objectRenderer=Q??new z(q,j,{numPasses:B?6:this.getRenderLayers()||1,doNotChangeAspectRatio:u}),this._onBeforeRenderingManagerRenderObserver=this._objectRenderer.onBeforeRenderingManagerRenderObservable.add((()=>{if(!this._disableEngineStages)for(const q of this._scene._beforeRenderTargetClearStage)q.action(this,this._currentFaceIndex,this._currentLayer);if(this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(I):this.skipInitialClear||I.clear(this.clearColor||this._scene.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||this._scene.updateTransformMatrix(!0),!this._disableEngineStages)for(const q of this._scene._beforeRenderTargetDrawStage)q.action(this,this._currentFaceIndex,this._currentLayer)})),this._onAfterRenderingManagerRenderObserver=this._objectRenderer.onAfterRenderingManagerRenderObservable.add((()=>{var q;if(!this._disableEngineStages)for(const j of this._scene._afterRenderTargetDrawStage)j.action(this,this._currentFaceIndex,this._currentLayer);const f=(null===(q=this._texture)||void 0===q?void 0:q.generateMipMaps)??!1;if(this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,this._currentFaceIndex,this._postProcesses,this.ignoreCameraViewport):this._currentUseCameraPostProcess&&this._scene.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,this._currentFaceIndex),!this._disableEngineStages)for(const j of this._scene._afterRenderTargetPostProcessStage)j.action(this,this._currentFaceIndex,this._currentLayer);this._texture&&(this._texture.generateMipMaps=f),this._doNotChangeAspectRatio||this._scene.updateTransformMatrix(!0),this._currentDumpForDebug&&(this._dumpTools?this._dumpTools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),I):r.e.Error("dumpTools module is still being loaded. To speed up the process import dump tools directly in your project"))})),this._onFastPathRenderObserver=this._objectRenderer.onFastPathRenderObservable.add((()=>{this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(I):this.skipInitialClear||I.clear(this.clearColor||this._scene.clearColor,!0,!0,!0)})),this._resizeObserver=I.onResizeObservable.add((()=>{})),this._generateMipMaps=!!H,this._doNotChangeAspectRatio=u,O||(this._renderTargetOptions={generateMipMaps:H,type:X,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:i,generateStencilBuffer:t,samples:E,creationFlags:s,noColorAttachment:S,useSRGBBuffer:e,colorAttachment:L,label:this.name},this.samplingMode===h.e.NEAREST_SAMPLINGMODE&&(this.wrapU=h.e.CLAMP_ADDRESSMODE,this.wrapV=h.e.CLAMP_ADDRESSMODE),w||(B?(this._renderTarget=j.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=h.e.INVCUBIC_MODE,this._textureMatrix=g.b.Identity()):this._renderTarget=j.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==E&&(this.samples=E)))}createDepthStencilTexture(){var q;let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,L=arguments.length>5?arguments[5]:void 0;null===(q=this._renderTarget)||void 0===q||q.createDepthStencilTexture(f,j,d,g,h,L)}_processSizeParameter(q){if(q.ratio){this._sizeRatio=q.ratio;const f=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(f.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(f.getRenderHeight(),this._sizeRatio)}}else this._size=q}get samples(){var q;return(null===(q=this._renderTarget)||void 0===q?void 0:q.samples)??this._samples}set samples(q){this._renderTarget&&(this._samples=this._renderTarget.setSamples(q))}addPostProcess(q){if(!this._postProcessManager){const q=this.eq();if(!q)return;this._postProcessManager=new L.e(q),this._postProcesses=new Array}this._postProcesses.push(q),this._postProcesses[0].fz=!1}clearPostProcesses(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._postProcesses){if(q)for(const q of this._postProcesses)q.dispose();this._postProcesses=[]}}removePostProcess(q){if(!this._postProcesses)return;const f=this._postProcesses.indexOf(q);-1!==f&&(this._postProcesses.splice(f,1),this._postProcesses.length>0&&(this._postProcesses[0].fz=!1))}resetRefreshCounter(){this._objectRenderer.resetRefreshCounter()}get refreshRate(){return this._objectRenderer.refreshRate}set refreshRate(q){this._objectRenderer.refreshRate=q}_shouldRender(){return this._objectRenderer.shouldRender()}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){const q=this._size.layers;if(q)return q;const f=this._size.depth;return f||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(q){const f=Math.max(1,this.getRenderSize()*q);this.resize(f)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(q){var f;const j=this.isCube;null===(f=this._renderTarget)||void 0===f||f.dispose(),this._renderTarget=null;const d=this.eq();d&&(this._processSizeParameter(q),this._renderTarget=j?d.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):d.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._render(q,f)}isReadyForRendering(){this._dumpToolsLoading||(this._dumpToolsLoading=!0,Promise.resolve().then(j.bind(j,11476)).then((q=>this._dumpTools=q))),this._objectRenderer.prepareRenderList(),this.onBeforeBindObservable.notifyObservers(this),this._objectRenderer.initRender(this.getRenderWidth(),this.getRenderHeight());const q=this._objectRenderer._checkReadiness();return this.onAfterUnbindObservable.notifyObservers(this),this._objectRenderer.finishRender(),q}_render(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const j=this.eq();if(j){if(void 0!==this.useCameraPostProcesses&&(q=this.useCameraPostProcesses),this._objectRenderer.prepareRenderList(),this.onBeforeBindObservable.notifyObservers(this),this._objectRenderer.initRender(this.getRenderWidth(),this.getRenderHeight()),!this.is2DArray&&!this.is3D||this.isMulti)if(this.isCube&&!this.isMulti)for(let d=0;d<6;d++)this._renderToTarget(d,q,f),j.incrementRenderId(),j.resetCachedMaterial();else this._renderToTarget(0,q,f);else for(let d=0;d<this.getRenderLayers();d++)this._renderToTarget(0,q,f,d),j.incrementRenderId(),j.resetCachedMaterial();this.onAfterUnbindObservable.notifyObservers(this),this._objectRenderer.finishRender()}}_bestReflectionRenderTargetDimension(q,f){const j=q*f,d=(0,Q.o)(j+16384/(128+j));return Math.min((0,Q.c)(q),d)}_bindFrameBuffer(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const j=this.eq();if(!j)return;const d=j.getEngine();this._renderTarget&&d.bindFramebuffer(this._renderTarget,this.isCube?q:void 0,void 0,void 0,this.ignoreCameraViewport,0,f)}_unbindFrameBuffer(q,f){this._renderTarget&&q.unBindFramebuffer(this._renderTarget,this.isCube,(()=>{this.onAfterRenderObservable.notifyObservers(f)}))}_prepareFrame(q,f,j,d){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses)||this._bindFrameBuffer(f,j):d&&q.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(f,j)}_renderToTarget(q,f,j){var d,g;let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const L=this.eq();if(!L)return;const Q=L.getEngine();this._currentFaceIndex=q,this._currentLayer=h,this._currentUseCameraPostProcess=f,this._currentDumpForDebug=j,this._prepareFrame(L,q,h,f),null===(d=Q._debugPushGroup)||void 0===d||d.call(Q,`render to face #${q} layer #${h}`,2),this._objectRenderer.render(q+h,!0),null===(g=Q._debugPopGroup)||void 0===g||g.call(Q,2),this._unbindFrameBuffer(Q,q),this._texture&&this.isCube&&5===q&&Q.generateMipMapsForCubemap(this._texture,!0)}setRenderingOrder(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._objectRenderer.setRenderingOrder(q,f,j,d)}setRenderingAutoClearDepthStencil(q,f){this._objectRenderer.setRenderingAutoClearDepthStencil(q,f)}clone(){const q=this.getSize(),f=new B(this.name,q,this.eq(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return f.Rf=this.Rf,f.level=this.level,f.coordinatesMode=this.coordinatesMode,this.renderList&&(f.renderList=this.renderList.slice(0)),f}serialize(){if(!this.name)return null;const q=super.serialize();if(q.renderTargetSize=this.getRenderSize(),q.renderList=[],this.renderList)for(let f=0;f<this.renderList.length;f++)q.renderList.push(this.renderList[f].id);return q}disposeFramebufferObjects(){var q;null===(q=this._renderTarget)||void 0===q||q.dispose(!0)}releaseInternalTexture(){var q;null===(q=this._renderTarget)||void 0===q||q.releaseTextures(),this._texture=null}dispose(){var q;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._objectRenderer.onBeforeRenderingManagerRenderObservable.remove(this._onBeforeRenderingManagerRenderObserver),this._objectRenderer.onAfterRenderingManagerRenderObservable.remove(this._onAfterRenderingManagerRenderObserver),this._objectRenderer.onFastPathRenderObservable.remove(this._onFastPathRenderObserver),this._dontDisposeObjectRenderer||this._objectRenderer.dispose(),this.clearPostProcesses(!0),this._resizeObserver&&(this.eq().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null);const f=this.eq();if(!f)return;let j=f.customRenderTargets.indexOf(this);j>=0&&f.customRenderTargets.splice(j,1);for(const d of f.cameras)j=d.customRenderTargets.indexOf(this),j>=0&&d.customRenderTargets.splice(j,1);null===(q=this._renderTarget)||void 0===q||q.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this._objectRenderer._rebuild(),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._objectRenderer.freeRenderingGroups()}getViewCount(){return 1}}B.REFRESHRATE_RENDER_ONCE=z.REFRESHRATE_RENDER_ONCE,B.REFRESHRATE_RENDER_ONEVERYFRAME=z.REFRESHRATE_RENDER_ONEVERYFRAME,B.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=z.REFRESHRATE_RENDER_ONEVERYTWOFRAMES,h.e._CreateRenderTargetTexture=(q,f,j,d,g)=>new B(q,f,j,d)},11438:(q,f,j)=>{j.d(f,{e:()=>w});var d=j(11125),g=j(11130),h=j(10982),L=j(10941),Q=j(11417),H=j(10965),r=j(11016),u=j(11059),X=j(11102),z=j(11193),B=j(11044);function D(q,f){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const d=f.width,g=f.height;if(q instanceof Float32Array){let f=q.byteLength/q.BYTES_PER_ELEMENT;const j=new Uint8Array(f);for(;--f>=0;){let d=q[f];d<0?d=0:d>1&&(d=1),j[f]=255*d}q=j}const h=document.createElement("canvas");h.width=d,h.height=g;const L=h.getContext("2d");if(!L)return null;const Q=L.createImageData(d,g);if(Q.data.set(q),L.putImageData(Q,0,0),j){const q=document.createElement("canvas");q.width=d,q.height=g;const f=q.getContext("2d");return f?(f.translate(0,g),f.scale(1,-1),f.drawImage(h,0,0),q.toDataURL("image/png")):null}return h.toDataURL("image/png")}function i(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const d=q.getInternalTexture();if(!d)return null;const g=q._readPixelsSync(f,j);return g?D(g,q.getSize(),d.invertY):null}async function t(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const d=q.getInternalTexture();if(!d)return null;const g=await q.readPixels(f,j);return g?D(g,q.getSize(),d.invertY):null}var O=j(11316),N=j(11199);class w extends Q.b{static _CreateVideoTexture(q,f,j){arguments.length>5&&void 0!==arguments[5]||w.TRILINEAR_SAMPLINGMODE;throw(0,r.c)("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(q){this._isBlocking=q}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(q,f,j,d){let g,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:w.TRILINEAR_SAMPLINGMODE,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,X=arguments.length>8&&void 0!==arguments[8]&&arguments[8],z=arguments.length>9?arguments[9]:void 0,B=arguments.length>10?arguments[10]:void 0,D=arguments.length>11?arguments[11]:void 0,i=arguments.length>12?arguments[12]:void 0,t=arguments.length>13?arguments[13]:void 0;super(f),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new h.d,this._isBlocking=!0,this.name=q||"",this.url=q;let N=!1,E=null,s=!0;"object"===typeof j&&null!==j?(g=j.noMipmap??!1,d=j.invertY??!O.b,L=j.samplingMode??w.TRILINEAR_SAMPLINGMODE,Q=j.m??null,H=j.onError??null,r=j.buffer??null,X=j.deleteBuffer??!1,z=j.format,B=j.mimeType,D=j.loaderOptions,i=j.creationFlags,N=j.useSRGBBuffer??!1,E=j.internalTexture??null,s=j.gammaSpace??s,t=j.forcedExtension??t):g=!!j,this._gammaSpace=s,this._noMipmap=g,this._invertY=void 0===d?!O.b:d,this._initialSamplingMode=L,this._buffer=r,this._deleteBuffer=X,this._mimeType=B,this._loaderOptions=D,this._creationFlags=i,this._useSRGBBuffer=N,this._forcedExtension=t,void 0!==z&&(this._format=z);const S=this.eq(),e=this._getEngine();if(!e)return;e.onBeforeTextureInitObservable.notifyObservers(this);const Z=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),Q&&Q(),!this.isBlocking&&S&&S.resetCachedMaterial()},I=(q,f)=>{this._loadingError=!0,this._errorObject={message:q,exception:f},H&&H(q,f),w.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!E)return this._delayedOnLoad=Z,void(this._delayedOnError=I);if(this._texture=E??this._getFromCache(this.url,g,L,this._invertY,N,this.isCube),this._texture)if(this._texture.isReady)u.b.SetImmediate((()=>Z()));else{const q=this._texture.onLoadedObservable.add(Z);this._texture.onErrorObservable.add((f=>{var j;I(f.message,f.exception),null===(j=this._texture)||void 0===j||j.onLoadedObservable.remove(q)}))}else if(S&&S.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=Z,this._delayedOnError=I;else{try{this._texture=e.createTexture(this.url,g,this._invertY,S,L,Z,I,this._buffer,void 0,this._format,this._forcedExtension,B,D,i,N)}catch(T){throw I("error loading",T),T}X&&(this._buffer=null)}}updateURL(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2?arguments[2]:void 0,d=arguments.length>3?arguments[3]:void 0;this.url&&(this.releaseInternalTexture(),this.eq().markAllMaterialsAsDirty(1,(q=>q.hasTexture(this)))),this.name&&!this.name.startsWith("data:")||(this.name=q),this.url=q,this._buffer=f,this._forcedExtension=d,this.delayLoadState=4,j&&(this._delayedOnLoad=j),this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;const q=this.eq();q&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?u.b.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=q.getEngine().createTexture(this.url,this._noMipmap,this._invertY,q,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(q,f,j,d){q*=this._cachedUScale,f*=this._cachedVScale,q-=this.uRotationCenter*this._cachedUScale,f-=this.vRotationCenter*this._cachedVScale,j-=this.wRotationCenter,L.j.TransformCoordinatesFromFloatsToRef(q,f,j,this._rowGenerationMatrix,d),d.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,d.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,d.z+=this.wRotationCenter}getTextureMatrix(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*q===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*q,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=L.b.Zero(),this._rowGenerationMatrix=new L.b,this._t0=L.j.Zero(),this._t1=L.j.Zero(),this._t2=L.j.Zero()),L.b.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(L.b.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,L.f.Matrix[0]),L.b.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,L.f.Matrix[1]),L.b.ScalingToRef(this._cachedUScale,this._cachedVScale,0,L.f.Matrix[2]),L.b.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,L.f.Matrix[3]),L.f.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(L.f.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(L.f.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(L.f.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.eX(this._t0),this._t2.eX(this._t0),L.b.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const f=this.eq();if(!f)return this._cachedTextureMatrix;const j=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&j!==this._cachedIdentity3x2&&f.markAllMaterialsAsDirty(1,(q=>q.hasTexture(this))),this._cachedTextureMatrix}getReflectionTextureMatrix(){const q=this.eq();if(!q)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==w.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===q.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=L.b.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=L.b.Zero());const f=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case w.PLANAR_MODE:L.b.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case w.PROJECTION_MODE:{L.b.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const f=q.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=f.updateFlag,f.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:L.b.IdentityToRef(this._cachedReflectionTextureMatrix)}return f&&q.markAllMaterialsAsDirty(1,(q=>q.hasTexture(this))),this._cachedReflectionTextureMatrix}clone(){const q={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,m:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return N.d.Clone((()=>new w(this._texture?this._texture.url:null,this.eq(),q)),this)}serialize(){var q;const f=this.name;w.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const j=super.serialize(w._SerializeInternalTextureUniqueId);if(!j)return null;if(w.SerializeBuffers||w.ForceSerializeBuffers)if("string"===typeof this._buffer&&this._buffer.startsWith("data:"))j.base64String=this._buffer,j.name=j.name.replace("data:","");else if(this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array){const q=this.mimeType||"image/png";j.base64String=`data:${q};base64,${(0,B.n)(this._buffer)}`}else(w.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(j.base64String=!this._engine||this._engine._features.supportSyncTextureRead?i(this):t(this));var d;(j.invertY=this._invertY,j.samplingMode=this.samplingMode,j._creationFlags=this._creationFlags,j._useSRGBBuffer=this._useSRGBBuffer,w._SerializeInternalTextureUniqueId)&&(j.internalTextureUniqueId=null===(d=this._texture)||void 0===d?void 0:d.uniqueId);return j.internalTextureLabel=null===(q=this._texture)||void 0===q?void 0:q.label,j.noMipmap=this._noMipmap,this.name=f,j}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(q,f,j){if(q.customType){const d=X.b.Instantiate(q.customType).Parse(q,f,j);return q.samplingMode&&d.updateSamplingMode&&d._samplingMode&&d._samplingMode!==q.samplingMode&&d.updateSamplingMode(q.samplingMode),d}if(q.isCube&&!q.isRenderTarget)return w._CubeTextureParser(q,f,j);const d=void 0!==q.internalTextureUniqueId;if(!q.name&&!q.isRenderTarget&&!d)return null;let g;if(d){const j=f.getEngine().getLoadedTexturesCache();for(const f of j)if(f.uniqueId===q.internalTextureUniqueId){g=f;break}}const h=f=>{if(f&&f._texture&&(f._texture._cachedWrapU=null,f._texture._cachedWrapV=null,f._texture._cachedWrapR=null),q.samplingMode){const j=q.samplingMode;f&&f.samplingMode!==j&&f.updateSamplingMode(j)}if(f&&q.animations)for(let j=0;j<q.animations.length;j++){const d=q.animations[j],g=(0,H.c)("BABYLON.Animation");g&&f.animations.push(g.Parse(d))}f&&f._texture&&(d&&!g&&f._texture._setUniqueId(q.internalTextureUniqueId),f._texture.label=q.internalTextureLabel)};return N.d.Parse((()=>{let d=!0;if(q.noMipmap&&(d=!1),q.mirrorPlane){const j=w._CreateMirror(q.name,q.renderTargetSize,f,d);return j._waitingRenderList=q.renderList,j.mirrorPlane=z.e.Pf(q.mirrorPlane),h(j),j}if(q.isRenderTarget){let j=null;if(q.isCube){if(f.reflectionProbes)for(let d=0;d<f.reflectionProbes.length;d++){const j=f.reflectionProbes[d];if(j.name===q.name)return j.cubeTexture}}else j=w._CreateRenderTargetTexture(q.name,q.renderTargetSize,f,d,q._creationFlags??0),j._waitingRenderList=q.renderList;return h(j),j}if(q.isVideo){const g=w._CreateVideoTexture(j+(q.url||q.name),j+(q.src||q.url),f,d,q.invertY,q.samplingMode,q.settings||{});return h(g),g}{let L;if(q.base64String&&!g)L=w.CreateFromBase64String(q.base64String,q.base64String,f,!d,q.invertY,q.samplingMode,(()=>{h(L)}),q._creationFlags??0,q._useSRGBBuffer??!1),L.name=q.name;else{let Q;Q=q.name&&(q.name.indexOf("://")>0||q.name.startsWith("data:"))?q.name:j+q.name,q.url&&(q.url.startsWith("data:")||w.UseSerializedUrlIfAny)&&(Q=q.url);const H={noMipmap:!d,invertY:q.invertY,samplingMode:q.samplingMode,m:()=>{h(L)},internalTexture:g};L=new w(Q,f,H)}return L}}),q,f)}static CreateFromBase64String(q,f,j,d,g){let h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:w.TRILINEAR_SAMPLINGMODE;return new w("data:"+f,j,d,g,h,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,q,!1,arguments.length>8&&void 0!==arguments[8]?arguments[8]:5,void 0,void 0,arguments.length>9?arguments[9]:void 0,arguments.length>10?arguments[10]:void 0)}static LoadFromDataString(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],g=arguments.length>4?arguments[4]:void 0,h=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:w.TRILINEAR_SAMPLINGMODE,Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,H=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,r=arguments.length>9&&void 0!==arguments[9]?arguments[9]:5,u=arguments.length>10?arguments[10]:void 0,X=arguments.length>11?arguments[11]:void 0;return"data:"!==q.substring(0,5)&&(q="data:"+q),new w(q,j,g,h,L,Q,H,f,d,r,void 0,void 0,u,X)}}w.SerializeBuffers=!0,w.ForceSerializeBuffers=!1,w.OnTextureLoadErrorObservable=new h.d,w._SerializeInternalTextureUniqueId=!1,w._CubeTextureParser=(q,f,j)=>{throw(0,r.c)("CubeTexture")},w._CreateMirror=(q,f,j,d)=>{throw(0,r.c)("MirrorTexture")},w._CreateRenderTargetTexture=(q,f,j,d,g)=>{throw(0,r.c)("RenderTargetTexture")},w.NEAREST_SAMPLINGMODE=1,w.NEAREST_NEAREST_MIPLINEAR=8,w.BILINEAR_SAMPLINGMODE=2,w.LINEAR_LINEAR_MIPNEAREST=11,w.TRILINEAR_SAMPLINGMODE=3,w.LINEAR_LINEAR_MIPLINEAR=3,w.NEAREST_NEAREST_MIPNEAREST=4,w.NEAREST_LINEAR_MIPNEAREST=5,w.NEAREST_LINEAR_MIPLINEAR=6,w.NEAREST_LINEAR=7,w.NEAREST_NEAREST=1,w.LINEAR_NEAREST_MIPNEAREST=9,w.LINEAR_NEAREST_MIPLINEAR=10,w.LINEAR_LINEAR=2,w.LINEAR_NEAREST=12,w.EXPLICIT_MODE=0,w.SPHERICAL_MODE=1,w.PLANAR_MODE=2,w.CUBIC_MODE=3,w.PROJECTION_MODE=4,w.SKYBOX_MODE=5,w.INVCUBIC_MODE=6,w.EQUIRECTANGULAR_MODE=7,w.FIXED_EQUIRECTANGULAR_MODE=8,w.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,w.CLAMP_ADDRESSMODE=0,w.WRAP_ADDRESSMODE=1,w.MIRROR_ADDRESSMODE=2,w.UseSerializedUrlIfAny=!1,(0,d.b)([(0,g.O)()],w.prototype,"url",void 0),(0,d.b)([(0,g.O)()],w.prototype,"uOffset",void 0),(0,d.b)([(0,g.O)()],w.prototype,"vOffset",void 0),(0,d.b)([(0,g.O)()],w.prototype,"uScale",void 0),(0,d.b)([(0,g.O)()],w.prototype,"vScale",void 0),(0,d.b)([(0,g.O)()],w.prototype,"uAng",void 0),(0,d.b)([(0,g.O)()],w.prototype,"vAng",void 0),(0,d.b)([(0,g.O)()],w.prototype,"wAng",void 0),(0,d.b)([(0,g.O)()],w.prototype,"uRotationCenter",void 0),(0,d.b)([(0,g.O)()],w.prototype,"vRotationCenter",void 0),(0,d.b)([(0,g.O)()],w.prototype,"wRotationCenter",void 0),(0,d.b)([(0,g.O)()],w.prototype,"homogeneousRotationInUVTransform",void 0),(0,d.b)([(0,g.O)()],w.prototype,"isBlocking",null),(0,H.f)("BABYLON.Texture",w),N.d._TextureParser=w.Parse},11362:(q,f,j)=>{function d(q){return 13===q||14===q||15===q||16===q||17===q||18===q||19===q}function g(q){return 13===q||17===q||18===q||19===q}j.d(f,{c:()=>g,d:()=>d})},11093:(q,f,j)=>{j.d(f,{b:()=>d});class d{get wrapU(){return this._cachedWrapU}set wrapU(q){this._cachedWrapU=q}get wrapV(){return this._cachedWrapV}set wrapV(q){this._cachedWrapV=q}get wrapR(){return this._cachedWrapR}set wrapR(q){this._cachedWrapR=q}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(q){this._cachedAnisotropicFilteringLevel=q}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(q){this._comparisonFunction=q}get useMipMaps(){return this._useMipMaps}set useMipMaps(q){this._useMipMaps=q}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this._cachedWrapU=q,this._cachedWrapV=f,this._cachedWrapR=j,this._cachedAnisotropicFilteringLevel=d,this.samplingMode=g,this._comparisonFunction=h,this}compareSampler(q){return this._cachedWrapU===q._cachedWrapU&&this._cachedWrapV===q._cachedWrapV&&this._cachedWrapR===q._cachedWrapR&&this._cachedAnisotropicFilteringLevel===q._cachedAnisotropicFilteringLevel&&this.samplingMode===q.samplingMode&&this._comparisonFunction===q._comparisonFunction&&this._useMipMaps===q._useMipMaps}}},11236:(q,f,j)=>{function d(q){-1===q.indexOf("vClipPlane")&&q.push("vClipPlane"),-1===q.indexOf("vClipPlane2")&&q.push("vClipPlane2"),-1===q.indexOf("vClipPlane3")&&q.push("vClipPlane3"),-1===q.indexOf("vClipPlane4")&&q.push("vClipPlane4"),-1===q.indexOf("vClipPlane5")&&q.push("vClipPlane5"),-1===q.indexOf("vClipPlane6")&&q.push("vClipPlane6")}function g(q,f,j){const d=!!(q.clipPlane??f.clipPlane),g=!!(q.clipPlane2??f.clipPlane2),h=!!(q.clipPlane3??f.clipPlane3),L=!!(q.clipPlane4??f.clipPlane4),Q=!!(q.clipPlane5??f.clipPlane5),H=!!(q.clipPlane6??f.clipPlane6);d&&j.push("#define CLIPPLANE"),g&&j.push("#define CLIPPLANE2"),h&&j.push("#define CLIPPLANE3"),L&&j.push("#define CLIPPLANE4"),Q&&j.push("#define CLIPPLANE5"),H&&j.push("#define CLIPPLANE6")}function h(q,f,j){let d=!1;const g=!!(q.clipPlane??f.clipPlane),h=!!(q.clipPlane2??f.clipPlane2),L=!!(q.clipPlane3??f.clipPlane3),Q=!!(q.clipPlane4??f.clipPlane4),H=!!(q.clipPlane5??f.clipPlane5),r=!!(q.clipPlane6??f.clipPlane6);return j.CLIPPLANE!==g&&(j.CLIPPLANE=g,d=!0),j.CLIPPLANE2!==h&&(j.CLIPPLANE2=h,d=!0),j.CLIPPLANE3!==L&&(j.CLIPPLANE3=L,d=!0),j.CLIPPLANE4!==Q&&(j.CLIPPLANE4=Q,d=!0),j.CLIPPLANE5!==H&&(j.CLIPPLANE5=H,d=!0),j.CLIPPLANE6!==r&&(j.CLIPPLANE6=r,d=!0),d}function L(q,f,j){let d=f.clipPlane??j.clipPlane;Q(q,"vClipPlane",d),d=f.clipPlane2??j.clipPlane2,Q(q,"vClipPlane2",d),d=f.clipPlane3??j.clipPlane3,Q(q,"vClipPlane3",d),d=f.clipPlane4??j.clipPlane4,Q(q,"vClipPlane4",d),d=f.clipPlane5??j.clipPlane5,Q(q,"vClipPlane5",d),d=f.clipPlane6??j.clipPlane6,Q(q,"vClipPlane6",d)}function Q(q,f,j){j&&q.setFloat4(f,j.df.x,j.df.y,j.df.z,j.d)}j.d(f,{c:()=>d,f:()=>L,h:()=>h,k:()=>g})},11517:(q,f,j)=>{function d(q){q.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}j.d(f,{c:()=>d})},11345:(q,f,j)=>{function d(q){return void 0===q.getPipelineContext}j.d(f,{d:()=>d})},11186:(q,f,j)=>{j.d(f,{e:()=>g});var d=j(11059);class g{static GetEffect(q){return void 0===q.getPipelineContext?q.effect:q}constructor(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=q.createDrawContext(),f&&(this.materialContext=q.createMaterialContext())}setEffect(q,f){let j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var d;(this.effect=q,void 0!==f&&(this.defines=f),j)&&(null===(d=this.drawContext)||void 0===d||d.reset())}dispose(){var q;let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const q=this.effect;f?q.dispose():d.b.SetImmediate((()=>{q.getEngine().onEndFrameObservable.addOnce((()=>{q.dispose()}))})),this.effect=null}null===(q=this.drawContext)||void 0===q||q.dispose()}}},11082:(q,f,j)=>{j.d(f,{c:()=>X,e:()=>B,h:()=>r,l:()=>u});var d=j(10997),g=j(11084),h=j(11075),L=j(11005),Q=j(11048),H=j(11054);function r(q,f){return(0,g.F)(f).cachedPipelines[q]}function u(q){const f=q._name,j=q.context;if(f&&j){const q=(0,g.F)(j),d=q.cachedPipelines[f];null===d||void 0===d||d.dispose(),delete q.cachedPipelines[f]}}function X(q,f,j,g,h,L,H){let r,u;const X=(0,d.h)()?null===L||void 0===L?void 0:L.getHostDocument():null;r="string"===typeof f?f:f.vertexSource?"source:"+f.vertexSource:f.vertexElement?(null===X||void 0===X?void 0:X.getElementById(f.vertexElement))||f.vertexElement:f.vertex||f,u="string"===typeof f?f:f.fragmentSource?"source:"+f.fragmentSource:f.fragmentElement?(null===X||void 0===X?void 0:X.getElementById(f.fragmentElement))||f.fragmentElement:f.fragment||f;const B=[void 0,void 0],D=()=>{if(B[0]&&B[1]){q.isFragment=!0;const[d,r]=B;(0,Q.j)(r,q,((L,r)=>{H&&(H._fragmentSourceCodeBeforeMigration=r),j&&(L=j("fragment",L));const u=(0,Q.c)(d,L,q);q=null;const X=function(q,f,j,d){if(j){return{vertexSourceCode:(1===d?"//":"")+"#define SHADER_NAME vertex:"+(j.vertexElement||j.vertex||j.spectorName||j)+"\n"+q,fragmentSourceCode:(1===d?"//":"")+"#define SHADER_NAME fragment:"+(j.fragmentElement||j.fragment||j.spectorName||j)+"\n"+f}}return{vertexSourceCode:q,fragmentSourceCode:f}}(u.vertexCode,u.fragmentCode,f,h);null===g||void 0===g||g(X.vertexSourceCode,X.fragmentSourceCode)}),L)}};z(r,"Vertex","",(f=>{(0,Q.d)(q),(0,Q.j)(f,q,((q,d)=>{H&&(H._rawVertexSourceCode=f,H._vertexSourceCodeBeforeMigration=d),j&&(q=j("vertex",q)),B[0]=q,D()}),L)}),h),z(u,"Fragment","Pixel",(q=>{H&&(H._rawFragmentSourceCode=q),B[1]=q,D()}),h)}function z(q,f,j,g,L,Q){if("undefined"!==typeof HTMLElement&&q instanceof HTMLElement){return void g((0,d.b)(q))}if("source:"===q.substring(0,7))return void g(q.substring(7));if("base64:"===q.substring(0,7)){return void g(window.atob(q.substring(7)))}const r=h.b.GetShadersStore(L);if(r[q+f+"Shader"])return void g(r[q+f+"Shader"]);if(j&&r[q+j+"Shader"])return void g(r[q+j+"Shader"]);let u;if(u="."===q[0]||"/"===q[0]||q.indexOf("http")>-1?q:h.b.GetShadersRepository(L)+q,!(Q=Q||H.p))throw new Error("loadFileInjection is not defined");Q(u+"."+f.toLowerCase()+".fx",g)}const B=(q,f,j,d)=>{try{const h=q.context?(0,g.F)(q.context):null;h&&(h.disableParallelShaderCompile=q.disableParallelCompilation);const L=q.existingPipelineContext||f(q.shaderProcessingContext);return L._name=q.name,q.name&&h&&(h.cachedPipelines[q.name]=L),j(L,q.vertex,q.fragment,!!q.createAsRaw,"","",q.rebuildRebind,q.defines,q.transformFeedbackVaryings,"",(()=>{d(L,(()=>{var f;null===(f=q.onRenderingStateCompiled)||void 0===f||f.call(q,L)}))})),L}catch(h){throw L.e.Error("Error compiling effect"),h}}},11067:(q,f,j)=>{j.d(f,{b:()=>H});var d=j(10982),g=j(11005),h=j(11075),L=j(11082),Q=j(11059);class H{static get ShadersRepository(){return h.b.ShadersRepository}static set ShadersRepository(q){h.b.ShadersRepository=q}get B(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new d.d),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(q,f,j){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4?arguments[4]:void 0,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,X=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,z=arguments.length>9?arguments[9]:void 0,B=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",D=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,i=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new d.d,this.onErrorObservable=new d.d,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=q,this._key=B;const t=this._key.replace(/\r/g,"").replace(/\n/g,"|");let O;if(f.attributes){const q=f;if(this._engine=j,this._attributesNames=q.attributes,this._uniformsNames=q.uniformsNames.concat(q.samplers),this._samplerList=q.samplers.slice(),this.defines=q.defines,this.onError=q.onError,this.onCompiled=q.onCompiled,this._fallbacks=q.fallbacks,this._indexParameters=q.indexParameters,this._transformFeedbackVaryings=q.transformFeedbackVaryings||null,this._multiTarget=!!q.multiTarget,this._shaderLanguage=q.shaderLanguage??0,this._disableParallelShaderCompilation=!!q.disableParallelShaderCompilation,q.uniformBuffersNames){this._uniformBuffersNamesList=q.uniformBuffersNames.slice();for(let f=0;f<q.uniformBuffersNames.length;f++)this._uniformBuffersNames[q.uniformBuffersNames[f]]=f}this._processFinalCode=q.processFinalCode??null,this._processCodeAfterIncludes=q.processCodeAfterIncludes??void 0,i=q.extraInitializationsAsync,O=q.existingPipelineContext}else this._engine=h,this.defines=null==Q?"":Q,this._uniformsNames=j.concat(g),this._samplerList=g?g.slice():[],this._attributesNames=f,this._uniformBuffersNamesList=[],this._shaderLanguage=D,this.onError=X,this.onCompiled=u,this._indexParameters=z,this._fallbacks=r;"WEBGL2"===this._engine.shaderPlatformName&&(O=(0,L.h)(t,this._engine._gl)??O),this._attributeLocationByName={},this.uniqueId=H._UniqueIdSeed++,O?(this._pipelineContext=O,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,i),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.B||this.dispose(!0)}))}async _processShaderCodeAsync(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3?arguments[3]:void 0;d&&await d(),this._processingContext=j||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const g={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:q??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:h.b.GetShadersRepository(this._shaderLanguage),includesShadersStore:h.b.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,L.c)(g,this.name,this._processFinalCode,((q,j)=>{this._vertexSourceCode=q,this._fragmentSourceCode=j,this._prepareEffect(f)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.B||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(q){return this._attributes[q]}getAttributeLocationByName(q){return this._attributeLocationByName[q]}getAttributesCount(){return this._attributes.length}getUniformIndex(q){return this._uniformsNames.indexOf(q)}getUniform(q){return this._uniforms[q]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((q=>{this.executeWhenCompiled(q)}))}executeWhenCompiled(q){this.isReady()?q(this):(this.onCompileObservable.add((f=>{q(f)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(q){(0,Q.d)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(f=>{this._processCompilationErrors(f,q)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var q;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(q=this._pipelineContext)||void 0===q?void 0:q._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var q;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(q=this._pipelineContext)||void 0===q?void 0:q._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(q,f,j,d){this._isReady=!1,this._vertexSourceCodeOverride=q,this._fragmentSourceCodeOverride=f,this.onError=(q,f)=>{d&&d(f)},this.onCompiled=()=>{var q,f;const d=this.getEngine().scenes;if(d)for(let j=0;j<d.length;j++)d[j].markAllMaterialsAsDirty(127);null===(q=(f=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===q||q.call(f,j)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(q){if(this._pipelineContext=q,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let f=0;f<this._attributesNames.length;f++){const q=this._attributesNames[f];this._attributeLocationByName[q]=this._attributes[f]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),H.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const f=this._pipelineContext;this._isReady=!1;try{const j=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),d=j?null:this.defines,g=j?this._vertexSourceCodeOverride:this._vertexSourceCode,h=j?this._fragmentSourceCodeOverride:this._fragmentSourceCode,Q=this._engine;this._pipelineContext=(0,L.e)({existingPipelineContext:q?f:null,vertex:g,fragment:h,context:"WEBGL2"===Q.shaderPlatformName||"WEBGL1"===Q.shaderPlatformName?Q._gl:void 0,rebuildRebind:(q,f,j,d)=>this._rebuildProgram(q,f,j,d),defines:d,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:j,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:j=>{f&&!q&&this._engine._deletePipelineContext(f),j&&this._onRenderingStateCompiled(j)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(f)}catch(j){this._processCompilationErrors(j,f)}}_getShaderCodeAndErrorLine(q,f,j){const d=j?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let g=null;if(f&&q){const h=f.match(d);if(h&&2===h.length){const f=parseInt(h[1]),d=q.split("\n",-1);d.length>=f&&(g=`Offending line [${f}] in ${j?"fragment":"vertex"} code: ${d[f-1]}`)}}return[q,g]}_processCompilationErrors(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=q.message;const j=this._attributesNames,d=this._fallbacks;if(g.e.Error("Unable to compile effect:"),g.e.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),g.e.Error(`Attributes: ${j.join(" ")}`),g.e.Error("Defines:\n"+this.defines),H.LogShaderCodeOnCompilationError){var h,L;let q=null,f=null,j=null;var Q;if(null!==(h=this._pipelineContext)&&void 0!==h&&h._getVertexShaderCode()&&([j,q]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),j&&(g.e.Error("Vertex code:"),g.e.Error(j))),null!==(L=this._pipelineContext)&&void 0!==L&&L._getFragmentShaderCode())[j,f]=this._getShaderCodeAndErrorLine(null===(Q=this._pipelineContext)||void 0===Q?void 0:Q._getFragmentShaderCode(),this._compilationError,!0),j&&(g.e.Error("Fragment code:"),g.e.Error(j));q&&g.e.Error(q),f&&g.e.Error(f)}g.e.Error("Error: "+this._compilationError);const r=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};f&&(this._pipelineContext=f,this._isReady=!0,r()),d?(this._pipelineContext=null,d.hasMoreFallbacks?(this._allFallbacksProcessed=!1,g.e.Error("Trying next fallback."),this.defines=d.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,r(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,f||r())}get isSupported(){return""===this._compilationError}_bindTexture(q,f){this._engine._bindTexture(this._samplers[q],f,q)}setTexture(q,f){this._engine.setTexture(this._samplers[q],this._uniforms[q],f,q)}setTextureArray(q,f){const j=q+"Ex";if(-1===this._samplerList.indexOf(j+"0")){const d=this._samplerList.indexOf(q);for(let q=1;q<f.length;q++){const f=j+(q-1).toString();this._samplerList.splice(d+q,0,f)}let g=0;for(const q of this._samplerList)this._samplers[q]=g,g+=1}this._engine.setTextureArray(this._samplers[q],this._uniforms[q],f,q)}bindUniformBuffer(q,f){const j=this._uniformBuffersNames[f];void 0===j||H._BaseCache[j]===q&&this._engine._features.useUBOBindingCache||(H._BaseCache[j]=q,this._engine.bindUniformBufferBase(q,j,f))}bindUniformBlock(q,f){this._engine.bindUniformBlock(this._pipelineContext,q,f)}setInt(q,f){return this._pipelineContext.setInt(q,f),this}setInt2(q,f,j){return this._pipelineContext.setInt2(q,f,j),this}setInt3(q,f,j,d){return this._pipelineContext.setInt3(q,f,j,d),this}setInt4(q,f,j,d,g){return this._pipelineContext.setInt4(q,f,j,d,g),this}setIntArray(q,f){return this._pipelineContext.setIntArray(q,f),this}setIntArray2(q,f){return this._pipelineContext.setIntArray2(q,f),this}setIntArray3(q,f){return this._pipelineContext.setIntArray3(q,f),this}setIntArray4(q,f){return this._pipelineContext.setIntArray4(q,f),this}setUInt(q,f){return this._pipelineContext.setUInt(q,f),this}setUInt2(q,f,j){return this._pipelineContext.setUInt2(q,f,j),this}setUInt3(q,f,j,d){return this._pipelineContext.setUInt3(q,f,j,d),this}setUInt4(q,f,j,d,g){return this._pipelineContext.setUInt4(q,f,j,d,g),this}setUIntArray(q,f){return this._pipelineContext.setUIntArray(q,f),this}setUIntArray2(q,f){return this._pipelineContext.setUIntArray2(q,f),this}setUIntArray3(q,f){return this._pipelineContext.setUIntArray3(q,f),this}setUIntArray4(q,f){return this._pipelineContext.setUIntArray4(q,f),this}setFloatArray(q,f){return this._pipelineContext.setArray(q,f),this}setFloatArray2(q,f){return this._pipelineContext.setArray2(q,f),this}setFloatArray3(q,f){return this._pipelineContext.setArray3(q,f),this}setFloatArray4(q,f){return this._pipelineContext.setArray4(q,f),this}setArray(q,f){return this._pipelineContext.setArray(q,f),this}setArray2(q,f){return this._pipelineContext.setArray2(q,f),this}setArray3(q,f){return this._pipelineContext.setArray3(q,f),this}setArray4(q,f){return this._pipelineContext.setArray4(q,f),this}setMatrices(q,f){return this._pipelineContext.setMatrices(q,f),this}setMatrix(q,f){return this._pipelineContext.setMatrix(q,f),this}setMatrix3x3(q,f){return this._pipelineContext.setMatrix3x3(q,f),this}setMatrix2x2(q,f){return this._pipelineContext.setMatrix2x2(q,f),this}setFloat(q,f){return this._pipelineContext.setFloat(q,f),this}setBool(q,f){return this._pipelineContext.setInt(q,f?1:0),this}setVector2(q,f){return this._pipelineContext.setVector2(q,f),this}setFloat2(q,f,j){return this._pipelineContext.setFloat2(q,f,j),this}setVector3(q,f){return this._pipelineContext.setVector3(q,f),this}setFloat3(q,f,j,d){return this._pipelineContext.setFloat3(q,f,j,d),this}setVector4(q,f){return this._pipelineContext.setVector4(q,f),this}setQuaternion(q,f){return this._pipelineContext.setQuaternion(q,f),this}setFloat4(q,f,j,d,g){return this._pipelineContext.setFloat4(q,f,j,d,g),this}setColor3(q,f){return this._pipelineContext.setColor3(q,f),this}setColor4(q,f,j){return this._pipelineContext.setColor4(q,f,j),this}setDirectColor4(q,f){return this._pipelineContext.setDirectColor4(q,f),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(H.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,L.l)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;f&&(h.b.GetShadersStore(d)[`${q}PixelShader`]=f),j&&(h.b.GetShadersStore(d)[`${q}VertexShader`]=j)}static ResetCache(){H._BaseCache={}}}H.LogShaderCodeOnCompilationError=!0,H.PersistentMode=!1,H.AutomaticallyClearCodeCache=!1,H._UniqueIdSeed=0,H._BaseCache={},H.ShadersStore=h.b.ShadersStore,H.IncludesShadersStore=h.b.IncludesShadersStore},11588:(q,f,j)=>{j.d(f,{d:()=>d});class d{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(q,f){this._defines[q]||(q<this._currentRank&&(this._currentRank=q),q>this._maxRank&&(this._maxRank=q),this._defines[q]=new Array),this._defines[q].push(f)}addCPUSkinningFallback(q,f){this._mesh=f,q<this._currentRank&&(this._currentRank=q),q>this._maxRank&&(this._maxRank=q)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(q,f){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,q=q.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),f._bonesComputationForcedToCPU=!0;const j=this._mesh.eq();for(let q=0;q<j.meshes.length;q++){const d=j.meshes[q];if(d.material){if(d.computeBonesUsingShaders&&0!==d.numBoneInfluencers)if(d.material.getEffect()===f)d.computeBonesUsingShaders=!1;else if(d.Qd)for(const q of d.Qd){if(q.effect===f){d.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&d.computeBonesUsingShaders&&d.numBoneInfluencers>0&&(d.computeBonesUsingShaders=!1)}}else{const f=this._defines[this._currentRank];if(f)for(let j=0;j<f.length;j++)q=q.replace("#define "+f[j],"");this._currentRank++}return q}}},11462:(q,f,j)=>{j.d(f,{b:()=>r,f:()=>u});var d=j(11151),g=j(11300),h=j(10982),L=j(11067),Q=j(11186);j(11465);const H={Iq:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class r{constructor(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:H;this._fullscreenViewport=new g.e(0,0,1,1);const j=f.Iq??H.Iq,h=f.indices??H.indices;this.gH=q,this._vertexBuffers={[d.i.PositionKind]:new d.i(q,j,d.i.PositionKind,!1,!1,2)},this._indexBuffer=q.createIndexBuffer(h),this._indexBufferLength=h.length,this._onContextRestoredObserver=q.onContextRestoredObservable.add((()=>{this._indexBuffer=q.createIndexBuffer(h);for(const q in this._vertexBuffers){this._vertexBuffers[q]._rebuild()}}))}setViewport(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._fullscreenViewport;this.gH.setViewport(q)}bindBuffers(q){this.gH.bindBuffers(this._vertexBuffers,this._indexBuffer,q)}applyEffectWrapper(q){this.gH.setState(!0),this.gH.depthCullingState.depthTest=!1,this.gH.stencilState.stencilTest=!1,this.gH.enableEffect(q.drawWrapper),this.bindBuffers(q.effect),q.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.gH.depthCullingState.depthTest,this._savedStateStencilTest=this.gH.stencilState.stencilTest}restoreStates(){this.gH.depthCullingState.depthTest=this._savedStateDepthTest,this.gH.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.gH.drawElementsType(0,0,this._indexBufferLength)}_isRenderTargetTexture(q){return void 0!==q.renderTarget}render(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!q.effect.isReady())return;this.saveStates(),this.setViewport();const j=null===f?null:this._isRenderTargetTexture(f)?f.renderTarget:f;j&&this.gH.bindFramebuffer(j),this.applyEffectWrapper(q),this.draw(),j&&this.gH.unBindFramebuffer(j),this.restoreStates()}dispose(){const q=this._vertexBuffers[d.i.PositionKind];q&&(q.dispose(),delete this._vertexBuffers[d.i.PositionKind]),this._indexBuffer&&this.gH._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.gH.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class u{static RegisterShaderCodeProcessing(q,f){f?u._CustomShaderCodeProcessing[q??""]=f:delete u._CustomShaderCodeProcessing[q??""]}static _GetShaderCodeProcessing(q){return u._CustomShaderCodeProcessing[q]??u._CustomShaderCodeProcessing[""]}get name(){return this.options.name}set name(q){this.options.name=q}isReady(){var q;return(null===(q=this._drawWrapper.effect)||void 0===q?void 0:q.isReady())??!1}get drawWrapper(){return this._drawWrapper}get effect(){return this._drawWrapper.effect}set effect(q){this._drawWrapper.effect=q}constructor(q){this.alphaMode=0,this.onEffectCreatedObservable=new h.d(void 0,!0),this.onApplyObservable=new h.d,this._shadersLoaded=!1,this._webGPUReady=!1,this._importPromises=[],this.options={...q,name:q.name||"effectWrapper",gH:q.gH,uniforms:q.uniforms||q.uniformNames||[],uniformNames:void 0,samplers:q.samplers||q.samplerNames||[],samplerNames:void 0,attributeNames:q.attributeNames||["position"],uniformBuffers:q.uniformBuffers||[],defines:q.defines||"",useShaderStore:q.useShaderStore||!1,vertexUrl:q.vertexUrl||q.vertexShader||"postprocess",vertexShader:void 0,fragmentShader:q.fragmentShader||"pass",indexParameters:q.indexParameters,blockCompilation:q.blockCompilation||!1,shaderLanguage:q.shaderLanguage||0,onCompiled:q.onCompiled||void 0,extraInitializations:q.extraInitializations||void 0,extraInitializationsAsync:q.extraInitializationsAsync||void 0,useAsPostProcess:q.useAsPostProcess??!1},this.options.uniformNames=this.options.uniforms,this.options.samplerNames=this.options.samplers,this.options.vertexShader=this.options.vertexUrl,this.options.useAsPostProcess&&(-1===this.options.samplers.indexOf("textureSampler")&&this.options.samplers.push("textureSampler"),-1===this.options.uniforms.indexOf("scale")&&this.options.uniforms.push("scale")),q.vertexUrl||q.vertexShader?this._shaderPath={vertexSource:this.options.vertexShader}:(this.options.useAsPostProcess||(this.options.uniforms.push("scale"),this.onApplyObservable.add((()=>{this.effect.setFloat2("scale",1,1)}))),this._shaderPath={vertex:this.options.vertexShader}),this._shaderPath.fragmentSource=this.options.fragmentShader,this._shaderPath.spectorName=this.options.name,this.options.useShaderStore&&(this._shaderPath.fragment=this._shaderPath.fragmentSource,this._shaderPath.vertex||(this._shaderPath.vertex=this._shaderPath.vertexSource),delete this._shaderPath.fragmentSource,delete this._shaderPath.vertexSource),this.onApplyObservable.add((()=>{this.bind()})),this.options.useShaderStore||(this._onContextRestoredObserver=this.options.gH.onContextRestoredObservable.add((()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()}))),this._drawWrapper=new Q.e(this.options.gH),this._webGPUReady=1===this.options.shaderLanguage;const f=Array.isArray(this.options.defines)?this.options.defines.join("\n"):this.options.defines;this._postConstructor(this.options.blockCompilation,f,this.options.extraInitializations)}_gatherImports(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1?arguments[1]:void 0;this.options.useAsPostProcess&&(q&&this._webGPUReady?f.push(Promise.all([j.e(42).then(j.bind(j,13503))])):f.push(Promise.all([Promise.resolve().then(j.bind(j,11465))])))}_postConstructor(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2?arguments[2]:void 0,d=arguments.length>3?arguments[3]:void 0;this._importPromises.length=0,d&&this._importPromises.push(...d);const g=this.options.gH.isWebGPU&&!u.ForceGLSL;this._gatherImports(g,this._importPromises),void 0!==j&&j(g,this._importPromises),g&&this._webGPUReady&&(this.options.shaderLanguage=1),q||this.updateEffect(f)}updateEffect(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3?arguments[3]:void 0,g=arguments.length>4?arguments[4]:void 0,h=arguments.length>5?arguments[5]:void 0,Q=arguments.length>6?arguments[6]:void 0,H=arguments.length>7?arguments[7]:void 0;const r=u._GetShaderCodeProcessing(this.name);if(null!==r&&void 0!==r&&r.defineCustomBindings){var X,z;const d=(null===(X=f)||void 0===X?void 0:X.slice())??[];d.push(...this.options.uniforms);const g=(null===(z=j)||void 0===z?void 0:z.slice())??[];g.push(...this.options.samplers),q=r.defineCustomBindings(this.name,q,d,g),f=d,j=g}this.options.defines=q||"";const B=this._shadersLoaded||0===this._importPromises.length?void 0:async()=>{await Promise.all(this._importPromises),this._shadersLoaded=!0};let D;D=this.options.extraInitializationsAsync?async()=>{null===B||void 0===B||B(),await this.options.extraInitializationsAsync()}:B,this.options.useShaderStore?this._drawWrapper.effect=this.options.gH.createEffect({vertex:Q??this._shaderPath.vertex,fragment:H??this._shaderPath.fragment},{attributes:this.options.attributeNames,uniformsNames:f||this.options.uniforms,uniformBuffersNames:this.options.uniformBuffers,samplers:j||this.options.samplers,defines:null!==q?q:"",fallbacks:null,onCompiled:g??this.options.onCompiled,onError:h??null,indexParameters:d||this.options.indexParameters,processCodeAfterIncludes:null!==r&&void 0!==r&&r.processCodeAfterIncludes?(q,f)=>r.processCodeAfterIncludes(this.name,q,f):null,processFinalCode:null!==r&&void 0!==r&&r.processFinalCode?(q,f)=>r.processFinalCode(this.name,q,f):null,shaderLanguage:this.options.shaderLanguage,extraInitializationsAsync:D},this.options.gH):this._drawWrapper.effect=new L.b(this._shaderPath,this.options.attributeNames,f||this.options.uniforms,j||this.options.samplerNames,this.options.gH,q,void 0,g||this.options.onCompiled,void 0,void 0,void 0,this.options.shaderLanguage,D),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)}bind(){var q,f;let j=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.options.useAsPostProcess&&!j&&(this.options.gH.setAlphaMode(this.alphaMode),this.drawWrapper.effect.setFloat2("scale",1,1)),null===(q=u._GetShaderCodeProcessing(this.name))||void 0===q||null===(f=q.bindCustomBindings)||void 0===f||f.call(q,this.name,this._drawWrapper.effect)}dispose(){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.onEffectCreatedObservable.clear(),this._drawWrapper.dispose(!0)}}u.ForceGLSL=!1,u._CustomShaderCodeProcessing={}},11521:(q,f,j)=>{j.d(f,{c:()=>h,f:()=>g});var d=j(11517);function g(q,f){f.EXPOSURE&&q.push("exposureLinear"),f.CONTRAST&&q.push("contrast"),f.COLORGRADING&&q.push("colorTransformSettings"),(f.VIGNETTE||f.DITHER)&&q.push("vInverseScreenSize"),f.VIGNETTE&&(q.push("vignetteSettings1"),q.push("vignetteSettings2")),f.COLORCURVES&&(0,d.c)(q),f.DITHER&&q.push("ditherIntensity")}function h(q,f){f.COLORGRADING&&q.push("txColorTransform")}},11515:(q,f,j)=>{j.d(f,{c:()=>B});var d=j(11125),g=j(11130),h=j(10982),L=j(11210),Q=j(11199),H=j(11517);class r{constructor(){this._dirty=!0,this._tempColor=new L.e(0,0,0,0),this._globalCurve=new L.e(0,0,0,0),this._highlightsCurve=new L.e(0,0,0,0),this._midtonesCurve=new L.e(0,0,0,0),this._shadowsCurve=new L.e(0,0,0,0),this._positiveCurve=new L.e(0,0,0,0),this._negativeCurve=new L.e(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get globalHue(){return this._globalHue}set globalHue(q){this._globalHue=q,this._dirty=!0}get globalDensity(){return this._globalDensity}set globalDensity(q){this._globalDensity=q,this._dirty=!0}get globalSaturation(){return this._globalSaturation}set globalSaturation(q){this._globalSaturation=q,this._dirty=!0}get globalExposure(){return this._globalExposure}set globalExposure(q){this._globalExposure=q,this._dirty=!0}get highlightsHue(){return this._highlightsHue}set highlightsHue(q){this._highlightsHue=q,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}set highlightsDensity(q){this._highlightsDensity=q,this._dirty=!0}get highlightsSaturation(){return this._highlightsSaturation}set highlightsSaturation(q){this._highlightsSaturation=q,this._dirty=!0}get highlightsExposure(){return this._highlightsExposure}set highlightsExposure(q){this._highlightsExposure=q,this._dirty=!0}get midtonesHue(){return this._midtonesHue}set midtonesHue(q){this._midtonesHue=q,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesDensity(q){this._midtonesDensity=q,this._dirty=!0}get midtonesSaturation(){return this._midtonesSaturation}set midtonesSaturation(q){this._midtonesSaturation=q,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set midtonesExposure(q){this._midtonesExposure=q,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set shadowsHue(q){this._shadowsHue=q,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set shadowsDensity(q){this._shadowsDensity=q,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}set shadowsSaturation(q){this._shadowsSaturation=q,this._dirty=!0}get shadowsExposure(){return this._shadowsExposure}set shadowsExposure(q){this._shadowsExposure=q,this._dirty=!0}getClassName(){return"ColorCurves"}static Bind(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vCameraColorCurvePositive",d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vCameraColorCurveNeutral",g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"vCameraColorCurveNegative";q._dirty&&(q._dirty=!1,q._getColorGradingDataToRef(q._globalHue,q._globalDensity,q._globalSaturation,q._globalExposure,q._globalCurve),q._getColorGradingDataToRef(q._highlightsHue,q._highlightsDensity,q._highlightsSaturation,q._highlightsExposure,q._tempColor),q._tempColor.multiplyToRef(q._globalCurve,q._highlightsCurve),q._getColorGradingDataToRef(q._midtonesHue,q._midtonesDensity,q._midtonesSaturation,q._midtonesExposure,q._tempColor),q._tempColor.multiplyToRef(q._globalCurve,q._midtonesCurve),q._getColorGradingDataToRef(q._shadowsHue,q._shadowsDensity,q._shadowsSaturation,q._shadowsExposure,q._tempColor),q._tempColor.multiplyToRef(q._globalCurve,q._shadowsCurve),q._highlightsCurve.subtractToRef(q._midtonesCurve,q._positiveCurve),q._midtonesCurve.subtractToRef(q._shadowsCurve,q._negativeCurve)),f&&(f.setFloat4(j,q._positiveCurve.r,q._positiveCurve.g,q._positiveCurve.b,q._positiveCurve.a),f.setFloat4(d,q._midtonesCurve.r,q._midtonesCurve.g,q._midtonesCurve.b,q._midtonesCurve.a),f.setFloat4(g,q._negativeCurve.r,q._negativeCurve.g,q._negativeCurve.b,q._negativeCurve.a))}_getColorGradingDataToRef(q,f,j,d,g){null!=q&&(q=r._Clamp(q,0,360),f=r._Clamp(f,-100,100),j=r._Clamp(j,-100,100),d=r._Clamp(d,-100,100),f=r._ApplyColorGradingSliderNonlinear(f),f*=.5,d=r._ApplyColorGradingSliderNonlinear(d),f<0&&(f*=-1,q=(q+180)%360),r._FromHSBToRef(q,f,50+.25*d,g),g.scaleToRef(2,g),g.a=1+.01*j)}static _ApplyColorGradingSliderNonlinear(q){q/=100;let f=Math.abs(q);return f=Math.pow(f,2),q<0&&(f*=-1),f*=100,f}static _FromHSBToRef(q,f,j,d){let g=r._Clamp(q,0,360);const h=r._Clamp(f/100,0,1),L=r._Clamp(j/100,0,1);if(0===h)d.r=L,d.g=L,d.b=L;else{g/=60;const q=Math.floor(g),f=g-q,j=L*(1-h),Q=L*(1-h*f),H=L*(1-h*(1-f));switch(q){case 0:d.r=L,d.g=H,d.b=j;break;case 1:d.r=Q,d.g=L,d.b=j;break;case 2:d.r=j,d.g=L,d.b=H;break;case 3:d.r=j,d.g=Q,d.b=L;break;case 4:d.r=H,d.g=j,d.b=L;break;default:d.r=L,d.g=j,d.b=Q}}d.a=1}static _Clamp(q,f,j){return Math.min(Math.max(q,f),j)}clone(){return Q.d.Clone((()=>new r),this)}serialize(){return Q.d.Serialize(this)}static Parse(q){return Q.d.Parse((()=>new r),q,null,null)}}r.PrepareUniforms=H.c,(0,d.b)([(0,g.O)()],r.prototype,"_globalHue",void 0),(0,d.b)([(0,g.O)()],r.prototype,"_globalDensity",void 0),(0,d.b)([(0,g.O)()],r.prototype,"_globalSaturation",void 0),(0,d.b)([(0,g.O)()],r.prototype,"_globalExposure",void 0),(0,d.b)([(0,g.O)()],r.prototype,"_highlightsHue",void 0),(0,d.b)([(0,g.O)()],r.prototype,"_highlightsDensity",void 0),(0,d.b)([(0,g.O)()],r.prototype,"_highlightsSaturation",void 0),(0,d.b)([(0,g.O)()],r.prototype,"_highlightsExposure",void 0),(0,d.b)([(0,g.O)()],r.prototype,"_midtonesHue",void 0),(0,d.b)([(0,g.O)()],r.prototype,"_midtonesDensity",void 0),(0,d.b)([(0,g.O)()],r.prototype,"_midtonesSaturation",void 0),(0,d.b)([(0,g.O)()],r.prototype,"_midtonesExposure",void 0),Q.d._ColorCurvesParser=r.Parse;var u=j(11114),X=j(11521),z=j(10965);class B{constructor(){this.colorCurves=new r,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=B.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new L.e(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=B.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.outputTextureWidth=0,this.outputTextureHeight=0,this.onUpdateParameters=new h.d}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(q){this._colorCurvesEnabled!==q&&(this._colorCurvesEnabled=q,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(q){this._colorGradingTexture!==q&&(this._colorGradingTexture=q,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(q){this._colorGradingEnabled!==q&&(this._colorGradingEnabled=q,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(q){this._colorGradingWithGreenDepth!==q&&(this._colorGradingWithGreenDepth=q,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(q){this._colorGradingBGR!==q&&(this._colorGradingBGR=q,this._updateParameters())}get exposure(){return this._exposure}set exposure(q){this._exposure!==q&&(this._exposure=q,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(q){this._toneMappingEnabled!==q&&(this._toneMappingEnabled=q,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(q){this._toneMappingType!==q&&(this._toneMappingType=q,this._updateParameters())}get contrast(){return this._contrast}set contrast(q){this._contrast!==q&&(this._contrast=q,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(q){this.vignetteCenterY=q}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(q){this.vignetteCenterX=q}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(q){this._vignetteBlendMode!==q&&(this._vignetteBlendMode=q,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(q){this._vignetteEnabled!==q&&(this._vignetteEnabled=q,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(q){this._ditheringEnabled!==q&&(this._ditheringEnabled=q,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(q){this._ditheringIntensity!==q&&(this._ditheringIntensity=q,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(q){this._skipFinalColorClamp!==q&&(this._skipFinalColorClamp=q,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(q){this._applyByPostProcess!==q&&(this._applyByPostProcess=q,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(q){this._isEnabled!==q&&(this._isEnabled=q,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}prepareDefines(q){if((arguments.length>1&&void 0!==arguments[1]&&arguments[1])!==this.applyByPostProcess||!this._isEnabled)return q.VIGNETTE=!1,q.TONEMAPPING=0,q.CONTRAST=!1,q.EXPOSURE=!1,q.COLORCURVES=!1,q.COLORGRADING=!1,q.COLORGRADING3D=!1,q.DITHER=!1,q.IMAGEPROCESSING=!1,q.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(q.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(q.VIGNETTE=this.vignetteEnabled,q.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===B._VIGNETTEMODE_MULTIPLY,q.VIGNETTEBLENDMODEOPAQUE=!q.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case B.TONEMAPPING_KHR_PBR_NEUTRAL:q.TONEMAPPING=3;break;case B.TONEMAPPING_ACES:q.TONEMAPPING=2;break;default:q.TONEMAPPING=1}else q.TONEMAPPING=0;q.CONTRAST=1!==this.contrast,q.EXPOSURE=1!==this.exposure,q.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,q.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,q.COLORGRADING?q.COLORGRADING3D=this.colorGradingTexture.is3D:q.COLORGRADING3D=!1,q.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,q.SAMPLER3DBGRMAP=this.colorGradingBGR,q.DITHER=this._ditheringEnabled,q.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,q.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,q.IMAGEPROCESSING=q.VIGNETTE||!!q.TONEMAPPING||q.CONTRAST||q.EXPOSURE||q.COLORCURVES||q.COLORGRADING||q.DITHER}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(q,f){if(this._colorCurvesEnabled&&this.colorCurves&&r.Bind(this.colorCurves,q),this._vignetteEnabled||this._ditheringEnabled){const j=1/(this.outputTextureWidth||q.getEngine().getRenderWidth()),d=1/(this.outputTextureHeight||q.getEngine().getRenderHeight());if(q.setFloat2("vInverseScreenSize",j,d),this._ditheringEnabled&&q.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const g=null!=f?f:d/j;let h=Math.tan(.5*this.vignetteCameraFov),L=h*g;const Q=Math.sqrt(L*h);L=(0,u.k)(L,Q,this.vignetteStretch),h=(0,u.k)(h,Q,this.vignetteStretch),q.setFloat4("vignetteSettings1",L,h,-L*this.vignetteCenterX,-h*this.vignetteCenterY);const H=-2*this.vignetteWeight;q.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,H)}}if(q.setFloat("exposureLinear",this.exposure),q.setFloat("contrast",this.contrast),this.colorGradingTexture){q.setTexture("txColorTransform",this.colorGradingTexture);const f=this.colorGradingTexture.getSize().height;q.setFloat4("colorTransformSettings",(f-1)/f,.5/f,f,this.colorGradingTexture.level)}}clone(){return Q.d.Clone((()=>new B),this)}serialize(){return Q.d.Serialize(this)}static Parse(q){const f=Q.d.Parse((()=>new B),q,null,null);return void 0!==q.vignetteCentreX&&(f.vignetteCenterX=q.vignetteCentreX),void 0!==q.vignetteCentreY&&(f.vignetteCenterY=q.vignetteCentreY),f}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}B.TONEMAPPING_STANDARD=0,B.TONEMAPPING_ACES=1,B.TONEMAPPING_KHR_PBR_NEUTRAL=2,B.PrepareUniforms=X.f,B.PrepareSamplers=X.c,B._VIGNETTEMODE_MULTIPLY=0,B._VIGNETTEMODE_OPAQUE=1,(0,d.b)([(0,g.f)()],B.prototype,"colorCurves",void 0),(0,d.b)([(0,g.O)()],B.prototype,"_colorCurvesEnabled",void 0),(0,d.b)([(0,g.F)("colorGradingTexture")],B.prototype,"_colorGradingTexture",void 0),(0,d.b)([(0,g.O)()],B.prototype,"_colorGradingEnabled",void 0),(0,d.b)([(0,g.O)()],B.prototype,"_colorGradingWithGreenDepth",void 0),(0,d.b)([(0,g.O)()],B.prototype,"_colorGradingBGR",void 0),(0,d.b)([(0,g.O)()],B.prototype,"_exposure",void 0),(0,d.b)([(0,g.O)()],B.prototype,"_toneMappingEnabled",void 0),(0,d.b)([(0,g.O)()],B.prototype,"_toneMappingType",void 0),(0,d.b)([(0,g.O)()],B.prototype,"_contrast",void 0),(0,d.b)([(0,g.O)()],B.prototype,"vignetteStretch",void 0),(0,d.b)([(0,g.O)()],B.prototype,"vignetteCenterX",void 0),(0,d.b)([(0,g.O)()],B.prototype,"vignetteCenterY",void 0),(0,d.b)([(0,g.O)()],B.prototype,"vignetteWeight",void 0),(0,d.b)([(0,g.l)()],B.prototype,"vignetteColor",void 0),(0,d.b)([(0,g.O)()],B.prototype,"vignetteCameraFov",void 0),(0,d.b)([(0,g.O)()],B.prototype,"_vignetteBlendMode",void 0),(0,d.b)([(0,g.O)()],B.prototype,"_vignetteEnabled",void 0),(0,d.b)([(0,g.O)()],B.prototype,"_ditheringEnabled",void 0),(0,d.b)([(0,g.O)()],B.prototype,"_ditheringIntensity",void 0),(0,d.b)([(0,g.O)()],B.prototype,"_skipFinalColorClamp",void 0),(0,d.b)([(0,g.O)()],B.prototype,"_applyByPostProcess",void 0),(0,d.b)([(0,g.O)()],B.prototype,"_isEnabled",void 0),(0,d.b)([(0,g.O)()],B.prototype,"outputTextureWidth",void 0),(0,d.b)([(0,g.O)()],B.prototype,"outputTextureHeight",void 0),Q.d._ImageProcessingConfigurationParser=B.Parse,(0,z.f)("BABYLON.ImageProcessingConfiguration",B)},11590:(q,f,j)=>{j.d(f,{d:()=>X});var d=j(11125),g=j(11118),h=j(11130),L=j(11574),Q=j(11549),H=j(11551),r=j(11219);class u extends Q.b{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class X extends H.e{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(q,"DetailMap",140,new u,f),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=g.b.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=q._dirtyCallbacks[1]}isReadyForSubMesh(q,f,j){return!this._isEnabled||!(q._areTexturesDirty&&f.texturesEnabled&&j.getCaps().standardDerivatives&&this._texture&&L.e.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(q,f){if(this._isEnabled){q.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const j=f.getEngine();q._areTexturesDirty&&(j.getCaps().standardDerivatives&&this._texture&&L.e.DetailTextureEnabled&&this._isEnabled?((0,r.P)(this._texture,q,"DETAIL"),q.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):q.DETAIL=!1)}else q.DETAIL=!1}bindForSubMesh(q,f){if(!this._isEnabled)return;const j=this._material.isFrozen;q.useUbo&&j&&q.isSync||this._texture&&L.e.DetailTextureEnabled&&(q.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),(0,r.q)(this._texture,q,"detail")),f.texturesEnabled&&this._texture&&L.e.DetailTextureEnabled&&q.setTexture("detailSampler",this._texture)}hasTexture(q){return this._texture===q}getActiveTextures(q){this._texture&&q.push(this._texture)}getAnimatables(q){this._texture&&this._texture.animations&&this._texture.animations.length>0&&q.push(this._texture)}dispose(q){var f;q&&(null===(f=this._texture)||void 0===f||f.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(q){q.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,d.b)([(0,h.F)("detailTexture"),(0,h.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"texture",void 0),(0,d.b)([(0,h.O)()],X.prototype,"diffuseBlendLevel",void 0),(0,d.b)([(0,h.O)()],X.prototype,"roughnessBlendLevel",void 0),(0,d.b)([(0,h.O)()],X.prototype,"bumpLevel",void 0),(0,d.b)([(0,h.O)(),(0,h.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"normalBlendMethod",void 0),(0,d.b)([(0,h.O)(),(0,h.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"isEnabled",void 0)},11118:(q,f,j)=>{j.d(f,{b:()=>t});var d=j(11125),g=j(11130),h=j(10992),L=j(10982),Q=j(10980),H=j(11142),r=j(11190),u=j(11005),X=j(11193),z=j(11186),B=j(11199);class D{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(q){this._func=q}get funcRef(){return this._funcRef}set funcRef(q){this._funcRef=q}get funcMask(){return this._funcMask}set funcMask(q){this._funcMask=q}get opStencilFail(){return this._opStencilFail}set opStencilFail(q){this._opStencilFail=q}get opDepthFail(){return this._opDepthFail}set opDepthFail(q){this._opDepthFail=q}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(q){this._opStencilDepthPass=q}get mask(){return this._mask}set mask(q){this._mask=q}get enabled(){return this._enabled}set enabled(q){this._enabled=q}getClassName(){return"MaterialStencilState"}copyTo(q){B.d.Clone((()=>q),this)}serialize(){return B.d.Serialize(this)}parse(q,f,j){B.d.Parse((()=>this),q,f,j)}}(0,d.b)([(0,g.O)()],D.prototype,"func",null),(0,d.b)([(0,g.O)()],D.prototype,"funcRef",null),(0,d.b)([(0,g.O)()],D.prototype,"funcMask",null),(0,d.b)([(0,g.O)()],D.prototype,"opStencilFail",null),(0,d.b)([(0,g.O)()],D.prototype,"opDepthFail",null),(0,d.b)([(0,g.O)()],D.prototype,"opStencilDepthPass",null),(0,d.b)([(0,g.O)()],D.prototype,"mask",null),(0,d.b)([(0,g.O)()],D.prototype,"enabled",null);var i=j(11219);class t{get _supportGlowLayer(){return!1}set _glowModeEnabled(q){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(q){if(this._alpha===q)return;const f=this._alpha;this._alpha=q,1!==f&&1!==q||this.zu(t.MiscDirtyFlag+t.PrePassDirtyFlag)}get alpha(){return this._alpha}set ef(q){this._backFaceCulling!==q&&(this._backFaceCulling=q,this.zu(t.TextureDirtyFlag))}get ef(){return this._backFaceCulling}set cullBackFaces(q){this._cullBackFaces!==q&&(this._cullBackFaces=q,this.zu(t.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(q){this._blockDirtyMechanism!==q&&(this._blockDirtyMechanism=q,q||this.zz())}atomicMaterialsUpdate(q){this.blockDirtyMechanism=!0;try{q(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(q){this._onDisposeObserver&&this.qd.remove(this._onDisposeObserver),this._onDisposeObserver=this.qd.add(q)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new L.d),this._onBindObservable}set onBind(q){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(q)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new L.d),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new L.d),this._onEffectCreatedObservable}set alphaMode(q){this._alphaMode!==q&&(this._alphaMode=q,this.zu(t.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(q){this._needDepthPrePass!==q&&(this._needDepthPrePass=q,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(q){this._fogEnabled!==q&&(this._fogEnabled=q,this.zu(t.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case t.WireFrameFillMode:case t.LineListDrawMode:case t.LineLoopDrawMode:case t.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(q){this.fillMode=q?t.WireFrameFillMode:t.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case t.PointFillMode:case t.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(q){this.fillMode=q?t.PointFillMode:t.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(q){this._fillMode!==q&&(this._fillMode=q,this.zu(t.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(q){const f=this.eq().getEngine().getCaps().fragmentDepthSupported;q&&!f&&u.e.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=q&&f,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(q){this._drawWrapper=q}constructor(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.qd=new L.d,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new D,this._useUBO=!1,this._fillMode=t.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=q;const g=f||Q.d.LastCreatedScene;g&&(this._scene=g,this._dirtyCallbacks={},this._forceGLSL=d,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=q||h.h.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new z.e(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new r.d(this._scene.getEngine(),void 0,void 0,q),this._useUBO=this.eq().getEngine().supportsUniformBuffers,this._createUniformBuffer(),j||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),t.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var q;const f=this.eq().getEngine();null===(q=this._uniformBuffer)||void 0===q||q.dispose(),f.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new r.d(f,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new r.d(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(q){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.zz(),this.checkReadyOnlyOnce=!0}unfreeze(){this.zz(),this.checkReadyOnlyOnce=!1}isReady(q,f){return!0}isReadyForSubMesh(q,f,j){const d=f.materialDefines;return!!d&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=d,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}eq(){return this._scene}_getEffectiveOrientation(q){return null!==this.sideOrientation?this.sideOrientation:q.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(q){this._transparencyMode!==q&&(this._transparencyMode=q,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===t.MATERIAL_ALPHABLEND||this._transparencyMode===t.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===t.MATERIAL_ALPHATEST||this._transparencyMode===t.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===t.MATERIAL_OPAQUE||this._transparencyMode===t.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(q){return this._hasTransparencyMode?this._transparencyModeIsBlend:q.visibility<1||!this._disableAlphaBlending&&(q.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(q){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(q)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}zz(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const f=this.eq().meshes;for(const j of f)if(j.Qd)for(const f of j.Qd)if(f.bq()===this)for(const j of f._drawWrappers)j&&this._materialContext===j.materialContext&&(j._wasPreviouslyReady=!1,j._wasPreviouslyUsingInstances=null,j._forceRebindOnNextCall=q);q&&this.zu(t.AllDirtyFlag)}_preBind(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const j=this._scene.getEngine(),d=(null==f?this.sideOrientation:f)===t.ClockWiseSideOrientation;return j.enableEffect(q||this._getDrawWrapper()),j.setState(this.ef,this.zOffset,!1,d,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),d}bind(q,f){}buildUniformLayout(){const q=this._uniformBuffer;this._eventInfo.ubo=q,this._callbackPluginEventGeneric(8,this._eventInfo),q.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(q,f,j){const d=j._drawWrapper;this._eventInfo.subMesh=j,this._callbackPluginEventBindForSubMesh(this._eventInfo),d._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(q){}bindView(q){this._useUBO?this._needToBindSceneUbo=!0:q.setMatrix("view",this.eq().getViewMatrix())}bindViewProjection(q){this._useUBO?this._needToBindSceneUbo=!0:(q.setMatrix("viewProjection",this.eq().getTransformMatrix()),q.setMatrix("projection",this.eq().getProjectionMatrix()))}bindEyePosition(q,f){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(q,f)}_afterBind(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&f&&(this._needToBindSceneUbo=!1,(0,i.p)(f,this.eq().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=q?q.visibility:1,this._onBindObservable&&q&&this._onBindObservable.notifyObservers(q),this.disableDepthWrite){const q=this._scene.getEngine();this._cachedDepthWriteState=q.getDepthWrite(),q.setDepthWrite(!1)}if(this.disableColorWrite){const q=this._scene.getEngine();this._cachedColorWriteState=q.getColorWrite(),q.setColorWrite(!1)}if(0!==this.depthFunction){const q=this._scene.getEngine();this._cachedDepthFunctionState=q.getDepthFunction()||0,q.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(q){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=q,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(q){return null}_clonePlugins(q,f){const j={};if(this._serializePlugins(j),t._ParsePlugins(j,q,this._scene,f),this.pluginManager)for(const d of this.pluginManager._plugins){const f=q.pluginManager.getPlugin(d.name);f&&d.copyTo(f)}}getBindedMeshes(){if(this.meshMap){const q=[];for(const f in this.meshMap){const j=this.meshMap[f];j&&q.push(j)}return q}return this._scene.meshes.filter((q=>q.material===this))}forceCompilation(q,f,j,d){const g={clipPlane:!1,useInstances:!1,...j},h=this.eq(),L=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const Q=()=>{if(!this._scene||!this._scene.getEngine())return;const j=h.clipPlane;if(g.clipPlane&&(h.clipPlane=new X.e(0,0,0,1)),this._storeEffectOnSubMeshes){let j=!0,h=null;if(q.Qd){const f=new H.d(0,0,0,0,0,q,void 0,!1,!1);f.materialDefines&&(f.materialDefines._renderId=-1),this.isReadyForSubMesh(q,f,g.useInstances)||(f.effect&&f.effect.getCompilationError()&&f.effect.allFallbacksProcessed()?h=f.effect.getCompilationError():(j=!1,setTimeout(Q,16)))}j&&(this.allowShaderHotSwapping=L,h&&d&&d(h),f&&f(this))}else this.isReady()?(this.allowShaderHotSwapping=L,f&&f(this)):setTimeout(Q,16);g.clipPlane&&(h.clipPlane=j)};Q()}async forceCompilationAsync(q,f){return await new Promise(((j,d)=>{this.forceCompilation(q,(()=>{j()}),f,(q=>{d(q)}))}))}zu(q){this.eq().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(t._DirtyCallbackArray.length=0,q&t.ImageProcessingDirtyFlag&&t._DirtyCallbackArray.push(t._ImageProcessingDirtyCallBack),q&t.TextureDirtyFlag&&t._DirtyCallbackArray.push(t._TextureDirtyCallBack),q&t.LightDirtyFlag&&t._DirtyCallbackArray.push(t._LightsDirtyCallBack),q&t.FresnelDirtyFlag&&t._DirtyCallbackArray.push(t._FresnelDirtyCallBack),q&t.AttributesDirtyFlag&&t._DirtyCallbackArray.push(t._AttributeDirtyCallBack),q&t.MiscDirtyFlag&&t._DirtyCallbackArray.push(t._MiscDirtyCallBack),q&t.PrePassDirtyFlag&&t._DirtyCallbackArray.push(t._PrePassDirtyCallBack),t._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(t._RunDirtyCallBacks),this.eq().resetCachedMaterial())}resetDrawCache(){const q=this.eq().meshes;for(const f of q)if(f.Qd)for(const q of f.Qd)q.bq()===this&&q.resetDrawCache()}_markAllSubMeshesAsDirty(q){const f=this.eq();if(f.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const j=f.meshes;for(const d of j)if(d.Qd)for(const j of d.Qd){if((j.bq()||(f._hasDefaultMaterial?f.defaultMaterial:null))===this)for(const f of j._drawWrappers)f&&f.defines&&f.defines.markAllAsDirty&&this._materialContext===f.materialContext&&q(f.defines)}}_markScenePrePassDirty(){if(this.eq().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const q=this.eq().enablePrePassRenderer();q&&q.zu()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(t._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(t._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(t._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(t._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(t._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(t._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(t._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(t._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(t._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(t._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const q=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.qd.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(q)}))}}setPrePassRenderer(q){return!1}dispose(q,f,j){const d=this.eq();if(d.stopAnimation(this),d.freeProcessedMaterials(),d.removeMaterial(this),this._eventInfo.forceDisposeTextures=f,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const q=this._parentContainer.materials.indexOf(this);q>-1&&this._parentContainer.materials.splice(q,1),this._parentContainer=null}if(!0!==j)if(this.meshMap)for(const g in this.meshMap){const q=this.meshMap[g];this._disposeMeshResources(q)}else{const q=d.meshes;for(const f of q)this._disposeMeshResources(f)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.qd.notifyObservers(this),this.qd.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(q){if(!q)return;const f=q.wf,j=q._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(q.Qd&&j)for(const g of q.Qd){const q=g._drawWrappers;for(let h=0;h<q.length;h++){var d;const L=null===(d=q[h])||void 0===d?void 0:d.effect;if(!L)continue;j[h]===this&&(null===f||void 0===f||f._releaseVertexArrayObject(L),g._removeDrawWrapper(h,!0,!0))}}}else null===f||void 0===f||f._releaseVertexArrayObject(this._drawWrapper.effect);q.material!==this||q.sourceMesh||(q.material=null)}serialize(){const q=B.d.Serialize(this);return q.stencil=this.stencil.serialize(),q.uniqueId=this.uniqueId,this._serializePlugins(q),q}_serializePlugins(q){if(q.plugins={},this.pluginManager)for(const f of this.pluginManager._plugins)f.doNotSerialize||(q.plugins[f.getClassName()]=f.serialize())}static Parse(q,f,j){if(q.customType){if("BABYLON.PBRMaterial"===q.customType&&q.overloadedAlbedo&&(q.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return u.e.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else q.customType="BABYLON.StandardMaterial";const d=h.h.Instantiate(q.customType).Parse(q,f,j);return d._loadedUniqueId=q.uniqueId,d}static _ParsePlugins(q,f,j,d){if(q.plugins)for(const Q in q.plugins){var g,L;const H=q.plugins[Q];let r=null===(g=f.pluginManager)||void 0===g?void 0:g.getPlugin(H.name);if(!r){const q=h.h.Instantiate("BABYLON."+Q);q&&(r=new q(f))}null===(L=r)||void 0===L||L.parse(H,j,d)}}}t.TriangleFillMode=0,t.WireFrameFillMode=1,t.PointFillMode=2,t.PointListDrawMode=3,t.LineListDrawMode=4,t.LineLoopDrawMode=5,t.LineStripDrawMode=6,t.TriangleStripDrawMode=7,t.TriangleFanDrawMode=8,t.ClockWiseSideOrientation=0,t.CounterClockWiseSideOrientation=1,t.ImageProcessingDirtyFlag=64,t.TextureDirtyFlag=1,t.LightDirtyFlag=2,t.FresnelDirtyFlag=4,t.AttributesDirtyFlag=8,t.MiscDirtyFlag=16,t.PrePassDirtyFlag=32,t.AllDirtyFlag=127,t.MATERIAL_OPAQUE=0,t.MATERIAL_ALPHATEST=1,t.MATERIAL_ALPHABLEND=2,t.MATERIAL_ALPHATESTANDBLEND=3,t.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,t.MATERIAL_NORMALBLENDMETHOD_RNM=1,t.OnEventObservable=new L.d,t._AllDirtyCallBack=q=>q.markAllAsDirty(),t._ImageProcessingDirtyCallBack=q=>q.markAsImageProcessingDirty(),t._TextureDirtyCallBack=q=>q.markAsTexturesDirty(),t._FresnelDirtyCallBack=q=>q.markAsFresnelDirty(),t._MiscDirtyCallBack=q=>q.markAsMiscDirty(),t._PrePassDirtyCallBack=q=>q.markAsPrePassDirty(),t._LightsDirtyCallBack=q=>q.markAsLightDirty(),t._AttributeDirtyCallBack=q=>q.markAsAttributesDirty(),t._FresnelAndMiscDirtyCallBack=q=>{t._FresnelDirtyCallBack(q),t._MiscDirtyCallBack(q)},t._TextureAndMiscDirtyCallBack=q=>{t._TextureDirtyCallBack(q),t._MiscDirtyCallBack(q)},t._DirtyCallbackArray=[],t._RunDirtyCallBacks=q=>{for(const f of t._DirtyCallbackArray)f(q)},(0,d.b)([(0,g.O)()],t.prototype,"id",void 0),(0,d.b)([(0,g.O)()],t.prototype,"uniqueId",void 0),(0,d.b)([(0,g.O)()],t.prototype,"name",void 0),(0,d.b)([(0,g.O)()],t.prototype,"metadata",void 0),(0,d.b)([(0,g.O)()],t.prototype,"checkReadyOnEveryCall",void 0),(0,d.b)([(0,g.O)()],t.prototype,"checkReadyOnlyOnce",void 0),(0,d.b)([(0,g.O)()],t.prototype,"state",void 0),(0,d.b)([(0,g.O)("alpha")],t.prototype,"_alpha",void 0),(0,d.b)([(0,g.O)("ef")],t.prototype,"_backFaceCulling",void 0),(0,d.b)([(0,g.O)("cullBackFaces")],t.prototype,"_cullBackFaces",void 0),(0,d.b)([(0,g.O)()],t.prototype,"sideOrientation",void 0),(0,d.b)([(0,g.O)("alphaMode")],t.prototype,"_alphaMode",void 0),(0,d.b)([(0,g.O)()],t.prototype,"_needDepthPrePass",void 0),(0,d.b)([(0,g.O)()],t.prototype,"disableDepthWrite",void 0),(0,d.b)([(0,g.O)()],t.prototype,"disableColorWrite",void 0),(0,d.b)([(0,g.O)()],t.prototype,"forceDepthWrite",void 0),(0,d.b)([(0,g.O)()],t.prototype,"depthFunction",void 0),(0,d.b)([(0,g.O)()],t.prototype,"separateCullingPass",void 0),(0,d.b)([(0,g.O)("fogEnabled")],t.prototype,"_fogEnabled",void 0),(0,d.b)([(0,g.O)()],t.prototype,"pointSize",void 0),(0,d.b)([(0,g.O)()],t.prototype,"zOffset",void 0),(0,d.b)([(0,g.O)()],t.prototype,"zOffsetUnits",void 0),(0,d.b)([(0,g.O)()],t.prototype,"pointsCloud",null),(0,d.b)([(0,g.O)()],t.prototype,"fillMode",null),(0,d.b)([(0,g.O)()],t.prototype,"useLogarithmicDepth",null),(0,d.b)([(0,g.O)()],t.prototype,"transparencyMode",null)},11549:(q,f,j)=>{j.d(f,{b:()=>d});class d{constructor(q){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=q,q)for(const f in q)Object.prototype.hasOwnProperty.call(q,f)&&this._setDefaultValue(f)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||q,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const q of Object.keys(this))"_"!==q[0]&&this._keys.push(q);if(this._externalProperties)for(const q in this._externalProperties)-1===this._keys.indexOf(q)&&this._keys.push(q)}isEqual(q){if(this._keys.length!==q._keys.length)return!1;for(let f=0;f<this._keys.length;f++){const j=this._keys[f];if(this[j]!==q[j])return!1}return!0}cloneTo(q){this._keys.length!==q._keys.length&&(q._keys=this._keys.slice(0));for(let f=0;f<this._keys.length;f++){const j=this._keys[f];q[j]=this[j]}}reset(){for(const q of this._keys)this._setDefaultValue(q)}_setDefaultValue(q){var f,j,d,g;const h=(null===(f=this._externalProperties)||void 0===f||null===(j=f[q])||void 0===j?void 0:j.type)??typeof this[q],L=null===(d=this._externalProperties)||void 0===d||null===(g=d[q])||void 0===g?void 0:g.default;switch(h){case"number":this[q]=L??0;break;case"string":this[q]=L??"";break;default:this[q]=L??!1}}toString(){let q="";for(let f=0;f<this._keys.length;f++){const j=this._keys[f],d=this[j];switch(typeof d){case"number":case"string":q+="#define "+j+" "+d+"\n";break;default:d&&(q+="#define "+j+"\n")}}return q}}},11574:(q,f,j)=>{j.d(f,{e:()=>g});var d=j(11065);class g{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(q){this._DiffuseTextureEnabled!==q&&(this._DiffuseTextureEnabled=q,d.b.MarkAllMaterialsAsDirty(1))}static get BaseWeightTextureEnabled(){return this._BaseWeightTextureEnabled}static set BaseWeightTextureEnabled(q){this._BaseWeightTextureEnabled!==q&&(this._BaseWeightTextureEnabled=q,d.b.MarkAllMaterialsAsDirty(1))}static get BaseDiffuseRoughnessTextureEnabled(){return this._BaseDiffuseRoughnessTextureEnabled}static set BaseDiffuseRoughnessTextureEnabled(q){this._BaseDiffuseRoughnessTextureEnabled!==q&&(this._BaseDiffuseRoughnessTextureEnabled=q,d.b.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(q){this._DetailTextureEnabled!==q&&(this._DetailTextureEnabled=q,d.b.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(q){this._DecalMapEnabled!==q&&(this._DecalMapEnabled=q,d.b.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(q){this._AmbientTextureEnabled!==q&&(this._AmbientTextureEnabled=q,d.b.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(q){this._OpacityTextureEnabled!==q&&(this._OpacityTextureEnabled=q,d.b.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(q){this._ReflectionTextureEnabled!==q&&(this._ReflectionTextureEnabled=q,d.b.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(q){this._EmissiveTextureEnabled!==q&&(this._EmissiveTextureEnabled=q,d.b.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(q){this._SpecularTextureEnabled!==q&&(this._SpecularTextureEnabled=q,d.b.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(q){this._BumpTextureEnabled!==q&&(this._BumpTextureEnabled=q,d.b.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(q){this._LightmapTextureEnabled!==q&&(this._LightmapTextureEnabled=q,d.b.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(q){this._RefractionTextureEnabled!==q&&(this._RefractionTextureEnabled=q,d.b.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(q){this._ColorGradingTextureEnabled!==q&&(this._ColorGradingTextureEnabled=q,d.b.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(q){this._FresnelEnabled!==q&&(this._FresnelEnabled=q,d.b.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(q){this._ClearCoatTextureEnabled!==q&&(this._ClearCoatTextureEnabled=q,d.b.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(q){this._ClearCoatBumpTextureEnabled!==q&&(this._ClearCoatBumpTextureEnabled=q,d.b.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(q){this._ClearCoatTintTextureEnabled!==q&&(this._ClearCoatTintTextureEnabled=q,d.b.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(q){this._SheenTextureEnabled!==q&&(this._SheenTextureEnabled=q,d.b.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(q){this._AnisotropicTextureEnabled!==q&&(this._AnisotropicTextureEnabled=q,d.b.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(q){this._ThicknessTextureEnabled!==q&&(this._ThicknessTextureEnabled=q,d.b.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(q){this._RefractionIntensityTextureEnabled!==q&&(this._RefractionIntensityTextureEnabled=q,d.b.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(q){this._TranslucencyIntensityTextureEnabled!==q&&(this._TranslucencyIntensityTextureEnabled=q,d.b.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(q){this._TranslucencyColorTextureEnabled!==q&&(this._TranslucencyColorTextureEnabled=q,d.b.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(q){this._IridescenceTextureEnabled!==q&&(this._IridescenceTextureEnabled=q,d.b.MarkAllMaterialsAsDirty(1))}}g._DiffuseTextureEnabled=!0,g._BaseWeightTextureEnabled=!0,g._BaseDiffuseRoughnessTextureEnabled=!0,g._DetailTextureEnabled=!0,g._DecalMapEnabled=!0,g._AmbientTextureEnabled=!0,g._OpacityTextureEnabled=!0,g._ReflectionTextureEnabled=!0,g._EmissiveTextureEnabled=!0,g._SpecularTextureEnabled=!0,g._BumpTextureEnabled=!0,g._LightmapTextureEnabled=!0,g._RefractionTextureEnabled=!0,g._ColorGradingTextureEnabled=!0,g._FresnelEnabled=!0,g._ClearCoatTextureEnabled=!0,g._ClearCoatBumpTextureEnabled=!0,g._ClearCoatTintTextureEnabled=!0,g._SheenTextureEnabled=!0,g._AnisotropicTextureEnabled=!0,g._ThicknessTextureEnabled=!0,g._RefractionIntensityTextureEnabled=!0,g._TranslucencyIntensityTextureEnabled=!0,g._TranslucencyColorTextureEnabled=!0,g._IridescenceTextureEnabled=!0},11219:(q,f,j)=>{j.d(f,{C:()=>Z,D:()=>B,G:()=>z,I:()=>Y,K:()=>U,M:()=>W,P:()=>O,R:()=>T,V:()=>v,X:()=>F,_:()=>M,ab:()=>b,b:()=>E,bb:()=>D,d:()=>X,g:()=>S,i:()=>u,l:()=>i,p:()=>t,q:()=>N,s:()=>I,w:()=>w,y:()=>e});var d=j(11005),g=j(11210),h=j(10980),L=j(11228),Q=j(11236);const H=g.c.Black(),r={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function u(q,f,j){if(!q||q.LOGARITHMICDEPTH||q.indexOf&&q.indexOf("LOGARITHMICDEPTH")>=0){const q=j.activeCamera;1===q.mode&&d.e.Error("Logarithmic depth is not compatible with orthographic cameras!",20),f.setFloat("logarithmicDepthConstant",2/(Math.log(q.maxZ+1)/Math.LN2))}}function X(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];j&&q.fogEnabled&&(!f||f.applyFog)&&0!==q.fogMode&&(j.setFloat4("vFogInfos",q.fogMode,q.fogStart,q.fogEnd,q.fogDensity),d?(q.fogColor.toLinearSpaceToRef(H,q.getEngine().useExactSrgbConversions),j.setColor3("vFogColor",H)):j.setColor3("vFogColor",q.fogColor))}function z(q,f,j,d,g,h,L,Q,H,u){const X=q.numMaxInfluencers||q.numInfluencers;return X<=0?0:(f.push("#define MORPHTARGETS"),q.hasPositions&&f.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),q.hasNormals&&f.push("#define MORPHTARGETTEXTURE_HASNORMALS"),q.hasTangents&&f.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),q.hasUVs&&f.push("#define MORPHTARGETTEXTURE_HASUVS"),q.hasUV2s&&f.push("#define MORPHTARGETTEXTURE_HASUV2S"),q.hasColors&&f.push("#define MORPHTARGETTEXTURE_HASCOLORS"),q.supportsPositions&&g&&f.push("#define MORPHTARGETS_POSITION"),q.supportsNormals&&h&&f.push("#define MORPHTARGETS_NORMAL"),q.supportsTangents&&L&&f.push("#define MORPHTARGETS_TANGENT"),q.supportsUVs&&Q&&f.push("#define MORPHTARGETS_UV"),q.supportsUV2s&&H&&f.push("#define MORPHTARGETS_UV2"),q.supportsColors&&u&&f.push("#define MORPHTARGETS_COLOR"),f.push("#define NUM_MORPH_INFLUENCERS "+X),q.isUsingTextureForTargets&&f.push("#define MORPHTARGETS_TEXTURE"),r.NUM_MORPH_INFLUENCERS=X,r.NORMAL=h,r.TANGENT=L,r.UV=Q,r.UV2=H,r.COLOR=u,B(j,d,r,g),X)}function B(q,f,j){let g=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const L=j.NUM_MORPH_INFLUENCERS;if(L>0&&h.d.LastCreatedEngine){const Q=h.d.LastCreatedEngine.getCaps().maxVertexAttribs,H=f.morphTargetManager;if(null!==H&&void 0!==H&&H.isUsingTextureForTargets)return;const r=H&&H.supportsPositions&&g,u=H&&H.supportsNormals&&j.NORMAL,X=H&&H.supportsTangents&&j.TANGENT,z=H&&H.supportsUVs&&j.UV1,B=H&&H.supportsUV2s&&j.UV2,D=H&&H.supportsColors&&j.VERTEXCOLOR;for(let j=0;j<L;j++)r&&q.push("position"+j),u&&q.push("normal"+j),X&&q.push("tangent"+j),z&&q.push("uv_"+j),B&&q.push("uv2_"+j),D&&q.push("color"+j),q.length>Q&&d.e.Error("Cannot add more vertex attributes for mesh "+f.name)}}function D(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];q.push("world0"),q.push("world1"),q.push("world2"),q.push("world3"),f&&(q.push("previousWorld0"),q.push("previousWorld1"),q.push("previousWorld2"),q.push("previousWorld3"))}function i(q,f){const j=q.morphTargetManager;q&&j&&f.setFloatArray("morphTargetInfluences",j.influences)}function t(q,f){f.bindToEffect(q,"Scene")}function O(q,f,j){f._needUVs=!0,f[j]=!0,q.optimizeUVAllocation&&q.getTextureMatrix().isIdentityAs3x2()?(f[j+"DIRECTUV"]=q.coordinatesIndex+1,f["MAINUV"+(q.coordinatesIndex+1)]=!0):f[j+"DIRECTUV"]=0}function N(q,f,j){const d=q.getTextureMatrix();f.jd(j+"Matrix",d)}function w(q,f,j){j.BAKED_VERTEX_ANIMATION_TEXTURE&&j.INSTANCES&&q.push("bakedVertexAnimationSettingsInstanced")}function E(q,f,j){var d;if(f&&q&&(q.computeBonesUsingShaders&&f._bonesComputationForcedToCPU&&(q.computeBonesUsingShaders=!1),q.useBones&&q.computeBonesUsingShaders&&q.skeleton)){const g=q.skeleton;if(g.isUsingTextureForMatrices&&f.getUniformIndex("boneTextureWidth")>-1){const j=g.getTransformMatrixTexture(q);f.setTexture("boneSampler",j),f.setFloat("boneTextureWidth",4*(g.bones.length+1))}else{const h=g.getTransformMatrices(q);h&&(f.setMatrices("mBones",h),j&&q.eq().prePassRenderer&&q.eq().prePassRenderer.getIndex(2)&&(j.previousBones[q.uniqueId]||(j.previousBones[q.uniqueId]=h.slice()),f.setMatrices("mPreviousBones",j.previousBones[q.uniqueId]),d=h,j.previousBones[q.uniqueId].set(d)))}}}function s(q,f,j,d,g){let h=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];q._bindLight(f,j,d,g,h)}function S(q,f,j,d){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const h=Math.min(f.lightSources.length,g);for(let L=0;L<h;L++){s(f.lightSources[L],L,q,j,"boolean"===typeof d?d:d.SPECULARTERM,f.receiveShadows)}}function e(q,f,j,d){j.NUM_BONE_INFLUENCERS>0&&(d.addCPUSkinningFallback(0,f),q.push("matricesIndices"),q.push("matricesWeights"),j.NUM_BONE_INFLUENCERS>4&&(q.push("matricesIndicesExtra"),q.push("matricesWeightsExtra")))}function Z(q,f){(f.INSTANCES||f.THIN_INSTANCES)&&D(q,!!f.PREPASS_VELOCITY),f.INSTANCESCOLOR&&q.push("instanceColor")}function I(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,g=0;for(let h=0;h<j&&q["LIGHT"+h];h++)h>0&&(g=d+h,f.addFallback(g,"LIGHT"+h)),q.SHADOWS||(q["SHADOW"+h]&&f.addFallback(d,"SHADOW"+h),q["SHADOWPCF"+h]&&f.addFallback(d,"SHADOWPCF"+h),q["SHADOWPCSS"+h]&&f.addFallback(d,"SHADOWPCSS"+h),q["SHADOWPOISSON"+h]&&f.addFallback(d,"SHADOWPOISSON"+h),q["SHADOWESM"+h]&&f.addFallback(d,"SHADOWESM"+h),q["SHADOWCLOSEESM"+h]&&f.addFallback(d,"SHADOWCLOSEESM"+h));return g++}function T(q,f,j,d,g,h,L){let Q=arguments.length>7&&void 0!==arguments[7]&&arguments[7];L._areMiscDirty&&(L.LOGARITHMICDEPTH=j,L.POINTSIZE=d,L.FOG=g&&function(q,f){return f.fogEnabled&&q.applyFog&&0!==f.fogMode}(q,f),L.NONUNIFORMSCALING=q.nonUniformScaling,L.ALPHATEST=h,L.DECAL_AFTER_DETAIL=Q)}function W(q,f,j,d){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!j._areLightsDirty)return j._needNormals;let L=0;const Q={needNormals:j._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(q.lightsEnabled&&!h)for(const r of f.lightSources)if(n(q,f,r,L,j,d,Q),L++,L===g)break;j.SPECULARTERM=Q.specularEnabled,j.SHADOWS=Q.shadowEnabled;for(let r=L;r<g;r++)void 0!==j["LIGHT"+r]&&(j["LIGHT"+r]=!1,j["HEMILIGHT"+r]=!1,j["POINTLIGHT"+r]=!1,j["DIRLIGHT"+r]=!1,j["SPOTLIGHT"+r]=!1,j["AREALIGHT"+r]=!1,j["SHADOW"+r]=!1,j["SHADOWCSM"+r]=!1,j["SHADOWCSMDEBUG"+r]=!1,j["SHADOWCSMNUM_CASCADES"+r]=!1,j["SHADOWCSMUSESHADOWMAXZ"+r]=!1,j["SHADOWCSMNOBLEND"+r]=!1,j["SHADOWCSM_RIGHTHANDED"+r]=!1,j["SHADOWPCF"+r]=!1,j["SHADOWPCSS"+r]=!1,j["SHADOWPOISSON"+r]=!1,j["SHADOWESM"+r]=!1,j["SHADOWCLOSEESM"+r]=!1,j["SHADOWCUBE"+r]=!1,j["SHADOWLOWQUALITY"+r]=!1,j["SHADOWMEDIUMQUALITY"+r]=!1);const H=q.getEngine().getCaps();return void 0===j.SHADOWFLOAT&&(Q.needRebuild=!0),j.SHADOWFLOAT=Q.shadowEnabled&&(H.textureFloatRender&&H.textureFloatLinearFiltering||H.textureHalfFloatRender&&H.textureHalfFloatLinearFiltering),j.LIGHTMAPEXCLUDED=Q.lightmapMode,Q.needRebuild&&j.rebuild(),Q.needNormals}function n(q,f,j,d,g,h,Q){switch(Q.needNormals=!0,void 0===g["LIGHT"+d]&&(Q.needRebuild=!0),g["LIGHT"+d]=!0,g["SPOTLIGHT"+d]=!1,g["HEMILIGHT"+d]=!1,g["POINTLIGHT"+d]=!1,g["DIRLIGHT"+d]=!1,g["AREALIGHT"+d]=!1,j.prepareLightSpecificDefines(g,d),g["LIGHT_FALLOFF_PHYSICAL"+d]=!1,g["LIGHT_FALLOFF_GLTF"+d]=!1,g["LIGHT_FALLOFF_STANDARD"+d]=!1,j.falloffType){case L.d.FALLOFF_GLTF:g["LIGHT_FALLOFF_GLTF"+d]=!0;break;case L.d.FALLOFF_PHYSICAL:g["LIGHT_FALLOFF_PHYSICAL"+d]=!0;break;case L.d.FALLOFF_STANDARD:g["LIGHT_FALLOFF_STANDARD"+d]=!0}if(h&&!j.bu.equalsFloats(0,0,0)&&(Q.specularEnabled=!0),g["SHADOW"+d]=!1,g["SHADOWCSM"+d]=!1,g["SHADOWCSMDEBUG"+d]=!1,g["SHADOWCSMNUM_CASCADES"+d]=!1,g["SHADOWCSMUSESHADOWMAXZ"+d]=!1,g["SHADOWCSMNOBLEND"+d]=!1,g["SHADOWCSM_RIGHTHANDED"+d]=!1,g["SHADOWPCF"+d]=!1,g["SHADOWPCSS"+d]=!1,g["SHADOWPOISSON"+d]=!1,g["SHADOWESM"+d]=!1,g["SHADOWCLOSEESM"+d]=!1,g["SHADOWCUBE"+d]=!1,g["SHADOWLOWQUALITY"+d]=!1,g["SHADOWMEDIUMQUALITY"+d]=!1,f&&f.receiveShadows&&q.shadowsEnabled&&j.shadowEnabled){const f=j.getShadowGenerator(q.activeCamera)??j.getShadowGenerator();if(f){const q=f.getShadowMap();q&&q.renderList&&q.renderList.length>0&&(Q.shadowEnabled=!0,f.prepareDefines(g,d))}}j.lightmapMode!=L.d.LIGHTMAP_DEFAULT?(Q.lightmapMode=!0,g["LIGHTMAPEXCLUDED"+d]=!0,g["LIGHTMAPNOSPECULAR"+d]=j.lightmapMode==L.d.LIGHTMAP_SHADOWSONLY):(g["LIGHTMAPEXCLUDED"+d]=!1,g["LIGHTMAPNOSPECULAR"+d]=!1)}function U(q,f,j,d,g){let h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=arguments.length>6&&void 0!==arguments[6]&&arguments[6],H=function(q,f){let j=!1;if(q.activeCamera){const d=f.CAMERA_ORTHOGRAPHIC?1:0,g=f.CAMERA_PERSPECTIVE?1:0,h=1===q.activeCamera.mode?1:0,L=0===q.activeCamera.mode?1:0;(d^h||g^L)&&(f.CAMERA_ORTHOGRAPHIC=1===h,f.CAMERA_PERSPECTIVE=1===L,j=!0)}return j}(q,d);!1!==h&&(H=(0,Q.h)(j,q,d)),d.DEPTHPREPASS!==!f.getColorWrite()&&(d.DEPTHPREPASS=!d.DEPTHPREPASS,H=!0),d.INSTANCES!==g&&(d.INSTANCES=g,H=!0),d.THIN_INSTANCES!==L&&(d.THIN_INSTANCES=L,H=!0),H&&d.markAsUnprocessed()}function Y(q,f,j,d){let g=arguments.length>4&&void 0!==arguments[4]&&arguments[4],h=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],L=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!f._areAttributesDirty&&f._needNormals===f._normals&&f._needUVs===f._uvs)return!1;f._normals=f._needNormals,f._uvs=f._needUVs,f.NORMAL=f._needNormals&&q.isVerticesDataPresent("normal"),f._needNormals&&q.isVerticesDataPresent("tangent")&&(f.TANGENT=!0);for(let Q=1;Q<=6;++Q)f["UV"+Q]=!!f._needUVs&&q.isVerticesDataPresent(`uv${1===Q?"":Q}`);if(j){const j=q.useVertexColors&&q.isVerticesDataPresent("color");f.VERTEXCOLOR=j,f.VERTEXALPHA=q.hasVertexAlpha&&j&&h}return q.isVerticesDataPresent("instanceColor")&&(q.hasInstances||q.hasThinInstances)&&(f.INSTANCESCOLOR=!0),d&&function(q,f){if(q.useBones&&q.computeBonesUsingShaders&&q.skeleton){f.NUM_BONE_INFLUENCERS=q.numBoneInfluencers;const j=void 0!==f.BONETEXTURE;if(q.skeleton.isUsingTextureForMatrices&&j)f.BONETEXTURE=!0;else{f.BonesPerMesh=q.skeleton.bones.length+1,f.BONETEXTURE=!j&&void 0;const d=q.eq().prePassRenderer;if(d&&d.enabled){const j=-1===d.excludedSkinnedMesh.indexOf(q);f.BONES_VELOCITY_ENABLED=j}}}else f.NUM_BONE_INFLUENCERS=0,f.BonesPerMesh=0,void 0!==f.BONETEXTURE&&(f.BONETEXTURE=!1)}(q,f),g&&function(q,f){const j=q.morphTargetManager;j?(f.MORPHTARGETS_UV=j.supportsUVs&&f.UV1,f.MORPHTARGETS_UV2=j.supportsUV2s&&f.UV2,f.MORPHTARGETS_TANGENT=j.supportsTangents&&f.TANGENT,f.MORPHTARGETS_NORMAL=j.supportsNormals&&f.NORMAL,f.MORPHTARGETS_POSITION=j.supportsPositions,f.MORPHTARGETS_COLOR=j.supportsColors,f.MORPHTARGETTEXTURE_HASUVS=j.hasUVs,f.MORPHTARGETTEXTURE_HASUV2S=j.hasUV2s,f.MORPHTARGETTEXTURE_HASTANGENTS=j.hasTangents,f.MORPHTARGETTEXTURE_HASNORMALS=j.hasNormals,f.MORPHTARGETTEXTURE_HASPOSITIONS=j.hasPositions,f.MORPHTARGETTEXTURE_HASCOLORS=j.hasColors,f.NUM_MORPH_INFLUENCERS=j.numMaxInfluencers||j.numInfluencers,f.MORPHTARGETS=f.NUM_MORPH_INFLUENCERS>0,f.MORPHTARGETS_TEXTURE=j.isUsingTextureForTargets):(f.MORPHTARGETS_UV=!1,f.MORPHTARGETS_UV2=!1,f.MORPHTARGETS_TANGENT=!1,f.MORPHTARGETS_NORMAL=!1,f.MORPHTARGETS_POSITION=!1,f.MORPHTARGETS_COLOR=!1,f.MORPHTARGETTEXTURE_HASUVS=!1,f.MORPHTARGETTEXTURE_HASUV2S=!1,f.MORPHTARGETTEXTURE_HASTANGENTS=!1,f.MORPHTARGETTEXTURE_HASNORMALS=!1,f.MORPHTARGETTEXTURE_HASPOSITIONS=!1,f.MORPHTARGETTEXTURE_HAS_COLORS=!1,f.MORPHTARGETS=!1,f.NUM_MORPH_INFLUENCERS=0)}(q,f),L&&function(q,f){const j=q.bakedVertexAnimationManager;f.BAKED_VERTEX_ANIMATION_TEXTURE=!(!j||!j.isEnabled)}(q,f),!0}function v(q,f){if(q.activeCamera){const j=f.MULTIVIEW;f.MULTIVIEW=null!==q.activeCamera.outputRenderTarget&&q.activeCamera.outputRenderTarget.getViewCount()>1,f.MULTIVIEW!=j&&f.markAsUnprocessed()}}function F(q,f,j){const d=f.ORDER_INDEPENDENT_TRANSPARENCY,g=f.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;f.ORDER_INDEPENDENT_TRANSPARENCY=q.useOrderIndependentTransparency&&j,f.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!q.getEngine().getCaps().textureFloatLinearFiltering,d===f.ORDER_INDEPENDENT_TRANSPARENCY&&g===f.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||f.markAsUnprocessed()}function M(q,f,j){const d=f.PREPASS;if(!f._arePrePassDirty)return;const g=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(q.prePassRenderer&&q.prePassRenderer.enabled&&j){f.PREPASS=!0,f.SCENE_MRT_COUNT=q.prePassRenderer.mrtCount,f.PREPASS_NORMAL_WORLDSPACE=q.prePassRenderer.generateNormalsInWorldSpace,f.PREPASS_COLOR=!0,f.PREPASS_COLOR_INDEX=0;for(let j=0;j<g.length;j++){const d=q.prePassRenderer.getIndex(g[j].type);-1!==d?(f[g[j].define]=!0,f[g[j].index]=d):f[g[j].define]=!1}}else{f.PREPASS=!1;for(let q=0;q<g.length;q++)f[g[q].define]=!1}f.PREPASS!=d&&(f.markAsUnprocessed(),f.markAsImageProcessingDirty())}function o(q,f,j,d){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5],L=arguments.length>6&&void 0!==arguments[6]&&arguments[6];g&&g.push("Light"+q),h||(f.push("vLightData"+q,"vLightDiffuse"+q,"vLightSpecular"+q,"vLightDirection"+q,"vLightWidth"+q,"vLightHeight"+q,"vLightFalloff"+q,"vLightGround"+q,"lightMatrix"+q,"shadowsInfo"+q,"depthValues"+q),j.push("shadowTexture"+q),j.push("depthTexture"+q),f.push("viewFrustumZ"+q,"cascadeBlendFactor"+q,"lightSizeUVCorrection"+q,"depthCorrection"+q,"penumbraDarkness"+q,"frustumLengths"+q),d&&(j.push("projectionLightTexture"+q),f.push("textureProjectionMatrix"+q)),L&&j.push("iesLightTexture"+q))}function b(q,f,j){let d,g,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(q.uniformsNames){const L=q;d=L.uniformsNames,g=L.uniformBuffersNames,f=L.samplers,j=L.defines,h=L.maxSimultaneousLights||0}else d=q,f||(f=[]);for(let L=0;L<h&&j["LIGHT"+L];L++)o(L,d,f,j["PROJECTEDLIGHTTEXTURE"+L],g,!1,j["IESLIGHTTEXTURE"+L]);j.NUM_MORPH_INFLUENCERS&&(d.push("morphTargetInfluences"),d.push("morphTargetCount")),j.BAKED_VERTEX_ANIMATION_TEXTURE&&(d.push("bakedVertexAnimationSettings"),d.push("bakedVertexAnimationTextureSizeInverted"),d.push("bakedVertexAnimationTime"),f.push("bakedVertexAnimationTexture"))}},11599:(q,f,j)=>{j.d(f,{d:()=>h});var d,g=j(10941);!function(q){q[q.Zero=0]="Zero",q[q.One=1]="One",q[q.MaxViewZ=2]="MaxViewZ"}(d||(d={}));class h{static CreateConfiguration(q){return h._Configurations[q]={defines:{},previousWorldMatrices:{},previousViewProjection:g.b.Zero(),currentViewProjection:g.b.Zero(),previousBones:{},lastUpdateFrameId:-1,excludedSkinnedMesh:[],reverseCulling:!1},h._Configurations[q]}static DeleteConfiguration(q){delete h._Configurations[q]}static GetConfiguration(q){return h._Configurations[q]}static AddUniformsAndSamplers(q,f){q.push("previousWorld","previousViewProjection","mPreviousBones")}static MarkAsDirty(q,f){for(const j of f)if(j.Qd)for(const f of j.Qd)f._removeDrawWrapper(q)}static PrepareDefines(q,f,j){if(!j._arePrePassDirty)return;const d=h._Configurations[q];if(!d)return;j.PREPASS=!0,j.PREPASS_COLOR=!1,j.PREPASS_COLOR_INDEX=-1;let g=0;for(let L=0;L<h.GeometryTextureDescriptions.length;L++){const q=h.GeometryTextureDescriptions[L],f=q.define,Q=q.defineIndex,H=d.defines[Q];void 0!==H?(j[f]=!0,j[Q]=H,g++):(j[f]=!1,delete j[Q])}j.SCENE_MRT_COUNT=g,j.BONES_VELOCITY_ENABLED=f.useBones&&f.computeBonesUsingShaders&&f.skeleton&&!f.skeleton.isUsingTextureForMatrices&&-1===d.excludedSkinnedMesh.indexOf(f)}static Bind(q,f,j,d,g){const L=h._Configurations[q];if(!L)return;const Q=j.eq(),H=Q.getEngine();if(L.reverseCulling&&H.setStateCullFaceType(Q._mirroredCameraPosition?g.cullBackFaces:!g.cullBackFaces),(void 0!==L.defines.PREPASS_VELOCITY_INDEX||void 0!==L.defines.PREPASS_VELOCITY_LINEAR_INDEX)&&(L.previousWorldMatrices[j.uniqueId]||(L.previousWorldMatrices[j.uniqueId]=d.clone()),L.previousViewProjection||(L.previousViewProjection=Q.getTransformMatrix().clone(),L.currentViewProjection=Q.getTransformMatrix().clone()),L.currentViewProjection.updateFlag!==Q.getTransformMatrix().updateFlag?(L.lastUpdateFrameId=H.frameId,L.previousViewProjection.H(L.currentViewProjection),L.currentViewProjection.H(Q.getTransformMatrix())):L.lastUpdateFrameId!==H.frameId&&(L.lastUpdateFrameId=H.frameId,L.previousViewProjection.H(L.currentViewProjection)),f.setMatrix("previousWorld",L.previousWorldMatrices[j.uniqueId]),f.setMatrix("previousViewProjection",L.previousViewProjection),L.previousWorldMatrices[j.uniqueId]=d.clone(),j.useBones&&j.computeBonesUsingShaders&&j.skeleton)){const q=j.skeleton;if(!q.isUsingTextureForMatrices||-1===f.getUniformIndex("boneTextureWidth")){const d=q.getTransformMatrices(j);d&&(L.previousBones[j.uniqueId]||(L.previousBones[j.uniqueId]=d.slice()),f.setMatrices("mPreviousBones",L.previousBones[j.uniqueId]),L.previousBones[j.uniqueId].set(d))}}}}h.GeometryTextureDescriptions=[{type:0,name:"Irradiance",clearType:0,define:"PREPASS_IRRADIANCE",defineIndex:"PREPASS_IRRADIANCE_INDEX"},{type:1,name:"WorldPosition",clearType:0,define:"PREPASS_POSITION",defineIndex:"PREPASS_POSITION_INDEX"},{type:2,name:"Velocity",clearType:0,define:"PREPASS_VELOCITY",defineIndex:"PREPASS_VELOCITY_INDEX"},{type:3,name:"Reflectivity",clearType:0,define:"PREPASS_REFLECTIVITY",defineIndex:"PREPASS_REFLECTIVITY_INDEX"},{type:5,name:"ViewDepth",clearType:2,define:"PREPASS_DEPTH",defineIndex:"PREPASS_DEPTH_INDEX"},{type:6,name:"ViewNormal",clearType:0,define:"PREPASS_NORMAL",defineIndex:"PREPASS_NORMAL_INDEX"},{type:7,name:"AlbedoSqrt",clearType:0,define:"PREPASS_ALBEDO_SQRT",defineIndex:"PREPASS_ALBEDO_SQRT_INDEX"},{type:8,name:"WorldNormal",clearType:0,define:"PREPASS_WORLD_NORMAL",defineIndex:"PREPASS_WORLD_NORMAL_INDEX"},{type:9,name:"LocalPosition",clearType:0,define:"PREPASS_LOCAL_POSITION",defineIndex:"PREPASS_LOCAL_POSITION_INDEX"},{type:10,name:"ScreenDepth",clearType:1,define:"PREPASS_SCREENSPACE_DEPTH",defineIndex:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:11,name:"LinearVelocity",clearType:0,define:"PREPASS_VELOCITY_LINEAR",defineIndex:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:12,name:"Albedo",clearType:0,define:"PREPASS_ALBEDO",defineIndex:"PREPASS_ALBEDO_INDEX"},{type:13,name:"NormalizedViewDepth",clearType:1,define:"PREPASS_NORMALIZED_VIEW_DEPTH",defineIndex:"PREPASS_NORMALIZED_VIEW_DEPTH_INDEX"}],h._Configurations={}},11551:(q,f,j)=>{j.d(f,{e:()=>O});var d=j(11125),g=j(11130),h=j(11118),L=j(10980),Q=j(11048),H=j(11075);const r=new RegExp("^([gimus]+)!");class u{constructor(q){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=q,this._scene=q.eq(),this._engine=this._scene.getEngine()}_addPlugin(q){for(let d=0;d<this._plugins.length;++d)if(this._plugins[d].name===q.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!q.isCompatible(this._material.shaderLanguage))throw`The plugin "${q.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const f=q.getClassName();u._MaterialPluginClassToMainDefine[f]||(u._MaterialPluginClassToMainDefine[f]="MATERIALPLUGIN_"+ ++u._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(q,f)=>this._handlePluginEvent(q,f),this._plugins.push(q),this._plugins.sort(((q,f)=>q.priority-f.priority)),this._codeInjectionPoints={};const j={};j[u._MaterialPluginClassToMainDefine[f]]={type:"boolean",default:!0};for(const d of this._plugins)d.collectDefines(j),this._collectPointNames("vertex",d.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",d.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=j,!0}_activatePlugin(q){-1===this._activePlugins.indexOf(q)&&(this._activePlugins.push(q),this._activePlugins.sort(((q,f)=>q.priority-f.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),q.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(q),this._activePluginsForExtraEvents.sort(((q,f)=>q.priority-f.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(q){for(let f=0;f<this._plugins.length;++f)if(this._plugins[f].name===q)return this._plugins[f];return null}_handlePluginEventIsReadyForSubMesh(q){let f=!0;for(const j of this._activePlugins)f=f&&j.isReadyForSubMesh(q.defines,this._scene,this._engine,q.subMesh);q.isReadyForSubMesh=f}_handlePluginEventPrepareDefinesBeforeAttributes(q){for(const f of this._activePlugins)f.prepareDefinesBeforeAttributes(q.defines,this._scene,q.mesh)}_handlePluginEventPrepareDefines(q){for(const f of this._activePlugins)f.prepareDefines(q.defines,this._scene,q.mesh)}_handlePluginEventHardBindForSubMesh(q){for(const f of this._activePluginsForExtraEvents)f.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,q.subMesh)}_handlePluginEventBindForSubMesh(q){for(const f of this._activePlugins)f.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,q.subMesh)}_handlePluginEventHasRenderTargetTextures(q){let f=!1;for(const j of this._activePluginsForExtraEvents)if(f=j.hasRenderTargetTextures(),f)break;q.hasRenderTargetTextures=f}_handlePluginEventFillRenderTargetTextures(q){for(const f of this._activePluginsForExtraEvents)f.fillRenderTargetTextures(q.renderTargets)}_handlePluginEvent(q,f){switch(q){case 512:{const q=f;for(const f of this._activePlugins)f.getActiveTextures(q.activeTextures);break}case 256:{const q=f;for(const f of this._activePlugins)f.getAnimatables(q.animatables);break}case 1024:{const q=f;let j=!1;for(const f of this._activePlugins)if(j=f.hasTexture(q.texture),j)break;q.hasTexture=j;break}case 2:{const q=f;for(const f of this._plugins)f.dispose(q.forceDisposeTextures);break}case 4:f.defineNames=this._defineNamesFromPlugins;break;case 128:{const q=f;for(const f of this._activePlugins)q.fallbackRank=f.addFallbacks(q.defines,q.fallbacks,q.fallbackRank),f.getAttributes(q.attributes,this._scene,q.mesh);this._uniformList.length>0&&q.uniforms.push(...this._uniformList),this._samplerList.length>0&&q.samplers.push(...this._samplerList),this._uboList.length>0&&q.uniformBuffersNames.push(...this._uboList),q.customCode=this._injectCustomCode(q,q.customCode);break}case 8:{const q=f;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const j=1===this._material.shaderLanguage;for(const f of this._plugins){const d=f.getUniforms(this._material.shaderLanguage);if(d){if(d.ubo)for(const f of d.ubo){if(f.size&&f.type){const d=f.arraySize??0;if(q.ubo.addUniform(f.name,f.size,d),j){let q;switch(f.type){case"mat4":q="mat4x4f";break;case"float":q="f32";break;default:q=`${f.type}f`}this._uboDeclaration+=d>0?`uniform ${f.name}: array<${q}, ${d}>;\n`:`uniform ${f.name}: ${q};\n`}else this._uboDeclaration+=`${f.type} ${f.name}${d>0?`[${d}]`:""};\n`}this._uniformList.push(f.name)}d.vertex&&(this._vertexDeclaration+=d.vertex+"\n"),d.fragment&&(this._fragmentDeclaration+=d.fragment+"\n")}f.getSamplers(this._samplerList),f.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(q,f){if(f)for(const j in f)this._codeInjectionPoints[q]||(this._codeInjectionPoints[q]={}),this._codeInjectionPoints[q][j]=!0}_injectCustomCode(q,f){return(j,d)=>{var g;f&&(d=f(j,d)),this._uboDeclaration&&(d=d.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(d=d.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(d=d.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const h=null===(g=this._codeInjectionPoints)||void 0===g?void 0:g[j];if(!h)return d;let L=null;for(let f in h){let g="";for(const d of this._activePlugins){var u;let h=null===(u=d.getCustomCode(j,this._material.shaderLanguage))||void 0===u?void 0:u[f];if(h){if(d.resolveIncludes){if(null===L){const f=0;L={defines:[],indexParameters:q.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:H.b.GetShadersRepository(f),includesShadersStore:H.b.GetIncludesShadersStore(f),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}L.isFragment="fragment"===j,(0,Q.g)(h,L,(q=>h=q))}g+=h+"\n"}}if(g.length>0)if("!"===f.charAt(0)){f=f.substring(1);let q="g";if("!"===f.charAt(0))q="",f=f.substring(1);else{const j=r.exec(f);j&&j.length>=2&&(q=j[1],f=f.substring(q.length+1))}q.indexOf("g")<0&&(q+="g");const j=d,h=new RegExp(f,q);let L=h.exec(j);for(;null!==L;){let q=g;for(let f=0;f<L.length;++f)q=q.replace("$"+f,L[f]);d=d.replace(L[0],q),L=h.exec(j)}}else{const q="#define "+f;d=d.replace(q,"\n"+g+"\n"+q)}}return d}}}u._MaterialPluginClassToMainDefine={},u._MaterialPluginCounter=0,L.d.OnEnginesDisposedObservable.add((()=>{D()}));const X=[];let z=!1,B=null;function D(){X.length=0,z=!1,h.b.OnEventObservable.remove(B),B=null}var i=j(11199),t=j(10965);class O{isCompatible(q){return 0===q}_enable(q){q&&this._pluginManager._activatePlugin(this)}constructor(q,f,j,d){let g=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],h=arguments.length>5&&void 0!==arguments[5]&&arguments[5],L=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this.doNotSerialize=!1,this._material=q,this.name=f,this.priority=j,this.resolveIncludes=L,q.pluginManager||(q.pluginManager=new u(q),q.qd.add((()=>{q.pluginManager=void 0}))),this._pluginDefineNames=d,this._pluginManager=q.pluginManager,g&&this._pluginManager._addPlugin(this),h&&this._enable(!0),this.markAllDefinesAsDirty=q._dirtyCallbacks[127]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(q,f,j,d){return!0}hardBindForSubMesh(q,f,j,d){}bindForSubMesh(q,f,j,d){}dispose(q){}getCustomCode(q){return null}collectDefines(q){if(this._pluginDefineNames)for(const f of Object.keys(this._pluginDefineNames)){if("_"===f[0])continue;const j=typeof this._pluginDefineNames[f];q[f]={type:"number"===j?"number":"string"===j?"string":"boolean"===j?"boolean":"object",default:this._pluginDefineNames[f]}}}prepareDefinesBeforeAttributes(q,f,j){}prepareDefines(q,f,j){}hasTexture(q){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(q){}getActiveTextures(q){}getAnimatables(q){}addFallbacks(q,f,j){return j}getSamplers(q){}getAttributes(q,f,j){}getUniformBuffersNames(q){}getUniforms(){return{}}copyTo(q){i.d.Clone((()=>q),this)}serialize(){return i.d.Serialize(this)}parse(q,f,j){i.d.Parse((()=>this),q,f,j)}}(0,d.b)([(0,g.O)()],O.prototype,"name",void 0),(0,d.b)([(0,g.O)()],O.prototype,"priority",void 0),(0,d.b)([(0,g.O)()],O.prototype,"resolveIncludes",void 0),(0,d.b)([(0,g.O)()],O.prototype,"registerForExtraEvents",void 0),(0,t.f)("BABYLON.MaterialPluginBase",O)},11320:(q,f,j)=>{j.d(f,{e:()=>L});var d=j(11118),g=j(11202),h=j(10965);class L extends d.b{get rd(){return this._subMaterials}set rd(q){this._subMaterials=q,this._hookArray(q)}getChildren(){return this.rd}constructor(q,f){super(q,f,!0),this._waitingSubMaterialsUniqueIds=[],this.eq().addMultiMaterial(this),this.rd=[],this._storeEffectOnSubMeshes=!0}_hookArray(q){var f=this;const j=q.push;q.push=function(){for(var d=arguments.length,g=new Array(d),h=0;h<d;h++)g[h]=arguments[h];const L=j.apply(q,g);return f._markAllSubMeshesAsTexturesDirty(),L};const d=q.splice;q.splice=(f,j)=>{const g=d.apply(q,[f,j]);return this._markAllSubMeshesAsTexturesDirty(),g}}getSubMaterial(q){return q<0||q>=this.rd.length?this.eq().defaultMaterial:this.rd[q]}getActiveTextures(){return super.getActiveTextures().concat(...this.rd.map((q=>q?q.getActiveTextures():[])))}hasTexture(q){if(super.hasTexture(q))return!0;for(let j=0;j<this.rd.length;j++){var f;if(null!==(f=this.rd[j])&&void 0!==f&&f.hasTexture(q))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(q,f,j){for(let d=0;d<this.rd.length;d++){const g=this.rd[d];if(g){if(g._storeEffectOnSubMeshes){if(!g.isReadyForSubMesh(q,f,j))return!1;continue}if(!g.isReady(q))return!1}}return!0}clone(q,f){const j=new L(q,this.eq());for(let d=0;d<this.rd.length;d++){let g=null;const h=this.rd[d];g=f&&h?h.clone(q+"-"+h.name):this.rd[d],j.rd.push(g)}return j}serialize(){const q={};q.name=this.name,q.id=this.id,q.uniqueId=this.uniqueId,g.c&&(q.tags=g.c.GetTags(this)),q.materialsUniqueIds=[],q.materials=[];for(let f=0;f<this.rd.length;f++){const j=this.rd[f];j?(q.materialsUniqueIds.push(j.uniqueId),q.materials.push(j.id)):(q.materialsUniqueIds.push(null),q.materials.push(null))}return q}dispose(q,f,j){const d=this.eq();if(!d)return;if(j)for(let h=0;h<this.rd.length;h++){const j=this.rd[h];j&&j.dispose(q,f)}const g=d.multiMaterials.indexOf(this);g>=0&&d.multiMaterials.splice(g,1),super.dispose(q,f)}static ParseMultiMaterial(q,f){const j=new L(q.name,f);if(j.id=q.id,j._loadedUniqueId=q.uniqueId,g.c&&g.c.AddTagsTo(j,q.tags),q.materialsUniqueIds)j._waitingSubMaterialsUniqueIds=q.materialsUniqueIds;else for(const d of q.materials)j.rd.push(f.getLastMaterialById(d));return j}}(0,h.f)("BABYLON.MultiMaterial",L)},11559:(q,f,j)=>{j.d(f,{e:()=>d});class d{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(q){q.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(q){}bindForSubMesh(q,f,j,d,g){if(f.prePassRenderer&&f.prePassRenderer.enabled&&f.prePassRenderer.currentRTisSceneRT&&(-1!==f.prePassRenderer.getIndex(2)||-1!==f.prePassRenderer.getIndex(11))){this.previousWorldMatrices[j.uniqueId]||(this.previousWorldMatrices[j.uniqueId]=d.clone()),this.previousViewProjection||(this.previousViewProjection=f.getTransformMatrix().clone(),this.currentViewProjection=f.getTransformMatrix().clone());const g=f.getEngine();this.currentViewProjection.updateFlag!==f.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=g.frameId,this.previousViewProjection.H(this.currentViewProjection),this.currentViewProjection.H(f.getTransformMatrix())):this._lastUpdateFrameId!==g.frameId&&(this._lastUpdateFrameId=g.frameId,this.previousViewProjection.H(this.currentViewProjection)),q.setMatrix("previousWorld",this.previousWorldMatrices[j.uniqueId]),q.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[j.uniqueId]=d.clone()}}}},11566:(q,f,j)=>{j.d(f,{b:()=>h});var d=j(10941),g=j(11118);class h extends g.b{constructor(q,f){let j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(q,f,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new d.b,this._storeEffectOnSubMeshes=j}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(q,f){return!!q&&(!this._storeEffectOnSubMeshes||(!q.Qd||0===q.Qd.length||this.isReadyForSubMesh(q,q.Qd[0],f)))}_isReadyForSubMesh(q){const f=q.materialDefines;return!(this.checkReadyOnEveryCall||!q.effect||!f||f._renderId!==this.eq().getRenderId())}bindOnlyWorldMatrix(q){this._activeEffect.setMatrix("world",q)}bindOnlyNormalMatrix(q){this._activeEffect.setMatrix("normalMatrix",q)}bind(q,f){f&&this.bindForSubMesh(q,f,f.Qd[0])}_afterBind(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2?arguments[2]:void 0;super._afterBind(q,f,j),this.eq()._cachedEffect=f,j?j._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return j._drawWrapper._forceRebindOnNextCall||q.isCachedMaterialInvalid(this,f,d)}dispose(q,f,j){this._activeEffect=void 0,super.dispose(q,f,j)}}},11642:(q,f,j)=>{j.d(f,{d:()=>t});var d=j(11199),g=j(11506),h=j(10941),L=j(11151),Q=j(11438),H=j(10965),r=j(11588),u=j(11021),X=j(11566),z=j(10980),B=j(11236),D=j(11219);const i={effect:null,subMesh:null};class t extends X.b{constructor(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(q,f,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new h.b,this._cachedWorldViewProjectionMatrix=new h.b,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=j,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","df","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...d}}get shaderPath(){return this._shaderPath}set shaderPath(q){this._shaderPath=q}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(q){-1===this._options.uniforms.indexOf(q)&&this._options.uniforms.push(q)}setTexture(q,f){return-1===this._options.samplers.indexOf(q)&&this._options.samplers.push(q),this._textures[q]=f,this}removeTexture(q){delete this._textures[q]}setTextureArray(q,f){return-1===this._options.samplers.indexOf(q)&&this._options.samplers.push(q),this._checkUniform(q),this._textureArrays[q]=f,this}setExternalTexture(q,f){return-1===this._options.externalTextures.indexOf(q)&&this._options.externalTextures.push(q),this._externalTextures[q]=f,this}setFloat(q,f){return this._checkUniform(q),this._floats[q]=f,this}setInt(q,f){return this._checkUniform(q),this._ints[q]=f,this}setUInt(q,f){return this._checkUniform(q),this._uints[q]=f,this}setFloats(q,f){return this._checkUniform(q),this._floatsArrays[q]=f,this}setColor3(q,f){return this._checkUniform(q),this._colors3[q]=f,this}setColor3Array(q,f){return this._checkUniform(q),this._colors3Arrays[q]=f.reduce(((q,f)=>(q.push(f.r,f.g,f.b),q)),[]),this}setColor4(q,f){return this._checkUniform(q),this._colors4[q]=f,this}setColor4Array(q,f){return this._checkUniform(q),this._colors4Arrays[q]=f.reduce(((q,f)=>(q.push(f.r,f.g,f.b,f.a),q)),[]),this}setVector2(q,f){return this._checkUniform(q),this._vectors2[q]=f,this}setVector3(q,f){return this._checkUniform(q),this._vectors3[q]=f,this}setVector4(q,f){return this._checkUniform(q),this._vectors4[q]=f,this}setQuaternion(q,f){return this._checkUniform(q),this._quaternions[q]=f,this}setQuaternionArray(q,f){return this._checkUniform(q),this._quaternionsArrays[q]=f.reduce(((q,f)=>(f.toArray(q,q.length),q)),[]),this}setMatrix(q,f){return this._checkUniform(q),this._matrices[q]=f,this}setMatrices(q,f){this._checkUniform(q);const j=new Float32Array(16*f.length);for(let d=0;d<f.length;d++){f[d].copyToArray(j,16*d)}return this._matrixArrays[q]=j,this}setMatrix3x3(q,f){return this._checkUniform(q),this._matrices3x3[q]=f,this}setMatrix2x2(q,f){return this._checkUniform(q),this._matrices2x2[q]=f,this}setArray2(q,f){return this._checkUniform(q),this._vectors2Arrays[q]=f,this}setArray3(q,f){return this._checkUniform(q),this._vectors3Arrays[q]=f,this}setArray4(q,f){return this._checkUniform(q),this._vectors4Arrays[q]=f,this}setUniformBuffer(q,f){return-1===this._options.uniformBuffers.indexOf(q)&&this._options.uniformBuffers.push(q),this._uniformBuffers[q]=f,this}setTextureSampler(q,f){return-1===this._options.samplerObjects.indexOf(q)&&this._options.samplerObjects.push(q),this._textureSamplers[q]=f,this}setStorageBuffer(q,f){return-1===this._options.storageBuffers.indexOf(q)&&this._options.storageBuffers.push(q),this._storageBuffers[q]=f,this}setDefine(q,f){const j=q.trimEnd()+" ",d=this.options.defines.findIndex((f=>f===q||f.startsWith(j)));return d>=0&&this.options.defines.splice(d,1),("boolean"!==typeof f||f)&&this.options.defines.push(j+f),this}isReadyForSubMesh(q,f,j){return this.isReady(q,j,f)}isReady(q,f,j){var d;const h=j&&this._storeEffectOnSubMeshes;if(this.isFrozen){const q=h?j._drawWrapper:this._drawWrapper;if(q.effect&&q._wasPreviouslyReady&&q._wasPreviouslyUsingInstances===f)return!0}const Q=this.eq(),H=Q.getEngine(),u=[],X=[];let z=null,t=this._shaderPath,O=this._options.uniforms,N=this._options.uniformBuffers,w=this._options.samplers;H.getCaps().multiview&&Q.activeCamera&&Q.activeCamera.outputRenderTarget&&Q.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,u.push("#define MULTIVIEW"),-1!==O.indexOf("viewProjection")&&-1===O.indexOf("viewProjectionR")&&O.push("viewProjectionR"));for(let g=0;g<this._options.defines.length;g++){const q=0===this._options.defines[g].indexOf("#define")?this._options.defines[g]:`#define ${this._options.defines[g]}`;u.push(q)}for(let g=0;g<this._options.attributes.length;g++)X.push(this._options.attributes[g]);if(q&&q.isVerticesDataPresent(L.i.ColorKind)&&(-1===X.indexOf(L.i.ColorKind)&&X.push(L.i.ColorKind),u.push("#define VERTEXCOLOR")),f&&(u.push("#define INSTANCES"),(0,D.bb)(X,this._materialHelperNeedsPreviousMatrices),null!==q&&void 0!==q&&q.hasThinInstances&&(u.push("#define THIN_INSTANCES"),q&&q.isVerticesDataPresent(L.i.ColorInstanceKind)&&(X.push(L.i.ColorInstanceKind),u.push("#define INSTANCESCOLOR")))),q&&q.useBones&&q.computeBonesUsingShaders&&q.skeleton){X.push(L.i.MatricesIndicesKind),X.push(L.i.MatricesWeightsKind),q.numBoneInfluencers>4&&(X.push(L.i.MatricesIndicesExtraKind),X.push(L.i.MatricesWeightsExtraKind));const f=q.skeleton;u.push("#define NUM_BONE_INFLUENCERS "+q.numBoneInfluencers),z=new r.d,z.addCPUSkinningFallback(0,q),f.isUsingTextureForMatrices?(u.push("#define BONETEXTURE"),-1===O.indexOf("boneTextureWidth")&&O.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(u.push("#define BonesPerMesh "+(f.bones.length+1)),-1===O.indexOf("mBones")&&O.push("mBones"))}else u.push("#define NUM_BONE_INFLUENCERS 0");let E=0;const s=q?q.morphTargetManager:null;if(s){const f=-1!==u.indexOf("#define UV1"),j=-1!==u.indexOf("#define UV2"),d=-1!==u.indexOf("#define TANGENT"),g=-1!==u.indexOf("#define NORMAL"),h=-1!==u.indexOf("#define VERTEXCOLOR");E=(0,D.G)(s,u,X,q,!0,g,d,f,j,h),s.isUsingTextureForTargets&&(-1===O.indexOf("morphTargetTextureIndices")&&O.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),E>0&&(O=O.slice(),O.push("morphTargetInfluences"),O.push("morphTargetCount"),O.push("morphTargetTextureInfo"),O.push("morphTargetTextureIndices"))}else u.push("#define NUM_MORPH_INFLUENCERS 0");if(q){const f=q.bakedVertexAnimationManager;f&&f.isEnabled&&(u.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===O.indexOf("bakedVertexAnimationSettings")&&O.push("bakedVertexAnimationSettings"),-1===O.indexOf("bakedVertexAnimationTextureSizeInverted")&&O.push("bakedVertexAnimationTextureSizeInverted"),-1===O.indexOf("bakedVertexAnimationTime")&&O.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,D.w)(X,q,u)}for(const g in this._textures)if(!this._textures[g].isReady())return!1;q&&this.needAlphaTestingForMesh(q)&&u.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,B.c)(O),(0,B.k)(this,Q,u)),Q.fogEnabled&&null!==q&&void 0!==q&&q.applyFog&&Q.fogMode!==g.b.FOGMODE_NONE&&(u.push("#define FOG"),-1===O.indexOf("view")&&O.push("view"),-1===O.indexOf("vFogInfos")&&O.push("vFogInfos"),-1===O.indexOf("vFogColor")&&O.push("vFogColor")),this._useLogarithmicDepth&&(u.push("#define LOGARITHMICDEPTH"),-1===O.indexOf("logarithmicDepthConstant")&&O.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(O=O.slice(),N=N.slice(),w=w.slice(),t=this.customShaderNameResolve(this.name,O,N,w,u,X));const S=h?j._getDrawWrapper(void 0,!0):this._drawWrapper,e=(null===S||void 0===S?void 0:S.effect)??null,Z=(null===S||void 0===S?void 0:S.defines)??null,I=u.join("\n");let T=e;return Z!==I&&(T=H.createEffect(t,{attributes:X,uniformsNames:O,uniformBuffersNames:N,samplers:w,defines:I,fallbacks:z,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:E},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},H),h?j.setEffect(T,I,this._materialContext):S&&S.setEffect(T,I),this._onEffectCreatedObservable&&(i.effect=T,i.subMesh=j??(null===q||void 0===q?void 0:q.Qd[0])??null,this._onEffectCreatedObservable.notifyObservers(i))),S._wasPreviouslyUsingInstances=!!f,!(null===(d=T)||void 0===d||!d.isReady())&&(e!==T&&Q.resetCachedMaterial(),S._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(q,f){const j=f??this.getEffect();if(!j)return;const d=this._options.uniforms;-1!==d.indexOf("world")&&j.setMatrix("world",q);const g=this.eq();-1!==d.indexOf("worldView")&&(q.multiplyToRef(g.getViewMatrix(),this._cachedWorldViewMatrix),j.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==d.indexOf("worldViewProjection")&&(q.multiplyToRef(g.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),j.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==d.indexOf("view")&&j.setMatrix("view",g.getViewMatrix())}bindForSubMesh(q,f,j){var d;this.bind(q,f,null===(d=j._drawWrapperOverride)||void 0===d?void 0:d.effect,j)}bind(q,f,j,d){const g=d&&this._storeEffectOnSubMeshes,h=j??(g?d.effect:this.getEffect());if(!h)return;const L=this.eq();this._activeEffect=h,this.bindOnlyWorldMatrix(q,j);const Q=this._options.uniformBuffers;let H=!1;if(h&&Q&&Q.length>0&&L.getEngine().supportsUniformBuffers)for(let X=0;X<Q.length;++X){switch(Q[X]){case"Mesh":f&&(f.getMeshUniformBuffer().bindToEffect(h,"Mesh"),f.transferToEffect(q));break;case"Scene":(0,D.p)(h,L.getSceneUniformBuffer()),L.finalizeSceneUbo(),H=!0}}const r=f&&g?this._mustRebind(L,h,d,f.visibility):L.getCachedMaterial()!==this;if(h&&r){let q;for(q in H||-1===this._options.uniforms.indexOf("view")||h.setMatrix("view",L.getViewMatrix()),H||-1===this._options.uniforms.indexOf("projection")||h.setMatrix("projection",L.getProjectionMatrix()),H||-1===this._options.uniforms.indexOf("viewProjection")||(h.setMatrix("viewProjection",L.getTransformMatrix()),this._multiview&&h.setMatrix("viewProjectionR",L._transformMatrixR)),L.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&h.setVector3("cameraPosition",L.activeCamera.globalPosition),(0,D.b)(f,h),(0,B.f)(h,this,L),this._useLogarithmicDepth&&(0,D.i)(g?d.materialDefines:h.defines,h,L),f&&(0,D.d)(L,f,h),this._textures)h.setTexture(q,this._textures[q]);for(q in this._textureArrays)h.setTextureArray(q,this._textureArrays[q]);for(q in this._ints)h.setInt(q,this._ints[q]);for(q in this._uints)h.setUInt(q,this._uints[q]);for(q in this._floats)h.setFloat(q,this._floats[q]);for(q in this._floatsArrays)h.setArray(q,this._floatsArrays[q]);for(q in this._colors3)h.setColor3(q,this._colors3[q]);for(q in this._colors3Arrays)h.setArray3(q,this._colors3Arrays[q]);for(q in this._colors4){const f=this._colors4[q];h.setFloat4(q,f.r,f.g,f.b,f.a)}for(q in this._colors4Arrays)h.setArray4(q,this._colors4Arrays[q]);for(q in this._vectors2)h.setVector2(q,this._vectors2[q]);for(q in this._vectors3)h.setVector3(q,this._vectors3[q]);for(q in this._vectors4)h.setVector4(q,this._vectors4[q]);for(q in this._quaternions)h.setQuaternion(q,this._quaternions[q]);for(q in this._matrices)h.setMatrix(q,this._matrices[q]);for(q in this._matrixArrays)h.setMatrices(q,this._matrixArrays[q]);for(q in this._matrices3x3)h.setMatrix3x3(q,this._matrices3x3[q]);for(q in this._matrices2x2)h.setMatrix2x2(q,this._matrices2x2[q]);for(q in this._vectors2Arrays)h.setArray2(q,this._vectors2Arrays[q]);for(q in this._vectors3Arrays)h.setArray3(q,this._vectors3Arrays[q]);for(q in this._vectors4Arrays)h.setArray4(q,this._vectors4Arrays[q]);for(q in this._quaternionsArrays)h.setArray4(q,this._quaternionsArrays[q]);for(q in this._uniformBuffers){const f=this._uniformBuffers[q].getBuffer();f&&h.bindUniformBuffer(f,q)}const j=L.getEngine(),Q=j.setExternalTexture;if(Q)for(q in this._externalTextures)Q.call(j,q,this._externalTextures[q]);const r=j.setTextureSampler;if(r)for(q in this._textureSamplers)r.call(j,q,this._textureSamplers[q]);const u=j.setStorageBuffer;if(u)for(q in this._storageBuffers)u.call(j,q,this._storageBuffers[q])}if(h&&f&&(r||!this.isFrozen)){(0,D.l)(f,h),f.morphTargetManager&&f.morphTargetManager.isUsingTextureForTargets&&f.morphTargetManager._bind(h);const q=f.bakedVertexAnimationManager;if(q&&q.isEnabled){var u;const q=g?d._drawWrapper:this._drawWrapper;null===(u=f.bakedVertexAnimationManager)||void 0===u||u.bind(h,!!q._wasPreviouslyUsingInstances)}}this._afterBind(f,h,d)}getActiveTextures(){const q=super.getActiveTextures();for(const f in this._textures)q.push(this._textures[f]);for(const f in this._textureArrays){const j=this._textureArrays[f];for(let f=0;f<j.length;f++)q.push(j[f])}return q}hasTexture(q){if(super.hasTexture(q))return!0;for(const f in this._textures)if(this._textures[f]===q)return!0;for(const f in this._textureArrays){const j=this._textureArrays[f];for(let f=0;f<j.length;f++)if(j[f]===q)return!0}return!1}clone(q){const f=d.d.Clone((()=>new t(q,this.eq(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);f.name=q,f.id=q,"object"===typeof f._shaderPath&&(f._shaderPath={...f._shaderPath}),this._options={...this._options};const j=Object.keys(this._options);for(const d of j){const q=this._options[d];Array.isArray(q)&&(this._options[d]=q.slice(0))}this.stencil.copyTo(f.stencil);for(const d in this._textures)f.setTexture(d,this._textures[d]);for(const d in this._textureArrays)f.setTextureArray(d,this._textureArrays[d]);for(const d in this._externalTextures)f.setExternalTexture(d,this._externalTextures[d]);for(const d in this._ints)f.setInt(d,this._ints[d]);for(const d in this._uints)f.setUInt(d,this._uints[d]);for(const d in this._floats)f.setFloat(d,this._floats[d]);for(const d in this._floatsArrays)f.setFloats(d,this._floatsArrays[d]);for(const d in this._colors3)f.setColor3(d,this._colors3[d]);for(const d in this._colors3Arrays)f._colors3Arrays[d]=this._colors3Arrays[d];for(const d in this._colors4)f.setColor4(d,this._colors4[d]);for(const d in this._colors4Arrays)f._colors4Arrays[d]=this._colors4Arrays[d];for(const d in this._vectors2)f.setVector2(d,this._vectors2[d]);for(const d in this._vectors3)f.setVector3(d,this._vectors3[d]);for(const d in this._vectors4)f.setVector4(d,this._vectors4[d]);for(const d in this._quaternions)f.setQuaternion(d,this._quaternions[d]);for(const d in this._quaternionsArrays)f._quaternionsArrays[d]=this._quaternionsArrays[d];for(const d in this._matrices)f.setMatrix(d,this._matrices[d]);for(const d in this._matrixArrays)f._matrixArrays[d]=this._matrixArrays[d].slice();for(const d in this._matrices3x3)f.setMatrix3x3(d,this._matrices3x3[d]);for(const d in this._matrices2x2)f.setMatrix2x2(d,this._matrices2x2[d]);for(const d in this._vectors2Arrays)f.setArray2(d,this._vectors2Arrays[d]);for(const d in this._vectors3Arrays)f.setArray3(d,this._vectors3Arrays[d]);for(const d in this._vectors4Arrays)f.setArray4(d,this._vectors4Arrays[d]);for(const d in this._uniformBuffers)f.setUniformBuffer(d,this._uniformBuffers[d]);for(const d in this._textureSamplers)f.setTextureSampler(d,this._textureSamplers[d]);for(const d in this._storageBuffers)f.setStorageBuffer(d,this._storageBuffers[d]);return f}dispose(q,f,j){if(f){let q;for(q in this._textures)this._textures[q].dispose();for(q in this._textureArrays){const f=this._textureArrays[q];for(let q=0;q<f.length;q++)f[q].dispose()}}this._textures={},super.dispose(q,f,j)}serialize(){const q=d.d.Serialize(this);let f;for(f in q.customType="BABYLON.ShaderMaterial",q.uniqueId=this.uniqueId,q.options=this._options,q.shaderPath=this._shaderPath,q.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,q.stencil=this.stencil.serialize(),q.textures={},this._textures)q.textures[f]=this._textures[f].serialize();for(f in q.textureArrays={},this._textureArrays){q.textureArrays[f]=[];const j=this._textureArrays[f];for(let d=0;d<j.length;d++)q.textureArrays[f].push(j[d].serialize())}for(f in q.ints={},this._ints)q.ints[f]=this._ints[f];for(f in q.uints={},this._uints)q.uints[f]=this._uints[f];for(f in q.floats={},this._floats)q.floats[f]=this._floats[f];for(f in q.floatsArrays={},this._floatsArrays)q.floatsArrays[f]=this._floatsArrays[f];for(f in q.colors3={},this._colors3){const j=this._colors3[f];q.colors3[f]=[j.r,j.g,j.b]}for(f in q.colors3Arrays={},this._colors3Arrays)q.colors3Arrays[f]=this._colors3Arrays[f];for(f in q.colors4={},this._colors4){const j=this._colors4[f];q.colors4[f]=[j.r,j.g,j.b,j.a]}for(f in q.colors4Arrays={},this._colors4Arrays)q.colors4Arrays[f]=this._colors4Arrays[f];for(f in q.vectors2={},this._vectors2){const j=this._vectors2[f];q.vectors2[f]=[j.x,j.y]}for(f in q.vectors3={},this._vectors3){const j=this._vectors3[f];q.vectors3[f]=[j.x,j.y,j.z]}for(f in q.vectors4={},this._vectors4){const j=this._vectors4[f];q.vectors4[f]=[j.x,j.y,j.z,j.w]}for(f in q.quaternions={},this._quaternions)q.quaternions[f]=this._quaternions[f].Yf();for(f in q.matrices={},this._matrices)q.matrices[f]=this._matrices[f].Yf();for(f in q.matrixArray={},this._matrixArrays)q.matrixArray[f]=this._matrixArrays[f];for(f in q.matrices3x3={},this._matrices3x3)q.matrices3x3[f]=this._matrices3x3[f];for(f in q.matrices2x2={},this._matrices2x2)q.matrices2x2[f]=this._matrices2x2[f];for(f in q.vectors2Arrays={},this._vectors2Arrays)q.vectors2Arrays[f]=this._vectors2Arrays[f];for(f in q.vectors3Arrays={},this._vectors3Arrays)q.vectors3Arrays[f]=this._vectors3Arrays[f];for(f in q.vectors4Arrays={},this._vectors4Arrays)q.vectors4Arrays[f]=this._vectors4Arrays[f];for(f in q.quaternionsArrays={},this._quaternionsArrays)q.quaternionsArrays[f]=this._quaternionsArrays[f];return q}static Parse(q,f,j){const g=d.d.Parse((()=>new t(q.name,f,q.shaderPath,q.options,q.storeEffectOnSubMeshes)),q,f,j);let L;for(L in q.stencil&&g.stencil.parse(q.stencil,f,j),q.textures)g.setTexture(L,Q.e.Parse(q.textures[L],f,j));for(L in q.textureArrays){const d=q.textureArrays[L],h=[];for(let q=0;q<d.length;q++)h.push(Q.e.Parse(d[q],f,j));g.setTextureArray(L,h)}for(L in q.ints)g.setInt(L,q.ints[L]);for(L in q.uints)g.setUInt(L,q.uints[L]);for(L in q.floats)g.setFloat(L,q.floats[L]);for(L in q.floatsArrays)g.setFloats(L,q.floatsArrays[L]);for(L in q.colors3){const f=q.colors3[L];g.setColor3(L,{r:f[0],g:f[1],b:f[2]})}for(L in q.colors3Arrays){const f=q.colors3Arrays[L].reduce(((q,f,j)=>(j%3===0?q.push([f]):q[q.length-1].push(f),q)),[]).map((q=>({r:q[0],g:q[1],b:q[2]})));g.setColor3Array(L,f)}for(L in q.colors4){const f=q.colors4[L];g.setColor4(L,{r:f[0],g:f[1],b:f[2],a:f[3]})}for(L in q.colors4Arrays){const f=q.colors4Arrays[L].reduce(((q,f,j)=>(j%4===0?q.push([f]):q[q.length-1].push(f),q)),[]).map((q=>({r:q[0],g:q[1],b:q[2],a:q[3]})));g.setColor4Array(L,f)}for(L in q.vectors2){const f=q.vectors2[L];g.setVector2(L,{x:f[0],y:f[1]})}for(L in q.vectors3){const f=q.vectors3[L];g.setVector3(L,{x:f[0],y:f[1],z:f[2]})}for(L in q.vectors4){const f=q.vectors4[L];g.setVector4(L,{x:f[0],y:f[1],z:f[2],w:f[3]})}for(L in q.quaternions)g.setQuaternion(L,h.e.Pf(q.quaternions[L]));for(L in q.matrices)g.setMatrix(L,h.b.Pf(q.matrices[L]));for(L in q.matrixArray)g._matrixArrays[L]=new Float32Array(q.matrixArray[L]);for(L in q.matrices3x3)g.setMatrix3x3(L,q.matrices3x3[L]);for(L in q.matrices2x2)g.setMatrix2x2(L,q.matrices2x2[L]);for(L in q.vectors2Arrays)g.setArray2(L,q.vectors2Arrays[L]);for(L in q.vectors3Arrays)g.setArray3(L,q.vectors3Arrays[L]);for(L in q.vectors4Arrays)g.setArray4(L,q.vectors4Arrays[L]);for(L in q.quaternionsArrays)g.setArray4(L,q.quaternionsArrays[L]);return g}static async ParseFromFileAsync(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return await new Promise(((g,h)=>{const L=new u.c;L.addEventListener("readystatechange",(()=>{if(4==L.readyState)if(200==L.status){const f=JSON.parse(L.responseText),h=this.Parse(f,j||z.d.LastCreatedScene,d);q&&(h.name=q),g(h)}else h("Unable to load the ShaderMaterial")})),L.open("GET",f),L.send()}))}static async ParseFromSnippetAsync(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return await new Promise(((d,g)=>{const h=new u.c;h.addEventListener("readystatechange",(()=>{if(4==h.readyState)if(200==h.status){const g=JSON.parse(JSON.parse(h.responseText).jsonPayload),L=JSON.parse(g.shaderMaterial),Q=this.Parse(L,f||z.d.LastCreatedScene,j);Q.snippetId=q,d(Q)}else g("Unable to load the snippet "+q)})),h.open("GET",this.SnippetUrl+"/"+q.replace(/#/g,"/")),h.send()}))}}t.SnippetUrl="https://snippet.babylonjs.com",t.CreateFromSnippetAsync=t.ParseFromSnippetAsync,(0,H.f)("BABYLON.ShaderMaterial",t)},11603:(q,f,j)=>{j.d(f,{b:()=>I});var d=j(11125),g=j(11130),h=j(11298),L=j(11506),Q=j(11210),H=j(11151),r=j(11559),u=j(11515),X=j(11118),z=j(11549),B=j(11566),D=j(11438),i=j(10965),t=j(11574),O=j(11588),N=j(11590),w=j(11236),E=j(11219),s=j(11199),S=j(11599);const e={effect:null,subMesh:null};class Z extends z.b{constructor(q){super(q),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(q){const f=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const j of f)this[j]=j===q}}class I extends B.b{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(q){this._attachImageProcessingConfiguration(q),this._markAllSubMeshesAsImageProcessingDirty()}_attachImageProcessingConfiguration(q){q!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=q||this.eq().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(q){this.imageProcessingConfiguration.colorCurvesEnabled=q}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(q){this.imageProcessingConfiguration.colorGradingEnabled=q}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(q){this._imageProcessingConfiguration.toneMappingEnabled=q}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(q){this._imageProcessingConfiguration.exposure=q}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(q){this._imageProcessingConfiguration.contrast=q}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(q){this._imageProcessingConfiguration.colorGradingTexture=q}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(q){this._imageProcessingConfiguration.colorCurves=q}get canRenderToMRT(){return!0}constructor(q,f){super(q,f,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||I.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new Q.c(0,0,0),this.diffuseColor=new Q.c(1,1,1),this.specularColor=new Q.c(1,1,1),this.emissiveColor=new Q.c(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new h.g(16),this._globalAmbientColor=new Q.c(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new N.d(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new r.e,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),I.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),I.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(I.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(I.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}getClassName(){return"Od"}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return this._hasTransparencyMode?this._transparencyModeIsTest:this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===X.b.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.Rf&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==X.b.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.Rf||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(q,f){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._uniformBufferLayoutBuilt||this.buildUniformLayout();const g=f._drawWrapper;if(g.effect&&this.isFrozen&&g._wasPreviouslyReady&&g._wasPreviouslyUsingInstances===d)return!0;f.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),f.materialDefines=new Z(this._eventInfo.defineNames));const h=this.eq(),L=f.materialDefines;if(this._isReadyForSubMesh(f))return!0;const Q=h.getEngine();L._needNormals=(0,E.M)(h,q,L,!0,this._maxSimultaneousLights,this._disableLighting),(0,E.V)(h,L);const X=this.needAlphaBlendingForMesh(q)&&this.eq().useOrderIndependentTransparency;if((0,E._)(h,L,this.canRenderToMRT&&!X),(0,E.X)(h,L,X),S.d.PrepareDefines(Q.currentRenderPassId,q,L),L._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,L._needUVs=!1;for(let q=1;q<=6;++q)L["MAINUV"+q]=!1;if(h.texturesEnabled){if(L.DIFFUSEDIRECTUV=0,L.BUMPDIRECTUV=0,L.AMBIENTDIRECTUV=0,L.OPACITYDIRECTUV=0,L.EMISSIVEDIRECTUV=0,L.SPECULARDIRECTUV=0,L.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&I.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,E.P)(this._diffuseTexture,L,"DIFFUSE")}else L.DIFFUSE=!1;if(this._ambientTexture&&I.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;(0,E.P)(this._ambientTexture,L,"AMBIENT")}else L.AMBIENT=!1;if(this._opacityTexture&&I.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;(0,E.P)(this._opacityTexture,L,"OPACITY"),L.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else L.OPACITY=!1;if(this._reflectionTexture&&I.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(L._needNormals=!0,L.REFLECTION=!0,L.ROUGHNESS=this._roughness>0,L.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,L.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===D.e.INVCUBIC_MODE,L.REFLECTIONMAP_3D=this._reflectionTexture.isCube,L.REFLECTIONMAP_OPPOSITEZ=L.REFLECTIONMAP_3D&&this.eq().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,L.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case D.e.EXPLICIT_MODE:L.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case D.e.PLANAR_MODE:L.setReflectionMode("REFLECTIONMAP_PLANAR");break;case D.e.PROJECTION_MODE:L.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case D.e.SKYBOX_MODE:L.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case D.e.SPHERICAL_MODE:L.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case D.e.EQUIRECTANGULAR_MODE:L.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case D.e.FIXED_EQUIRECTANGULAR_MODE:L.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case D.e.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:L.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case D.e.CUBIC_MODE:case D.e.INVCUBIC_MODE:default:L.setReflectionMode("REFLECTIONMAP_CUBIC")}L.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else L.REFLECTION=!1,L.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&I.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;(0,E.P)(this._emissiveTexture,L,"EMISSIVE")}else L.EMISSIVE=!1;if(this._lightmapTexture&&I.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;(0,E.P)(this._lightmapTexture,L,"LIGHTMAP"),L.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,L.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else L.LIGHTMAP=!1;if(this._specularTexture&&I.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;(0,E.P)(this._specularTexture,L,"SPECULAR"),L.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else L.SPECULAR=!1;if(h.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&I.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,E.P)(this._bumpTexture,L,"BUMP"),L.PARALLAX=this._useParallax,L.PARALLAX_RHS=h.useRightHandedSystem,L.PARALLAXOCCLUSION=this._useParallaxOcclusion,L.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else L.BUMP=!1,L.PARALLAX=!1,L.PARALLAX_RHS=!1,L.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&I.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;L._needUVs=!0,L.REFRACTION=!0,L.REFRACTIONMAP_3D=this._refractionTexture.isCube,L.RGBDREFRACTION=this._refractionTexture.isRGBD,L.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else L.REFRACTION=!1;L.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else L.DIFFUSE=!1,L.AMBIENT=!1,L.OPACITY=!1,L.REFLECTION=!1,L.EMISSIVE=!1,L.LIGHTMAP=!1,L.BUMP=!1,L.REFRACTION=!1;L.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),L.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,L.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,L.SPECULAROVERALPHA=this._useSpecularOverAlpha,L.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,L.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,L.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(q)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=L,this._eventInfo.subMesh=f,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(L._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(L),L.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,L.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(L._areFresnelDirty&&(I.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(L.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,L.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,L.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,L.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,L.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,L.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,L._needNormals=!0,L.FRESNEL=!0):L.FRESNEL=!1),L.AREALIGHTUSED)for(let j=0;j<q.lightSources.length;j++)if(!q.lightSources[j]._isReady())return!1;(0,E.R)(q,h,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(q),L,this._applyDecalMapAfterDetailMap),(0,E.K)(h,Q,this,L,d,null,f.getRenderingMesh().hasThinInstances),this._eventInfo.defines=L,this._eventInfo.mesh=q,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,E.I)(q,L,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let z=!1;if(L.isDirty){const d=L._areLightsDisposed;L.markAsProcessed();const g=new O.d;L.REFLECTION&&g.addFallback(0,"REFLECTION"),L.SPECULAR&&g.addFallback(0,"SPECULAR"),L.BUMP&&g.addFallback(0,"BUMP"),L.PARALLAX&&g.addFallback(1,"PARALLAX"),L.PARALLAX_RHS&&g.addFallback(1,"PARALLAX_RHS"),L.PARALLAXOCCLUSION&&g.addFallback(0,"PARALLAXOCCLUSION"),L.SPECULAROVERALPHA&&g.addFallback(0,"SPECULAROVERALPHA"),L.FOG&&g.addFallback(1,"FOG"),L.POINTSIZE&&g.addFallback(0,"POINTSIZE"),L.LOGARITHMICDEPTH&&g.addFallback(0,"LOGARITHMICDEPTH"),(0,E.s)(L,g,this._maxSimultaneousLights),L.SPECULARTERM&&g.addFallback(0,"SPECULARTERM"),L.DIFFUSEFRESNEL&&g.addFallback(1,"DIFFUSEFRESNEL"),L.OPACITYFRESNEL&&g.addFallback(2,"OPACITYFRESNEL"),L.REFLECTIONFRESNEL&&g.addFallback(3,"REFLECTIONFRESNEL"),L.EMISSIVEFRESNEL&&g.addFallback(4,"EMISSIVEFRESNEL"),L.FRESNEL&&g.addFallback(4,"FRESNEL"),L.MULTIVIEW&&g.addFallback(0,"MULTIVIEW");const X=[H.i.PositionKind];L.NORMAL&&X.push(H.i.NormalKind),L.TANGENT&&X.push(H.i.TangentKind);for(let q=1;q<=6;++q)L["UV"+q]&&X.push(`uv${1===q?"":q}`);L.VERTEXCOLOR&&X.push(H.i.ColorKind),(0,E.y)(X,q,L,g),(0,E.C)(X,L),(0,E.D)(X,q,L),(0,E.w)(X,q,L);let B="default";const D=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],i=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],t=["Material","Scene","Mesh"],N={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:L.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=g,this._eventInfo.fallbackRank=0,this._eventInfo.defines=L,this._eventInfo.uniforms=D,this._eventInfo.attributes=X,this._eventInfo.samplers=i,this._eventInfo.uniformBuffersNames=t,this._eventInfo.customCode=void 0,this._eventInfo.mesh=q,this._eventInfo.indexParameters=N,this._callbackPluginEventGeneric(128,this._eventInfo),S.d.AddUniformsAndSamplers(D,i),r.e.AddUniforms(D),r.e.AddSamplers(i),u.c&&(u.c.PrepareUniforms(D,L),u.c.PrepareSamplers(i,L)),(0,E.ab)({uniformsNames:D,uniformBuffersNames:t,samplers:i,defines:L,maxSimultaneousLights:this._maxSimultaneousLights}),(0,w.c)(D);const s={};this.customShaderNameResolve&&(B=this.customShaderNameResolve(B,D,t,i,L,X,s));const Z=L.toString(),I=f.effect;let T=h.getEngine().createEffect(B,{attributes:X,uniformsNames:D,uniformBuffersNames:t,samplers:i,defines:Z,fallbacks:g,onCompiled:this.onCompiled,onError:this.onError,indexParameters:N,processFinalCode:s.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:L.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([j.e(20),j.e(51)]).then(j.bind(j,14017)),Promise.all([j.e(18),j.e(52)]).then(j.bind(j,14029))]):await Promise.all([Promise.all([j.e(13),j.e(53)]).then(j.bind(j,14037)),Promise.all([j.e(12),j.e(54)]).then(j.bind(j,14053))]),this._shadersLoaded=!0}},Q);if(this._eventInfo.customCode=void 0,T)if(this._onEffectCreatedObservable&&(e.effect=T,e.subMesh=f,this._onEffectCreatedObservable.notifyObservers(e)),this.allowShaderHotSwapping&&I&&!T.isReady()){if(T=I,L.markAsUnprocessed(),z=this.isFrozen,d)return L._areLightsDisposed=!0,!1}else h.resetCachedMaterial(),f.setEffect(T,L,this._materialContext)}return!(!f.effect||!f.effect.isReady())&&(L._renderId=h.getRenderId(),g._wasPreviouslyReady=!z,g._wasPreviouslyUsingInstances=d,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const q=this._uniformBuffer;q.addUniform("diffuseLeftColor",4),q.addUniform("diffuseRightColor",4),q.addUniform("opacityParts",4),q.addUniform("reflectionLeftColor",4),q.addUniform("reflectionRightColor",4),q.addUniform("refractionLeftColor",4),q.addUniform("refractionRightColor",4),q.addUniform("emissiveLeftColor",4),q.addUniform("emissiveRightColor",4),q.addUniform("vDiffuseInfos",2),q.addUniform("vAmbientInfos",2),q.addUniform("vOpacityInfos",2),q.addUniform("vReflectionInfos",2),q.addUniform("vReflectionPosition",3),q.addUniform("vReflectionSize",3),q.addUniform("vEmissiveInfos",2),q.addUniform("vLightmapInfos",2),q.addUniform("vSpecularInfos",2),q.addUniform("vBumpInfos",3),q.addUniform("diffuseMatrix",16),q.addUniform("ambientMatrix",16),q.addUniform("opacityMatrix",16),q.addUniform("reflectionMatrix",16),q.addUniform("emissiveMatrix",16),q.addUniform("lightmapMatrix",16),q.addUniform("specularMatrix",16),q.addUniform("bumpMatrix",16),q.addUniform("vTangentSpaceParams",2),q.addUniform("pointSize",1),q.addUniform("alphaCutOff",1),q.addUniform("refractionMatrix",16),q.addUniform("vRefractionInfos",4),q.addUniform("vRefractionPosition",3),q.addUniform("vRefractionSize",3),q.addUniform("vSpecularColor",4),q.addUniform("vEmissiveColor",3),q.addUniform("vDiffuseColor",4),q.addUniform("vAmbientColor",3),q.addUniform("cameraInfo",4),super.buildUniformLayout()}bindForSubMesh(q,f,j){const d=this.eq(),g=j.materialDefines;if(!g)return;const h=j.effect;if(!h)return;this._activeEffect=h,f.getMeshUniformBuffer().bindToEffect(h,"Mesh"),f.transferToEffect(q),this._uniformBuffer.bindToEffect(h,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,d,f,q,this.isFrozen),S.d.Bind(d.getEngine().currentRenderPassId,this._activeEffect,f,q,this);const H=d.activeCamera;H?this._uniformBuffer.updateFloat4("cameraInfo",H.gd,H.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=j,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),g.OBJECTSPACE_NORMALMAP&&(q.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const r=this._mustRebind(d,h,j,f.visibility);(0,E.b)(f,h);const u=this._uniformBuffer;if(r){if(this.bindViewProjection(h),!u.useUbo||!this.isFrozen||!u.isSync||j._drawWrapper._forceRebindOnNextCall){if(I.FresnelEnabled&&g.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(u.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),u.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&u.updateColor4("opacityParts",new Q.c(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(u.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),u.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(u.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),u.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(u.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),u.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),d.texturesEnabled){if(this._diffuseTexture&&I.DiffuseTextureEnabled&&(u.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,E.q)(this._diffuseTexture,u,"diffuse")),this._ambientTexture&&I.AmbientTextureEnabled&&(u.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,E.q)(this._ambientTexture,u,"ambient")),this._opacityTexture&&I.OpacityTextureEnabled&&(u.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,E.q)(this._opacityTexture,u,"opacity")),this._hasAlphaChannel()&&u.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&I.ReflectionTextureEnabled){if(u.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),u.jd("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize){const q=this._reflectionTexture;u.updateVector3("vReflectionPosition",q.boundingBoxPosition),u.updateVector3("vReflectionSize",q.boundingBoxSize)}}else u.updateFloat2("vReflectionInfos",0,this.roughness);if(this._emissiveTexture&&I.EmissiveTextureEnabled&&(u.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,E.q)(this._emissiveTexture,u,"emissive")),this._lightmapTexture&&I.LightmapTextureEnabled&&(u.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,E.q)(this._lightmapTexture,u,"lightmap")),this._specularTexture&&I.SpecularTextureEnabled&&(u.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,E.q)(this._specularTexture,u,"specular")),this._bumpTexture&&d.getEngine().getCaps().standardDerivatives&&I.BumpTextureEnabled&&(u.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,E.q)(this._bumpTexture,u,"bump"),d._mirroredCameraPosition?u.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):u.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&I.RefractionTextureEnabled){let q=1;if(this._refractionTexture.isCube||(u.jd("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(q=this._refractionTexture.depth)),u.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,q,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const q=this._refractionTexture;u.updateVector3("vRefractionPosition",q.boundingBoxPosition),u.updateVector3("vRefractionSize",q.boundingBoxSize)}}}this.pointsCloud&&u.updateFloat("pointSize",this.pointSize),u.updateColor4("vSpecularColor",this.specularColor,this.specularPower),u.updateColor3("vEmissiveColor",I.EmissiveTextureEnabled?this.emissiveColor:Q.c.BlackReadOnly),u.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),d.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),u.updateColor3("vAmbientColor",this._globalAmbientColor)}d.texturesEnabled&&(this._diffuseTexture&&I.DiffuseTextureEnabled&&h.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&I.AmbientTextureEnabled&&h.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&I.OpacityTextureEnabled&&h.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&I.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?h.setTexture("reflectionCubeSampler",this._reflectionTexture):h.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&I.EmissiveTextureEnabled&&h.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&I.LightmapTextureEnabled&&h.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&I.SpecularTextureEnabled&&h.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&d.getEngine().getCaps().standardDerivatives&&I.BumpTextureEnabled&&h.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&I.RefractionTextureEnabled&&(this._refractionTexture.isCube?h.setTexture("refractionCubeSampler",this._refractionTexture):h.setTexture("refraction2DSampler",this._refractionTexture))),this.eq().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(f)&&this.eq().depthPeelingRenderer.bind(h),this._eventInfo.subMesh=j,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,w.f)(h,this,d),this.bindEyePosition(h)}else d.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(r||!this.isFrozen){var X;if(d.lightsEnabled&&!this._disableLighting&&(0,E.g)(d,f,h,g,this._maxSimultaneousLights),(d.fogEnabled&&f.applyFog&&d.fogMode!==L.b.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||f.receiveShadows||g.PREPASS)&&this.bindView(h),(0,E.d)(d,f,h),g.NUM_MORPH_INFLUENCERS&&(0,E.l)(f,h),g.BAKED_VERTEX_ANIMATION_TEXTURE)null===(X=f.bakedVertexAnimationManager)||void 0===X||X.bind(h,g.INSTANCES);this.useLogarithmicDepth&&(0,E.i)(g,h,d),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)}this._afterBind(f,this._activeEffect,j),u.update()}getAnimatables(){const q=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&q.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&q.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&q.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&q.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&q.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&q.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&q.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&q.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&q.push(this._refractionTexture),q}getActiveTextures(){const q=super.getActiveTextures();return this._diffuseTexture&&q.push(this._diffuseTexture),this._ambientTexture&&q.push(this._ambientTexture),this._opacityTexture&&q.push(this._opacityTexture),this._reflectionTexture&&q.push(this._reflectionTexture),this._emissiveTexture&&q.push(this._emissiveTexture),this._specularTexture&&q.push(this._specularTexture),this._bumpTexture&&q.push(this._bumpTexture),this._lightmapTexture&&q.push(this._lightmapTexture),this._refractionTexture&&q.push(this._refractionTexture),q}hasTexture(q){return!!super.hasTexture(q)||(this._diffuseTexture===q||(this._ambientTexture===q||(this._opacityTexture===q||(this._reflectionTexture===q||(this._emissiveTexture===q||(this._specularTexture===q||(this._bumpTexture===q||(this._lightmapTexture===q||this._refractionTexture===q))))))))}dispose(q,f){var j,d,g,h,L,Q,H,r,u;f&&(null===(j=this._diffuseTexture)||void 0===j||j.dispose(),null===(d=this._ambientTexture)||void 0===d||d.dispose(),null===(g=this._opacityTexture)||void 0===g||g.dispose(),null===(h=this._reflectionTexture)||void 0===h||h.dispose(),null===(L=this._emissiveTexture)||void 0===L||L.dispose(),null===(Q=this._specularTexture)||void 0===Q||Q.dispose(),null===(H=this._bumpTexture)||void 0===H||H.dispose(),null===(r=this._lightmapTexture)||void 0===r||r.dispose(),null===(u=this._refractionTexture)||void 0===u||u.dispose());this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(q,f)}clone(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const d=s.d.Clone((()=>new I(q,this.eq())),this,{cloneTexturesOnlyOnce:f});return d.name=q,d.id=q,this.stencil.copyTo(d.stencil),this._clonePlugins(d,j),d}static Parse(q,f,j){const d=s.d.Parse((()=>new I(q.name,f)),q,f,j);return q.stencil&&d.stencil.parse(q.stencil,f,j),X.b._ParsePlugins(q,d,f,j),d}static get DiffuseTextureEnabled(){return t.e.DiffuseTextureEnabled}static set DiffuseTextureEnabled(q){t.e.DiffuseTextureEnabled=q}static get DetailTextureEnabled(){return t.e.DetailTextureEnabled}static set DetailTextureEnabled(q){t.e.DetailTextureEnabled=q}static get AmbientTextureEnabled(){return t.e.AmbientTextureEnabled}static set AmbientTextureEnabled(q){t.e.AmbientTextureEnabled=q}static get OpacityTextureEnabled(){return t.e.OpacityTextureEnabled}static set OpacityTextureEnabled(q){t.e.OpacityTextureEnabled=q}static get ReflectionTextureEnabled(){return t.e.ReflectionTextureEnabled}static set ReflectionTextureEnabled(q){t.e.ReflectionTextureEnabled=q}static get EmissiveTextureEnabled(){return t.e.EmissiveTextureEnabled}static set EmissiveTextureEnabled(q){t.e.EmissiveTextureEnabled=q}static get SpecularTextureEnabled(){return t.e.SpecularTextureEnabled}static set SpecularTextureEnabled(q){t.e.SpecularTextureEnabled=q}static get BumpTextureEnabled(){return t.e.BumpTextureEnabled}static set BumpTextureEnabled(q){t.e.BumpTextureEnabled=q}static get LightmapTextureEnabled(){return t.e.LightmapTextureEnabled}static set LightmapTextureEnabled(q){t.e.LightmapTextureEnabled=q}static get RefractionTextureEnabled(){return t.e.RefractionTextureEnabled}static set RefractionTextureEnabled(q){t.e.RefractionTextureEnabled=q}static get ColorGradingTextureEnabled(){return t.e.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(q){t.e.ColorGradingTextureEnabled=q}static get FresnelEnabled(){return t.e.FresnelEnabled}static set FresnelEnabled(q){t.e.FresnelEnabled=q}}I.ForceGLSL=!1,(0,d.b)([(0,g.F)("diffuseTexture")],I.prototype,"_diffuseTexture",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],I.prototype,"diffuseTexture",void 0),(0,d.b)([(0,g.F)("ambientTexture")],I.prototype,"_ambientTexture",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"ambientTexture",void 0),(0,d.b)([(0,g.F)("opacityTexture")],I.prototype,"_opacityTexture",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],I.prototype,"opacityTexture",void 0),(0,d.b)([(0,g.F)("reflectionTexture")],I.prototype,"_reflectionTexture",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"reflectionTexture",void 0),(0,d.b)([(0,g.F)("emissiveTexture")],I.prototype,"_emissiveTexture",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"emissiveTexture",void 0),(0,d.b)([(0,g.F)("specularTexture")],I.prototype,"_specularTexture",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"specularTexture",void 0),(0,d.b)([(0,g.F)("bumpTexture")],I.prototype,"_bumpTexture",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"bumpTexture",void 0),(0,d.b)([(0,g.F)("lightmapTexture")],I.prototype,"_lightmapTexture",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"lightmapTexture",void 0),(0,d.b)([(0,g.F)("refractionTexture")],I.prototype,"_refractionTexture",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"refractionTexture",void 0),(0,d.b)([(0,g.i)("ambient")],I.prototype,"ambientColor",void 0),(0,d.b)([(0,g.i)("diffuse")],I.prototype,"diffuseColor",void 0),(0,d.b)([(0,g.i)("specular")],I.prototype,"specularColor",void 0),(0,d.b)([(0,g.i)("emissive")],I.prototype,"emissiveColor",void 0),(0,d.b)([(0,g.O)()],I.prototype,"specularPower",void 0),(0,d.b)([(0,g.O)("useAlphaFromDiffuseTexture")],I.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],I.prototype,"useAlphaFromDiffuseTexture",void 0),(0,d.b)([(0,g.O)("useEmissiveAsIllumination")],I.prototype,"_useEmissiveAsIllumination",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useEmissiveAsIllumination",void 0),(0,d.b)([(0,g.O)("linkEmissiveWithDiffuse")],I.prototype,"_linkEmissiveWithDiffuse",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"linkEmissiveWithDiffuse",void 0),(0,d.b)([(0,g.O)("useSpecularOverAlpha")],I.prototype,"_useSpecularOverAlpha",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useSpecularOverAlpha",void 0),(0,d.b)([(0,g.O)("useReflectionOverAlpha")],I.prototype,"_useReflectionOverAlpha",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useReflectionOverAlpha",void 0),(0,d.b)([(0,g.O)("disableLighting")],I.prototype,"_disableLighting",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsLightsDirty")],I.prototype,"disableLighting",void 0),(0,d.b)([(0,g.O)("useObjectSpaceNormalMap")],I.prototype,"_useObjectSpaceNormalMap",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useObjectSpaceNormalMap",void 0),(0,d.b)([(0,g.O)("useParallax")],I.prototype,"_useParallax",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useParallax",void 0),(0,d.b)([(0,g.O)("useParallaxOcclusion")],I.prototype,"_useParallaxOcclusion",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useParallaxOcclusion",void 0),(0,d.b)([(0,g.O)()],I.prototype,"parallaxScaleBias",void 0),(0,d.b)([(0,g.O)("roughness")],I.prototype,"_roughness",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"roughness",void 0),(0,d.b)([(0,g.O)()],I.prototype,"indexOfRefraction",void 0),(0,d.b)([(0,g.O)()],I.prototype,"invertRefractionY",void 0),(0,d.b)([(0,g.O)()],I.prototype,"alphaCutOff",void 0),(0,d.b)([(0,g.O)("useLightmapAsShadowmap")],I.prototype,"_useLightmapAsShadowmap",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useLightmapAsShadowmap",void 0),(0,d.b)([(0,g.p)("diffuseFresnelParameters")],I.prototype,"_diffuseFresnelParameters",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsFresnelDirty")],I.prototype,"diffuseFresnelParameters",void 0),(0,d.b)([(0,g.p)("opacityFresnelParameters")],I.prototype,"_opacityFresnelParameters",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsFresnelAndMiscDirty")],I.prototype,"opacityFresnelParameters",void 0),(0,d.b)([(0,g.p)("reflectionFresnelParameters")],I.prototype,"_reflectionFresnelParameters",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsFresnelDirty")],I.prototype,"reflectionFresnelParameters",void 0),(0,d.b)([(0,g.p)("refractionFresnelParameters")],I.prototype,"_refractionFresnelParameters",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsFresnelDirty")],I.prototype,"refractionFresnelParameters",void 0),(0,d.b)([(0,g.p)("emissiveFresnelParameters")],I.prototype,"_emissiveFresnelParameters",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsFresnelDirty")],I.prototype,"emissiveFresnelParameters",void 0),(0,d.b)([(0,g.O)("useReflectionFresnelFromSpecular")],I.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsFresnelDirty")],I.prototype,"useReflectionFresnelFromSpecular",void 0),(0,d.b)([(0,g.O)("useGlossinessFromSpecularMapAlpha")],I.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,d.b)([(0,g.O)("maxSimultaneousLights")],I.prototype,"_maxSimultaneousLights",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsLightsDirty")],I.prototype,"maxSimultaneousLights",void 0),(0,d.b)([(0,g.O)("invertNormalMapX")],I.prototype,"_invertNormalMapX",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"invertNormalMapX",void 0),(0,d.b)([(0,g.O)("invertNormalMapY")],I.prototype,"_invertNormalMapY",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"invertNormalMapY",void 0),(0,d.b)([(0,g.O)("twoSidedLighting")],I.prototype,"_twoSidedLighting",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"twoSidedLighting",void 0),(0,d.b)([(0,g.O)("applyDecalMapAfterDetailMap")],I.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,d.b)([(0,g.b)("_markAllSubMeshesAsMiscDirty")],I.prototype,"applyDecalMapAfterDetailMap",void 0),(0,i.f)("BABYLON.StandardMaterial",I),L.b.DefaultMaterialFactory=q=>new I("default material",q)},11190:(q,f,j)=>{j.d(f,{d:()=>h});var d=j(11005),g=j(10992);class h{constructor(q,f,j,d){let g=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._valueCache={},this._engine=q,this._noUBO=!q.supportsUniformBuffers||g,this._dynamic=j,this._name=d??"no-name",this._data=f||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.jd=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.jd=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get useUbo(){return!this._noUBO}get isSync(){return!this._needSync}isDynamic(){return void 0!==this._dynamic}getData(){return this._bufferData}getBuffer(){return this._buffer}_fillAlignment(q){let f;if(f=q<=2?q:4,this._uniformLocationPointer%f!==0){const q=this._uniformLocationPointer;this._uniformLocationPointer+=f-this._uniformLocationPointer%f;const j=this._uniformLocationPointer-q;for(let f=0;f<j;f++)this._data.push(0)}}addUniform(q,f){let j,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this._noUBO&&void 0===this._uniformLocations[q]){if(d>0){if(f instanceof Array)throw"addUniform should not be use with Array in UBO: "+q;if(this._fillAlignment(4),this._uniformArraySizes[q]={strideSize:f,arraySize:d},16==f)f*=d;else{f=f*d+(4-f)*d}j=[];for(let q=0;q<f;q++)j.push(0)}else{if(f instanceof Array)j=f,f=j.length;else{j=[];for(let q=0;q<f;q++)j.push(0)}this._fillAlignment(f)}this._uniformSizes[q]=f,this._uniformLocations[q]=this._uniformLocationPointer,this._uniformLocationPointer+=f;for(let q=0;q<f;q++)this._data.push(j[q]);this._needSync=!0}}addMatrix(q,f){this.addUniform(q,Array.prototype.slice.call(f.Yf()))}addFloat2(q,f,j){const d=[f,j];this.addUniform(q,d)}addFloat3(q,f,j,d){const g=[f,j,d];this.addUniform(q,g)}addColor3(q,f){const j=[f.r,f.g,f.b];this.addUniform(q,j)}addColor4(q,f,j){const d=[f.r,f.g,f.b,j];this.addUniform(q,d)}addVector3(q,f){const j=[f.x,f.y,f.z];this.addUniform(q,j)}addMatrix3x3(q){this.addUniform(q,12)}addMatrix2x2(q){this.addUniform(q,8)}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}_getNames(){const q=[];let f=0;for(const j in this._uniformLocations)if(q.push(j),10===++f)break;return q.join(",")}_rebuild(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}get _numBuffers(){return this._buffers.length}get _indexBuffer(){return this._bufferIndex}get name(){return this._name}get currentEffect(){return this._currentEffect}_buffersEqual(q,f){for(let j=0;j<q.length;++j)if(q[j]!==f[j])return!1;return!0}_copyBuffer(q,f){for(let j=0;j<q.length;++j)f[j]=q[j]}update(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(h._UpdatedUbosInFrame[this._name]||(h._UpdatedUbosInFrame[this._name]=0),h._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}updateUniform(q,f,j){this._checkNewFrame();let g=this._uniformLocations[q];if(void 0===g){if(this._buffer)return void d.e.Error("Cannot add an uniform after UBO has been created. uniformName="+q);this.addUniform(q,j),g=this._uniformLocations[q]}if(this._buffer||this.create(),this._dynamic)for(let d=0;d<j;d++)this._bufferData[g+d]=f[d];else{let q=!1;for(let d=0;d<j;d++)(16===j&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[g+d]!==Math.fround(f[d]))&&(q=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[g+d]=f[d]);this._needSync=this._needSync||q}}updateUniformArray(q,f,j){this._checkNewFrame();const h=this._uniformLocations[q];if(void 0===h)return void d.e.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");this._buffer||this.create();const L=this._uniformArraySizes[q];if(this._dynamic)for(let d=0;d<j;d++)this._bufferData[h+d]=f[d];else{let q=!1,d=0,Q=0;for(let H=0;H<j;H++)if(this._bufferData[h+4*Q+d]!==g.h.FloatRound(f[H])&&(q=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[h+4*Q+d]=f[H]),d++,d===L.strideSize){for(;d<4;d++)this._bufferData[h+4*Q+d]=0;d=0,Q++}this._needSync=this._needSync||q}}_cacheMatrix(q,f){this._checkNewFrame();const j=this._valueCache[q],d=f.updateFlag;return(void 0===j||j!==d)&&(this._valueCache[q]=d,!0)}_updateMatrix3x3ForUniform(q,f){for(let j=0;j<3;j++)h._TempBuffer[4*j]=f[3*j],h._TempBuffer[4*j+1]=f[3*j+1],h._TempBuffer[4*j+2]=f[3*j+2],h._TempBuffer[4*j+3]=0;this.updateUniform(q,h._TempBuffer,12)}_updateMatrix3x3ForEffect(q,f){this._currentEffect.setMatrix3x3(q,f)}_updateMatrix2x2ForEffect(q,f){this._currentEffect.setMatrix2x2(q,f)}_updateMatrix2x2ForUniform(q,f){for(let j=0;j<2;j++)h._TempBuffer[4*j]=f[2*j],h._TempBuffer[4*j+1]=f[2*j+1],h._TempBuffer[4*j+2]=0,h._TempBuffer[4*j+3]=0;this.updateUniform(q,h._TempBuffer,8)}_updateFloatForEffect(q,f){this._currentEffect.setFloat(q,f)}_updateFloatForUniform(q,f){h._TempBuffer[0]=f,this.updateUniform(q,h._TempBuffer,1)}_updateFloat2ForEffect(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setFloat2(q+d,f,j)}_updateFloat2ForUniform(q,f,j){h._TempBuffer[0]=f,h._TempBuffer[1]=j,this.updateUniform(q,h._TempBuffer,2)}_updateFloat3ForEffect(q,f,j,d){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setFloat3(q+g,f,j,d)}_updateFloat3ForUniform(q,f,j,d){h._TempBuffer[0]=f,h._TempBuffer[1]=j,h._TempBuffer[2]=d,this.updateUniform(q,h._TempBuffer,3)}_updateFloat4ForEffect(q,f,j,d,g){let h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setFloat4(q+h,f,j,d,g)}_updateFloat4ForUniform(q,f,j,d,g){h._TempBuffer[0]=f,h._TempBuffer[1]=j,h._TempBuffer[2]=d,h._TempBuffer[3]=g,this.updateUniform(q,h._TempBuffer,4)}_updateFloatArrayForEffect(q,f){this._currentEffect.setFloatArray(q,f)}_updateFloatArrayForUniform(q,f){this.updateUniformArray(q,f,f.length)}_updateArrayForEffect(q,f){this._currentEffect.setArray(q,f)}_updateArrayForUniform(q,f){this.updateUniformArray(q,f,f.length)}_updateIntArrayForEffect(q,f){this._currentEffect.setIntArray(q,f)}_updateIntArrayForUniform(q,f){h._TempBufferInt32View.set(f),this.updateUniformArray(q,h._TempBuffer,f.length)}_updateUIntArrayForEffect(q,f){this._currentEffect.setUIntArray(q,f)}_updateUIntArrayForUniform(q,f){h._TempBufferUInt32View.set(f),this.updateUniformArray(q,h._TempBuffer,f.length)}_updateMatrixForEffect(q,f){this._currentEffect.setMatrix(q,f)}_updateMatrixForUniform(q,f){this._cacheMatrix(q,f)&&this.updateUniform(q,f.Yf(),16)}_updateMatricesForEffect(q,f){this._currentEffect.setMatrices(q,f)}_updateMatricesForUniform(q,f){this.updateUniform(q,f,f.length)}_updateVector3ForEffect(q,f){this._currentEffect.setVector3(q,f)}_updateVector3ForUniform(q,f){h._TempBuffer[0]=f.x,h._TempBuffer[1]=f.y,h._TempBuffer[2]=f.z,this.updateUniform(q,h._TempBuffer,3)}_updateVector4ForEffect(q,f){this._currentEffect.setVector4(q,f)}_updateVector4ForUniform(q,f){h._TempBuffer[0]=f.x,h._TempBuffer[1]=f.y,h._TempBuffer[2]=f.z,h._TempBuffer[3]=f.w,this.updateUniform(q,h._TempBuffer,4)}_updateColor3ForEffect(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setColor3(q+j,f)}_updateColor3ForUniform(q,f){h._TempBuffer[0]=f.r,h._TempBuffer[1]=f.g,h._TempBuffer[2]=f.b,this.updateUniform(q,h._TempBuffer,3)}_updateColor4ForEffect(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setColor4(q+d,f,j)}_updateDirectColor4ForEffect(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setDirectColor4(q+j,f)}_updateColor4ForUniform(q,f,j){h._TempBuffer[0]=f.r,h._TempBuffer[1]=f.g,h._TempBuffer[2]=f.b,h._TempBuffer[3]=j,this.updateUniform(q,h._TempBuffer,4)}_updateDirectColor4ForUniform(q,f){h._TempBuffer[0]=f.r,h._TempBuffer[1]=f.g,h._TempBuffer[2]=f.b,h._TempBuffer[3]=f.a,this.updateUniform(q,h._TempBuffer,4)}_updateIntForEffect(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setInt(q+j,f)}_updateIntForUniform(q,f){h._TempBufferInt32View[0]=f,this.updateUniform(q,h._TempBuffer,1)}_updateInt2ForEffect(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setInt2(q+d,f,j)}_updateInt2ForUniform(q,f,j){h._TempBufferInt32View[0]=f,h._TempBufferInt32View[1]=j,this.updateUniform(q,h._TempBuffer,2)}_updateInt3ForEffect(q,f,j,d){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setInt3(q+g,f,j,d)}_updateInt3ForUniform(q,f,j,d){h._TempBufferInt32View[0]=f,h._TempBufferInt32View[1]=j,h._TempBufferInt32View[2]=d,this.updateUniform(q,h._TempBuffer,3)}_updateInt4ForEffect(q,f,j,d,g){let h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setInt4(q+h,f,j,d,g)}_updateInt4ForUniform(q,f,j,d,g){h._TempBufferInt32View[0]=f,h._TempBufferInt32View[1]=j,h._TempBufferInt32View[2]=d,h._TempBufferInt32View[3]=g,this.updateUniform(q,h._TempBuffer,4)}_updateUIntForEffect(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setUInt(q+j,f)}_updateUIntForUniform(q,f){h._TempBufferUInt32View[0]=f,this.updateUniform(q,h._TempBuffer,1)}_updateUInt2ForEffect(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setUInt2(q+d,f,j)}_updateUInt2ForUniform(q,f,j){h._TempBufferUInt32View[0]=f,h._TempBufferUInt32View[1]=j,this.updateUniform(q,h._TempBuffer,2)}_updateUInt3ForEffect(q,f,j,d){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setUInt3(q+g,f,j,d)}_updateUInt3ForUniform(q,f,j,d){h._TempBufferUInt32View[0]=f,h._TempBufferUInt32View[1]=j,h._TempBufferUInt32View[2]=d,this.updateUniform(q,h._TempBuffer,3)}_updateUInt4ForEffect(q,f,j,d,g){let h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setUInt4(q+h,f,j,d,g)}_updateUInt4ForUniform(q,f,j,d,g){h._TempBufferUInt32View[0]=f,h._TempBufferUInt32View[1]=j,h._TempBufferUInt32View[2]=d,h._TempBufferUInt32View[3]=g,this.updateUniform(q,h._TempBuffer,4)}setTexture(q,f){this._currentEffect.setTexture(q,f)}setTextureArray(q,f){this._currentEffect.setTextureArray(q,f)}bindTexture(q,f){this._currentEffect._bindTexture(q,f)}updateUniformDirectly(q,f){this.updateUniform(q,f,f.length),this.update()}bindToEffect(q,f){this._currentEffect=q,this._currentEffectName=f}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}setDataBuffer(q){if(!this._buffers)return this._buffer===q;for(let f=0;f<this._buffers.length;++f){if(this._buffers[f][0]===q)return this._bufferIndex=f,this._buffer=q,this._createBufferOnWrite=!1,this._currentEffect=void 0,this._buffers.length>1&&this._buffers[f][1]&&this._bufferData.set(this._buffers[f][1]),this._valueCache={},this._currentFrameId=this._engine.frameId,!0}return!1}dispose(){if(this._noUBO)return;const q=this._engine._uniformBuffers,f=q.indexOf(this);if(-1!==f&&(q[f]=q[q.length-1],q.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let j=0;j<this._buffers.length;++j){const q=this._buffers[j][0];this._engine._releaseBuffer(q)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}h._UpdatedUbosInFrame={},h._MAX_UNIFORM_SIZE=256,h._TempBuffer=new Float32Array(h._MAX_UNIFORM_SIZE),h._TempBufferInt32View=new Int32Array(h._TempBuffer.buffer),h._TempBufferUInt32View=new Uint32Array(h._TempBuffer.buffer)},11276:(q,f,j)=>{j.d(f,{e:()=>L,f:()=>d});var d,g,h=j(10941);!function(q){q[q.LOCAL=0]="LOCAL",q[q.WORLD=1]="WORLD",q[q.BONE=2]="BONE"}(d||(d={}));class L{}L.X=new h.j(1,0,0),L.Y=new h.j(0,1,0),L.Z=new h.j(0,0,1),function(q){q[q.X=0]="X",q[q.Y=1]="Y",q[q.Z=2]="Z"}(g||(g={}))},11210:(q,f,j)=>{j.d(f,{c:()=>X,e:()=>z,i:()=>B});var d=j(10958),g=j(10965),h=j(10950),L=j(10985);function Q(q){return Math.pow(q,h.k)}function H(q){return q<=.04045?.0773993808*q:Math.pow(.947867299*(q+.055),2.4)}function r(q){return Math.pow(q,h.j)}function u(q){return q<=.0031308?12.92*q:1.055*Math.pow(q,.41666)-.055}class X{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.r=q,this.g=f,this.b=j}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"o"}getHashCode(){let q=255*this.r|0;return q=397*q^255*this.g,q=397*q^255*this.b,q}toArray(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return q[f]=this.r,q[f+1]=this.g,q[f+2]=this.b,this}Zj(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return X.FromArrayToRef(q,f,this),this}toColor4(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new z(this.r,this.g,this.b,q)}Yf(){return[this.r,this.g,this.b]}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(q){return new X(this.r*q.r,this.g*q.g,this.b*q.b)}multiplyToRef(q,f){return f.r=this.r*q.r,f.g=this.g*q.g,f.b=this.b*q.b,f}multiplyInPlace(q){return this.r*=q.r,this.g*=q.g,this.b*=q.b,this}multiplyByFloats(q,f,j){return new X(this.r*q,this.g*f,this.b*j)}divide(q){throw new ReferenceError("Can not divide a color")}divideToRef(q,f){throw new ReferenceError("Can not divide a color")}divideInPlace(q){throw new ReferenceError("Can not divide a color")}minimizeInPlace(q){return this.minimizeInPlaceFromFloats(q.r,q.g,q.b)}maximizeInPlace(q){return this.maximizeInPlaceFromFloats(q.r,q.g,q.b)}minimizeInPlaceFromFloats(q,f,j){return this.r=Math.min(q,this.r),this.g=Math.min(f,this.g),this.b=Math.min(j,this.b),this}maximizeInPlaceFromFloats(q,f,j){return this.r=Math.max(q,this.r),this.g=Math.max(f,this.g),this.b=Math.max(j,this.b),this}floorToRef(q){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(q){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}equals(q){return q&&this.r===q.r&&this.g===q.g&&this.b===q.b}equalsFloats(q,f,j){return this.equalsToFloats(q,f,j)}equalsToFloats(q,f,j){return this.r===q&&this.g===f&&this.b===j}equalsWithEpsilon(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h.d;return(0,L.WithinEpsilon)(this.r,q.r,f)&&(0,L.WithinEpsilon)(this.g,q.g,f)&&(0,L.WithinEpsilon)(this.b,q.b,f)}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(q){throw new ReferenceError("Can not negate a color")}scale(q){return new X(this.r*q,this.g*q,this.b*q)}scaleInPlace(q){return this.r*=q,this.g*=q,this.b*=q,this}scaleToRef(q,f){return f.r=this.r*q,f.g=this.g*q,f.b=this.b*q,f}scaleAndAddToRef(q,f){return f.r+=this.r*q,f.g+=this.g*q,f.b+=this.b*q,f}clampToRef(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,j=arguments.length>2?arguments[2]:void 0;return j.r=(0,L.Clamp)(this.r,q,f),j.g=(0,L.Clamp)(this.g,q,f),j.b=(0,L.Clamp)(this.b,q,f),j}add(q){return new X(this.r+q.r,this.g+q.g,this.b+q.b)}addInPlace(q){return this.r+=q.r,this.g+=q.g,this.b+=q.b,this}addInPlaceFromFloats(q,f,j){return this.r+=q,this.g+=f,this.b+=j,this}addToRef(q,f){return f.r=this.r+q.r,f.g=this.g+q.g,f.b=this.b+q.b,f}ej(q){return new X(this.r-q.r,this.g-q.g,this.b-q.b)}subtractToRef(q,f){return f.r=this.r-q.r,f.g=this.g-q.g,f.b=this.b-q.b,f}eX(q){return this.r-=q.r,this.g-=q.g,this.b-=q.b,this}subtractFromFloats(q,f,j){return new X(this.r-q,this.g-f,this.b-j)}subtractFromFloatsToRef(q,f,j,d){return d.r=this.r-q,d.g=this.g-f,d.b=this.b-j,d}clone(){return new X(this.r,this.g,this.b)}H(q){return this.r=q.r,this.g=q.g,this.b=q.b,this}Af(q,f,j){return this.r=q,this.g=f,this.b=j,this}set(q,f,j){return this.Af(q,f,j)}cf(q){return this.r=this.g=this.b=q,this}toHexString(){const q=Math.round(255*this.r),f=Math.round(255*this.g),j=Math.round(255*this.b);return"#"+(0,L.ToHex)(q)+(0,L.ToHex)(f)+(0,L.ToHex)(j)}fromHexString(q){return"#"!==q.substring(0,1)||7!==q.length||(this.r=parseInt(q.substring(1,3),16)/255,this.g=parseInt(q.substring(3,5),16)/255,this.b=parseInt(q.substring(5,7),16)/255),this}toHSV(){return this.toHSVToRef(new X)}toHSVToRef(q){const f=this.r,j=this.g,d=this.b,g=Math.max(f,j,d),h=Math.min(f,j,d);let L=0,Q=0;const H=g,r=g-h;return 0!==g&&(Q=r/g),g!=h&&(g==f?(L=(j-d)/r,j<d&&(L+=6)):g==j?L=(d-f)/r+2:g==d&&(L=(f-j)/r+4),L*=60),q.r=L,q.g=Q,q.b=H,q}toLinearSpace(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const f=new X;return this.toLinearSpaceToRef(f,q),f}toLinearSpaceToRef(q){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(q.r=H(this.r),q.g=H(this.g),q.b=H(this.b)):(q.r=Q(this.r),q.g=Q(this.g),q.b=Q(this.b)),this}toGammaSpace(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const f=new X;return this.toGammaSpaceToRef(f,q),f}toGammaSpaceToRef(q){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(q.r=u(this.r),q.g=u(this.g),q.b=u(this.b)):(q.r=r(this.r),q.g=r(this.g),q.b=r(this.b)),this}static HSVtoRGBToRef(q,f,j,d){const g=j*f,h=q/60,L=g*(1-Math.abs(h%2-1));let Q=0,H=0,r=0;h>=0&&h<=1?(Q=g,H=L):h>=1&&h<=2?(Q=L,H=g):h>=2&&h<=3?(H=g,r=L):h>=3&&h<=4?(H=L,r=g):h>=4&&h<=5?(Q=L,r=g):h>=5&&h<=6&&(Q=g,r=L);const u=j-g;return d.r=Q+u,d.g=H+u,d.b=r+u,d}static FromHSV(q,f,j){const d=new X(0,0,0);return X.HSVtoRGBToRef(q,f,j,d),d}static FromHexString(q){return new X(0,0,0).fromHexString(q)}static Pf(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new X(q[f],q[f+1],q[f+2])}static FromArrayToRef(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2?arguments[2]:void 0;j.r=q[f],j.g=q[f+1],j.b=q[f+2]}static FromInts(q,f,j){return new X(q/255,f/255,j/255)}static Lerp(q,f,j){const d=new X(0,0,0);return X.LerpToRef(q,f,j,d),d}static LerpToRef(q,f,j,d){d.r=q.r+(f.r-q.r)*j,d.g=q.g+(f.g-q.g)*j,d.b=q.b+(f.b-q.b)*j}static Hermite(q,f,j,d,g){const h=g*g,L=g*h,Q=2*L-3*h+1,H=-2*L+3*h,r=L-2*h+g,u=L-h,z=q.r*Q+j.r*H+f.r*r+d.r*u,B=q.g*Q+j.g*H+f.g*r+d.g*u,D=q.b*Q+j.b*H+f.b*r+d.b*u;return new X(z,B,D)}static Hermite1stDerivative(q,f,j,d,g){const h=X.Black();return this.Hermite1stDerivativeToRef(q,f,j,d,g,h),h}static Hermite1stDerivativeToRef(q,f,j,d,g,h){const L=g*g;h.r=6*(L-g)*q.r+(3*L-4*g+1)*f.r+6*(-L+g)*j.r+(3*L-2*g)*d.r,h.g=6*(L-g)*q.g+(3*L-4*g+1)*f.g+6*(-L+g)*j.g+(3*L-2*g)*d.g,h.b=6*(L-g)*q.b+(3*L-4*g+1)*f.b+6*(-L+g)*j.b+(3*L-2*g)*d.b}static Red(){return new X(1,0,0)}static Green(){return new X(0,1,0)}static Blue(){return new X(0,0,1)}static Black(){return new X(0,0,0)}static get BlackReadOnly(){return X._BlackReadOnly}static White(){return new X(1,1,1)}static Purple(){return new X(.5,0,.5)}static Magenta(){return new X(1,0,1)}static Yellow(){return new X(1,1,0)}static Gray(){return new X(.5,.5,.5)}static Teal(){return new X(0,1,1)}static Random(){return new X(Math.random(),Math.random(),Math.random())}}X._V8PerformanceHack=new X(.5,.5,.5),X._BlackReadOnly=X.Black(),Object.defineProperties(X.prototype,{dimension:{value:[3]},rank:{value:1}});class z{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=q,this.g=f,this.b=j,this.a=d}Yf(){return[this.r,this.g,this.b,this.a]}toArray(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return q[f]=this.r,q[f+1]=this.g,q[f+2]=this.b,q[f+3]=this.a,this}Zj(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=q[f],this.g=q[f+1],this.b=q[f+2],this.a=q[f+3],this}equals(q){return q&&this.r===q.r&&this.g===q.g&&this.b===q.b&&this.a===q.a}add(q){return new z(this.r+q.r,this.g+q.g,this.b+q.b,this.a+q.a)}addToRef(q,f){return f.r=this.r+q.r,f.g=this.g+q.g,f.b=this.b+q.b,f.a=this.a+q.a,f}addInPlace(q){return this.r+=q.r,this.g+=q.g,this.b+=q.b,this.a+=q.a,this}addInPlaceFromFloats(q,f,j,d){return this.r+=q,this.g+=f,this.b+=j,this.a+=d,this}ej(q){return new z(this.r-q.r,this.g-q.g,this.b-q.b,this.a-q.a)}subtractToRef(q,f){return f.r=this.r-q.r,f.g=this.g-q.g,f.b=this.b-q.b,f.a=this.a-q.a,f}eX(q){return this.r-=q.r,this.g-=q.g,this.b-=q.b,this.a-=q.a,this}subtractFromFloats(q,f,j,d){return new z(this.r-q,this.g-f,this.b-j,this.a-d)}subtractFromFloatsToRef(q,f,j,d,g){return g.r=this.r-q,g.g=this.g-f,g.b=this.b-j,g.a=this.a-d,g}scale(q){return new z(this.r*q,this.g*q,this.b*q,this.a*q)}scaleInPlace(q){return this.r*=q,this.g*=q,this.b*=q,this.a*=q,this}scaleToRef(q,f){return f.r=this.r*q,f.g=this.g*q,f.b=this.b*q,f.a=this.a*q,f}scaleAndAddToRef(q,f){return f.r+=this.r*q,f.g+=this.g*q,f.b+=this.b*q,f.a+=this.a*q,f}clampToRef(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,j=arguments.length>2?arguments[2]:void 0;return j.r=(0,L.Clamp)(this.r,q,f),j.g=(0,L.Clamp)(this.g,q,f),j.b=(0,L.Clamp)(this.b,q,f),j.a=(0,L.Clamp)(this.a,q,f),j}multiply(q){return new z(this.r*q.r,this.g*q.g,this.b*q.b,this.a*q.a)}multiplyToRef(q,f){return f.r=this.r*q.r,f.g=this.g*q.g,f.b=this.b*q.b,f.a=this.a*q.a,f}multiplyInPlace(q){return this.r*=q.r,this.g*=q.g,this.b*=q.b,this.a*=q.a,this}multiplyByFloats(q,f,j,d){return new z(this.r*q,this.g*f,this.b*j,this.a*d)}divide(q){throw new ReferenceError("Can not divide a color")}divideToRef(q,f){throw new ReferenceError("Can not divide a color")}divideInPlace(q){throw new ReferenceError("Can not divide a color")}minimizeInPlace(q){return this.r=Math.min(this.r,q.r),this.g=Math.min(this.g,q.g),this.b=Math.min(this.b,q.b),this.a=Math.min(this.a,q.a),this}maximizeInPlace(q){return this.r=Math.max(this.r,q.r),this.g=Math.max(this.g,q.g),this.b=Math.max(this.b,q.b),this.a=Math.max(this.a,q.a),this}minimizeInPlaceFromFloats(q,f,j,d){return this.r=Math.min(q,this.r),this.g=Math.min(f,this.g),this.b=Math.min(j,this.b),this.a=Math.min(d,this.a),this}maximizeInPlaceFromFloats(q,f,j,d){return this.r=Math.max(q,this.r),this.g=Math.max(f,this.g),this.b=Math.max(j,this.b),this.a=Math.max(d,this.a),this}floorToRef(q){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(q){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(q){throw new ReferenceError("Can not negate a color")}equalsWithEpsilon(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h.d;return(0,L.WithinEpsilon)(this.r,q.r,f)&&(0,L.WithinEpsilon)(this.g,q.g,f)&&(0,L.WithinEpsilon)(this.b,q.b,f)&&(0,L.WithinEpsilon)(this.a,q.a,f)}equalsToFloats(q,f,j,d){return this.r===q&&this.g===f&&this.b===j&&this.a===d}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"wd"}getHashCode(){let q=255*this.r|0;return q=397*q^255*this.g,q=397*q^255*this.b,q=397*q^255*this.a,q}clone(){return(new z).H(this)}H(q){return this.r=q.r,this.g=q.g,this.b=q.b,this.a=q.a,this}Af(q,f,j,d){return this.r=q,this.g=f,this.b=j,this.a=d,this}set(q,f,j,d){return this.Af(q,f,j,d)}cf(q){return this.r=this.g=this.b=this.a=q,this}toHexString(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const f=Math.round(255*this.r),j=Math.round(255*this.g),d=Math.round(255*this.b);if(q)return"#"+(0,L.ToHex)(f)+(0,L.ToHex)(j)+(0,L.ToHex)(d);const g=Math.round(255*this.a);return"#"+(0,L.ToHex)(f)+(0,L.ToHex)(j)+(0,L.ToHex)(d)+(0,L.ToHex)(g)}fromHexString(q){return"#"!==q.substring(0,1)||9!==q.length&&7!==q.length||(this.r=parseInt(q.substring(1,3),16)/255,this.g=parseInt(q.substring(3,5),16)/255,this.b=parseInt(q.substring(5,7),16)/255,9===q.length&&(this.a=parseInt(q.substring(7,9),16)/255)),this}toLinearSpace(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const f=new z;return this.toLinearSpaceToRef(f,q),f}toLinearSpaceToRef(q){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(q.r=H(this.r),q.g=H(this.g),q.b=H(this.b)):(q.r=Q(this.r),q.g=Q(this.g),q.b=Q(this.b)),q.a=this.a,this}toGammaSpace(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const f=new z;return this.toGammaSpaceToRef(f,q),f}toGammaSpaceToRef(q){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(q.r=u(this.r),q.g=u(this.g),q.b=u(this.b)):(q.r=r(this.r),q.g=r(this.g),q.b=r(this.b)),q.a=this.a,this}static FromHexString(q){return"#"!==q.substring(0,1)||9!==q.length&&7!==q.length?new z(0,0,0,0):new z(0,0,0,1).fromHexString(q)}static Lerp(q,f,j){return z.LerpToRef(q,f,j,new z)}static LerpToRef(q,f,j,d){return d.r=q.r+(f.r-q.r)*j,d.g=q.g+(f.g-q.g)*j,d.b=q.b+(f.b-q.b)*j,d.a=q.a+(f.a-q.a)*j,d}static Hermite(q,f,j,d,g){const h=g*g,L=g*h,Q=2*L-3*h+1,H=-2*L+3*h,r=L-2*h+g,u=L-h,X=q.r*Q+j.r*H+f.r*r+d.r*u,B=q.g*Q+j.g*H+f.g*r+d.g*u,D=q.b*Q+j.b*H+f.b*r+d.b*u,i=q.a*Q+j.a*H+f.a*r+d.a*u;return new z(X,B,D,i)}static Hermite1stDerivative(q,f,j,d,g){const h=new z;return this.Hermite1stDerivativeToRef(q,f,j,d,g,h),h}static Hermite1stDerivativeToRef(q,f,j,d,g,h){const L=g*g;h.r=6*(L-g)*q.r+(3*L-4*g+1)*f.r+6*(-L+g)*j.r+(3*L-2*g)*d.r,h.g=6*(L-g)*q.g+(3*L-4*g+1)*f.g+6*(-L+g)*j.g+(3*L-2*g)*d.g,h.b=6*(L-g)*q.b+(3*L-4*g+1)*f.b+6*(-L+g)*j.b+(3*L-2*g)*d.b,h.a=6*(L-g)*q.a+(3*L-4*g+1)*f.a+6*(-L+g)*j.a+(3*L-2*g)*d.a}static FromColor3(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new z(q.r,q.g,q.b,f)}static Pf(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new z(q[f],q[f+1],q[f+2],q[f+3])}static FromArrayToRef(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2?arguments[2]:void 0;j.r=q[f],j.g=q[f+1],j.b=q[f+2],j.a=q[f+3]}static FromInts(q,f,j,d){return new z(q/255,f/255,j/255,d/255)}static CheckColors4(q,f){if(q.length===3*f){const f=[];for(let j=0;j<q.length;j+=3){const d=j/3*4;f[d]=q[j],f[d+1]=q[j+1],f[d+2]=q[j+2],f[d+3]=1}return f}return q}}z._V8PerformanceHack=new z(.5,.5,.5,.5),Object.defineProperties(z.prototype,{dimension:{value:[4]},rank:{value:1}});class B{}B.o=(0,d.e)(3,X.Black),B.wd=(0,d.e)(3,(()=>new z(0,0,0,0))),(0,g.f)("BABYLON.Color3",X),(0,g.f)("BABYLON.Color4",z)},10950:(q,f,j)=>{j.d(f,{d:()=>L,h:()=>h,j:()=>d,k:()=>g});const d=1/2.2,g=2.2,h=(1+Math.sqrt(5))/2,L=.001},11303:(q,f,j)=>{j.d(f,{d:()=>g});var d=j(11193);class g{static GetPlanes(q){const f=[];for(let j=0;j<6;j++)f.push(new d.e(0,0,0,0));return g.GetPlanesToRef(q,f),f}static GetNearPlaneToRef(q,f){const j=q.m;f.df.x=j[3]+j[2],f.df.y=j[7]+j[6],f.df.z=j[11]+j[10],f.d=j[15]+j[14],f.normalize()}static GetFarPlaneToRef(q,f){const j=q.m;f.df.x=j[3]-j[2],f.df.y=j[7]-j[6],f.df.z=j[11]-j[10],f.d=j[15]-j[14],f.normalize()}static GetLeftPlaneToRef(q,f){const j=q.m;f.df.x=j[3]+j[0],f.df.y=j[7]+j[4],f.df.z=j[11]+j[8],f.d=j[15]+j[12],f.normalize()}static GetRightPlaneToRef(q,f){const j=q.m;f.df.x=j[3]-j[0],f.df.y=j[7]-j[4],f.df.z=j[11]-j[8],f.d=j[15]-j[12],f.normalize()}static GetTopPlaneToRef(q,f){const j=q.m;f.df.x=j[3]-j[1],f.df.y=j[7]-j[5],f.df.z=j[11]-j[9],f.d=j[15]-j[13],f.normalize()}static GetBottomPlaneToRef(q,f){const j=q.m;f.df.x=j[3]+j[1],f.df.y=j[7]+j[5],f.df.z=j[11]+j[9],f.d=j[15]+j[13],f.normalize()}static GetPlanesToRef(q,f){g.GetNearPlaneToRef(q,f[0]),g.GetFarPlaneToRef(q,f[1]),g.GetLeftPlaneToRef(q,f[2]),g.GetRightPlaneToRef(q,f[3]),g.GetTopPlaneToRef(q,f[4]),g.GetBottomPlaneToRef(q,f[5])}static IsPointInFrustum(q,f){for(let j=0;j<6;j++)if(f[j].dotCoordinate(q)<0)return!1;return!0}}},11177:(q,f,j)=>{j.d(f,{e:()=>Q,i:()=>H});var d=j(11125),g=j(10941),h=j(11130);class L{static extractMinAndMaxIndexed(q,f,j,d,g,h){for(let L=j;L<j+d;L++){const j=3*f[L],d=q[j],Q=q[j+1],H=q[j+2];g.minimizeInPlaceFromFloats(d,Q,H),h.maximizeInPlaceFromFloats(d,Q,H)}}static extractMinAndMax(q,f,j,d,g,h){for(let L=f,Q=f*d;L<f+j;L++,Q+=d){const f=q[Q],j=q[Q+1],d=q[Q+2];g.minimizeInPlaceFromFloats(f,j,d),h.maximizeInPlaceFromFloats(f,j,d)}}}function Q(q,f,j,d){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const Q=new g.j(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),H=new g.j(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return L.extractMinAndMaxIndexed(q,f,j,d,Q,H),h&&(Q.x-=Q.x*h.x+h.y,Q.y-=Q.y*h.x+h.y,Q.z-=Q.z*h.x+h.y,H.x+=H.x*h.x+h.y,H.y+=H.y*h.x+h.y,H.z+=H.z*h.x+h.y),{minimum:Q,maximum:H}}function H(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4?arguments[4]:void 0;const Q=new g.j(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),H=new g.j(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return h||(h=3),L.extractMinAndMax(q,f,j,h,Q,H),d&&(Q.x-=Q.x*d.x+d.y,Q.y-=Q.y*d.x+d.y,Q.z-=Q.z*d.x+d.y,H.x+=H.x*d.x+d.y,H.y+=H.y*d.x+d.y,H.z+=H.z*d.x+d.y),{minimum:Q,maximum:H}}(0,d.b)([h.c.filter((function(){for(var q=arguments.length,f=new Array(q),j=0;j<q;j++)f[j]=arguments[j];let[d,g]=f;return!Array.isArray(d)&&!Array.isArray(g)}))],L,"extractMinAndMaxIndexed",null),(0,d.b)([h.c.filter((function(){for(var q=arguments.length,f=new Array(q),j=0;j<q;j++)f[j]=arguments[j];let[d]=f;return!Array.isArray(d)}))],L,"extractMinAndMax",null)},11396:(q,f,j)=>{j.d(f,{e:()=>d.b,i:()=>d.e,k:()=>d.f,n:()=>d.j});j(11276),j(11210),j(10950),j(11303),j(11402),j(11193),j(11411);var d=j(10941);j(11300)},11402:(q,f,j)=>{j.d(f,{d:()=>Q,f:()=>z,j:()=>u,m:()=>X});var d,g=j(10985),h=j(10941),L=j(10950);!function(q){q[q.CW=0]="CW",q[q.CCW=1]="CCW"}(d||(d={}));class Q{static Interpolate(q,f,j,d,g){if(0===q)return 0;const h=1-3*d+3*f,L=3*d-6*f,Q=3*f;let H=q;for(let r=0;r<5;r++){const f=H*H;H-=(h*(f*H)+L*f+Q*H-q)*(1/(3*h*f+2*L*H+Q)),H=Math.min(1,Math.max(0,H))}return 3*Math.pow(1-H,2)*H*j+3*(1-H)*Math.pow(H,2)*g+Math.pow(H,3)}}class H{constructor(q){this._radians=q,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}static BetweenTwoPoints(q,f){const j=f.ej(q),d=Math.atan2(j.y,j.x);return new H(d)}static BetweenTwoVectors(q,f){let j=q.lengthSquared()*f.lengthSquared();if(0===j)return new H(Math.PI/2);j=Math.sqrt(j);let d=q.dot(f)/j;d=(0,g.Clamp)(d,-1,1);const h=Math.acos(d);return new H(h)}static FromRadians(q){return new H(q)}static FromDegrees(q){return new H(q*Math.PI/180)}}class r{constructor(q,f,j){this.startPoint=q,this.midPoint=f,this.endPoint=j;const d=Math.pow(f.x,2)+Math.pow(f.y,2),g=(Math.pow(q.x,2)+Math.pow(q.y,2)-d)/2,L=(d-Math.pow(j.x,2)-Math.pow(j.y,2))/2,Q=(q.x-f.x)*(f.y-j.y)-(f.x-j.x)*(q.y-f.y);this.centerPoint=new h.i((g*(f.y-j.y)-L*(q.y-f.y))/Q,((q.x-f.x)*L-(f.x-j.x)*g)/Q),this.radius=this.centerPoint.ej(this.startPoint).length(),this.startAngle=H.BetweenTwoPoints(this.centerPoint,this.startPoint);const r=this.startAngle.degrees();let u=H.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),X=H.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();u-r>180&&(u-=360),u-r<-180&&(u+=360),X-u>180&&(X-=360),X-u<-180&&(X+=360),this.orientation=u-r<0?0:1,this.angle=H.FromDegrees(0===this.orientation?r-X:X-r)}}class u{constructor(q,f){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new h.i(q,f))}addLineTo(q,f){if(this.closed)return this;const j=new h.i(q,f),d=this._points[this._points.length-1];return this._points.push(j),this._length+=j.ej(d).length(),this}addArcTo(q,f,j,d){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const L=this._points[this._points.length-1],Q=new h.i(q,f),H=new h.i(j,d),u=new r(L,Q,H);let X=u.angle.radians()/g;0===u.orientation&&(X*=-1);let z=u.startAngle.radians()+X;for(let h=0;h<g;h++){const q=Math.cos(z)*u.radius+u.centerPoint.x,f=Math.sin(z)*u.radius+u.centerPoint.y;this.addLineTo(q,f),z+=X}return this}addQuadraticCurveTo(q,f,j,d){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const h=(q,f,j,d)=>(1-q)*(1-q)*f+2*q*(1-q)*j+q*q*d,L=this._points[this._points.length-1];for(let Q=0;Q<=g;Q++){const H=Q/g,r=h(H,L.x,q,j),u=h(H,L.y,f,d);this.addLineTo(r,u)}return this}addBezierCurveTo(q,f,j,d,g,h){let L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:36;if(this.closed)return this;const Q=(q,f,j,d,g)=>(1-q)*(1-q)*(1-q)*f+3*q*(1-q)*(1-q)*j+3*q*q*(1-q)*d+q*q*q*g,H=this._points[this._points.length-1];for(let r=0;r<=L;r++){const u=r/L,X=Q(u,H.x,q,j,g),z=Q(u,H.y,f,d,h);this.addLineTo(X,z)}return this}isPointInside(q){let f=!1;const j=this._points.length;for(let d=j-1,g=0;g<j;d=g++){let j=this._points[d],h=this._points[g],L=h.x-j.x,Q=h.y-j.y;if(Math.abs(Q)>Number.EPSILON){if(Q<0&&(j=this._points[g],L=-L,h=this._points[d],Q=-Q),q.y<j.y||q.y>h.y)continue;if(q.y===j.y&&q.x===j.x)return!0;{const d=Q*(q.x-j.x)-L*(q.y-j.y);if(0===d)return!0;if(d<0)continue;f=!f}}else{if(q.y!==j.y)continue;if(h.x<=q.x&&q.x<=j.x||j.x<=q.x&&q.x<=h.x)return!0}}return f}close(){return this.closed=!0,this}length(){let q=this._length;if(this.closed){const f=this._points[this._points.length-1];q+=this._points[0].ej(f).length()}return q}area(){const q=this._points.length;let f=0;for(let j=q-1,d=0;d<q;j=d++)f+=this._points[j].x*this._points[d].y-this._points[d].x*this._points[j].y;return.5*f}getPoints(){return this._points}getPointAtLengthPosition(q){if(q<0||q>1)return h.i.Zero();const f=q*this.length();let j=0;for(let d=0;d<this._points.length;d++){const q=(d+1)%this._points.length,g=this._points[d],L=this._points[q].ej(g),Q=L.length()+j;if(f>=j&&f<=Q){const q=L.normalize(),d=f-j;return new h.i(g.x+q.x*d,g.y+q.y*d)}j=Q}return h.i.Zero()}static StartingAt(q,f){return new u(q,f)}}class X{constructor(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2?arguments[2]:void 0,d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.path=q,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:h.j.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:h.b.Identity()};for(let g=0;g<q.length;g++)this._curve[g]=q[g].clone();this._raw=j||!1,this._alignTangentsWithPath=d,this._compute(f,d)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(q){return this._updatePointAtData(q).point}getTangentAt(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(q,f),f?h.j.TransformCoordinates(h.j.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(q,f),f?h.j.TransformCoordinates(h.j.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(q,f),f?h.j.TransformCoordinates(h.j.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(q){return this.length()*q}getPreviousPointIndexAt(q){return this._updatePointAtData(q),this._pointAtData.previousPointArrayIndex}getSubPositionAt(q){return this._updatePointAtData(q),this._pointAtData.subPosition}getClosestPositionTo(q){let f=Number.MAX_VALUE,j=0;for(let d=0;d<this._curve.length-1;d++){const g=this._curve[d+0],L=this._curve[d+1].ej(g).normalize(),Q=this._distances[d+1]-this._distances[d+0],H=Math.min(Math.max(h.j.Dot(L,q.ej(g).normalize()),0)*h.j.Distance(g,q)/Q,1),r=h.j.Distance(g.add(L.scale(H*Q)),q);r<f&&(f=r,j=(this._distances[d+0]+Q*H)/this.length())}return j}slice(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(q<0&&(q=1- -1*q%1),f<0&&(f=1- -1*f%1),q>f){const j=q;q=f,f=j}const j=this.getCurve(),d=this.getPointAt(q);let g=this.getPreviousPointIndexAt(q);const h=this.getPointAt(f),L=this.getPreviousPointIndexAt(f)+1,Q=[];return 0!==q&&(g++,Q.push(d)),Q.push(...j.slice(g,L)),1===f&&1!==q||Q.push(h),new X(Q,this.getNormalAt(q),this._raw,this._alignTangentsWithPath)}update(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(let d=0;d<q.length;d++)this._curve[d].x=q[d].x,this._curve[d].y=q[d].y,this._curve[d].z=q[d].z;return this._compute(f,j),this}_compute(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const j=this._curve.length;if(j<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[j-1]=this._curve[j-1].ej(this._curve[j-2]),this._raw||this._tangents[j-1].normalize();const d=this._tangents[0],g=this._normalVector(d,q);let L,Q,H,r,u;this._normals[0]=g,this._raw||this._normals[0].normalize(),this._binormals[0]=h.j.Cross(d,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let X=1;X<j;X++)L=this._getLastNonNullVector(X),X<j-1&&(Q=this._getFirstNonNullVector(X),this._tangents[X]=f?Q:L.add(Q),this._tangents[X].normalize()),this._distances[X]=this._distances[X-1]+this._curve[X].ej(this._curve[X-1]).length(),H=this._tangents[X],u=this._binormals[X-1],this._normals[X]=h.j.Cross(u,H),this._raw||(0===this._normals[X].length()?(r=this._normals[X-1],this._normals[X]=r.clone()):this._normals[X].normalize()),this._binormals[X]=h.j.Cross(H,this._normals[X]),this._raw||this._binormals[X].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(q){let f=1,j=this._curve[q+f].ej(this._curve[q]);for(;0===j.length()&&q+f+1<this._curve.length;)f++,j=this._curve[q+f].ej(this._curve[q]);return j}_getLastNonNullVector(q){let f=1,j=this._curve[q].ej(this._curve[q-f]);for(;0===j.length()&&q>f+1;)f++,j=this._curve[q].ej(this._curve[q-f]);return j}_normalVector(q,f){let j,d=q.length();if(0===d&&(d=1),void 0===f||null===f){let f;f=(0,g.WithinEpsilon)(Math.abs(q.y)/d,1,L.d)?(0,g.WithinEpsilon)(Math.abs(q.x)/d,1,L.d)?(0,g.WithinEpsilon)(Math.abs(q.z)/d,1,L.d)?h.j.Zero():new h.j(0,0,1):new h.j(1,0,0):new h.j(0,-1,0),j=h.j.Cross(q,f)}else j=h.j.Cross(q,f),h.j.CrossToRef(j,q,j);return j.normalize(),j}_updatePointAtData(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._pointAtData.id===q)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=q;const j=this.getPoints();if(q<=0)return this._setPointAtData(0,0,j[0],0,f);if(q>=1)return this._setPointAtData(1,1,j[j.length-1],j.length-1,f);let d,g=j[0],L=0;const Q=q*this.length();for(let H=1;H<j.length;H++){d=j[H];const r=h.j.Distance(g,d);if(L+=r,L===Q)return this._setPointAtData(q,1,d,H,f);if(L>Q){const j=(L-Q)/r,h=g.ej(d),u=d.add(h.scaleInPlace(j));return this._setPointAtData(q,1-j,u,H-1,f)}g=d}return this._pointAtData}_setPointAtData(q,f,j,d,g){return this._pointAtData.point=j,this._pointAtData.position=q,this._pointAtData.subPosition=f,this._pointAtData.previousPointArrayIndex=d,this._pointAtData.interpolateReady=g,g&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=h.b.Identity();const q=this._pointAtData.previousPointArrayIndex;if(q!==this._tangents.length-1){const f=q+1,j=this._tangents[q].clone(),d=this._normals[q].clone(),g=this._binormals[q].clone(),L=this._tangents[f].clone(),Q=this._normals[f].clone(),H=this._binormals[f].clone(),r=h.e.RotationQuaternionFromAxis(d,g,j),u=h.e.RotationQuaternionFromAxis(Q,H,L);h.e.Slerp(r,u,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}class z{static CreateQuadraticBezier(q,f,j,d){d=d>2?d:3;const g=[],L=(q,f,j,d)=>(1-q)*(1-q)*f+2*q*(1-q)*j+q*q*d;for(let Q=0;Q<=d;Q++)g.push(new h.j(L(Q/d,q.x,f.x,j.x),L(Q/d,q.y,f.y,j.y),L(Q/d,q.z,f.z,j.z)));return new z(g)}static CreateCubicBezier(q,f,j,d,g){g=g>3?g:4;const L=[],Q=(q,f,j,d,g)=>(1-q)*(1-q)*(1-q)*f+3*q*(1-q)*(1-q)*j+3*q*q*(1-q)*d+q*q*q*g;for(let H=0;H<=g;H++)L.push(new h.j(Q(H/g,q.x,f.x,j.x,d.x),Q(H/g,q.y,f.y,j.y,d.y),Q(H/g,q.z,f.z,j.z,d.z)));return new z(L)}static CreateHermiteSpline(q,f,j,d,g){const L=[],Q=1/g;for(let H=0;H<=g;H++)L.push(h.j.Hermite(q,f,j,d,H*Q));return new z(L)}static CreateCatmullRomSpline(q,f,j){const d=[],g=1/f;let L=0;if(j){const j=q.length;for(let Q=0;Q<j;Q++){L=0;for(let H=0;H<f;H++)d.push(h.j.CatmullRom(q[Q%j],q[(Q+1)%j],q[(Q+2)%j],q[(Q+3)%j],L)),L+=g}d.push(d[0])}else{const j=[];j.push(q[0].clone()),Array.prototype.push.apply(j,q),j.push(q[q.length-1].clone());let Q=0;for(;Q<j.length-3;Q++){L=0;for(let q=0;q<f;q++)d.push(h.j.CatmullRom(j[Q],j[Q+1],j[Q+2],j[Q+3],L)),L+=g}Q--,d.push(h.j.CatmullRom(j[Q],j[Q+1],j[Q+2],j[Q+3],L))}return new z(d)}static ArcThru3Points(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,g=arguments.length>4&&void 0!==arguments[4]&&arguments[4],L=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const Q=[],H=f.ej(q),r=j.ej(f),u=q.ej(j),X=h.j.Cross(H,r),B=X.length();if(B<Math.pow(10,-8))return new z(Q);const D=H.lengthSquared(),i=r.lengthSquared(),t=u.lengthSquared(),O=X.lengthSquared(),N=.5*H.length()*r.length()*u.length()/B,w=-.5*i*h.j.Dot(H,u)/O,E=-.5*t*h.j.Dot(H,r)/O,s=-.5*D*h.j.Dot(r,u)/O,S=q.scale(w).add(f.scale(E)).add(j.scale(s)),e=q.ej(S).normalize(),Z=h.j.Cross(X,e).normalize();if(L){const f=2*Math.PI/d;for(let q=0;q<=2*Math.PI;q+=f)Q.push(S.add(e.scale(N*Math.cos(q)).add(Z.scale(N*Math.sin(q)))));Q.push(q)}else{const f=1/d;let L=0,H=h.j.Zero();do{H=S.add(e.scale(N*Math.cos(L)).add(Z.scale(N*Math.sin(L)))),Q.push(H),L+=f}while(!H.equalsWithEpsilon(j,N*f*1.1));Q.push(j),g&&Q.push(q)}return new z(Q)}constructor(q){this._length=0,this._points=q,this._length=this._computeLength(q)}getPoints(){return this._points}length(){return this._length}continue(q){const f=this._points[this._points.length-1],j=this._points.slice(),d=q.getPoints();for(let g=1;g<d.length;g++)j.push(d[g].ej(d[0]).add(f));return new z(j)}_computeLength(q){let f=0;for(let j=1;j<q.length;j++)f+=q[j].ej(q[j-1]).length();return f}}},11193:(q,f,j)=>{j.d(f,{e:()=>g});var d=j(10941);class g{constructor(q,f,j,g){this.df=new d.j(q,f,j),this.d=g}Yf(){return[this.df.x,this.df.y,this.df.z,this.d]}clone(){return new g(this.df.x,this.df.y,this.df.z,this.d)}getClassName(){return"Plane"}getHashCode(){let q=this.df.getHashCode();return q=397*q^this.d,q}normalize(){const q=Math.sqrt(this.df.x*this.df.x+this.df.y*this.df.y+this.df.z*this.df.z);let f=0;return 0!==q&&(f=1/q),this.df.x*=f,this.df.y*=f,this.df.z*=f,this.d*=f,this}transform(q){const f=g._TmpMatrix;q.invertToRef(f);const j=f.m,d=this.df.x,h=this.df.y,L=this.df.z,Q=this.d,H=d*j[0]+h*j[1]+L*j[2]+Q*j[3],r=d*j[4]+h*j[5]+L*j[6]+Q*j[7],u=d*j[8]+h*j[9]+L*j[10]+Q*j[11],X=d*j[12]+h*j[13]+L*j[14]+Q*j[15];return new g(H,r,u,X)}dotCoordinate(q){return this.df.x*q.x+this.df.y*q.y+this.df.z*q.z+this.d}copyFromPoints(q,f,j){const d=f.x-q.x,g=f.y-q.y,h=f.z-q.z,L=j.x-q.x,Q=j.y-q.y,H=j.z-q.z,r=g*H-h*Q,u=h*L-d*H,X=d*Q-g*L,z=Math.sqrt(r*r+u*u+X*X);let B;return B=0!==z?1/z:0,this.df.x=r*B,this.df.y=u*B,this.df.z=X*B,this.d=-(this.df.x*q.x+this.df.y*q.y+this.df.z*q.z),this}isFrontFacingTo(q,f){return d.j.Dot(this.df,q)<=f}signedDistanceTo(q){return d.j.Dot(q,this.df)+this.d}static Pf(q){return new g(q[0],q[1],q[2],q[3])}static FromPoints(q,f,j){const d=new g(0,0,0,0);return d.copyFromPoints(q,f,j),d}static FromPositionAndNormal(q,f){const j=new g(0,0,0,0);return this.FromPositionAndNormalToRef(q,f,j)}static FromPositionAndNormalToRef(q,f,j){return j.df.H(f),j.df.normalize(),j.d=-q.dot(j.df),j}static SignedDistanceToPlaneFromPositionAndNormal(q,f,j){const g=-(f.x*q.x+f.y*q.y+f.z*q.z);return d.j.Dot(j,f)+g}}g._TmpMatrix=d.b.Identity()},10985:(q,f,j)=>{function d(q){return parseInt(q.toString().replace(/\W/g,""))}function g(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1401298e-51;return Math.abs(q-f)<=j}function h(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1401298e-51;return q<f-d||q>j+d}function L(q,f){return q===f?q:Math.random()*(f-q)+q}function Q(q,f,j){return q+(f-q)*j}function H(q,f,j){let d=t(f-q,360);return d>180&&(d-=360),q+d*z(j)}function r(q,f,j){let d=0;return d=q!=f?z((j-q)/(f-q)):0,d}function u(q,f,j,d,g){const h=g*g,L=g*h;return q*(2*L-3*h+1)+j*(-2*L+3*h)+f*(L-2*h+g)+d*(L-h)}function X(q,f,j,d,g){const h=g*g;return 6*(h-g)*q+(3*h-4*g+1)*f+6*(-h+g)*j+(3*h-2*g)*d}function z(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(j,Math.max(f,q))}function B(q){return q-=2*Math.PI*Math.floor((q+Math.PI)/(2*Math.PI))}function D(q){const f=q.toString(16);return q<=15?("0"+f).toUpperCase():f.toUpperCase()}function i(q){if(Math.log2)return Math.floor(Math.log2(q));if(q<0)return NaN;if(0===q)return-1/0;let f=0;if(q<1){for(;q<1;)f++,q*=2;f=-f}else if(q>1)for(;q>1;)f++,q=Math.floor(q/2);return f}function t(q,f){return q-Math.floor(q/f)*f}function O(q,f,j){return(q-f)/(j-f)}function N(q,f,j){return q*(j-f)+f}function w(q,f){let j=t(f-q,360);return j>180&&(j-=360),j}function E(q,f){const j=t(q,2*f);return f-Math.abs(j-f)}function s(q,f,j){let d=z(j);return d=-2*d*d*d+3*d*d,f*d+q*(1-d)}function S(q,f,j){let d=0;return d=Math.abs(f-q)<=j?f:q+Math.sign(f-q)*j,d}function e(q,f,j){const d=w(q,f);let g=0;return g=-j<d&&d<j?f:S(q,f=q+d,j),g}function Z(q,f,j){return(q-f)/(j-f)}function I(q,f,j){return(j-f)*q+f}function T(q,f){const j=q%f;return 0===j?f:T(f,j)}j.r(f),j.d(f,{Clamp:()=>z,DeltaAngle:()=>w,Denormalize:()=>N,ExtractAsInt:()=>d,Hermite:()=>u,Hermite1stDerivative:()=>X,HighestCommonFactor:()=>T,ILog2:()=>i,InverseLerp:()=>r,Lerp:()=>Q,LerpAngle:()=>H,MoveTowards:()=>S,MoveTowardsAngle:()=>e,Normalize:()=>O,NormalizeRadians:()=>B,OutsideRange:()=>h,PercentToRange:()=>I,PingPong:()=>E,RandomRange:()=>L,RangeToPercent:()=>Z,Repeat:()=>t,SmoothStep:()=>s,ToHex:()=>D,WithinEpsilon:()=>g})},11411:(q,f,j)=>{j.d(f,{b:()=>d});class d{constructor(q,f){this.width=q,this.height=f}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let q=0|this.width;return q=397*q^this.height,q}H(q){this.width=q.width,this.height=q.height}Af(q,f){return this.width=q,this.height=f,this}set(q,f){return this.Af(q,f)}multiplyByFloats(q,f){return new d(this.width*q,this.height*f)}clone(){return new d(this.width,this.height)}equals(q){return!!q&&(this.width===q.width&&this.height===q.height)}get surface(){return this.width*this.height}static Zero(){return new d(0,0)}add(q){return new d(this.width+q.width,this.height+q.height)}ej(q){return new d(this.width-q.width,this.height-q.height)}scale(q){return new d(this.width*q,this.height*q)}static Lerp(q,f,j){const g=q.width+(f.width-q.width)*j,h=q.height+(f.height-q.height)*j;return new d(g,h)}}},10941:(q,f,j)=>{j.d(f,{b:()=>N,e:()=>O,f:()=>E,i:()=>D,j:()=>i,m:()=>t});var d=j(10950),g=j(10958),h=j(10965),L=j(10974),Q=j(10980),H=j(10985);class r{}function u(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const g=q.Yf(),h=f.Yf(),L=g[0],Q=g[1],H=g[2],r=g[3],u=g[4],X=g[5],z=g[6],B=g[7],D=g[8],i=g[9],t=g[10],O=g[11],N=g[12],w=g[13],E=g[14],s=g[15],S=h[0],e=h[1],Z=h[2],I=h[3],T=h[4],W=h[5],n=h[6],U=h[7],Y=h[8],v=h[9],F=h[10],M=h[11],o=h[12],b=h[13],x=h[14],R=h[15];j[d]=L*S+Q*T+H*Y+r*o,j[d+1]=L*e+Q*W+H*v+r*b,j[d+2]=L*Z+Q*n+H*F+r*x,j[d+3]=L*I+Q*U+H*M+r*R,j[d+4]=u*S+X*T+z*Y+B*o,j[d+5]=u*e+X*W+z*v+B*b,j[d+6]=u*Z+X*n+z*F+B*x,j[d+7]=u*I+X*U+z*M+B*R,j[d+8]=D*S+i*T+t*Y+O*o,j[d+9]=D*e+i*W+t*v+O*b,j[d+10]=D*Z+i*n+t*F+O*x,j[d+11]=D*I+i*U+t*M+O*R,j[d+12]=N*S+w*T+E*Y+s*o,j[d+13]=N*e+w*W+E*v+s*b,j[d+14]=N*Z+w*n+E*F+s*x,j[d+15]=N*I+w*U+E*M+s*R}function X(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const d=q.Yf();f[j]=d[0],f[j+1]=d[1],f[j+2]=d[2],f[j+3]=d[3],f[j+4]=d[4],f[j+5]=d[5],f[j+6]=d[6],f[j+7]=d[7],f[j+8]=d[8],f[j+9]=d[9],f[j+10]=d[10],f[j+11]=d[11],f[j+12]=d[12],f[j+13]=d[13],f[j+14]=d[14],f[j+15]=d[15]}function z(q,f){const j=q.Yf(),d=j[0],g=j[1],h=j[2],L=j[3],Q=j[4],H=j[5],r=j[6],u=j[7],X=j[8],z=j[9],B=j[10],D=j[11],i=j[12],t=j[13],O=j[14],N=j[15],w=B*N-O*D,E=z*N-t*D,s=z*O-t*B,S=X*N-i*D,e=X*O-B*i,Z=X*t-i*z,I=+(H*w-r*E+u*s),T=-(Q*w-r*S+u*e),W=+(Q*E-H*S+u*Z),n=-(Q*s-H*e+r*Z),U=d*I+g*T+h*W+L*n;if(0===U)return!1;const Y=1/U,v=r*N-O*u,F=H*N-t*u,M=H*O-t*r,o=Q*N-i*u,b=Q*O-i*r,x=Q*t-i*H,R=r*D-B*u,A=H*D-z*u,k=H*B-z*r,y=Q*D-X*u,p=Q*B-X*r,l=Q*z-X*H,V=-(g*w-h*E+L*s),a=+(d*w-h*S+L*e),P=-(d*E-g*S+L*Z),C=+(d*s-g*e+h*Z),c=+(g*v-h*F+L*M),G=-(d*v-h*o+L*b),m=+(d*F-g*o+L*x),K=-(d*M-g*b+h*x),J=-(g*R-h*A+L*k),qq=+(d*R-h*y+L*p),fq=-(d*A-g*y+L*l),jq=+(d*k-g*p+h*l);return f[0]=I*Y,f[1]=V*Y,f[2]=c*Y,f[3]=J*Y,f[4]=T*Y,f[5]=a*Y,f[6]=G*Y,f[7]=qq*Y,f[8]=W*Y,f[9]=P*Y,f[10]=m*Y,f[11]=fq*Y,f[12]=n*Y,f[13]=C*Y,f[14]=K*Y,f[15]=jq*Y,!0}r._UpdateFlagSeed=0;const B=q=>parseInt(q.toString().replace(/\W/g,""));class D{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=q,this.y=f}toString(){return`{X: ${this.x} Y: ${this.y}}`}getClassName(){return"Vector2"}getHashCode(){let q=B(this.x);return q=397*q^B(this.y),q}toArray(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return q[f]=this.x,q[f+1]=this.y,this}Zj(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return D.FromArrayToRef(q,f,this),this}Yf(){return[this.x,this.y]}H(q){return this.x=q.x,this.y=q.y,this}Af(q,f){return this.x=q,this.y=f,this}set(q,f){return this.Af(q,f)}cf(q){return this.Af(q,q)}add(q){return new D(this.x+q.x,this.y+q.y)}addToRef(q,f){return f.x=this.x+q.x,f.y=this.y+q.y,f}addInPlace(q){return this.x+=q.x,this.y+=q.y,this}addInPlaceFromFloats(q,f){return this.x+=q,this.y+=f,this}addVector3(q){return new D(this.x+q.x,this.y+q.y)}ej(q){return new D(this.x-q.x,this.y-q.y)}subtractToRef(q,f){return f.x=this.x-q.x,f.y=this.y-q.y,f}eX(q){return this.x-=q.x,this.y-=q.y,this}multiplyInPlace(q){return this.x*=q.x,this.y*=q.y,this}multiply(q){return new D(this.x*q.x,this.y*q.y)}multiplyToRef(q,f){return f.x=this.x*q.x,f.y=this.y*q.y,f}multiplyByFloats(q,f){return new D(this.x*q,this.y*f)}divide(q){return new D(this.x/q.x,this.y/q.y)}divideToRef(q,f){return f.x=this.x/q.x,f.y=this.y/q.y,f}divideInPlace(q){return this.x=this.x/q.x,this.y=this.y/q.y,this}minimizeInPlace(q){return this.minimizeInPlaceFromFloats(q.x,q.y)}maximizeInPlace(q){return this.maximizeInPlaceFromFloats(q.x,q.y)}minimizeInPlaceFromFloats(q,f){return this.x=Math.min(q,this.x),this.y=Math.min(f,this.y),this}maximizeInPlaceFromFloats(q,f){return this.x=Math.max(q,this.x),this.y=Math.max(f,this.y),this}subtractFromFloats(q,f){return new D(this.x-q,this.y-f)}subtractFromFloatsToRef(q,f,j){return j.x=this.x-q,j.y=this.y-f,j}negate(){return new D(-this.x,-this.y)}negateInPlace(){return this.x*=-1,this.y*=-1,this}negateToRef(q){return q.x=-this.x,q.y=-this.y,q}scaleInPlace(q){return this.x*=q,this.y*=q,this}scale(q){return new D(this.x*q,this.y*q)}scaleToRef(q,f){return f.x=this.x*q,f.y=this.y*q,f}scaleAndAddToRef(q,f){return f.x+=this.x*q,f.y+=this.y*q,f}equals(q){return q&&this.x===q.x&&this.y===q.y}equalsWithEpsilon(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.d;return q&&(0,H.WithinEpsilon)(this.x,q.x,f)&&(0,H.WithinEpsilon)(this.y,q.y,f)}equalsToFloats(q,f){return this.x===q&&this.y===f}floor(){return new D(Math.floor(this.x),Math.floor(this.y))}floorToRef(q){return q.x=Math.floor(this.x),q.y=Math.floor(this.y),q}fract(){return new D(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}fractToRef(q){return q.x=this.x-Math.floor(this.x),q.y=this.y-Math.floor(this.y),q}rotate(q){return this.rotateToRef(q,new D)}rotateToRef(q,f){const j=Math.cos(q),d=Math.sin(q);return f.x=j*this.x-d*this.y,f.y=d*this.x+j*this.y,f}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(q){return 0===q||1===q?this:this.scaleInPlace(1/q)}normalizeToNew(){const q=new D;return this.normalizeToRef(q),q}normalizeToRef(q){const f=this.length();return 0===f&&(q.x=this.x,q.y=this.y),this.scaleToRef(1/f,q)}clone(){return new D(this.x,this.y)}dot(q){return this.x*q.x+this.y*q.y}static Zero(){return new D(0,0)}static One(){return new D(1,1)}static Random(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new D((0,H.RandomRange)(q,f),(0,H.RandomRange)(q,f))}static RandomToRef(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).Af((0,H.RandomRange)(q,f),(0,H.RandomRange)(q,f))}static get ZeroReadOnly(){return D._ZeroReadOnly}static Pf(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new D(q[f],q[f+1])}static FromArrayToRef(q,f,j){return j.x=q[f],j.y=q[f+1],j}static FromFloatsToRef(q,f,j){return j.Af(q,f),j}static CatmullRom(q,f,j,d,g){const h=g*g,L=g*h,Q=.5*(2*f.x+(-q.x+j.x)*g+(2*q.x-5*f.x+4*j.x-d.x)*h+(-q.x+3*f.x-3*j.x+d.x)*L),H=.5*(2*f.y+(-q.y+j.y)*g+(2*q.y-5*f.y+4*j.y-d.y)*h+(-q.y+3*f.y-3*j.y+d.y)*L);return new D(Q,H)}static ClampToRef(q,f,j,d){return d.x=(0,H.Clamp)(q.x,f.x,j.x),d.y=(0,H.Clamp)(q.y,f.y,j.y),d}static Clamp(q,f,j){const d=(0,H.Clamp)(q.x,f.x,j.x),g=(0,H.Clamp)(q.y,f.y,j.y);return new D(d,g)}static Hermite(q,f,j,d,g){const h=g*g,L=g*h,Q=2*L-3*h+1,H=-2*L+3*h,r=L-2*h+g,u=L-h,X=q.x*Q+j.x*H+f.x*r+d.x*u,z=q.y*Q+j.y*H+f.y*r+d.y*u;return new D(X,z)}static Hermite1stDerivative(q,f,j,d,g){return this.Hermite1stDerivativeToRef(q,f,j,d,g,new D)}static Hermite1stDerivativeToRef(q,f,j,d,g,h){const L=g*g;return h.x=6*(L-g)*q.x+(3*L-4*g+1)*f.x+6*(-L+g)*j.x+(3*L-2*g)*d.x,h.y=6*(L-g)*q.y+(3*L-4*g+1)*f.y+6*(-L+g)*j.y+(3*L-2*g)*d.y,h}static Lerp(q,f,j){return D.LerpToRef(q,f,j,new D)}static LerpToRef(q,f,j,d){return d.x=q.x+(f.x-q.x)*j,d.y=q.y+(f.y-q.y)*j,d}static Dot(q,f){return q.x*f.x+q.y*f.y}static Normalize(q){return D.NormalizeToRef(q,new D)}static NormalizeToRef(q,f){return q.normalizeToRef(f),f}static Minimize(q,f){const j=q.x<f.x?q.x:f.x,d=q.y<f.y?q.y:f.y;return new D(j,d)}static Maximize(q,f){const j=q.x>f.x?q.x:f.x,d=q.y>f.y?q.y:f.y;return new D(j,d)}static Transform(q,f){return D.TransformToRef(q,f,new D)}static TransformToRef(q,f,j){const d=f.m,g=q.x*d[0]+q.y*d[4]+d[12],h=q.x*d[1]+q.y*d[5]+d[13];return j.x=g,j.y=h,j}static PointInTriangle(q,f,j,d){const g=.5*(-j.y*d.x+f.y*(-j.x+d.x)+f.x*(j.y-d.y)+j.x*d.y),h=g<0?-1:1,L=(f.y*d.x-f.x*d.y+(d.y-f.y)*q.x+(f.x-d.x)*q.y)*h,Q=(f.x*j.y-f.y*j.x+(f.y-j.y)*q.x+(j.x-f.x)*q.y)*h;return L>0&&Q>0&&L+Q<2*g*h}static Distance(q,f){return Math.sqrt(D.DistanceSquared(q,f))}static DistanceSquared(q,f){const j=q.x-f.x,d=q.y-f.y;return j*j+d*d}static Center(q,f){return D.CenterToRef(q,f,new D)}static CenterToRef(q,f,j){return j.Af((q.x+f.x)/2,(q.y+f.y)/2)}static DistanceOfPointFromSegment(q,f,j){const d=D.DistanceSquared(f,j);if(0===d)return D.Distance(q,f);const g=j.ej(f),h=Math.max(0,Math.min(1,D.Dot(q.ej(f),g)/d)),L=f.add(g.multiplyByFloats(h,h));return D.Distance(q,L)}}D._V8PerformanceHack=new D(.5,.5),D._ZeroReadOnly=D.Zero(),Object.defineProperties(D.prototype,{dimension:{value:[2]},rank:{value:1}});class i{get x(){return this._x}set x(q){this._x=q,this._isDirty=!0}get y(){return this._y}set y(q){this._y=q,this._isDirty=!0}get z(){return this._z}set z(q){this._z=q,this._isDirty=!0}constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._isDirty=!0,this._x=q,this._y=f,this._z=j}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z}}`}getClassName(){return"kf"}getHashCode(){let q=B(this._x);return q=397*q^B(this._y),q=397*q^B(this._z),q}Yf(){return[this._x,this._y,this._z]}toArray(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return q[f]=this._x,q[f+1]=this._y,q[f+2]=this._z,this}Zj(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return i.FromArrayToRef(q,f,this),this}toQuaternion(){return O.RotationYawPitchRoll(this._y,this._x,this._z)}addInPlace(q){return this._x+=q._x,this._y+=q._y,this._z+=q._z,this._isDirty=!0,this}addInPlaceFromFloats(q,f,j){return this._x+=q,this._y+=f,this._z+=j,this._isDirty=!0,this}add(q){return new i(this._x+q._x,this._y+q._y,this._z+q._z)}addToRef(q,f){return f._x=this._x+q._x,f._y=this._y+q._y,f._z=this._z+q._z,f._isDirty=!0,f}eX(q){return this._x-=q._x,this._y-=q._y,this._z-=q._z,this._isDirty=!0,this}ej(q){return new i(this._x-q._x,this._y-q._y,this._z-q._z)}subtractToRef(q,f){return this.subtractFromFloatsToRef(q._x,q._y,q._z,f)}subtractFromFloats(q,f,j){return new i(this._x-q,this._y-f,this._z-j)}subtractFromFloatsToRef(q,f,j,d){return d._x=this._x-q,d._y=this._y-f,d._z=this._z-j,d._isDirty=!0,d}negate(){return new i(-this._x,-this._y,-this._z)}negateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}negateToRef(q){return q._x=-1*this._x,q._y=-1*this._y,q._z=-1*this._z,q._isDirty=!0,q}scaleInPlace(q){return this._x*=q,this._y*=q,this._z*=q,this._isDirty=!0,this}scale(q){return new i(this._x*q,this._y*q,this._z*q)}scaleToRef(q,f){return f._x=this._x*q,f._y=this._y*q,f._z=this._z*q,f._isDirty=!0,f}getNormalToRef(q){const f=this.length();let j=Math.acos(this._y/f);const d=Math.atan2(this._z,this._x);j>Math.PI/2?j-=Math.PI/2:j+=Math.PI/2;const g=f*Math.sin(j)*Math.cos(d),h=f*Math.cos(j),L=f*Math.sin(j)*Math.sin(d);return q.set(g,h,L),q}applyRotationQuaternionToRef(q,f){const j=this._x,d=this._y,g=this._z,h=q._x,L=q._y,Q=q._z,H=q._w,r=2*(L*g-Q*d),u=2*(Q*j-h*g),X=2*(h*d-L*j);return f._x=j+H*r+L*X-Q*u,f._y=d+H*u+Q*r-h*X,f._z=g+H*X+h*u-L*r,f._isDirty=!0,f}applyRotationQuaternionInPlace(q){return this.applyRotationQuaternionToRef(q,this)}applyRotationQuaternion(q){return this.applyRotationQuaternionToRef(q,new i)}scaleAndAddToRef(q,f){return f._x+=this._x*q,f._y+=this._y*q,f._z+=this._z*q,f._isDirty=!0,f}projectOnPlane(q,f){return this.projectOnPlaneToRef(q,f,new i)}projectOnPlaneToRef(q,f,j){const d=q.df,g=q.d,h=w.kf[0];this.subtractToRef(f,h),h.normalize();const L=i.Dot(h,d);if(Math.abs(L)<1e-10)j.cf(1/0);else{const q=-(i.Dot(f,d)+g)/L,Q=h.scaleInPlace(q);f.addToRef(Q,j)}return j}equals(q){return q&&this._x===q._x&&this._y===q._y&&this._z===q._z}equalsWithEpsilon(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.d;return q&&(0,H.WithinEpsilon)(this._x,q._x,f)&&(0,H.WithinEpsilon)(this._y,q._y,f)&&(0,H.WithinEpsilon)(this._z,q._z,f)}equalsToFloats(q,f,j){return this._x===q&&this._y===f&&this._z===j}multiplyInPlace(q){return this._x*=q._x,this._y*=q._y,this._z*=q._z,this._isDirty=!0,this}multiply(q){return this.multiplyByFloats(q._x,q._y,q._z)}multiplyToRef(q,f){return f._x=this._x*q._x,f._y=this._y*q._y,f._z=this._z*q._z,f._isDirty=!0,f}multiplyByFloats(q,f,j){return new i(this._x*q,this._y*f,this._z*j)}divide(q){return new i(this._x/q._x,this._y/q._y,this._z/q._z)}divideToRef(q,f){return f._x=this._x/q._x,f._y=this._y/q._y,f._z=this._z/q._z,f._isDirty=!0,f}divideInPlace(q){return this._x=this._x/q._x,this._y=this._y/q._y,this._z=this._z/q._z,this._isDirty=!0,this}minimizeInPlace(q){return this.minimizeInPlaceFromFloats(q._x,q._y,q._z)}maximizeInPlace(q){return this.maximizeInPlaceFromFloats(q._x,q._y,q._z)}minimizeInPlaceFromFloats(q,f,j){return q<this._x&&(this.x=q),f<this._y&&(this.y=f),j<this._z&&(this.z=j),this}maximizeInPlaceFromFloats(q,f,j){return q>this._x&&(this.x=q),f>this._y&&(this.y=f),j>this._z&&(this.z=j),this}isNonUniformWithinEpsilon(q){const f=Math.abs(this._x),j=Math.abs(this._y);if(!(0,H.WithinEpsilon)(f,j,q))return!0;const d=Math.abs(this._z);return!(0,H.WithinEpsilon)(f,d,q)||!(0,H.WithinEpsilon)(j,d,q)}get isNonUniform(){const q=Math.abs(this._x);if(q!==Math.abs(this._y))return!0;return q!==Math.abs(this._z)}floorToRef(q){return q._x=Math.floor(this._x),q._y=Math.floor(this._y),q._z=Math.floor(this._z),q._isDirty=!0,q}floor(){return new i(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))}fractToRef(q){return q._x=this._x-Math.floor(this._x),q._y=this._y-Math.floor(this._y),q._z=this._z-Math.floor(this._z),q._isDirty=!0,q}fract(){return new i(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z))}length(){return Math.sqrt(this.lengthSquared())}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z}get hasAZeroComponent(){return this._x*this._y*this._z===0}normalize(){return this.normalizeFromLength(this.length())}reorderInPlace(q){if("xyz"===(q=q.toLowerCase()))return this;const f=w.kf[0].H(this);return this.x=f[q[0]],this.y=f[q[1]],this.z=f[q[2]],this}rotateByQuaternionToRef(q,f){return q.toRotationMatrix(w.Matrix[0]),i.TransformCoordinatesToRef(this,w.Matrix[0],f),f}rotateByQuaternionAroundPointToRef(q,f,j){return this.subtractToRef(f,w.kf[0]),w.kf[0].rotateByQuaternionToRef(q,w.kf[0]),f.addToRef(w.kf[0],j),j}cross(q){return i.CrossToRef(this,q,new i)}normalizeFromLength(q){return 0===q||1===q?this:this.scaleInPlace(1/q)}normalizeToNew(){return this.normalizeToRef(new i)}normalizeToRef(q){const f=this.length();return 0===f||1===f?(q._x=this._x,q._y=this._y,q._z=this._z,q._isDirty=!0,q):this.scaleToRef(1/f,q)}clone(){return new i(this._x,this._y,this._z)}H(q){return this.Af(q._x,q._y,q._z)}Af(q,f,j){return this._x=q,this._y=f,this._z=j,this._isDirty=!0,this}set(q,f,j){return this.Af(q,f,j)}cf(q){return this._x=this._y=this._z=q,this._isDirty=!0,this}static GetClipFactor(q,f,j,d){const g=i.Dot(q,j);return(g-d)/(g-i.Dot(f,j))}static GetAngleBetweenVectors(q,f,j){const d=q.normalizeToRef(w.kf[1]),g=f.normalizeToRef(w.kf[2]);let h=i.Dot(d,g);h=(0,H.Clamp)(h,-1,1);const L=Math.acos(h),Q=w.kf[3];return i.CrossToRef(d,g,Q),i.Dot(Q,j)>0?isNaN(L)?0:L:isNaN(L)?-Math.PI:-Math.acos(h)}static GetAngleBetweenVectorsOnPlane(q,f,j){w.kf[0].H(q);const d=w.kf[0];w.kf[1].H(f);const g=w.kf[1];w.kf[2].H(j);const h=w.kf[2],L=w.kf[3],Q=w.kf[4];d.normalize(),g.normalize(),h.normalize(),i.CrossToRef(h,d,L),i.CrossToRef(L,h,Q);const r=Math.atan2(i.Dot(g,L),i.Dot(g,Q));return(0,H.NormalizeRadians)(r)}static PitchYawRollToMoveBetweenPointsToRef(q,f,j){const d=E.kf[0];return f.subtractToRef(q,d),j._y=Math.atan2(d.x,d.z)||0,j._x=Math.atan2(Math.sqrt(d.x**2+d.z**2),d.y)||0,j._z=0,j._isDirty=!0,j}static PitchYawRollToMoveBetweenPoints(q,f){const j=i.Zero();return i.PitchYawRollToMoveBetweenPointsToRef(q,f,j)}static SlerpToRef(q,f,j,g){j=(0,H.Clamp)(j,0,1);const h=w.kf[0],L=w.kf[1];h.H(q);const Q=h.length();h.normalizeFromLength(Q),L.H(f);const r=L.length();L.normalizeFromLength(r);const u=i.Dot(h,L);let X,z;if(u<1-d.d){const q=Math.acos(u),f=1/Math.sin(q);X=Math.sin((1-j)*q)*f,z=Math.sin(j*q)*f}else X=1-j,z=j;return h.scaleInPlace(X),L.scaleInPlace(z),g.H(h).addInPlace(L),g.scaleInPlace((0,H.Lerp)(Q,r,j)),g}static SmoothToRef(q,f,j,d,g){return i.SlerpToRef(q,f,0===d?1:j/d,g),g}static Pf(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new i(q[f],q[f+1],q[f+2])}static FromFloatArray(q,f){return i.Pf(q,f)}static FromArrayToRef(q,f,j){return j._x=q[f],j._y=q[f+1],j._z=q[f+2],j._isDirty=!0,j}static FromFloatArrayToRef(q,f,j){return i.FromArrayToRef(q,f,j)}static FromFloatsToRef(q,f,j,d){return d.Af(q,f,j),d}static Zero(){return new i(0,0,0)}static One(){return new i(1,1,1)}static Up(){return new i(0,1,0)}static get UpReadOnly(){return i._UpReadOnly}static get DownReadOnly(){return i._DownReadOnly}static get RightReadOnly(){return i._RightReadOnly}static get LeftReadOnly(){return i._LeftReadOnly}static get LeftHandedForwardReadOnly(){return i._LeftHandedForwardReadOnly}static get RightHandedForwardReadOnly(){return i._RightHandedForwardReadOnly}static get LeftHandedBackwardReadOnly(){return i._LeftHandedBackwardReadOnly}static get RightHandedBackwardReadOnly(){return i._RightHandedBackwardReadOnly}static get ZeroReadOnly(){return i._ZeroReadOnly}static get OneReadOnly(){return i._OneReadOnly}static Down(){return new i(0,-1,0)}static Forward(){return new i(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?-1:1)}static Backward(){return new i(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?1:-1)}static Right(){return new i(1,0,0)}static Left(){return new i(-1,0,0)}static Random(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new i((0,H.RandomRange)(q,f),(0,H.RandomRange)(q,f),(0,H.RandomRange)(q,f))}static RandomToRef(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).Af((0,H.RandomRange)(q,f),(0,H.RandomRange)(q,f),(0,H.RandomRange)(q,f))}static TransformCoordinates(q,f){const j=i.Zero();return i.TransformCoordinatesToRef(q,f,j),j}static TransformCoordinatesToRef(q,f,j){return i.TransformCoordinatesFromFloatsToRef(q._x,q._y,q._z,f,j),j}static TransformCoordinatesFromFloatsToRef(q,f,j,d,g){const h=d.m,L=q*h[0]+f*h[4]+j*h[8]+h[12],Q=q*h[1]+f*h[5]+j*h[9]+h[13],H=q*h[2]+f*h[6]+j*h[10]+h[14],r=1/(q*h[3]+f*h[7]+j*h[11]+h[15]);return g._x=L*r,g._y=Q*r,g._z=H*r,g._isDirty=!0,g}static TransformNormal(q,f){const j=i.Zero();return i.TransformNormalToRef(q,f,j),j}static TransformNormalToRef(q,f,j){return this.TransformNormalFromFloatsToRef(q._x,q._y,q._z,f,j),j}static TransformNormalFromFloatsToRef(q,f,j,d,g){const h=d.m;return g._x=q*h[0]+f*h[4]+j*h[8],g._y=q*h[1]+f*h[5]+j*h[9],g._z=q*h[2]+f*h[6]+j*h[10],g._isDirty=!0,g}static CatmullRom(q,f,j,d,g){const h=g*g,L=g*h,Q=.5*(2*f._x+(-q._x+j._x)*g+(2*q._x-5*f._x+4*j._x-d._x)*h+(-q._x+3*f._x-3*j._x+d._x)*L),H=.5*(2*f._y+(-q._y+j._y)*g+(2*q._y-5*f._y+4*j._y-d._y)*h+(-q._y+3*f._y-3*j._y+d._y)*L),r=.5*(2*f._z+(-q._z+j._z)*g+(2*q._z-5*f._z+4*j._z-d._z)*h+(-q._z+3*f._z-3*j._z+d._z)*L);return new i(Q,H,r)}static Clamp(q,f,j){const d=new i;return i.ClampToRef(q,f,j,d),d}static ClampToRef(q,f,j,d){let g=q._x;g=g>j._x?j._x:g,g=g<f._x?f._x:g;let h=q._y;h=h>j._y?j._y:h,h=h<f._y?f._y:h;let L=q._z;return L=L>j._z?j._z:L,L=L<f._z?f._z:L,d.Af(g,h,L),d}static CheckExtends(q,f,j){f.minimizeInPlace(q),j.maximizeInPlace(q)}static Hermite(q,f,j,d,g){const h=g*g,L=g*h,Q=2*L-3*h+1,H=-2*L+3*h,r=L-2*h+g,u=L-h,X=q._x*Q+j._x*H+f._x*r+d._x*u,z=q._y*Q+j._y*H+f._y*r+d._y*u,B=q._z*Q+j._z*H+f._z*r+d._z*u;return new i(X,z,B)}static Hermite1stDerivative(q,f,j,d,g){const h=new i;return this.Hermite1stDerivativeToRef(q,f,j,d,g,h),h}static Hermite1stDerivativeToRef(q,f,j,d,g,h){const L=g*g;return h._x=6*(L-g)*q._x+(3*L-4*g+1)*f._x+6*(-L+g)*j._x+(3*L-2*g)*d._x,h._y=6*(L-g)*q._y+(3*L-4*g+1)*f._y+6*(-L+g)*j._y+(3*L-2*g)*d._y,h._z=6*(L-g)*q._z+(3*L-4*g+1)*f._z+6*(-L+g)*j._z+(3*L-2*g)*d._z,h._isDirty=!0,h}static Lerp(q,f,j){const d=new i(0,0,0);return i.LerpToRef(q,f,j,d),d}static LerpToRef(q,f,j,d){return d._x=q._x+(f._x-q._x)*j,d._y=q._y+(f._y-q._y)*j,d._z=q._z+(f._z-q._z)*j,d._isDirty=!0,d}static Dot(q,f){return q._x*f._x+q._y*f._y+q._z*f._z}dot(q){return this._x*q._x+this._y*q._y+this._z*q._z}static Cross(q,f){const j=new i;return i.CrossToRef(q,f,j),j}static CrossToRef(q,f,j){const d=q._y*f._z-q._z*f._y,g=q._z*f._x-q._x*f._z,h=q._x*f._y-q._y*f._x;return j.Af(d,g,h),j}static Normalize(q){const f=i.Zero();return i.NormalizeToRef(q,f),f}static NormalizeToRef(q,f){return q.normalizeToRef(f),f}static Project(q,f,j,d){const g=new i;return i.ProjectToRef(q,f,j,d,g),g}static ProjectToRef(q,f,j,d,g){var h;const L=d.width,H=d.height,r=d.x,u=d.y,X=w.Matrix[1],z=null===(h=Q.d.LastCreatedEngine)||void 0===h?void 0:h.isNDCHalfZRange,B=z?1:.5,D=z?0:.5;N.FromValuesToRef(L/2,0,0,0,0,-H/2,0,0,0,0,B,0,r+L/2,H/2+u,D,1,X);const t=w.Matrix[0];return f.multiplyToRef(j,t),t.multiplyToRef(X,t),i.TransformCoordinatesToRef(q,t,g),g}static Reflect(q,f){return this.ReflectToRef(q,f,new i)}static ReflectToRef(q,f,j){const d=E.kf[0];return d.H(f).scaleInPlace(2*i.Dot(q,f)),j.H(q).eX(d)}static _UnprojectFromInvertedMatrixToRef(q,f,j){i.TransformCoordinatesToRef(q,f,j);const d=f.m,g=q._x*d[3]+q._y*d[7]+q._z*d[11]+d[15];return(0,H.WithinEpsilon)(g,1)&&j.scaleInPlace(1/g),j}static UnprojectFromTransform(q,f,j,d,g){return this.Unproject(q,f,j,d,g,N.IdentityReadOnly)}static Unproject(q,f,j,d,g,h){const L=new i;return i.UnprojectToRef(q,f,j,d,g,h,L),L}static UnprojectToRef(q,f,j,d,g,h,L){return i.UnprojectFloatsToRef(q._x,q._y,q._z,f,j,d,g,h,L),L}static UnprojectFloatsToRef(q,f,j,d,g,h,L,H,r){var u;const X=w.Matrix[0];h.multiplyToRef(L,X),X.multiplyToRef(H,X),X.invert();const z=w.kf[0];return z.x=q/d*2-1,z.y=-(f/g*2-1),null!==(u=Q.d.LastCreatedEngine)&&void 0!==u&&u.isNDCHalfZRange?z.z=j:z.z=2*j-1,i._UnprojectFromInvertedMatrixToRef(z,X,r),r}static Minimize(q,f){const j=new i;return j.H(q),j.minimizeInPlace(f),j}static Maximize(q,f){const j=new i;return j.H(q),j.maximizeInPlace(f),j}static Distance(q,f){return Math.sqrt(i.DistanceSquared(q,f))}static DistanceSquared(q,f){const j=q._x-f._x,d=q._y-f._y,g=q._z-f._z;return j*j+d*d+g*g}static ProjectOnTriangleToRef(q,f,j,g,h){const L=w.kf[0],Q=w.kf[1],r=w.kf[2],u=w.kf[3],X=w.kf[4];j.subtractToRef(f,L),g.subtractToRef(f,Q),g.subtractToRef(j,r);const z=L.length(),B=Q.length(),D=r.length();if(z<d.d||B<d.d||D<d.d)return h.H(f),i.Distance(q,f);q.subtractToRef(f,X),i.CrossToRef(L,Q,u);const t=u.length();if(t<d.d)return h.H(f),i.Distance(q,f);u.normalizeFromLength(t);let O=X.length();if(O<d.d)return h.H(f),0;X.normalizeFromLength(O);const N=i.Dot(u,X),E=w.kf[5],s=w.kf[6];E.H(u).scaleInPlace(-O*N),s.H(q).addInPlace(E);const S=w.kf[4],e=w.kf[5],Z=w.kf[7],I=w.kf[8];S.H(L).scaleInPlace(1/z),I.H(Q).scaleInPlace(1/B),S.addInPlace(I).scaleInPlace(-1),e.H(L).scaleInPlace(-1/z),I.H(r).scaleInPlace(1/D),e.addInPlace(I).scaleInPlace(-1),Z.H(r).scaleInPlace(-1/D),I.H(Q).scaleInPlace(-1/B),Z.addInPlace(I).scaleInPlace(-1);const T=w.kf[9];let W;T.H(s).eX(f),i.CrossToRef(S,T,I),W=i.Dot(I,u);const n=W;T.H(s).eX(j),i.CrossToRef(e,T,I),W=i.Dot(I,u);const U=W;T.H(s).eX(g),i.CrossToRef(Z,T,I),W=i.Dot(I,u);const Y=W,v=w.kf[10];let F,M;n>0&&U<0?(v.H(L),F=f,M=j):U>0&&Y<0?(v.H(r),F=j,M=g):(v.H(Q).scaleInPlace(-1),F=g,M=f);const o=w.kf[9],b=w.kf[4];F.subtractToRef(s,I),M.subtractToRef(s,o),i.CrossToRef(I,o,b);if(!(i.Dot(b,u)<0))return h.H(s),Math.abs(O*N);const x=w.kf[5];i.CrossToRef(v,b,x),x.normalize();const R=w.kf[9];R.H(F).eX(s);const A=R.length();if(A<d.d)return h.H(F),i.Distance(q,F);R.normalizeFromLength(A);const k=i.Dot(x,R),y=w.kf[7];y.H(s).addInPlace(x.scaleInPlace(A*k)),I.H(y).eX(F),O=v.length(),v.normalizeFromLength(O);let p=i.Dot(I,v)/Math.max(O,d.d);return p=(0,H.Clamp)(p,0,1),y.H(F).addInPlace(v.scaleInPlace(p*O)),h.H(y),i.Distance(q,y)}static Center(q,f){return i.CenterToRef(q,f,i.Zero())}static CenterToRef(q,f,j){return j.Af((q._x+f._x)/2,(q._y+f._y)/2,(q._z+f._z)/2)}static RotationFromAxis(q,f,j){const d=new i;return i.RotationFromAxisToRef(q,f,j,d),d}static RotationFromAxisToRef(q,f,j,d){const g=w.Quaternion[0];return O.RotationQuaternionFromAxisToRef(q,f,j,g),g.toEulerAnglesToRef(d),d}}i._V8PerformanceHack=new i(.5,.5,.5),i._UpReadOnly=i.Up(),i._DownReadOnly=i.Down(),i._LeftHandedForwardReadOnly=i.Forward(!1),i._RightHandedForwardReadOnly=i.Forward(!0),i._LeftHandedBackwardReadOnly=i.Backward(!1),i._RightHandedBackwardReadOnly=i.Backward(!0),i._RightReadOnly=i.Right(),i._LeftReadOnly=i.Left(),i._ZeroReadOnly=i.Zero(),i._OneReadOnly=i.One(),Object.defineProperties(i.prototype,{dimension:{value:[3]},rank:{value:1}});class t{get x(){return this._x}set x(q){this._x=q,this._isDirty=!0}get y(){return this._y}set y(q){this._y=q,this._isDirty=!0}get z(){return this._z}set z(q){this._z=q,this._isDirty=!0}get w(){return this._w}set w(q){this._w=q,this._isDirty=!0}constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._isDirty=!0,this._x=q,this._y=f,this._z=j,this._w=d}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Vector4"}getHashCode(){let q=B(this._x);return q=397*q^B(this._y),q=397*q^B(this._z),q=397*q^B(this._w),q}Yf(){return[this._x,this._y,this._z,this._w]}toArray(q,f){return void 0===f&&(f=0),q[f]=this._x,q[f+1]=this._y,q[f+2]=this._z,q[f+3]=this._w,this}Zj(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.FromArrayToRef(q,f,this),this}addInPlace(q){return this.x+=q._x,this.y+=q._y,this.z+=q._z,this.w+=q._w,this}addInPlaceFromFloats(q,f,j,d){return this.x+=q,this.y+=f,this.z+=j,this.w+=d,this}add(q){return new t(this._x+q.x,this._y+q.y,this._z+q.z,this._w+q.w)}addToRef(q,f){return f.x=this._x+q.x,f.y=this._y+q.y,f.z=this._z+q.z,f.w=this._w+q.w,f}eX(q){return this.x-=q.x,this.y-=q.y,this.z-=q.z,this.w-=q.w,this}ej(q){return new t(this._x-q.x,this._y-q.y,this._z-q.z,this._w-q.w)}subtractToRef(q,f){return f.x=this._x-q.x,f.y=this._y-q.y,f.z=this._z-q.z,f.w=this._w-q.w,f}subtractFromFloats(q,f,j,d){return new t(this._x-q,this._y-f,this._z-j,this._w-d)}subtractFromFloatsToRef(q,f,j,d,g){return g.x=this._x-q,g.y=this._y-f,g.z=this._z-j,g.w=this._w-d,g}negate(){return new t(-this._x,-this._y,-this._z,-this._w)}negateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}negateToRef(q){return q.x=-this._x,q.y=-this._y,q.z=-this._z,q.w=-this._w,q}scaleInPlace(q){return this.x*=q,this.y*=q,this.z*=q,this.w*=q,this}scale(q){return new t(this._x*q,this._y*q,this._z*q,this._w*q)}scaleToRef(q,f){return f.x=this._x*q,f.y=this._y*q,f.z=this._z*q,f.w=this._w*q,f}scaleAndAddToRef(q,f){return f.x+=this._x*q,f.y+=this._y*q,f.z+=this._z*q,f.w+=this._w*q,f}equals(q){return q&&this._x===q.x&&this._y===q.y&&this._z===q.z&&this._w===q.w}equalsWithEpsilon(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.d;return q&&(0,H.WithinEpsilon)(this._x,q.x,f)&&(0,H.WithinEpsilon)(this._y,q.y,f)&&(0,H.WithinEpsilon)(this._z,q.z,f)&&(0,H.WithinEpsilon)(this._w,q.w,f)}equalsToFloats(q,f,j,d){return this._x===q&&this._y===f&&this._z===j&&this._w===d}multiplyInPlace(q){return this.x*=q.x,this.y*=q.y,this.z*=q.z,this.w*=q.w,this}multiply(q){return new t(this._x*q.x,this._y*q.y,this._z*q.z,this._w*q.w)}multiplyToRef(q,f){return f.x=this._x*q.x,f.y=this._y*q.y,f.z=this._z*q.z,f.w=this._w*q.w,f}multiplyByFloats(q,f,j,d){return new t(this._x*q,this._y*f,this._z*j,this._w*d)}divide(q){return new t(this._x/q.x,this._y/q.y,this._z/q.z,this._w/q.w)}divideToRef(q,f){return f.x=this._x/q.x,f.y=this._y/q.y,f.z=this._z/q.z,f.w=this._w/q.w,f}divideInPlace(q){return this.divideToRef(q,this)}minimizeInPlace(q){return q.x<this._x&&(this.x=q.x),q.y<this._y&&(this.y=q.y),q.z<this._z&&(this.z=q.z),q.w<this._w&&(this.w=q.w),this}maximizeInPlace(q){return q.x>this._x&&(this.x=q.x),q.y>this._y&&(this.y=q.y),q.z>this._z&&(this.z=q.z),q.w>this._w&&(this.w=q.w),this}minimizeInPlaceFromFloats(q,f,j,d){return this.x=Math.min(q,this._x),this.y=Math.min(f,this._y),this.z=Math.min(j,this._z),this.w=Math.min(d,this._w),this}maximizeInPlaceFromFloats(q,f,j,d){return this.x=Math.max(q,this._x),this.y=Math.max(f,this._y),this.z=Math.max(j,this._z),this.w=Math.max(d,this._w),this}floorToRef(q){return q.x=Math.floor(this._x),q.y=Math.floor(this._y),q.z=Math.floor(this._z),q.w=Math.floor(this._w),q}floor(){return new t(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z),Math.floor(this._w))}fractToRef(q){return q.x=this._x-Math.floor(this._x),q.y=this._y-Math.floor(this._y),q.z=this._z-Math.floor(this._z),q.w=this._w-Math.floor(this._w),q}fract(){return new t(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z),this._w-Math.floor(this._w))}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(q){return 0===q||1===q?this:this.scaleInPlace(1/q)}normalizeToNew(){return this.normalizeToRef(new t)}normalizeToRef(q){const f=this.length();return 0===f||1===f?(q.x=this._x,q.y=this._y,q.z=this._z,q.w=this._w,q):this.scaleToRef(1/f,q)}toVector3(){return new i(this._x,this._y,this._z)}clone(){return new t(this._x,this._y,this._z,this._w)}H(q){return this.x=q.x,this.y=q.y,this.z=q.z,this.w=q.w,this}Af(q,f,j,d){return this.x=q,this.y=f,this.z=j,this.w=d,this}set(q,f,j,d){return this.Af(q,f,j,d)}cf(q){return this.x=this.y=this.z=this.w=q,this}dot(q){return this._x*q.x+this._y*q.y+this._z*q.z+this._w*q.w}static Pf(q,f){return f||(f=0),new t(q[f],q[f+1],q[f+2],q[f+3])}static FromArrayToRef(q,f,j){return j.x=q[f],j.y=q[f+1],j.z=q[f+2],j.w=q[f+3],j}static FromFloatArrayToRef(q,f,j){return t.FromArrayToRef(q,f,j),j}static FromFloatsToRef(q,f,j,d,g){return g.x=q,g.y=f,g.z=j,g.w=d,g}static Zero(){return new t(0,0,0,0)}static One(){return new t(1,1,1,1)}static Random(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new t((0,H.RandomRange)(q,f),(0,H.RandomRange)(q,f),(0,H.RandomRange)(q,f),(0,H.RandomRange)(q,f))}static RandomToRef(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,j=arguments.length>2?arguments[2]:void 0;return j.x=(0,H.RandomRange)(q,f),j.y=(0,H.RandomRange)(q,f),j.z=(0,H.RandomRange)(q,f),j.w=(0,H.RandomRange)(q,f),j}static Clamp(q,f,j){return t.ClampToRef(q,f,j,new t)}static ClampToRef(q,f,j,d){return d.x=(0,H.Clamp)(q.x,f.x,j.x),d.y=(0,H.Clamp)(q.y,f.y,j.y),d.z=(0,H.Clamp)(q.z,f.z,j.z),d.w=(0,H.Clamp)(q.w,f.w,j.w),d}static CheckExtends(q,f,j){f.minimizeInPlace(q),j.maximizeInPlace(q)}static get ZeroReadOnly(){return t._ZeroReadOnly}static Normalize(q){return t.NormalizeToRef(q,new t)}static NormalizeToRef(q,f){return q.normalizeToRef(f),f}static Minimize(q,f){const j=new t;return j.H(q),j.minimizeInPlace(f),j}static Maximize(q,f){const j=new t;return j.H(q),j.maximizeInPlace(f),j}static Distance(q,f){return Math.sqrt(t.DistanceSquared(q,f))}static DistanceSquared(q,f){const j=q.x-f.x,d=q.y-f.y,g=q.z-f.z,h=q.w-f.w;return j*j+d*d+g*g+h*h}static Center(q,f){return t.CenterToRef(q,f,new t)}static CenterToRef(q,f,j){return j.x=(q.x+f.x)/2,j.y=(q.y+f.y)/2,j.z=(q.z+f.z)/2,j.w=(q.w+f.w)/2,j}static TransformCoordinates(q,f){return t.TransformCoordinatesToRef(q,f,new t)}static TransformCoordinatesToRef(q,f,j){return t.TransformCoordinatesFromFloatsToRef(q._x,q._y,q._z,f,j),j}static TransformCoordinatesFromFloatsToRef(q,f,j,d,g){const h=d.m,L=q*h[0]+f*h[4]+j*h[8]+h[12],Q=q*h[1]+f*h[5]+j*h[9]+h[13],H=q*h[2]+f*h[6]+j*h[10]+h[14],r=q*h[3]+f*h[7]+j*h[11]+h[15];return g.x=L,g.y=Q,g.z=H,g.w=r,g}static TransformNormal(q,f){return t.TransformNormalToRef(q,f,new t)}static TransformNormalToRef(q,f,j){const d=f.m,g=q.x*d[0]+q.y*d[4]+q.z*d[8],h=q.x*d[1]+q.y*d[5]+q.z*d[9],L=q.x*d[2]+q.y*d[6]+q.z*d[10];return j.x=g,j.y=h,j.z=L,j.w=q.w,j}static TransformNormalFromFloatsToRef(q,f,j,d,g,h){const L=g.m;return h.x=q*L[0]+f*L[4]+j*L[8],h.y=q*L[1]+f*L[5]+j*L[9],h.z=q*L[2]+f*L[6]+j*L[10],h.w=d,h}static FromVector3(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new t(q._x,q._y,q._z,f)}static Dot(q,f){return q.x*f.x+q.y*f.y+q.z*f.z+q.w*f.w}}t._V8PerformanceHack=new t(.5,.5,.5,.5),t._ZeroReadOnly=t.Zero(),Object.defineProperties(t.prototype,{dimension:{value:[4]},rank:{value:1}});class O{get x(){return this._x}set x(q){this._x=q,this._isDirty=!0}get y(){return this._y}set y(q){this._y=q,this._isDirty=!0}get z(){return this._z}set z(q){this._z=q,this._isDirty=!0}get w(){return this._w}set w(q){this._w=q,this._isDirty=!0}constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this._isDirty=!0,this._x=q,this._y=f,this._z=j,this._w=d}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Quaternion"}getHashCode(){let q=B(this._x);return q=397*q^B(this._y),q=397*q^B(this._z),q=397*q^B(this._w),q}Yf(){return[this._x,this._y,this._z,this._w]}toArray(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return q[f]=this._x,q[f+1]=this._y,q[f+2]=this._z,q[f+3]=this._w,this}Zj(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return O.FromArrayToRef(q,f,this)}equals(q){return q&&this._x===q._x&&this._y===q._y&&this._z===q._z&&this._w===q._w}equalsWithEpsilon(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.d;return q&&(0,H.WithinEpsilon)(this._x,q._x,f)&&(0,H.WithinEpsilon)(this._y,q._y,f)&&(0,H.WithinEpsilon)(this._z,q._z,f)&&(0,H.WithinEpsilon)(this._w,q._w,f)}isApprox(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.d;return q&&((0,H.WithinEpsilon)(this._x,q._x,f)&&(0,H.WithinEpsilon)(this._y,q._y,f)&&(0,H.WithinEpsilon)(this._z,q._z,f)&&(0,H.WithinEpsilon)(this._w,q._w,f)||(0,H.WithinEpsilon)(this._x,-q._x,f)&&(0,H.WithinEpsilon)(this._y,-q._y,f)&&(0,H.WithinEpsilon)(this._z,-q._z,f)&&(0,H.WithinEpsilon)(this._w,-q._w,f))}clone(){return new O(this._x,this._y,this._z,this._w)}H(q){return this._x=q._x,this._y=q._y,this._z=q._z,this._w=q._w,this._isDirty=!0,this}Af(q,f,j,d){return this._x=q,this._y=f,this._z=j,this._w=d,this._isDirty=!0,this}set(q,f,j,d){return this.Af(q,f,j,d)}cf(q){return this.Af(q,q,q,q)}add(q){return new O(this._x+q._x,this._y+q._y,this._z+q._z,this._w+q._w)}addInPlace(q){return this._x+=q._x,this._y+=q._y,this._z+=q._z,this._w+=q._w,this._isDirty=!0,this}addToRef(q,f){return f._x=this._x+q._x,f._y=this._y+q._y,f._z=this._z+q._z,f._w=this._w+q._w,f._isDirty=!0,f}addInPlaceFromFloats(q,f,j,d){return this._x+=q,this._y+=f,this._z+=j,this._w+=d,this._isDirty=!0,this}subtractToRef(q,f){return f._x=this._x-q._x,f._y=this._y-q._y,f._z=this._z-q._z,f._w=this._w-q._w,f._isDirty=!0,f}subtractFromFloats(q,f,j,d){return this.subtractFromFloatsToRef(q,f,j,d,new O)}subtractFromFloatsToRef(q,f,j,d,g){return g._x=this._x-q,g._y=this._y-f,g._z=this._z-j,g._w=this._w-d,g._isDirty=!0,g}ej(q){return new O(this._x-q._x,this._y-q._y,this._z-q._z,this._w-q._w)}eX(q){return this._x-=q._x,this._y-=q._y,this._z-=q._z,this._w-=q._w,this._isDirty=!0,this}scale(q){return new O(this._x*q,this._y*q,this._z*q,this._w*q)}scaleToRef(q,f){return f._x=this._x*q,f._y=this._y*q,f._z=this._z*q,f._w=this._w*q,f._isDirty=!0,f}scaleInPlace(q){return this._x*=q,this._y*=q,this._z*=q,this._w*=q,this._isDirty=!0,this}scaleAndAddToRef(q,f){return f._x+=this._x*q,f._y+=this._y*q,f._z+=this._z*q,f._w+=this._w*q,f._isDirty=!0,f}multiply(q){const f=new O(0,0,0,1);return this.multiplyToRef(q,f),f}multiplyToRef(q,f){const j=this._x*q._w+this._y*q._z-this._z*q._y+this._w*q._x,d=-this._x*q._z+this._y*q._w+this._z*q._x+this._w*q._y,g=this._x*q._y-this._y*q._x+this._z*q._w+this._w*q._z,h=-this._x*q._x-this._y*q._y-this._z*q._z+this._w*q._w;return f.Af(j,d,g,h),f}multiplyInPlace(q){return this.multiplyToRef(q,this)}multiplyByFloats(q,f,j,d){return this._x*=q,this._y*=f,this._z*=j,this._w*=d,this._isDirty=!0,this}divide(q){throw new ReferenceError("Can not divide a quaternion")}divideToRef(q,f){throw new ReferenceError("Can not divide a quaternion")}divideInPlace(q){throw new ReferenceError("Can not divide a quaternion")}minimizeInPlace(){throw new ReferenceError("Can not minimize a quaternion")}minimizeInPlaceFromFloats(){throw new ReferenceError("Can not minimize a quaternion")}maximizeInPlace(){throw new ReferenceError("Can not maximize a quaternion")}maximizeInPlaceFromFloats(){throw new ReferenceError("Can not maximize a quaternion")}negate(){return this.negateToRef(new O)}negateInPlace(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._isDirty=!0,this}negateToRef(q){return q._x=-this._x,q._y=-this._y,q._z=-this._z,q._w=-this._w,q._isDirty=!0,q}equalsToFloats(q,f,j,d){return this._x===q&&this._y===f&&this._z===j&&this._w===d}floorToRef(q){throw new ReferenceError("Can not floor a quaternion")}floor(){throw new ReferenceError("Can not floor a quaternion")}fractToRef(q){throw new ReferenceError("Can not fract a quaternion")}fract(){throw new ReferenceError("Can not fract a quaternion")}conjugateToRef(q){return q.Af(-this._x,-this._y,-this._z,this._w),q}conjugateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}conjugate(){return new O(-this._x,-this._y,-this._z,this._w)}invert(){const q=this.conjugate(),f=this.lengthSquared();return 0==f||1==f||q.scaleInPlace(1/f),q}invertInPlace(){this.conjugateInPlace();const q=this.lengthSquared();return 0==q||1==q||this.scaleInPlace(1/q),this}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this.lengthSquared())}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(q){return 0===q||1===q?this:this.scaleInPlace(1/q)}normalizeToNew(){const q=new O(0,0,0,1);return this.normalizeToRef(q),q}normalizeToRef(q){const f=this.length();return 0===f||1===f?q.Af(this._x,this._y,this._z,this._w):this.scaleToRef(1/f,q)}toEulerAngles(){const q=i.Zero();return this.toEulerAnglesToRef(q),q}toEulerAnglesToRef(q){const f=this._z,j=this._x,d=this._y,g=this._w,h=d*f-j*g,L=.4999999;if(h<-L)q._y=2*Math.atan2(d,g),q._x=Math.PI/2,q._z=0,q._isDirty=!0;else if(h>L)q._y=2*Math.atan2(d,g),q._x=-Math.PI/2,q._z=0,q._isDirty=!0;else{const L=g*g,Q=f*f,H=j*j,r=d*d;q._z=Math.atan2(2*(j*d+f*g),-Q-H+r+L),q._x=Math.asin(-2*h),q._y=Math.atan2(2*(f*j+d*g),Q-H-r+L),q._isDirty=!0}return q}toAlphaBetaGammaToRef(q){const f=this._z,j=this._x,d=this._y,g=this._w,h=Math.sqrt(j*j+d*d),L=Math.sqrt(f*f+g*g),Q=2*Math.atan2(h,L),H=2*Math.atan2(f,g),r=2*Math.atan2(d,j),u=(H+r)/2,X=(H-r)/2;return q.set(X,Q,u),q}toRotationMatrix(q){return N.FromQuaternionToRef(this,q),q}fromRotationMatrix(q){return O.FromRotationMatrixToRef(q,this),this}dot(q){return this._x*q._x+this._y*q._y+this._z*q._z+this._w*q._w}toAxisAngle(){const q=i.Zero();return{axis:q,angle:this.toAxisAngleToRef(q)}}toAxisAngleToRef(q){let f=0;const j=Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z),d=this._w;return j>0?(f=2*Math.atan2(j,d),q.set(this._x/j,this._y/j,this._z/j)):(f=0,q.set(1,0,0)),f}static FromRotationMatrix(q){const f=new O;return O.FromRotationMatrixToRef(q,f),f}static FromRotationMatrixToRef(q,f){const j=q.m,d=j[0],g=j[4],h=j[8],L=j[1],Q=j[5],H=j[9],r=j[2],u=j[6],X=j[10],z=d+Q+X;let B;return z>0?(B=.5/Math.sqrt(z+1),f._w=.25/B,f._x=(u-H)*B,f._y=(h-r)*B,f._z=(L-g)*B,f._isDirty=!0):d>Q&&d>X?(B=2*Math.sqrt(1+d-Q-X),f._w=(u-H)/B,f._x=.25*B,f._y=(g+L)/B,f._z=(h+r)/B,f._isDirty=!0):Q>X?(B=2*Math.sqrt(1+Q-d-X),f._w=(h-r)/B,f._x=(g+L)/B,f._y=.25*B,f._z=(H+u)/B,f._isDirty=!0):(B=2*Math.sqrt(1+X-d-Q),f._w=(L-g)/B,f._x=(h+r)/B,f._y=(H+u)/B,f._z=.25*B,f._isDirty=!0),f}static Dot(q,f){return q._x*f._x+q._y*f._y+q._z*f._z+q._w*f._w}static AreClose(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1;const d=O.Dot(q,f);return 1-d*d<=j}static SmoothToRef(q,f,j,d,g){let h=0===d?1:j/d;return h=(0,H.Clamp)(h,0,1),O.SlerpToRef(q,f,h,g),g}static Zero(){return new O(0,0,0,0)}static Inverse(q){return new O(-q._x,-q._y,-q._z,q._w)}static InverseToRef(q,f){return f.set(-q._x,-q._y,-q._z,q._w),f}static Identity(){return new O(0,0,0,1)}static IsIdentity(q){return q&&0===q._x&&0===q._y&&0===q._z&&1===q._w}static RotationAxis(q,f){return O.RotationAxisToRef(q,f,new O)}static RotationAxisToRef(q,f,j){j._w=Math.cos(f/2);const d=Math.sin(f/2)/q.length();return j._x=q._x*d,j._y=q._y*d,j._z=q._z*d,j._isDirty=!0,j}static Pf(q,f){return f||(f=0),new O(q[f],q[f+1],q[f+2],q[f+3])}static FromArrayToRef(q,f,j){return j._x=q[f],j._y=q[f+1],j._z=q[f+2],j._w=q[f+3],j._isDirty=!0,j}static FromFloatsToRef(q,f,j,d,g){return g.Af(q,f,j,d),g}static FromEulerAngles(q,f,j){const d=new O;return O.RotationYawPitchRollToRef(f,q,j,d),d}static FromEulerAnglesToRef(q,f,j,d){return O.RotationYawPitchRollToRef(f,q,j,d),d}static FromEulerVector(q){const f=new O;return O.RotationYawPitchRollToRef(q._y,q._x,q._z,f),f}static FromEulerVectorToRef(q,f){return O.RotationYawPitchRollToRef(q._y,q._x,q._z,f),f}static FromUnitVectorsToRef(q,f,j){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:d.d;const h=i.Dot(q,f)+1;return h<g?Math.abs(q.x)>Math.abs(q.z)?j.set(-q.y,q.x,0,0):j.set(0,-q.z,q.y,0):(i.CrossToRef(q,f,E.kf[0]),j.set(E.kf[0].x,E.kf[0].y,E.kf[0].z,h)),j.normalize()}static RotationYawPitchRoll(q,f,j){const d=new O;return O.RotationYawPitchRollToRef(q,f,j,d),d}static RotationYawPitchRollToRef(q,f,j,d){const g=.5*j,h=.5*f,L=.5*q,Q=Math.sin(g),H=Math.cos(g),r=Math.sin(h),u=Math.cos(h),X=Math.sin(L),z=Math.cos(L);return d._x=z*r*H+X*u*Q,d._y=X*u*H-z*r*Q,d._z=z*u*Q-X*r*H,d._w=z*u*H+X*r*Q,d._isDirty=!0,d}static RotationAlphaBetaGamma(q,f,j){const d=new O;return O.RotationAlphaBetaGammaToRef(q,f,j,d),d}static RotationAlphaBetaGammaToRef(q,f,j,d){const g=.5*(j+q),h=.5*(j-q),L=.5*f;return d._x=Math.cos(h)*Math.sin(L),d._y=Math.sin(h)*Math.sin(L),d._z=Math.sin(g)*Math.cos(L),d._w=Math.cos(g)*Math.cos(L),d._isDirty=!0,d}static RotationQuaternionFromAxis(q,f,j){const d=new O(0,0,0,0);return O.RotationQuaternionFromAxisToRef(q,f,j,d),d}static RotationQuaternionFromAxisToRef(q,f,j,d){const g=w.Matrix[0];return q=q.normalizeToRef(w.kf[0]),f=f.normalizeToRef(w.kf[1]),j=j.normalizeToRef(w.kf[2]),N.FromXYZAxesToRef(q,f,j,g),O.FromRotationMatrixToRef(g,d),d}static FromLookDirectionLH(q,f){const j=new O;return O.FromLookDirectionLHToRef(q,f,j),j}static FromLookDirectionLHToRef(q,f,j){const d=w.Matrix[0];return N.LookDirectionLHToRef(q,f,d),O.FromRotationMatrixToRef(d,j),j}static FromLookDirectionRH(q,f){const j=new O;return O.FromLookDirectionRHToRef(q,f,j),j}static FromLookDirectionRHToRef(q,f,j){const d=w.Matrix[0];return N.LookDirectionRHToRef(q,f,d),O.FromRotationMatrixToRef(d,j)}static Slerp(q,f,j){const d=O.Identity();return O.SlerpToRef(q,f,j,d),d}static SlerpToRef(q,f,j,d){let g,h,L=q._x*f._x+q._y*f._y+q._z*f._z+q._w*f._w,Q=!1;if(L<0&&(Q=!0,L=-L),L>.999999)h=1-j,g=Q?-j:j;else{const q=Math.acos(L),f=1/Math.sin(q);h=Math.sin((1-j)*q)*f,g=Q?-Math.sin(j*q)*f:Math.sin(j*q)*f}return d._x=h*q._x+g*f._x,d._y=h*q._y+g*f._y,d._z=h*q._z+g*f._z,d._w=h*q._w+g*f._w,d._isDirty=!0,d}static Hermite(q,f,j,d,g){const h=g*g,L=g*h,Q=2*L-3*h+1,H=-2*L+3*h,r=L-2*h+g,u=L-h,X=q._x*Q+j._x*H+f._x*r+d._x*u,z=q._y*Q+j._y*H+f._y*r+d._y*u,B=q._z*Q+j._z*H+f._z*r+d._z*u,D=q._w*Q+j._w*H+f._w*r+d._w*u;return new O(X,z,B,D)}static Hermite1stDerivative(q,f,j,d,g){const h=new O;return this.Hermite1stDerivativeToRef(q,f,j,d,g,h),h}static Hermite1stDerivativeToRef(q,f,j,d,g,h){const L=g*g;return h._x=6*(L-g)*q._x+(3*L-4*g+1)*f._x+6*(-L+g)*j._x+(3*L-2*g)*d._x,h._y=6*(L-g)*q._y+(3*L-4*g+1)*f._y+6*(-L+g)*j._y+(3*L-2*g)*d._y,h._z=6*(L-g)*q._z+(3*L-4*g+1)*f._z+6*(-L+g)*j._z+(3*L-2*g)*d._z,h._w=6*(L-g)*q._w+(3*L-4*g+1)*f._w+6*(-L+g)*j._w+(3*L-2*g)*d._w,h._isDirty=!0,h}static Normalize(q){const f=O.Zero();return O.NormalizeToRef(q,f),f}static NormalizeToRef(q,f){return q.normalizeToRef(f),f}static Clamp(q,f,j){const d=new O;return O.ClampToRef(q,f,j,d),d}static ClampToRef(q,f,j,d){return d.Af((0,H.Clamp)(q.x,f.x,j.x),(0,H.Clamp)(q.y,f.y,j.y),(0,H.Clamp)(q.z,f.z,j.z),(0,H.Clamp)(q.w,f.w,j.w))}static Random(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new O((0,H.RandomRange)(q,f),(0,H.RandomRange)(q,f),(0,H.RandomRange)(q,f),(0,H.RandomRange)(q,f))}static RandomToRef(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).Af((0,H.RandomRange)(q,f),(0,H.RandomRange)(q,f),(0,H.RandomRange)(q,f),(0,H.RandomRange)(q,f))}static Minimize(){throw new ReferenceError("Quaternion.Minimize does not make sense")}static Maximize(){throw new ReferenceError("Quaternion.Maximize does not make sense")}static Distance(q,f){return Math.sqrt(O.DistanceSquared(q,f))}static DistanceSquared(q,f){const j=q.x-f.x,d=q.y-f.y,g=q.z-f.z,h=q.w-f.w;return j*j+d*d+g*g+h*h}static Center(q,f){return O.CenterToRef(q,f,O.Zero())}static CenterToRef(q,f,j){return j.Af((q.x+f.x)/2,(q.y+f.y)/2,(q.z+f.z)/2,(q.w+f.w)/2)}}O._V8PerformanceHack=new O(.5,.5,.5,.5),Object.defineProperties(O.prototype,{dimension:{value:[4]},rank:{value:1}});class N{static get Use64Bits(){return L.b.MatrixUse64Bits}get m(){return this.cz}markAsUpdated(){this.updateFlag=r._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}_updateIdentityStatus(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._isIdentity=q,this._isIdentity3x2=q||j,this._isIdentityDirty=!this._isIdentity&&f,this._isIdentity3x2Dirty=!this._isIdentity3x2&&d}constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,L.b.MatrixTrackPrecisionChange&&L.b.MatrixTrackedMatrices.push(this),this.cz=new L.b.MatrixCurrentType(16),this.markAsUpdated()}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const q=this.cz;this._isIdentity=1===q[0]&&0===q[1]&&0===q[2]&&0===q[3]&&0===q[4]&&1===q[5]&&0===q[6]&&0===q[7]&&0===q[8]&&0===q[9]&&1===q[10]&&0===q[11]&&0===q[12]&&0===q[13]&&0===q[14]&&1===q[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this.cz[0]||1!==this.cz[5]||1!==this.cz[15]||0!==this.cz[1]||0!==this.cz[2]||0!==this.cz[3]||0!==this.cz[4]||0!==this.cz[6]||0!==this.cz[7]||0!==this.cz[8]||0!==this.cz[9]||0!==this.cz[10]||0!==this.cz[11]||0!==this.cz[12]||0!==this.cz[13]||0!==this.cz[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const q=this.cz,f=q[0],j=q[1],d=q[2],g=q[3],h=q[4],L=q[5],Q=q[6],H=q[7],r=q[8],u=q[9],X=q[10],z=q[11],B=q[12],D=q[13],i=q[14],t=q[15],O=X*t-i*z,N=u*t-D*z,w=u*i-D*X,E=r*t-B*z,s=r*i-X*B,S=r*D-B*u;return f*+(L*O-Q*N+H*w)+j*-(h*O-Q*E+H*s)+d*+(h*N-L*E+H*S)+g*-(h*w-L*s+Q*S)}toString(){return`{${this.m[0]}, ${this.m[1]}, ${this.m[2]}, ${this.m[3]}\n${this.m[4]}, ${this.m[5]}, ${this.m[6]}, ${this.m[7]}\n${this.m[8]}, ${this.m[9]}, ${this.m[10]}, ${this.m[11]}\n${this.m[12]}, ${this.m[13]}, ${this.m[14]}, ${this.m[15]}}`}toArray(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!q)return this.cz;const j=this.cz;for(let d=0;d<16;d++)q[f+d]=j[d];return this}Yf(){return this.cz}Zj(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return N.FromArrayToRef(q,f,this)}Af(){for(var q=arguments.length,f=new Array(q),j=0;j<q;j++)f[j]=arguments[j];return N.FromArrayToRef(f,0,this)}set(){const q=this.cz;for(let f=0;f<16;f++)q[f]=f<0||arguments.length<=f?void 0:arguments[f];return this.markAsUpdated(),this}cf(q){const f=this.cz;for(let j=0;j<16;j++)f[j]=q;return this.markAsUpdated(),this}invert(){return this.invertToRef(this),this}reset(){return N.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(q){const f=new N;return this.addToRef(q,f),f}addToRef(q,f){const j=this.cz,d=f.cz,g=q.m;for(let h=0;h<16;h++)d[h]=j[h]+g[h];return f.markAsUpdated(),f}addToSelf(q){const f=this.cz,j=q.m;return f[0]+=j[0],f[1]+=j[1],f[2]+=j[2],f[3]+=j[3],f[4]+=j[4],f[5]+=j[5],f[6]+=j[6],f[7]+=j[7],f[8]+=j[8],f[9]+=j[9],f[10]+=j[10],f[11]+=j[11],f[12]+=j[12],f[13]+=j[13],f[14]+=j[14],f[15]+=j[15],this.markAsUpdated(),this}addInPlace(q){const f=this.cz,j=q.m;for(let d=0;d<16;d++)f[d]+=j[d];return this.markAsUpdated(),this}addInPlaceFromFloats(){const q=this.cz;for(let f=0;f<16;f++)q[f]+=f<0||arguments.length<=f?void 0:arguments[f];return this.markAsUpdated(),this}ej(q){const f=this.cz,j=q.m;for(let d=0;d<16;d++)f[d]-=j[d];return this.markAsUpdated(),this}subtractToRef(q,f){const j=this.cz,d=q.m,g=f.cz;for(let h=0;h<16;h++)g[h]=j[h]-d[h];return f.markAsUpdated(),f}eX(q){const f=this.cz,j=q.m;for(let d=0;d<16;d++)f[d]-=j[d];return this.markAsUpdated(),this}subtractFromFloats(){for(var q=arguments.length,f=new Array(q),j=0;j<q;j++)f[j]=arguments[j];return this.subtractFromFloatsToRef(...f,new N)}subtractFromFloatsToRef(){for(var q=arguments.length,f=new Array(q),j=0;j<q;j++)f[j]=arguments[j];const d=f.pop(),g=this.cz,h=d.cz,L=f;for(let Q=0;Q<16;Q++)h[Q]=g[Q]-L[Q];return d.markAsUpdated(),d}invertToRef(q){return!0===this._isIdentity?(N.IdentityToRef(q),q):(z(this,q.Yf())?q.markAsUpdated():q.H(this),q)}addAtIndex(q,f){return this.cz[q]+=f,this.markAsUpdated(),this}multiplyAtIndex(q,f){return this.cz[q]*=f,this.markAsUpdated(),this}setTranslationFromFloats(q,f,j){return this.cz[12]=q,this.cz[13]=f,this.cz[14]=j,this.markAsUpdated(),this}addTranslationFromFloats(q,f,j){return this.cz[12]+=q,this.cz[13]+=f,this.cz[14]+=j,this.markAsUpdated(),this}setTranslation(q){return this.setTranslationFromFloats(q._x,q._y,q._z)}getTranslation(){return new i(this.cz[12],this.cz[13],this.cz[14])}getTranslationToRef(q){return q.x=this.cz[12],q.y=this.cz[13],q.z=this.cz[14],q}removeRotationAndScaling(){const q=this.m;return N.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,q[12],q[13],q[14],q[15],this),this._updateIdentityStatus(0===q[12]&&0===q[13]&&0===q[14]&&1===q[15]),this}H(q){q.copyToArray(this.cz);const f=q;return this.updateFlag=f.updateFlag,this._updateIdentityStatus(f._isIdentity,f._isIdentityDirty,f._isIdentity3x2,f._isIdentity3x2Dirty),this}copyToArray(q){return X(this,q,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),this}multiply(q){const f=new N;return this.multiplyToRef(q,f),f}multiplyInPlace(q){const f=this.cz,j=q.m;for(let d=0;d<16;d++)f[d]*=j[d];return this.markAsUpdated(),this}multiplyByFloats(){const q=this.cz;for(let f=0;f<16;f++)q[f]*=f<0||arguments.length<=f?void 0:arguments[f];return this.markAsUpdated(),this}multiplyByFloatsToRef(){for(var q=arguments.length,f=new Array(q),j=0;j<q;j++)f[j]=arguments[j];const d=f.pop(),g=this.cz,h=d.cz,L=f;for(let Q=0;Q<16;Q++)h[Q]=g[Q]*L[Q];return d.markAsUpdated(),d}multiplyToRef(q,f){return this._isIdentity?(f.H(q),f):q._isIdentity?(f.H(this),f):(this.multiplyToArray(q,f.cz,0),f.markAsUpdated(),f)}multiplyToArray(q,f,j){return u(this,q,f,j),this}divide(q){return this.divideToRef(q,new N)}divideToRef(q,f){const j=this.cz,d=q.m,g=f.cz;for(let h=0;h<16;h++)g[h]=j[h]/d[h];return f.markAsUpdated(),f}divideInPlace(q){const f=this.cz,j=q.m;for(let d=0;d<16;d++)f[d]/=j[d];return this.markAsUpdated(),this}minimizeInPlace(q){const f=this.cz,j=q.m;for(let d=0;d<16;d++)f[d]=Math.min(f[d],j[d]);return this.markAsUpdated(),this}minimizeInPlaceFromFloats(){const q=this.cz;for(let f=0;f<16;f++)q[f]=Math.min(q[f],f<0||arguments.length<=f?void 0:arguments[f]);return this.markAsUpdated(),this}maximizeInPlace(q){const f=this.cz,j=q.m;for(let d=0;d<16;d++)f[d]=Math.min(f[d],j[d]);return this.markAsUpdated(),this}maximizeInPlaceFromFloats(){const q=this.cz;for(let f=0;f<16;f++)q[f]=Math.min(q[f],f<0||arguments.length<=f?void 0:arguments[f]);return this.markAsUpdated(),this}negate(){return this.negateToRef(new N)}negateInPlace(){const q=this.cz;for(let f=0;f<16;f++)q[f]=-q[f];return this.markAsUpdated(),this}negateToRef(q){const f=this.cz,j=q.cz;for(let d=0;d<16;d++)j[d]=-f[d];return q.markAsUpdated(),q}equals(q){const f=q;if(!f)return!1;if((this._isIdentity||f._isIdentity)&&!this._isIdentityDirty&&!f._isIdentityDirty)return this._isIdentity&&f._isIdentity;const j=this.m,d=f.m;return j[0]===d[0]&&j[1]===d[1]&&j[2]===d[2]&&j[3]===d[3]&&j[4]===d[4]&&j[5]===d[5]&&j[6]===d[6]&&j[7]===d[7]&&j[8]===d[8]&&j[9]===d[9]&&j[10]===d[10]&&j[11]===d[11]&&j[12]===d[12]&&j[13]===d[13]&&j[14]===d[14]&&j[15]===d[15]}equalsWithEpsilon(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const j=this.cz,d=q.m;for(let g=0;g<16;g++)if(!(0,H.WithinEpsilon)(j[g],d[g],f))return!1;return!0}equalsToFloats(){const q=this.cz;for(let f=0;f<16;f++)if(q[f]!=(f<0||arguments.length<=f?void 0:arguments[f]))return!1;return!0}floor(){return this.floorToRef(new N)}floorToRef(q){const f=this.cz,j=q.cz;for(let d=0;d<16;d++)j[d]=Math.floor(f[d]);return q.markAsUpdated(),q}fract(){return this.fractToRef(new N)}fractToRef(q){const f=this.cz,j=q.cz;for(let d=0;d<16;d++)j[d]=f[d]-Math.floor(f[d]);return q.markAsUpdated(),q}clone(){const q=new N;return q.H(this),q}getClassName(){return"Matrix"}getHashCode(){let q=B(this.cz[0]);for(let f=1;f<16;f++)q=397*q^B(this.cz[f]);return q}decomposeToTransformNode(q){return q.rotationQuaternion=q.rotationQuaternion||new O,this.decompose(q.Vf,q.rotationQuaternion,q.position)}decompose(q,f,j,d){let g=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._isIdentity)return j&&j.cf(0),q&&q.cf(1),f&&f.Af(0,0,0,1),!0;const h=this.cz;if(j&&j.Af(h[12],h[13],h[14]),(q=q||w.kf[0]).x=Math.sqrt(h[0]*h[0]+h[1]*h[1]+h[2]*h[2]),q.y=Math.sqrt(h[4]*h[4]+h[5]*h[5]+h[6]*h[6]),q.z=Math.sqrt(h[8]*h[8]+h[9]*h[9]+h[10]*h[10]),d){const f=(g?d.absoluteScaling.x:d.Vf.x)<0?-1:1,j=(g?d.absoluteScaling.y:d.Vf.y)<0?-1:1,h=(g?d.absoluteScaling.z:d.Vf.z)<0?-1:1;q.x*=f,q.y*=j,q.z*=h}else this.determinant()<=0&&(q.y*=-1);if(0===q._x||0===q._y||0===q._z)return f&&f.Af(0,0,0,1),!1;if(f){const j=1/q._x,d=1/q._y,g=1/q._z;N.FromValuesToRef(h[0]*j,h[1]*j,h[2]*j,0,h[4]*d,h[5]*d,h[6]*d,0,h[8]*g,h[9]*g,h[10]*g,0,0,0,0,1,w.Matrix[0]),O.FromRotationMatrixToRef(w.Matrix[0],f)}return!0}getRow(q){if(q<0||q>3)return null;const f=4*q;return new t(this.cz[f+0],this.cz[f+1],this.cz[f+2],this.cz[f+3])}getRowToRef(q,f){if(q>=0&&q<=3){const j=4*q;f.x=this.cz[j+0],f.y=this.cz[j+1],f.z=this.cz[j+2],f.w=this.cz[j+3]}return f}setRow(q,f){return this.setRowFromFloats(q,f.x,f.y,f.z,f.w)}transpose(){const q=new N;return N.TransposeToRef(this,q),q}transposeToRef(q){return N.TransposeToRef(this,q),q}setRowFromFloats(q,f,j,d,g){if(q<0||q>3)return this;const h=4*q;return this.cz[h+0]=f,this.cz[h+1]=j,this.cz[h+2]=d,this.cz[h+3]=g,this.markAsUpdated(),this}scale(q){const f=new N;return this.scaleToRef(q,f),f}scaleToRef(q,f){for(let j=0;j<16;j++)f.cz[j]=this.cz[j]*q;return f.markAsUpdated(),f}scaleAndAddToRef(q,f){for(let j=0;j<16;j++)f.cz[j]+=this.cz[j]*q;return f.markAsUpdated(),f}scaleInPlace(q){const f=this.cz;for(let j=0;j<16;j++)f[j]*=q;return this.markAsUpdated(),this}toNormalMatrix(q){const f=w.Matrix[0];this.invertToRef(f),f.transposeToRef(q);const j=q.cz;return N.FromValuesToRef(j[0],j[1],j[2],0,j[4],j[5],j[6],0,j[8],j[9],j[10],0,0,0,0,1,q),q}getRotationMatrix(){const q=new N;return this.getRotationMatrixToRef(q),q}getRotationMatrixToRef(q){const f=w.kf[0];if(!this.decompose(f))return N.IdentityToRef(q),q;const j=this.cz,d=1/f._x,g=1/f._y,h=1/f._z;return N.FromValuesToRef(j[0]*d,j[1]*d,j[2]*d,0,j[4]*g,j[5]*g,j[6]*g,0,j[8]*h,j[9]*h,j[10]*h,0,0,0,0,1,q),q}toggleModelMatrixHandInPlace(){const q=this.cz;return q[2]*=-1,q[6]*=-1,q[8]*=-1,q[9]*=-1,q[14]*=-1,this.markAsUpdated(),this}toggleProjectionMatrixHandInPlace(){const q=this.cz;return q[8]*=-1,q[9]*=-1,q[10]*=-1,q[11]*=-1,this.markAsUpdated(),this}static Pf(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const j=new N;return N.FromArrayToRef(q,f,j),j}static FromArrayToRef(q,f,j){for(let d=0;d<16;d++)j.cz[d]=q[d+f];return j.markAsUpdated(),j}static FromFloat32ArrayToRefScaled(q,f,j,d){return d.cz[0]=q[0+f]*j,d.cz[1]=q[1+f]*j,d.cz[2]=q[2+f]*j,d.cz[3]=q[3+f]*j,d.cz[4]=q[4+f]*j,d.cz[5]=q[5+f]*j,d.cz[6]=q[6+f]*j,d.cz[7]=q[7+f]*j,d.cz[8]=q[8+f]*j,d.cz[9]=q[9+f]*j,d.cz[10]=q[10+f]*j,d.cz[11]=q[11+f]*j,d.cz[12]=q[12+f]*j,d.cz[13]=q[13+f]*j,d.cz[14]=q[14+f]*j,d.cz[15]=q[15+f]*j,d.markAsUpdated(),d}static get IdentityReadOnly(){return N._IdentityReadOnly}static FromValuesToRef(q,f,j,d,g,h,L,Q,H,r,u,X,z,B,D,i,t){const O=t.cz;O[0]=q,O[1]=f,O[2]=j,O[3]=d,O[4]=g,O[5]=h,O[6]=L,O[7]=Q,O[8]=H,O[9]=r,O[10]=u,O[11]=X,O[12]=z,O[13]=B,O[14]=D,O[15]=i,t.markAsUpdated()}static FromValues(q,f,j,d,g,h,L,Q,H,r,u,X,z,B,D,i){const t=new N,O=t.cz;return O[0]=q,O[1]=f,O[2]=j,O[3]=d,O[4]=g,O[5]=h,O[6]=L,O[7]=Q,O[8]=H,O[9]=r,O[10]=u,O[11]=X,O[12]=z,O[13]=B,O[14]=D,O[15]=i,t.markAsUpdated(),t}static Compose(q,f,j){const d=new N;return N.ComposeToRef(q,f,j,d),d}static ComposeToRef(q,f,j,d){const g=d.cz,h=f._x,L=f._y,Q=f._z,H=f._w,r=h+h,u=L+L,X=Q+Q,z=h*r,B=h*u,D=h*X,i=L*u,t=L*X,O=Q*X,N=H*r,w=H*u,E=H*X,s=q._x,S=q._y,e=q._z;return g[0]=(1-(i+O))*s,g[1]=(B+E)*s,g[2]=(D-w)*s,g[3]=0,g[4]=(B-E)*S,g[5]=(1-(z+O))*S,g[6]=(t+N)*S,g[7]=0,g[8]=(D+w)*e,g[9]=(t-N)*e,g[10]=(1-(z+i))*e,g[11]=0,g[12]=j._x,g[13]=j._y,g[14]=j._z,g[15]=1,d.markAsUpdated(),d}static Identity(){const q=N.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return q._updateIdentityStatus(!0),q}static IdentityToRef(q){return N.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,q),q._updateIdentityStatus(!0),q}static Zero(){const q=N.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return q._updateIdentityStatus(!1),q}static RotationX(q){const f=new N;return N.RotationXToRef(q,f),f}static Invert(q){const f=new N;return q.invertToRef(f),f}static RotationXToRef(q,f){const j=Math.sin(q),d=Math.cos(q);return N.FromValuesToRef(1,0,0,0,0,d,j,0,0,-j,d,0,0,0,0,1,f),f._updateIdentityStatus(1===d&&0===j),f}static RotationY(q){const f=new N;return N.RotationYToRef(q,f),f}static RotationYToRef(q,f){const j=Math.sin(q),d=Math.cos(q);return N.FromValuesToRef(d,0,-j,0,0,1,0,0,j,0,d,0,0,0,0,1,f),f._updateIdentityStatus(1===d&&0===j),f}static RotationZ(q){const f=new N;return N.RotationZToRef(q,f),f}static RotationZToRef(q,f){const j=Math.sin(q),d=Math.cos(q);return N.FromValuesToRef(d,j,0,0,-j,d,0,0,0,0,1,0,0,0,0,1,f),f._updateIdentityStatus(1===d&&0===j),f}static RotationAxis(q,f){const j=new N;return N.RotationAxisToRef(q,f,j),j}static RotationAxisToRef(q,f,j){const d=Math.sin(-f),g=Math.cos(-f),h=1-g;q=q.normalizeToRef(w.kf[0]);const L=j.cz;return L[0]=q._x*q._x*h+g,L[1]=q._x*q._y*h-q._z*d,L[2]=q._x*q._z*h+q._y*d,L[3]=0,L[4]=q._y*q._x*h+q._z*d,L[5]=q._y*q._y*h+g,L[6]=q._y*q._z*h-q._x*d,L[7]=0,L[8]=q._z*q._x*h-q._y*d,L[9]=q._z*q._y*h+q._x*d,L[10]=q._z*q._z*h+g,L[11]=0,L[12]=0,L[13]=0,L[14]=0,L[15]=1,j.markAsUpdated(),j}static RotationAlignToRef(q,f,j){let g=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const h=i.Dot(f,q),L=j.cz;if(h<-1+d.d)L[0]=-1,L[1]=0,L[2]=0,L[3]=0,L[4]=0,L[5]=g?1:-1,L[6]=0,L[7]=0,L[8]=0,L[9]=0,L[10]=g?-1:1,L[11]=0;else{const j=i.Cross(f,q),d=1/(1+h);L[0]=j._x*j._x*d+h,L[1]=j._y*j._x*d-j._z,L[2]=j._z*j._x*d+j._y,L[3]=0,L[4]=j._x*j._y*d+j._z,L[5]=j._y*j._y*d+h,L[6]=j._z*j._y*d-j._x,L[7]=0,L[8]=j._x*j._z*d-j._y,L[9]=j._y*j._z*d+j._x,L[10]=j._z*j._z*d+h,L[11]=0}return L[12]=0,L[13]=0,L[14]=0,L[15]=1,j.markAsUpdated(),j}static RotationYawPitchRoll(q,f,j){const d=new N;return N.RotationYawPitchRollToRef(q,f,j,d),d}static RotationYawPitchRollToRef(q,f,j,d){return O.RotationYawPitchRollToRef(q,f,j,w.Quaternion[0]),w.Quaternion[0].toRotationMatrix(d),d}static Scaling(q,f,j){const d=new N;return N.ScalingToRef(q,f,j,d),d}static ScalingToRef(q,f,j,d){return N.FromValuesToRef(q,0,0,0,0,f,0,0,0,0,j,0,0,0,0,1,d),d._updateIdentityStatus(1===q&&1===f&&1===j),d}static Translation(q,f,j){const d=new N;return N.TranslationToRef(q,f,j,d),d}static TranslationToRef(q,f,j,d){return N.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,q,f,j,1,d),d._updateIdentityStatus(0===q&&0===f&&0===j),d}static Lerp(q,f,j){const d=new N;return N.LerpToRef(q,f,j,d),d}static LerpToRef(q,f,j,d){const g=d.cz,h=q.m,L=f.m;for(let Q=0;Q<16;Q++)g[Q]=h[Q]*(1-j)+L[Q]*j;return d.markAsUpdated(),d}static DecomposeLerp(q,f,j){const d=new N;return N.DecomposeLerpToRef(q,f,j,d),d}static DecomposeLerpToRef(q,f,j,d){const g=w.kf[0],h=w.Quaternion[0],L=w.kf[1];q.decompose(g,h,L);const Q=w.kf[2],H=w.Quaternion[1],r=w.kf[3];f.decompose(Q,H,r);const u=w.kf[4];i.LerpToRef(g,Q,j,u);const X=w.Quaternion[2];O.SlerpToRef(h,H,j,X);const z=w.kf[5];return i.LerpToRef(L,r,j,z),N.ComposeToRef(u,X,z,d),d}static LookAtLH(q,f,j){const d=new N;return N.LookAtLHToRef(q,f,j,d),d}static LookAtLHToRef(q,f,j,d){const g=w.kf[0],h=w.kf[1],L=w.kf[2];f.subtractToRef(q,L),L.normalize(),i.CrossToRef(j,L,g);const Q=g.lengthSquared();0===Q?g.x=1:g.normalizeFromLength(Math.sqrt(Q)),i.CrossToRef(L,g,h),h.normalize();const H=-i.Dot(g,q),r=-i.Dot(h,q),u=-i.Dot(L,q);return N.FromValuesToRef(g._x,h._x,L._x,0,g._y,h._y,L._y,0,g._z,h._z,L._z,0,H,r,u,1,d),d}static LookAtRH(q,f,j){const d=new N;return N.LookAtRHToRef(q,f,j,d),d}static LookAtRHToRef(q,f,j,d){const g=w.kf[0],h=w.kf[1],L=w.kf[2];q.subtractToRef(f,L),L.normalize(),i.CrossToRef(j,L,g);const Q=g.lengthSquared();0===Q?g.x=1:g.normalizeFromLength(Math.sqrt(Q)),i.CrossToRef(L,g,h),h.normalize();const H=-i.Dot(g,q),r=-i.Dot(h,q),u=-i.Dot(L,q);return N.FromValuesToRef(g._x,h._x,L._x,0,g._y,h._y,L._y,0,g._z,h._z,L._z,0,H,r,u,1,d),d}static LookDirectionLH(q,f){const j=new N;return N.LookDirectionLHToRef(q,f,j),j}static LookDirectionLHToRef(q,f,j){const d=w.kf[0];d.H(q),d.scaleInPlace(-1);const g=w.kf[1];return i.CrossToRef(f,d,g),N.FromValuesToRef(g._x,g._y,g._z,0,f._x,f._y,f._z,0,d._x,d._y,d._z,0,0,0,0,1,j),j}static LookDirectionRH(q,f){const j=new N;return N.LookDirectionRHToRef(q,f,j),j}static LookDirectionRHToRef(q,f,j){const d=w.kf[2];return i.CrossToRef(f,q,d),N.FromValuesToRef(d._x,d._y,d._z,0,f._x,f._y,f._z,0,q._x,q._y,q._z,0,0,0,0,1,j),j}static OrthoLH(q,f,j,d,g){const h=new N;return N.OrthoLHToRef(q,f,j,d,h,g),h}static OrthoLHToRef(q,f,j,d,g,h){const L=2/q,Q=2/f,H=2/(d-j),r=-(d+j)/(d-j);return N.FromValuesToRef(L,0,0,0,0,Q,0,0,0,0,H,0,0,0,r,1,g),h&&g.multiplyToRef(s,g),g._updateIdentityStatus(1===L&&1===Q&&1===H&&0===r),g}static OrthoOffCenterLH(q,f,j,d,g,h,L){const Q=new N;return N.OrthoOffCenterLHToRef(q,f,j,d,g,h,Q,L),Q}static OrthoOffCenterLHToRef(q,f,j,d,g,h,L,Q){const H=2/(f-q),r=2/(d-j),u=2/(h-g),X=-(h+g)/(h-g),z=(q+f)/(q-f),B=(d+j)/(j-d);return N.FromValuesToRef(H,0,0,0,0,r,0,0,0,0,u,0,z,B,X,1,L),Q&&L.multiplyToRef(s,L),L.markAsUpdated(),L}static ObliqueOffCenterLHToRef(q,f,j,d,g,h,L,Q,H,r,u){const X=-L*Math.cos(Q),z=-L*Math.sin(Q);return N.TranslationToRef(0,0,-H,w.Matrix[1]),N.FromValuesToRef(1,0,0,0,0,1,0,0,X,z,1,0,0,0,0,1,w.Matrix[0]),w.Matrix[1].multiplyToRef(w.Matrix[0],w.Matrix[0]),N.TranslationToRef(0,0,H,w.Matrix[1]),w.Matrix[0].multiplyToRef(w.Matrix[1],w.Matrix[0]),N.OrthoOffCenterLHToRef(q,f,j,d,g,h,r,u),w.Matrix[0].multiplyToRef(r,r),r}static OrthoOffCenterRH(q,f,j,d,g,h,L){const Q=new N;return N.OrthoOffCenterRHToRef(q,f,j,d,g,h,Q,L),Q}static OrthoOffCenterRHToRef(q,f,j,d,g,h,L,Q){return N.OrthoOffCenterLHToRef(q,f,j,d,g,h,L,Q),L.cz[10]*=-1,L}static ObliqueOffCenterRHToRef(q,f,j,d,g,h,L,Q,H,r,u){const X=L*Math.cos(Q),z=L*Math.sin(Q);return N.TranslationToRef(0,0,H,w.Matrix[1]),N.FromValuesToRef(1,0,0,0,0,1,0,0,X,z,1,0,0,0,0,1,w.Matrix[0]),w.Matrix[1].multiplyToRef(w.Matrix[0],w.Matrix[0]),N.TranslationToRef(0,0,-H,w.Matrix[1]),w.Matrix[0].multiplyToRef(w.Matrix[1],w.Matrix[0]),N.OrthoOffCenterRHToRef(q,f,j,d,g,h,r,u),w.Matrix[0].multiplyToRef(r,r),r}static PerspectiveLH(q,f,j,d,g){let h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const L=new N,Q=2*j/q,H=2*j/f,r=(d+j)/(d-j),u=-2*d*j/(d-j),X=Math.tan(h);return N.FromValuesToRef(Q,0,0,0,0,H,0,X,0,0,r,1,0,0,u,0,L),g&&L.multiplyToRef(s,L),L._updateIdentityStatus(!1),L}static PerspectiveFovLH(q,f,j,d,g){let h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,L=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const Q=new N;return N.PerspectiveFovLHToRef(q,f,j,d,Q,!0,g,h,L),Q}static PerspectiveFovLHToRef(q,f,j,d,g){let h=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],L=arguments.length>6?arguments[6]:void 0,Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,H=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const r=j,u=d,X=1/Math.tan(.5*q),z=h?X/f:X,B=h?X:X*f,D=H&&0===r?-1:0!==u?(u+r)/(u-r):1,i=H&&0===r?2*u:0!==u?-2*u*r/(u-r):-2*r,t=Math.tan(Q);return N.FromValuesToRef(z,0,0,0,0,B,0,t,0,0,D,1,0,0,i,0,g),L&&g.multiplyToRef(s,g),g._updateIdentityStatus(!1),g}static PerspectiveFovReverseLHToRef(q,f,j,d,g){let h=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],L=arguments.length>6?arguments[6]:void 0,Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const H=1/Math.tan(.5*q),r=h?H/f:H,u=h?H:H*f,X=Math.tan(Q);return N.FromValuesToRef(r,0,0,0,0,u,0,X,0,0,-j,1,0,0,1,0,g),L&&g.multiplyToRef(s,g),g._updateIdentityStatus(!1),g}static PerspectiveFovRH(q,f,j,d,g){let h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,L=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const Q=new N;return N.PerspectiveFovRHToRef(q,f,j,d,Q,!0,g,h,L),Q}static PerspectiveFovRHToRef(q,f,j,d,g){let h=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],L=arguments.length>6?arguments[6]:void 0,Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,H=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const r=j,u=d,X=1/Math.tan(.5*q),z=h?X/f:X,B=h?X:X*f,D=H&&0===r?1:0!==u?-(u+r)/(u-r):-1,i=H&&0===r?2*u:0!==u?-2*u*r/(u-r):-2*r,t=Math.tan(Q);return N.FromValuesToRef(z,0,0,0,0,B,0,t,0,0,D,-1,0,0,i,0,g),L&&g.multiplyToRef(s,g),g._updateIdentityStatus(!1),g}static PerspectiveFovReverseRHToRef(q,f,j,d,g){let h=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],L=arguments.length>6?arguments[6]:void 0,Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const H=1/Math.tan(.5*q),r=h?H/f:H,u=h?H:H*f,X=Math.tan(Q);return N.FromValuesToRef(r,0,0,0,0,u,0,X,0,0,-j,-1,0,0,-1,0,g),L&&g.multiplyToRef(s,g),g._updateIdentityStatus(!1),g}static GetFinalMatrix(q,f,j,d,g,h){const L=q.width,Q=q.height,H=q.x,r=q.y,u=N.FromValues(L/2,0,0,0,0,-Q/2,0,0,0,0,h-g,0,H+L/2,Q/2+r,g,1),X=new N;return f.multiplyToRef(j,X),X.multiplyToRef(d,X),X.multiplyToRef(u,X)}static GetAsMatrix2x2(q){const f=q.m,j=[f[0],f[1],f[4],f[5]];return L.b.MatrixUse64Bits?j:new Float32Array(j)}static GetAsMatrix3x3(q){const f=q.m,j=[f[0],f[1],f[2],f[4],f[5],f[6],f[8],f[9],f[10]];return L.b.MatrixUse64Bits?j:new Float32Array(j)}static Transpose(q){const f=new N;return N.TransposeToRef(q,f),f}static TransposeToRef(q,f){const j=q.m,d=j[0],g=j[4],h=j[8],L=j[12],Q=j[1],H=j[5],r=j[9],u=j[13],X=j[2],z=j[6],B=j[10],D=j[14],i=j[3],t=j[7],O=j[11],N=j[15],w=f.cz;return w[0]=d,w[1]=g,w[2]=h,w[3]=L,w[4]=Q,w[5]=H,w[6]=r,w[7]=u,w[8]=X,w[9]=z,w[10]=B,w[11]=D,w[12]=i,w[13]=t,w[14]=O,w[15]=N,f.markAsUpdated(),f._updateIdentityStatus(q._isIdentity,q._isIdentityDirty),f}static Reflection(q){const f=new N;return N.ReflectionToRef(q,f),f}static ReflectionToRef(q,f){q.normalize();const j=q.df.x,d=q.df.y,g=q.df.z,h=-2*j,L=-2*d,Q=-2*g;return N.FromValuesToRef(h*j+1,L*j,Q*j,0,h*d,L*d+1,Q*d,0,h*g,L*g,Q*g+1,0,h*q.d,L*q.d,Q*q.d,1,f),f}static FromXYZAxesToRef(q,f,j,d){return N.FromValuesToRef(q._x,q._y,q._z,0,f._x,f._y,f._z,0,j._x,j._y,j._z,0,0,0,0,1,d),d}static FromQuaternionToRef(q,f){const j=q._x*q._x,d=q._y*q._y,g=q._z*q._z,h=q._x*q._y,L=q._z*q._w,Q=q._z*q._x,H=q._y*q._w,r=q._y*q._z,u=q._x*q._w;return f.cz[0]=1-2*(d+g),f.cz[1]=2*(h+L),f.cz[2]=2*(Q-H),f.cz[3]=0,f.cz[4]=2*(h-L),f.cz[5]=1-2*(g+j),f.cz[6]=2*(r+u),f.cz[7]=0,f.cz[8]=2*(Q+H),f.cz[9]=2*(r-u),f.cz[10]=1-2*(d+j),f.cz[11]=0,f.cz[12]=0,f.cz[13]=0,f.cz[14]=0,f.cz[15]=1,f.markAsUpdated(),f}}N._IdentityReadOnly=N.Identity(),Object.defineProperties(N.prototype,{dimension:{value:[4,4]},rank:{value:2}});class w{}w.kf=(0,g.h)(11,i.Zero),w.Matrix=(0,g.h)(2,N.Identity),w.Quaternion=(0,g.h)(3,O.Zero);class E{}E.Vector2=(0,g.h)(3,D.Zero),E.kf=(0,g.h)(13,i.Zero),E.Vector4=(0,g.h)(3,t.Zero),E.Quaternion=(0,g.h)(3,O.Zero),E.Matrix=(0,g.h)(8,N.Identity),(0,h.f)("BABYLON.Vector2",D),(0,h.f)("BABYLON.Vector3",i),(0,h.f)("BABYLON.Vector4",t),(0,h.f)("BABYLON.Matrix",N);const s=N.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)},11300:(q,f,j)=>{j.d(f,{e:()=>d});class d{constructor(q,f,j,d){this.x=q,this.y=f,this.width=j,this.height=d}toGlobal(q,f){return new d(this.x*q,this.y*f,this.width*q,this.height*f)}toGlobalToRef(q,f,j){return j.x=this.x*q,j.y=this.y*f,j.width=this.width*q,j.height=this.height*f,this}clone(){return new d(this.x,this.y,this.width,this.height)}}},11389:(q,f,j)=>{j.d(f,{b:()=>r,f:()=>u});var d=j(10941),g=j(11396);const h=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],L=[()=>1,q=>q.y,q=>q.z,q=>q.x,q=>q.x*q.y,q=>q.y*q.z,q=>3*q.z*q.z-1,q=>q.x*q.z,q=>q.x*q.x-q.y*q.y],Q=(q,f)=>h[q]*L[q](f),H=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class r{constructor(){this.preScaled=!1,this.l00=d.j.Zero(),this.l1_1=d.j.Zero(),this.l10=d.j.Zero(),this.l11=d.j.Zero(),this.l2_2=d.j.Zero(),this.l2_1=d.j.Zero(),this.l20=d.j.Zero(),this.l21=d.j.Zero(),this.l22=d.j.Zero()}addLight(q,f,j){g.k.kf[0].set(f.r,f.g,f.b);const d=g.k.kf[0],h=g.k.kf[1];d.scaleToRef(j,h),h.scaleToRef(Q(0,q),g.k.kf[2]),this.l00.addInPlace(g.k.kf[2]),h.scaleToRef(Q(1,q),g.k.kf[2]),this.l1_1.addInPlace(g.k.kf[2]),h.scaleToRef(Q(2,q),g.k.kf[2]),this.l10.addInPlace(g.k.kf[2]),h.scaleToRef(Q(3,q),g.k.kf[2]),this.l11.addInPlace(g.k.kf[2]),h.scaleToRef(Q(4,q),g.k.kf[2]),this.l2_2.addInPlace(g.k.kf[2]),h.scaleToRef(Q(5,q),g.k.kf[2]),this.l2_1.addInPlace(g.k.kf[2]),h.scaleToRef(Q(6,q),g.k.kf[2]),this.l20.addInPlace(g.k.kf[2]),h.scaleToRef(Q(7,q),g.k.kf[2]),this.l21.addInPlace(g.k.kf[2]),h.scaleToRef(Q(8,q),g.k.kf[2]),this.l22.addInPlace(g.k.kf[2])}scaleInPlace(q){this.l00.scaleInPlace(q),this.l1_1.scaleInPlace(q),this.l10.scaleInPlace(q),this.l11.scaleInPlace(q),this.l2_2.scaleInPlace(q),this.l2_1.scaleInPlace(q),this.l20.scaleInPlace(q),this.l21.scaleInPlace(q),this.l22.scaleInPlace(q)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(H[0]),this.l1_1.scaleInPlace(H[1]),this.l10.scaleInPlace(H[2]),this.l11.scaleInPlace(H[3]),this.l2_2.scaleInPlace(H[4]),this.l2_1.scaleInPlace(H[5]),this.l20.scaleInPlace(H[6]),this.l21.scaleInPlace(H[7]),this.l22.scaleInPlace(H[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(h[0]),this.l1_1.scaleInPlace(h[1]),this.l10.scaleInPlace(h[2]),this.l11.scaleInPlace(h[3]),this.l2_2.scaleInPlace(h[4]),this.l2_1.scaleInPlace(h[5]),this.l20.scaleInPlace(h[6]),this.l21.scaleInPlace(h[7]),this.l22.scaleInPlace(h[8])}updateFromArray(q){return d.j.FromArrayToRef(q[0],0,this.l00),d.j.FromArrayToRef(q[1],0,this.l1_1),d.j.FromArrayToRef(q[2],0,this.l10),d.j.FromArrayToRef(q[3],0,this.l11),d.j.FromArrayToRef(q[4],0,this.l2_2),d.j.FromArrayToRef(q[5],0,this.l2_1),d.j.FromArrayToRef(q[6],0,this.l20),d.j.FromArrayToRef(q[7],0,this.l21),d.j.FromArrayToRef(q[8],0,this.l22),this}updateFromFloatsArray(q){return d.j.FromFloatsToRef(q[0],q[1],q[2],this.l00),d.j.FromFloatsToRef(q[3],q[4],q[5],this.l1_1),d.j.FromFloatsToRef(q[6],q[7],q[8],this.l10),d.j.FromFloatsToRef(q[9],q[10],q[11],this.l11),d.j.FromFloatsToRef(q[12],q[13],q[14],this.l2_2),d.j.FromFloatsToRef(q[15],q[16],q[17],this.l2_1),d.j.FromFloatsToRef(q[18],q[19],q[20],this.l20),d.j.FromFloatsToRef(q[21],q[22],q[23],this.l21),d.j.FromFloatsToRef(q[24],q[25],q[26],this.l22),this}static Pf(q){return(new r).updateFromArray(q)}static FromPolynomial(q){const f=new r;return f.l00=q.xx.scale(.376127).add(q.yy.scale(.376127)).add(q.zz.scale(.376126)),f.l1_1=q.y.scale(.977204),f.l10=q.z.scale(.977204),f.l11=q.x.scale(.977204),f.l2_2=q.xy.scale(1.16538),f.l2_1=q.yz.scale(1.16538),f.l20=q.zz.scale(1.34567).ej(q.xx.scale(.672834)).ej(q.yy.scale(.672834)),f.l21=q.zx.scale(1.16538),f.l22=q.xx.scale(1.16538).ej(q.yy.scale(1.16538)),f.l1_1.scaleInPlace(-1),f.l11.scaleInPlace(-1),f.l2_1.scaleInPlace(-1),f.l21.scaleInPlace(-1),f.scaleInPlace(Math.PI),f}}class u{constructor(){this.x=d.j.Zero(),this.y=d.j.Zero(),this.z=d.j.Zero(),this.xx=d.j.Zero(),this.yy=d.j.Zero(),this.zz=d.j.Zero(),this.xy=d.j.Zero(),this.yz=d.j.Zero(),this.zx=d.j.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=r.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(q){g.k.kf[0].Af(q.r,q.g,q.b);const f=g.k.kf[0];this.xx.addInPlace(f),this.yy.addInPlace(f),this.zz.addInPlace(f)}scaleInPlace(q){this.x.scaleInPlace(q),this.y.scaleInPlace(q),this.z.scaleInPlace(q),this.xx.scaleInPlace(q),this.yy.scaleInPlace(q),this.zz.scaleInPlace(q),this.yz.scaleInPlace(q),this.zx.scaleInPlace(q),this.xy.scaleInPlace(q)}updateFromHarmonics(q){return this._harmonics=q,this.x.H(q.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.H(q.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.H(q.l10),this.z.scaleInPlace(1.02333),this.xx.H(q.l00),g.k.kf[0].H(q.l20).scaleInPlace(.247708),g.k.kf[1].H(q.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).eX(g.k.kf[0]).addInPlace(g.k.kf[1]),this.yy.H(q.l00),this.yy.scaleInPlace(.886277).eX(g.k.kf[0]).eX(g.k.kf[1]),this.zz.H(q.l00),g.k.kf[0].H(q.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(g.k.kf[0]),this.yz.H(q.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.H(q.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.H(q.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(q){return(new u).updateFromHarmonics(q)}static Pf(q){const f=new u;return d.j.FromArrayToRef(q[0],0,f.x),d.j.FromArrayToRef(q[1],0,f.y),d.j.FromArrayToRef(q[2],0,f.z),d.j.FromArrayToRef(q[3],0,f.xx),d.j.FromArrayToRef(q[4],0,f.yy),d.j.FromArrayToRef(q[5],0,f.zz),d.j.FromArrayToRef(q[6],0,f.yz),d.j.FromArrayToRef(q[7],0,f.zx),d.j.FromArrayToRef(q[8],0,f.xy),f}}},11657:(q,f,j)=>{j.d(f,{c:()=>O,e:()=>N});var d=j(10941),g=j(11210),h=j(11289),L=j(11257),Q=j(11005),H=j(11151),r=j(11402),u=j(10950),X=j(10980);class z extends d.i{constructor(q,f){super(q.x,q.y),this.index=f}}class B{constructor(){this.elements=[]}add(q){const f=[];for(const j of q){const q=new z(j,this.elements.length);f.push(q),this.elements.push(q)}return f}computeBounds(){const q=new d.i(this.elements[0].x,this.elements[0].y),f=new d.i(this.elements[0].x,this.elements[0].y);for(const j of this.elements)j.x<q.x?q.x=j.x:j.x>f.x&&(f.x=j.x),j.y<q.y?q.y=j.y:j.y>f.y&&(f.y=j.y);return{min:q,max:f,width:f.x-q.x,height:f.y-q.y}}}class D{_addToepoint(q){for(const f of q)this._epoints.push(f.x,f.y)}constructor(q,f,j){let d,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new B,this._outlinepoints=new B,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=g,this._name=q,this._scene=j||X.d.LastCreatedScene,d=f instanceof r.j?f.getPoints():f,this._addToepoint(d),this._points.add(d),this._outlinepoints.add(d),"undefined"===typeof this.bjsEarcut&&Q.e.Warn("Earcut was not found, the polygon will not be built.")}addHole(q){this._points.add(q);const f=new B;return f.add(q),this._holes.push(f),this._eholes.push(this._epoints.length/2),this._addToepoint(q),this}build(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const d=new h.e(this._name,this._scene),g=this.buildVertexData(f,j);return d.oq(H.i.PositionKind,g.Iq,q),d.oq(H.i.NormalKind,g.Tq,q),d.oq(H.i.UVKind,g.nq,q),d.setIndices(g.indices),d}buildVertexData(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const j=new L.e,d=[],g=[],h=[],Q=this._points.computeBounds();for(const L of this._points.elements)d.push(0,1,0),g.push(L.x,0,L.y),h.push((L.x-Q.min.x)/Q.width,(L.y-Q.min.y)/Q.height);const H=[],r=this.bjsEarcut(this._epoints,this._eholes,2);for(let L=0;L<r.length;L++)H.push(r[L]);if(q>0){const j=g.length/3;for(const f of this._points.elements)d.push(0,-1,0),g.push(f.x,-q,f.y),h.push(1-(f.x-Q.min.x)/Q.width,1-(f.y-Q.min.y)/Q.height);const L=H.length;for(let q=0;q<L;q+=3){const f=H[q+0],d=H[q+1],g=H[q+2];H.push(g+j),H.push(d+j),H.push(f+j)}this._addSide(g,d,h,H,Q,this._outlinepoints,q,!1,f);for(const r of this._holes)this._addSide(g,d,h,H,Q,r,q,!0,f)}return j.indices=H,j.Iq=g,j.Tq=d,j.nq=h,j}_addSide(q,f,j,g,h,L,Q,H,r){let X=q.length/3,z=0;for(let B=0;B<L.elements.length;B++){const D=L.elements[B],i=L.elements[(B+1)%L.elements.length];q.push(D.x,0,D.y),q.push(D.x,-Q,D.y),q.push(i.x,0,i.y),q.push(i.x,-Q,i.y);const t=L.elements[(B+L.elements.length-1)%L.elements.length],O=L.elements[(B+2)%L.elements.length];let N=new d.j(-(i.y-D.y),0,i.x-D.x),w=new d.j(-(D.y-t.y),0,D.x-t.x),E=new d.j(-(O.y-i.y),0,O.x-i.x);H||(N=N.scale(-1),w=w.scale(-1),E=E.scale(-1));const s=N.normalizeToNew();let S=w.normalizeToNew(),e=E.normalizeToNew();const Z=d.j.Dot(S,s);S=Z>r?Z<u.d-1?new d.j(D.x,0,D.y).ej(new d.j(i.x,0,i.y)).normalize():w.add(N).normalize():s;const I=d.j.Dot(E,N);e=I>r?I<u.d-1?new d.j(i.x,0,i.y).ej(new d.j(D.x,0,D.y)).normalize():E.add(N).normalize():s,j.push(z/h.width,0),j.push(z/h.width,1),z+=N.length(),j.push(z/h.width,0),j.push(z/h.width,1),f.push(S.x,S.y,S.z),f.push(S.x,S.y,S.z),f.push(e.x,e.y,e.z),f.push(e.x,e.y,e.z),H?(g.push(X),g.push(X+2),g.push(X+1),g.push(X+1),g.push(X+2),g.push(X+3)):(g.push(X),g.push(X+1),g.push(X+2),g.push(X+1),g.push(X+3),g.push(X+2)),X+=4}}}var i=j(11316);function t(q,f,j,h,Q,r,u){const X=j||new Array(3),z=h,B=[],D=u||!1;for(let L=0;L<3;L++)void 0===X[L]&&(X[L]=new d.m(0,0,1,1)),z&&void 0===z[L]&&(z[L]=new g.e(1,1,1,1));const t=q.getVerticesData(H.i.PositionKind),O=q.getVerticesData(H.i.NormalKind),N=q.getVerticesData(H.i.UVKind),w=q.sf(),E=t.length/9;let s=0,S=0,e=0,Z=0,I=0;const T=[0];if(D)for(let d=E;d<t.length/3;d+=4)S=t[3*(d+2)]-t[3*d],e=t[3*(d+2)+2]-t[3*d+2],Z=Math.sqrt(S*S+e*e),I+=Z,T.push(I);let W=0,n=0;for(let d=0;d<O.length;d+=3)Math.abs(O[d+1])<.001&&(n=1),Math.abs(O[d+1]-1)<.001&&(n=0),Math.abs(O[d+1]+1)<.001&&(n=2),W=d/3,1===n?(s=W-E,N[2*W]=s%4<1.5?D?X[n].x+(X[n].z-X[n].x)*T[Math.floor(s/4)]/I:X[n].x:D?X[n].x+(X[n].z-X[n].x)*T[Math.floor(s/4)+1]/I:X[n].z,N[2*W+1]=s%2===0?i.b?1-X[n].w:X[n].w:i.b?1-X[n].y:X[n].y):(N[2*W]=(1-N[2*W])*X[n].x+N[2*W]*X[n].z,N[2*W+1]=(1-N[2*W+1])*X[n].y+N[2*W+1]*X[n].w,i.b&&(N[2*W+1]=1-N[2*W+1])),z&&B.push(z[n].r,z[n].g,z[n].b,z[n].a);L.e._ComputeSides(f,t,w,O,N,Q,r);const U=new L.e;if(U.indices=w,U.Iq=t,U.Tq=O,U.nq=N,z){const q=f===L.e.DOUBLESIDE?B.concat(B):B;U.Wq=q}return U}function O(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;f.sideOrientation=h.e._GetDefaultSideOrientation(f.sideOrientation);const L=f.shape,Q=f.holes||[],H=f.depth||0,r=f.smoothingThreshold||2,u=[];let z=[];for(let h=0;h<L.length;h++)u[h]=new d.i(L[h].x,L[h].z);u[0].equalsWithEpsilon(u[u.length-1],1e-8)&&u.pop();const B=new D(q,u,j||X.d.LastCreatedScene,g);for(let h=0;h<Q.length;h++){z=[];for(let q=0;q<Q[h].length;q++)z.push(new d.i(Q[h][q].x,Q[h][q].z));B.addHole(z)}const i=B.build(!1,H,r);i._originalBuilderSideOrientation=f.sideOrientation;return t(i,f.sideOrientation,f.faceUV,f.faceColors,f.frontUVs,f.backUVs,f.wrap).Yq(i,f.updatable),i}function N(q,f){return O(q,f,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}L.e.CreatePolygon=t,h.e.CreatePolygon=function(q,f,j,d,g,h){return O(q,{shape:f,holes:d,updatable:g,sideOrientation:h},j,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},h.e.ExtrudePolygon=function(q,f,j,d,g,h,L){return N(q,{shape:f,holes:g,depth:j,updatable:h,sideOrientation:L},d,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)}},11649:(q,f,j)=>{j.d(f,{b:()=>u,c:()=>X});var d=j(11402),g=j(10941),h=j(11289),L=j(11245),Q=j(11657);class H{constructor(q){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=q}moveTo(q,f){this._currentPath=new d.j(q,f),this._tempPaths.push(this._currentPath)}lineTo(q,f){this._currentPath.addLineTo(q,f)}quadraticCurveTo(q,f,j,d){this._currentPath.addQuadraticCurveTo(q,f,j,d,this._resolution)}bezierCurveTo(q,f,j,d,g,h){this._currentPath.addBezierCurveTo(q,f,j,d,g,h,this._resolution)}extractHoles(){for(const q of this._tempPaths)q.area()>0?this._holes.push(q):this._paths.push(q);if(!this._paths.length&&this._holes.length){const q=this._holes;this._holes=this._paths,this._paths=q}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function r(q,f,j,d,g,h){const L=h.glyphs[q]||h.glyphs["?"];if(!L)return null;const Q=new H(g);if(L.o){const q=L.o.split(" ");for(let g=0,h=q.length;g<h;){switch(q[g++]){case"m":{const h=parseInt(q[g++])*f+j,L=parseInt(q[g++])*f+d;Q.moveTo(h,L);break}case"l":{const h=parseInt(q[g++])*f+j,L=parseInt(q[g++])*f+d;Q.lineTo(h,L);break}case"q":{const h=parseInt(q[g++])*f+j,L=parseInt(q[g++])*f+d,H=parseInt(q[g++])*f+j,r=parseInt(q[g++])*f+d;Q.quadraticCurveTo(H,r,h,L);break}case"b":{const h=parseInt(q[g++])*f+j,L=parseInt(q[g++])*f+d,H=parseInt(q[g++])*f+j,r=parseInt(q[g++])*f+d,u=parseInt(q[g++])*f+j,X=parseInt(q[g++])*f+d;Q.bezierCurveTo(H,r,u,X,h,L);break}}}}return Q.extractHoles(),{offsetX:L.ha*f,shapePath:Q}}function u(q,f,j,d){const g=Array.from(q),h=f/d.resolution,L=(d.boundingBox.yMax-d.boundingBox.yMin+d.underlineThickness)*h,Q=[];let H=0,u=0;for(let X=0;X<g.length;X++){const q=g[X];if("\n"===q)H=0,u-=L;else{const f=r(q,h,H,u,j,d);f&&(H+=f.offsetX,Q.push(f.shapePath))}}return Q}function X(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const X=u(f,d.size||50,d.resolution||8,j),z=[];let B=0;for(const L of X){if(!L.paths.length)continue;const f=L.holes.slice();for(const j of L.paths){var D,i;const L=[],u=[],X=j.getPoints();for(const q of X)u.push(new g.j(q.x,0,q.y));const t=f.slice();for(const q of t){const d=q.getPoints();let h=!1;for(const q of d)if(j.isPointInside(q)){h=!0;break}if(!h)continue;const Q=[];for(const q of d)Q.push(new g.j(q.x,0,q.y));L.push(Q),f.splice(f.indexOf(q),1)}if(!L.length&&f.length)for(const q of f){const f=q.getPoints(),j=[];for(const q of f)j.push(new g.j(q.x,0,q.y));L.push(j)}const O=(0,Q.e)(q,{shape:u,holes:L.length?L:void 0,depth:d.depth||1,faceUV:d.faceUV||(null===(D=d.perLetterFaceUV)||void 0===D?void 0:D.call(d,B)),faceColors:d.faceColors||(null===(i=d.perLetterFaceColors)||void 0===i?void 0:i.call(d,B)),sideOrientation:h.e._GetDefaultSideOrientation(d.sideOrientation||h.e.DOUBLESIDE)},H,r);z.push(O),B++}}const t=h.e.MergeMeshes(z,!0,!0);if(t){const f=t.getBoundingInfo().boundingBox;t.position.x+=-(f.minimumWorld.x+f.maximumWorld.x)/2,t.position.y+=-(f.minimumWorld.y+f.maximumWorld.y)/2,t.position.z+=-(f.minimumWorld.z+f.maximumWorld.z)/2+f.extendSize.z,t.name=q;const j=new L.b("pivot",H);j.rotation.x=-Math.PI/2,t.parent=j,t.bakeCurrentTransformIntoVertices(),t.parent=null,j.dispose()}return t}},11669:(q,f,j)=>{j.d(f,{b:()=>H,c:()=>L,d:()=>Q});var d=j(10992),g=j(11676),h=j(11684);function L(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}function Q(q){return!!(q.wasmUrl&&(q.wasmBinary||q.wasmBinaryUrl)&&"object"===typeof WebAssembly||q.fallbackUrl)}class H{constructor(q){if(q.workerPool)return void(this._workerPoolPromise=Promise.resolve(q.workerPool));const f=q.wasmBinary,j=q.numWorkers??L(),Q=j&&"function"===typeof Worker&&"function"===typeof URL,H=Q||!q.jsModule,r=q.wasmUrl&&q.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:H?d.h.GetBabylonScriptURL(q.wasmUrl,!0):"",wasmBinaryPromise:f?Promise.resolve(f):d.h.LoadFileAsync(d.h.GetBabylonScriptURL(q.wasmBinaryUrl,!0))}:{url:H?d.h.GetBabylonScriptURL(q.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};Q?this._workerPoolPromise=r.wasmBinaryPromise.then((q=>{const f=this._getWorkerContent(),d=URL.createObjectURL(new Blob([f],{type:"application/javascript"}));return new g.e(j,(()=>{const f=new Worker(d);return(0,h.j)(f,q,r.url)}))})):this._modulePromise=r.wasmBinaryPromise.then((async f=>{if(!this._isModuleAvailable()&&!q.jsModule){if(!r.url)throw new Error("Draco codec module is not available");await d.h.LoadBabylonScriptAsync(r.url)}return await this._createModuleAsync(f,q.jsModule)}))}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._modulePromise&&await this._modulePromise}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((q=>{q.dispose()})),delete this._workerPoolPromise,delete this._modulePromise}}},11684:(q,f,j)=>{function d(q,f,j,d){const g=q;let h=null,L=null,Q=null,H=null;const r={},u=f.find((q=>"POSITION"===q.dracoName));if(!u)throw new Error("Position attribute is required for Draco encoding");if(!j){const q=u.data.length/u.size;j=new(q>65535?Uint32Array:Uint16Array)(q);for(let f=0;f<q;f++)j[f]=f}try{h=new g.Encoder,L=new g.MeshBuilder,Q=new g.Mesh,L.AddFacesToMesh(Q,j.length/3,j);const q=new Map([[Float32Array,(q,f,j,d,g,h)=>q.AddFloatAttribute(f,j,d,g,h)],[Uint32Array,(q,f,j,d,g,h)=>q.AddUInt32Attribute(f,j,d,g,h)],[Uint16Array,(q,f,j,d,g,h)=>q.AddUInt16Attribute(f,j,d,g,h)],[Uint8Array,(q,f,j,d,g,h)=>q.AddUInt8Attribute(f,j,d,g,h)],[Int32Array,(q,f,j,d,g,h)=>q.AddInt32Attribute(f,j,d,g,h)],[Int16Array,(q,f,j,d,g,h)=>q.AddInt16Attribute(f,j,d,g,h)],[Int8Array,(q,f,j,d,g,h)=>q.AddInt8Attribute(f,j,d,g,h)]]);for(const j of f){j.data instanceof Uint8ClampedArray&&(j.data=new Uint8Array(j.data));const f=q.get(j.data.constructor),H=j.data.length/j.size;r[j.kind]=f(L,Q,g[j.dracoName],H,j.size,j.data),d.quantizationBits&&d.quantizationBits[j.dracoName]&&h.SetAttributeQuantization(g[j.dracoName],d.quantizationBits[j.dracoName])}d.method&&h.SetEncodingMethod(g[d.method]),void 0!==d.encodeSpeed&&void 0!==d.decodeSpeed&&h.SetSpeedOptions(d.encodeSpeed,d.decodeSpeed),H=new g.DracoInt8Array;const u=h.EncodeMeshToDracoBuffer(Q,H);if(u<=0)throw new Error("Draco encoding failed.");const X=new Int8Array(u);for(let f=0;f<u;f++)X[f]=H.GetValue(f);return{data:X,attributeIds:r}}finally{Q&&g.destroy(Q),L&&g.destroy(L),h&&g.destroy(h),H&&g.destroy(H)}}function g(){let q;onmessage=f=>{const j=f.data;switch(j.id){case"init":{j.url&&importScripts(j.url);const f=j.wasmBinary?{wasmBinary:j.wasmBinary}:{};q=DracoEncoderModule(f),postMessage({id:"initDone"});break}case"encodeMesh":if(!q)throw new Error("Draco encoder module is not available");q.then((q=>{const f=d(q,j.attributes,j.indices,j.options);postMessage({id:"encodeMeshDone",encodedMeshData:f},f?[f.data.buffer]:void 0)}))}}}function h(q,f,j,d,g){const h=q;let L=null,Q=null,H=null;try{let q;L=new h.Decoder,Q=new h.DecoderBuffer,Q.Init(f,f.byteLength);const r=L.GetEncodedGeometryType(Q);switch(r){case h.TRIANGULAR_MESH:{const f=new h.Mesh;if(q=L.DecodeBufferToMesh(Q,f),!q.ok()||0===f.ptr)throw new Error(q.error_msg());const j=3*f.num_faces(),g=4*j,r=h._malloc(g);try{L.GetTrianglesUInt32Array(f,g,r);const q=new Uint32Array(j);q.set(new Uint32Array(h.HEAPF32.buffer,r,j)),d(q)}finally{h._free(r)}H=f;break}case h.POINT_CLOUD:{const f=new h.PointCloud;if(q=L.DecodeBufferToPointCloud(Q,f),!q.ok()||!f.ptr)throw new Error(q.error_msg());H=f;break}default:throw new Error(`Invalid geometry type ${r}`)}const u=H.num_points(),X=(q,f,j,d)=>{const L=d.data_type(),Q=d.num_components(),H=d.normalized(),r=d.byte_stride(),X=d.byte_offset(),z={[h.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:h.HEAPF32},[h.DT_INT8]:{typedArrayConstructor:Int8Array,heap:h.HEAP8},[h.DT_INT16]:{typedArrayConstructor:Int16Array,heap:h.HEAP16},[h.DT_INT32]:{typedArrayConstructor:Int32Array,heap:h.HEAP32},[h.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:h.HEAPU8},[h.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:h.HEAPU16},[h.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:h.HEAPU32}}[L];if(!z)throw new Error(`Invalid data type ${L}`);const B=u*Q,D=B*z.typedArrayConstructor.BYTES_PER_ELEMENT,i=h._malloc(D);try{q.GetAttributeDataArrayForAllPoints(f,d,L,D,i);const h=new z.typedArrayConstructor(z.heap.buffer,i,B);g(j,h.slice(),Q,X,r,H)}finally{h._free(i)}};if(j)for(const f in j){const q=j[f],d=L.GetAttributeByUniqueId(H,q);X(L,H,f,d)}else{const q={position:h.POSITION,df:h.NORMAL,color:h.COLOR,uv:h.TEX_COORD};for(const f in q){const j=L.GetAttributeId(H,q[f]);if(-1!==j){const q=L.GetAttribute(H,j);X(L,H,f,q)}}}return u}finally{H&&h.destroy(H),Q&&h.destroy(Q),L&&h.destroy(L)}}function L(){let q;onmessage=f=>{const j=f.data;switch(j.id){case"init":{j.url&&importScripts(j.url);const f=j.wasmBinary?{wasmBinary:j.wasmBinary}:{};q=DracoDecoderModule(f),postMessage({id:"initDone"});break}case"decodeMesh":if(!q)throw new Error("Draco decoder module is not available");q.then((q=>{const f=h(q,j.dataView,j.attributes,(q=>{postMessage({id:"indices",data:q},[q.buffer])}),((q,f,j,d,g,h)=>{postMessage({id:"attribute",kind:q,data:f,size:j,byteOffset:d,byteStride:g,normalized:h},[f.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:f})}))}}}async function Q(q,f,j){return await new Promise(((d,g)=>{const h=f=>{q.removeEventListener("error",h),q.removeEventListener("message",L),g(f)},L=f=>{"initDone"===f.data.id&&(q.removeEventListener("error",h),q.removeEventListener("message",L),d(q))};if(q.addEventListener("error",h),q.addEventListener("message",L),f){const d=f.slice(0);q.postMessage({id:"init",url:j,wasmBinary:d},[d])}else q.postMessage({id:"init",url:j})}))}j.d(f,{d:()=>h,e:()=>L,g:()=>d,i:()=>g,j:()=>Q})},11354:(q,f,j)=>{j.d(f,{c:()=>g});var d=j(11153);class g extends d.c{constructor(q){super(),this._buffer=q}get underlyingResource(){return this._buffer}}},11249:(q,f,j)=>{j.d(f,{e:()=>e});var d=j(11125),g=j(10982),h=j(10941),L=j(11151),Q=j(11257),H=j(11245),r=j(11268),u=j(11164),X=j(11190);class z{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new h.j(0,0,0),this._diffPositionForCollisions=new h.j(0,0,0),this._collisionResponse=!0}}var B=j(11016),D=j(11177),i=j(11210),t=j(10950),O=j(11276),N=j(10965),w=j(11130),E=j(11065);class s{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=h.j.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class S{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new s,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=new Map,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new z,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class e extends H.b{static get BILLBOARDMODE_NONE(){return H.b.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return H.b.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return H.b.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return H.b.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return H.b.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return H.b.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(q){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=q}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(q){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=q}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(q){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=q}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(q){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=q}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(q){this._internalAbstractMeshDataInfo._collisionRetryCount=q}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(q){this._internalAbstractMeshDataInfo._morphTargetManager!==q&&(this._internalAbstractMeshDataInfo._morphTargetManager=q,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(q){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==q&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=q,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(q){return!!super._updateNonUniformScalingState(q)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(q){this._internalAbstractMeshDataInfo._rawBoundingInfo=q}set pB(q){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(q)}set onCollisionPositionChange(q){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(q)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(q){if(this._internalAbstractMeshDataInfo._visibility===q)return;const f=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=q,(1===f&&1!==q||1!==f&&1===q)&&this._markSubMeshesAsDirty((q=>{q.markAsMiscDirty(),q.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(q){this._internalAbstractMeshDataInfo._inheritVisibility=q}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let q=this._parentNode;for(;q;){const f=q.isVisible;if("undefined"!==typeof f)return f;q=q.parent}}return this._isVisible}set isVisible(q){this._isVisible=q}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(q){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=q}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(q){this._internalAbstractMeshDataInfo._renderingGroupId=q}get material(){return this._internalAbstractMeshDataInfo._material}set material(q){this._setMaterial(q)}_setMaterial(q){this._internalAbstractMeshDataInfo._material!==q&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=q,q&&q.meshMap&&(q.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.Qd&&(this.resetDrawCache(void 0,null==q),this._unBindEffect()))}getMaterialForRenderPass(q){var f;return null===(f=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===f?void 0:f[q]}setMaterialForRenderPass(q,f){var j;this.resetDrawCache(q),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]);const d=this._internalAbstractMeshDataInfo._materialForRenderPass[q];null!==d&&void 0!==d&&null!==(j=d.meshMap)&&void 0!==j&&j[this.uniqueId]&&(d.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._materialForRenderPass[q]=f,f&&f.meshMap&&(f.meshMap[this.uniqueId]=this)}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(q){this._internalAbstractMeshDataInfo._receiveShadows!==q&&(this._internalAbstractMeshDataInfo._receiveShadows=q,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(q){this._internalAbstractMeshDataInfo._hasVertexAlpha!==q&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=q,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(q){this._internalAbstractMeshDataInfo._useVertexColors!==q&&(this._internalAbstractMeshDataInfo._useVertexColors=q,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(q){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==q&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=q,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(q){this._internalAbstractMeshDataInfo._numBoneInfluencers!==q&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=q,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(q){this._internalAbstractMeshDataInfo._applyFog!==q&&(this._internalAbstractMeshDataInfo._applyFog=q,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(q){this._internalAbstractMeshDataInfo._enableDistantPicking=q}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(q){q!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=q,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(q){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(q)?-1:q}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(q){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=q}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(q){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(q)?-1:q}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(q){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=q}get lightSources(){return this._lightSources}set skeleton(q){const f=this._internalAbstractMeshDataInfo._skeleton;f&&f.needInitialSkinMatrix&&f._unregisterMeshWithPoseMatrix(this),q&&q.needInitialSkinMatrix&&q._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=q,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(q){var f;let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(q,j,!1),f=this,this._internalAbstractMeshDataInfo=new S,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.xX=e.RX,this.onCollideObservable=new g.d,this.onCollisionPositionChangeObservable=new g.d,this.onMaterialChangedObservable=new g.d,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.Xr=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=i.c.Red(),this.outlineWidth=.02,this.overlayColor=i.c.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.Cg=!1,this.vq=!1,this.actionManager=null,this.ellipsoid=new h.j(.5,1,.5),this.ellipsoidOffset=new h.j(0,0,0),this.edgesWidth=1,this.edgesColor=new i.e(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,yg:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new g.d,this._onCollisionPositionChange=function(q,j){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;j.subtractToRef(f._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,f._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),f._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>E.b.CollisionsEpsilon&&f.position.addInPlace(f._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),d&&f.onCollideObservable.notifyObservers(d),f.onCollisionPositionChangeObservable.notifyObservers(f.position)},j=this.eq(),j.Iu(this),this._resyncLightSources(),this._uniformBuffer=new X.d(this.eq().getEngine(),void 0,void 0,q,!this.eq().getEngine().isWebGPU),this._buildUniformLayout(),j.performancePriority){case 2:this.vq=!0;case 1:this.Cg=!0,this.Xr=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(q){const f=this._uniformBuffer;f.jd("world",q),f.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),f.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(q){let f="Name: "+this.name+", isInstance: "+("InstancedMesh"===this.getClassName()?"YES":"NO");f+=", # of submeshes: "+(this.Qd?this.Qd.length:0);const j=this._internalAbstractMeshDataInfo._skeleton;return j&&(f+=", skeleton: "+j.name),q&&(f+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],f+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.yg?"YES":"NO")),f}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==H.b.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(f||this.actionManager.isRecursive)){if(!q)return this.actionManager;if(this.actionManager.hasSpecificTrigger(q))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(q,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.Qd){for(const q of this.Qd)q._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const q of this.eq().lights)q.isEnabled()&&q.canAffectMesh(this)&&this._lightSources.push(q);this._markSubMeshesAsLightDirty()}_resyncLightSource(q){const f=q.isEnabled()&&q.canAffectMesh(this),j=this._lightSources.indexOf(q);let d=!1;if(-1===j){if(!f)return;this._lightSources.push(q)}else{if(f)return;d=!0,this._lightSources.splice(j,1)}this._markSubMeshesAsLightDirty(d)}_unBindEffect(){for(const q of this.Qd)q.setEffect(null)}_removeLightSource(q,f){const j=this._lightSources.indexOf(q);-1!==j&&(this._lightSources.splice(j,1),this._markSubMeshesAsLightDirty(f))}_markSubMeshesAsDirty(q){if(this.Qd)for(const f of this.Qd)for(let j=0;j<f._drawWrappers.length;++j){const d=f._drawWrappers[j];d&&d.defines&&d.defines.markAllAsDirty&&q(d.defines)}}_markSubMeshesAsLightDirty(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((f=>f.markAsLightDirty(q)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((q=>q.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((q=>q.markAsMiscDirty()))}zu(q){return this._currentRenderId=Number.MAX_VALUE,super.zu(q),this._isDirty=!0,this}resetDrawCache(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.Qd)for(const j of this.Qd)j.resetDrawCache(q,f)}get isBlocked(){return!1}getLOD(q){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}sf(){return null}getVerticesData(q){return null}oq(q,f,j,d){return this}updateVerticesData(q,f,j,d){return this}setIndices(q,f){return this}isVerticesDataPresent(q){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.Fq()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(q){return this._boundingInfo=q,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(q,f,j){return this._boundingInfo=new u.b(q,f,j),this._boundingInfo}normalizeToUnitCube(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(q,f,j)}get useBones(){return this.skeleton&&this.eq().skeletonsEnabled&&this.isVerticesDataPresent(L.i.MatricesIndicesKind)&&this.isVerticesDataPresent(L.i.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(q){}_activate(q,f){return this._renderId=q,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===H.b.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(q,f,j){return this.position.addInPlace(this.calcMovePOV(q,f,j)),this}calcMovePOV(q,f,j){const d=new h.b;(this.rotationQuaternion?this.rotationQuaternion:h.e.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(d);const g=h.j.Zero(),L=this.definedFacingForward?-1:1;return h.j.TransformCoordinatesFromFloatsToRef(q*L,f,j*L,d,g),g}rotatePOV(q,f,j){return this.rotation.addInPlace(this.calcRotatePOV(q,f,j)),this}calcRotatePOV(q,f,j){const d=this.definedFacingForward?1:-1;return new h.j(q*d,f,j*d)}Mq(q,f){if(q){const j=(0,D.i)(q,0,this.getTotalVertices(),f);this._boundingInfo?this._boundingInfo.reConstruct(j.minimum,j.maximum):this._boundingInfo=new u.b(j.minimum,j.maximum)}if(this.Qd)for(let j=0;j<this.Qd.length;j++)this.Qd[j].refreshBoundingInfo(q);this.Fq()}_refreshBoundingInfoDirect(q){if(this._boundingInfo?this._boundingInfo.reConstruct(q.minimum,q.maximum):this._boundingInfo=new u.b(q.minimum,q.maximum),this.Qd)for(let f=0;f<this.Qd.length;f++)this.Qd[f].refreshBoundingInfo(null);this.Fq()}static _ApplySkeleton(q,f,j,d,g,Q,H){!function(q,f,j,d,g,Q,H){const r=h.f.kf[0],u=h.f.Matrix[0],X=h.f.Matrix[1],z=f===L.i.NormalKind?h.j.TransformNormalFromFloatsToRef:h.j.TransformCoordinatesFromFloatsToRef;for(let L=0,B=0;L<q.length;L+=3,B+=4){let f,D;for(u.reset(),f=0;f<4;f++)D=g[B+f],D>0&&(h.b.FromFloat32ArrayToRefScaled(j,Math.floor(16*d[B+f]),D,X),u.addToSelf(X));if(Q&&H)for(f=0;f<4;f++)D=H[B+f],D>0&&(h.b.FromFloat32ArrayToRefScaled(j,Math.floor(16*Q[B+f]),D,X),u.addToSelf(X));z(q[L],q[L+1],q[L+2],u,r),r.toArray(q,L)}}(q,f,j,d,g,Q,H)}_getData(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:L.i.PositionKind;const d=q.cache,g=q=>{if(d){const f=d._vertexData||(d._vertexData={});return f[q]||this.copyVerticesData(q,f),f[q]}return this.getVerticesData(q)};if(f||(f=g(j)),!f)return null;if(d?(d._outputData?d._outputData.set(f):d._outputData=new Float32Array(f),f=d._outputData):(q.applyMorph&&this.morphTargetManager||q.applySkeleton&&this.skeleton)&&(f=f.slice()),q.applyMorph&&this.morphTargetManager&&function(q,f,j){let d=null;switch(f){case L.i.PositionKind:d=q=>q.getPositions();break;case L.i.NormalKind:d=q=>q.getNormals();break;case L.i.TangentKind:d=q=>q.getTangents();break;case L.i.UVKind:d=q=>q.getUVs();break;case L.i.UV2Kind:d=q=>q.getUV2s();break;case L.i.ColorKind:d=q=>q.getColors();break;default:return}for(let g=0;g<q.length;g++){let f=q[g];for(let h=0;h<j.numTargets;h++){const L=j.getTarget(h),Q=L.influence;if(0!==Q){const j=d(L);j&&(f+=(j[g]-q[g])*Q)}}q[g]=f}}(f,j,this.morphTargetManager),q.applySkeleton&&this.skeleton){const q=g(L.i.MatricesIndicesKind),d=g(L.i.MatricesWeightsKind);if(d&&q){const h=this.numBoneInfluencers>4,Q=h?g(L.i.MatricesIndicesExtraKind):null,H=h?g(L.i.MatricesWeightsExtraKind):null,r=this.skeleton.getTransformMatrices(this);e._ApplySkeleton(f,j,r,q,d,Q,H)}}if(!1!==q.updatePositionsArray&&j===L.i.PositionKind){const q=this._internalAbstractMeshDataInfo._positions||[],j=q.length;if(q.length=f.length/3,j<q.length)for(let f=j;f<q.length;f++)q[f]=new h.j;for(let d=0,g=0;d<q.length;d++,g+=3)q[d].Af(f[g],f[g+1],f[g+2]);this._internalAbstractMeshDataInfo._positions=q}return f}getNormalsData(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:q,applyMorph:f,updatePositionsArray:!1},null,L.i.NormalKind)}tH(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:q,applyMorph:f,updatePositionsArray:!1},j,L.i.PositionKind)}Fq(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new u.b(h.j.Zero(),h.j.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(q){if(!this.Qd)return this;const f=this.Qd.length;for(let j=0;j<f;j++){const d=this.Qd[j];(f>1||!d.IsGlobal)&&d.updateBoundingInfo(q)}return this}_afterComputeWorldMatrix(){this.vq||(this._boundingInfoIsDirty=!0)}isInFrustum(q){return this.getBoundingInfo().isInFrustum(q,this.xX)}isCompletelyInFrustum(q){return this.getBoundingInfo().isCompletelyInFrustum(q)}intersectsMesh(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2?arguments[2]:void 0;const d=this.getBoundingInfo(),g=q.getBoundingInfo();if(d.intersects(g,f))return!0;if(j)for(const h of this.getChildMeshes())if(h.intersectsMesh(q,f,!0))return!0;return!1}intersectsPoint(q){return this.getBoundingInfo().intersectsPoint(q)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(q){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=q}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const j=this.eq().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=j.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,j.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,q,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId,f),this}_collideForSubMesh(q,f,j){var d;if(this._generatePointsArray(),!this._positions)return this;if(!q._lastColliderWorldVertices||!q._lastColliderTransformMatrix.equals(f)){q._lastColliderTransformMatrix=f.clone(),q._lastColliderWorldVertices=[],q._trianglePlanes=[];const j=q.verticesStart,d=q.verticesStart+q.verticesCount;for(let g=j;g<d;g++)q._lastColliderWorldVertices.push(h.j.TransformCoordinates(this._positions[g],f))}return j._collide(q._trianglePlanes,q._lastColliderWorldVertices,this.sf(),q.indexStart,q.indexStart+q.indexCount,q.verticesStart,!!q.bq(),this,this._shouldConvertRHS(),7===(null===(d=q.bq())||void 0===d?void 0:d.fillMode)),this}_processCollisionsForSubMeshes(q,f){const j=this._scene.getCollidingSubMeshCandidates(this,q),d=j.length;for(let g=0;g<d;g++){const h=j.data[g];d>1&&!h._checkCollision(q)||this._collideForSubMesh(h,f,q)}return this}_shouldConvertRHS(){return!1}_checkCollision(q){if(!this.getBoundingInfo()._checkCollision(q))return this;const f=h.f.Matrix[0],j=h.f.Matrix[1];return h.b.ScalingToRef(1/q._radius.x,1/q._radius.y,1/q._radius.z,f),this.worldMatrixFromCache.multiplyToRef(f,j),this._processCollisionsForSubMeshes(q,j),this}_generatePointsArray(){return!1}intersects(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],g=arguments.length>4?arguments[4]:void 0,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const Q=new r.d,H=this.getClassName(),u="InstancedLinesMesh"===H||"LinesMesh"===H||"GreasedLineMesh"===H?this.intersectionThreshold:0,X=this.getBoundingInfo();if(!this.Qd)return Q;if(!L&&(!q.intersectsSphere(X.boundingSphere,u)||!q.intersectsBox(X.boundingBox,u)))return Q;if(d)return Q.hit=!L,Q.pickedMesh=L?null:this,Q.distance=L?0:h.j.Distance(q.origin,X.boundingSphere.center),Q.subMeshId=0,Q;if(!this._generatePointsArray())return Q;let z=null;const B=this._scene.getIntersectingSubMeshCandidates(this,q),D=B.length;let i=!1;for(let h=0;h<D;h++){const q=B.data[h].bq();if(q&&(7==q.fillMode||0==q.fillMode||1==q.fillMode||2==q.fillMode||4==q.fillMode)){i=!0;break}}if(!i)return Q.hit=!0,Q.pickedMesh=this,Q.distance=h.j.Distance(q.origin,X.boundingSphere.center),Q.subMeshId=-1,Q;for(let h=0;h<D;h++){const d=B.data[h];if(D>1&&!L&&!d.canIntersects(q))continue;const g=d.intersects(q,this._positions,this.sf(),f,j);if(g&&(f||!z||g.distance<z.distance)&&(z=g,z.subMeshId=h,f))break}if(z){const f=g??this.getWorldMatrix(),j=h.f.kf[0],d=h.f.kf[1];h.j.TransformCoordinatesToRef(q.origin,f,j),q.direction.scaleToRef(z.distance,d);const L=h.j.TransformNormal(d,f).addInPlace(j);return Q.hit=!0,Q.distance=h.j.Distance(j,L),Q.pickedPoint=L,Q.pickedMesh=this,Q.bu=z.bu||0,Q.bv=z.bv||0,Q.subMeshFaceId=z.faceId,Q.faceId=z.faceId+B.data[z.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),Q.subMeshId=z.subMeshId,Q}return Q}clone(q,f,j){return null}releaseSubMeshes(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.Qd)for(;this.Qd.length;)this.Qd[0].dispose(q);else this.Qd=[];return this}dispose(q){let f,j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const d=this.eq();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),d.freeActiveMeshes(),d.freeRenderingGroups(),d.renderingManager.maintainStateBetweenFrames&&d.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((q=>q!==this&&q.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),f=0;f<this._intersectionsInProgress.length;f++){const q=this._intersectionsInProgress[f],j=q._intersectionsInProgress.indexOf(this);q._intersectionsInProgress.splice(j,1)}this._intersectionsInProgress.length=0;const g=d.lights;for(const L of g){let q=L.includedOnlyMeshes.indexOf(this);-1!==q&&L.includedOnlyMeshes.splice(q,1),q=L.excludedMeshes.indexOf(this),-1!==q&&L.excludedMeshes.splice(q,1);const f=L.getShadowGenerators();if(f){const j=f.values();for(let f=j.next();!0!==f.done;f=j.next()){const j=f.value.getShadowMap();j&&j.renderList&&(q=j.renderList.indexOf(this),-1!==q&&j.renderList.splice(q,1))}}}"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes(!0);const h=d.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,h.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),h.wipeCaches(),d.Zu(this),this._parentContainer){const q=this._parentContainer.meshes.indexOf(this);q>-1&&this._parentContainer.meshes.splice(q,1),this._parentContainer=null}if(j&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!q)for(f=0;f<d.ez.length;f++)d.ez[f].k===this&&(d.ez[f].dispose(),f--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(q,j)}_initFacetData(){const q=this._internalAbstractMeshDataInfo._facetData;q.facetNormals||(q.facetNormals=[]),q.facetPositions||(q.facetPositions=[]),q.facetPartitioning||(q.facetPartitioning=new Array),q.facetNb=this.sf().length/3|0,q.partitioningSubdivisions=q.partitioningSubdivisions?q.partitioningSubdivisions:10,q.partitioningBBoxRatio=q.partitioningBBoxRatio?q.partitioningBBoxRatio:1.01;for(let f=0;f<q.facetNb;f++)q.facetNormals[f]=h.j.Zero(),q.facetPositions[f]=h.j.Zero();return q.facetDataEnabled=!0,this}updateFacetData(){const q=this._internalAbstractMeshDataInfo._facetData;q.facetDataEnabled||this._initFacetData();const f=this.getVerticesData(L.i.PositionKind),j=this.sf(),d=this.getVerticesData(L.i.NormalKind),g=this.getBoundingInfo();if(q.facetDepthSort&&!q.facetDepthSortEnabled){if(q.facetDepthSortEnabled=!0,j instanceof Uint16Array)q.depthSortedIndices=new Uint16Array(j);else if(j instanceof Uint32Array)q.depthSortedIndices=new Uint32Array(j);else{let f=!1;for(let q=0;q<j.length;q++)if(j[q]>65535){f=!0;break}q.depthSortedIndices=f?new Uint32Array(j):new Uint16Array(j)}if(q.facetDepthSortFunction=function(q,f){return f.sqDistance-q.sqDistance},!q.facetDepthSortFrom){const f=this.eq().activeCamera;q.facetDepthSortFrom=f?f.position:h.j.Zero()}q.depthSortedFacets=[];for(let f=0;f<q.facetNb;f++){const j={ind:3*f,sqDistance:0};q.depthSortedFacets.push(j)}q.invertedMatrix=h.b.Identity(),q.facetDepthSortOrigin=h.j.Zero()}q.bbSize.x=g.maximum.x-g.minimum.x>t.d?g.maximum.x-g.minimum.x:t.d,q.bbSize.y=g.maximum.y-g.minimum.y>t.d?g.maximum.y-g.minimum.y:t.d,q.bbSize.z=g.maximum.z-g.minimum.z>t.d?g.maximum.z-g.minimum.z:t.d;let H=q.bbSize.x>q.bbSize.y?q.bbSize.x:q.bbSize.y;if(H=H>q.bbSize.z?H:q.bbSize.z,q.subDiv.max=q.partitioningSubdivisions,q.subDiv.X=Math.floor(q.subDiv.max*q.bbSize.x/H),q.subDiv.Y=Math.floor(q.subDiv.max*q.bbSize.y/H),q.subDiv.Z=Math.floor(q.subDiv.max*q.bbSize.z/H),q.subDiv.X=q.subDiv.X<1?1:q.subDiv.X,q.subDiv.Y=q.subDiv.Y<1?1:q.subDiv.Y,q.subDiv.Z=q.subDiv.Z<1?1:q.subDiv.Z,q.facetParameters.facetNormals=this.getFacetLocalNormals(),q.facetParameters.facetPositions=this.getFacetLocalPositions(),q.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),q.facetParameters.bInfo=g,q.facetParameters.bbSize=q.bbSize,q.facetParameters.subDiv=q.subDiv,q.facetParameters.ratio=this.partitioningBBoxRatio,q.facetParameters.depthSort=q.facetDepthSort,q.facetDepthSort&&q.facetDepthSortEnabled&&(this.Nf(!0),this._worldMatrix.invertToRef(q.invertedMatrix),h.j.TransformCoordinatesToRef(q.facetDepthSortFrom,q.invertedMatrix,q.facetDepthSortOrigin),q.facetParameters.distanceTo=q.facetDepthSortOrigin),q.facetParameters.depthSortedFacets=q.depthSortedFacets,d&&Q.e.ComputeNormals(f,j,d,q.facetParameters),q.facetDepthSort&&q.facetDepthSortEnabled){q.depthSortedFacets.sort(q.facetDepthSortFunction);const f=q.depthSortedIndices.length/3|0;for(let d=0;d<f;d++){const f=q.depthSortedFacets[d].ind;q.depthSortedIndices[3*d]=j[f],q.depthSortedIndices[3*d+1]=j[f+1],q.depthSortedIndices[3*d+2]=j[f+2]}this.updateIndices(q.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const q=this._internalAbstractMeshDataInfo._facetData;return q.facetNormals||this.updateFacetData(),q.facetNormals}getFacetLocalPositions(){const q=this._internalAbstractMeshDataInfo._facetData;return q.facetPositions||this.updateFacetData(),q.facetPositions}getFacetLocalPartitioning(){const q=this._internalAbstractMeshDataInfo._facetData;return q.facetPartitioning||this.updateFacetData(),q.facetPartitioning}getFacetPosition(q){const f=h.j.Zero();return this.getFacetPositionToRef(q,f),f}getFacetPositionToRef(q,f){const j=this.getFacetLocalPositions()[q],d=this.getWorldMatrix();return h.j.TransformCoordinatesToRef(j,d,f),this}getFacetNormal(q){const f=h.j.Zero();return this.getFacetNormalToRef(q,f),f}getFacetNormalToRef(q,f){const j=this.getFacetLocalNormals()[q];return h.j.TransformNormalToRef(j,this.getWorldMatrix(),f),this}getFacetsAtLocalCoordinates(q,f,j){const d=this.getBoundingInfo(),g=this._internalAbstractMeshDataInfo._facetData,h=Math.floor((q-d.minimum.x*g.partitioningBBoxRatio)*g.subDiv.X*g.partitioningBBoxRatio/g.bbSize.x),L=Math.floor((f-d.minimum.y*g.partitioningBBoxRatio)*g.subDiv.Y*g.partitioningBBoxRatio/g.bbSize.y),Q=Math.floor((j-d.minimum.z*g.partitioningBBoxRatio)*g.subDiv.Z*g.partitioningBBoxRatio/g.bbSize.z);return h<0||h>g.subDiv.max||L<0||L>g.subDiv.max||Q<0||Q>g.subDiv.max?null:g.facetPartitioning[h+g.subDiv.max*L+g.subDiv.max*g.subDiv.max*Q]}getClosestFacetAtCoordinates(q,f,j,d){let g=arguments.length>4&&void 0!==arguments[4]&&arguments[4],L=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const Q=this.getWorldMatrix(),H=h.f.Matrix[5];Q.invertToRef(H);const r=h.f.kf[8];h.j.TransformCoordinatesFromFloatsToRef(q,f,j,H,r);const u=this.getClosestFacetAtLocalCoordinates(r.x,r.y,r.z,d,g,L);return d&&h.j.TransformCoordinatesFromFloatsToRef(d.x,d.y,d.z,Q,d),u}getClosestFacetAtLocalCoordinates(q,f,j,d){let g=arguments.length>4&&void 0!==arguments[4]&&arguments[4],h=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],L=null,Q=0,H=0,r=0,u=0,X=0,z=0,B=0,D=0;const i=this.getFacetLocalPositions(),t=this.getFacetLocalNormals(),O=this.getFacetsAtLocalCoordinates(q,f,j);if(!O)return null;let N,w,E,s=Number.MAX_VALUE,S=s;for(let e=0;e<O.length;e++)N=O[e],w=t[N],E=i[N],u=(q-E.x)*w.x+(f-E.y)*w.y+(j-E.z)*w.z,(!g||g&&h&&u>=0||g&&!h&&u<=0)&&(u=w.x*E.x+w.y*E.y+w.z*E.z,X=-(w.x*q+w.y*f+w.z*j-u)/(w.x*w.x+w.y*w.y+w.z*w.z),z=q+w.x*X,B=f+w.y*X,D=j+w.z*X,Q=z-q,H=B-f,r=D-j,S=Q*Q+H*H+r*r,S<s&&(s=S,L=N,d&&(d.x=z,d.y=B,d.z=D)));return L}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const q=this._internalAbstractMeshDataInfo._facetData;return q.facetDataEnabled&&(q.facetDataEnabled=!1,q.facetPositions=[],q.facetNormals=[],q.facetPartitioning=new Array,q.facetParameters={},q.depthSortedIndices=new Uint32Array(0)),this}updateIndices(q,f){return this}createNormals(q){const f=this.getVerticesData(L.i.PositionKind),j=this.sf();let d;return d=this.isVerticesDataPresent(L.i.NormalKind)?this.getVerticesData(L.i.NormalKind):[],Q.e.ComputeNormals(f,j,d,{useRightHandedSystem:this.eq().useRightHandedSystem}),this.oq(L.i.NormalKind,d,q),this}async optimizeIndicesAsync(){const q=this.sf();if(!q)return this;const{OptimizeIndices:f}=await j.e(35).then(j.bind(j,13464));return f(q),this.setIndices(q,this.getTotalVertices()),this}alignWithNormal(q,f){f||(f=O.e.Y);const j=h.f.kf[0],d=h.f.kf[1];return h.j.CrossToRef(f,q,d),h.j.CrossToRef(q,d,j),this.rotationQuaternion?h.e.RotationQuaternionFromAxisToRef(j,q,d,this.rotationQuaternion):h.j.RotationFromAxisToRef(j,q,d,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,B.c)("EdgesRenderer")}enableEdgesRendering(q,f,j){throw(0,B.c)("EdgesRenderer")}Zz(){return this._scene.ez.filter((q=>q.k===this))}}e.OCCLUSION_TYPE_NONE=0,e.OCCLUSION_TYPE_OPTIMISTIC=1,e.OCCLUSION_TYPE_STRICT=2,e.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,e.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,e.CULLINGSTRATEGY_STANDARD=0,e.RX=1,e.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,e.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,d.b)([w.c.filter((function(){for(var q=arguments.length,f=new Array(q),j=0;j<q;j++)f[j]=arguments[j];let[d,g,h,L,Q]=f;return!Array.isArray(d)&&!Array.isArray(g)&&!Array.isArray(h)&&!Array.isArray(L)&&!Array.isArray(Q)}))],e,"_ApplySkeleton",null),(0,N.f)("BABYLON.AbstractMesh",e)},11690:(q,f,j)=>{j.d(f,{c:()=>d.i});var d=j(11151)},11308:(q,f,j)=>{j.d(f,{e:()=>t});var d=j(10941),g=j(11210),h=j(11257),L=j(11151),Q=j(11142),H=j(11310),r=j(11164),u=j(10992),X=j(11202),z=j(11177),B=j(10980),D=j(11316),i=j(11155);class t{get boundingBias(){return this._boundingBias}set boundingBias(q){this._boundingBias?this._boundingBias.H(q):this._boundingBias=q.clone(),this.Fq(!0,null)}static CreateGeometryForMesh(q){const f=new t(t.RandomId(),q.eq());return f.Yq(q),f}get meshes(){return this._meshes}constructor(q,f,j){let g=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._extend={minimum:new d.j(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),maximum:new d.j(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=f||B.d.LastCreatedScene,this._scene&&(this.id=q,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=g,j?this.setAllVerticesData(j,g):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),h&&(this.Yq(h),h.Nf(!0)))}get extend(){return this._extend}eq(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let q=0;q<this._meshes.length;q++)if(!this._meshes[q].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const q=new Set;for(const f in this._vertexBuffers)q.add(this._vertexBuffers[f].getWrapperBuffer());q.forEach((q=>{q._rebuild()}))}setAllVerticesData(q,f){q.applyToGeometry(this,f),this._notifyUpdate()}oq(q,f){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3?arguments[3]:void 0;j&&Array.isArray(f)&&(f=new Float32Array(f));const g=new L.i(this._engine,f,q,{updatable:j,postponeInternalCreation:0===this._meshes.length,stride:d,label:"Geometry_"+this.id+"_"+q});this.setVerticesBuffer(g)}removeVerticesData(q){this._vertexBuffers[q]&&(this._vertexBuffers[q].dispose(),delete this._vertexBuffers[q]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const g=q.getKind();this._vertexBuffers[g]&&j&&this._vertexBuffers[g].dispose(),q._buffer&&q._buffer._increaseReferences(),this._vertexBuffers[g]=q;const h=this._meshes,Q=h.length;if(g===L.i.PositionKind){this._totalVertices=f??q._maxVerticesCount,this._updateExtend(q.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const j=this._extend&&this._extend.minimum||new d.j(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),g=this._extend&&this._extend.maximum||new d.j(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let q=0;q<Q;q++){const f=h[q];f.buildBoundingInfo(j,g),f._createGlobalSubMesh(f.isUnIndexed),f.Nf(!0),f.synchronizeInstances()}}this._notifyUpdate(g)}updateVerticesDataDirectly(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const g=this.getVertexBuffer(q);g&&(g.updateDirectly(f,j,d),this._notifyUpdate(q))}updateVerticesData(q,f){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const d=this.getVertexBuffer(q);d&&(d.update(f),q===L.i.PositionKind&&this.Fq(j,f),this._notifyUpdate(q))}Fq(q,f){if(q&&this._updateExtend(f),this._resetPointsArrayCache(),q){const q=this._meshes;for(const f of q){f.hasBoundingInfo?f.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):f.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const q=f.Qd;for(const f of q)f.refreshBoundingInfo()}}}_bind(q,f,j,d){if(!q)return;void 0===f&&(f=this._indexBuffer);const g=this.getVertexBuffers();if(!g)return;if(f!=this._indexBuffer||!this._vertexArrayObjects&&!d)return void this._engine.bindBuffers(g,f,q,j);const h=d||this._vertexArrayObjects,L=this._engine;h[q.key]||(h[q.key]=L.recordVertexArrayObject(g,f,q,j)),L.bindVertexArrayObject(h[q.key],f)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(q,f,j){const d=this.getVertexBuffer(q);return d?d.getFloatData(this._totalVertices,j||f&&1!==this._meshes.length):null}copyVerticesData(q,f){const j=this.getVertexBuffer(q);if(!j)return;f[q]||(f[q]=new Float32Array(this._totalVertices*j.getSize()));const d=j.getData();d&&(0,i.g)(d,j.getSize(),j.type,j.byteOffset,j.byteStride,j.normalized,this._totalVertices,f[q])}isVertexBufferUpdatable(q){const f=this._vertexBuffers[q];return!!f&&f.isUpdatable()}getVertexBuffer(q){return this.isReady()?this._vertexBuffers[q]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(q){return this._vertexBuffers?void 0!==this._vertexBuffers[q]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(q)}getVerticesDataKinds(){const q=[];let f;if(!this._vertexBuffers&&this._delayInfo)for(f in this._delayInfo)q.push(f);else for(f in this._vertexBuffers)q.push(f);return q}updateIndices(q,f){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const d=q.length!==this._indices.length;if(j||(this._indices=q.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,q,f),d)for(const q of this._meshes)q._createGlobalSubMesh(!0)}else this.setIndices(q,null,!0)}setIndexBuffer(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=q,this._totalVertices=f,this._totalIndices=j,q.is32Bits=null===d?f>65535:d;for(const g of this._meshes)g._createGlobalSubMesh(!0),g.synchronizeInstances();this._notifyUpdate()}setIndices(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=q,this._indexBufferIsUpdatable=j,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,j,"Geometry_"+this.id+"_IndexBuffer")),void 0!=f&&(this._totalVertices=f);for(const g of this._meshes)g._createGlobalSubMesh(!d),g.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}sf(q,f){if(!this.isReady())return null;const j=this._indices;return f||q&&1!==this._meshes.length?j.slice():j}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;q&&this._vertexArrayObjects&&this._vertexArrayObjects[q.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[q.key]),delete this._vertexArrayObjects[q.key])}releaseForMesh(q,f){const j=this._meshes,d=j.indexOf(q);-1!==d&&(j.splice(d,1),this._vertexArrayObjects&&q._invalidateInstanceVertexArrayObject(),q._geometry=null,0===j.length&&f&&this.dispose())}Yq(q){if(q._geometry===this)return;const f=q._geometry;f&&f.releaseForMesh(q),this._vertexArrayObjects&&q._invalidateInstanceVertexArrayObject();const j=this._meshes;q._geometry=this,q._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),j.push(q),this.isReady()?this._applyToMesh(q):this._boundingInfo&&q.setBoundingInfo(this._boundingInfo)}_updateExtend(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!q&&(q=this.getVerticesData(L.i.PositionKind),!q))return;this._extend=(0,z.i)(q,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(q){const f=this._meshes.length;for(const j in this._vertexBuffers)1===f&&this._vertexBuffers[j].create(),j===L.i.PositionKind&&(this._extend||this._updateExtend(),q.buildBoundingInfo(this._extend.minimum,this._extend.maximum),q._createGlobalSubMesh(q.isUnIndexed),q.Fq());1===f&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),q._syncGeometryWithMorphTargetManager(),q.synchronizeInstances()}_notifyUpdate(q){this.onGeometryUpdated&&this.onGeometryUpdated(this,q),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const f of this._meshes)f._markSubMeshesAsAttributesDirty()}load(q,f){2!==this.delayLoadState&&(this.isReady()?f&&f():(this.delayLoadState=2,this._queueLoad(q,f)))}_queueLoad(q,f){this.delayLoadingFile&&(q.addPendingData(this),q._loadFile(this.delayLoadingFile,(j=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(j),this),this.delayLoadState=1,this._delayInfo=[],q.removePendingData(this);const d=this._meshes,g=d.length;for(let q=0;q<g;q++)this._applyToMesh(d[q]);f&&f()}),void 0,!0))}toLeftHanded(){const q=this.sf(!1);if(null!=q&&q.length>0){for(let f=0;f<q.length;f+=3){const j=q[f+0];q[f+0]=q[f+2],q[f+2]=j}this.setIndices(q)}const f=this.getVerticesData(L.i.PositionKind,!1);if(null!=f&&f.length>0){for(let q=0;q<f.length;q+=3)f[q+2]=-f[q+2];this.oq(L.i.PositionKind,f,!1)}const j=this.getVerticesData(L.i.NormalKind,!1);if(null!=j&&j.length>0){for(let q=0;q<j.length;q+=3)j[q+2]=-j[q+2];this.oq(L.i.NormalKind,j,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const q=this.getVerticesData(L.i.PositionKind);if(!q||0===q.length)return!1;for(let f=3*this._positionsCache.length,j=this._positionsCache.length;f<q.length;f+=3,++j)this._positionsCache[j]=d.j.Pf(q,f);for(let f=0,j=0;f<q.length;f+=3,++j)this._positionsCache[j].set(q[0+f],q[1+f],q[2+f]);return this._positionsCache.length=q.length/3,this._positions=this._positionsCache,!0}B(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const j in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[j]);this._vertexArrayObjects={};const q=this._meshes,f=q.length;for(let j=0;j<f;j++)q[j]._invalidateInstanceVertexArrayObject()}}dispose(){const q=this._meshes,f=q.length;let j;for(j=0;j<f;j++)this.releaseForMesh(q[j]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const d in this._vertexBuffers)this._vertexBuffers[d].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const q=this._parentContainer.geometries.indexOf(this);q>-1&&this._parentContainer.geometries.splice(q,1),this._parentContainer=null}this._isDisposed=!0}i(q){const f=new h.e;f.indices=[];const j=this.sf();if(j)for(let h=0;h<j.length;h++)f.indices.push(j[h]);let d,g=!1,L=!1;for(d in this._vertexBuffers){const q=this.getVerticesData(d);if(q&&(q instanceof Float32Array?f.set(new Float32Array(q),d):f.set(q.slice(0),d),!L)){const q=this.getVertexBuffer(d);q&&(g=q.isUpdatable(),L=!g)}}const Q=new t(q,this._scene,f,g);for(d in Q.delayLoadState=this.delayLoadState,Q.delayLoadingFile=this.delayLoadingFile,Q._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)Q._delayInfo=Q._delayInfo||[],Q._delayInfo.push(d);return Q._boundingInfo=new r.b(this._extend.minimum,this._extend.maximum),Q}serialize(){const q={};return q.id=this.id,q.uniqueId=this.uniqueId,q.updatable=this._updatable,X.c&&X.c.HasTags(this)&&(q.tags=X.c.GetTags(this)),q}_toNumberArray(q){return Array.isArray(q)?q:Array.prototype.slice.call(q)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const q in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,q)&&(this._vertexBuffers[q]._buffer._data=null)}serializeVerticeData(){const q=this.serialize();return this.isVerticesDataPresent(L.i.PositionKind)&&(q.Iq=this._toNumberArray(this.getVerticesData(L.i.PositionKind)),this.isVertexBufferUpdatable(L.i.PositionKind)&&(q.positionsUpdatable=!0)),this.isVerticesDataPresent(L.i.NormalKind)&&(q.Tq=this._toNumberArray(this.getVerticesData(L.i.NormalKind)),this.isVertexBufferUpdatable(L.i.NormalKind)&&(q.normalsUpdatable=!0)),this.isVerticesDataPresent(L.i.TangentKind)&&(q.tangents=this._toNumberArray(this.getVerticesData(L.i.TangentKind)),this.isVertexBufferUpdatable(L.i.TangentKind)&&(q.tangentsUpdatable=!0)),this.isVerticesDataPresent(L.i.UVKind)&&(q.nq=this._toNumberArray(this.getVerticesData(L.i.UVKind)),this.isVertexBufferUpdatable(L.i.UVKind)&&(q.uvsUpdatable=!0)),this.isVerticesDataPresent(L.i.UV2Kind)&&(q.uvs2=this._toNumberArray(this.getVerticesData(L.i.UV2Kind)),this.isVertexBufferUpdatable(L.i.UV2Kind)&&(q.uvs2Updatable=!0)),this.isVerticesDataPresent(L.i.UV3Kind)&&(q.uvs3=this._toNumberArray(this.getVerticesData(L.i.UV3Kind)),this.isVertexBufferUpdatable(L.i.UV3Kind)&&(q.uvs3Updatable=!0)),this.isVerticesDataPresent(L.i.UV4Kind)&&(q.uvs4=this._toNumberArray(this.getVerticesData(L.i.UV4Kind)),this.isVertexBufferUpdatable(L.i.UV4Kind)&&(q.uvs4Updatable=!0)),this.isVerticesDataPresent(L.i.UV5Kind)&&(q.uvs5=this._toNumberArray(this.getVerticesData(L.i.UV5Kind)),this.isVertexBufferUpdatable(L.i.UV5Kind)&&(q.uvs5Updatable=!0)),this.isVerticesDataPresent(L.i.UV6Kind)&&(q.uvs6=this._toNumberArray(this.getVerticesData(L.i.UV6Kind)),this.isVertexBufferUpdatable(L.i.UV6Kind)&&(q.uvs6Updatable=!0)),this.isVerticesDataPresent(L.i.ColorKind)&&(q.Wq=this._toNumberArray(this.getVerticesData(L.i.ColorKind)),this.isVertexBufferUpdatable(L.i.ColorKind)&&(q.colorsUpdatable=!0)),this.isVerticesDataPresent(L.i.MatricesIndicesKind)&&(q.matricesIndices=this._toNumberArray(this.getVerticesData(L.i.MatricesIndicesKind)),q.matricesIndicesExpanded=!0,this.isVertexBufferUpdatable(L.i.MatricesIndicesKind)&&(q.matricesIndicesUpdatable=!0)),this.isVerticesDataPresent(L.i.MatricesWeightsKind)&&(q.matricesWeights=this._toNumberArray(this.getVerticesData(L.i.MatricesWeightsKind)),this.isVertexBufferUpdatable(L.i.MatricesWeightsKind)&&(q.matricesWeightsUpdatable=!0)),q.indices=this._toNumberArray(this.sf()),q}static ExtractFromMesh(q,f){const j=q._geometry;return j?j.i(f):null}static RandomId(){return u.h.RandomId()}static _GetGeometryByLoadedUniqueId(q,f){for(let j=0;j<f.geometries.length;j++)if(f.geometries[j]._loadedUniqueId===q)return f.geometries[j];return null}static _ImportGeometry(q,f){const j=f.eq(),d=q.geometryUniqueId,h=q.geometryId;if(d||h){const q=d?this._GetGeometryByLoadedUniqueId(d,j):j.getGeometryById(h);q&&q.Yq(f)}else if(q instanceof ArrayBuffer){const j=f._binaryInfo;if(j.positionsAttrDesc&&j.positionsAttrDesc.count>0){const d=new Float32Array(q,j.positionsAttrDesc.offset,j.positionsAttrDesc.count);f.oq(L.i.PositionKind,d,!1)}if(j.normalsAttrDesc&&j.normalsAttrDesc.count>0){const d=new Float32Array(q,j.normalsAttrDesc.offset,j.normalsAttrDesc.count);f.oq(L.i.NormalKind,d,!1)}if(j.tangetsAttrDesc&&j.tangetsAttrDesc.count>0){const d=new Float32Array(q,j.tangetsAttrDesc.offset,j.tangetsAttrDesc.count);f.oq(L.i.TangentKind,d,!1)}if(j.uvsAttrDesc&&j.uvsAttrDesc.count>0){const d=new Float32Array(q,j.uvsAttrDesc.offset,j.uvsAttrDesc.count);if(D.b)for(let q=1;q<d.length;q+=2)d[q]=1-d[q];f.oq(L.i.UVKind,d,!1)}if(j.uvs2AttrDesc&&j.uvs2AttrDesc.count>0){const d=new Float32Array(q,j.uvs2AttrDesc.offset,j.uvs2AttrDesc.count);if(D.b)for(let q=1;q<d.length;q+=2)d[q]=1-d[q];f.oq(L.i.UV2Kind,d,!1)}if(j.uvs3AttrDesc&&j.uvs3AttrDesc.count>0){const d=new Float32Array(q,j.uvs3AttrDesc.offset,j.uvs3AttrDesc.count);if(D.b)for(let q=1;q<d.length;q+=2)d[q]=1-d[q];f.oq(L.i.UV3Kind,d,!1)}if(j.uvs4AttrDesc&&j.uvs4AttrDesc.count>0){const d=new Float32Array(q,j.uvs4AttrDesc.offset,j.uvs4AttrDesc.count);if(D.b)for(let q=1;q<d.length;q+=2)d[q]=1-d[q];f.oq(L.i.UV4Kind,d,!1)}if(j.uvs5AttrDesc&&j.uvs5AttrDesc.count>0){const d=new Float32Array(q,j.uvs5AttrDesc.offset,j.uvs5AttrDesc.count);if(D.b)for(let q=1;q<d.length;q+=2)d[q]=1-d[q];f.oq(L.i.UV5Kind,d,!1)}if(j.uvs6AttrDesc&&j.uvs6AttrDesc.count>0){const d=new Float32Array(q,j.uvs6AttrDesc.offset,j.uvs6AttrDesc.count);if(D.b)for(let q=1;q<d.length;q+=2)d[q]=1-d[q];f.oq(L.i.UV6Kind,d,!1)}if(j.colorsAttrDesc&&j.colorsAttrDesc.count>0){const d=new Float32Array(q,j.colorsAttrDesc.offset,j.colorsAttrDesc.count);f.oq(L.i.ColorKind,d,!1,j.colorsAttrDesc.stride)}if(j.matricesIndicesAttrDesc&&j.matricesIndicesAttrDesc.count>0){const d=new Int32Array(q,j.matricesIndicesAttrDesc.offset,j.matricesIndicesAttrDesc.count),g=[];for(let q=0;q<d.length;q++){const f=d[q];g.push(255&f),g.push((65280&f)>>8),g.push((16711680&f)>>16),g.push(f>>24&255)}f.oq(L.i.MatricesIndicesKind,g,!1)}if(j.matricesIndicesExtraAttrDesc&&j.matricesIndicesExtraAttrDesc.count>0){const d=new Int32Array(q,j.matricesIndicesExtraAttrDesc.offset,j.matricesIndicesExtraAttrDesc.count),g=[];for(let q=0;q<d.length;q++){const f=d[q];g.push(255&f),g.push((65280&f)>>8),g.push((16711680&f)>>16),g.push(f>>24&255)}f.oq(L.i.MatricesIndicesExtraKind,g,!1)}if(j.matricesWeightsAttrDesc&&j.matricesWeightsAttrDesc.count>0){const d=new Float32Array(q,j.matricesWeightsAttrDesc.offset,j.matricesWeightsAttrDesc.count);f.oq(L.i.MatricesWeightsKind,d,!1)}if(j.indicesAttrDesc&&j.indicesAttrDesc.count>0){const d=new Int32Array(q,j.indicesAttrDesc.offset,j.indicesAttrDesc.count);f.setIndices(d,null)}if(j.subMeshesAttrDesc&&j.subMeshesAttrDesc.count>0){const d=new Int32Array(q,j.subMeshesAttrDesc.offset,5*j.subMeshesAttrDesc.count);f.Qd=[];for(let q=0;q<j.subMeshesAttrDesc.count;q++){const j=d[5*q+0],g=d[5*q+1],h=d[5*q+2],L=d[5*q+3],H=d[5*q+4];Q.d.AddToMesh(j,g,h,L,H,f)}}}else if(q.Iq&&q.Tq&&q.indices){if(f.oq(L.i.PositionKind,q.Iq,q.Iq._updatable||q.positionsUpdatable),f.oq(L.i.NormalKind,q.Tq,q.Tq._updatable||q.normalsUpdatable),q.tangents&&f.oq(L.i.TangentKind,q.tangents,q.tangents._updatable||q.tangentsUpdatable),q.nq&&f.oq(L.i.UVKind,q.nq,q.nq._updatable||q.uvsUpdatable),q.uvs2&&f.oq(L.i.UV2Kind,q.uvs2,q.uvs2._updatable||q.uvs2Updatable),q.uvs3&&f.oq(L.i.UV3Kind,q.uvs3,q.uvs3._updatable||q.uvs3Updatable),q.uvs4&&f.oq(L.i.UV4Kind,q.uvs4,q.uvs4._updatable||q.uvs4Updatable),q.uvs5&&f.oq(L.i.UV5Kind,q.uvs5,q.uvs5._updatable||q.uvs5Updatable),q.uvs6&&f.oq(L.i.UV6Kind,q.uvs6,q.uvs6._updatable||q.uvs6Updatable),q.Wq&&f.oq(L.i.ColorKind,g.e.CheckColors4(q.Wq,q.Iq.length/3),q.Wq._updatable),q.matricesIndices)if(q.matricesIndices._isExpanded||q.matricesIndicesExpanded)delete q.matricesIndices._isExpanded,delete q.matricesIndicesExpanded,f.oq(L.i.MatricesIndicesKind,q.matricesIndices,q.matricesIndices._updatable||q.matricesIndicesUpdatable);else{const j=[];for(let f=0;f<q.matricesIndices.length;f++){const d=q.matricesIndices[f];j.push(255&d),j.push((65280&d)>>8),j.push((16711680&d)>>16),j.push(d>>24&255)}f.oq(L.i.MatricesIndicesKind,j,q.matricesIndices._updatable||q.matricesIndicesUpdatable)}if(q.matricesIndicesExtra)if(q.matricesIndicesExtraExpanded||q.matricesIndicesExtra._isExpanded)delete q.matricesIndices._isExpanded,delete q.matricesIndicesExtraExpanded,f.oq(L.i.MatricesIndicesExtraKind,q.matricesIndicesExtra,q.matricesIndicesExtra._updatable||q.matricesIndicesExtraUpdatable);else{const j=[];for(let f=0;f<q.matricesIndicesExtra.length;f++){const d=q.matricesIndicesExtra[f];j.push(255&d),j.push((65280&d)>>8),j.push((16711680&d)>>16),j.push(d>>24&255)}f.oq(L.i.MatricesIndicesExtraKind,j,q.matricesIndicesExtra._updatable||q.matricesIndicesExtraUpdatable)}q.matricesWeights&&(t._CleanMatricesWeights(q,f),f.oq(L.i.MatricesWeightsKind,q.matricesWeights,q.matricesWeights._updatable)),q.matricesWeightsExtra&&f.oq(L.i.MatricesWeightsExtraKind,q.matricesWeightsExtra,q.matricesWeights._updatable),f.setIndices(q.indices,null)}if(q.Qd){f.Qd=[];for(let j=0;j<q.Qd.length;j++){const d=q.Qd[j];Q.d.AddToMesh(d.materialIndex,d.verticesStart,d.verticesCount,d.indexStart,d.indexCount,f)}}f._shouldGenerateFlatShading&&(f.convertToFlatShadedMesh(),f._shouldGenerateFlatShading=!1),f.Nf(!0),j.onMeshImportedObservable.notifyObservers(f)}static _CleanMatricesWeights(q,f){const j=.001;if(!H.c.CleanBoneMatrixWeights)return;let d=0;if(!(q.skeletonId>-1))return;{const j=f.eq().getLastSkeletonById(q.skeletonId);if(!j)return;d=j.bones.length}const g=f.getVerticesData(L.i.MatricesIndicesKind),h=f.getVerticesData(L.i.MatricesIndicesExtraKind),Q=q.matricesWeights,r=q.matricesWeightsExtra,u=q.numBoneInfluencer,X=Q.length;for(let L=0;L<X;L+=4){let q=0,f=-1;for(let d=0;d<4;d++){const g=Q[L+d];q+=g,g<j&&f<0&&(f=d)}if(r)for(let d=0;d<4;d++){const g=r[L+d];q+=g,g<j&&f<0&&(f=d+4)}if((f<0||f>u-1)&&(f=u-1),q>j){const f=1/q;for(let q=0;q<4;q++)Q[L+q]*=f;if(r)for(let q=0;q<4;q++)r[L+q]*=f}else f>=4?(r[L+f-4]=1-q,h[L+f-4]=d):(Q[L+f]=1-q,g[L+f]=d)}f.oq(L.i.MatricesIndicesKind,g),q.matricesWeightsExtra&&f.oq(L.i.MatricesIndicesExtraKind,h)}static Parse(q,f,j){const g=new t(q.id,f,void 0,q.updatable);return g._loadedUniqueId=q.uniqueId,X.c&&X.c.AddTagsTo(g,q.tags),q.delayLoadingFile?(g.delayLoadState=4,g.delayLoadingFile=j+q.delayLoadingFile,g._boundingInfo=new r.b(d.j.Pf(q.boundingBoxMinimum),d.j.Pf(q.boundingBoxMaximum)),g._delayInfo=[],q.hasUVs&&g._delayInfo.push(L.i.UVKind),q.hasUVs2&&g._delayInfo.push(L.i.UV2Kind),q.hasUVs3&&g._delayInfo.push(L.i.UV3Kind),q.hasUVs4&&g._delayInfo.push(L.i.UV4Kind),q.hasUVs5&&g._delayInfo.push(L.i.UV5Kind),q.hasUVs6&&g._delayInfo.push(L.i.UV6Kind),q.hasColors&&g._delayInfo.push(L.i.ColorKind),q.hasMatricesIndices&&g._delayInfo.push(L.i.MatricesIndicesKind),q.hasMatricesWeights&&g._delayInfo.push(L.i.MatricesWeightsKind),g._delayLoadingFunction=h.e.ImportVertexData):h.e.ImportVertexData(q,g),f.pushGeometry(g,!0),g}}},11280:(q,f,j)=>{j.d(f,{d:()=>z});var d=j(10941),g=j(11005),h=j(11249),L=j(11289),Q=j(11011),H=j(11245),r=j(11151),u=j(10992),X=j(10965);L.e._instancedMeshFactory=(q,f)=>{const j=new z(q,f);if(f.instancedBuffers){j.instancedBuffers={};for(const q in f.instancedBuffers)j.instancedBuffers[q]=f.instancedBuffers[q]}return j};class z extends h.e{constructor(q,f){super(q,f.eq()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,f.kz(this),this._sourceMesh=f,this._unIndexed=f._unIndexed,this.position.H(f.position),this.rotation.H(f.rotation),this.Vf.H(f.Vf),f.rotationQuaternion&&(this.rotationQuaternion=f.rotationQuaternion.clone()),this.animations=f.animations.slice();for(const j of f.getAnimationRanges())null!=j&&this.createAnimationRange(j.name,j.from,j.to);if(this.infiniteDistance=f.infiniteDistance,this.setPivotMatrix(f.getPivotMatrix()),f.skeleton||f.morphTargetManager||!f.hasBoundingInfo)this.refreshBoundingInfo(!0,!0);else{const q=f.getBoundingInfo();this.buildBoundingInfo(q.minimum,q.maximum)}this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(q){var f;(null===(f=this._sourceMesh)||void 0===f?void 0:f.receiveShadows)!==q&&u.h.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(q){var f;(null===(f=this._sourceMesh)||void 0===f?void 0:f.material)!==q&&u.h.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(q){var f;(null===(f=this._sourceMesh)||void 0===f?void 0:f.visibility)!==q&&u.h.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(q){var f;(null===(f=this._sourceMesh)||void 0===f?void 0:f.skeleton)!==q&&u.h.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(q){this._sourceMesh&&q!==this._sourceMesh.renderingGroupId&&g.e.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}get wf(){return this._sourceMesh._geometry}createInstance(q){return this._sourceMesh.createInstance(q)}isReady(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(q,!0)}getVerticesData(q,f,j){return this._sourceMesh.getVerticesData(q,f,j)}copyVerticesData(q,f){this._sourceMesh.copyVerticesData(q,f)}oq(q,f,j,d){return this.sourceMesh&&this.sourceMesh.oq(q,f,j,d),this.sourceMesh}updateVerticesData(q,f,j,d){return this.sourceMesh&&this.sourceMesh.updateVerticesData(q,f,j,d),this.sourceMesh}setIndices(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(q,f),this.sourceMesh}isVerticesDataPresent(q){return this._sourceMesh.isVerticesDataPresent(q)}sf(){return this._sourceMesh.sf()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let q,f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;q="object"===typeof f?f:{applySkeleton:f,applyMorph:j};const d=this._sourceMesh.wf?this._sourceMesh.wf.boundingBias:null;return this.Mq(this._sourceMesh._getData(q,null,r.i.PositionKind),d),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(q,f){if(super._activate(q,f),this._sourceMesh.Qd||g.e.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,q),f){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD!==this._sourceMesh&&this._currentLOD.billboardMode!==H.b.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new d.b);const q=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,d.f.kf[7].H(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.H(this._currentLOD.Nf(!0)),this._currentLOD.position.H(d.f.kf[7]),this._currentLOD._masterMesh=q,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(q){if(!q)return this;const f=this.sourceMesh.getLODLevels();if(f&&0!==f.length){const f=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(q,f.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(q){return this.sourceMesh._preActivateForIntermediateRendering(q)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.Qd)for(let q=0;q<this._sourceMesh.Qd.length;q++)this._sourceMesh.Qd[q].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Fq(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2?arguments[2]:void 0;const d=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).createInstance(q);if(Q.e.DeepCopy(this,d,["name","Qd","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","Sz","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo","wf"],[]),this.refreshBoundingInfo(),f&&(d.parent=f),!j)for(let g=0;g<this.eq().meshes.length;g++){const q=this.eq().meshes[g];q.parent===this&&q.clone(q.name,d)}return d.Nf(!0),this.onClonedObservable.notifyObservers(d),d}dispose(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.Az(this),super.dispose(q,f)}_serializeAsParent(q){super._serializeAsParent(q),q.parentId=this._sourceMesh.uniqueId,q.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,f=arguments.length>1?arguments[1]:void 0,j=arguments.length>2?arguments[2]:void 0;const d=this.clone("Clone of "+(this.name||this.id),q||this.parent,!0,f&&f.newSourcedMesh);d&&j&&j(this,d);for(const g of this.getChildTransformNodes(!0))g.instantiateHierarchy(d,f,j);return d}}L.e.prototype.registerInstancedBuffer=function(q,f){var j,d;if(null===(j=this._userInstancedBuffersStorage)||void 0===j||null===(d=j.vertexBuffers[q])||void 0===d||d.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const q of this.instances)q.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[q]=null,this._userInstancedBuffersStorage.strides[q]=f,this._userInstancedBuffersStorage.sizes[q]=32*f,this._userInstancedBuffersStorage.data[q]=new Float32Array(this._userInstancedBuffersStorage.sizes[q]),this._userInstancedBuffersStorage.vertexBuffers[q]=new r.i(this.getEngine(),this._userInstancedBuffersStorage.data[q],q,!0,!1,f,!0);for(const g of this.instances)g.instancedBuffers[q]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},L.e.prototype._processInstancedBuffers=function(q,f){const j=q?q.length:0;for(const d in this.instancedBuffers){let g=this._userInstancedBuffersStorage.sizes[d];const h=this._userInstancedBuffersStorage.strides[d],L=(j+1)*h;for(;g<L;)g*=2;this._userInstancedBuffersStorage.data[d].length!=g&&(this._userInstancedBuffersStorage.data[d]=new Float32Array(g),this._userInstancedBuffersStorage.sizes[d]=g,this._userInstancedBuffersStorage.vertexBuffers[d]&&(this._userInstancedBuffersStorage.vertexBuffers[d].dispose(),this._userInstancedBuffersStorage.vertexBuffers[d]=null));const Q=this._userInstancedBuffersStorage.data[d];let H=0;if(f){const q=this.instancedBuffers[d];q.toArray?q.toArray(Q,H):q.copyToArray?q.copyToArray(Q,H):Q[H]=q,H+=h}for(let f=0;f<j;f++){const j=q[f].instancedBuffers[d];j.toArray?j.toArray(Q,H):j.copyToArray?j.copyToArray(Q,H):Q[H]=j,H+=h}this._userInstancedBuffersStorage.vertexBuffers[d]?this._userInstancedBuffersStorage.vertexBuffers[d].updateDirectly(Q,0):(this._userInstancedBuffersStorage.vertexBuffers[d]=new r.i(this.getEngine(),this._userInstancedBuffersStorage.data[d],d,!0,!1,h,!0),this._invalidateInstanceVertexArrayObject())}},L.e.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const q in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[q]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},L.e.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const q in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[q]&&this._userInstancedBuffersStorage.vertexBuffers[q].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,X.f)("BABYLON.InstancedMesh",z)},11634:(q,f,j)=>{j.d(f,{c:()=>r});var d=j(11210),g=j(11151),h=j(11289),L=j(11280),Q=j(11118),H=j(11642);h.e._LinesMeshParser=(q,f)=>r.Parse(q,f);class r extends h.e{_isShaderMaterial(q){return"ShaderMaterial"===q.getClassName()}constructor(q){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>5?arguments[5]:void 0,L=arguments.length>6?arguments[6]:void 0,Q=arguments.length>7?arguments[7]:void 0;super(q,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,f,arguments.length>4?arguments[4]:void 0),this.useVertexColor=h,this.useVertexAlpha=L,this.color=new d.c(1,1,1),this.alpha=1,this._shaderLanguage=0,f&&(this.color=f.color.clone(),this.alpha=f.alpha,this.useVertexColor=f.useVertexColor,this.useVertexAlpha=f.useVertexAlpha),this.intersectionThreshold=.1;const u={attributes:[g.i.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(this.useVertexAlpha?u.defines.push("#define VERTEXALPHA"):u.needAlphaBlending=!1,this.useVertexColor?(u.defines.push("#define VERTEXCOLOR"),u.attributes.push(g.i.ColorKind)):(u.uniforms.push("color"),this._color4=new d.e),Q)this.material=Q;else{this.eq().getEngine().isWebGPU&&!r.ForceGLSL&&(this._shaderLanguage=1),u.shaderLanguage=this._shaderLanguage,u.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([j.e(23).then(j.bind(j,14061)),j.e(19).then(j.bind(j,14070))]):await Promise.all([j.e(17).then(j.bind(j,14078)),j.e(16).then(j.bind(j,14083))])},this.material=new H.d("colorShader",this.eq(),"color",u,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(q){this._lineMaterial=q,this._lineMaterial.fillMode=Q.b.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(q){}_bind(q,f){if(!this._geometry)return this;const j=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(f,j):this._geometry._bind(f,j,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:q,g:f,b:j}=this.color;this._color4.set(q,f,j,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(q,f,j){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const d=this.eq().getEngine();return this._unIndexed?d.drawArraysType(Q.b.LineListDrawMode,q.verticesStart,q.verticesCount,j):d.drawElementsType(Q.b.LineListDrawMode,q.indexStart,q.indexCount,j),this}dispose(q){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(q)}clone(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2?arguments[2]:void 0;if(f&&void 0===f._addToSceneRootNodes){const j=f;return j.source=this,new r(q,this.eq(),j.parent,j.source,j.doNotCloneChildren)}return new r(q,this.eq(),f,this,j)}createInstance(q){const f=new u(q,this);if(this.instancedBuffers){f.instancedBuffers={};for(const q in this.instancedBuffers)f.instancedBuffers[q]=this.instancedBuffers[q]}return f}serialize(q){super.serialize(q),q.color=this.color.Yf(),q.alpha=this.alpha}static Parse(q,f){const j=new r(q.name,f);return j.color=d.c.Pf(q.color),j.alpha=q.alpha,j}}r.ForceGLSL=!1;class u extends L.d{constructor(q,f){super(q,f),this.intersectionThreshold=f.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}},11289:(q,f,j)=>{j.d(f,{e:()=>F,f:()=>T});var d=j(10982),g=j(10992),h=j(11011),L=j(11202),Q=j(11259),H=j(11293),r=j(10941),u=j(11210),X=j(11247),z=j(11151),B=j(11257),D=j(11308),i=j(11249),t=j(11142),O=j(11118),N=j(11320),w=j(11310),E=j(11199),s=j(11005),S=j(10965),e=j(11016),Z=j(11327);class I{constructor(q,f){this.distanceOrScreenCoverage=q,this.mesh=f}}class T{}class W{constructor(){this.visibleInstances={},this.batchCache=new n,this.batchCacheReplacementModeInFrozenMode=new n,this.instancesBufferSize=2048}}class n{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class U{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class Y{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}const v={source:null,parent:null,doNotCloneChildren:!1,clonePhysicsImpostor:!0,cloneThinInstances:!1};class F extends i.e{static _GetDefaultSideOrientation(q){return q||F.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(q){this._internalMeshDataInfo._useLODScreenCoverage=q,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(q){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==q&&(q&&this._internalMeshDataInfo._sourcePositions&&(this.oq(z.i.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.oq(z.i.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=q,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new d.d),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new d.d),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new d.d),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new d.d),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new d.d),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(q){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(q)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(q){this._internalMeshDataInfo._forcedInstanceCount=q}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(q){this._internalMeshDataInfo._sideOrientation=q,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===q||!this._scene.useRightHandedSystem&&0===q}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(q){this.sideOrientation=q,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(q){this._internalMeshDataInfo._overrideRenderingFillMode=q}get material(){return this._internalAbstractMeshDataInfo._material}set material(q){q&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(q.sideOrientation=null),this._setMaterial(q)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(q){this._unIndexed!==q&&(this._unIndexed=q,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(q){this._instanceDataStorage.manualUpdate=q}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(q){this._instanceDataStorage.previousManualUpdate=q}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(q){this._instanceDataStorage.forceMatrixUpdates=q}_copySource(q,f){let j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const g=this.eq();if(q._geometry&&q._geometry.Yq(this),h.e.DeepCopy(q,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","wf","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","Sz","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=q,g.useClonedMeshMap&&(q._internalMeshDataInfo.meshMap||(q._internalMeshDataInfo.meshMap={}),q._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=q._originalBuilderSideOrientation,this._creationDataStorage=q._creationDataStorage,q._ranges){const f=q._ranges;for(const q in f)Object.prototype.hasOwnProperty.call(f,q)&&f[q]&&this.createAnimationRange(q,f[q].from,f[q].to)}if(q.metadata&&q.metadata.clone?this.metadata=q.metadata.clone():this.metadata=q.metadata,this._internalMetadata=q._internalMetadata,L.c&&L.c.HasTags(q)&&L.c.AddTagsTo(this,L.c.GetTags(q,!0)),this.DH(q.isEnabled(!1)),this.parent=q.parent,this.setPivotMatrix(q.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+q.id,this.material=q.material,!f){const g=q.getDescendants(!0);for(let q=0;q<g.length;q++){const h=g[q];h._isMesh?(v.parent=this,v.doNotCloneChildren=f,v.clonePhysicsImpostor=j,v.cloneThinInstances=d,h.clone(this.name+"."+h.name,v)):h.clone&&h.clone(this.name+"."+h.name,this)}}if(q.morphTargetManager&&(this.morphTargetManager=q.morphTargetManager),g.getPhysicsEngine){const f=g.getPhysicsEngine();if(j&&f)if(1===f.getPluginVersion()){const j=f.getImpostorForPhysicsObject(q);j&&(this.physicsImpostor=j.clone(this))}else 2===f.getPluginVersion()&&q.physicsBody&&q.physicsBody.clone(this)}for(let h=0;h<g.ez.length;h++){const f=g.ez[h];f.k===q&&f.clone(f.name,this)}if(this.skeleton=q.skeleton,d&&(q._thinInstanceDataStorage.matrixData?(this.kX("matrix",new Float32Array(q._thinInstanceDataStorage.matrixData),16,!q._thinInstanceDataStorage.matrixBuffer.isUpdatable()),this._thinInstanceDataStorage.matrixBufferSize=q._thinInstanceDataStorage.matrixBufferSize,this._thinInstanceDataStorage.instancesCount=q._thinInstanceDataStorage.instancesCount):this._thinInstanceDataStorage.matrixBufferSize=q._thinInstanceDataStorage.matrixBufferSize,q._userThinInstanceBuffersStorage)){const f=q._userThinInstanceBuffersStorage;for(const q in f.data){var Q,H;this.kX(q,new Float32Array(f.data[q]),f.strides[q],!(null!==(Q=f.vertexBuffers)&&void 0!==Q&&null!==(H=Q[q])&&void 0!==H&&H.isUpdatable())),this._userThinInstanceBuffersStorage.sizes[q]=f.sizes[q]}}this.refreshBoundingInfo(!0,!0),this.Nf(!0)}constructor(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4?arguments[4]:void 0,L=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(q,f),this._internalMeshDataInfo=new Y,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new W,this._thinInstanceDataStorage=new U,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=F.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,f=this.eq(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(q,f,j)=>{q&&j&&(this._uniformBuffer?this.transferToEffect(f):j.bindOnlyWorldMatrix(f))};let Q=null,H=!1;if(j&&void 0===j._addToSceneRootNodes){const q=j;Q=q.parent??null,g=q.source??null,h=q.doNotCloneChildren??!1,L=q.clonePhysicsImpostor??!0,H=q.cloneThinInstances??!1}else Q=j;g&&this._copySource(g,h,L,H),null!==Q&&(this.parent=Q),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=q=>{q.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new d.d(this._internalMeshDataInfo._onMeshReadyObserverAdded),g&&g.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,f=arguments.length>1?arguments[1]:void 0,j=arguments.length>2?arguments[2]:void 0;const d=0===this.getTotalVertices()||f&&f.doNotInstantiate&&(!0===f.doNotInstantiate||f.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),q||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));d.parent=q||this.parent,d.position=this.position.clone(),d.Vf=this.Vf.clone(),this.rotationQuaternion?d.rotationQuaternion=this.rotationQuaternion.clone():d.rotation=this.rotation.clone(),j&&j(this,d);for(const g of this.getChildTransformNodes(!0))"InstancedMesh"===g.getClassName()&&"Mesh"===d.getClassName()&&g.sourceMesh===this?g.instantiateHierarchy(d,{doNotInstantiate:f&&f.doNotInstantiate||!1,newSourcedMesh:d},j):g.instantiateHierarchy(d,f,j);return d}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(q){let f=super.toString(q);if(f+=", n vertices: "+this.getTotalVertices(),f+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let j=0;j<this.animations.length;j++)f+=", animation[0]: "+this.animations[j].toString(q);if(q)if(this._geometry){const q=this.sf(),j=this.getVerticesData(z.i.PositionKind);j&&q&&(f+=", flat shading: "+(j.length/3===q.length?"YES":"NO"))}else f+=", flat shading: UNKNOWN";return f}_unBindEffect(){super._unBindEffect();for(const q of this.instances)q._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const q=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((f,j)=>f.distanceOrScreenCoverage<j.distanceOrScreenCoverage?q:f.distanceOrScreenCoverage>j.distanceOrScreenCoverage?-q:0))}addLODLevel(q,f){if(f&&f._masterMesh)return s.e.Warn("You cannot use a mesh as LOD level twice"),this;const j=new I(q,f);return this._internalMeshDataInfo._LODLevels.push(j),f&&(f._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(q){const f=this._internalMeshDataInfo;for(let j=0;j<f._LODLevels.length;j++){const d=f._LODLevels[j];if(d.distanceOrScreenCoverage===q)return d.mesh}return null}removeLODLevel(q){const f=this._internalMeshDataInfo;for(let j=0;j<f._LODLevels.length;j++)f._LODLevels[j].mesh===q&&(f._LODLevels.splice(j,1),q&&(q._masterMesh=null));return this._sortLODLevels(),this}getLOD(q,f){const j=this._internalMeshDataInfo;if(!j._LODLevels||0===j._LODLevels.length)return this;const d=f||this.getBoundingInfo().boundingSphere,g=q.mode===H.d.ORTHOGRAPHIC_CAMERA?q.gd:d.centerWorld.ej(q.globalPosition).length();let h=g,L=1;if(j._useLODScreenCoverage){const f=q.screenArea;let j=d.radiusWorld*q.gd/g;j=j*j*Math.PI,h=j/f,L=-1}if(L*j._LODLevels[j._LODLevels.length-1].distanceOrScreenCoverage>L*h)return this.onLODLevelSelection&&this.onLODLevelSelection(h,this,this),this;for(let Q=0;Q<j._LODLevels.length;Q++){const q=j._LODLevels[Q];if(L*q.distanceOrScreenCoverage<L*h){if(q.mesh){if(4===q.mesh.delayLoadState)return q.mesh._checkDelayState(),this;if(2===q.mesh.delayLoadState)return this;q.mesh._preActivate(),q.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(h,this,q.mesh),q.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(h,this,this),this}get wf(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(q,f,j,d){var g,h;if(!this._geometry)return null;let L=d||null===(g=this._userInstancedBuffersStorage)||void 0===g||null===(h=g.vertexBuffers[q])||void 0===h?void 0:h.getFloatData(this.instances.length+1,j||f&&1!==this._geometry.meshes.length);return L||(L=this._geometry.getVerticesData(q,f,j)),L}copyVerticesData(q,f){this._geometry&&this._geometry.copyVerticesData(q,f)}getVertexBuffer(q,f){var j;return this._geometry?(f||null===(j=this._userInstancedBuffersStorage)||void 0===j?void 0:j.vertexBuffers[q])??this._geometry.getVertexBuffer(q):null}isVerticesDataPresent(q,f){var j;return this._geometry?!f&&void 0!==(null===(j=this._userInstancedBuffersStorage)||void 0===j?void 0:j.vertexBuffers[q])||this._geometry.isVerticesDataPresent(q):!!this._delayInfo&&-1!==this._delayInfo.indexOf(q)}isVertexBufferUpdatable(q,f){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(q);if(!f){var j;const f=null===(j=this._userInstancedBuffersStorage)||void 0===j?void 0:j.vertexBuffers[q];if(f)return f.isUpdatable()}return this._geometry.isVertexBufferUpdatable(q)}getVerticesDataKinds(q){if(!this._geometry){const q=[];if(this._delayInfo)for(const f of this._delayInfo)q.push(f);return q}const f=this._geometry.getVerticesDataKinds();if(!q&&this._userInstancedBuffersStorage)for(const j in this._userInstancedBuffersStorage.vertexBuffers)-1===f.indexOf(j)&&f.push(j);return f}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}sf(q,f){return this._geometry?this._geometry.sf(q,f):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(q))return!1;if(!this.Qd||0===this.Qd.length)return!0;if(!q)return!0;const j=this.getEngine(),d=this.eq(),g=f||j.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.Nf();const h=this.material||d.defaultMaterial;if(h)if(h._storeEffectOnSubMeshes)for(const z of this.Qd){const q=z.bq();if(q)if(q._storeEffectOnSubMeshes){if(!q.isReadyForSubMesh(this,z,g))return!1}else if(!q.isReady(this,g))return!1}else if(!h.isReady(this,g))return!1;const L=j.currentRenderPassId;for(const z of this.lightSources){const q=z.getShadowGenerators();if(!q)continue;const f=q.values();for(let d=f.next();!0!==d.done;d=f.next()){var Q,H,r,u;const q=d.value;if(q&&(null===(Q=q.getShadowMap())||void 0===Q||!Q.renderList||null!==(H=q.getShadowMap())&&void 0!==H&&H.renderList&&-1!==(null===(r=q.getShadowMap())||void 0===r||null===(u=r.renderList)||void 0===u?void 0:u.indexOf(this)))){const f=q.getShadowMap().renderPassIds??[j.currentRenderPassId];for(let d=0;d<f.length;++d){j.currentRenderPassId=f[d];for(const f of this.Qd){var X;if(!q.isReady(f,g,(null===(X=f.bq())||void 0===X?void 0:X.needAlphaBlendingForMesh(this))??!1))return j.currentRenderPassId=L,!1}}j.currentRenderPassId=L}}}for(const z of this._internalMeshDataInfo._LODLevels)if(z.mesh&&!z.mesh.isReady(g))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}Cu(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(q){this._instanceDataStorage.overridenInstanceCount=q}_preActivate(){const q=this._internalMeshDataInfo,f=this.eq().getRenderId();return q._preActivateId===f||(q._preActivateId=f,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(q){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=q),this}_registerInstanceForRenderId(q,f){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:f,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[f]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=f,this._instanceDataStorage.visibleInstances[f]=new Array),this._instanceDataStorage.visibleInstances[f].push(q),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.vq||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let q,f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;q="object"===typeof f?f:{applySkeleton:f,applyMorph:j};const d=this.wf?this.wf.boundingBias:null;return this.Mq(this._getData(q,null,z.i.PositionKind),d),this}_createGlobalSubMesh(q){const f=this.getTotalVertices();if(!f||!this.sf())return null;if(this.Qd&&this.Qd.length>0){const j=this.sf();if(!j)return null;const d=j.length;let g=!1;if(q)g=!0;else for(const q of this.Qd){if(q.indexStart+q.indexCount>d){g=!0;break}if(q.verticesStart+q.verticesCount>f){g=!0;break}}if(!g)return this.Qd[0]}return this.releaseSubMeshes(),new t.d(0,0,f,0,this.getTotalIndices()||f,this)}subdivide(q){if(q<1)return;const f=this.getTotalIndices();let j=f/q|0,d=0;for(;j%3!==0;)j++;this.releaseSubMeshes();for(let g=0;g<q&&!(d>=f);g++)t.d.CreateFromIndices(0,d,g===q-1?f-d:j,this,void 0,!1),d+=j;this.refreshBoundingInfo(),this.synchronizeInstances()}oq(q,f){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.oq(q,f,j,d);else{const d=new B.e;d.set(f,q);const g=this.eq();new D.e(D.e.RandomId(),g,d,j,this)}return this}removeVerticesData(q){this._geometry&&this._geometry.removeVerticesData(q)}markVerticesDataAsUpdatable(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const j=this.getVertexBuffer(q);j&&j.isUpdatable()!==f&&this.oq(q,this.getVerticesData(q),f)}setVerticesBuffer(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=D.e.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(q,null,f),this}updateVerticesData(q,f,j,d){return this._geometry?(d?(this.makeGeometryUnique(),this.updateVerticesData(q,f,j,!1)):this._geometry.updateVerticesData(q,f,j),this):this}updateMeshPositions(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const j=this.getVerticesData(z.i.PositionKind);if(!j)return this;if(q(j),this.updateVerticesData(z.i.PositionKind,j,!1,!1),f){const q=this.sf(),f=this.getVerticesData(z.i.NormalKind);if(!f)return this;B.e.ComputeNormals(j,q,f),this.updateVerticesData(z.i.NormalKind,f,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const q=this._geometry,f=this._geometry.i(D.e.RandomId());return q.releaseForMesh(this,!0),f.Yq(this),this}setIndexBuffer(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,g=this._geometry;g||(g=new D.e(D.e.RandomId(),this.eq(),void 0,void 0,this)),g.setIndexBuffer(q,f,j,d)}setIndices(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(q,f,j,d);else{const f=new B.e;f.indices=q;const d=this.eq();new D.e(D.e.RandomId(),d,f,j,this)}return this}updateIndices(q,f){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(q,f,j),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(q,f,j){let d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const g=this.eq().getEngine();let h;if(this._unIndexed)if(this._getRenderingFillMode(j)===O.b.WireFrameFillMode)h=q._getLinesIndexBuffer(this.sf(),g);else h=null;else switch(this._getRenderingFillMode(j)){case O.b.PointFillMode:h=null;break;case O.b.WireFrameFillMode:h=q._getLinesIndexBuffer(this.sf(),g);break;default:case O.b.TriangleFillMode:h=this._geometry.getIndexBuffer()}return this._bindDirect(f,h,d)}_bindDirect(q,f){let j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(q),j&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(q,f,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(q,f),this):this}_draw(q,f,j){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const d=this.eq().getEngine();return this._unIndexed&&f!==O.b.WireFrameFillMode||f==O.b.PointFillMode?d.drawArraysType(f,q.verticesStart,q.verticesCount,this.forcedInstanceCount||j):f==O.b.WireFrameFillMode?d.drawElementsType(f,0,q._linesIndexCount,this.forcedInstanceCount||j):d.drawElementsType(f,q.indexStart,q.indexCount,this.forcedInstanceCount||j),this}registerBeforeRender(q){return this.onBeforeRenderObservable.add(q),this}unregisterBeforeRender(q){return this.onBeforeRenderObservable.removeCallback(q),this}registerAfterRender(q){return this.onAfterRenderObservable.add(q),this}unregisterAfterRender(q){return this.onAfterRenderObservable.removeCallback(q),this}_getInstancesRenderList(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(f)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[q]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[q]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const j=this.eq(),d=j._isInIntermediateRendering(),g=d?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,h=this._instanceDataStorage.batchCache;if(h.mustReturn=!1,h.renderSelf[q]=f||!g&&this.isEnabled()&&this.isVisible,h.visibleInstances[q]=null,this._instanceDataStorage.visibleInstances&&!f){const f=this._instanceDataStorage.visibleInstances,g=j.getRenderId(),L=d?f.intermediateDefaultRenderId:f.defaultRenderId;h.visibleInstances[q]=f[g],!h.visibleInstances[q]&&L&&(h.visibleInstances[q]=f[L])}return h.hardwareInstancedRendering[q]=!f&&this._instanceDataStorage.hardwareInstancedRendering&&null!==h.visibleInstances[q]&&void 0!==h.visibleInstances[q],this._instanceDataStorage.previousBatch=h,h}_updateInstancedBuffers(q,f,j,d,g,h){const L=f.visibleInstances[q._id],Q=L?L.length:0,H=this._instanceDataStorage;let u=H.instancesBuffer,X=H.instancesPreviousBuffer,B=0,D=0;const i=f.renderSelf[q._id],t=!u||j!==H.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!H.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||H.isFrozen&&!t)D=(i?1:0)+Q;else{const f=this.getWorldMatrix();if(i&&(this._scene.needsPreviousWorldMatrices&&(H.masterMeshPreviousWorldMatrix?(H.masterMeshPreviousWorldMatrix.copyToArray(H.instancesPreviousData,B),H.masterMeshPreviousWorldMatrix.H(f)):(H.masterMeshPreviousWorldMatrix=f.clone(),H.masterMeshPreviousWorldMatrix.copyToArray(H.instancesPreviousData,B))),f.copyToArray(H.instancesData,B),B+=16,D++),L){var O;if(F.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(O=q.bq())&&void 0!==O&&O.needAlphaBlendingForMesh(q.getRenderingMesh())){const q=this._scene.activeCamera.globalPosition;for(let f=0;f<L.length;f++){const j=L[f];j._distanceToCamera=r.j.Distance(j.getBoundingInfo().boundingSphere.centerWorld,q)}L.sort(((q,f)=>q._distanceToCamera>f._distanceToCamera?-1:q._distanceToCamera<f._distanceToCamera?1:0))}for(let q=0;q<L.length;q++){const f=L[q],j=f.getWorldMatrix();j.copyToArray(H.instancesData,B),this._scene.needsPreviousWorldMatrices&&(f._previousWorldMatrix?(f._previousWorldMatrix.copyToArray(H.instancesPreviousData,B),f._previousWorldMatrix.H(j)):(f._previousWorldMatrix=j.clone(),f._previousWorldMatrix.copyToArray(H.instancesPreviousData,B))),B+=16,D++}}}t?(u&&u.dispose(),X&&X.dispose(),u=new z.e(d,H.instancesData,!0,16,!1,!0),H.instancesBuffer=u,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=u.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=u.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=u.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=u.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(X=new z.e(d,H.instancesPreviousData,!0,16,!1,!0),H.instancesPreviousBuffer=X,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=X.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=X.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=X.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=X.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(u.updateDirectly(H.instancesData,0,D),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||X.updateDirectly(H.instancesPreviousData,0,D)),this._processInstancedBuffers(L,i),h&&void 0!==g&&(this.eq()._activeIndices.addCount(q.indexCount*D,!1),d._currentDrawContext&&(d._currentDrawContext.useInstancing=!0),this._bind(q,h,g),this._draw(q,g,D)),!this._scene.needsPreviousWorldMatrices||t||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||X.updateDirectly(H.instancesData,0,D)}_renderWithInstances(q,f,j,d,g){const h=j.visibleInstances[q._id],L=h?h.length:0,Q=this._instanceDataStorage,H=Q.instancesBufferSize,r=16*(L+1)*4;for(;Q.instancesBufferSize<r;)Q.instancesBufferSize*=2;return Q.instancesData&&H==Q.instancesBufferSize||(Q.instancesData=new Float32Array(Q.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!Q.instancesPreviousData||H!=Q.instancesBufferSize)&&(Q.instancesPreviousData=new Float32Array(Q.instancesBufferSize/4)),this._updateInstancedBuffers(q,j,H,g,f,d),g.unbindInstanceAttributes(),this}_renderWithThinInstances(q,f,j,d){var g;const h=(null===(g=this._thinInstanceDataStorage)||void 0===g?void 0:g.instancesCount)??0;this.eq()._activeIndices.addCount(q.indexCount*h,!1),d._currentDrawContext&&(d._currentDrawContext.useInstancing=!0),this._bind(q,j,f),this._draw(q,f,h),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,h):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),d.unbindInstanceAttributes()}_processInstancedBuffers(q,f){}_processRendering(q,f,j,d,g,h,L,Q){const H=this.eq(),r=H.getEngine();if(d=this._getRenderingFillMode(d),h&&f.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(f,d,j,r),this;if(h)this._renderWithInstances(f,d,g,j,r);else{r._currentDrawContext&&(r._currentDrawContext.useInstancing=!1);let j=0;g.renderSelf[f._id]&&(L&&L(!1,q.getWorldMatrix(),Q),j++,this._draw(f,d,this._instanceDataStorage.overridenInstanceCount));const h=g.visibleInstances[f._id];if(h){const q=h.length;j+=q;for(let j=0;j<q;j++){const q=h[j].getWorldMatrix();L&&L(!0,q,Q),this._draw(f,d)}}H._activeIndices.addCount(f.indexCount*j,!1)}return this}_rebuild(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(q&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const f in this._userInstancedBuffersStorage.vertexBuffers){const j=this._userInstancedBuffersStorage.vertexBuffers[f];j&&(q&&j.dispose(),this._userInstancedBuffersStorage.vertexBuffers[f]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(q)}_freeze(){if(this.Qd){for(let q=0;q<this.Qd.length;q++)this._getInstancesRenderList(q);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(q,f,j,d){let g=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const h=this._scene.getEngine(),L=h.currentRenderPassId;if(void 0!==q&&(h.currentRenderPassId=q),d)(!g||g&&d.isInFrustum(this._scene._frustumPlanes))&&this.render(d,!!f,j);else for(let Q=0;Q<this.Qd.length;Q++){const q=this.Qd[Q];(!g||g&&q.isInFrustum(this._scene._frustumPlanes))&&this.render(q,!!f,j)}return void 0!==q&&(h.currentRenderPassId=L),this}directRender(){if(!this.Qd)return this;for(const q of this.Qd)this.render(q,!1);return this}render(q,f,j){var d,g,h;const L=this.eq();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const Q=(null===(d=L.activeCameras)||void 0===d?void 0:d.length)??0;if((Q>1&&L.activeCamera===L.activeCameras[0]||Q<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const H=this._getInstancesRenderList(q._id,!!j);if(H.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const r=L.getEngine();let u=0,X=null;this.ignoreCameraMaxZ&&L.activeCamera&&!L._isInIntermediateRendering()&&(u=L.activeCamera.maxZ,X=L.activeCamera,L.activeCamera.maxZ=0,L.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const z=q.getRenderingMesh(),B=H.hardwareInstancedRendering[q._id]||z.hasThinInstances||!!this._userInstancedBuffersStorage&&!q.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,D=this._instanceDataStorage,i=q.bq();if(!i)return X&&(X.maxZ=u,L.updateTransformMatrix(!0)),this;if(D.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===i){if(i._storeEffectOnSubMeshes&&(null===(g=q._drawWrapper)||void 0===g||!g._wasPreviouslyReady)||!i._storeEffectOnSubMeshes&&!i._getDrawWrapper()._wasPreviouslyReady)return X&&(X.maxZ=u,L.updateTransformMatrix(!0)),this}else{if(i._storeEffectOnSubMeshes){if(!i.isReadyForSubMesh(this,q,B))return X&&(X.maxZ=u,L.updateTransformMatrix(!0)),this}else if(!i.isReady(this,B))return X&&(X.maxZ=u,L.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=i}let t;f&&r.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),t=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?q._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const N=(null===(h=t)||void 0===h?void 0:h.effect)??null;for(const O of L._beforeRenderingMeshStage)O.action(this,q,H,N);if(!t||!N)return X&&(X.maxZ=u,L.updateTransformMatrix(!0)),this;const w=j||this;let E;if(D.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.ef&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)E=D.sideOrientation;else{const q=w._getWorldMatrixDeterminant();E=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),q<0&&(E=E===O.b.ClockWiseSideOrientation?O.b.CounterClockWiseSideOrientation:O.b.ClockWiseSideOrientation),D.sideOrientation=E}const s=this._internalMeshDataInfo._effectiveMaterial._preBind(t,E);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&r.setDepthWrite(!0);const S=this._internalMeshDataInfo._effectiveMaterial,e=S.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),B||this._bind(q,N,e,!1);const Z=w.getWorldMatrix();S._storeEffectOnSubMeshes?S.bindForSubMesh(Z,this,q):S.bind(Z,this),!S.ef&&S.separateCullingPass&&(r.setState(!0,S.zOffset,!1,!s,S.cullBackFaces,S.stencil,S.zOffsetUnits),this._processRendering(this,q,N,e,H,B,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),r.setState(!0,S.zOffset,!1,s,S.cullBackFaces,S.stencil,S.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(q)),this._processRendering(this,q,N,e,H,B,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const O of L._afterRenderingMeshStage)O.action(this,q,H,N);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),X&&(X.maxZ=u,L.updateTransformMatrix(!0)),2!==L.performancePriority||D.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(z.i.MatricesWeightsKind)&&(this.isVerticesDataPresent(z.i.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const q=this.getVerticesData(z.i.MatricesWeightsKind),f=q.length;for(let j=0;j<f;j+=4){const f=q[j]+q[j+1]+q[j+2]+q[j+3];if(0===f)q[j]=1;else{const d=1/f;q[j]*=d,q[j+1]*=d,q[j+2]*=d,q[j+3]*=d}}this.oq(z.i.MatricesWeightsKind,q)}_normalizeSkinWeightsAndExtra(){const q=this.getVerticesData(z.i.MatricesWeightsExtraKind),f=this.getVerticesData(z.i.MatricesWeightsKind),j=f.length;for(let d=0;d<j;d+=4){let j=f[d]+f[d+1]+f[d+2]+f[d+3];if(j+=q[d]+q[d+1]+q[d+2]+q[d+3],0===j)f[d]=1;else{const g=1/j;f[d]*=g,f[d+1]*=g,f[d+2]*=g,f[d+3]*=g,q[d]*=g,q[d+1]*=g,q[d+2]*=g,q[d+3]*=g}}this.oq(z.i.MatricesWeightsKind,f),this.oq(z.i.MatricesWeightsKind,q)}validateSkinning(){const q=this.getVerticesData(z.i.MatricesWeightsExtraKind),f=this.getVerticesData(z.i.MatricesWeightsKind);if(null===f||null==this.skeleton)return{skinned:!1,valid:!0,Oi:"not skinned"};const j=f.length;let d=0,g=0,h=0,L=0;const Q=null===q?4:8,H=[];for(let z=0;z<=Q;z++)H[z]=0;for(let z=0;z<j;z+=4){let j=f[z],r=j,u=0===r?0:1;for(let g=1;g<Q;g++){const h=g<4?f[z+g]:q[z+g-4];h>j&&d++,0!==h&&u++,r+=h,j=h}if(H[u]++,u>h&&(h=u),0===r)g++;else{const j=1/r;let d=0;for(let g=0;g<Q;g++)d+=g<4?Math.abs(f[z+g]-f[z+g]*j):Math.abs(q[z+g-4]-q[z+g-4]*j);d>.001&&L++}}const r=this.skeleton.bones.length,u=this.getVerticesData(z.i.MatricesIndicesKind),X=this.getVerticesData(z.i.MatricesIndicesExtraKind);let B=0;for(let z=0;z<j;z+=4)for(let q=0;q<Q;q++){const f=q<4?u[z+q]:X[z+q-4];(f>=r||f<0)&&B++}return{skinned:!0,valid:0===g&&0===L&&0===B,Oi:"Number of Weights = "+j/4+"\nMaximum influences = "+h+"\nMissing Weights = "+g+"\nNot Sorted = "+d+"\nNot Normalized = "+L+"\nWeightCounts = ["+H+"]\nNumber of bones = "+r+"\nBad Bone Indices = "+B}}_checkDelayState(){const q=this.eq();return this._geometry?this._geometry.load(q):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(q)),this}_queueLoad(q){q.addPendingData(this);const f=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return g.h.LoadFile(this.delayLoadingFile,(f=>{f instanceof ArrayBuffer?this._delayLoadingFunction(f,this):this._delayLoadingFunction(JSON.parse(f),this);for(const q of this.instances)q.refreshBoundingInfo(),q._syncSubMeshes();this.delayLoadState=1,q.removePendingData(this)}),(()=>{}),q.offlineProvider,f),this}isInFrustum(q){return 2!==this.delayLoadState&&(!!super.isInFrustum(q)&&(this._checkDelayState(),!0))}setMaterialById(q){const f=this.eq().materials;let j;for(j=f.length-1;j>-1;j--)if(f[j].id===q)return this.material=f[j],this;const d=this.eq().multiMaterials;for(j=d.length-1;j>-1;j--)if(d[j].id===q)return this.material=d[j],this;return this}getAnimatables(){const q=[];return this.material&&q.push(this.material),this.skeleton&&q.push(this.skeleton),q}bakeTransformIntoVertices(q){if(!this.isVerticesDataPresent(z.i.PositionKind))return this;const f=this.Qd.splice(0);this._resetPointsArrayCache();let j=this.getVerticesData(z.i.PositionKind);const d=r.j.Zero();let g;for(g=0;g<j.length;g+=3)r.j.TransformCoordinatesFromFloatsToRef(j[g],j[g+1],j[g+2],q,d).toArray(j,g);if(this.oq(z.i.PositionKind,j,this.getVertexBuffer(z.i.PositionKind).isUpdatable()),this.isVerticesDataPresent(z.i.NormalKind)){for(j=this.getVerticesData(z.i.NormalKind),g=0;g<j.length;g+=3)r.j.TransformNormalFromFloatsToRef(j[g],j[g+1],j[g+2],q,d).normalize().toArray(j,g);this.oq(z.i.NormalKind,j,this.getVertexBuffer(z.i.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(z.i.TangentKind)){for(j=this.getVerticesData(z.i.TangentKind),g=0;g<j.length;g+=4)r.j.TransformNormalFromFloatsToRef(j[g],j[g+1],j[g+2],q,d).normalize().toArray(j,g);this.oq(z.i.TangentKind,j,this.getVertexBuffer(z.i.TangentKind).isUpdatable())}return q.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.Qd=f,this}bakeCurrentTransformIntoVertices(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&this.makeGeometryUnique(),this.bakeTransformIntoVertices(this.Nf(!0)),this.resetLocalMatrix(q),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2?arguments[2]:void 0,d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(f&&void 0===f._addToSceneRootNodes){const j=f;return v.source=this,v.doNotCloneChildren=j.doNotCloneChildren,v.clonePhysicsImpostor=j.clonePhysicsImpostor,v.cloneThinInstances=j.cloneThinInstances,new F(q,this.eq(),v)}return new F(q,this.eq(),f,this,j,d)}dispose(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const j=this._internalMeshDataInfo;if(j._onBeforeDrawObservable&&j._onBeforeDrawObservable.clear(),j._onBeforeBindObservable&&j._onBeforeBindObservable.clear(),j._onBeforeRenderObservable&&j._onBeforeRenderObservable.clear(),j._onAfterRenderObservable&&j._onAfterRenderObservable.clear(),j._onBetweenPassObservable&&j._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(j.meshMap)for(const q in j.meshMap){const f=j.meshMap[q];f&&(f._internalMeshDataInfo._source=null,j.meshMap[q]=void 0)}j._source&&j._source._internalMeshDataInfo.meshMap&&(j._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const q=this.eq().meshes;for(const f of q){const q=f;q._internalMeshDataInfo&&q._internalMeshDataInfo._source&&q._internalMeshDataInfo._source===this&&(q._internalMeshDataInfo._source=null)}}j._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(q,f)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(q,f,j,d,h,L){let Q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],H=arguments.length>7?arguments[7]:void 0;const r=this.eq();return g.h.LoadImage(q,(q=>{const g=q.width,H=q.height,r=this.getEngine().createCanvas(g,H).getContext("2d");r.drawImage(q,0,0);const u=r.getImageData(0,0,g,H).data;this.applyDisplacementMapFromBuffer(u,g,H,f,j,h,L,Q),d&&d(this)}),H||(()=>{}),r.offlineProvider),this}applyDisplacementMapFromBuffer(q,f,j,d,g,h,L){let Q=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(z.i.PositionKind)||!this.isVerticesDataPresent(z.i.NormalKind)||!this.isVerticesDataPresent(z.i.UVKind))return s.e.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const H=this.getVerticesData(z.i.PositionKind,!0,!0),u=this.getVerticesData(z.i.NormalKind),X=this.getVerticesData(z.i.UVKind);let D=r.j.Zero();const i=r.j.Zero(),t=r.i.Zero();h=h||r.i.Zero(),L=L||new r.i(1,1);for(let z=0;z<H.length;z+=3){r.j.FromArrayToRef(H,z,D),r.j.FromArrayToRef(u,z,i),r.i.FromArrayToRef(X,z/3*2,t);const Q=4*((Math.abs(t.x*L.x+h.x%1)*(f-1)%f|0)+(Math.abs(t.y*L.y+h.y%1)*(j-1)%j|0)*f),B=.3*(q[Q]/255)+.59*(q[Q+1]/255)+.11*(q[Q+2]/255);i.normalize(),i.scaleInPlace(d+(g-d)*B),D=D.add(i),D.toArray(H,z)}return B.e.ComputeNormals(H,this.sf(),u),Q?(this.oq(z.i.PositionKind,H),this.oq(z.i.NormalKind,u),this.oq(z.i.UVKind,X)):(this.updateVerticesData(z.i.PositionKind,H),this.updateVerticesData(z.i.NormalKind,u)),this}_getFlattenedNormals(q,f){const j=new Float32Array(3*q.length);let d=0;const g=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let h=0;h<q.length;h+=3){const L=r.j.Pf(f,3*q[h]),Q=r.j.Pf(f,3*q[h+1]),H=r.j.Pf(f,3*q[h+2]),u=L.ej(Q),X=H.ej(Q),z=r.j.Normalize(r.j.Cross(u,X));g&&z.scaleInPlace(-1);for(let q=0;q<3;q++)j[d++]=z.x,j[d++]=z.y,j[d++]=z.z}return j}_convertToUnIndexedMesh(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const f=this.getVerticesDataKinds().filter((q=>{var f;return!(null!==(f=this.getVertexBuffer(q))&&void 0!==f&&f.getIsInstanced())})),j=this.sf(),d={},g=(q,f)=>{const d=new Float32Array(j.length*f);let g=0;for(let h=0;h<j.length;h++)for(let L=0;L<f;L++)d[g++]=q[j[h]*f+L];return d},h=this.getBoundingInfo(),L=this.wf?this.Qd.slice(0):[];for(const Q of f)d[Q]=this.getVerticesData(Q);for(const Q of f){const f=this.getVertexBuffer(Q),h=f.getSize();if(q&&Q===z.i.NormalKind){const q=this._getFlattenedNormals(j,d[z.i.PositionKind]);this.oq(z.i.NormalKind,q,f.isUpdatable(),h)}else this.oq(Q,g(d[Q],h),f.isUpdatable(),h)}if(this.morphTargetManager){for(let f=0;f<this.morphTargetManager.numTargets;f++){const d=this.morphTargetManager.getTarget(f),h=d.getPositions();d.setPositions(g(h,3));const L=d.getNormals();L&&d.setNormals(q?this._getFlattenedNormals(j,h):g(L,3));const Q=d.getTangents();Q&&d.setTangents(g(Q,3));const H=d.getUVs();H&&d.setUVs(g(H,2));const r=d.getColors();r&&d.setColors(g(r,4))}this.morphTargetManager.synchronize()}for(let Q=0;Q<j.length;Q++)j[Q]=Q;this.setIndices(j),this._unIndexed=!0,this.releaseSubMeshes();for(const Q of L){const q=Q.getBoundingInfo();t.d.AddToMesh(Q.materialIndex,Q.indexStart,Q.indexCount,Q.indexStart,Q.indexCount,this).setBoundingInfo(q)}return this.setBoundingInfo(h),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const f=B.e.ExtractFromMesh(this);let j;if(q&&this.isVerticesDataPresent(z.i.NormalKind)&&f.Tq){for(j=0;j<f.Tq.length;j++)f.Tq[j]*=-1;this.oq(z.i.NormalKind,f.Tq,this.isVertexBufferUpdatable(z.i.NormalKind))}if(f.indices){let q;for(j=0;j<f.indices.length;j+=3)q=f.indices[j+1],f.indices[j+1]=f.indices[j+2],f.indices[j+2]=q;this.setIndices(f.indices,null,this.isVertexBufferUpdatable(z.i.PositionKind),!0)}return this}increaseVertices(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const f=B.e.ExtractFromMesh(this),j=f.indices&&!Array.isArray(f.indices)&&Array.from?Array.from(f.indices):f.indices,d=f.Iq&&!Array.isArray(f.Iq)&&Array.from?Array.from(f.Iq):f.Iq,g=f.nq&&!Array.isArray(f.nq)&&Array.from?Array.from(f.nq):f.nq,h=f.Tq&&!Array.isArray(f.Tq)&&Array.from?Array.from(f.Tq):f.Tq;if(j&&d){f.indices=j,f.Iq=d,g&&(f.nq=g),h&&(f.Tq=h);const L=q+1,Q=[];for(let q=0;q<L+1;q++)Q[q]=[];let H,u;const X=new r.j(0,0,0),B=new r.j(0,0,0),D=new r.i(0,0),i=[],t=[],O=[];let N,w,E,s=d.length;g&&(w=g.length),h&&(E=h.length);for(let q=0;q<j.length;q+=3){t[0]=j[q],t[1]=j[q+1],t[2]=j[q+2];for(let q=0;q<3;q++)if(H=t[q],u=t[(q+1)%3],void 0===O[H]&&void 0===O[u]?(O[H]=[],O[u]=[]):(void 0===O[H]&&(O[H]=[]),void 0===O[u]&&(O[u]=[])),void 0===O[H][u]&&void 0===O[u][H]){O[H][u]=[],X.x=(d[3*u]-d[3*H])/L,X.y=(d[3*u+1]-d[3*H+1])/L,X.z=(d[3*u+2]-d[3*H+2])/L,h&&(B.x=(h[3*u]-h[3*H])/L,B.y=(h[3*u+1]-h[3*H+1])/L,B.z=(h[3*u+2]-h[3*H+2])/L),g&&(D.x=(g[2*u]-g[2*H])/L,D.y=(g[2*u+1]-g[2*H+1])/L),O[H][u].push(H);for(let q=1;q<L;q++)O[H][u].push(d.length/3),d[s++]=d[3*H]+q*X.x,d[s++]=d[3*H+1]+q*X.y,d[s++]=d[3*H+2]+q*X.z,h&&(h[E++]=h[3*H]+q*B.x,h[E++]=h[3*H+1]+q*B.y,h[E++]=h[3*H+2]+q*B.z),g&&(g[w++]=g[2*H]+q*D.x,g[w++]=g[2*H+1]+q*D.y);O[H][u].push(u),O[u][H]=[],N=O[H][u].length;for(let q=0;q<N;q++)O[u][H][q]=O[H][u][N-1-q]}Q[0][0]=j[q],Q[1][0]=O[j[q]][j[q+1]][1],Q[1][1]=O[j[q]][j[q+2]][1];for(let f=2;f<L;f++){Q[f][0]=O[j[q]][j[q+1]][f],Q[f][f]=O[j[q]][j[q+2]][f],X.x=(d[3*Q[f][f]]-d[3*Q[f][0]])/f,X.y=(d[3*Q[f][f]+1]-d[3*Q[f][0]+1])/f,X.z=(d[3*Q[f][f]+2]-d[3*Q[f][0]+2])/f,h&&(B.x=(h[3*Q[f][f]]-h[3*Q[f][0]])/f,B.y=(h[3*Q[f][f]+1]-h[3*Q[f][0]+1])/f,B.z=(h[3*Q[f][f]+2]-h[3*Q[f][0]+2])/f),g&&(D.x=(g[2*Q[f][f]]-g[2*Q[f][0]])/f,D.y=(g[2*Q[f][f]+1]-g[2*Q[f][0]+1])/f);for(let q=1;q<f;q++)Q[f][q]=d.length/3,d[s++]=d[3*Q[f][0]]+q*X.x,d[s++]=d[3*Q[f][0]+1]+q*X.y,d[s++]=d[3*Q[f][0]+2]+q*X.z,h&&(h[E++]=h[3*Q[f][0]]+q*B.x,h[E++]=h[3*Q[f][0]+1]+q*B.y,h[E++]=h[3*Q[f][0]+2]+q*B.z),g&&(g[w++]=g[2*Q[f][0]]+q*D.x,g[w++]=g[2*Q[f][0]+1]+q*D.y)}Q[L]=O[j[q+1]][j[q+2]],i.push(Q[0][0],Q[1][0],Q[1][1]);for(let q=1;q<L;q++){let f;for(f=0;f<q;f++)i.push(Q[q][f],Q[q+1][f],Q[q+1][f+1]),i.push(Q[q][f],Q[q+1][f+1],Q[q][f+1]);i.push(Q[q][f],Q[q+1][f],Q[q+1][f+1])}}f.indices=i,f.Yq(this,this.isVertexBufferUpdatable(z.i.PositionKind))}else s.e.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const q=B.e.ExtractFromMesh(this),f=q.nq,j=q.indices,d=q.Iq,g=q.Wq,h=q.matricesIndices,L=q.matricesWeights,Q=q.matricesIndicesExtra,H=q.matricesWeightsExtra;if(void 0===j||void 0===d||null===j||null===d)s.e.Warn("VertexData contains empty entries");else{const r=[],u=[],X=[],D=[],i=[],t=[],O=[],N=[];let w=[],E=0;const s={};let S,e;for(let q=0;q<j.length;q+=3){e=[j[q],j[q+1],j[q+2]],w=[];for(let q=0;q<3;q++){w[q]="";for(let f=0;f<3;f++)Math.abs(d[3*e[q]+f])<1e-8&&(d[3*e[q]+f]=0),w[q]+=d[3*e[q]+f]+"|"}if(w[0]!=w[1]&&w[0]!=w[2]&&w[1]!=w[2])for(let q=0;q<3;q++){if(S=s[w[q]],void 0===S){s[w[q]]=E,S=E++;for(let f=0;f<3;f++)r.push(d[3*e[q]+f]);if(null!==g&&void 0!==g)for(let f=0;f<4;f++)D.push(g[4*e[q]+f]);if(null!==f&&void 0!==f)for(let j=0;j<2;j++)X.push(f[2*e[q]+j]);if(null!==h&&void 0!==h)for(let f=0;f<4;f++)i.push(h[4*e[q]+f]);if(null!==L&&void 0!==L)for(let f=0;f<4;f++)t.push(L[4*e[q]+f]);if(null!==Q&&void 0!==Q)for(let f=0;f<4;f++)O.push(Q[4*e[q]+f]);if(null!==H&&void 0!==H)for(let f=0;f<4;f++)N.push(H[4*e[q]+f])}u.push(S)}}const Z=[];B.e.ComputeNormals(r,u,Z),q.Iq=r,q.indices=u,q.Tq=Z,null!==f&&void 0!==f&&(q.nq=X),null!==g&&void 0!==g&&(q.Wq=D),null!==h&&void 0!==h&&(q.matricesIndices=i),null!==L&&void 0!==L&&(q.matricesWeights=t),null!==Q&&void 0!==Q&&(q.matricesIndicesExtra=O),null!==L&&void 0!==L&&(q.matricesWeightsExtra=N),q.Yq(this,this.isVertexBufferUpdatable(z.i.PositionKind))}}static _instancedMeshFactory(q,f){throw(0,e.c)("InstancedMesh")}static _PhysicsImpostorParser(q,f,j){throw(0,e.c)("PhysicsImpostor")}createInstance(q){const f=F._instancedMeshFactory(q,this);return f.parent=this.parent,f}synchronizeInstances(){for(let q=0;q<this.instances.length;q++){this.instances[q]._syncSubMeshes()}return this}optimizeIndices(q){const f=this.sf(),j=this.getVerticesData(z.i.PositionKind);if(!j||!f)return this;const d=[];for(let g=0;g<j.length;g+=3)d.push(r.j.Pf(j,g));const h=[];return g.d.SyncAsyncForLoop(d.length,40,(q=>{const f=d.length-1-q,j=d[f];for(let g=0;g<f;++g){const q=d[g];if(j.equals(q)){h[f]=g;break}}}),(()=>{for(let q=0;q<f.length;++q)f[q]=h[f[q]]||f[q];const j=this.Qd.slice(0);this.setIndices(f),this.Qd=j,q&&q(this)})),this}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};q.name=this.name,q.id=this.id,q.uniqueId=this.uniqueId,q.type=this.getClassName(),L.c&&L.c.HasTags(this)&&(q.tags=L.c.GetTags(this)),q.position=this.position.Yf(),this.rotationQuaternion?q.rotationQuaternion=this.rotationQuaternion.Yf():this.rotation&&(q.rotation=this.rotation.Yf()),q.Vf=this.Vf.Yf(),this._postMultiplyPivotMatrix?q.pivotMatrix=this.getPivotMatrix().Yf():q.localMatrix=this.getPivotMatrix().Yf(),q.isEnabled=this.isEnabled(!1),q.isVisible=this.isVisible,q.infiniteDistance=this.infiniteDistance,q.pickable=this.Xr,q.receiveShadows=this.receiveShadows,q.billboardMode=this.billboardMode,q.visibility=this.visibility,q.Cg=this.Cg,q.checkCollisions=this.checkCollisions,q.ellipsoid=this.ellipsoid.Yf(),q.ellipsoidOffset=this.ellipsoidOffset.Yf(),q.vq=this.vq,q.isBlocker=this.isBlocker,q.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(q),q.isUnIndexed=this.isUnIndexed;const f=this._geometry;if(f&&this.Qd){q.geometryUniqueId=f.uniqueId,q.geometryId=f.id,q.Qd=[];for(let f=0;f<this.Qd.length;f++){const j=this.Qd[f];q.Qd.push({materialIndex:j.materialIndex,verticesStart:j.verticesStart,verticesCount:j.verticesCount,indexStart:j.indexStart,indexCount:j.indexCount})}}if(this.material?this.material.doNotSerialize||(q.materialUniqueId=this.material.uniqueId,q.materialId=this.material.id):(this.material=null,q.materialUniqueId=this._scene.defaultMaterial.uniqueId,q.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(q.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(q.skeletonId=this.skeleton.id,q.numBoneInfluencers=this.numBoneInfluencers),this.eq()._getComponent(Z.b.NAME_PHYSICSENGINE)){const f=this.getPhysicsImpostor();f&&(q.physicsMass=f.getParam("Wg"),q.physicsFriction=f.getParam("friction"),q.physicsRestitution=f.getParam("Wg"),q.physicsImpostor=f.type)}this.metadata&&(q.metadata=this.metadata),q.instances=[];for(let j=0;j<this.instances.length;j++){const f=this.instances[j];if(f.doNotSerialize)continue;const d={name:f.name,id:f.id,isEnabled:f.isEnabled(!1),isVisible:f.isVisible,Xr:f.Xr,checkCollisions:f.checkCollisions,position:f.position.Yf(),Vf:f.Vf.Yf()};if(f.parent&&f.parent._serializeAsParent(d),f.rotationQuaternion?d.rotationQuaternion=f.rotationQuaternion.Yf():f.rotation&&(d.rotation=f.rotation.Yf()),this.eq()._getComponent(Z.b.NAME_PHYSICSENGINE)){const q=f.getPhysicsImpostor();q&&(d.physicsMass=q.getParam("Wg"),d.physicsFriction=q.getParam("friction"),d.physicsRestitution=q.getParam("Wg"),d.physicsImpostor=q.type)}f.metadata&&(d.metadata=f.metadata),f.actionManager&&(d.actions=f.actionManager.serialize(f.name)),q.instances.push(d),E.d.AppendSerializedAnimations(f,d),d.ranges=f.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(q.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const f={data:{},sizes:{},strides:{}};for(const q in this._userThinInstanceBuffersStorage.data)f.data[q]=Array.from(this._userThinInstanceBuffersStorage.data[q]),f.sizes[q]=this._userThinInstanceBuffersStorage.sizes[q],f.strides[q]=this._userThinInstanceBuffersStorage.strides[q];q.thinInstances.userThinInstance=f}return E.d.AppendSerializedAnimations(this,q),q.ranges=this.serializeAnimationRanges(),q.layerMask=this.layerMask,q.alphaIndex=this.alphaIndex,q.hasVertexAlpha=this.hasVertexAlpha,q.overlayAlpha=this.overlayAlpha,q.overlayColor=this.overlayColor.Yf(),q.renderOverlay=this.renderOverlay,q.applyFog=this.applyFog,this.actionManager&&(q.actions=this.actionManager.serialize(this.name)),q}_syncGeometryWithMorphTargetManager(){if(!this.wf)return;this._markSubMeshesAsAttributesDirty();const q=this._internalAbstractMeshDataInfo._morphTargetManager;if(q&&q.vertexCount){if(q.vertexCount!==this.getTotalVertices())return s.e.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(q.isUsingTextureForTargets)return;for(let f=0;f<q.numInfluencers;f++){const j=q.getActiveTarget(f),d=j.getPositions();if(!d)return void s.e.Error("Invalid morph target. Target must have positions.");this.wf.oq(z.i.PositionKind+f,d,!1,3);const g=j.getNormals();g&&this.wf.oq(z.i.NormalKind+f,g,!1,3);const h=j.getTangents();h&&this.wf.oq(z.i.TangentKind+f,h,!1,3);const L=j.getUVs();L&&this.wf.oq(z.i.UVKind+"_"+f,L,!1,2);const Q=j.getUV2s();Q&&this.wf.oq(z.i.UV2Kind+"_"+f,Q,!1,2);const H=j.getColors();H&&this.wf.oq(z.i.ColorKind+f,H,!1,4)}}else{let q=0;for(;this.wf.isVerticesDataPresent(z.i.PositionKind+q);)this.wf.removeVerticesData(z.i.PositionKind+q),this.wf.isVerticesDataPresent(z.i.NormalKind+q)&&this.wf.removeVerticesData(z.i.NormalKind+q),this.wf.isVerticesDataPresent(z.i.TangentKind+q)&&this.wf.removeVerticesData(z.i.TangentKind+q),this.wf.isVerticesDataPresent(z.i.UVKind+q)&&this.wf.removeVerticesData(z.i.UVKind+"_"+q),this.wf.isVerticesDataPresent(z.i.UV2Kind+q)&&this.wf.removeVerticesData(z.i.UV2Kind+"_"+q),this.wf.isVerticesDataPresent(z.i.ColorKind+q)&&this.wf.removeVerticesData(z.i.ColorKind+q),q++}}static Parse(q,f,j){let d;if(d=q.type&&"LinesMesh"===q.type?F._LinesMeshParser(q,f):q.type&&"GroundMesh"===q.type?F._GroundMeshParser(q,f):q.type&&"GoldbergMesh"===q.type?F._GoldbergMeshParser(q,f):q.type&&"GreasedLineMesh"===q.type?F._GreasedLineMeshParser(q,f):q.type&&"TrailMesh"===q.type?F._TrailMeshParser(q,f):new F(q.name,f),d.id=q.id,d._waitingParsedUniqueId=q.uniqueId,L.c&&L.c.AddTagsTo(d,q.tags),d.position=r.j.Pf(q.position),void 0!==q.metadata&&(d.metadata=q.metadata),q.rotationQuaternion?d.rotationQuaternion=r.e.Pf(q.rotationQuaternion):q.rotation&&(d.rotation=r.j.Pf(q.rotation)),d.Vf=r.j.Pf(q.Vf),q.localMatrix?d.setPreTransformMatrix(r.b.Pf(q.localMatrix)):q.pivotMatrix&&d.setPivotMatrix(r.b.Pf(q.pivotMatrix)),d.DH(q.isEnabled),d.isVisible=q.isVisible,d.infiniteDistance=q.infiniteDistance,d.Cg=!!q.Cg,d.showBoundingBox=q.showBoundingBox,d.showSubMeshesBoundingBox=q.showSubMeshesBoundingBox,void 0!==q.applyFog&&(d.applyFog=q.applyFog),void 0!==q.pickable&&(d.Xr=q.pickable),void 0!==q.alphaIndex&&(d.alphaIndex=q.alphaIndex),d.receiveShadows=q.receiveShadows,void 0!==q.billboardMode&&(d.billboardMode=q.billboardMode),void 0!==q.visibility&&(d.visibility=q.visibility),d.checkCollisions=q.checkCollisions,d.vq=!!q.vq,q.ellipsoid&&(d.ellipsoid=r.j.Pf(q.ellipsoid)),q.ellipsoidOffset&&(d.ellipsoidOffset=r.j.Pf(q.ellipsoidOffset)),null!=q.overrideMaterialSideOrientation&&(d.sideOrientation=q.overrideMaterialSideOrientation),void 0!==q.sideOrientation&&(d.sideOrientation=q.sideOrientation),void 0!==q.isBlocker&&(d.isBlocker=q.isBlocker),d._shouldGenerateFlatShading=q.useFlatShading,q.yg&&(d._waitingData.yg=q.yg),void 0!==q.parentId&&(d._waitingParentId=q.parentId),void 0!==q.parentInstanceIndex&&(d._waitingParentInstanceIndex=q.parentInstanceIndex),void 0!==q.actions&&(d._waitingData.actions=q.actions),void 0!==q.overlayAlpha&&(d.overlayAlpha=q.overlayAlpha),void 0!==q.overlayColor&&(d.overlayColor=u.c.Pf(q.overlayColor)),void 0!==q.renderOverlay&&(d.renderOverlay=q.renderOverlay),d.isUnIndexed=!!q.isUnIndexed,d.hasVertexAlpha=q.hasVertexAlpha,q.delayLoadingFile?(d.delayLoadState=4,d.delayLoadingFile=j+q.delayLoadingFile,d.buildBoundingInfo(r.j.Pf(q.boundingBoxMinimum),r.j.Pf(q.boundingBoxMaximum)),q._binaryInfo&&(d._binaryInfo=q._binaryInfo),d._delayInfo=[],q.hasUVs&&d._delayInfo.push(z.i.UVKind),q.hasUVs2&&d._delayInfo.push(z.i.UV2Kind),q.hasUVs3&&d._delayInfo.push(z.i.UV3Kind),q.hasUVs4&&d._delayInfo.push(z.i.UV4Kind),q.hasUVs5&&d._delayInfo.push(z.i.UV5Kind),q.hasUVs6&&d._delayInfo.push(z.i.UV6Kind),q.hasColors&&d._delayInfo.push(z.i.ColorKind),q.hasMatricesIndices&&d._delayInfo.push(z.i.MatricesIndicesKind),q.hasMatricesWeights&&d._delayInfo.push(z.i.MatricesWeightsKind),d._delayLoadingFunction=D.e._ImportGeometry,w.c.ForceFullSceneLoadingForIncremental&&d._checkDelayState()):D.e._ImportGeometry(q,d),q.materialUniqueId?d._waitingMaterialId=q.materialUniqueId:q.materialId&&(d._waitingMaterialId=q.materialId),q.morphTargetManagerId>-1&&(d._waitingMorphTargetManagerId=q.morphTargetManagerId),void 0!==q.skeletonId&&null!==q.skeletonId&&(d.skeleton=f.getLastSkeletonById(q.skeletonId),q.numBoneInfluencers&&(d.numBoneInfluencers=q.numBoneInfluencers)),q.animations){for(let f=0;f<q.animations.length;f++){const j=q.animations[f],g=(0,S.c)("BABYLON.Animation");g&&d.animations.push(g.Parse(j))}X.d.ParseAnimationRanges(d,q,f)}if(q.autoAnimate&&f.beginAnimation(d,q.autoAnimateFrom,q.autoAnimateTo,q.autoAnimateLoop,q.autoAnimateSpeed||1),q.layerMask&&!isNaN(q.layerMask)?d.layerMask=Math.abs(parseInt(q.layerMask)):d.layerMask=268435455,q.physicsImpostor&&(d.physicsImpostor=F._PhysicsImpostorParser(f,d,q)),q.lodMeshIds&&(d._waitingData.lods={ids:q.lodMeshIds,distances:q.lodDistances?q.lodDistances:null,coverages:q.lodCoverages?q.lodCoverages:null}),q.instances)for(let g=0;g<q.instances.length;g++){const j=q.instances[g],h=d.createInstance(j.name);if(j.id&&(h.id=j.id),L.c&&(j.tags?L.c.AddTagsTo(h,j.tags):L.c.AddTagsTo(h,q.tags)),h.position=r.j.Pf(j.position),void 0!==j.metadata&&(h.metadata=j.metadata),void 0!==j.parentId&&(h._waitingParentId=j.parentId),void 0!==j.parentInstanceIndex&&(h._waitingParentInstanceIndex=j.parentInstanceIndex),void 0!==j.isEnabled&&null!==j.isEnabled&&h.DH(j.isEnabled),void 0!==j.isVisible&&null!==j.isVisible&&(h.isVisible=j.isVisible),void 0!==j.Xr&&null!==j.Xr&&(h.Xr=j.Xr),j.rotationQuaternion?h.rotationQuaternion=r.e.Pf(j.rotationQuaternion):j.rotation&&(h.rotation=r.j.Pf(j.rotation)),h.Vf=r.j.Pf(j.Vf),void 0!=j.checkCollisions&&null!=j.checkCollisions&&(h.checkCollisions=j.checkCollisions),void 0!=j.pickable&&null!=j.pickable&&(h.Xr=j.pickable),void 0!=j.showBoundingBox&&null!=j.showBoundingBox&&(h.showBoundingBox=j.showBoundingBox),void 0!=j.showSubMeshesBoundingBox&&null!=j.showSubMeshesBoundingBox&&(h.showSubMeshesBoundingBox=j.showSubMeshesBoundingBox),void 0!=j.alphaIndex&&null!=j.showSubMeshesBoundingBox&&(h.alphaIndex=j.alphaIndex),j.physicsImpostor&&(h.physicsImpostor=F._PhysicsImpostorParser(f,h,j)),void 0!==j.actions&&(h._waitingData.actions=j.actions),j.animations){for(let q=0;q<j.animations.length;q++){const f=j.animations[q],d=(0,S.c)("BABYLON.Animation");d&&h.animations.push(d.Parse(f))}X.d.ParseAnimationRanges(h,j,f),j.autoAnimate&&f.beginAnimation(h,j.autoAnimateFrom,j.autoAnimateTo,j.autoAnimateLoop,j.autoAnimateSpeed||1)}}if(q.thinInstances){const f=q.thinInstances;if(d.thinInstanceEnablePicking=!!f.enablePicking,f.matrixData?(d.kX("matrix",new Float32Array(f.matrixData),16,!1),d._thinInstanceDataStorage.matrixBufferSize=f.matrixBufferSize,d._thinInstanceDataStorage.instancesCount=f.instancesCount):d._thinInstanceDataStorage.matrixBufferSize=f.matrixBufferSize,q.thinInstances.userThinInstance){const f=q.thinInstances.userThinInstance;for(const q in f.data)d.kX(q,new Float32Array(f.data[q]),f.strides[q],!1),d._userThinInstanceBuffersStorage.sizes[q]=f.sizes[q]}}return d}setPositionsForCPUSkinning(){const q=this._internalMeshDataInfo;if(!q._sourcePositions){const f=this.getVerticesData(z.i.PositionKind);if(!f)return q._sourcePositions;q._sourcePositions=new Float32Array(f),this.isVertexBufferUpdatable(z.i.PositionKind)||this.oq(z.i.PositionKind,f,!0)}return q._sourcePositions}setNormalsForCPUSkinning(){const q=this._internalMeshDataInfo;if(!q._sourceNormals){const f=this.getVerticesData(z.i.NormalKind);if(!f)return q._sourceNormals;q._sourceNormals=new Float32Array(f),this.isVertexBufferUpdatable(z.i.NormalKind)||this.oq(z.i.NormalKind,f,!0)}return q._sourceNormals}applySkeleton(q){if(!this.wf)return this;if(this.wf._softwareSkinningFrameId==this.eq().getFrameId())return this;if(this.wf._softwareSkinningFrameId=this.eq().getFrameId(),!this.isVerticesDataPresent(z.i.PositionKind))return this;if(!this.isVerticesDataPresent(z.i.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(z.i.MatricesWeightsKind))return this;const f=this.isVerticesDataPresent(z.i.NormalKind),j=this._internalMeshDataInfo;if(!j._sourcePositions){const q=this.Qd.slice();this.setPositionsForCPUSkinning(),this.Qd=q}f&&!j._sourceNormals&&this.setNormalsForCPUSkinning();let d=this.getVerticesData(z.i.PositionKind);if(!d)return this;d instanceof Float32Array||(d=new Float32Array(d));let g=this.getVerticesData(z.i.NormalKind);if(f){if(!g)return this;g instanceof Float32Array||(g=new Float32Array(g))}const h=this.getVerticesData(z.i.MatricesIndicesKind),L=this.getVerticesData(z.i.MatricesWeightsKind);if(!L||!h)return this;const Q=this.numBoneInfluencers>4,H=Q?this.getVerticesData(z.i.MatricesIndicesExtraKind):null,u=Q?this.getVerticesData(z.i.MatricesWeightsExtraKind):null,X=q.getTransformMatrices(this),B=r.j.Zero(),D=new r.b,i=new r.b;let t,O=0;for(let z=0;z<d.length;z+=3,O+=4){let q;for(t=0;t<4;t++)q=L[O+t],q>0&&(r.b.FromFloat32ArrayToRefScaled(X,Math.floor(16*h[O+t]),q,i),D.addToSelf(i));if(Q)for(t=0;t<4;t++)q=u[O+t],q>0&&(r.b.FromFloat32ArrayToRefScaled(X,Math.floor(16*H[O+t]),q,i),D.addToSelf(i));r.j.TransformCoordinatesFromFloatsToRef(j._sourcePositions[z],j._sourcePositions[z+1],j._sourcePositions[z+2],D,B),B.toArray(d,z),f&&(r.j.TransformNormalFromFloatsToRef(j._sourceNormals[z],j._sourceNormals[z+1],j._sourceNormals[z+2],D,B),B.toArray(g,z)),D.reset()}return this.updateVerticesData(z.i.PositionKind,d),f&&this.updateVerticesData(z.i.NormalKind,g),this}static MinMax(q){let f=null,j=null;for(const d of q){const q=d.getBoundingInfo().boundingBox;f&&j?(f.minimizeInPlace(q.minimumWorld),j.maximizeInPlace(q.maximumWorld)):(f=q.minimumWorld,j=q.maximumWorld)}return f&&j?{min:f,max:j}:{min:r.j.Zero(),max:r.j.Zero()}}static Center(q){const f=q instanceof Array?F.MinMax(q):q;return r.j.Center(f.min,f.max)}static MergeMeshes(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],j=arguments.length>2?arguments[2]:void 0,d=arguments.length>3?arguments[3]:void 0,g=arguments.length>4?arguments[4]:void 0,h=arguments.length>5?arguments[5]:void 0;return(0,Q.o)(F._MergeMeshesCoroutine(q,f,j,d,g,h,!1))}static async MergeMeshesAsync(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],j=arguments.length>2?arguments[2]:void 0,d=arguments.length>3?arguments[3]:void 0,g=arguments.length>4?arguments[4]:void 0,h=arguments.length>5?arguments[5]:void 0;return await(0,Q.k)(F._MergeMeshesCoroutine(q,f,j,d,g,h,!0),(0,Q.d)())}static*_MergeMeshesCoroutine(q){let f,j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],d=arguments.length>2?arguments[2]:void 0,g=arguments.length>3?arguments[3]:void 0,h=arguments.length>4?arguments[4]:void 0,L=arguments.length>5?arguments[5]:void 0,Q=arguments.length>6?arguments[6]:void 0;if(0===(q=q.filter(Boolean)).length)return null;if(!d){let j=0;for(f=0;f<q.length;f++)if(j+=q[f].getTotalVertices(),j>=65536)return s.e.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}L&&(h=!1);const H=new Array,r=new Array,u=new Array,X=q[0].sideOrientation;for(f=0;f<q.length;f++){const j=q[f];if(j.isAnInstance)return s.e.Warn("Cannot merge instance meshes."),null;if(X!==j.sideOrientation)return s.e.Warn("Cannot merge meshes with different sideOrientation values."),null;if(h&&u.push(j.getTotalIndices()),L)if(j.material){const q=j.material;if(q instanceof N.e){for(let f=0;f<q.rd.length;f++)H.indexOf(q.rd[f])<0&&H.push(q.rd[f]);for(let f=0;f<j.Qd.length;f++)r.push(H.indexOf(q.rd[j.Qd[f].materialIndex])),u.push(j.Qd[f].indexCount)}else{H.indexOf(q)<0&&H.push(q);for(let f=0;f<j.Qd.length;f++)r.push(H.indexOf(q)),u.push(j.Qd[f].indexCount)}}else for(let q=0;q<j.Qd.length;q++)r.push(0),u.push(j.Qd[q].indexCount)}const z=q[0],D=q=>{const f=q.Nf(!0);return{vertexData:B.e.ExtractFromMesh(q,!1,!1),transform:f}},{vertexData:i,transform:O}=D(z);Q&&(yield);const w=new Array(q.length-1);for(let B=1;B<q.length;B++)w[B-1]=D(q[B]),Q&&(yield);const E=i._mergeCoroutine(O,w,d,Q,!j);let S=E.next();for(;!S.done;)Q&&(yield),S=E.next();const e=S.value;g||(g=new F(z.name+"_merged",z.eq()));const Z=e._applyToCoroutine(g,void 0,Q);let I=Z.next();for(;!I.done;)Q&&(yield),I=Z.next();if(g.checkCollisions=z.checkCollisions,g.sideOrientation=z.sideOrientation,j)for(f=0;f<q.length;f++)q[f].dispose();if(h||L){g.releaseSubMeshes(),f=0;let q=0;for(;f<u.length;)t.d.CreateFromIndices(0,q,u[f],g,void 0,!1),q+=u[f],f++;for(const f of g.Qd)f.refreshBoundingInfo();g.Nf(!0)}if(L){const q=new N.e(z.name+"_merged",z.eq());q.rd=H;for(let f=0;f<g.Qd.length;f++)g.Qd[f].materialIndex=r[f];g.material=q}else g.material=z.material;return g}kz(q){q._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(q)}Az(q){const f=q._indexInSourceMeshInstanceArray;if(-1!=f){if(f!==this.instances.length-1){const q=this.instances[this.instances.length-1];this.instances[f]=q,q._indexInSourceMeshInstanceArray=f}q._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===O.b.CounterClockWiseSideOrientation}_getRenderingFillMode(q){const f=this.eq();return f.forcePointsCloud?O.b.PointFillMode:f.forceWireframe?O.b.WireFrameFillMode:this.overrideRenderingFillMode??q}setMaterialByID(q){return this.setMaterialById(q)}static CreateRibbon(q,f,j,d,g,h,L,Q,H){throw new Error("Import MeshBuilder to populate this function")}static CreateDisc(q,f,j,d,g,h){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(q,f,j,d,g){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(q,f,j,d,g,h){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(q,f,j,d){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(q,f,j,d,g,h,L,Q,H){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(q,f,j,d,g,h,L){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(q,f,j,d,g,h,L,Q,H,r){throw new Error("Import MeshBuilder to populate this function")}static Vr(q,f,j,d,g){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(q,f,j,d,g,h,L,Q){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(q,f,j,d,g,h,L){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(q,f,j,d,g,h,L,Q){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(q,f,j,d,g,h,L,Q,H,r){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(q,f,j,d,g,h,L,Q,H,r,u,X){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(q,f,j,d,g,h,L){throw new Error("Import MeshBuilder to populate this function")}static Pr(q,f,j,d,g){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(q,f,j,d,g,h){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(q,f,j,d,g,h,L,Q,H){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(q,f,j,d,g,h,L,Q,H,r,u){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(q,f,j,d,g,h,L,Q,H,r){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(q,f,j){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(q,f,j){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(q,f,j,d,g,h){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(q,f,j){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(q){throw new Error("Import MeshBuilder to populate this function")}}F.FRONTSIDE=B.e.FRONTSIDE,F.BACKSIDE=B.e.BACKSIDE,F.DOUBLESIDE=B.e.DOUBLESIDE,F.DEFAULTSIDE=B.e.DEFAULTSIDE,F.NO_CAP=0,F.CAP_START=1,F.CAP_END=2,F.CAP_ALL=3,F.NO_FLIP=0,F.FLIP_TILE=1,F.ROTATE_TILE=2,F.FLIP_ROW=3,F.ROTATE_ROW=4,F.FLIP_N_ROTATE_TILE=5,F.FLIP_N_ROTATE_ROW=6,F.CENTER=0,F.LEFT=1,F.RIGHT=2,F.TOP=3,F.BOTTOM=4,F.INSTANCEDMESH_SORT_TRANSPARENT=!1,F._GroundMeshParser=(q,f)=>{throw(0,e.c)("GroundMesh")},F._GoldbergMeshParser=(q,f)=>{throw(0,e.c)("GoldbergMesh")},F._LinesMeshParser=(q,f)=>{throw(0,e.c)("LinesMesh")},F._GreasedLineMeshParser=(q,f)=>{throw(0,e.c)("GreasedLineMesh")},F._GreasedLineRibbonMeshParser=(q,f)=>{throw(0,e.c)("GreasedLineRibbonMesh")},F._TrailMeshParser=(q,f)=>{throw(0,e.c)("TrailMesh")},(0,S.f)("BABYLON.Mesh",F)},11257:(q,f,j)=>{j.d(f,{e:()=>D});var d=j(11125),g=j(10941),h=j(11151),L=j(11016),Q=j(11210),H=j(11005),r=j(11130),u=j(11259),X=j(11035),z=j(11142);class B{}class D{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,u.h)(this._applyToCoroutine.bind(this)),this.uniqueId=D._UniqueIdGenerator,D._UniqueIdGenerator++}set(q,f){switch(q.length||H.e.Warn(`Setting vertex data kind '${f}' with an empty array`),f){case h.i.PositionKind:this.Iq=q;break;case h.i.NormalKind:this.Tq=q;break;case h.i.TangentKind:this.tangents=q;break;case h.i.UVKind:this.nq=q;break;case h.i.UV2Kind:this.uvs2=q;break;case h.i.UV3Kind:this.uvs3=q;break;case h.i.UV4Kind:this.uvs4=q;break;case h.i.UV5Kind:this.uvs5=q;break;case h.i.UV6Kind:this.uvs6=q;break;case h.i.ColorKind:this.Wq=q;break;case h.i.MatricesIndicesKind:this.matricesIndices=q;break;case h.i.MatricesWeightsKind:this.matricesWeights=q;break;case h.i.MatricesIndicesExtraKind:this.matricesIndicesExtra=q;break;case h.i.MatricesWeightsExtraKind:this.matricesWeightsExtra=q}}Yq(q,f){return this._applyTo(q,f,!1),this}applyToGeometry(q,f){return this._applyTo(q,f,!1),this}updateMesh(q){return this._update(q),this}updateGeometry(q){return this._update(q),this}*_applyToCoroutine(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2?arguments[2]:void 0;if(this.Iq&&(q.oq(h.i.PositionKind,this.Iq,f),j&&(yield)),this.Tq&&(q.oq(h.i.NormalKind,this.Tq,f),j&&(yield)),this.tangents&&(q.oq(h.i.TangentKind,this.tangents,f),j&&(yield)),this.nq&&(q.oq(h.i.UVKind,this.nq,f),j&&(yield)),this.uvs2&&(q.oq(h.i.UV2Kind,this.uvs2,f),j&&(yield)),this.uvs3&&(q.oq(h.i.UV3Kind,this.uvs3,f),j&&(yield)),this.uvs4&&(q.oq(h.i.UV4Kind,this.uvs4,f),j&&(yield)),this.uvs5&&(q.oq(h.i.UV5Kind,this.uvs5,f),j&&(yield)),this.uvs6&&(q.oq(h.i.UV6Kind,this.uvs6,f),j&&(yield)),this.Wq){const d=this.Iq&&this.Wq.length===this.Iq.length?3:4;q.oq(h.i.ColorKind,this.Wq,f,d),this.hasVertexAlpha&&void 0!==q.hasVertexAlpha&&(q.hasVertexAlpha=!0),j&&(yield)}if(this.matricesIndices&&(q.oq(h.i.MatricesIndicesKind,this.matricesIndices,f),j&&(yield)),this.matricesWeights&&(q.oq(h.i.MatricesWeightsKind,this.matricesWeights,f),j&&(yield)),this.matricesIndicesExtra&&(q.oq(h.i.MatricesIndicesExtraKind,this.matricesIndicesExtra,f),j&&(yield)),this.matricesWeightsExtra&&(q.oq(h.i.MatricesWeightsExtraKind,this.matricesWeightsExtra,f),j&&(yield)),this.indices?(q.setIndices(this.indices,null,f),j&&(yield)):q.setIndices([],null),q.Qd&&this.materialInfos&&this.materialInfos.length>1){const f=q;f.Qd=[];for(const q of this.materialInfos)new z.d(q.materialIndex,q.verticesStart,q.verticesCount,q.indexStart,q.indexCount,f)}return this}_update(q,f,j){return this.Iq&&q.updateVerticesData(h.i.PositionKind,this.Iq,f,j),this.Tq&&q.updateVerticesData(h.i.NormalKind,this.Tq,f,j),this.tangents&&q.updateVerticesData(h.i.TangentKind,this.tangents,f,j),this.nq&&q.updateVerticesData(h.i.UVKind,this.nq,f,j),this.uvs2&&q.updateVerticesData(h.i.UV2Kind,this.uvs2,f,j),this.uvs3&&q.updateVerticesData(h.i.UV3Kind,this.uvs3,f,j),this.uvs4&&q.updateVerticesData(h.i.UV4Kind,this.uvs4,f,j),this.uvs5&&q.updateVerticesData(h.i.UV5Kind,this.uvs5,f,j),this.uvs6&&q.updateVerticesData(h.i.UV6Kind,this.uvs6,f,j),this.Wq&&q.updateVerticesData(h.i.ColorKind,this.Wq,f,j),this.matricesIndices&&q.updateVerticesData(h.i.MatricesIndicesKind,this.matricesIndices,f,j),this.matricesWeights&&q.updateVerticesData(h.i.MatricesWeightsKind,this.matricesWeights,f,j),this.matricesIndicesExtra&&q.updateVerticesData(h.i.MatricesIndicesExtraKind,this.matricesIndicesExtra,f,j),this.matricesWeightsExtra&&q.updateVerticesData(h.i.MatricesWeightsExtraKind,this.matricesWeightsExtra,f,j),this.indices&&q.setIndices(this.indices,null),this}static _TransformVector3Coordinates(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:q.length;const h=g.f.kf[0],L=g.f.kf[1];for(let Q=j;Q<j+d;Q+=3)g.j.FromArrayToRef(q,Q,h),g.j.TransformCoordinatesToRef(h,f,L),q[Q]=L.x,q[Q+1]=L.y,q[Q+2]=L.z}static _TransformVector3Normals(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:q.length;const h=g.f.kf[0],L=g.f.kf[1];for(let Q=j;Q<j+d;Q+=3)g.j.FromArrayToRef(q,Q,h),g.j.TransformNormalToRef(h,f,L),q[Q]=L.x,q[Q+1]=L.y,q[Q+2]=L.z}static _TransformVector4Normals(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:q.length;const h=g.f.Vector4[0],L=g.f.Vector4[1];for(let Q=j;Q<j+d;Q+=4)g.m.FromArrayToRef(q,Q,h),g.m.TransformNormalToRef(h,f,L),q[Q]=L.x,q[Q+1]=L.y,q[Q+2]=L.z,q[Q+3]=L.w}static _FlipFaces(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:q.length;for(let d=f;d<f+j;d+=3){const f=q[d+1];q[d+1]=q[d+2],q[d+2]=f}}transform(q){const f=q.determinant()<0;return this.Iq&&D._TransformVector3Coordinates(this.Iq,q),this.Tq&&D._TransformVector3Normals(this.Tq,q),this.tangents&&D._TransformVector4Normals(this.tangents,q),f&&this.indices&&D._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const q=[];for(const f of this.materialInfos){const j=new D;if(this.Iq&&(j.Iq=this.Iq.slice(3*f.verticesStart,3*(f.verticesCount+f.verticesStart))),this.Tq&&(j.Tq=this.Tq.slice(3*f.verticesStart,3*(f.verticesCount+f.verticesStart))),this.tangents&&(j.tangents=this.tangents.slice(4*f.verticesStart,4*(f.verticesCount+f.verticesStart))),this.Wq&&(j.Wq=this.Wq.slice(4*f.verticesStart,4*(f.verticesCount+f.verticesStart))),this.nq&&(j.nq=this.nq.slice(2*f.verticesStart,2*(f.verticesCount+f.verticesStart))),this.uvs2&&(j.uvs2=this.uvs2.slice(2*f.verticesStart,2*(f.verticesCount+f.verticesStart))),this.uvs3&&(j.uvs3=this.uvs3.slice(2*f.verticesStart,2*(f.verticesCount+f.verticesStart))),this.uvs4&&(j.uvs4=this.uvs4.slice(2*f.verticesStart,2*(f.verticesCount+f.verticesStart))),this.uvs5&&(j.uvs5=this.uvs5.slice(2*f.verticesStart,2*(f.verticesCount+f.verticesStart))),this.uvs6&&(j.uvs6=this.uvs6.slice(2*f.verticesStart,2*(f.verticesCount+f.verticesStart))),this.matricesIndices&&(j.matricesIndices=this.matricesIndices.slice(4*f.verticesStart,4*(f.verticesCount+f.verticesStart))),this.matricesIndicesExtra&&(j.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*f.verticesStart,4*(f.verticesCount+f.verticesStart))),this.matricesWeights&&(j.matricesWeights=this.matricesWeights.slice(4*f.verticesStart,4*(f.verticesCount+f.verticesStart))),this.matricesWeightsExtra&&(j.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*f.verticesStart,4*(f.verticesCount+f.verticesStart))),this.indices){j.indices=[];for(let q=f.indexStart;q<f.indexStart+f.indexCount;q++)j.indices.push(this.indices[q]-f.verticesStart)}const d=new B;d.indexStart=0,d.indexCount=j.indices?j.indices.length:0,d.materialIndex=f.materialIndex,d.verticesStart=0,d.verticesCount=(j.Iq?j.Iq.length:0)/3,j.materialInfos=[d],q.push(j)}return q}merge(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],g=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const h=Array.isArray(q)?q.map((q=>({vertexData:q}))):[{vertexData:q}];return(0,u.o)(this._mergeCoroutine(void 0,h,f,!1,j,d,g))}*_mergeCoroutine(q,f){var j,d;let g=arguments.length>2&&void 0!==arguments[2]&&arguments[2],L=arguments.length>3?arguments[3]:void 0,Q=arguments.length>4?arguments[4]:void 0,H=arguments.length>5&&void 0!==arguments[5]&&arguments[5],r=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let u=f.map((q=>q.vertexData)),X=this;if(r)for(const h of u)h&&(h._validate(),!this.Tq&&h.Tq&&(this.Tq=new Float32Array(this.Iq.length)),!this.tangents&&h.tangents&&(this.tangents=new Float32Array(this.Iq.length/3*4)),!this.nq&&h.nq&&(this.nq=new Float32Array(this.Iq.length/3*2)),!this.uvs2&&h.uvs2&&(this.uvs2=new Float32Array(this.Iq.length/3*2)),!this.uvs3&&h.uvs3&&(this.uvs3=new Float32Array(this.Iq.length/3*2)),!this.uvs4&&h.uvs4&&(this.uvs4=new Float32Array(this.Iq.length/3*2)),!this.uvs5&&h.uvs5&&(this.uvs5=new Float32Array(this.Iq.length/3*2)),!this.uvs6&&h.uvs6&&(this.uvs6=new Float32Array(this.Iq.length/3*2)),!this.Wq&&h.Wq&&(this.Wq=new Float32Array(this.Iq.length/3*4),this.Wq.fill(1)),!this.matricesIndices&&h.matricesIndices&&(this.matricesIndices=new Float32Array(this.Iq.length/3*4)),!this.matricesWeights&&h.matricesWeights&&(this.matricesWeights=new Float32Array(this.Iq.length/3*4)),!this.matricesIndicesExtra&&h.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.Iq.length/3*4)),!this.matricesWeightsExtra&&h.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.Iq.length/3*4)));for(const h of u)if(h)if(r)this.Tq&&!h.Tq&&(h.Tq=new Float32Array(h.Iq.length)),this.tangents&&!h.tangents&&(h.tangents=new Float32Array(h.Iq.length/3*4)),this.nq&&!h.nq&&(h.nq=new Float32Array(h.Iq.length/3*2)),this.uvs2&&!h.uvs2&&(h.uvs2=new Float32Array(h.Iq.length/3*2)),this.uvs3&&!h.uvs3&&(h.uvs3=new Float32Array(h.Iq.length/3*2)),this.uvs4&&!h.uvs4&&(h.uvs4=new Float32Array(h.Iq.length/3*2)),this.uvs5&&!h.uvs5&&(h.uvs5=new Float32Array(h.Iq.length/3*2)),this.uvs6&&!h.uvs6&&(h.uvs6=new Float32Array(h.Iq.length/3*2)),this.Wq&&!h.Wq&&(h.Wq=new Float32Array(h.Iq.length/3*4),h.Wq.fill(1)),this.matricesIndices&&!h.matricesIndices&&(h.matricesIndices=new Float32Array(h.Iq.length/3*4)),this.matricesWeights&&!h.matricesWeights&&(h.matricesWeights=new Float32Array(h.Iq.length/3*4)),this.matricesIndicesExtra&&!h.matricesIndicesExtra&&(h.matricesIndicesExtra=new Float32Array(h.Iq.length/3*4)),this.matricesWeightsExtra&&!h.matricesWeightsExtra&&(h.matricesWeightsExtra=new Float32Array(h.Iq.length/3*4));else if(h._validate(),!this.Tq!==!h.Tq||!this.tangents!==!h.tangents||!this.nq!==!h.nq||!this.uvs2!==!h.uvs2||!this.uvs3!==!h.uvs3||!this.uvs4!==!h.uvs4||!this.uvs5!==!h.uvs5||!this.uvs6!==!h.uvs6||!this.Wq!==!h.Wq||!this.matricesIndices!==!h.matricesIndices||!this.matricesWeights!==!h.matricesWeights||!this.matricesIndicesExtra!==!h.matricesIndicesExtra||!this.matricesWeightsExtra!==!h.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(H){let j=0,d=0,g=0;const h=[];let L=null;const Q=[];for(const f of this.splitBasedOnMaterialID())Q.push({vertexData:f,transform:q});for(const q of f)if(q.vertexData)for(const f of q.vertexData.splitBasedOnMaterialID())Q.push({vertexData:f,transform:q.transform});Q.sort(((q,f)=>{const j=q.vertexData.materialInfos?q.vertexData.materialInfos[0].materialIndex:0,d=f.vertexData.materialInfos?f.vertexData.materialInfos[0].materialIndex:0;return j>d?1:j===d?0:-1}));for(const q of Q){const f=q.vertexData;if(j=f.materialInfos?f.materialInfos[0].materialIndex:0,L&&L.materialIndex===j)L.indexCount+=f.indices.length,L.verticesCount+=f.Iq.length/3;else{const q=new B;q.materialIndex=j,q.indexStart=d,q.indexCount=f.indices.length,q.verticesStart=g,q.verticesCount=f.Iq.length/3,h.push(q),L=q}d+=f.indices.length,g+=f.Iq.length/3}const H=Q.splice(0,1)[0];X=H.vertexData,q=H.transform,u=Q.map((q=>q.vertexData)),f=Q,this.materialInfos=h}const z=u.reduce(((q,f)=>{var j;return q+((null===(j=f.indices)||void 0===j?void 0:j.length)??0)}),(null===(j=X.indices)||void 0===j?void 0:j.length)??0);let i=Q||u.some((q=>q.indices===X.indices))?null===(d=X.indices)||void 0===d?void 0:d.slice():X.indices;if(z>0){var t;let j=(null===(t=i)||void 0===t?void 0:t.length)??0;if(i||(i=new Array(z)),i.length!==z){if(Array.isArray(i))i.length=z;else{const q=g||i instanceof Uint32Array?new Uint32Array(z):new Uint16Array(z);q.set(i),i=q}q&&q.determinant()<0&&D._FlipFaces(i,0,j)}let d=X.Iq?X.Iq.length/3:0;for(const{vertexData:q,transform:g}of f)if(q.indices){for(let f=0;f<q.indices.length;f++)i[j+f]=q.indices[f]+d;g&&g.determinant()<0&&D._FlipFaces(i,j,q.indices.length),d+=q.Iq.length/3,j+=q.indices.length,L&&(yield)}}return this.indices=i,this.Iq=D._MergeElement(h.i.PositionKind,X.Iq,q,f.map((q=>[q.vertexData.Iq,q.transform]))),L&&(yield),X.Tq&&(this.Tq=D._MergeElement(h.i.NormalKind,X.Tq,q,f.map((q=>[q.vertexData.Tq,q.transform]))),L&&(yield)),X.tangents&&(this.tangents=D._MergeElement(h.i.TangentKind,X.tangents,q,f.map((q=>[q.vertexData.tangents,q.transform]))),L&&(yield)),X.nq&&(this.nq=D._MergeElement(h.i.UVKind,X.nq,q,f.map((q=>[q.vertexData.nq,q.transform]))),L&&(yield)),X.uvs2&&(this.uvs2=D._MergeElement(h.i.UV2Kind,X.uvs2,q,f.map((q=>[q.vertexData.uvs2,q.transform]))),L&&(yield)),X.uvs3&&(this.uvs3=D._MergeElement(h.i.UV3Kind,X.uvs3,q,f.map((q=>[q.vertexData.uvs3,q.transform]))),L&&(yield)),X.uvs4&&(this.uvs4=D._MergeElement(h.i.UV4Kind,X.uvs4,q,f.map((q=>[q.vertexData.uvs4,q.transform]))),L&&(yield)),X.uvs5&&(this.uvs5=D._MergeElement(h.i.UV5Kind,X.uvs5,q,f.map((q=>[q.vertexData.uvs5,q.transform]))),L&&(yield)),X.uvs6&&(this.uvs6=D._MergeElement(h.i.UV6Kind,X.uvs6,q,f.map((q=>[q.vertexData.uvs6,q.transform]))),L&&(yield)),X.Wq&&(this.Wq=D._MergeElement(h.i.ColorKind,X.Wq,q,f.map((q=>[q.vertexData.Wq,q.transform]))),(void 0!==X.hasVertexAlpha||f.some((q=>void 0!==q.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=X.hasVertexAlpha||f.some((q=>q.vertexData.hasVertexAlpha))),L&&(yield)),X.matricesIndices&&(this.matricesIndices=D._MergeElement(h.i.MatricesIndicesKind,X.matricesIndices,q,f.map((q=>[q.vertexData.matricesIndices,q.transform]))),L&&(yield)),X.matricesWeights&&(this.matricesWeights=D._MergeElement(h.i.MatricesWeightsKind,X.matricesWeights,q,f.map((q=>[q.vertexData.matricesWeights,q.transform]))),L&&(yield)),X.matricesIndicesExtra&&(this.matricesIndicesExtra=D._MergeElement(h.i.MatricesIndicesExtraKind,X.matricesIndicesExtra,q,f.map((q=>[q.vertexData.matricesIndicesExtra,q.transform]))),L&&(yield)),X.matricesWeightsExtra&&(this.matricesWeightsExtra=D._MergeElement(h.i.MatricesWeightsExtraKind,X.matricesWeightsExtra,q,f.map((q=>[q.vertexData.matricesWeightsExtra,q.transform])))),this}static _MergeElement(q,f,j,d){const g=d.filter((q=>null!==q[0]&&void 0!==q[0]));if(!f&&0==g.length)return f;if(!f)return this._MergeElement(q,g[0][0],g[0][1],g.slice(1));const L=g.reduce(((q,f)=>q+f[0].length),f.length),Q=q===h.i.PositionKind?D._TransformVector3Coordinates:q===h.i.NormalKind?D._TransformVector3Normals:q===h.i.TangentKind?D._TransformVector4Normals:()=>{};if(f instanceof Float32Array){const q=new Float32Array(L);q.set(f),j&&Q(q,j,0,f.length);let d=f.length;for(const[f,j]of g)q.set(f,d),j&&Q(q,j,d,f.length),d+=f.length;return q}{const q=new Array(L);for(let j=0;j<f.length;j++)q[j]=f[j];j&&Q(q,j,0,f.length);let d=f.length;for(const[f,j]of g){for(let j=0;j<f.length;j++)q[d+j]=f[j];j&&Q(q,j,d,f.length),d+=f.length}return q}}_validate(){if(!this.Iq)throw new X.i("Positions are required",X.g.MeshInvalidPositionsError);const q=(q,f)=>{const j=h.i.DeduceStride(q);if(f.length%j!==0)throw new Error("The "+q+"s array count must be a multiple of "+j);return f.length/j},f=q(h.i.PositionKind,this.Iq),j=(j,d)=>{const g=q(j,d);if(g!==f)throw new Error("The "+j+"s element count ("+g+") does not match the positions count ("+f+")")};this.Tq&&j(h.i.NormalKind,this.Tq),this.tangents&&j(h.i.TangentKind,this.tangents),this.nq&&j(h.i.UVKind,this.nq),this.uvs2&&j(h.i.UV2Kind,this.uvs2),this.uvs3&&j(h.i.UV3Kind,this.uvs3),this.uvs4&&j(h.i.UV4Kind,this.uvs4),this.uvs5&&j(h.i.UV5Kind,this.uvs5),this.uvs6&&j(h.i.UV6Kind,this.uvs6),this.Wq&&j(h.i.ColorKind,this.Wq),this.matricesIndices&&j(h.i.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&j(h.i.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&j(h.i.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&j(h.i.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const q=this.serialize();return D.Parse(q)}serialize(){const q={};if(this.Iq&&(q.Iq=Array.from(this.Iq)),this.Tq&&(q.Tq=Array.from(this.Tq)),this.tangents&&(q.tangents=Array.from(this.tangents)),this.nq&&(q.nq=Array.from(this.nq)),this.uvs2&&(q.uvs2=Array.from(this.uvs2)),this.uvs3&&(q.uvs3=Array.from(this.uvs3)),this.uvs4&&(q.uvs4=Array.from(this.uvs4)),this.uvs5&&(q.uvs5=Array.from(this.uvs5)),this.uvs6&&(q.uvs6=Array.from(this.uvs6)),this.Wq&&(q.Wq=Array.from(this.Wq),q.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(q.matricesIndices=Array.from(this.matricesIndices),q.matricesIndicesExpanded=!0),this.matricesWeights&&(q.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(q.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),q.matricesIndicesExtraExpanded=!0),this.matricesWeightsExtra&&(q.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),q.indices=this.indices?Array.from(this.indices):[],this.materialInfos){q.materialInfos=[];for(const f of this.materialInfos){const j={indexStart:f.indexStart,indexCount:f.indexCount,materialIndex:f.materialIndex,verticesStart:f.verticesStart,verticesCount:f.verticesCount};q.materialInfos.push(j)}}return q}static ExtractFromMesh(q,f,j){return D._ExtractFrom(q,f,j)}static ExtractFromGeometry(q,f,j){return D._ExtractFrom(q,f,j)}static _ExtractFrom(q,f,j){const d=new D;if(q.isVerticesDataPresent(h.i.PositionKind)&&(d.Iq=q.getVerticesData(h.i.PositionKind,f,j)),q.isVerticesDataPresent(h.i.NormalKind)&&(d.Tq=q.getVerticesData(h.i.NormalKind,f,j)),q.isVerticesDataPresent(h.i.TangentKind)&&(d.tangents=q.getVerticesData(h.i.TangentKind,f,j)),q.isVerticesDataPresent(h.i.UVKind)&&(d.nq=q.getVerticesData(h.i.UVKind,f,j)),q.isVerticesDataPresent(h.i.UV2Kind)&&(d.uvs2=q.getVerticesData(h.i.UV2Kind,f,j)),q.isVerticesDataPresent(h.i.UV3Kind)&&(d.uvs3=q.getVerticesData(h.i.UV3Kind,f,j)),q.isVerticesDataPresent(h.i.UV4Kind)&&(d.uvs4=q.getVerticesData(h.i.UV4Kind,f,j)),q.isVerticesDataPresent(h.i.UV5Kind)&&(d.uvs5=q.getVerticesData(h.i.UV5Kind,f,j)),q.isVerticesDataPresent(h.i.UV6Kind)&&(d.uvs6=q.getVerticesData(h.i.UV6Kind,f,j)),q.isVerticesDataPresent(h.i.ColorKind)){const g=q.wf||q,L=g.getVertexBuffer(h.i.ColorKind),Q=g.getVerticesData(h.i.ColorKind,f,j);if(3===L.getSize()){const q=new Float32Array(4*Q.length/3);for(let f=0,j=0;f<Q.length;f+=3,j+=4)q[j]=Q[f],q[j+1]=Q[f+1],q[j+2]=Q[f+2],q[j+3]=1;d.Wq=q}else{if(4!==L.getSize())throw new Error(`Unexpected number of color components: ${L.getSize()}`);d.Wq=Q}}return q.isVerticesDataPresent(h.i.MatricesIndicesKind)&&(d.matricesIndices=q.getVerticesData(h.i.MatricesIndicesKind,f,j)),q.isVerticesDataPresent(h.i.MatricesWeightsKind)&&(d.matricesWeights=q.getVerticesData(h.i.MatricesWeightsKind,f,j)),q.isVerticesDataPresent(h.i.MatricesIndicesExtraKind)&&(d.matricesIndicesExtra=q.getVerticesData(h.i.MatricesIndicesExtraKind,f,j)),q.isVerticesDataPresent(h.i.MatricesWeightsExtraKind)&&(d.matricesWeightsExtra=q.getVerticesData(h.i.MatricesWeightsExtraKind,f,j)),d.indices=q.sf(f,j),d}static CreateRibbon(q){throw(0,L.c)("ribbonBuilder")}static CreateBox(q){throw(0,L.c)("boxBuilder")}static CreateTiledBox(q){throw(0,L.c)("tiledBoxBuilder")}static CreateTiledPlane(q){throw(0,L.c)("tiledPlaneBuilder")}static CreateSphere(q){throw(0,L.c)("sphereBuilder")}static CreateCylinder(q){throw(0,L.c)("cylinderBuilder")}static CreateTorus(q){throw(0,L.c)("torusBuilder")}static CreateLineSystem(q){throw(0,L.c)("linesBuilder")}static CreateDashedLines(q){throw(0,L.c)("linesBuilder")}static CreateGround(q){throw(0,L.c)("groundBuilder")}static CreateTiledGround(q){throw(0,L.c)("groundBuilder")}static CreateGroundFromHeightMap(q){throw(0,L.c)("groundBuilder")}static Pr(q){throw(0,L.c)("planeBuilder")}static CreateDisc(q){throw(0,L.c)("discBuilder")}static CreatePolygon(q,f,j,d,g,h,Q){throw(0,L.c)("polygonBuilder")}static CreateIcoSphere(q){throw(0,L.c)("icoSphereBuilder")}static CreatePolyhedron(q){throw(0,L.c)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||g.j.Up();throw(0,L.c)("capsuleBuilder")}static CreateTorusKnot(q){throw(0,L.c)("torusKnotBuilder")}static ComputeNormals(q,f,j,d){let h=0,L=0,Q=0,H=0,r=0,u=0,X=0,z=0,B=0,D=0,i=0,t=0,O=0,N=0,w=0,E=0,s=0,S=0,e=0,Z=0,I=!1,T=!1,W=!1,n=!1,U=1,Y=0,v=null;d&&(I=!!d.facetNormals,T=!!d.facetPositions,W=!!d.facetPartitioning,U=!0===d.useRightHandedSystem?-1:1,Y=d.ratio||0,n=!!d.depthSort,v=d.distanceTo,n&&void 0===v&&(v=g.j.Zero()));let F=0,M=0,o=0,b=0;for(W&&d&&d.bbSize&&(F=d.subDiv.X*Y/d.bbSize.x,M=d.subDiv.Y*Y/d.bbSize.y,o=d.subDiv.Z*Y/d.bbSize.z,b=d.subDiv.max*d.subDiv.max,d.facetPartitioning.length=0),h=0;h<q.length;h++)j[h]=0;const x=f.length/3|0;for(h=0;h<x;h++){if(t=3*f[3*h],O=t+1,N=t+2,w=3*f[3*h+1],E=w+1,s=w+2,S=3*f[3*h+2],e=S+1,Z=S+2,L=q[t]-q[w],Q=q[O]-q[E],H=q[N]-q[s],r=q[S]-q[w],u=q[e]-q[E],X=q[Z]-q[s],z=U*(Q*X-H*u),B=U*(H*r-L*X),D=U*(L*u-Q*r),i=Math.sqrt(z*z+B*B+D*D),i=0===i?1:i,z/=i,B/=i,D/=i,I&&d&&(d.facetNormals[h].x=z,d.facetNormals[h].y=B,d.facetNormals[h].z=D),T&&d&&(d.facetPositions[h].x=(q[t]+q[w]+q[S])/3,d.facetPositions[h].y=(q[O]+q[E]+q[e])/3,d.facetPositions[h].z=(q[N]+q[s]+q[Z])/3),W&&d){const f=Math.floor((d.facetPositions[h].x-d.bInfo.minimum.x*Y)*F),j=Math.floor((d.facetPositions[h].y-d.bInfo.minimum.y*Y)*M),g=Math.floor((d.facetPositions[h].z-d.bInfo.minimum.z*Y)*o),L=Math.floor((q[t]-d.bInfo.minimum.x*Y)*F),Q=Math.floor((q[O]-d.bInfo.minimum.y*Y)*M),H=Math.floor((q[N]-d.bInfo.minimum.z*Y)*o),r=Math.floor((q[w]-d.bInfo.minimum.x*Y)*F),u=Math.floor((q[E]-d.bInfo.minimum.y*Y)*M),X=Math.floor((q[s]-d.bInfo.minimum.z*Y)*o),z=Math.floor((q[S]-d.bInfo.minimum.x*Y)*F),B=Math.floor((q[e]-d.bInfo.minimum.y*Y)*M),D=Math.floor((q[Z]-d.bInfo.minimum.z*Y)*o),i=L+d.subDiv.max*Q+b*H,I=r+d.subDiv.max*u+b*X,T=z+d.subDiv.max*B+b*D,W=f+d.subDiv.max*j+b*g;d.facetPartitioning[W]=d.facetPartitioning[W]?d.facetPartitioning[W]:[],d.facetPartitioning[i]=d.facetPartitioning[i]?d.facetPartitioning[i]:[],d.facetPartitioning[I]=d.facetPartitioning[I]?d.facetPartitioning[I]:[],d.facetPartitioning[T]=d.facetPartitioning[T]?d.facetPartitioning[T]:[],d.facetPartitioning[i].push(h),I!=i&&d.facetPartitioning[I].push(h),T!=I&&T!=i&&d.facetPartitioning[T].push(h),W!=i&&W!=I&&W!=T&&d.facetPartitioning[W].push(h)}if(n&&d&&d.facetPositions){const q=d.depthSortedFacets[h];q.ind=3*h,q.sqDistance=g.j.DistanceSquared(d.facetPositions[h],v)}j[t]+=z,j[O]+=B,j[N]+=D,j[w]+=z,j[E]+=B,j[s]+=D,j[S]+=z,j[e]+=B,j[Z]+=D}for(h=0;h<j.length/3;h++)z=j[3*h],B=j[3*h+1],D=j[3*h+2],i=Math.sqrt(z*z+B*B+D*D),i=0===i?1:i,z/=i,B/=i,D/=i,j[3*h]=z,j[3*h+1]=B,j[3*h+2]=D}static _ComputeSides(q,f,j,d,h,L,Q){const H=j.length,r=d.length;let u,X;switch(q=q||D.DEFAULTSIDE){case D.FRONTSIDE:break;case D.BACKSIDE:for(u=0;u<H;u+=3){const q=j[u];j[u]=j[u+2],j[u+2]=q}for(X=0;X<r;X++)d[X]=-d[X];break;case D.DOUBLESIDE:{const q=f.length,z=q/3;for(let j=0;j<q;j++)f[q+j]=f[j];for(u=0;u<H;u+=3)j[u+H]=j[u+2]+z,j[u+1+H]=j[u+1]+z,j[u+2+H]=j[u]+z;for(X=0;X<r;X++)d[r+X]=-d[X];const B=h.length;let D=0;for(D=0;D<B;D++)h[D+B]=h[D];for(L=L||new g.m(0,0,1,1),Q=Q||new g.m(0,0,1,1),D=0,u=0;u<B/2;u++)h[D]=L.x+(L.z-L.x)*h[D],h[D+1]=L.y+(L.w-L.y)*h[D+1],h[D+B]=Q.x+(Q.z-Q.x)*h[D+B],h[D+B+1]=Q.y+(Q.w-Q.y)*h[D+B+1],D+=2;break}}}static Parse(q){const f=new D,j=q.Iq;j&&f.set(j,h.i.PositionKind);const d=q.Tq;d&&f.set(d,h.i.NormalKind);const g=q.tangents;g&&f.set(g,h.i.TangentKind);const L=q.nq;L&&f.set(L,h.i.UVKind);const H=q.uvs2;H&&f.set(H,h.i.UV2Kind);const r=q.uvs3;r&&f.set(r,h.i.UV3Kind);const u=q.uvs4;u&&f.set(u,h.i.UV4Kind);const X=q.uvs5;X&&f.set(X,h.i.UV5Kind);const z=q.uvs6;z&&f.set(z,h.i.UV6Kind);const i=q.Wq;i&&(f.set(Q.e.CheckColors4(i,j.length/3),h.i.ColorKind),void 0!==q.hasVertexAlpha&&(f.hasVertexAlpha=q.hasVertexAlpha));const t=q.matricesIndices;t&&f.set(t,h.i.MatricesIndicesKind);const O=q.matricesWeights;O&&f.set(O,h.i.MatricesWeightsKind);const N=q.indices;N&&(f.indices=N);const w=q.materialInfos;if(w){f.materialInfos=[];for(const q of w){const j=new B;j.indexCount=q.indexCount,j.indexStart=q.indexStart,j.verticesCount=q.verticesCount,j.verticesStart=q.verticesStart,j.materialIndex=q.materialIndex,f.materialInfos.push(j)}}return f}static ImportVertexData(q,f){const j=D.Parse(q);f.setAllVerticesData(j,q.updatable)}}D.FRONTSIDE=0,D.BACKSIDE=1,D.DOUBLESIDE=2,D.DEFAULTSIDE=0,D._UniqueIdGenerator=0,(0,d.b)([r.c.filter((function(){for(var q=arguments.length,f=new Array(q),j=0;j<q;j++)f[j]=arguments[j];let[d]=f;return!Array.isArray(d)}))],D,"_TransformVector3Coordinates",null),(0,d.b)([r.c.filter((function(){for(var q=arguments.length,f=new Array(q),j=0;j<q;j++)f[j]=arguments[j];let[d]=f;return!Array.isArray(d)}))],D,"_TransformVector3Normals",null),(0,d.b)([r.c.filter((function(){for(var q=arguments.length,f=new Array(q),j=0;j<q;j++)f[j]=arguments[j];let[d]=f;return!Array.isArray(d)}))],D,"_TransformVector4Normals",null),(0,d.b)([r.c.filter((function(){for(var q=arguments.length,f=new Array(q),j=0;j<q;j++)f[j]=arguments[j];let[d]=f;return!Array.isArray(d)}))],D,"_FlipFaces",null)},11142:(q,f,j)=>{j.d(f,{d:()=>H});var d=j(11151),g=j(11161),h=j(11164),L=j(11177),Q=j(11186);class H{get materialDefines(){var q;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(q=this._getDrawWrapper())||void 0===q?void 0:q.defines}set materialDefines(q){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=q}_getDrawWrapper(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];q=q??this._engine.currentRenderPassId;let j=this._drawWrappers[q];return!j&&f&&(this._drawWrappers[q]=j=new Q.e(this._mesh.eq().getEngine())),j}_removeDrawWrapper(q){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var j;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(j=this._drawWrappers[q])||void 0===j||j.dispose(f));this._drawWrappers[q]=void 0}get effect(){var q;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(q=this._getDrawWrapper())||void 0===q?void 0:q.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(q){this._mainDrawWrapperOverride=q}setEffect(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2?arguments[2]:void 0,d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const g=this._drawWrapper;g.setEffect(q,f,d),void 0!==j&&(g.materialContext=j),q||(g.defines=null,g.materialContext=void 0)}resetDrawCache(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==q)return void this._removeDrawWrapper(q,!0,f);for(const q of this._drawWrappers)null===q||void 0===q||q.dispose(f)}this._drawWrappers=[]}static AddToMesh(q,f,j,d,g,h,L){return new H(q,f,j,d,g,h,L,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(q,f,j,d,g,h,L){let Q=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],H=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=q,this.verticesStart=f,this.verticesCount=j,this.indexStart=d,this.indexCount=g,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=h,this._renderingMesh=L||h,H&&h.Qd.push(this),this._engine=this._mesh.eq().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=h.Qd.length-1,Q&&(this.refreshBoundingInfo(),h.Nf(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(q){return this._boundingInfo=q,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const q=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return q||this._renderingMesh}bq(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const f=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!f)return q&&this._mesh.eq()._hasDefaultMaterial?this._mesh.eq().defaultMaterial:null;if(this._isMultiMaterial(f)){const q=f.getSubMaterial(this.materialIndex);return this._currentMaterial!==q&&(this._currentMaterial=q,this.resetDrawCache()),q}return f}_isMultiMaterial(q){return void 0!==q.getSubMaterial}refreshBoundingInfo(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.wf)return this;if(q||(q=this._renderingMesh.getVerticesData(d.i.PositionKind)),!q)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const f=this._renderingMesh.sf();let j;if(0===this.indexStart&&this.indexCount===f.length){const q=this._renderingMesh.getBoundingInfo();j={minimum:q.minimum.clone(),maximum:q.maximum.clone()}}else j=(0,L.e)(q,f,this.indexStart,this.indexCount,this._renderingMesh.wf.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(j.minimum,j.maximum):this._boundingInfo=new h.b(j.minimum,j.maximum),this}_checkCollision(q){return this.getBoundingInfo()._checkCollision(q)}updateBoundingInfo(q){let f=this.getBoundingInfo();return f||(this.refreshBoundingInfo(),f=this.getBoundingInfo()),f&&f.update(q),this}isInFrustum(q){const f=this.getBoundingInfo();return!!f&&f.isInFrustum(q,this._mesh.xX)}isCompletelyInFrustum(q){const f=this.getBoundingInfo();return!!f&&f.isCompletelyInFrustum(q)}render(q){return this._renderingMesh.render(this,q,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(q,f){if(!this._linesIndexBuffer){const j=6*Math.floor(this.indexCount/3),d=this.verticesStart+this.verticesCount>65535?new Uint32Array(j):new Uint16Array(j);let g=0;if(0===q.length)for(let q=this.indexStart;q<this.indexStart+this.indexCount;q+=3)d[g++]=q,d[g++]=q+1,d[g++]=q+1,d[g++]=q+2,d[g++]=q+2,d[g++]=q;else for(let f=this.indexStart;f<this.indexStart+this.indexCount;f+=3)d[g++]=q[f],d[g++]=q[f+1],d[g++]=q[f+1],d[g++]=q[f+2],d[g++]=q[f+2],d[g++]=q[f];this._linesIndexBuffer=f.createIndexBuffer(d),this._linesIndexCount=d.length}return this._linesIndexBuffer}canIntersects(q){const f=this.getBoundingInfo();return!!f&&q.intersectsBox(f.boundingBox)}intersects(q,f,j,d,g){const h=this.bq();if(!h)return null;let L=3,Q=!1;switch(h.fillMode){case 3:case 5:case 6:case 8:return null;case 7:L=1,Q=!0}return 4===h.fillMode?j.length?this._intersectLines(q,f,j,this._mesh.intersectionThreshold,d):this._intersectUnIndexedLines(q,f,j,this._mesh.intersectionThreshold,d):!j.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(q,f,j,d,g):this._intersectTriangles(q,f,j,L,Q,d,g)}_intersectLines(q,f,j,d,h){let L=null;for(let Q=this.indexStart;Q<this.indexStart+this.indexCount;Q+=2){const H=f[j[Q]],r=f[j[Q+1]],u=q.intersectionSegment(H,r,d);if(!(u<0)&&((h||!L||u<L.distance)&&(L=new g.d(null,null,u),L.faceId=Q/2,h)))break}return L}_intersectUnIndexedLines(q,f,j,d,h){let L=null;for(let Q=this.verticesStart;Q<this.verticesStart+this.verticesCount;Q+=2){const j=f[Q],H=f[Q+1],r=q.intersectionSegment(j,H,d);if(!(r<0)&&((h||!L||r<L.distance)&&(L=new g.d(null,null,r),L.faceId=Q/2,h)))break}return L}_intersectTriangles(q,f,j,d,g,h,L){let Q=null,H=-1;for(let r=this.indexStart;r<this.indexStart+this.indexCount-(3-d);r+=d){H++;const d=j[r],u=j[r+1],X=j[r+2];if(g&&4294967295===X){r+=2;continue}const z=f[d],B=f[u],D=f[X];if(!z||!B||!D)continue;if(L&&!L(z,B,D,q,d,u,X))continue;const i=q.intersectsTriangle(z,B,D);if(i){if(i.distance<0)continue;if((h||!Q||i.distance<Q.distance)&&(Q=i,Q.faceId=H,h))break}}return Q}_intersectUnIndexedTriangles(q,f,j,d,g){let h=null;for(let L=this.verticesStart;L<this.verticesStart+this.verticesCount;L+=3){const j=f[L],Q=f[L+1],H=f[L+2];if(g&&!g(j,Q,H,q,-1,-1,-1))continue;const r=q.intersectsTriangle(j,Q,H);if(r){if(r.distance<0)continue;if((d||!h||r.distance<h.distance)&&(h=r,h.faceId=L/3,d))break}}return h}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(q,f){const j=new H(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,q,f,!1);if(!this.IsGlobal){const q=this.getBoundingInfo();if(!q)return j;j._boundingInfo=new h.b(q.minimum,q.maximum)}return j}dispose(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.eq().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const f=this._mesh.Qd.indexOf(this);this._mesh.Qd.splice(f,1),this.resetDrawCache(void 0,q)}getClassName(){return"SubMesh"}static CreateFromIndices(q,f,j,d,g){let h=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],L=Number.MAX_VALUE,Q=-Number.MAX_VALUE;const r=(g||d).sf();for(let H=f;H<f+j;H++){const q=r[H];q<L&&(L=q),q>Q&&(Q=q)}return new H(q,L,Q-L+1,f,j,d,g,h)}}},11660:(q,f,j)=>{var d=j(11289),g=j(11151),h=j(10941),L=j(11005),Q=j(11164);d.e.prototype.thinInstanceAdd=function(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.eq().getEngine().getCaps().instancedArrays)return L.e.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(q)?q.length:1);const j=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(q))for(let d=0;d<q.length;++d)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,q[d],d===q.length-1&&f);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,q,f);return j},d.e.prototype.thinInstanceAddSelf=function(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(h.b.IdentityReadOnly,q)},d.e.prototype.thinInstanceRegisterAttribute=function(q,f){q===g.i.ColorKind&&(q=g.i.ColorInstanceKind),this.removeVerticesData(q),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[q]=f,this._userThinInstanceBuffersStorage.sizes[q]=f*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[q]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[q]),this._userThinInstanceBuffersStorage.vertexBuffers[q]=new g.i(this.getEngine(),this._userThinInstanceBuffersStorage.data[q],q,!0,!1,f,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[q])},d.e.prototype.thinInstanceSetMatrixAt=function(q,f){let j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||q>=this._thinInstanceDataStorage.instancesCount)return!1;const d=this._thinInstanceDataStorage.matrixData;return f.copyToArray(d,16*q),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[q]=f),j&&(this.yX("matrix"),this.vq||this.thinInstanceRefreshBoundingInfo(!1)),!0},d.e.prototype.thinInstanceSetAttributeAt=function(q,f,j){let d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return q===g.i.ColorKind&&(q=g.i.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[q]||f>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(q,0),this._userThinInstanceBuffersStorage.data[q].set(j,f*this._userThinInstanceBuffersStorage.strides[q]),d&&this.yX(q),!0)},Object.defineProperty(d.e.prototype,"ud",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(q){var f;const j=this._thinInstanceDataStorage.matrixData??(null===(f=this.source)||void 0===f?void 0:f._thinInstanceDataStorage.matrixData);q<=(j?j.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=q)},enumerable:!0,configurable:!0}),d.e.prototype._thinInstanceCreateMatrixBuffer=function(q,f){let j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const d=new g.e(this.getEngine(),f,!j,16,!1,!0);for(let g=0;g<4;g++)this.setVerticesBuffer(d.createVertexBuffer(q+g,4*g,4));return d},d.e.prototype.kX=function(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var h;if(j=j||16,"matrix"===q)null===(h=this._thinInstanceDataStorage.matrixBuffer)||void 0===h||h.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=f?f.length:32*j,this._thinInstanceDataStorage.matrixData=f,this._thinInstanceDataStorage.worldMatrices=null,null!==f?(this._thinInstanceDataStorage.instancesCount=f.length/j,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",f,d),this.vq||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.vq||this.refreshBoundingInfo());else if("previousMatrix"===q){var L;null===(L=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===L||L.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=f,null!==f&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",f,d))}else{var Q;if(q===g.i.ColorKind&&(q=g.i.ColorInstanceKind),null===f)null!==(Q=this._userThinInstanceBuffersStorage)&&void 0!==Q&&Q.data[q]&&(this.removeVerticesData(q),delete this._userThinInstanceBuffersStorage.data[q],delete this._userThinInstanceBuffersStorage.strides[q],delete this._userThinInstanceBuffersStorage.sizes[q],delete this._userThinInstanceBuffersStorage.vertexBuffers[q]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[q]=f,this._userThinInstanceBuffersStorage.strides[q]=j,this._userThinInstanceBuffersStorage.sizes[q]=f.length,this._userThinInstanceBuffersStorage.vertexBuffers[q]=new g.i(this.getEngine(),f,q,!d,!1,j,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[q])}},d.e.prototype.yX=function(q){var f;if("matrix"===q)this.Pz&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(q),null===(f=this._thinInstanceDataStorage.matrixBuffer)||void 0===f||f.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===q){var j;this.Pz&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(q),null===(j=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===j||j.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var d;q===g.i.ColorKind&&(q=g.i.ColorInstanceKind),null!==(d=this._userThinInstanceBuffersStorage)&&void 0!==d&&d.vertexBuffers[q]&&(this.Pz&&!this._userThinInstanceBuffersStorage.vertexBuffers[q].isUpdatable()&&this._thinInstanceRecreateBuffer(q),this._userThinInstanceBuffersStorage.vertexBuffers[q].updateDirectly(this._userThinInstanceBuffersStorage.data[q],0))}},d.e.prototype.thinInstancePartialBufferUpdate=function(q,f,j){var d;"matrix"===q?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(f,j):(q===g.i.ColorKind&&(q=g.i.ColorInstanceKind),null!==(d=this._userThinInstanceBuffersStorage)&&void 0!==d&&d.vertexBuffers[q]&&this._userThinInstanceBuffersStorage.vertexBuffers[q].updateDirectly(f,j))},d.e.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const q=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let f=0;f<this._thinInstanceDataStorage.instancesCount;++f)this._thinInstanceDataStorage.worldMatrices[f]=h.b.Pf(q,16*f)}return this._thinInstanceDataStorage.worldMatrices},d.e.prototype.thinInstanceRefreshBoundingInfo=function(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const d=this._thinInstanceDataStorage.boundingVectors;if(q||!this.rawBoundingInfo){d.length=0,this.refreshBoundingInfo(f,j);const q=this.getBoundingInfo();this.rawBoundingInfo=new Q.b(q.minimum,q.maximum)}const g=this.getBoundingInfo(),L=this._thinInstanceDataStorage.matrixData;if(0===d.length)for(let h=0;h<g.boundingBox.vectors.length;++h)d.push(g.boundingBox.vectors[h].clone());h.f.kf[0].cf(Number.POSITIVE_INFINITY),h.f.kf[1].cf(Number.NEGATIVE_INFINITY);for(let Q=0;Q<this._thinInstanceDataStorage.instancesCount;++Q){h.b.FromArrayToRef(L,16*Q,h.f.Matrix[0]);for(let q=0;q<d.length;++q)h.j.TransformCoordinatesToRef(d[q],h.f.Matrix[0],h.f.kf[2]),h.f.kf[0].minimizeInPlace(h.f.kf[2]),h.f.kf[1].maximizeInPlace(h.f.kf[2])}g.reConstruct(h.f.kf[0],h.f.kf[1]),this.Fq()},d.e.prototype._thinInstanceRecreateBuffer=function(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var j;if("matrix"===q)null===(j=this._thinInstanceDataStorage.matrixBuffer)||void 0===j||j.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,f);else if("previousMatrix"===q){var d;if(this._scene.needsPreviousWorldMatrices)null===(d=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===d||d.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,f)}else{var h;q===g.i.ColorKind&&(q=g.i.ColorInstanceKind),null===(h=this._userThinInstanceBuffersStorage.vertexBuffers[q])||void 0===h||h.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[q]=new g.i(this.getEngine(),this._userThinInstanceBuffersStorage.data[q],q,!f,!1,this._userThinInstanceBuffersStorage.strides[q],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[q])}},d.e.prototype._thinInstanceUpdateBufferSize=function(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;q===g.i.ColorKind&&(q=g.i.ColorInstanceKind);const j="matrix"===q;if(!j&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[q]))return;const d=j?16:this._userThinInstanceBuffersStorage.strides[q],h=j?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[q];let L=j?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[q];const Q=(this._thinInstanceDataStorage.instancesCount+f)*d;let H=h;for(;H<Q;)H*=2;if(!L||h!=H){if(L){const q=new Float32Array(H);q.set(L,0),L=q}else L=new Float32Array(H);var r,u,X;if(j){if(null===(r=this._thinInstanceDataStorage.matrixBuffer)||void 0===r||r.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",L,!1),this._thinInstanceDataStorage.matrixData=L,this._thinInstanceDataStorage.matrixBufferSize=H,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(u=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===u||u.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",L,!1)}else null===(X=this._userThinInstanceBuffersStorage.vertexBuffers[q])||void 0===X||X.dispose(),this._userThinInstanceBuffersStorage.data[q]=L,this._userThinInstanceBuffersStorage.sizes[q]=H,this._userThinInstanceBuffersStorage.vertexBuffers[q]=new g.i(this.getEngine(),L,q,!0,!1,d,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[q])}},d.e.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},d.e.prototype._disposeThinInstanceSpecificData=function(){var q;null!==(q=this._thinInstanceDataStorage)&&void 0!==q&&q.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},11245:(q,f,j)=>{j.d(f,{b:()=>u});var d=j(11125),g=j(11130),h=j(11199),L=j(10982),Q=j(10941),H=j(11247),r=j(10965);class u extends H.d{get billboardMode(){return this._billboardMode}set billboardMode(q){this._billboardMode!==q&&(this._billboardMode=q,this._cache.useBillboardPosition=0!==(this._billboardMode&u.BILLBOARDMODE_USE_POSITION))}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(q){this._infiniteDistance!==q&&(this._infiniteDistance=q)}constructor(q){let f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(q,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new Q.j(0,0,1),this._up=new Q.j(0,1,0),this._right=new Q.j(1,0,0),this._position=Q.j.Zero(),this._rotation=Q.j.Zero(),this._rotationQuaternion=null,this._scaling=Q.j.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=u.BILLBOARDMODE_NONE,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.Gz=Q.b.Zero(),this._usePivotMatrix=!1,this._absolutePosition=Q.j.Zero(),this._absoluteScaling=Q.j.Zero(),this._absoluteRotationQuaternion=Q.e.Identity(),this._pivotMatrix=Q.b.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new L.d,this._nonUniformScaling=!1,f&&this.eq().addTransformNode(this)}getClassName(){return"Ed"}get position(){return this._position}set position(q){this._position=q,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(q){this._rotation=q,this._rotationQuaternion=null,this._markAsDirtyInternal()}get Vf(){return this._scaling}set Vf(q){this._scaling=q,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(q){this._rotationQuaternion=q,q&&this._rotation.cf(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return Q.j.TransformNormalFromFloatsToRef(0,0,this.eq().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return Q.j.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return Q.j.TransformNormalFromFloatsToRef(this.eq().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(q){return this._poseMatrix?(this._poseMatrix.H(q),this):(this._poseMatrix=q.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=Q.b.Identity()),this._poseMatrix}_isSynchronized(){const q=this._cache;return this._billboardMode===q.billboardMode&&this._billboardMode===u.BILLBOARDMODE_NONE&&(!q.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const q=this._cache;q.localMatrixUpdated=!1,q.billboardMode=-1,q.infiniteDistance=!1,q.useBillboardPosition=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(q){return this.setPivotMatrix(q,!1)}setPivotMatrix(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.H(q),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=f,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=Q.b.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,f=arguments.length>1?arguments[1]:void 0,j=arguments.length>2?arguments[2]:void 0;const d=this.clone("Clone of "+(this.name||this.id),q||this.parent,!0);d&&j&&j(this,d);for(const g of this.getChildTransformNodes(!0))g.instantiateHierarchy(d,f,j);return d}yg(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return q?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.cf(0),this._rotationQuaternion=this._rotationQuaternion||Q.e.Identity(),q.decompose(this._scaling,this._rotationQuaternion,this._position),this.Nf(!0)):(this._worldMatrix=q,this._absolutePosition.Af(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.Nf(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.Nf(!0),this}get Sz(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.Nf(),this._absolutePosition}setAbsolutePosition(q){if(!q)return this;let f,j,d;if(void 0===q.x){if(arguments.length<3)return this;f=arguments[0],j=arguments[1],d=arguments[2]}else f=q.x,j=q.y,d=q.z;if(this.parent){const q=Q.f.Matrix[0];this.parent.getWorldMatrix().invertToRef(q),Q.j.TransformCoordinatesFromFloatsToRef(f,j,d,q,this.position)}else this.position.x=f,this.position.y=j,this.position.z=d;return this._absolutePosition.H(q),this}setPositionWithLocalVector(q){return this.Nf(),this.position=Q.j.TransformNormal(q,this.Gz),this}getPositionExpressedInLocalSpace(){this.Nf();const q=Q.f.Matrix[0];return this.Gz.invertToRef(q),Q.j.TransformNormal(this.position,q)}locallyTranslate(q){return this.Nf(!0),this.position=Q.j.TransformCoordinates(q,this.Gz),this}lookAt(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const h=u._LookAtVectorCache,L=0===g?this.position:this.getAbsolutePosition();if(q.subtractToRef(L,h),this.setDirection(h,f,j,d),1===g&&this.parent)if(this.rotationQuaternion){const q=Q.f.Matrix[0];this.rotationQuaternion.toRotationMatrix(q);const f=Q.f.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(f),f.invert(),q.multiplyToRef(f,q),this.rotationQuaternion.fromRotationMatrix(q)}else{const q=Q.f.Quaternion[0];Q.e.FromEulerVectorToRef(this.rotation,q);const f=Q.f.Matrix[0];q.toRotationMatrix(f);const j=Q.f.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(j),j.invert(),f.multiplyToRef(j,f),q.fromRotationMatrix(f),q.toEulerAnglesToRef(this.rotation)}return this}jr(q){const f=Q.j.Zero();return this.getDirectionToRef(q,f),f}getDirectionToRef(q,f){return Q.j.TransformNormalToRef(q,this.getWorldMatrix(),f),this}setDirection(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const g=-Math.atan2(q.z,q.x)+Math.PI/2,h=Math.sqrt(q.x*q.x+q.z*q.z),L=-Math.atan2(q.y,h);return this.rotationQuaternion?Q.e.RotationYawPitchRollToRef(g+f,L+j,d,this.rotationQuaternion):(this.rotation.x=L+j,this.rotation.y=g+f,this.rotation.z=d),this}setPivotPoint(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.eq().getRenderId()&&this.Nf(!0);const j=this.getWorldMatrix();if(1==f){const f=Q.f.Matrix[0];j.invertToRef(f),q=Q.j.TransformCoordinates(q,f)}return this.setPivotMatrix(Q.b.Translation(-q.x,-q.y,-q.z),!0)}getPivotPoint(){const q=Q.j.Zero();return this.getPivotPointToRef(q),q}getPivotPointToRef(q){return q.x=-this._pivotMatrix.m[12],q.y=-this._pivotMatrix.m[13],q.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const q=Q.j.Zero();return this.getAbsolutePivotPointToRef(q),q}getAbsolutePivotPointToRef(q){return this.getPivotPointToRef(q),Q.j.TransformCoordinatesToRef(q,this.getWorldMatrix(),q),this}zu(q){if(this._isDirty)return this;if(this._children)for(const f of this._children)f.zu(q);return super.zu(q)}setParent(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!q&&!this.parent)return this;const d=Q.f.Quaternion[0],g=Q.f.kf[0],h=Q.f.kf[1],L=Q.f.Matrix[1];Q.b.IdentityToRef(L);const H=Q.f.Matrix[0];this.Nf(!0);let r=this.rotationQuaternion;return r||(r=u._TmpRotation,Q.e.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,r)),Q.b.ComposeToRef(this.Vf,r,this.position,H),this.parent&&H.multiplyToRef(this.parent.Nf(!0),H),q&&(q.Nf(!0).invertToRef(L),H.multiplyToRef(L,H)),H.decompose(h,d,g,f?this:void 0),this.rotationQuaternion?this.rotationQuaternion.H(d):d.toEulerAnglesToRef(this.rotation),this.Vf.H(h),this.position.H(g),this.parent=q,j&&this.setPivotMatrix(Q.b.Identity()),this}addChild(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return q.setParent(this,f),this}removeChild(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return q.parent!==this||q.setParent(null,f),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(q){return this._nonUniformScaling!==q&&(this._nonUniformScaling=q,!0)}attachToBone(q,f){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=f,this.parent=q,q.getSkeleton().prepare(!0),q.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=q?this._currentParentWhenAttachingToBone:null,this):(q&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(q,f,j){let d;if(q.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.cf(0)),j&&0!==j){if(this.parent){const j=this.parent.getWorldMatrix(),d=Q.f.Matrix[0];j.invertToRef(d),q=Q.j.TransformNormal(q,d),j.determinant()<0&&(f*=-1)}d=Q.e.RotationAxisToRef(q,f,u._RotationAxisCache),d.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else d=Q.e.RotationAxisToRef(q,f,u._RotationAxisCache),this.rotationQuaternion.multiplyToRef(d,this.rotationQuaternion);return this}rotateAround(q,f,j){f.normalize(),this.rotationQuaternion||(this.rotationQuaternion=Q.e.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.cf(0));const d=Q.f.kf[0],g=Q.f.kf[1],h=Q.f.kf[2],L=Q.f.Quaternion[0],H=Q.f.Matrix[0],r=Q.f.Matrix[1],u=Q.f.Matrix[2],X=Q.f.Matrix[3];return q.subtractToRef(this.position,d),Q.b.TranslationToRef(d.x,d.y,d.z,H),Q.b.TranslationToRef(-d.x,-d.y,-d.z,r),Q.b.RotationAxisToRef(f,j,u),r.multiplyToRef(u,X),X.multiplyToRef(H,X),X.decompose(g,L,h),this.position.addInPlace(h),L.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(q,f,j){const d=q.scale(f);if(j&&0!==j)this.setAbsolutePosition(this.getAbsolutePosition().add(d));else{const q=this.getPositionExpressedInLocalSpace().add(d);this.setPositionWithLocalVector(q)}return this}addRotation(q,f,j){let d;this.rotationQuaternion?d=this.rotationQuaternion:(d=Q.f.Quaternion[1],Q.e.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,d));const g=Q.f.Quaternion[0];return Q.e.RotationYawPitchRollToRef(f,q,j,g),d.multiplyInPlace(g),this.rotationQuaternion||d.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==u.BILLBOARDMODE_NONE}Nf(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const j=this.eq().getRenderId();if(!this._isDirty&&!q&&(this._currentRenderId===j||this.isSynchronized()))return this._currentRenderId=j,this._worldMatrix;f=f||this.eq().activeCamera,this._updateCache();const d=this._cache;d.pivotMatrixUpdated=!1,d.billboardMode=this.billboardMode,d.infiniteDistance=this.infiniteDistance,d.parent=this._parentNode,this._currentRenderId=j,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const g=this._getEffectiveParent(),h=u._TmpScaling;let L,H=this._position;if(this._infiniteDistance&&!this.parent&&f){const q=f.getWorldMatrix(),j=new Q.j(q.m[12],q.m[13],q.m[14]);H=u._TmpTranslation,H.Af(this._position.x+j.x,this._position.y+j.y,this._position.z+j.z)}if(h.Af(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,L=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(Q.e.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.Af(0,0,0))}}else L=u._TmpRotation,Q.e.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,L);if(this._usePivotMatrix){const q=Q.f.Matrix[1];Q.b.ScalingToRef(h.x,h.y,h.z,q);const f=Q.f.Matrix[0];L.toRotationMatrix(f),this._pivotMatrix.multiplyToRef(q,Q.f.Matrix[4]),Q.f.Matrix[4].multiplyToRef(f,this.Gz),this._postMultiplyPivotMatrix&&this.Gz.multiplyToRef(this._pivotMatrixInverse,this.Gz),this.Gz.addTranslationFromFloats(H.x,H.y,H.z)}else Q.b.ComposeToRef(h,L,H,this.Gz);if(g&&g.getWorldMatrix){if(q&&g.Nf(q),this.billboardMode){if(this._transformToBoneReferal){const q=this.parent;q.getSkeleton().prepare(),q.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),Q.f.Matrix[7])}else Q.f.Matrix[7].H(g.getWorldMatrix());const q=Q.f.kf[5],f=Q.f.kf[6],j=Q.f.Quaternion[0];Q.f.Matrix[7].decompose(f,j,q),Q.b.ScalingToRef(f.x,f.y,f.z,Q.f.Matrix[7]),Q.f.Matrix[7].setTranslation(q),u.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(j,q),this.Gz.setTranslation(q)),this.Gz.multiplyToRef(Q.f.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const q=this.parent;q.getSkeleton().prepare(),this.Gz.multiplyToRef(q.getFinalMatrix(),Q.f.Matrix[6]),Q.f.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.Gz.multiplyToRef(g.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.H(this.Gz);if(f&&this.billboardMode)if(d.useBillboardPosition){if(d.useBillboardPosition){const q=Q.f.kf[0];this._worldMatrix.getTranslationToRef(q);const j=f.globalPosition;this._worldMatrix.invertToRef(Q.f.Matrix[1]);const d=Q.f.kf[1];Q.j.TransformCoordinatesToRef(j,Q.f.Matrix[1],d),d.normalize();const g=-Math.atan2(d.z,d.x)+Math.PI/2,h=Math.sqrt(d.x*d.x+d.z*d.z),L=-Math.atan2(d.y,h);if(Q.e.RotationYawPitchRollToRef(g,L,0,Q.f.Quaternion[0]),(this.billboardMode&u.BILLBOARDMODE_ALL)!==u.BILLBOARDMODE_ALL){const q=Q.f.kf[1];Q.f.Quaternion[0].toEulerAnglesToRef(q),(this.billboardMode&u.BILLBOARDMODE_X)!==u.BILLBOARDMODE_X&&(q.x=0),(this.billboardMode&u.BILLBOARDMODE_Y)!==u.BILLBOARDMODE_Y&&(q.y=0),(this.billboardMode&u.BILLBOARDMODE_Z)!==u.BILLBOARDMODE_Z&&(q.z=0),Q.b.RotationYawPitchRollToRef(q.y,q.x,q.z,Q.f.Matrix[0])}else Q.b.FromQuaternionToRef(Q.f.Quaternion[0],Q.f.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(Q.f.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(Q.f.kf[0])}}else{const q=Q.f.kf[0];if(this._worldMatrix.getTranslationToRef(q),Q.f.Matrix[1].H(f.getViewMatrix()),Q.f.Matrix[1].setTranslationFromFloats(0,0,0),Q.f.Matrix[1].invertToRef(Q.f.Matrix[0]),(this.billboardMode&u.BILLBOARDMODE_ALL)!==u.BILLBOARDMODE_ALL){Q.f.Matrix[0].decompose(void 0,Q.f.Quaternion[0],void 0);const q=Q.f.kf[1];Q.f.Quaternion[0].toEulerAnglesToRef(q),(this.billboardMode&u.BILLBOARDMODE_X)!==u.BILLBOARDMODE_X&&(q.x=0),(this.billboardMode&u.BILLBOARDMODE_Y)!==u.BILLBOARDMODE_Y&&(q.y=0),(this.billboardMode&u.BILLBOARDMODE_Z)!==u.BILLBOARDMODE_Z&&(q.z=0),Q.b.RotationYawPitchRollToRef(q.y,q.x,q.z,Q.f.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(Q.f.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(Q.f.kf[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):g&&g._nonUniformScaling?this._updateNonUniformScalingState(g._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.Af(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=Q.b.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.Nf(),q){const q=this.getChildren();for(let f=0;f<q.length;++f){const j=q[f];if(j){j.Nf();const q=Q.f.Matrix[0];j.Gz.multiplyToRef(this.Gz,q);const f=Q.f.Quaternion[0];q.decompose(j.Vf,f,j.position),j.rotationQuaternion?j.rotationQuaternion.H(f):f.toEulerAnglesToRef(j.rotation)}}}this.Vf.Af(1,1,1),this.position.Af(0,0,0),this.rotation.Af(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=Q.e.Identity()),this._worldMatrix=Q.b.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(q){return this.onAfterWorldMatrixUpdateObservable.add(q),this}unregisterAfterWorldMatrixUpdate(q){return this.onAfterWorldMatrixUpdateObservable.removeCallback(q),this}getPositionInCameraSpace(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return q||(q=this.eq().activeCamera),Q.j.TransformCoordinates(this.getAbsolutePosition(),q.getViewMatrix())}getDistanceToCamera(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return q||(q=this.eq().activeCamera),this.getAbsolutePosition().ej(q.globalPosition).length()}clone(q,f,j){const d=h.d.Clone((()=>new u(q,this.eq())),this);if(d.name=q,d.id=q,f&&(d.parent=f),!j){const f=this.getDescendants(!0);for(let j=0;j<f.length;j++){const g=f[j];g.clone&&g.clone(q+"."+g.name,d)}}return d}serialize(q){const f=h.d.Serialize(this,q);return f.type=this.getClassName(),f.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(f),f.localMatrix=this.getPivotMatrix().Yf(),f.isEnabled=this.isEnabled(),h.d.AppendSerializedAnimations(this,f),f.ranges=this.serializeAnimationRanges(),f}static Parse(q,f,j){const d=h.d.Parse((()=>new u(q.name,f)),q,f,j);if(q.localMatrix?d.setPreTransformMatrix(Q.b.Pf(q.localMatrix)):q.pivotMatrix&&d.setPivotMatrix(Q.b.Pf(q.pivotMatrix)),d.DH(q.isEnabled),d._waitingParsedUniqueId=q.uniqueId,void 0!==q.parentId&&(d._waitingParentId=q.parentId),void 0!==q.parentInstanceIndex&&(d._waitingParentInstanceIndex=q.parentInstanceIndex),q.animations){for(let f=0;f<q.animations.length;f++){const j=q.animations[f],g=(0,r.c)("BABYLON.Animation");g&&d.animations.push(g.Parse(j))}H.d.ParseAnimationRanges(d,q,f)}return q.autoAnimate&&f.beginAnimation(d,q.autoAnimateFrom,q.autoAnimateTo,q.autoAnimateLoop,q.autoAnimateSpeed||1),d}getChildTransformNodes(q,f){const j=[];return this._getDescendants(j,q,(q=>(!f||f(q))&&q instanceof u)),j}dispose(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.eq().stopAnimation(this),this.eq().removeTransformNode(this),this._parentContainer){const q=this._parentContainer.transformNodes.indexOf(this);q>-1&&this._parentContainer.transformNodes.splice(q,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),q){const q=this.getChildTransformNodes(!0);for(const f of q)f.parent=null,f.Nf(!0)}super.dispose(q,f)}normalizeToUnitCube(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2?arguments[2]:void 0,d=null,g=null;f&&(this.rotationQuaternion?(g=this.rotationQuaternion.clone(),this.rotationQuaternion.Af(0,0,0,1)):this.rotation&&(d=this.rotation.clone(),this.rotation.Af(0,0,0)));const h=this.getHierarchyBoundingVectors(q,j),L=h.max.ej(h.min),Q=Math.max(L.x,L.y,L.z);if(0===Q)return this;const H=1/Q;return this.Vf.scaleInPlace(H),f&&(this.rotationQuaternion&&g?this.rotationQuaternion.H(g):this.rotation&&d&&this.rotation.H(d)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}u.BILLBOARDMODE_NONE=0,u.BILLBOARDMODE_X=1,u.BILLBOARDMODE_Y=2,u.BILLBOARDMODE_Z=4,u.BILLBOARDMODE_ALL=7,u.BILLBOARDMODE_USE_POSITION=128,u.BillboardUseParentOrientation=!1,u._TmpRotation=Q.e.Zero(),u._TmpScaling=Q.j.Zero(),u._TmpTranslation=Q.j.Zero(),u._LookAtVectorCache=new Q.j(0,0,0),u._RotationAxisCache=new Q.e,(0,d.b)([(0,g.M)("position")],u.prototype,"_position",void 0),(0,d.b)([(0,g.M)("rotation")],u.prototype,"_rotation",void 0),(0,d.b)([(0,g.B)("rotationQuaternion")],u.prototype,"_rotationQuaternion",void 0),(0,d.b)([(0,g.M)("Vf")],u.prototype,"_scaling",void 0),(0,d.b)([(0,g.O)("billboardMode")],u.prototype,"_billboardMode",void 0),(0,d.b)([(0,g.O)()],u.prototype,"scalingDeterminant",void 0),(0,d.b)([(0,g.O)("infiniteDistance")],u.prototype,"_infiniteDistance",void 0),(0,d.b)([(0,g.O)()],u.prototype,"ignoreNonUniformScaling",void 0),(0,d.b)([(0,g.O)()],u.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},11581:(q,f,j)=>{j.d(f,{d:()=>r});var d=j(10941),g=j(10985),h=j(11389),L=j(10950),Q=j(11210);class H{constructor(q,f,j,d){this.name=q,this.worldAxisForNormal=f,this.worldAxisForFileX=j,this.worldAxisForFileY=d}}class r{static ConvertCubeMapTextureToSphericalPolynomial(q){var f;if(!q.isCube)return null;null===(f=q.eq())||void 0===f||f.getEngine().flushFramebuffer();const j=q.getSize().width,d=q.readPixels(0,void 0,void 0,!1),g=q.readPixels(1,void 0,void 0,!1);let h,L;q.isRenderTarget?(h=q.readPixels(3,void 0,void 0,!1),L=q.readPixels(2,void 0,void 0,!1)):(h=q.readPixels(2,void 0,void 0,!1),L=q.readPixels(3,void 0,void 0,!1));const Q=q.readPixels(4,void 0,void 0,!1),H=q.readPixels(5,void 0,void 0,!1),r=q.gammaSpace;let u=0;return 1!=q.textureType&&2!=q.textureType||(u=1),new Promise((q=>{Promise.all([g,d,h,L,Q,H]).then((f=>{let[d,g,h,L,Q,H]=f;const X={size:j,right:g,left:d,up:h,down:L,front:Q,back:H,format:5,type:u,gammaSpace:r};q(this.ConvertCubeMapToSphericalPolynomial(X))}))}))}static _AreaElement(q,f){return Math.atan2(q*f,Math.sqrt(q*q+f*f+1))}static ConvertCubeMapToSphericalPolynomial(q){const f=new h.b;let j=0;const d=2/q.size,H=d,r=.5*d,u=r-1;for(let h=0;h<6;h++){const X=this._FileFaces[h],z=q[X.name];let B=u;const D=5===q.format?4:3;for(let h=0;h<q.size;h++){let i=u;for(let H=0;H<q.size;H++){const u=X.worldAxisForFileX.scale(i).add(X.worldAxisForFileY.scale(B)).add(X.worldAxisForNormal);u.normalize();const t=this._AreaElement(i-r,B-r)-this._AreaElement(i-r,B+r)-this._AreaElement(i+r,B-r)+this._AreaElement(i+r,B+r);let O=z[h*q.size*D+H*D+0],N=z[h*q.size*D+H*D+1],w=z[h*q.size*D+H*D+2];isNaN(O)&&(O=0),isNaN(N)&&(N=0),isNaN(w)&&(w=0),0===q.type&&(O/=255,N/=255,w/=255),q.gammaSpace&&(O=Math.pow((0,g.Clamp)(O),L.k),N=Math.pow((0,g.Clamp)(N),L.k),w=Math.pow((0,g.Clamp)(w),L.k));const E=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const q=Math.max(O,N,w);if(q>E){const f=E/q;O*=f,N*=f,w*=f}}else O=(0,g.Clamp)(O,0,E),N=(0,g.Clamp)(N,0,E),w=(0,g.Clamp)(w,0,E);const s=new Q.c(O,N,w);f.addLight(u,s,t),j+=t,i+=d}B+=H}}const X=6*(4*Math.PI)/6/j;return f.scaleInPlace(X),f.convertIncidentRadianceToIrradiance(),f.convertIrradianceToLambertianRadiance(),h.f.FromHarmonics(f)}}r._FileFaces=[new H("right",new d.j(1,0,0),new d.j(0,0,-1),new d.j(0,-1,0)),new H("left",new d.j(-1,0,0),new d.j(0,0,1),new d.j(0,-1,0)),new H("up",new d.j(0,1,0),new d.j(1,0,0),new d.j(0,0,1)),new H("down",new d.j(0,-1,0),new d.j(1,0,0),new d.j(0,0,-1)),new H("front",new d.j(0,0,1),new d.j(1,0,0),new d.j(0,-1,0)),new H("back",new d.j(0,0,-1),new d.j(-1,0,0),new d.j(0,-1,0))],r.MAX_HDRI_VALUE=4096,r.PRESERVE_CLAMPED_COLORS=!1},10958:(q,f,j)=>{function d(q,f){const j=[];for(let d=0;d<q;++d)j.push(f());return j}function g(q,f){return d(q,f)}j.d(f,{e:()=>d,h:()=>g,j:()=>L});const h=["push","splice","pop","shift","unshift"];function L(q,f){const j=h.map((j=>function(q,f,j){const d=q[f];if("function"!==typeof d)return null;const g=function(){const d=q.length,h=g.previous.apply(q,arguments);return j(f,d),h};return d.next=g,g.previous=d,q[f]=g,()=>{const j=g.previous;if(!j)return;const d=g.next;d?(j.next=d,d.previous=j):(j.next=void 0,q[f]=j),g.next=void 0,g.previous=void 0}}(q,j,f)));return()=>{for(const q of j)null===q||void 0===q||q()}}},11491:(q,f,j)=>{j.d(f,{d:()=>L});var d=j(11438),g=j(11497);let h=0;const L=q=>{if(!q.environmentBRDFTexture){const f=q.useDelayedTextureLoading;q.useDelayedTextureLoading=!1;const j=q._blockEntityCollection;q._blockEntityCollection=!1;const L=d.e.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+h++,q,!0,!1,d.e.BILINEAR_SAMPLINGMODE);q._blockEntityCollection=j;const Q=q.getEngine().getLoadedTexturesCache(),H=Q.indexOf(L.getInternalTexture());-1!==H&&Q.splice(H,1),L.isRGBD=!0,L.wrapU=d.e.CLAMP_ADDRESSMODE,L.wrapV=d.e.CLAMP_ADDRESSMODE,q.environmentBRDFTexture=L,q.useDelayedTextureLoading=f,g.d.ExpandRGBDTexture(L);const r=q.getEngine().onContextRestoredObservable.add((()=>{L.isRGBD=!0;const f=q.onBeforeRenderObservable.add((()=>{L.isReady()&&(q.onBeforeRenderObservable.remove(f),g.d.ExpandRGBDTexture(L))}))}));q.qd.add((()=>{q.getEngine().onContextRestoredObservable.remove(r)}))}return q.environmentBRDFTexture}},11259:(q,f,j)=>{function d(q,f,j){try{const d=q.next();d.done?f(d):d.value?d.value.then((()=>{d.value=void 0,f(d)}),j):f(d)}catch(d){j(d)}}function g(){let q,f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(j,g,h)=>{const L=performance.now();void 0===q||L-q>f?(q=L,setTimeout((()=>{d(j,g,h)}),0)):d(j,g,h)}}function h(q,f,j,d,g){const h=()=>{let L;const Q=q=>{q.done?j(q.value):void 0===L?L=!0:h()};do{L=void 0,g&&g.aborted?d(new Error("Aborted")):f(q,Q,d),void 0===L&&(L=!1)}while(L)};h()}function L(q,f){let j;return h(q,d,(q=>j=q),(q=>{throw q}),f),j}async function Q(q,f,j){return await new Promise(((d,g)=>{h(q,f,d,g,j)}))}function H(q,f){return function(){return L(q(...arguments),f)}}j.d(f,{d:()=>g,h:()=>H,k:()=>Q,o:()=>L})},11133:(q,f,j)=>{j.d(f,{b:()=>h,f:()=>L});const d={},g={};function h(q){const f=q.getClassName();return g[f]||(g[f]={}),g[f]}function L(q){const f=q.getClassName();if(d[f])return d[f];d[f]={};const j=d[f];let h=q,L=f;for(;L;){const q=g[L];for(const g in q)j[g]=q[g];let f,d=!1;do{if(f=Object.getPrototypeOf(h),!f.getClassName){d=!0;break}if(f.getClassName()!==L)break;h=f}while(f);if(d)break;L=f.getClassName(),h=f}return j}},11130:(q,f,j)=>{j.d(f,{B:()=>t,F:()=>Q,I:()=>u,M:()=>X,O:()=>L,b:()=>h,c:()=>N,f:()=>B,i:()=>H,l:()=>D,p:()=>r,s:()=>i,v:()=>O,x:()=>z});var d=j(11133);function g(q,f){return(j,g)=>{const h=(0,d.b)(j);h[g]||(h[g]={type:q,sourceName:f})}}function h(q){return function(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(j,d)=>{const g=f||"_"+d;Object.defineProperty(j,d,{get:function(){return this[g]},set:function(f){var d;"function"===typeof(null===(d=this[g])||void 0===d?void 0:d.equals)&&this[g].equals(f)||this[g]!==f&&(this[g]=f,j[q].apply(this))},enumerable:!0,configurable:!0})}}(q,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)}function L(q){return g(0,q)}function Q(q){return g(1,q)}function H(q){return g(2,q)}function r(q){return g(3,q)}function u(q){return g(4,q)}function X(q){return g(5,q)}function z(q){return g(6,q)}function B(q){return g(7,q)}function D(q){return g(8,q)}function i(q){return g(9,q)}function t(q){return g(10,q)}function O(q){return g(12,q)}function N(q,f,j,d){const g=j.value;j.value=function(){let j=g;if("undefined"!==typeof _native&&_native[f]){const q=_native[f];j=d?function(){return d(...arguments)?q(...arguments):g(...arguments)}:q}return q[f]=j,j(...arguments)}}N.filter=function(q){return(f,j,d)=>N(f,j,d,q)}},11199:(q,f,j)=>{j.d(f,{d:()=>r});var d=j(11016),g=j(11202),h=j(11210),L=j(10941),Q=j(11133);const H=function(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const h=q();g.c&&g.c.HasTags(f)&&g.c.AddTagsTo(h,g.c.GetTags(f,!0));const L=(0,Q.f)(h),H={};for(const g in L){const q=L[g],Q=f[g],u=q.type;if(void 0!==Q&&null!==Q&&("uniqueId"!==g||r.AllowLoadingUniqueId))switch(u){case 0:case 6:case 9:case 11:h[g]=Q;break;case 1:d.cloneTexturesOnlyOnce&&H[Q.uniqueId]?h[g]=H[Q.uniqueId]:(h[g]=j||Q.isRenderTarget?Q:Q.clone(),H[Q.uniqueId]=h[g]);break;case 2:case 3:case 4:case 5:case 7:case 8:case 10:case 12:h[g]=j?Q:Q.clone()}}return h};class r{static AppendSerializedAnimations(q,f){if(q.animations){f.animations=[];for(let j=0;j<q.animations.length;j++){const d=q.animations[j];f.animations.push(d.serialize())}}}static Serialize(q,f){f||(f={}),g.c&&(f.tags=g.c.GetTags(q));const j=(0,Q.f)(q);for(const d in j){const g=j[d],h=g.sourceName||d,L=g.type,Q=q[d];if(void 0!==Q&&null!==Q&&("uniqueId"!==d||r.AllowLoadingUniqueId))switch(L){case 0:f[h]=Q;break;case 1:case 3:case 7:case 9:f[h]=Q.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:f[h]=Q.Yf();break;case 6:case 11:f[h]=Q.id}}return f}static ParseProperties(q,f,j,d){d||(d="");const g=(0,Q.f)(f);for(const Q in g){const H=g[Q],u=q[H.sourceName||Q],X=H.type;if(void 0!==u&&null!==u&&("uniqueId"!==Q||r.AllowLoadingUniqueId)){const q=f;switch(X){case 0:q[Q]=u;break;case 1:j&&(q[Q]=r._TextureParser(u,j,d));break;case 2:q[Q]=h.c.Pf(u);break;case 3:q[Q]=r._FresnelParametersParser(u);break;case 4:q[Q]=L.i.Pf(u);break;case 5:q[Q]=L.j.Pf(u);break;case 6:j&&(q[Q]=j.getLastMeshById(u));break;case 7:q[Q]=r._ColorCurvesParser(u);break;case 8:q[Q]=h.e.Pf(u);break;case 9:q[Q]=r._ImageProcessingConfigurationParser(u);break;case 10:q[Q]=L.e.Pf(u);break;case 11:j&&(q[Q]=j.getCameraById(u));break;case 12:q[Q]=L.b.Pf(u)}}}}static Parse(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const h=q();return g.c&&g.c.AddTagsTo(h,f.tags),r.ParseProperties(f,h,j,d),h}static Clone(q,f){return H(q,f,!1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}static Instanciate(q,f){return H(q,f,!0)}}r.AllowLoadingUniqueId=!1,r._ImageProcessingConfigurationParser=q=>{throw(0,d.c)("ImageProcessingConfiguration")},r._FresnelParametersParser=q=>{throw(0,d.c)("FresnelParameters")},r._ColorCurvesParser=q=>{throw(0,d.c)("ColorCurves")},r._TextureParser=(q,f,j)=>{throw(0,d.c)("Texture")}},11011:(q,f,j)=>{j.d(f,{e:()=>h});var d=j(11005);const g=(q,f,j)=>q?q.getClassName&&"Mesh"===q.getClassName()?null:!q.getClassName||"SubMesh"!==q.getClassName()&&"PhysicsBody"!==q.getClassName()?q.clone?q.clone():Array.isArray(q)?q.slice():j&&"object"===typeof q?{...q}:null:q.clone(f):null;class h{static DeepCopy(q,f,j,h){let L=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const Q=function(q){const f=[];do{const j=Object.getOwnPropertyNames(q);for(const q of j)-1===f.indexOf(q)&&f.push(q)}while(q=Object.getPrototypeOf(q));return f}(q);for(const r of Q){if("_"===r[0]&&(!h||-1===h.indexOf(r)))continue;if(r.endsWith("Observable"))continue;if(j&&-1!==j.indexOf(r))continue;const Q=q[r],u=typeof Q;if("function"!==u)try{if("object"===u)if(Q instanceof Uint8Array)f[r]=Uint8Array.from(Q);else if(Q instanceof Array){if(f[r]=[],Q.length>0)if("object"==typeof Q[0])for(let q=0;q<Q.length;q++){const j=g(Q[q],f,L);-1===f[r].indexOf(j)&&f[r].push(j)}else f[r]=Q.slice(0)}else f[r]=g(Q,f,L);else f[r]=Q}catch(H){d.e.Warn(H.message)}}}}},11693:(q,f,j)=>{function d(){const q=q=>!!q&&"object"===typeof q;for(var f=arguments.length,j=new Array(f),g=0;g<f;g++)j[g]=arguments[g];return j.reduce(((f,j)=>{const g=Object.keys(j);for(const h of g){const g=f[h],L=j[h];Array.isArray(g)&&Array.isArray(L)?f[h]=g.concat(...L):q(g)&&q(L)?f[h]=d(g,L):f[h]=L}return f}),{})}j.d(f,{b:()=>d})},11016:(q,f,j)=>{j.d(f,{c:()=>g});const d={};function g(q){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!d[q])return d[q]=!0,`${q} needs to be imported before as it contains a side-effect required by your code.`}},10997:(q,f,j)=>{function d(){return"undefined"!==typeof window}function g(){return"undefined"!==typeof navigator}function h(){return"undefined"!==typeof document}function L(q){let f="",j=q.firstChild;for(;j;)3===j.nodeType&&(f+=j.textContent),j=j.nextSibling;return f}j.d(f,{b:()=>L,c:()=>h,f:()=>g,h:()=>d})},11476:(q,f,j)=>{j.r(f),j.d(f,{Dispose:()=>z,DumpData:()=>X,DumpDataAsync:()=>u,DumpFramebuffer:()=>r,DumpTools:()=>B});var d=j(11462),g=j(10992),h=j(10985),L=j(10980);let Q,H=null;async function r(q,f,j,d){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",h=arguments.length>5?arguments[5]:void 0,L=arguments.length>6?arguments[6]:void 0;const Q=await j.readPixels(0,0,q,f);X(q,f,new Uint8Array(Q.buffer),d,g,h,!0,void 0,L)}async function u(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",g=arguments.length>4?arguments[4]:void 0,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5],L=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Q=arguments.length>7?arguments[7]:void 0;return await new Promise((H=>{X(q,f,j,(q=>H(q)),d,g,h,L,Q)}))}function X(q,f,r,u){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",B=arguments.length>5?arguments[5]:void 0,D=arguments.length>6&&void 0!==arguments[6]&&arguments[6],i=arguments.length>7&&void 0!==arguments[7]&&arguments[7],t=arguments.length>8?arguments[8]:void 0;(async function(){return H||(H=new Promise(((q,f)=>{let g,h=null;const H={Mu:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(j.bind(j,11337)).then((r=>{let{ThinEngine:u}=r;const X=L.d.Instances.length;try{g=new OffscreenCanvas(100,100),h=new u(g,!1,H)}catch(i){var B;X<L.d.Instances.length&&(null===(B=L.d.Instances.pop())||void 0===B||B.dispose()),g=document.createElement("canvas"),h=new u(g,!1,H)}L.d.Instances.pop(),L.d.OnEnginesDisposedObservable.add((q=>{h&&q!==h&&!h.B&&0===L.d.Instances.length&&z()})),h.getCaps().parallelShaderCompile=void 0;const D=new d.b(h);j.e(37).then(j.bind(j,13480)).then((j=>{let{passPixelShader:L}=j;if(!h)return void f("Engine is not defined");const H=new d.f({gH:h,name:L.name,fragmentShader:L.shader,samplerNames:["textureSampler"]});Q={canvas:g,gH:h,renderer:D,wrapper:H},q(Q)}))})).catch(f)}))),await H})().then((j=>{if(j.gH.setSize(q,f,!0),r instanceof Float32Array){const q=new Uint8Array(r.length);let f=r.length;for(;f--;){const j=r[f];q[f]=Math.round(255*(0,h.Clamp)(j))}r=q}const d=j.gH.createRawTexture(r,q,f,5,!1,!D,1);j.renderer.setViewport(),j.renderer.applyEffectWrapper(j.wrapper),j.wrapper.effect._bindTexture("textureSampler",d),j.renderer.draw(),i?g.h.ToBlob(j.canvas,(q=>{const f=new FileReader;f.onload=q=>{const f=q.target.result;u&&u(f)},f.readAsArrayBuffer(q)}),X,t):g.h.EncodeScreenshotCanvasData(j.canvas,u,X,B,t),d.dispose()}))}function z(){var q;Q?(Q.wrapper.dispose(),Q.renderer.dispose(),Q.gH.dispose()):null===(q=H)||void 0===q||q.then((q=>{q.wrapper.dispose(),q.renderer.dispose(),q.gH.dispose()}));H=null,Q=null}const B={DumpData:X,DumpDataAsync:u,DumpFramebuffer:r,Dispose:z};g.h.DumpData=X,g.h.DumpDataAsync=u,g.h.DumpFramebuffer=r},11035:(q,f,j)=>{j.d(f,{c:()=>d,g:()=>g,i:()=>h});class d extends Error{}d._setPrototypeOf=Object.setPrototypeOf||((q,f)=>(q.__proto__=f,q));const g={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};class h extends d{constructor(q,f,j){super(q),this.errorCode=f,this.innerError=j,this.name="RuntimeError",d._setPrototypeOf(this,h.prototype)}}},11030:(q,f,j)=>{j.d(f,{c:()=>Y,e:()=>w,f:()=>T,h:()=>n,m:()=>Z,i:()=>t,p:()=>S,s:()=>e,u:()=>I,y:()=>E});var d=j(11021),g=j(10997),h=j(10982);class L{}L.FilesToLoad={};var Q=j(11035),H=j(11044),r=j(11048),u=j(10980),X=j(11005),z=j(11059),B=j(11054),D=j(11065);const i=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class t extends Q.i{constructor(q,f){super(q,Q.g.LoadFileError),this.name="LoadFileError",Q.c._setPrototypeOf(this,t.prototype),f instanceof d.c?this.request=f:this.file=f}}class O extends Q.i{constructor(q,f){super(q,Q.g.RequestFileError),this.request=f,this.name="RequestFileError",Q.c._setPrototypeOf(this,O.prototype)}}class N extends Q.i{constructor(q,f){super(q,Q.g.ReadFileError),this.file=f,this.name="ReadFileError",Q.c._setPrototypeOf(this,N.prototype)}}const w={DefaultRetryStrategy:class{static ExponentialBackoff(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return(j,d,g)=>0!==d.status||g>=q||-1!==j.indexOf("file:")?-1:Math.pow(2,g)*f}}.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:q=>q,ScriptBaseUrl:"",ScriptPreprocessUrl:q=>q,CleanUrl:q=>q=q.replace(/#/gm,"%23")},E=(q,f)=>{if((!q||0!==q.indexOf("data:"))&&w.CorsBehavior)if("string"===typeof w.CorsBehavior||w.CorsBehavior instanceof String)f.crossOrigin=w.CorsBehavior;else{const j=w.CorsBehavior(q);j&&(f.crossOrigin=j)}},s={getRequiredSize:null},S=function(q,f,j,g){let h,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",r=arguments.length>5?arguments[5]:void 0,X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:u.d.LastCreatedEngine;if("undefined"===typeof HTMLImageElement&&(null===X||void 0===X||!X._features.forceBitmapOverHTMLImageElement))return j("LoadImage is only supported in web or BabylonNative environments."),null;let z=!1;q instanceof ArrayBuffer||ArrayBuffer.isView(q)?"undefined"!==typeof Blob&&"undefined"!==typeof URL?(h=URL.createObjectURL(new Blob([q],{type:Q})),z=!0):h=`data:${Q};base64,`+(0,H.n)(q):q instanceof Blob?(h=URL.createObjectURL(q),z=!0):(h=w.CleanUrl(q),h=w.PreprocessUrl(h));const B=f=>{if(j){const d=h||q.toString();j(`Error while trying to load image: ${0===d.indexOf("http")||d.length<=128?d:d.slice(0,128)+"..."}`,f)}};if(null!==X&&void 0!==X&&X._features.forceBitmapOverHTMLImageElement)return Z(h,(d=>{X.createImageBitmap(new Blob([d],{type:Q}),{premultiplyAlpha:"none",...r}).then((q=>{f(q),z&&URL.revokeObjectURL(h)})).catch((f=>{j&&j("Error while trying to load image: "+q,f)}))}),void 0,g||void 0,!0,((q,f)=>{B(f)})),null;const D=new Image;if(s.getRequiredSize){const f=s.getRequiredSize(q);f.width&&(D.width=f.width),f.height&&(D.height=f.height)}E(h,D);const i=[],t=()=>{for(const q of i)q.target.removeEventListener(q.name,q.handler);i.length=0};i.push({target:D,name:"load",handler:()=>{t(),f(D),z&&D.src&&URL.revokeObjectURL(D.src)}}),i.push({target:D,name:"error",handler:q=>{t(),B(q),z&&D.src&&URL.revokeObjectURL(D.src)}}),i.push({target:document,name:"securitypolicyviolation",handler:q=>{if(q.blockedURI!==D.src||"Oi"===q.disposition)return;t();const f=new Error(`CSP violation of policy ${q.effectiveDirective} ${q.blockedURI}. Current policy is ${q.originalPolicy}`);u.d.UseFallbackTexture=!1,B(f),z&&D.src&&URL.revokeObjectURL(D.src),D.src=""}}),(()=>{for(const q of i)q.target.addEventListener(q.name,q.handler)})();const O="blob:"===h.substring(0,5),N="data:"===h.substring(0,5),S=()=>{O||N||!d.c.IsCustomRequestAvailable?D.src=h:Z(h,((q,f,j)=>{const d=new Blob([q],{type:!Q&&j?j:Q}),g=URL.createObjectURL(d);z=!0,D.src=g}),void 0,g||void 0,!0,((q,f)=>{B(f)}))},e=()=>{g&&g.loadImage(h,D)};if(!O&&!N&&g&&g.enableTexturesOffline)g.open(e,S);else{if(-1!==h.indexOf("file:")){const q=decodeURIComponent(h.substring(5).toLowerCase());if(L.FilesToLoad[q]&&"undefined"!==typeof URL){try{let f;try{f=URL.createObjectURL(L.FilesToLoad[q])}catch(I){f=URL.createObjectURL(L.FilesToLoad[q])}D.src=f,z=!0}catch(T){D.src=""}return D}}S()}return D},e=(q,f,j,d,g)=>{const L=new FileReader,Q={onCompleteObservable:new h.d,abort:()=>L.abort()};return L.onloadend=()=>Q.onCompleteObservable.notifyObservers(Q),g&&(L.onerror=()=>{g(new N(`Unable to read ${q.name}`,q))}),L.onload=q=>{f(q.target.result)},j&&(L.onprogress=j),d?L.readAsArrayBuffer(q):L.readAsText(q),Q},Z=(q,f,j,d,g,H,r)=>{if(q.name)return e(q,f,j,g,H?q=>{H(void 0,q)}:void 0);const u=q;if(-1!==u.indexOf("file:")){let q=decodeURIComponent(u.substring(5).toLowerCase());0===q.indexOf("./")&&(q=q.substring(2));const d=L.FilesToLoad[q];if(d)return e(d,f,j,g,H?q=>H(void 0,new t(q.message,q.file)):void 0)}const{match:B,type:D}=U(u);if(B){const q={onCompleteObservable:new h.d,abort:()=>()=>{}};try{const q=g?Y(u):v(u);f(q,void 0,D)}catch(Q){H?H(void 0,Q):X.e.Error(Q.message||"Failed to parse the Data URL")}return z.b.SetImmediate((()=>{q.onCompleteObservable.notifyObservers(q)})),q}return I(u,((q,j)=>{f(q,null===j||void 0===j?void 0:j.responseURL,null===j||void 0===j?void 0:j.getResponseHeader("content-type"))}),j,d,g,H?q=>{H(q.request,new t(q.message,q.request))}:void 0,r)},I=(q,f,j,L,Q,H,r)=>{q=w.CleanUrl(q),q=w.PreprocessUrl(q);const u=w.BaseUrl+q;let z=!1;const B={onCompleteObservable:new h.d,abort:()=>z=!0},D=()=>{let q,h=new d.c,L=null;const D=()=>{h&&(j&&h.removeEventListener("progress",j),q&&h.removeEventListener("readystatechange",q),h.removeEventListener("loadend",i))};let i=()=>{D(),B.onCompleteObservable.notifyObservers(B),B.onCompleteObservable.clear(),j=void 0,q=null,i=null,H=void 0,r=void 0,f=void 0};B.abort=()=>{z=!0,i&&i(),h&&h.readyState!==(XMLHttpRequest.DONE||4)&&h.abort(),null!==L&&(clearTimeout(L),L=null),h=null};const t=q=>{const f=q.message||"Unknown error";H&&h?H(new O(f,h)):X.e.Error(f)},N=X=>{if(h){if(h.open("GET",u),r)try{r(h)}catch(B){return void t(B)}Q&&(h.responseType="arraybuffer"),j&&h.addEventListener("progress",j),i&&h.addEventListener("loadend",i),q=()=>{if(!z&&h&&h.readyState===(XMLHttpRequest.DONE||4)){if(q&&h.removeEventListener("readystatechange",q),h.status>=200&&h.status<300||0===h.status&&(!(0,g.h)()||W())){const q=Q?h.response:h.responseText;if(null!==q){try{f&&f(q,h)}catch(B){t(B)}return}}const j=w.DefaultRetryStrategy;if(j){const q=j(u,h,X);if(-1!==q)return D(),h=new d.c,void(L=setTimeout((()=>N(X+1)),q))}const r=new O("Error status: "+h.status+" "+h.statusText+" - Unable to load "+u,h);H&&H(r)}},h.addEventListener("readystatechange",q),h.send()}};N(0)};if(L&&L.enableSceneOffline){const d=q=>{q&&q.status>400?H&&H(q):D()},g=()=>{L&&L.loadFile(w.BaseUrl+q,(q=>{!z&&f&&f(q),B.onCompleteObservable.notifyObservers(B)}),j?q=>{!z&&j&&j(q)}:void 0,d,Q)};L.open(g,d)}else D();return B},T=q=>{const{match:f,type:j}=U(q);if(f)return j||void 0;const d=q.lastIndexOf(".");switch(q.substring(d+1).toLowerCase()){case"glb":return"model/gltf-binary";case"bin":return"application/octet-stream";case"dd":return"model/gltf+json";case"jpg":case"jpeg":return"image/jpeg";case"png":return"image/png";case"webp":return"image/webp";default:return}},W=()=>"undefined"!==typeof location&&"file:"===location.protocol,n=q=>i.test(q),U=q=>{const f=i.exec(q);if(null===f||0===f.length)return{match:!1,type:""};return{match:!0,type:f[0].replace("data:","").replace("base64,","")}};function Y(q){return(0,H.d)(q.split(",")[1])}const v=q=>(0,H.g)(q.split(",")[1]);let F;D.b._FileToolsLoadImage=S,B.e.loadFile=Z,r.l.loadFile=Z;((q,f,j,d,g,h,L,Q,H,r)=>{F={DecodeBase64UrlToBinary:q,DecodeBase64UrlToString:f,DefaultRetryStrategy:j.DefaultRetryStrategy,BaseUrl:j.BaseUrl,CorsBehavior:j.CorsBehavior,PreprocessUrl:j.PreprocessUrl,IsBase64DataUrl:d,IsFileURL:g,LoadFile:h,LoadImage:L,ReadFile:Q,RequestFile:H,SetCorsBehavior:r},Object.defineProperty(F,"DefaultRetryStrategy",{get:function(){return j.DefaultRetryStrategy},set:function(q){j.DefaultRetryStrategy=q}}),Object.defineProperty(F,"BaseUrl",{get:function(){return j.BaseUrl},set:function(q){j.BaseUrl=q}}),Object.defineProperty(F,"PreprocessUrl",{get:function(){return j.PreprocessUrl},set:function(q){j.PreprocessUrl=q}}),Object.defineProperty(F,"CorsBehavior",{get:function(){return j.CorsBehavior},set:function(q){j.CorsBehavior=q}})})(Y,v,w,n,W,Z,S,e,I,E)},11105:(q,f,j)=>{function d(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(q=>{const f=16*Math.random()|0;return("x"===q?f:3&f|8).toString(16)}))}j.d(f,{d:()=>d})},11102:(q,f,j)=>{j.d(f,{b:()=>h});var d=j(11005),g=j(10965);class h{static Instantiate(q){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[q])return this.RegisteredExternalClasses[q];const f=(0,g.c)(q);if(f)return f;d.e.Warn(q+" not found, you may have missed an import.");const j=q.split(".");let h=window||this;for(let d=0,g=j.length;d<g;d++)h=h[j[d]];return"function"!==typeof h?null:h}}h.RegisteredExternalClasses={}},11005:(q,f,j)=>{j.d(f,{e:()=>d});class d{static _CheckLimit(q,f){let j=d._LogLimitOutputs[q];return j?j.current++:(j={limit:f,current:1},d._LogLimitOutputs[q]=j),j.current<=j.limit}static _GenerateLimitMessage(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const j=d._LogLimitOutputs[q];if(!j||!d.MessageLimitReached)return;const g=this._Levels[f];j.current===j.limit&&d[g.name](d.MessageLimitReached.replace(/%LIMIT%/g,""+j.limit).replace(/%TYPE%/g,g.name??""))}static _AddLogEntry(q){d._LogCache=q+d._LogCache,d.OnNewCacheEntry&&d.OnNewCacheEntry(q)}static _FormatMessage(q){const f=q=>q<10?"0"+q:""+q,j=new Date;return"["+f(j.getHours())+":"+f(j.getMinutes())+":"+f(j.getSeconds())+"]: "+q}static _LogDisabled(q,f){}static _LogEnabled(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1?arguments[1]:void 0,j=arguments.length>2?arguments[2]:void 0;const g=Array.isArray(f)?f[0]:f;if(void 0!==j&&!d._CheckLimit(g,j))return;const h=d._FormatMessage(g),L=this._Levels[q],Q=Array.isArray(f)?f.slice(1):[];L.logFunc&&L.logFunc("BJS - "+h,...Q);const H=`<div style='color:${L.color}'>${h}</div><br>`;d._AddLogEntry(H),d._GenerateLimitMessage(g,q)}static get LogCache(){return d._LogCache}static ClearLogCache(){d._LogCache="",d._LogLimitOutputs={},d.errorsCount=0}static set LogLevels(q){d.Log=d._LogDisabled,d.Warn=d._LogDisabled,d.Error=d._LogDisabled;const f=[d.MessageLogLevel,d.WarningLogLevel,d.ErrorLogLevel];for(const j of f)if((q&j)===j){const q=this._Levels[j];d[q.name]=d._LogEnabled.bind(d,j)}}}d.NoneLogLevel=0,d.MessageLogLevel=1,d.WarningLogLevel=2,d.ErrorLogLevel=4,d.AllLogLevel=7,d.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",d._LogCache="",d._LogLimitOutputs={},d._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],d.errorsCount=0,d.Log=d._LogEnabled.bind(d,d.MessageLogLevel),d.Warn=d._LogEnabled.bind(d,d.WarningLogLevel),d.Error=d._LogEnabled.bind(d,d.ErrorLogLevel)},10982:(q,f,j)=>{j.d(f,{d:()=>L});const d="undefined"!==typeof WeakRef;class g{constructor(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2?arguments[2]:void 0,d=arguments.length>3?arguments[3]:void 0;this.initialize(q,f,j,d)}initialize(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2?arguments[2]:void 0,d=arguments.length>3?arguments[3]:void 0;return this.mask=q,this.skipNextObservers=f,this.target=j,this.currentTarget=d,this}}class h{constructor(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=q,this.mask=f,this.scope=j,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(q)}}class L{static FromPromise(q,f){const j=new L;return q.then((q=>{j.notifyObservers(q)})).catch((q=>{if(!f)throw q;f.notifyObservers(q)})),j}get observers(){return this._observers}constructor(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=f,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new g(0),q&&(this._onObserverAdded=q)}add(q){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!q)return null;const g=new h(q,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);g.unregisterOnNextCall=j,f?this._observers.unshift(g):this._observers.push(g),this._onObserverAdded&&this._onObserverAdded(g),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(g,this._lastNotifiedValue);const L=d?new WeakRef(this):{deref:()=>this};return g._remove=function(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const f=L.deref();f&&(q?f.remove(g):f._remove(g))},g}addOnce(q){return this.add(q,void 0,void 0,void 0,!0)}remove(q){if(!q)return!1;q._remove=null;return-1!==this._observers.indexOf(q)&&(this._deferUnregister(q),!0)}removeCallback(q,f){for(let j=0;j<this._observers.length;j++){const d=this._observers[j];if(!d._willBeUnregistered&&(d.callback===q&&(!f||f===d.scope)))return this._deferUnregister(d),!0}return!1}_deferUnregister(q){q._willBeUnregistered||(this._numObserversMarkedAsDeleted++,q.unregisterOnNextCall=!1,q._willBeUnregistered=!0,setTimeout((()=>{this._remove(q)}),0))}_remove(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!q)return!1;const j=this._observers.indexOf(q);return-1!==j&&(f&&this._numObserversMarkedAsDeleted--,this._observers.splice(j,1),!0)}makeObserverTopPriority(q){this._remove(q,!1),this._observers.unshift(q)}makeObserverBottomPriority(q){this._remove(q,!1),this._observers.push(q)}notifyObservers(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,j=arguments.length>2?arguments[2]:void 0,d=arguments.length>3?arguments[3]:void 0,g=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=q),!this._observers.length)return!0;const h=this._eventState;h.mask=f,h.target=j,h.currentTarget=d,h.skipNextObservers=!1,h.lastReturnValue=q,h.userInfo=g;for(const L of this._observers)if(!L._willBeUnregistered&&(L.mask&f&&(L.unregisterOnNextCall&&this._deferUnregister(L),L.scope?h.lastReturnValue=L.callback.apply(L.scope,[q,h]):h.lastReturnValue=L.callback(q,h)),h.skipNextObservers))return!1;return!0}notifyObserver(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=f),q._willBeUnregistered)return;const d=this._eventState;d.mask=j,d.skipNextObservers=!1,q.unregisterOnNextCall&&this._deferUnregister(q),q.callback(f,d)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const q=this._observers.pop();q&&(q._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const q=new L;return q._observers=this._observers.slice(0),q}hasSpecificMask(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const f of this._observers)if(f.mask&q||f.mask===q)return!0;return!1}}},11425:(q,f,j)=>{j.d(f,{b:()=>g});var d=j(11013);class g{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(q,f){g.Enabled&&(this._current+=q,f&&this._fetchResult())}beginMonitoring(){g.Enabled&&(this._startMonitoringTime=d.c.Now)}endMonitoring(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!g.Enabled)return;q&&this.fetchNewFrame();const f=d.c.Now;this._current=f-this._startMonitoringTime,q&&this._fetchResult()}Dz(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const q=d.c.Now;q-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=q,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}g.Enabled=!0},11013:(q,f,j)=>{j.d(f,{c:()=>g});var d=j(10997);class g{static get Now(){return(0,d.h)()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}},11497:(q,f,j)=>{j.d(f,{d:()=>h});var d=j(11457),g=j(11433);class h{static ExpandRGBDTexture(q){const f=q._texture;if(!f||!q.isRGBD)return;const g=f.getEngine(),h=g.getCaps(),L=f.isReady;let Q=!1;h.textureHalfFloatRender&&h.textureHalfFloatLinearFiltering?(Q=!0,f.type=2):h.textureFloatRender&&h.textureFloatLinearFiltering&&(Q=!0,f.type=1),Q&&(f.isReady=!1,f._isRGBD=!1,f.invertY=!1);const H=async()=>{const h=g.isWebGPU,L=h?1:0;f.isReady=!1,h?await j.e(21).then(j.bind(j,13515)):await j.e(14).then(j.bind(j,13519));const Q=new d.c("rgbdDecode","rgbdDecode",null,null,1,null,3,g,!1,void 0,f.type,void 0,null,!1,void 0,L);Q.externalTextureSamplerBinding=!0;const H=g.createRenderTargetTexture(f.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:f.samplingMode,type:f.type,format:5});Q.onEffectCreatedObservable.addOnce((j=>{j.executeWhenCompiled((()=>{Q.onApply=q=>{q._bindTexture("textureSampler",f),q.setFloat2("scale",1,1)},q.eq().postProcessManager.directRender([Q],H,!0),g.restoreDefaultFramebuffer(),g._releaseTexture(f),Q&&Q.dispose(),H._swapAndDie(f),f.isReady=!0}))}))};Q&&(L?H():q.onLoadObservable.addOnce(H))}static async EncodeTextureToRGBD(q,f){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return f.getEngine().isWebGPU?await j.e(22).then(j.bind(j,13526)):await j.e(15).then(j.bind(j,13522)),await(0,g.d)("rgbdEncode",q,f,d,1,5)}}},11298:(q,f,j)=>{j.d(f,{c:()=>g,g:()=>d});class d{constructor(q){this.length=0,this.data=new Array(q),this._id=d._GlobalId++}push(q){this.data[this.length++]=q,this.length>this.data.length&&(this.data.length*=2)}forEach(q){for(let f=0;f<this.length;f++)q(this.data[f])}sort(q){this.data.sort(q)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(q){if(0!==q.length){this.length+q.length>this.data.length&&(this.data.length=2*(this.length+q.length));for(let f=0;f<q.length;f++)this.data[this.length++]=(q.data||q)[f]}}indexOf(q){const f=this.data.indexOf(q);return f>=this.length?-1:f}contains(q){return-1!==this.indexOf(q)}}d._GlobalId=0;class g extends d{constructor(){super(...arguments),this._duplicateId=0}push(q){super.push(q),q.__smartArrayFlags||(q.__smartArrayFlags={}),q.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(q){return(!q.__smartArrayFlags||q.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(q),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(q){if(0!==q.length){this.length+q.length>this.data.length&&(this.data.length=2*(this.length+q.length));for(let f=0;f<q.length;f++){const j=(q.data||q)[f];this.pushNoDuplicate(j)}}}}},11044:(q,f,j)=>{j.d(f,{d:()=>L,g:()=>h,k:()=>d,n:()=>g});const d=q=>{if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(q);let f="";for(let j=0;j<q.byteLength;j++)f+=String.fromCharCode(q[j]);return f},g=q=>{const f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let j,d,g,h,L,Q,H,r="",u=0;const X=ArrayBuffer.isView(q)?new Uint8Array(q.buffer,q.byteOffset,q.byteLength):new Uint8Array(q);for(;u<X.length;)j=X[u++],d=u<X.length?X[u++]:Number.NaN,g=u<X.length?X[u++]:Number.NaN,h=j>>2,L=(3&j)<<4|d>>4,Q=(15&d)<<2|g>>6,H=63&g,isNaN(d)?Q=H=64:isNaN(g)&&(H=64),r+=f.charAt(h)+f.charAt(L)+f.charAt(Q)+f.charAt(H);return r},h=q=>atob(q),L=q=>{const f=h(q),j=f.length,d=new Uint8Array(new ArrayBuffer(j));for(let g=0;g<j;g++)d[g]=f.charCodeAt(g);return d.buffer}},11202:(q,f,j)=>{j.d(f,{c:()=>g});class d{static Eval(q,f){return"true"===(q=q.match(/\([^()]*\)/g)?q.replace(/\([^()]*\)/g,(q=>(q=q.slice(1,q.length-1),d._HandleParenthesisContent(q,f)))):d._HandleParenthesisContent(q,f))||"false"!==q&&d.Eval(q,f)}static _HandleParenthesisContent(q,f){let j;f=f||(q=>"true"===q);const g=q.split("||");for(const h in g)if(Object.prototype.hasOwnProperty.call(g,h)){let q=d._SimplifyNegation(g[h].trim());const L=q.split("&&");if(L.length>1)for(let g=0;g<L.length;++g){const h=d._SimplifyNegation(L[g].trim());if(j="true"!==h&&"false"!==h?"!"===h[0]?!f(h.substring(1)):f(h):"true"===h,!j){q="false";break}}if(j||"true"===q){j=!0;break}j="true"!==q&&"false"!==q?"!"===q[0]?!f(q.substring(1)):f(q):"true"===q}return j?"true":"false"}static _SimplifyNegation(q){return"!true"===(q=(q=q.replace(/^[\s!]+/,(q=>(q=q.replace(/[\s]/g,(()=>""))).length%2?"!":""))).trim())?q="false":"!false"===q&&(q="true"),q}}class g{static EnableFor(q){q._tags=q._tags||{},q.hasTags=()=>g.HasTags(q),q.addTags=f=>g.AddTagsTo(q,f),q.removeTags=f=>g.RemoveTagsFrom(q,f),q.matchesTagsQuery=f=>g.MatchesQuery(q,f)}static DisableFor(q){delete q._tags,delete q.hasTags,delete q.addTags,delete q.removeTags,delete q.matchesTagsQuery}static HasTags(q){if(!q._tags)return!1;const f=q._tags;for(const j in f)if(Object.prototype.hasOwnProperty.call(f,j))return!0;return!1}static GetTags(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!q._tags)return null;if(f){const f=[];for(const j in q._tags)Object.prototype.hasOwnProperty.call(q._tags,j)&&!0===q._tags[j]&&f.push(j);return f.join(" ")}return q._tags}static AddTagsTo(q,f){if(!f)return;if("string"!==typeof f)return;const j=f.split(" ");for(const d of j)g._AddTagTo(q,d)}static _AddTagTo(q,f){""!==(f=f.trim())&&"true"!==f&&"false"!==f&&(f.match(/[\s]/)||f.match(/^([!]|([|]|[&]){2})/)||(g.EnableFor(q),q._tags[f]=!0))}static RemoveTagsFrom(q,f){if(!g.HasTags(q))return;const j=f.split(" ");for(const d in j)g._RemoveTagFrom(q,j[d])}static _RemoveTagFrom(q,f){delete q._tags[f]}static MatchesQuery(q,f){return void 0===f||(""===f?g.HasTags(q):d.Eval(f,(f=>g.HasTags(q)&&q._tags[f])))}}},11433:(q,f,j)=>{j.d(f,{d:()=>O,f:()=>s,i:()=>e,m:()=>Z,p:()=>E});var d=j(11438),g=j(11440),h=j(11125),L=j(11457),Q=j(11065),H=j(10965),r=j(11199),u=j(11462),X=j(11331);class z extends u.f{_gatherImports(q,f){q?(this._webGPUReady=!0,f.push(Promise.all([j.e(36).then(j.bind(j,13471))]))):f.push(Promise.all([j.e(37).then(j.bind(j,13480))])),super._gatherImports(q,f)}constructor(q){super({...arguments.length>2?arguments[2]:void 0,name:q,gH:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||X.d.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:z.FragmentUrl})}}z.FragmentUrl="pass";class B extends u.f{_gatherImports(q,f){q?(this._webGPUReady=!0,f.push(Promise.all([j.e(43).then(j.bind(j,13510))]))):f.push(Promise.all([j.e(44).then(j.bind(j,13513))])),super._gatherImports(q,f)}constructor(q){super({...arguments.length>2?arguments[2]:void 0,name:q,gH:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||X.d.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:B.FragmentUrl,defines:"#define POSITIVEX"}),this._face=0}get face(){return this._face}set face(q){if(!(q<0||q>5))switch(this._face=q,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ")}}}B.FragmentUrl="passCube";var D=j(11130);class i extends L.c{getClassName(){return"PassPostProcess"}constructor(q,f){let j=arguments.length>4?arguments[4]:void 0;const d={size:"number"===typeof f?f:void 0,camera:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,samplingMode:arguments.length>3?arguments[3]:void 0,gH:j,reusable:arguments.length>5?arguments[5]:void 0,textureType:arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,blockCompilation:arguments.length>7&&void 0!==arguments[7]&&arguments[7],...f};super(q,z.FragmentUrl,{effectWrapper:"number"!==typeof f&&f.effectWrapper?void 0:new z(q,j,d),...d})}static _Parse(q,f,j,d){return r.d.Parse((()=>new i(q.name,q.options,f,q.renderTargetSamplingMode,q._engine,q.reusable)),q,j,d)}}(0,H.f)("BABYLON.PassPostProcess",i);class t extends L.c{get face(){return this._effectWrapper.face}set face(q){this._effectWrapper.face=q}getClassName(){return"PassCubePostProcess"}constructor(q,f){let j=arguments.length>4?arguments[4]:void 0;const d={size:"number"===typeof f?f:void 0,camera:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,samplingMode:arguments.length>3?arguments[3]:void 0,gH:j,reusable:arguments.length>5?arguments[5]:void 0,textureType:arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,blockCompilation:arguments.length>7&&void 0!==arguments[7]&&arguments[7],...f};super(q,z.FragmentUrl,{effectWrapper:"number"!==typeof f&&f.effectWrapper?void 0:new B(q,j,d),...d})}static _Parse(q,f,j,d){return r.d.Parse((()=>new t(q.name,q.options,f,q.renderTargetSamplingMode,q._engine,q.reusable)),q,j,d)}}function O(q,f,j,d,g,h,Q,H){const r=f.getEngine();return f.isReady=!1,g=g??f.samplingMode,d=d??f.type,h=h??f.format,Q=Q??f.width,H=H??f.height,-1===d&&(d=0),new Promise((u=>{const X=new L.c("postprocess",q,null,null,1,null,g,r,!1,void 0,d,void 0,null,!1,h);X.externalTextureSamplerBinding=!0;const z=r.createRenderTargetTexture({width:Q,height:H},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:g,type:d,format:h});X.onEffectCreatedObservable.addOnce((q=>{q.executeWhenCompiled((()=>{X.onApply=q=>{q._bindTexture("textureSampler",f),q.setFloat2("scale",1,1)},j.postProcessManager.directRender([X],z,!0),r.restoreDefaultFramebuffer(),r._releaseTexture(f),X&&X.dispose(),z._swapAndDie(f),f.type=d,f.format=5,f.isReady=!0,u(f)}))}))}))}let N,w;function E(q){N||(N=new Float32Array(1),w=new Int32Array(N.buffer)),N[0]=q;const f=w[0];let j=f>>16&32768,d=f>>12&2047;const g=f>>23&255;return g<103?j:g>142?(j|=31744,j|=(255==g?0:1)&&8388607&f,j):g<113?(d|=2048,j|=(d>>114-g)+(d>>113-g&1),j):(j|=g-112<<10|d>>1,j+=1&d,j)}function s(q){const f=(32768&q)>>15,j=(31744&q)>>10,d=1023&q;return 0===j?(f?-1:1)*Math.pow(2,-14)*(d/Math.pow(2,10)):31==j?d?NaN:1/0*(f?-1:1):(f?-1:1)*Math.pow(2,j-15)*(1+d/Math.pow(2,10))}(0,h.b)([(0,D.O)()],t.prototype,"face",null),Q.b._RescalePostProcessFactory=q=>new i("rescale",1,null,2,q,!1,0);const S=async(q,f,h,Q,H)=>{const r=q.eq(),u=r.getEngine();let X;if(u.isWebGPU?q.isCube?await j.e(40).then(j.bind(j,13496)):await j.e(41).then(j.bind(j,13498)):q.isCube?await j.e(38).then(j.bind(j,13488)):await j.e(39).then(j.bind(j,13494)),q.isCube){const q=["#define POSITIVEX","#define NEGATIVEX","#define POSITIVEY","#define NEGATIVEY","#define POSITIVEZ","#define NEGATIVEZ"];X=new L.c("lodCube","lodCube",{uniforms:["lod","gamma"],samplingMode:d.e.NEAREST_NEAREST_MIPNEAREST,gH:u,defines:q[Q],shaderLanguage:u.isWebGPU?1:0})}else X=new L.c("lod","lod",{uniforms:["lod","gamma"],samplingMode:d.e.NEAREST_NEAREST_MIPNEAREST,gH:u,shaderLanguage:u.isWebGPU?1:0});await new Promise((q=>{X.onEffectCreatedObservable.addOnce((f=>{f.executeWhenCompiled((()=>{q(0)}))}))}));const z=new g.b("temp",{width:f,height:h},r,!1);X.onApply=function(f){f.setTexture("textureSampler",q),f.setFloat("lod",H),f.setInt("gamma",q.gammaSpace?1:0)};const B=q.getInternalTexture();try{if(z.renderTarget&&B){const j=B.samplingMode;0!==H?q.updateSamplingMode(d.e.NEAREST_NEAREST_MIPNEAREST):q.updateSamplingMode(d.e.NEAREST_NEAREST),r.postProcessManager.directRender([X],z.renderTarget,!0),q.updateSamplingMode(j);const g=await u.readPixels(0,0,f,h),L=new Uint8Array(g.buffer,0,g.byteLength);return u.unBindFramebuffer(z.renderTarget),L}throw Error("Render to texture failed.")}finally{z.dispose(),X.dispose()}};async function e(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return!q.isReady()&&q._texture&&await new Promise(((f,j)=>{null!==q._texture?q._texture.onLoadedObservable.addOnce((()=>{f(0)})):j(0)})),await S(q,f,j,d,g)}const Z={CreateResizedCopy:function(q,f,j){let h=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const L=q.eq(),Q=L.getEngine(),H=new g.b("resized"+q.name,{width:f,height:j},L,!q.noMipmap,!0,q._texture.type,!1,q.samplingMode,!1);H.wrapU=q.wrapU,H.wrapV=q.wrapV,H.uOffset=q.uOffset,H.vOffset=q.vOffset,H.uScale=q.uScale,H.vScale=q.vScale,H.uAng=q.uAng,H.vAng=q.vAng,H.wAng=q.wAng,H.coordinatesIndex=q.coordinatesIndex,H.level=q.level,H.anisotropicFilteringLevel=q.anisotropicFilteringLevel,H._texture.isReady=!1,q.wrapU=d.e.CLAMP_ADDRESSMODE,q.wrapV=d.e.CLAMP_ADDRESSMODE;const r=new i("pass",1,null,h?d.e.BILINEAR_SAMPLINGMODE:d.e.NEAREST_SAMPLINGMODE,Q,!1,0);return r.externalTextureSamplerBinding=!0,r.onEffectCreatedObservable.addOnce((f=>{f.executeWhenCompiled((()=>{r.onApply=function(f){f.setTexture("textureSampler",q)};const f=H.renderTarget;f&&(L.postProcessManager.directRender([r],f),Q.unBindFramebuffer(f),H.disposeFramebufferObjects(),r.dispose(),H.getInternalTexture().isReady=!0)}))})),H},ApplyPostProcess:O,ToHalfFloat:E,FromHalfFloat:s,GetTextureDataAsync:e}},11059:(q,f,j)=>{j.d(f,{b:()=>g,d:()=>L});let d=[];class g{static SetImmediate(q){0===d.length&&setTimeout((()=>{const q=d;d=[];for(const f of q)f()}),1),d.push(q)}}function h(q,f,j){try{if(q())return f(),!0}catch(d){return null===j||void 0===j||j(d),!0}return!1}const L=function(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,L=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&h(q,f,j))return null;const Q=setInterval((()=>{h(q,f,j)?clearInterval(Q):(g-=d,g<0&&(clearInterval(Q),null===j||void 0===j||j(new Error("Operation timed out after maximum retries. "+(L||"")),!0)))}),d);return()=>clearInterval(Q)}},11114:(q,f,j)=>{function d(q){let f=1;do{f*=2}while(f<q);return f===q}function g(q,f,j){return q*(1-j)+f*j}function h(q){const f=L(q),j=Q(q);return f-q>q-j?j:f}function L(q){return q--,q|=q>>1,q|=q>>2,q|=q>>4,q|=q>>8,q|=q>>16,++q}function Q(q){return q|=q>>1,q|=q>>2,q|=q>>4,q|=q>>8,(q|=q>>16)-(q>>1)}function H(q,f){let j;switch(arguments.length>2&&void 0!==arguments[2]?arguments[2]:2){case 1:j=Q(q);break;case 2:j=h(q);break;default:j=L(q)}return Math.min(j,f)}j.d(f,{c:()=>Q,g:()=>H,i:()=>d,k:()=>g,o:()=>h})},10992:(q,f,j)=>{j.d(f,{d:()=>O,h:()=>t});var d=j(10982),g=j(10997),h=j(11005),L=j(11011),Q=j(11013),H=j(11016),r=j(11021),u=j(10980),X=j(11030),z=j(11059),B=j(11102),D=j(11105),i=j(11114);class t{static get BaseUrl(){return X.e.BaseUrl}static set BaseUrl(q){X.e.BaseUrl=q}static get CleanUrl(){return X.e.CleanUrl}static set CleanUrl(q){X.e.CleanUrl=q}static IsAbsoluteUrl(q){return 0===q.indexOf("//")||-1!==q.indexOf("://")&&(-1!==q.indexOf(".")&&(-1!==q.indexOf("/")&&(!(q.indexOf(":")>q.indexOf("/"))&&(q.indexOf("://")<q.indexOf(".")||(0===q.indexOf("data:")||0===q.indexOf("blob:"))))))}static set ScriptBaseUrl(q){X.e.ScriptBaseUrl=q}static get ScriptBaseUrl(){return X.e.ScriptBaseUrl}static set CDNBaseUrl(q){t.ScriptBaseUrl=q,t.AssetBaseUrl=q}static set ScriptPreprocessUrl(q){X.e.ScriptPreprocessUrl=q}static get ScriptPreprocessUrl(){return X.e.ScriptPreprocessUrl}static get DefaultRetryStrategy(){return X.e.DefaultRetryStrategy}static set DefaultRetryStrategy(q){X.e.DefaultRetryStrategy=q}static get CorsBehavior(){return X.e.CorsBehavior}static set CorsBehavior(q){X.e.CorsBehavior=q}static get UseFallbackTexture(){return u.d.UseFallbackTexture}static set UseFallbackTexture(q){u.d.UseFallbackTexture=q}static get RegisteredExternalClasses(){return B.b.RegisteredExternalClasses}static set RegisteredExternalClasses(q){B.b.RegisteredExternalClasses=q}static get fallbackTexture(){return u.d.FallbackTexture}static set fallbackTexture(q){u.d.FallbackTexture=q}static FetchToRef(q,f,j,d,g,h){const L=4*((Math.abs(q)*j%j|0)+(Math.abs(f)*d%d|0)*j);h.r=g[L]/255,h.g=g[L+1]/255,h.b=g[L+2]/255,h.a=g[L+3]/255}static Mix(q,f,j){return 0}static Instantiate(q){return B.b.Instantiate(q)}static SetImmediate(q){z.b.SetImmediate(q)}static IsExponentOfTwo(q){return!0}static FloatRound(q){return Math.fround(q)}static GetFilename(q){const f=q.lastIndexOf("/");return f<0?q:q.substring(f+1)}static GetFolderPath(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const j=q.lastIndexOf("/");return j<0?f?q:"":q.substring(0,j+1)}static ToDegrees(q){return 180*q/Math.PI}static ToRadians(q){return q*Math.PI/180}static SmoothAngleChange(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9;const d=this.ToRadians(q),g=this.ToRadians(f);return this.ToDegrees(Math.atan2((1-j)*Math.sin(g)+j*Math.sin(d),(1-j)*Math.cos(g)+j*Math.cos(d)))}static MakeArray(q,f){return!0===f||void 0!==q&&null!=q?Array.isArray(q)?q:[q]:null}static GetPointerPrefix(q){return(0,g.h)()&&!window.PointerEvent?"mouse":"pointer"}static SetCorsBehavior(q,f){(0,X.y)(q,f)}static SetReferrerPolicyBehavior(q,f){f.referrerPolicy=q}static get PreprocessUrl(){return X.e.PreprocessUrl}static set PreprocessUrl(q){X.e.PreprocessUrl=q}static LoadImage(q,f,j,d,g,h){return(0,X.p)(q,f,j,d,g,h)}static LoadFile(q,f,j,d,g,h){return(0,X.m)(q,f,j,d,g,h)}static async LoadFileAsync(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return await new Promise(((j,d)=>{(0,X.m)(q,(q=>{j(q)}),void 0,void 0,f,((q,f)=>{d(f)}))}))}static GetAssetUrl(q){if(!q)return"";if(t.AssetBaseUrl&&q.startsWith(t._DefaultAssetsUrl)){const f="/"===t.AssetBaseUrl[t.AssetBaseUrl.length-1]?t.AssetBaseUrl.substring(0,t.AssetBaseUrl.length-1):t.AssetBaseUrl;return q.replace(t._DefaultAssetsUrl,f)}return q}static GetBabylonScriptURL(q,f){if(!q)return"";if(t.ScriptBaseUrl&&q.startsWith(t._DefaultCdnUrl)){const f="/"===t.ScriptBaseUrl[t.ScriptBaseUrl.length-1]?t.ScriptBaseUrl.substring(0,t.ScriptBaseUrl.length-1):t.ScriptBaseUrl;q=q.replace(t._DefaultCdnUrl,f)}return q=t.ScriptPreprocessUrl(q),f&&(q=t.GetAbsoluteUrl(q)),q}static LoadBabylonScript(q,f,j,d){q=t.GetBabylonScriptURL(q),t.LoadScript(q,f,j)}static async LoadBabylonScriptAsync(q){return q=t.GetBabylonScriptURL(q),await t.LoadScriptAsync(q)}static LoadScript(q,f,j,d){let h=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("function"===typeof importScripts){try{importScripts(q),f&&f()}catch(H){null===j||void 0===j||j(`Unable to load script '${q}' in worker`,H)}return}if(!(0,g.h)())return void(null===j||void 0===j||j(`Cannot load script '${q}' outside of a window or a worker`));const L=document.getElementsByTagName("head")[0],Q=document.createElement("script");h?(Q.setAttribute("type","module"),Q.innerText=q):(Q.setAttribute("type","text/javascript"),Q.setAttribute("src",q)),d&&(Q.id=d),Q.onload=()=>{f&&f()},Q.onerror=f=>{j&&j(`Unable to load script '${q}'`,f)},L.appendChild(Q)}static async LoadScriptAsync(q,f){return await new Promise(((j,d)=>{this.LoadScript(q,(()=>{j()}),((q,f)=>{d(f||new Error(q))}),f)}))}static ReadFileAsDataURL(q,f,j){const g=new FileReader,h={onCompleteObservable:new d.d,abort:()=>g.abort()};return g.onloadend=()=>{h.onCompleteObservable.notifyObservers(h)},g.onload=q=>{f(q.target.result)},g.onprogress=j,g.readAsDataURL(q),h}static ReadFile(q,f,j,d,g){return(0,X.s)(q,f,j,d,g)}static FileAsURL(q){const f=new Blob([q]);return window.URL.createObjectURL(f)}static Format(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return q.toFixed(f)}static DeepCopy(q,f,j,d){L.e.DeepCopy(q,f,j,d)}static IsEmpty(q){for(const f in q)if(Object.prototype.hasOwnProperty.call(q,f))return!1;return!0}static RegisterTopRootEvents(q,f){for(let d=0;d<f.length;d++){const g=f[d];q.addEventListener(g.name,g.handler,!1);try{window.parent&&window.parent.addEventListener(g.name,g.handler,!1)}catch(j){}}}static UnregisterTopRootEvents(q,f){for(let d=0;d<f.length;d++){const g=f[d];q.removeEventListener(g.name,g.handler);try{q.parent&&q.parent.removeEventListener(g.name,g.handler)}catch(j){}}}static async DumpFramebuffer(q,f,j,d){throw(0,H.c)("DumpTools")}static DumpData(q,f,j,d){throw(0,H.c)("DumpTools")}static async DumpDataAsync(q,f,j){throw(0,H.c)("DumpTools")}static _IsOffScreenCanvas(q){return void 0!==q.convertToBlob}static ToBlob(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",d=arguments.length>3?arguments[3]:void 0;t._IsOffScreenCanvas(q)||q.toBlob||(q.toBlob=function(q,f,j){setTimeout((()=>{const d=atob(this.toDataURL(f,j).split(",")[1]),g=d.length,h=new Uint8Array(g);for(let q=0;q<g;q++)h[q]=d.charCodeAt(q);q(new Blob([h]))}))}),t._IsOffScreenCanvas(q)?q.convertToBlob({type:j,quality:d}).then((q=>f(q))):q.toBlob((function(q){f(q)}),j,d)}static DownloadBlob(q,f){if("download"in document.createElement("a")){if(!f){const q=new Date;f="screenshot_"+((q.getFullYear()+"-"+(q.getMonth()+1)).slice(2)+"-"+q.getDate()+"_"+q.getHours()+"-"+("0"+q.getMinutes()).slice(-2))+".png"}t.Download(q,f)}else if(q&&"undefined"!==typeof URL){const f=URL.createObjectURL(q),j=window.open("");if(!j)return;const d=j.document.createElement("img");d.onload=function(){URL.revokeObjectURL(f)},d.src=f,j.document.body.appendChild(d)}}static EncodeScreenshotCanvasData(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",d=arguments.length>3?arguments[3]:void 0,g=arguments.length>4?arguments[4]:void 0;if("string"!==typeof d&&f){if(f){if(t._IsOffScreenCanvas(q))return void q.convertToBlob({type:j,quality:g}).then((q=>{const j=new FileReader;j.readAsDataURL(q),j.onloadend=()=>{const q=j.result;f(q)}}));const d=q.toDataURL(j,g);f(d)}}else this.ToBlob(q,(function(q){q&&t.DownloadBlob(q,d),f&&f("")}),j,g)}static Download(q,f){if("undefined"===typeof URL)return;const j=window.URL.createObjectURL(q),d=document.createElement("a");document.body.appendChild(d),d.style.display="none",d.href=j,d.download=f,d.addEventListener("click",(()=>{d.parentElement&&d.parentElement.removeChild(d)})),d.click(),window.URL.revokeObjectURL(j)}static BackCompatCameraNoPreventDefault(q){return"boolean"===typeof q[0]?q[0]:"boolean"===typeof q[1]&&q[1]}static CreateScreenshot(q,f,j,d){throw(0,H.c)("ScreenshotTools")}static async CreateScreenshotAsync(q,f,j){throw(0,H.c)("ScreenshotTools")}static CreateScreenshotUsingRenderTarget(q,f,j,d){throw(0,H.c)("ScreenshotTools")}static async CreateScreenshotUsingRenderTargetAsync(q,f,j){throw(0,H.c)("ScreenshotTools")}static RandomId(){return(0,D.d)()}static IsBase64(q){return(0,X.h)(q)}static DecodeBase64(q){return(0,X.c)(q)}static get errorsCount(){return h.e.errorsCount}static Log(q){h.e.Log(q)}static Warn(q){h.e.Warn(q)}static Error(q){h.e.Error(q)}static get LogCache(){return h.e.LogCache}static ClearLogCache(){h.e.ClearLogCache()}static set LogLevels(q){h.e.LogLevels=q}static set PerformanceLogLevel(q){return(q&t.PerformanceUserMarkLogLevel)===t.PerformanceUserMarkLogLevel?(t.StartPerformanceCounter=t._StartUserMark,void(t.EndPerformanceCounter=t._EndUserMark)):(q&t.PerformanceConsoleLogLevel)===t.PerformanceConsoleLogLevel?(t.StartPerformanceCounter=t._StartPerformanceConsole,void(t.EndPerformanceCounter=t._EndPerformanceConsole)):(t.StartPerformanceCounter=t._StartPerformanceCounterDisabled,void(t.EndPerformanceCounter=t._EndPerformanceCounterDisabled))}static _StartPerformanceCounterDisabled(q,f){}static _EndPerformanceCounterDisabled(q,f){}static _StartUserMark(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!t._Performance){if(!(0,g.h)())return;t._Performance=window.performance}f&&t._Performance.mark&&t._Performance.mark(q+"-Begin")}static _EndUserMark(q){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&t._Performance.mark&&(t._Performance.mark(q+"-End"),t._Performance.measure(q,q+"-Begin",q+"-End"))}static _StartPerformanceConsole(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];f&&(t._StartUserMark(q,f),console.time&&console.time(q))}static _EndPerformanceConsole(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];f&&(t._EndUserMark(q,f),console.timeEnd(q))}static get Now(){return Q.c.Now}static GetClassName(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=null;if(!f&&q.getClassName)j=q.getClassName();else{if(q instanceof Object){j=(f?q:Object.getPrototypeOf(q)).constructor.__bjsclassName__}j||(j=typeof q)}return j}static First(q,f){for(const j of q)if(f(j))return j;return null}static getFullClassName(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=null,d=null;if(!f&&q.getClassName)j=q.getClassName();else{if(q instanceof Object){const g=f?q:Object.getPrototypeOf(q);j=g.constructor.__bjsclassName__,d=g.constructor.__bjsmoduleName__}j||(j=typeof q)}return j?(null!=d?d+".":"")+j:null}static async DelayAsync(q){await new Promise((f=>{setTimeout((()=>{f()}),q)}))}static IsSafari(){return!!(0,g.f)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}t.AssetBaseUrl="",t.UseCustomRequestHeaders=!1,t.CustomRequestHeaders=r.c.CustomRequestHeaders,t.GetDOMTextContent=g.b,t._DefaultCdnUrl="https://cdn.babylonjs.com",t._DefaultAssetsUrl="https://assets.babylonjs.com/core",t.GetAbsoluteUrl="object"===typeof document?q=>{const f=document.createElement("a");return f.href=q,f.href}:"function"===typeof URL&&"object"===typeof location?q=>new URL(q,location.origin).href:()=>{throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},t.NoneLogLevel=h.e.NoneLogLevel,t.MessageLogLevel=h.e.MessageLogLevel,t.WarningLogLevel=h.e.WarningLogLevel,t.ErrorLogLevel=h.e.ErrorLogLevel,t.AllLogLevel=h.e.AllLogLevel,t.IsWindowObjectExist=g.h,t.PerformanceNoneLogLevel=0,t.PerformanceUserMarkLogLevel=1,t.PerformanceConsoleLogLevel=2,t.StartPerformanceCounter=t._StartPerformanceCounterDisabled,t.EndPerformanceCounter=t._EndPerformanceCounterDisabled;class O{constructor(q,f,j){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.iterations=q,this.index=d-1,this._done=!1,this._fn=f,this._successCallback=j}executeNext(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}breakLoop(){this._done=!0,this._successCallback()}static Run(q,f,j){const d=new O(q,f,j,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return d.executeNext(),d}static SyncAsyncForLoop(q,f,j,d,g){let h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return O.Run(Math.ceil(q/f),(d=>{g&&g()?d.breakLoop():setTimeout((()=>{for(let h=0;h<f;++h){const L=d.index*f+h;if(L>=q)break;if(j(L),g&&g()){d.breakLoop();break}}d.executeNext()}),h)}),d)}}t.Mix=i.k,t.IsExponentOfTwo=i.i,u.d.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},10965:(q,f,j)=>{j.d(f,{c:()=>h,f:()=>g});const d={};function g(q,f){d[q]=f}function h(q){return d[q]}},11540:(q,f,j)=>{j.d(f,{d:()=>d});class d{static get UniqueId(){const q=this._UniqueIdCounter;return this._UniqueIdCounter++,q}}d._UniqueIdCounter=1},11021:(q,f,j)=>{j.d(f,{c:()=>d});class d{constructor(){this._xhr="undefined"!==typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(d.CustomRequestHeaders).length>0||d.CustomRequestModifiers.length>0}get requestURL(){return this._requestURL}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const q in d.CustomRequestHeaders){const f=d.CustomRequestHeaders[q];f&&this._xhr.setRequestHeader(q,f)}}_shouldSkipRequestModifications(q){return d.SkipRequestModificationForBabylonCDN&&(q.includes("preview.babylonjs.com")||q.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(q){this._xhr.onprogress=q}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(q){this._xhr.responseType=q}get timeout(){return this._xhr.timeout}set timeout(q){this._xhr.timeout=q}addEventListener(q,f,j){this._xhr.addEventListener(q,f,j)}removeEventListener(q,f,j){this._xhr.removeEventListener(q,f,j)}abort(){this._xhr.abort()}send(q){d.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(q)}open(q,f){for(const j of d.CustomRequestModifiers){if(this._shouldSkipRequestModifications(f))return;f=j(this._xhr,f)||f}f=(f=f.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=f,this._xhr.open(q,f,!0)}setRequestHeader(q,f){this._xhr.setRequestHeader(q,f)}getResponseHeader(q){return this._xhr.getResponseHeader(q)}}d.CustomRequestHeaders={},d.CustomRequestModifiers=new Array,d.SkipRequestModificationForBabylonCDN=!0},11676:(q,f,j)=>{j.d(f,{e:()=>g});class d{constructor(q){this._pendingActions=new Array,this._workerInfos=q.map((q=>({workerPromise:Promise.resolve(q),idle:!0})))}dispose(){for(const q of this._workerInfos)q.workerPromise.then((q=>{q.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(q){this._executeOnIdleWorker(q)||this._pendingActions.push(q)}_executeOnIdleWorker(q){for(const f of this._workerInfos)if(f.idle)return this._execute(f,q),!0;return!1}_execute(q,f){q.idle=!1,q.workerPromise.then((j=>{f(j,(()=>{const f=this._pendingActions.shift();f?this._execute(q,f):q.idle=!0}))}))}}class g extends d{constructor(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.DefaultOptions;super([]),this._maxWorkers=q,this._createWorkerAsync=f,this._options=j}push(q){if(!this._executeOnIdleWorker(q))if(this._workerInfos.length<this._maxWorkers){const f={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(f),this._execute(f,q)}else this._pendingActions.push(q)}_execute(q,f){q.timeoutId&&(clearTimeout(q.timeoutId),delete q.timeoutId),super._execute(q,((j,d)=>{f(j,(()=>{d(),q.idle&&(q.timeoutId=setTimeout((()=>{q.workerPromise.then((q=>{q.terminate()}));const f=this._workerInfos.indexOf(q);-1!==f&&this._workerInfos.splice(f,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}g.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},11623:(q,f,j)=>{j.d(f,{d:()=>u});var d=j(11125),g=j(10982),h=j(10980),L=j(11151),Q=j(11130),H=j(11199),r=j(10965);class u{get influence(){return this._influence}set influence(q){if(this._influence===q)return;const f=this._influence;this._influence=q,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===f||0===q)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(q){this._animationPropertiesOverride=q}constructor(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=q,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uv2s=null,this._colors=null,this._uniqueId=0,this.onInfluenceChanged=new g.d,this._onDataLayoutChanged=new g.d,this._animationPropertiesOverride=null,this.id=q,this._scene=j||h.d.LastCreatedScene,this.influence=f,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}get hasUV2s(){return!!this._uv2s}get hasColors(){return!!this._colors}get vertexCount(){return this._positions?this._positions.length/3:this._normals?this._normals.length/3:this._tangents?this._tangents.length/3:this._uvs?this._uvs.length/2:this._uv2s?this._uv2s.length/2:this._colors?this._colors.length/4:0}setPositions(q){const f=this.hasPositions;this._positions=q,f!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(q){const f=this.hasNormals;this._normals=q,f!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(q){const f=this.hasTangents;this._tangents=q,f!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(q){const f=this.hasUVs;this._uvs=q,f!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}setUV2s(q){const f=this.hasUV2s;this._uv2s=q,f!==this.hasUV2s&&this._onDataLayoutChanged.notifyObservers(void 0)}getUV2s(){return this._uv2s}setColors(q){const f=this.hasColors;this._colors=q,f!==this.hasColors&&this._onDataLayoutChanged.notifyObservers(void 0)}getColors(){return this._colors}clone(){const q=H.d.Clone((()=>new u(this.name,this.influence,this._scene)),this);return q._positions=this._positions,q._normals=this._normals,q._tangents=this._tangents,q._uvs=this._uvs,q._uv2s=this._uv2s,q._colors=this._colors,q}serialize(){const q={};return q.name=this.name,q.influence=this.influence,q.Iq=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(q.id=this.id),this.hasNormals&&(q.Tq=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(q.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(q.nq=Array.prototype.slice.call(this.getUVs())),this.hasUV2s&&(q.uv2s=Array.prototype.slice.call(this.getUV2s())),this.hasColors&&(q.Wq=Array.prototype.slice.call(this.getColors())),H.d.AppendSerializedAnimations(this,q),q}getClassName(){return"MorphTarget"}static Parse(q,f){const j=new u(q.name,q.influence);if(j.setPositions(q.Iq),null!=q.id&&(j.id=q.id),q.Tq&&j.setNormals(q.Tq),q.tangents&&j.setTangents(q.tangents),q.nq&&j.setUVs(q.nq),q.uv2s&&j.setUV2s(q.uv2s),q.Wq&&j.setColors(q.Wq),q.animations){for(let f=0;f<q.animations.length;f++){const d=q.animations[f],g=(0,r.c)("BABYLON.Animation");g&&j.animations.push(g.Parse(d))}q.autoAnimate&&f&&f.beginAnimation(j,q.autoAnimateFrom,q.autoAnimateTo,q.autoAnimateLoop,q.autoAnimateSpeed||1)}return j}static FromMesh(q,f,j){f||(f=q.name);const d=new u(f,j,q.eq());return d.setPositions(q.getVerticesData(L.i.PositionKind)),q.isVerticesDataPresent(L.i.NormalKind)&&d.setNormals(q.getVerticesData(L.i.NormalKind)),q.isVerticesDataPresent(L.i.TangentKind)&&d.setTangents(q.getVerticesData(L.i.TangentKind)),q.isVerticesDataPresent(L.i.UVKind)&&d.setUVs(q.getVerticesData(L.i.UVKind)),q.isVerticesDataPresent(L.i.UV2Kind)&&d.setUV2s(q.getVerticesData(L.i.UV2Kind)),q.isVerticesDataPresent(L.i.ColorKind)&&d.setColors(q.getVerticesData(L.i.ColorKind)),d}}(0,d.b)([(0,Q.O)()],u.prototype,"id",void 0)},11457:(q,f,j)=>{j.d(f,{c:()=>D});var d=j(11125),g=j(11298),h=j(10982),L=j(10941),Q=j(11067),H=j(11130),r=j(11199),u=j(10965),X=j(11065),z=j(11114),B=j(11462);X.b.prototype.setTextureFromPostProcess=function(q,f,j){var d;let g=null;f&&(f._forcedOutputTexture?g=f._forcedOutputTexture:f._textures.data[f._currentRenderTextureInd]&&(g=f._textures.data[f._currentRenderTextureInd])),this._bindTexture(q,(null===(d=g)||void 0===d?void 0:d.texture)??null,j)},X.b.prototype.setTextureFromPostProcessOutput=function(q,f,j){var d;this._bindTexture(q,(null===f||void 0===f||null===(d=f._outputTexture)||void 0===d?void 0:d.texture)??null,j)},Q.b.prototype.setTextureFromPostProcess=function(q,f){this._engine.setTextureFromPostProcess(this._samplers[q],f,q)},Q.b.prototype.setTextureFromPostProcessOutput=function(q,f){this._engine.setTextureFromPostProcessOutput(this._samplers[q],f,q)};class D{static get ForceGLSL(){return B.f.ForceGLSL}static set ForceGLSL(q){B.f.ForceGLSL=q}static RegisterShaderCodeProcessing(q,f){B.f.RegisterShaderCodeProcessing(q,f)}get name(){return this._effectWrapper.name}set name(q){this._effectWrapper.name=q}get alphaMode(){return this._effectWrapper.alphaMode}set alphaMode(q){this._effectWrapper.alphaMode=q}get samples(){return this._samples}set samples(q){this._samples=Math.min(q,this._engine.getCaps().maxMSAASamples),this._textures.forEach((q=>{q.setSamples(this._samples)}))}get shaderLanguage(){return this._shaderLanguage}getEffectName(){return this._fragmentUrl}set onActivate(q){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),q&&(this._onActivateObserver=this.onActivateObservable.add(q))}set onSizeChanged(q){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(q)}set onApply(q){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(q)}set onBeforeRender(q){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(q)}set onAfterRender(q){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(q)}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}set inputTexture(q){this._forcedOutputTexture=q}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}getCamera(){return this._camera}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.Af(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}constructor(q,f,j,d,Q,H){var r;let u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,X=arguments.length>7?arguments[7]:void 0,z=arguments.length>8?arguments[8]:void 0,i=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,t=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,O=arguments.length>11&&void 0!==arguments[11]?arguments[11]:"postprocess",N=arguments.length>12?arguments[12]:void 0,w=arguments.length>13&&void 0!==arguments[13]&&arguments[13],E=arguments.length>14&&void 0!==arguments[14]?arguments[14]:5,s=arguments.length>15?arguments[15]:void 0,S=arguments.length>16?arguments[16]:void 0;this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.fz=!0,this.forceAutoClearInAlphaMode=!1,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new g.g(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new L.i(1,1),this._texelSize=L.i.Zero(),this.onActivateObservable=new h.d,this.onSizeChangedObservable=new h.d,this.onApplyObservable=new h.d,this.onBeforeRenderObservable=new h.d,this.onAfterRenderObservable=new h.d,this.qd=new h.d;let e,Z=1,I=null;if(j&&!Array.isArray(j)){const q=j;j=q.uniforms??null,d=q.samplers??null,Z=q.size??1,H=q.camera??null,u=q.samplingMode??1,X=q.gH,z=q.reusable,i=Array.isArray(q.defines)?q.defines.join("\n"):q.defines??null,t=q.textureType??0,O=q.vertexUrl??"postprocess",N=q.indexParameters,w=q.blockCompilation??!1,E=q.textureFormat??5,s=q.shaderLanguage??0,I=q.uniformBuffers??null,S=q.extraInitializations,e=q.effectWrapper}else Q&&(Z="number"===typeof Q?Q:{width:Q.width,height:Q.height});if(this._useExistingThinPostProcess=!!e,this._effectWrapper=e??new B.f({name:q,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:f,gH:X||(null===(r=H)||void 0===r?void 0:r.eq().getEngine()),uniforms:j,samplers:d,uniformBuffers:I,defines:i,vertexUrl:O,indexParameters:N,blockCompilation:!0,shaderLanguage:s,extraInitializations:void 0}),this.name=q,this.onEffectCreatedObservable=this._effectWrapper.onEffectCreatedObservable,null!=H?(this._camera=H,this._scene=H.eq(),H.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):X&&(this._engine=X,this._engine.postProcesses.push(this)),this._options=Z,this.renderTargetSamplingMode=u||1,this._reusable=z||!1,this._textureType=t,this._textureFormat=E,this._shaderLanguage=s||0,this._samplers=d||[],-1===this._samplers.indexOf("textureSampler")&&this._samplers.push("textureSampler"),this._fragmentUrl=f,this._vertexUrl=O,this._parameters=j||[],-1===this._parameters.indexOf("scale")&&this._parameters.push("scale"),this._uniformBuffers=I||[],this._indexParameters=N,!this._useExistingThinPostProcess){this._webGPUReady=1===this._shaderLanguage;const q=[];this._gatherImports(this._engine.isWebGPU&&!D.ForceGLSL,q),this._effectWrapper._webGPUReady=this._webGPUReady,this._effectWrapper._postConstructor(w,i,S,q)}}_gatherImports(){let q=arguments.length>1?arguments[1]:void 0;arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this._webGPUReady?q.push(Promise.all([j.e(42).then(j.bind(j,13503))])):q.push(Promise.all([Promise.resolve().then(j.bind(j,11465))]))}getClassName(){return"PostProcess"}getEngine(){return this._engine}getEffect(){return this._effectWrapper.drawWrapper.effect}shareOutputWith(q){return this._disposeTextures(),this._shareOutputWithPostProcess=q,this}useOwnOutput(){0==this._textures.length&&(this._textures=new g.g(2)),this._shareOutputWithPostProcess=null}updateEffect(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3?arguments[3]:void 0,g=arguments.length>4?arguments[4]:void 0,h=arguments.length>5?arguments[5]:void 0,L=arguments.length>6?arguments[6]:void 0,Q=arguments.length>7?arguments[7]:void 0;this._effectWrapper.updateEffect(q,f,j,d,g,h,L,Q),this._postProcessDefines=Array.isArray(this._effectWrapper.options.defines)?this._effectWrapper.options.defines.join("\n"):this._effectWrapper.options.defines}isReusable(){return this._reusable}markTextureDirty(){this.width=-1}_createRenderTargetTexture(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let g=0;g<this._textureCache.length;g++)if(this._textureCache[g].texture.width===q.width&&this._textureCache[g].texture.height===q.height&&this._textureCache[g].postProcessChannel===j&&this._textureCache[g].texture._generateDepthBuffer===f.generateDepthBuffer&&this._textureCache[g].texture.samples===f.samples)return this._textureCache[g].texture;const d=this._engine.createRenderTargetTexture(q,f);return this._textureCache.push({texture:d,postProcessChannel:j,lastUsedRenderId:-1}),d}_flushTextureCache(){const q=this._renderId;for(let f=this._textureCache.length-1;f>=0;f--)if(q-this._textureCache[f].lastUsedRenderId>100){let q=!1;for(let j=0;j<this._textures.length;j++)if(this._textures.data[j]===this._textureCache[f].texture){q=!0;break}q||(this._textureCache[f].texture.dispose(),this._textureCache.splice(f,1))}}resize(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],g=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._textures.length>0&&this._textures.reset(),this.width=q,this.height=f;let h=null;if(j)for(let H=0;H<j._postProcesses.length;H++)if(null!==j._postProcesses[H]){h=j._postProcesses[H];break}const L={width:this.width,height:this.height},Q={generateMipMaps:d,generateDepthBuffer:g||h===this,generateStencilBuffer:(g||h===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(L,Q,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(L,Q,1)),this._texelSize.Af(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}_getTarget(){let q;if(this._shareOutputWithPostProcess)q=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)q=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{let f;q=this.inputTexture;for(let j=0;j<this._textureCache.length;j++)if(this._textureCache[j].texture===q){f=this._textureCache[j];break}f&&(f.lastUsedRenderId=this._renderId)}return q}activate(q){var f,j;let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,g=arguments.length>2?arguments[2]:void 0;const h=null===q||void 0!==q.cameraRigMode?q||this._camera:null,L=(null===h||void 0===h?void 0:h.eq())??q,Q=L.getEngine(),H=Q.getCaps().maxTextureSize,r=(d?d.width:this._engine.getRenderWidth(!0))*this._options|0,u=(d?d.height:this._engine.getRenderHeight(!0))*this._options|0;let X=this._options.width||r,B=this._options.height||u;const D=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;let i=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){const q=Q.currentViewport;q&&(X*=q.width,B*=q.height)}(D||this.alwaysForcePOT)&&(this._options.width||(X=Q.needPOTTextures?(0,z.g)(X,H,this.scaleMode):X),this._options.height||(B=Q.needPOTTextures?(0,z.g)(B,H,this.scaleMode):B)),this.width===X&&this.height===B&&(i=this._getTarget())||this.resize(X,B,h,D,g),this._textures.forEach((q=>{q.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(q,this.samples)})),this._flushTextureCache(),this._renderId++}return i||(i=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.Af(r/X,u/B),this._engine.bindFramebuffer(i,0,r,u,this.forceFullscreenViewport)):(this._scaleRatio.Af(1,1),this._engine.bindFramebuffer(i,0,void 0,void 0,this.forceFullscreenViewport)),null===(f=(j=this._engine)._debugInsertMarker)||void 0===f||f.call(j,`post process ${this.name} input`),this.onActivateObservable.notifyObservers(h),this.fz&&(0===this.alphaMode||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:L.clearColor,L._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),i}get isSupported(){return this._effectWrapper.drawWrapper.effect.isSupported}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}isReady(){return this._effectWrapper.isReady()}apply(){if(!this._effectWrapper.isReady())return null;let q;var f;(this._engine.enableEffect(this._effectWrapper.drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),this._engine.setAlphaMode(this.alphaMode),q=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding)||this._effectWrapper.drawWrapper.effect._bindTexture("textureSampler",null===(f=q)||void 0===f?void 0:f.texture);return this._effectWrapper.drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effectWrapper.drawWrapper.effect),this._effectWrapper.bind(!0),this._effectWrapper.drawWrapper.effect}_disposeTextures(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())}_disposeTextureCache(){for(let q=this._textureCache.length-1;q>=0;q--)this._textureCache[q].texture.dispose();this._textureCache.length=0}setPrePassRenderer(q){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=q.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)}dispose(q){let f;if(q=q||this._camera,this._useExistingThinPostProcess||this._effectWrapper.dispose(),this._disposeTextures(),this._scene&&(f=this._scene.postProcesses.indexOf(this),-1!==f&&this._scene.postProcesses.splice(f,1)),this._parentContainer){const q=this._parentContainer.postProcesses.indexOf(this);q>-1&&this._parentContainer.postProcesses.splice(q,1),this._parentContainer=null}if(f=this._engine.postProcesses.indexOf(this),-1!==f&&this._engine.postProcesses.splice(f,1),this.qd.notifyObservers(),q){if(q.detachPostProcess(this),f=q._postProcesses.indexOf(this),0===f&&q._postProcesses.length>0){const q=this._camera._getFirstPostProcess();q&&q.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}}serialize(){const q=r.d.Serialize(this),f=this.getCamera()||this._scene&&this._scene.activeCamera;return q.customType="BABYLON."+this.getClassName(),q.cameraId=f?f.id:null,q.reusable=this._reusable,q.textureType=this._textureType,q.fragmentUrl=this._fragmentUrl,q.parameters=this._parameters,q.samplers=this._samplers,q.uniformBuffers=this._uniformBuffers,q.options=this._options,q.defines=this._postProcessDefines,q.textureFormat=this._textureFormat,q.vertexUrl=this._vertexUrl,q.indexParameters=this._indexParameters,q}clone(){const q=this.serialize();q._engine=this._engine,q.cameraId=null;const f=D.Parse(q,this._scene,"");return f?(f.onActivateObservable=this.onActivateObservable.clone(),f.onSizeChangedObservable=this.onSizeChangedObservable.clone(),f.onApplyObservable=this.onApplyObservable.clone(),f.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),f.onAfterRenderObservable=this.onAfterRenderObservable.clone(),f._prePassEffectConfiguration=this._prePassEffectConfiguration,f):null}static Parse(q,f,j){const d=(0,u.c)(q.customType);if(!d||!d._Parse)return null;const g=f?f.getCameraById(q.cameraId):null;return d._Parse(q,g,f,j)}static _Parse(q,f,j,d){return r.d.Parse((()=>new D(q.name,q.fragmentUrl,q.parameters,q.samplers,q.options,f,q.renderTargetSamplingMode,q._engine,q.reusable,q.defines,q.textureType,q.vertexUrl,q.indexParameters,!1,q.textureFormat)),q,j,d)}}(0,d.b)([(0,H.O)()],D.prototype,"uniqueId",void 0),(0,d.b)([(0,H.O)()],D.prototype,"name",null),(0,d.b)([(0,H.O)()],D.prototype,"width",void 0),(0,d.b)([(0,H.O)()],D.prototype,"height",void 0),(0,d.b)([(0,H.O)()],D.prototype,"renderTargetSamplingMode",void 0),(0,d.b)([(0,H.l)()],D.prototype,"clearColor",void 0),(0,d.b)([(0,H.O)()],D.prototype,"fz",void 0),(0,d.b)([(0,H.O)()],D.prototype,"forceAutoClearInAlphaMode",void 0),(0,d.b)([(0,H.O)()],D.prototype,"alphaMode",null),(0,d.b)([(0,H.O)()],D.prototype,"alphaConstants",void 0),(0,d.b)([(0,H.O)()],D.prototype,"enablePixelPerfectMode",void 0),(0,d.b)([(0,H.O)()],D.prototype,"forceFullscreenViewport",void 0),(0,d.b)([(0,H.O)()],D.prototype,"scaleMode",void 0),(0,d.b)([(0,H.O)()],D.prototype,"alwaysForcePOT",void 0),(0,d.b)([(0,H.O)("samples")],D.prototype,"_samples",void 0),(0,d.b)([(0,H.O)()],D.prototype,"adaptScaleToCurrentViewport",void 0),(0,u.f)("BABYLON.PostProcess",D)},11445:(q,f,j)=>{j.d(f,{e:()=>h});var d=j(11151),g=j(10982);class h{constructor(q){this._vertexBuffers={},this.onBeforeRenderObservable=new g.d,this._scene=q}_prepareBuffers(){if(this._vertexBuffers[d.i.PositionKind])return;const q=[];q.push(1,1),q.push(-1,1),q.push(-1,-1),q.push(1,-1),this._vertexBuffers[d.i.PositionKind]=new d.i(this._scene.getEngine(),q,d.i.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const q=[];q.push(0),q.push(1),q.push(2),q.push(0),q.push(2),q.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(q)}_rebuild(){const q=this._vertexBuffers[d.i.PositionKind];q&&(q._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const j=this._scene.activeCamera;return!!j&&(f=f||j._postProcesses.filter((q=>null!=q)),!(!f||0===f.length||!this._scene.postProcessesEnabled)&&(f[0].activate(j,q,null!==f&&void 0!==f),!0))}directRender(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5],L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:q.length;const Q=this._scene.getEngine();for(let r=0;r<L;r++){var H;if(r<q.length-1)q[r+1].activate(this._scene.activeCamera||this._scene,null===f||void 0===f?void 0:f.texture);else f?Q.bindFramebuffer(f,d,void 0,void 0,j,g):h||Q.restoreDefaultFramebuffer(),null===(H=Q._debugInsertMarker)||void 0===H||H.call(Q,`post process ${q[r].name} output`);const L=q[r],u=L.apply();u&&(L.onBeforeRenderObservable.notifyObservers(u),this._prepareBuffers(),Q.bindBuffers(this._vertexBuffers,this._indexBuffer,u),Q.drawElementsType(0,0,6),L.onAfterRenderObservable.notifyObservers(u))}Q.setDepthBuffer(!0),Q.setDepthWrite(!0)}_finalizeFrame(q,f,j,d){let g=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const h=this._scene.activeCamera;if(!h)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(d=d||h._postProcesses.filter((q=>null!=q))).length||!this._scene.postProcessesEnabled)return;const L=this._scene.getEngine();for(let H=0,r=d.length;H<r;H++){const u=d[H];var Q;if(H<r-1)u._outputTexture=d[H+1].activate(h,null===f||void 0===f?void 0:f.texture);else f?(L.bindFramebuffer(f,j,void 0,void 0,g),u._outputTexture=f):(L.restoreDefaultFramebuffer(),u._outputTexture=null),null===(Q=L._debugInsertMarker)||void 0===Q||Q.call(L,`post process ${d[H].name} output`);if(q)break;const X=u.apply();X&&(u.onBeforeRenderObservable.notifyObservers(X),this._prepareBuffers(),L.bindBuffers(this._vertexBuffers,this._indexBuffer,X),L.drawElementsType(0,0,6),u.onAfterRenderObservable.notifyObservers(X))}L.setDepthBuffer(!0),L.setDepthWrite(!0),L.setAlphaMode(0)}dispose(){const q=this._vertexBuffers[d.i.PositionKind];q&&(q.dispose(),this._vertexBuffers[d.i.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11454:(q,f,j)=>{j.d(f,{c:()=>Q});var d=j(11298),g=j(10941);class h{set opaqueSortCompareFn(q){this._opaqueSortCompareFn=q||h.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(q){this._alphaTestSortCompareFn=q||h.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(q){this._transparentSortCompareFn=q||h.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=q,this._opaqueSubMeshes=new d.g(256),this._transparentSubMeshes=new d.g(256),this._alphaTestSubMeshes=new d.g(256),this._depthOnlySubMeshes=new d.g(256),this._particleSystems=new d.g(256),this._spriteManagers=new d.g(256),this._empty=!0,this._edgesRenderers=new d.c(16),this._scene=f,this.opaqueSortCompareFn=j,this.alphaTestSortCompareFn=g,this.transparentSortCompareFn=h}render(q,f,j,d){if(q)return void q(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const g=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(g.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),g.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const h=g.getStencilBuffer();if(g.setStencilBuffer(!1),f&&this._renderSprites(),j&&this._renderParticles(d),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(g.setStencilBuffer(h),this._scene.useOrderIndependentTransparency){const q=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);q.length&&this._renderTransparent(q)}else this._renderTransparent(this._transparentSubMeshes);g.setAlphaMode(0)}if(g.setStencilBuffer(!1),this._edgesRenderers.length){for(let q=0;q<this._edgesRenderers.length;q++)this._edgesRenderers.data[q].render();g.setAlphaMode(0)}g.setStencilBuffer(h)}_renderOpaqueSorted(q){h._RenderSorted(q,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(q){h._RenderSorted(q,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(q){h._RenderSorted(q,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(q,f,j,d){let L,Q=0;const H=j?j.globalPosition:h._ZeroVector;if(d)for(;Q<q.length;Q++)L=q.data[Q],L._alphaIndex=L.getMesh().alphaIndex,L._distanceToCamera=g.j.Distance(L.getBoundingInfo().boundingSphere.centerWorld,H);const r=q.length===q.data.length?q.data:q.data.slice(0,q.length);f&&r.sort(f);const u=r[0].getMesh().eq();for(Q=0;Q<r.length;Q++)if(L=r[Q],!u._activeMeshesFrozenButKeepClipping||L.isInFrustum(u._frustumPlanes)){if(d){const q=L.bq();if(q&&q.needDepthPrePass){const f=q.eq().getEngine();f.setColorWrite(!1),f.setAlphaMode(0),L.render(!1),f.setColorWrite(!0)}}L.render(d)}}static defaultTransparentSortCompare(q,f){return q._alphaIndex>f._alphaIndex?1:q._alphaIndex<f._alphaIndex?-1:h.backToFrontSortCompare(q,f)}static backToFrontSortCompare(q,f){return q._distanceToCamera<f._distanceToCamera?1:q._distanceToCamera>f._distanceToCamera?-1:0}static frontToBackSortCompare(q,f){return q._distanceToCamera<f._distanceToCamera?-1:q._distanceToCamera>f._distanceToCamera?1:0}static PainterSortCompare(q,f){const j=q.getMesh(),d=f.getMesh();return j.material&&d.material?j.material.uniqueId-d.material.uniqueId:j.uniqueId-d.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(q,f,j){void 0===f&&(f=q.getMesh()),void 0===j&&(j=q.bq()),null!==j&&void 0!==j&&(j.needAlphaBlendingForMesh(f)?this._transparentSubMeshes.push(q):j.needAlphaTestingForMesh(f)?(j.needDepthPrePass&&this._depthOnlySubMeshes.push(q),this._alphaTestSubMeshes.push(q)):(j.needDepthPrePass&&this._depthOnlySubMeshes.push(q),this._opaqueSubMeshes.push(q)),f._renderingGroup=this,f._edgesRenderer&&f.isEnabled()&&f.isVisible&&f._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(f._edgesRenderer),this._empty=!1)}dispatchSprites(q){this._spriteManagers.push(q),this._empty=!1}dispatchParticles(q){this._particleSystems.push(q),this._empty=!1}_renderParticles(q){if(0===this._particleSystems.length)return;const f=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let j=0;j<this._particleSystems.length;j++){const d=this._particleSystems.data[j];if(0===(f&&f.layerMask&d.layerMask))continue;const g=d.k;g.position&&q&&-1===q.indexOf(g)||this._scene._activeParticles.addCount(d.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const q=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let f=0;f<this._spriteManagers.length;f++){const j=this._spriteManagers.data[f];0!==(q&&q.layerMask&j.layerMask)&&j.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}h._ZeroVector=g.j.Zero();class L{}class Q{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(q){q!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=q,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const q of this._scene.meshes)if(q.Qd)for(const f of q.Qd)f._wasDispatched=!1;if(this._scene.spriteManagers)for(const q of this._scene.spriteManagers)q._wasDispatched=!1;for(const q of this._scene.ez)q._wasDispatched=!1}constructor(q){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new L,this._maintainStateBetweenFrames=!1,this._scene=q;for(let f=Q.MIN_RENDERINGGROUPS;f<Q.MAX_RENDERINGGROUPS;f++)this._autoClearDepthStencil[f]={fz:!0,depth:!0,stencil:!0}}getRenderingGroup(q){const f=q||0;return this._prepareRenderingGroup(f),this._renderingGroups[f]}_clearDepthStencilBuffer(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,q,f),this._depthStencilBufferAlreadyCleaned=!0)}render(q,f,j,d){const g=this._renderingGroupInfo;if(g.Sf=this._scene,g.camera=this._scene.activeCamera,g.renderingManager=this,this._scene.spriteManagers&&d)for(let h=0;h<this._scene.spriteManagers.length;h++){const q=this._scene.spriteManagers[h];this.dispatchSprites(q)}for(let h=Q.MIN_RENDERINGGROUPS;h<Q.MAX_RENDERINGGROUPS;h++){this._depthStencilBufferAlreadyCleaned=h===Q.MIN_RENDERINGGROUPS;const L=this._renderingGroups[h];if(!L||L._empty)continue;const H=1<<h;if(g.renderingGroupId=h,this._scene.onBeforeRenderingGroupObservable.notifyObservers(g,H),Q.AUTOCLEAR){const q=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(h):this._autoClearDepthStencil[h];q&&q.fz&&this._clearDepthStencilBuffer(q.depth,q.stencil)}for(const q of this._scene._beforeRenderingGroupDrawStage)q.action(h);L.render(q,d,j,f);for(const q of this._scene._afterRenderingGroupDrawStage)q.action(h);this._scene.onAfterRenderingGroupObservable.notifyObservers(g,H)}}reset(){if(!this.maintainStateBetweenFrames)for(let q=Q.MIN_RENDERINGGROUPS;q<Q.MAX_RENDERINGGROUPS;q++){const f=this._renderingGroups[q];f&&f.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let q=Q.MIN_RENDERINGGROUPS;q<Q.MAX_RENDERINGGROUPS;q++){const f=this._renderingGroups[q];f&&f.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let q=Q.MIN_RENDERINGGROUPS;q<Q.MAX_RENDERINGGROUPS;q++){const f=this._renderingGroups[q];f&&f.dispose()}}_prepareRenderingGroup(q){void 0===this._renderingGroups[q]&&(this._renderingGroups[q]=new h(q,this._scene,this._customOpaqueSortCompareFn[q],this._customAlphaTestSortCompareFn[q],this._customTransparentSortCompareFn[q]))}dispatchSprites(q){this.maintainStateBetweenFrames&&q._wasDispatched||(q._wasDispatched=!0,this.getRenderingGroup(q.renderingGroupId).dispatchSprites(q))}dispatchParticles(q){this.maintainStateBetweenFrames&&q._wasDispatched||(q._wasDispatched=!0,this.getRenderingGroup(q.renderingGroupId).dispatchParticles(q))}dispatch(q,f,j){void 0===f&&(f=q.getMesh()),this.maintainStateBetweenFrames&&q._wasDispatched||(q._wasDispatched=!0,this.getRenderingGroup(f.renderingGroupId).dispatch(q,f,j))}setRenderingOrder(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[q]=f,this._customAlphaTestSortCompareFn[q]=j,this._customTransparentSortCompareFn[q]=d,this._renderingGroups[q]){const f=this._renderingGroups[q];f.opaqueSortCompareFn=this._customOpaqueSortCompareFn[q],f.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[q],f.transparentSortCompareFn=this._customTransparentSortCompareFn[q]}}setRenderingAutoClearDepthStencil(q,f){let j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[q]={fz:f,depth:j,stencil:d}}getAutoClearDepthStencilSetup(q){return this._autoClearDepthStencil[q]}}Q.MAX_RENDERINGGROUPS=4,Q.MIN_RENDERINGGROUPS=0,Q.AUTOCLEAR=!0},11465:(q,f,j)=>{j.r(f),j.d(f,{postprocessVertexShader:()=>L});var d=j(11075);const g="postprocessVertexShader",h="attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";d.b.ShadersStore[g]||(d.b.ShadersStore[g]=h);const L={name:g,shader:h}},11534:(q,f,j)=>{j.d(f,{d:()=>d});class d{}d._IsPickingAvailable=!1},11247:(q,f,j)=>{j.d(f,{d:()=>X});var d=j(11125),g=j(10941),h=j(11130),L=j(10982),Q=j(10980),H=j(11016),r=j(11199);class u{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new L.d,this._onClonedObservable=new L.d}}class X{static AddNodeConstructor(q,f){this._NodeConstructors[q]=f}static Construct(q,f,j,d){const g=this._NodeConstructors[q];return g?g(f,j,d):null}set accessibilityTag(q){this._accessibilityTag=q,this.onAccessibilityTagChangedObservable.notifyObservers(q)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(q){this._nodeDataStorage._doNotSerialize=q}B(){return this._nodeDataStorage._isDisposed}set parent(q){if(this._parentNode===q)return;const f=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const f=this._parentNode._children.indexOf(this);-1!==f&&this._parentNode._children.splice(f,1),q||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=q,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),f||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(q){q.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const q=this._scene.rootNodes,f=q.length-1;q[this._nodeDataStorage._sceneRootNodesIndex]=q[f],q[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(q){this._animationPropertiesOverride=q}getClassName(){return"Node"}set onDispose(q){this._onDisposeObserver&&this.qd.remove(this._onDisposeObserver),this._onDisposeObserver=this.qd.add(q)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new u,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new L.d,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=g.b.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.qd=new L.d,this._onDisposeObserver=null,this._behaviors=new Array,this.name=q,this.id=q,this._scene=f||Q.d.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),j&&this._addToSceneRootNodes()}eq(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(q)||(q.init(),this._scene.isLoading&&!f?this._scene.onDataLoadedObservable.addOnce((()=>{q.attach(this)})):q.attach(this),this._behaviors.push(q)),this}removeBehavior(q){const f=this._behaviors.indexOf(q);return-1===f||(this._behaviors[f].detach(),this._behaviors.splice(f,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(q){for(const f of this._behaviors)if(f.name===q)return f;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.Nf(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(q){!q&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(q){return this.parent?this.parent._getActionManagerForTrigger(q,!1):null}_updateCache(q){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}zu(q){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){if(this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children)for(const q of this._children)q._syncParentEnabledState()}DH(q){this._nodeDataStorage._isEnabled!==q&&(this._nodeDataStorage._isEnabled=q,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(q))}isDescendantOf(q){return!!this.parent&&(this.parent===q||this.parent.isDescendantOf(q))}_getDescendants(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2?arguments[2]:void 0;if(this._children)for(let d=0;d<this._children.length;d++){const g=this._children[d];j&&!j(g)||q.push(g),f||g._getDescendants(q,!1,j)}}getDescendants(q,f){const j=[];return this._getDescendants(j,q,f),j}getChildMeshes(q,f){const j=[];return this._getDescendants(j,q,(q=>(!f||f(q))&&void 0!==q.xX)),j}getChildren(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(f,q)}_setReady(q){q!==this._nodeDataStorage._isReady&&(q?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(q){for(let f=0;f<this.animations.length;f++){const j=this.animations[f];if(j.name===q)return j}return null}createAnimationRange(q,f,j){if(!this._ranges[q]){this._ranges[q]=X._AnimationRangeFactory(q,f,j);for(let d=0,g=this.animations.length;d<g;d++)this.animations[d]&&this.animations[d].createRange(q,f,j)}}deleteAnimationRange(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let j=0,d=this.animations.length;j<d;j++)this.animations[j]&&this.animations[j].deleteRange(q,f);this._ranges[q]=null}getAnimationRange(q){return this._ranges[q]||null}clone(q,f,j){const d=r.d.Clone((()=>new X(q,this.eq())),this);if(f&&(d.parent=f),!j){const f=this.getDescendants(!0);for(let j=0;j<f.length;j++){const g=f[j];g.clone(q+"."+g.name,d)}}return d}getAnimationRanges(){const q=[];let f;for(f in this._ranges)q.push(this._ranges[f]);return q}beginAnimation(q,f,j,d){const g=this.getAnimationRange(q);return g?this._scene.beginAnimation(this,g.from,g.to,f,j,d):null}serializeAnimationRanges(){const q=[];for(const f in this._ranges){const j=this._ranges[f];if(!j)continue;const d={};d.name=f,d.from=j.from,d.to=j.to,q.push(d)}return q}Nf(q){return this._worldMatrix||(this._worldMatrix=g.b.Identity()),this._worldMatrix}dispose(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!q){const j=this.getDescendants(!0);for(const d of j)d.dispose(q,f)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.qd.notifyObservers(this),this.qd.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const j of this._behaviors)j.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(q,f,j){if(f.ranges)for(let d=0;d<f.ranges.length;d++){const j=f.ranges[d];q.createAnimationRange(j.name,j.from,j.to)}}getHierarchyBoundingVectors(){let q,f,j=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.eq().incrementRenderId(),this.Nf(!0);const h=this;if(h.getBoundingInfo&&h.Qd){const j=h.getBoundingInfo();q=j.boundingBox.minimumWorld.clone(),f=j.boundingBox.maximumWorld.clone()}else q=new g.j(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),f=new g.j(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(j){const j=this.getDescendants(!1);for(const h of j){const j=h;if(j.Nf(!0),d&&!d(j))continue;if(!j.getBoundingInfo||0===j.getTotalVertices())continue;const L=j.getBoundingInfo().boundingBox,Q=L.minimumWorld,H=L.maximumWorld;g.j.CheckExtends(Q,q,f),g.j.CheckExtends(H,q,f)}}return{min:q,max:f}}}X._AnimationRangeFactory=(q,f,j)=>{throw(0,H.c)("AnimationRange")},X._NodeConstructors={},(0,d.b)([(0,h.O)()],X.prototype,"name",void 0),(0,d.b)([(0,h.O)()],X.prototype,"id",void 0),(0,d.b)([(0,h.O)()],X.prototype,"uniqueId",void 0),(0,d.b)([(0,h.O)()],X.prototype,"state",void 0),(0,d.b)([(0,h.O)()],X.prototype,"metadata",void 0)},11506:(q,f,j)=>{j.d(f,{b:()=>qq});var d=j(10992),g=j(11013),h=j(10982),L=j(11298);class Q{constructor(){this._count=0,this._data={}}H(q){this.clear(),q.forEach(((q,f)=>this.add(q,f)))}get(q){const f=this._data[q];if(void 0!==f)return f}getOrAddWithFactory(q,f){let j=this.get(q);return void 0!==j||(j=f(q),j&&this.add(q,j)),j}getOrAdd(q,f){const j=this.get(q);return void 0!==j?j:(this.add(q,f),f)}contains(q){return void 0!==this._data[q]}add(q,f){return void 0===this._data[q]&&(this._data[q]=f,++this._count,!0)}set(q,f){return void 0!==this._data[q]&&(this._data[q]=f,!0)}getAndRemove(q){const f=this.get(q);return void 0!==f?(delete this._data[q],--this._count,f):null}remove(q){return!!this.contains(q)&&(delete this._data[q],--this._count,!0)}clear(){this._data={},this._count=0}get count(){return this._count}forEach(q){for(const f in this._data){q(f,this._data[f])}}first(q){for(const f in this._data){const j=q(f,this._data[f]);if(j)return j}return null}}var H=j(11202),r=j(10941),u=j(11515),X=j(11190),z=j(11268);class B{constructor(q,f,j,d,g,h){this.source=q,this.pointerX=f,this.pointerY=j,this.meshUnderPointer=d,this.sourceEvent=g,this.additionalData=h}static CreateNew(q,f,j){const d=q.eq();return new B(q,d.pointerX,d.pointerY,d.meshUnderPointer||q,f,j)}static CreateNewFromSprite(q,f,j,d){return new B(q,f.pointerX,f.pointerY,f.meshUnderPointer,j,d)}static CreateNewFromScene(q,f){return new B(null,q.pointerX,q.pointerY,q.meshUnderPointer,f)}static CreateNewFromPrimitive(q,f,j,d){return new B(q,f.x,f.y,null,j,d)}}var D=j(11445),i=j(11454),t=j(11327),O=j(10997),N=j(10980),w=j(11016),E=j(11524);class s{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasTriggers(){for(const q in s.Triggers)if(Object.prototype.hasOwnProperty.call(s.Triggers,q))return!0;return!1}static get HasPickTriggers(){for(const q in s.Triggers)if(Object.prototype.hasOwnProperty.call(s.Triggers,q)){const f=parseInt(q);if(f>=1&&f<=7)return!0}return!1}static HasSpecificTrigger(q){for(const f in s.Triggers)if(Object.prototype.hasOwnProperty.call(s.Triggers,f)){if(parseInt(f)===q)return!0}return!1}}s.Triggers={};var S,e,Z,I,T,W,n,U=j(11526);!function(q){q[q.Generic=0]="Generic",q[q.Keyboard=1]="Keyboard",q[q.Mouse=2]="Mouse",q[q.Touch=3]="Touch",q[q.DualShock=4]="DualShock",q[q.Xbox=5]="Xbox",q[q.Switch=6]="Switch",q[q.DualSense=7]="DualSense"}(S||(S={})),function(q){q[q.Horizontal=0]="Horizontal",q[q.Vertical=1]="Vertical",q[q.LeftClick=2]="LeftClick",q[q.MiddleClick=3]="MiddleClick",q[q.RightClick=4]="RightClick",q[q.BrowserBack=5]="BrowserBack",q[q.BrowserForward=6]="BrowserForward",q[q.MouseWheelX=7]="MouseWheelX",q[q.MouseWheelY=8]="MouseWheelY",q[q.MouseWheelZ=9]="MouseWheelZ",q[q.Move=12]="Move"}(e||(e={})),function(q){q[q.Horizontal=0]="Horizontal",q[q.Vertical=1]="Vertical",q[q.LeftClick=2]="LeftClick",q[q.MiddleClick=3]="MiddleClick",q[q.RightClick=4]="RightClick",q[q.BrowserBack=5]="BrowserBack",q[q.BrowserForward=6]="BrowserForward",q[q.MouseWheelX=7]="MouseWheelX",q[q.MouseWheelY=8]="MouseWheelY",q[q.MouseWheelZ=9]="MouseWheelZ",q[q.DeltaHorizontal=10]="DeltaHorizontal",q[q.DeltaVertical=11]="DeltaVertical"}(Z||(Z={})),function(q){q[q.Cross=0]="Cross",q[q.Circle=1]="Circle",q[q.Square=2]="Square",q[q.Triangle=3]="Triangle",q[q.L1=4]="L1",q[q.R1=5]="R1",q[q.L2=6]="L2",q[q.R2=7]="R2",q[q.Share=8]="Share",q[q.Options=9]="Options",q[q.L3=10]="L3",q[q.R3=11]="R3",q[q.DPadUp=12]="DPadUp",q[q.DPadDown=13]="DPadDown",q[q.DPadLeft=14]="DPadLeft",q[q.DPadRight=15]="DPadRight",q[q.Home=16]="Home",q[q.TouchPad=17]="TouchPad",q[q.LStickXAxis=18]="LStickXAxis",q[q.LStickYAxis=19]="LStickYAxis",q[q.RStickXAxis=20]="RStickXAxis",q[q.RStickYAxis=21]="RStickYAxis"}(I||(I={})),function(q){q[q.Cross=0]="Cross",q[q.Circle=1]="Circle",q[q.Square=2]="Square",q[q.Triangle=3]="Triangle",q[q.L1=4]="L1",q[q.R1=5]="R1",q[q.L2=6]="L2",q[q.R2=7]="R2",q[q.Create=8]="Create",q[q.Options=9]="Options",q[q.L3=10]="L3",q[q.R3=11]="R3",q[q.DPadUp=12]="DPadUp",q[q.DPadDown=13]="DPadDown",q[q.DPadLeft=14]="DPadLeft",q[q.DPadRight=15]="DPadRight",q[q.Home=16]="Home",q[q.TouchPad=17]="TouchPad",q[q.LStickXAxis=18]="LStickXAxis",q[q.LStickYAxis=19]="LStickYAxis",q[q.RStickXAxis=20]="RStickXAxis",q[q.RStickYAxis=21]="RStickYAxis"}(T||(T={})),function(q){q[q.A=0]="A",q[q.B=1]="B",q[q.X=2]="X",q[q.Y=3]="Y",q[q.LB=4]="LB",q[q.RB=5]="RB",q[q.LT=6]="LT",q[q.RT=7]="RT",q[q.Back=8]="Back",q[q.Start=9]="Start",q[q.LS=10]="LS",q[q.RS=11]="RS",q[q.DPadUp=12]="DPadUp",q[q.DPadDown=13]="DPadDown",q[q.DPadLeft=14]="DPadLeft",q[q.DPadRight=15]="DPadRight",q[q.Home=16]="Home",q[q.LStickXAxis=17]="LStickXAxis",q[q.LStickYAxis=18]="LStickYAxis",q[q.RStickXAxis=19]="RStickXAxis",q[q.RStickYAxis=20]="RStickYAxis"}(W||(W={})),function(q){q[q.B=0]="B",q[q.A=1]="A",q[q.Y=2]="Y",q[q.X=3]="X",q[q.L=4]="L",q[q.R=5]="R",q[q.ZL=6]="ZL",q[q.ZR=7]="ZR",q[q.Minus=8]="Minus",q[q.Plus=9]="Plus",q[q.LS=10]="LS",q[q.RS=11]="RS",q[q.DPadUp=12]="DPadUp",q[q.DPadDown=13]="DPadDown",q[q.DPadLeft=14]="DPadLeft",q[q.DPadRight=15]="DPadRight",q[q.Home=16]="Home",q[q.Capture=17]="Capture",q[q.LStickXAxis=18]="LStickXAxis",q[q.LStickYAxis=19]="LStickYAxis",q[q.RStickXAxis=20]="RStickXAxis",q[q.RStickYAxis=21]="RStickYAxis"}(n||(n={}));var Y=j(11529);class v{static CreateDeviceEvent(q,f,j,d,g,h,L){switch(q){case S.Keyboard:return this._CreateKeyboardEvent(j,d,g,h);case S.Mouse:if(j===e.MouseWheelX||j===e.MouseWheelY||j===e.MouseWheelZ)return this._CreateWheelEvent(q,f,j,d,g,h);case S.Touch:return this._CreatePointerEvent(q,f,j,d,g,h,L);default:throw`Unable to generate event for device ${S[q]}`}}static _CreatePointerEvent(q,f,j,d,g,h,L){const Q=this._CreateMouseEvent(q,f,j,d,g,h);q===S.Mouse?(Q.deviceType=S.Mouse,Q.pointerId=1,Q.pointerType="mouse"):(Q.deviceType=S.Touch,Q.pointerId=L??f,Q.pointerType="touch");let H=0;return H+=g.pollInput(q,f,e.LeftClick),H+=2*g.pollInput(q,f,e.RightClick),H+=4*g.pollInput(q,f,e.MiddleClick),Q.buttons=H,j===e.Move?Q.type="pointermove":j>=e.LeftClick&&j<=e.RightClick&&(Q.type=1===d?"pointerdown":"pointerup",Q.button=j-2),Q}static _CreateWheelEvent(q,f,j,d,g,h){const L=this._CreateMouseEvent(q,f,j,d,g,h);switch(L.pointerId=1,L.type="wheel",L.deltaMode=Y.c.DOM_DELTA_PIXEL,L.deltaX=0,L.deltaY=0,L.deltaZ=0,j){case e.MouseWheelX:L.deltaX=d;break;case e.MouseWheelY:L.deltaY=d;break;case e.MouseWheelZ:L.deltaZ=d}return L}static _CreateMouseEvent(q,f,j,d,g,h){const L=this._CreateEvent(h),Q=g.pollInput(q,f,e.Horizontal),H=g.pollInput(q,f,e.Vertical);return h?(L.movementX=0,L.movementY=0,L.offsetX=L.movementX-h.getBoundingClientRect().x,L.offsetY=L.movementY-h.getBoundingClientRect().y):(L.movementX=g.pollInput(q,f,10),L.movementY=g.pollInput(q,f,11),L.offsetX=0,L.offsetY=0),this._CheckNonCharacterKeys(L,g),L.clientX=Q,L.clientY=H,L.x=Q,L.y=H,L.deviceType=q,L.deviceSlot=f,L.inputIndex=j,L}static _CreateKeyboardEvent(q,f,j,d){const g=this._CreateEvent(d);return this._CheckNonCharacterKeys(g,j),g.deviceType=S.Keyboard,g.deviceSlot=0,g.inputIndex=q,g.type=1===f?"keydown":"keyup",g.key=String.fromCharCode(q),g.keyCode=q,g}static _CheckNonCharacterKeys(q,f){const j=f.isDeviceAvailable(S.Keyboard),d=j&&1===f.pollInput(S.Keyboard,0,18),g=j&&1===f.pollInput(S.Keyboard,0,17),h=j&&(1===f.pollInput(S.Keyboard,0,91)||1===f.pollInput(S.Keyboard,0,92)||1===f.pollInput(S.Keyboard,0,93)),L=j&&1===f.pollInput(S.Keyboard,0,16);q.altKey=d,q.ctrlKey=g,q.metaKey=h,q.shiftKey=L}static _CreateEvent(q){const f={preventDefault:()=>{}};return f.target=q,f}}class F{constructor(q,f,j){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(q,f,((q,f,d,g)=>{const h=v.CreateDeviceEvent(q,f,d,g,this);j(q,f,h)})):this._createDummyNativeInput()}pollInput(q,f,j){return this._nativeInput.pollInput(q,f,j)}isDeviceAvailable(q){return q===S.Mouse||q===S.Touch}dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}}const M=Object.keys(e).length/2;class o{constructor(q,f,j,g){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=d.h.IsSafari(),this._usingMacOs=(0,O.f)()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=q=>{},this._keyboardUpEvent=q=>{},this._keyboardBlurEvent=q=>{},this._pointerMoveEvent=q=>{},this._pointerDownEvent=q=>{},this._pointerUpEvent=q=>{},this._pointerCancelEvent=q=>{},this._pointerCancelTouch=q=>{},this._pointerLeaveEvent=q=>{},this._pointerWheelEvent=q=>{},this._pointerBlurEvent=q=>{},this._pointerMacOsChromeOutEvent=q=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=(0,O.f)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=(0,O.f)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=q=>{},this._gamepadDisconnectedEvent=q=>{},this._eventPrefix=d.h.GetPointerPrefix(q),this._engine=q,this._onDeviceConnected=f,this._onDeviceDisconnected=j,this._onInputChanged=g,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOs&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}pollInput(q,f,j){const g=this._inputs[q][f];if(!g)throw`Unable to find device ${S[q]}`;q>=S.DualShock&&q<=S.DualSense&&this._updateDevice(q,f,j);const h=g[j];if(void 0===h)throw`Unable to find input ${j} for device ${S[q]} in slot ${f}`;return j===e.Move&&d.h.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),h}isDeviceAvailable(q){return void 0!==this._inputs[q]}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_enableEvents(){const q=null===this||void 0===this?void 0:this._engine.getInputElement();if(q&&(!this._eventsAttached||this._elementToAttachTo!==q)){if(this._disableEvents(),this._inputs)for(const q of this._inputs)if(q)for(const f in q){const j=q[+f];if(j)for(let q=0;q<j.length;q++)j[q]=0}this._elementToAttachTo=q,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"leave",this._pointerLeaveEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOs&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOsChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_checkForConnectedDevices(){if(navigator.getGamepads){const q=navigator.getGamepads();for(const f of q)f&&this._addGamePad(f)}"function"===typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(S.Mouse,0,0,0)}_addGamePad(q){const f=this._getGamepadDeviceType(q.id),j=q.index;this._gamepads=this._gamepads||new Array(q.index+1),this._registerDevice(f,j,q.buttons.length+q.axes.length),this._gamepads[j]=f}_addPointerDevice(q,f,j,d){this._pointerActive||(this._pointerActive=!0),this._registerDevice(q,f,M);const g=this._inputs[q][f];g[0]=j,g[1]=d}_registerDevice(q,f,j){if(void 0===f)throw`Unable to register device ${S[q]} to undefined slot.`;if(this._inputs[q]||(this._inputs[q]={}),!this._inputs[q][f]){const d=new Array(j);d.fill(0),this._inputs[q][f]=d,this._onDeviceConnected(q,f)}}_unregisterDevice(q,f){this._inputs[q][f]&&(delete this._inputs[q][f],this._onDeviceDisconnected(q,f))}_handleKeyActions(){this._keyboardDownEvent=q=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(S.Keyboard,0,255));const f=this._inputs[S.Keyboard][0];if(f){f[q.keyCode]=1;const j=q;j.inputIndex=q.keyCode,this._usingMacOs&&q.metaKey&&"Meta"!==q.key&&(this._metaKeys.includes(q.keyCode)||this._metaKeys.push(q.keyCode)),this._onInputChanged(S.Keyboard,0,j)}},this._keyboardUpEvent=q=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(S.Keyboard,0,255));const f=this._inputs[S.Keyboard][0];if(f){f[q.keyCode]=0;const j=q;if(j.inputIndex=q.keyCode,this._usingMacOs&&"Meta"===q.key&&this._metaKeys.length>0){for(const q of this._metaKeys){const j=v.CreateDeviceEvent(S.Keyboard,0,q,0,this,this._elementToAttachTo);f[q]=0,this._onInputChanged(S.Keyboard,0,j)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(S.Keyboard,0,j)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const q=this._inputs[S.Keyboard][0];for(let f=0;f<q.length;f++)if(0!==q[f]){q[f]=0;const j=v.CreateDeviceEvent(S.Keyboard,0,f,0,this,this._elementToAttachTo);this._onInputChanged(S.Keyboard,0,j)}this._usingMacOs&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_handlePointerActions(){this._maxTouchPoints=(0,O.f)()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let d=0;d<this._maxTouchPoints;d++)this._activeTouchIds[d]=-1;this._pointerMoveEvent=q=>{const f=this._getPointerType(q);let j=f===S.Mouse?0:this._activeTouchIds.indexOf(q.pointerId);if(f===S.Touch&&-1===j){const g=this._activeTouchIds.indexOf(-1);if(!(g>=0))return void d.h.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);j=g,this._activeTouchIds[g]=q.pointerId,this._onDeviceConnected(f,j)}this._inputs[f]||(this._inputs[f]={}),this._inputs[f][j]||this._addPointerDevice(f,j,q.clientX,q.clientY);const g=this._inputs[f][j];if(g){const d=q;d.inputIndex=e.Move,g[e.Horizontal]=q.clientX,g[e.Vertical]=q.clientY,f===S.Touch&&0===g[e.LeftClick]&&(g[e.LeftClick]=1),void 0===q.pointerId&&(q.pointerId=this._mouseId),this._onInputChanged(f,j,d),this._usingSafari||-1===q.button||(d.inputIndex=q.button+2,g[q.button+2]=g[q.button+2]?0:1,this._onInputChanged(f,j,d))}},this._pointerDownEvent=q=>{const f=this._getPointerType(q);let j=f===S.Mouse?0:q.pointerId;if(f===S.Touch){let f=this._activeTouchIds.indexOf(q.pointerId);if(-1===f&&(f=this._activeTouchIds.indexOf(-1)),!(f>=0))return void d.h.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);j=f,this._activeTouchIds[f]=q.pointerId}this._inputs[f]||(this._inputs[f]={}),this._inputs[f][j]?f===S.Touch&&this._onDeviceConnected(f,j):this._addPointerDevice(f,j,q.clientX,q.clientY);const g=this._inputs[f][j];if(g){const d=g[e.Horizontal],L=g[e.Vertical];if(f===S.Mouse){if(void 0===q.pointerId&&(q.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(h){}}else if(q.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(q.pointerId)}catch(h){}g[e.Horizontal]=q.clientX,g[e.Vertical]=q.clientY,g[q.button+2]=1;const Q=q;Q.inputIndex=q.button+2,this._onInputChanged(f,j,Q),d===q.clientX&&L===q.clientY||(Q.inputIndex=e.Move,this._onInputChanged(f,j,Q))}},this._pointerUpEvent=q=>{var f;const j=this._getPointerType(q),d=j===S.Mouse?0:this._activeTouchIds.indexOf(q.pointerId);if(j===S.Touch){if(-1===d)return;this._activeTouchIds[d]=-1}const g=null===(f=this._inputs[j])||void 0===f?void 0:f[d];let h=q.button,L=g&&0!==g[h+2];if(!L&&this._isUsingFirefox&&this._usingMacOs&&g&&(h=2===h?0:2,L=0!==g[h+2]),L){var Q,H,r,u;const f=g[e.Horizontal],L=g[e.Vertical];g[e.Horizontal]=q.clientX,g[e.Vertical]=q.clientY,g[h+2]=0;const X=q;void 0===q.pointerId&&(q.pointerId=this._mouseId),f===q.clientX&&L===q.clientY||(X.inputIndex=e.Move,this._onInputChanged(j,d,X)),X.inputIndex=h+2,j===S.Mouse&&this._mouseId>=0&&null!==(Q=(H=this._elementToAttachTo).hasPointerCapture)&&void 0!==Q&&Q.call(H,this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):q.pointerId&&null!==(r=(u=this._elementToAttachTo).hasPointerCapture)&&void 0!==r&&r.call(u,q.pointerId)&&this._elementToAttachTo.releasePointerCapture(q.pointerId),this._onInputChanged(j,d,X),j===S.Touch&&this._onDeviceDisconnected(j,d)}},this._pointerCancelTouch=q=>{var f,j;const d=this._activeTouchIds.indexOf(q);if(-1===d)return;null!==(f=(j=this._elementToAttachTo).hasPointerCapture)&&void 0!==f&&f.call(j,q)&&this._elementToAttachTo.releasePointerCapture(q),this._inputs[S.Touch][d][e.LeftClick]=0;const g=v.CreateDeviceEvent(S.Touch,d,e.LeftClick,0,this,this._elementToAttachTo,q);this._onInputChanged(S.Touch,d,g),this._activeTouchIds[d]=-1,this._onDeviceDisconnected(S.Touch,d)},this._pointerCancelEvent=q=>{if("mouse"===q.pointerType){var f,j;const q=this._inputs[S.Mouse][0];this._mouseId>=0&&null!==(f=(j=this._elementToAttachTo).hasPointerCapture)&&void 0!==f&&f.call(j,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let f=e.LeftClick;f<=e.BrowserForward;f++)if(1===q[f]){q[f]=0;const j=v.CreateDeviceEvent(S.Mouse,0,f,0,this,this._elementToAttachTo);this._onInputChanged(S.Mouse,0,j)}}else this._pointerCancelTouch(q.pointerId)},this._pointerLeaveEvent=q=>{"pen"===q.pointerType&&this._pointerCancelTouch(q.pointerId)},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let q=!1;const f=function(){};try{const j=Object.defineProperty({},"passive",{get:function(){q=!0}});this._elementToAttachTo.addEventListener("test",f,j),this._elementToAttachTo.removeEventListener("test",f,j)}catch(j){}this._pointerBlurEvent=()=>{if(this.isDeviceAvailable(S.Mouse)){var q,f;const j=this._inputs[S.Mouse][0];this._mouseId>=0&&null!==(q=(f=this._elementToAttachTo).hasPointerCapture)&&void 0!==q&&q.call(f,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let q=e.LeftClick;q<=e.BrowserForward;q++)if(1===j[q]){j[q]=0;const f=v.CreateDeviceEvent(S.Mouse,0,q,0,this,this._elementToAttachTo);this._onInputChanged(S.Mouse,0,f)}}if(this.isDeviceAvailable(S.Touch)){const q=this._inputs[S.Touch];for(let f=0;f<this._activeTouchIds.length;f++){var j,d,g;const h=this._activeTouchIds[f];if(null!==(j=(d=this._elementToAttachTo).hasPointerCapture)&&void 0!==j&&j.call(d,h)&&this._elementToAttachTo.releasePointerCapture(h),-1!==h&&1===(null===(g=q[f])||void 0===g?void 0:g[e.LeftClick])){q[f][e.LeftClick]=0;const j=v.CreateDeviceEvent(S.Touch,f,e.LeftClick,0,this,this._elementToAttachTo,h);this._onInputChanged(S.Touch,f,j),this._activeTouchIds[f]=-1,this._onDeviceDisconnected(S.Touch,f)}}}},this._pointerWheelEvent=q=>{const f=S.Mouse;this._inputs[f]||(this._inputs[f]=[]),this._inputs[f][0]||(this._pointerActive=!0,this._registerDevice(f,0,M));const j=this._inputs[f][0];if(j){j[e.MouseWheelX]=q.deltaX||0,j[e.MouseWheelY]=q.deltaY||q.wheelDelta||0,j[e.MouseWheelZ]=q.deltaZ||0;const d=q;void 0===q.pointerId&&(q.pointerId=this._mouseId),0!==j[e.MouseWheelX]&&(d.inputIndex=e.MouseWheelX,this._onInputChanged(f,0,d)),0!==j[e.MouseWheelY]&&(d.inputIndex=e.MouseWheelY,this._onInputChanged(f,0,d)),0!==j[e.MouseWheelZ]&&(d.inputIndex=e.MouseWheelZ,this._onInputChanged(f,0,d))}},this._usingMacOs&&this._isUsingChromium&&(this._pointerMacOsChromeOutEvent=q=>{q.buttons>1&&this._pointerCancelEvent(q)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOsChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"leave",this._pointerLeaveEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!q&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((()=>{if(this.isDeviceAvailable(S.Mouse)){const q=this._inputs[S.Mouse][0];q[e.MouseWheelX]=0,q[e.MouseWheelY]=0,q[e.MouseWheelZ]=0}}))}_handleGamepadActions(){this._gamepadConnectedEvent=q=>{this._addGamePad(q.gamepad)},this._gamepadDisconnectedEvent=q=>{if(this._gamepads){const f=this._getGamepadDeviceType(q.gamepad.id),j=q.gamepad.index;this._unregisterDevice(f,j),delete this._gamepads[j]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_updateDevice(q,f,j){const d=navigator.getGamepads()[f];if(d&&q===this._gamepads[f]){const g=this._inputs[q][f];j>=d.buttons.length?g[j]=d.axes[j-d.buttons.length].valueOf():g[j]=d.buttons[j].value}}_getGamepadDeviceType(q){return-1!==q.indexOf("054c")?-1!==q.indexOf("0ce6")?S.DualSense:S.DualShock:-1!==q.indexOf("Xbox One")||-1!==q.search("Xbox 360")||-1!==q.search("xinput")?S.Xbox:-1!==q.indexOf("057e")?S.Switch:S.Generic}_getPointerType(q){let f=S.Mouse;return("touch"===q.pointerType||"pen"===q.pointerType||q.touches)&&(f=S.Touch),f}}class b{constructor(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.deviceType=f,this.deviceSlot=j,this.onInputChangedObservable=new h.d,this._deviceInputSystem=q}getInput(q){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,q)}}class x{constructor(q){this._registeredManagers=new Array,this._refCount=0,this.registerManager=q=>{for(let f=0;f<this._devices.length;f++){const j=this._devices[f];for(const d in j){const j=+d;q._addDevice(new b(this._deviceInputSystem,f,j))}}this._registeredManagers.push(q)},this.unregisterManager=q=>{const f=this._registeredManagers.indexOf(q);f>-1&&this._registeredManagers.splice(f,1)};const f=Object.keys(S).length/2;this._devices=new Array(f);const j=(q,f)=>{this._devices[q]||(this._devices[q]=new Array),this._devices[q][f]||(this._devices[q][f]=f);for(const j of this._registeredManagers){const d=new b(this._deviceInputSystem,q,f);j._addDevice(d)}},d=(q,f)=>{var j;null!==(j=this._devices[q])&&void 0!==j&&j[f]&&delete this._devices[q][f];for(const d of this._registeredManagers)d._removeDevice(q,f)},g=(q,f,j)=>{if(j)for(const d of this._registeredManagers)d._onInputChanged(q,f,j)};"undefined"!==typeof _native?this._deviceInputSystem=new F(j,d,g):this._deviceInputSystem=new o(q,j,d,g)}dispose(){this._deviceInputSystem.dispose()}}class R{getDeviceSource(q,f){if(void 0===f){if(void 0===this._firstDevice[q])return null;f=this._firstDevice[q]}return this._devices[q]&&void 0!==this._devices[q][f]?this._devices[q][f]:null}getDeviceSources(q){return this._devices[q]?this._devices[q].filter((q=>!!q)):[]}constructor(q){const f=Object.keys(S).length/2;this._devices=new Array(f),this._firstDevice=new Array(f),this._engine=q,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new x(q)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new h.d((q=>{for(const f of this._devices)if(f)for(const j of f)j&&this.onDeviceConnectedObservable.notifyObserver(q,j)})),this.onDeviceDisconnectedObservable=new h.d,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=q.qd.add((()=>{this.dispose()}))}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.qd.remove(this._onDisposeObserver)}_addDevice(q){this._devices[q.deviceType]||(this._devices[q.deviceType]=[]),this._devices[q.deviceType][q.deviceSlot]||(this._devices[q.deviceType][q.deviceSlot]=q,this._updateFirstDevices(q.deviceType)),this.onDeviceConnectedObservable.notifyObservers(q)}_removeDevice(q,f){var j,d;const g=null===(j=this._devices[q])||void 0===j?void 0:j[f];this.onDeviceDisconnectedObservable.notifyObservers(g),null!==(d=this._devices[q])&&void 0!==d&&d[f]&&delete this._devices[q][f],this._updateFirstDevices(q)}_onInputChanged(q,f,j){var d,g;null===(d=this._devices[q])||void 0===d||null===(g=d[f])||void 0===g||g.onInputChangedObservable.notifyObservers(j)}_updateFirstDevices(q){switch(q){case S.Keyboard:case S.Mouse:this._firstDevice[q]=0;break;case S.Touch:case S.DualSense:case S.DualShock:case S.Xbox:case S.Switch:case S.Generic:{delete this._firstDevice[q];const f=this._devices[q];if(f)for(let j=0;j<f.length;j++)if(f[j]){this._firstDevice[q]=j;break}break}}}}var A=j(11534);class k{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get Wd(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(q){this._singleClick=q}set Wd(q){this._doubleClick=q}set hasSwiped(q){this._hasSwiped=q}set ignore(q){this._ignore=q}}class y{constructor(q){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._activePointerIds=new Array,this._activePointerIdsCount=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new r.i(0,0),this._previousStartingPointerPosition=new r.i(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=q||N.d.LastCreatedScene,this._scene}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(q){return this._meshUnderPointerId[q]||null}get unTranslatedPointer(){return new r.i(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(q){this._pointerX=q}get pointerY(){return this._pointerY}set pointerY(q){this._pointerY=q}_updatePointerPosition(q){const f=this._scene.getEngine().getInputElementClientRect();f&&(this._pointerX=q.clientX-f.left,this._pointerY=q.clientY-f.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(q,f){const j=this._scene,d=j.getEngine(),g=d.getInputElement();g&&(g.tabIndex=d.canvasTabIndex,j.doNotHandleCursors||(g.style.cursor=j.defaultCursor)),this._setCursorAndPointerOverMesh(q,f,j);for(const H of j._pointerMoveStage){var h;const j=!(null===(h=q=q||this._pickMove(f))||void 0===h||!h.pickedMesh);q=H.action(this._unTranslatedPointerX,this._unTranslatedPointerY,q,j,g)}const L=f.inputIndex>=e.MouseWheelX&&f.inputIndex<=e.MouseWheelZ?E.b.POINTERWHEEL:E.b.POINTERMOVE;let Q;j.onPointerMove&&(q=q||this._pickMove(f),j.onPointerMove(f,q,L)),q?(Q=new E.f(L,f,q),this._setRayOnPointerInfo(q,f)):(Q=new E.f(L,f,null,this),this._movePointerInfo=Q),j.onPointerObservable.hasObservers()&&j.onPointerObservable.notifyObservers(Q,L)}_setRayOnPointerInfo(q,f){const j=this._scene;q&&A.d._IsPickingAvailable&&(q.ray||(q.ray=j.createPickingRay(f.offsetX,f.offsetY,r.b.Identity(),j.activeCamera)))}_addCameraPointerObserver(q,f){return this._cameraObserverCount++,this._scene.onPointerObservable.add(q,f)}_removeCameraPointerObserver(q){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(q)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(q,f,j){const d=this._scene,g=new E.d(j,f,this._unTranslatedPointerX,this._unTranslatedPointerY);return q&&(g.originalPickingInfo=q,g.ray=q.ray,"xr-near"===f.pointerType&&q.originMesh&&(g.nearInteractionPickingInfo=q)),d.onPrePointerObservable.notifyObservers(g,j),!!g.skipOnPointerObservable}_pickMove(q){const f=this._scene,j=f.Sj(this._unTranslatedPointerX,this._unTranslatedPointerY,f.pointerMovePredicate,f.pointerMoveFastCheck,f.cameraToUseForPointers,f.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(j,q,f),j}_setCursorAndPointerOverMesh(q,f,j){const d=j.getEngine().getInputElement();if(null!==q&&void 0!==q&&q.pickedMesh){if(this.setPointerOverMesh(q.pickedMesh,f.pointerId,q,f),!j.doNotHandleCursors&&d&&this._pointerOverMesh){const q=this._pointerOverMesh._getActionManagerForTrigger();q&&q.hasPointerTriggers&&(d.style.cursor=q.hoverCursor||j.hoverCursor)}}else this.setPointerOverMesh(null,f.pointerId,q,f)}simulatePointerMove(q,f){const j=new PointerEvent("pointermove",f);j.inputIndex=e.Move,this._checkPrePointerObservable(q,j,E.b.POINTERMOVE)||this._processPointerMove(q,j)}simulatePointerDown(q,f){const j=new PointerEvent("pointerdown",f);j.inputIndex=j.button+2,this._checkPrePointerObservable(q,j,E.b.POINTERDOWN)||this._processPointerDown(q,j)}_processPointerDown(q,f){var j;const d=this._scene;if(null!==(j=q)&&void 0!==j&&j.pickedMesh){this._pickedDownMesh=q.pickedMesh;const j=q.pickedMesh._getActionManagerForTrigger();if(j){if(j.hasPickTriggers)switch(j.processTrigger(5,new B(q.pickedMesh,d.pointerX,d.pointerY,q.pickedMesh,f,q)),f.button){case 0:j.processTrigger(2,new B(q.pickedMesh,d.pointerX,d.pointerY,q.pickedMesh,f,q));break;case 1:j.processTrigger(4,new B(q.pickedMesh,d.pointerX,d.pointerY,q.pickedMesh,f,q));break;case 2:j.processTrigger(3,new B(q.pickedMesh,d.pointerX,d.pointerY,q.pickedMesh,f,q))}j.hasSpecificTrigger(8)&&window.setTimeout((()=>{const q=d.Sj(this._unTranslatedPointerX,this._unTranslatedPointerY,(q=>q.Xr&&q.isVisible&&q.isReady()&&q.actionManager&&q.actionManager.hasSpecificTrigger(8)&&q===this._pickedDownMesh),!1,d.cameraToUseForPointers);null!==q&&void 0!==q&&q.pickedMesh&&j&&0!==this._activePointerIdsCount&&Date.now()-this._startingPointerTime>y.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,j.processTrigger(8,B.CreateNew(q.pickedMesh,f)))}),y.LongPressDelay)}}else for(const L of d._pointerDownStage)q=L.action(this._unTranslatedPointerX,this._unTranslatedPointerY,q,f,!1);let g;const h=E.b.POINTERDOWN;q?(d.onPointerDown&&d.onPointerDown(f,q,h),g=new E.f(h,f,q),this._setRayOnPointerInfo(q,f)):g=new E.f(h,f,null,this),d.onPointerObservable.hasObservers()&&d.onPointerObservable.notifyObservers(g,h)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(q,f,j){const d=new PointerEvent("pointerup",f);d.inputIndex=e.Move;const g=new k;j?g.Wd=!0:g.singleClick=!0,this._checkPrePointerObservable(q,d,E.b.POINTERUP)||this._processPointerUp(q,d,g)}_processPointerUp(q,f,j){var d;const g=this._scene;if(null!==(d=q)&&void 0!==d&&d.pickedMesh){if(this._pickedUpMesh=q.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(g.onPointerPick&&g.onPointerPick(f,q),j.singleClick&&!j.ignore&&g.onPointerObservable.observers.length>this._cameraObserverCount)){const j=E.b.POINTERPICK,d=new E.f(j,f,q);this._setRayOnPointerInfo(q,f),g.onPointerObservable.notifyObservers(d,j)}const d=q.pickedMesh._getActionManagerForTrigger();if(d&&!j.ignore){d.processTrigger(7,B.CreateNew(q.pickedMesh,f,q)),!j.hasSwiped&&j.singleClick&&d.processTrigger(1,B.CreateNew(q.pickedMesh,f,q));const g=q.pickedMesh._getActionManagerForTrigger(6);j.Wd&&g&&g.processTrigger(6,B.CreateNew(q.pickedMesh,f,q))}}else if(!j.ignore)for(const h of g._pointerUpStage)q=h.action(this._unTranslatedPointerX,this._unTranslatedPointerY,q,f,j.Wd);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const q=this._pickedDownMesh._getActionManagerForTrigger(16);q&&q.processTrigger(16,B.CreateNew(this._pickedDownMesh,f))}if(!j.ignore){const d=new E.f(E.b.POINTERUP,f,q);if(this._setRayOnPointerInfo(q,f),g.onPointerObservable.notifyObservers(d,E.b.POINTERUP),g.onPointerUp&&g.onPointerUp(f,q,E.b.POINTERUP),!j.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let d=0;if(j.singleClick?d=E.b.POINTERTAP:j.Wd&&(d=E.b.POINTERDOUBLETAP),d){const j=new E.f(d,f,q);g.onPointerObservable.hasObservers()&&g.onPointerObservable.hasSpecificMask(d)&&g.onPointerObservable.notifyObservers(j,d)}}}}isPointerCaptured(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._pointerCaptures[q]}attachControl(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const g=this._scene,h=g.getEngine();d||(d=h.getInputElement()),this._alreadyAttached&&this.qz(),d&&(this._alreadyAttachedTo=d),this._deviceSourceManager=new R(h),this._initActionManager=q=>{if(!this._meshPickProceed){const f=g.skipPointerUpPicking||0===g._registeredActions&&!this._checkForPicking()&&!g.onPointerUp?null:g.Sj(this._unTranslatedPointerX,this._unTranslatedPointerY,g.pointerUpPredicate,g.pointerUpFastCheck,g.cameraToUseForPointers,g.pointerUpTrianglePredicate);this._currentPickResult=f,f&&(q=f.hit&&f.pickedMesh?f.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return q},this._delayedSimpleClick=(q,f,j)=>{if((Date.now()-this._previousStartingPointerTime>y.DoubleClickDelay&&!this._doubleClickOccured||q!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,f.singleClick=!0,f.ignore=!1,this._delayedClicks[q])){const f=this._delayedClicks[q].evt,j=E.b.POINTERTAP,d=new E.f(j,f,this._currentPickResult);g.onPointerObservable.hasObservers()&&g.onPointerObservable.hasSpecificMask(j)&&g.onPointerObservable.notifyObservers(d,j),this._delayedClicks[q]=null}},this._initClickEvent=(q,f,j,d)=>{const g=new k;this._currentPickResult=null;let h=null,L=q.hasSpecificMask(E.b.POINTERPICK)||f.hasSpecificMask(E.b.POINTERPICK)||q.hasSpecificMask(E.b.POINTERTAP)||f.hasSpecificMask(E.b.POINTERTAP)||q.hasSpecificMask(E.b.POINTERDOUBLETAP)||f.hasSpecificMask(E.b.POINTERDOUBLETAP);!L&&s&&(h=this._initActionManager(h,g),h&&(L=h.hasPickTriggers));let Q=!1;if(L=L&&!this._isMultiTouchGesture,L){const L=j.button;if(g.hasSwiped=this._isPointerSwiping(),!g.hasSwiped){let u=!y.ExclusiveDoubleClickMode;if(u||(u=!q.hasSpecificMask(E.b.POINTERDOUBLETAP)&&!f.hasSpecificMask(E.b.POINTERDOUBLETAP),u&&!s.HasSpecificTrigger(6)&&(h=this._initActionManager(h,g),h&&(u=!h.hasSpecificTrigger(6)))),u)(Date.now()-this._previousStartingPointerTime>y.DoubleClickDelay||L!==this._previousButtonPressed)&&(g.singleClick=!0,d(g,this._currentPickResult),Q=!0);else{const q={evt:j,clickInfo:g,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,L,g,d),y.DoubleClickDelay)};this._delayedClicks[L]=q}let X=q.hasSpecificMask(E.b.POINTERDOUBLETAP)||f.hasSpecificMask(E.b.POINTERDOUBLETAP);if(!X&&s.HasSpecificTrigger(6)&&(h=this._initActionManager(h,g),h&&(X=h.hasSpecificTrigger(6))),X)if(L===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<y.DoubleClickDelay&&!this._doubleClickOccured){if(g.hasSwiped||this._isPointerSwiping())if(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=L,y.ExclusiveDoubleClickMode){var H;if(this._delayedClicks[L])clearTimeout(null===(H=this._delayedClicks[L])||void 0===H?void 0:H.timeoutId),this._delayedClicks[L]=null;d(g,this._previousPickResult)}else d(g,this._currentPickResult);else{var r;if(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,g.Wd=!0,g.ignore=!1,y.ExclusiveDoubleClickMode&&this._delayedClicks[L])clearTimeout(null===(r=this._delayedClicks[L])||void 0===r?void 0:r.timeoutId),this._delayedClicks[L]=null;d(g,this._currentPickResult)}Q=!0}else this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=L}}Q||d(g,this._currentPickResult)},this._onPointerMove=q=>{if(this._updatePointerPosition(q),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>y.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>y.DragMovementThreshold),h.isPointerLock&&h._verifyPointerLock(),this._checkPrePointerObservable(null,q,q.inputIndex>=e.MouseWheelX&&q.inputIndex<=e.MouseWheelZ?E.b.POINTERWHEEL:E.b.POINTERMOVE))return;if(!g.cameraToUseForPointers&&!g.activeCamera)return;if(g.Qz)return void this._processPointerMove(new z.d,q);g.pointerMovePredicate||(g.pointerMovePredicate=q=>q.Xr&&q.isVisible&&q.isReady()&&q.isEnabled()&&(q.enablePointerMoveEvents||g.constantlyUpdateMeshUnderPointer||null!==q._getActionManagerForTrigger())&&(!g.cameraToUseForPointers||0!==(g.cameraToUseForPointers.layerMask&q.layerMask)));const f=g._registeredActions>0||g.constantlyUpdateMeshUnderPointer?this._pickMove(q):null;this._processPointerMove(f,q)},this._onPointerDown=q=>{const f=this._activePointerIds.indexOf(-1);if(-1===f?this._activePointerIds.push(q.pointerId):this._activePointerIds[f]=q.pointerId,this._activePointerIdsCount++,this._pickedDownMesh=null,this._meshPickProceed=!1,y.ExclusiveDoubleClickMode)for(let d=0;d<this._delayedClicks.length;d++)if(this._delayedClicks[d])if(q.button===d){var j;clearTimeout(null===(j=this._delayedClicks[d])||void 0===j?void 0:j.timeoutId)}else{const q=this._delayedClicks[d].clickInfo;this._doubleClickOccured=!1,q.singleClick=!0,q.ignore=!1;const f=this._delayedClicks[d].evt,j=E.b.POINTERTAP,h=new E.f(j,f,this._currentPickResult);g.onPointerObservable.hasObservers()&&g.onPointerObservable.hasSpecificMask(j)&&g.onPointerObservable.notifyObservers(h,j),this._delayedClicks[d]=null}if(this._updatePointerPosition(q),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=q.button),g.preventDefaultOnPointerDown&&d&&(q.preventDefault(),d.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,q,E.b.POINTERDOWN))return;if(!g.cameraToUseForPointers&&!g.activeCamera)return;let h;this._pointerCaptures[q.pointerId]=!0,g.pointerDownPredicate||(g.pointerDownPredicate=q=>q.Xr&&q.isVisible&&q.isReady()&&q.isEnabled()&&(!g.cameraToUseForPointers||0!==(g.cameraToUseForPointers.layerMask&q.layerMask))),this._pickedDownMesh=null,h=g.skipPointerDownPicking||0===g._registeredActions&&!this._checkForPicking()&&!g.onPointerDown?new z.d:g.Sj(this._unTranslatedPointerX,this._unTranslatedPointerY,g.pointerDownPredicate,g.pointerDownFastCheck,g.cameraToUseForPointers,g.pointerDownTrianglePredicate),this._processPointerDown(h,q)},this._onPointerUp=q=>{const f=this._activePointerIds.indexOf(q.pointerId);-1!==f&&(this._activePointerIds[f]=-1,this._activePointerIdsCount--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(q),g.preventDefaultOnPointerUp&&d&&(q.preventDefault(),d.focus()),this._initClickEvent(g.onPrePointerObservable,g.onPointerObservable,q,((f,j)=>{if(g.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!f.ignore)){if(this._checkPrePointerObservable(null,q,E.b.POINTERUP))return this._swipeButtonPressed===q.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),void(0===q.buttons&&(this._pointerCaptures[q.pointerId]=!1));f.hasSwiped||(f.singleClick&&g.onPrePointerObservable.hasSpecificMask(E.b.POINTERTAP)&&this._checkPrePointerObservable(null,q,E.b.POINTERTAP)&&(this._skipPointerTap=!0),f.Wd&&g.onPrePointerObservable.hasSpecificMask(E.b.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,q,E.b.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}this._pointerCaptures[q.pointerId]?(0===q.buttons&&(this._pointerCaptures[q.pointerId]=!1),(g.cameraToUseForPointers||g.activeCamera)&&(g.pointerUpPredicate||(g.pointerUpPredicate=q=>q.Xr&&q.isVisible&&q.isReady()&&q.isEnabled()&&(!g.cameraToUseForPointers||0!==(g.cameraToUseForPointers.layerMask&q.layerMask))),!this._meshPickProceed&&(s&&s.HasTriggers||this._checkForPicking()||g.onPointerUp)&&this._initActionManager(null,f),j||(j=this._currentPickResult),this._processPointerUp(j,q,f),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===q.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))):this._swipeButtonPressed===q.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1)})))},this._onKeyDown=q=>{const f=U.c.KEYDOWN;if(g.onPreKeyboardObservable.hasObservers()){const j=new U.d(f,q);if(g.onPreKeyboardObservable.notifyObservers(j,f),j.skipOnKeyboardObservable)return}if(g.onKeyboardObservable.hasObservers()){const j=new U.h(f,q);g.onKeyboardObservable.notifyObservers(j,f)}g.actionManager&&g.actionManager.processTrigger(14,B.CreateNewFromScene(g,q))},this._onKeyUp=q=>{const f=U.c.KEYUP;if(g.onPreKeyboardObservable.hasObservers()){const j=new U.d(f,q);if(g.onPreKeyboardObservable.notifyObservers(j,f),j.skipOnKeyboardObservable)return}if(g.onKeyboardObservable.hasObservers()){const j=new U.h(f,q);g.onKeyboardObservable.notifyObservers(j,f)}g.actionManager&&g.actionManager.processTrigger(15,B.CreateNewFromScene(g,q))},this._deviceSourceManager.onDeviceConnectedObservable.add((d=>{d.deviceType===S.Mouse?d.onInputChangedObservable.add((g=>{this._originMouseEvent=g,g.inputIndex===e.LeftClick||g.inputIndex===e.MiddleClick||g.inputIndex===e.RightClick||g.inputIndex===e.BrowserBack||g.inputIndex===e.BrowserForward?f&&1===d.getInput(g.inputIndex)?this._onPointerDown(g):q&&0===d.getInput(g.inputIndex)&&this._onPointerUp(g):j&&(g.inputIndex===e.Move?this._onPointerMove(g):g.inputIndex!==e.MouseWheelX&&g.inputIndex!==e.MouseWheelY&&g.inputIndex!==e.MouseWheelZ||this._onPointerMove(g))})):d.deviceType===S.Touch?d.onInputChangedObservable.add((g=>{g.inputIndex===e.LeftClick&&(f&&1===d.getInput(g.inputIndex)?(this._onPointerDown(g),this._activePointerIdsCount>1&&(this._isMultiTouchGesture=!0)):q&&0===d.getInput(g.inputIndex)&&(this._onPointerUp(g),0===this._activePointerIdsCount&&(this._isMultiTouchGesture=!1))),j&&g.inputIndex===e.Move&&this._onPointerMove(g)})):d.deviceType===S.Keyboard&&d.onInputChangedObservable.add((q=>{"keydown"===q.type?this._onKeyDown(q):"keyup"===q.type&&this._onKeyUp(q)}))})),this._alreadyAttached=!0}qz(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2?arguments[2]:void 0,d=arguments.length>3?arguments[3]:void 0;if(this._meshUnderPointerId[f]===q&&(!q||!q._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const g=this._meshUnderPointerId[f];let h;g&&(h=g._getActionManagerForTrigger(10),h&&h.processTrigger(10,new B(g,this._pointerX,this._pointerY,q,d,{pointerId:f}))),q?(this._meshUnderPointerId[f]=q,this._pointerOverMesh=q,h=q._getActionManagerForTrigger(9),h&&h.processTrigger(9,new B(q,this._pointerX,this._pointerY,q,d,{pointerId:f,pickResult:j}))):(delete this._meshUnderPointerId[f],this._pointerOverMesh=null),this._scene.onMeshUnderPointerUpdatedObservable.hasObservers()&&this._scene.onMeshUnderPointerUpdatedObservable.notifyObservers({mesh:q,pointerId:f})}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(q){this._pointerOverMesh===q&&(this._pointerOverMesh=null),this._pickedDownMesh===q&&(this._pickedDownMesh=null),this._pickedUpMesh===q&&(this._pickedUpMesh=null);for(const f in this._meshUnderPointerId)this._meshUnderPointerId[f]===q&&delete this._meshUnderPointerId[f]}}y.DragMovementThreshold=10,y.LongPressDelay=500,y.DoubleClickDelay=300,y.ExclusiveDoubleClickMode=!1;var p=j(11425),l=j(11210),V=j(11303),a=j(11540),P=j(11030),C=j(11228),c=j(10958);class G{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.Qz=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}var m,K=j(11005),J=j(10965);!function(q){q[q.BackwardCompatible=0]="BackwardCompatible",q[q.Intermediate=1]="Intermediate",q[q.Aggressive=2]="Aggressive"}(m||(m={}));class qq{static DefaultMaterialFactory(q){throw(0,w.c)("Od")}static CollisionCoordinatorFactory(){throw(0,w.c)("DefaultCollisionCoordinator")}get clearColor(){return this._clearColor}set clearColor(q){q!==this._clearColor&&(this._clearColor=q,this.onClearColorChangedObservable.notifyObservers(this._clearColor))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get performancePriority(){return this._performancePriority}set performancePriority(q){if(q!==this._performancePriority){switch(this._performancePriority=q,q){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.Qz=!1,this.fz=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.Qz=!0,this.fz=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.Qz=!0,this.fz=!1}this.onScenePerformancePriorityChangedObservable.notifyObservers(q)}}set forceWireframe(q){this._forceWireframe!==q&&(this._forceWireframe=q,this.markAllMaterialsAsDirty(16))}get forceWireframe(){return this._forceWireframe}set skipFrustumClipping(q){this._skipFrustumClipping!==q&&(this._skipFrustumClipping=q)}get skipFrustumClipping(){return this._skipFrustumClipping}set forcePointsCloud(q){this._forcePointsCloud!==q&&(this._forcePointsCloud=q,this.markAllMaterialsAsDirty(16))}get forcePointsCloud(){return this._forcePointsCloud}get environmentTexture(){return this._environmentTexture}set environmentTexture(q){this._environmentTexture!==q&&(this._environmentTexture=q,this.onEnvironmentTextureChangedObservable.notifyObservers(q),this.markAllMaterialsAsDirty(1))}getNodes(){let q=[];q=q.concat(this.meshes),q=q.concat(this.lights),q=q.concat(this.cameras),q=q.concat(this.transformNodes);for(const f of this.skeletons)q=q.concat(f.bones);return q}get animationPropertiesOverride(){return this._animationPropertiesOverride}set animationPropertiesOverride(q){this._animationPropertiesOverride=q}set onDispose(q){this._onDisposeObserver&&this.qd.remove(this._onDisposeObserver),this._onDisposeObserver=this.qd.add(q)}set beforeRender(q){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),q&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(q))}set afterRender(q){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),q&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(q))}set beforeCameraRender(q){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(q)}set afterCameraRender(q){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(q)}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}set pointerDownPredicate(q){this._pointerPickingConfiguration.pointerDownPredicate=q}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}set pointerUpPredicate(q){this._pointerPickingConfiguration.pointerUpPredicate=q}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}set pointerMovePredicate(q){this._pointerPickingConfiguration.pointerMovePredicate=q}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}set pointerDownFastCheck(q){this._pointerPickingConfiguration.pointerDownFastCheck=q}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}set pointerUpFastCheck(q){this._pointerPickingConfiguration.pointerUpFastCheck=q}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}set pointerMoveFastCheck(q){this._pointerPickingConfiguration.pointerMoveFastCheck=q}get Qz(){return this._pointerPickingConfiguration.Qz}set Qz(q){this._pointerPickingConfiguration.Qz=q}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}set skipPointerDownPicking(q){this._pointerPickingConfiguration.skipPointerDownPicking=q}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}set skipPointerUpPicking(q){this._pointerPickingConfiguration.skipPointerUpPicking=q}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}static get DragMovementThreshold(){return y.DragMovementThreshold}static set DragMovementThreshold(q){y.DragMovementThreshold=q}static get LongPressDelay(){return y.LongPressDelay}static set LongPressDelay(q){y.LongPressDelay=q}static get DoubleClickDelay(){return y.DoubleClickDelay}static set DoubleClickDelay(q){y.DoubleClickDelay=q}static get ExclusiveDoubleClickMode(){return y.ExclusiveDoubleClickMode}static set ExclusiveDoubleClickMode(q){y.ExclusiveDoubleClickMode=q}bindEyePosition(q){var f;let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vEyePosition",d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const g=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:(null===(f=this.activeCamera)||void 0===f?void 0:f.globalPosition)??r.j.ZeroReadOnly,h=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return r.f.Vector4[0].set(g.x,g.y,g.z,h?-1:1),q&&(d?q.setFloat3(j,r.f.Vector4[0].x,r.f.Vector4[0].y,r.f.Vector4[0].z):q.setVector4(j,r.f.Vector4[0])),r.f.Vector4[0]}finalizeSceneUbo(){const q=this.getSceneUniformBuffer(),f=this.bindEyePosition(null);return q.updateFloat4("vEyePosition",f.x,f.y,f.z,f.w),q.update(),q}set useRightHandedSystem(q){this._useRightHandedSystem!==q&&(this._useRightHandedSystem=q,this.markAllMaterialsAsDirty(16))}get useRightHandedSystem(){return this._useRightHandedSystem}setStepId(q){this._currentStepId=q}getStepId(){return this._currentStepId}getInternalStep(){return this._currentInternalStep}set fogEnabled(q){this._fogEnabled!==q&&(this._fogEnabled=q,this.markAllMaterialsAsDirty(16))}get fogEnabled(){return this._fogEnabled}set fogMode(q){this._fogMode!==q&&(this._fogMode=q,this.markAllMaterialsAsDirty(16))}get fogMode(){return this._fogMode}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set shadowsEnabled(q){this._shadowsEnabled!==q&&(this._shadowsEnabled=q,this.markAllMaterialsAsDirty(2))}get shadowsEnabled(){return this._shadowsEnabled}set lightsEnabled(q){this._lightsEnabled!==q&&(this._lightsEnabled=q,this.markAllMaterialsAsDirty(2))}get lightsEnabled(){return this._lightsEnabled}get activeCameras(){return this._activeCameras}set activeCameras(q){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),q&&(this._unObserveActiveCameras=(0,c.j)(q,(()=>{this.onActiveCamerasChanged.notifyObservers(this)}))),this._activeCameras=q}get activeCamera(){return this._activeCamera}set activeCamera(q){q!==this._activeCamera&&(this._activeCamera=q,this.onActiveCameraChanged.notifyObservers(this))}get _hasDefaultMaterial(){return qq.DefaultMaterialFactory!==qq._OriginalDefaultMaterialFactory}get defaultMaterial(){return this.nX||(this.nX=qq.DefaultMaterialFactory(this)),this.nX}set defaultMaterial(q){this.nX=q}set texturesEnabled(q){this._texturesEnabled!==q&&(this._texturesEnabled=q,this.markAllMaterialsAsDirty(1))}get texturesEnabled(){return this._texturesEnabled}get frameGraph(){return this._frameGraph}set frameGraph(q){if(this._frameGraph)return this._frameGraph=q,void(q||(this.customRenderFunction=this._currentCustomRenderFunction));this._frameGraph=q,q&&(this._currentCustomRenderFunction=this.customRenderFunction,this.customRenderFunction=this._renderWithFrameGraph,this.activeCamera=null)}set skeletonsEnabled(q){this._skeletonsEnabled!==q&&(this._skeletonsEnabled=q,this.markAllMaterialsAsDirty(8))}get skeletonsEnabled(){return this._skeletonsEnabled}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=qq.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get renderingManager(){return this._renderingManager}get frustumPlanes(){return this._frustumPlanes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const q of this._transientComponents)q.register();this._transientComponents.length=0}}if(q){this._components.push(q),this._transientComponents.push(q);const f=q;f.addFromContainer&&f.serialize&&this._serializableComponents.push(f)}_getComponent(q){for(const f of this._components)if(f.name===q)return f;return null}get uniqueId(){return this._uniqueId}constructor(q,f){this._inputManager=new y(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.fz=!0,this.autoClearDepthAndStencil=!0,this._clearColor=new l.e(.2,.2,.3,1),this.onClearColorChangedObservable=new h.d,this.ambientColor=new l.c(0,0,0),this.environmentIntensity=1,this.iblIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new h.d,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.ez=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.effectLayers=[],this.QB=null,this.layers=[],this.lensFlareSystems=[],this.proceduralTextures=[],this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.qd=new h.d,this._onDisposeObserver=null,this.onBeforeRenderObservable=new h.d,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new h.d,this.onAfterRenderCameraObservable=new h.d,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new h.d,this.onAfterAnimationsObservable=new h.d,this.onBeforeDrawPhaseObservable=new h.d,this.onAfterDrawPhaseObservable=new h.d,this.onReadyObservable=new h.d,this.onBeforeCameraRenderObservable=new h.d,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new h.d,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new h.d,this.onAfterActiveMeshesEvaluationObservable=new h.d,this.onBeforeParticlesRenderingObservable=new h.d,this.onAfterParticlesRenderingObservable=new h.d,this.onDataLoadedObservable=new h.d,this.onNewCameraAddedObservable=new h.d,this.onCameraRemovedObservable=new h.d,this.onNewLightAddedObservable=new h.d,this.onLightRemovedObservable=new h.d,this.onNewGeometryAddedObservable=new h.d,this.onGeometryRemovedObservable=new h.d,this.onNewTransformNodeAddedObservable=new h.d,this.onTransformNodeRemovedObservable=new h.d,this.onNewMeshAddedObservable=new h.d,this.onMeshRemovedObservable=new h.d,this.onNewSkeletonAddedObservable=new h.d,this.onSkeletonRemovedObservable=new h.d,this.onNewMaterialAddedObservable=new h.d,this.onNewMultiMaterialAddedObservable=new h.d,this.onMaterialRemovedObservable=new h.d,this.onMultiMaterialRemovedObservable=new h.d,this.onNewTextureAddedObservable=new h.d,this.onTextureRemovedObservable=new h.d,this.onBeforeRenderTargetsRenderObservable=new h.d,this.onAfterRenderTargetsRenderObservable=new h.d,this.onBeforeStepObservable=new h.d,this.onAfterStepObservable=new h.d,this.onActiveCameraChanged=new h.d,this.onActiveCamerasChanged=new h.d,this.onBeforeRenderingGroupObservable=new h.d,this.onAfterRenderingGroupObservable=new h.d,this.onMeshImportedObservable=new h.d,this.onAnimationFileImportedObservable=new h.d,this.onEnvironmentTextureChangedObservable=new h.d,this.onMeshUnderPointerUpdatedObservable=new h.d,this._registeredForLateAnimationBindings=new L.c(256),this._pointerPickingConfiguration=new G,this.onPrePointerObservable=new h.d,this.onPointerObservable=new h.d,this.onPreKeyboardObservable=new h.d,this.onKeyboardObservable=new h.d,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=qq.FOGMODE_NONE,this.fogColor=new l.c(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this._frameGraph=null,this.frameGraphs=[],this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new r.j(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new L.c(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new p.b,this._activeIndices=new p.b,this._activeParticles=new p.b,this._activeBones=new p.b,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=[],this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new L.g(256),this._processedMaterials=new L.g(256),this._renderTargets=new L.c(256),this._materialsRenderTargets=new L.c(256),this._activeParticleSystems=new L.g(256),this._activeSkeletons=new L.c(32),this._softwareSkinnedMeshes=new L.c(32),this._activeAnimatables=new Array,this._transformMatrix=r.b.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=t.c.Create(),this._beforeClearStage=t.c.Create(),this._beforeRenderTargetClearStage=t.c.Create(),this._gatherRenderTargetsStage=t.c.Create(),this._gatherActiveCameraRenderTargetsStage=t.c.Create(),this._isReadyForMeshStage=t.c.Create(),this._beforeEvaluateActiveMeshStage=t.c.Create(),this._evaluateSubMeshStage=t.c.Create(),this._preActiveMeshStage=t.c.Create(),this._cameraDrawRenderTargetStage=t.c.Create(),this._beforeCameraDrawStage=t.c.Create(),this._beforeRenderTargetDrawStage=t.c.Create(),this._beforeRenderingGroupDrawStage=t.c.Create(),this._beforeRenderingMeshStage=t.c.Create(),this._afterRenderingMeshStage=t.c.Create(),this._afterRenderingGroupDrawStage=t.c.Create(),this._afterCameraDrawStage=t.c.Create(),this._afterCameraPostProcessStage=t.c.Create(),this._afterRenderTargetDrawStage=t.c.Create(),this._afterRenderTargetPostProcessStage=t.c.Create(),this._afterRenderStage=t.c.Create(),this._pointerMoveStage=t.c.Create(),this._pointerDownStage=t.c.Create(),this._pointerUpStage=t.c.Create(),this._geometriesByUniqueId=null,this._uniqueId=0,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._useCurrentFrameBuffer=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[],this._uniqueId=this.getUniqueId();const j={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...f};q=this._engine=q||N.d.LastCreatedEngine,j.virtual?q._virtualScenes.push(this):(N.d._LastCreatedScene=this,q.scenes.push(this)),this._uid=null,this._renderingManager=new i.c(this),D.e&&(this.postProcessManager=new D.e(this)),(0,O.h)()&&this.attachControl(),this._createUbo(),u.c&&(this._imageProcessingConfiguration=new u.c),this.setDefaultCandidateProviders(),j.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=j.useMaterialMeshMap,this.useClonedMeshMap=j.useClonedMeshMap,f&&f.virtual||q.onNewSceneAddedObservable.notifyObservers(this)}getClassName(){return"Scene"}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_getDefaultSubMeshCandidates(q){return this._defaultSubMeshCandidates.data=q.Qd,this._defaultSubMeshCandidates.length=q.Qd.length,this._defaultSubMeshCandidates}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=q=>this._getDefaultSubMeshCandidates(q),this.getIntersectingSubMeshCandidates=(q,f)=>this._getDefaultSubMeshCandidates(q),this.getCollidingSubMeshCandidates=(q,f)=>this._getDefaultSubMeshCandidates(q)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}get pointerX(){return this._inputManager.pointerX}set pointerX(q){this._inputManager.pointerX=q}get pointerY(){return this._inputManager.pointerY}set pointerY(q){this._inputManager.pointerY=q}getCachedMaterial(){return this._cachedMaterial}getCachedEffect(){return this._cachedEffect}getCachedVisibility(){return this._cachedVisibility}isCachedMaterialInvalid(q,f){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this._cachedEffect!==f||this._cachedMaterial!==q||this._cachedVisibility!==j}getEngine(){return this._engine}getTotalVertices(){return this._totalVertices.current}get totalVerticesPerfCounter(){return this._totalVertices}getActiveIndices(){return this._activeIndices.current}get totalActiveIndicesPerfCounter(){return this._activeIndices}getActiveParticles(){return this._activeParticles.current}get activeParticlesPerfCounter(){return this._activeParticles}getActiveBones(){return this._activeBones.current}get activeBonesPerfCounter(){return this._activeBones}getActiveMeshes(){return this._activeMeshes}getAnimationRatio(){return void 0!==this._animationRatio?this._animationRatio:1}getRenderId(){return this._renderId}getFrameId(){return this._frameId}incrementRenderId(){this._renderId++}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}simulatePointerMove(q,f){return this._inputManager.simulatePointerMove(q,f),this}simulatePointerDown(q,f){return this._inputManager.simulatePointerDown(q,f),this}simulatePointerUp(q,f,j){return this._inputManager.simulatePointerUp(q,f,j),this}isPointerCaptured(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._inputManager.isPointerCaptured(q)}attachControl(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._inputManager.attachControl(q,f,j)}qz(){this._inputManager.qz()}isReady(){var q,f;let j,d=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._isDisposed)return!1;const g=this.getEngine(),h=g.currentRenderPassId;g.currentRenderPassId=(null===(q=this.activeCamera)||void 0===q?void 0:q.renderPassId)??h;let L=!0;for(this._pendingData.length>0&&(L=!1),null===(f=this.prePassRenderer)||void 0===f||f.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&L&&(L=this.depthPeelingRenderer.isReady()),d&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),j=0;j<this.meshes.length;j++){const q=this.meshes[j];if(!q.Qd||0===q.Qd.length)continue;if(!q.isReady(!0)){L=!1;continue}const f=q.hasThinInstances||"InstancedMesh"===q.getClassName()||"InstancedLinesMesh"===q.getClassName()||g.getCaps().instancedArrays&&q.instances.length>0;for(const j of this._isReadyForMeshStage)j.action(q,f)||(L=!1);if(!d)continue;const h=q.material||this.defaultMaterial;if(h)if(h._storeEffectOnSubMeshes)for(const j of q.Qd){const q=j.bq();q&&q.hasRenderTargetTextures&&null!=q.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(q)&&(this._processedMaterials.push(q),this._materialsRenderTargets.concatWithNoDuplicate(q.getRenderTargetTextures()))}else h.hasRenderTargetTextures&&null!=h.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(h)&&(this._processedMaterials.push(h),this._materialsRenderTargets.concatWithNoDuplicate(h.getRenderTargetTextures()))}if(d)for(j=0;j<this._materialsRenderTargets.length;++j){this._materialsRenderTargets.data[j].isReadyForRendering()||(L=!1)}for(j=0;j<this.geometries.length;j++){2===this.geometries[j].delayLoadState&&(L=!1)}if(this.activeCameras&&this.activeCameras.length>0)for(const Q of this.activeCameras)Q.isReady(!0)||(L=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(L=!1));for(const Q of this.ez)Q.isReady()||(L=!1);if(this.layers)for(const Q of this.layers)Q.isReady()||(L=!1);if(this.effectLayers)for(const Q of this.effectLayers)Q.isLayerReady()||(L=!1);return g.areAllEffectsReady()||(L=!1),g.currentRenderPassId=h,L}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}registerBeforeRender(q){this.onBeforeRenderObservable.add(q)}unregisterBeforeRender(q){this.onBeforeRenderObservable.removeCallback(q)}registerAfterRender(q){this.onAfterRenderObservable.add(q)}unregisterAfterRender(q){this.onAfterRenderObservable.removeCallback(q)}_executeOnceBeforeRender(q){const f=()=>{q(),setTimeout((()=>{this.unregisterBeforeRender(f)}))};this.registerBeforeRender(f)}executeOnceBeforeRender(q,f){void 0!==f?setTimeout((()=>{this._executeOnceBeforeRender(q)}),f):this._executeOnceBeforeRender(q)}addPendingData(q){this._pendingData.push(q)}removePendingData(q){const f=this.isLoading,j=this._pendingData.indexOf(q);-1!==j&&this._pendingData.splice(j,1),f&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}getWaitingItemsCount(){return this._pendingData.length}get isLoading(){return this._pendingData.length>0}executeWhenReady(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.onReadyObservable.addOnce(q),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(f)}async whenReadyAsync(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return await new Promise((f=>{this.executeWhenReady((()=>{f()}),q)}))}_checkIsReady(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._registerTransientComponents(),this.isReady(q)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((()=>{this.incrementRenderId(),this._checkIsReady(q)}),100))}get animatables(){return this._activeAnimatables}resetLastAnimationTimeFrame(){this._animationTimeLast=g.c.Now}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projectionMatrix}getTransformMatrix(){return this._transformMatrix}setTransformMatrix(q,f,j,d){j||d||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===q.updateFlag&&this._projectionUpdateFlag===f.updateFlag||(this._viewUpdateFlag=q.updateFlag,this._projectionUpdateFlag=f.updateFlag,this._viewMatrix=q,this._projectionMatrix=f,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?V.d.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=V.d.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(j,d):this._sceneUbo.useUbo&&(this._sceneUbo.jd("viewProjection",this._transformMatrix),this._sceneUbo.jd("view",this._viewMatrix),this._sceneUbo.jd("projection",this._projectionMatrix)))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}createSceneUniformBuffer(q){const f=new X.d(this._engine,void 0,!1,q??"Sf");return f.addUniform("viewProjection",16),f.addUniform("view",16),f.addUniform("projection",16),f.addUniform("vEyePosition",4),f}setSceneUniformBuffer(q){this._sceneUbo=q,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}getUniqueId(){return a.d.UniqueId}Iu(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._blockEntityCollection&&(this.meshes.push(q),q._resyncLightSources(),q.parent||q._addToSceneRootNodes(),d.h.SetImmediate((()=>{this.onNewMeshAddedObservable.notifyObservers(q)})),f)){const f=q.getChildMeshes();for(const q of f)this.Iu(q)}}Zu(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const j=this.meshes.indexOf(q);if(-1!==j&&(this.meshes.splice(j,1),q.parent||q._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(q),this.onMeshRemovedObservable.notifyObservers(q),f){const f=q.getChildMeshes();for(const q of f)this.Zu(q)}return j}addTransformNode(q){this._blockEntityCollection||q.eq()===this&&-1!==q._indexInSceneTransformNodesArray||(q._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(q),q.parent||q._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(q))}removeTransformNode(q){const f=q._indexInSceneTransformNodesArray;if(-1!==f){if(f!==this.transformNodes.length-1){const q=this.transformNodes[this.transformNodes.length-1];this.transformNodes[f]=q,q._indexInSceneTransformNodesArray=f}q._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),q.parent||q._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(q),f}removeSkeleton(q){const f=this.skeletons.indexOf(q);return-1!==f&&(this.skeletons.splice(f,1),this.onSkeletonRemovedObservable.notifyObservers(q),this._executeActiveContainerCleanup(this._activeSkeletons)),f}removeMorphTargetManager(q){const f=this.morphTargetManagers.indexOf(q);return-1!==f&&this.morphTargetManagers.splice(f,1),f}removeLight(q){const f=this.lights.indexOf(q);if(-1!==f){for(const f of this.meshes)f._removeLightSource(q,!1);this.lights.splice(f,1),this.sortLightsByPriority(),q.parent||q._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(q),f}removeCamera(q){const f=this.cameras.indexOf(q);if(-1!==f&&(this.cameras.splice(f,1),q.parent||q._removeFromSceneRootNodes()),this.activeCameras){const f=this.activeCameras.indexOf(q);-1!==f&&this.activeCameras.splice(f,1)}return this.activeCamera===q&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(q),f}removeParticleSystem(q){const f=this.ez.indexOf(q);return-1!==f&&(this.ez.splice(f,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),f}removeAnimation(q){const f=this.animations.indexOf(q);return-1!==f&&this.animations.splice(f,1),f}stopAnimation(q,f,j){}removeAnimationGroup(q){const f=this.animationGroups.indexOf(q);return-1!==f&&this.animationGroups.splice(f,1),f}removeMultiMaterial(q){const f=this.multiMaterials.indexOf(q);return-1!==f&&this.multiMaterials.splice(f,1),this.onMultiMaterialRemovedObservable.notifyObservers(q),f}removeMaterial(q){const f=q._indexInSceneMaterialArray;if(-1!==f&&f<this.materials.length){if(f!==this.materials.length-1){const q=this.materials[this.materials.length-1];this.materials[f]=q,q._indexInSceneMaterialArray=f}q._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(q),f}removeActionManager(q){const f=this.actionManagers.indexOf(q);return-1!==f&&this.actionManagers.splice(f,1),f}removeTexture(q){const f=this.textures.indexOf(q);return-1!==f&&this.textures.splice(f,1),this.onTextureRemovedObservable.notifyObservers(q),f}addLight(q){if(!this._blockEntityCollection){this.lights.push(q),this.sortLightsByPriority(),q.parent||q._addToSceneRootNodes();for(const f of this.meshes)-1===f.lightSources.indexOf(q)&&(f.lightSources.push(q),f._resyncLightSources());d.h.SetImmediate((()=>{this.onNewLightAddedObservable.notifyObservers(q)}))}}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(C.d.CompareLightsPriority)}addCamera(q){this._blockEntityCollection||(this.cameras.push(q),d.h.SetImmediate((()=>{this.onNewCameraAddedObservable.notifyObservers(q)})),q.parent||q._addToSceneRootNodes())}addSkeleton(q){this._blockEntityCollection||(this.skeletons.push(q),d.h.SetImmediate((()=>{this.onNewSkeletonAddedObservable.notifyObservers(q)})))}addParticleSystem(q){this._blockEntityCollection||this.ez.push(q)}addAnimation(q){this._blockEntityCollection||this.animations.push(q)}addAnimationGroup(q){this._blockEntityCollection||this.animationGroups.push(q)}addMultiMaterial(q){this._blockEntityCollection||(this.multiMaterials.push(q),d.h.SetImmediate((()=>{this.onNewMultiMaterialAddedObservable.notifyObservers(q)})))}addMaterial(q){this._blockEntityCollection||q.eq()===this&&-1!==q._indexInSceneMaterialArray||(q._indexInSceneMaterialArray=this.materials.length,this.materials.push(q),d.h.SetImmediate((()=>{this.onNewMaterialAddedObservable.notifyObservers(q)})))}addMorphTargetManager(q){this._blockEntityCollection||this.morphTargetManagers.push(q)}addGeometry(q){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[q.uniqueId]=this.geometries.length),this.geometries.push(q))}addActionManager(q){this.actionManagers.push(q)}addTexture(q){this._blockEntityCollection||(this.textures.push(q),this.onNewTextureAddedObservable.notifyObservers(q))}switchActiveCamera(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.qz(),this.activeCamera=q,f&&q.attachControl())}setActiveCameraById(q){const f=this.getCameraById(q);return f?(this.activeCamera=f,f):null}setActiveCameraByName(q){const f=this.getCameraByName(q);return f?(this.activeCamera=f,f):null}getAnimationGroupByName(q){for(let f=0;f<this.animationGroups.length;f++)if(this.animationGroups[f].name===q)return this.animationGroups[f];return null}_getMaterial(q,f){for(let j=0;j<this.materials.length;j++){const q=this.materials[j];if(f(q))return q}if(q)for(let j=0;j<this.multiMaterials.length;j++){const q=this.multiMaterials[j];if(f(q))return q}return null}getMaterialByUniqueID(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.getMaterialByUniqueId(q,f)}getMaterialByUniqueId(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(f,(f=>f.uniqueId===q))}getMaterialById(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(f,(f=>f.id===q))}getMaterialByName(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(f,(f=>f.name===q))}getLastMaterialById(q){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(let j=this.materials.length-1;j>=0;j--)if(this.materials[j].id===q)return this.materials[j];if(f)for(let j=this.multiMaterials.length-1;j>=0;j--)if(this.multiMaterials[j].id===q)return this.multiMaterials[j];return null}getTextureByUniqueId(q){for(let f=0;f<this.textures.length;f++)if(this.textures[f].uniqueId===q)return this.textures[f];return null}getTextureByName(q){for(let f=0;f<this.textures.length;f++)if(this.textures[f].name===q)return this.textures[f];return null}getCameraById(q){for(let f=0;f<this.cameras.length;f++)if(this.cameras[f].id===q)return this.cameras[f];return null}getCameraByUniqueId(q){for(let f=0;f<this.cameras.length;f++)if(this.cameras[f].uniqueId===q)return this.cameras[f];return null}getCameraByName(q){for(let f=0;f<this.cameras.length;f++)if(this.cameras[f].name===q)return this.cameras[f];return null}getBoneById(q){for(let f=0;f<this.skeletons.length;f++){const j=this.skeletons[f];for(let f=0;f<j.bones.length;f++)if(j.bones[f].id===q)return j.bones[f]}return null}getBoneByName(q){for(let f=0;f<this.skeletons.length;f++){const j=this.skeletons[f];for(let f=0;f<j.bones.length;f++)if(j.bones[f].name===q)return j.bones[f]}return null}getLightByName(q){for(let f=0;f<this.lights.length;f++)if(this.lights[f].name===q)return this.lights[f];return null}getLightById(q){for(let f=0;f<this.lights.length;f++)if(this.lights[f].id===q)return this.lights[f];return null}getLightByUniqueId(q){for(let f=0;f<this.lights.length;f++)if(this.lights[f].uniqueId===q)return this.lights[f];return null}getParticleSystemById(q){for(let f=0;f<this.ez.length;f++)if(this.ez[f].id===q)return this.ez[f];return null}getGeometryById(q){for(let f=0;f<this.geometries.length;f++)if(this.geometries[f].id===q)return this.geometries[f];return null}_getGeometryByUniqueId(q){if(this._geometriesByUniqueId){const f=this._geometriesByUniqueId[q];if(void 0!==f)return this.geometries[f]}else for(let f=0;f<this.geometries.length;f++)if(this.geometries[f].uniqueId===q)return this.geometries[f];return null}getFrameGraphByName(q){for(let f=0;f<this.frameGraphs.length;f++)if(this.frameGraphs[f].name===q)return this.frameGraphs[f];return null}pushGeometry(q,f){return!(!f&&this._getGeometryByUniqueId(q.uniqueId))&&(this.addGeometry(q),d.h.SetImmediate((()=>{this.onNewGeometryAddedObservable.notifyObservers(q)})),!0)}removeGeometry(q){let f;if(this._geometriesByUniqueId){if(f=this._geometriesByUniqueId[q.uniqueId],void 0===f)return!1}else if(f=this.geometries.indexOf(q),f<0)return!1;if(f!==this.geometries.length-1){const q=this.geometries[this.geometries.length-1];q&&(this.geometries[f]=q,this._geometriesByUniqueId&&(this._geometriesByUniqueId[q.uniqueId]=f))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[q.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(q),!0}getGeometries(){return this.geometries}getMeshById(q){for(let f=0;f<this.meshes.length;f++)if(this.meshes[f].id===q)return this.meshes[f];return null}getMeshesById(q){return this.meshes.filter((function(f){return f.id===q}))}getTransformNodeById(q){for(let f=0;f<this.transformNodes.length;f++)if(this.transformNodes[f].id===q)return this.transformNodes[f];return null}getTransformNodeByUniqueId(q){for(let f=0;f<this.transformNodes.length;f++)if(this.transformNodes[f].uniqueId===q)return this.transformNodes[f];return null}getTransformNodesById(q){return this.transformNodes.filter((function(f){return f.id===q}))}getMeshByUniqueId(q){for(let f=0;f<this.meshes.length;f++)if(this.meshes[f].uniqueId===q)return this.meshes[f];return null}getLastMeshById(q){for(let f=this.meshes.length-1;f>=0;f--)if(this.meshes[f].id===q)return this.meshes[f];return null}getLastTransformNodeById(q){for(let f=this.transformNodes.length-1;f>=0;f--)if(this.transformNodes[f].id===q)return this.transformNodes[f];return null}getLastEntryById(q){let f;for(f=this.meshes.length-1;f>=0;f--)if(this.meshes[f].id===q)return this.meshes[f];for(f=this.transformNodes.length-1;f>=0;f--)if(this.transformNodes[f].id===q)return this.transformNodes[f];for(f=this.cameras.length-1;f>=0;f--)if(this.cameras[f].id===q)return this.cameras[f];for(f=this.lights.length-1;f>=0;f--)if(this.lights[f].id===q)return this.lights[f];return null}getNodeById(q){const f=this.getMeshById(q);if(f)return f;const j=this.getTransformNodeById(q);if(j)return j;const d=this.getLightById(q);if(d)return d;const g=this.getCameraById(q);if(g)return g;const h=this.getBoneById(q);return h||null}getNodeByName(q){const f=this.getMeshByName(q);if(f)return f;const j=this.getTransformNodeByName(q);if(j)return j;const d=this.getLightByName(q);if(d)return d;const g=this.getCameraByName(q);if(g)return g;const h=this.getBoneByName(q);return h||null}getMeshByName(q){for(let f=0;f<this.meshes.length;f++)if(this.meshes[f].name===q)return this.meshes[f];return null}getTransformNodeByName(q){for(let f=0;f<this.transformNodes.length;f++)if(this.transformNodes[f].name===q)return this.transformNodes[f];return null}getLastSkeletonById(q){for(let f=this.skeletons.length-1;f>=0;f--)if(this.skeletons[f].id===q)return this.skeletons[f];return null}getSkeletonByUniqueId(q){for(let f=0;f<this.skeletons.length;f++)if(this.skeletons[f].uniqueId===q)return this.skeletons[f];return null}getSkeletonById(q){for(let f=0;f<this.skeletons.length;f++)if(this.skeletons[f].id===q)return this.skeletons[f];return null}getSkeletonByName(q){for(let f=0;f<this.skeletons.length;f++)if(this.skeletons[f].name===q)return this.skeletons[f];return null}getMorphTargetManagerById(q){for(let f=0;f<this.morphTargetManagers.length;f++)if(this.morphTargetManagers[f].uniqueId===q)return this.morphTargetManagers[f];return null}getMorphTargetById(q){for(let f=0;f<this.morphTargetManagers.length;++f){const j=this.morphTargetManagers[f];for(let f=0;f<j.numTargets;++f){const d=j.getTarget(f);if(d.id===q)return d}}return null}getMorphTargetByName(q){for(let f=0;f<this.morphTargetManagers.length;++f){const j=this.morphTargetManagers[f];for(let f=0;f<j.numTargets;++f){const d=j.getTarget(f);if(d.name===q)return d}}return null}getPostProcessByName(q){for(let f=0;f<this.postProcesses.length;++f){const j=this.postProcesses[f];if(j.name===q)return j}return null}isActiveMesh(q){return-1!==this._activeMeshes.indexOf(q)}get uid(){return this._uid||(this._uid=d.h.RandomId()),this._uid}addExternalData(q,f){return this._externalData||(this._externalData=new Q),this._externalData.add(q,f)}getExternalData(q){return this._externalData?this._externalData.get(q):null}getOrAddExternalDataWithFactory(q,f){return this._externalData||(this._externalData=new Q),this._externalData.getOrAddWithFactory(q,f)}removeExternalData(q){return this._externalData.remove(q)}_evaluateSubMesh(q,f,j,d){if(d||q.isInFrustum(this._frustumPlanes)){for(const d of this._evaluateSubMeshStage)d.action(f,q);const j=q.bq();null!==j&&void 0!==j&&(j.hasRenderTargetTextures&&null!=j.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(j)&&(this._processedMaterials.push(j),this._materialsRenderTargets.concatWithNoDuplicate(j.getRenderTargetTextures())),this._renderingManager.dispatch(q,f,j))}}freeProcessedMaterials(){this._processedMaterials.dispose()}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set blockfreeActiveMeshesAndRenderingGroups(q){this._preventFreeActiveMeshesAndRenderingGroups!==q&&(q&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=q)}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let q=0;q<this.activeCameras.length;q++){const f=this.activeCameras[q];f&&f._activeMeshes&&f._activeMeshes.dispose()}}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let q=0;q<this.textures.length;q++){const f=this.textures[q];f&&f.renderList&&f.freeRenderingGroups()}}_isInIntermediateRendering(){return this._intermediateRendering}freezeActiveMeshes(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1?arguments[1]:void 0,j=arguments.length>2?arguments[2]:void 0,d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],g=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.executeWhenReady((()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=g,this._skipEvaluateActiveMeshesCompletely=q,d)for(let q=0;q<this._activeMeshes.length;q++)this._activeMeshes.data[q]._freeze();f&&f()}else j&&j("No active camera found")})),this}unfreezeActiveMeshes(){for(let q=0;q<this.meshes.length;q++){const f=this.meshes[q];f._internalAbstractMeshDataInfo&&(f._internalAbstractMeshDataInfo._isActive=!1)}for(let q=0;q<this._activeMeshes.length;q++)this._activeMeshes.data[q]._unFreeze();return this._activeMeshesFrozen=!1,this}_executeActiveContainerCleanup(q){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((()=>q.dispose()))}_evaluateActiveMeshes(){if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode){var q;if(this._activeMeshes.length>0)null===(q=this.activeCamera)||void 0===q||q._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();return}if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const q=this._activeMeshes.length;for(let f=0;f<q;f++){this._activeMeshes.data[f].Nf()}}if(this._activeParticleSystems){const q=this._activeParticleSystems.length;for(let f=0;f<q;f++)this._activeParticleSystems.data[f].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const d of this._beforeEvaluateActiveMeshStage)d.action();const f=this.getActiveMeshCandidates(),j=f.length;for(let d=0;d<j;d++){const q=f.data[d];let j=q._internalAbstractMeshDataInfo._currentLOD.get(this.activeCamera);if(j?j[1]=-1:(j=[q,-1],q._internalAbstractMeshDataInfo._currentLOD.set(this.activeCamera,j)),q.isBlocked)continue;if(this._totalVertices.addCount(q.getTotalVertices(),!1),!q.isReady()||!q.isEnabled()||q.Vf.hasAZeroComponent)continue;q.Nf(),q.actionManager&&q.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(q);let g=this.customLODSelector?this.customLODSelector(q,this.activeCamera):q.getLOD(this.activeCamera);if(j[0]=g,j[1]=this._frameId,void 0!==g&&null!==g&&(g!==q&&0!==g.billboardMode&&g.Nf(),q._preActivate(),q.isVisible&&q.visibility>0&&0!==(q.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||q.Cg||q.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(q),this.activeCamera._activeMeshes.push(q),g!==q&&g._activate(this._renderId,!1);for(const f of this._preActiveMeshStage)f.action(q);q._activate(this._renderId,!1)&&(q.isAnInstance?q._internalAbstractMeshDataInfo._actAsRegularMesh&&(g=q):g._internalAbstractMeshDataInfo._onlyForInstances=!1,g._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(q,g)),q._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let q=0;q<this.ez.length;q++){const f=this.ez[q];if(!f.isStarted()||!f.k)continue;const j=f.k;j.position&&!j.isEnabled()||(this._activeParticleSystems.push(f),f.animate(),this._renderingManager.dispatchParticles(f))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}_prepareSkeleton(q){this._skeletonsEnabled&&q.skeleton&&(this._activeSkeletons.pushNoDuplicate(q.skeleton)&&(q.skeleton.prepare(),this._activeBones.addCount(q.skeleton.bones.length,!1)),q.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(q)&&this.frameGraph&&q.applySkeleton(q.skeleton))}_activeMesh(q,f){this._prepareSkeleton(f);let j=q.hasInstances||q.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||f.Cg;if(f&&f.Qd&&f.Qd.length>0){const d=this.getActiveSubMeshCandidates(f),g=d.length;j=j||1===g;for(let h=0;h<g;h++){const g=d.data[h];this._evaluateSubMesh(g,f,q,j)}}}updateTransformMatrix(q){const f=this.activeCamera;if(f)if(f._renderingMultiview){const j=f._rigCameras[0],d=f._rigCameras[1];this.setTransformMatrix(j.getViewMatrix(),j.getProjectionMatrix(q),d.getViewMatrix(),d.getProjectionMatrix(q))}else this.setTransformMatrix(f.getViewMatrix(),f.getProjectionMatrix(q))}_bindFrameBuffer(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._useCurrentFrameBuffer||(q&&q._multiviewTexture?q._multiviewTexture._bindFrameBuffer():q&&q.outputRenderTarget?q.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer()),f&&this._clearFrameBuffer(q)}_clearFrameBuffer(q){if(q&&q._multiviewTexture);else if(q&&q.outputRenderTarget&&!q._renderingMultiview){const f=q.outputRenderTarget;f.onClearObservable.hasObservers()?f.onClearObservable.notifyObservers(this._engine):f.skipInitialClear||q.isRightCamera||(this.fz&&this._engine.clear(f.clearColor||this._clearColor,!f._cleared,!0,!0),f._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_renderForCamera(q,f){var j;let g=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(q&&q._skipRendering)return;const h=this._engine;if(this._activeCamera=q,!this.activeCamera)throw new Error("Active camera not set");if(h.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&g){let f=!0;q._renderingMultiview&&q.outputRenderTarget&&(f=q.outputRenderTarget.skipInitialClear,this.fz&&(this._defaultFrameBufferCleared=!1,q.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),q._renderingMultiview&&q.outputRenderTarget&&(q.outputRenderTarget.skipInitialClear=f)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let d=0;d<this._softwareSkinnedMeshes.length;d++){const q=this._softwareSkinnedMeshes.data[d];q.applySkeleton(q.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),q.customRenderTargets&&q.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(q.customRenderTargets),f&&f.customRenderTargets&&f.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(f.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const d of this._gatherActiveCameraRenderTargetsStage)d.action(this._renderTargets);let L=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){d.h.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let q=0;q<this._renderTargets.length;q++){const f=this._renderTargets.data[q];if(f._shouldRender()){this._renderId++;const q=f.activeCamera&&f.activeCamera!==this.activeCamera;f.render(q,this.dumpNextRenderTargets),L=!0}}d.h.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const q of this._cameraDrawRenderTargetStage)L=q.action(this.activeCamera)||L;this._intermediateRendering=!1}this._engine.currentRenderPassId=(null===(j=q.outputRenderTarget)||void 0===j?void 0:j.renderPassId)??q.renderPassId??0,L&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||q._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const d of this._beforeCameraDrawStage)d.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),h.snapshotRendering&&1===h.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const d of this._afterCameraDrawStage)d.action(this.activeCamera);if(this.postProcessManager&&!q._multiviewTexture){const f=q.outputRenderTarget?q.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(q.isIntermediate,f)}for(const d of this._afterCameraPostProcessStage)d.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}_processSubCameras(q){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(0===q.cameraRigMode||q._renderingMultiview)return q._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(q,void 0,f),void this.onAfterRenderCameraObservable.notifyObservers(q);if(q._useMultiviewToSingleView)this._renderMultiviewToSingleView(q);else{this.onBeforeCameraRenderObservable.notifyObservers(q);for(let f=0;f<q._rigCameras.length;f++)this._renderForCamera(q._rigCameras[f],q)}this._activeCamera=q,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(q)}_checkIntersections(){for(let q=0;q<this._meshesForIntersections.length;q++){const f=this._meshesForIntersections.data[q];if(f.actionManager)for(let q=0;f.actionManager&&q<f.actionManager.actions.length;q++){const j=f.actionManager.actions[q];if(12===j.trigger||13===j.trigger){const q=j.getTriggerParameter(),d=q.mesh?q.mesh:q,g=d.intersectsMesh(f,q.usePreciseIntersection),h=f._intersectionsInProgress.indexOf(d);g&&-1===h?12===j.trigger?(j._executeCurrent(B.CreateNew(f,void 0,d)),f._intersectionsInProgress.push(d)):13===j.trigger&&f._intersectionsInProgress.push(d):!g&&h>-1&&(13===j.trigger&&j._executeCurrent(B.CreateNew(f,void 0,d)),f.actionManager.hasSpecificTrigger(13,(q=>{const f=q.mesh?q.mesh:q;return d===f}))&&13!==j.trigger||f._intersectionsInProgress.splice(h,1))}}}}_advancePhysicsEngineStep(q){}_animate(q){}animate(){if(this._engine.isDeterministicLockStep()){let q=Math.max(qq.MinDeltaTime,Math.min(this._engine.getDeltaTime(),qq.MaxDeltaTime))+this._timeAccumulator;const f=this._engine.getTimeStep(),j=1e3/f/1e3;let d=0;const g=this._engine.getLockstepMaxSteps();let h=Math.floor(q/f);for(h=Math.min(h,g);q>0&&d<h;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=f*j,this._animate(f),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(f),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,d++,q-=f;this._timeAccumulator=q<0?0:q}else{const q=this.useConstantAnimationDeltaTime?16:Math.max(qq.MinDeltaTime,Math.min(this._engine.getDeltaTime(),qq.MaxDeltaTime));this._animationRatio=.06*q,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(q)}}_clear(){(this.autoClearDepthAndStencil||this.fz)&&this._engine.clear(this._clearColor,this.fz||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}_checkCameraRenderTarget(q){var f;if(null===q||void 0===q||!q.outputRenderTarget||null!==q&&void 0!==q&&q.isRigCamera||(q.outputRenderTarget._cleared=!1),null!==q&&void 0!==q&&null!==(f=q.rigCameras)&&void 0!==f&&f.length)for(let j=0;j<q.rigCameras.length;++j){const f=q.rigCameras[j].outputRenderTarget;f&&(f._cleared=!1)}}resetDrawCache(q){if(this.meshes)for(const f of this.meshes)f.resetDrawCache(q)}_renderWithFrameGraph(){var q;let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.activeCamera=null,this._activeParticleSystems.reset(),this._activeSkeletons.reset(),f)for(const g of this.cameras)if(g.update(),0!==g.cameraRigMode)for(let q=0;q<g._rigCameras.length;q++)g._rigCameras[q].update();this.onBeforeRenderObservable.notifyObservers(this);for(const g of this._beforeClearStage)g.action();const j=this.getActiveMeshCandidates(),d=j.length;for(let g=0;g<d;g++){const q=j.data[g];q.isBlocked||(this._totalVertices.addCount(q.getTotalVertices(),!1),q.isReady()&&q.isEnabled()&&!q.Vf.hasAZeroComponent&&(q.Nf(),q.actionManager&&q.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(q)))}if(this.particlesEnabled)for(let g=0;g<this.ez.length;g++){const q=this.ez[g];if(!q.isStarted()||!q.k)continue;const f=q.k;f.position&&!f.isEnabled()||(this._activeParticleSystems.push(q),q.animate())}null===(q=this.frameGraph)||void 0===q||q.execute()}_renderRenderTarget(q,f){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._intermediateRendering=!0,q._shouldRender()){if(this._renderId++,this.activeCamera=f,!this.activeCamera)throw new Error("Active camera not set");this._engine.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),q.render(j,d)}this._intermediateRendering=!1}render(){var q;let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.B){if(this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),null!==(q=this.activeCameras)&&void 0!==q&&q.length)for(const q of this.activeCameras)this._checkCameraRenderTarget(q);this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),j||this.animate();for(const q of this._beforeCameraUpdateStage)q.action();if(f)if(this.activeCameras&&this.activeCameras.length>0)for(let q=0;q<this.activeCameras.length;q++){const f=this.activeCameras[q];if(f.update(),0!==f.cameraRigMode)for(let q=0;q<f._rigCameras.length;q++)f._rigCameras[q].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let q=0;q<this.activeCamera._rigCameras.length;q++)this.activeCamera._rigCameras[q].update();if(this.customRenderFunction)this._renderId++,this._engine.currentRenderPassId=0,this.customRenderFunction(f,j);else{var g;this.onBeforeRenderObservable.notifyObservers(this),this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const q=null!==(g=this.activeCameras)&&void 0!==g&&g.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){d.h.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0);for(let f=0;f<this.customRenderTargets.length;f++){const j=this.customRenderTargets[f],d=j.activeCamera||this.activeCamera;this._renderRenderTarget(j,d,q!==d,this.dumpNextRenderTargets)}d.h.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._renderId++}this._engine.currentRenderPassId=(null===q||void 0===q?void 0:q.renderPassId)??0,this.activeCamera=q,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const f of this._beforeClearStage)f.action();this._clearFrameBuffer(this.activeCamera);for(const f of this._gatherRenderTargetsStage)f.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let f=0;f<this.activeCameras.length;f++)this._processSubCameras(this.activeCameras[f],f>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}}this._checkIntersections();for(const q of this._afterRenderStage)q.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let q=0;q<this._toBeDisposed.length;q++){const f=this._toBeDisposed[q];f&&f.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}}freezeMaterials(){for(let q=0;q<this.materials.length;q++)this.materials[q].freeze()}unfreezeMaterials(){for(let q=0;q<this.materials.length;q++)this.materials[q].unfreeze()}dispose(){if(this.B)return;if(this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this._activeAnimatables&&this.stopAllAnimations){for(const q of this._activeAnimatables)q.onAnimationEndObservable.clear(),q.onAnimationEnd=null;this.stopAllAnimations()}this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const q=this._activeRequests.slice();for(const g of q)g.abort();this._activeRequests.length=0;try{this.qd.notifyObservers(this)}catch(d){K.e.Error("An error occurred while calling onDisposeObservable!",d)}this.qz();if(this._engine.getInputElement())for(let g=0;g<this.cameras.length;g++)this.cameras[g].qz();this._disposeList(this.animationGroups),this._disposeList(this.lights),this.nX&&this.nX.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.meshes,(q=>q.dispose(!0))),this._disposeList(this.transformNodes,(q=>q.dispose(!0)));const f=this.cameras;this._disposeList(f),this._disposeList(this.ez),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let j=this._engine.scenes.indexOf(this);if(j>-1&&this._engine.scenes.splice(j,1),N.d._LastCreatedScene===this){N.d._LastCreatedScene=null;let q=N.d.Instances.length-1;for(;q>=0;){const f=N.d.Instances[q];if(f.scenes.length>0){N.d._LastCreatedScene=f.scenes[this._engine.scenes.length-1];break}q--}}j=this._engine._virtualScenes.indexOf(this),j>-1&&this._engine._virtualScenes.splice(j,1),this._engine.wipeCaches(!0),this.qd.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this.onClearColorChangedObservable.clear(),this.onEnvironmentTextureChangedObservable.clear(),this.onMeshUnderPointerUpdatedObservable.clear(),this._isDisposed=!0}_disposeList(q,f){const j=q.slice(0);f=f??(q=>q.dispose());for(const d of j)f(d);q.length=0}get B(){return this._isDisposed}clearCachedVertexData(){for(let q=0;q<this.meshes.length;q++){const f=this.meshes[q].wf;f&&f.clearCachedData()}}cleanCachedTextureBuffer(){for(const q of this.textures){q._buffer&&(q._buffer=null)}}getWorldExtends(q){const f=new r.j(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),j=new r.j(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);q=q||(()=>!0);const d=this.meshes.filter(q);for(const g of d){if(g.Nf(!0),!g.Qd||0===g.Qd.length||g.infiniteDistance)continue;const q=g.getBoundingInfo(),d=q.boundingBox.minimumWorld,h=q.boundingBox.maximumWorld;r.j.CheckExtends(d,f,j),r.j.CheckExtends(h,f,j)}return{min:f,max:j}}createPickingRay(q,f,j,d){throw(0,w.c)("Ray")}createPickingRayToRef(q,f,j,d,g){throw(0,w.c)("Ray")}createPickingRayInCameraSpace(q,f,j){throw(0,w.c)("Ray")}createPickingRayInCameraSpaceToRef(q,f,j,d){throw(0,w.c)("Ray")}Sj(q,f,j,d,g,h){const L=(0,w.c)("Ray",!0);return L&&K.e.Warn(L),new z.d}pickWithBoundingInfo(q,f,j,d,g){const h=(0,w.c)("Ray",!0);return h&&K.e.Warn(h),new z.d}pickWithRay(q,f,j,d){throw(0,w.c)("Ray")}multiPick(q,f,j,d,g){throw(0,w.c)("Ray")}multiPickWithRay(q,f,j){throw(0,w.c)("Ray")}setPointerOverMesh(q,f,j){this._inputManager.setPointerOverMesh(q,f,j)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_rebuildGeometries(){for(const q of this.geometries)q._rebuild();for(const q of this.meshes)q._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const q of this._components)q.rebuild();for(const q of this.ez)q.rebuild();if(this.spriteManagers)for(const q of this.spriteManagers)q.rebuild()}_rebuildTextures(){for(const q of this.textures)q._rebuild(!0);this.markAllMaterialsAsDirty(1)}_getByTags(q,f,j){if(void 0===f)return q;const d=[];for(const g in q){const h=q[g];H.c&&H.c.MatchesQuery(h,f)&&(!j||j(h))&&d.push(h)}return d}getMeshesByTags(q,f){return this._getByTags(this.meshes,q,f)}getCamerasByTags(q,f){return this._getByTags(this.cameras,q,f)}getLightsByTags(q,f){return this._getByTags(this.lights,q,f)}getMaterialByTags(q,f){return this._getByTags(this.materials,q,f).concat(this._getByTags(this.multiMaterials,q,f))}getTransformNodesByTags(q,f){return this._getByTags(this.transformNodes,q,f)}setRenderingOrder(q){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(q,f,j,d)}setRenderingAutoClearDepthStencil(q,f){let j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(q,f,j,d)}getAutoClearDepthStencilSetup(q){return this._renderingManager.getAutoClearDepthStencilSetup(q)}_forceBlockMaterialDirtyMechanism(q){this._blockMaterialDirtyMechanism=q}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set blockMaterialDirtyMechanism(q){this._blockMaterialDirtyMechanism!==q&&(this._blockMaterialDirtyMechanism=q,q||this.markAllMaterialsAsDirty(127))}markAllMaterialsAsDirty(q,f){if(!this._blockMaterialDirtyMechanism)for(const j of this.materials)f&&!f(j)||j.zu(q)}_loadFile(q,f,j,d,g,h,L){const Q=(0,P.m)(q,f,j,d?this.offlineProvider:void 0,g,h,L);return this._activeRequests.push(Q),Q.onCompleteObservable.add((q=>{this._activeRequests.splice(this._activeRequests.indexOf(q),1)})),Q}async _loadFileAsync(q,f,j,d,g){return await new Promise(((h,L)=>{this._loadFile(q,(q=>{h(q)}),f,j,d,((q,f)=>{L(f)}),g)}))}_requestFile(q,f,j,d,g,h,L){const Q=(0,P.u)(q,f,j,d?this.offlineProvider:void 0,g,h,L);return this._activeRequests.push(Q),Q.onCompleteObservable.add((q=>{this._activeRequests.splice(this._activeRequests.indexOf(q),1)})),Q}async _requestFileAsync(q,f,j,d,g){return await new Promise(((h,L)=>{this._requestFile(q,(q=>{h(q)}),f,j,d,(q=>{L(q)}),g)}))}_readFile(q,f,j,d,g){const h=(0,P.s)(q,f,j,d,g);return this._activeRequests.push(h),h.onCompleteObservable.add((q=>{this._activeRequests.splice(this._activeRequests.indexOf(q),1)})),h}async _readFileAsync(q,f,j){return await new Promise(((d,g)=>{this._readFile(q,(q=>{d(q)}),f,j,(q=>{g(q)}))}))}getPerfCollector(){throw(0,w.c)("performanceViewerSceneExtension")}setActiveCameraByID(q){return this.setActiveCameraById(q)}getMaterialByID(q){return this.getMaterialById(q)}getLastMaterialByID(q){return this.getLastMaterialById(q)}getTextureByUniqueID(q){return this.getTextureByUniqueId(q)}getCameraByID(q){return this.getCameraById(q)}getCameraByUniqueID(q){return this.getCameraByUniqueId(q)}getBoneByID(q){return this.getBoneById(q)}getLightByID(q){return this.getLightById(q)}getLightByUniqueID(q){return this.getLightByUniqueId(q)}getParticleSystemByID(q){return this.getParticleSystemById(q)}getGeometryByID(q){return this.getGeometryById(q)}getMeshByID(q){return this.getMeshById(q)}getMeshByUniqueID(q){return this.getMeshByUniqueId(q)}getLastMeshByID(q){return this.getLastMeshById(q)}getMeshesByID(q){return this.getMeshesById(q)}getTransformNodeByID(q){return this.getTransformNodeById(q)}getTransformNodeByUniqueID(q){return this.getTransformNodeByUniqueId(q)}getTransformNodesByID(q){return this.getTransformNodesById(q)}getNodeByID(q){return this.getNodeById(q)}getLastEntryByID(q){return this.getLastEntryById(q)}getLastSkeletonByID(q){return this.getLastSkeletonById(q)}}qq.FOGMODE_NONE=0,qq.FOGMODE_EXP=1,qq.FOGMODE_EXP2=2,qq.FOGMODE_LINEAR=3,qq.MinDeltaTime=1,qq.MaxDeltaTime=1e3,qq._OriginalDefaultMaterialFactory=qq.DefaultMaterialFactory,(0,J.f)("BABYLON.Scene",qq)},11327:(q,f,j)=>{j.d(f,{b:()=>d,c:()=>g});class d{}d.NAME_EFFECTLAYER="EffectLayer",d.NAME_LAYER="Layer",d.NAME_LENSFLARESYSTEM="LensFlareSystem",d.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",d.NAME_PARTICLESYSTEM="Id",d.NAME_GAMEPAD="Gamepad",d.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",d.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",d.NAME_PREPASSRENDERER="PrePassRenderer",d.NAME_DEPTHRENDERER="DepthRenderer",d.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",d.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",d.NAME_SPRITE="Sprite",d.NAME_SUBSURFACE="SubSurface",d.NAME_OUTLINERENDERER="Outline",d.NAME_PROCEDURALTEXTURE="ProceduralTexture",d.NAME_SHADOWGENERATOR="ShadowGenerator",d.NAME_OCTREE="Td",d.NAME_PHYSICSENGINE="PhysicsEngine",d.NAME_AUDIO="Audio",d.NAME_FLUIDRENDERER="FluidRenderer",d.NAME_IBLCDFGENERATOR="iblCDFGenerator",d.STEP_ISREADYFORMESH_EFFECTLAYER=0,d.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,d.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,d.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,d.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,d.STEP_BEFORECAMERADRAW_PREPASS=0,d.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,d.STEP_BEFORECAMERADRAW_LAYER=2,d.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,d.STEP_BEFORERENDERTARGETDRAW_LAYER=1,d.STEP_BEFORERENDERINGMESH_PREPASS=0,d.STEP_BEFORERENDERINGMESH_OUTLINE=1,d.STEP_AFTERRENDERINGMESH_PREPASS=0,d.STEP_AFTERRENDERINGMESH_OUTLINE=1,d.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,d.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,d.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,d.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,d.STEP_BEFORECLEAR_PREPASS=1,d.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,d.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,d.STEP_AFTERRENDERTARGETDRAW_LAYER=1,d.STEP_AFTERCAMERADRAW_PREPASS=0,d.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,d.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,d.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,d.STEP_AFTERCAMERADRAW_LAYER=4,d.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,d.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,d.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,d.STEP_AFTERRENDER_AUDIO=0,d.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,d.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,d.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,d.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,d.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,d.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,d.STEP_POINTERMOVE_SPRITE=0,d.STEP_POINTERDOWN_SPRITE=0,d.STEP_POINTERUP_SPRITE=0;class g extends Array{constructor(q){super(...q)}static Create(){return Object.create(g.prototype)}registerStep(q,f,j){let d=0,g=Number.MAX_VALUE;for(;d<this.length;d++){if(g=this[d].index,q<g)break}this.splice(d,0,{index:q,component:f,action:j.bind(f)})}clear(){this.length=0}}},11125:(q,f,j)=>{j.d(f,{b:()=>d});function d(q,f,j,d){var g,h=arguments.length,L=h<3?f:null===d?d=Object.getOwnPropertyDescriptor(f,j):d;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)L=Reflect.decorate(q,f,j,d);else for(var Q=q.length-1;Q>=0;Q--)(g=q[Q])&&(L=(h<3?g(L):h>3?g(f,j,L):g(f,j))||L);return h>3&&L&&Object.defineProperty(f,j,L),L}Object.create;Object.create}}]);