"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[9],{11700:(V,I,m)=>{m.d(I,{c:()=>T,f:()=>t,h:()=>D,i:()=>X,m:()=>N,o:()=>v,s:()=>O});var C=m(11040),l=m(11312),s=m(11074),F=m(11048),k=m(11703),j=m(11337),E=m(11501),K=m(11099),Y=m(11297);const X=Object.freeze(new C.e(0,0,0,0)),O=Object.freeze(C.m.Zero()),v=Object.freeze(C.k.Zero()),N=Object.freeze(E.c.Zero()),t=Object.freeze(l.c.Black()),D=Object.freeze(new l.d(0,0,0,0)),b={key:0,repeatCount:0,loopMode:2};class T{static _PrepareAnimation(V,I,m,s,F,k,j,K){let Y;if(!isNaN(parseFloat(F))&&isFinite(F)?Y=T.ANIMATIONTYPE_FLOAT:F instanceof C.e?Y=T.ANIMATIONTYPE_QUATERNION:F instanceof C.m?Y=T.ANIMATIONTYPE_VECTOR3:F instanceof C.k?Y=T.ANIMATIONTYPE_VECTOR2:F instanceof l.c?Y=T.ANIMATIONTYPE_COLOR3:F instanceof l.d?Y=T.ANIMATIONTYPE_COLOR4:F instanceof E.c&&(Y=T.ANIMATIONTYPE_SIZE),void 0==Y)return null;const X=new T(V,I,m,Y,j),O=[{frame:0,value:F},{frame:s,value:k}];return X.setKeys(O),void 0!==K&&X.setEasingFunction(K),X}static CreateAnimation(V,I,m,C){const l=new T(V+"Animation",V,m,I,T.ANIMATIONLOOPMODE_CONSTANT);return l.setEasingFunction(C),l}static CreateAndStartAnimation(V,I,m,C,l,s,F,k,j,E,K){const Y=T._PrepareAnimation(V,m,C,l,s,F,k,j);return Y?(I.cV&&(K=I.cV()),K?K.beginDirectAnimation(I,[Y],0,l,Y.loopMode!==T.ANIMATIONLOOPMODE_CONSTANT,1,E):null):null}static CreateAndStartHierarchyAnimation(V,I,m,C,l,s,F,k,j,E,K){const Y=T._PrepareAnimation(V,C,l,s,F,k,j,E);if(!Y)return null;return I.cV().beginDirectHierarchyAnimation(I,m,[Y],0,s,1===Y.loopMode,1,K)}static CreateMergeAndStartAnimation(V,I,m,C,l,s,F,k,j,E){const K=T._PrepareAnimation(V,m,C,l,s,F,k,j);return K?(I.animations.push(K),I.cV().beginAnimation(I,0,l,1===K.loopMode,1,E)):null}static MakeAnimationAdditive(V,I,m){let l;l="object"===typeof I?I:{referenceFrame:I??0,range:m,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let s=V;if(l.cloneOriginalAnimation&&(s=V.clone(),s.name=l.clonedAnimationName||s.name),!s._keys.length)return s;const F=l.referenceFrame&&l.referenceFrame>=0?l.referenceFrame:0;let k=0;const j=s._keys[0];let E=s._keys.length-1;const K=s._keys[E],Y={referenceValue:j.value,referencePosition:C.g.LF[0],referenceQuaternion:C.g.Quaternion[0],referenceScaling:C.g.LF[1],keyPosition:C.g.LF[2],keyQuaternion:C.g.Quaternion[1],keyScaling:C.g.LF[3]};let X=j.frame,O=K.frame;if(l.range){const V=s.getRange(l.range);V&&(X=V.from,O=V.to)}else X=l.fromFrame??X,O=l.toFrame??O;if(X!==j.frame&&(k=s.createKeyForFrame(X)),O!==K.frame&&(E=s.createKeyForFrame(O)),1===s._keys.length){const V=s._getKeyValue(s._keys[0]);Y.referenceValue=V.clone?V.clone():V}else if(F<=j.frame){const V=s._getKeyValue(j.value);Y.referenceValue=V.clone?V.clone():V}else if(F>=K.frame){const V=s._getKeyValue(K.value);Y.referenceValue=V.clone?V.clone():V}else{b.key=0;const V=s._interpolate(F,b);Y.referenceValue=V.clone?V.clone():V}s.dataType===T.ANIMATIONTYPE_QUATERNION?Y.referenceValue.normalize().conjugateInPlace():s.dataType===T.ANIMATIONTYPE_MATRIX&&(Y.referenceValue.decompose(Y.referenceScaling,Y.referenceQuaternion,Y.referencePosition),Y.referenceQuaternion.normalize().conjugateInPlace());let v=Number.MAX_VALUE;const N=l.clipKeys?[]:null;for(let t=k;t<=E;t++){let V=s._keys[t];if((N||l.cloneOriginalAnimation)&&(V={frame:V.frame,value:V.value.clone?V.value.clone():V.value,inTangent:V.inTangent,outTangent:V.outTangent,interpolation:V.interpolation,lockedTangent:V.lockedTangent},N&&(v===Number.MAX_VALUE&&(v=V.frame),V.frame-=v,N.push(V))),!t||s.dataType===T.ANIMATIONTYPE_FLOAT||V.value!==j.value)switch(s.dataType){case T.ANIMATIONTYPE_MATRIX:V.value.decompose(Y.keyScaling,Y.keyQuaternion,Y.keyPosition),Y.keyPosition.WK(Y.referencePosition),Y.keyScaling.divideInPlace(Y.referenceScaling),Y.referenceQuaternion.multiplyToRef(Y.keyQuaternion,Y.keyQuaternion),C.b.ComposeToRef(Y.keyScaling,Y.keyQuaternion,Y.keyPosition,V.value);break;case T.ANIMATIONTYPE_QUATERNION:Y.referenceValue.multiplyToRef(V.value,V.value);break;case T.ANIMATIONTYPE_VECTOR2:case T.ANIMATIONTYPE_VECTOR3:case T.ANIMATIONTYPE_COLOR3:case T.ANIMATIONTYPE_COLOR4:V.value.subtractToRef(Y.referenceValue,V.value);break;case T.ANIMATIONTYPE_SIZE:V.value.width-=Y.referenceValue.width,V.value.height-=Y.referenceValue.height;break;default:V.value-=Y.referenceValue}}return N&&s.setKeys(N,!0),s}static TransitionTo(V,I,m,C,l,s,F){let k=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(F<=0)return m[V]=I,k&&k(),null;const j=l*(F/1e3);s.setKeys([{frame:0,value:m[V].clone?m[V].clone():m[V]},{frame:j,value:I}]),m.animations||(m.animations=[]),m.animations.push(s);const E=C.beginAnimation(m,0,j,!1);return E.onAnimationEnd=k,E}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const V of this._runtimeAnimations)if(!V.isStopped())return!0;return!1}constructor(V,I,m,C,l,s){this.name=V,this.targetProperty=I,this.framePerSecond=m,this.dataType=C,this.loopMode=l,this.enableBlending=s,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this._coreAnimation=null,this.targetPropertyPath=I.split("."),this.dataType=C,this.loopMode=void 0===l?T.ANIMATIONLOOPMODE_CYCLE:l,this.uniqueId=T._UniqueIdGenerator++}toString(V){let I="Name: "+this.name+", property: "+this.targetProperty;if(I+=", datatype: "+["Float","LF","Quaternion","Matrix","dY","Vector2"][this.dataType],I+=", nKeys: "+(this._keys?this._keys.length:"none"),I+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),V){I+=", Ranges: {";let V=!0;for(const m in this._ranges)V&&(I+=", ",V=!1),I+=m;I+="}"}return I}addEvent(V){this._events.push(V),this._events.sort(((V,I)=>V.frame-I.frame))}removeEvents(V){for(let I=0;I<this._events.length;I++)this._events[I].frame===V&&(this._events.splice(I,1),I--)}getEvents(){return this._events}createRange(V,I,m){this._ranges[V]||(this._ranges[V]=new k.b(V,I,m))}deleteRange(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const m=this._ranges[V];if(m){if(I){const V=m.from,I=m.to;for(let m=this._keys.length-1;m>=0;m--)this._keys[m].frame>=V&&this._keys[m].frame<=I&&this._keys.splice(m,1)}this._ranges[V]=null}}getRange(V){return this._ranges[V]}getKeys(){return this._keys}getHighestFrame(){let V=0;for(let I=0,m=this._keys.length;I<m;I++)V<this._keys[I].frame&&(V=this._keys[I].frame);return V}getEasingFunction(){return this._easingFunction}setEasingFunction(V){this._easingFunction=V}floatInterpolateFunction(V,I,m){return(0,s.Lerp)(V,I,m)}floatInterpolateFunctionWithTangents(V,I,m,C,l){return(0,s.Hermite)(V,I,m,C,l)}quaternionInterpolateFunction(V,I,m){return C.e.Slerp(V,I,m)}quaternionInterpolateFunctionWithTangents(V,I,m,l,s){return C.e.Hermite(V,I,m,l,s).normalize()}vector3InterpolateFunction(V,I,m){return C.m.Lerp(V,I,m)}vector3InterpolateFunctionWithTangents(V,I,m,l,s){return C.m.Hermite(V,I,m,l,s)}vector2InterpolateFunction(V,I,m){return C.k.Lerp(V,I,m)}vector2InterpolateFunctionWithTangents(V,I,m,l,s){return C.k.Hermite(V,I,m,l,s)}sizeInterpolateFunction(V,I,m){return E.c.Lerp(V,I,m)}color3InterpolateFunction(V,I,m){return l.c.Lerp(V,I,m)}color3InterpolateFunctionWithTangents(V,I,m,C,s){return l.c.Hermite(V,I,m,C,s)}color4InterpolateFunction(V,I,m){return l.d.Lerp(V,I,m)}color4InterpolateFunctionWithTangents(V,I,m,C,s){return l.d.Hermite(V,I,m,C,s)}_getKeyValue(V){return"function"===typeof V?V():V}evaluate(V){return b.key=0,this._interpolate(V,b)}_interpolate(V,I){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(I.loopMode===T.ANIMATIONLOOPMODE_CONSTANT&&I.repeatCount>0)return I.highLimitValue.clone?I.highLimitValue.clone():I.highLimitValue;const C=this._keys;let l;if(this._coreAnimation)l=this._coreAnimation._key;else{const s=C.length;for(l=I.key;l>=0&&V<C[l].frame;)--l;for(;l+1<=s-1&&V>=C[l+1].frame;)++l;if(I.key=l,l<0)return m?void 0:this._getKeyValue(C[0].value);if(l+1>s-1)return m?void 0:this._getKeyValue(C[s-1].value);this._key=l}const s=C[l],F=C[l+1];if(m&&(V===s.frame||V===F.frame))return;const k=this._getKeyValue(s.value),j=this._getKeyValue(F.value);if(1===s.interpolation)return F.frame>V?k:j;const E=void 0!==s.outTangent&&void 0!==F.inTangent,K=F.frame-s.frame;let Y=(V-s.frame)/K;const b=s.easingFunction||this.getEasingFunction();switch(b&&(Y=b.ease(Y)),this.dataType){case T.ANIMATIONTYPE_FLOAT:{const V=E?this.floatInterpolateFunctionWithTangents(k,s.outTangent*K,j,F.inTangent*K,Y):this.floatInterpolateFunction(k,j,Y);switch(I.loopMode){case T.ANIMATIONLOOPMODE_CYCLE:case T.ANIMATIONLOOPMODE_CONSTANT:case T.ANIMATIONLOOPMODE_YOYO:return V;case T.ANIMATIONLOOPMODE_RELATIVE:case T.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(I.offsetValue??0)*I.repeatCount+V}break}case T.ANIMATIONTYPE_QUATERNION:{const V=E?this.quaternionInterpolateFunctionWithTangents(k,s.outTangent.scale(K),j,F.inTangent.scale(K),Y):this.quaternionInterpolateFunction(k,j,Y);switch(I.loopMode){case T.ANIMATIONLOOPMODE_CYCLE:case T.ANIMATIONLOOPMODE_CONSTANT:case T.ANIMATIONLOOPMODE_YOYO:return V;case T.ANIMATIONLOOPMODE_RELATIVE:case T.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return V.addInPlace((I.offsetValue||X).scale(I.repeatCount))}return V}case T.ANIMATIONTYPE_VECTOR3:{const V=E?this.vector3InterpolateFunctionWithTangents(k,s.outTangent.scale(K),j,F.inTangent.scale(K),Y):this.vector3InterpolateFunction(k,j,Y);switch(I.loopMode){case T.ANIMATIONLOOPMODE_CYCLE:case T.ANIMATIONLOOPMODE_CONSTANT:case T.ANIMATIONLOOPMODE_YOYO:return V;case T.ANIMATIONLOOPMODE_RELATIVE:case T.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return V.add((I.offsetValue||O).scale(I.repeatCount))}break}case T.ANIMATIONTYPE_VECTOR2:{const V=E?this.vector2InterpolateFunctionWithTangents(k,s.outTangent.scale(K),j,F.inTangent.scale(K),Y):this.vector2InterpolateFunction(k,j,Y);switch(I.loopMode){case T.ANIMATIONLOOPMODE_CYCLE:case T.ANIMATIONLOOPMODE_CONSTANT:case T.ANIMATIONLOOPMODE_YOYO:return V;case T.ANIMATIONLOOPMODE_RELATIVE:case T.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return V.add((I.offsetValue||v).scale(I.repeatCount))}break}case T.ANIMATIONTYPE_SIZE:switch(I.loopMode){case T.ANIMATIONLOOPMODE_CYCLE:case T.ANIMATIONLOOPMODE_CONSTANT:case T.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(k,j,Y);case T.ANIMATIONLOOPMODE_RELATIVE:case T.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(k,j,Y).add((I.offsetValue||N).scale(I.repeatCount))}break;case T.ANIMATIONTYPE_COLOR3:{const V=E?this.color3InterpolateFunctionWithTangents(k,s.outTangent.scale(K),j,F.inTangent.scale(K),Y):this.color3InterpolateFunction(k,j,Y);switch(I.loopMode){case T.ANIMATIONLOOPMODE_CYCLE:case T.ANIMATIONLOOPMODE_CONSTANT:case T.ANIMATIONLOOPMODE_YOYO:return V;case T.ANIMATIONLOOPMODE_RELATIVE:case T.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return V.add((I.offsetValue||t).scale(I.repeatCount))}break}case T.ANIMATIONTYPE_COLOR4:{const V=E?this.color4InterpolateFunctionWithTangents(k,s.outTangent.scale(K),j,F.inTangent.scale(K),Y):this.color4InterpolateFunction(k,j,Y);switch(I.loopMode){case T.ANIMATIONLOOPMODE_CYCLE:case T.ANIMATIONLOOPMODE_CONSTANT:case T.ANIMATIONLOOPMODE_YOYO:return V;case T.ANIMATIONLOOPMODE_RELATIVE:case T.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return V.add((I.offsetValue||D).scale(I.repeatCount))}break}case T.ANIMATIONTYPE_MATRIX:switch(I.loopMode){case T.ANIMATIONLOOPMODE_CYCLE:case T.ANIMATIONLOOPMODE_CONSTANT:case T.ANIMATIONLOOPMODE_YOYO:return T.AllowMatricesInterpolation?this.matrixInterpolateFunction(k,j,Y,I.workValue):k;case T.ANIMATIONLOOPMODE_RELATIVE:case T.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return k}}return 0}matrixInterpolateFunction(V,I,m,l){return T.AllowMatrixDecomposeForInterpolation?l?(C.b.DecomposeLerpToRef(V,I,m,l),l):C.b.DecomposeLerp(V,I,m):l?(C.b.LerpToRef(V,I,m,l),l):C.b.Lerp(V,I,m)}clone(){const V=new T(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(V.enableBlending=this.enableBlending,V.blendingSpeed=this.blendingSpeed,this._keys&&V.setKeys(this._keys),this._ranges){V._ranges={};for(const I in this._ranges){const m=this._ranges[I];m&&(V._ranges[I]=m.clone())}}return V}setKeys(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=I?V:V.slice(0)}createKeyForFrame(V){b.key=0;const I=this._interpolate(V,b,!0);if(!I)return this._keys[b.key].frame===V?b.key:b.key+1;const m={frame:V,value:I.clone?I.clone():I};return this._keys.splice(b.key+1,0,m),b.key+1}serialize(){const V={};V.name=this.name,V.property=this.targetProperty,V.framePerSecond=this.framePerSecond,V.dataType=this.dataType,V.loopBehavior=this.loopMode,V.enableBlending=this.enableBlending,V.blendingSpeed=this.blendingSpeed;const I=this.dataType;V.keys=[];const m=this.getKeys();for(let C=0;C<m.length;C++){const l=m[C],s={};switch(s.frame=l.frame,I){case T.ANIMATIONTYPE_FLOAT:s.values=[l.value],void 0!==l.inTangent&&s.values.push(l.inTangent),void 0!==l.outTangent&&(void 0===l.inTangent&&s.values.push(void 0),s.values.push(l.outTangent)),void 0!==l.interpolation&&(void 0===l.inTangent&&s.values.push(void 0),void 0===l.outTangent&&s.values.push(void 0),s.values.push(l.interpolation));break;case T.ANIMATIONTYPE_QUATERNION:case T.ANIMATIONTYPE_MATRIX:case T.ANIMATIONTYPE_VECTOR3:case T.ANIMATIONTYPE_COLOR3:case T.ANIMATIONTYPE_COLOR4:s.values=l.value.UF(),void 0!=l.inTangent&&s.values.push(l.inTangent.UF()),void 0!=l.outTangent&&(void 0===l.inTangent&&s.values.push(void 0),s.values.push(l.outTangent.UF())),void 0!==l.interpolation&&(void 0===l.inTangent&&s.values.push(void 0),void 0===l.outTangent&&s.values.push(void 0),s.values.push(l.interpolation))}V.keys.push(s)}V.ranges=[];for(const C in this._ranges){const I=this._ranges[C];if(!I)continue;const m={};m.name=C,m.from=I.from,m.to=I.to,V.ranges.push(m)}return V}static _UniversalLerp(V,I,m){const C=V.constructor;return C.Lerp?C.Lerp(V,I,m):C.Slerp?C.Slerp(V,I,m):V.toFixed?V*(1-m)+m*I:I}static Parse(V){const I=new T(V.name,V.property,V.framePerSecond,V.dataType,V.loopBehavior),m=V.dataType,s=[];let F,k;for(V.enableBlending&&(I.enableBlending=V.enableBlending),V.blendingSpeed&&(I.blendingSpeed=V.blendingSpeed),k=0;k<V.keys.length;k++){const I=V.keys[k];let j,E,K;switch(m){case T.ANIMATIONTYPE_FLOAT:F=I.values[0],I.values.length>=2&&(j=I.values[1]),I.values.length>=3&&(E=I.values[2]),I.values.length>=4&&(K=I.values[3]);break;case T.ANIMATIONTYPE_QUATERNION:if(F=C.e.Ik(I.values),I.values.length>=8){const V=C.e.Ik(I.values.slice(4,8));V.equals(C.e.Zero())||(j=V)}if(I.values.length>=12){const V=C.e.Ik(I.values.slice(8,12));V.equals(C.e.Zero())||(E=V)}I.values.length>=13&&(K=I.values[12]);break;case T.ANIMATIONTYPE_MATRIX:F=C.b.Ik(I.values),I.values.length>=17&&(K=I.values[16]);break;case T.ANIMATIONTYPE_COLOR3:F=l.c.Ik(I.values),I.values[3]&&(j=l.c.Ik(I.values[3])),I.values[4]&&(E=l.c.Ik(I.values[4])),I.values[5]&&(K=I.values[5]);break;case T.ANIMATIONTYPE_COLOR4:F=l.d.Ik(I.values),I.values[4]&&(j=l.d.Ik(I.values[4])),I.values[5]&&(E=l.d.Ik(I.values[5])),I.values[6]&&(K=l.d.Ik(I.values[6]));break;case T.ANIMATIONTYPE_VECTOR3:default:F=C.m.Ik(I.values),I.values[3]&&(j=C.m.Ik(I.values[3])),I.values[4]&&(E=C.m.Ik(I.values[4])),I.values[5]&&(K=I.values[5])}const Y={};Y.frame=I.frame,Y.value=F,void 0!=j&&(Y.inTangent=j),void 0!=E&&(Y.outTangent=E),void 0!=K&&(Y.interpolation=K),s.push(Y)}if(I.setKeys(s),V.ranges)for(k=0;k<V.ranges.length;k++)F=V.ranges[k],I.createRange(F.name,F.from,F.to);return I}static AppendSerializedAnimations(V,I){Y.d.AppendSerializedAnimations(V,I)}static async ParseFromFileAsync(V,I){return await new Promise(((m,C)=>{const l=new K.c;l.addEventListener("readystatechange",(()=>{if(4==l.readyState)if(200==l.status){let I=JSON.parse(l.responseText);if(I.animations&&(I=I.animations),I.length){const V=[];for(const m of I)V.push(this.Parse(m));m(V)}else{const C=this.Parse(I);V&&(C.name=V),m(C)}}else C("Unable to load the animation")})),l.open("GET",I),l.send()}))}static async ParseFromSnippetAsync(V){return await new Promise(((I,m)=>{const C=new K.c;C.addEventListener("readystatechange",(()=>{if(4==C.readyState)if(200==C.status){const m=JSON.parse(JSON.parse(C.responseText).jsonPayload);if(m.animations){const C=JSON.parse(m.animations),l=[];for(const I of C.animations){const m=this.Parse(I);m.snippetId=V,l.push(m)}I(l)}else{const C=JSON.parse(m.animation),l=this.Parse(C);l.snippetId=V,I(l)}}else m("Unable to load the snippet "+V)})),C.open("GET",this.SnippetUrl+"/"+V.replace(/#/g,"/")),C.send()}))}}T._UniqueIdGenerator=0,T.AllowMatricesInterpolation=!1,T.AllowMatrixDecomposeForInterpolation=!0,T.SnippetUrl="https://snippet.babylonjs.com",T.ANIMATIONTYPE_FLOAT=0,T.ANIMATIONTYPE_VECTOR3=1,T.ANIMATIONTYPE_QUATERNION=2,T.ANIMATIONTYPE_MATRIX=3,T.ANIMATIONTYPE_COLOR3=4,T.ANIMATIONTYPE_COLOR4=7,T.ANIMATIONTYPE_VECTOR2=5,T.ANIMATIONTYPE_SIZE=6,T.ANIMATIONLOOPMODE_RELATIVE=0,T.ANIMATIONLOOPMODE_CYCLE=1,T.ANIMATIONLOOPMODE_CONSTANT=2,T.ANIMATIONLOOPMODE_YOYO=4,T.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,T.CreateFromSnippetAsync=T.ParseFromSnippetAsync,(0,F.h)("BABYLON.Animation",T),j.c._AnimationRangeFactory=(V,I,m)=>new k.b(V,I,m)},11703:(V,I,m)=>{m.d(I,{b:()=>C});class C{constructor(V,I,m){this.name=V,this.from=I,this.to=m}clone(){return new C(this.name,this.from,this.to)}}},11233:(V,I,m)=>{m.d(I,{c:()=>F,e:()=>k});var C=m(11238),l=m(11085),s=m(11240);class F{get K(){return this._isDisposed}constructor(V,I,m){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],F=arguments.length>5&&void 0!==arguments[5]&&arguments[5],k=arguments.length>6&&void 0!==arguments[6]&&arguments[6],j=arguments.length>7?arguments[7]:void 0,E=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,V&&V.cV?this._engine=V.cV().getEngine():this._engine=V,this._updatable=m,this._instanced=F,this._divisor=j||1,this._label=E,I instanceof C.e?(this._data=null,this._buffer=I):(this._data=I,this._buffer=null),this.byteStride=k?l:l*Float32Array.BYTES_PER_ELEMENT,s||this.create()}createVertexBuffer(V,I,m,C,l){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],F=arguments.length>6?arguments[6]:void 0;const j=s?I:I*Float32Array.BYTES_PER_ELEMENT,E=C?s?C:C*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new k(this._engine,this,V,this._updatable,!0,E,void 0===l?this._instanced:l,j,m,void 0,void 0,!0,this._divisor||F)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!V&&this._buffer||(V=V||this._data,V&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,V),this._data=V):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(V,this._label),this._data=V):this._buffer=this._engine.createVertexBuffer(V,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.xF>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.xF,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.xF,void 0,this._label));l.d.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(V){this.create(V)}updateDirectly(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,V,C?I:I*Float32Array.BYTES_PER_ELEMENT,m?m*this.byteStride:void 0),this._data=0===I&&void 0===m?V:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class k{get K(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(V){const I=0!=V;this._instanceDivisor=V,I!==this._instanced&&(this._instanced=I,this._computeHashCode())}get _maxVerticesCount(){const V=this.getData();return V?Array.isArray(V)?V.length/(this.byteStride/4)-this.byteOffset/4:(V.byteLength-this.byteOffset)/this.byteStride:0}constructor(V,I,m,C,l,j,E,K,Y,X){let O=arguments.length>10&&void 0!==arguments[10]&&arguments[10],v=arguments.length>11&&void 0!==arguments[11]&&arguments[11],N=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,t=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let D=!1;if(this.rF=V,"object"===typeof C&&null!==C?(D=C.updatable??!1,l=C.postponeInternalCreation,j=C.stride,E=C.instanced,K=C.offset,Y=C.size,X=C.type,O=C.normalized??!1,v=C.useBytes??!1,N=C.divisor??1,t=C.takeBufferOwnership??!1,this._label=C.label):D=!!C,I instanceof F?(this._buffer=I,this._ownsBuffer=t):(this._buffer=new F(V,I,D,j,l,E,v,N,this._label),this._ownsBuffer=!0),this.uniqueId=k._Counter++,this._kind=m,void 0===X){const V=this.getData();this.type=V?k.GetDataType(V):k.FLOAT}else this.type=X;const b=(0,s.q)(this.type);v?(this._size=Y||(j?j/b:k.DeduceStride(m)),this.byteStride=j||this._buffer.byteStride||this._size*b,this.byteOffset=K||0):(this._size=Y||j||k.DeduceStride(m),this.byteStride=j?j*b:this._buffer.byteStride||this._size*b,this.byteOffset=(K||0)*b),this.normalized=O,this._instanced=void 0!==E&&E,this._instanceDivisor=E?N:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var V;null===(V=this._buffer)||void 0===V||V._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(V,I){const m=this.getData();return m?(0,s.n)(m,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,V,I):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,s.q)(this.type)}getOffset(){return this.byteOffset/(0,s.q)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,s.q)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(V){this._buffer.create(V),this._alignBuffer()}update(V){this._buffer.update(V),this._alignBuffer()}updateDirectly(V,I){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(V,I,void 0,m),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(V,I){(0,s.k)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,V,this.normalized,((V,m)=>{for(let C=0;C<this._size;C++)I(V[C],m+C)}))}_alignBuffer(){}static DeduceStride(V){switch(V){case k.UVKind:case k.UV2Kind:case k.UV3Kind:case k.UV4Kind:case k.UV5Kind:case k.UV6Kind:return 2;case k.NormalKind:case k.PositionKind:return 3;case k.ColorKind:case k.ColorInstanceKind:case k.MatricesIndicesKind:case k.MatricesIndicesExtraKind:case k.MatricesWeightsKind:case k.MatricesWeightsExtraKind:case k.TangentKind:return 4;default:throw new Error("Invalid kind '"+V+"'")}}static GetDataType(V){return V instanceof Int8Array?k.BYTE:V instanceof Uint8Array?k.UNSIGNED_BYTE:V instanceof Int16Array?k.SHORT:V instanceof Uint16Array?k.UNSIGNED_SHORT:V instanceof Int32Array?k.INT:V instanceof Uint32Array?k.UNSIGNED_INT:k.FLOAT}static GetTypeByteLength(V){return(0,s.q)(V)}static ForEach(V,I,m,C,l,F,k,j){(0,s.k)(V,I,m,C,l,F,k,((V,I)=>{for(let m=0;m<C;m++)j(V[m],I+m)}))}static GetFloatData(V,I,m,C,l,F,k,j){return(0,s.n)(V,I,m,C,l,F,k,j)}}k._Counter=0,k.BYTE=5120,k.UNSIGNED_BYTE=5121,k.SHORT=5122,k.UNSIGNED_SHORT=5123,k.INT=5124,k.UNSIGNED_INT=5125,k.FLOAT=5126,k.PositionKind="position",k.NormalKind="normal",k.TangentKind="tangent",k.UVKind="uv",k.UV2Kind="uv2",k.UV3Kind="uv3",k.UV4Kind="uv4",k.UV5Kind="uv5",k.UV6Kind="uv6",k.ColorKind="color",k.ColorInstanceKind="instanceColor",k.MatricesIndicesKind="matricesIndices",k.MatricesWeightsKind="matricesWeights",k.MatricesIndicesExtraKind="matricesIndicesExtra",k.MatricesWeightsExtraKind="matricesWeightsExtra"},11240:(V,I,m)=>{m.d(I,{e:()=>X,i:()=>Y,k:()=>j,n:()=>E,q:()=>F,s:()=>k,t:()=>K});var C=m(11085);function l(V,I,m,C){switch(I){case 5120:{let I=V.getInt8(m);return C&&(I=Math.max(I/127,-1)),I}case 5121:{let I=V.getUint8(m);return C&&(I/=255),I}case 5122:{let I=V.getInt16(m,!0);return C&&(I=Math.max(I/32767,-1)),I}case 5123:{let I=V.getUint16(m,!0);return C&&(I/=65535),I}case 5124:return V.getInt32(m,!0);case 5125:return V.getUint32(m,!0);case 5126:return V.getFloat32(m,!0);default:throw new Error(`Invalid component type ${I}`)}}function s(V,I,m,C,l){switch(I){case 5120:C&&(l=Math.round(127*l)),V.setInt8(m,l);break;case 5121:C&&(l=Math.round(255*l)),V.setUint8(m,l);break;case 5122:C&&(l=Math.round(32767*l)),V.setInt16(m,l,!0);break;case 5123:C&&(l=Math.round(65535*l)),V.setUint16(m,l,!0);break;case 5124:V.setInt32(m,l,!0);break;case 5125:V.setUint32(m,l,!0);break;case 5126:V.setFloat32(m,l,!0);break;default:throw new Error(`Invalid component type ${I}`)}}function F(V){switch(V){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${V}'`)}}function k(V){switch(V){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${V}'`)}}function j(V,I,m,C,k,j,E,K){const Y=new Array(C),X=new Array(C);if(V instanceof Array){let l=I/4;const s=m/4;for(let I=0;I<j;I+=C){for(let I=0;I<C;I++)Y[I]=X[I]=V[l+I];K(X,I);for(let I=0;I<C;I++)Y[I]!==X[I]&&(V[l+I]=X[I]);l+=s}}else{const O=ArrayBuffer.isView(V)?new DataView(V.buffer,V.byteOffset,V.byteLength):new DataView(V),v=F(k);for(let V=0;V<j;V+=C){for(let V=0,m=I;V<C;V++,m+=v)Y[V]=X[V]=l(O,k,m,E);K(X,V);for(let V=0,m=I;V<C;V++,m+=v)Y[V]!==X[V]&&s(O,k,m,E,X[V]);I+=m}}}function E(V,I,m,l,s,k,E,K){const Y=I*F(m),X=E*I;if(5126!==m||s!==Y){const C=new Float32Array(X);return j(V,l,s,I,m,X,k,((V,m)=>{for(let l=0;l<I;l++)C[m+l]=V[l]})),C}if(!(V instanceof Array||V instanceof Float32Array)||0!==l||V.length!==X){if(V instanceof Array){const I=l/4;return V.slice(I,I+X)}if(V instanceof ArrayBuffer)return new Float32Array(V,l,X);{const I=V.byteOffset+l;return 0!==(3&I)&&(C.d.Warn("Float array must be aligned to 4-bytes border"),K=!0),K?new Float32Array(V.buffer.slice(I,I+X*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(V.buffer,I,X)}}return K?V.slice():V}function K(V,I,m,l,s,E,K,Y){const X=F(m),O=k(m),v=K*I;if(Array.isArray(V)){if(0!==(3&l)||0!==(3&s))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const C=l/4,F=s/4;if(C+(K-1)*F+I>V.length)throw new Error("Last accessed index is out of bounds.");if(F<I)throw new Error("Data stride cannot be smaller than the component size.");if(F!==I){const C=new O(v);return j(V,l,s,I,m,v,E,((V,m)=>{for(let l=0;l<I;l++)C[m+l]=V[l]})),C}return new O(V.slice(C,C+v))}let N,t=l;V instanceof ArrayBuffer?N=V:(N=V.buffer,t+=V.byteOffset);if(t+(K-1)*s+I*X>N.byteLength)throw new Error("Last accessed byte is out of bounds.");const D=I*X;if(s<D)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(s!==D){const V=new O(v);return j(N,t,s,I,m,v,E,((m,C)=>{for(let l=0;l<I;l++)V[C+l]=m[l]})),V}return 1!==X&&0!==(t&X-1)&&(C.d.Warn("Array must be aligned to border of element size. Data will be copied."),Y=!0),Y?new O(N.slice(t,t+v*X)):new O(N,t,v)}function Y(V,I,m,l,s,k,E,K){const Y=I*F(m),X=E*I;if(K.length!==X)throw new Error("Output length is not valid");if(5126===m&&s===Y)if(V instanceof Array){const I=l/4;K.set(V,I)}else if(V instanceof ArrayBuffer){const I=new Float32Array(V,l,X);K.set(I)}else{const I=V.byteOffset+l;if(0!==(3&I))return C.d.Warn("Float array must be aligned to 4-bytes border"),void K.set(new Float32Array(V.buffer.slice(I,I+X*Float32Array.BYTES_PER_ELEMENT)));const m=new Float32Array(V.buffer,I,X);K.set(m)}else j(V,l,s,I,m,X,k,((V,m)=>{for(let C=0;C<I;C++)K[m+C]=V[C]}))}function X(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(V)){for(let l=0;l<I;l++)if(V[m+l]-C>65535)return!0;return!1}return 4===V.BYTES_PER_ELEMENT}},11238:(V,I,m)=>{m.d(I,{e:()=>C});class C{get underlyingResource(){return null}constructor(){this.references=0,this.xF=0,this.is32Bits=!1,this.uniqueId=C._Counter++}}C._Counter=0},11386:(V,I,m)=>{m.d(I,{c:()=>t});var C=m(11206),l=m(11214),s=m(11389),F=m(11076),k=m(11067),j=m(11040),E=m(11337),K=m(11085),Y=m(11048),X=m(11095),O=m(11393),v=m(11400),N=m(11297);class t extends E.c{get position(){return this._position}set position(V){this._position=V}set upVector(V){this._upVector=V}get upVector(){return this._upVector}get screenArea(){let V=0,I=0;if(this.mode===t.PERSPECTIVE_CAMERA)this.fovMode===t.FOVMODE_VERTICAL_FIXED?(I=2*this.Fk*Math.tan(this.fov/2),V=this.getEngine().getAspectRatio(this)*I):(V=2*this.Fk*Math.tan(this.fov/2),I=V/this.getEngine().getAspectRatio(this));else{const m=this.getEngine().getRenderWidth()/2,C=this.getEngine().getRenderHeight()/2;V=(this.orthoRight??m)-(this.orthoLeft??-m),I=(this.orthoTop??C)-(this.orthoBottom??-C)}return V*I}set orthoLeft(V){this._orthoLeft=V;for(const I of this._rigCameras)I.orthoLeft=V}get orthoLeft(){return this._orthoLeft}set orthoRight(V){this._orthoRight=V;for(const I of this._rigCameras)I.orthoRight=V}get orthoRight(){return this._orthoRight}set orthoBottom(V){this._orthoBottom=V;for(const I of this._rigCameras)I.orthoBottom=V}get orthoBottom(){return this._orthoBottom}set orthoTop(V){this._orthoTop=V;for(const I of this._rigCameras)I.orthoTop=V}get orthoTop(){return this._orthoTop}setFocalLength(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:36;this.fov=2*Math.atan(I/(2*V))}set mode(V){this._mode=V;for(const I of this._rigCameras)I.mode=V}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(V,I,m){let C=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(V,m,!1),this._position=j.m.Zero(),this._upVector=j.m.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.Fk=1,this.maxZ=1e4,this.inertia=.9,this._mode=t.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new O.e(0,0,1,1),this.layerMask=268435455,this.fovMode=t.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=t.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new k.e,this.onProjectionMatrixChangedObservable=new k.e,this.onAfterCheckInputsObservable=new k.e,this.onRestoreStateObservable=new k.e,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new j.b,this._postProcesses=new Array,this._activeMeshes=new s.g(256),this._globalPosition=j.m.Zero(),this._computedViewMatrix=j.b.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=j.b.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=j.e.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.cV().addCamera(this),C&&!this.cV().activeCamera&&(this.cV().activeCamera=this),this.position=I,this.renderPassId=this.cV().getEngine().createRenderPassId(`Camera ${V}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"uE"}toString(V){let I="Name: "+this.name;if(I+=", type: "+this.getClassName(),this.animations)for(let m=0;m<this.animations.length;m++)I+=", animation[0]: "+this.animations[m].toString(V);return I}applyVerticalCorrection(){const V=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-V.x:V.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(V){return-1!==this._activeMeshes.indexOf(V)}isReady(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(V)for(const I of this._postProcesses)if(I&&!I.isReady())return!1;return super.isReady(V)}_initCache(){super._initCache(),this._cache.position=new j.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new j.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.Fk=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(V){V||super._updateCache(),this._cache.position.C(this.position),this._cache.upVector.C(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let V=this._cache.mode===this.mode&&this._cache.Fk===this.Fk&&this._cache.maxZ===this.maxZ;if(!V)return!1;const I=this.getEngine();return this.mode===t.PERSPECTIVE_CAMERA?V=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===I.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(V=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===I.getRenderWidth()&&this._cache.renderHeight===I.getRenderHeight(),this.oblique&&(V=V&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),V}attachControl(V,I){}sY(V){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==t.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let V=0;V<this._postProcesses.length;V++)if(null!==this._postProcesses[V])return this._postProcesses[V];return null}_cascadePostProcessesToRigCams(){const V=this._getFirstPostProcess();V&&V.markTextureDirty();for(let I=0,m=this._rigCameras.length;I<m;I++){const V=this._rigCameras[I],m=V._rigPostProcess;if(m){"pass"===m.getEffectName()&&(V.isIntermediate=0===this._postProcesses.length),V._postProcesses=this._postProcesses.slice(0).concat(m),m.markTextureDirty()}else V._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!V.isReusable()&&this._postProcesses.indexOf(V)>-1?(K.d.Error("You're trying to reuse a post process not defined as reusable."),0):(null==I||I<0?this._postProcesses.push(V):null===this._postProcesses[I]?this._postProcesses[I]=V:this._postProcesses.splice(I,0,V),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.bE(),this._postProcesses.indexOf(V))}detachPostProcess(V){const I=this._postProcesses.indexOf(V);-1!==I&&(this._postProcesses[I]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.bE(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return j.b.Identity()}getViewMatrix(V){return!V&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.cV().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(V){this._doNotComputeProjectionMatrix=!0,void 0!==V&&(this._projectionMatrix=V)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(V){if(this._doNotComputeProjectionMatrix||!V&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.Fk=this.Fk,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const I=this.getEngine(),m=this.cV(),C=I.useReverseDepthBuffer;if(this.mode===t.PERSPECTIVE_CAMERA){let V;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=I.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.Fk<=0&&(this.Fk=.1),V=m.useRightHandedSystem?j.b.PerspectiveFovRHToRef:j.b.PerspectiveFovLHToRef,V(this.fov,I.getAspectRatio(this),C?this.maxZ:this.Fk,C?this.Fk:this.maxZ,this._projectionMatrix,this.fovMode===t.FOVMODE_VERTICAL_FIXED,I.isNDCHalfZRange,this.projectionPlaneTilt,C)}else{var l,s,F;const V=I.getRenderWidth()/2,k=I.getRenderHeight()/2;m.useRightHandedSystem?this.oblique?j.b.ObliqueOffCenterRHToRef(this.orthoLeft??-V,this.orthoRight??V,this.orthoBottom??-k,this.orthoTop??k,C?this.maxZ:this.Fk,C?this.Fk:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,I.isNDCHalfZRange):j.b.OrthoOffCenterRHToRef(this.orthoLeft??-V,this.orthoRight??V,this.orthoBottom??-k,this.orthoTop??k,C?this.maxZ:this.Fk,C?this.Fk:this.maxZ,this._projectionMatrix,I.isNDCHalfZRange):this.oblique?j.b.ObliqueOffCenterLHToRef(this.orthoLeft??-V,this.orthoRight??V,this.orthoBottom??-k,this.orthoTop??k,C?this.maxZ:this.Fk,C?this.Fk:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,I.isNDCHalfZRange):j.b.OrthoOffCenterLHToRef(this.orthoLeft??-V,this.orthoRight??V,this.orthoBottom??-k,this.orthoTop??k,C?this.maxZ:this.Fk,C?this.Fk:this.maxZ,this._projectionMatrix,I.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(l=this.oblique)||void 0===l?void 0:l.angle,this._cache.obliqueLength=null===(s=this.oblique)||void 0===s?void 0:s.length,this._cache.obliqueOffset=null===(F=this.oblique)||void 0===F?void 0:F.offset,this._cache.renderWidth=I.getRenderWidth(),this._cache.renderHeight=I.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(V){return(this.radius||(this.target?j.m.Distance(this.position,this.target):this.position.length()))+V}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?v.b.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=v.b.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),I&&this.rigCameras.length>0){let I=!1;for(const m of this.rigCameras)m._updateFrustumPlanes(),I=I||V.isInFrustum(m._frustumPlanes);return I}return V.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(V){return this._updateFrustumPlanes(),V.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,X.c)("Ray")}getForwardRayToRef(V){throw(0,X.c)("Ray")}dispose(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.cV().stopAnimation(this),this.cV().removeCamera(this);this._rigCameras.length>0;){const V=this._rigCameras.pop();V&&V.dispose()}if(this._parentContainer){const V=this._parentContainer.cameras.indexOf(this);V>-1&&this._parentContainer.cameras.splice(V,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==t.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let V=this._postProcesses.length;for(;--V>=0;){const I=this._postProcesses[V];I&&I.dispose(this)}}let m=this.customRenderTargets.length;for(;--m>=0;)this.customRenderTargets[m].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.cV().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(V,I)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(V,I){if(this.cameraRigMode!==V){for(;this._rigCameras.length>0;){const V=this._rigCameras.pop();V&&V.dispose()}if(this.cameraRigMode=V,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=I.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=F.d.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==t.RIG_MODE_NONE){const V=this.createRigCamera(this.name+"_L",0);V&&(V._isLeftCamera=!0);const I=this.createRigCamera(this.name+"_R",1);I&&(I._isRightCamera=!0),V&&I&&(this._rigCameras.push(V),this._rigCameras.push(I))}this._setRigMode(I),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(V){}_getVRProjectionMatrix(){return j.b.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.Fk,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(V,I){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[V]=I,"interaxialDistance"===V&&(this._cameraRigParams.stereoHalfAngle=F.d.ToRadians(I/.0637))}createRigCamera(V,I){return null}_updateRigCameras(){for(let V=0;V<this._rigCameras.length;V++)this._rigCameras[V].Fk=this.Fk,this._rigCameras[V].maxZ=this.maxZ,this._rigCameras[V].fov=this.fov,this._rigCameras[V].upVector.C(this.upVector);this.cameraRigMode===t.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const V=N.d.Serialize(this);return V.uniqueId=this.uniqueId,V.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(V),this.inputs&&this.inputs.serialize(V),N.d.AppendSerializedAnimations(this,V),V.ranges=this.serializeAnimationRanges(),V.isEnabled=this.isEnabled(),V}clone(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const m=N.d.Clone(t.GetConstructorFromName(this.getClassName(),V,this.cV(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return m.name=V,m.parent=I,this.onClonedObservable.notifyObservers(m),m}Kj(V){const I=j.m.Zero();return this.getDirectionToRef(V,I),I}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(V,I){j.m.TransformNormalToRef(V,this.getWorldMatrix(),I)}static GetConstructorFromName(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,l=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const s=E.c.Construct(V,I,m,{interaxial_distance:C,isStereoscopicSideBySide:l});return s||(()=>t._CreateDefaultParsedCamera(I,m))}fF(){return this.getWorldMatrix()}static Parse(V,I){const m=V.type,C=t.GetConstructorFromName(m,V.name,I,V.interaxial_distance,V.isStereoscopicSideBySide),l=N.d.Parse(C,V,I);if(void 0!==V.parentId&&(l._waitingParentId=V.parentId),void 0!==V.parentInstanceIndex&&(l._waitingParentInstanceIndex=V.parentInstanceIndex),l.inputs&&(l.inputs.parse(V),l._setupInputs()),V.upVector&&(l.upVector=j.m.Ik(V.upVector)),l.setPosition&&(l.position.aF(0,0,0),l.setPosition(j.m.Ik(V.position))),V.target&&l.setTarget&&l.setTarget(j.m.Ik(V.target)),V.cameraRigMode){const I=V.interaxial_distance?{interaxialDistance:V.interaxial_distance}:{};l.setCameraRigMode(V.cameraRigMode,I)}if(V.animations){for(let I=0;I<V.animations.length;I++){const m=V.animations[I],C=(0,Y.d)("BABYLON.Animation");C&&l.animations.push(C.Parse(m))}E.c.ParseAnimationRanges(l,V,I)}return V.autoAnimate&&I.beginAnimation(l,V.autoAnimateFrom,V.autoAnimateTo,V.autoAnimateLoop,V.autoAnimateSpeed||1),void 0!==V.isEnabled&&l.Sk(V.isEnabled),l}_calculateHandednessMultiplier(){let V=this.cV().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(V*=-1),V}}t._CreateDefaultParsedCamera=(V,I)=>{throw(0,X.c)("UniversalCamera")},t.PERSPECTIVE_CAMERA=0,t.ORTHOGRAPHIC_CAMERA=1,t.FOVMODE_VERTICAL_FIXED=0,t.FOVMODE_HORIZONTAL_FIXED=1,t.RIG_MODE_NONE=0,t.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,t.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,t.RIG_MODE_STEREOSCOPIC_INTERLACED=14,t.RIG_MODE_VR=20,t.RIG_MODE_CUSTOM=22,t.ForceAttachControlToAlwaysPreventDefault=!1,(0,C.d)([(0,l.x)("position")],t.prototype,"_position",void 0),(0,C.d)([(0,l.x)("upVector")],t.prototype,"_upVector",void 0),(0,C.d)([(0,l.B)()],t.prototype,"orthoLeft",null),(0,C.d)([(0,l.B)()],t.prototype,"orthoRight",null),(0,C.d)([(0,l.B)()],t.prototype,"orthoBottom",null),(0,C.d)([(0,l.B)()],t.prototype,"orthoTop",null),(0,C.d)([(0,l.B)()],t.prototype,"fov",void 0),(0,C.d)([(0,l.B)()],t.prototype,"projectionPlaneTilt",void 0),(0,C.d)([(0,l.B)()],t.prototype,"Fk",void 0),(0,C.d)([(0,l.B)()],t.prototype,"maxZ",void 0),(0,C.d)([(0,l.B)()],t.prototype,"inertia",void 0),(0,C.d)([(0,l.B)()],t.prototype,"mode",null),(0,C.d)([(0,l.B)()],t.prototype,"layerMask",void 0),(0,C.d)([(0,l.B)()],t.prototype,"fovMode",void 0),(0,C.d)([(0,l.B)()],t.prototype,"cameraRigMode",void 0),(0,C.d)([(0,l.B)()],t.prototype,"interaxialDistance",void 0),(0,C.d)([(0,l.B)()],t.prototype,"isStereoscopicSideBySide",void 0)},11564:(V,I,m)=>{m.d(I,{e:()=>Y});var C=m(11206),l=m(11214),s=m(11386),F=m(11040),k=m(11044),j=m(11372);m(11337).c.AddNodeConstructor("TargetCamera",((V,I)=>()=>new Y(V,F.m.Zero(),I)));const E=F.b.Zero(),K=F.e.Identity();class Y extends s.c{constructor(V,I,m){super(V,I,m,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this.cameraDirection=new F.m(0,0,0),this.cameraRotation=new F.k(0,0),this.updateUpVectorFromRotation=!1,this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=F.m.Zero(),this._initialFocalDistance=1,this._viewMatrix=F.b.Zero(),this._cameraTransformMatrix=F.b.Zero(),this._cameraRotationMatrix=F.b.Zero(),this._transformedReferencePoint=F.m.Zero(),this._deferredPositionUpdate=new F.m,this._deferredRotationQuaternionUpdate=new F.e,this._deferredRotationUpdate=new F.m,this._deferredUpdated=!1,this._deferOnly=!1,this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0,this._referencePoint=F.m.Forward(this.cV().useRightHandedSystem),this.rotation=new F.m(0,this.cV().useRightHandedSystem?Math.PI:0,0)}getFrontPosition(V){this.getWorldMatrix();const I=F.g.LF[0],m=F.g.LF[1];return m.set(0,0,this._scene.useRightHandedSystem?-1:1),this.getDirectionToRef(m,I),I.scaleInPlace(V),this.globalPosition.add(I)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const V=this.lockedTarget;V.fF().getTranslationToRef(V.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.aF(0,0,0),this.cameraRotation.aF(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new F.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new F.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new F.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(V){V||super._updateCache();const I=this._getLockedTargetPosition();I?this._cache.lockedTarget?this._cache.lockedTarget.C(I):this._cache.lockedTarget=I.clone():this._cache.lockedTarget=null,this._cache.rotation.C(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.C(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const V=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(V):!V)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const V=this.getEngine();return this.speed*Math.sqrt(V.getDeltaTime()/(100*V.getFps()))}setTarget(V){this.upVector.normalize(),this._initialFocalDistance=V.Fm(this.position).length(),this.position.z===V.z&&(this.position.z+=k.c),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),this.cV().useRightHandedSystem?F.b.LookAtRHToRef(this.position,V,F.m.UpReadOnly,E):F.b.LookAtLHToRef(this.position,V,F.m.UpReadOnly,E),E.invert();const I=this.rotationQuaternion||K;F.e.FromRotationMatrixToRef(E,I),I.toEulerAnglesToRef(this.rotation),this.rotation.z=0}get target(){return this.getTarget()}set target(V){this.setTarget(V)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(F.g.Matrix[0]),F.m.TransformNormalToRef(this.cameraDirection,F.g.Matrix[0],F.g.LF[0]),this._deferredPositionUpdate.addInPlace(F.g.LF[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.C(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.C(this._deferredPositionUpdate)}_checkInputs(){const V=this.invertRotation?-this.inverseRotationSpeed:1,I=this._decideIfNeedsToMove(),m=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.C(this.rotation),this._deferredPositionUpdate.C(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.C(this.rotationQuaternion),I&&this._updatePosition(),m){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*V,this._deferredRotationUpdate.y+=this.cameraRotation.y*V,!this.noRotationConstraint){const V=1.570796;this._deferredRotationUpdate.x>V&&(this._deferredRotationUpdate.x=V),this._deferredRotationUpdate.x<-V&&(this._deferredRotationUpdate.x=-V)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.C(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(F.e.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.C(this._deferredRotationQuaternionUpdate))}}I&&(Math.abs(this.cameraDirection.x)<this.speed*k.c&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*k.c&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*k.c&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),m&&(Math.abs(this.cameraRotation.x)<this.speed*k.c&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*k.c&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):F.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return F.m.TransformNormalToRef(F.m.UpReadOnly,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),F.m.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?j.c.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(F.e.FromEulerVectorToRef(this.rotation,K),j.c.Y.rotateByQuaternionToRef(K,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(V,I,m){if(this.cV().useRightHandedSystem?F.b.LookAtRHToRef(V,I,m,this._viewMatrix):F.b.LookAtLHToRef(V,I,m,this._viewMatrix),this.parent){const V=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(V,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.C(V)}createRigCamera(V,I){if(this.cameraRigMode!==s.c.RIG_MODE_NONE){const I=new Y(V,this.position.clone(),this.cV());return I.isRigCamera=!0,I.rigParent=this,this.cameraRigMode===s.c.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new F.e),I._cameraRigParams={},I.rotationQuaternion=new F.e),I.mode=this.mode,I.orthoLeft=this.orthoLeft,I.orthoRight=this.orthoRight,I.orthoTop=this.orthoTop,I.orthoBottom=this.orthoBottom,I}return null}_updateRigCameras(){const V=this._rigCameras[0],I=this._rigCameras[1];switch(this.fF(),this.cameraRigMode){case s.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case s.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case s.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case s.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case s.c.RIG_MODE_STEREOSCOPIC_INTERLACED:{const m=this.cameraRigMode===s.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,C=this.cameraRigMode===s.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*m,V),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*C,I);break}case s.c.RIG_MODE_VR:V.rotationQuaternion?(V.rotationQuaternion.C(this.rotationQuaternion),I.rotationQuaternion.C(this.rotationQuaternion)):(V.rotation.C(this.rotation),I.rotation.C(this.rotation)),V.position.C(this.position),I.position.C(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(V,I){this.getTarget().subtractToRef(this.position,Y._TargetFocalPoint),Y._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const m=Y._TargetFocalPoint.addInPlace(this.position);F.b.TranslationToRef(-m.x,-m.y,-m.z,Y._TargetTransformMatrix),Y._TargetTransformMatrix.multiplyToRef(F.b.RotationAxis(I.upVector,V),Y._RigCamTransformMatrix),F.b.TranslationToRef(m.x,m.y,m.z,Y._TargetTransformMatrix),Y._RigCamTransformMatrix.multiplyToRef(Y._TargetTransformMatrix,Y._RigCamTransformMatrix),F.m.TransformCoordinatesToRef(this.position,Y._RigCamTransformMatrix,I.position),I.setTarget(m)}getClassName(){return"TargetCamera"}}Y._RigCamTransformMatrix=new F.b,Y._TargetTransformMatrix=new F.b,Y._TargetFocalPoint=new F.m,(0,C.d)([(0,l.B)()],Y.prototype,"updateUpVectorFromRotation",void 0),(0,C.d)([(0,l.x)()],Y.prototype,"rotation",void 0),(0,C.d)([(0,l.B)()],Y.prototype,"speed",void 0),(0,C.d)([(0,l.m)("lockedTargetId")],Y.prototype,"lockedTarget",void 0)},11246:(V,I,m)=>{m.d(I,{d:()=>C});class C{constructor(V,I,m){this.bu=V,this.bv=I,this.distance=m,this.faceId=0,this.subMeshId=0}}},11366:(V,I,m)=>{m.d(I,{b:()=>s});var C=m(11040),l=m(11233);class s{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(){var V;let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0],m=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.pickedMesh||m&&!this.pickedMesh.isVerticesDataPresent(l.e.NormalKind))return null;let s,F=this.pickedMesh.AF();0===(null===(V=F)||void 0===V?void 0:V.length)&&(F=null);const k=C.g.LF[0],j=C.g.LF[1],E=C.g.LF[2];if(m){const V=this.pickedMesh.getVerticesData(l.e.NormalKind);let I=F?C.m.FromArrayToRef(V,3*F[3*this.faceId],k):k.aF(V[3*this.faceId*3],V[3*this.faceId*3+1],V[3*this.faceId*3+2]),m=F?C.m.FromArrayToRef(V,3*F[3*this.faceId+1],j):j.aF(V[3*(3*this.faceId+1)],V[3*(3*this.faceId+1)+1],V[3*(3*this.faceId+1)+2]),K=F?C.m.FromArrayToRef(V,3*F[3*this.faceId+2],E):E.aF(V[3*(3*this.faceId+2)],V[3*(3*this.faceId+2)+1],V[3*(3*this.faceId+2)+2]);I=I.scale(this.bu),m=m.scale(this.bv),K=K.scale(1-this.bu-this.bv),s=new C.m(I.x+m.x+K.x,I.y+m.y+K.y,I.z+m.z+K.z)}else{const V=this.pickedMesh.getVerticesData(l.e.PositionKind),I=F?C.m.FromArrayToRef(V,3*F[3*this.faceId],k):k.aF(V[3*this.faceId*3],V[3*this.faceId*3+1],V[3*this.faceId*3+2]),m=F?C.m.FromArrayToRef(V,3*F[3*this.faceId+1],j):j.aF(V[3*(3*this.faceId+1)],V[3*(3*this.faceId+1)+1],V[3*(3*this.faceId+1)+2]),K=F?C.m.FromArrayToRef(V,3*F[3*this.faceId+2],E):E.aF(V[3*(3*this.faceId+2)],V[3*(3*this.faceId+2)+1],V[3*(3*this.faceId+2)+2]),Y=I.Fm(m),X=K.Fm(m);s=C.m.Cross(Y,X)}const K=(V,I)=>{if(-1!==this.thinInstanceIndex){const m=V.thinInstanceGetWorldMatrices()[this.thinInstanceIndex];m&&C.m.TransformNormalToRef(I,m,I)}let m=V.getWorldMatrix();V.nonUniformScaling&&(C.g.Matrix[0].C(m),m=C.g.Matrix[0],m.setTranslationFromFloats(0,0,0),m.invert(),m.transposeToRef(C.g.Matrix[1]),m=C.g.Matrix[1]),C.m.TransformNormalToRef(I,m,I)};if(I&&K(this.pickedMesh,s),this.ray){const V=C.g.LF[0].C(s);I||K(this.pickedMesh,V),C.m.Dot(V,this.ray.direction)>0&&s.negateInPlace()}return s.normalize(),s}getTextureCoordinates(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.e.UVKind;if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(V))return null;const I=this.pickedMesh.AF();if(!I)return null;const m=this.pickedMesh.getVerticesData(V);if(!m)return null;let s=C.k.Ik(m,2*I[3*this.faceId]),F=C.k.Ik(m,2*I[3*this.faceId+1]),k=C.k.Ik(m,2*I[3*this.faceId+2]);return s=s.scale(this.bu),F=F.scale(this.bv),k=k.scale(1-this.bu-this.bv),new C.k(s.x+F.x+k.x,s.y+F.y+k.y)}}},11415:(V,I,m)=>{m.d(I,{e:()=>C});let C=!1},11260:(V,I,m)=>{m.d(I,{b:()=>F});var C=m(11046),l=m(11040),s=m(11044);class F{constructor(V,I,m){this.vectors=(0,C.d)(8,l.m.Zero),this.center=l.m.Zero(),this.centerWorld=l.m.Zero(),this.extendSize=l.m.Zero(),this.extendSizeWorld=l.m.Zero(),this.directions=(0,C.d)(3,l.m.Zero),this.vectorsWorld=(0,C.d)(8,l.m.Zero),this.minimumWorld=l.m.Zero(),this.maximumWorld=l.m.Zero(),this.minimum=l.m.Zero(),this.maximum=l.m.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(V,I,m)}reConstruct(V,I,m){const C=V.x,s=V.y,F=V.z,k=I.x,j=I.y,E=I.z,K=this.vectors;this.minimum.aF(C,s,F),this.maximum.aF(k,j,E),K[0].aF(C,s,F),K[1].aF(k,j,E),K[2].aF(k,s,F),K[3].aF(C,j,F),K[4].aF(C,s,E),K[5].aF(k,j,F),K[6].aF(C,j,E),K[7].aF(k,s,E),I.addToRef(V,this.center).scaleInPlace(.5),I.subtractToRef(V,this.extendSize).scaleInPlace(.5),this._worldMatrix=m||l.b.IdentityReadOnly,this._update(this._worldMatrix)}scale(V){const I=F._TmpVector3,m=this.maximum.subtractToRef(this.minimum,I[0]),C=m.length();m.normalizeFromLength(C);const l=C*V,s=m.scaleInPlace(.5*l),k=this.center.subtractToRef(s,I[1]),j=this.center.addToRef(s,I[2]);return this.reConstruct(k,j,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(V){const I=this.minimumWorld,m=this.maximumWorld,C=this.directions,s=this.vectorsWorld,F=this.vectors;if(V.isIdentity()){I.C(this.minimum),m.C(this.maximum);for(let V=0;V<8;++V)s[V].C(F[V]);this.extendSizeWorld.C(this.extendSize),this.centerWorld.C(this.center)}else{I.mk(Number.MAX_VALUE),m.mk(-Number.MAX_VALUE);for(let C=0;C<8;++C){const k=s[C];l.m.TransformCoordinatesToRef(F[C],V,k),I.minimizeInPlace(k),m.maximizeInPlace(k)}m.subtractToRef(I,this.extendSizeWorld).scaleInPlace(.5),m.addToRef(I,this.centerWorld).scaleInPlace(.5)}l.m.FromArrayToRef(V.m,0,C[0]),l.m.FromArrayToRef(V.m,4,C[1]),l.m.FromArrayToRef(V.m,8,C[2]),this._worldMatrix=V}isInFrustum(V){return F.IsInFrustum(this.vectorsWorld,V)}isCompletelyInFrustum(V){return F.IsCompletelyInFrustum(this.vectorsWorld,V)}intersectsPoint(V){const I=this.minimumWorld,m=this.maximumWorld,C=I.x,l=I.y,F=I.z,k=m.x,j=m.y,E=m.z,K=V.x,Y=V.y,X=V.z,O=-s.c;return!(k-K<O||O>K-C)&&(!(j-Y<O||O>Y-l)&&!(E-X<O||O>X-F))}intersectsSphere(V){return F.IntersectsSphere(this.minimumWorld,this.maximumWorld,V.centerWorld,V.radiusWorld)}intersectsMinMax(V,I){const m=this.minimumWorld,C=this.maximumWorld,l=m.x,s=m.y,F=m.z,k=C.x,j=C.y,E=C.z,K=V.x,Y=V.y,X=V.z,O=I.x,v=I.y,N=I.z;return!(k<K||l>O)&&(!(j<Y||s>v)&&!(E<X||F>N))}dispose(){var V,I;null===(V=this._drawWrapperFront)||void 0===V||V.dispose(),null===(I=this._drawWrapperBack)||void 0===I||I.dispose()}static Intersects(V,I){return V.intersectsMinMax(I.minimumWorld,I.maximumWorld)}static IntersectsSphere(V,I,m,C){const s=F._TmpVector3[0];l.m.ClampToRef(m,V,I,s);return l.m.DistanceSquared(m,s)<=C*C}static IsCompletelyInFrustum(V,I){for(let m=0;m<6;++m){const C=I[m];for(let I=0;I<8;++I)if(C.dotCoordinate(V[I])<0)return!1}return!0}static IsInFrustum(V,I){for(let m=0;m<6;++m){let C=!0;const l=I[m];for(let I=0;I<8;++I)if(l.dotCoordinate(V[I])>=0){C=!1;break}if(C)return!1}return!0}}F._TmpVector3=(0,C.d)(3,l.m.Zero)},11251:(V,I,m)=>{m.d(I,{d:()=>Y});var C=m(11046),l=m(11040),s=m(11260),F=m(11263);const k={min:0,max:0},j={min:0,max:0},E=(V,I,m)=>{const C=l.m.Dot(I.centerWorld,V),s=Math.abs(l.m.Dot(I.directions[0],V))*I.extendSize.x+Math.abs(l.m.Dot(I.directions[1],V))*I.extendSize.y+Math.abs(l.m.Dot(I.directions[2],V))*I.extendSize.z;m.min=C-s,m.max=C+s},K=(V,I,m)=>(E(V,I,k),E(V,m,j),!(k.min>j.max||j.min>k.max));class Y{constructor(V,I,m){this._isLocked=!1,this.boundingBox=new s.b(V,I,m),this.boundingSphere=new F.e(V,I,m)}reConstruct(V,I,m){this.boundingBox.reConstruct(V,I,m),this.boundingSphere.reConstruct(V,I,m)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(V){this._isLocked=V}update(V){this._isLocked||(this.boundingBox._update(V),this.boundingSphere._update(V))}centerOn(V,I){const m=Y._TmpVector3[0].C(V).WK(I),C=Y._TmpVector3[1].C(V).addInPlace(I);return this.boundingBox.reConstruct(m,C,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(m,C,this.boundingBox.getWorldMatrix()),this}encapsulate(V){const I=l.m.Minimize(this.minimum,V),m=l.m.Maximize(this.maximum,V);return this.reConstruct(I,m,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(V){const I=l.g.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(I);const m=l.g.LF[0];return l.m.TransformCoordinatesToRef(V.boundingBox.minimumWorld,I,m),this.encapsulate(m),l.m.TransformCoordinatesToRef(V.boundingBox.maximumWorld,I,m),this.encapsulate(m),this}scale(V){return this.boundingBox.scale(V),this.boundingSphere.scale(V),this}isInFrustum(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===I||3===I)&&this.boundingSphere.isCenterInFrustum(V))return!0;if(!this.boundingSphere.isInFrustum(V))return!1;return!(1!==I&&3!==I)||this.boundingBox.isInFrustum(V)}get diagonalLength(){const V=this.boundingBox;return V.maximumWorld.subtractToRef(V.minimumWorld,Y._TmpVector3[0]).length()}isCompletelyInFrustum(V){return this.boundingBox.isCompletelyInFrustum(V)}_checkCollision(V){return V._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(V){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(V)&&!!this.boundingBox.intersectsPoint(V))}intersects(V,I){if(!F.e.Intersects(this.boundingSphere,V.boundingSphere))return!1;if(!s.b.Intersects(this.boundingBox,V.boundingBox))return!1;if(!I)return!0;const m=this.boundingBox,C=V.boundingBox;return!!K(m.directions[0],m,C)&&(!!K(m.directions[1],m,C)&&(!!K(m.directions[2],m,C)&&(!!K(C.directions[0],m,C)&&(!!K(C.directions[1],m,C)&&(!!K(C.directions[2],m,C)&&(!!K(l.m.Cross(m.directions[0],C.directions[0]),m,C)&&(!!K(l.m.Cross(m.directions[0],C.directions[1]),m,C)&&(!!K(l.m.Cross(m.directions[0],C.directions[2]),m,C)&&(!!K(l.m.Cross(m.directions[1],C.directions[0]),m,C)&&(!!K(l.m.Cross(m.directions[1],C.directions[1]),m,C)&&(!!K(l.m.Cross(m.directions[1],C.directions[2]),m,C)&&(!!K(l.m.Cross(m.directions[2],C.directions[0]),m,C)&&(!!K(l.m.Cross(m.directions[2],C.directions[1]),m,C)&&!!K(l.m.Cross(m.directions[2],C.directions[2]),m,C))))))))))))))}}Y._TmpVector3=(0,C.d)(2,l.m.Zero)},11263:(V,I,m)=>{m.d(I,{e:()=>s});var C=m(11046),l=m(11040);class s{constructor(V,I,m){this.center=l.m.Zero(),this.centerWorld=l.m.Zero(),this.minimum=l.m.Zero(),this.maximum=l.m.Zero(),this.reConstruct(V,I,m)}reConstruct(V,I,m){this.minimum.C(V),this.maximum.C(I);const C=l.m.Distance(V,I);I.addToRef(V,this.center).scaleInPlace(.5),this.radius=.5*C,this._update(m||l.b.IdentityReadOnly)}scale(V){const I=this.radius*V,m=s._TmpVector3,C=m[0].mk(I),l=this.center.subtractToRef(C,m[1]),F=this.center.addToRef(C,m[2]);return this.reConstruct(l,F,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(V){if(V.isIdentity())this.centerWorld.C(this.center),this.radiusWorld=this.radius;else{l.m.TransformCoordinatesToRef(this.center,V,this.centerWorld);const I=s._TmpVector3[0];l.m.TransformNormalFromFloatsToRef(1,1,1,V,I),this.radiusWorld=Math.max(Math.abs(I.x),Math.abs(I.y),Math.abs(I.z))*this.radius}}isInFrustum(V){const I=this.centerWorld,m=this.radiusWorld;for(let C=0;C<6;C++)if(V[C].dotCoordinate(I)<=-m)return!1;return!0}isCenterInFrustum(V){const I=this.centerWorld;for(let m=0;m<6;m++)if(V[m].dotCoordinate(I)<0)return!1;return!0}intersectsPoint(V){const I=l.m.DistanceSquared(this.centerWorld,V);return!(this.radiusWorld*this.radiusWorld<I)}static Intersects(V,I){const m=l.m.DistanceSquared(V.centerWorld,I.centerWorld),C=V.radiusWorld+I.radiusWorld;return!(C*C<m)}static CreateFromCenterAndRadius(V,I,m){this._TmpVector3[0].C(V),this._TmpVector3[1].aF(0,0,I),this._TmpVector3[2].C(V),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].WK(this._TmpVector3[1]);const C=new s(this._TmpVector3[0],this._TmpVector3[2]);return C._worldMatrix=m||l.b.Identity(),C}}s._TmpVector3=(0,C.d)(3,l.m.Zero)},11485:(V,I,m)=>{m(11136).b.prototype.createDepthStencilTexture=function(V,I,m){if(I.isCube){const m=V.width||V;return this._createDepthStencilCubeTexture(m,I)}return this._createDepthStencilTexture(V,I,m)}},11467:(V,I,m)=>{m(11433).ThinEngine.prototype.setAlphaMode=function(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._alphaMode!==V){switch(V){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}I||(this.depthCullingState.depthMask=0===V),this._alphaMode=V}else if(!I){const I=0===V;this.depthCullingState.depthMask!==I&&(this.depthCullingState.depthMask=I)}}},11469:(V,I,m)=>{var C=m(11433);C.ThinEngine.prototype.updateDynamicIndexBuffer=function(V,I){let m;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(V),m=V.is32Bits?I instanceof Uint32Array?I:new Uint32Array(I):I instanceof Uint16Array?I:new Uint16Array(I),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,m,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},C.ThinEngine.prototype.updateDynamicVertexBuffer=function(V,I,m,C){this.bindArrayBuffer(V),void 0===m&&(m=0);const l=I.byteLength||I.length;void 0===C||C>=l&&0===m?I instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,m,new Float32Array(I)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,m,I):I instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,m,new Float32Array(I).subarray(0,C/4)):(I=I instanceof ArrayBuffer?new Uint8Array(I,0,C):new Uint8Array(I.buffer,I.byteOffset,C),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,m,I)),this._resetVertexBufferBinding()}},11473:(V,I,m)=>{var C=m(11161),l=m(11085),s=m(11433),F=m(11482),k=m(11458);class j extends F.c{setDepthStencilTexture(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(super.setDepthStencilTexture(V,I),!V)return;const m=this._engine,C=this._context,l=V._hardwareTexture;if(l&&V._autoMSAAManagement&&this._MSAAFramebuffer){const I=m._currentFramebuffer;m._bindUnboundFramebuffer(this._MSAAFramebuffer),C.framebufferRenderbuffer(C.FRAMEBUFFER,(0,k.c)(V.format)?C.DEPTH_STENCIL_ATTACHMENT:C.DEPTH_ATTACHMENT,C.RENDERBUFFER,l.getMSAARenderBuffer()),m._bindUnboundFramebuffer(I)}}constructor(V,I,m,C,l){super(V,I,m,C),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=l}_cloneRenderTargetWrapper(){let V=null;return this._colorTextureArray&&this._depthStencilTextureArray?(V=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),V.texture.isReady=!0):V=super._cloneRenderTargetWrapper(),V}_swapRenderTargetWrapper(V){super._swapRenderTargetWrapper(V),V._framebuffer=this._framebuffer,V._depthStencilBuffer=this._depthStencilBuffer,V._MSAAFramebuffer=this._MSAAFramebuffer,V._colorTextureArray=this._colorTextureArray,V._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,s=arguments.length>5?arguments[5]:void 0;if(this._depthStencilBuffer){const V=this._engine,I=V._currentFramebuffer,m=this._context;V._bindUnboundFramebuffer(this._framebuffer),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_STENCIL_ATTACHMENT,m.RENDERBUFFER,null),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,null),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.STENCIL_ATTACHMENT,m.RENDERBUFFER,null),V._bindUnboundFramebuffer(I),m.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(V,I,m,C,l,s)}shareDepth(V){super.shareDepth(V);const I=this._context,m=this._depthStencilBuffer,C=V._MSAAFramebuffer||V._framebuffer,l=this._engine;V._depthStencilBuffer&&V._depthStencilBuffer!==m&&I.deleteRenderbuffer(V._depthStencilBuffer),V._depthStencilBuffer=m;const s=V._generateStencilBuffer?I.DEPTH_STENCIL_ATTACHMENT:I.DEPTH_ATTACHMENT;l._bindUnboundFramebuffer(C),I.framebufferRenderbuffer(I.FRAMEBUFFER,s,I.RENDERBUFFER,m),l._bindUnboundFramebuffer(null)}_bindTextureRenderTarget(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2?arguments[2]:void 0,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const l=V._hardwareTexture;if(!l)return;const s=this._framebuffer,F=this._engine,k=F._currentFramebuffer;let j;if(F._bindUnboundFramebuffer(s),F.webGLVersion>1){const s=this._context;var E;if(j=s["COLOR_ATTACHMENT"+I],V.is2DArray||V.is3D)m=m??(null===(E=this.layerIndices)||void 0===E?void 0:E[I])??0,s.framebufferTextureLayer(s.FRAMEBUFFER,j,l.underlyingResource,C,m);else if(V.isCube){var K;m=m??(null===(K=this.faceIndices)||void 0===K?void 0:K[I])??0,s.framebufferTexture2D(s.FRAMEBUFFER,j,s.TEXTURE_CUBE_MAP_POSITIVE_X+m,l.underlyingResource,C)}else s.framebufferTexture2D(s.FRAMEBUFFER,j,s.TEXTURE_2D,l.underlyingResource,C)}else{const V=this._context;j=V["COLOR_ATTACHMENT"+I+"_WEBGL"];const s=void 0!==m?V.TEXTURE_CUBE_MAP_POSITIVE_X+m:V.TEXTURE_2D;V.framebufferTexture2D(V.FRAMEBUFFER,j,s,l.underlyingResource,C)}if(V._autoMSAAManagement&&this._MSAAFramebuffer){const V=this._context;F._bindUnboundFramebuffer(this._MSAAFramebuffer),V.framebufferRenderbuffer(V.FRAMEBUFFER,j,V.RENDERBUFFER,l.getMSAARenderBuffer())}F._bindUnboundFramebuffer(k)}setTexture(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super.setTexture(V,I,m),this._bindTextureRenderTarget(V,I)}setLayerAndFaceIndices(V,I){var m;if(super.setLayerAndFaceIndices(V,I),!this.textures||!this.layerIndices||!this.faceIndices)return;const C=(null===(m=this._attachments)||void 0===m?void 0:m.length)??this.textures.length;for(let l=0;l<C;l++){const V=this.textures[l];V&&(V.is2DArray||V.is3D?this._bindTextureRenderTarget(V,l,this.layerIndices[l]):V.isCube?this._bindTextureRenderTarget(V,l,this.faceIndices[l]):this._bindTextureRenderTarget(V,l))}}setLayerAndFaceIndex(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1?arguments[1]:void 0,m=arguments.length>2?arguments[2]:void 0;if(super.setLayerAndFaceIndex(V,I,m),!this.textures||!this.layerIndices||!this.faceIndices)return;const C=this.textures[V];C.is2DArray||C.is3D?this._bindTextureRenderTarget(this.textures[V],V,this.layerIndices[V]):C.isCube&&this._bindTextureRenderTarget(this.textures[V],V,this.faceIndices[V])}resolveMSAATextures(){const V=this._engine,I=V._currentFramebuffer;V._bindUnboundFramebuffer(this._MSAAFramebuffer),super.resolveMSAATextures(),V._bindUnboundFramebuffer(I)}dispose(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._disposeOnlyFramebuffers;const I=this._context;V||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(I.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(I.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(I.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(V)}}m(11485);s.ThinEngine.prototype._createHardwareRenderTargetWrapper=function(V,I,m){const C=new j(V,I,m,this,this._gl);return this._renderTargetWrapperCache.push(C),C},s.ThinEngine.prototype.createRenderTargetTexture=function(V,I){const m=this._createHardwareRenderTargetWrapper(!1,!1,V);let C,l,s=!0,F=!1,k=!1,j=1;void 0!==I&&"object"===typeof I&&(s=I.generateDepthBuffer??!0,F=!!I.generateStencilBuffer,k=!!I.noColorAttachment,C=I.colorAttachment,j=I.samples??1,l=I.label);const E=C||(k?null:this._createInternalTexture(V,I,!0,5)),K=V.width||V,Y=V.height||V,X=this._currentFramebuffer,O=this._gl,v=O.createFramebuffer();if(this._bindUnboundFramebuffer(v),m._depthStencilBuffer=this._setupFramebufferDepthAttachments(F,s,K,Y),!E||E.is2DArray||E.is3D||O.framebufferTexture2D(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,O.TEXTURE_2D,E._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(X),m.label=l??"RenderTargetWrapper",m._framebuffer=v,m._generateDepthBuffer=s,m._generateStencilBuffer=F,m.setTextures(E),C){if(m._samples=C.samples,C.samples>1){const V=C._hardwareTexture.getMSAARenderBuffer(0);m._MSAAFramebuffer=O.createFramebuffer(),this._bindUnboundFramebuffer(m._MSAAFramebuffer),O.framebufferRenderbuffer(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,O.RENDERBUFFER,V),this._bindUnboundFramebuffer(null)}}else this.updateRenderTargetTextureSampleCount(m,j);return m},s.ThinEngine.prototype._createDepthStencilTexture=function(V,I,m){const s=this._gl,F=V.layers||0,j=V.depth||0;let E=s.TEXTURE_2D;0!==F?E=s.TEXTURE_2D_ARRAY:0!==j&&(E=s.TEXTURE_3D);const K=new C.e(this,12);if(K.label=I.label,!this._caps.depthTextureExtension)return l.d.Error("Depth texture is not supported by your browser or hardware."),K;const Y={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...I};if(this._bindTextureDirectly(E,K,!0),this._setupDepthStencilTexture(K,V,0!==Y.comparisonFunction&&Y.bilinearFiltering,Y.comparisonFunction,Y.samples),void 0!==Y.depthTextureFormat){if(15!==Y.depthTextureFormat&&16!==Y.depthTextureFormat&&17!==Y.depthTextureFormat&&13!==Y.depthTextureFormat&&14!==Y.depthTextureFormat&&18!==Y.depthTextureFormat)return l.d.Error(`Depth texture ${Y.depthTextureFormat} format is not supported.`),K;K.format=Y.depthTextureFormat}else K.format=Y.generateStencil?13:16;const X=(0,k.c)(K.format),O=this._getWebGLTextureTypeFromDepthTextureFormat(K.format),v=X?s.DEPTH_STENCIL:s.DEPTH_COMPONENT,N=this._getInternalFormatFromDepthTextureFormat(K.format,!0,X);return K.is2DArray?s.texImage3D(E,0,N,K.width,K.height,F,0,v,O,null):K.is3D?s.texImage3D(E,0,N,K.width,K.height,j,0,v,O,null):s.texImage2D(E,0,N,K.width,K.height,0,v,O,null),this._bindTextureDirectly(E,null),this._internalTexturesCache.push(K),m._depthStencilBuffer&&(s.deleteRenderbuffer(m._depthStencilBuffer),m._depthStencilBuffer=null),this._bindUnboundFramebuffer(m._MSAAFramebuffer??m._framebuffer),m._generateStencilBuffer=X,m._depthStencilTextureWithStencil=X,m._depthStencilBuffer=this._setupFramebufferDepthAttachments(m._generateStencilBuffer,m._generateDepthBuffer,m.width,m.height,m.samples,K.format),this._bindUnboundFramebuffer(null),K},s.ThinEngine.prototype.updateRenderTargetTextureSampleCount=function(V,I){var m;if(this.webGLVersion<2||!V)return 1;if(V.samples===I)return I;const C=this._gl;I=Math.min(I,this.getCaps().maxMSAASamples),V._depthStencilBuffer&&(C.deleteRenderbuffer(V._depthStencilBuffer),V._depthStencilBuffer=null),V._MSAAFramebuffer&&(C.deleteFramebuffer(V._MSAAFramebuffer),V._MSAAFramebuffer=null);const l=null===(m=V.texture)||void 0===m?void 0:m._hardwareTexture;if(null===l||void 0===l||l.releaseMSAARenderBuffers(),V.texture&&I>1&&"function"===typeof C.renderbufferStorageMultisample){const m=C.createFramebuffer();if(!m)throw new Error("Unable to create multi sampled framebuffer");V._MSAAFramebuffer=m,this._bindUnboundFramebuffer(V._MSAAFramebuffer);const s=this._createRenderBuffer(V.texture.width,V.texture.height,I,-1,this._getRGBABufferInternalSizedFormat(V.texture.type,V.texture.format,V.texture._useSRGBBuffer),C.COLOR_ATTACHMENT0,!1);if(!s)throw new Error("Unable to create multi sampled framebuffer");null===l||void 0===l||l.addMSAARenderBuffer(s)}this._bindUnboundFramebuffer(V._MSAAFramebuffer??V._framebuffer),V.texture&&(V.texture.samples=I),V._samples=I;const s=V._depthStencilTexture?V._depthStencilTexture.format:void 0;return V._depthStencilBuffer=this._setupFramebufferDepthAttachments(V._generateStencilBuffer,V._generateDepthBuffer,V.width,V.height,I,s),this._bindUnboundFramebuffer(null),I},s.ThinEngine.prototype._setupDepthStencilTexture=function(V,I,m,C){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const s=I.width??I,F=I.height??I,k=I.layers||0,j=I.depth||0;V.baseWidth=s,V.baseHeight=F,V.width=s,V.height=F,V.is2DArray=k>0,V.depth=k||j,V.isReady=!0,V.samples=l,V.generateMipMaps=!1,V.samplingMode=m?2:1,V.type=0,V._comparisonFunction=C;const E=this._gl,K=this._getTextureTarget(V),Y=this._getSamplingParameters(V.samplingMode,!1);E.texParameteri(K,E.TEXTURE_MAG_FILTER,Y.mag),E.texParameteri(K,E.TEXTURE_MIN_FILTER,Y.min),E.texParameteri(K,E.TEXTURE_WRAP_S,E.CLAMP_TO_EDGE),E.texParameteri(K,E.TEXTURE_WRAP_T,E.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===C?(E.texParameteri(K,E.TEXTURE_COMPARE_FUNC,515),E.texParameteri(K,E.TEXTURE_COMPARE_MODE,E.NONE)):(E.texParameteri(K,E.TEXTURE_COMPARE_FUNC,C),E.texParameteri(K,E.TEXTURE_COMPARE_MODE,E.COMPARE_REF_TO_TEXTURE)))}},11121:(V,I,m)=>{m.d(I,{e:()=>H,g:()=>S,m:()=>c,k:()=>G,o:()=>r});class C{constructor(){this.children=[]}isValid(V){return!0}process(V,I,m){let C="";if(this.line){let m=this.line;const K=I.processor;if(K){var l,s,F,k,j,E;K.lineProcessor&&(m=K.lineProcessor(m,I.isFragment,I.processingContext));const C=(null===(l=I.processor)||void 0===l?void 0:l.attributeKeywordName)??"attribute",Y=I.isFragment&&null!==(s=I.processor)&&void 0!==s&&s.varyingFragmentKeywordName?null===(F=I.processor)||void 0===F?void 0:F.varyingFragmentKeywordName:!I.isFragment&&null!==(k=I.processor)&&void 0!==k&&k.varyingVertexKeywordName?null===(j=I.processor)||void 0===j?void 0:j.varyingVertexKeywordName:"varying";if(!I.isFragment&&K.attributeProcessor&&this.line.startsWith(C))m=K.attributeProcessor(this.line,V,I.processingContext);else if(K.varyingProcessor&&(null!==(E=K.varyingCheck)&&void 0!==E&&E.call(K,this.line,I.isFragment)||!K.varyingCheck&&this.line.startsWith(Y)))m=K.varyingProcessor(this.line,I.isFragment,V,I.processingContext);else if(K.uniformProcessor&&K.uniformRegexp&&K.uniformRegexp.test(this.line))I.lookForClosingBracketForUniformBuffer||(m=K.uniformProcessor(this.line,I.isFragment,V,I.processingContext));else if(K.uniformBufferProcessor&&K.uniformBufferRegexp&&K.uniformBufferRegexp.test(this.line))I.lookForClosingBracketForUniformBuffer||(m=K.uniformBufferProcessor(this.line,I.isFragment,I.processingContext),I.lookForClosingBracketForUniformBuffer=!0);else if(K.textureProcessor&&K.textureRegexp&&K.textureRegexp.test(this.line))m=K.textureProcessor(this.line,I.isFragment,V,I.processingContext);else if((K.uniformProcessor||K.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!I.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?K.uniformProcessor&&(m=K.uniformProcessor(this.line,I.isFragment,V,I.processingContext)):K.uniformBufferProcessor&&(m=K.uniformBufferProcessor(this.line,I.isFragment,I.processingContext),I.lookForClosingBracketForUniformBuffer=!0)}I.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(I.lookForClosingBracketForUniformBuffer=!1,K.endOfUniformBufferProcessor&&(m=K.endOfUniformBufferProcessor(this.line,I.isFragment,I.processingContext)))}C+=m+"\n"}for(const K of this.children)C+=K.process(V,I,m);return this.additionalDefineKey&&(V[this.additionalDefineKey]=this.additionalDefineValue||"true",m[this.additionalDefineKey]=V[this.additionalDefineKey]),C}}class l{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(V){this._lines.length=0;for(const I of V){if(!I||"\r"===I)continue;if("#"===I[0]){this._lines.push(I);continue}const V=I.trim();if(!V)continue;if(V.startsWith("//")){this._lines.push(I);continue}const m=V.indexOf(";");if(-1===m)this._lines.push(V);else if(m===V.length-1)V.length>1&&this._lines.push(V);else{const V=I.split(";");for(let I=0;I<V.length;I++){let m=V[I];m&&(m=m.trim(),m&&this._lines.push(m+(I!==V.length-1?";":"")))}}}}}class s extends C{process(V,I,m){for(let C=0;C<this.children.length;C++){const l=this.children[C];if(l.isValid(V))return l.process(V,I,m)}return""}}class F extends C{isValid(V){return this.testExpression.isTrue(V)}}class k{isTrue(V){return!0}static postfixToInfix(V){const I=[];for(const m of V)if(void 0===k._OperatorPriority[m])I.push(m);else{const V=I[I.length-1],C=I[I.length-2];I.length-=2,I.push(`(${C}${m}${V})`)}return I[I.length-1]}static infixToPostfix(V){const I=k._InfixToPostfixCache.get(V);if(I)return I.accessTime=Date.now(),I.result;if(!V.includes("&&")&&!V.includes("||")&&!V.includes(")")&&!V.includes("("))return[V];const m=[];let C=-1;const l=()=>{K=K.trim(),""!==K&&(m.push(K),K="")},s=V=>{C<k._Stack.length-1&&(k._Stack[++C]=V)},F=()=>k._Stack[C],j=()=>-1===C?"!!INVALID EXPRESSION!!":k._Stack[C--];let E=0,K="";for(;E<V.length;){const I=V.charAt(E),Y=E<V.length-1?V.substring(E,2+E):"";if("("===I)K="",s(I);else if(")"===I){for(l();-1!==C&&"("!==F();)m.push(j());j()}else if(k._OperatorPriority[Y]>1){for(l();-1!==C&&k._OperatorPriority[F()]>=k._OperatorPriority[Y];)m.push(j());s(Y),E++}else K+=I;E++}for(l();-1!==C;)"("===F()?j():m.push(j());return k._InfixToPostfixCache.size>=k.InfixToPostfixCacheLimitSize&&k.ClearCache(),k._InfixToPostfixCache.set(V,{result:m,accessTime:Date.now()}),m}static ClearCache(){const V=Array.from(k._InfixToPostfixCache.entries()).sort(((V,I)=>V[1].accessTime-I[1].accessTime));for(let I=0;I<k.InfixToPostfixCacheCleanupSize;I++)k._InfixToPostfixCache.delete(V[I][0])}}k.InfixToPostfixCacheLimitSize=5e4,k.InfixToPostfixCacheCleanupSize=25e3,k._InfixToPostfixCache=new Map,k._OperatorPriority={")":0,"(":1,"||":2,"&&":3},k._Stack=["","","","","","","","","","","","","","","","","","","",""];class j extends k{constructor(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=V,this.not=I}isTrue(V){let I=void 0!==V[this.define];return this.not&&(I=!I),I}}class E extends k{isTrue(V){return this.leftOperand.isTrue(V)||this.rightOperand.isTrue(V)}}class K extends k{isTrue(V){return this.leftOperand.isTrue(V)&&this.rightOperand.isTrue(V)}}class Y extends k{constructor(V,I,m){super(),this.define=V,this.operand=I,this.testValue=m}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(V){let I=!1;const m=parseInt(void 0!=V[this.define]?V[this.define]:this.define),C=parseInt(void 0!=V[this.testValue]?V[this.testValue]:this.testValue);if(isNaN(m)||isNaN(C))return!1;switch(this.operand){case">":I=m>C;break;case"<":I=m<C;break;case"<=":I=m<=C;break;case">=":I=m>=C;break;case"==":I=m===C;break;case"!=":I=m!==C}return I}}var X=m(11095),O=m(11125);const v=/defined\s*?\((.+?)\)/g,N=/defined\s*?\[(.+?)\]/g,t=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,D=/__decl__/,b=/light\{X\}.(\w*)/g,T=/\{X\}/g,n=[],x=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function S(V){V.processor&&V.processor.initializeShaders&&V.processor.initializeShaders(V.processingContext)}function c(V,I,m,C){var l;null!==(l=I.processor)&&void 0!==l&&l.preProcessShaderCode&&(V=I.processor.preProcessShaderCode(V,I.isFragment)),G(V,I,(V=>{I.processCodeAfterIncludes&&(V=I.processCodeAfterIncludes(I.isFragment?"fragment":"vertex",V,I.defines));const l=function(V,I,m){let C=function(V,I){var m;if(null!==(m=I.processor)&&void 0!==m&&m.noPrecision)return V;const C=I.shouldUseHighPrecisionShader;-1===V.indexOf("precision highp float")?V=C?"precision highp float;\n"+V:"precision mediump float;\n"+V:C||(V=V.replace("precision highp float","precision mediump float"));return V}(V,I);if(!I.processor)return C;if(0===I.processor.shaderLanguage&&-1!==C.indexOf("#version 3")&&(C=C.replace("#version 300 es",""),!I.processor.parseGLES3))return C;const l=I.defines,s=Q(I,m);I.processor.preProcessor&&(C=I.processor.preProcessor(C,l,s,I.isFragment,I.processingContext));const F={};C=W(C,s,I,F),I.processor.postProcessor&&(C=I.processor.postProcessor(C,l,I.isFragment,I.processingContext,m?{drawBuffersExtensionDisabled:!m.getCaps().drawBuffersExtension}:{},s,F));null!==m&&void 0!==m&&m._features.needShaderCodeInlining&&(C=m.inlineShaderCode(C));return C}(V,I,C);m(l,V)}))}function H(V,I,m){return m.processor&&m.processor.finalizeShaders?m.processor.finalizeShaders(V,I,m.processingContext):{vertexCode:V,fragmentCode:I}}function y(V){const I=/defined\((.+)\)/.exec(V);if(I&&I.length)return new j(I[1].trim(),"!"===V[0]);const m=["==","!=",">=","<=","<",">"];let C="",l=0;for(C of m)if(l=V.indexOf(C),l>-1)break;if(-1===l)return new j(V);const s=V.substring(0,l).trim(),F=V.substring(l+C.length).trim();return new Y(s,C,F)}function z(V,I){const m=new F,C=V.substring(0,I);let l=V.substring(I);return l=l.substring(0,(l.indexOf("//")+1||l.length+1)-1).trim(),m.testExpression="#ifdef"===C?new j(l):"#ifndef"===C?new j(l,!0):function(V){V=V.replace(v,"defined[$1]");const I=k.infixToPostfix(V),m=[];for(const l of I)if("||"!==l&&"&&"!==l)m.push(l);else if(m.length>=2){let V=m[m.length-1],I=m[m.length-2];m.length-=2;const C="&&"==l?new K:new E;"string"===typeof V&&(V=V.replace(N,"defined($1)")),"string"===typeof I&&(I=I.replace(N,"defined($1)")),C.leftOperand="string"===typeof I?y(I):I,C.rightOperand="string"===typeof V?y(V):V,m.push(C)}let C=m[m.length-1];return"string"===typeof C&&(C=C.replace(N,"defined($1)")),"string"===typeof C?y(C):C}(l),m}function Z(V,I,m,l){let s=V.currentLine;for(;B(V,m,l);){s=V.currentLine;const F=s.substring(0,5).toLowerCase();if("#else"===F){const m=new C;return I.children.push(m),void B(V,m,l)}if("#elif"===F){const V=z(s,5);I.children.push(V),m=V}}}function B(V,I,m){for(;V.canRead;){V.lineIndex++;const l=V.currentLine;if(l.indexOf("#")>=0){const C=x.exec(l);if(C&&C.length){switch(C[0]){case"#ifdef":{const C=new s;I.children.push(C);const F=z(l,6);C.children.push(F),Z(V,C,F,m);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const C=new s;I.children.push(C);const F=z(l,7);C.children.push(F),Z(V,C,F,m);break}case"#if":{const C=new s,F=z(l,3);I.children.push(C),C.children.push(F),Z(V,C,F,m);break}}continue}}const F=new C;if(F.line=l,I.children.push(F),"#"===l[0]&&"d"===l[1]){const V=l.replace(";","").split(" ");F.additionalDefineKey=V[1],3===V.length&&(F.additionalDefineValue=V[2])}}return!1}function W(V,I,m,s){const F=new C,k=new l;return k.lineIndex=-1,k.lines=V.split("\n"),B(k,F,s),F.process(I,m,s)}function Q(V,I){var m;const C=V.defines,l={};for(const s of C){const V=s.replace("#define","").replace(";","").trim().split(" ");l[V[0]]=V.length>1?V[1]:""}return 0===(null===(m=V.processor)||void 0===m?void 0:m.shaderLanguage)&&(l.GL_ES="true"),l.__VERSION__=V.version,l[V.platformName]="true",(0,O.j)(l,null===I||void 0===I?void 0:I.isNDCHalfZRange,null===I||void 0===I?void 0:I.useReverseDepthBuffer,null===I||void 0===I?void 0:I.useExactSrgbConversions),l}function G(V,I,m){let C;for(n.length=0;null!==(C=t.exec(V));)n.push(C);let l=String(V),s=[V],F=!1;for(const k of n){let V=k[1];if(-1!==V.indexOf("__decl__")&&(V=V.replace(D,""),I.supportsUniformBuffers&&(V=V.replace("Vertex","Ubo").replace("Fragment","Ubo")),V+="Declaration"),!I.includesShadersStore[V]){const C=I.shadersRepository+"ShadersInclude/"+V+".fx";return void r.loadFile(C,(C=>{I.includesShadersStore[V]=C,G(s.join(""),I,m)}))}{let m=I.includesShadersStore[V];if(k[2]){const V=k[3].split(",");for(let I=0;I<V.length;I+=2){const C=new RegExp(V[I],"g"),l=V[I+1];m=m.replace(C,l)}}if(k[4]){const V=k[5];if(-1!==V.indexOf("..")){const C=V.split(".."),l=parseInt(C[0]);let s=parseInt(C[1]),F=m.slice(0);m="",isNaN(s)&&(s=I.indexParameters[C[1]]);for(let V=l;V<s;V++)I.supportsUniformBuffers||(F=F.replace(b,((V,I)=>I+"{X}"))),m+=F.replace(T,V.toString())+"\n"}else I.supportsUniformBuffers||(m=m.replace(b,((V,I)=>I+"{X}"))),m=m.replace(T,V)}const C=[];for(const V of s){const I=V.split(k[0]);for(let V=0;V<I.length-1;V++)C.push(I[V]),C.push(m);C.push(I[I.length-1])}s=C,F=F||m.indexOf("#include<")>=0||m.indexOf("#include <")>=0}}n.length=0,l=s.join(""),F?G(l.toString(),I,m):m(l)}const r={loadFile:(V,I,m,C,l,s)=>{throw(0,X.c)("FileTools")}}},11452:(V,I,m)=>{m.d(I,{b:()=>C});class C{get underlyingResource(){return this._webGLTexture}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,I=arguments.length>1?arguments[1]:void 0;if(this._MSAARenderBuffers=null,this._context=I,!V&&(V=I.createTexture(),!V))throw new Error("Unable to create webGL texture");this.set(V)}setUsage(){}set(V){this._webGLTexture=V}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(V){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(V)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const V of this._MSAARenderBuffers)this._context.deleteRenderbuffer(V);this._MSAARenderBuffers=null}}getMSAARenderBuffer(){var V;let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(V=this._MSAARenderBuffers)||void 0===V?void 0:V[I])??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},11125:(V,I,m)=>{m.d(I,{e:()=>l,h:()=>s,j:()=>k,n:()=>F,p:()=>j});var C=m(11095);m(11081);const l={};function s(V,I){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(I?I+"\n":"")+V}function F(V,I,m,s,F,k,j){const E=j||l.loadFile;if(E){return E(V,I,m,s,F,k)}throw(0,C.c)("FileTools")}function k(V,I,m,C){if(V)return I?V.IS_NDC_HALF_ZRANGE="":delete V.IS_NDC_HALF_ZRANGE,m?V.USE_REVERSE_DEPTHBUFFER="":delete V.USE_REVERSE_DEPTHBUFFER,void(C?V.USE_EXACT_SRGB_CONVERSIONS="":delete V.USE_EXACT_SRGB_CONVERSIONS);{let V="";return I&&(V+="#define IS_NDC_HALF_ZRANGE"),m&&(V&&(V+="\n"),V+="#define USE_REVERSE_DEPTHBUFFER"),C&&(V&&(V+="\n"),V+="#define USE_EXACT_SRGB_CONVERSIONS"),V}}function j(V,I){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3?arguments[3]:void 0;switch(V){case 3:{const V=(ArrayBuffer,new Int8Array(I));return C&&V.set(new Int8Array(C)),V}case 0:{const V=(ArrayBuffer,new Uint8Array(I));return C&&V.set(new Uint8Array(C)),V}case 4:{const V=I instanceof ArrayBuffer?new Int16Array(I):new Int16Array(m?I/2:I);return C&&V.set(new Int16Array(C)),V}case 5:case 8:case 9:case 10:case 2:{const V=I instanceof ArrayBuffer?new Uint16Array(I):new Uint16Array(m?I/2:I);return C&&V.set(new Uint16Array(C)),V}case 6:{const V=I instanceof ArrayBuffer?new Int32Array(I):new Int32Array(m?I/4:I);return C&&V.set(new Int32Array(C)),V}case 7:case 11:case 12:case 13:case 14:case 15:{const V=I instanceof ArrayBuffer?new Uint32Array(I):new Uint32Array(m?I/4:I);return C&&V.set(new Uint32Array(C)),V}case 1:{const V=I instanceof ArrayBuffer?new Float32Array(I):new Float32Array(m?I/4:I);return C&&V.set(new Float32Array(C)),V}}const l=(ArrayBuffer,new Uint8Array(I));return C&&l.set(new Uint8Array(C)),l}},11136:(V,I,m)=>{m.d(I,{b:()=>T});var C=m(11061),l=m(11085),s=m(11143),F=m(11055),k=m(11091);class j{constructor(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,V&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(V){this._zOffset!==V&&(this._zOffset=V,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(V){this._zOffsetUnits!==V&&(this._zOffsetUnits=V,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(V){this._cullFace!==V&&(this._cullFace=V,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(V){this._cull!==V&&(this._cull=V,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(V){this._depthFunc!==V&&(this._depthFunc=V,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(V){this._depthMask!==V&&(this._depthMask=V,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(V){this._depthTest!==V&&(this._depthTest=V,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(V){this._frontFace!==V&&(this._frontFace=V,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(V){this.isDirty&&(this._isCullDirty&&(this.cull?V.enable(V.CULL_FACE):V.disable(V.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(V.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(V.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?V.enable(V.DEPTH_TEST):V.disable(V.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(V.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(V.enable(V.POLYGON_OFFSET_FILL),V.polygonOffset(this.zOffset,this.zOffsetUnits)):V.disable(V.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(V.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}class E{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(V){this._func!==V&&(this._func=V,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(V){this._funcRef!==V&&(this._funcRef=V,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(V){this._funcMask!==V&&(this._funcMask=V,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(V){this._opStencilFail!==V&&(this._opStencilFail=V,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(V){this._opDepthFail!==V&&(this._opDepthFail=V,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(V){this._opStencilDepthPass!==V&&(this._opStencilDepthPass=V,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(V){this._mask!==V&&(this._mask=V,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(V){this._enabled!==V&&(this._enabled=V,this._isStencilTestDirty=!0)}constructor(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,V&&this.reset()}reset(){var V;this.stencilMaterial=void 0,null===(V=this.stencilGlobal)||void 0===V||V.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(V){var I;if(!V)return;const m=!this.useStencilGlobalOnly&&!(null===(I=this.stencilMaterial)||void 0===I||!I.enabled);this.enabled=m?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=m?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=m?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=m?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=m?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=m?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=m?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=m?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?V.enable(V.STENCIL_TEST):V.disable(V.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(V.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(V.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(V.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}class K{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=K.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=K.KEEP,this.opDepthFail=K.KEEP,this.opStencilDepthPass=K.REPLACE}get stencilFunc(){return this.func}set stencilFunc(V){this.func=V}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(V){this.funcRef=V}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(V){this.funcMask=V}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(V){this.opStencilFail=V}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(V){this.opDepthFail=V}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(V){this.opStencilDepthPass=V}get stencilMask(){return this.mask}set stencilMask(V){this.mask=V}get stencilTest(){return this.enabled}set stencilTest(V){this.enabled=V}}K.ALWAYS=519,K.KEEP=7680,K.REPLACE=7681;class Y{constructor(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._alphaBlend}set alphaBlend(V){this._alphaBlend!==V&&(this._alphaBlend=V,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(V,I,m,C){this._blendConstants[0]===V&&this._blendConstants[1]===I&&this._blendConstants[2]===m&&this._blendConstants[3]===C||(this._blendConstants[0]=V,this._blendConstants[1]=I,this._blendConstants[2]=m,this._blendConstants[3]=C,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(V,I,m,C){this._blendFunctionParameters[0]===V&&this._blendFunctionParameters[1]===I&&this._blendFunctionParameters[2]===m&&this._blendFunctionParameters[3]===C||(this._blendFunctionParameters[0]=V,this._blendFunctionParameters[1]=I,this._blendFunctionParameters[2]=m,this._blendFunctionParameters[3]=C,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(V,I){this._blendEquationParameters[0]===V&&this._blendEquationParameters[1]===I||(this._blendEquationParameters[0]=V,this._blendEquationParameters[1]=I,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(V){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?V.enable(V.BLEND):V.disable(V.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(V.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(V.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(V.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}var X=m(11095),O=m(11161),v=m(11081),N=m(11067),t=m(11125),D=m(11177);function b(V,I){if((0,v.o)()){const{requestAnimationFrame:m}=I||window;if("function"===typeof m)return m(V)}else if("function"===typeof requestAnimationFrame)return requestAnimationFrame(V);return setTimeout(V,16)}class T{get frameId(){return this._frameId}get isWebGPU(){return this._isWebGPU}_getShaderProcessor(V){return this._shaderProcessor}get shaderPlatformName(){return this._shaderPlatformName}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}set useReverseDepthBuffer(V){V!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=V,this._depthCullingState.depthFunc=V?518:515)}setColorWrite(V){V!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=V)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}_getGlobalDefines(V){if(V)return this.isNDCHalfZRange?V.IS_NDC_HALF_ZRANGE="":delete V.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?V.USE_REVERSE_DEPTHBUFFER="":delete V.USE_REVERSE_DEPTHBUFFER,void(this.useExactSrgbConversions?V.USE_EXACT_SRGB_CONVERSIONS="":delete V.USE_EXACT_SRGB_CONVERSIONS);{let V="";return this.isNDCHalfZRange&&(V+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(V&&(V+="\n"),V+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(V&&(V+="\n"),V+="#define USE_EXACT_SRGB_CONVERSIONS"),V}}_rebuildInternalTextures(){const V=this._internalTexturesCache.slice();for(const I of V)I._rebuild()}_rebuildRenderTargetWrappers(){const V=this._renderTargetWrapperCache.slice();for(const I of V)I._rebuild()}_rebuildEffects(){for(const V in this._compiledEffects){const I=this._compiledEffects[V];I._pipelineContext=null,I._prepareEffect()}s.c.ResetCache()}_rebuildGraphicsResources(){var V;this.wipeCaches(!0),this._rebuildEffects(),null===(V=this._rebuildComputeEffects)||void 0===V||V.call(this),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_flagContextRestored(){l.d.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}_restoreEngineAfterContextLost(V){setTimeout((()=>{this._clearEmptyResources();const I=this._depthCullingState.depthTest,m=this._depthCullingState.depthFunc,C=this._depthCullingState.depthMask,l=this._stencilState.stencilTest;V(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=I,this._depthCullingState.depthFunc=m,this._depthCullingState.depthMask=C,this._stencilState.stencilTest=l,this._flagContextRestored()}),0)}get K(){return this._isDisposed}get snapshotRendering(){return!1}set snapshotRendering(V){}get snapshotRenderingMode(){return 0}set snapshotRenderingMode(V){}getClassName(){return"AbstractEngine"}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){const V=new Uint8Array(4),I=[V,V,V,V,V,V];this._emptyCubeTexture=this.createRawCubeTexture(I,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get activeRenderLoops(){return this._activeRenderLoops}stopRenderLoop(V){if(!V)return this._activeRenderLoops.length=0,void this._cancelFrame();const I=this._activeRenderLoops.indexOf(V);I>=0&&(this._activeRenderLoops.splice(I,1),0==this._activeRenderLoops.length&&this._cancelFrame())}_cancelFrame(){if(0!==this._frameHandler){const V=this._frameHandler;if(this._frameHandler=0,(0,v.o)()){const{cancelAnimationFrame:I}=this.getHostWindow()||window;if("function"===typeof I)return I(V)}else if("function"===typeof cancelAnimationFrame)return cancelAnimationFrame(V);return clearTimeout(V)}}DY(){this.onBeginFrameObservable.notifyObservers(this)}bY(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}get maxFPS(){return this._maxFPS}set maxFPS(V){this._maxFPS=V,void 0!==V&&(this._minFrameTime=V<=0?Number.MAX_VALUE:1e3/V)}_isOverFrameTime(V){if(!V||void 0===this._maxFPS)return!1;const I=V-this._lastFrameTime;return this._lastFrameTime=V,this._renderAccumulator+=I,this._renderAccumulator<this._minFrameTime||(this._renderAccumulator-=this._minFrameTime,this._renderAccumulator>this._minFrameTime&&(this._renderAccumulator=this._minFrameTime),!1)}_processFrame(V){if(this._frameHandler=0,!this._contextWasLost&&!this._isOverFrameTime(V)){let V=!0;(this.K||!this.renderEvenInBackground&&this._windowIsBackground)&&(V=!1),V&&(this.DY(),this.skipFrameRender||this._renderViews()||this._renderFrame(),this.bY())}}_renderLoop(V){this._processFrame(V),this._activeRenderLoops.length>0&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_renderFrame(){for(let V=0;V<this._activeRenderLoops.length;V++){(0,this._activeRenderLoops[V])()}}_renderViews(){return!1}_queueNewFrame(V,I){return b(V,I)}runRenderLoop(V){-1===this._activeRenderLoops.indexOf(V)&&(this._activeRenderLoops.push(V),1===this._activeRenderLoops.length&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(V){this._depthCullingState.depthTest=V}setZOffset(V){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-V:V}getZOffset(){const V=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-V:V}setZOffsetUnits(V){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-V:V}getZOffsetUnits(){const V=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-V:V}getHostWindow(){return(0,v.o)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(V){this._compatibilityMode=!0}_rebuildTextures(){for(const V of this.scenes)V._rebuildTextures();for(const V of this._virtualScenes)V._rebuildTextures()}_releaseRenderTargetWrapper(V){const I=this._renderTargetWrapperCache.indexOf(V);-1!==I&&this._renderTargetWrapperCache.splice(I,1)}get currentViewport(){return this._cachedViewport}setViewport(V,I,m){const C=I||this.getRenderWidth(),l=m||this.getRenderHeight(),s=V.x||0,F=V.y||0;this._cachedViewport=V,this._viewport(s*C,F*l,C*V.width,l*V.height)}createCanvasImage(){return document.createElement("img")}createCanvasPath2D(V){return new Path2D(V)}get description(){let V=this.name+this.version;return this._caps.parallelShaderCompile&&(V+=" - Parallel shader compilation"),V}_createTextureBase(V,I,m,s){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7?arguments[7]:void 0,K=arguments.length>8?arguments[8]:void 0,Y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,X=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,v=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,N=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,t=arguments.length>13?arguments[13]:void 0,b=arguments.length>14?arguments[14]:void 0,n=arguments.length>15?arguments[15]:void 0;const x="data:"===(V=V||"").substring(0,5),S="blob:"===V.substring(0,5),c=x&&-1!==V.indexOf(";base64,"),H=X||new O.e(this,1);H!==X&&(H.label=V.substring(0,60));const y=V;!this._transformTextureUrl||c||X||Y||(V=this._transformTextureUrl(V)),y!==V&&(H._originalUrl=y);const z=V.lastIndexOf(".");let Z=N||(z>-1?V.substring(z).toLowerCase():"");Z.indexOf("?")>-1&&(Z=Z.split("?")[0]);const B=(0,D.c)(Z,t);s&&s.addPendingData(H),H.url=V,H.generateMipMaps=!I,H.samplingMode=F,H.invertY=m,H._useSRGBBuffer=this._getUseSRGBBuffer(!!n,I),this._doNotHandleContextLost||(H._buffer=Y);let W=null;k&&!X&&(W=H.onLoadedObservable.add(k)),X||this._internalTexturesCache.push(H);const Q=(m,X)=>{s&&s.removePendingData(H),V===y?(W&&H.onLoadedObservable.remove(W),C.c.UseFallbackTexture&&V!==C.c.FallbackTexture&&this._createTextureBase(C.c.FallbackTexture,I,H.invertY,s,F,null,j,E,K,Y,H),m=(m||"Unknown error")+(C.c.UseFallbackTexture?" - Fallback texture was used":""),H.onErrorObservable.notifyObservers({message:m,exception:X}),j&&j(m,X)):(l.d.Warn(`Failed to load ${V}, falling back to ${y}`),this._createTextureBase(y,I,H.invertY,s,F,k,j,E,K,Y,H,v,N,t,b,n))};if(B){const I=async V=>{(await B).loadData(V,H,((V,I,m,C,l,k)=>{k?Q("TextureLoader failed to load data"):E(H,Z,s,{width:V,height:I},H.invertY,!m,C,(()=>(l(),!1)),F)}),b)};Y?Y instanceof ArrayBuffer?I(new Uint8Array(Y)):ArrayBuffer.isView(Y)?I(Y):j&&j("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(V,(V=>{I(new Uint8Array(V))}),void 0,s?s.offlineProvider:void 0,!0,((V,I)=>{Q("Unable to load "+(V&&V.responseURL,I))}))}else{const m=V=>{S&&!this._doNotHandleContextLost&&(H._buffer=V),E(H,Z,s,V,H.invertY,I,!1,K,F)};!x||c?Y&&("string"===typeof Y.decoding||Y.close)?m(Y):T._FileToolsLoadImage(V||"",m,Q,s?s.offlineProvider:null,t,H.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0,this):"string"===typeof Y||Y instanceof ArrayBuffer||ArrayBuffer.isView(Y)||Y instanceof Blob?T._FileToolsLoadImage(Y,m,Q,s?s.offlineProvider:null,t,H.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0,this):Y&&m(Y)}return H}_rebuildBuffers(){for(const V of this._uniformBuffers)V._rebuildAfterContextLost()}get _shouldUseHighPrecisionShader(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,v.i)()?document:null}getLoadedTexturesCache(){return this._internalTexturesCache}clearInternalTexturesCache(){this._internalTexturesCache.length=0}getCaps(){return this._caps}resetTextureCache(){for(const V in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,V)&&(this._boundTexturesCache[V]=null);this._currentTextureChannel=-1}get name(){return this._name}set name(V){this._name=V}static get NpmPackage(){return"babylonjs@8.13.0"}static get Version(){return"8.13.0"}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}setHardwareScalingLevel(V){this._hardwareScalingLevel=V,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(V){this._doNotHandleContextLost=V}get isStencilEnable(){return this._isStencilEnable}getCreationOptions(){return this._creationOptions}constructor(V,I,m){var l,s;this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new j,this._stencilStateComposer=new E,this._stencilState=new K,this._alphaState=new Y,this._alphaMode=1,this._alphaEquation=0,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new N.e,this.onCanvasFocusObservable=new N.e,this.onNewSceneAddedObservable=new N.e,this.onResizeObservable=new N.e,this.onCanvasPointerOutObservable=new N.e,this.onEffectErrorObservable=new N.e,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new N.e,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=V=>this._renderLoop(V),this._lastFrameTime=0,this._renderAccumulator=0,this.skipFrameRender=!1,this.onBeforeShaderCompilationObservable=new N.e,this.onAfterShaderCompilationObservable=new N.e,this.onBeginFrameObservable=new N.e,this.onEndFrameObservable=new N.e,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new N.e,this.onContextRestoredObservable=new N.e,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.Ck=new N.e,this.onReleaseEffectsObservable=new N.e,C.c.Instances.push(this),this.startTime=k.d.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,F.d.SetMatrixPrecision(!!I.useHighPrecisionMatrix),(0,v.l)()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=m??!1,I.antialias=V??I.antialias,I.deterministicLockstep=I.deterministicLockstep??!1,I.lockstepMaxSteps=I.lockstepMaxSteps??4,I.timeStep=I.timeStep??1/60,I.stencil=I.stencil??!0,this._audioContext=(null===(l=I.audioEngineOptions)||void 0===l?void 0:l.audioContext)??null,this._audioDestination=(null===(s=I.audioEngineOptions)||void 0===s?void 0:s.audioDestination)??null,this.premultipliedAlpha=I.premultipliedAlpha??!0,this._doNotHandleContextLost=!!I.doNotHandleContextLost,this._isStencilEnable=!!I.stencil,this.useExactSrgbConversions=I.useExactSrgbConversions??!1;const X=(0,v.o)()&&window.devicePixelRatio||1,O=I.limitDeviceRatio||X;m=m||I.adaptToDeviceRatio||!1,this._hardwareScalingLevel=m?1/Math.min(O,X):1,this._lastDevicePixelRatio=X,this._creationOptions=I}resize(){let V,I,m=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.adaptToDeviceRatio){const V=(0,v.o)()&&window.devicePixelRatio||1,I=this._lastDevicePixelRatio/V;this._lastDevicePixelRatio=V,this._hardwareScalingLevel*=I}if((0,v.o)()&&(0,v.i)())if(this._renderingCanvas){var C,l;const m=null===(C=(l=this._renderingCanvas).getBoundingClientRect)||void 0===C?void 0:C.call(l);V=this._renderingCanvas.clientWidth||(null===m||void 0===m?void 0:m.width)||this._renderingCanvas.width*this._hardwareScalingLevel||100,I=this._renderingCanvas.clientHeight||(null===m||void 0===m?void 0:m.height)||this._renderingCanvas.height*this._hardwareScalingLevel||100}else V=window.innerWidth,I=window.innerHeight;else V=this._renderingCanvas?this._renderingCanvas.width:100,I=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(V/this._hardwareScalingLevel,I/this._hardwareScalingLevel,m)}setSize(V,I){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._renderingCanvas)return!1;if(V|=0,I|=0,!m&&this._renderingCanvas.width===V&&this._renderingCanvas.height===I)return!1;if(this._renderingCanvas.width=V,this._renderingCanvas.height=I,this.scenes){for(let V=0;V<this.scenes.length;V++){const I=this.scenes[V];for(let V=0;V<I.cameras.length;V++){I.cameras[V]._currentRenderId=0}}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}createRawTexture(V,I,m,C,l,s,F,k,j,E,K){throw(0,X.c)("engine.rawTexture")}createRawCubeTexture(V,I,m,C,l,s,F,k){throw(0,X.c)("engine.rawTexture")}createRawTexture3D(V,I,m,C,l,s,F,k,j,E,K){throw(0,X.c)("engine.rawTexture")}createRawTexture2DArray(V,I,m,C,l,s,F,k,j,E,K){throw(0,X.c)("engine.rawTexture")}_sharedInit(V){this._renderingCanvas=V}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const V=navigator.userAgent;this.hostInformation.isMobile=-1!==V.indexOf("Mobile")||-1!==V.indexOf("Mac")&&(0,v.i)()&&"ontouchend"in document},this._checkForMobile(),(0,v.o)()&&window.addEventListener("resize",this._checkForMobile))}createVideoElement(V){return document.createElement("video")}_reportDrawCall(){var V;let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;null===(V=this._drawCalls)||void 0===V||V.addCount(I,!1)}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return 1e3*this._timeStep}_createImageBitmapFromSource(V,I){throw new Error("createImageBitmapFromSource is not implemented")}createImageBitmap(V,I){return createImageBitmap(V,I)}resizeImageBitmap(V,I,m){throw new Error("resizeImageBitmap is not implemented")}getFontOffset(V){throw new Error("getFontOffset is not implemented")}static _CreateCanvas(V,I){if("undefined"===typeof document)return new OffscreenCanvas(V,I);const m=document.createElement("canvas");return m.width=V,m.height=I,m}createCanvas(V,I){return T._CreateCanvas(V,I)}static _FileToolsLoadImage(V,I,m,C,l,s,F){throw(0,X.c)("FileTools")}_loadFile(V,I,m,C,l,s){const F=(0,t.n)(V,I,m,C,l,s);return this._activeRequests.push(F),F.onCompleteObservable.add((()=>{const V=this._activeRequests.indexOf(F);-1!==V&&this._activeRequests.splice(V,1)})),F}static _FileToolsLoadFile(V,I,m,C,l,s){if(t.e.loadFile)return t.e.loadFile(V,I,m,C,l,s);throw(0,X.c)("FileTools")}dispose(){var V;for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();null===(V=this.releaseComputeEffects)||void 0===V||V.call(this),s.c.ResetCache();for(const m of this._activeRequests)m.abort();this._boundRenderFunction=null,this.Ck.notifyObservers(this),this.Ck.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),this.onEffectErrorObservable.clear(),(0,v.o)()&&window.removeEventListener("resize",this._checkForMobile);const I=C.c.Instances.indexOf(this);I>=0&&C.c.Instances.splice(I,1),C.c.Instances.length||(C.c.OnEnginesDisposedObservable.notifyObservers(this),C.c.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}static DefaultLoadingScreenFactory(V){throw(0,X.c)("LoadingScreen")}static MarkAllMaterialsAsDirty(V,I){for(let m=0;m<C.c.Instances.length;m++){const l=C.c.Instances[m];for(let m=0;m<l.scenes.length;m++)l.scenes[m].markAllMaterialsAsDirty(V,I)}}}T._RenderPassIdCounter=0,T._RescalePostProcessFactory=null,T.CollisionsEpsilon=.001,T.QueueNewFrame=b},11551:(V,I,m)=>{m.d(I,{d:()=>C});class C{}C.AUTOSAMPLERSUFFIX="Sampler",C.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",C.ALPHA_DISABLE=0,C.ALPHA_ADD=1,C.ALPHA_COMBINE=2,C.ALPHA_SUBTRACT=3,C.ALPHA_MULTIPLY=4,C.ALPHA_MAXIMIZED=5,C.ALPHA_ONEONE=6,C.ALPHA_PREMULTIPLIED=7,C.ALPHA_PREMULTIPLIED_PORTERDUFF=8,C.ALPHA_INTERPOLATE=9,C.ALPHA_SCREENMODE=10,C.ALPHA_ONEONE_ONEONE=11,C.ALPHA_ALPHATOCOLOR=12,C.ALPHA_REVERSEONEMINUS=13,C.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,C.ALPHA_ONEONE_ONEZERO=15,C.ALPHA_EXCLUSION=16,C.ALPHA_LAYER_ACCUMULATE=17,C.ALPHA_EQUATION_ADD=0,C.ALPHA_EQUATION_SUBSTRACT=1,C.ALPHA_EQUATION_REVERSE_SUBTRACT=2,C.ALPHA_EQUATION_MAX=3,C.ALPHA_EQUATION_MIN=4,C.ALPHA_EQUATION_DARKEN=5,C.DELAYLOADSTATE_NONE=0,C.DELAYLOADSTATE_LOADED=1,C.DELAYLOADSTATE_LOADING=2,C.DELAYLOADSTATE_NOTLOADED=4,C.NEVER=512,C.ALWAYS=519,C.LESS=513,C.EQUAL=514,C.LEQUAL=515,C.GREATER=516,C.GEQUAL=518,C.NOTEQUAL=517,C.KEEP=7680,C.ZERO=0,C.REPLACE=7681,C.INCR=7682,C.DECR=7683,C.INVERT=5386,C.INCR_WRAP=34055,C.DECR_WRAP=34056,C.TEXTURE_CLAMP_ADDRESSMODE=0,C.TEXTURE_WRAP_ADDRESSMODE=1,C.TEXTURE_MIRROR_ADDRESSMODE=2,C.TEXTURE_CREATIONFLAG_STORAGE=1,C.TEXTUREFORMAT_ALPHA=0,C.TEXTUREFORMAT_LUMINANCE=1,C.TEXTUREFORMAT_LUMINANCE_ALPHA=2,C.TEXTUREFORMAT_RGB=4,C.TEXTUREFORMAT_RGBA=5,C.TEXTUREFORMAT_RED=6,C.TEXTUREFORMAT_R=6,C.TEXTUREFORMAT_R16_UNORM=33322,C.TEXTUREFORMAT_RG16_UNORM=33324,C.TEXTUREFORMAT_RGB16_UNORM=32852,C.TEXTUREFORMAT_RGBA16_UNORM=32859,C.TEXTUREFORMAT_R16_SNORM=36760,C.TEXTUREFORMAT_RG16_SNORM=36761,C.TEXTUREFORMAT_RGB16_SNORM=36762,C.TEXTUREFORMAT_RGBA16_SNORM=36763,C.TEXTUREFORMAT_RG=7,C.TEXTUREFORMAT_RED_INTEGER=8,C.TEXTUREFORMAT_R_INTEGER=8,C.TEXTUREFORMAT_RG_INTEGER=9,C.TEXTUREFORMAT_RGB_INTEGER=10,C.TEXTUREFORMAT_RGBA_INTEGER=11,C.TEXTUREFORMAT_BGRA=12,C.TEXTUREFORMAT_DEPTH24_STENCIL8=13,C.TEXTUREFORMAT_DEPTH32_FLOAT=14,C.TEXTUREFORMAT_DEPTH16=15,C.TEXTUREFORMAT_DEPTH24=16,C.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,C.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,C.TEXTUREFORMAT_STENCIL8=19,C.TEXTUREFORMAT_UNDEFINED=4294967295,C.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,C.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,C.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,C.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,C.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,C.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,C.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,C.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,C.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,C.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,C.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,C.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,C.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,C.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,C.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,C.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,C.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,C.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,C.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,C.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,C.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,C.TEXTURETYPE_UNSIGNED_BYTE=0,C.TEXTURETYPE_UNSIGNED_INT=0,C.TEXTURETYPE_FLOAT=1,C.TEXTURETYPE_HALF_FLOAT=2,C.TEXTURETYPE_BYTE=3,C.TEXTURETYPE_SHORT=4,C.TEXTURETYPE_UNSIGNED_SHORT=5,C.TEXTURETYPE_INT=6,C.TEXTURETYPE_UNSIGNED_INTEGER=7,C.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,C.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,C.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,C.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,C.TEXTURETYPE_UNSIGNED_INT_24_8=12,C.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,C.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,C.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,C.TEXTURETYPE_UNDEFINED=16,C.TEXTURE_2D=3553,C.TEXTURE_2D_ARRAY=35866,C.TEXTURE_CUBE_MAP=34067,C.TEXTURE_CUBE_MAP_ARRAY=3735928559,C.TEXTURE_3D=32879,C.TEXTURE_NEAREST_SAMPLINGMODE=1,C.TEXTURE_NEAREST_NEAREST=1,C.TEXTURE_BILINEAR_SAMPLINGMODE=2,C.TEXTURE_LINEAR_LINEAR=2,C.TEXTURE_TRILINEAR_SAMPLINGMODE=3,C.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,C.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,C.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,C.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,C.TEXTURE_NEAREST_LINEAR=7,C.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,C.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,C.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,C.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,C.TEXTURE_LINEAR_NEAREST=12,C.TEXTURE_EXPLICIT_MODE=0,C.TEXTURE_SPHERICAL_MODE=1,C.TEXTURE_PLANAR_MODE=2,C.TEXTURE_CUBIC_MODE=3,C.TEXTURE_PROJECTION_MODE=4,C.TEXTURE_SKYBOX_MODE=5,C.TEXTURE_INVCUBIC_MODE=6,C.TEXTURE_EQUIRECTANGULAR_MODE=7,C.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,C.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,C.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,C.TEXTURE_FILTERING_QUALITY_HIGH=64,C.TEXTURE_FILTERING_QUALITY_MEDIUM=16,C.TEXTURE_FILTERING_QUALITY_LOW=8,C.SCALEMODE_FLOOR=1,C.SCALEMODE_NEAREST=2,C.SCALEMODE_CEILING=3,C.MATERIAL_TextureDirtyFlag=1,C.MATERIAL_LightDirtyFlag=2,C.MATERIAL_FresnelDirtyFlag=4,C.MATERIAL_AttributesDirtyFlag=8,C.MATERIAL_MiscDirtyFlag=16,C.MATERIAL_PrePassDirtyFlag=32,C.MATERIAL_ImageProcessingDirtyFlag=64,C.MATERIAL_AllDirtyFlag=127,C.MATERIAL_TriangleFillMode=0,C.MATERIAL_WireFrameFillMode=1,C.MATERIAL_PointFillMode=2,C.MATERIAL_PointListDrawMode=3,C.MATERIAL_LineListDrawMode=4,C.MATERIAL_LineLoopDrawMode=5,C.MATERIAL_LineStripDrawMode=6,C.MATERIAL_TriangleStripDrawMode=7,C.MATERIAL_TriangleFanDrawMode=8,C.MATERIAL_ClockWiseSideOrientation=0,C.MATERIAL_CounterClockWiseSideOrientation=1,C.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR=0,C.MATERIAL_DIFFUSE_MODEL_BURLEY=1,C.MATERIAL_DIFFUSE_MODEL_LAMBERT=2,C.MATERIAL_DIFFUSE_MODEL_LEGACY=3,C.MATERIAL_DIELECTRIC_SPECULAR_MODEL_GLTF=0,C.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR=1,C.MATERIAL_CONDUCTOR_SPECULAR_MODEL_GLTF=0,C.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR=1,C.ACTION_NothingTrigger=0,C.ACTION_OnPickTrigger=1,C.ACTION_OnLeftPickTrigger=2,C.ACTION_OnRightPickTrigger=3,C.ACTION_OnCenterPickTrigger=4,C.ACTION_OnPickDownTrigger=5,C.ACTION_OnDoublePickTrigger=6,C.ACTION_OnPickUpTrigger=7,C.ACTION_OnPickOutTrigger=16,C.ACTION_OnLongPressTrigger=8,C.ACTION_OnPointerOverTrigger=9,C.ACTION_OnPointerOutTrigger=10,C.ACTION_OnEveryFrameTrigger=11,C.ACTION_OnIntersectionEnterTrigger=12,C.ACTION_OnIntersectionExitTrigger=13,C.ACTION_OnKeyDownTrigger=14,C.ACTION_OnKeyUpTrigger=15,C.PARTICLES_BILLBOARDMODE_Y=2,C.PARTICLES_BILLBOARDMODE_ALL=7,C.PARTICLES_BILLBOARDMODE_STRETCHED=8,C.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,C.MESHES_CULLINGSTRATEGY_STANDARD=0,C.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,C.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,C.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,C.SCENELOADER_NO_LOGGING=0,C.SCENELOADER_MINIMAL_LOGGING=1,C.SCENELOADER_SUMMARY_LOGGING=2,C.SCENELOADER_DETAILED_LOGGING=3,C.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,C.PREPASS_POSITION_TEXTURE_TYPE=1,C.PREPASS_VELOCITY_TEXTURE_TYPE=2,C.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,C.PREPASS_COLOR_TEXTURE_TYPE=4,C.PREPASS_DEPTH_TEXTURE_TYPE=5,C.PREPASS_NORMAL_TEXTURE_TYPE=6,C.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,C.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,C.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,C.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,C.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,C.PREPASS_ALBEDO_TEXTURE_TYPE=12,C.PREPASS_NORMALIZED_VIEW_DEPTH_TEXTURE_TYPE=13,C.BUFFER_CREATIONFLAG_READ=1,C.BUFFER_CREATIONFLAG_WRITE=2,C.BUFFER_CREATIONFLAG_READWRITE=3,C.BUFFER_CREATIONFLAG_UNIFORM=4,C.BUFFER_CREATIONFLAG_VERTEX=8,C.BUFFER_CREATIONFLAG_INDEX=16,C.BUFFER_CREATIONFLAG_STORAGE=32,C.BUFFER_CREATIONFLAG_INDIRECT=64,C.RENDERPASS_MAIN=0,C.INPUT_ALT_KEY=18,C.INPUT_CTRL_KEY=17,C.INPUT_META_KEY1=91,C.INPUT_META_KEY2=92,C.INPUT_META_KEY3=93,C.INPUT_SHIFT_KEY=16,C.SNAPSHOTRENDERING_STANDARD=0,C.SNAPSHOTRENDERING_FAST=1,C.PERSPECTIVE_CAMERA=0,C.ORTHOGRAPHIC_CAMERA=1,C.FOVMODE_VERTICAL_FIXED=0,C.FOVMODE_HORIZONTAL_FIXED=1,C.RIG_MODE_NONE=0,C.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,C.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,C.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,C.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,C.RIG_MODE_STEREOSCOPIC_INTERLACED=14,C.RIG_MODE_VR=20,C.RIG_MODE_CUSTOM=22,C.MAX_SUPPORTED_UV_SETS=6,C.GL_ALPHA_EQUATION_ADD=32774,C.GL_ALPHA_EQUATION_MIN=32775,C.GL_ALPHA_EQUATION_MAX=32776,C.GL_ALPHA_EQUATION_SUBTRACT=32778,C.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,C.GL_ALPHA_FUNCTION_SRC=768,C.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,C.GL_ALPHA_FUNCTION_SRC_ALPHA=770,C.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,C.GL_ALPHA_FUNCTION_DST_ALPHA=772,C.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,C.GL_ALPHA_FUNCTION_DST_COLOR=774,C.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,C.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,C.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,C.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,C.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,C.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,C.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,C.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,C.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,C.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,C.SnippetUrl="https://snippet.babylonjs.com",C.FOGMODE_NONE=0,C.FOGMODE_EXP=1,C.FOGMODE_EXP2=2,C.FOGMODE_LINEAR=3,C.BYTE=5120,C.UNSIGNED_BYTE=5121,C.SHORT=5122,C.UNSIGNED_SHORT=5123,C.INT=5124,C.UNSIGNED_INT=5125,C.FLOAT=5126,C.PositionKind="position",C.NormalKind="XC",C.TangentKind="tangent",C.UVKind="uv",C.UV2Kind="uv2",C.UV3Kind="uv3",C.UV4Kind="uv4",C.UV5Kind="uv5",C.UV6Kind="uv6",C.ColorKind="color",C.ColorInstanceKind="instanceColor",C.MatricesIndicesKind="matricesIndices",C.MatricesWeightsKind="matricesWeights",C.MatricesIndicesExtraKind="matricesIndicesExtra",C.MatricesWeightsExtraKind="matricesWeightsExtra",C.ANIMATIONTYPE_FLOAT=0,C.ANIMATIONTYPE_VECTOR3=1,C.ANIMATIONTYPE_QUATERNION=2,C.ANIMATIONTYPE_MATRIX=3,C.ANIMATIONTYPE_COLOR3=4,C.ANIMATIONTYPE_COLOR4=7,C.ANIMATIONTYPE_VECTOR2=5,C.ANIMATIONTYPE_SIZE=6,C.ShadowMinZ=0,C.ShadowMaxZ=1e4},11428:(V,I,m)=>{m.d(I,{c:()=>H});var C=m(11161),l=m(11061),s=m(11433),F=m(11091);class k{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;this._enabled=!0,this._rollingFrameTime=new j(V)}sampleFrame(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F.d.Now;if(this._enabled){if(null!=this._lastFrameTimeMs){const I=V-this._lastFrameTimeMs;this._rollingFrameTime.add(I)}this._lastFrameTimeMs=V}}get averageFrameTime(){return this._rollingFrameTime.average}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFPS(){return 1e3/this._rollingFrameTime.average}get instantaneousFPS(){const V=this._rollingFrameTime.history(0);return 0===V?0:1e3/V}get isSaturated(){return this._rollingFrameTime.isSaturated()}enable(){this._enabled=!0}disable(){this._enabled=!1,this._lastFrameTimeMs=null}get isEnabled(){return this._enabled}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class j{constructor(V){this._samples=new Array(V),this.reset()}add(V){let I;if(this.isSaturated()){const V=this._samples[this._pos];I=V-this.average,this.average-=I/(this._sampleCount-1),this._m2-=I*(V-this.average)}else this._sampleCount++;I=V-this.average,this.average+=I/this._sampleCount,this._m2+=I*(V-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=V,this._pos++,this._pos%=this._samples.length}history(V){if(V>=this._sampleCount||V>=this._samples.length)return 0;const I=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(I-V)]}isSaturated(){return this._sampleCount>=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(V){const I=this._samples.length;return(V%I+I)%I}}var E=m(11444),K=m(11085),Y=m(11452),X=(m(11467),m(11193));function O(V,I,m,C){let l,s=1;1===C?l=new Float32Array(I*m*4):2===C?(l=new Uint16Array(I*m*4),s=15360):l=7===C?new Uint32Array(I*m*4):new Uint8Array(I*m*4);for(let F=0;F<I;F++)for(let C=0;C<m;C++){const m=3*(C*I+F),k=4*(C*I+F);l[k+0]=V[m+0],l[k+1]=V[m+1],l[k+2]=V[m+2],l[k+3]=s}return l}function v(V){return function(I,m,l,s,F,k,j,E){let K=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,Y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const X=V?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,O=V?10:11,v=new C.e(this,O);v.baseWidth=m,v.baseHeight=l,v.baseDepth=s,v.width=m,v.height=l,v.depth=s,v.format=F,v.type=Y,v.generateMipMaps=k,v.samplingMode=E,V?v.is3D=!0:v.is2DArray=!0,this._doNotHandleContextLost||(v._bufferView=I),V?this.updateRawTexture3D(v,I,F,j,K,Y):this.updateRawTexture2DArray(v,I,F,j,K,Y),this._bindTextureDirectly(X,v,!0);const N=this._getSamplingParameters(E,k);return this._gl.texParameteri(X,this._gl.TEXTURE_MAG_FILTER,N.mag),this._gl.texParameteri(X,this._gl.TEXTURE_MIN_FILTER,N.min),k&&this._gl.generateMipmap(X),this._bindTextureDirectly(X,null),this._internalTexturesCache.push(v),v}}function N(V){return function(I,m,C,l){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const k=V?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,j=this._getWebGLTextureType(F),E=this._getInternalFormat(C),K=this._getRGBABufferInternalSizedFormat(F,C);this._bindTextureDirectly(k,I,!0),this._unpackFlipY(void 0===l||!!l),this._doNotHandleContextLost||(I._bufferView=m,I.format=C,I.invertY=l,I._compression=s),I.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),s&&m?this._gl.compressedTexImage3D(k,0,this.getCaps().s3tc[s],I.width,I.height,I.depth,0,m):this._gl.texImage3D(k,0,K,I.width,I.height,I.depth,0,E,j,m),I.generateMipMaps&&this._gl.generateMipmap(k),this._bindTextureDirectly(k,null),I.isReady=!0}}s.ThinEngine.prototype.updateRawTexture=function(V,I,m,C){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,F=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!V)return;const k=this._getRGBABufferInternalSizedFormat(s,m,F),j=this._getInternalFormat(m),E=this._getWebGLTextureType(s);this._bindTextureDirectly(this._gl.TEXTURE_2D,V,!0),this._unpackFlipY(void 0===C||!!C),this._doNotHandleContextLost||(V._bufferView=I,V.format=m,V.type=s,V.invertY=C,V._compression=l),V.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),l&&I?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[l],V.width,V.height,0,I):this._gl.texImage2D(this._gl.TEXTURE_2D,0,k,V.width,V.height,0,j,E,I),V.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),V.isReady=!0},s.ThinEngine.prototype.createRawTexture=function(V,I,m,l,s,F,k){let j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,K=arguments.length>10&&void 0!==arguments[10]&&arguments[10];const Y=new C.e(this,3);Y.baseWidth=I,Y.baseHeight=m,Y.width=I,Y.height=m,Y.format=l,Y.generateMipMaps=s,Y.samplingMode=k,Y.invertY=F,Y._compression=j,Y.type=E,Y._useSRGBBuffer=this._getUseSRGBBuffer(K,!s),this._doNotHandleContextLost||(Y._bufferView=V),this.updateRawTexture(Y,V,l,F,j,E,Y._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,Y,!0);const X=this._getSamplingParameters(k,s);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,X.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,X.min),s&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(Y),Y},s.ThinEngine.prototype.createRawCubeTexture=function(V,I,m,l,s,F,k){let j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;const E=this._gl,Y=new C.e(this,8);Y.isCube=!0,Y.format=m,Y.type=l,this._doNotHandleContextLost||(Y._bufferViewArray=V);const O=this._getWebGLTextureType(l);let v=this._getInternalFormat(m);v===E.RGB&&(v=E.RGBA),O!==E.FLOAT||this._caps.textureFloatLinearFiltering?O!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?O!==E.FLOAT||this._caps.textureFloatRender?O!==E.HALF_FLOAT||this._caps.colorBufferFloat||(s=!1,K.d.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(s=!1,K.d.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(s=!1,k=1,K.d.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(s=!1,k=1,K.d.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));const N=I,t=N;Y.width=N,Y.height=t,Y.invertY=F,Y._compression=j;if(!this.needPOTTextures||(0,X.l)(Y.width)&&(0,X.l)(Y.height)||(s=!1),V)this.updateRawCubeTexture(Y,V,m,l,F,j);else{const V=this._getRGBABufferInternalSizedFormat(l),I=0;this._bindTextureDirectly(E.TEXTURE_CUBE_MAP,Y,!0);for(let m=0;m<6;m++)j?E.compressedTexImage2D(E.TEXTURE_CUBE_MAP_POSITIVE_X+m,I,this.getCaps().s3tc[j],Y.width,Y.height,0,void 0):E.texImage2D(E.TEXTURE_CUBE_MAP_POSITIVE_X+m,I,V,Y.width,Y.height,0,v,O,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,Y,!0),V&&s&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);const D=this._getSamplingParameters(k,s);return E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_MAG_FILTER,D.mag),E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_MIN_FILTER,D.min),E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_WRAP_S,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_WRAP_T,E.CLAMP_TO_EDGE),this._bindTextureDirectly(E.TEXTURE_CUBE_MAP,null),Y.generateMipMaps=s,Y.samplingMode=k,Y.isReady=!0,Y},s.ThinEngine.prototype.updateRawCubeTexture=function(V,I,m,C,l){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;V._bufferViewArray=I,V.format=m,V.type=C,V.invertY=l,V._compression=s;const k=this._gl,j=this._getWebGLTextureType(C);let E=this._getInternalFormat(m);const K=this._getRGBABufferInternalSizedFormat(C);let Y=!1;E===k.RGB&&(E=k.RGBA,Y=!0),this._bindTextureDirectly(k.TEXTURE_CUBE_MAP,V,!0),this._unpackFlipY(void 0===l||!!l),V.width%4!==0&&k.pixelStorei(k.UNPACK_ALIGNMENT,1);for(let X=0;X<6;X++){let m=I[X];s?k.compressedTexImage2D(k.TEXTURE_CUBE_MAP_POSITIVE_X+X,F,this.getCaps().s3tc[s],V.width,V.height,0,m):(Y&&(m=O(m,V.width,V.height,C)),k.texImage2D(k.TEXTURE_CUBE_MAP_POSITIVE_X+X,F,K,V.width,V.height,0,E,j,m))}(!this.needPOTTextures||(0,X.l)(V.width)&&(0,X.l)(V.height))&&V.generateMipMaps&&0===F&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),V.isReady=!0},s.ThinEngine.prototype.createRawCubeTextureFromUrl=function(V,I,m,C,l,s,F,k){let j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,E=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,K=arguments.length>10&&void 0!==arguments[10]?arguments[10]:3,Y=arguments.length>11&&void 0!==arguments[11]&&arguments[11];const X=this._gl,v=this.createRawCubeTexture(null,m,C,l,!s,Y,K,null);null===I||void 0===I||I.addPendingData(v),v.url=V,v.isReady=!1,this._internalTexturesCache.push(v);const N=V=>{if(!v._hardwareTexture)return;const m=v.width,s=F(V);if(s){if(k){const V=this._getWebGLTextureType(l);let I=this._getInternalFormat(C);const F=this._getRGBABufferInternalSizedFormat(l);let j=!1;I===X.RGB&&(I=X.RGBA,j=!0),this._bindTextureDirectly(X.TEXTURE_CUBE_MAP,v,!0),this._unpackFlipY(!1);const E=k(s);for(let C=0;C<E.length;C++){const s=m>>C;for(let m=0;m<6;m++){let k=E[C][m];j&&(k=O(k,s,s,l)),X.texImage2D(m,C,F,s,s,0,I,V,k)}}this._bindTextureDirectly(X.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(v,s,C,l,Y);v.isReady=!0,null===I||void 0===I||I.removePendingData(v),v.onLoadedObservable.notifyObservers(v),v.onLoadedObservable.clear(),j&&j()}};return this._loadFile(V,(V=>{N(V)}),void 0,null===I||void 0===I?void 0:I.offlineProvider,!0,((V,m)=>{null===I||void 0===I||I.removePendingData(v),E&&V&&E(V.status+" "+V.statusText,m)})),v},s.ThinEngine.prototype.createRawTexture2DArray=v(!1),s.ThinEngine.prototype.createRawTexture3D=v(!0),s.ThinEngine.prototype.updateRawTexture2DArray=N(!1),s.ThinEngine.prototype.updateRawTexture3D=N(!0);var t=m(11125);s.ThinEngine.prototype._readTexturePixelsSync=function(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],k=arguments.length>7&&void 0!==arguments[7]&&arguments[7],j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,E=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const K=this._gl;if(!K)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const V=K.createFramebuffer();if(!V)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=V}var Y,X;(K.bindFramebuffer(K.FRAMEBUFFER,this._dummyFramebuffer),C>-1)?K.framebufferTexture2D(K.FRAMEBUFFER,K.COLOR_ATTACHMENT0,K.TEXTURE_CUBE_MAP_POSITIVE_X+C,null===(Y=V._hardwareTexture)||void 0===Y?void 0:Y.underlyingResource,l):K.framebufferTexture2D(K.FRAMEBUFFER,K.COLOR_ATTACHMENT0,K.TEXTURE_2D,null===(X=V._hardwareTexture)||void 0===X?void 0:X.underlyingResource,l);let O=void 0!==V.type?this._getWebGLTextureType(V.type):K.UNSIGNED_BYTE;if(k)s||(s=(0,t.p)(V.type,4*I*m));else if(O===K.UNSIGNED_BYTE)s||(s=new Uint8Array(4*I*m)),O=K.UNSIGNED_BYTE;else s||(s=new Float32Array(4*I*m)),O=K.FLOAT;return F&&this.flushFramebuffer(),K.readPixels(j,E,I,m,K.RGBA,O,s),K.bindFramebuffer(K.FRAMEBUFFER,this._currentFramebuffer),s},s.ThinEngine.prototype._readTexturePixels=function(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],k=arguments.length>7&&void 0!==arguments[7]&&arguments[7],j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,E=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;return Promise.resolve(this._readTexturePixelsSync(V,I,m,C,l,s,F,k,j,E))};m(11469);s.ThinEngine.prototype._createDepthStencilCubeTexture=function(V,I){const m=new C.e(this,12);if(m.isCube=!0,1===this.webGLVersion)return K.d.Error("Depth cube texture is not supported by WebGL 1."),m;const l={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...I},s=this._gl;this._bindTextureDirectly(s.TEXTURE_CUBE_MAP,m,!0),this._setupDepthStencilTexture(m,V,l.bilinearFiltering,l.comparisonFunction);for(let C=0;C<6;C++)l.generateStencil?s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+C,0,s.DEPTH24_STENCIL8,V,V,0,s.DEPTH_STENCIL,s.UNSIGNED_INT_24_8,null):s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+C,0,s.DEPTH_COMPONENT24,V,V,0,s.DEPTH_COMPONENT,s.UNSIGNED_INT,null);return this._bindTextureDirectly(s.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(m),m},s.ThinEngine.prototype._setCubeMapTextureParams=function(V,I,m){const C=this._gl;C.texParameteri(C.TEXTURE_CUBE_MAP,C.TEXTURE_MAG_FILTER,C.LINEAR),C.texParameteri(C.TEXTURE_CUBE_MAP,C.TEXTURE_MIN_FILTER,I?C.LINEAR_MIPMAP_LINEAR:C.LINEAR),C.texParameteri(C.TEXTURE_CUBE_MAP,C.TEXTURE_WRAP_S,C.CLAMP_TO_EDGE),C.texParameteri(C.TEXTURE_CUBE_MAP,C.TEXTURE_WRAP_T,C.CLAMP_TO_EDGE),V.samplingMode=I?3:2,I&&this.getCaps().textureMaxLevel&&void 0!==m&&m>0&&(C.texParameteri(C.TEXTURE_CUBE_MAP,C.TEXTURE_MAX_LEVEL,m),V._maxLodLevel=m),this._bindTextureDirectly(C.TEXTURE_CUBE_MAP,null)},s.ThinEngine.prototype.createCubeTexture=function(V,I,m,C){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6?arguments[6]:void 0,k=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,j=arguments.length>8&&void 0!==arguments[8]&&arguments[8],E=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,Y=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,O=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,v=arguments.length>13&&void 0!==arguments[13]&&arguments[13],N=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null;const t=this._gl;return this.createCubeTextureBase(V,I,m,!!C,l,s,F,k,j,E,Y,O,(V=>this._bindTextureDirectly(t.TEXTURE_CUBE_MAP,V,!0)),((V,I)=>{const m=this.needPOTTextures?(0,X.h)(I[0].width,this._caps.maxCubemapTextureSize):I[0].width,s=m,k=[t.TEXTURE_CUBE_MAP_POSITIVE_X,t.TEXTURE_CUBE_MAP_POSITIVE_Y,t.TEXTURE_CUBE_MAP_POSITIVE_Z,t.TEXTURE_CUBE_MAP_NEGATIVE_X,t.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(t.TEXTURE_CUBE_MAP,V,!0),this._unpackFlipY(!1);const j=F?this._getInternalFormat(F,V._useSRGBBuffer):V._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:t.RGBA;let E=F?this._getInternalFormat(F):t.RGBA;V._useSRGBBuffer&&1===this.webGLVersion&&(E=j);for(let C=0;C<k.length;C++)if(I[C].width!==m||I[C].height!==s){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void K.d.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=m,this._workingCanvas.height=s,this._workingContext.drawImage(I[C],0,0,I[C].width,I[C].height,0,0,m,s),t.texImage2D(k[C],0,j,E,t.UNSIGNED_BYTE,this._workingCanvas)}else t.texImage2D(k[C],0,j,E,t.UNSIGNED_BYTE,I[C]);C||t.generateMipmap(t.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(V,!C),V.width=m,V.height=s,V.isReady=!0,F&&(V.format=F),V.onLoadedObservable.notifyObservers(V),V.onLoadedObservable.clear(),l&&l()}),!!v,N)},s.ThinEngine.prototype.generateMipMapsForCubemap=function(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(V.generateMipMaps){const m=this._gl;this._bindTextureDirectly(m.TEXTURE_CUBE_MAP,V,!0),m.generateMipmap(m.TEXTURE_CUBE_MAP),I&&this._bindTextureDirectly(m.TEXTURE_CUBE_MAP,null)}};m(11473);s.ThinEngine.prototype.setDepthStencilTexture=function(V,I,m,C){void 0!==V&&(I&&(this._boundUniforms[V]=I),m&&m.depthStencilTexture?this._setTexture(V,m,!1,!0,C):this._setTexture(V,null,void 0,void 0,C))},s.ThinEngine.prototype.createRenderTargetCubeTexture=function(V,I){const m=this._createHardwareRenderTargetWrapper(!1,!0,V),l={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...I};l.generateStencilBuffer=l.generateDepthBuffer&&l.generateStencilBuffer,(1!==l.type||this._caps.textureFloatLinearFiltering)&&(2!==l.type||this._caps.textureHalfFloatLinearFiltering)||(l.samplingMode=1);const s=this._gl,F=new C.e(this,5);this._bindTextureDirectly(s.TEXTURE_CUBE_MAP,F,!0);const k=this._getSamplingParameters(l.samplingMode,l.generateMipMaps);1!==l.type||this._caps.textureFloat||(l.type=0,K.d.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,k.mag),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,k.min),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE);for(let C=0;C<6;C++)s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+C,0,this._getRGBABufferInternalSizedFormat(l.type,l.format),V,V,0,this._getInternalFormat(l.format),this._getWebGLTextureType(l.type),null);const j=s.createFramebuffer();return this._bindUnboundFramebuffer(j),m._depthStencilBuffer=this._setupFramebufferDepthAttachments(l.generateStencilBuffer,l.generateDepthBuffer,V,V),l.generateMipMaps&&s.generateMipmap(s.TEXTURE_CUBE_MAP),this._bindTextureDirectly(s.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),m._framebuffer=j,m._generateDepthBuffer=l.generateDepthBuffer,m._generateStencilBuffer=l.generateStencilBuffer,F.width=V,F.height=V,F.isReady=!0,F.isCube=!0,F.samples=1,F.generateMipMaps=l.generateMipMaps,F.samplingMode=l.samplingMode,F.type=l.type,F.format=l.format,this._internalTexturesCache.push(F),m.setTextures(F),m};var D=m(11488),b=m(11507);s.ThinEngine.prototype.createPrefilteredCubeTexture=function(V,I,l,s){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,j=arguments.length>6?arguments[6]:void 0,E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Y=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];return this.createCubeTexture(V,I,null,!1,(async V=>{if(!V)return void(F&&F(null));const k=V.texture;if(Y?V.info.sphericalPolynomial&&(k._sphericalPolynomial=V.info.sphericalPolynomial):k._sphericalPolynomial=new D.c,k._source=9,this.getCaps().textureLOD)return void(F&&F(k));const j=this._gl,E=V.width;if(!E)return;const{DDSTools:X}=await m.e(26).then(m.bind(m,13655)),O=[];for(let m=0;m<3;m++){const F=1-m/2,Y=s,v=Math.log2(E)*l+s,N=Y+(v-Y)*F,t=Math.round(Math.min(Math.max(N,0),v)),D=new C.e(this,2);if(D.type=k.type,D.format=k.format,D.width=Math.pow(2,Math.max(Math.log2(E)-t,0)),D.height=D.width,D.isCube=!0,D._cachedWrapU=0,D._cachedWrapV=0,this._bindTextureDirectly(j.TEXTURE_CUBE_MAP,D,!0),D.samplingMode=2,j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MAG_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),V.isDDS){const I=V.info,m=V.data;this._unpackFlipY(I.isCompressed),X.UploadDDSLevels(this,D,m,I,!0,6,t)}else K.d.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(j.TEXTURE_CUBE_MAP,null);const T=new b.b(I);T._isCube=!0,T._texture=D,D.isReady=!0,O.push(T)}k._lodTextureHigh=O[2],k._lodTextureMid=O[1],k._lodTextureLow=O[0],F&&F(k)}),k,j,E,Y,l,s)},s.ThinEngine.prototype.createUniformBuffer=function(V,I){const m=this._gl.createBuffer();if(!m)throw new Error("Unable to create uniform buffer");const C=new E.b(m);return this.bindUniformBuffer(C),V instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,V,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(V),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),C.references=1,C},s.ThinEngine.prototype.createDynamicUniformBuffer=function(V,I){const m=this._gl.createBuffer();if(!m)throw new Error("Unable to create dynamic uniform buffer");const C=new E.b(m);return this.bindUniformBuffer(C),V instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,V,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(V),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),C.references=1,C},s.ThinEngine.prototype.updateUniformBuffer=function(V,I,m,C){this.bindUniformBuffer(V),void 0===m&&(m=0),void 0===C?I instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,m,I):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,m,new Float32Array(I)):I instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,I.subarray(m,m+C)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(I).subarray(m,m+C)),this.bindUniformBuffer(null)},s.ThinEngine.prototype.bindUniformBuffer=function(V){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,V?V.underlyingResource:null)},s.ThinEngine.prototype.bindUniformBufferBase=function(V,I,m){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,I,V?V.underlyingResource:null)},s.ThinEngine.prototype.bindUniformBlock=function(V,I,m){const C=V.program,l=this._gl.getUniformBlockIndex(C,I);4294967295!==l&&this._gl.uniformBlockBinding(C,l,m)};var T=m(11081),n=m(11136);n.b.prototype.displayLoadingUI=function(){if(!(0,T.o)())return;const V=this.loadingScreen;V&&V.displayLoadingUI()},n.b.prototype.hideLoadingUI=function(){if(!(0,T.o)())return;const V=this._loadingScreen;V&&V.hideLoadingUI()},Object.defineProperty(n.b.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=n.b.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(V){this._loadingScreen=V},enumerable:!0,configurable:!0}),Object.defineProperty(n.b.prototype,"loadingUIText",{set:function(V){this.loadingScreen.loadingUIText=V},enumerable:!0,configurable:!0}),Object.defineProperty(n.b.prototype,"loadingUIBackgroundColor",{set:function(V){this.loadingScreen.loadingUIBackgroundColor=V},enumerable:!0,configurable:!0}),n.b.prototype.getInputElement=function(){return this._renderingCanvas},n.b.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},n.b.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},n.b.prototype.getAspectRatio=function(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const m=V.viewport;return this.getRenderWidth(I)*m.width/(this.getRenderHeight(I)*m.height)},n.b.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},n.b.prototype._verifyPointerLock=function(){var V;null===(V=this._onPointerLockChange)||void 0===V||V.call(this)},n.b.prototype.setAlphaEquation=function(V){if(this._alphaEquation!==V){switch(V){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=V}},n.b.prototype.getInputElement=function(){return this._renderingCanvas},n.b.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},n.b.prototype.setDepthFunction=function(V){this._depthCullingState.depthFunc=V},n.b.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},n.b.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},n.b.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},n.b.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},n.b.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},n.b.prototype.setDepthWrite=function(V){this._depthCullingState.depthMask=V},n.b.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},n.b.prototype.setStencilBuffer=function(V){this._stencilState.stencilTest=V},n.b.prototype.getStencilMask=function(){return this._stencilState.stencilMask},n.b.prototype.setStencilMask=function(V){this._stencilState.stencilMask=V},n.b.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},n.b.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},n.b.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},n.b.prototype.setStencilFunction=function(V){this._stencilState.stencilFunc=V},n.b.prototype.setStencilFunctionReference=function(V){this._stencilState.stencilFuncRef=V},n.b.prototype.setStencilFunctionMask=function(V){this._stencilState.stencilFuncMask=V},n.b.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},n.b.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},n.b.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},n.b.prototype.setStencilOperationFail=function(V){this._stencilState.stencilOpStencilFail=V},n.b.prototype.setStencilOperationDepthFail=function(V){this._stencilState.stencilOpDepthFail=V},n.b.prototype.setStencilOperationPass=function(V){this._stencilState.stencilOpStencilDepthPass=V},n.b.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},n.b.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},n.b.prototype.setAlphaConstants=function(V,I,m,C){this._alphaState.setAlphaBlendConstants(V,I,m,C)},n.b.prototype.getAlphaMode=function(){return this._alphaMode},n.b.prototype.getAlphaEquation=function(){return this._alphaEquation},n.b.prototype.getRenderPassNames=function(){return this._renderPassNames},n.b.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},n.b.prototype.createRenderPassId=function(V){const I=++n.b._RenderPassIdCounter;return this._renderPassNames[I]=V??"NONAME",I},n.b.prototype.releaseRenderPassId=function(V){this._renderPassNames[V]=void 0;for(let I=0;I<this.scenes.length;++I){const m=this.scenes[I];for(let I=0;I<m.meshes.length;++I){const C=m.meshes[I];if(C.kk)for(let I=0;I<C.kk.length;++I){C.kk[I]._removeDrawWrapper(V)}}}};m(11485);function x(V){if(V.requestPointerLock){const I=V.requestPointerLock();I instanceof Promise?I.then((()=>{V.focus()})).catch((()=>{})):V.focus()}}var S=m(11510),c=m(11129);class H extends s.ThinEngine{static get NpmPackage(){return n.b.NpmPackage}static get Version(){return n.b.Version}static get Instances(){return l.c.Instances}static get LastCreatedEngine(){return l.c.LastCreatedEngine}static get LastCreatedScene(){return l.c.LastCreatedScene}static DefaultLoadingScreenFactory(V){return n.b.DefaultLoadingScreenFactory(V)}get _supportsHardwareTextureRescaling(){return!!H._RescalePostProcessFactory}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}get performanceMonitor(){return this._performanceMonitor}constructor(V,I,m){super(V,I,m,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this.customAnimationFrameRequester=null,this._performanceMonitor=new k,this._drawCalls=new S.e,V&&(this._features.supportRenderPasses=!0,m=this._creationOptions)}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_sharedInit(V){super._sharedInit(V),function(V,I,m){V._onCanvasFocus=()=>{V.onCanvasFocusObservable.notifyObservers(V)},V._onCanvasBlur=()=>{V.onCanvasBlurObservable.notifyObservers(V)},V._onCanvasContextMenu=I=>{V.disableContextMenu&&I.preventDefault()},I.addEventListener("focus",V._onCanvasFocus),I.addEventListener("blur",V._onCanvasBlur),I.addEventListener("contextmenu",V._onCanvasContextMenu),V._onBlur=()=>{V.disablePerformanceMonitorInBackground&&V.performanceMonitor.disable(),V._windowIsBackground=!0},V._onFocus=()=>{V.disablePerformanceMonitorInBackground&&V.performanceMonitor.enable(),V._windowIsBackground=!1},V._onCanvasPointerOut=m=>{document.elementFromPoint(m.clientX,m.clientY)!==I&&V.onCanvasPointerOutObservable.notifyObservers(m)};const C=V.getHostWindow();C&&"function"===typeof C.addEventListener&&(C.addEventListener("blur",V._onBlur),C.addEventListener("focus",V._onFocus)),I.addEventListener("pointerout",V._onCanvasPointerOut),m.doNotHandleTouchAction||function(V){V&&V.setAttribute&&(V.setAttribute("touch-action","none"),V.style.touchAction="none",V.style.webkitTapHighlightColor="transparent")}(I),!n.b.audioEngine&&m.audioEngine&&n.b.AudioEngineFactory&&(n.b.audioEngine=n.b.AudioEngineFactory(V.getRenderingCanvas(),V.getAudioContext(),V.getAudioDestination())),(0,T.i)()&&(V._onFullscreenChange=()=>{V.isFullscreen=!!document.fullscreenElement,V.isFullscreen&&V._pointerLockRequested&&I&&x(I)},document.addEventListener("fullscreenchange",V._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",V._onFullscreenChange,!1),V._onPointerLockChange=()=>{V.isPointerLock=document.pointerLockElement===I},document.addEventListener("pointerlockchange",V._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",V._onPointerLockChange,!1)),V.enableOfflineSupport=void 0!==n.b.OfflineProviderFactory,V._deterministicLockstep=!!m.deterministicLockstep,V._lockstepMaxSteps=m.lockstepMaxSteps||0,V._timeStep=m.timeStep||1/60}(this,V,this._creationOptions)}resizeImageBitmap(V,I,m){return function(V,I,m,C){const l=V.createCanvas(m,C).getContext("2d");if(!l)throw new Error("Unable to get 2d context for resizeImageBitmap");return l.drawImage(I,0,0),l.getImageData(0,0,m,C).data}(this,V,I,m)}async _createImageBitmapFromSource(V,I){return await async function(V,I,m){return await new Promise(((C,l)=>{const s=new Image;s.onload=()=>{s.decode().then((()=>{V.createImageBitmap(s,m).then((V=>{C(V)}))}))},s.onerror=()=>{l(`Error loading image ${s.src}`)},s.src=I}))}(this,V,I)}switchFullscreen(V){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(V)}enterFullscreen(V){this.isFullscreen||(this._pointerLockRequested=V,this._renderingCanvas&&function(V){const I=V.requestFullscreen||V.webkitRequestFullscreen;I&&I.call(V)}(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&function(){const V=document;document.exitFullscreen?document.exitFullscreen():V.webkitCancelFullScreen&&V.webkitCancelFullScreen()}()}setDitheringState(V){V?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(V){V?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}setDirectViewport(V,I,m,C){const l=this._cachedViewport;return this._cachedViewport=null,this._viewport(V,I,m,C),l}scissorClear(V,I,m,C,l){this.enableScissor(V,I,m,C),this.clear(l,!0,!0,!0),this.disableScissor()}enableScissor(V,I,m,C){const l=this._gl;l.enable(l.SCISSOR_TEST),l.scissor(V,I,m,C)}disableScissor(){const V=this._gl;V.disable(V.SCISSOR_TEST)}async _loadFileAsync(V,I,m){return await new Promise(((C,l)=>{this._loadFile(V,(V=>{C(V)}),void 0,I,m,((V,I)=>{l(I)}))}))}getVertexShaderSource(V){const I=this._gl.getAttachedShaders(V);return I?this._gl.getShaderSource(I[0]):null}getFragmentShaderSource(V){const I=this._gl.getAttachedShaders(V);return I?this._gl.getShaderSource(I[1]):null}set framebufferDimensionsObject(V){this._framebufferDimensionsObject=V,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}_rebuildBuffers(){for(const V of this.scenes)V.resetCachedMaterial(),V._rebuildGeometries();for(const V of this._virtualScenes)V.resetCachedMaterial(),V._rebuildGeometries();super._rebuildBuffers()}getFontOffset(V){return function(V){const I=document.createElement("span");I.textContent="Hg",I.style.font=V;const m=document.createElement("div");m.style.display="inline-block",m.style.width="1px",m.style.height="0px",m.style.verticalAlign="bottom";const C=document.createElement("div");C.style.whiteSpace="nowrap",C.appendChild(I),C.appendChild(m),document.body.appendChild(C);let l=0,s=0;try{s=m.getBoundingClientRect().top-I.getBoundingClientRect().top,m.style.verticalAlign="baseline",l=m.getBoundingClientRect().top-I.getBoundingClientRect().top}finally{document.body.removeChild(C)}return{ascent:l,height:s,descent:s-l}}(V)}_cancelFrame(){if(this.customAnimationFrameRequester){if(0!==this._frameHandler){this._frameHandler=0;const{cancelAnimationFrame:V}=this.customAnimationFrameRequester;V&&V(this.customAnimationFrameRequester.Y)}}else super._cancelFrame()}_renderLoop(V){this._processFrame(V),this._activeRenderLoops.length>0&&0===this._frameHandler&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.Y=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.Y):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}enterPointerlock(){this._renderingCanvas&&x(this._renderingCanvas)}exitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}DY(){this._measureFps(),super.DY()}_deletePipelineContext(V){const I=V;I&&I.program&&I.transformFeedback&&(this.deleteTransformFeedback(I.transformFeedback),I.transformFeedback=null),super._deletePipelineContext(V)}createShaderProgram(V,I,m,C,l){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;l=l||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const F=super.createShaderProgram(V,I,m,C,l,s);return this.onAfterShaderCompilationObservable.notifyObservers(this),F}_createShaderProgram(V,I,m,C){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const s=C.createProgram();if(V.program=s,!s)throw new Error("Unable to create program");if(C.attachShader(s,I),C.attachShader(s,m),this.webGLVersion>1&&l){const I=this.createTransformFeedback();this.bindTransformFeedback(I),this.setTranformFeedbackVaryings(s,l),V.transformFeedback=I}return C.linkProgram(s),this.webGLVersion>1&&l&&this.bindTransformFeedback(null),V.context=C,V.vertexShader=I,V.fragmentShader=m,V.isParallelCompiled||this._finalizePipelineContext(V),s}_releaseTexture(V){super._releaseTexture(V)}_releaseRenderTargetWrapper(V){super._releaseRenderTargetWrapper(V);for(const I of this.scenes){for(const m of I.postProcesses)m._outputTexture===V&&(m._outputTexture=null);for(const m of I.cameras)for(const I of m._postProcesses)I&&I._outputTexture===V&&(I._outputTexture=null)}}_rescaleTexture(V,I,m,C,l){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const s=this.createRenderTargetTexture({width:I.width,height:I.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});if(!this._rescalePostProcess&&H._RescalePostProcessFactory&&(this._rescalePostProcess=H._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;const F=()=>{this._rescalePostProcess.onApply=function(I){I._bindTexture("textureSampler",V)};let F=m;F||(F=this.scenes[this.scenes.length-1]),F.postProcessManager.directRender([this._rescalePostProcess],s,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,I,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,C,0,0,I.width,I.height,0),this.unBindFramebuffer(s),s.dispose(),l&&l()},k=this._rescalePostProcess.getEffect();k?k.executeWhenCompiled(F):this._rescalePostProcess.onEffectCreatedObservable.addOnce((V=>{V.executeWhenCompiled(F)}))}}wrapWebGLTexture(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const F=new Y.b(V,this._gl),k=new C.e(this,0,!0);return k._hardwareTexture=F,k.baseWidth=l,k.baseHeight=s,k.width=l,k.height=s,k.isReady=!0,k.useMipMaps=I,this.updateTextureSamplingMode(m,k),k}_uploadImageToTexture(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const l=this._gl,s=this._getWebGLTextureType(V.type),F=this._getInternalFormat(V.format),k=this._getRGBABufferInternalSizedFormat(V.type,F),j=V.isCube?l.TEXTURE_CUBE_MAP:l.TEXTURE_2D;this._bindTextureDirectly(j,V,!0),this._unpackFlipY(V.invertY);let E=l.TEXTURE_2D;V.isCube&&(E=l.TEXTURE_CUBE_MAP_POSITIVE_X+m),l.texImage2D(E,C,k,F,s,I),this._bindTextureDirectly(j,null,!0)}updateTextureComparisonFunction(V,I){if(1===this.webGLVersion)return void K.d.Error("WebGL 1 does not support texture comparison.");const m=this._gl;V.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,V,!0),0===I?(m.texParameteri(m.TEXTURE_CUBE_MAP,m.TEXTURE_COMPARE_FUNC,515),m.texParameteri(m.TEXTURE_CUBE_MAP,m.TEXTURE_COMPARE_MODE,m.NONE)):(m.texParameteri(m.TEXTURE_CUBE_MAP,m.TEXTURE_COMPARE_FUNC,I),m.texParameteri(m.TEXTURE_CUBE_MAP,m.TEXTURE_COMPARE_MODE,m.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,V,!0),0===I?(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_COMPARE_FUNC,515),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_COMPARE_MODE,m.NONE)):(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_COMPARE_FUNC,I),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_COMPARE_MODE,m.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),V._comparisonFunction=I}createInstancesBuffer(V){const I=this._gl.createBuffer();if(!I)throw new Error("Unable to create instance buffer");const m=new E.b(I);return m.xF=V,this.bindArrayBuffer(m),this._gl.bufferData(this._gl.ARRAY_BUFFER,V,this._gl.DYNAMIC_DRAW),m.references=1,m}deleteInstancesBuffer(V){this._gl.deleteBuffer(V)}async _clientWaitAsync(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;const C=this._gl;return await new Promise(((l,s)=>{(0,c.i)((()=>{const m=C.clientWaitSync(V,I,0);if(m==C.WAIT_FAILED)throw new Error("clientWaitSync failed");return m!=C.TIMEOUT_EXPIRED}),l,s,m)}))}_readPixelsAsync(V,I,m,C,l,s,F){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const k=this._gl,j=k.createBuffer();k.bindBuffer(k.PIXEL_PACK_BUFFER,j),k.bufferData(k.PIXEL_PACK_BUFFER,F.byteLength,k.STREAM_READ),k.readPixels(V,I,m,C,l,s,0),k.bindBuffer(k.PIXEL_PACK_BUFFER,null);const E=k.fenceSync(k.SYNC_GPU_COMMANDS_COMPLETE,0);return E?(k.flush(),this._clientWaitAsync(E,0,10).then((()=>(k.deleteSync(E),k.bindBuffer(k.PIXEL_PACK_BUFFER,j),k.getBufferSubData(k.PIXEL_PACK_BUFFER,0,F),k.bindBuffer(k.PIXEL_PACK_BUFFER,null),k.deleteBuffer(j),F)))):null}dispose(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),function(V,I){1===l.c.Instances.length&&n.b.audioEngine&&(n.b.audioEngine.dispose(),n.b.audioEngine=null);const m=V.getHostWindow();m&&"function"===typeof m.removeEventListener&&(m.removeEventListener("blur",V._onBlur),m.removeEventListener("focus",V._onFocus)),I&&(I.removeEventListener("focus",V._onCanvasFocus),I.removeEventListener("blur",V._onCanvasBlur),I.removeEventListener("pointerout",V._onCanvasPointerOut),I.removeEventListener("contextmenu",V._onCanvasContextMenu)),(0,T.i)()&&(document.removeEventListener("fullscreenchange",V._onFullscreenChange),document.removeEventListener("mozfullscreenchange",V._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",V._onFullscreenChange),document.removeEventListener("msfullscreenchange",V._onFullscreenChange),document.removeEventListener("pointerlockchange",V._onPointerLockChange),document.removeEventListener("mspointerlockchange",V._onPointerLockChange),document.removeEventListener("mozpointerlockchange",V._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",V._onPointerLockChange))}(this,this._renderingCanvas),super.dispose()}}H.ALPHA_DISABLE=0,H.ALPHA_ADD=1,H.ALPHA_COMBINE=2,H.ALPHA_SUBTRACT=3,H.ALPHA_MULTIPLY=4,H.ALPHA_MAXIMIZED=5,H.ALPHA_ONEONE=6,H.ALPHA_PREMULTIPLIED=7,H.ALPHA_PREMULTIPLIED_PORTERDUFF=8,H.ALPHA_INTERPOLATE=9,H.ALPHA_SCREENMODE=10,H.DELAYLOADSTATE_NONE=0,H.DELAYLOADSTATE_LOADED=1,H.DELAYLOADSTATE_LOADING=2,H.DELAYLOADSTATE_NOTLOADED=4,H.NEVER=512,H.ALWAYS=519,H.LESS=513,H.EQUAL=514,H.LEQUAL=515,H.GREATER=516,H.GEQUAL=518,H.NOTEQUAL=517,H.KEEP=7680,H.REPLACE=7681,H.INCR=7682,H.DECR=7683,H.INVERT=5386,H.INCR_WRAP=34055,H.DECR_WRAP=34056,H.TEXTURE_CLAMP_ADDRESSMODE=0,H.TEXTURE_WRAP_ADDRESSMODE=1,H.TEXTURE_MIRROR_ADDRESSMODE=2,H.TEXTUREFORMAT_ALPHA=0,H.TEXTUREFORMAT_LUMINANCE=1,H.TEXTUREFORMAT_LUMINANCE_ALPHA=2,H.TEXTUREFORMAT_RGB=4,H.TEXTUREFORMAT_RGBA=5,H.TEXTUREFORMAT_RED=6,H.TEXTUREFORMAT_R=6,H.TEXTUREFORMAT_R16_UNORM=33322,H.TEXTUREFORMAT_RG16_UNORM=33324,H.TEXTUREFORMAT_RGB16_UNORM=32852,H.TEXTUREFORMAT_RGBA16_UNORM=32859,H.TEXTUREFORMAT_R16_SNORM=36760,H.TEXTUREFORMAT_RG16_SNORM=36761,H.TEXTUREFORMAT_RGB16_SNORM=36762,H.TEXTUREFORMAT_RGBA16_SNORM=36763,H.TEXTUREFORMAT_RG=7,H.TEXTUREFORMAT_RED_INTEGER=8,H.TEXTUREFORMAT_R_INTEGER=8,H.TEXTUREFORMAT_RG_INTEGER=9,H.TEXTUREFORMAT_RGB_INTEGER=10,H.TEXTUREFORMAT_RGBA_INTEGER=11,H.TEXTURETYPE_UNSIGNED_BYTE=0,H.TEXTURETYPE_UNSIGNED_INT=0,H.TEXTURETYPE_FLOAT=1,H.TEXTURETYPE_HALF_FLOAT=2,H.TEXTURETYPE_BYTE=3,H.TEXTURETYPE_SHORT=4,H.TEXTURETYPE_UNSIGNED_SHORT=5,H.TEXTURETYPE_INT=6,H.TEXTURETYPE_UNSIGNED_INTEGER=7,H.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,H.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,H.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,H.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,H.TEXTURETYPE_UNSIGNED_INT_24_8=12,H.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,H.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,H.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,H.TEXTURE_NEAREST_SAMPLINGMODE=1,H.TEXTURE_BILINEAR_SAMPLINGMODE=2,H.TEXTURE_TRILINEAR_SAMPLINGMODE=3,H.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,H.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,H.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,H.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,H.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,H.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,H.TEXTURE_NEAREST_LINEAR=7,H.TEXTURE_NEAREST_NEAREST=1,H.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,H.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,H.TEXTURE_LINEAR_LINEAR=2,H.TEXTURE_LINEAR_NEAREST=12,H.TEXTURE_EXPLICIT_MODE=0,H.TEXTURE_SPHERICAL_MODE=1,H.TEXTURE_PLANAR_MODE=2,H.TEXTURE_CUBIC_MODE=3,H.TEXTURE_PROJECTION_MODE=4,H.TEXTURE_SKYBOX_MODE=5,H.TEXTURE_INVCUBIC_MODE=6,H.TEXTURE_EQUIRECTANGULAR_MODE=7,H.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,H.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,H.SCALEMODE_FLOOR=1,H.SCALEMODE_NEAREST=2,H.SCALEMODE_CEILING=3},11061:(V,I,m)=>{m.d(I,{c:()=>l});var C=m(11067);class l{static get LastCreatedEngine(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}static get LastCreatedScene(){return this._LastCreatedScene}}l.Instances=[],l.OnEnginesDisposedObservable=new C.e,l._LastCreatedScene=null,l.UseFallbackTexture=!0,l.FallbackTexture=""},11055:(V,I,m)=>{m.d(I,{d:()=>C});class C{static SetMatrixPrecision(V){if(C.MatrixTrackPrecisionChange=!1,V&&!C.MatrixUse64Bits&&C.MatrixTrackedMatrices)for(let I=0;I<C.MatrixTrackedMatrices.length;++I){const V=C.MatrixTrackedMatrices[I],m=V.aY;V.aY=new Array(16);for(let I=0;I<16;++I)V.aY[I]=m[I]}C.MatrixUse64Bits=V,C.MatrixCurrentType=C.MatrixUse64Bits?Array:Float32Array,C.MatrixTrackedMatrices=null}}C.MatrixUse64Bits=!1,C.MatrixTrackPrecisionChange=!0,C.MatrixCurrentType=Float32Array,C.MatrixTrackedMatrices=[]},11482:(V,I,m)=>{m.d(I,{c:()=>l});var C=m(11458);class l{get depthStencilTexture(){return this._depthStencilTexture}setDepthStencilTexture(V){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this._depthStencilTexture&&this._depthStencilTexture.dispose(),this._depthStencilTexture=V,this._generateDepthBuffer=this._generateStencilBuffer=this._depthStencilTextureWithStencil=!1,V&&(this._generateDepthBuffer=!0,this._generateStencilBuffer=this._depthStencilTextureWithStencil=(0,C.c)(V.format))}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}get isCube(){return this._isCube}get isMulti(){return this._isMulti}get is2DArray(){return this.layers>0}get is3D(){return this.depth>0}get size(){return this.width}get width(){return this._size.width??this._size}get height(){return this._size.height??this._size}get layers(){return this._size.layers||0}get depth(){return this._size.depth||0}get texture(){var V;return(null===(V=this._textures)||void 0===V?void 0:V[0])??null}get textures(){return this._textures}get faceIndices(){return this._faceIndices}get layerIndices(){return this._layerIndices}getBaseArrayLayer(V){var I,m;if(!this._textures)return-1;const C=this._textures[V],l=(null===(I=this._layerIndices)||void 0===I?void 0:I[V])??0,s=(null===(m=this._faceIndices)||void 0===m?void 0:m[V])??0;return C.isCube?6*l+s:C.is3D?0:l}get samples(){return this._samples}setSamples(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.samples===V&&!m)return V;const C=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,V,I):this._engine.updateRenderTargetTextureSampleCount(this,V);return this._samples=V,C}resolveMSAATextures(){this.isMulti?this._engine.resolveMultiFramebuffer(this):this._engine.resolveFramebuffer(this)}generateMipMaps(){this._engine._currentRenderTarget===this&&this._engine.unBindFramebuffer(this,!0),this.isMulti?this._engine.generateMipMapsMultiFramebuffer(this):this._engine.generateMipMapsFramebuffer(this)}constructor(V,I,m,C,l){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this.disableAutomaticMSAAResolve=!1,this.resolveMSAAColors=!0,this.resolveMSAADepth=!1,this.resolveMSAAStencil=!1,this._isMulti=V,this._isCube=I,this._size=m,this._engine=C,this._depthStencilTexture=null,this.label=l}setTextures(V){Array.isArray(V)?this._textures=V:this._textures=V?[V]:null}setTexture(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._textures||(this._textures=[]),this._textures[I]!==V&&(this._textures[I]&&m&&this._textures[I].dispose(),this._textures[I]=V)}setLayerAndFaceIndices(V,I){this._layerIndices=V,this._faceIndices=I}setLayerAndFaceIndex(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1?arguments[1]:void 0,m=arguments.length>2?arguments[2]:void 0;this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),void 0!==I&&I>=0&&(this._layerIndices[V]=I),void 0!==m&&m>=0&&(this._faceIndices[V]=m)}createDepthStencilTexture(){var V;let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,m=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,F=arguments.length>5?arguments[5]:void 0;return null===(V=this._depthStencilTexture)||void 0===V||V.dispose(),this._depthStencilTextureWithStencil=C,this._depthStencilTextureLabel=F,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:m,comparisonFunction:I,generateStencil:C,isCube:this._isCube,samples:l,depthTextureFormat:s,label:F},this),this._depthStencilTexture}_shareDepth(V){this.shareDepth(V)}shareDepth(V){this._depthStencilTexture&&(V._depthStencilTexture&&V._depthStencilTexture.dispose(),V._depthStencilTexture=this._depthStencilTexture,V._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}_swapAndDie(V){this.texture&&this.texture._swapAndDie(V),this._textures=null,this.dispose(!0)}_cloneRenderTargetWrapper(){let V=null;if(this._isMulti){const I=this.textures;if(I&&I.length>0){let m=!1,C=I.length,l=-1;const s=I[I.length-1]._source;14!==s&&12!==s||(m=!0,l=I[I.length-1].format,C--);const F=[],k=[],j=[],E=[],K=[],Y=[],X=[],O={};for(let V=0;V<C;++V){const m=I[V];F.push(m.samplingMode),k.push(m.type),j.push(m.format);void 0!==O[m.uniqueId]?(E.push(-1),X.push(0)):(O[m.uniqueId]=V,m.is2DArray?(E.push(35866),X.push(m.depth)):m.isCube?(E.push(34067),X.push(0)):m.is3D?(E.push(32879),X.push(m.depth)):(E.push(3553),X.push(0))),this._faceIndices&&K.push(this._faceIndices[V]??0),this._layerIndices&&Y.push(this._layerIndices[V]??0)}const v={samplingModes:F,generateMipMaps:I[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:m,depthTextureFormat:l,types:k,formats:j,textureCount:C,targetTypes:E,faceIndex:K,layerIndex:Y,layerCounts:X,label:this.label},N={width:this.width,height:this.height,depth:this.depth};V=this._engine.createMultipleRenderTarget(N,v);for(let t=0;t<C;++t){if(-1!==E[t])continue;const m=O[I[t].uniqueId];V.setTexture(V.textures[m],t)}}}else{var I,m,C,l;const F={};if(F.generateDepthBuffer=this._generateDepthBuffer,F.generateMipMaps=(null===(I=this.texture)||void 0===I?void 0:I.generateMipMaps)??!1,F.generateStencilBuffer=this._generateStencilBuffer,F.samplingMode=null===(m=this.texture)||void 0===m?void 0:m.samplingMode,F.type=null===(C=this.texture)||void 0===C?void 0:C.type,F.format=null===(l=this.texture)||void 0===l?void 0:l.format,F.noColorAttachment=!this._textures,F.label=this.label,this.isCube)V=this._engine.createRenderTargetCubeTexture(this.width,F);else{var s;const I={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?null===(s=this.texture)||void 0===s?void 0:s.depth:void 0};V=this._engine.createRenderTargetTexture(I,F)}V.texture&&(V.texture.isReady=!0)}return V}_swapRenderTargetWrapper(V){if(this._textures&&V._textures)for(let I=0;I<this._textures.length;++I)this._textures[I]._swapAndDie(V._textures[I],!1),V._textures[I].isReady=!0;this._depthStencilTexture&&V._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(V._depthStencilTexture),V._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}_rebuild(){const V=this._cloneRenderTargetWrapper();if(V){if(this._depthStencilTexture){const I=this._depthStencilTexture.samplingMode,m=this._depthStencilTexture.format,C=2===I||3===I||11===I;V.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,C,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,m,this._depthStencilTextureLabel)}this.samples>1&&V.setSamples(this.samples),V._swapRenderTargetWrapper(this),V.dispose()}}releaseTextures(){if(this._textures)for(let V=0;V<this._textures.length;++V)this._textures[V].dispose();this._textures=null}dispose(){var V;arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(null===(V=this._depthStencilTexture)||void 0===V||V.dispose(),this._depthStencilTexture=null,this.releaseTextures());this._engine._releaseRenderTargetWrapper(this)}}},11150:(V,I,m)=>{m.d(I,{e:()=>C});class C{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?C.ShadersRepository:C.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?C.ShadersStore:C.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?C.IncludesShadersStore:C.IncludesShadersStoreWGSL}}C.ShadersRepository="src/Shaders/",C.ShadersStore={},C.IncludesShadersStore={},C.ShadersRepositoryWGSL="src/ShadersWGSL/",C.ShadersStoreWGSL={},C.IncludesShadersStoreWGSL={}},11156:(V,I,m)=>{m.d(I,{e:()=>X,i:()=>T,k:()=>v,l:()=>O,m:()=>N,p:()=>b,q:()=>Y,t:()=>E,v:()=>K,y:()=>j,A:()=>k});class C{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.rF._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(V){V&&this.program&&V(this.program)}setEngine(V){this.rF=V}_fillEffectInformation(V,I,m,C,l,s,F,k){const j=this.rF;if(j.supportsUniformBuffers)for(const K in I)V.bindUniformBlock(K,I[K]);let E;for(this.rF.getUniforms(this,m).forEach(((V,I)=>{C[m[I]]=V})),this._uniforms=C,E=0;E<l.length;E++){null==V.getUniform(l[E])&&(l.splice(E,1),E--)}l.forEach(((V,I)=>{s[V]=I}));for(const K of j.getAttributes(this,F))k.push(K)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(V,I){const m=this._valueCache[V],C=I.updateFlag;return(void 0===m||m!==C)&&(this._valueCache[V]=C,!0)}_cacheFloat2(V,I,m){let C=this._valueCache[V];if(!C||2!==C.length)return C=[I,m],this._valueCache[V]=C,!0;let l=!1;return C[0]!==I&&(C[0]=I,l=!0),C[1]!==m&&(C[1]=m,l=!0),l}_cacheFloat3(V,I,m,C){let l=this._valueCache[V];if(!l||3!==l.length)return l=[I,m,C],this._valueCache[V]=l,!0;let s=!1;return l[0]!==I&&(l[0]=I,s=!0),l[1]!==m&&(l[1]=m,s=!0),l[2]!==C&&(l[2]=C,s=!0),s}_cacheFloat4(V,I,m,C,l){let s=this._valueCache[V];if(!s||4!==s.length)return s=[I,m,C,l],this._valueCache[V]=s,!0;let F=!1;return s[0]!==I&&(s[0]=I,F=!0),s[1]!==m&&(s[1]=m,F=!0),s[2]!==C&&(s[2]=C,F=!0),s[3]!==l&&(s[3]=l,F=!0),F}setInt(V,I){const m=this._valueCache[V];void 0!==m&&m===I||this.rF.setInt(this._uniforms[V],I)&&(this._valueCache[V]=I)}setInt2(V,I,m){this._cacheFloat2(V,I,m)&&(this.rF.setInt2(this._uniforms[V],I,m)||(this._valueCache[V]=null))}setInt3(V,I,m,C){this._cacheFloat3(V,I,m,C)&&(this.rF.setInt3(this._uniforms[V],I,m,C)||(this._valueCache[V]=null))}setInt4(V,I,m,C,l){this._cacheFloat4(V,I,m,C,l)&&(this.rF.setInt4(this._uniforms[V],I,m,C,l)||(this._valueCache[V]=null))}setIntArray(V,I){this._valueCache[V]=null,this.rF.setIntArray(this._uniforms[V],I)}setIntArray2(V,I){this._valueCache[V]=null,this.rF.setIntArray2(this._uniforms[V],I)}setIntArray3(V,I){this._valueCache[V]=null,this.rF.setIntArray3(this._uniforms[V],I)}setIntArray4(V,I){this._valueCache[V]=null,this.rF.setIntArray4(this._uniforms[V],I)}setUInt(V,I){const m=this._valueCache[V];void 0!==m&&m===I||this.rF.setUInt(this._uniforms[V],I)&&(this._valueCache[V]=I)}setUInt2(V,I,m){this._cacheFloat2(V,I,m)&&(this.rF.setUInt2(this._uniforms[V],I,m)||(this._valueCache[V]=null))}setUInt3(V,I,m,C){this._cacheFloat3(V,I,m,C)&&(this.rF.setUInt3(this._uniforms[V],I,m,C)||(this._valueCache[V]=null))}setUInt4(V,I,m,C,l){this._cacheFloat4(V,I,m,C,l)&&(this.rF.setUInt4(this._uniforms[V],I,m,C,l)||(this._valueCache[V]=null))}setUIntArray(V,I){this._valueCache[V]=null,this.rF.setUIntArray(this._uniforms[V],I)}setUIntArray2(V,I){this._valueCache[V]=null,this.rF.setUIntArray2(this._uniforms[V],I)}setUIntArray3(V,I){this._valueCache[V]=null,this.rF.setUIntArray3(this._uniforms[V],I)}setUIntArray4(V,I){this._valueCache[V]=null,this.rF.setUIntArray4(this._uniforms[V],I)}setArray(V,I){this._valueCache[V]=null,this.rF.setArray(this._uniforms[V],I)}setArray2(V,I){this._valueCache[V]=null,this.rF.setArray2(this._uniforms[V],I)}setArray3(V,I){this._valueCache[V]=null,this.rF.setArray3(this._uniforms[V],I)}setArray4(V,I){this._valueCache[V]=null,this.rF.setArray4(this._uniforms[V],I)}setMatrices(V,I){I&&(this._valueCache[V]=null,this.rF.setMatrices(this._uniforms[V],I))}setMatrix(V,I){this._cacheMatrix(V,I)&&(this.rF.setMatrices(this._uniforms[V],I.UF())||(this._valueCache[V]=null))}setMatrix3x3(V,I){this._valueCache[V]=null,this.rF.setMatrix3x3(this._uniforms[V],I)}setMatrix2x2(V,I){this._valueCache[V]=null,this.rF.setMatrix2x2(this._uniforms[V],I)}setFloat(V,I){const m=this._valueCache[V];void 0!==m&&m===I||this.rF.setFloat(this._uniforms[V],I)&&(this._valueCache[V]=I)}setVector2(V,I){this._cacheFloat2(V,I.x,I.y)&&(this.rF.setFloat2(this._uniforms[V],I.x,I.y)||(this._valueCache[V]=null))}setFloat2(V,I,m){this._cacheFloat2(V,I,m)&&(this.rF.setFloat2(this._uniforms[V],I,m)||(this._valueCache[V]=null))}setVector3(V,I){this._cacheFloat3(V,I.x,I.y,I.z)&&(this.rF.setFloat3(this._uniforms[V],I.x,I.y,I.z)||(this._valueCache[V]=null))}setFloat3(V,I,m,C){this._cacheFloat3(V,I,m,C)&&(this.rF.setFloat3(this._uniforms[V],I,m,C)||(this._valueCache[V]=null))}setVector4(V,I){this._cacheFloat4(V,I.x,I.y,I.z,I.w)&&(this.rF.setFloat4(this._uniforms[V],I.x,I.y,I.z,I.w)||(this._valueCache[V]=null))}setQuaternion(V,I){this._cacheFloat4(V,I.x,I.y,I.z,I.w)&&(this.rF.setFloat4(this._uniforms[V],I.x,I.y,I.z,I.w)||(this._valueCache[V]=null))}setFloat4(V,I,m,C,l){this._cacheFloat4(V,I,m,C,l)&&(this.rF.setFloat4(this._uniforms[V],I,m,C,l)||(this._valueCache[V]=null))}setColor3(V,I){this._cacheFloat3(V,I.r,I.g,I.b)&&(this.rF.setFloat3(this._uniforms[V],I.r,I.g,I.b)||(this._valueCache[V]=null))}setColor4(V,I,m){this._cacheFloat4(V,I.r,I.g,I.b,m)&&(this.rF.setFloat4(this._uniforms[V],I.r,I.g,I.b,m)||(this._valueCache[V]=null))}setDirectColor4(V,I){this._cacheFloat4(V,I.r,I.g,I.b,I.a)&&(this.rF.setFloat4(this._uniforms[V],I.r,I.g,I.b,I.a)||(this._valueCache[V]=null))}_getVertexShaderCode(){return this.vertexShader?this.rF._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.rF._getShaderSource(this.fragmentShader):null}}var l=m(11125);const s=new WeakMap,F={_webGLVersion:2,cachedPipelines:{}};function k(V){let I=s.get(V);if(!I){if(!V)return F;I={_webGLVersion:V.TEXTURE_BINDING_3D?2:1,_context:V,parallelShaderCompile:V.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},s.set(V,I)}return I}function j(V){s.delete(V)}function E(V,I,m,C,l,s){const F=k(C);s||(s=F._createShaderProgramInjection??X);return s(V,D(I,"vertex",C,F._contextWasLost),D(m,"fragment",C,F._contextWasLost),C,l,F.validateShaderPrograms)}function K(V,I,m,C,l){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6?arguments[6]:void 0;const j=k(l);F||(F=j._createShaderProgramInjection??X);const E=j._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return F(V,t(I,"vertex",C,E,l,j._contextWasLost),t(m,"fragment",C,E,l,j._contextWasLost),l,s,j.validateShaderPrograms)}function Y(V,I){const m=new C,l=k(V);return l.parallelShaderCompile&&!l.disableParallelShaderCompile&&(m.isParallelCompiled=!0),m.context=l._context,m}function X(V,I,m,C){let l=arguments.length>5?arguments[5]:void 0;const s=C.createProgram();if(V.program=s,!s)throw new Error("Unable to create program");return C.attachShader(s,I),C.attachShader(s,m),C.linkProgram(s),V.context=C,V.vertexShader=I,V.fragmentShader=m,V.isParallelCompiled||v(V,C,l),s}function O(V,I,m){const C=V;if(C._isDisposed)return!1;const l=k(I);return!!(l&&l.parallelShaderCompile&&l.parallelShaderCompile.COMPLETION_STATUS_KHR&&C.program&&I.getProgramParameter(C.program,l.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(v(C,I,m),!0)}function v(V,I,m){const C=V.context,l=V.vertexShader,s=V.fragmentShader,F=V.program;if(!C.getProgramParameter(F,C.LINK_STATUS)){if(!I.getShaderParameter(l,I.COMPILE_STATUS)){const m=I.getShaderInfoLog(l);if(m)throw V.vertexCompilationError=m,new Error("VERTEX SHADER "+m)}if(!I.getShaderParameter(s,I.COMPILE_STATUS)){const m=I.getShaderInfoLog(s);if(m)throw V.fragmentCompilationError=m,new Error("FRAGMENT SHADER "+m)}const m=C.getProgramInfoLog(F);if(m)throw V.programLinkError=m,new Error(m)}if(m){C.validateProgram(F);if(!C.getProgramParameter(F,C.VALIDATE_STATUS)){const I=C.getProgramInfoLog(F);if(I)throw V.programValidationError=I,new Error(I)}}C.deleteShader(l),C.deleteShader(s),V.vertexShader=void 0,V.fragmentShader=void 0,V.onCompiled&&(V.onCompiled(),V.onCompiled=void 0)}function N(V,I,m,C,l,s,F,j,Y){let X=arguments.length>10?arguments[10]:void 0,O=arguments.length>11?arguments[11]:void 0,v=arguments.length>12?arguments[12]:void 0;const N=k(V.context);O||(O=N.createRawShaderProgramInjection??E),v||(v=N.createShaderProgramInjection??K);const t=V;t.program=C?O(t,I,m,t.context,Y):v(t,I,m,j,t.context,Y),t.program.__SPECTOR_rebuildProgram=F,X()}function t(V,I,m,C,s,F){return D((0,l.h)(V,m,C),I,s,F)}function D(V,I,m,C){const l=m.createShader("vertex"===I?m.VERTEX_SHADER:m.FRAGMENT_SHADER);if(!l){let V=m.NO_ERROR,l=m.NO_ERROR;for(;(l=m.getError())!==m.NO_ERROR;)V=l;throw new Error(`Something went wrong while creating a gl ${I} shader object. gl error=${V}, gl isContextLost=${m.isContextLost()}, _contextWasLost=${C}`)}return m.shaderSource(l,V),m.compileShader(l),l}function b(V,I){I.useProgram(V)}function T(V,I){const m=V;if(!m.isParallelCompiled)return void I(V);const C=m.onCompiled;m.onCompiled=()=>{null===C||void 0===C||C(),I(V)}}},11433:(V,I,m)=>{m.r(I),m.d(I,{ThinEngine:()=>n});var C=m(11156),l=m(11442),s=m(11085),F=m(11081);class k{constructor(){this.shaderLanguage=0}postProcessor(V,I,m,C,l){if(l.drawBuffersExtensionDisabled){const I=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;V=V.replace(I,"")}return V}}const j=/(flat\s)?\s*varying\s*.*/;class E{constructor(){this.shaderLanguage=0}attributeProcessor(V){return V.replace("attribute","in")}varyingCheck(V,I){return j.test(V)}varyingProcessor(V,I){return V.replace("varying",I?"in":"out")}postProcessor(V,I,m){const C=-1!==V.search(/#extension.+GL_EXT_draw_buffers.+require/);if(V=(V=V.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),m){const I=-1!==V.search(/layout *\(location *= *0\) *out/g);V=(V=(V=(V=(V=(V=(V=V.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(C||I?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==I.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+V}return V}}var K=m(11444),Y=m(11193),X=m(11136),O=m(11452),v=m(11161),N=m(11143),t=m(11125),D=m(11154),b=m(11458);class T{}class n extends X.b{get name(){return this._name}set name(V){this._name=V}get version(){return this._webGLVersion}static get ShadersRepository(){return N.c.ShadersRepository}static set ShadersRepository(V){N.c.ShadersRepository=V}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(V){this._framebufferDimensionsObject=V}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(V,I,m,l){if(m=m||{},super(I??m.antialias,m,l),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!V)return;let F=null;if(V.getContext){if(F=V,void 0===m.PE&&(m.PE=!1),void 0===m.xrCompatible&&(m.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const V=navigator.userAgent;for(const I of n.ExceptionList){const C=I.key,l=I.targets;if(new RegExp(C).test(V)){if(I.capture&&I.captureConstraint){const m=I.capture,C=I.captureConstraint,l=new RegExp(m).exec(V);if(l&&l.length>0){if(parseInt(l[l.length-1])>=C)continue}}for(const V of l)switch(V){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":m.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost?this._onContextLost=()=>{(0,C.y)(this._gl)}:(this._onContextLost=V=>{V.preventDefault(),this._contextWasLost=!0,(0,C.y)(this._gl),s.d.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},F.addEventListener("webglcontextrestored",this._onContextRestored,!1),m.powerPreference=m.powerPreference||"high-performance"),F.addEventListener("webglcontextlost",this._onContextLost,!1),this._badDesktopOS&&(m.xrCompatible=!1),!m.disableWebGL2Support)try{this._gl=F.getContext("webgl2",m)||F.getContext("experimental-webgl2",m),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(Y){}if(!this._gl){if(!F)throw new Error("The provided canvas is null or undefined.");try{this._gl=F.getContext("webgl",m)||F.getContext("experimental-webgl",m)}catch(Y){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=V,F=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const I=this._gl.getContextAttributes();I&&(m.stencil=I.stencil)}this._sharedInit(F),this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==m.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=m.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let C=0;C<this._caps.maxVertexAttribs;C++)this._currentBufferPointers[C]=new T;this._shaderProcessor=this.webGLVersion>1?new E:new k;const j=`Babylon.js v${n.Version}`;s.d.Log(j+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",j);const K=(0,C.A)(this._gl);K.validateShaderPrograms=this.validateShaderPrograms,K.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(V){return null}areAllEffectsReady(){for(const V in this._compiledEffects){if(!this._compiledEffects[V].isReady())return!1}return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1,textureNorm16:!!this._gl.getExtension("EXT_texture_norm16")},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const V=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=V&&(this._glRenderer=this._gl.getParameter(V.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(V.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.textureNorm16&&(this._gl.R16_EXT=33322,this._gl.RG16_EXT=33324,this._gl.RGB16_EXT=32852,this._gl.RGBA16_EXT=32859,this._gl.R16_SNORM_EXT=36760,this._gl.RG16_SNORM_EXT=36761,this._gl.RGB16_SNORM_EXT=36762,this._gl.RGBA16_SNORM_EXT=36763),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{const V=this._gl.getExtension("WEBGL_draw_buffers");if(null!==V){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=V.drawBuffersWEBGL.bind(V),this._caps.maxDrawBuffers=this._gl.getParameter(V.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let I=0;I<16;I++)this._gl["COLOR_ATTACHMENT"+I+"_WEBGL"]=V["COLOR_ATTACHMENT"+I+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const V=this._gl.getExtension("WEBGL_depth_texture");null!=V&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=V.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const V=this._gl.getExtension("OES_vertex_array_object");null!=V&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=V.createVertexArrayOES.bind(V),this._gl.bindVertexArray=V.bindVertexArrayOES.bind(V),this._gl.deleteVertexArray=V.deleteVertexArrayOES.bind(V))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const V=this._gl.getExtension("ANGLE_instanced_arrays");null!=V?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=V.drawArraysInstancedANGLE.bind(V),this._gl.drawElementsInstanced=V.drawElementsInstancedANGLE.bind(V),this._gl.vertexAttribDivisor=V.vertexAttribDivisorANGLE.bind(V)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const V=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),I=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);V&&I&&(this._caps.highPrecisionShaderSupported=0!==V.precision&&0!==I.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const V=this._gl.getExtension("EXT_blend_minmax");null!=V&&(this._caps.blendMinMax=!0,this._gl.MAX=V.MAX_EXT,this._gl.MIN=V.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const V=this._gl.getExtension("EXT_sRGB");null!=V&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:V.SRGB_EXT,SRGB8:V.SRGB_ALPHA_EXT,SRGB8_ALPHA8:V.SRGB_ALPHA_EXT})}if(this._creationOptions){const V=this._creationOptions.forceSRGBBufferSupportState;void 0!==V&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&V)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let I=0;I<this._maxSimultaneousTextures;I++)this._nextFreeTextureSlots.push(I);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"===typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const V=this._workingCanvas.getContext("2d");V&&(this._workingContext=V)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const V=this.getGlInfo();return V&&V.renderer?V.renderer:""}getRenderWidth(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const l=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=l;let s=0;if(I&&V){let I=!0;if(this._currentRenderTarget){var F;const m=null===(F=this._currentRenderTarget.texture)||void 0===F?void 0:F.format;if(8===m||9===m||10===m||11===m){var k;const m=null===(k=this._currentRenderTarget.texture)||void 0===k?void 0:k.type;7===m||5===m?(n._TempClearColorUint32[0]=255*V.r,n._TempClearColorUint32[1]=255*V.g,n._TempClearColorUint32[2]=255*V.b,n._TempClearColorUint32[3]=255*V.a,this._gl.clearBufferuiv(this._gl.COLOR,0,n._TempClearColorUint32),I=!1):(n._TempClearColorInt32[0]=255*V.r,n._TempClearColorInt32[1]=255*V.g,n._TempClearColorInt32[2]=255*V.b,n._TempClearColorInt32[3]=255*V.a,this._gl.clearBufferiv(this._gl.COLOR,0,n._TempClearColorInt32),I=!1)}}I&&(this._gl.clearColor(V.r,V.g,V.b,void 0!==V.a?V.a:1),s|=this._gl.COLOR_BUFFER_BIT)}m&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),s|=this._gl.DEPTH_BUFFER_BIT),C&&(this._gl.clearStencil(0),s|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(s)}_viewport(V,I,m,C){V===this._viewportCached.x&&I===this._viewportCached.y&&m===this._viewportCached.z&&C===this._viewportCached.w||(this._viewportCached.x=V,this._viewportCached.y=I,this._viewportCached.z=m,this._viewportCached.w=C,this._gl.viewport(V,I,m,C))}bY(){super.bY(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2?arguments[2]:void 0,C=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const j=V;this._currentRenderTarget&&this._resolveAndGenerateMipMapsFramebuffer(this._currentRenderTarget),this._currentRenderTarget=V,this._bindUnboundFramebuffer(j._framebuffer);const E=this._gl;var K;if(!V.isMulti)if(V.is2DArray||V.is3D)E.framebufferTextureLayer(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,null===(K=V.texture._hardwareTexture)||void 0===K?void 0:K.underlyingResource,F,k),j._currentLOD=F;else if(V.isCube){var Y;E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+I,null===(Y=V.texture._hardwareTexture)||void 0===Y?void 0:Y.underlyingResource,F)}else if(j._currentLOD!==F){var X;E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_2D,null===(X=V.texture._hardwareTexture)||void 0===X?void 0:X.underlyingResource,F),j._currentLOD=F}const O=V._depthStencilTexture;if(O){V.is3D&&(V.texture.width===O.width&&V.texture.height===O.height&&V.texture.depth===O.depth||s.d.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const m=V._depthStencilTextureWithStencil?E.DEPTH_STENCIL_ATTACHMENT:E.DEPTH_ATTACHMENT;var v;if(V.is2DArray||V.is3D)E.framebufferTextureLayer(E.FRAMEBUFFER,m,null===(v=O._hardwareTexture)||void 0===v?void 0:v.underlyingResource,F,k);else if(V.isCube){var N;E.framebufferTexture2D(E.FRAMEBUFFER,m,E.TEXTURE_CUBE_MAP_POSITIVE_X+I,null===(N=O._hardwareTexture)||void 0===N?void 0:N.underlyingResource,F)}else{var t;E.framebufferTexture2D(E.FRAMEBUFFER,m,E.TEXTURE_2D,null===(t=O._hardwareTexture)||void 0===t?void 0:t.underlyingResource,F)}}j._MSAAFramebuffer&&this._bindUnboundFramebuffer(j._MSAAFramebuffer),this._cachedViewport&&!l?this.setViewport(this._cachedViewport,m,C):(m||(m=V.width,F&&(m/=Math.pow(2,F))),C||(C=V.height,F&&(C/=Math.pow(2,F))),this._viewport(0,0,m,C)),this.wipeCaches()}setStateCullFaceType(V,I){const m=this.cullBackFaces??V??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==m||I)&&(this._depthCullingState.cullFace=m)}setState(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2?arguments[2]:void 0,C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(this._depthCullingState.cull!==V||m)&&(this._depthCullingState.cull=V),this.setStateCullFaceType(l,m),this.setZOffset(I),this.setZOffsetUnits(F);const k=C?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==k||m)&&(this._depthCullingState.frontFace=k),this._stencilStateComposer.stencilMaterial=s}_resolveAndGenerateMipMapsFramebuffer(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];V.disableAutomaticMSAAResolve||(V.isMulti?this.resolveMultiFramebuffer(V):this.resolveFramebuffer(V)),I||(V.isMulti?this.generateMipMapsMultiFramebuffer(V):this.generateMipMapsFramebuffer(V))}_bindUnboundFramebuffer(V){this._currentFramebuffer!==V&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,V),this._currentFramebuffer=V)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(V){const I=this._getTextureTarget(V);this._bindTextureDirectly(I,V,!0),this._gl.generateMipmap(I),this._bindTextureDirectly(I,null)}unBindFramebuffer(V,I,m){const C=V;this._currentRenderTarget=null,this._resolveAndGenerateMipMapsFramebuffer(V,I),m&&(C._MSAAFramebuffer&&this._bindUnboundFramebuffer(C._framebuffer),m()),this._bindUnboundFramebuffer(null)}generateMipMapsFramebuffer(V){var I;V.isMulti||null===(I=V.texture)||void 0===I||!I.generateMipMaps||V.isCube||this.generateMipmaps(V.texture)}resolveFramebuffer(V){const I=V,m=this._gl;if(!I._MSAAFramebuffer||I.isMulti)return;let C=I.resolveMSAAColors?m.COLOR_BUFFER_BIT:0;C|=I._generateDepthBuffer&&I.resolveMSAADepth?m.DEPTH_BUFFER_BIT:0,C|=I._generateStencilBuffer&&I.resolveMSAAStencil?m.STENCIL_BUFFER_BIT:0,m.bindFramebuffer(m.READ_FRAMEBUFFER,I._MSAAFramebuffer),m.bindFramebuffer(m.DRAW_FRAMEBUFFER,I._framebuffer),m.blitFramebuffer(0,0,V.width,V.height,0,0,V.width,V.height,C,m.NEAREST)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(V,I,m){return this._createVertexBuffer(V,this._gl.STATIC_DRAW)}_createVertexBuffer(V,I){const m=this._gl.createBuffer();if(!m)throw new Error("Unable to create vertex buffer");const C=new K.b(m);return this.bindArrayBuffer(C),"number"!==typeof V?V instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(V),I),C.xF=4*V.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,V,I),C.xF=V.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(V),I),C.xF=V),this._resetVertexBufferBinding(),C.references=1,C}createDynamicVertexBuffer(V,I){return this._createVertexBuffer(V,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(V,I,m){const C=this._gl.createBuffer(),l=new K.b(C);if(!C)throw new Error("Unable to create index buffer");this.bindIndexBuffer(l);const s=this._normalizeIndexData(V);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,s,I?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),l.references=1,l.is32Bits=4===s.BYTES_PER_ELEMENT,l}_normalizeIndexData(V){if(2===V.BYTES_PER_ELEMENT)return V;if(this._caps.uintIndices){if(V instanceof Uint32Array)return V;for(let I=0;I<V.length;I++)if(V[I]>=65535)return new Uint32Array(V);return new Uint16Array(V)}return new Uint16Array(V)}bindArrayBuffer(V){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(V,this._gl.ARRAY_BUFFER)}bindUniformBlock(V,I,m){const C=V.program,l=this._gl.getUniformBlockIndex(C,I);this._gl.uniformBlockBinding(C,l,m)}bindIndexBuffer(V){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(V,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(V,I){(this._vaoRecordInProgress||this._currentBoundBuffer[I]!==V)&&(this._gl.bindBuffer(I,V?V.underlyingResource:null),this._currentBoundBuffer[I]=V)}updateArrayBuffer(V){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,V)}_vertexAttribPointer(V,I,m,C,l,s,F){const k=this._currentBufferPointers[I];if(!k)return;let j=!1;k.active?(k.buffer!==V&&(k.buffer=V,j=!0),k.size!==m&&(k.size=m,j=!0),k.type!==C&&(k.type=C,j=!0),k.normalized!==l&&(k.normalized=l,j=!0),k.stride!==s&&(k.stride=s,j=!0),k.offset!==F&&(k.offset=F,j=!0)):(j=!0,k.active=!0,k.index=I,k.size=m,k.type=C,k.normalized=l,k.stride=s,k.offset=F,k.buffer=V),(j||this._vaoRecordInProgress)&&(this.bindArrayBuffer(V),C===this._gl.UNSIGNED_INT||C===this._gl.INT?this._gl.vertexAttribIPointer(I,m,C,s,F):this._gl.vertexAttribPointer(I,m,C,l,s,F))}_bindIndexBufferWithCache(V){null!=V&&this._cachedIndexBuffer!==V&&(this._cachedIndexBuffer=V,this.bindIndexBuffer(V),this._uintIndicesCurrentlySet=V.is32Bits)}_bindVertexBuffersAttributes(V,I,m){const C=I.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let l=0;l<C.length;l++){const s=I.getAttributeLocation(l);if(s>=0){const I=C[l];let F=null;if(m&&(F=m[I]),F||(F=V[I]),!F)continue;this._gl.enableVertexAttribArray(s),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[s]=!0);const k=F.getBuffer();k&&(this._vertexAttribPointer(k,s,F.getSize(),F.type,F.normalized,F.byteStride,F.byteOffset),F.getIsInstanced()&&(this._gl.vertexAttribDivisor(s,F.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(s),this._currentInstanceBuffers.push(k))))}}}recordVertexArrayObject(V,I,m,C){const l=this._gl.createVertexArray();if(!l)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(l),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(V,m,C),this.bindIndexBuffer(I),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),l}bindVertexArrayObject(V,I){this._cachedVertexArrayObject!==V&&(this._cachedVertexArrayObject=V,this._gl.bindVertexArray(V),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=I&&I.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(V,I,m,C,l){if(this._cachedVertexBuffers!==V||this._cachedEffectForVertexBuffers!==l){this._cachedVertexBuffers=V,this._cachedEffectForVertexBuffers=l;const I=l.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let s=0;for(let F=0;F<I;F++)if(F<m.length){const I=l.getAttributeLocation(F);I>=0&&(this._gl.enableVertexAttribArray(I),this._vertexAttribArraysEnabled[I]=!0,this._vertexAttribPointer(V,I,m[F],this._gl.FLOAT,!1,C,s)),s+=4*m[F]}}this._bindIndexBufferWithCache(I)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(V,I,m,C){this._cachedVertexBuffers===V&&this._cachedEffectForVertexBuffers===m||(this._cachedVertexBuffers=V,this._cachedEffectForVertexBuffers=m,this._bindVertexBuffersAttributes(V,m,C)),this._bindIndexBufferWithCache(I)}unbindInstanceAttributes(){let V;for(let I=0,m=this._currentInstanceLocations.length;I<m;I++){const m=this._currentInstanceBuffers[I];V!=m&&m.references&&(V=m,this.bindArrayBuffer(m));const C=this._currentInstanceLocations[I];this._gl.vertexAttribDivisor(C,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(V){this._gl.deleteVertexArray(V)}_releaseBuffer(V){return V.references--,0===V.references&&(this._deleteBuffer(V),!0)}_deleteBuffer(V){this._gl.deleteBuffer(V.underlyingResource)}updateAndBindInstancesBuffer(V,I,m){if(this.bindArrayBuffer(V),I&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,I),void 0!==m[0].index)this.bindInstancesBuffer(V,m,!0);else for(let C=0;C<4;C++){const I=m[C];this._vertexAttribArraysEnabled[I]||(this._gl.enableVertexAttribArray(I),this._vertexAttribArraysEnabled[I]=!0),this._vertexAttribPointer(V,I,4,this._gl.FLOAT,!1,64,16*C),this._gl.vertexAttribDivisor(I,1),this._currentInstanceLocations.push(I),this._currentInstanceBuffers.push(V)}}bindInstancesBuffer(V,I){let m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.bindArrayBuffer(V);let C=0;if(m)for(let l=0;l<I.length;l++){C+=4*I[l].attributeSize}for(let l=0;l<I.length;l++){const m=I[l];void 0===m.index&&(m.index=this._currentEffect.getAttributeLocationByName(m.attributeName)),m.index<0||(this._vertexAttribArraysEnabled[m.index]||(this._gl.enableVertexAttribArray(m.index),this._vertexAttribArraysEnabled[m.index]=!0),this._vertexAttribPointer(V,m.index,m.attributeSize,m.attributeType||this._gl.FLOAT,m.normalized||!1,C,m.offset),this._gl.vertexAttribDivisor(m.index,void 0===m.divisor?1:m.divisor),this._currentInstanceLocations.push(m.index),this._currentInstanceBuffers.push(V))}}disableInstanceAttributeByName(V){if(!this._currentEffect)return;const I=this._currentEffect.getAttributeLocationByName(V);this.disableInstanceAttribute(I)}disableInstanceAttribute(V){let I,m=!1;for(;-1!==(I=this._currentInstanceLocations.indexOf(V));)this._currentInstanceLocations.splice(I,1),this._currentInstanceBuffers.splice(I,1),m=!0,I=this._currentInstanceLocations.indexOf(V);m&&(this._gl.vertexAttribDivisor(V,0),this.disableAttributeByIndex(V))}disableAttributeByIndex(V){this._gl.disableVertexAttribArray(V),this._vertexAttribArraysEnabled[V]=!1,this._currentBufferPointers[V].active=!1}draw(V,I,m,C){this.drawElementsType(V?0:1,I,m,C)}drawPointClouds(V,I,m){this.drawArraysType(2,V,I,m)}drawUnIndexed(V,I,m,C){this.drawArraysType(V?0:1,I,m,C)}drawElementsType(V,I,m,C){this.applyStates(),this._reportDrawCall();const l=this._drawMode(V),s=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,F=this._uintIndicesCurrentlySet?4:2;C?this._gl.drawElementsInstanced(l,m,s,I*F,C):this._gl.drawElements(l,m,s,I*F)}drawArraysType(V,I,m,C){this.applyStates(),this._reportDrawCall();const l=this._drawMode(V);C?this._gl.drawArraysInstanced(l,I,m,C):this._gl.drawArrays(l,I,m)}_drawMode(V){switch(V){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(V){this._compiledEffects[V._key]&&delete this._compiledEffects[V._key];const I=V.getPipelineContext();I&&this._deletePipelineContext(I)}_deletePipelineContext(V){const I=V;I&&I.program&&(I.program.__SPECTOR_rebuildProgram=null,(0,D.k)(I),this._gl&&(this._currentProgram===I.program&&this._setProgram(null),this._gl.deleteProgram(I.program)))}_getGlobalDefines(V){return(0,t.j)(V,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(V,I,m,l,s,F,k,j,E){let K=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,Y=arguments.length>10?arguments[10]:void 0;const X="string"===typeof V?V:V.vertexToken||V.vertexSource||V.vertexElement||V.vertex,O="string"===typeof V?V:V.fragmentToken||V.fragmentSource||V.fragmentElement||V.fragment,v=this._getGlobalDefines(),t=void 0!==I.attributes;let D=s??I.defines??"";v&&(D+=v);const b=X+"+"+O+"@"+D;if(this._compiledEffects[b]){const V=this._compiledEffects[b];return k&&V.isReady()&&k(V),V._refCount++,V}this._gl&&(0,C.A)(this._gl);const T=new N.c(V,I,t?this:m,l,this,s,F,k,j,E,b,I.shaderLanguage??K,I.extraInitializationsAsync??Y);return this._compiledEffects[b]=T,T}_getShaderSource(V){return this._gl.getShaderSource(V)}createRawShaderProgram(V,I,m,l){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const F=(0,C.A)(this._gl);return F._contextWasLost=this._contextWasLost,F.validateShaderPrograms=this.validateShaderPrograms,(0,C.t)(V,I,m,l||this._gl,s)}createShaderProgram(V,I,m,l,s){let F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const k=(0,C.A)(this._gl);return k._contextWasLost=this._contextWasLost,k.validateShaderPrograms=this.validateShaderPrograms,(0,C.v)(V,I,m,l,s||this._gl,F)}inlineShaderCode(V){return V}createPipelineContext(V){if(this._gl){(0,C.A)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const I=(0,C.q)(this._gl,V);return I.rF=this,I}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(V){return(0,C.k)(V,this._gl,this.validateShaderPrograms)}_preparePipelineContextAsync(V,I,m,l,s,F,k,j,E,K,Y){const X=(0,C.A)(this._gl);return X._contextWasLost=this._contextWasLost,X.validateShaderPrograms=this.validateShaderPrograms,X._createShaderProgramInjection=this._createShaderProgram.bind(this),X.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),X.createShaderProgramInjection=this.createShaderProgram.bind(this),X.loadFileInjection=this._loadFile.bind(this),(0,C.m)(V,I,m,l,s,F,k,j,E,K,Y)}_createShaderProgram(V,I,m,l){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,C.e)(V,I,m,l,s)}_isRenderingStateCompiled(V){return!this._isDisposed&&(0,C.l)(V,this._gl,this.validateShaderPrograms)}_executeWhenRenderingStateIsCompiled(V,I){(0,C.i)(V,I)}getUniforms(V,I){const m=new Array,C=V;for(let l=0;l<I.length;l++)m.push(this._gl.getUniformLocation(C.program,I[l]));return m}getAttributes(V,I){const m=[],C=V;for(let s=0;s<I.length;s++)try{m.push(this._gl.getAttribLocation(C.program,I[s]))}catch(l){m.push(-1)}return m}enableEffect(V){(V=null!==V&&(0,l.b)(V)?V.effect:V)&&V!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(V),this._currentEffect=V,V.onBind&&V.onBind(V),V._onBindObservable&&V._onBindObservable.notifyObservers(V))}setInt(V,I){return!!V&&(this._gl.uniform1i(V,I),!0)}setInt2(V,I,m){return!!V&&(this._gl.uniform2i(V,I,m),!0)}setInt3(V,I,m,C){return!!V&&(this._gl.uniform3i(V,I,m,C),!0)}setInt4(V,I,m,C,l){return!!V&&(this._gl.uniform4i(V,I,m,C,l),!0)}setIntArray(V,I){return!!V&&(this._gl.uniform1iv(V,I),!0)}setIntArray2(V,I){return!(!V||I.length%2!==0)&&(this._gl.uniform2iv(V,I),!0)}setIntArray3(V,I){return!(!V||I.length%3!==0)&&(this._gl.uniform3iv(V,I),!0)}setIntArray4(V,I){return!(!V||I.length%4!==0)&&(this._gl.uniform4iv(V,I),!0)}setUInt(V,I){return!!V&&(this._gl.uniform1ui(V,I),!0)}setUInt2(V,I,m){return!!V&&(this._gl.uniform2ui(V,I,m),!0)}setUInt3(V,I,m,C){return!!V&&(this._gl.uniform3ui(V,I,m,C),!0)}setUInt4(V,I,m,C,l){return!!V&&(this._gl.uniform4ui(V,I,m,C,l),!0)}setUIntArray(V,I){return!!V&&(this._gl.uniform1uiv(V,I),!0)}setUIntArray2(V,I){return!(!V||I.length%2!==0)&&(this._gl.uniform2uiv(V,I),!0)}setUIntArray3(V,I){return!(!V||I.length%3!==0)&&(this._gl.uniform3uiv(V,I),!0)}setUIntArray4(V,I){return!(!V||I.length%4!==0)&&(this._gl.uniform4uiv(V,I),!0)}setArray(V,I){return!!V&&(!(I.length<1)&&(this._gl.uniform1fv(V,I),!0))}setArray2(V,I){return!(!V||I.length%2!==0)&&(this._gl.uniform2fv(V,I),!0)}setArray3(V,I){return!(!V||I.length%3!==0)&&(this._gl.uniform3fv(V,I),!0)}setArray4(V,I){return!(!V||I.length%4!==0)&&(this._gl.uniform4fv(V,I),!0)}setMatrices(V,I){return!!V&&(this._gl.uniformMatrix4fv(V,!1,I),!0)}setMatrix3x3(V,I){return!!V&&(this._gl.uniformMatrix3fv(V,!1,I),!0)}setMatrix2x2(V,I){return!!V&&(this._gl.uniformMatrix2fv(V,!1,I),!0)}setFloat(V,I){return!!V&&(this._gl.uniform1f(V,I),!0)}setFloat2(V,I,m){return!!V&&(this._gl.uniform2f(V,I,m),!0)}setFloat3(V,I,m,C){return!!V&&(this._gl.uniform3f(V,I,m,C),!0)}setFloat4(V,I,m,C,l){return!!V&&(this._gl.uniform4f(V,I,m,C,l),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const V=this._colorWrite;this._gl.colorMask(V,V,V,V)}}wipeCaches(V){this.preventCacheWipeBetweenFrames&&!V||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),V&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(V,I){const m=this._gl;let C=m.NEAREST,l=m.NEAREST,s=!1;switch(V){case 11:C=m.LINEAR,l=I?m.LINEAR_MIPMAP_NEAREST:m.LINEAR;break;case 3:C=m.LINEAR,s=!0,l=I?m.LINEAR_MIPMAP_LINEAR:m.LINEAR;break;case 8:s=!0,C=m.NEAREST,l=I?m.NEAREST_MIPMAP_LINEAR:m.NEAREST;break;case 4:C=m.NEAREST,l=I?m.NEAREST_MIPMAP_NEAREST:m.NEAREST;break;case 5:C=m.NEAREST,l=I?m.LINEAR_MIPMAP_NEAREST:m.LINEAR;break;case 6:s=!0,C=m.NEAREST,l=I?m.LINEAR_MIPMAP_LINEAR:m.LINEAR;break;case 7:C=m.NEAREST,l=m.LINEAR;break;case 1:C=m.NEAREST,l=m.NEAREST;break;case 9:C=m.LINEAR,l=I?m.NEAREST_MIPMAP_NEAREST:m.NEAREST;break;case 10:s=!0,C=m.LINEAR,l=I?m.NEAREST_MIPMAP_LINEAR:m.NEAREST;break;case 2:C=m.LINEAR,l=m.LINEAR;break;case 12:C=m.LINEAR,l=m.NEAREST}return{min:l,mag:C,hasMipMaps:s}}_createTexture(){const V=this._gl.createTexture();if(!V)throw new Error("Unable to create texture");return V}_createHardwareTexture(){return new O.b(this._createTexture(),this._gl)}_createInternalTexture(V,I){let m,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,l=!1,F=!1,k=0,j=3,E=5,K=!1,Y=1,X=!1,O=0;void 0!==I&&"object"===typeof I?(l=!!I.generateMipMaps,F=!!I.createMipMaps,k=void 0===I.type?0:I.type,j=void 0===I.samplingMode?3:I.samplingMode,E=void 0===I.format?5:I.format,K=void 0!==I.useSRGBBuffer&&I.useSRGBBuffer,Y=I.samples??1,m=I.label,X=!!I.createMSAATexture,O=I.comparisonFunction||0):l=!!I,K&&(K=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==k||this._caps.textureFloatLinearFiltering)&&(2!==k||this._caps.textureHalfFloatLinearFiltering)||(j=1),1!==k||this._caps.textureFloat||(k=0,s.d.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const N=(0,b.f)(E),t=(0,b.c)(E),D=this._gl,T=new v.e(this,C),n=V.width||V,x=V.height||V,S=V.depth||0,c=V.layers||0,H=this._getSamplingParameters(j,(l||F)&&!N),y=0!==c?D.TEXTURE_2D_ARRAY:0!==S?D.TEXTURE_3D:D.TEXTURE_2D,z=N?this._getInternalFormatFromDepthTextureFormat(E,!0,t):this._getRGBABufferInternalSizedFormat(k,E,K),Z=N?t?D.DEPTH_STENCIL:D.DEPTH_COMPONENT:this._getInternalFormat(E),B=N?this._getWebGLTextureTypeFromDepthTextureFormat(E):this._getWebGLTextureType(k);if(this._bindTextureDirectly(y,T),0!==c?(T.is2DArray=!0,D.texImage3D(y,0,z,n,x,c,0,Z,B,null)):0!==S?(T.is3D=!0,D.texImage3D(y,0,z,n,x,S,0,Z,B,null)):D.texImage2D(y,0,z,n,x,0,Z,B,null),D.texParameteri(y,D.TEXTURE_MAG_FILTER,H.mag),D.texParameteri(y,D.TEXTURE_MIN_FILTER,H.min),D.texParameteri(y,D.TEXTURE_WRAP_S,D.CLAMP_TO_EDGE),D.texParameteri(y,D.TEXTURE_WRAP_T,D.CLAMP_TO_EDGE),N&&this.webGLVersion>1&&(0===O?(D.texParameteri(y,D.TEXTURE_COMPARE_FUNC,515),D.texParameteri(y,D.TEXTURE_COMPARE_MODE,D.NONE)):(D.texParameteri(y,D.TEXTURE_COMPARE_FUNC,O),D.texParameteri(y,D.TEXTURE_COMPARE_MODE,D.COMPARE_REF_TO_TEXTURE))),(l||F)&&this._gl.generateMipmap(y),this._bindTextureDirectly(y,null),T._useSRGBBuffer=K,T.baseWidth=n,T.baseHeight=x,T.width=n,T.height=x,T.depth=c||S,T.isReady=!0,T.samples=Y,T.generateMipMaps=l,T.samplingMode=j,T.type=k,T.format=E,T.label=m,T.comparisonFunction=O,this._internalTexturesCache.push(T),X){let V=null;if(V=(0,b.f)(T.format)?this._setupFramebufferDepthAttachments((0,b.c)(T.format),19!==T.format,T.width,T.height,Y,T.format,!0):this._createRenderBuffer(T.width,T.height,Y,-1,this._getRGBABufferInternalSizedFormat(T.type,T.format,T._useSRGBBuffer),-1),!V)throw new Error("Unable to create render buffer");T._autoMSAAManagement=!0;let I=T._hardwareTexture;I||(I=T._hardwareTexture=this._createHardwareTexture()),I.addMSAARenderBuffer(V)}return T}_getUseSRGBBuffer(V,I){return V&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||I)}createTexture(V,I,m,C){var l=this;let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,K=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,Y=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,X=arguments.length>11?arguments[11]:void 0,O=arguments.length>12?arguments[12]:void 0,N=arguments.length>13?arguments[13]:void 0,t=arguments.length>14?arguments[14]:void 0;return this._createTextureBase(V,I,m,C,s,F,k,(function(){for(var V=arguments.length,I=new Array(V),m=0;m<V;m++)I[m]=arguments[m];return l._prepareWebGLTexture(...I,K)}),((V,I,m,l,s,F)=>{const k=this._gl,j=m.width===V&&m.height===I;s._creationFlags=N??0;const E=this._getTexImageParametersForCreateTexture(s.format,s._useSRGBBuffer);if(j)return k.texImage2D(k.TEXTURE_2D,0,E.internalFormat,E.format,E.type,m),!1;const K=this._caps.maxTextureSize;if(m.width>K||m.height>K||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=V,this._workingCanvas.height=I,this._workingContext.drawImage(m,0,0,m.width,m.height,0,0,V,I),k.texImage2D(k.TEXTURE_2D,0,E.internalFormat,E.format,E.type,this._workingCanvas),s.width=V,s.height=I,!1);{const V=new v.e(this,2);this._bindTextureDirectly(k.TEXTURE_2D,V,!0),k.texImage2D(k.TEXTURE_2D,0,E.internalFormat,E.format,E.type,m),this._rescaleTexture(V,s,C,E.format,(()=>{this._releaseTexture(V),this._bindTextureDirectly(k.TEXTURE_2D,s,!0),F()}))}return!0}),j,E,K,Y,X,O,t)}_getTexImageParametersForCreateTexture(V,I){let m,C;return 1===this.webGLVersion?(m=this._getInternalFormat(V,I),C=m):(m=this._getInternalFormat(V,!1),C=this._getRGBABufferInternalSizedFormat(0,V,I)),{internalFormat:C,format:m,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(V,I,m,C,l){}_unpackFlipY(V){this._unpackFlipYCached!==V&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,V?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=V))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(V){return V.isCube?this._gl.TEXTURE_CUBE_MAP:V.is3D?this._gl.TEXTURE_3D:V.is2DArray||V.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(V,I){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const C=this._getTextureTarget(I),l=this._getSamplingParameters(V,I.useMipMaps||m);this._setTextureParameterInteger(C,this._gl.TEXTURE_MAG_FILTER,l.mag,I),this._setTextureParameterInteger(C,this._gl.TEXTURE_MIN_FILTER,l.min),m&&l.hasMipMaps&&(I.generateMipMaps=!0,this._gl.generateMipmap(C)),this._bindTextureDirectly(C,null),I.samplingMode=V}updateTextureDimensions(V,I,m){}updateTextureWrappingMode(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const l=this._getTextureTarget(V);null!==I&&(this._setTextureParameterInteger(l,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(I),V),V._cachedWrapU=I),null!==m&&(this._setTextureParameterInteger(l,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(m),V),V._cachedWrapV=m),(V.is2DArray||V.is3D)&&null!==C&&(this._setTextureParameterInteger(l,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(C),V),V._cachedWrapR=C),this._bindTextureDirectly(l,null)}_uploadCompressedDataToTextureDirectly(V,I,m,C,l){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const k=this._gl;let j=k.TEXTURE_2D;if(V.isCube&&(j=k.TEXTURE_CUBE_MAP_POSITIVE_X+s),V._useSRGBBuffer)switch(I){case 37492:case 36196:this._caps.etc2?I=k.COMPRESSED_SRGB8_ETC2:V._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?I=k.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:V._useSRGBBuffer=!1;break;case 36492:I=k.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:I=k.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?I=k.COMPRESSED_SRGB_S3TC_DXT1_EXT:V._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?I=k.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:V._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?I=k.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:V._useSRGBBuffer=!1;break;default:V._useSRGBBuffer=!1}this._gl.compressedTexImage2D(j,F,I,m,C,0,l)}_uploadDataToTextureDirectly(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,l=arguments.length>4?arguments[4]:void 0,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const F=this._gl,k=this._getWebGLTextureType(V.type),j=this._getInternalFormat(V.format),E=void 0===l?this._getRGBABufferInternalSizedFormat(V.type,V.format,V._useSRGBBuffer):this._getInternalFormat(l,V._useSRGBBuffer);this._unpackFlipY(V.invertY);let K=F.TEXTURE_2D;V.isCube&&(K=F.TEXTURE_CUBE_MAP_POSITIVE_X+m);const Y=Math.round(Math.log(V.width)*Math.LOG2E),X=Math.round(Math.log(V.height)*Math.LOG2E),O=s?V.width:Math.pow(2,Math.max(Y-C,0)),v=s?V.height:Math.pow(2,Math.max(X-C,0));F.texImage2D(K,C,E,O,v,0,j,k,I)}updateTextureData(V,I,m,C,l,s){let F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,k=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,j=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const E=this._gl,K=this._getWebGLTextureType(V.type),Y=this._getInternalFormat(V.format);this._unpackFlipY(V.invertY);let X=E.TEXTURE_2D,O=E.TEXTURE_2D;V.isCube&&(O=E.TEXTURE_CUBE_MAP_POSITIVE_X+F,X=E.TEXTURE_CUBE_MAP),this._bindTextureDirectly(X,V,!0),E.texSubImage2D(O,k,m,C,l,s,Y,K,I),j&&this._gl.generateMipmap(O),this._bindTextureDirectly(X,null)}_uploadArrayBufferViewToTexture(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const l=this._gl,s=V.isCube?l.TEXTURE_CUBE_MAP:l.TEXTURE_2D;this._bindTextureDirectly(s,V,!0),this._uploadDataToTextureDirectly(V,I,m,C),this._bindTextureDirectly(s,null,!0)}_prepareWebGLTextureContinuation(V,I,m,C,l){const s=this._gl;if(!s)return;const F=this._getSamplingParameters(l,!m);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,F.mag),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,F.min),m||C||s.generateMipmap(s.TEXTURE_2D),this._bindTextureDirectly(s.TEXTURE_2D,null),I&&I.removePendingData(V),V.onLoadedObservable.notifyObservers(V),V.onLoadedObservable.clear()}_prepareWebGLTexture(V,I,m,C,l,s,F,k,j,E){const K=this.getCaps().maxTextureSize,X=Math.min(K,this.needPOTTextures?(0,Y.h)(C.width,K):C.width),O=Math.min(K,this.needPOTTextures?(0,Y.h)(C.height,K):C.height),v=this._gl;v&&(V._hardwareTexture?(this._bindTextureDirectly(v.TEXTURE_2D,V,!0),this._unpackFlipY(void 0===l||!!l),V.baseWidth=C.width,V.baseHeight=C.height,V.width=X,V.height=O,V.isReady=!0,V.type=-1!==V.type?V.type:0,V.format=-1!==V.format?V.format:E??(".jpg"!==I||V._useSRGBBuffer?5:4),k(X,O,C,I,V,(()=>{this._prepareWebGLTextureContinuation(V,m,s,F,j)}))||this._prepareWebGLTextureContinuation(V,m,s,F,j)):m&&m.removePendingData(V))}_getInternalFormatFromDepthTextureFormat(V,I,m){const C=this._gl;if(!I)return C.STENCIL_INDEX8;let l=m?C.DEPTH_STENCIL:C.DEPTH_COMPONENT;return this.webGLVersion>1?15===V?l=C.DEPTH_COMPONENT16:16===V?l=C.DEPTH_COMPONENT24:17===V||13===V?l=m?C.DEPTH24_STENCIL8:C.DEPTH_COMPONENT24:14===V?l=C.DEPTH_COMPONENT32F:18===V&&(l=m?C.DEPTH32F_STENCIL8:C.DEPTH_COMPONENT32F):l=C.DEPTH_COMPONENT16,l}_getWebGLTextureTypeFromDepthTextureFormat(V){const I=this._gl;let m=I.UNSIGNED_INT;return 15===V?m=I.UNSIGNED_SHORT:17===V||13===V?m=I.UNSIGNED_INT_24_8:14===V?m=I.FLOAT:18===V?m=I.FLOAT_32_UNSIGNED_INT_24_8_REV:19===V&&(m=I.UNSIGNED_BYTE),m}_setupFramebufferDepthAttachments(V,I,m,C){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5?arguments[5]:void 0,F=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const k=this._gl;s=s??(V?13:14);const j=this._getInternalFormatFromDepthTextureFormat(s,I,V);return V&&I?this._createRenderBuffer(m,C,l,k.DEPTH_STENCIL,j,F?-1:k.DEPTH_STENCIL_ATTACHMENT):I?this._createRenderBuffer(m,C,l,j,j,F?-1:k.DEPTH_ATTACHMENT):V?this._createRenderBuffer(m,C,l,j,j,F?-1:k.STENCIL_ATTACHMENT):null}_createRenderBuffer(V,I,m,C,l,s){let F=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const k=this._gl.createRenderbuffer();return this._updateRenderBuffer(k,V,I,m,C,l,s,F)}_updateRenderBuffer(V,I,m,C,l,s,F){let k=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const j=this._gl;return j.bindRenderbuffer(j.RENDERBUFFER,V),C>1&&j.renderbufferStorageMultisample?j.renderbufferStorageMultisample(j.RENDERBUFFER,C,s,I,m):j.renderbufferStorage(j.RENDERBUFFER,l,I,m),-1!==F&&j.framebufferRenderbuffer(j.FRAMEBUFFER,F,j.RENDERBUFFER,V),k&&j.bindRenderbuffer(j.RENDERBUFFER,null),V}_releaseTexture(V){this._deleteTexture(V._hardwareTexture),this.unbindAllTextures();const I=this._internalTexturesCache.indexOf(V);-1!==I&&this._internalTexturesCache.splice(I,1),V._lodTextureHigh&&V._lodTextureHigh.dispose(),V._lodTextureMid&&V._lodTextureMid.dispose(),V._lodTextureLow&&V._lodTextureLow.dispose(),V._irradianceTexture&&V._irradianceTexture.dispose()}_deleteTexture(V){null===V||void 0===V||V.release()}_setProgram(V){this._currentProgram!==V&&((0,C.p)(V,this._gl),this._currentProgram=V)}bindSamplers(V){const I=V.getPipelineContext();this._setProgram(I.program);const m=V.getSamplers();for(let C=0;C<m.length;C++){const I=V.getUniform(m[C]);I&&(this._boundUniforms[C]=I)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(V,I){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=!1;const F=I&&I._associatedChannel>-1;m&&F&&(this._activeChannel=I._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==I||C){if(this._activateCurrentTexture(),I&&I.isMultiview)throw s.d.Error(["_bindTextureDirectly called with a multiview texture!",V,I]),"_bindTextureDirectly called with a multiview texture!";var k;this._gl.bindTexture(V,(null===I||void 0===I||null===(k=I._hardwareTexture)||void 0===k?void 0:k.underlyingResource)??null),this._boundTexturesCache[this._activeChannel]=I,I&&(I._associatedChannel=this._activeChannel)}else m&&(l=!0,this._activateCurrentTexture());return F&&!m&&this._bindSamplerUniformToChannel(I._associatedChannel,this._activeChannel),l}_bindTexture(V,I,m){if(void 0===V)return;I&&(I._associatedChannel=V),this._activeChannel=V;const C=I?this._getTextureTarget(I):this._gl.TEXTURE_2D;this._bindTextureDirectly(C,I)}unbindAllTextures(){for(let V=0;V<this._maxSimultaneousTextures;V++)this._activeChannel=V,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(V,I,m,C){void 0!==V&&(I&&(this._boundUniforms[V]=I),this._setTexture(V,m))}_bindSamplerUniformToChannel(V,I){const m=this._boundUniforms[V];m&&m._currentState!==I&&(this._gl.uniform1i(m,I),m._currentState=I)}_getTextureWrapMode(V){switch(V){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(V,I){let m,C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!I)return null!=this._boundTexturesCache[V]&&(this._activeChannel=V,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(I.video){this._activeChannel=V;const m=I.getInternalTexture();m&&(m._associatedChannel=V),I.update()}else if(4===I.delayLoadState)return I.delayLoad(),!1;m=l?I.depthStencilTexture:I.isReady()?I.getInternalTexture():I.isCube?this.emptyCubeTexture:I.is3D?this.emptyTexture3D:I.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!C&&m&&(m._associatedChannel=V);let s=!0;this._boundTexturesCache[V]===m&&(C||this._bindSamplerUniformToChannel(m._associatedChannel,V),s=!1),this._activeChannel=V;const F=this._getTextureTarget(m);if(s&&this._bindTextureDirectly(F,m,C),m&&!m.isMultiview){if(m.isCube&&m._cachedCoordinatesMode!==I.coordinatesMode){m._cachedCoordinatesMode=I.coordinatesMode;const V=3!==I.coordinatesMode&&5!==I.coordinatesMode?1:0;I.wrapU=V,I.wrapV=V}m._cachedWrapU!==I.wrapU&&(m._cachedWrapU=I.wrapU,this._setTextureParameterInteger(F,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(I.wrapU),m)),m._cachedWrapV!==I.wrapV&&(m._cachedWrapV=I.wrapV,this._setTextureParameterInteger(F,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(I.wrapV),m)),m.is3D&&m._cachedWrapR!==I.wrapR&&(m._cachedWrapR=I.wrapR,this._setTextureParameterInteger(F,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(I.wrapR),m)),this._setAnisotropicLevel(F,m,I.anisotropicFilteringLevel)}return!0}setTextureArray(V,I,m,C){if(void 0!==V&&I){this._textureUnits&&this._textureUnits.length===m.length||(this._textureUnits=new Int32Array(m.length));for(let I=0;I<m.length;I++){const C=m[I].getInternalTexture();C?(this._textureUnits[I]=V+I,C._associatedChannel=V+I):this._textureUnits[I]=-1}this._gl.uniform1iv(I,this._textureUnits);for(let V=0;V<m.length;V++)this._setTexture(this._textureUnits[V],m[V],!0)}}_setAnisotropicLevel(V,I,m){const C=this._caps.textureAnisotropicFilterExtension;11!==I.samplingMode&&3!==I.samplingMode&&2!==I.samplingMode&&(m=1),C&&I._cachedAnisotropicFilteringLevel!==m&&(this._setTextureParameterFloat(V,C.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(m,this._caps.maxAnisotropy),I),I._cachedAnisotropicFilteringLevel=m)}_setTextureParameterFloat(V,I,m,C){this._bindTextureDirectly(V,C,!0,!0),this._gl.texParameterf(V,I,m)}_setTextureParameterInteger(V,I,m,C){C&&this._bindTextureDirectly(V,C,!0,!0),this._gl.texParameteri(V,I,m)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let V=0;V<this._caps.maxVertexAttribs;V++)this.disableAttributeByIndex(V)}else for(let V=0,I=this._vertexAttribArraysEnabled.length;V<I;V++)V>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[V]||this.disableAttributeByIndex(V)}releaseEffects(){this._compiledEffects={},this.onReleaseEffectsObservable.notifyObservers(this)}dispose(){var V;((0,F.o)()&&this._renderingCanvas&&(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._onContextRestored&&this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored)),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose)&&(null===(V=this._gl.getExtension("WEBGL_lose_context"))||void 0===V||V.loseContext());(0,C.y)(this._gl)}attachContextLostEvent(V){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",V,!1)}attachContextRestoredEvent(V){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",V,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(V){const I=this._gl;for(;I.getError()!==I.NO_ERROR;);let m=!0;const C=I.createTexture();I.bindTexture(I.TEXTURE_2D,C),I.texImage2D(I.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(V),1,1,0,I.RGBA,this._getWebGLTextureType(V),null),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MIN_FILTER,I.NEAREST),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MAG_FILTER,I.NEAREST);const l=I.createFramebuffer();I.bindFramebuffer(I.FRAMEBUFFER,l),I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_2D,C,0);const s=I.checkFramebufferStatus(I.FRAMEBUFFER);if(m=m&&s===I.FRAMEBUFFER_COMPLETE,m=m&&I.getError()===I.NO_ERROR,m&&(I.clear(I.COLOR_BUFFER_BIT),m=m&&I.getError()===I.NO_ERROR),m){I.bindFramebuffer(I.FRAMEBUFFER,null);const V=I.RGBA,C=I.UNSIGNED_BYTE,l=new Uint8Array(4);I.readPixels(0,0,1,1,V,C,l),m=m&&I.getError()===I.NO_ERROR}for(I.deleteTexture(C),I.deleteFramebuffer(l),I.bindFramebuffer(I.FRAMEBUFFER,null);!m&&I.getError()!==I.NO_ERROR;);return m}_getWebGLTextureType(V){if(1===this._webGLVersion){switch(V){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(V){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=I?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(V){case 0:m=this._gl.ALPHA;break;case 1:m=this._gl.LUMINANCE;break;case 2:m=this._gl.LUMINANCE_ALPHA;break;case 6:case 33322:case 36760:m=this._gl.RED;break;case 7:case 33324:case 36761:m=this._gl.RG;break;case 4:case 32852:case 36762:m=I?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:case 32859:case 36763:m=I?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(V){case 8:m=this._gl.RED_INTEGER;break;case 9:m=this._gl.RG_INTEGER;break;case 10:m=this._gl.RGB_INTEGER;break;case 11:m=this._gl.RGBA_INTEGER}return m}_getRGBABufferInternalSizedFormat(V,I){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(1===this._webGLVersion){if(void 0!==I)switch(I){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return m?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(V){case 3:switch(I){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(I){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return m?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return m?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(I){case 8:return this._gl.R16I;case 36760:return this._gl.R16_SNORM_EXT;case 36761:return this._gl.RG16_SNORM_EXT;case 36762:return this._gl.RGB16_SNORM_EXT;case 36763:return this._gl.RGBA16_SNORM_EXT;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(I){case 8:return this._gl.R16UI;case 33322:return this._gl.R16_EXT;case 33324:return this._gl.RG16_EXT;case 32852:return this._gl.RGB16_EXT;case 32859:return this._gl.RGBA16_EXT;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(I){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(I){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(I){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(I){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(I){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return m?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(V,I,m,C){let l=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],F=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;const j=l?4:3,E=l?this._gl.RGBA:this._gl.RGB,K=m*C*j;if(k){if(k.length<K)return s.d.Error(`Data buffer is too small to store the read pixels (${k.length} should be more than ${K})`),Promise.resolve(k)}else k=new Uint8Array(K);return F&&this.flushFramebuffer(),this._gl.readPixels(V,I,m,C,E,this._gl.UNSIGNED_BYTE,k),Promise.resolve(k)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const V=X.b._CreateCanvas(1,1),I=V.getContext("webgl")||V.getContext("experimental-webgl");this._IsSupported=null!=I&&!!window.WebGLRenderingContext}catch(V){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const V=X.b._CreateCanvas(1,1),I=V.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||V.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!I}catch(V){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}n._TempClearColorUint32=new Uint32Array(4),n._TempClearColorInt32=new Int32Array(4),n.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],n._ConcatenateShader=t.h,n._IsSupported=null,n._HasMajorPerformanceCaveat=null},11626:(V,I,m)=>{var C;m.d(I,{c:()=>l}),function(V){V[V.PointerMove=0]="PointerMove",V[V.PointerDown=1]="PointerDown",V[V.PointerUp=2]="PointerUp"}(C||(C={}));class l{}l.DOM_DELTA_PIXEL=0,l.DOM_DELTA_LINE=1,l.DOM_DELTA_PAGE=2},11624:(V,I,m)=>{m.d(I,{c:()=>C,d:()=>s,g:()=>l});class C{}C.KEYDOWN=1,C.KEYUP=2;class l{constructor(V,I){this.type=V,this.event=I}}class s extends l{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(V){this.skipOnKeyboardObservable=V}constructor(V,I){super(V,I),this.type=V,this.event=I,this.skipOnKeyboardObservable=!1}}},11616:(V,I,m)=>{m.d(I,{c:()=>l,f:()=>F,h:()=>k});var C=m(11040);class l{}l.POINTERDOWN=1,l.POINTERUP=2,l.POINTERMOVE=4,l.POINTERWHEEL=8,l.POINTERPICK=16,l.POINTERTAP=32,l.POINTERDOUBLETAP=64;class s{constructor(V,I){this.type=V,this.event=I}}class F extends s{constructor(V,I,m,l){super(V,I),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new C.k(m,l)}}class k extends s{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}constructor(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(V,I),this._pickInfo=m,this._inputManager=C}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}},11708:(V,I,m)=>{m.d(I,{d:()=>X});var C=m(11206),l=m(11214),s=m(11040),F=m(11312),k=m(11337),j=m(11283),E=m(11048),K=m(11320),Y=m(11297);class X extends k.c{get range(){return this._range}set range(V){this._range=V,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(V){this._intensityMode=V,this._computePhotometricScale()}get radius(){return this._radius}set radius(V){this._radius=V,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(V){this._shadowEnabled!==V&&(this._shadowEnabled=V,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(V){this._includedOnlyMeshes=V,this._hookArrayForIncludedOnly(V)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(V){this._excludedMeshes=V,this._hookArrayForExcluded(V)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(V){this._excludeWithLayerMask=V,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(V){this._includeOnlyWithLayerMask=V,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(V){this._lightmapMode!==V&&(this._lightmapMode=V,this._markMeshesAsLightDirty())}getViewMatrix(V){return null}getProjectionMatrix(V,I){return null}constructor(V,I){super(V,I,!1),this.Yk=new F.c(1,1,1),this.oE=new F.c(1,1,1),this.falloffType=X.FALLOFF_DEFAULT,this.Kk=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=X.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.cV().addLight(this),this._uniformBuffer=new j.e(this.cV().getEngine(),void 0,void 0,V),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(V,I){return this}_bindLight(V,I,m,C){let l=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const s=V.toString();let k=!1;if(this._uniformBuffer.bindToEffect(m,"Light"+s),this._renderId!==I.getRenderId()||this._lastUseSpecular!==C||!this._uniformBuffer.useUbo){this._renderId=I.getRenderId(),this._lastUseSpecular=C;const V=this.getScaledIntensity();this.transferToEffect(m,s),this.Yk.scaleToRef(V,F.f.dY[0]),this._uniformBuffer.updateColor4("vLightDiffuse",F.f.dY[0],this.range,s),C&&(this.oE.scaleToRef(V,F.f.dY[1]),this._uniformBuffer.updateColor4("vLightSpecular",F.f.dY[1],this.radius,s)),k=!0}if(this.transferTexturesToEffect(m,s),I.shadowsEnabled&&this.shadowEnabled&&l){const V=this.getShadowGenerator(I.activeCamera)??this.getShadowGenerator();V&&(V.bindShadowLight(s,m),k=!0)}k?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(V){let I="Name: "+this.name;if(I+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let m=0;m<this.animations.length;m++)I+=", animation[0]: "+this.animations[m].toString(V);return I}_syncParentEnabledState(){super._syncParentEnabledState(),this.K()||this._resyncMeshes()}Sk(V){super.Sk(V),this._resyncMeshes()}getShadowGenerator(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(V)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return s.m.Zero()}canAffectMesh(V){return!V||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(V))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(V))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&V.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&V.layerMask)))}dispose(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const V=this._shadowGenerators.values();for(let I=V.next();!0!==I.done;I=V.next()){I.value.dispose()}this._shadowGenerators=null}if(this.cV().stopAnimation(this),this._parentContainer){const V=this._parentContainer.lights.indexOf(this);V>-1&&this._parentContainer.lights.splice(V,1),this._parentContainer=null}for(const m of this.cV().meshes)m._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.cV().removeLight(this),super.dispose(V,I)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.Kk}clone(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const m=X.GetConstructorFromName(this.getTypeID(),V,this.cV());if(!m)return null;const C=Y.d.Clone(m,this);return V&&(C.name=V),I&&(C.parent=I),C.Sk(this.isEnabled()),this.onClonedObservable.notifyObservers(C),C}serialize(){const V=Y.d.Serialize(this);if(V.uniqueId=this.uniqueId,V.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(V),this.excludedMeshes.length>0){V.excludedMeshesIds=[];for(const I of this.excludedMeshes)V.excludedMeshesIds.push(I.id)}if(this.includedOnlyMeshes.length>0){V.includedOnlyMeshesIds=[];for(const I of this.includedOnlyMeshes)V.includedOnlyMeshesIds.push(I.id)}return Y.d.AppendSerializedAnimations(this,V),V.ranges=this.serializeAnimationRanges(),V.isEnabled=this.isEnabled(),V}static GetConstructorFromName(V,I,m){const C=k.c.Construct("Light_Type_"+V,I,m);return C||null}static Parse(V,I){const m=X.GetConstructorFromName(V.type,V.name,I);if(!m)return null;const C=Y.d.Parse(m,V,I);if(V.excludedMeshesIds&&(C._excludedMeshesIds=V.excludedMeshesIds),V.includedOnlyMeshesIds&&(C._includedOnlyMeshesIds=V.includedOnlyMeshesIds),void 0!==V.parentId&&(C._waitingParentId=V.parentId),void 0!==V.parentInstanceIndex&&(C._waitingParentInstanceIndex=V.parentInstanceIndex),void 0!==V.falloffType&&(C.falloffType=V.falloffType),void 0!==V.lightmapMode&&(C.lightmapMode=V.lightmapMode),V.animations){for(let I=0;I<V.animations.length;I++){const m=V.animations[I],l=(0,E.d)("BABYLON.Animation");l&&C.animations.push(l.Parse(m))}k.c.ParseAnimationRanges(C,V,I)}return V.autoAnimate&&I.beginAnimation(C,V.autoAnimateFrom,V.autoAnimateTo,V.autoAnimateLoop,V.autoAnimateSpeed||1),void 0!==V.isEnabled&&C.Sk(V.isEnabled),C}_hookArrayForExcluded(V){var I=this;const m=V.push;V.push=function(){for(var C=arguments.length,l=new Array(C),s=0;s<C;s++)l[s]=arguments[s];const F=m.apply(V,l);for(const V of l)V._resyncLightSource(I);return F};const C=V.splice;V.splice=(I,m)=>{const l=C.apply(V,[I,m]);for(const V of l)V._resyncLightSource(this);return l};for(const l of V)l._resyncLightSource(this)}_hookArrayForIncludedOnly(V){var I=this;const m=V.push;V.push=function(){for(var C=arguments.length,l=new Array(C),s=0;s<C;s++)l[s]=arguments[s];const F=m.apply(V,l);return I._resyncMeshes(),F};const C=V.splice;V.splice=(I,m)=>{const l=C.apply(V,[I,m]);return this._resyncMeshes(),l},this._resyncMeshes()}_resyncMeshes(){for(const V of this.cV().meshes)V._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const V of this.cV().meshes)-1!==V.lightSources.indexOf(this)&&V._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.cV().resetCachedMaterial()}_getPhotometricScale(){let V=0;const I=this.getTypeID();let m=this.intensityMode;switch(m===X.INTENSITYMODE_AUTOMATIC&&(m=I===X.LIGHTTYPEID_DIRECTIONALLIGHT?X.INTENSITYMODE_ILLUMINANCE:X.INTENSITYMODE_LUMINOUSINTENSITY),I){case X.LIGHTTYPEID_POINTLIGHT:case X.LIGHTTYPEID_SPOTLIGHT:switch(m){case X.INTENSITYMODE_LUMINOUSPOWER:V=1/(4*Math.PI);break;case X.INTENSITYMODE_LUMINOUSINTENSITY:V=1;break;case X.INTENSITYMODE_LUMINANCE:V=this.radius*this.radius}break;case X.LIGHTTYPEID_DIRECTIONALLIGHT:switch(m){case X.INTENSITYMODE_ILLUMINANCE:V=1;break;case X.INTENSITYMODE_LUMINANCE:{let I=this.radius;I=Math.max(I,.001);V=2*Math.PI*(1-Math.cos(I));break}}break;case X.LIGHTTYPEID_HEMISPHERICLIGHT:V=1}return V}_reorderLightsInScene(){const V=this.cV();0!=this._renderPriority&&(V.requireLightSorting=!0),this.cV().sortLightsByPriority()}_isReady(){return!0}}X.FALLOFF_DEFAULT=K.b.FALLOFF_DEFAULT,X.FALLOFF_PHYSICAL=K.b.FALLOFF_PHYSICAL,X.FALLOFF_GLTF=K.b.FALLOFF_GLTF,X.FALLOFF_STANDARD=K.b.FALLOFF_STANDARD,X.LIGHTMAP_DEFAULT=K.b.LIGHTMAP_DEFAULT,X.LIGHTMAP_SPECULAR=K.b.LIGHTMAP_SPECULAR,X.LIGHTMAP_SHADOWSONLY=K.b.LIGHTMAP_SHADOWSONLY,X.INTENSITYMODE_AUTOMATIC=K.b.INTENSITYMODE_AUTOMATIC,X.INTENSITYMODE_LUMINOUSPOWER=K.b.INTENSITYMODE_LUMINOUSPOWER,X.INTENSITYMODE_LUMINOUSINTENSITY=K.b.INTENSITYMODE_LUMINOUSINTENSITY,X.INTENSITYMODE_ILLUMINANCE=K.b.INTENSITYMODE_ILLUMINANCE,X.INTENSITYMODE_LUMINANCE=K.b.INTENSITYMODE_LUMINANCE,X.LIGHTTYPEID_POINTLIGHT=K.b.LIGHTTYPEID_POINTLIGHT,X.LIGHTTYPEID_DIRECTIONALLIGHT=K.b.LIGHTTYPEID_DIRECTIONALLIGHT,X.LIGHTTYPEID_SPOTLIGHT=K.b.LIGHTTYPEID_SPOTLIGHT,X.LIGHTTYPEID_HEMISPHERICLIGHT=K.b.LIGHTTYPEID_HEMISPHERICLIGHT,X.LIGHTTYPEID_RECT_AREALIGHT=K.b.LIGHTTYPEID_RECT_AREALIGHT,(0,C.d)([(0,l.e)()],X.prototype,"diffuse",void 0),(0,C.d)([(0,l.e)()],X.prototype,"specular",void 0),(0,C.d)([(0,l.B)()],X.prototype,"falloffType",void 0),(0,C.d)([(0,l.B)()],X.prototype,"intensity",void 0),(0,C.d)([(0,l.B)()],X.prototype,"range",null),(0,C.d)([(0,l.B)()],X.prototype,"intensityMode",null),(0,C.d)([(0,l.B)()],X.prototype,"radius",null),(0,C.d)([(0,l.B)()],X.prototype,"_renderPriority",void 0),(0,C.d)([(0,l.b)("_reorderLightsInScene")],X.prototype,"renderPriority",void 0),(0,C.d)([(0,l.B)("shadowEnabled")],X.prototype,"_shadowEnabled",void 0),(0,C.d)([(0,l.B)("excludeWithLayerMask")],X.prototype,"_excludeWithLayerMask",void 0),(0,C.d)([(0,l.B)("includeOnlyWithLayerMask")],X.prototype,"_includeOnlyWithLayerMask",void 0),(0,C.d)([(0,l.B)("lightmapMode")],X.prototype,"_lightmapMode",void 0)},11320:(V,I,m)=>{m.d(I,{b:()=>C});class C{static CompareLightsPriority(V,I){return V.shadowEnabled!==I.shadowEnabled?(I.shadowEnabled?1:0)-(V.shadowEnabled?1:0):I.renderPriority-V.renderPriority}}C.FALLOFF_DEFAULT=0,C.FALLOFF_PHYSICAL=1,C.FALLOFF_GLTF=2,C.FALLOFF_STANDARD=3,C.LIGHTMAP_DEFAULT=0,C.LIGHTMAP_SPECULAR=1,C.LIGHTMAP_SHADOWSONLY=2,C.INTENSITYMODE_AUTOMATIC=0,C.INTENSITYMODE_LUMINOUSPOWER=1,C.INTENSITYMODE_LUMINOUSINTENSITY=2,C.INTENSITYMODE_ILLUMINANCE=3,C.INTENSITYMODE_LUMINANCE=4,C.LIGHTTYPEID_POINTLIGHT=0,C.LIGHTTYPEID_DIRECTIONALLIGHT=1,C.LIGHTTYPEID_SPOTLIGHT=2,C.LIGHTTYPEID_HEMISPHERICLIGHT=3,C.LIGHTTYPEID_RECT_AREALIGHT=4},11776:(V,I,m)=>{m.d(I,{c:()=>j});var C=m(11206),l=m(11214),s=m(11040),F=m(11708),k=m(11372);class j extends F.d{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=s.b.Identity(),this._projectionMatrix=s.b.Identity()}_setPosition(V){this._position=V}get position(){return this._position}set position(V){this._setPosition(V)}_setDirection(V){this._direction=V}get direction(){return this._direction}set direction(V){this._setDirection(V)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(V){this._shadowMinZ=V,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(V){this._shadowMaxZ=V,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=s.m.Zero()),s.m.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=s.m.Zero()),s.m.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(V){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(V){return this.direction=s.m.Normalize(V.Fm(this.position)),this.direction}getRotation(){this.direction.normalize();const V=s.m.Cross(this.direction,k.c.Y),I=s.m.Cross(V,this.direction);return s.m.RotationFromAxis(V,I,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=s.m.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}fF(V){return!V&&this.isSynchronized()?(this._currentRenderId=this.cV().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.C(this.position),this._worldMatrix||(this._worldMatrix=s.b.Identity()),s.b.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(V){return void 0!==this.shadowMinZ?this.shadowMinZ:(null===V||void 0===V?void 0:V.Fk)||0}getDepthMaxZ(V){return void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===V||void 0===V?void 0:V.maxZ)||1e4}setShadowProjectionMatrix(V,I,m){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(I,m,V):this._setDefaultShadowProjectionMatrix(V,I,m),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(V){const I=s.g.LF[0];let m=this.position;this.computeTransformedInformation()&&(m=this.transformedPosition),s.m.NormalizeToRef(this.getShadowDirection(V),I),1===Math.abs(s.m.Dot(I,s.m.Up()))&&(I.z=1e-13);const C=s.g.LF[1];return m.addToRef(I,C),s.b.LookAtLHToRef(m,C,s.m.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(V,I){return this.setShadowProjectionMatrix(this._projectionMatrix,V??this._viewMatrix,I??[]),this._projectionMatrix}}(0,C.d)([(0,l.x)()],j.prototype,"position",null),(0,C.d)([(0,l.x)()],j.prototype,"direction",null),(0,C.d)([(0,l.B)()],j.prototype,"shadowMinZ",null),(0,C.d)([(0,l.B)()],j.prototype,"shadowMaxZ",null)},11409:(V,I,m)=>{m.d(I,{d:()=>C});class C{static get ForceFullSceneLoadingForIncremental(){return C._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(V){C._ForceFullSceneLoadingForIncremental=V}static get ShowLoadingScreen(){return C._ShowLoadingScreen}static set ShowLoadingScreen(V){C._ShowLoadingScreen=V}static get loggingLevel(){return C._LoggingLevel}static set loggingLevel(V){C._LoggingLevel=V}static get CleanBoneMatrixWeights(){return C._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(V){C._CleanBoneMatrixWeights=V}}C._ForceFullSceneLoadingForIncremental=!1,C._ShowLoadingScreen=!0,C._CleanBoneMatrixWeights=!1,C._LoggingLevel=0},11587:(V,I,m)=>{m.d(I,{b:()=>P});var C=m(11206),l=m(11214),s=m(11085),F=m(11389),k=m(11574),j=m(11596),E=m(11040),K=m(11233),Y=m(11642),X=m(11649);class O extends Y.c{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1,this.MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,this.LEGACY_SPECULAR_ENERGY_CONSERVATION=!1,this.BASE_DIFFUSE_MODEL=0,this.DIELECTRIC_SPECULAR_MODEL=0,this.CONDUCTOR_SPECULAR_MODEL=0}}class v extends X.b{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(V,"PBRBRDF",90,new O,I),this._useEnergyConservation=v.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=v.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=v.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=v.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=v.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=v.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=v.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=v.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._mixIblRadianceWithIrradiance=v.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this.mixIblRadianceWithIrradiance=v.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this._useLegacySpecularEnergyConservation=v.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this.useLegacySpecularEnergyConservation=v.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this._baseDiffuseModel=v.DEFAULT_DIFFUSE_MODEL,this.baseDiffuseModel=v.DEFAULT_DIFFUSE_MODEL,this._dielectricSpecularModel=v.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this.dielectricSpecularModel=v.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this._conductorSpecularModel=v.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this.conductorSpecularModel=v.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this._internalMarkAllSubMeshesAsMiscDirty=V._dirtyCallbacks[16],this._enable(!0)}prepareDefines(V){V.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,V.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,V.SPHERICAL_HARMONICS=this._useSphericalHarmonics,V.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation,V.MIX_IBL_RADIANCE_WITH_IRRADIANCE=this._mixIblRadianceWithIrradiance,V.LEGACY_SPECULAR_ENERGY_CONSERVATION=this._useLegacySpecularEnergyConservation,V.BASE_DIFFUSE_MODEL=this._baseDiffuseModel,V.DIELECTRIC_SPECULAR_MODEL=this._dielectricSpecularModel,V.CONDUCTOR_SPECULAR_MODEL=this._conductorSpecularModel}getClassName(){return"PBRBRDFConfiguration"}}v.DEFAULT_USE_ENERGY_CONSERVATION=!0,v.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,v.DEFAULT_USE_SPHERICAL_HARMONICS=!0,v.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,v.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,v.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION=!0,v.DEFAULT_DIFFUSE_MODEL=0,v.DEFAULT_DIELECTRIC_SPECULAR_MODEL=0,v.DEFAULT_CONDUCTOR_SPECULAR_MODEL=0,(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsMiscDirty")],v.prototype,"useEnergyConservation",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsMiscDirty")],v.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsMiscDirty")],v.prototype,"useSphericalHarmonics",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsMiscDirty")],v.prototype,"useSpecularGlossinessInputEnergyConservation",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsMiscDirty")],v.prototype,"mixIblRadianceWithIrradiance",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsMiscDirty")],v.prototype,"useLegacySpecularEnergyConservation",void 0),(0,C.d)([(0,l.B)("baseDiffuseModel"),(0,l.b)("_markAllSubMeshesAsMiscDirty")],v.prototype,"baseDiffuseModel",void 0),(0,C.d)([(0,l.B)("dielectricSpecularModel"),(0,l.b)("_markAllSubMeshesAsMiscDirty")],v.prototype,"dielectricSpecularModel",void 0),(0,C.d)([(0,l.B)("conductorSpecularModel"),(0,l.b)("_markAllSubMeshesAsMiscDirty")],v.prototype,"conductorSpecularModel",void 0);var N=m(11658),t=m(11312),D=m(11605),b=m(11202),T=m(11661),n=m(11518),x=m(11667),S=(m(11674),m(11681)),c=m(11316);class H extends Y.c{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class y extends X.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(V,"PBRClearCoat",100,new H,I),this._isEnabled=!1,this.isEnabled=!1,this.Kk=1,this.roughness=0,this._indexOfRefraction=y._DefaultIndexOfRefraction,this.indexOfRefraction=y._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=t.c.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=V._dirtyCallbacks[1]}isReadyForSubMesh(V,I,m){if(!this._isEnabled)return!0;const C=this._material._disableBumpMap;if(V._areTexturesDirty&&I.texturesEnabled){if(this._texture&&x.d.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&x.d.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(m.getCaps().standardDerivatives&&this._bumpTexture&&x.d.ClearCoatBumpTextureEnabled&&!C&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&x.d.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(V,I){this._isEnabled?(V.CLEARCOAT=!0,V.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,V.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,V._areTexturesDirty&&I.texturesEnabled&&(this._texture&&x.d.ClearCoatTextureEnabled?(0,c.R)(this._texture,V,"CLEARCOAT_TEXTURE"):V.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&x.d.ClearCoatTextureEnabled?(0,c.R)(this._textureRoughness,V,"CLEARCOAT_TEXTURE_ROUGHNESS"):V.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&x.d.ClearCoatBumpTextureEnabled?(0,c.R)(this._bumpTexture,V,"CLEARCOAT_BUMP"):V.CLEARCOAT_BUMP=!1,V.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===y._DefaultIndexOfRefraction,this._isTintEnabled?(V.CLEARCOAT_TINT=!0,this._tintTexture&&x.d.ClearCoatTintTextureEnabled?((0,c.R)(this._tintTexture,V,"CLEARCOAT_TINT_TEXTURE"),V.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):V.CLEARCOAT_TINT_TEXTURE=!1):(V.CLEARCOAT_TINT=!1,V.CLEARCOAT_TINT_TEXTURE=!1))):(V.CLEARCOAT=!1,V.CLEARCOAT_TEXTURE=!1,V.CLEARCOAT_TEXTURE_ROUGHNESS=!1,V.CLEARCOAT_BUMP=!1,V.CLEARCOAT_TINT=!1,V.CLEARCOAT_TINT_TEXTURE=!1,V.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,V.CLEARCOAT_DEFAULTIOR=!1,V.CLEARCOAT_TEXTUREDIRECTUV=0,V.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,V.CLEARCOAT_BUMPDIRECTUV=0,V.CLEARCOAT_REMAP_F0=!1,V.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,V.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(V,I,m,C){if(!this._isEnabled)return;const l=C.materialDefines,s=this._material.isFrozen,F=this._material._disableBumpMap,k=this._material._invertNormalMapX,j=this._material._invertNormalMapY;if(!V.useUbo||!s||!V.isSync){var E,K,Y,X;if((this._texture||this._textureRoughness)&&x.d.ClearCoatTextureEnabled)V.updateFloat4("vClearCoatInfos",(null===(E=this._texture)||void 0===E?void 0:E.coordinatesIndex)??0,(null===(K=this._texture)||void 0===K?void 0:K.level)??0,(null===(Y=this._textureRoughness)||void 0===Y?void 0:Y.coordinatesIndex)??0,(null===(X=this._textureRoughness)||void 0===X?void 0:X.level)??0),this._texture&&(0,c.u)(this._texture,V,"clearCoat"),this._textureRoughness&&!l.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,c.u)(this._textureRoughness,V,"clearCoatRoughness");this._bumpTexture&&m.getCaps().standardDerivatives&&x.d.ClearCoatTextureEnabled&&!F&&(V.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,c.u)(this._bumpTexture,V,"clearCoatBump"),I._mirroredCameraPosition?V.updateFloat2("vClearCoatTangentSpaceParams",k?1:-1,j?1:-1):V.updateFloat2("vClearCoatTangentSpaceParams",k?-1:1,j?-1:1)),this._tintTexture&&x.d.ClearCoatTintTextureEnabled&&(V.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,c.u)(this._tintTexture,V,"clearCoatTint")),V.updateFloat2("vClearCoatParams",this.Kk,this.roughness);const C=1-this._indexOfRefraction,s=1+this._indexOfRefraction,O=Math.pow(-C/s,2),v=1/this._indexOfRefraction;V.updateFloat4("vClearCoatRefractionParams",O,v,C,s),this._isTintEnabled&&(V.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),V.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}I.texturesEnabled&&(this._texture&&x.d.ClearCoatTextureEnabled&&V.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!l.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&x.d.ClearCoatTextureEnabled&&V.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&m.getCaps().standardDerivatives&&x.d.ClearCoatBumpTextureEnabled&&!F&&V.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&x.d.ClearCoatTintTextureEnabled&&V.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(V){return this._texture===V||(this._textureRoughness===V||(this._bumpTexture===V||this._tintTexture===V))}getActiveTextures(V){this._texture&&V.push(this._texture),this._textureRoughness&&V.push(this._textureRoughness),this._bumpTexture&&V.push(this._bumpTexture),this._tintTexture&&V.push(this._tintTexture)}getAnimatables(V){this._texture&&this._texture.animations&&this._texture.animations.length>0&&V.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&V.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&V.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&V.push(this._tintTexture)}dispose(V){var I,m,C,l;V&&(null===(I=this._texture)||void 0===I||I.dispose(),null===(m=this._textureRoughness)||void 0===m||m.dispose(),null===(C=this._bumpTexture)||void 0===C||C.dispose(),null===(l=this._tintTexture)||void 0===l||l.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(V,I,m){return V.CLEARCOAT_BUMP&&I.addFallback(m++,"CLEARCOAT_BUMP"),V.CLEARCOAT_TINT&&I.addFallback(m++,"CLEARCOAT_TINT"),V.CLEARCOAT&&I.addFallback(m++,"CLEARCOAT"),m}getSamplers(V){V.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}y._DefaultIndexOfRefraction=1.5,(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"isEnabled",void 0),(0,C.d)([(0,l.B)()],y.prototype,"intensity",void 0),(0,C.d)([(0,l.B)()],y.prototype,"roughness",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"indexOfRefraction",void 0),(0,C.d)([(0,l.s)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"texture",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useRoughnessFromMainTexture",void 0),(0,C.d)([(0,l.s)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"textureRoughness",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"remapF0OnInterfaceChange",void 0),(0,C.d)([(0,l.s)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"bumpTexture",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"isTintEnabled",void 0),(0,C.d)([(0,l.e)()],y.prototype,"tintColor",void 0),(0,C.d)([(0,l.B)()],y.prototype,"tintColorAtDistance",void 0),(0,C.d)([(0,l.B)()],y.prototype,"tintThickness",void 0),(0,C.d)([(0,l.s)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"tintTexture",void 0);class z extends Y.c{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class Z extends X.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(V,"PBRIridescence",110,new z,I),this._isEnabled=!1,this.isEnabled=!1,this.Kk=1,this.minimumThickness=Z._DefaultMinimumThickness,this.maximumThickness=Z._DefaultMaximumThickness,this.indexOfRefraction=Z._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=V._dirtyCallbacks[1]}isReadyForSubMesh(V,I){if(!this._isEnabled)return!0;if(V._areTexturesDirty&&I.texturesEnabled){if(this._texture&&x.d.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&x.d.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(V,I){this._isEnabled?(V.IRIDESCENCE=!0,V._areTexturesDirty&&I.texturesEnabled&&(this._texture&&x.d.IridescenceTextureEnabled?(0,c.R)(this._texture,V,"IRIDESCENCE_TEXTURE"):V.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&x.d.IridescenceTextureEnabled?(0,c.R)(this._thicknessTexture,V,"IRIDESCENCE_THICKNESS_TEXTURE"):V.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(V.IRIDESCENCE=!1,V.IRIDESCENCE_TEXTURE=!1,V.IRIDESCENCE_THICKNESS_TEXTURE=!1,V.IRIDESCENCE_TEXTUREDIRECTUV=0,V.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(V,I){if(!this._isEnabled)return;const m=this._material.isFrozen;if(!V.useUbo||!m||!V.isSync){var C,l,s,F;if((this._texture||this._thicknessTexture)&&x.d.IridescenceTextureEnabled)V.updateFloat4("vIridescenceInfos",(null===(C=this._texture)||void 0===C?void 0:C.coordinatesIndex)??0,(null===(l=this._texture)||void 0===l?void 0:l.level)??0,(null===(s=this._thicknessTexture)||void 0===s?void 0:s.coordinatesIndex)??0,(null===(F=this._thicknessTexture)||void 0===F?void 0:F.level)??0),this._texture&&(0,c.u)(this._texture,V,"iridescence"),this._thicknessTexture&&(0,c.u)(this._thicknessTexture,V,"iridescenceThickness");V.updateFloat4("vIridescenceParams",this.Kk,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}I.texturesEnabled&&(this._texture&&x.d.IridescenceTextureEnabled&&V.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&x.d.IridescenceTextureEnabled&&V.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(V){return this._texture===V||this._thicknessTexture===V}getActiveTextures(V){this._texture&&V.push(this._texture),this._thicknessTexture&&V.push(this._thicknessTexture)}getAnimatables(V){this._texture&&this._texture.animations&&this._texture.animations.length>0&&V.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&V.push(this._thicknessTexture)}dispose(V){var I,m;V&&(null===(I=this._texture)||void 0===I||I.dispose(),null===(m=this._thicknessTexture)||void 0===m||m.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(V,I,m){return V.IRIDESCENCE&&I.addFallback(m++,"IRIDESCENCE"),m}getSamplers(V){V.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}Z._DefaultMinimumThickness=100,Z._DefaultMaximumThickness=400,Z._DefaultIndexOfRefraction=1.3,(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"isEnabled",void 0),(0,C.d)([(0,l.B)()],Z.prototype,"intensity",void 0),(0,C.d)([(0,l.B)()],Z.prototype,"minimumThickness",void 0),(0,C.d)([(0,l.B)()],Z.prototype,"maximumThickness",void 0),(0,C.d)([(0,l.B)()],Z.prototype,"indexOfRefraction",void 0),(0,C.d)([(0,l.s)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"texture",void 0),(0,C.d)([(0,l.s)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"thicknessTexture",void 0);class B extends Y.c{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class W extends X.b{set angle(V){this.direction.x=Math.cos(V),this.direction.y=Math.sin(V)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(V,"PBRAnisotropic",110,new B,I),this._isEnabled=!1,this.isEnabled=!1,this.Kk=1,this.direction=new E.k(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=V._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=V._dirtyCallbacks[16]}isReadyForSubMesh(V,I){return!this._isEnabled||!(V._areTexturesDirty&&I.texturesEnabled&&this._texture&&x.d.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(V,I,m){this._isEnabled?(V.ANISOTROPIC=this._isEnabled,this._isEnabled&&!m.isVerticesDataPresent(K.e.TangentKind)&&(V._needUVs=!0,V.MAINUV1=!0),V._areTexturesDirty&&I.texturesEnabled&&(this._texture&&x.d.AnisotropicTextureEnabled?(0,c.R)(this._texture,V,"ANISOTROPIC_TEXTURE"):V.ANISOTROPIC_TEXTURE=!1),V._areMiscDirty&&(V.ANISOTROPIC_LEGACY=this._legacy)):(V.ANISOTROPIC=!1,V.ANISOTROPIC_TEXTURE=!1,V.ANISOTROPIC_TEXTUREDIRECTUV=0,V.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(V,I){if(!this._isEnabled)return;const m=this._material.isFrozen;V.useUbo&&m&&V.isSync||(this._texture&&x.d.AnisotropicTextureEnabled&&(V.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,c.u)(this._texture,V,"anisotropy")),V.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.Kk)),I.texturesEnabled&&this._texture&&x.d.AnisotropicTextureEnabled&&V.setTexture("anisotropySampler",this._texture)}hasTexture(V){return this._texture===V}getActiveTextures(V){this._texture&&V.push(this._texture)}getAnimatables(V){this._texture&&this._texture.animations&&this._texture.animations.length>0&&V.push(this._texture)}dispose(V){V&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(V,I,m){return V.ANISOTROPIC&&I.addFallback(m++,"ANISOTROPIC"),m}getSamplers(V){V.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(V,I,m){super.parse(V,I,m),void 0===V.legacy&&(this.legacy=!0)}}(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"isEnabled",void 0),(0,C.d)([(0,l.B)()],W.prototype,"intensity",void 0),(0,C.d)([(0,l.w)()],W.prototype,"direction",void 0),(0,C.d)([(0,l.s)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"texture",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsMiscDirty")],W.prototype,"legacy",void 0);class Q extends Y.c{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class G extends X.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(V,"Sheen",120,new Q,I),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.Kk=1,this.color=t.c.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=V._dirtyCallbacks[1]}isReadyForSubMesh(V,I){if(!this._isEnabled)return!0;if(V._areTexturesDirty&&I.texturesEnabled){if(this._texture&&x.d.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&x.d.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(V,I){this._isEnabled?(V.SHEEN=!0,V.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,V.SHEEN_ROUGHNESS=null!==this._roughness,V.SHEEN_ALBEDOSCALING=this._albedoScaling,V.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,V._areTexturesDirty&&I.texturesEnabled&&(this._texture&&x.d.SheenTextureEnabled?((0,c.R)(this._texture,V,"SHEEN_TEXTURE"),V.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):V.SHEEN_TEXTURE=!1,this._textureRoughness&&x.d.SheenTextureEnabled?(0,c.R)(this._textureRoughness,V,"SHEEN_TEXTURE_ROUGHNESS"):V.SHEEN_TEXTURE_ROUGHNESS=!1)):(V.SHEEN=!1,V.SHEEN_TEXTURE=!1,V.SHEEN_TEXTURE_ROUGHNESS=!1,V.SHEEN_LINKWITHALBEDO=!1,V.SHEEN_ROUGHNESS=!1,V.SHEEN_ALBEDOSCALING=!1,V.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,V.SHEEN_GAMMATEXTURE=!1,V.SHEEN_TEXTUREDIRECTUV=0,V.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(V,I,m,C){if(!this._isEnabled)return;const l=C.materialDefines,s=this._material.isFrozen;if(!V.useUbo||!s||!V.isSync){var F,k,j,E;if((this._texture||this._textureRoughness)&&x.d.SheenTextureEnabled)V.updateFloat4("vSheenInfos",(null===(F=this._texture)||void 0===F?void 0:F.coordinatesIndex)??0,(null===(k=this._texture)||void 0===k?void 0:k.level)??0,(null===(j=this._textureRoughness)||void 0===j?void 0:j.coordinatesIndex)??0,(null===(E=this._textureRoughness)||void 0===E?void 0:E.level)??0),this._texture&&(0,c.u)(this._texture,V,"sheen"),this._textureRoughness&&!l.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,c.u)(this._textureRoughness,V,"sheenRoughness");V.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.Kk),null!==this._roughness&&V.updateFloat("vSheenRoughness",this._roughness)}I.texturesEnabled&&(this._texture&&x.d.SheenTextureEnabled&&V.setTexture("sheenSampler",this._texture),this._textureRoughness&&!l.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&x.d.SheenTextureEnabled&&V.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(V){return this._texture===V||this._textureRoughness===V}getActiveTextures(V){this._texture&&V.push(this._texture),this._textureRoughness&&V.push(this._textureRoughness)}getAnimatables(V){this._texture&&this._texture.animations&&this._texture.animations.length>0&&V.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&V.push(this._textureRoughness)}dispose(V){var I,m;V&&(null===(I=this._texture)||void 0===I||I.dispose(),null===(m=this._textureRoughness)||void 0===m||m.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(V,I,m){return V.SHEEN&&I.addFallback(m++,"SHEEN"),m}getSamplers(V){V.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"isEnabled",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"linkSheenWithAlbedo",void 0),(0,C.d)([(0,l.B)()],G.prototype,"intensity",void 0),(0,C.d)([(0,l.e)()],G.prototype,"color",void 0),(0,C.d)([(0,l.s)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"texture",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"useRoughnessFromMainTexture",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"roughness",void 0),(0,C.d)([(0,l.s)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"textureRoughness",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"albedoScaling",void 0);class r extends Y.c{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1,this.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1,this.SS_TRANSLUCENCY_LEGACY=!1}}class g extends X.b{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(V){this._scene.enableSubSurfaceForPrePass()&&V&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(V))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(V){this._volumeIndexOfRefraction=V>=1?V:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(V,"PBRSubSurface",130,new r,I),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=t.c.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=t.c.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this.applyAlbedoAfterSubSurface=g.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE,this.legacyTransluceny=g.DEFAULT_LEGACY_TRANSLUCENCY,this._scene=V.cV(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=V._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=V._dirtyCallbacks[32]}isReadyForSubMesh(V,I){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(V._areTexturesDirty&&I.texturesEnabled){if(this._thicknessTexture&&x.d.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&x.d.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&x.d.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const V=this._getRefractionTexture(I);if(V&&x.d.RefractionTextureEnabled&&!V.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(V,I){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return V.SUBSURFACE=!1,V.SS_DISPERSION=!1,V.SS_TRANSLUCENCY=!1,V.SS_SCATTERING=!1,V.SS_REFRACTION=!1,V.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,V.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,V.SS_THICKNESSANDMASK_TEXTURE=!1,V.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,V.SS_HAS_THICKNESS=!1,V.SS_REFRACTIONINTENSITY_TEXTURE=!1,V.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,V.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,V.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,V.SS_REFRACTIONMAP_3D=!1,V.SS_REFRACTIONMAP_OPPOSITEZ=!1,V.SS_LODINREFRACTIONALPHA=!1,V.SS_GAMMAREFRACTION=!1,V.SS_RGBDREFRACTION=!1,V.SS_LINEARSPECULARREFRACTION=!1,V.SS_LINKREFRACTIONTOTRANSPARENCY=!1,V.SS_ALBEDOFORREFRACTIONTINT=!1,V.SS_ALBEDOFORTRANSLUCENCYTINT=!1,V.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,V.SS_USE_THICKNESS_AS_DEPTH=!1,V.SS_USE_GLTF_TEXTURES=!1,V.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,V.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,V.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,void(V.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1);if(V._areTexturesDirty){if(V.SUBSURFACE=!0,V.SS_DISPERSION=this._isDispersionEnabled,V.SS_TRANSLUCENCY=this._isTranslucencyEnabled,V.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,V.SS_TRANSLUCENCY_LEGACY=this.legacyTransluceny,V.SS_SCATTERING=this._isScatteringEnabled,V.SS_THICKNESSANDMASK_TEXTURE=!1,V.SS_REFRACTIONINTENSITY_TEXTURE=!1,V.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,V.SS_HAS_THICKNESS=!1,V.SS_USE_GLTF_TEXTURES=!1,V.SS_REFRACTION=!1,V.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,V.SS_REFRACTIONMAP_3D=!1,V.SS_GAMMAREFRACTION=!1,V.SS_RGBDREFRACTION=!1,V.SS_LINEARSPECULARREFRACTION=!1,V.SS_REFRACTIONMAP_OPPOSITEZ=!1,V.SS_LODINREFRACTIONALPHA=!1,V.SS_LINKREFRACTIONTOTRANSPARENCY=!1,V.SS_ALBEDOFORREFRACTIONTINT=!1,V.SS_ALBEDOFORTRANSLUCENCYTINT=!1,V.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,V.SS_USE_THICKNESS_AS_DEPTH=!1,V.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,V.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=this.applyAlbedoAfterSubSurface,V._areTexturesDirty&&I.texturesEnabled&&(this._thicknessTexture&&x.d.ThicknessTextureEnabled&&(0,c.R)(this._thicknessTexture,V,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&x.d.RefractionIntensityTextureEnabled&&(0,c.R)(this._refractionIntensityTexture,V,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&x.d.TranslucencyIntensityTextureEnabled&&(0,c.R)(this._translucencyIntensityTexture,V,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&x.d.TranslucencyColorTextureEnabled&&((0,c.R)(this._translucencyColorTexture,V,"SS_TRANSLUCENCYCOLOR_TEXTURE"),V.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=this._translucencyColorTexture.gammaSpace)),V.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,V.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,V.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,V.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&I.texturesEnabled){const m=this._getRefractionTexture(I);m&&x.d.RefractionTextureEnabled&&(V.SS_REFRACTION=!0,V.SS_REFRACTIONMAP_3D=m.isCube,V.SS_GAMMAREFRACTION=m.gammaSpace,V.SS_RGBDREFRACTION=m.isRGBD,V.SS_LINEARSPECULARREFRACTION=m.linearSpecularLOD,V.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&m.isCube?!m.invertZ:m.invertZ,V.SS_LODINREFRACTIONALPHA=m.lodLevelInAlpha,V.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,V.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,V.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=m.isCube&&m.boundingBoxSize,V.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(V.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(V,I,m,C){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)V.updateFloat2("vThicknessParam",0,0);else{C.getRenderingMesh().getWorldMatrix().decompose(E.g.LF[0]);const I=Math.max(Math.abs(E.g.LF[0].x),Math.abs(E.g.LF[0].y),Math.abs(E.g.LF[0].z));V.updateFloat2("vThicknessParam",this.minimumThickness*I,(this.maximumThickness-this.minimumThickness)*I)}}bindForSubMesh(V,I,m,C){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const l=C.materialDefines,s=this._material.isFrozen,F=this._material.realTimeFiltering,k=l.LODBASEDMICROSFURACE,j=this._getRefractionTexture(I);if(!V.useUbo||!s||!V.isSync){if(this._thicknessTexture&&x.d.ThicknessTextureEnabled&&(V.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,c.u)(this._thicknessTexture,V,"thickness")),this._refractionIntensityTexture&&x.d.RefractionIntensityTextureEnabled&&l.SS_REFRACTIONINTENSITY_TEXTURE&&(V.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,c.u)(this._refractionIntensityTexture,V,"refractionIntensity")),this._translucencyColorTexture&&x.d.TranslucencyColorTextureEnabled&&l.SS_TRANSLUCENCYCOLOR_TEXTURE&&(V.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,c.u)(this._translucencyColorTexture,V,"translucencyColor")),this._translucencyIntensityTexture&&x.d.TranslucencyIntensityTextureEnabled&&l.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(V.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,c.u)(this._translucencyIntensityTexture,V,"translucencyIntensity")),j&&x.d.RefractionTextureEnabled){V.lk("refractionMatrix",j.getRefractionTextureMatrix());let I=1;j.isCube||j.depth&&(I=j.depth);const m=j.getSize().width,C=this.volumeIndexOfRefraction;if(V.updateFloat4("vRefractionInfos",j.level,1/C,I,this._invertRefractionY?-1:1),V.updateFloat4("vRefractionMicrosurfaceInfos",m,j.lodGenerationScale,j.lodGenerationOffset,1/this.indexOfRefraction),F&&V.updateFloat2("vRefractionFilteringInfo",m,Math.log2(m)),j.boundingBoxSize){const I=j;V.updateVector3("vRefractionPosition",I.boundingBoxPosition),V.updateVector3("vRefractionSize",I.boundingBoxSize)}}this._isScatteringEnabled&&V.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),V.updateColor3("vDiffusionDistance",this.diffusionDistance),V.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),V.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),V.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),V.updateFloat("dispersion",this.dispersion)}I.texturesEnabled&&(this._thicknessTexture&&x.d.ThicknessTextureEnabled&&V.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&x.d.RefractionIntensityTextureEnabled&&l.SS_REFRACTIONINTENSITY_TEXTURE&&V.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&x.d.TranslucencyIntensityTextureEnabled&&l.SS_TRANSLUCENCYINTENSITY_TEXTURE&&V.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&x.d.TranslucencyColorTextureEnabled&&l.SS_TRANSLUCENCYCOLOR_TEXTURE&&V.setTexture("translucencyColorSampler",this._translucencyColorTexture),j&&x.d.RefractionTextureEnabled&&(k?V.setTexture("refractionSampler",j):(V.setTexture("refractionSampler",j._lodTextureMid||j),V.setTexture("refractionSamplerLow",j._lodTextureLow||j),V.setTexture("refractionSamplerHigh",j._lodTextureHigh||j))))}_getRefractionTexture(V){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?V.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(V){x.d.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&V.push(this._refractionTexture)}hasTexture(V){return this._thicknessTexture===V||(this._refractionTexture===V||(this._refractionIntensityTexture===V||(this._translucencyIntensityTexture===V||this._translucencyColorTexture===V)))}hasRenderTargetTextures(){return!!(x.d.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(V){this._thicknessTexture&&V.push(this._thicknessTexture),this._refractionTexture&&V.push(this._refractionTexture),this._translucencyColorTexture&&V.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&V.push(this._translucencyIntensityTexture)}getAnimatables(V){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&V.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&V.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&V.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&V.push(this._translucencyIntensityTexture)}dispose(V){V&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(V,I,m){return V.SS_SCATTERING&&I.addFallback(m++,"SS_SCATTERING"),V.SS_TRANSLUCENCY&&I.addFallback(m++,"SS_TRANSLUCENCY"),m}getSamplers(V){V.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}g.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE=!1,g.DEFAULT_LEGACY_TRANSLUCENCY=!1,(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"isRefractionEnabled",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"isTranslucencyEnabled",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"isDispersionEnabled",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markScenePrePassDirty")],g.prototype,"isScatteringEnabled",void 0),(0,C.d)([(0,l.B)()],g.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,C.d)([(0,l.B)()],g.prototype,"refractionIntensity",void 0),(0,C.d)([(0,l.B)()],g.prototype,"translucencyIntensity",void 0),(0,C.d)([(0,l.B)()],g.prototype,"useAlbedoToTintRefraction",void 0),(0,C.d)([(0,l.B)()],g.prototype,"useAlbedoToTintTranslucency",void 0),(0,C.d)([(0,l.s)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"thicknessTexture",void 0),(0,C.d)([(0,l.s)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"refractionTexture",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"indexOfRefraction",void 0),(0,C.d)([(0,l.B)()],g.prototype,"_volumeIndexOfRefraction",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"volumeIndexOfRefraction",null),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"invertRefractionY",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"linkRefractionWithTransparency",void 0),(0,C.d)([(0,l.B)()],g.prototype,"minimumThickness",void 0),(0,C.d)([(0,l.B)()],g.prototype,"maximumThickness",void 0),(0,C.d)([(0,l.B)()],g.prototype,"useThicknessAsDepth",void 0),(0,C.d)([(0,l.e)()],g.prototype,"tintColor",void 0),(0,C.d)([(0,l.B)()],g.prototype,"tintColorAtDistance",void 0),(0,C.d)([(0,l.B)()],g.prototype,"dispersion",void 0),(0,C.d)([(0,l.e)()],g.prototype,"diffusionDistance",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useMaskFromThicknessTexture",void 0),(0,C.d)([(0,l.s)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"refractionIntensityTexture",void 0),(0,C.d)([(0,l.s)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"translucencyIntensityTexture",void 0),(0,C.d)([(0,l.e)()],g.prototype,"translucencyColor",void 0),(0,C.d)([(0,l.s)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"translucencyColorTexture",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useGltfStyleTextures",void 0),(0,C.d)([(0,l.B)()],g.prototype,"applyAlbedoAfterSubSurface",void 0),(0,C.d)([(0,l.B)()],g.prototype,"legacyTransluceny",void 0);var h=m(11685),d=m(11327),R=m(11688);const i={effect:null,subMesh:null};class q extends Y.c{constructor(V){super(V),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.IBL_CDF_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BASE_WEIGHT=!1,this.BASE_WEIGHTDIRECTUV=0,this.BASE_DIFFUSE_ROUGHNESS=!1,this.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.MIRRORED=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class P extends T.b{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(V){this._realTimeFiltering=V,this.bE(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(V){this._realTimeFilteringQuality=V,this.bE(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(V){V!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=V||this.cV().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(V,I){super(V,I,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||P.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new E.n(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._baseWeightTexture=null,this._baseDiffuseRoughnessTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=P.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=t.c.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new t.c(0,0,0),this._albedoColor=new t.c(1,1,1),this._baseWeight=1,this._baseDiffuseRoughness=null,this._reflectivityColor=new t.c(1,1,1),this._reflectionColor=new t.c(1,1,1),this._emissiveColor=new t.c(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=P.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new F.g(16),this._globalAmbientColor=new t.c(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new v(this),this.clearCoat=new y(this),this.iridescence=new Z(this),this.anisotropy=new W(this),this.sheen=new G(this),this.subSurface=new g(this),this.detailMap=new h.c(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),x.d.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,k.d)(this.cV()),this.prePassConfiguration=new N.c}get hasRenderTargetTextures(){return!!(x.d.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var V;return this._transparencyMode===P.PBRMATERIAL_OPAQUE||this._transparencyMode===P.PBRMATERIAL_ALPHATEST||(null===(V=this.subSurface)||void 0===V?void 0:V.disableAlphaBlending)}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var V;return this._hasTransparencyMode?this._transparencyModeIsTest:(null===(V=this.subSurface)||void 0===V||!V.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===P.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.eF&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==P.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.eF||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(V,I,m){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const C=I._drawWrapper;if(C.effect&&this.isFrozen&&C._wasPreviouslyReady&&C._wasPreviouslyUsingInstances===m)return!0;I.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),I.materialDefines=new q(this._eventInfo.defineNames));const l=I.materialDefines;if(this._isReadyForSubMesh(I))return!0;const F=this.cV(),k=F.getEngine();if(l._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,F.texturesEnabled)){if(this._albedoTexture&&x.d.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._baseWeightTexture&&x.d.BaseWeightTextureEnabled&&!this._baseWeightTexture.isReadyOrNotBlocking())return!1;if(this._baseDiffuseRoughnessTexture&&x.d.BaseDiffuseRoughnessTextureEnabled&&!this._baseDiffuseRoughnessTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&x.d.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&x.d.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const V=this._getReflectionTexture();if(V&&x.d.ReflectionTextureEnabled){if(!V.isReadyOrNotBlocking())return!1;var j;if(V.irradianceTexture){if(!V.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!V.sphericalPolynomial&&null!==(j=V.getInternalTexture())&&void 0!==j&&j._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&x.d.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&x.d.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(x.d.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(k.getCaps().standardDerivatives&&this._bumpTexture&&x.d.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&x.d.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=l,this._eventInfo.subMesh=I,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(l._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;if(l.AREALIGHTUSED)for(let s=0;s<V.lightSources.length;s++)if(!V.lightSources[s]._isReady())return!1;k.getCaps().standardDerivatives||V.isVerticesDataPresent(K.e.NormalKind)||(V.createNormals(!0),s.d.Warn("PBRMaterial: Normals have been created for the mesh: "+V.name));const E=I.effect,Y=l._areLightsDisposed;let X=this._prepareEffect(V,l,this.onCompiled,this.onError,m,null,I.getRenderingMesh().hasThinInstances),O=!1;if(X)if(this._onEffectCreatedObservable&&(i.effect=X,i.subMesh=I,this._onEffectCreatedObservable.notifyObservers(i)),this.allowShaderHotSwapping&&E&&!X.isReady()){if(X=E,l.markAsUnprocessed(),O=this.isFrozen,Y)return l._areLightsDisposed=!0,!1}else F.resetCachedMaterial(),I.setEffect(X,l,this._materialContext);return!(!I.effect||!I.effect.isReady())&&(l._renderId=F.getRenderId(),C._wasPreviouslyReady=!O,C._wasPreviouslyUsingInstances=!!m,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(V,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,k=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(V,I,s,F,k),!I.isDirty)return null;I.markAsProcessed();const j=this.cV().getEngine(),E=new S.b;let Y=0;I.USESPHERICALINVERTEX&&E.addFallback(Y++,"USESPHERICALINVERTEX"),I.FOG&&E.addFallback(Y,"FOG"),I.SPECULARAA&&E.addFallback(Y,"SPECULARAA"),I.POINTSIZE&&E.addFallback(Y,"POINTSIZE"),I.LOGARITHMICDEPTH&&E.addFallback(Y,"LOGARITHMICDEPTH"),I.PARALLAX&&E.addFallback(Y,"PARALLAX"),I.PARALLAX_RHS&&E.addFallback(Y,"PARALLAX_RHS"),I.PARALLAXOCCLUSION&&E.addFallback(Y++,"PARALLAXOCCLUSION"),I.ENVIRONMENTBRDF&&E.addFallback(Y++,"ENVIRONMENTBRDF"),I.TANGENT&&E.addFallback(Y++,"TANGENT"),I.BUMP&&E.addFallback(Y++,"BUMP"),Y=(0,c.w)(I,E,this._maxSimultaneousLights,Y++),I.SPECULARTERM&&E.addFallback(Y++,"SPECULARTERM"),I.USESPHERICALFROMREFLECTIONMAP&&E.addFallback(Y++,"USESPHERICALFROMREFLECTIONMAP"),I.USEIRRADIANCEMAP&&E.addFallback(Y++,"USEIRRADIANCEMAP"),I.LIGHTMAP&&E.addFallback(Y++,"LIGHTMAP"),I.NORMAL&&E.addFallback(Y++,"NORMAL"),I.AMBIENT&&E.addFallback(Y++,"AMBIENT"),I.EMISSIVE&&E.addFallback(Y++,"EMISSIVE"),I.VERTEXCOLOR&&E.addFallback(Y++,"VERTEXCOLOR"),I.MORPHTARGETS&&E.addFallback(Y++,"MORPHTARGETS"),I.MULTIVIEW&&E.addFallback(0,"MULTIVIEW");const X=[K.e.PositionKind];I.NORMAL&&X.push(K.e.NormalKind),I.TANGENT&&X.push(K.e.TangentKind);for(let m=1;m<=6;++m)I["UV"+m]&&X.push(`uv${1===m?"":m}`);I.VERTEXCOLOR&&X.push(K.e.ColorKind),(0,c.C)(X,V,I,E),(0,c.F)(X,I),(0,c.G)(X,V,I),(0,c.y)(X,V,I);let O="pbr";const v=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","baseWeight","baseDiffuseRoughness","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vBaseWeightInfos","vBaseDiffuseRoughnessInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","baseWeightMatrix","baseDiffuseRoughnessMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vReflectionDominantDirection","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],t=["albedoSampler","baseWeightSampler","baseDiffuseRoughnessSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","icdfSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],b=["Material","Scene","Mesh"],T={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:I.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=E,this._eventInfo.fallbackRank=Y,this._eventInfo.defines=I,this._eventInfo.uniforms=v,this._eventInfo.attributes=X,this._eventInfo.samplers=t,this._eventInfo.uniformBuffersNames=b,this._eventInfo.customCode=void 0,this._eventInfo.mesh=V,this._eventInfo.indexParameters=T,this._callbackPluginEventGeneric(128,this._eventInfo),R.b.AddUniformsAndSamplers(v,t),N.c.AddUniforms(v),N.c.AddSamplers(t),(0,d.b)(v),D.e&&(D.e.PrepareUniforms(v,I),D.e.PrepareSamplers(t,I)),(0,c._)({uniformsNames:v,uniformBuffersNames:b,samplers:t,defines:I,maxSimultaneousLights:this._maxSimultaneousLights});const n={};this.customShaderNameResolve&&(O=this.customShaderNameResolve(O,v,b,t,I,X,n));const x=I.toString(),H=j.createEffect(O,{attributes:X,uniformsNames:v,uniformBuffersNames:b,samplers:t,defines:x,fallbacks:E,onCompiled:C,onError:l,indexParameters:T,processFinalCode:n.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:I.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([m.e(20),m.e(45)]).then(m.bind(m,13780)),Promise.all([m.e(18),m.e(46)]).then(m.bind(m,13935))]):await Promise.all([Promise.all([m.e(13),m.e(48)]).then(m.bind(m,14031)),Promise.all([m.e(12),m.e(49)]).then(m.bind(m,14200))]),this._shadersLoaded=!0}},j);return this._eventInfo.customCode=void 0,H}_prepareDefines(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const s=this.cV(),F=s.getEngine();(0,c.P)(s,V,I,!0,this._maxSimultaneousLights,this._disableLighting),I._needNormals=!0,(0,c.T)(s,I);const k=this.needAlphaBlendingForMesh(V)&&this.cV().useOrderIndependentTransparency;if((0,c.Z)(s,I,this.canRenderToMRT&&!k),(0,c.V)(s,I,k),R.b.PrepareDefines(F.currentRenderPassId,V,I),I.METALLICWORKFLOW=this.isMetallicWorkflow(),I._areTexturesDirty){I._needUVs=!1;for(let V=1;V<=6;++V)I["MAINUV"+V]=!1;if(s.texturesEnabled){I.ALBEDODIRECTUV=0,I.BASE_WEIGHTDIRECTUV=0,I.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,I.AMBIENTDIRECTUV=0,I.OPACITYDIRECTUV=0,I.EMISSIVEDIRECTUV=0,I.REFLECTIVITYDIRECTUV=0,I.MICROSURFACEMAPDIRECTUV=0,I.METALLIC_REFLECTANCEDIRECTUV=0,I.REFLECTANCEDIRECTUV=0,I.BUMPDIRECTUV=0,I.LIGHTMAPDIRECTUV=0,F.getCaps().textureLOD&&(I.LODBASEDMICROSFURACE=!0),this._albedoTexture&&x.d.DiffuseTextureEnabled?((0,c.R)(this._albedoTexture,I,"ALBEDO"),I.GAMMAALBEDO=this._albedoTexture.gammaSpace):I.ALBEDO=!1,this._baseWeightTexture&&x.d.BaseWeightTextureEnabled?(0,c.R)(this._baseWeightTexture,I,"BASE_WEIGHT"):I.BASE_WEIGHT=!1,this._baseDiffuseRoughnessTexture&&x.d.BaseDiffuseRoughnessTextureEnabled?(0,c.R)(this._baseDiffuseRoughnessTexture,I,"BASE_DIFFUSE_ROUGHNESS"):I.BASE_DIFFUSE_ROUGHNESS=!1,this._ambientTexture&&x.d.AmbientTextureEnabled?((0,c.R)(this._ambientTexture,I,"AMBIENT"),I.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):I.AMBIENT=!1,this._opacityTexture&&x.d.OpacityTextureEnabled?((0,c.R)(this._opacityTexture,I,"OPACITY"),I.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):I.OPACITY=!1;const V=this._getReflectionTexture();if(V&&x.d.ReflectionTextureEnabled){switch(I.REFLECTION=!0,I.GAMMAREFLECTION=V.gammaSpace,I.RGBDREFLECTION=V.isRGBD,I.LODINREFLECTIONALPHA=V.lodLevelInAlpha,I.LINEARSPECULARREFLECTION=V.linearSpecularLOD,I.USEIRRADIANCEMAP=!1,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(I.NUM_SAMPLES=""+this.realTimeFilteringQuality,F._features.needTypeSuffixInShaderConstants&&(I.NUM_SAMPLES=I.NUM_SAMPLES+"u"),I.REALTIME_FILTERING=!0,this.cV().iblCdfGenerator&&(I.IBL_CDF_FILTERING=!0)):I.REALTIME_FILTERING=!1,I.INVERTCUBICMAP=V.coordinatesMode===n.e.INVCUBIC_MODE,I.REFLECTIONMAP_3D=V.isCube,I.REFLECTIONMAP_OPPOSITEZ=I.REFLECTIONMAP_3D&&this.cV().useRightHandedSystem?!V.invertZ:V.invertZ,I.REFLECTIONMAP_CUBIC=!1,I.REFLECTIONMAP_EXPLICIT=!1,I.REFLECTIONMAP_PLANAR=!1,I.REFLECTIONMAP_PROJECTION=!1,I.REFLECTIONMAP_SKYBOX=!1,I.REFLECTIONMAP_SPHERICAL=!1,I.REFLECTIONMAP_EQUIRECTANGULAR=!1,I.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,I.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,V.coordinatesMode){case n.e.EXPLICIT_MODE:I.REFLECTIONMAP_EXPLICIT=!0;break;case n.e.PLANAR_MODE:I.REFLECTIONMAP_PLANAR=!0;break;case n.e.PROJECTION_MODE:I.REFLECTIONMAP_PROJECTION=!0;break;case n.e.SKYBOX_MODE:I.REFLECTIONMAP_SKYBOX=!0;break;case n.e.SPHERICAL_MODE:I.REFLECTIONMAP_SPHERICAL=!0;break;case n.e.EQUIRECTANGULAR_MODE:I.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case n.e.FIXED_EQUIRECTANGULAR_MODE:I.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case n.e.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:I.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case n.e.CUBIC_MODE:case n.e.INVCUBIC_MODE:default:I.REFLECTIONMAP_CUBIC=!0,I.USE_LOCAL_REFLECTIONMAP_CUBIC=!!V.boundingBoxSize}V.coordinatesMode!==n.e.SKYBOX_MODE&&(V.irradianceTexture?(I.USEIRRADIANCEMAP=!0,I.USESPHERICALFROMREFLECTIONMAP=!1,I.USESPHERICALINVERTEX=!1,V.irradianceTexture._dominantDirection&&(I.USE_IRRADIANCE_DOMINANT_DIRECTION=!0)):V.isCube&&(I.USESPHERICALFROMREFLECTIONMAP=!0,I.USEIRRADIANCEMAP=!1,I.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||F.getCaps().maxVaryingVectors<=8||this._baseDiffuseRoughnessTexture?I.USESPHERICALINVERTEX=!1:I.USESPHERICALINVERTEX=!0))}else I.REFLECTION=!1,I.REFLECTIONMAP_3D=!1,I.REFLECTIONMAP_SPHERICAL=!1,I.REFLECTIONMAP_PLANAR=!1,I.REFLECTIONMAP_CUBIC=!1,I.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,I.REFLECTIONMAP_PROJECTION=!1,I.REFLECTIONMAP_SKYBOX=!1,I.REFLECTIONMAP_EXPLICIT=!1,I.REFLECTIONMAP_EQUIRECTANGULAR=!1,I.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,I.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,I.INVERTCUBICMAP=!1,I.USESPHERICALFROMREFLECTIONMAP=!1,I.USEIRRADIANCEMAP=!1,I.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,I.USESPHERICALINVERTEX=!1,I.REFLECTIONMAP_OPPOSITEZ=!1,I.LODINREFLECTIONALPHA=!1,I.GAMMAREFLECTION=!1,I.RGBDREFLECTION=!1,I.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&x.d.LightmapTextureEnabled?((0,c.R)(this._lightmapTexture,I,"LIGHTMAP"),I.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,I.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,I.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):I.LIGHTMAP=!1,this._emissiveTexture&&x.d.EmissiveTextureEnabled?((0,c.R)(this._emissiveTexture,I,"EMISSIVE"),I.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):I.EMISSIVE=!1,x.d.SpecularTextureEnabled?(this._metallicTexture?((0,c.R)(this._metallicTexture,I,"REFLECTIVITY"),I.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,I.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,I.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,I.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,I.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,c.R)(this._reflectivityTexture,I,"REFLECTIVITY"),I.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,I.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,I.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):I.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(I.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,c.R)(this._metallicReflectanceTexture,I,"METALLIC_REFLECTANCE"),I.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):I.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,c.R)(this._reflectanceTexture,I,"REFLECTANCE"),I.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):I.REFLECTANCE=!1):(I.METALLIC_REFLECTANCE=!1,I.REFLECTANCE=!1),this._microSurfaceTexture?(0,c.R)(this._microSurfaceTexture,I,"MICROSURFACEMAP"):I.MICROSURFACEMAP=!1):(I.REFLECTIVITY=!1,I.MICROSURFACEMAP=!1),F.getCaps().standardDerivatives&&this._bumpTexture&&x.d.BumpTextureEnabled&&!this._disableBumpMap?((0,c.R)(this._bumpTexture,I,"BUMP"),this._useParallax&&this._albedoTexture&&x.d.DiffuseTextureEnabled?(I.PARALLAX=!0,I.PARALLAX_RHS=s.useRightHandedSystem,I.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):I.PARALLAX=!1,I.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(I.BUMP=!1,I.PARALLAX=!1,I.PARALLAX_RHS=!1,I.PARALLAXOCCLUSION=!1,I.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&x.d.ReflectionTextureEnabled?(I.ENVIRONMENTBRDF=!0,I.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(I.ENVIRONMENTBRDF=!1,I.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?I.ALPHAFROMALBEDO=!0:I.ALPHAFROMALBEDO=!1}I.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===P.LIGHTFALLOFF_STANDARD?(I.USEPHYSICALLIGHTFALLOFF=!1,I.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===P.LIGHTFALLOFF_GLTF?(I.USEPHYSICALLIGHTFALLOFF=!1,I.USEGLTFLIGHTFALLOFF=!0):(I.USEPHYSICALLIGHTFALLOFF=!0,I.USEGLTFLIGHTFALLOFF=!1),I.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.JF&&this._twoSidedLighting?I.TWOSIDEDLIGHTING=!0:I.TWOSIDEDLIGHTING=!1,I.MIRRORED=!!s._mirroredCameraPosition,I.SPECULARAA=F.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(I._areTexturesDirty||I._areMiscDirty)&&(I.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,I.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,I.ALPHABLEND=this.needAlphaBlendingForMesh(V),I.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,I.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),I._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(I),I.FORCENORMALFORWARD=this._forceNormalForward,I.RADIANCEOCCLUSION=this._useRadianceOcclusion,I.HORIZONOCCLUSION=this._useHorizonOcclusion,I._areMiscDirty&&((0,c.S)(V,s,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(V),I,this._applyDecalMapAfterDetailMap),I.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!V.isVerticesDataPresent(K.e.NormalKind),I.DEBUGMODE=this._debugMode),(0,c.M)(s,F,this,I,!!m,C,l),this._eventInfo.defines=I,this._eventInfo.mesh=V,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,c.K)(V,I,!0,!0,!0,this._transparencyMode!==P.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(V,I,m){const C={clipPlane:!1,useInstances:!1,...m};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const m=new q(this._eventInfo.defineNames),l=this._prepareEffect(V,m,void 0,void 0,C.useInstances,C.clipPlane,V.hasThinInstances);this._onEffectCreatedObservable&&(i.effect=l,i.subMesh=null,this._onEffectCreatedObservable.notifyObservers(i)),l.isReady()?I&&I(this):l.onCompileObservable.add((()=>{I&&I(this)}))})()}buildUniformLayout(){const V=this._uniformBuffer;V.addUniform("vAlbedoInfos",2),V.addUniform("vBaseWeightInfos",2),V.addUniform("vBaseDiffuseRoughnessInfos",2),V.addUniform("vAmbientInfos",4),V.addUniform("vOpacityInfos",2),V.addUniform("vEmissiveInfos",2),V.addUniform("vLightmapInfos",2),V.addUniform("vReflectivityInfos",3),V.addUniform("vMicroSurfaceSamplerInfos",2),V.addUniform("vReflectionInfos",2),V.addUniform("vReflectionFilteringInfo",2),V.addUniform("vReflectionPosition",3),V.addUniform("vReflectionSize",3),V.addUniform("vBumpInfos",3),V.addUniform("albedoMatrix",16),V.addUniform("baseWeightMatrix",16),V.addUniform("baseDiffuseRoughnessMatrix",16),V.addUniform("ambientMatrix",16),V.addUniform("opacityMatrix",16),V.addUniform("emissiveMatrix",16),V.addUniform("lightmapMatrix",16),V.addUniform("reflectivityMatrix",16),V.addUniform("microSurfaceSamplerMatrix",16),V.addUniform("bumpMatrix",16),V.addUniform("vTangentSpaceParams",2),V.addUniform("reflectionMatrix",16),V.addUniform("vReflectionColor",3),V.addUniform("vAlbedoColor",4),V.addUniform("baseWeight",1),V.addUniform("baseDiffuseRoughness",1),V.addUniform("vLightingIntensity",4),V.addUniform("vReflectionMicrosurfaceInfos",3),V.addUniform("vReflectionDominantDirection",3),V.addUniform("pointSize",1),V.addUniform("vReflectivityColor",4),V.addUniform("vEmissiveColor",3),V.addUniform("vAmbientColor",3),V.addUniform("vDebugMode",2),V.addUniform("vMetallicReflectanceFactors",4),V.addUniform("vMetallicReflectanceInfos",2),V.addUniform("metallicReflectanceMatrix",16),V.addUniform("vReflectanceInfos",2),V.addUniform("reflectanceMatrix",16),V.addUniform("vSphericalL00",3),V.addUniform("vSphericalL1_1",3),V.addUniform("vSphericalL10",3),V.addUniform("vSphericalL11",3),V.addUniform("vSphericalL2_2",3),V.addUniform("vSphericalL2_1",3),V.addUniform("vSphericalL20",3),V.addUniform("vSphericalL21",3),V.addUniform("vSphericalL22",3),V.addUniform("vSphericalX",3),V.addUniform("vSphericalY",3),V.addUniform("vSphericalZ",3),V.addUniform("vSphericalXX_ZZ",3),V.addUniform("vSphericalYY_ZZ",3),V.addUniform("vSphericalZZ",3),V.addUniform("vSphericalXY",3),V.addUniform("vSphericalYZ",3),V.addUniform("vSphericalZX",3),V.addUniform("cameraInfo",4),super.buildUniformLayout()}bindForSubMesh(V,I,m){const C=this.cV(),l=m.materialDefines;if(!l)return;const s=m.effect;if(!s)return;this._activeEffect=s,I.getMeshUniformBuffer().bindToEffect(s,"Mesh"),I.transferToEffect(V);const F=C.getEngine();this._uniformBuffer.bindToEffect(s,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,C,I,V,this.isFrozen),R.b.Bind(F.currentRenderPassId,this._activeEffect,I,V,this);const k=C.activeCamera;k?this._uniformBuffer.updateFloat4("cameraInfo",k.Fk,k.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=m,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),l.OBJECTSPACE_NORMALMAP&&(V.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const E=this._mustRebind(C,s,m,I.visibility);(0,c.b)(I,this._activeEffect,this.prePassConfiguration);let K=null;const Y=this._uniformBuffer;if(E){if(this.bindViewProjection(s),K=this._getReflectionTexture(),!Y.useUbo||!this.isFrozen||!Y.isSync||m._drawWrapper._forceRebindOnNextCall){var X;if(C.texturesEnabled){if(this._albedoTexture&&x.d.DiffuseTextureEnabled&&(Y.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,c.u)(this._albedoTexture,Y,"albedo")),this._baseWeightTexture&&x.d.BaseWeightTextureEnabled&&(Y.updateFloat2("vBaseWeightInfos",this._baseWeightTexture.coordinatesIndex,this._baseWeightTexture.level),(0,c.u)(this._baseWeightTexture,Y,"baseWeight")),this._baseDiffuseRoughnessTexture&&x.d.BaseDiffuseRoughnessTextureEnabled&&(Y.updateFloat2("vBaseDiffuseRoughnessInfos",this._baseDiffuseRoughnessTexture.coordinatesIndex,this._baseDiffuseRoughnessTexture.level),(0,c.u)(this._baseDiffuseRoughnessTexture,Y,"baseDiffuseRoughness")),this._ambientTexture&&x.d.AmbientTextureEnabled&&(Y.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,c.u)(this._ambientTexture,Y,"ambient")),this._opacityTexture&&x.d.OpacityTextureEnabled&&(Y.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,c.u)(this._opacityTexture,Y,"opacity")),K&&x.d.ReflectionTextureEnabled){if(Y.lk("reflectionMatrix",K.getReflectionTextureMatrix()),Y.updateFloat2("vReflectionInfos",K.level*C.iblIntensity,0),K.boundingBoxSize){const V=K;Y.updateVector3("vReflectionPosition",V.boundingBoxPosition),Y.updateVector3("vReflectionSize",V.boundingBoxSize)}if(this.realTimeFiltering){const V=K.getSize().width;Y.updateFloat2("vReflectionFilteringInfo",V,Math.log2(V))}if(l.USEIRRADIANCEMAP)l.USEIRRADIANCEMAP&&l.USE_IRRADIANCE_DOMINANT_DIRECTION&&Y.updateVector3("vReflectionDominantDirection",K.irradianceTexture._dominantDirection);else{const V=K.sphericalPolynomial;if(l.USESPHERICALFROMREFLECTIONMAP&&V)if(l.SPHERICAL_HARMONICS){const I=V.preScaledHarmonics;Y.updateVector3("vSphericalL00",I.l00),Y.updateVector3("vSphericalL1_1",I.l1_1),Y.updateVector3("vSphericalL10",I.l10),Y.updateVector3("vSphericalL11",I.l11),Y.updateVector3("vSphericalL2_2",I.l2_2),Y.updateVector3("vSphericalL2_1",I.l2_1),Y.updateVector3("vSphericalL20",I.l20),Y.updateVector3("vSphericalL21",I.l21),Y.updateVector3("vSphericalL22",I.l22)}else Y.updateFloat3("vSphericalX",V.x.x,V.x.y,V.x.z),Y.updateFloat3("vSphericalY",V.y.x,V.y.y,V.y.z),Y.updateFloat3("vSphericalZ",V.z.x,V.z.y,V.z.z),Y.updateFloat3("vSphericalXX_ZZ",V.xx.x-V.zz.x,V.xx.y-V.zz.y,V.xx.z-V.zz.z),Y.updateFloat3("vSphericalYY_ZZ",V.yy.x-V.zz.x,V.yy.y-V.zz.y,V.yy.z-V.zz.z),Y.updateFloat3("vSphericalZZ",V.zz.x,V.zz.y,V.zz.z),Y.updateFloat3("vSphericalXY",V.xy.x,V.xy.y,V.xy.z),Y.updateFloat3("vSphericalYZ",V.yz.x,V.yz.y,V.yz.z),Y.updateFloat3("vSphericalZX",V.zx.x,V.zx.y,V.zx.z)}Y.updateFloat3("vReflectionMicrosurfaceInfos",K.getSize().width,K.lodGenerationScale,K.lodGenerationOffset)}this._emissiveTexture&&x.d.EmissiveTextureEnabled&&(Y.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,c.u)(this._emissiveTexture,Y,"emissive")),this._lightmapTexture&&x.d.LightmapTextureEnabled&&(Y.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,c.u)(this._lightmapTexture,Y,"lightmap")),x.d.SpecularTextureEnabled&&(this._metallicTexture?(Y.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,c.u)(this._metallicTexture,Y,"reflectivity")):this._reflectivityTexture&&(Y.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,c.u)(this._reflectivityTexture,Y,"reflectivity")),this._metallicReflectanceTexture&&(Y.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,c.u)(this._metallicReflectanceTexture,Y,"metallicReflectance")),this._reflectanceTexture&&l.REFLECTANCE&&(Y.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,c.u)(this._reflectanceTexture,Y,"reflectance")),this._microSurfaceTexture&&(Y.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,c.u)(this._microSurfaceTexture,Y,"microSurfaceSampler"))),this._bumpTexture&&F.getCaps().standardDerivatives&&x.d.BumpTextureEnabled&&!this._disableBumpMap&&(Y.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,c.u)(this._bumpTexture,Y,"bump"),C._mirroredCameraPosition?Y.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):Y.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&Y.updateFloat("pointSize",this.pointSize),l.METALLICWORKFLOW){var O;t.f.dX[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,t.f.dX[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness;const V=(null===(O=this.subSurface)||void 0===O?void 0:O._indexOfRefraction)??1.5,I=1;t.f.dX[0].b=V;const m=Math.pow((V-I)/(V+I),2);t.f.dX[0].a=m,Y.updateDirectColor4("vReflectivityColor",t.f.dX[0]),Y.updateColor4("vMetallicReflectanceFactors",this._metallicReflectanceColor,this._metallicF0Factor)}else Y.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);Y.updateColor3("vEmissiveColor",x.d.EmissiveTextureEnabled?this._emissiveColor:t.c.BlackReadOnly),Y.updateColor3("vReflectionColor",this._reflectionColor),!l.SS_REFRACTION&&null!==(X=this.subSurface)&&void 0!==X&&X._linkRefractionWithTransparency?Y.updateColor4("vAlbedoColor",this._albedoColor,1):Y.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),Y.updateFloat("baseWeight",this._baseWeight),Y.updateFloat("baseDiffuseRoughness",this._baseDiffuseRoughness||0),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*C.environmentIntensity,this._lightingInfos.w=this._specularIntensity,Y.updateVector4("vLightingIntensity",this._lightingInfos),C.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),Y.updateColor3("vAmbientColor",this._globalAmbientColor),Y.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}if(C.texturesEnabled){if(this._albedoTexture&&x.d.DiffuseTextureEnabled&&Y.setTexture("albedoSampler",this._albedoTexture),this._baseWeightTexture&&x.d.BaseWeightTextureEnabled&&Y.setTexture("baseWeightSampler",this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&x.d.BaseDiffuseRoughnessTextureEnabled&&Y.setTexture("baseDiffuseRoughnessSampler",this._baseDiffuseRoughnessTexture),this._ambientTexture&&x.d.AmbientTextureEnabled&&Y.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&x.d.OpacityTextureEnabled&&Y.setTexture("opacitySampler",this._opacityTexture),K&&x.d.ReflectionTextureEnabled){l.LODBASEDMICROSFURACE?Y.setTexture("reflectionSampler",K):(Y.setTexture("reflectionSampler",K._lodTextureMid||K),Y.setTexture("reflectionSamplerLow",K._lodTextureLow||K),Y.setTexture("reflectionSamplerHigh",K._lodTextureHigh||K)),l.USEIRRADIANCEMAP&&Y.setTexture("irradianceSampler",K.irradianceTexture);const V=this.cV().iblCdfGenerator;this.realTimeFiltering&&V&&Y.setTexture("icdfSampler",V.getIcdfTexture())}l.ENVIRONMENTBRDF&&Y.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&x.d.EmissiveTextureEnabled&&Y.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&x.d.LightmapTextureEnabled&&Y.setTexture("lightmapSampler",this._lightmapTexture),x.d.SpecularTextureEnabled&&(this._metallicTexture?Y.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&Y.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&Y.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&l.REFLECTANCE&&Y.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&Y.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&F.getCaps().standardDerivatives&&x.d.BumpTextureEnabled&&!this._disableBumpMap&&Y.setTexture("bumpSampler",this._bumpTexture)}this.cV().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(I)&&this.cV().depthPeelingRenderer.bind(s),this._eventInfo.subMesh=m,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,d.d)(this._activeEffect,this,C),this.bindEyePosition(s)}else C.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(E||!this.isFrozen){var v;if(C.lightsEnabled&&!this._disableLighting&&(0,c.j)(C,I,this._activeEffect,l,this._maxSimultaneousLights),(C.fogEnabled&&I.applyFog&&C.fogMode!==j.e.FOGMODE_NONE||K||this.subSurface.refractionTexture||I.receiveShadows||l.PREPASS)&&this.bindView(s),(0,c.f)(C,I,this._activeEffect,!0),l.NUM_MORPH_INFLUENCERS&&(0,c.r)(I,this._activeEffect),l.BAKED_VERTEX_ANIMATION_TEXTURE)null===(v=I.bakedVertexAnimationManager)||void 0===v||v.bind(s,l.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,c.n)(l,this._activeEffect,C)}this._afterBind(I,this._activeEffect,m),Y.update()}getAnimatables(){const V=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&V.push(this._albedoTexture),this._baseWeightTexture&&this._baseWeightTexture.animations&&this._baseWeightTexture.animations.length>0&&V.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&this._baseDiffuseRoughnessTexture.animations&&this._baseDiffuseRoughnessTexture.animations.length>0&&V.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&V.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&V.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&V.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&V.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?V.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&V.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&V.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&V.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&V.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&V.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&V.push(this._microSurfaceTexture),V}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.cV().environmentTexture}getActiveTextures(){const V=super.getActiveTextures();return this._albedoTexture&&V.push(this._albedoTexture),this._baseWeightTexture&&V.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&V.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&V.push(this._ambientTexture),this._opacityTexture&&V.push(this._opacityTexture),this._reflectionTexture&&V.push(this._reflectionTexture),this._emissiveTexture&&V.push(this._emissiveTexture),this._reflectivityTexture&&V.push(this._reflectivityTexture),this._metallicTexture&&V.push(this._metallicTexture),this._metallicReflectanceTexture&&V.push(this._metallicReflectanceTexture),this._reflectanceTexture&&V.push(this._reflectanceTexture),this._microSurfaceTexture&&V.push(this._microSurfaceTexture),this._bumpTexture&&V.push(this._bumpTexture),this._lightmapTexture&&V.push(this._lightmapTexture),V}hasTexture(V){return!!super.hasTexture(V)||(this._albedoTexture===V||(this._baseWeightTexture===V||(this._baseDiffuseRoughnessTexture===V||(this._ambientTexture===V||(this._opacityTexture===V||(this._reflectionTexture===V||(this._emissiveTexture===V||(this._reflectivityTexture===V||(this._metallicTexture===V||(this._metallicReflectanceTexture===V||(this._reflectanceTexture===V||(this._microSurfaceTexture===V||(this._bumpTexture===V||this._lightmapTexture===V)))))))))))))}setPrePassRenderer(){var V;if(null===(V=this.subSurface)||void 0===V||!V.isScatteringEnabled)return!1;const I=this.cV().enableSubSurfaceForPrePass();return I&&(I.enabled=!0),!0}dispose(V,I){var m,C,l,s,F,k,j,E,K,Y,X,O,v,N;(this._breakShaderLoadedCheck=!0,I)&&(this._environmentBRDFTexture&&this.cV().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(m=this._albedoTexture)||void 0===m||m.dispose(),null===(C=this._baseWeightTexture)||void 0===C||C.dispose(),null===(l=this._baseDiffuseRoughnessTexture)||void 0===l||l.dispose(),null===(s=this._ambientTexture)||void 0===s||s.dispose(),null===(F=this._opacityTexture)||void 0===F||F.dispose(),null===(k=this._reflectionTexture)||void 0===k||k.dispose(),null===(j=this._emissiveTexture)||void 0===j||j.dispose(),null===(E=this._metallicTexture)||void 0===E||E.dispose(),null===(K=this._reflectivityTexture)||void 0===K||K.dispose(),null===(Y=this._bumpTexture)||void 0===Y||Y.dispose(),null===(X=this._lightmapTexture)||void 0===X||X.dispose(),null===(O=this._metallicReflectanceTexture)||void 0===O||O.dispose(),null===(v=this._reflectanceTexture)||void 0===v||v.dispose(),null===(N=this._microSurfaceTexture)||void 0===N||N.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(V,I)}}P.PBRMATERIAL_OPAQUE=b.d.MATERIAL_OPAQUE,P.PBRMATERIAL_ALPHATEST=b.d.MATERIAL_ALPHATEST,P.PBRMATERIAL_ALPHABLEND=b.d.MATERIAL_ALPHABLEND,P.PBRMATERIAL_ALPHATESTANDBLEND=b.d.MATERIAL_ALPHATESTANDBLEND,P.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,P.LIGHTFALLOFF_PHYSICAL=0,P.LIGHTFALLOFF_GLTF=1,P.LIGHTFALLOFF_STANDARD=2,P.ForceGLSL=!1,(0,C.d)([(0,l.k)()],P.prototype,"_imageProcessingConfiguration",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsMiscDirty")],P.prototype,"debugMode",void 0)},11570:(V,I,m)=>{m.d(I,{c:()=>Y});var C=m(11206),l=m(11214),s=m(11574),F=m(11312),k=m(11587),j=m(11048),E=m(11202),K=m(11297);class Y extends k.b{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(V){this.subSurface.refractionTexture=V,V?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(V){this.subSurface.indexOfRefraction=V}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(V){this.subSurface.invertRefractionY=V}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(V){this.subSurface.linkRefractionWithTransparency=V,V&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===k.b.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(V){V!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=V?k.b.LIGHTFALLOFF_PHYSICAL:k.b.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===k.b.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(V){V!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=V?k.b.LIGHTFALLOFF_GLTF:k.b.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(V){this._attachImageProcessingConfiguration(V),this._markAllSubMeshesAsImageProcessingDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(V){this.imageProcessingConfiguration.colorCurvesEnabled=V}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(V){this.imageProcessingConfiguration.colorGradingEnabled=V}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(V){this._imageProcessingConfiguration.toneMappingEnabled=V}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(V){this._imageProcessingConfiguration.exposure=V}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(V){this._imageProcessingConfiguration.contrast=V}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(V){this._imageProcessingConfiguration.colorGradingTexture=V}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(V){this._imageProcessingConfiguration.colorCurves=V}constructor(V,I){super(V,I,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=Y.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=F.c.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new F.c(0,0,0),this.albedoColor=new F.c(1,1,1),this.baseWeight=1,this.reflectivityColor=new F.c(1,1,1),this.reflectionColor=new F.c(1,1,1),this.emissiveColor=new F.c(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,s.d)(this.cV())}getClassName(){return"PBRMaterial"}clone(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const C=K.d.Clone((()=>new Y(V,this.cV())),this,{cloneTexturesOnlyOnce:I});return C.id=V,C.name=V,this.stencil.copyTo(C.stencil),this._clonePlugins(C,m),C}serialize(){const V=super.serialize();return V.customType="BABYLON.PBRMaterial",V}static Parse(V,I,m){const C=K.d.Parse((()=>new Y(V.name,I)),V,I,m);return V.stencil&&C.stencil.parse(V.stencil,I,m),E.d._ParsePlugins(V,C,I,m),V.clearCoat&&C.clearCoat.parse(V.clearCoat,I,m),V.anisotropy&&C.anisotropy.parse(V.anisotropy,I,m),V.brdf&&C.brdf.parse(V.brdf,I,m),V.sheen&&C.sheen.parse(V.sheen,I,m),V.subSurface&&C.subSurface.parse(V.subSurface,I,m),V.iridescence&&C.iridescence.parse(V.iridescence,I,m),C}}Y.PBRMATERIAL_OPAQUE=k.b.PBRMATERIAL_OPAQUE,Y.PBRMATERIAL_ALPHATEST=k.b.PBRMATERIAL_ALPHATEST,Y.PBRMATERIAL_ALPHABLEND=k.b.PBRMATERIAL_ALPHABLEND,Y.PBRMATERIAL_ALPHATESTANDBLEND=k.b.PBRMATERIAL_ALPHATESTANDBLEND,Y.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=k.b.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"directIntensity",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"emissiveIntensity",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"environmentIntensity",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"specularIntensity",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"disableBumpMap",void 0),(0,C.d)([(0,l.s)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"albedoTexture",void 0),(0,C.d)([(0,l.s)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"baseWeightTexture",void 0),(0,C.d)([(0,l.s)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"baseDiffuseRoughnessTexture",void 0),(0,C.d)([(0,l.s)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"ambientTexture",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"ambientTextureStrength",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,C.d)([(0,l.s)(),(0,l.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],Y.prototype,"opacityTexture",void 0),(0,C.d)([(0,l.s)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"reflectionTexture",void 0),(0,C.d)([(0,l.s)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"emissiveTexture",void 0),(0,C.d)([(0,l.s)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"reflectivityTexture",void 0),(0,C.d)([(0,l.s)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"metallicTexture",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"metallic",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"roughness",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"metallicF0Factor",void 0),(0,C.d)([(0,l.e)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"metallicReflectanceColor",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,C.d)([(0,l.s)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"metallicReflectanceTexture",void 0),(0,C.d)([(0,l.s)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"reflectanceTexture",void 0),(0,C.d)([(0,l.s)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"microSurfaceTexture",void 0),(0,C.d)([(0,l.s)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"bumpTexture",void 0),(0,C.d)([(0,l.s)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty",null)],Y.prototype,"lightmapTexture",void 0),(0,C.d)([(0,l.e)("ambient"),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"ambientColor",void 0),(0,C.d)([(0,l.e)("albedo"),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"albedoColor",void 0),(0,C.d)([(0,l.B)("baseWeight"),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"baseWeight",void 0),(0,C.d)([(0,l.B)("baseDiffuseRoughness"),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"baseDiffuseRoughness",void 0),(0,C.d)([(0,l.e)("reflectivity"),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"reflectivityColor",void 0),(0,C.d)([(0,l.e)("reflection"),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"reflectionColor",void 0),(0,C.d)([(0,l.e)("emissive"),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"emissiveColor",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"microSurface",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useLightmapAsShadowmap",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],Y.prototype,"useAlphaFromAlbedoTexture",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],Y.prototype,"forceAlphaTest",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],Y.prototype,"alphaCutOff",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useSpecularOverAlpha",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useAmbientInGrayScale",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,C.d)([(0,l.B)()],Y.prototype,"usePhysicalLightFalloff",null),(0,C.d)([(0,l.B)()],Y.prototype,"useGLTFLightFalloff",null),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useRadianceOverAlpha",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useObjectSpaceNormalMap",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useParallax",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useParallaxOcclusion",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"parallaxScaleBias",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsLightsDirty")],Y.prototype,"disableLighting",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"forceIrradianceInFragment",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsLightsDirty")],Y.prototype,"maxSimultaneousLights",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"invertNormalMapX",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"invertNormalMapY",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"twoSidedLighting",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useAlphaFresnel",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useLinearAlphaFresnel",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"environmentBRDFTexture",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"forceNormalForward",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"enableSpecularAntiAliasing",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useHorizonOcclusion",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useRadianceOcclusion",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsMiscDirty")],Y.prototype,"unlit",void 0),(0,C.d)([(0,l.B)(),(0,l.b)("_markAllSubMeshesAsMiscDirty")],Y.prototype,"applyDecalMapAfterDetailMap",void 0),(0,j.h)("BABYLON.PBRMaterial",Y)},11177:(V,I,m)=>{m.d(I,{c:()=>F});var C=m(11085);const l=new Map;function s(V,I){(function(V){return l.delete(V)})(V)&&C.d.Warn(`Extension with the name '${V}' already exists`),l.set(V,I)}function F(V,I){"image/ktx"!==I&&"image/ktx2"!==I||(V=".ktx"),l.has(V)||(V.endsWith(".ies")&&s(".ies",(async()=>await m.e(28).then(m.bind(m,13645)).then((V=>new V._IESTextureLoader)))),V.endsWith(".dds")&&s(".dds",(async()=>await m.e(25).then(m.bind(m,13647)).then((V=>new V._DDSTextureLoader)))),V.endsWith(".basis")&&s(".basis",(async()=>await m.e(29).then(m.bind(m,13660)).then((V=>new V._BasisTextureLoader)))),V.endsWith(".env")&&s(".env",(async()=>await Promise.all([m.e(24),m.e(30)]).then(m.bind(m,13667)).then((V=>new V._ENVTextureLoader)))),V.endsWith(".hdr")&&s(".hdr",(async()=>await m.e(31).then(m.bind(m,13669)).then((V=>new V._HDRTextureLoader)))),(V.endsWith(".ktx")||V.endsWith(".ktx2"))&&(s(".ktx",(async()=>await m.e(32).then(m.bind(m,13671)).then((V=>new V._KTXTextureLoader)))),s(".ktx2",(async()=>await m.e(32).then(m.bind(m,13671)).then((V=>new V._KTXTextureLoader))))),V.endsWith(".tga")&&s(".tga",(async()=>await m.e(33).then(m.bind(m,13680)).then((V=>new V._TGATextureLoader)))),V.endsWith(".exr")&&s(".exr",(async()=>await m.e(34).then(m.bind(m,13684)).then((V=>new V._ExrTextureLoader)))));const C=l.get(V);return C?Promise.resolve(C(I)):null}},11507:(V,I,m)=>{m.d(I,{b:()=>X});var C=m(11206),l=m(11214),s=m(11067),F=m(11040),k=m(11061),j=m(11188),E=(m(11102),m(11501));class K{get wrapU(){return this._wrapU}set wrapU(V){this._wrapU=V}get wrapV(){return this._wrapV}set wrapV(V){this._wrapV=V}get coordinatesMode(){return 0}get isCube(){return!!this._texture&&this._texture.isCube}set isCube(V){this._texture&&(this._texture.isCube=V)}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(V){this._texture&&(this._texture.is3D=V)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(V){this._texture&&(this._texture.is2DArray=V)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(V){return void 0!==(null===V||void 0===V?void 0:V.shareDepth)}constructor(V){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=E.c.Zero(),this._cachedBaseSize=E.c.Zero(),this._initialSamplingMode=2,this._texture=K._IsRenderTargetWrapper(V)?V.texture:V,this._texture&&(this._engine=this._texture.getEngine(),this.wrapU=this._texture._cachedWrapU??this.wrapU,this.wrapV=this._texture._cachedWrapV??this.wrapV,this.wrapR=this._texture._cachedWrapR??this.wrapR)}isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(V){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(V,this._texture,this._texture.generateMipMaps)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}var Y=m(11297);class X extends K{set eF(V){this._hasAlpha!==V&&(this._hasAlpha=V,this._scene&&this._scene.markAllMaterialsAsDirty(1,(V=>V.hasTexture(this))))}get eF(){return this._hasAlpha}set getAlphaFromRGB(V){this._getAlphaFromRGB!==V&&(this._getAlphaFromRGB=V,this._scene&&this._scene.markAllMaterialsAsDirty(1,(V=>V.hasTexture(this))))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(V){this._coordinatesIndex!==V&&(this._coordinatesIndex=V,this._scene&&this._scene.markAllMaterialsAsDirty(1,(V=>V.hasTexture(this))))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(V){this._coordinatesMode!==V&&(this._coordinatesMode=V,this._scene&&this._scene.markAllMaterialsAsDirty(1,(V=>V.hasTexture(this))))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(V){this._wrapU=V}get wrapV(){return this._wrapV}set wrapV(V){this._wrapV=V}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(V){this._texture?this._texture.isCube=V:this._isCube=V}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(V){this._texture&&(this._texture.is3D=V)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(V){this._texture&&(this._texture.is2DArray=V)}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set gammaSpace(V){var I;if(this._texture){if(this._texture._gammaSpace===V)return;this._texture._gammaSpace=V}else{if(this._gammaSpace===V)return;this._gammaSpace=V}null===(I=this.cV())||void 0===I||I.markAllMaterialsAsDirty(1,(V=>V.hasTexture(this)))}get isRGBD(){return null!=this._texture&&this._texture._isRGBD}set isRGBD(V){var I;V!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=V),null===(I=this.cV())||void 0===I||I.markAllMaterialsAsDirty(1,(V=>V.hasTexture(this))))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(V){this._texture&&(this._texture._lodGenerationOffset=V)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(V){this._texture&&(this._texture._lodGenerationScale=V)}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}set linearSpecularLOD(V){this._texture&&(this._texture._linearSpecularLOD=V)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(V){this._texture&&(this._texture._irradianceTexture=V)}get uid(){return this._uid||(this._uid=(0,j.d)()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(V){this._onDisposeObserver&&this.Ck.remove(this._onDisposeObserver),this._onDisposeObserver=this.Ck.add(V)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=X.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this._dominantDirection=null,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.Ck=new s.e,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,V?X._IsScene(V)?this._scene=V:this._engine=V:this._scene=k.c.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=I,this._uid=null}cV(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return F.b.IdentityReadOnly}getReflectionTextureMatrix(){return F.b.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(V){}get canRescale(){return!1}_getFromCache(V,I,m,C,l,s){const F=this._getEngine();if(!F)return null;const k=F._getUseSRGBBuffer(!!l,I),j=F.getLoadedTexturesCache();for(let E=0;E<j.length;E++){const F=j[E];if((void 0===l||k===F._useSRGBBuffer)&&(void 0===C||C===F.invertY)&&F.url===V&&F.generateMipMaps===!I&&(!m||m===F.samplingMode)&&(void 0===s||s===F.isCube))return F.incrementReferences(),F}return null}_rebuild(){}clone(){return null}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const V=this.cV();V&&V.markAllMaterialsAsDirty(1)}readPixels(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],l=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,k=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Number.MAX_VALUE,j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Number.MAX_VALUE;if(!this._texture)return null;const E=this._getEngine();if(!E)return null;const K=this.getSize();let Y=K.width,X=K.height;0!==I&&(Y/=Math.pow(2,I),X/=Math.pow(2,I),Y=Math.round(Y),X=Math.round(X)),k=Math.min(Y,k),j=Math.min(X,j);try{return this._texture.isCube?E._readTexturePixels(this._texture,k,j,V,I,m,C,l,s,F):E._readTexturePixels(this._texture,k,j,-1,I,m,C,l,s,F)}catch(O){return null}}_readPixelsSync(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],l=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!this._texture)return null;const s=this.getSize();let F=s.width,k=s.height;const j=this._getEngine();if(!j)return null;0!=I&&(F/=Math.pow(2,I),k/=Math.pow(2,I),F=Math.round(F),k=Math.round(k));try{return this._texture.isCube?j._readTexturePixelsSync(this._texture,F,k,V,I,m,C,l):j._readTexturePixelsSync(this._texture,F,k,-1,I,m,C,l)}catch(E){return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const V=this._scene.textures.indexOf(this);if(V>=0&&this._scene.textures.splice(V,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const V=this._parentContainer.textures.indexOf(this);V>-1&&this._parentContainer.textures.splice(V,1),this._parentContainer=null}}this.Ck.notifyObservers(this),this.Ck.clear(),this.metadata=null,super.dispose()}serialize(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.name&&!V)return null;const I=Y.d.Serialize(this);return Y.d.AppendSerializedAnimations(this,I),I}static WhenAllReady(V,I){let m=V.length;if(0!==m)for(let C=0;C<V.length;C++){const l=V[C];if(l.isReady())0===--m&&I();else{const V=l.onLoadObservable;V?V.addOnce((()=>{0===--m&&I()})):0===--m&&I()}}else I()}static _IsScene(V){return"Scene"===V.getClassName()}}X.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,C.d)([(0,l.B)()],X.prototype,"uniqueId",void 0),(0,C.d)([(0,l.B)()],X.prototype,"name",void 0),(0,C.d)([(0,l.B)()],X.prototype,"displayName",void 0),(0,C.d)([(0,l.B)()],X.prototype,"metadata",void 0),(0,C.d)([(0,l.B)("eF")],X.prototype,"_hasAlpha",void 0),(0,C.d)([(0,l.B)("getAlphaFromRGB")],X.prototype,"_getAlphaFromRGB",void 0),(0,C.d)([(0,l.B)()],X.prototype,"level",void 0),(0,C.d)([(0,l.B)("coordinatesIndex")],X.prototype,"_coordinatesIndex",void 0),(0,C.d)([(0,l.B)()],X.prototype,"optimizeUVAllocation",void 0),(0,C.d)([(0,l.B)("coordinatesMode")],X.prototype,"_coordinatesMode",void 0),(0,C.d)([(0,l.B)()],X.prototype,"wrapU",null),(0,C.d)([(0,l.B)()],X.prototype,"wrapV",null),(0,C.d)([(0,l.B)()],X.prototype,"wrapR",void 0),(0,C.d)([(0,l.B)()],X.prototype,"anisotropicFilteringLevel",void 0),(0,C.d)([(0,l.B)()],X.prototype,"isCube",null),(0,C.d)([(0,l.B)()],X.prototype,"is3D",null),(0,C.d)([(0,l.B)()],X.prototype,"is2DArray",null),(0,C.d)([(0,l.B)()],X.prototype,"gammaSpace",null),(0,C.d)([(0,l.B)()],X.prototype,"invertZ",void 0),(0,C.d)([(0,l.B)()],X.prototype,"lodLevelInAlpha",void 0),(0,C.d)([(0,l.B)()],X.prototype,"lodGenerationOffset",null),(0,C.d)([(0,l.B)()],X.prototype,"lodGenerationScale",null),(0,C.d)([(0,l.B)()],X.prototype,"linearSpecularLOD",null),(0,C.d)([(0,l.s)()],X.prototype,"irradianceTexture",null),(0,C.d)([(0,l.B)()],X.prototype,"isRenderTarget",void 0)},11674:(V,I,m)=>{var C=m(11678),l=m(11507);l.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(l.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=C.c.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((V=>{this._texture._sphericalPolynomial=V,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(V){this._texture&&(this._texture._sphericalPolynomial=V)},enumerable:!0,configurable:!0})},11161:(V,I,m)=>{m.d(I,{e:()=>F});var C,l=m(11067),s=m(11170);!function(V){V[V.Unknown=0]="Unknown",V[V.Url=1]="Url",V[V.Temp=2]="Temp",V[V.Raw=3]="Raw",V[V.Dynamic=4]="Dynamic",V[V.RenderTarget=5]="RenderTarget",V[V.MultiRenderTarget=6]="MultiRenderTarget",V[V.Cube=7]="Cube",V[V.CubeRaw=8]="CubeRaw",V[V.CubePrefiltered=9]="CubePrefiltered",V[V.Raw3D=10]="Raw3D",V[V.Raw2DArray=11]="Raw2DArray",V[V.DepthStencil=12]="DepthStencil",V[V.CubeRawRGBD=13]="CubeRawRGBD",V[V.Depth=14]="Depth"}(C||(C={}));class F extends s.c{get useMipMaps(){return this.generateMipMaps}set useMipMaps(V){this.generateMipMaps=V}get uniqueId(){return this._uniqueId}_setUniqueId(V){this._uniqueId=V}getEngine(){return this._engine}get source(){return this._source}constructor(V,I){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new l.e,this.onErrorObservable=new l.e,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._autoMSAAManagement=!1,this._engine=V,this._source=I,this._uniqueId=F._Counter++,m||(this._hardwareTexture=V._createHardwareTexture())}incrementReferences(){this._references++}updateSize(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._engine.updateTextureDimensions(this,V,I,m),this.width=V,this.height=I,this.depth=m,this.baseWidth=V,this.baseHeight=I,this.baseDepth=m,this._size=V*I*m}_rebuild(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const V=this.onRebuildCallback(this),I=I=>{I._swapAndDie(this,!1),this.isReady=V.isReady};return void(V.isAsync?V.proxy.then(I):I(V.proxy))}let V;switch(this.source){case 2:case 12:case 14:break;case 1:return void(V=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(V=>{V._swapAndDie(this,!1),this.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case 3:V=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),V._swapAndDie(this,!1),this.isReady=!0;break;case 10:V=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),V._swapAndDie(this,!1),this.isReady=!0;break;case 11:V=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),V._swapAndDie(this,!1),this.isReady=!0;break;case 4:V=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),V._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:return void(V=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(()=>{V._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null));case 8:V=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),V._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:return V=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(V=>{V&&V._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension),void(V._sphericalPolynomial=this._sphericalPolynomial)}}_swapAndDie(V){var I;let m=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null===(I=this._hardwareTexture)||void 0===I||I.setUsage(V._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),V._hardwareTexture=this._hardwareTexture,m&&(V._isRGBD=this._isRGBD),this._lodTextureHigh&&(V._lodTextureHigh&&V._lodTextureHigh.dispose(),V._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(V._lodTextureMid&&V._lodTextureMid.dispose(),V._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(V._lodTextureLow&&V._lodTextureLow.dispose(),V._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(V._irradianceTexture&&V._irradianceTexture.dispose(),V._irradianceTexture=this._irradianceTexture);const C=this._engine.getLoadedTexturesCache();let l=C.indexOf(this);-1!==l&&C.splice(l,1),l=C.indexOf(V),-1===l&&C.push(V)}dispose(){this._references--,0===this._references&&(this.onLoadedObservable.clear(),this.onErrorObservable.clear(),this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}}F._Counter=0},11543:(V,I,m)=>{m.d(I,{d:()=>l});var C=m(11518);class l extends C.e{constructor(V,I,m,l,s){let F=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],k=arguments.length>6&&void 0!==arguments[6]&&arguments[6],j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,K=arguments.length>9?arguments[9]:void 0,Y=arguments.length>10?arguments[10]:void 0,X=arguments.length>11?arguments[11]:void 0;super(null,s,!F,k,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,K),this.format=l,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==E||(j=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==E||(j=1),this._texture=this._engine.createRawTexture(V,I,m,l,F,k,j,null,E,K??0,Y??!1),this.wrapU=C.e.CLAMP_ADDRESSMODE,this.wrapV=C.e.CLAMP_ADDRESSMODE,this._waitingForData=!!X&&!V)}update(V){this._getEngine().updateRawTexture(this._texture,V,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer),this._waitingForData=!1}clone(){if(!this._texture)return super.clone();const V=new l(null,this.getSize().width,this.getSize().height,this.format,this.cV(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return V._texture=this._texture,this._texture.incrementReferences(),V}isReady(){return super.isReady()&&!this._waitingForData}static CreateLuminanceTexture(V,I,m,C){return new l(V,I,m,1,C,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(V,I,m,C){return new l(V,I,m,2,C,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(V,I,m,C){return new l(V,I,m,0,C,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(V,I,m,C){return new l(V,I,m,4,C,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(V,I,m,C){return new l(V,I,m,5,C,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9],arguments.length>10&&void 0!==arguments[10]&&arguments[10])}static CreateRGBAStorageTexture(V,I,m,C){return new l(V,I,m,5,C,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(V,I,m,s){let F=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],k=arguments.length>5&&void 0!==arguments[5]&&arguments[5],j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:C.e.TRILINEAR_SAMPLINGMODE;return new l(V,I,m,6,s,F,k,j,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(V,I,m,s){let F=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],k=arguments.length>5&&void 0!==arguments[5]&&arguments[5],j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:C.e.TRILINEAR_SAMPLINGMODE;return new l(V,I,m,6,s,F,k,j,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},11520:(V,I,m)=>{m.d(I,{c:()=>O});var C=m(11067),l=m(11040),s=m(11518),F=m(11524),k=m(11193),j=m(11143),E=m(11085),K=m(11527),Y=m(11046);class X{get renderList(){return this._renderList}set renderList(V){this._renderList!==V&&(this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),V&&(this._unObserveRenderList=(0,Y.l)(V,this._renderListHasChanged)),this._renderList=V)}get disableImageProcessing(){return this._disableImageProcessing}set disableImageProcessing(V){V!==this._disableImageProcessing&&(this._disableImageProcessing=V,this._scene.markAllMaterialsAsDirty(64))}get name(){return this._name}set name(V){if(this._name===V)return;if(this._name=V,!this._scene)return;const I=this._scene.getEngine();for(let m=0;m<this._renderPassIds.length;++m){const V=this._renderPassIds[m];I._renderPassNames[V]=`${this._name}#${m}`}}get renderPassIds(){return this._renderPassIds}get currentRefreshId(){return this._currentRefreshId}setMaterialForRendering(V,I){let m;m=Array.isArray(V)?V:[V];for(let C=0;C<m.length;++C)for(let V=0;V<this.options.numPasses;++V){let l=m[C];m[C].isAnInstance&&(l=m[C].sourceMesh),l.setMaterialForRenderPass(this._renderPassIds[V],void 0!==I?Array.isArray(I)?I[V]:I:void 0)}}constructor(V,I,m){this._unObserveRenderList=null,this._renderListHasChanged=(V,I)=>{const m=this._renderList?this._renderList.length:0;if(0===I&&m>0||0===m)for(const C of this._scene.meshes)C._markSubMeshesAsLightDirty()},this.particleSystemList=null,this.getCustomRenderList=null,this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this._disableImageProcessing=!1,this.onBeforeRenderObservable=new C.e,this.onAfterRenderObservable=new C.e,this.onBeforeRenderingManagerRenderObservable=new C.e,this.onAfterRenderingManagerRenderObservable=new C.e,this.onFastPathRenderObservable=new C.e,this._currentRefreshId=-1,this._refreshRate=1,this._currentApplyByPostProcessSetting=!1,this._currentSceneCamera=null,this.name=V,this._scene=I,this.renderList=[],this._renderPassIds=[],this.options={numPasses:1,doNotChangeAspectRatio:!0,...m},this._createRenderPassId(),this.renderPassId=this._renderPassIds[0],this._renderingManager=new K.c(I),this._renderingManager._useSceneAutoClearSetup=!0}_releaseRenderPassId(){const V=this._scene.getEngine();for(let I=0;I<this.options.numPasses;++I)V.releaseRenderPassId(this._renderPassIds[I]);this._renderPassIds.length=0}_createRenderPassId(){this._releaseRenderPassId();const V=this._scene.getEngine();for(let I=0;I<this.options.numPasses;++I)this._renderPassIds[I]=V.createRenderPassId(`${this.name}#${I}`)}resetRefreshCounter(){this._currentRefreshId=-1}get refreshRate(){return this._refreshRate}set refreshRate(V){this._refreshRate=V,this.resetRefreshCounter()}shouldRender(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}isReadyForRendering(V,I){this.prepareRenderList(),this.initRender(V,I);const m=this._checkReadiness();return this.finishRender(),m}prepareRenderList(){const V=this._scene;if(this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(let I=0;I<this._waitingRenderList.length;I++){const m=this._waitingRenderList[I],C=V.getMeshById(m);C&&this.renderList.push(C)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];const V=this._scene.meshes;for(let I=0;I<V.length;I++){const m=V[I];this.renderListPredicate(m)&&this.renderList.push(m)}}this._currentApplyByPostProcessSetting=this._scene.imageProcessingConfiguration.applyByPostProcess,this._disableImageProcessing&&(this._scene.imageProcessingConfiguration._applyByPostProcess=this._disableImageProcessing)}initRender(V,I){const m=this._scene.getEngine(),C=this.activeCamera??this._scene.activeCamera;this._currentSceneCamera=this._scene.activeCamera,C&&(C!==this._scene.activeCamera&&(this._scene.setTransformMatrix(C.getViewMatrix(),C.getProjectionMatrix(!0)),this._scene.activeCamera=C),m.setViewport(C.rigParent?C.rigParent.viewport:C.viewport,V,I)),this._defaultRenderListPrepared=!1}finishRender(){const V=this._scene;this._disableImageProcessing&&(V.imageProcessingConfiguration._applyByPostProcess=this._currentApplyByPostProcessSetting),V.activeCamera=this._currentSceneCamera,this._currentSceneCamera&&(this.activeCamera&&this.activeCamera!==V.activeCamera&&V.setTransformMatrix(this._currentSceneCamera.getViewMatrix(),this._currentSceneCamera.getProjectionMatrix(!0)),V.getEngine().setViewport(this._currentSceneCamera.viewport)),V.resetCachedMaterial()}render(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const m=this._scene,C=m.getEngine(),l=C.currentRenderPassId;C.currentRenderPassId=this._renderPassIds[V],this.onBeforeRenderObservable.notifyObservers(V);if(C.snapshotRendering&&1===C.snapshotRenderingMode)this.onFastPathRenderObservable.notifyObservers(V);else{let I=null;const C=this.renderList?this.renderList:m.getActiveMeshes().data,l=this.renderList?this.renderList.length:m.getActiveMeshes().length;this.getCustomRenderList&&(I=this.getCustomRenderList(V,C,l)),I?this._prepareRenderingManager(I,I.length,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(C,l,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),I=C),this.onBeforeRenderingManagerRenderObservable.notifyObservers(V),this._renderingManager.render(this.customRenderFunction,I,this.renderParticles,this.renderSprites),this.onAfterRenderingManagerRenderObservable.notifyObservers(V)}I||this.onAfterRenderObservable.notifyObservers(V),C.currentRenderPassId=l}_checkReadiness(){const V=this._scene,I=V.getEngine(),m=I.currentRenderPassId;let C=!0;V.getViewMatrix()||V.updateTransformMatrix();const l=this.options.numPasses;for(let F=0;F<l&&C;F++){let m=null;const s=this.renderList?this.renderList:V.getActiveMeshes().data,k=this.renderList?this.renderList.length:V.getActiveMeshes().length;I.currentRenderPassId=this._renderPassIds[F],this.onBeforeRenderObservable.notifyObservers(F),this.getCustomRenderList&&(m=this.getCustomRenderList(F,s,k)),m||(m=s),this.options.doNotChangeAspectRatio||V.updateTransformMatrix(!0);for(let V=0;V<m.length&&C;++V){const I=m[V];if(I.isEnabled()&&!I.isBlocked&&I.isVisible&&I.kk)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(I,this.refreshRate,!0)){C=!1;continue}}else if(!I.isReady(!0)){C=!1;continue}}this.onAfterRenderObservable.notifyObservers(F),l>1&&(V.incrementRenderId(),V.resetCachedMaterial())}const s=this.particleSystemList||V.ZY;for(const F of s)F.isReady()||(C=!1);return I.currentRenderPassId=m,C}_prepareRenderingManager(V,I,m){const C=this._scene,l=C.activeCamera,s=this.cameraForLOD??l;this._renderingManager.reset();const F=C.getRenderId(),k=C.getFrameId();for(let E=0;E<I;E++){const I=V[E];if(I&&!I.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(I,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!I.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}let V,j=null;if(s){const V=I._internalAbstractMeshDataInfo._currentLOD.get(s);V&&V[1]===k?j=V[0]:(j=C.customLODSelector?C.customLODSelector(I,s):I.getLOD(s),V?(V[0]=j,V[1]=k):I._internalAbstractMeshDataInfo._currentLOD.set(s,[j,k]))}else j=I;if(!j)continue;if(j!==I&&0!==j.billboardMode&&j.fF(),j._preActivateForIntermediateRendering(F),V=!(!m||!l)&&0===(I.layerMask&l.layerMask),I.isEnabled()&&I.isVisible&&I.kk&&!V){if(j!==I&&j._activate(F,!0),I._activate(F,!0)&&I.kk.length){I.isAnInstance?I._internalAbstractMeshDataInfo._actAsRegularMesh&&(j=I):j._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,j._internalAbstractMeshDataInfo._isActiveIntermediate=!0,C._prepareSkeleton(j);for(let V=0;V<j.kk.length;V++){const I=j.kk[V];this._renderingManager.dispatch(I,j)}}I._postActivate()}}}const j=this.particleSystemList||C.ZY;for(let E=0;E<j.length;E++){const V=j[E],I=V.i;V.isStarted()&&I&&(!I.position||I.isEnabled())&&this._renderingManager.dispatchParticles(V)}}setRenderingOrder(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(V,I,m,C)}setRenderingAutoClearDepthStencil(V,I){let m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],C=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(V,I,m,C),this._renderingManager._useSceneAutoClearSetup=!1}clone(){const V=new X(this.name,this._scene,this.options);return this.renderList&&(V.renderList=this.renderList.slice(0)),V}dispose(){const V=this.renderList?this.renderList:this._scene.getActiveMeshes().data,I=this.renderList?this.renderList.length:this._scene.getActiveMeshes().length;for(let m=0;m<I;m++){const I=V[m];I&&void 0!==I.getMaterialForRenderPass(this.renderPassId)&&I.setMaterialForRenderPass(this.renderPassId,void 0)}this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderingManagerRenderObservable.clear(),this.onAfterRenderingManagerRenderObservable.clear(),this.onFastPathRenderObservable.clear(),this._releaseRenderPassId(),this.renderList=null}_rebuild(){this.refreshRate===X.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=X.REFRESHRATE_RENDER_ONCE)}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}}X.REFRESHRATE_RENDER_ONCE=0,X.REFRESHRATE_RENDER_ONEVERYFRAME=1,X.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,j.c.prototype.setDepthStencilTexture=function(V,I){this._engine.setDepthStencilTexture(this._samplers[V],this._uniforms[V],I,V)};class O extends s.e{get renderListPredicate(){return this._objectRenderer.renderListPredicate}set renderListPredicate(V){this._objectRenderer.renderListPredicate=V}get renderList(){return this._objectRenderer.renderList}set renderList(V){this._objectRenderer.renderList=V}get particleSystemList(){return this._objectRenderer.particleSystemList}set particleSystemList(V){this._objectRenderer.particleSystemList=V}get getCustomRenderList(){return this._objectRenderer.getCustomRenderList}set getCustomRenderList(V){this._objectRenderer.getCustomRenderList=V}get renderParticles(){return this._objectRenderer.renderParticles}set renderParticles(V){this._objectRenderer.renderParticles=V}get renderSprites(){return this._objectRenderer.renderSprites}set renderSprites(V){this._objectRenderer.renderSprites=V}get forceLayerMaskCheck(){return this._objectRenderer.forceLayerMaskCheck}set forceLayerMaskCheck(V){this._objectRenderer.forceLayerMaskCheck=V}get activeCamera(){return this._objectRenderer.activeCamera}set activeCamera(V){this._objectRenderer.activeCamera=V}get cameraForLOD(){return this._objectRenderer.cameraForLOD}set cameraForLOD(V){this._objectRenderer.cameraForLOD=V}get disableImageProcessing(){return this._objectRenderer.disableImageProcessing}set disableImageProcessing(V){this._objectRenderer.disableImageProcessing=V}get customIsReadyFunction(){return this._objectRenderer.customIsReadyFunction}set customIsReadyFunction(V){this._objectRenderer.customIsReadyFunction=V}get customRenderFunction(){return this._objectRenderer.customRenderFunction}set customRenderFunction(V){this._objectRenderer.customRenderFunction=V}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(V){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(V)}get onBeforeRenderObservable(){return this._objectRenderer.onBeforeRenderObservable}set onBeforeRender(V){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(V)}get onAfterRenderObservable(){return this._objectRenderer.onAfterRenderObservable}set onAfterRender(V){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(V)}set onClear(V){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(V)}get _waitingRenderList(){return this._objectRenderer._waitingRenderList}set _waitingRenderList(V){this._objectRenderer._waitingRenderList=V}get renderPassId(){return this._objectRenderer.renderPassId}get renderPassIds(){return this._objectRenderer.renderPassIds}get currentRefreshId(){return this._objectRenderer.currentRefreshId}setMaterialForRendering(V,I){this._objectRenderer.setMaterialForRendering(V,I)}get isMulti(){var V;return(null===(V=this._renderTarget)||void 0===V?void 0:V.isMulti)??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(V){if(this._boundingBoxSize&&this._boundingBoxSize.equals(V))return;this._boundingBoxSize=V;const I=this.cV();I&&I.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){var V;return(null===(V=this._renderTarget)||void 0===V?void 0:V._depthStencilTexture)??null}constructor(V,I,m){let F,k,j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],K=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,O=arguments.length>6&&void 0!==arguments[6]&&arguments[6],v=arguments.length>7&&void 0!==arguments[7]?arguments[7]:s.e.TRILINEAR_SAMPLINGMODE,N=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],t=arguments.length>9&&void 0!==arguments[9]&&arguments[9],D=arguments.length>10&&void 0!==arguments[10]&&arguments[10],b=arguments.length>11&&void 0!==arguments[11]?arguments[11]:5,T=arguments.length>12&&void 0!==arguments[12]&&arguments[12],n=arguments.length>13?arguments[13]:void 0,x=arguments.length>14?arguments[14]:void 0,S=arguments.length>15&&void 0!==arguments[15]&&arguments[15],c=arguments.length>16&&void 0!==arguments[16]&&arguments[16],H=!0;if("object"===typeof j){const V=j;j=!!V.generateMipMaps,K=V.doNotChangeAspectRatio??!0,Y=V.type??0,O=!!V.isCube,v=V.samplingMode??s.e.TRILINEAR_SAMPLINGMODE,N=V.generateDepthBuffer??!0,t=!!V.generateStencilBuffer,D=!!V.isMulti,b=V.format??5,T=!!V.delayAllocation,n=V.samples,x=V.creationFlags,S=!!V.noColorAttachment,c=!!V.useSRGBBuffer,F=V.colorAttachment,H=V.gammaSpace??H,k=V.existingObjectRenderer}if(super(null,m,!j,void 0,v,void 0,void 0,void 0,void 0,b),this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new C.e,this.onAfterUnbindObservable=new C.e,this.onClearObservable=new C.e,this.onResizeObservable=new C.e,this._cleared=!1,this.skipInitialClear=!1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this._dontDisposeObjectRenderer=!1,this.boundingBoxPosition=l.m.Zero(),this._disableEngineStages=!1,this._dumpToolsLoading=!1,!(m=this.cV()))return;const y=this.cV().getEngine();this._gammaSpace=H,this._coordinatesMode=s.e.PROJECTION_MODE,this.name=V,this.isRenderTarget=!0,this._initialSizeParameter=I,this._dontDisposeObjectRenderer=!!k,this._processSizeParameter(I),this._objectRenderer=k??new X(V,m,{numPasses:O?6:this.getRenderLayers()||1,doNotChangeAspectRatio:K}),this._onBeforeRenderingManagerRenderObserver=this._objectRenderer.onBeforeRenderingManagerRenderObservable.add((()=>{if(!this._disableEngineStages)for(const V of this._scene._beforeRenderTargetClearStage)V.action(this,this._currentFaceIndex,this._currentLayer);if(this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(y):this.skipInitialClear||y.clear(this.clearColor||this._scene.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||this._scene.updateTransformMatrix(!0),!this._disableEngineStages)for(const V of this._scene._beforeRenderTargetDrawStage)V.action(this,this._currentFaceIndex,this._currentLayer)})),this._onAfterRenderingManagerRenderObserver=this._objectRenderer.onAfterRenderingManagerRenderObservable.add((()=>{var V;if(!this._disableEngineStages)for(const m of this._scene._afterRenderTargetDrawStage)m.action(this,this._currentFaceIndex,this._currentLayer);const I=(null===(V=this._texture)||void 0===V?void 0:V.generateMipMaps)??!1;if(this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,this._currentFaceIndex,this._postProcesses,this.ignoreCameraViewport):this._currentUseCameraPostProcess&&this._scene.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,this._currentFaceIndex),!this._disableEngineStages)for(const m of this._scene._afterRenderTargetPostProcessStage)m.action(this,this._currentFaceIndex,this._currentLayer);this._texture&&(this._texture.generateMipMaps=I),this._doNotChangeAspectRatio||this._scene.updateTransformMatrix(!0),this._currentDumpForDebug&&(this._dumpTools?this._dumpTools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),y):E.d.Error("dumpTools module is still being loaded. To speed up the process import dump tools directly in your project"))})),this._onFastPathRenderObserver=this._objectRenderer.onFastPathRenderObservable.add((()=>{this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(y):this.skipInitialClear||y.clear(this.clearColor||this._scene.clearColor,!0,!0,!0)})),this._resizeObserver=y.onResizeObservable.add((()=>{})),this._generateMipMaps=!!j,this._doNotChangeAspectRatio=K,D||(this._renderTargetOptions={generateMipMaps:j,type:Y,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:N,generateStencilBuffer:t,samples:n,creationFlags:x,noColorAttachment:S,useSRGBBuffer:c,colorAttachment:F,label:this.name},this.samplingMode===s.e.NEAREST_SAMPLINGMODE&&(this.wrapU=s.e.CLAMP_ADDRESSMODE,this.wrapV=s.e.CLAMP_ADDRESSMODE),T||(O?(this._renderTarget=m.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=s.e.INVCUBIC_MODE,this._textureMatrix=l.b.Identity()):this._renderTarget=m.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==n&&(this.samples=n)))}createDepthStencilTexture(){var V;let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,m=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,F=arguments.length>5?arguments[5]:void 0;null===(V=this._renderTarget)||void 0===V||V.createDepthStencilTexture(I,m,C,l,s,F)}_processSizeParameter(V){if(V.ratio){this._sizeRatio=V.ratio;const I=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(I.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(I.getRenderHeight(),this._sizeRatio)}}else this._size=V}get samples(){var V;return(null===(V=this._renderTarget)||void 0===V?void 0:V.samples)??this._samples}set samples(V){this._renderTarget&&(this._samples=this._renderTarget.setSamples(V))}addPostProcess(V){if(!this._postProcessManager){const V=this.cV();if(!V)return;this._postProcessManager=new F.d(V),this._postProcesses=new Array}this._postProcesses.push(V),this._postProcesses[0].FY=!1}clearPostProcesses(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._postProcesses){if(V)for(const V of this._postProcesses)V.dispose();this._postProcesses=[]}}removePostProcess(V){if(!this._postProcesses)return;const I=this._postProcesses.indexOf(V);-1!==I&&(this._postProcesses.splice(I,1),this._postProcesses.length>0&&(this._postProcesses[0].FY=!1))}resetRefreshCounter(){this._objectRenderer.resetRefreshCounter()}get refreshRate(){return this._objectRenderer.refreshRate}set refreshRate(V){this._objectRenderer.refreshRate=V}_shouldRender(){return this._objectRenderer.shouldRender()}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){const V=this._size.layers;if(V)return V;const I=this._size.depth;return I||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(V){const I=Math.max(1,this.getRenderSize()*V);this.resize(I)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(V){var I;const m=this.isCube;null===(I=this._renderTarget)||void 0===I||I.dispose(),this._renderTarget=null;const C=this.cV();C&&(this._processSizeParameter(V),this._renderTarget=m?C.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):C.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._render(V,I)}isReadyForRendering(){this._dumpToolsLoading||(this._dumpToolsLoading=!0,Promise.resolve().then(m.bind(m,11560)).then((V=>this._dumpTools=V))),this._objectRenderer.prepareRenderList(),this.onBeforeBindObservable.notifyObservers(this),this._objectRenderer.initRender(this.getRenderWidth(),this.getRenderHeight());const V=this._objectRenderer._checkReadiness();return this.onAfterUnbindObservable.notifyObservers(this),this._objectRenderer.finishRender(),V}_render(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const m=this.cV();if(m){if(void 0!==this.useCameraPostProcesses&&(V=this.useCameraPostProcesses),this._objectRenderer.prepareRenderList(),this.onBeforeBindObservable.notifyObservers(this),this._objectRenderer.initRender(this.getRenderWidth(),this.getRenderHeight()),!this.is2DArray&&!this.is3D||this.isMulti)if(this.isCube&&!this.isMulti)for(let C=0;C<6;C++)this._renderToTarget(C,V,I),m.incrementRenderId(),m.resetCachedMaterial();else this._renderToTarget(0,V,I);else for(let C=0;C<this.getRenderLayers();C++)this._renderToTarget(0,V,I,C),m.incrementRenderId(),m.resetCachedMaterial();this.onAfterUnbindObservable.notifyObservers(this),this._objectRenderer.finishRender()}}_bestReflectionRenderTargetDimension(V,I){const m=V*I,C=(0,k.s)(m+16384/(128+m));return Math.min((0,k.e)(V),C)}_bindFrameBuffer(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const m=this.cV();if(!m)return;const C=m.getEngine();this._renderTarget&&C.bindFramebuffer(this._renderTarget,this.isCube?V:void 0,void 0,void 0,this.ignoreCameraViewport,0,I)}_unbindFrameBuffer(V,I){this._renderTarget&&V.unBindFramebuffer(this._renderTarget,this.isCube,(()=>{this.onAfterRenderObservable.notifyObservers(I)}))}_prepareFrame(V,I,m,C){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses)||this._bindFrameBuffer(I,m):C&&V.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(I,m)}_renderToTarget(V,I,m){var C,l;let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const F=this.cV();if(!F)return;const k=F.getEngine();this._currentFaceIndex=V,this._currentLayer=s,this._currentUseCameraPostProcess=I,this._currentDumpForDebug=m,this._prepareFrame(F,V,s,I),null===(C=k._debugPushGroup)||void 0===C||C.call(k,`render to face #${V} layer #${s}`,2),this._objectRenderer.render(V+s,!0),null===(l=k._debugPopGroup)||void 0===l||l.call(k,2),this._unbindFrameBuffer(k,V),this._texture&&this.isCube&&5===V&&k.generateMipMapsForCubemap(this._texture,!0)}setRenderingOrder(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._objectRenderer.setRenderingOrder(V,I,m,C)}setRenderingAutoClearDepthStencil(V,I){this._objectRenderer.setRenderingAutoClearDepthStencil(V,I)}clone(){const V=this.getSize(),I=new O(this.name,V,this.cV(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return I.eF=this.eF,I.level=this.level,I.coordinatesMode=this.coordinatesMode,this.renderList&&(I.renderList=this.renderList.slice(0)),I}serialize(){if(!this.name)return null;const V=super.serialize();if(V.renderTargetSize=this.getRenderSize(),V.renderList=[],this.renderList)for(let I=0;I<this.renderList.length;I++)V.renderList.push(this.renderList[I].id);return V}disposeFramebufferObjects(){var V;null===(V=this._renderTarget)||void 0===V||V.dispose(!0)}releaseInternalTexture(){var V;null===(V=this._renderTarget)||void 0===V||V.releaseTextures(),this._texture=null}dispose(){var V;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._objectRenderer.onBeforeRenderingManagerRenderObservable.remove(this._onBeforeRenderingManagerRenderObserver),this._objectRenderer.onAfterRenderingManagerRenderObservable.remove(this._onAfterRenderingManagerRenderObserver),this._objectRenderer.onFastPathRenderObservable.remove(this._onFastPathRenderObserver),this._dontDisposeObjectRenderer||this._objectRenderer.dispose(),this.clearPostProcesses(!0),this._resizeObserver&&(this.cV().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null);const I=this.cV();if(!I)return;let m=I.customRenderTargets.indexOf(this);m>=0&&I.customRenderTargets.splice(m,1);for(const C of I.cameras)m=C.customRenderTargets.indexOf(this),m>=0&&C.customRenderTargets.splice(m,1);null===(V=this._renderTarget)||void 0===V||V.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this._objectRenderer._rebuild(),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._objectRenderer.freeRenderingGroups()}getViewCount(){return 1}}O.REFRESHRATE_RENDER_ONCE=X.REFRESHRATE_RENDER_ONCE,O.REFRESHRATE_RENDER_ONEVERYFRAME=X.REFRESHRATE_RENDER_ONEVERYFRAME,O.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=X.REFRESHRATE_RENDER_ONEVERYTWOFRAMES,s.e._CreateRenderTargetTexture=(V,I,m,C,l)=>new O(V,I,m,C)},11518:(V,I,m)=>{m.d(I,{e:()=>T});var C=m(11206),l=m(11214),s=m(11067),F=m(11040),k=m(11507),j=m(11048),E=m(11095),K=m(11129),Y=m(11181),X=m(11289),O=m(11118);function v(V,I){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const C=I.width,l=I.height;if(V instanceof Float32Array){let I=V.byteLength/V.BYTES_PER_ELEMENT;const m=new Uint8Array(I);for(;--I>=0;){let C=V[I];C<0?C=0:C>1&&(C=1),m[I]=255*C}V=m}const s=document.createElement("canvas");s.width=C,s.height=l;const F=s.getContext("2d");if(!F)return null;const k=F.createImageData(C,l);if(k.data.set(V),F.putImageData(k,0,0),m){const V=document.createElement("canvas");V.width=C,V.height=l;const I=V.getContext("2d");return I?(I.translate(0,l),I.scale(1,-1),I.drawImage(s,0,0),V.toDataURL("image/png")):null}return s.toDataURL("image/png")}function N(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const C=V.getInternalTexture();if(!C)return null;const l=V._readPixelsSync(I,m);return l?v(l,V.getSize(),C.invertY):null}async function t(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const C=V.getInternalTexture();if(!C)return null;const l=await V.readPixels(I,m);return l?v(l,V.getSize(),C.invertY):null}var D=m(11415),b=m(11297);class T extends k.b{static _CreateVideoTexture(V,I,m){arguments.length>5&&void 0!==arguments[5]||T.TRILINEAR_SAMPLINGMODE;throw(0,E.c)("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(V){this._isBlocking=V}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(V,I,m,C){let l,F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:T.TRILINEAR_SAMPLINGMODE,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Y=arguments.length>8&&void 0!==arguments[8]&&arguments[8],X=arguments.length>9?arguments[9]:void 0,O=arguments.length>10?arguments[10]:void 0,v=arguments.length>11?arguments[11]:void 0,N=arguments.length>12?arguments[12]:void 0,t=arguments.length>13?arguments[13]:void 0;super(I),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new s.e,this._isBlocking=!0,this.name=V||"",this.url=V;let b=!1,n=null,x=!0;"object"===typeof m&&null!==m?(l=m.noMipmap??!1,C=m.invertY??!D.e,F=m.samplingMode??T.TRILINEAR_SAMPLINGMODE,k=m.J??null,j=m.onError??null,E=m.buffer??null,Y=m.deleteBuffer??!1,X=m.format,O=m.mimeType,v=m.loaderOptions,N=m.creationFlags,b=m.useSRGBBuffer??!1,n=m.internalTexture??null,x=m.gammaSpace??x,t=m.forcedExtension??t):l=!!m,this._gammaSpace=x,this._noMipmap=l,this._invertY=void 0===C?!D.e:C,this._initialSamplingMode=F,this._buffer=E,this._deleteBuffer=Y,this._mimeType=O,this._loaderOptions=v,this._creationFlags=N,this._useSRGBBuffer=b,this._forcedExtension=t,void 0!==X&&(this._format=X);const S=this.cV(),c=this._getEngine();if(!c)return;c.onBeforeTextureInitObservable.notifyObservers(this);const H=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),k&&k(),!this.isBlocking&&S&&S.resetCachedMaterial()},y=(V,I)=>{this._loadingError=!0,this._errorObject={message:V,exception:I},j&&j(V,I),T.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!n)return this._delayedOnLoad=H,void(this._delayedOnError=y);if(this._texture=n??this._getFromCache(this.url,l,F,this._invertY,b,this.isCube),this._texture)if(this._texture.isReady)K.e.SetImmediate((()=>H()));else{const V=this._texture.onLoadedObservable.add(H);this._texture.onErrorObservable.add((I=>{var m;y(I.message,I.exception),null===(m=this._texture)||void 0===m||m.onLoadedObservable.remove(V)}))}else if(S&&S.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=H,this._delayedOnError=y;else{try{this._texture=c.createTexture(this.url,l,this._invertY,S,F,H,y,this._buffer,void 0,this._format,this._forcedExtension,O,v,N,b)}catch(z){throw y("error loading",z),z}Y&&(this._buffer=null)}}updateURL(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2?arguments[2]:void 0,C=arguments.length>3?arguments[3]:void 0;this.url&&(this.releaseInternalTexture(),this.cV().markAllMaterialsAsDirty(1,(V=>V.hasTexture(this)))),this.name&&!this.name.startsWith("data:")||(this.name=V),this.url=V,this._buffer=I,this._forcedExtension=C,this.delayLoadState=4,m&&(this._delayedOnLoad=m),this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;const V=this.cV();V&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?K.e.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=V.getEngine().createTexture(this.url,this._noMipmap,this._invertY,V,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(V,I,m,C){V*=this._cachedUScale,I*=this._cachedVScale,V-=this.uRotationCenter*this._cachedUScale,I-=this.vRotationCenter*this._cachedVScale,m-=this.wRotationCenter,F.m.TransformCoordinatesFromFloatsToRef(V,I,m,this._rowGenerationMatrix,C),C.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,C.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,C.z+=this.wRotationCenter}getTextureMatrix(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*V===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*V,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=F.b.Zero(),this._rowGenerationMatrix=new F.b,this._t0=F.m.Zero(),this._t1=F.m.Zero(),this._t2=F.m.Zero()),F.b.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(F.b.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,F.g.Matrix[0]),F.b.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,F.g.Matrix[1]),F.b.ScalingToRef(this._cachedUScale,this._cachedVScale,0,F.g.Matrix[2]),F.b.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,F.g.Matrix[3]),F.g.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(F.g.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(F.g.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(F.g.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.WK(this._t0),this._t2.WK(this._t0),F.b.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const I=this.cV();if(!I)return this._cachedTextureMatrix;const m=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&m!==this._cachedIdentity3x2&&I.markAllMaterialsAsDirty(1,(V=>V.hasTexture(this))),this._cachedTextureMatrix}getReflectionTextureMatrix(){const V=this.cV();if(!V)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==T.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===V.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=F.b.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=F.b.Zero());const I=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case T.PLANAR_MODE:F.b.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case T.PROJECTION_MODE:{F.b.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const I=V.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=I.updateFlag,I.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:F.b.IdentityToRef(this._cachedReflectionTextureMatrix)}return I&&V.markAllMaterialsAsDirty(1,(V=>V.hasTexture(this))),this._cachedReflectionTextureMatrix}clone(){const V={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,J:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return b.d.Clone((()=>new T(this._texture?this._texture.url:null,this.cV(),V)),this)}serialize(){var V;const I=this.name;T.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const m=super.serialize(T._SerializeInternalTextureUniqueId);if(!m)return null;if(T.SerializeBuffers||T.ForceSerializeBuffers)if("string"===typeof this._buffer&&this._buffer.startsWith("data:"))m.base64String=this._buffer,m.name=m.name.replace("data:","");else if(this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array){const V=this.mimeType||"image/png";m.base64String=`data:${V};base64,${(0,O.k)(this._buffer)}`}else(T.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(m.base64String=!this._engine||this._engine._features.supportSyncTextureRead?N(this):t(this));var C;(m.invertY=this._invertY,m.samplingMode=this.samplingMode,m._creationFlags=this._creationFlags,m._useSRGBBuffer=this._useSRGBBuffer,T._SerializeInternalTextureUniqueId)&&(m.internalTextureUniqueId=null===(C=this._texture)||void 0===C?void 0:C.uniqueId);return m.internalTextureLabel=null===(V=this._texture)||void 0===V?void 0:V.label,m.noMipmap=this._noMipmap,this.name=I,m}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(V,I,m){if(V.customType){const C=Y.c.Instantiate(V.customType).Parse(V,I,m);return V.samplingMode&&C.updateSamplingMode&&C._samplingMode&&C._samplingMode!==V.samplingMode&&C.updateSamplingMode(V.samplingMode),C}if(V.isCube&&!V.isRenderTarget)return T._CubeTextureParser(V,I,m);const C=void 0!==V.internalTextureUniqueId;if(!V.name&&!V.isRenderTarget&&!C)return null;let l;if(C){const m=I.getEngine().getLoadedTexturesCache();for(const I of m)if(I.uniqueId===V.internalTextureUniqueId){l=I;break}}const s=I=>{if(I&&I._texture&&(I._texture._cachedWrapU=null,I._texture._cachedWrapV=null,I._texture._cachedWrapR=null),V.samplingMode){const m=V.samplingMode;I&&I.samplingMode!==m&&I.updateSamplingMode(m)}if(I&&V.animations)for(let m=0;m<V.animations.length;m++){const C=V.animations[m],l=(0,j.d)("BABYLON.Animation");l&&I.animations.push(l.Parse(C))}I&&I._texture&&(C&&!l&&I._texture._setUniqueId(V.internalTextureUniqueId),I._texture.label=V.internalTextureLabel)};return b.d.Parse((()=>{let C=!0;if(V.noMipmap&&(C=!1),V.mirrorPlane){const m=T._CreateMirror(V.name,V.renderTargetSize,I,C);return m._waitingRenderList=V.renderList,m.mirrorPlane=X.e.Ik(V.mirrorPlane),s(m),m}if(V.isRenderTarget){let m=null;if(V.isCube){if(I.reflectionProbes)for(let C=0;C<I.reflectionProbes.length;C++){const m=I.reflectionProbes[C];if(m.name===V.name)return m.cubeTexture}}else m=T._CreateRenderTargetTexture(V.name,V.renderTargetSize,I,C,V._creationFlags??0),m._waitingRenderList=V.renderList;return s(m),m}if(V.isVideo){const l=T._CreateVideoTexture(m+(V.url||V.name),m+(V.src||V.url),I,C,V.invertY,V.samplingMode,V.settings||{});return s(l),l}{let F;if(V.base64String&&!l)F=T.CreateFromBase64String(V.base64String,V.base64String,I,!C,V.invertY,V.samplingMode,(()=>{s(F)}),V._creationFlags??0,V._useSRGBBuffer??!1),F.name=V.name;else{let k;k=V.name&&(V.name.indexOf("://")>0||V.name.startsWith("data:"))?V.name:m+V.name,V.url&&(V.url.startsWith("data:")||T.UseSerializedUrlIfAny)&&(k=V.url);const j={noMipmap:!C,invertY:V.invertY,samplingMode:V.samplingMode,J:()=>{s(F)},internalTexture:l};F=new T(k,I,j)}return F}}),V,I)}static CreateFromBase64String(V,I,m,C,l){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:T.TRILINEAR_SAMPLINGMODE;return new T("data:"+I,m,C,l,s,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,V,!1,arguments.length>8&&void 0!==arguments[8]?arguments[8]:5,void 0,void 0,arguments.length>9?arguments[9]:void 0,arguments.length>10?arguments[10]:void 0)}static LoadFromDataString(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=arguments.length>4?arguments[4]:void 0,s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:T.TRILINEAR_SAMPLINGMODE,k=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,E=arguments.length>9&&void 0!==arguments[9]?arguments[9]:5,K=arguments.length>10?arguments[10]:void 0,Y=arguments.length>11?arguments[11]:void 0;return"data:"!==V.substring(0,5)&&(V="data:"+V),new T(V,m,l,s,F,k,j,I,C,E,void 0,void 0,K,Y)}}T.SerializeBuffers=!0,T.ForceSerializeBuffers=!1,T.OnTextureLoadErrorObservable=new s.e,T._SerializeInternalTextureUniqueId=!1,T._CubeTextureParser=(V,I,m)=>{throw(0,E.c)("CubeTexture")},T._CreateMirror=(V,I,m,C)=>{throw(0,E.c)("MirrorTexture")},T._CreateRenderTargetTexture=(V,I,m,C,l)=>{throw(0,E.c)("RenderTargetTexture")},T.NEAREST_SAMPLINGMODE=1,T.NEAREST_NEAREST_MIPLINEAR=8,T.BILINEAR_SAMPLINGMODE=2,T.LINEAR_LINEAR_MIPNEAREST=11,T.TRILINEAR_SAMPLINGMODE=3,T.LINEAR_LINEAR_MIPLINEAR=3,T.NEAREST_NEAREST_MIPNEAREST=4,T.NEAREST_LINEAR_MIPNEAREST=5,T.NEAREST_LINEAR_MIPLINEAR=6,T.NEAREST_LINEAR=7,T.NEAREST_NEAREST=1,T.LINEAR_NEAREST_MIPNEAREST=9,T.LINEAR_NEAREST_MIPLINEAR=10,T.LINEAR_LINEAR=2,T.LINEAR_NEAREST=12,T.EXPLICIT_MODE=0,T.SPHERICAL_MODE=1,T.PLANAR_MODE=2,T.CUBIC_MODE=3,T.PROJECTION_MODE=4,T.SKYBOX_MODE=5,T.INVCUBIC_MODE=6,T.EQUIRECTANGULAR_MODE=7,T.FIXED_EQUIRECTANGULAR_MODE=8,T.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,T.CLAMP_ADDRESSMODE=0,T.WRAP_ADDRESSMODE=1,T.MIRROR_ADDRESSMODE=2,T.UseSerializedUrlIfAny=!1,(0,C.d)([(0,l.B)()],T.prototype,"url",void 0),(0,C.d)([(0,l.B)()],T.prototype,"uOffset",void 0),(0,C.d)([(0,l.B)()],T.prototype,"vOffset",void 0),(0,C.d)([(0,l.B)()],T.prototype,"uScale",void 0),(0,C.d)([(0,l.B)()],T.prototype,"vScale",void 0),(0,C.d)([(0,l.B)()],T.prototype,"uAng",void 0),(0,C.d)([(0,l.B)()],T.prototype,"vAng",void 0),(0,C.d)([(0,l.B)()],T.prototype,"wAng",void 0),(0,C.d)([(0,l.B)()],T.prototype,"uRotationCenter",void 0),(0,C.d)([(0,l.B)()],T.prototype,"vRotationCenter",void 0),(0,C.d)([(0,l.B)()],T.prototype,"wRotationCenter",void 0),(0,C.d)([(0,l.B)()],T.prototype,"homogeneousRotationInUVTransform",void 0),(0,C.d)([(0,l.B)()],T.prototype,"isBlocking",null),(0,j.h)("BABYLON.Texture",T),b.d._TextureParser=T.Parse},11458:(V,I,m)=>{function C(V){return 13===V||14===V||15===V||16===V||17===V||18===V||19===V}function l(V){return 13===V||17===V||18===V||19===V}m.d(I,{c:()=>l,f:()=>C})},11170:(V,I,m)=>{m.d(I,{c:()=>C});class C{get wrapU(){return this._cachedWrapU}set wrapU(V){this._cachedWrapU=V}get wrapV(){return this._cachedWrapV}set wrapV(V){this._cachedWrapV=V}get wrapR(){return this._cachedWrapR}set wrapR(V){this._cachedWrapR=V}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(V){this._cachedAnisotropicFilteringLevel=V}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(V){this._comparisonFunction=V}get useMipMaps(){return this._useMipMaps}set useMipMaps(V){this._useMipMaps=V}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this._cachedWrapU=V,this._cachedWrapV=I,this._cachedWrapR=m,this._cachedAnisotropicFilteringLevel=C,this.samplingMode=l,this._comparisonFunction=s,this}compareSampler(V){return this._cachedWrapU===V._cachedWrapU&&this._cachedWrapV===V._cachedWrapV&&this._cachedWrapR===V._cachedWrapR&&this._cachedAnisotropicFilteringLevel===V._cachedAnisotropicFilteringLevel&&this.samplingMode===V.samplingMode&&this._comparisonFunction===V._comparisonFunction&&this._useMipMaps===V._useMipMaps}}},11327:(V,I,m)=>{function C(V){-1===V.indexOf("vClipPlane")&&V.push("vClipPlane"),-1===V.indexOf("vClipPlane2")&&V.push("vClipPlane2"),-1===V.indexOf("vClipPlane3")&&V.push("vClipPlane3"),-1===V.indexOf("vClipPlane4")&&V.push("vClipPlane4"),-1===V.indexOf("vClipPlane5")&&V.push("vClipPlane5"),-1===V.indexOf("vClipPlane6")&&V.push("vClipPlane6")}function l(V,I,m){const C=!!(V.clipPlane??I.clipPlane),l=!!(V.clipPlane2??I.clipPlane2),s=!!(V.clipPlane3??I.clipPlane3),F=!!(V.clipPlane4??I.clipPlane4),k=!!(V.clipPlane5??I.clipPlane5),j=!!(V.clipPlane6??I.clipPlane6);C&&m.push("#define CLIPPLANE"),l&&m.push("#define CLIPPLANE2"),s&&m.push("#define CLIPPLANE3"),F&&m.push("#define CLIPPLANE4"),k&&m.push("#define CLIPPLANE5"),j&&m.push("#define CLIPPLANE6")}function s(V,I,m){let C=!1;const l=!!(V.clipPlane??I.clipPlane),s=!!(V.clipPlane2??I.clipPlane2),F=!!(V.clipPlane3??I.clipPlane3),k=!!(V.clipPlane4??I.clipPlane4),j=!!(V.clipPlane5??I.clipPlane5),E=!!(V.clipPlane6??I.clipPlane6);return m.CLIPPLANE!==l&&(m.CLIPPLANE=l,C=!0),m.CLIPPLANE2!==s&&(m.CLIPPLANE2=s,C=!0),m.CLIPPLANE3!==F&&(m.CLIPPLANE3=F,C=!0),m.CLIPPLANE4!==k&&(m.CLIPPLANE4=k,C=!0),m.CLIPPLANE5!==j&&(m.CLIPPLANE5=j,C=!0),m.CLIPPLANE6!==E&&(m.CLIPPLANE6=E,C=!0),C}function F(V,I,m){let C=I.clipPlane??m.clipPlane;k(V,"vClipPlane",C),C=I.clipPlane2??m.clipPlane2,k(V,"vClipPlane2",C),C=I.clipPlane3??m.clipPlane3,k(V,"vClipPlane3",C),C=I.clipPlane4??m.clipPlane4,k(V,"vClipPlane4",C),C=I.clipPlane5??m.clipPlane5,k(V,"vClipPlane5",C),C=I.clipPlane6??m.clipPlane6,k(V,"vClipPlane6",C)}function k(V,I,m){m&&V.setFloat4(I,m.XC.x,m.XC.y,m.XC.z,m.d)}m.d(I,{b:()=>C,d:()=>F,g:()=>s,i:()=>l})},11612:(V,I,m)=>{function C(V){V.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}m.d(I,{c:()=>C})},11442:(V,I,m)=>{function C(V){return void 0===V.getPipelineContext}m.d(I,{b:()=>C})},11274:(V,I,m)=>{m.d(I,{b:()=>l});var C=m(11129);class l{static GetEffect(V){return void 0===V.getPipelineContext?V.effect:V}constructor(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=V.createDrawContext(),I&&(this.materialContext=V.createMaterialContext())}setEffect(V,I){let m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var C;(this.effect=V,void 0!==I&&(this.defines=I),m)&&(null===(C=this.drawContext)||void 0===C||C.reset())}dispose(){var V;let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const V=this.effect;I?V.dispose():C.e.SetImmediate((()=>{V.getEngine().onEndFrameObservable.addOnce((()=>{V.dispose()}))})),this.effect=null}null===(V=this.drawContext)||void 0===V||V.dispose()}}},11154:(V,I,m)=>{m.d(I,{d:()=>Y,e:()=>O,h:()=>E,k:()=>K});var C=m(11081),l=m(11156),s=m(11150),F=m(11085),k=m(11121),j=m(11125);function E(V,I){return(0,l.A)(I).cachedPipelines[V]}function K(V){const I=V._name,m=V.context;if(I&&m){const V=(0,l.A)(m),C=V.cachedPipelines[I];null===C||void 0===C||C.dispose(),delete V.cachedPipelines[I]}}function Y(V,I,m,l,s,F,j){let E,K;const Y=(0,C.o)()?null===F||void 0===F?void 0:F.getHostDocument():null;E="string"===typeof I?I:I.vertexSource?"source:"+I.vertexSource:I.vertexElement?(null===Y||void 0===Y?void 0:Y.getElementById(I.vertexElement))||I.vertexElement:I.vertex||I,K="string"===typeof I?I:I.fragmentSource?"source:"+I.fragmentSource:I.fragmentElement?(null===Y||void 0===Y?void 0:Y.getElementById(I.fragmentElement))||I.fragmentElement:I.fragment||I;const O=[void 0,void 0],v=()=>{if(O[0]&&O[1]){V.isFragment=!0;const[C,E]=O;(0,k.m)(E,V,((F,E)=>{j&&(j._fragmentSourceCodeBeforeMigration=E),m&&(F=m("fragment",F));const K=(0,k.e)(C,F,V);V=null;const Y=function(V,I,m,C){if(m){return{vertexSourceCode:(1===C?"//":"")+"#define SHADER_NAME vertex:"+(m.vertexElement||m.vertex||m.spectorName||m)+"\n"+V,fragmentSourceCode:(1===C?"//":"")+"#define SHADER_NAME fragment:"+(m.fragmentElement||m.fragment||m.spectorName||m)+"\n"+I}}return{vertexSourceCode:V,fragmentSourceCode:I}}(K.vertexCode,K.fragmentCode,I,s);null===l||void 0===l||l(Y.vertexSourceCode,Y.fragmentSourceCode)}),F)}};X(E,"Vertex","",(I=>{(0,k.g)(V),(0,k.m)(I,V,((V,C)=>{j&&(j._rawVertexSourceCode=I,j._vertexSourceCodeBeforeMigration=C),m&&(V=m("vertex",V)),O[0]=V,v()}),F)}),s),X(K,"Fragment","Pixel",(V=>{j&&(j._rawFragmentSourceCode=V),O[1]=V,v()}),s)}function X(V,I,m,l,F,k){if("undefined"!==typeof HTMLElement&&V instanceof HTMLElement){return void l((0,C.e)(V))}if("source:"===V.substring(0,7))return void l(V.substring(7));if("base64:"===V.substring(0,7)){return void l(window.atob(V.substring(7)))}const E=s.e.GetShadersStore(F);if(E[V+I+"Shader"])return void l(E[V+I+"Shader"]);if(m&&E[V+m+"Shader"])return void l(E[V+m+"Shader"]);let K;if(K="."===V[0]||"/"===V[0]||V.indexOf("http")>-1?V:s.e.GetShadersRepository(F)+V,!(k=k||j.n))throw new Error("loadFileInjection is not defined");k(K+"."+I.toLowerCase()+".fx",l)}const O=(V,I,m,C)=>{try{const s=V.context?(0,l.A)(V.context):null;s&&(s.disableParallelShaderCompile=V.disableParallelCompilation);const F=V.existingPipelineContext||I(V.shaderProcessingContext);return F._name=V.name,V.name&&s&&(s.cachedPipelines[V.name]=F),m(F,V.vertex,V.fragment,!!V.createAsRaw,"","",V.rebuildRebind,V.defines,V.transformFeedbackVaryings,"",(()=>{C(F,(()=>{var I;null===(I=V.onRenderingStateCompiled)||void 0===I||I.call(V,F)}))})),F}catch(s){throw F.d.Error("Error compiling effect"),s}}},11143:(V,I,m)=>{m.d(I,{c:()=>j});var C=m(11067),l=m(11085),s=m(11150),F=m(11154),k=m(11129);class j{static get ShadersRepository(){return s.e.ShadersRepository}static set ShadersRepository(V){s.e.ShadersRepository=V}get K(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new C.e),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(V,I,m){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4?arguments[4]:void 0,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,E=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,X=arguments.length>9?arguments[9]:void 0,O=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",v=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,N=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new C.e,this.onErrorObservable=new C.e,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=V,this._key=O;const t=this._key.replace(/\r/g,"").replace(/\n/g,"|");let D;if(I.attributes){const V=I;if(this._engine=m,this._attributesNames=V.attributes,this._uniformsNames=V.uniformsNames.concat(V.samplers),this._samplerList=V.samplers.slice(),this.defines=V.defines,this.onError=V.onError,this.onCompiled=V.onCompiled,this._fallbacks=V.fallbacks,this._indexParameters=V.indexParameters,this._transformFeedbackVaryings=V.transformFeedbackVaryings||null,this._multiTarget=!!V.multiTarget,this._shaderLanguage=V.shaderLanguage??0,this._disableParallelShaderCompilation=!!V.disableParallelShaderCompilation,V.uniformBuffersNames){this._uniformBuffersNamesList=V.uniformBuffersNames.slice();for(let I=0;I<V.uniformBuffersNames.length;I++)this._uniformBuffersNames[V.uniformBuffersNames[I]]=I}this._processFinalCode=V.processFinalCode??null,this._processCodeAfterIncludes=V.processCodeAfterIncludes??void 0,N=V.extraInitializationsAsync,D=V.existingPipelineContext}else this._engine=s,this.defines=null==k?"":k,this._uniformsNames=m.concat(l),this._samplerList=l?l.slice():[],this._attributesNames=I,this._uniformBuffersNamesList=[],this._shaderLanguage=v,this.onError=Y,this.onCompiled=K,this._indexParameters=X,this._fallbacks=E;"WEBGL2"===this._engine.shaderPlatformName&&(D=(0,F.h)(t,this._engine._gl)??D),this._attributeLocationByName={},this.uniqueId=j._UniqueIdSeed++,D?(this._pipelineContext=D,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,N),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.K||this.dispose(!0)}))}async _processShaderCodeAsync(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=arguments.length>3?arguments[3]:void 0;C&&await C(),this._processingContext=m||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const l={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:V??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:s.e.GetShadersRepository(this._shaderLanguage),includesShadersStore:s.e.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,F.d)(l,this.name,this._processFinalCode,((V,m)=>{this._vertexSourceCode=V,this._fragmentSourceCode=m,this._prepareEffect(I)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.K||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(V){return this._attributes[V]}getAttributeLocationByName(V){return this._attributeLocationByName[V]}getAttributesCount(){return this._attributes.length}getUniformIndex(V){return this._uniformsNames.indexOf(V)}getUniform(V){return this._uniforms[V]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((V=>{this.executeWhenCompiled(V)}))}executeWhenCompiled(V){this.isReady()?V(this):(this.onCompileObservable.add((I=>{V(I)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(V){(0,k.i)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(I=>{this._processCompilationErrors(I,V)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var V;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(V=this._pipelineContext)||void 0===V?void 0:V._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var V;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(V=this._pipelineContext)||void 0===V?void 0:V._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(V,I,m,C){this._isReady=!1,this._vertexSourceCodeOverride=V,this._fragmentSourceCodeOverride=I,this.onError=(V,I)=>{C&&C(I)},this.onCompiled=()=>{var V,I;const C=this.getEngine().scenes;if(C)for(let m=0;m<C.length;m++)C[m].markAllMaterialsAsDirty(127);null===(V=(I=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===V||V.call(I,m)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(V){if(this._pipelineContext=V,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let I=0;I<this._attributesNames.length;I++){const V=this._attributesNames[I];this._attributeLocationByName[V]=this._attributes[I]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),j.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const I=this._pipelineContext;this._isReady=!1;try{const m=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),C=m?null:this.defines,l=m?this._vertexSourceCodeOverride:this._vertexSourceCode,s=m?this._fragmentSourceCodeOverride:this._fragmentSourceCode,k=this._engine;this._pipelineContext=(0,F.e)({existingPipelineContext:V?I:null,vertex:l,fragment:s,context:"WEBGL2"===k.shaderPlatformName||"WEBGL1"===k.shaderPlatformName?k._gl:void 0,rebuildRebind:(V,I,m,C)=>this._rebuildProgram(V,I,m,C),defines:C,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:m,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:m=>{I&&!V&&this._engine._deletePipelineContext(I),m&&this._onRenderingStateCompiled(m)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(I)}catch(m){this._processCompilationErrors(m,I)}}_getShaderCodeAndErrorLine(V,I,m){const C=m?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let l=null;if(I&&V){const s=I.match(C);if(s&&2===s.length){const I=parseInt(s[1]),C=V.split("\n",-1);C.length>=I&&(l=`Offending line [${I}] in ${m?"fragment":"vertex"} code: ${C[I-1]}`)}}return[V,l]}_processCompilationErrors(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=V.message;const m=this._attributesNames,C=this._fallbacks;if(l.d.Error("Unable to compile effect:"),l.d.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),l.d.Error(`Attributes: ${m.join(" ")}`),l.d.Error("Defines:\n"+this.defines),j.LogShaderCodeOnCompilationError){var s,F;let V=null,I=null,m=null;var k;if(null!==(s=this._pipelineContext)&&void 0!==s&&s._getVertexShaderCode()&&([m,V]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),m&&(l.d.Error("Vertex code:"),l.d.Error(m))),null!==(F=this._pipelineContext)&&void 0!==F&&F._getFragmentShaderCode())[m,I]=this._getShaderCodeAndErrorLine(null===(k=this._pipelineContext)||void 0===k?void 0:k._getFragmentShaderCode(),this._compilationError,!0),m&&(l.d.Error("Fragment code:"),l.d.Error(m));V&&l.d.Error(V),I&&l.d.Error(I)}l.d.Error("Error: "+this._compilationError);const E=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};I&&(this._pipelineContext=I,this._isReady=!0,E()),C?(this._pipelineContext=null,C.hasMoreFallbacks?(this._allFallbacksProcessed=!1,l.d.Error("Trying next fallback."),this.defines=C.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,E(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,I||E())}get isSupported(){return""===this._compilationError}_bindTexture(V,I){this._engine._bindTexture(this._samplers[V],I,V)}setTexture(V,I){this._engine.setTexture(this._samplers[V],this._uniforms[V],I,V)}setTextureArray(V,I){const m=V+"Ex";if(-1===this._samplerList.indexOf(m+"0")){const C=this._samplerList.indexOf(V);for(let V=1;V<I.length;V++){const I=m+(V-1).toString();this._samplerList.splice(C+V,0,I)}let l=0;for(const V of this._samplerList)this._samplers[V]=l,l+=1}this._engine.setTextureArray(this._samplers[V],this._uniforms[V],I,V)}bindUniformBuffer(V,I){const m=this._uniformBuffersNames[I];void 0===m||j._BaseCache[m]===V&&this._engine._features.useUBOBindingCache||(j._BaseCache[m]=V,this._engine.bindUniformBufferBase(V,m,I))}bindUniformBlock(V,I){this._engine.bindUniformBlock(this._pipelineContext,V,I)}setInt(V,I){return this._pipelineContext.setInt(V,I),this}setInt2(V,I,m){return this._pipelineContext.setInt2(V,I,m),this}setInt3(V,I,m,C){return this._pipelineContext.setInt3(V,I,m,C),this}setInt4(V,I,m,C,l){return this._pipelineContext.setInt4(V,I,m,C,l),this}setIntArray(V,I){return this._pipelineContext.setIntArray(V,I),this}setIntArray2(V,I){return this._pipelineContext.setIntArray2(V,I),this}setIntArray3(V,I){return this._pipelineContext.setIntArray3(V,I),this}setIntArray4(V,I){return this._pipelineContext.setIntArray4(V,I),this}setUInt(V,I){return this._pipelineContext.setUInt(V,I),this}setUInt2(V,I,m){return this._pipelineContext.setUInt2(V,I,m),this}setUInt3(V,I,m,C){return this._pipelineContext.setUInt3(V,I,m,C),this}setUInt4(V,I,m,C,l){return this._pipelineContext.setUInt4(V,I,m,C,l),this}setUIntArray(V,I){return this._pipelineContext.setUIntArray(V,I),this}setUIntArray2(V,I){return this._pipelineContext.setUIntArray2(V,I),this}setUIntArray3(V,I){return this._pipelineContext.setUIntArray3(V,I),this}setUIntArray4(V,I){return this._pipelineContext.setUIntArray4(V,I),this}setFloatArray(V,I){return this._pipelineContext.setArray(V,I),this}setFloatArray2(V,I){return this._pipelineContext.setArray2(V,I),this}setFloatArray3(V,I){return this._pipelineContext.setArray3(V,I),this}setFloatArray4(V,I){return this._pipelineContext.setArray4(V,I),this}setArray(V,I){return this._pipelineContext.setArray(V,I),this}setArray2(V,I){return this._pipelineContext.setArray2(V,I),this}setArray3(V,I){return this._pipelineContext.setArray3(V,I),this}setArray4(V,I){return this._pipelineContext.setArray4(V,I),this}setMatrices(V,I){return this._pipelineContext.setMatrices(V,I),this}setMatrix(V,I){return this._pipelineContext.setMatrix(V,I),this}setMatrix3x3(V,I){return this._pipelineContext.setMatrix3x3(V,I),this}setMatrix2x2(V,I){return this._pipelineContext.setMatrix2x2(V,I),this}setFloat(V,I){return this._pipelineContext.setFloat(V,I),this}setBool(V,I){return this._pipelineContext.setInt(V,I?1:0),this}setVector2(V,I){return this._pipelineContext.setVector2(V,I),this}setFloat2(V,I,m){return this._pipelineContext.setFloat2(V,I,m),this}setVector3(V,I){return this._pipelineContext.setVector3(V,I),this}setFloat3(V,I,m,C){return this._pipelineContext.setFloat3(V,I,m,C),this}setVector4(V,I){return this._pipelineContext.setVector4(V,I),this}setQuaternion(V,I){return this._pipelineContext.setQuaternion(V,I),this}setFloat4(V,I,m,C,l){return this._pipelineContext.setFloat4(V,I,m,C,l),this}setColor3(V,I){return this._pipelineContext.setColor3(V,I),this}setColor4(V,I,m){return this._pipelineContext.setColor4(V,I,m),this}setDirectColor4(V,I){return this._pipelineContext.setDirectColor4(V,I),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(j.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,F.k)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;I&&(s.e.GetShadersStore(C)[`${V}PixelShader`]=I),m&&(s.e.GetShadersStore(C)[`${V}VertexShader`]=m)}static ResetCache(){j._BaseCache={}}}j.LogShaderCodeOnCompilationError=!0,j.PersistentMode=!1,j.AutomaticallyClearCodeCache=!1,j._UniqueIdSeed=0,j._BaseCache={},j.ShadersStore=s.e.ShadersStore,j.IncludesShadersStore=s.e.IncludesShadersStore},11681:(V,I,m)=>{m.d(I,{b:()=>C});class C{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(V,I){this._defines[V]||(V<this._currentRank&&(this._currentRank=V),V>this._maxRank&&(this._maxRank=V),this._defines[V]=new Array),this._defines[V].push(I)}addCPUSkinningFallback(V,I){this._mesh=I,V<this._currentRank&&(this._currentRank=V),V>this._maxRank&&(this._maxRank=V)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(V,I){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,V=V.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),I._bonesComputationForcedToCPU=!0;const m=this._mesh.cV();for(let V=0;V<m.meshes.length;V++){const C=m.meshes[V];if(C.material){if(C.computeBonesUsingShaders&&0!==C.numBoneInfluencers)if(C.material.getEffect()===I)C.computeBonesUsingShaders=!1;else if(C.kk)for(const V of C.kk){if(V.effect===I){C.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&C.computeBonesUsingShaders&&C.numBoneInfluencers>0&&(C.computeBonesUsingShaders=!1)}}else{const I=this._defines[this._currentRank];if(I)for(let m=0;m<I.length;m++)V=V.replace("#define "+I[m],"");this._currentRank++}return V}}},11533:(V,I,m)=>{m.d(I,{d:()=>E,f:()=>K});var C=m(11233),l=m(11393),s=m(11067),F=m(11143),k=m(11274);m(11538);const j={yV:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class E{constructor(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:j;this._fullscreenViewport=new l.e(0,0,1,1);const m=I.yV??j.yV,s=I.indices??j.indices;this.rF=V,this._vertexBuffers={[C.e.PositionKind]:new C.e(V,m,C.e.PositionKind,!1,!1,2)},this._indexBuffer=V.createIndexBuffer(s),this._indexBufferLength=s.length,this._onContextRestoredObserver=V.onContextRestoredObservable.add((()=>{this._indexBuffer=V.createIndexBuffer(s);for(const V in this._vertexBuffers){this._vertexBuffers[V]._rebuild()}}))}setViewport(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._fullscreenViewport;this.rF.setViewport(V)}bindBuffers(V){this.rF.bindBuffers(this._vertexBuffers,this._indexBuffer,V)}applyEffectWrapper(V){this.rF.setState(!0),this.rF.depthCullingState.depthTest=!1,this.rF.stencilState.stencilTest=!1,this.rF.enableEffect(V.drawWrapper),this.bindBuffers(V.effect),V.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.rF.depthCullingState.depthTest,this._savedStateStencilTest=this.rF.stencilState.stencilTest}restoreStates(){this.rF.depthCullingState.depthTest=this._savedStateDepthTest,this.rF.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.rF.drawElementsType(0,0,this._indexBufferLength)}_isRenderTargetTexture(V){return void 0!==V.renderTarget}render(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!V.effect.isReady())return;this.saveStates(),this.setViewport();const m=null===I?null:this._isRenderTargetTexture(I)?I.renderTarget:I;m&&this.rF.bindFramebuffer(m),this.applyEffectWrapper(V),this.draw(),m&&this.rF.unBindFramebuffer(m),this.restoreStates()}dispose(){const V=this._vertexBuffers[C.e.PositionKind];V&&(V.dispose(),delete this._vertexBuffers[C.e.PositionKind]),this._indexBuffer&&this.rF._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.rF.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class K{static RegisterShaderCodeProcessing(V,I){I?K._CustomShaderCodeProcessing[V??""]=I:delete K._CustomShaderCodeProcessing[V??""]}static _GetShaderCodeProcessing(V){return K._CustomShaderCodeProcessing[V]??K._CustomShaderCodeProcessing[""]}get name(){return this.options.name}set name(V){this.options.name=V}isReady(){var V;return(null===(V=this._drawWrapper.effect)||void 0===V?void 0:V.isReady())??!1}get drawWrapper(){return this._drawWrapper}get effect(){return this._drawWrapper.effect}set effect(V){this._drawWrapper.effect=V}constructor(V){this.alphaMode=0,this.onEffectCreatedObservable=new s.e(void 0,!0),this.onApplyObservable=new s.e,this._shadersLoaded=!1,this._webGPUReady=!1,this._importPromises=[],this.options={...V,name:V.name||"effectWrapper",rF:V.rF,uniforms:V.uniforms||V.uniformNames||[],uniformNames:void 0,samplers:V.samplers||V.samplerNames||[],samplerNames:void 0,attributeNames:V.attributeNames||["position"],uniformBuffers:V.uniformBuffers||[],defines:V.defines||"",useShaderStore:V.useShaderStore||!1,vertexUrl:V.vertexUrl||V.vertexShader||"postprocess",vertexShader:void 0,fragmentShader:V.fragmentShader||"pass",indexParameters:V.indexParameters,blockCompilation:V.blockCompilation||!1,shaderLanguage:V.shaderLanguage||0,onCompiled:V.onCompiled||void 0,extraInitializations:V.extraInitializations||void 0,extraInitializationsAsync:V.extraInitializationsAsync||void 0,useAsPostProcess:V.useAsPostProcess??!1},this.options.uniformNames=this.options.uniforms,this.options.samplerNames=this.options.samplers,this.options.vertexShader=this.options.vertexUrl,this.options.useAsPostProcess&&(-1===this.options.samplers.indexOf("textureSampler")&&this.options.samplers.push("textureSampler"),-1===this.options.uniforms.indexOf("scale")&&this.options.uniforms.push("scale")),V.vertexUrl||V.vertexShader?this._shaderPath={vertexSource:this.options.vertexShader}:(this.options.useAsPostProcess||(this.options.uniforms.push("scale"),this.onApplyObservable.add((()=>{this.effect.setFloat2("scale",1,1)}))),this._shaderPath={vertex:this.options.vertexShader}),this._shaderPath.fragmentSource=this.options.fragmentShader,this._shaderPath.spectorName=this.options.name,this.options.useShaderStore&&(this._shaderPath.fragment=this._shaderPath.fragmentSource,this._shaderPath.vertex||(this._shaderPath.vertex=this._shaderPath.vertexSource),delete this._shaderPath.fragmentSource,delete this._shaderPath.vertexSource),this.onApplyObservable.add((()=>{this.bind()})),this.options.useShaderStore||(this._onContextRestoredObserver=this.options.rF.onContextRestoredObservable.add((()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()}))),this._drawWrapper=new k.b(this.options.rF),this._webGPUReady=1===this.options.shaderLanguage;const I=Array.isArray(this.options.defines)?this.options.defines.join("\n"):this.options.defines;this._postConstructor(this.options.blockCompilation,I,this.options.extraInitializations)}_gatherImports(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1?arguments[1]:void 0;this.options.useAsPostProcess&&(V&&this._webGPUReady?I.push(Promise.all([m.e(42).then(m.bind(m,13740))])):I.push(Promise.all([Promise.resolve().then(m.bind(m,11538))])))}_postConstructor(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2?arguments[2]:void 0,C=arguments.length>3?arguments[3]:void 0;this._importPromises.length=0,C&&this._importPromises.push(...C);const l=this.options.rF.isWebGPU&&!K.ForceGLSL;this._gatherImports(l,this._importPromises),void 0!==m&&m(l,this._importPromises),l&&this._webGPUReady&&(this.options.shaderLanguage=1),V||this.updateEffect(I)}updateEffect(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,k=arguments.length>6?arguments[6]:void 0,j=arguments.length>7?arguments[7]:void 0;const E=K._GetShaderCodeProcessing(this.name);if(null!==E&&void 0!==E&&E.defineCustomBindings){var Y,X;const C=(null===(Y=I)||void 0===Y?void 0:Y.slice())??[];C.push(...this.options.uniforms);const l=(null===(X=m)||void 0===X?void 0:X.slice())??[];l.push(...this.options.samplers),V=E.defineCustomBindings(this.name,V,C,l),I=C,m=l}this.options.defines=V||"";const O=this._shadersLoaded||0===this._importPromises.length?void 0:async()=>{await Promise.all(this._importPromises),this._shadersLoaded=!0};let v;v=this.options.extraInitializationsAsync?async()=>{null===O||void 0===O||O(),await this.options.extraInitializationsAsync()}:O,this.options.useShaderStore?this._drawWrapper.effect=this.options.rF.createEffect({vertex:k??this._shaderPath.vertex,fragment:j??this._shaderPath.fragment},{attributes:this.options.attributeNames,uniformsNames:I||this.options.uniforms,uniformBuffersNames:this.options.uniformBuffers,samplers:m||this.options.samplers,defines:null!==V?V:"",fallbacks:null,onCompiled:l??this.options.onCompiled,onError:s??null,indexParameters:C||this.options.indexParameters,processCodeAfterIncludes:null!==E&&void 0!==E&&E.processCodeAfterIncludes?(V,I)=>E.processCodeAfterIncludes(this.name,V,I):null,processFinalCode:null!==E&&void 0!==E&&E.processFinalCode?(V,I)=>E.processFinalCode(this.name,V,I):null,shaderLanguage:this.options.shaderLanguage,extraInitializationsAsync:v},this.options.rF):this._drawWrapper.effect=new F.c(this._shaderPath,this.options.attributeNames,I||this.options.uniforms,m||this.options.samplerNames,this.options.rF,V,void 0,l||this.options.onCompiled,void 0,void 0,void 0,this.options.shaderLanguage,v),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)}bind(){var V,I;let m=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.options.useAsPostProcess&&!m&&(this.options.rF.setAlphaMode(this.alphaMode),this.drawWrapper.effect.setFloat2("scale",1,1)),null===(V=K._GetShaderCodeProcessing(this.name))||void 0===V||null===(I=V.bindCustomBindings)||void 0===I||I.call(V,this.name,this._drawWrapper.effect)}dispose(){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.onEffectCreatedObservable.clear(),this._drawWrapper.dispose(!0)}}K.ForceGLSL=!1,K._CustomShaderCodeProcessing={}},11614:(V,I,m)=>{m.d(I,{c:()=>s,g:()=>l});var C=m(11612);function l(V,I){I.EXPOSURE&&V.push("exposureLinear"),I.CONTRAST&&V.push("contrast"),I.COLORGRADING&&V.push("colorTransformSettings"),(I.VIGNETTE||I.DITHER)&&V.push("vInverseScreenSize"),I.VIGNETTE&&(V.push("vignetteSettings1"),V.push("vignetteSettings2")),I.COLORCURVES&&(0,C.c)(V),I.DITHER&&V.push("ditherIntensity")}function s(V,I){I.COLORGRADING&&V.push("txColorTransform")}},11605:(V,I,m)=>{m.d(I,{e:()=>O});var C=m(11206),l=m(11214),s=m(11067),F=m(11312),k=m(11297),j=m(11612);class E{constructor(){this._dirty=!0,this._tempColor=new F.d(0,0,0,0),this._globalCurve=new F.d(0,0,0,0),this._highlightsCurve=new F.d(0,0,0,0),this._midtonesCurve=new F.d(0,0,0,0),this._shadowsCurve=new F.d(0,0,0,0),this._positiveCurve=new F.d(0,0,0,0),this._negativeCurve=new F.d(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get globalHue(){return this._globalHue}set globalHue(V){this._globalHue=V,this._dirty=!0}get globalDensity(){return this._globalDensity}set globalDensity(V){this._globalDensity=V,this._dirty=!0}get globalSaturation(){return this._globalSaturation}set globalSaturation(V){this._globalSaturation=V,this._dirty=!0}get globalExposure(){return this._globalExposure}set globalExposure(V){this._globalExposure=V,this._dirty=!0}get highlightsHue(){return this._highlightsHue}set highlightsHue(V){this._highlightsHue=V,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}set highlightsDensity(V){this._highlightsDensity=V,this._dirty=!0}get highlightsSaturation(){return this._highlightsSaturation}set highlightsSaturation(V){this._highlightsSaturation=V,this._dirty=!0}get highlightsExposure(){return this._highlightsExposure}set highlightsExposure(V){this._highlightsExposure=V,this._dirty=!0}get midtonesHue(){return this._midtonesHue}set midtonesHue(V){this._midtonesHue=V,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesDensity(V){this._midtonesDensity=V,this._dirty=!0}get midtonesSaturation(){return this._midtonesSaturation}set midtonesSaturation(V){this._midtonesSaturation=V,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set midtonesExposure(V){this._midtonesExposure=V,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set shadowsHue(V){this._shadowsHue=V,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set shadowsDensity(V){this._shadowsDensity=V,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}set shadowsSaturation(V){this._shadowsSaturation=V,this._dirty=!0}get shadowsExposure(){return this._shadowsExposure}set shadowsExposure(V){this._shadowsExposure=V,this._dirty=!0}getClassName(){return"ColorCurves"}static Bind(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vCameraColorCurvePositive",C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vCameraColorCurveNeutral",l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"vCameraColorCurveNegative";V._dirty&&(V._dirty=!1,V._getColorGradingDataToRef(V._globalHue,V._globalDensity,V._globalSaturation,V._globalExposure,V._globalCurve),V._getColorGradingDataToRef(V._highlightsHue,V._highlightsDensity,V._highlightsSaturation,V._highlightsExposure,V._tempColor),V._tempColor.multiplyToRef(V._globalCurve,V._highlightsCurve),V._getColorGradingDataToRef(V._midtonesHue,V._midtonesDensity,V._midtonesSaturation,V._midtonesExposure,V._tempColor),V._tempColor.multiplyToRef(V._globalCurve,V._midtonesCurve),V._getColorGradingDataToRef(V._shadowsHue,V._shadowsDensity,V._shadowsSaturation,V._shadowsExposure,V._tempColor),V._tempColor.multiplyToRef(V._globalCurve,V._shadowsCurve),V._highlightsCurve.subtractToRef(V._midtonesCurve,V._positiveCurve),V._midtonesCurve.subtractToRef(V._shadowsCurve,V._negativeCurve)),I&&(I.setFloat4(m,V._positiveCurve.r,V._positiveCurve.g,V._positiveCurve.b,V._positiveCurve.a),I.setFloat4(C,V._midtonesCurve.r,V._midtonesCurve.g,V._midtonesCurve.b,V._midtonesCurve.a),I.setFloat4(l,V._negativeCurve.r,V._negativeCurve.g,V._negativeCurve.b,V._negativeCurve.a))}_getColorGradingDataToRef(V,I,m,C,l){null!=V&&(V=E._Clamp(V,0,360),I=E._Clamp(I,-100,100),m=E._Clamp(m,-100,100),C=E._Clamp(C,-100,100),I=E._ApplyColorGradingSliderNonlinear(I),I*=.5,C=E._ApplyColorGradingSliderNonlinear(C),I<0&&(I*=-1,V=(V+180)%360),E._FromHSBToRef(V,I,50+.25*C,l),l.scaleToRef(2,l),l.a=1+.01*m)}static _ApplyColorGradingSliderNonlinear(V){V/=100;let I=Math.abs(V);return I=Math.pow(I,2),V<0&&(I*=-1),I*=100,I}static _FromHSBToRef(V,I,m,C){let l=E._Clamp(V,0,360);const s=E._Clamp(I/100,0,1),F=E._Clamp(m/100,0,1);if(0===s)C.r=F,C.g=F,C.b=F;else{l/=60;const V=Math.floor(l),I=l-V,m=F*(1-s),k=F*(1-s*I),j=F*(1-s*(1-I));switch(V){case 0:C.r=F,C.g=j,C.b=m;break;case 1:C.r=k,C.g=F,C.b=m;break;case 2:C.r=m,C.g=F,C.b=j;break;case 3:C.r=m,C.g=k,C.b=F;break;case 4:C.r=j,C.g=m,C.b=F;break;default:C.r=F,C.g=m,C.b=k}}C.a=1}static _Clamp(V,I,m){return Math.min(Math.max(V,I),m)}clone(){return k.d.Clone((()=>new E),this)}serialize(){return k.d.Serialize(this)}static Parse(V){return k.d.Parse((()=>new E),V,null,null)}}E.PrepareUniforms=j.c,(0,C.d)([(0,l.B)()],E.prototype,"_globalHue",void 0),(0,C.d)([(0,l.B)()],E.prototype,"_globalDensity",void 0),(0,C.d)([(0,l.B)()],E.prototype,"_globalSaturation",void 0),(0,C.d)([(0,l.B)()],E.prototype,"_globalExposure",void 0),(0,C.d)([(0,l.B)()],E.prototype,"_highlightsHue",void 0),(0,C.d)([(0,l.B)()],E.prototype,"_highlightsDensity",void 0),(0,C.d)([(0,l.B)()],E.prototype,"_highlightsSaturation",void 0),(0,C.d)([(0,l.B)()],E.prototype,"_highlightsExposure",void 0),(0,C.d)([(0,l.B)()],E.prototype,"_midtonesHue",void 0),(0,C.d)([(0,l.B)()],E.prototype,"_midtonesDensity",void 0),(0,C.d)([(0,l.B)()],E.prototype,"_midtonesSaturation",void 0),(0,C.d)([(0,l.B)()],E.prototype,"_midtonesExposure",void 0),k.d._ColorCurvesParser=E.Parse;var K=m(11193),Y=m(11614),X=m(11048);class O{constructor(){this.colorCurves=new E,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=O.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new F.d(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=O.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.outputTextureWidth=0,this.outputTextureHeight=0,this.onUpdateParameters=new s.e}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(V){this._colorCurvesEnabled!==V&&(this._colorCurvesEnabled=V,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(V){this._colorGradingTexture!==V&&(this._colorGradingTexture=V,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(V){this._colorGradingEnabled!==V&&(this._colorGradingEnabled=V,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(V){this._colorGradingWithGreenDepth!==V&&(this._colorGradingWithGreenDepth=V,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(V){this._colorGradingBGR!==V&&(this._colorGradingBGR=V,this._updateParameters())}get exposure(){return this._exposure}set exposure(V){this._exposure!==V&&(this._exposure=V,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(V){this._toneMappingEnabled!==V&&(this._toneMappingEnabled=V,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(V){this._toneMappingType!==V&&(this._toneMappingType=V,this._updateParameters())}get contrast(){return this._contrast}set contrast(V){this._contrast!==V&&(this._contrast=V,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(V){this.vignetteCenterY=V}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(V){this.vignetteCenterX=V}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(V){this._vignetteBlendMode!==V&&(this._vignetteBlendMode=V,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(V){this._vignetteEnabled!==V&&(this._vignetteEnabled=V,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(V){this._ditheringEnabled!==V&&(this._ditheringEnabled=V,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(V){this._ditheringIntensity!==V&&(this._ditheringIntensity=V,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(V){this._skipFinalColorClamp!==V&&(this._skipFinalColorClamp=V,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(V){this._applyByPostProcess!==V&&(this._applyByPostProcess=V,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(V){this._isEnabled!==V&&(this._isEnabled=V,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}prepareDefines(V){if((arguments.length>1&&void 0!==arguments[1]&&arguments[1])!==this.applyByPostProcess||!this._isEnabled)return V.VIGNETTE=!1,V.TONEMAPPING=0,V.CONTRAST=!1,V.EXPOSURE=!1,V.COLORCURVES=!1,V.COLORGRADING=!1,V.COLORGRADING3D=!1,V.DITHER=!1,V.IMAGEPROCESSING=!1,V.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(V.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(V.VIGNETTE=this.vignetteEnabled,V.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===O._VIGNETTEMODE_MULTIPLY,V.VIGNETTEBLENDMODEOPAQUE=!V.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case O.TONEMAPPING_KHR_PBR_NEUTRAL:V.TONEMAPPING=3;break;case O.TONEMAPPING_ACES:V.TONEMAPPING=2;break;default:V.TONEMAPPING=1}else V.TONEMAPPING=0;V.CONTRAST=1!==this.contrast,V.EXPOSURE=1!==this.exposure,V.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,V.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,V.COLORGRADING?V.COLORGRADING3D=this.colorGradingTexture.is3D:V.COLORGRADING3D=!1,V.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,V.SAMPLER3DBGRMAP=this.colorGradingBGR,V.DITHER=this._ditheringEnabled,V.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,V.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,V.IMAGEPROCESSING=V.VIGNETTE||!!V.TONEMAPPING||V.CONTRAST||V.EXPOSURE||V.COLORCURVES||V.COLORGRADING||V.DITHER}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(V,I){if(this._colorCurvesEnabled&&this.colorCurves&&E.Bind(this.colorCurves,V),this._vignetteEnabled||this._ditheringEnabled){const m=1/(this.outputTextureWidth||V.getEngine().getRenderWidth()),C=1/(this.outputTextureHeight||V.getEngine().getRenderHeight());if(V.setFloat2("vInverseScreenSize",m,C),this._ditheringEnabled&&V.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const l=null!=I?I:C/m;let s=Math.tan(.5*this.vignetteCameraFov),F=s*l;const k=Math.sqrt(F*s);F=(0,K.p)(F,k,this.vignetteStretch),s=(0,K.p)(s,k,this.vignetteStretch),V.setFloat4("vignetteSettings1",F,s,-F*this.vignetteCenterX,-s*this.vignetteCenterY);const j=-2*this.vignetteWeight;V.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,j)}}if(V.setFloat("exposureLinear",this.exposure),V.setFloat("contrast",this.contrast),this.colorGradingTexture){V.setTexture("txColorTransform",this.colorGradingTexture);const I=this.colorGradingTexture.getSize().height;V.setFloat4("colorTransformSettings",(I-1)/I,.5/I,I,this.colorGradingTexture.level)}}clone(){return k.d.Clone((()=>new O),this)}serialize(){return k.d.Serialize(this)}static Parse(V){const I=k.d.Parse((()=>new O),V,null,null);return void 0!==V.vignetteCentreX&&(I.vignetteCenterX=V.vignetteCentreX),void 0!==V.vignetteCentreY&&(I.vignetteCenterY=V.vignetteCentreY),I}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}O.TONEMAPPING_STANDARD=0,O.TONEMAPPING_ACES=1,O.TONEMAPPING_KHR_PBR_NEUTRAL=2,O.PrepareUniforms=Y.g,O.PrepareSamplers=Y.c,O._VIGNETTEMODE_MULTIPLY=0,O._VIGNETTEMODE_OPAQUE=1,(0,C.d)([(0,l.d)()],O.prototype,"colorCurves",void 0),(0,C.d)([(0,l.B)()],O.prototype,"_colorCurvesEnabled",void 0),(0,C.d)([(0,l.s)("colorGradingTexture")],O.prototype,"_colorGradingTexture",void 0),(0,C.d)([(0,l.B)()],O.prototype,"_colorGradingEnabled",void 0),(0,C.d)([(0,l.B)()],O.prototype,"_colorGradingWithGreenDepth",void 0),(0,C.d)([(0,l.B)()],O.prototype,"_colorGradingBGR",void 0),(0,C.d)([(0,l.B)()],O.prototype,"_exposure",void 0),(0,C.d)([(0,l.B)()],O.prototype,"_toneMappingEnabled",void 0),(0,C.d)([(0,l.B)()],O.prototype,"_toneMappingType",void 0),(0,C.d)([(0,l.B)()],O.prototype,"_contrast",void 0),(0,C.d)([(0,l.B)()],O.prototype,"vignetteStretch",void 0),(0,C.d)([(0,l.B)()],O.prototype,"vignetteCenterX",void 0),(0,C.d)([(0,l.B)()],O.prototype,"vignetteCenterY",void 0),(0,C.d)([(0,l.B)()],O.prototype,"vignetteWeight",void 0),(0,C.d)([(0,l.f)()],O.prototype,"vignetteColor",void 0),(0,C.d)([(0,l.B)()],O.prototype,"vignetteCameraFov",void 0),(0,C.d)([(0,l.B)()],O.prototype,"_vignetteBlendMode",void 0),(0,C.d)([(0,l.B)()],O.prototype,"_vignetteEnabled",void 0),(0,C.d)([(0,l.B)()],O.prototype,"_ditheringEnabled",void 0),(0,C.d)([(0,l.B)()],O.prototype,"_ditheringIntensity",void 0),(0,C.d)([(0,l.B)()],O.prototype,"_skipFinalColorClamp",void 0),(0,C.d)([(0,l.B)()],O.prototype,"_applyByPostProcess",void 0),(0,C.d)([(0,l.B)()],O.prototype,"_isEnabled",void 0),(0,C.d)([(0,l.B)()],O.prototype,"outputTextureWidth",void 0),(0,C.d)([(0,l.B)()],O.prototype,"outputTextureHeight",void 0),k.d._ImageProcessingConfigurationParser=O.Parse,(0,X.h)("BABYLON.ImageProcessingConfiguration",O)},11685:(V,I,m)=>{m.d(I,{c:()=>Y});var C=m(11206),l=m(11202),s=m(11214),F=m(11667),k=m(11642),j=m(11649),E=m(11316);class K extends k.c{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class Y extends j.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(V,"DetailMap",140,new K,I),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=l.d.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=V._dirtyCallbacks[1]}isReadyForSubMesh(V,I,m){return!this._isEnabled||!(V._areTexturesDirty&&I.texturesEnabled&&m.getCaps().standardDerivatives&&this._texture&&F.d.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(V,I){if(this._isEnabled){V.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const m=I.getEngine();V._areTexturesDirty&&(m.getCaps().standardDerivatives&&this._texture&&F.d.DetailTextureEnabled&&this._isEnabled?((0,E.R)(this._texture,V,"DETAIL"),V.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):V.DETAIL=!1)}else V.DETAIL=!1}bindForSubMesh(V,I){if(!this._isEnabled)return;const m=this._material.isFrozen;V.useUbo&&m&&V.isSync||this._texture&&F.d.DetailTextureEnabled&&(V.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),(0,E.u)(this._texture,V,"detail")),I.texturesEnabled&&this._texture&&F.d.DetailTextureEnabled&&V.setTexture("detailSampler",this._texture)}hasTexture(V){return this._texture===V}getActiveTextures(V){this._texture&&V.push(this._texture)}getAnimatables(V){this._texture&&this._texture.animations&&this._texture.animations.length>0&&V.push(this._texture)}dispose(V){var I;V&&(null===(I=this._texture)||void 0===I||I.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(V){V.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,C.d)([(0,s.s)("detailTexture"),(0,s.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"texture",void 0),(0,C.d)([(0,s.B)()],Y.prototype,"diffuseBlendLevel",void 0),(0,C.d)([(0,s.B)()],Y.prototype,"roughnessBlendLevel",void 0),(0,C.d)([(0,s.B)()],Y.prototype,"bumpLevel",void 0),(0,C.d)([(0,s.B)(),(0,s.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"normalBlendMethod",void 0),(0,C.d)([(0,s.B)(),(0,s.b)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"isEnabled",void 0)},11202:(V,I,m)=>{m.d(I,{d:()=>t});var C=m(11206),l=m(11214),s=m(11076),F=m(11067),k=m(11061),j=m(11224),E=m(11283),K=m(11085),Y=m(11289),X=m(11274),O=m(11297);class v{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(V){this._func=V}get funcRef(){return this._funcRef}set funcRef(V){this._funcRef=V}get funcMask(){return this._funcMask}set funcMask(V){this._funcMask=V}get opStencilFail(){return this._opStencilFail}set opStencilFail(V){this._opStencilFail=V}get opDepthFail(){return this._opDepthFail}set opDepthFail(V){this._opDepthFail=V}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(V){this._opStencilDepthPass=V}get mask(){return this._mask}set mask(V){this._mask=V}get enabled(){return this._enabled}set enabled(V){this._enabled=V}getClassName(){return"MaterialStencilState"}copyTo(V){O.d.Clone((()=>V),this)}serialize(){return O.d.Serialize(this)}parse(V,I,m){O.d.Parse((()=>this),V,I,m)}}(0,C.d)([(0,l.B)()],v.prototype,"func",null),(0,C.d)([(0,l.B)()],v.prototype,"funcRef",null),(0,C.d)([(0,l.B)()],v.prototype,"funcMask",null),(0,C.d)([(0,l.B)()],v.prototype,"opStencilFail",null),(0,C.d)([(0,l.B)()],v.prototype,"opDepthFail",null),(0,C.d)([(0,l.B)()],v.prototype,"opStencilDepthPass",null),(0,C.d)([(0,l.B)()],v.prototype,"mask",null),(0,C.d)([(0,l.B)()],v.prototype,"enabled",null);var N=m(11316);class t{get _supportGlowLayer(){return!1}set _glowModeEnabled(V){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(V){if(this._alpha===V)return;const I=this._alpha;this._alpha=V,1!==I&&1!==V||this.bE(t.MiscDirtyFlag+t.PrePassDirtyFlag)}get alpha(){return this._alpha}set JF(V){this._backFaceCulling!==V&&(this._backFaceCulling=V,this.bE(t.TextureDirtyFlag))}get JF(){return this._backFaceCulling}set cullBackFaces(V){this._cullBackFaces!==V&&(this._cullBackFaces=V,this.bE(t.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(V){this._blockDirtyMechanism!==V&&(this._blockDirtyMechanism=V,V||this.tY())}atomicMaterialsUpdate(V){this.blockDirtyMechanism=!0;try{V(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(V){this._onDisposeObserver&&this.Ck.remove(this._onDisposeObserver),this._onDisposeObserver=this.Ck.add(V)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new F.e),this._onBindObservable}set onBind(V){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(V)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new F.e),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new F.e),this._onEffectCreatedObservable}set alphaMode(V){this._alphaMode!==V&&(this._alphaMode=V,this.bE(t.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(V){this._needDepthPrePass!==V&&(this._needDepthPrePass=V,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(V){this._fogEnabled!==V&&(this._fogEnabled=V,this.bE(t.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case t.WireFrameFillMode:case t.LineListDrawMode:case t.LineLoopDrawMode:case t.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(V){this.fillMode=V?t.WireFrameFillMode:t.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case t.PointFillMode:case t.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(V){this.fillMode=V?t.PointFillMode:t.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(V){this._fillMode!==V&&(this._fillMode=V,this.bE(t.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(V){const I=this.cV().getEngine().getCaps().fragmentDepthSupported;V&&!I&&K.d.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=V&&I,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(V){this._drawWrapper=V}constructor(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.Ck=new F.e,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new v,this._useUBO=!1,this._fillMode=t.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=V;const l=I||k.c.LastCreatedScene;l&&(this._scene=l,this._dirtyCallbacks={},this._forceGLSL=C,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=V||s.d.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new X.b(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new E.e(this._scene.getEngine(),void 0,void 0,V),this._useUBO=this.cV().getEngine().supportsUniformBuffers,this._createUniformBuffer(),m||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),t.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var V;const I=this.cV().getEngine();null===(V=this._uniformBuffer)||void 0===V||V.dispose(),I.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new E.e(I,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new E.e(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(V){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.tY(),this.checkReadyOnlyOnce=!0}unfreeze(){this.tY(),this.checkReadyOnlyOnce=!1}isReady(V,I){return!0}isReadyForSubMesh(V,I,m){const C=I.materialDefines;return!!C&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=C,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}cV(){return this._scene}_getEffectiveOrientation(V){return null!==this.sideOrientation?this.sideOrientation:V.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(V){this._transparencyMode!==V&&(this._transparencyMode=V,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===t.MATERIAL_ALPHABLEND||this._transparencyMode===t.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===t.MATERIAL_ALPHATEST||this._transparencyMode===t.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===t.MATERIAL_OPAQUE||this._transparencyMode===t.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(V){return this._hasTransparencyMode?this._transparencyModeIsBlend:V.visibility<1||!this._disableAlphaBlending&&(V.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(V){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(V)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}tY(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const I=this.cV().meshes;for(const m of I)if(m.kk)for(const I of m.kk)if(I.dV()===this)for(const m of I._drawWrappers)m&&this._materialContext===m.materialContext&&(m._wasPreviouslyReady=!1,m._wasPreviouslyUsingInstances=null,m._forceRebindOnNextCall=V);V&&this.bE(t.AllDirtyFlag)}_preBind(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const m=this._scene.getEngine(),C=(null==I?this.sideOrientation:I)===t.ClockWiseSideOrientation;return m.enableEffect(V||this._getDrawWrapper()),m.setState(this.JF,this.zOffset,!1,C,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),C}bind(V,I){}buildUniformLayout(){const V=this._uniformBuffer;this._eventInfo.ubo=V,this._callbackPluginEventGeneric(8,this._eventInfo),V.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(V,I,m){const C=m._drawWrapper;this._eventInfo.subMesh=m,this._callbackPluginEventBindForSubMesh(this._eventInfo),C._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(V){}bindView(V){this._useUBO?this._needToBindSceneUbo=!0:V.setMatrix("view",this.cV().getViewMatrix())}bindViewProjection(V){this._useUBO?this._needToBindSceneUbo=!0:(V.setMatrix("viewProjection",this.cV().getTransformMatrix()),V.setMatrix("projection",this.cV().getProjectionMatrix()))}bindEyePosition(V,I){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(V,I)}_afterBind(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&I&&(this._needToBindSceneUbo=!1,(0,N.s)(I,this.cV().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=V?V.visibility:1,this._onBindObservable&&V&&this._onBindObservable.notifyObservers(V),this.disableDepthWrite){const V=this._scene.getEngine();this._cachedDepthWriteState=V.getDepthWrite(),V.setDepthWrite(!1)}if(this.disableColorWrite){const V=this._scene.getEngine();this._cachedColorWriteState=V.getColorWrite(),V.setColorWrite(!1)}if(0!==this.depthFunction){const V=this._scene.getEngine();this._cachedDepthFunctionState=V.getDepthFunction()||0,V.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(V){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=V,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(V){return null}_clonePlugins(V,I){const m={};if(this._serializePlugins(m),t._ParsePlugins(m,V,this._scene,I),this.pluginManager)for(const C of this.pluginManager._plugins){const I=V.pluginManager.getPlugin(C.name);I&&C.copyTo(I)}}getBindedMeshes(){if(this.meshMap){const V=[];for(const I in this.meshMap){const m=this.meshMap[I];m&&V.push(m)}return V}return this._scene.meshes.filter((V=>V.material===this))}forceCompilation(V,I,m,C){const l={clipPlane:!1,useInstances:!1,...m},s=this.cV(),F=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const k=()=>{if(!this._scene||!this._scene.getEngine())return;const m=s.clipPlane;if(l.clipPlane&&(s.clipPlane=new Y.e(0,0,0,1)),this._storeEffectOnSubMeshes){let m=!0,s=null;if(V.kk){const I=new j.e(0,0,0,0,0,V,void 0,!1,!1);I.materialDefines&&(I.materialDefines._renderId=-1),this.isReadyForSubMesh(V,I,l.useInstances)||(I.effect&&I.effect.getCompilationError()&&I.effect.allFallbacksProcessed()?s=I.effect.getCompilationError():(m=!1,setTimeout(k,16)))}m&&(this.allowShaderHotSwapping=F,s&&C&&C(s),I&&I(this))}else this.isReady()?(this.allowShaderHotSwapping=F,I&&I(this)):setTimeout(k,16);l.clipPlane&&(s.clipPlane=m)};k()}async forceCompilationAsync(V,I){return await new Promise(((m,C)=>{this.forceCompilation(V,(()=>{m()}),I,(V=>{C(V)}))}))}bE(V){this.cV().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(t._DirtyCallbackArray.length=0,V&t.ImageProcessingDirtyFlag&&t._DirtyCallbackArray.push(t._ImageProcessingDirtyCallBack),V&t.TextureDirtyFlag&&t._DirtyCallbackArray.push(t._TextureDirtyCallBack),V&t.LightDirtyFlag&&t._DirtyCallbackArray.push(t._LightsDirtyCallBack),V&t.FresnelDirtyFlag&&t._DirtyCallbackArray.push(t._FresnelDirtyCallBack),V&t.AttributesDirtyFlag&&t._DirtyCallbackArray.push(t._AttributeDirtyCallBack),V&t.MiscDirtyFlag&&t._DirtyCallbackArray.push(t._MiscDirtyCallBack),V&t.PrePassDirtyFlag&&t._DirtyCallbackArray.push(t._PrePassDirtyCallBack),t._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(t._RunDirtyCallBacks),this.cV().resetCachedMaterial())}resetDrawCache(){const V=this.cV().meshes;for(const I of V)if(I.kk)for(const V of I.kk)V.dV()===this&&V.resetDrawCache()}_markAllSubMeshesAsDirty(V){const I=this.cV();if(I.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const m=I.meshes;for(const C of m)if(C.kk)for(const m of C.kk){if((m.dV()||(I._hasDefaultMaterial?I.defaultMaterial:null))===this)for(const I of m._drawWrappers)I&&I.defines&&I.defines.markAllAsDirty&&this._materialContext===I.materialContext&&V(I.defines)}}_markScenePrePassDirty(){if(this.cV().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const V=this.cV().enablePrePassRenderer();V&&V.bE()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(t._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(t._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(t._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(t._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(t._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(t._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(t._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(t._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(t._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(t._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const V=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.Ck.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(V)}))}}setPrePassRenderer(V){return!1}dispose(V,I,m){const C=this.cV();if(C.stopAnimation(this),C.freeProcessedMaterials(),C.removeMaterial(this),this._eventInfo.forceDisposeTextures=I,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const V=this._parentContainer.materials.indexOf(this);V>-1&&this._parentContainer.materials.splice(V,1),this._parentContainer=null}if(!0!==m)if(this.meshMap)for(const l in this.meshMap){const V=this.meshMap[l];this._disposeMeshResources(V)}else{const V=C.meshes;for(const I of V)this._disposeMeshResources(I)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.Ck.notifyObservers(this),this.Ck.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(V){if(!V)return;const I=V.wF,m=V._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(V.kk&&m)for(const l of V.kk){const V=l._drawWrappers;for(let s=0;s<V.length;s++){var C;const F=null===(C=V[s])||void 0===C?void 0:C.effect;if(!F)continue;m[s]===this&&(null===I||void 0===I||I._releaseVertexArrayObject(F),l._removeDrawWrapper(s,!0,!0))}}}else null===I||void 0===I||I._releaseVertexArrayObject(this._drawWrapper.effect);V.material!==this||V.sourceMesh||(V.material=null)}serialize(){const V=O.d.Serialize(this);return V.stencil=this.stencil.serialize(),V.uniqueId=this.uniqueId,this._serializePlugins(V),V}_serializePlugins(V){if(V.plugins={},this.pluginManager)for(const I of this.pluginManager._plugins)I.doNotSerialize||(V.plugins[I.getClassName()]=I.serialize())}static Parse(V,I,m){if(V.customType){if("BABYLON.PBRMaterial"===V.customType&&V.overloadedAlbedo&&(V.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return K.d.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else V.customType="BABYLON.StandardMaterial";const C=s.d.Instantiate(V.customType).Parse(V,I,m);return C._loadedUniqueId=V.uniqueId,C}static _ParsePlugins(V,I,m,C){if(V.plugins)for(const k in V.plugins){var l,F;const j=V.plugins[k];let E=null===(l=I.pluginManager)||void 0===l?void 0:l.getPlugin(j.name);if(!E){const V=s.d.Instantiate("BABYLON."+k);V&&(E=new V(I))}null===(F=E)||void 0===F||F.parse(j,m,C)}}}t.TriangleFillMode=0,t.WireFrameFillMode=1,t.PointFillMode=2,t.PointListDrawMode=3,t.LineListDrawMode=4,t.LineLoopDrawMode=5,t.LineStripDrawMode=6,t.TriangleStripDrawMode=7,t.TriangleFanDrawMode=8,t.ClockWiseSideOrientation=0,t.CounterClockWiseSideOrientation=1,t.ImageProcessingDirtyFlag=64,t.TextureDirtyFlag=1,t.LightDirtyFlag=2,t.FresnelDirtyFlag=4,t.AttributesDirtyFlag=8,t.MiscDirtyFlag=16,t.PrePassDirtyFlag=32,t.AllDirtyFlag=127,t.MATERIAL_OPAQUE=0,t.MATERIAL_ALPHATEST=1,t.MATERIAL_ALPHABLEND=2,t.MATERIAL_ALPHATESTANDBLEND=3,t.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,t.MATERIAL_NORMALBLENDMETHOD_RNM=1,t.OnEventObservable=new F.e,t._AllDirtyCallBack=V=>V.markAllAsDirty(),t._ImageProcessingDirtyCallBack=V=>V.markAsImageProcessingDirty(),t._TextureDirtyCallBack=V=>V.markAsTexturesDirty(),t._FresnelDirtyCallBack=V=>V.markAsFresnelDirty(),t._MiscDirtyCallBack=V=>V.markAsMiscDirty(),t._PrePassDirtyCallBack=V=>V.markAsPrePassDirty(),t._LightsDirtyCallBack=V=>V.markAsLightDirty(),t._AttributeDirtyCallBack=V=>V.markAsAttributesDirty(),t._FresnelAndMiscDirtyCallBack=V=>{t._FresnelDirtyCallBack(V),t._MiscDirtyCallBack(V)},t._TextureAndMiscDirtyCallBack=V=>{t._TextureDirtyCallBack(V),t._MiscDirtyCallBack(V)},t._DirtyCallbackArray=[],t._RunDirtyCallBacks=V=>{for(const I of t._DirtyCallbackArray)I(V)},(0,C.d)([(0,l.B)()],t.prototype,"id",void 0),(0,C.d)([(0,l.B)()],t.prototype,"uniqueId",void 0),(0,C.d)([(0,l.B)()],t.prototype,"name",void 0),(0,C.d)([(0,l.B)()],t.prototype,"metadata",void 0),(0,C.d)([(0,l.B)()],t.prototype,"checkReadyOnEveryCall",void 0),(0,C.d)([(0,l.B)()],t.prototype,"checkReadyOnlyOnce",void 0),(0,C.d)([(0,l.B)()],t.prototype,"state",void 0),(0,C.d)([(0,l.B)("alpha")],t.prototype,"_alpha",void 0),(0,C.d)([(0,l.B)("JF")],t.prototype,"_backFaceCulling",void 0),(0,C.d)([(0,l.B)("cullBackFaces")],t.prototype,"_cullBackFaces",void 0),(0,C.d)([(0,l.B)()],t.prototype,"sideOrientation",void 0),(0,C.d)([(0,l.B)("alphaMode")],t.prototype,"_alphaMode",void 0),(0,C.d)([(0,l.B)()],t.prototype,"_needDepthPrePass",void 0),(0,C.d)([(0,l.B)()],t.prototype,"disableDepthWrite",void 0),(0,C.d)([(0,l.B)()],t.prototype,"disableColorWrite",void 0),(0,C.d)([(0,l.B)()],t.prototype,"forceDepthWrite",void 0),(0,C.d)([(0,l.B)()],t.prototype,"depthFunction",void 0),(0,C.d)([(0,l.B)()],t.prototype,"separateCullingPass",void 0),(0,C.d)([(0,l.B)("fogEnabled")],t.prototype,"_fogEnabled",void 0),(0,C.d)([(0,l.B)()],t.prototype,"pointSize",void 0),(0,C.d)([(0,l.B)()],t.prototype,"zOffset",void 0),(0,C.d)([(0,l.B)()],t.prototype,"zOffsetUnits",void 0),(0,C.d)([(0,l.B)()],t.prototype,"pointsCloud",null),(0,C.d)([(0,l.B)()],t.prototype,"fillMode",null),(0,C.d)([(0,l.B)()],t.prototype,"useLogarithmicDepth",null),(0,C.d)([(0,l.B)()],t.prototype,"transparencyMode",null)},11642:(V,I,m)=>{m.d(I,{c:()=>C});class C{constructor(V){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=V,V)for(const I in V)Object.prototype.hasOwnProperty.call(V,I)&&this._setDefaultValue(I)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||V,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const V of Object.keys(this))"_"!==V[0]&&this._keys.push(V);if(this._externalProperties)for(const V in this._externalProperties)-1===this._keys.indexOf(V)&&this._keys.push(V)}isEqual(V){if(this._keys.length!==V._keys.length)return!1;for(let I=0;I<this._keys.length;I++){const m=this._keys[I];if(this[m]!==V[m])return!1}return!0}cloneTo(V){this._keys.length!==V._keys.length&&(V._keys=this._keys.slice(0));for(let I=0;I<this._keys.length;I++){const m=this._keys[I];V[m]=this[m]}}reset(){for(const V of this._keys)this._setDefaultValue(V)}_setDefaultValue(V){var I,m,C,l;const s=(null===(I=this._externalProperties)||void 0===I||null===(m=I[V])||void 0===m?void 0:m.type)??typeof this[V],F=null===(C=this._externalProperties)||void 0===C||null===(l=C[V])||void 0===l?void 0:l.default;switch(s){case"number":this[V]=F??0;break;case"string":this[V]=F??"";break;default:this[V]=F??!1}}toString(){let V="";for(let I=0;I<this._keys.length;I++){const m=this._keys[I],C=this[m];switch(typeof C){case"number":case"string":V+="#define "+m+" "+C+"\n";break;default:C&&(V+="#define "+m+"\n")}}return V}}},11667:(V,I,m)=>{m.d(I,{d:()=>l});var C=m(11136);class l{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(V){this._DiffuseTextureEnabled!==V&&(this._DiffuseTextureEnabled=V,C.b.MarkAllMaterialsAsDirty(1))}static get BaseWeightTextureEnabled(){return this._BaseWeightTextureEnabled}static set BaseWeightTextureEnabled(V){this._BaseWeightTextureEnabled!==V&&(this._BaseWeightTextureEnabled=V,C.b.MarkAllMaterialsAsDirty(1))}static get BaseDiffuseRoughnessTextureEnabled(){return this._BaseDiffuseRoughnessTextureEnabled}static set BaseDiffuseRoughnessTextureEnabled(V){this._BaseDiffuseRoughnessTextureEnabled!==V&&(this._BaseDiffuseRoughnessTextureEnabled=V,C.b.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(V){this._DetailTextureEnabled!==V&&(this._DetailTextureEnabled=V,C.b.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(V){this._DecalMapEnabled!==V&&(this._DecalMapEnabled=V,C.b.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(V){this._AmbientTextureEnabled!==V&&(this._AmbientTextureEnabled=V,C.b.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(V){this._OpacityTextureEnabled!==V&&(this._OpacityTextureEnabled=V,C.b.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(V){this._ReflectionTextureEnabled!==V&&(this._ReflectionTextureEnabled=V,C.b.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(V){this._EmissiveTextureEnabled!==V&&(this._EmissiveTextureEnabled=V,C.b.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(V){this._SpecularTextureEnabled!==V&&(this._SpecularTextureEnabled=V,C.b.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(V){this._BumpTextureEnabled!==V&&(this._BumpTextureEnabled=V,C.b.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(V){this._LightmapTextureEnabled!==V&&(this._LightmapTextureEnabled=V,C.b.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(V){this._RefractionTextureEnabled!==V&&(this._RefractionTextureEnabled=V,C.b.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(V){this._ColorGradingTextureEnabled!==V&&(this._ColorGradingTextureEnabled=V,C.b.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(V){this._FresnelEnabled!==V&&(this._FresnelEnabled=V,C.b.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(V){this._ClearCoatTextureEnabled!==V&&(this._ClearCoatTextureEnabled=V,C.b.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(V){this._ClearCoatBumpTextureEnabled!==V&&(this._ClearCoatBumpTextureEnabled=V,C.b.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(V){this._ClearCoatTintTextureEnabled!==V&&(this._ClearCoatTintTextureEnabled=V,C.b.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(V){this._SheenTextureEnabled!==V&&(this._SheenTextureEnabled=V,C.b.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(V){this._AnisotropicTextureEnabled!==V&&(this._AnisotropicTextureEnabled=V,C.b.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(V){this._ThicknessTextureEnabled!==V&&(this._ThicknessTextureEnabled=V,C.b.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(V){this._RefractionIntensityTextureEnabled!==V&&(this._RefractionIntensityTextureEnabled=V,C.b.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(V){this._TranslucencyIntensityTextureEnabled!==V&&(this._TranslucencyIntensityTextureEnabled=V,C.b.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(V){this._TranslucencyColorTextureEnabled!==V&&(this._TranslucencyColorTextureEnabled=V,C.b.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(V){this._IridescenceTextureEnabled!==V&&(this._IridescenceTextureEnabled=V,C.b.MarkAllMaterialsAsDirty(1))}}l._DiffuseTextureEnabled=!0,l._BaseWeightTextureEnabled=!0,l._BaseDiffuseRoughnessTextureEnabled=!0,l._DetailTextureEnabled=!0,l._DecalMapEnabled=!0,l._AmbientTextureEnabled=!0,l._OpacityTextureEnabled=!0,l._ReflectionTextureEnabled=!0,l._EmissiveTextureEnabled=!0,l._SpecularTextureEnabled=!0,l._BumpTextureEnabled=!0,l._LightmapTextureEnabled=!0,l._RefractionTextureEnabled=!0,l._ColorGradingTextureEnabled=!0,l._FresnelEnabled=!0,l._ClearCoatTextureEnabled=!0,l._ClearCoatBumpTextureEnabled=!0,l._ClearCoatTintTextureEnabled=!0,l._SheenTextureEnabled=!0,l._AnisotropicTextureEnabled=!0,l._ThicknessTextureEnabled=!0,l._RefractionIntensityTextureEnabled=!0,l._TranslucencyIntensityTextureEnabled=!0,l._TranslucencyColorTextureEnabled=!0,l._IridescenceTextureEnabled=!0},11316:(V,I,m)=>{m.d(I,{$:()=>v,C:()=>c,F:()=>H,G:()=>O,I:()=>X,K:()=>Q,M:()=>W,P:()=>Z,R:()=>D,S:()=>z,T:()=>G,V:()=>r,Z:()=>g,_:()=>d,b:()=>n,f:()=>Y,j:()=>S,n:()=>K,r:()=>N,s:()=>t,u:()=>b,w:()=>y,y:()=>T});var C=m(11085),l=m(11312),s=m(11061),F=m(11320),k=m(11327);const j=l.c.Black(),E={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function K(V,I,m){if(!V||V.LOGARITHMICDEPTH||V.indexOf&&V.indexOf("LOGARITHMICDEPTH")>=0){const V=m.activeCamera;1===V.mode&&C.d.Error("Logarithmic depth is not compatible with orthographic cameras!",20),I.setFloat("logarithmicDepthConstant",2/(Math.log(V.maxZ+1)/Math.LN2))}}function Y(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3];m&&V.fogEnabled&&(!I||I.applyFog)&&0!==V.fogMode&&(m.setFloat4("vFogInfos",V.fogMode,V.fogStart,V.fogEnd,V.fogDensity),C?(V.fogColor.toLinearSpaceToRef(j,V.getEngine().useExactSrgbConversions),m.setColor3("vFogColor",j)):m.setColor3("vFogColor",V.fogColor))}function X(V,I,m,C,l,s,F,k,j,K){const Y=V.numMaxInfluencers||V.numInfluencers;return Y<=0?0:(I.push("#define MORPHTARGETS"),V.hasPositions&&I.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),V.hasNormals&&I.push("#define MORPHTARGETTEXTURE_HASNORMALS"),V.hasTangents&&I.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),V.hasUVs&&I.push("#define MORPHTARGETTEXTURE_HASUVS"),V.hasUV2s&&I.push("#define MORPHTARGETTEXTURE_HASUV2S"),V.hasColors&&I.push("#define MORPHTARGETTEXTURE_HASCOLORS"),V.supportsPositions&&l&&I.push("#define MORPHTARGETS_POSITION"),V.supportsNormals&&s&&I.push("#define MORPHTARGETS_NORMAL"),V.supportsTangents&&F&&I.push("#define MORPHTARGETS_TANGENT"),V.supportsUVs&&k&&I.push("#define MORPHTARGETS_UV"),V.supportsUV2s&&j&&I.push("#define MORPHTARGETS_UV2"),V.supportsColors&&K&&I.push("#define MORPHTARGETS_COLOR"),I.push("#define NUM_MORPH_INFLUENCERS "+Y),V.isUsingTextureForTargets&&I.push("#define MORPHTARGETS_TEXTURE"),E.NUM_MORPH_INFLUENCERS=Y,E.NORMAL=s,E.TANGENT=F,E.UV=k,E.UV2=j,E.COLOR=K,O(m,C,E,l),Y)}function O(V,I,m){let l=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const F=m.NUM_MORPH_INFLUENCERS;if(F>0&&s.c.LastCreatedEngine){const k=s.c.LastCreatedEngine.getCaps().maxVertexAttribs,j=I.morphTargetManager;if(null!==j&&void 0!==j&&j.isUsingTextureForTargets)return;const E=j&&j.supportsPositions&&l,K=j&&j.supportsNormals&&m.NORMAL,Y=j&&j.supportsTangents&&m.TANGENT,X=j&&j.supportsUVs&&m.UV1,O=j&&j.supportsUV2s&&m.UV2,v=j&&j.supportsColors&&m.VERTEXCOLOR;for(let m=0;m<F;m++)E&&V.push("position"+m),K&&V.push("normal"+m),Y&&V.push("tangent"+m),X&&V.push("uv_"+m),O&&V.push("uv2_"+m),v&&V.push("color"+m),V.length>k&&C.d.Error("Cannot add more vertex attributes for mesh "+I.name)}}function v(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];V.push("world0"),V.push("world1"),V.push("world2"),V.push("world3"),I&&(V.push("previousWorld0"),V.push("previousWorld1"),V.push("previousWorld2"),V.push("previousWorld3"))}function N(V,I){const m=V.morphTargetManager;V&&m&&I.setFloatArray("morphTargetInfluences",m.influences)}function t(V,I){I.bindToEffect(V,"Scene")}function D(V,I,m){I._needUVs=!0,I[m]=!0,V.optimizeUVAllocation&&V.getTextureMatrix().isIdentityAs3x2()?(I[m+"DIRECTUV"]=V.coordinatesIndex+1,I["MAINUV"+(V.coordinatesIndex+1)]=!0):I[m+"DIRECTUV"]=0}function b(V,I,m){const C=V.getTextureMatrix();I.lk(m+"Matrix",C)}function T(V,I,m){m.BAKED_VERTEX_ANIMATION_TEXTURE&&m.INSTANCES&&V.push("bakedVertexAnimationSettingsInstanced")}function n(V,I,m){var C;if(I&&V&&(V.computeBonesUsingShaders&&I._bonesComputationForcedToCPU&&(V.computeBonesUsingShaders=!1),V.useBones&&V.computeBonesUsingShaders&&V.skeleton)){const l=V.skeleton;if(l.isUsingTextureForMatrices&&I.getUniformIndex("boneTextureWidth")>-1){const m=l.getTransformMatrixTexture(V);I.setTexture("boneSampler",m),I.setFloat("boneTextureWidth",4*(l.bones.length+1))}else{const s=l.getTransformMatrices(V);s&&(I.setMatrices("mBones",s),m&&V.cV().prePassRenderer&&V.cV().prePassRenderer.getIndex(2)&&(m.previousBones[V.uniqueId]||(m.previousBones[V.uniqueId]=s.slice()),I.setMatrices("mPreviousBones",m.previousBones[V.uniqueId]),C=s,m.previousBones[V.uniqueId].set(C)))}}}function x(V,I,m,C,l){let s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];V._bindLight(I,m,C,l,s)}function S(V,I,m,C){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const s=Math.min(I.lightSources.length,l);for(let F=0;F<s;F++){x(I.lightSources[F],F,V,m,"boolean"===typeof C?C:C.SPECULARTERM,I.receiveShadows)}}function c(V,I,m,C){m.NUM_BONE_INFLUENCERS>0&&(C.addCPUSkinningFallback(0,I),V.push("matricesIndices"),V.push("matricesWeights"),m.NUM_BONE_INFLUENCERS>4&&(V.push("matricesIndicesExtra"),V.push("matricesWeightsExtra")))}function H(V,I){(I.INSTANCES||I.THIN_INSTANCES)&&v(V,!!I.PREPASS_VELOCITY),I.INSTANCESCOLOR&&V.push("instanceColor")}function y(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,l=0;for(let s=0;s<m&&V["LIGHT"+s];s++)s>0&&(l=C+s,I.addFallback(l,"LIGHT"+s)),V.SHADOWS||(V["SHADOW"+s]&&I.addFallback(C,"SHADOW"+s),V["SHADOWPCF"+s]&&I.addFallback(C,"SHADOWPCF"+s),V["SHADOWPCSS"+s]&&I.addFallback(C,"SHADOWPCSS"+s),V["SHADOWPOISSON"+s]&&I.addFallback(C,"SHADOWPOISSON"+s),V["SHADOWESM"+s]&&I.addFallback(C,"SHADOWESM"+s),V["SHADOWCLOSEESM"+s]&&I.addFallback(C,"SHADOWCLOSEESM"+s));return l++}function z(V,I,m,C,l,s,F){let k=arguments.length>7&&void 0!==arguments[7]&&arguments[7];F._areMiscDirty&&(F.LOGARITHMICDEPTH=m,F.POINTSIZE=C,F.FOG=l&&function(V,I){return I.fogEnabled&&V.applyFog&&0!==I.fogMode}(V,I),F.NONUNIFORMSCALING=V.nonUniformScaling,F.ALPHATEST=s,F.DECAL_AFTER_DETAIL=k)}function Z(V,I,m,C){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!m._areLightsDirty)return m._needNormals;let F=0;const k={needNormals:m._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(V.lightsEnabled&&!s)for(const E of I.lightSources)if(B(V,I,E,F,m,C,k),F++,F===l)break;m.SPECULARTERM=k.specularEnabled,m.SHADOWS=k.shadowEnabled;for(let E=F;E<l;E++)void 0!==m["LIGHT"+E]&&(m["LIGHT"+E]=!1,m["HEMILIGHT"+E]=!1,m["POINTLIGHT"+E]=!1,m["DIRLIGHT"+E]=!1,m["SPOTLIGHT"+E]=!1,m["AREALIGHT"+E]=!1,m["SHADOW"+E]=!1,m["SHADOWCSM"+E]=!1,m["SHADOWCSMDEBUG"+E]=!1,m["SHADOWCSMNUM_CASCADES"+E]=!1,m["SHADOWCSMUSESHADOWMAXZ"+E]=!1,m["SHADOWCSMNOBLEND"+E]=!1,m["SHADOWCSM_RIGHTHANDED"+E]=!1,m["SHADOWPCF"+E]=!1,m["SHADOWPCSS"+E]=!1,m["SHADOWPOISSON"+E]=!1,m["SHADOWESM"+E]=!1,m["SHADOWCLOSEESM"+E]=!1,m["SHADOWCUBE"+E]=!1,m["SHADOWLOWQUALITY"+E]=!1,m["SHADOWMEDIUMQUALITY"+E]=!1);const j=V.getEngine().getCaps();return void 0===m.SHADOWFLOAT&&(k.needRebuild=!0),m.SHADOWFLOAT=k.shadowEnabled&&(j.textureFloatRender&&j.textureFloatLinearFiltering||j.textureHalfFloatRender&&j.textureHalfFloatLinearFiltering),m.LIGHTMAPEXCLUDED=k.lightmapMode,k.needRebuild&&m.rebuild(),k.needNormals}function B(V,I,m,C,l,s,k){switch(k.needNormals=!0,void 0===l["LIGHT"+C]&&(k.needRebuild=!0),l["LIGHT"+C]=!0,l["SPOTLIGHT"+C]=!1,l["HEMILIGHT"+C]=!1,l["POINTLIGHT"+C]=!1,l["DIRLIGHT"+C]=!1,l["AREALIGHT"+C]=!1,m.prepareLightSpecificDefines(l,C),l["LIGHT_FALLOFF_PHYSICAL"+C]=!1,l["LIGHT_FALLOFF_GLTF"+C]=!1,l["LIGHT_FALLOFF_STANDARD"+C]=!1,m.falloffType){case F.b.FALLOFF_GLTF:l["LIGHT_FALLOFF_GLTF"+C]=!0;break;case F.b.FALLOFF_PHYSICAL:l["LIGHT_FALLOFF_PHYSICAL"+C]=!0;break;case F.b.FALLOFF_STANDARD:l["LIGHT_FALLOFF_STANDARD"+C]=!0}if(s&&!m.oE.equalsFloats(0,0,0)&&(k.specularEnabled=!0),l["SHADOW"+C]=!1,l["SHADOWCSM"+C]=!1,l["SHADOWCSMDEBUG"+C]=!1,l["SHADOWCSMNUM_CASCADES"+C]=!1,l["SHADOWCSMUSESHADOWMAXZ"+C]=!1,l["SHADOWCSMNOBLEND"+C]=!1,l["SHADOWCSM_RIGHTHANDED"+C]=!1,l["SHADOWPCF"+C]=!1,l["SHADOWPCSS"+C]=!1,l["SHADOWPOISSON"+C]=!1,l["SHADOWESM"+C]=!1,l["SHADOWCLOSEESM"+C]=!1,l["SHADOWCUBE"+C]=!1,l["SHADOWLOWQUALITY"+C]=!1,l["SHADOWMEDIUMQUALITY"+C]=!1,I&&I.receiveShadows&&V.shadowsEnabled&&m.shadowEnabled){const I=m.getShadowGenerator(V.activeCamera)??m.getShadowGenerator();if(I){const V=I.getShadowMap();V&&V.renderList&&V.renderList.length>0&&(k.shadowEnabled=!0,I.prepareDefines(l,C))}}m.lightmapMode!=F.b.LIGHTMAP_DEFAULT?(k.lightmapMode=!0,l["LIGHTMAPEXCLUDED"+C]=!0,l["LIGHTMAPNOSPECULAR"+C]=m.lightmapMode==F.b.LIGHTMAP_SHADOWSONLY):(l["LIGHTMAPEXCLUDED"+C]=!1,l["LIGHTMAPNOSPECULAR"+C]=!1)}function W(V,I,m,C,l){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]&&arguments[6],j=function(V,I){let m=!1;if(V.activeCamera){const C=I.CAMERA_ORTHOGRAPHIC?1:0,l=I.CAMERA_PERSPECTIVE?1:0,s=1===V.activeCamera.mode?1:0,F=0===V.activeCamera.mode?1:0;(C^s||l^F)&&(I.CAMERA_ORTHOGRAPHIC=1===s,I.CAMERA_PERSPECTIVE=1===F,m=!0)}return m}(V,C);!1!==s&&(j=(0,k.g)(m,V,C)),C.DEPTHPREPASS!==!I.getColorWrite()&&(C.DEPTHPREPASS=!C.DEPTHPREPASS,j=!0),C.INSTANCES!==l&&(C.INSTANCES=l,j=!0),C.THIN_INSTANCES!==F&&(C.THIN_INSTANCES=F,j=!0),j&&C.markAsUnprocessed()}function Q(V,I,m,C){let l=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],F=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!I._areAttributesDirty&&I._needNormals===I._normals&&I._needUVs===I._uvs)return!1;I._normals=I._needNormals,I._uvs=I._needUVs,I.NORMAL=I._needNormals&&V.isVerticesDataPresent("normal"),I._needNormals&&V.isVerticesDataPresent("tangent")&&(I.TANGENT=!0);for(let k=1;k<=6;++k)I["UV"+k]=!!I._needUVs&&V.isVerticesDataPresent(`uv${1===k?"":k}`);if(m){const m=V.useVertexColors&&V.isVerticesDataPresent("color");I.VERTEXCOLOR=m,I.VERTEXALPHA=V.hasVertexAlpha&&m&&s}return V.isVerticesDataPresent("instanceColor")&&(V.hasInstances||V.hasThinInstances)&&(I.INSTANCESCOLOR=!0),C&&function(V,I){if(V.useBones&&V.computeBonesUsingShaders&&V.skeleton){I.NUM_BONE_INFLUENCERS=V.numBoneInfluencers;const m=void 0!==I.BONETEXTURE;if(V.skeleton.isUsingTextureForMatrices&&m)I.BONETEXTURE=!0;else{I.BonesPerMesh=V.skeleton.bones.length+1,I.BONETEXTURE=!m&&void 0;const C=V.cV().prePassRenderer;if(C&&C.enabled){const m=-1===C.excludedSkinnedMesh.indexOf(V);I.BONES_VELOCITY_ENABLED=m}}}else I.NUM_BONE_INFLUENCERS=0,I.BonesPerMesh=0,void 0!==I.BONETEXTURE&&(I.BONETEXTURE=!1)}(V,I),l&&function(V,I){const m=V.morphTargetManager;m?(I.MORPHTARGETS_UV=m.supportsUVs&&I.UV1,I.MORPHTARGETS_UV2=m.supportsUV2s&&I.UV2,I.MORPHTARGETS_TANGENT=m.supportsTangents&&I.TANGENT,I.MORPHTARGETS_NORMAL=m.supportsNormals&&I.NORMAL,I.MORPHTARGETS_POSITION=m.supportsPositions,I.MORPHTARGETS_COLOR=m.supportsColors,I.MORPHTARGETTEXTURE_HASUVS=m.hasUVs,I.MORPHTARGETTEXTURE_HASUV2S=m.hasUV2s,I.MORPHTARGETTEXTURE_HASTANGENTS=m.hasTangents,I.MORPHTARGETTEXTURE_HASNORMALS=m.hasNormals,I.MORPHTARGETTEXTURE_HASPOSITIONS=m.hasPositions,I.MORPHTARGETTEXTURE_HASCOLORS=m.hasColors,I.NUM_MORPH_INFLUENCERS=m.numMaxInfluencers||m.numInfluencers,I.MORPHTARGETS=I.NUM_MORPH_INFLUENCERS>0,I.MORPHTARGETS_TEXTURE=m.isUsingTextureForTargets):(I.MORPHTARGETS_UV=!1,I.MORPHTARGETS_UV2=!1,I.MORPHTARGETS_TANGENT=!1,I.MORPHTARGETS_NORMAL=!1,I.MORPHTARGETS_POSITION=!1,I.MORPHTARGETS_COLOR=!1,I.MORPHTARGETTEXTURE_HASUVS=!1,I.MORPHTARGETTEXTURE_HASUV2S=!1,I.MORPHTARGETTEXTURE_HASTANGENTS=!1,I.MORPHTARGETTEXTURE_HASNORMALS=!1,I.MORPHTARGETTEXTURE_HASPOSITIONS=!1,I.MORPHTARGETTEXTURE_HAS_COLORS=!1,I.MORPHTARGETS=!1,I.NUM_MORPH_INFLUENCERS=0)}(V,I),F&&function(V,I){const m=V.bakedVertexAnimationManager;I.BAKED_VERTEX_ANIMATION_TEXTURE=!(!m||!m.isEnabled)}(V,I),!0}function G(V,I){if(V.activeCamera){const m=I.MULTIVIEW;I.MULTIVIEW=null!==V.activeCamera.outputRenderTarget&&V.activeCamera.outputRenderTarget.getViewCount()>1,I.MULTIVIEW!=m&&I.markAsUnprocessed()}}function r(V,I,m){const C=I.ORDER_INDEPENDENT_TRANSPARENCY,l=I.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;I.ORDER_INDEPENDENT_TRANSPARENCY=V.useOrderIndependentTransparency&&m,I.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!V.getEngine().getCaps().textureFloatLinearFiltering,C===I.ORDER_INDEPENDENT_TRANSPARENCY&&l===I.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||I.markAsUnprocessed()}function g(V,I,m){const C=I.PREPASS;if(!I._arePrePassDirty)return;const l=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(V.prePassRenderer&&V.prePassRenderer.enabled&&m){I.PREPASS=!0,I.SCENE_MRT_COUNT=V.prePassRenderer.mrtCount,I.PREPASS_NORMAL_WORLDSPACE=V.prePassRenderer.generateNormalsInWorldSpace,I.PREPASS_COLOR=!0,I.PREPASS_COLOR_INDEX=0;for(let m=0;m<l.length;m++){const C=V.prePassRenderer.getIndex(l[m].type);-1!==C?(I[l[m].define]=!0,I[l[m].index]=C):I[l[m].define]=!1}}else{I.PREPASS=!1;for(let V=0;V<l.length;V++)I[l[V].define]=!1}I.PREPASS!=C&&(I.markAsUnprocessed(),I.markAsImageProcessingDirty())}function h(V,I,m,C){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],F=arguments.length>6&&void 0!==arguments[6]&&arguments[6];l&&l.push("Light"+V),s||(I.push("vLightData"+V,"vLightDiffuse"+V,"vLightSpecular"+V,"vLightDirection"+V,"vLightWidth"+V,"vLightHeight"+V,"vLightFalloff"+V,"vLightGround"+V,"lightMatrix"+V,"shadowsInfo"+V,"depthValues"+V),m.push("shadowTexture"+V),m.push("depthTexture"+V),I.push("viewFrustumZ"+V,"cascadeBlendFactor"+V,"lightSizeUVCorrection"+V,"depthCorrection"+V,"penumbraDarkness"+V,"frustumLengths"+V),C&&(m.push("projectionLightTexture"+V),I.push("textureProjectionMatrix"+V)),F&&m.push("iesLightTexture"+V))}function d(V,I,m){let C,l,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(V.uniformsNames){const F=V;C=F.uniformsNames,l=F.uniformBuffersNames,I=F.samplers,m=F.defines,s=F.maxSimultaneousLights||0}else C=V,I||(I=[]);for(let F=0;F<s&&m["LIGHT"+F];F++)h(F,C,I,m["PROJECTEDLIGHTTEXTURE"+F],l,!1,m["IESLIGHTTEXTURE"+F]);m.NUM_MORPH_INFLUENCERS&&(C.push("morphTargetInfluences"),C.push("morphTargetCount")),m.BAKED_VERTEX_ANIMATION_TEXTURE&&(C.push("bakedVertexAnimationSettings"),C.push("bakedVertexAnimationTextureSizeInverted"),C.push("bakedVertexAnimationTime"),I.push("bakedVertexAnimationTexture"))}},11688:(V,I,m)=>{m.d(I,{b:()=>s});var C,l=m(11040);!function(V){V[V.Zero=0]="Zero",V[V.One=1]="One",V[V.MaxViewZ=2]="MaxViewZ"}(C||(C={}));class s{static CreateConfiguration(V){return s._Configurations[V]={defines:{},previousWorldMatrices:{},previousViewProjection:l.b.Zero(),currentViewProjection:l.b.Zero(),previousBones:{},lastUpdateFrameId:-1,excludedSkinnedMesh:[],reverseCulling:!1},s._Configurations[V]}static DeleteConfiguration(V){delete s._Configurations[V]}static GetConfiguration(V){return s._Configurations[V]}static AddUniformsAndSamplers(V,I){V.push("previousWorld","previousViewProjection","mPreviousBones")}static MarkAsDirty(V,I){for(const m of I)if(m.kk)for(const I of m.kk)I._removeDrawWrapper(V)}static PrepareDefines(V,I,m){if(!m._arePrePassDirty)return;const C=s._Configurations[V];if(!C)return;m.PREPASS=!0,m.PREPASS_COLOR=!1,m.PREPASS_COLOR_INDEX=-1;let l=0;for(let F=0;F<s.GeometryTextureDescriptions.length;F++){const V=s.GeometryTextureDescriptions[F],I=V.define,k=V.defineIndex,j=C.defines[k];void 0!==j?(m[I]=!0,m[k]=j,l++):(m[I]=!1,delete m[k])}m.SCENE_MRT_COUNT=l,m.BONES_VELOCITY_ENABLED=I.useBones&&I.computeBonesUsingShaders&&I.skeleton&&!I.skeleton.isUsingTextureForMatrices&&-1===C.excludedSkinnedMesh.indexOf(I)}static Bind(V,I,m,C,l){const F=s._Configurations[V];if(!F)return;const k=m.cV(),j=k.getEngine();if(F.reverseCulling&&j.setStateCullFaceType(k._mirroredCameraPosition?l.cullBackFaces:!l.cullBackFaces),(void 0!==F.defines.PREPASS_VELOCITY_INDEX||void 0!==F.defines.PREPASS_VELOCITY_LINEAR_INDEX)&&(F.previousWorldMatrices[m.uniqueId]||(F.previousWorldMatrices[m.uniqueId]=C.clone()),F.previousViewProjection||(F.previousViewProjection=k.getTransformMatrix().clone(),F.currentViewProjection=k.getTransformMatrix().clone()),F.currentViewProjection.updateFlag!==k.getTransformMatrix().updateFlag?(F.lastUpdateFrameId=j.frameId,F.previousViewProjection.C(F.currentViewProjection),F.currentViewProjection.C(k.getTransformMatrix())):F.lastUpdateFrameId!==j.frameId&&(F.lastUpdateFrameId=j.frameId,F.previousViewProjection.C(F.currentViewProjection)),I.setMatrix("previousWorld",F.previousWorldMatrices[m.uniqueId]),I.setMatrix("previousViewProjection",F.previousViewProjection),F.previousWorldMatrices[m.uniqueId]=C.clone(),m.useBones&&m.computeBonesUsingShaders&&m.skeleton)){const V=m.skeleton;if(!V.isUsingTextureForMatrices||-1===I.getUniformIndex("boneTextureWidth")){const C=V.getTransformMatrices(m);C&&(F.previousBones[m.uniqueId]||(F.previousBones[m.uniqueId]=C.slice()),I.setMatrices("mPreviousBones",F.previousBones[m.uniqueId]),F.previousBones[m.uniqueId].set(C))}}}}s.GeometryTextureDescriptions=[{type:0,name:"Irradiance",clearType:0,define:"PREPASS_IRRADIANCE",defineIndex:"PREPASS_IRRADIANCE_INDEX"},{type:1,name:"WorldPosition",clearType:0,define:"PREPASS_POSITION",defineIndex:"PREPASS_POSITION_INDEX"},{type:2,name:"Velocity",clearType:0,define:"PREPASS_VELOCITY",defineIndex:"PREPASS_VELOCITY_INDEX"},{type:3,name:"Reflectivity",clearType:0,define:"PREPASS_REFLECTIVITY",defineIndex:"PREPASS_REFLECTIVITY_INDEX"},{type:5,name:"ViewDepth",clearType:2,define:"PREPASS_DEPTH",defineIndex:"PREPASS_DEPTH_INDEX"},{type:6,name:"ViewNormal",clearType:0,define:"PREPASS_NORMAL",defineIndex:"PREPASS_NORMAL_INDEX"},{type:7,name:"AlbedoSqrt",clearType:0,define:"PREPASS_ALBEDO_SQRT",defineIndex:"PREPASS_ALBEDO_SQRT_INDEX"},{type:8,name:"WorldNormal",clearType:0,define:"PREPASS_WORLD_NORMAL",defineIndex:"PREPASS_WORLD_NORMAL_INDEX"},{type:9,name:"LocalPosition",clearType:0,define:"PREPASS_LOCAL_POSITION",defineIndex:"PREPASS_LOCAL_POSITION_INDEX"},{type:10,name:"ScreenDepth",clearType:1,define:"PREPASS_SCREENSPACE_DEPTH",defineIndex:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:11,name:"LinearVelocity",clearType:0,define:"PREPASS_VELOCITY_LINEAR",defineIndex:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:12,name:"Albedo",clearType:0,define:"PREPASS_ALBEDO",defineIndex:"PREPASS_ALBEDO_INDEX"},{type:13,name:"NormalizedViewDepth",clearType:1,define:"PREPASS_NORMALIZED_VIEW_DEPTH",defineIndex:"PREPASS_NORMALIZED_VIEW_DEPTH_INDEX"}],s._Configurations={}},11649:(V,I,m)=>{m.d(I,{b:()=>D});var C=m(11206),l=m(11214),s=m(11202),F=m(11061),k=m(11121),j=m(11150);const E=new RegExp("^([gimus]+)!");class K{constructor(V){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=V,this._scene=V.cV(),this._engine=this._scene.getEngine()}_addPlugin(V){for(let C=0;C<this._plugins.length;++C)if(this._plugins[C].name===V.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!V.isCompatible(this._material.shaderLanguage))throw`The plugin "${V.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const I=V.getClassName();K._MaterialPluginClassToMainDefine[I]||(K._MaterialPluginClassToMainDefine[I]="MATERIALPLUGIN_"+ ++K._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(V,I)=>this._handlePluginEvent(V,I),this._plugins.push(V),this._plugins.sort(((V,I)=>V.priority-I.priority)),this._codeInjectionPoints={};const m={};m[K._MaterialPluginClassToMainDefine[I]]={type:"boolean",default:!0};for(const C of this._plugins)C.collectDefines(m),this._collectPointNames("vertex",C.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",C.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=m,!0}_activatePlugin(V){-1===this._activePlugins.indexOf(V)&&(this._activePlugins.push(V),this._activePlugins.sort(((V,I)=>V.priority-I.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),V.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(V),this._activePluginsForExtraEvents.sort(((V,I)=>V.priority-I.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(V){for(let I=0;I<this._plugins.length;++I)if(this._plugins[I].name===V)return this._plugins[I];return null}_handlePluginEventIsReadyForSubMesh(V){let I=!0;for(const m of this._activePlugins)I=I&&m.isReadyForSubMesh(V.defines,this._scene,this._engine,V.subMesh);V.isReadyForSubMesh=I}_handlePluginEventPrepareDefinesBeforeAttributes(V){for(const I of this._activePlugins)I.prepareDefinesBeforeAttributes(V.defines,this._scene,V.mesh)}_handlePluginEventPrepareDefines(V){for(const I of this._activePlugins)I.prepareDefines(V.defines,this._scene,V.mesh)}_handlePluginEventHardBindForSubMesh(V){for(const I of this._activePluginsForExtraEvents)I.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,V.subMesh)}_handlePluginEventBindForSubMesh(V){for(const I of this._activePlugins)I.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,V.subMesh)}_handlePluginEventHasRenderTargetTextures(V){let I=!1;for(const m of this._activePluginsForExtraEvents)if(I=m.hasRenderTargetTextures(),I)break;V.hasRenderTargetTextures=I}_handlePluginEventFillRenderTargetTextures(V){for(const I of this._activePluginsForExtraEvents)I.fillRenderTargetTextures(V.renderTargets)}_handlePluginEvent(V,I){switch(V){case 512:{const V=I;for(const I of this._activePlugins)I.getActiveTextures(V.activeTextures);break}case 256:{const V=I;for(const I of this._activePlugins)I.getAnimatables(V.animatables);break}case 1024:{const V=I;let m=!1;for(const I of this._activePlugins)if(m=I.hasTexture(V.texture),m)break;V.hasTexture=m;break}case 2:{const V=I;for(const I of this._plugins)I.dispose(V.forceDisposeTextures);break}case 4:I.defineNames=this._defineNamesFromPlugins;break;case 128:{const V=I;for(const I of this._activePlugins)V.fallbackRank=I.addFallbacks(V.defines,V.fallbacks,V.fallbackRank),I.getAttributes(V.attributes,this._scene,V.mesh);this._uniformList.length>0&&V.uniforms.push(...this._uniformList),this._samplerList.length>0&&V.samplers.push(...this._samplerList),this._uboList.length>0&&V.uniformBuffersNames.push(...this._uboList),V.customCode=this._injectCustomCode(V,V.customCode);break}case 8:{const V=I;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const m=1===this._material.shaderLanguage;for(const I of this._plugins){const C=I.getUniforms(this._material.shaderLanguage);if(C){if(C.ubo)for(const I of C.ubo){if(I.size&&I.type){const C=I.arraySize??0;if(V.ubo.addUniform(I.name,I.size,C),m){let V;switch(I.type){case"mat4":V="mat4x4f";break;case"float":V="f32";break;default:V=`${I.type}f`}this._uboDeclaration+=C>0?`uniform ${I.name}: array<${V}, ${C}>;\n`:`uniform ${I.name}: ${V};\n`}else this._uboDeclaration+=`${I.type} ${I.name}${C>0?`[${C}]`:""};\n`}this._uniformList.push(I.name)}C.vertex&&(this._vertexDeclaration+=C.vertex+"\n"),C.fragment&&(this._fragmentDeclaration+=C.fragment+"\n")}I.getSamplers(this._samplerList),I.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(V,I){if(I)for(const m in I)this._codeInjectionPoints[V]||(this._codeInjectionPoints[V]={}),this._codeInjectionPoints[V][m]=!0}_injectCustomCode(V,I){return(m,C)=>{var l;I&&(C=I(m,C)),this._uboDeclaration&&(C=C.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(C=C.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(C=C.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const s=null===(l=this._codeInjectionPoints)||void 0===l?void 0:l[m];if(!s)return C;let F=null;for(let I in s){let l="";for(const C of this._activePlugins){var K;let s=null===(K=C.getCustomCode(m,this._material.shaderLanguage))||void 0===K?void 0:K[I];if(s){if(C.resolveIncludes){if(null===F){const I=0;F={defines:[],indexParameters:V.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:j.e.GetShadersRepository(I),includesShadersStore:j.e.GetIncludesShadersStore(I),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}F.isFragment="fragment"===m,(0,k.k)(s,F,(V=>s=V))}l+=s+"\n"}}if(l.length>0)if("!"===I.charAt(0)){I=I.substring(1);let V="g";if("!"===I.charAt(0))V="",I=I.substring(1);else{const m=E.exec(I);m&&m.length>=2&&(V=m[1],I=I.substring(V.length+1))}V.indexOf("g")<0&&(V+="g");const m=C,s=new RegExp(I,V);let F=s.exec(m);for(;null!==F;){let V=l;for(let I=0;I<F.length;++I)V=V.replace("$"+I,F[I]);C=C.replace(F[0],V),F=s.exec(m)}}else{const V="#define "+I;C=C.replace(V,"\n"+l+"\n"+V)}}return C}}}K._MaterialPluginClassToMainDefine={},K._MaterialPluginCounter=0,F.c.OnEnginesDisposedObservable.add((()=>{v()}));const Y=[];let X=!1,O=null;function v(){Y.length=0,X=!1,s.d.OnEventObservable.remove(O),O=null}var N=m(11297),t=m(11048);class D{isCompatible(V){return 0===V}_enable(V){V&&this._pluginManager._activatePlugin(this)}constructor(V,I,m,C){let l=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],F=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this.doNotSerialize=!1,this._material=V,this.name=I,this.priority=m,this.resolveIncludes=F,V.pluginManager||(V.pluginManager=new K(V),V.Ck.add((()=>{V.pluginManager=void 0}))),this._pluginDefineNames=C,this._pluginManager=V.pluginManager,l&&this._pluginManager._addPlugin(this),s&&this._enable(!0),this.markAllDefinesAsDirty=V._dirtyCallbacks[127]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(V,I,m,C){return!0}hardBindForSubMesh(V,I,m,C){}bindForSubMesh(V,I,m,C){}dispose(V){}getCustomCode(V){return null}collectDefines(V){if(this._pluginDefineNames)for(const I of Object.keys(this._pluginDefineNames)){if("_"===I[0])continue;const m=typeof this._pluginDefineNames[I];V[I]={type:"number"===m?"number":"string"===m?"string":"boolean"===m?"boolean":"object",default:this._pluginDefineNames[I]}}}prepareDefinesBeforeAttributes(V,I,m){}prepareDefines(V,I,m){}hasTexture(V){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(V){}getActiveTextures(V){}getAnimatables(V){}addFallbacks(V,I,m){return m}getSamplers(V){}getAttributes(V,I,m){}getUniformBuffersNames(V){}getUniforms(){return{}}copyTo(V){N.d.Clone((()=>V),this)}serialize(){return N.d.Serialize(this)}parse(V,I,m){N.d.Parse((()=>this),V,I,m)}}(0,C.d)([(0,l.B)()],D.prototype,"name",void 0),(0,C.d)([(0,l.B)()],D.prototype,"priority",void 0),(0,C.d)([(0,l.B)()],D.prototype,"resolveIncludes",void 0),(0,C.d)([(0,l.B)()],D.prototype,"registerForExtraEvents",void 0),(0,t.h)("BABYLON.MaterialPluginBase",D)},11419:(V,I,m)=>{m.d(I,{d:()=>F});var C=m(11202),l=m(11305),s=m(11048);class F extends C.d{get jk(){return this._subMaterials}set jk(V){this._subMaterials=V,this._hookArray(V)}getChildren(){return this.jk}constructor(V,I){super(V,I,!0),this._waitingSubMaterialsUniqueIds=[],this.cV().addMultiMaterial(this),this.jk=[],this._storeEffectOnSubMeshes=!0}_hookArray(V){var I=this;const m=V.push;V.push=function(){for(var C=arguments.length,l=new Array(C),s=0;s<C;s++)l[s]=arguments[s];const F=m.apply(V,l);return I._markAllSubMeshesAsTexturesDirty(),F};const C=V.splice;V.splice=(I,m)=>{const l=C.apply(V,[I,m]);return this._markAllSubMeshesAsTexturesDirty(),l}}getSubMaterial(V){return V<0||V>=this.jk.length?this.cV().defaultMaterial:this.jk[V]}getActiveTextures(){return super.getActiveTextures().concat(...this.jk.map((V=>V?V.getActiveTextures():[])))}hasTexture(V){if(super.hasTexture(V))return!0;for(let m=0;m<this.jk.length;m++){var I;if(null!==(I=this.jk[m])&&void 0!==I&&I.hasTexture(V))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(V,I,m){for(let C=0;C<this.jk.length;C++){const l=this.jk[C];if(l){if(l._storeEffectOnSubMeshes){if(!l.isReadyForSubMesh(V,I,m))return!1;continue}if(!l.isReady(V))return!1}}return!0}clone(V,I){const m=new F(V,this.cV());for(let C=0;C<this.jk.length;C++){let l=null;const s=this.jk[C];l=I&&s?s.clone(V+"-"+s.name):this.jk[C],m.jk.push(l)}return m}serialize(){const V={};V.name=this.name,V.id=this.id,V.uniqueId=this.uniqueId,l.b&&(V.tags=l.b.GetTags(this)),V.materialsUniqueIds=[],V.materials=[];for(let I=0;I<this.jk.length;I++){const m=this.jk[I];m?(V.materialsUniqueIds.push(m.uniqueId),V.materials.push(m.id)):(V.materialsUniqueIds.push(null),V.materials.push(null))}return V}dispose(V,I,m){const C=this.cV();if(!C)return;if(m)for(let s=0;s<this.jk.length;s++){const m=this.jk[s];m&&m.dispose(V,I)}const l=C.multiMaterials.indexOf(this);l>=0&&C.multiMaterials.splice(l,1),super.dispose(V,I)}static ParseMultiMaterial(V,I){const m=new F(V.name,I);if(m.id=V.id,m._loadedUniqueId=V.uniqueId,l.b&&l.b.AddTagsTo(m,V.tags),V.materialsUniqueIds)m._waitingSubMaterialsUniqueIds=V.materialsUniqueIds;else for(const C of V.materials)m.jk.push(I.getLastMaterialById(C));return m}}(0,s.h)("BABYLON.MultiMaterial",F)},11658:(V,I,m)=>{m.d(I,{c:()=>C});class C{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(V){V.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(V){}bindForSubMesh(V,I,m,C,l){if(I.prePassRenderer&&I.prePassRenderer.enabled&&I.prePassRenderer.currentRTisSceneRT&&(-1!==I.prePassRenderer.getIndex(2)||-1!==I.prePassRenderer.getIndex(11))){this.previousWorldMatrices[m.uniqueId]||(this.previousWorldMatrices[m.uniqueId]=C.clone()),this.previousViewProjection||(this.previousViewProjection=I.getTransformMatrix().clone(),this.currentViewProjection=I.getTransformMatrix().clone());const l=I.getEngine();this.currentViewProjection.updateFlag!==I.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=l.frameId,this.previousViewProjection.C(this.currentViewProjection),this.currentViewProjection.C(I.getTransformMatrix())):this._lastUpdateFrameId!==l.frameId&&(this._lastUpdateFrameId=l.frameId,this.previousViewProjection.C(this.currentViewProjection)),V.setMatrix("previousWorld",this.previousWorldMatrices[m.uniqueId]),V.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[m.uniqueId]=C.clone()}}}},11661:(V,I,m)=>{m.d(I,{b:()=>s});var C=m(11040),l=m(11202);class s extends l.d{constructor(V,I){let m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(V,I,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new C.b,this._storeEffectOnSubMeshes=m}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(V,I){return!!V&&(!this._storeEffectOnSubMeshes||(!V.kk||0===V.kk.length||this.isReadyForSubMesh(V,V.kk[0],I)))}_isReadyForSubMesh(V){const I=V.materialDefines;return!(this.checkReadyOnEveryCall||!V.effect||!I||I._renderId!==this.cV().getRenderId())}bindOnlyWorldMatrix(V){this._activeEffect.setMatrix("world",V)}bindOnlyNormalMatrix(V){this._activeEffect.setMatrix("normalMatrix",V)}bind(V,I){I&&this.bindForSubMesh(V,I,I.kk[0])}_afterBind(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2?arguments[2]:void 0;super._afterBind(V,I,m),this.cV()._cachedEffect=I,m?m._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return m._drawWrapper._forceRebindOnNextCall||V.isCachedMaterialInvalid(this,I,C)}dispose(V,I,m){this._activeEffect=void 0,super.dispose(V,I,m)}}},11724:(V,I,m)=>{m.d(I,{d:()=>t});var C=m(11297),l=m(11596),s=m(11040),F=m(11233),k=m(11518),j=m(11048),E=m(11681),K=m(11099),Y=m(11661),X=m(11061),O=m(11327),v=m(11316);const N={effect:null,subMesh:null};class t extends Y.b{constructor(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(V,I,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new s.b,this._cachedWorldViewProjectionMatrix=new s.b,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=m,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","XC","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...C}}get shaderPath(){return this._shaderPath}set shaderPath(V){this._shaderPath=V}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(V){-1===this._options.uniforms.indexOf(V)&&this._options.uniforms.push(V)}setTexture(V,I){return-1===this._options.samplers.indexOf(V)&&this._options.samplers.push(V),this._textures[V]=I,this}removeTexture(V){delete this._textures[V]}setTextureArray(V,I){return-1===this._options.samplers.indexOf(V)&&this._options.samplers.push(V),this._checkUniform(V),this._textureArrays[V]=I,this}setExternalTexture(V,I){return-1===this._options.externalTextures.indexOf(V)&&this._options.externalTextures.push(V),this._externalTextures[V]=I,this}setFloat(V,I){return this._checkUniform(V),this._floats[V]=I,this}setInt(V,I){return this._checkUniform(V),this._ints[V]=I,this}setUInt(V,I){return this._checkUniform(V),this._uints[V]=I,this}setFloats(V,I){return this._checkUniform(V),this._floatsArrays[V]=I,this}setColor3(V,I){return this._checkUniform(V),this._colors3[V]=I,this}setColor3Array(V,I){return this._checkUniform(V),this._colors3Arrays[V]=I.reduce(((V,I)=>(V.push(I.r,I.g,I.b),V)),[]),this}setColor4(V,I){return this._checkUniform(V),this._colors4[V]=I,this}setColor4Array(V,I){return this._checkUniform(V),this._colors4Arrays[V]=I.reduce(((V,I)=>(V.push(I.r,I.g,I.b,I.a),V)),[]),this}setVector2(V,I){return this._checkUniform(V),this._vectors2[V]=I,this}setVector3(V,I){return this._checkUniform(V),this._vectors3[V]=I,this}setVector4(V,I){return this._checkUniform(V),this._vectors4[V]=I,this}setQuaternion(V,I){return this._checkUniform(V),this._quaternions[V]=I,this}setQuaternionArray(V,I){return this._checkUniform(V),this._quaternionsArrays[V]=I.reduce(((V,I)=>(I.toArray(V,V.length),V)),[]),this}setMatrix(V,I){return this._checkUniform(V),this._matrices[V]=I,this}setMatrices(V,I){this._checkUniform(V);const m=new Float32Array(16*I.length);for(let C=0;C<I.length;C++){I[C].copyToArray(m,16*C)}return this._matrixArrays[V]=m,this}setMatrix3x3(V,I){return this._checkUniform(V),this._matrices3x3[V]=I,this}setMatrix2x2(V,I){return this._checkUniform(V),this._matrices2x2[V]=I,this}setArray2(V,I){return this._checkUniform(V),this._vectors2Arrays[V]=I,this}setArray3(V,I){return this._checkUniform(V),this._vectors3Arrays[V]=I,this}setArray4(V,I){return this._checkUniform(V),this._vectors4Arrays[V]=I,this}setUniformBuffer(V,I){return-1===this._options.uniformBuffers.indexOf(V)&&this._options.uniformBuffers.push(V),this._uniformBuffers[V]=I,this}setTextureSampler(V,I){return-1===this._options.samplerObjects.indexOf(V)&&this._options.samplerObjects.push(V),this._textureSamplers[V]=I,this}setStorageBuffer(V,I){return-1===this._options.storageBuffers.indexOf(V)&&this._options.storageBuffers.push(V),this._storageBuffers[V]=I,this}setDefine(V,I){const m=V.trimEnd()+" ",C=this.options.defines.findIndex((I=>I===V||I.startsWith(m)));return C>=0&&this.options.defines.splice(C,1),("boolean"!==typeof I||I)&&this.options.defines.push(m+I),this}isReadyForSubMesh(V,I,m){return this.isReady(V,m,I)}isReady(V,I,m){var C;const s=m&&this._storeEffectOnSubMeshes;if(this.isFrozen){const V=s?m._drawWrapper:this._drawWrapper;if(V.effect&&V._wasPreviouslyReady&&V._wasPreviouslyUsingInstances===I)return!0}const k=this.cV(),j=k.getEngine(),K=[],Y=[];let X=null,t=this._shaderPath,D=this._options.uniforms,b=this._options.uniformBuffers,T=this._options.samplers;j.getCaps().multiview&&k.activeCamera&&k.activeCamera.outputRenderTarget&&k.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,K.push("#define MULTIVIEW"),-1!==D.indexOf("viewProjection")&&-1===D.indexOf("viewProjectionR")&&D.push("viewProjectionR"));for(let l=0;l<this._options.defines.length;l++){const V=0===this._options.defines[l].indexOf("#define")?this._options.defines[l]:`#define ${this._options.defines[l]}`;K.push(V)}for(let l=0;l<this._options.attributes.length;l++)Y.push(this._options.attributes[l]);if(V&&V.isVerticesDataPresent(F.e.ColorKind)&&(-1===Y.indexOf(F.e.ColorKind)&&Y.push(F.e.ColorKind),K.push("#define VERTEXCOLOR")),I&&(K.push("#define INSTANCES"),(0,v.$)(Y,this._materialHelperNeedsPreviousMatrices),null!==V&&void 0!==V&&V.hasThinInstances&&(K.push("#define THIN_INSTANCES"),V&&V.isVerticesDataPresent(F.e.ColorInstanceKind)&&(Y.push(F.e.ColorInstanceKind),K.push("#define INSTANCESCOLOR")))),V&&V.useBones&&V.computeBonesUsingShaders&&V.skeleton){Y.push(F.e.MatricesIndicesKind),Y.push(F.e.MatricesWeightsKind),V.numBoneInfluencers>4&&(Y.push(F.e.MatricesIndicesExtraKind),Y.push(F.e.MatricesWeightsExtraKind));const I=V.skeleton;K.push("#define NUM_BONE_INFLUENCERS "+V.numBoneInfluencers),X=new E.b,X.addCPUSkinningFallback(0,V),I.isUsingTextureForMatrices?(K.push("#define BONETEXTURE"),-1===D.indexOf("boneTextureWidth")&&D.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(K.push("#define BonesPerMesh "+(I.bones.length+1)),-1===D.indexOf("mBones")&&D.push("mBones"))}else K.push("#define NUM_BONE_INFLUENCERS 0");let n=0;const x=V?V.morphTargetManager:null;if(x){const I=-1!==K.indexOf("#define UV1"),m=-1!==K.indexOf("#define UV2"),C=-1!==K.indexOf("#define TANGENT"),l=-1!==K.indexOf("#define NORMAL"),s=-1!==K.indexOf("#define VERTEXCOLOR");n=(0,v.I)(x,K,Y,V,!0,l,C,I,m,s),x.isUsingTextureForTargets&&(-1===D.indexOf("morphTargetTextureIndices")&&D.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),n>0&&(D=D.slice(),D.push("morphTargetInfluences"),D.push("morphTargetCount"),D.push("morphTargetTextureInfo"),D.push("morphTargetTextureIndices"))}else K.push("#define NUM_MORPH_INFLUENCERS 0");if(V){const I=V.bakedVertexAnimationManager;I&&I.isEnabled&&(K.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===D.indexOf("bakedVertexAnimationSettings")&&D.push("bakedVertexAnimationSettings"),-1===D.indexOf("bakedVertexAnimationTextureSizeInverted")&&D.push("bakedVertexAnimationTextureSizeInverted"),-1===D.indexOf("bakedVertexAnimationTime")&&D.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,v.y)(Y,V,K)}for(const l in this._textures)if(!this._textures[l].isReady())return!1;V&&this.needAlphaTestingForMesh(V)&&K.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,O.b)(D),(0,O.i)(this,k,K)),k.fogEnabled&&null!==V&&void 0!==V&&V.applyFog&&k.fogMode!==l.e.FOGMODE_NONE&&(K.push("#define FOG"),-1===D.indexOf("view")&&D.push("view"),-1===D.indexOf("vFogInfos")&&D.push("vFogInfos"),-1===D.indexOf("vFogColor")&&D.push("vFogColor")),this._useLogarithmicDepth&&(K.push("#define LOGARITHMICDEPTH"),-1===D.indexOf("logarithmicDepthConstant")&&D.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(D=D.slice(),b=b.slice(),T=T.slice(),t=this.customShaderNameResolve(this.name,D,b,T,K,Y));const S=s?m._getDrawWrapper(void 0,!0):this._drawWrapper,c=(null===S||void 0===S?void 0:S.effect)??null,H=(null===S||void 0===S?void 0:S.defines)??null,y=K.join("\n");let z=c;return H!==y&&(z=j.createEffect(t,{attributes:Y,uniformsNames:D,uniformBuffersNames:b,samplers:T,defines:y,fallbacks:X,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:n},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},j),s?m.setEffect(z,y,this._materialContext):S&&S.setEffect(z,y),this._onEffectCreatedObservable&&(N.effect=z,N.subMesh=m??(null===V||void 0===V?void 0:V.kk[0])??null,this._onEffectCreatedObservable.notifyObservers(N))),S._wasPreviouslyUsingInstances=!!I,!(null===(C=z)||void 0===C||!C.isReady())&&(c!==z&&k.resetCachedMaterial(),S._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(V,I){const m=I??this.getEffect();if(!m)return;const C=this._options.uniforms;-1!==C.indexOf("world")&&m.setMatrix("world",V);const l=this.cV();-1!==C.indexOf("worldView")&&(V.multiplyToRef(l.getViewMatrix(),this._cachedWorldViewMatrix),m.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==C.indexOf("worldViewProjection")&&(V.multiplyToRef(l.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),m.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==C.indexOf("view")&&m.setMatrix("view",l.getViewMatrix())}bindForSubMesh(V,I,m){var C;this.bind(V,I,null===(C=m._drawWrapperOverride)||void 0===C?void 0:C.effect,m)}bind(V,I,m,C){const l=C&&this._storeEffectOnSubMeshes,s=m??(l?C.effect:this.getEffect());if(!s)return;const F=this.cV();this._activeEffect=s,this.bindOnlyWorldMatrix(V,m);const k=this._options.uniformBuffers;let j=!1;if(s&&k&&k.length>0&&F.getEngine().supportsUniformBuffers)for(let Y=0;Y<k.length;++Y){switch(k[Y]){case"Mesh":I&&(I.getMeshUniformBuffer().bindToEffect(s,"Mesh"),I.transferToEffect(V));break;case"Scene":(0,v.s)(s,F.getSceneUniformBuffer()),F.finalizeSceneUbo(),j=!0}}const E=I&&l?this._mustRebind(F,s,C,I.visibility):F.getCachedMaterial()!==this;if(s&&E){let V;for(V in j||-1===this._options.uniforms.indexOf("view")||s.setMatrix("view",F.getViewMatrix()),j||-1===this._options.uniforms.indexOf("projection")||s.setMatrix("projection",F.getProjectionMatrix()),j||-1===this._options.uniforms.indexOf("viewProjection")||(s.setMatrix("viewProjection",F.getTransformMatrix()),this._multiview&&s.setMatrix("viewProjectionR",F._transformMatrixR)),F.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&s.setVector3("cameraPosition",F.activeCamera.globalPosition),(0,v.b)(I,s),(0,O.d)(s,this,F),this._useLogarithmicDepth&&(0,v.n)(l?C.materialDefines:s.defines,s,F),I&&(0,v.f)(F,I,s),this._textures)s.setTexture(V,this._textures[V]);for(V in this._textureArrays)s.setTextureArray(V,this._textureArrays[V]);for(V in this._ints)s.setInt(V,this._ints[V]);for(V in this._uints)s.setUInt(V,this._uints[V]);for(V in this._floats)s.setFloat(V,this._floats[V]);for(V in this._floatsArrays)s.setArray(V,this._floatsArrays[V]);for(V in this._colors3)s.setColor3(V,this._colors3[V]);for(V in this._colors3Arrays)s.setArray3(V,this._colors3Arrays[V]);for(V in this._colors4){const I=this._colors4[V];s.setFloat4(V,I.r,I.g,I.b,I.a)}for(V in this._colors4Arrays)s.setArray4(V,this._colors4Arrays[V]);for(V in this._vectors2)s.setVector2(V,this._vectors2[V]);for(V in this._vectors3)s.setVector3(V,this._vectors3[V]);for(V in this._vectors4)s.setVector4(V,this._vectors4[V]);for(V in this._quaternions)s.setQuaternion(V,this._quaternions[V]);for(V in this._matrices)s.setMatrix(V,this._matrices[V]);for(V in this._matrixArrays)s.setMatrices(V,this._matrixArrays[V]);for(V in this._matrices3x3)s.setMatrix3x3(V,this._matrices3x3[V]);for(V in this._matrices2x2)s.setMatrix2x2(V,this._matrices2x2[V]);for(V in this._vectors2Arrays)s.setArray2(V,this._vectors2Arrays[V]);for(V in this._vectors3Arrays)s.setArray3(V,this._vectors3Arrays[V]);for(V in this._vectors4Arrays)s.setArray4(V,this._vectors4Arrays[V]);for(V in this._quaternionsArrays)s.setArray4(V,this._quaternionsArrays[V]);for(V in this._uniformBuffers){const I=this._uniformBuffers[V].getBuffer();I&&s.bindUniformBuffer(I,V)}const m=F.getEngine(),k=m.setExternalTexture;if(k)for(V in this._externalTextures)k.call(m,V,this._externalTextures[V]);const E=m.setTextureSampler;if(E)for(V in this._textureSamplers)E.call(m,V,this._textureSamplers[V]);const K=m.setStorageBuffer;if(K)for(V in this._storageBuffers)K.call(m,V,this._storageBuffers[V])}if(s&&I&&(E||!this.isFrozen)){(0,v.r)(I,s),I.morphTargetManager&&I.morphTargetManager.isUsingTextureForTargets&&I.morphTargetManager._bind(s);const V=I.bakedVertexAnimationManager;if(V&&V.isEnabled){var K;const V=l?C._drawWrapper:this._drawWrapper;null===(K=I.bakedVertexAnimationManager)||void 0===K||K.bind(s,!!V._wasPreviouslyUsingInstances)}}this._afterBind(I,s,C)}getActiveTextures(){const V=super.getActiveTextures();for(const I in this._textures)V.push(this._textures[I]);for(const I in this._textureArrays){const m=this._textureArrays[I];for(let I=0;I<m.length;I++)V.push(m[I])}return V}hasTexture(V){if(super.hasTexture(V))return!0;for(const I in this._textures)if(this._textures[I]===V)return!0;for(const I in this._textureArrays){const m=this._textureArrays[I];for(let I=0;I<m.length;I++)if(m[I]===V)return!0}return!1}clone(V){const I=C.d.Clone((()=>new t(V,this.cV(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);I.name=V,I.id=V,"object"===typeof I._shaderPath&&(I._shaderPath={...I._shaderPath}),this._options={...this._options};const m=Object.keys(this._options);for(const C of m){const V=this._options[C];Array.isArray(V)&&(this._options[C]=V.slice(0))}this.stencil.copyTo(I.stencil);for(const C in this._textures)I.setTexture(C,this._textures[C]);for(const C in this._textureArrays)I.setTextureArray(C,this._textureArrays[C]);for(const C in this._externalTextures)I.setExternalTexture(C,this._externalTextures[C]);for(const C in this._ints)I.setInt(C,this._ints[C]);for(const C in this._uints)I.setUInt(C,this._uints[C]);for(const C in this._floats)I.setFloat(C,this._floats[C]);for(const C in this._floatsArrays)I.setFloats(C,this._floatsArrays[C]);for(const C in this._colors3)I.setColor3(C,this._colors3[C]);for(const C in this._colors3Arrays)I._colors3Arrays[C]=this._colors3Arrays[C];for(const C in this._colors4)I.setColor4(C,this._colors4[C]);for(const C in this._colors4Arrays)I._colors4Arrays[C]=this._colors4Arrays[C];for(const C in this._vectors2)I.setVector2(C,this._vectors2[C]);for(const C in this._vectors3)I.setVector3(C,this._vectors3[C]);for(const C in this._vectors4)I.setVector4(C,this._vectors4[C]);for(const C in this._quaternions)I.setQuaternion(C,this._quaternions[C]);for(const C in this._quaternionsArrays)I._quaternionsArrays[C]=this._quaternionsArrays[C];for(const C in this._matrices)I.setMatrix(C,this._matrices[C]);for(const C in this._matrixArrays)I._matrixArrays[C]=this._matrixArrays[C].slice();for(const C in this._matrices3x3)I.setMatrix3x3(C,this._matrices3x3[C]);for(const C in this._matrices2x2)I.setMatrix2x2(C,this._matrices2x2[C]);for(const C in this._vectors2Arrays)I.setArray2(C,this._vectors2Arrays[C]);for(const C in this._vectors3Arrays)I.setArray3(C,this._vectors3Arrays[C]);for(const C in this._vectors4Arrays)I.setArray4(C,this._vectors4Arrays[C]);for(const C in this._uniformBuffers)I.setUniformBuffer(C,this._uniformBuffers[C]);for(const C in this._textureSamplers)I.setTextureSampler(C,this._textureSamplers[C]);for(const C in this._storageBuffers)I.setStorageBuffer(C,this._storageBuffers[C]);return I}dispose(V,I,m){if(I){let V;for(V in this._textures)this._textures[V].dispose();for(V in this._textureArrays){const I=this._textureArrays[V];for(let V=0;V<I.length;V++)I[V].dispose()}}this._textures={},super.dispose(V,I,m)}serialize(){const V=C.d.Serialize(this);let I;for(I in V.customType="BABYLON.ShaderMaterial",V.uniqueId=this.uniqueId,V.options=this._options,V.shaderPath=this._shaderPath,V.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,V.stencil=this.stencil.serialize(),V.textures={},this._textures)V.textures[I]=this._textures[I].serialize();for(I in V.textureArrays={},this._textureArrays){V.textureArrays[I]=[];const m=this._textureArrays[I];for(let C=0;C<m.length;C++)V.textureArrays[I].push(m[C].serialize())}for(I in V.ints={},this._ints)V.ints[I]=this._ints[I];for(I in V.uints={},this._uints)V.uints[I]=this._uints[I];for(I in V.floats={},this._floats)V.floats[I]=this._floats[I];for(I in V.floatsArrays={},this._floatsArrays)V.floatsArrays[I]=this._floatsArrays[I];for(I in V.colors3={},this._colors3){const m=this._colors3[I];V.colors3[I]=[m.r,m.g,m.b]}for(I in V.colors3Arrays={},this._colors3Arrays)V.colors3Arrays[I]=this._colors3Arrays[I];for(I in V.colors4={},this._colors4){const m=this._colors4[I];V.colors4[I]=[m.r,m.g,m.b,m.a]}for(I in V.colors4Arrays={},this._colors4Arrays)V.colors4Arrays[I]=this._colors4Arrays[I];for(I in V.vectors2={},this._vectors2){const m=this._vectors2[I];V.vectors2[I]=[m.x,m.y]}for(I in V.vectors3={},this._vectors3){const m=this._vectors3[I];V.vectors3[I]=[m.x,m.y,m.z]}for(I in V.vectors4={},this._vectors4){const m=this._vectors4[I];V.vectors4[I]=[m.x,m.y,m.z,m.w]}for(I in V.quaternions={},this._quaternions)V.quaternions[I]=this._quaternions[I].UF();for(I in V.matrices={},this._matrices)V.matrices[I]=this._matrices[I].UF();for(I in V.matrixArray={},this._matrixArrays)V.matrixArray[I]=this._matrixArrays[I];for(I in V.matrices3x3={},this._matrices3x3)V.matrices3x3[I]=this._matrices3x3[I];for(I in V.matrices2x2={},this._matrices2x2)V.matrices2x2[I]=this._matrices2x2[I];for(I in V.vectors2Arrays={},this._vectors2Arrays)V.vectors2Arrays[I]=this._vectors2Arrays[I];for(I in V.vectors3Arrays={},this._vectors3Arrays)V.vectors3Arrays[I]=this._vectors3Arrays[I];for(I in V.vectors4Arrays={},this._vectors4Arrays)V.vectors4Arrays[I]=this._vectors4Arrays[I];for(I in V.quaternionsArrays={},this._quaternionsArrays)V.quaternionsArrays[I]=this._quaternionsArrays[I];return V}static Parse(V,I,m){const l=C.d.Parse((()=>new t(V.name,I,V.shaderPath,V.options,V.storeEffectOnSubMeshes)),V,I,m);let F;for(F in V.stencil&&l.stencil.parse(V.stencil,I,m),V.textures)l.setTexture(F,k.e.Parse(V.textures[F],I,m));for(F in V.textureArrays){const C=V.textureArrays[F],s=[];for(let V=0;V<C.length;V++)s.push(k.e.Parse(C[V],I,m));l.setTextureArray(F,s)}for(F in V.ints)l.setInt(F,V.ints[F]);for(F in V.uints)l.setUInt(F,V.uints[F]);for(F in V.floats)l.setFloat(F,V.floats[F]);for(F in V.floatsArrays)l.setFloats(F,V.floatsArrays[F]);for(F in V.colors3){const I=V.colors3[F];l.setColor3(F,{r:I[0],g:I[1],b:I[2]})}for(F in V.colors3Arrays){const I=V.colors3Arrays[F].reduce(((V,I,m)=>(m%3===0?V.push([I]):V[V.length-1].push(I),V)),[]).map((V=>({r:V[0],g:V[1],b:V[2]})));l.setColor3Array(F,I)}for(F in V.colors4){const I=V.colors4[F];l.setColor4(F,{r:I[0],g:I[1],b:I[2],a:I[3]})}for(F in V.colors4Arrays){const I=V.colors4Arrays[F].reduce(((V,I,m)=>(m%4===0?V.push([I]):V[V.length-1].push(I),V)),[]).map((V=>({r:V[0],g:V[1],b:V[2],a:V[3]})));l.setColor4Array(F,I)}for(F in V.vectors2){const I=V.vectors2[F];l.setVector2(F,{x:I[0],y:I[1]})}for(F in V.vectors3){const I=V.vectors3[F];l.setVector3(F,{x:I[0],y:I[1],z:I[2]})}for(F in V.vectors4){const I=V.vectors4[F];l.setVector4(F,{x:I[0],y:I[1],z:I[2],w:I[3]})}for(F in V.quaternions)l.setQuaternion(F,s.e.Ik(V.quaternions[F]));for(F in V.matrices)l.setMatrix(F,s.b.Ik(V.matrices[F]));for(F in V.matrixArray)l._matrixArrays[F]=new Float32Array(V.matrixArray[F]);for(F in V.matrices3x3)l.setMatrix3x3(F,V.matrices3x3[F]);for(F in V.matrices2x2)l.setMatrix2x2(F,V.matrices2x2[F]);for(F in V.vectors2Arrays)l.setArray2(F,V.vectors2Arrays[F]);for(F in V.vectors3Arrays)l.setArray3(F,V.vectors3Arrays[F]);for(F in V.vectors4Arrays)l.setArray4(F,V.vectors4Arrays[F]);for(F in V.quaternionsArrays)l.setArray4(F,V.quaternionsArrays[F]);return l}static async ParseFromFileAsync(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return await new Promise(((l,s)=>{const F=new K.c;F.addEventListener("readystatechange",(()=>{if(4==F.readyState)if(200==F.status){const I=JSON.parse(F.responseText),s=this.Parse(I,m||X.c.LastCreatedScene,C);V&&(s.name=V),l(s)}else s("Unable to load the ShaderMaterial")})),F.open("GET",I),F.send()}))}static async ParseFromSnippetAsync(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return await new Promise(((C,l)=>{const s=new K.c;s.addEventListener("readystatechange",(()=>{if(4==s.readyState)if(200==s.status){const l=JSON.parse(JSON.parse(s.responseText).jsonPayload),F=JSON.parse(l.shaderMaterial),k=this.Parse(F,I||X.c.LastCreatedScene,m);k.snippetId=V,C(k)}else l("Unable to load the snippet "+V)})),s.open("GET",this.SnippetUrl+"/"+V.replace(/#/g,"/")),s.send()}))}}t.SnippetUrl="https://snippet.babylonjs.com",t.CreateFromSnippetAsync=t.ParseFromSnippetAsync,(0,j.h)("BABYLON.ShaderMaterial",t)},11691:(V,I,m)=>{m.d(I,{d:()=>y});var C=m(11206),l=m(11214),s=m(11389),F=m(11596),k=m(11312),j=m(11233),E=m(11658),K=m(11605),Y=m(11202),X=m(11642),O=m(11661),v=m(11518),N=m(11048),t=m(11667),D=m(11681),b=m(11685),T=m(11327),n=m(11316),x=m(11297),S=m(11688);const c={effect:null,subMesh:null};class H extends X.c{constructor(V){super(V),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(V){const I=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const m of I)this[m]=m===V}}class y extends O.b{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(V){this._attachImageProcessingConfiguration(V),this._markAllSubMeshesAsImageProcessingDirty()}_attachImageProcessingConfiguration(V){V!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=V||this.cV().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(V){this.imageProcessingConfiguration.colorCurvesEnabled=V}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(V){this.imageProcessingConfiguration.colorGradingEnabled=V}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(V){this._imageProcessingConfiguration.toneMappingEnabled=V}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(V){this._imageProcessingConfiguration.exposure=V}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(V){this._imageProcessingConfiguration.contrast=V}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(V){this._imageProcessingConfiguration.colorGradingTexture=V}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(V){this._imageProcessingConfiguration.colorCurves=V}get canRenderToMRT(){return!0}constructor(V,I){super(V,I,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||y.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new k.c(0,0,0),this.diffuseColor=new k.c(1,1,1),this.specularColor=new k.c(1,1,1),this.emissiveColor=new k.c(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new s.g(16),this._globalAmbientColor=new k.c(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new b.c(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new E.c,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),y.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),y.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(y.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(y.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}getClassName(){return"Xk"}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return this._hasTransparencyMode?this._transparencyModeIsTest:this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===Y.d.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.eF&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==Y.d.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.eF||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(V,I){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._uniformBufferLayoutBuilt||this.buildUniformLayout();const l=I._drawWrapper;if(l.effect&&this.isFrozen&&l._wasPreviouslyReady&&l._wasPreviouslyUsingInstances===C)return!0;I.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),I.materialDefines=new H(this._eventInfo.defineNames));const s=this.cV(),F=I.materialDefines;if(this._isReadyForSubMesh(I))return!0;const k=s.getEngine();F._needNormals=(0,n.P)(s,V,F,!0,this._maxSimultaneousLights,this._disableLighting),(0,n.T)(s,F);const Y=this.needAlphaBlendingForMesh(V)&&this.cV().useOrderIndependentTransparency;if((0,n.Z)(s,F,this.canRenderToMRT&&!Y),(0,n.V)(s,F,Y),S.b.PrepareDefines(k.currentRenderPassId,V,F),F._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,F._needUVs=!1;for(let V=1;V<=6;++V)F["MAINUV"+V]=!1;if(s.texturesEnabled){if(F.DIFFUSEDIRECTUV=0,F.BUMPDIRECTUV=0,F.AMBIENTDIRECTUV=0,F.OPACITYDIRECTUV=0,F.EMISSIVEDIRECTUV=0,F.SPECULARDIRECTUV=0,F.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&y.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,n.R)(this._diffuseTexture,F,"DIFFUSE")}else F.DIFFUSE=!1;if(this._ambientTexture&&y.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;(0,n.R)(this._ambientTexture,F,"AMBIENT")}else F.AMBIENT=!1;if(this._opacityTexture&&y.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;(0,n.R)(this._opacityTexture,F,"OPACITY"),F.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else F.OPACITY=!1;if(this._reflectionTexture&&y.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(F._needNormals=!0,F.REFLECTION=!0,F.ROUGHNESS=this._roughness>0,F.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,F.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===v.e.INVCUBIC_MODE,F.REFLECTIONMAP_3D=this._reflectionTexture.isCube,F.REFLECTIONMAP_OPPOSITEZ=F.REFLECTIONMAP_3D&&this.cV().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,F.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case v.e.EXPLICIT_MODE:F.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case v.e.PLANAR_MODE:F.setReflectionMode("REFLECTIONMAP_PLANAR");break;case v.e.PROJECTION_MODE:F.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case v.e.SKYBOX_MODE:F.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case v.e.SPHERICAL_MODE:F.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case v.e.EQUIRECTANGULAR_MODE:F.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case v.e.FIXED_EQUIRECTANGULAR_MODE:F.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case v.e.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:F.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case v.e.CUBIC_MODE:case v.e.INVCUBIC_MODE:default:F.setReflectionMode("REFLECTIONMAP_CUBIC")}F.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else F.REFLECTION=!1,F.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&y.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;(0,n.R)(this._emissiveTexture,F,"EMISSIVE")}else F.EMISSIVE=!1;if(this._lightmapTexture&&y.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;(0,n.R)(this._lightmapTexture,F,"LIGHTMAP"),F.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,F.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else F.LIGHTMAP=!1;if(this._specularTexture&&y.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;(0,n.R)(this._specularTexture,F,"SPECULAR"),F.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else F.SPECULAR=!1;if(s.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&y.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,n.R)(this._bumpTexture,F,"BUMP"),F.PARALLAX=this._useParallax,F.PARALLAX_RHS=s.useRightHandedSystem,F.PARALLAXOCCLUSION=this._useParallaxOcclusion,F.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else F.BUMP=!1,F.PARALLAX=!1,F.PARALLAX_RHS=!1,F.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&y.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;F._needUVs=!0,F.REFRACTION=!0,F.REFRACTIONMAP_3D=this._refractionTexture.isCube,F.RGBDREFRACTION=this._refractionTexture.isRGBD,F.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else F.REFRACTION=!1;F.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else F.DIFFUSE=!1,F.AMBIENT=!1,F.OPACITY=!1,F.REFLECTION=!1,F.EMISSIVE=!1,F.LIGHTMAP=!1,F.BUMP=!1,F.REFRACTION=!1;F.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),F.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,F.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,F.SPECULAROVERALPHA=this._useSpecularOverAlpha,F.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,F.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,F.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(V)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=F,this._eventInfo.subMesh=I,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(F._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(F),F.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,F.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(F._areFresnelDirty&&(y.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(F.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,F.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,F.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,F.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,F.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,F.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,F._needNormals=!0,F.FRESNEL=!0):F.FRESNEL=!1),F.AREALIGHTUSED)for(let m=0;m<V.lightSources.length;m++)if(!V.lightSources[m]._isReady())return!1;(0,n.S)(V,s,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(V),F,this._applyDecalMapAfterDetailMap),(0,n.M)(s,k,this,F,C,null,I.getRenderingMesh().hasThinInstances),this._eventInfo.defines=F,this._eventInfo.mesh=V,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,n.K)(V,F,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let X=!1;if(F.isDirty){const C=F._areLightsDisposed;F.markAsProcessed();const l=new D.b;F.REFLECTION&&l.addFallback(0,"REFLECTION"),F.SPECULAR&&l.addFallback(0,"SPECULAR"),F.BUMP&&l.addFallback(0,"BUMP"),F.PARALLAX&&l.addFallback(1,"PARALLAX"),F.PARALLAX_RHS&&l.addFallback(1,"PARALLAX_RHS"),F.PARALLAXOCCLUSION&&l.addFallback(0,"PARALLAXOCCLUSION"),F.SPECULAROVERALPHA&&l.addFallback(0,"SPECULAROVERALPHA"),F.FOG&&l.addFallback(1,"FOG"),F.POINTSIZE&&l.addFallback(0,"POINTSIZE"),F.LOGARITHMICDEPTH&&l.addFallback(0,"LOGARITHMICDEPTH"),(0,n.w)(F,l,this._maxSimultaneousLights),F.SPECULARTERM&&l.addFallback(0,"SPECULARTERM"),F.DIFFUSEFRESNEL&&l.addFallback(1,"DIFFUSEFRESNEL"),F.OPACITYFRESNEL&&l.addFallback(2,"OPACITYFRESNEL"),F.REFLECTIONFRESNEL&&l.addFallback(3,"REFLECTIONFRESNEL"),F.EMISSIVEFRESNEL&&l.addFallback(4,"EMISSIVEFRESNEL"),F.FRESNEL&&l.addFallback(4,"FRESNEL"),F.MULTIVIEW&&l.addFallback(0,"MULTIVIEW");const Y=[j.e.PositionKind];F.NORMAL&&Y.push(j.e.NormalKind),F.TANGENT&&Y.push(j.e.TangentKind);for(let V=1;V<=6;++V)F["UV"+V]&&Y.push(`uv${1===V?"":V}`);F.VERTEXCOLOR&&Y.push(j.e.ColorKind),(0,n.C)(Y,V,F,l),(0,n.F)(Y,F),(0,n.G)(Y,V,F),(0,n.y)(Y,V,F);let O="default";const v=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],N=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],t=["Material","Scene","Mesh"],b={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:F.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=l,this._eventInfo.fallbackRank=0,this._eventInfo.defines=F,this._eventInfo.uniforms=v,this._eventInfo.attributes=Y,this._eventInfo.samplers=N,this._eventInfo.uniformBuffersNames=t,this._eventInfo.customCode=void 0,this._eventInfo.mesh=V,this._eventInfo.indexParameters=b,this._callbackPluginEventGeneric(128,this._eventInfo),S.b.AddUniformsAndSamplers(v,N),E.c.AddUniforms(v),E.c.AddSamplers(N),K.e&&(K.e.PrepareUniforms(v,F),K.e.PrepareSamplers(N,F)),(0,n._)({uniformsNames:v,uniformBuffersNames:t,samplers:N,defines:F,maxSimultaneousLights:this._maxSimultaneousLights}),(0,T.b)(v);const x={};this.customShaderNameResolve&&(O=this.customShaderNameResolve(O,v,t,N,F,Y,x));const H=F.toString(),y=I.effect;let z=s.getEngine().createEffect(O,{attributes:Y,uniformsNames:v,uniformBuffersNames:t,samplers:N,defines:H,fallbacks:l,onCompiled:this.onCompiled,onError:this.onError,indexParameters:b,processFinalCode:x.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:F.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([m.e(20),m.e(51)]).then(m.bind(m,14286)),Promise.all([m.e(18),m.e(52)]).then(m.bind(m,14299))]):await Promise.all([Promise.all([m.e(13),m.e(53)]).then(m.bind(m,14303)),Promise.all([m.e(12),m.e(54)]).then(m.bind(m,14316))]),this._shadersLoaded=!0}},k);if(this._eventInfo.customCode=void 0,z)if(this._onEffectCreatedObservable&&(c.effect=z,c.subMesh=I,this._onEffectCreatedObservable.notifyObservers(c)),this.allowShaderHotSwapping&&y&&!z.isReady()){if(z=y,F.markAsUnprocessed(),X=this.isFrozen,C)return F._areLightsDisposed=!0,!1}else s.resetCachedMaterial(),I.setEffect(z,F,this._materialContext)}return!(!I.effect||!I.effect.isReady())&&(F._renderId=s.getRenderId(),l._wasPreviouslyReady=!X,l._wasPreviouslyUsingInstances=C,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const V=this._uniformBuffer;V.addUniform("diffuseLeftColor",4),V.addUniform("diffuseRightColor",4),V.addUniform("opacityParts",4),V.addUniform("reflectionLeftColor",4),V.addUniform("reflectionRightColor",4),V.addUniform("refractionLeftColor",4),V.addUniform("refractionRightColor",4),V.addUniform("emissiveLeftColor",4),V.addUniform("emissiveRightColor",4),V.addUniform("vDiffuseInfos",2),V.addUniform("vAmbientInfos",2),V.addUniform("vOpacityInfos",2),V.addUniform("vReflectionInfos",2),V.addUniform("vReflectionPosition",3),V.addUniform("vReflectionSize",3),V.addUniform("vEmissiveInfos",2),V.addUniform("vLightmapInfos",2),V.addUniform("vSpecularInfos",2),V.addUniform("vBumpInfos",3),V.addUniform("diffuseMatrix",16),V.addUniform("ambientMatrix",16),V.addUniform("opacityMatrix",16),V.addUniform("reflectionMatrix",16),V.addUniform("emissiveMatrix",16),V.addUniform("lightmapMatrix",16),V.addUniform("specularMatrix",16),V.addUniform("bumpMatrix",16),V.addUniform("vTangentSpaceParams",2),V.addUniform("pointSize",1),V.addUniform("alphaCutOff",1),V.addUniform("refractionMatrix",16),V.addUniform("vRefractionInfos",4),V.addUniform("vRefractionPosition",3),V.addUniform("vRefractionSize",3),V.addUniform("vSpecularColor",4),V.addUniform("vEmissiveColor",3),V.addUniform("vDiffuseColor",4),V.addUniform("vAmbientColor",3),V.addUniform("cameraInfo",4),super.buildUniformLayout()}bindForSubMesh(V,I,m){const C=this.cV(),l=m.materialDefines;if(!l)return;const s=m.effect;if(!s)return;this._activeEffect=s,I.getMeshUniformBuffer().bindToEffect(s,"Mesh"),I.transferToEffect(V),this._uniformBuffer.bindToEffect(s,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,C,I,V,this.isFrozen),S.b.Bind(C.getEngine().currentRenderPassId,this._activeEffect,I,V,this);const j=C.activeCamera;j?this._uniformBuffer.updateFloat4("cameraInfo",j.Fk,j.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=m,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),l.OBJECTSPACE_NORMALMAP&&(V.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const E=this._mustRebind(C,s,m,I.visibility);(0,n.b)(I,s);const K=this._uniformBuffer;if(E){if(this.bindViewProjection(s),!K.useUbo||!this.isFrozen||!K.isSync||m._drawWrapper._forceRebindOnNextCall){if(y.FresnelEnabled&&l.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(K.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),K.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&K.updateColor4("opacityParts",new k.c(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(K.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),K.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(K.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),K.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(K.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),K.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),C.texturesEnabled){if(this._diffuseTexture&&y.DiffuseTextureEnabled&&(K.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,n.u)(this._diffuseTexture,K,"diffuse")),this._ambientTexture&&y.AmbientTextureEnabled&&(K.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,n.u)(this._ambientTexture,K,"ambient")),this._opacityTexture&&y.OpacityTextureEnabled&&(K.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,n.u)(this._opacityTexture,K,"opacity")),this._hasAlphaChannel()&&K.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&y.ReflectionTextureEnabled){if(K.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),K.lk("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize){const V=this._reflectionTexture;K.updateVector3("vReflectionPosition",V.boundingBoxPosition),K.updateVector3("vReflectionSize",V.boundingBoxSize)}}else K.updateFloat2("vReflectionInfos",0,this.roughness);if(this._emissiveTexture&&y.EmissiveTextureEnabled&&(K.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,n.u)(this._emissiveTexture,K,"emissive")),this._lightmapTexture&&y.LightmapTextureEnabled&&(K.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,n.u)(this._lightmapTexture,K,"lightmap")),this._specularTexture&&y.SpecularTextureEnabled&&(K.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,n.u)(this._specularTexture,K,"specular")),this._bumpTexture&&C.getEngine().getCaps().standardDerivatives&&y.BumpTextureEnabled&&(K.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,n.u)(this._bumpTexture,K,"bump"),C._mirroredCameraPosition?K.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):K.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&y.RefractionTextureEnabled){let V=1;if(this._refractionTexture.isCube||(K.lk("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(V=this._refractionTexture.depth)),K.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,V,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const V=this._refractionTexture;K.updateVector3("vRefractionPosition",V.boundingBoxPosition),K.updateVector3("vRefractionSize",V.boundingBoxSize)}}}this.pointsCloud&&K.updateFloat("pointSize",this.pointSize),K.updateColor4("vSpecularColor",this.specularColor,this.specularPower),K.updateColor3("vEmissiveColor",y.EmissiveTextureEnabled?this.emissiveColor:k.c.BlackReadOnly),K.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),C.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),K.updateColor3("vAmbientColor",this._globalAmbientColor)}C.texturesEnabled&&(this._diffuseTexture&&y.DiffuseTextureEnabled&&s.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&y.AmbientTextureEnabled&&s.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&y.OpacityTextureEnabled&&s.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&y.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?s.setTexture("reflectionCubeSampler",this._reflectionTexture):s.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&y.EmissiveTextureEnabled&&s.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&y.LightmapTextureEnabled&&s.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&y.SpecularTextureEnabled&&s.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&C.getEngine().getCaps().standardDerivatives&&y.BumpTextureEnabled&&s.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&y.RefractionTextureEnabled&&(this._refractionTexture.isCube?s.setTexture("refractionCubeSampler",this._refractionTexture):s.setTexture("refraction2DSampler",this._refractionTexture))),this.cV().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(I)&&this.cV().depthPeelingRenderer.bind(s),this._eventInfo.subMesh=m,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,T.d)(s,this,C),this.bindEyePosition(s)}else C.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(E||!this.isFrozen){var Y;if(C.lightsEnabled&&!this._disableLighting&&(0,n.j)(C,I,s,l,this._maxSimultaneousLights),(C.fogEnabled&&I.applyFog&&C.fogMode!==F.e.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||I.receiveShadows||l.PREPASS)&&this.bindView(s),(0,n.f)(C,I,s),l.NUM_MORPH_INFLUENCERS&&(0,n.r)(I,s),l.BAKED_VERTEX_ANIMATION_TEXTURE)null===(Y=I.bakedVertexAnimationManager)||void 0===Y||Y.bind(s,l.INSTANCES);this.useLogarithmicDepth&&(0,n.n)(l,s,C),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)}this._afterBind(I,this._activeEffect,m),K.update()}getAnimatables(){const V=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&V.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&V.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&V.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&V.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&V.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&V.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&V.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&V.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&V.push(this._refractionTexture),V}getActiveTextures(){const V=super.getActiveTextures();return this._diffuseTexture&&V.push(this._diffuseTexture),this._ambientTexture&&V.push(this._ambientTexture),this._opacityTexture&&V.push(this._opacityTexture),this._reflectionTexture&&V.push(this._reflectionTexture),this._emissiveTexture&&V.push(this._emissiveTexture),this._specularTexture&&V.push(this._specularTexture),this._bumpTexture&&V.push(this._bumpTexture),this._lightmapTexture&&V.push(this._lightmapTexture),this._refractionTexture&&V.push(this._refractionTexture),V}hasTexture(V){return!!super.hasTexture(V)||(this._diffuseTexture===V||(this._ambientTexture===V||(this._opacityTexture===V||(this._reflectionTexture===V||(this._emissiveTexture===V||(this._specularTexture===V||(this._bumpTexture===V||(this._lightmapTexture===V||this._refractionTexture===V))))))))}dispose(V,I){var m,C,l,s,F,k,j,E,K;I&&(null===(m=this._diffuseTexture)||void 0===m||m.dispose(),null===(C=this._ambientTexture)||void 0===C||C.dispose(),null===(l=this._opacityTexture)||void 0===l||l.dispose(),null===(s=this._reflectionTexture)||void 0===s||s.dispose(),null===(F=this._emissiveTexture)||void 0===F||F.dispose(),null===(k=this._specularTexture)||void 0===k||k.dispose(),null===(j=this._bumpTexture)||void 0===j||j.dispose(),null===(E=this._lightmapTexture)||void 0===E||E.dispose(),null===(K=this._refractionTexture)||void 0===K||K.dispose());this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(V,I)}clone(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const C=x.d.Clone((()=>new y(V,this.cV())),this,{cloneTexturesOnlyOnce:I});return C.name=V,C.id=V,this.stencil.copyTo(C.stencil),this._clonePlugins(C,m),C}static Parse(V,I,m){const C=x.d.Parse((()=>new y(V.name,I)),V,I,m);return V.stencil&&C.stencil.parse(V.stencil,I,m),Y.d._ParsePlugins(V,C,I,m),C}static get DiffuseTextureEnabled(){return t.d.DiffuseTextureEnabled}static set DiffuseTextureEnabled(V){t.d.DiffuseTextureEnabled=V}static get DetailTextureEnabled(){return t.d.DetailTextureEnabled}static set DetailTextureEnabled(V){t.d.DetailTextureEnabled=V}static get AmbientTextureEnabled(){return t.d.AmbientTextureEnabled}static set AmbientTextureEnabled(V){t.d.AmbientTextureEnabled=V}static get OpacityTextureEnabled(){return t.d.OpacityTextureEnabled}static set OpacityTextureEnabled(V){t.d.OpacityTextureEnabled=V}static get ReflectionTextureEnabled(){return t.d.ReflectionTextureEnabled}static set ReflectionTextureEnabled(V){t.d.ReflectionTextureEnabled=V}static get EmissiveTextureEnabled(){return t.d.EmissiveTextureEnabled}static set EmissiveTextureEnabled(V){t.d.EmissiveTextureEnabled=V}static get SpecularTextureEnabled(){return t.d.SpecularTextureEnabled}static set SpecularTextureEnabled(V){t.d.SpecularTextureEnabled=V}static get BumpTextureEnabled(){return t.d.BumpTextureEnabled}static set BumpTextureEnabled(V){t.d.BumpTextureEnabled=V}static get LightmapTextureEnabled(){return t.d.LightmapTextureEnabled}static set LightmapTextureEnabled(V){t.d.LightmapTextureEnabled=V}static get RefractionTextureEnabled(){return t.d.RefractionTextureEnabled}static set RefractionTextureEnabled(V){t.d.RefractionTextureEnabled=V}static get ColorGradingTextureEnabled(){return t.d.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(V){t.d.ColorGradingTextureEnabled=V}static get FresnelEnabled(){return t.d.FresnelEnabled}static set FresnelEnabled(V){t.d.FresnelEnabled=V}}y.ForceGLSL=!1,(0,C.d)([(0,l.s)("diffuseTexture")],y.prototype,"_diffuseTexture",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],y.prototype,"diffuseTexture",void 0),(0,C.d)([(0,l.s)("ambientTexture")],y.prototype,"_ambientTexture",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"ambientTexture",void 0),(0,C.d)([(0,l.s)("opacityTexture")],y.prototype,"_opacityTexture",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],y.prototype,"opacityTexture",void 0),(0,C.d)([(0,l.s)("reflectionTexture")],y.prototype,"_reflectionTexture",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"reflectionTexture",void 0),(0,C.d)([(0,l.s)("emissiveTexture")],y.prototype,"_emissiveTexture",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"emissiveTexture",void 0),(0,C.d)([(0,l.s)("specularTexture")],y.prototype,"_specularTexture",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"specularTexture",void 0),(0,C.d)([(0,l.s)("bumpTexture")],y.prototype,"_bumpTexture",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"bumpTexture",void 0),(0,C.d)([(0,l.s)("lightmapTexture")],y.prototype,"_lightmapTexture",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"lightmapTexture",void 0),(0,C.d)([(0,l.s)("refractionTexture")],y.prototype,"_refractionTexture",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"refractionTexture",void 0),(0,C.d)([(0,l.e)("ambient")],y.prototype,"ambientColor",void 0),(0,C.d)([(0,l.e)("diffuse")],y.prototype,"diffuseColor",void 0),(0,C.d)([(0,l.e)("specular")],y.prototype,"specularColor",void 0),(0,C.d)([(0,l.e)("emissive")],y.prototype,"emissiveColor",void 0),(0,C.d)([(0,l.B)()],y.prototype,"specularPower",void 0),(0,C.d)([(0,l.B)("useAlphaFromDiffuseTexture")],y.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],y.prototype,"useAlphaFromDiffuseTexture",void 0),(0,C.d)([(0,l.B)("useEmissiveAsIllumination")],y.prototype,"_useEmissiveAsIllumination",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useEmissiveAsIllumination",void 0),(0,C.d)([(0,l.B)("linkEmissiveWithDiffuse")],y.prototype,"_linkEmissiveWithDiffuse",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"linkEmissiveWithDiffuse",void 0),(0,C.d)([(0,l.B)("useSpecularOverAlpha")],y.prototype,"_useSpecularOverAlpha",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useSpecularOverAlpha",void 0),(0,C.d)([(0,l.B)("useReflectionOverAlpha")],y.prototype,"_useReflectionOverAlpha",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useReflectionOverAlpha",void 0),(0,C.d)([(0,l.B)("disableLighting")],y.prototype,"_disableLighting",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsLightsDirty")],y.prototype,"disableLighting",void 0),(0,C.d)([(0,l.B)("useObjectSpaceNormalMap")],y.prototype,"_useObjectSpaceNormalMap",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useObjectSpaceNormalMap",void 0),(0,C.d)([(0,l.B)("useParallax")],y.prototype,"_useParallax",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useParallax",void 0),(0,C.d)([(0,l.B)("useParallaxOcclusion")],y.prototype,"_useParallaxOcclusion",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useParallaxOcclusion",void 0),(0,C.d)([(0,l.B)()],y.prototype,"parallaxScaleBias",void 0),(0,C.d)([(0,l.B)("roughness")],y.prototype,"_roughness",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"roughness",void 0),(0,C.d)([(0,l.B)()],y.prototype,"indexOfRefraction",void 0),(0,C.d)([(0,l.B)()],y.prototype,"invertRefractionY",void 0),(0,C.d)([(0,l.B)()],y.prototype,"alphaCutOff",void 0),(0,C.d)([(0,l.B)("useLightmapAsShadowmap")],y.prototype,"_useLightmapAsShadowmap",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useLightmapAsShadowmap",void 0),(0,C.d)([(0,l.g)("diffuseFresnelParameters")],y.prototype,"_diffuseFresnelParameters",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsFresnelDirty")],y.prototype,"diffuseFresnelParameters",void 0),(0,C.d)([(0,l.g)("opacityFresnelParameters")],y.prototype,"_opacityFresnelParameters",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsFresnelAndMiscDirty")],y.prototype,"opacityFresnelParameters",void 0),(0,C.d)([(0,l.g)("reflectionFresnelParameters")],y.prototype,"_reflectionFresnelParameters",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsFresnelDirty")],y.prototype,"reflectionFresnelParameters",void 0),(0,C.d)([(0,l.g)("refractionFresnelParameters")],y.prototype,"_refractionFresnelParameters",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsFresnelDirty")],y.prototype,"refractionFresnelParameters",void 0),(0,C.d)([(0,l.g)("emissiveFresnelParameters")],y.prototype,"_emissiveFresnelParameters",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsFresnelDirty")],y.prototype,"emissiveFresnelParameters",void 0),(0,C.d)([(0,l.B)("useReflectionFresnelFromSpecular")],y.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsFresnelDirty")],y.prototype,"useReflectionFresnelFromSpecular",void 0),(0,C.d)([(0,l.B)("useGlossinessFromSpecularMapAlpha")],y.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,C.d)([(0,l.B)("maxSimultaneousLights")],y.prototype,"_maxSimultaneousLights",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsLightsDirty")],y.prototype,"maxSimultaneousLights",void 0),(0,C.d)([(0,l.B)("invertNormalMapX")],y.prototype,"_invertNormalMapX",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"invertNormalMapX",void 0),(0,C.d)([(0,l.B)("invertNormalMapY")],y.prototype,"_invertNormalMapY",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"invertNormalMapY",void 0),(0,C.d)([(0,l.B)("twoSidedLighting")],y.prototype,"_twoSidedLighting",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"twoSidedLighting",void 0),(0,C.d)([(0,l.B)("applyDecalMapAfterDetailMap")],y.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,C.d)([(0,l.b)("_markAllSubMeshesAsMiscDirty")],y.prototype,"applyDecalMapAfterDetailMap",void 0),(0,N.h)("BABYLON.StandardMaterial",y),F.e.DefaultMaterialFactory=V=>new y("default material",V)},11283:(V,I,m)=>{m.d(I,{e:()=>s});var C=m(11085),l=m(11076);class s{constructor(V,I,m,C){let l=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._valueCache={},this._engine=V,this._noUBO=!V.supportsUniformBuffers||l,this._dynamic=m,this._name=C??"no-name",this._data=I||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.lk=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.lk=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get useUbo(){return!this._noUBO}get isSync(){return!this._needSync}isDynamic(){return void 0!==this._dynamic}getData(){return this._bufferData}getBuffer(){return this._buffer}_fillAlignment(V){let I;if(I=V<=2?V:4,this._uniformLocationPointer%I!==0){const V=this._uniformLocationPointer;this._uniformLocationPointer+=I-this._uniformLocationPointer%I;const m=this._uniformLocationPointer-V;for(let I=0;I<m;I++)this._data.push(0)}}addUniform(V,I){let m,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this._noUBO&&void 0===this._uniformLocations[V]){if(C>0){if(I instanceof Array)throw"addUniform should not be use with Array in UBO: "+V;if(this._fillAlignment(4),this._uniformArraySizes[V]={strideSize:I,arraySize:C},16==I)I*=C;else{I=I*C+(4-I)*C}m=[];for(let V=0;V<I;V++)m.push(0)}else{if(I instanceof Array)m=I,I=m.length;else{m=[];for(let V=0;V<I;V++)m.push(0)}this._fillAlignment(I)}this._uniformSizes[V]=I,this._uniformLocations[V]=this._uniformLocationPointer,this._uniformLocationPointer+=I;for(let V=0;V<I;V++)this._data.push(m[V]);this._needSync=!0}}addMatrix(V,I){this.addUniform(V,Array.prototype.slice.call(I.UF()))}addFloat2(V,I,m){const C=[I,m];this.addUniform(V,C)}addFloat3(V,I,m,C){const l=[I,m,C];this.addUniform(V,l)}addColor3(V,I){const m=[I.r,I.g,I.b];this.addUniform(V,m)}addColor4(V,I,m){const C=[I.r,I.g,I.b,m];this.addUniform(V,C)}addVector3(V,I){const m=[I.x,I.y,I.z];this.addUniform(V,m)}addMatrix3x3(V){this.addUniform(V,12)}addMatrix2x2(V){this.addUniform(V,8)}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}_getNames(){const V=[];let I=0;for(const m in this._uniformLocations)if(V.push(m),10===++I)break;return V.join(",")}_rebuild(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}get _numBuffers(){return this._buffers.length}get _indexBuffer(){return this._bufferIndex}get name(){return this._name}get currentEffect(){return this._currentEffect}_buffersEqual(V,I){for(let m=0;m<V.length;++m)if(V[m]!==I[m])return!1;return!0}_copyBuffer(V,I){for(let m=0;m<V.length;++m)I[m]=V[m]}update(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(s._UpdatedUbosInFrame[this._name]||(s._UpdatedUbosInFrame[this._name]=0),s._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}updateUniform(V,I,m){this._checkNewFrame();let l=this._uniformLocations[V];if(void 0===l){if(this._buffer)return void C.d.Error("Cannot add an uniform after UBO has been created. uniformName="+V);this.addUniform(V,m),l=this._uniformLocations[V]}if(this._buffer||this.create(),this._dynamic)for(let C=0;C<m;C++)this._bufferData[l+C]=I[C];else{let V=!1;for(let C=0;C<m;C++)(16===m&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[l+C]!==Math.fround(I[C]))&&(V=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[l+C]=I[C]);this._needSync=this._needSync||V}}updateUniformArray(V,I,m){this._checkNewFrame();const s=this._uniformLocations[V];if(void 0===s)return void C.d.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");this._buffer||this.create();const F=this._uniformArraySizes[V];if(this._dynamic)for(let C=0;C<m;C++)this._bufferData[s+C]=I[C];else{let V=!1,C=0,k=0;for(let j=0;j<m;j++)if(this._bufferData[s+4*k+C]!==l.d.FloatRound(I[j])&&(V=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[s+4*k+C]=I[j]),C++,C===F.strideSize){for(;C<4;C++)this._bufferData[s+4*k+C]=0;C=0,k++}this._needSync=this._needSync||V}}_cacheMatrix(V,I){this._checkNewFrame();const m=this._valueCache[V],C=I.updateFlag;return(void 0===m||m!==C)&&(this._valueCache[V]=C,!0)}_updateMatrix3x3ForUniform(V,I){for(let m=0;m<3;m++)s._TempBuffer[4*m]=I[3*m],s._TempBuffer[4*m+1]=I[3*m+1],s._TempBuffer[4*m+2]=I[3*m+2],s._TempBuffer[4*m+3]=0;this.updateUniform(V,s._TempBuffer,12)}_updateMatrix3x3ForEffect(V,I){this._currentEffect.setMatrix3x3(V,I)}_updateMatrix2x2ForEffect(V,I){this._currentEffect.setMatrix2x2(V,I)}_updateMatrix2x2ForUniform(V,I){for(let m=0;m<2;m++)s._TempBuffer[4*m]=I[2*m],s._TempBuffer[4*m+1]=I[2*m+1],s._TempBuffer[4*m+2]=0,s._TempBuffer[4*m+3]=0;this.updateUniform(V,s._TempBuffer,8)}_updateFloatForEffect(V,I){this._currentEffect.setFloat(V,I)}_updateFloatForUniform(V,I){s._TempBuffer[0]=I,this.updateUniform(V,s._TempBuffer,1)}_updateFloat2ForEffect(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setFloat2(V+C,I,m)}_updateFloat2ForUniform(V,I,m){s._TempBuffer[0]=I,s._TempBuffer[1]=m,this.updateUniform(V,s._TempBuffer,2)}_updateFloat3ForEffect(V,I,m,C){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setFloat3(V+l,I,m,C)}_updateFloat3ForUniform(V,I,m,C){s._TempBuffer[0]=I,s._TempBuffer[1]=m,s._TempBuffer[2]=C,this.updateUniform(V,s._TempBuffer,3)}_updateFloat4ForEffect(V,I,m,C,l){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setFloat4(V+s,I,m,C,l)}_updateFloat4ForUniform(V,I,m,C,l){s._TempBuffer[0]=I,s._TempBuffer[1]=m,s._TempBuffer[2]=C,s._TempBuffer[3]=l,this.updateUniform(V,s._TempBuffer,4)}_updateFloatArrayForEffect(V,I){this._currentEffect.setFloatArray(V,I)}_updateFloatArrayForUniform(V,I){this.updateUniformArray(V,I,I.length)}_updateArrayForEffect(V,I){this._currentEffect.setArray(V,I)}_updateArrayForUniform(V,I){this.updateUniformArray(V,I,I.length)}_updateIntArrayForEffect(V,I){this._currentEffect.setIntArray(V,I)}_updateIntArrayForUniform(V,I){s._TempBufferInt32View.set(I),this.updateUniformArray(V,s._TempBuffer,I.length)}_updateUIntArrayForEffect(V,I){this._currentEffect.setUIntArray(V,I)}_updateUIntArrayForUniform(V,I){s._TempBufferUInt32View.set(I),this.updateUniformArray(V,s._TempBuffer,I.length)}_updateMatrixForEffect(V,I){this._currentEffect.setMatrix(V,I)}_updateMatrixForUniform(V,I){this._cacheMatrix(V,I)&&this.updateUniform(V,I.UF(),16)}_updateMatricesForEffect(V,I){this._currentEffect.setMatrices(V,I)}_updateMatricesForUniform(V,I){this.updateUniform(V,I,I.length)}_updateVector3ForEffect(V,I){this._currentEffect.setVector3(V,I)}_updateVector3ForUniform(V,I){s._TempBuffer[0]=I.x,s._TempBuffer[1]=I.y,s._TempBuffer[2]=I.z,this.updateUniform(V,s._TempBuffer,3)}_updateVector4ForEffect(V,I){this._currentEffect.setVector4(V,I)}_updateVector4ForUniform(V,I){s._TempBuffer[0]=I.x,s._TempBuffer[1]=I.y,s._TempBuffer[2]=I.z,s._TempBuffer[3]=I.w,this.updateUniform(V,s._TempBuffer,4)}_updateColor3ForEffect(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setColor3(V+m,I)}_updateColor3ForUniform(V,I){s._TempBuffer[0]=I.r,s._TempBuffer[1]=I.g,s._TempBuffer[2]=I.b,this.updateUniform(V,s._TempBuffer,3)}_updateColor4ForEffect(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setColor4(V+C,I,m)}_updateDirectColor4ForEffect(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setDirectColor4(V+m,I)}_updateColor4ForUniform(V,I,m){s._TempBuffer[0]=I.r,s._TempBuffer[1]=I.g,s._TempBuffer[2]=I.b,s._TempBuffer[3]=m,this.updateUniform(V,s._TempBuffer,4)}_updateDirectColor4ForUniform(V,I){s._TempBuffer[0]=I.r,s._TempBuffer[1]=I.g,s._TempBuffer[2]=I.b,s._TempBuffer[3]=I.a,this.updateUniform(V,s._TempBuffer,4)}_updateIntForEffect(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setInt(V+m,I)}_updateIntForUniform(V,I){s._TempBufferInt32View[0]=I,this.updateUniform(V,s._TempBuffer,1)}_updateInt2ForEffect(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setInt2(V+C,I,m)}_updateInt2ForUniform(V,I,m){s._TempBufferInt32View[0]=I,s._TempBufferInt32View[1]=m,this.updateUniform(V,s._TempBuffer,2)}_updateInt3ForEffect(V,I,m,C){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setInt3(V+l,I,m,C)}_updateInt3ForUniform(V,I,m,C){s._TempBufferInt32View[0]=I,s._TempBufferInt32View[1]=m,s._TempBufferInt32View[2]=C,this.updateUniform(V,s._TempBuffer,3)}_updateInt4ForEffect(V,I,m,C,l){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setInt4(V+s,I,m,C,l)}_updateInt4ForUniform(V,I,m,C,l){s._TempBufferInt32View[0]=I,s._TempBufferInt32View[1]=m,s._TempBufferInt32View[2]=C,s._TempBufferInt32View[3]=l,this.updateUniform(V,s._TempBuffer,4)}_updateUIntForEffect(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setUInt(V+m,I)}_updateUIntForUniform(V,I){s._TempBufferUInt32View[0]=I,this.updateUniform(V,s._TempBuffer,1)}_updateUInt2ForEffect(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setUInt2(V+C,I,m)}_updateUInt2ForUniform(V,I,m){s._TempBufferUInt32View[0]=I,s._TempBufferUInt32View[1]=m,this.updateUniform(V,s._TempBuffer,2)}_updateUInt3ForEffect(V,I,m,C){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setUInt3(V+l,I,m,C)}_updateUInt3ForUniform(V,I,m,C){s._TempBufferUInt32View[0]=I,s._TempBufferUInt32View[1]=m,s._TempBufferUInt32View[2]=C,this.updateUniform(V,s._TempBuffer,3)}_updateUInt4ForEffect(V,I,m,C,l){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setUInt4(V+s,I,m,C,l)}_updateUInt4ForUniform(V,I,m,C,l){s._TempBufferUInt32View[0]=I,s._TempBufferUInt32View[1]=m,s._TempBufferUInt32View[2]=C,s._TempBufferUInt32View[3]=l,this.updateUniform(V,s._TempBuffer,4)}setTexture(V,I){this._currentEffect.setTexture(V,I)}setTextureArray(V,I){this._currentEffect.setTextureArray(V,I)}bindTexture(V,I){this._currentEffect._bindTexture(V,I)}updateUniformDirectly(V,I){this.updateUniform(V,I,I.length),this.update()}bindToEffect(V,I){this._currentEffect=V,this._currentEffectName=I}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}setDataBuffer(V){if(!this._buffers)return this._buffer===V;for(let I=0;I<this._buffers.length;++I){if(this._buffers[I][0]===V)return this._bufferIndex=I,this._buffer=V,this._createBufferOnWrite=!1,this._currentEffect=void 0,this._buffers.length>1&&this._buffers[I][1]&&this._bufferData.set(this._buffers[I][1]),this._valueCache={},this._currentFrameId=this._engine.frameId,!0}return!1}dispose(){if(this._noUBO)return;const V=this._engine._uniformBuffers,I=V.indexOf(this);if(-1!==I&&(V[I]=V[V.length-1],V.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let m=0;m<this._buffers.length;++m){const V=this._buffers[m][0];this._engine._releaseBuffer(V)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}s._UpdatedUbosInFrame={},s._MAX_UNIFORM_SIZE=256,s._TempBuffer=new Float32Array(s._MAX_UNIFORM_SIZE),s._TempBufferInt32View=new Int32Array(s._TempBuffer.buffer),s._TempBufferUInt32View=new Uint32Array(s._TempBuffer.buffer)},11372:(V,I,m)=>{m.d(I,{c:()=>F,g:()=>C});var C,l,s=m(11040);!function(V){V[V.LOCAL=0]="LOCAL",V[V.WORLD=1]="WORLD",V[V.BONE=2]="BONE"}(C||(C={}));class F{}F.X=new s.m(1,0,0),F.Y=new s.m(0,1,0),F.Z=new s.m(0,0,1),function(V){V[V.X=0]="X",V[V.Y=1]="Y",V[V.Z=2]="Z"}(l||(l={}))},11312:(V,I,m)=>{m.d(I,{c:()=>Y,d:()=>X,f:()=>O});var C=m(11046),l=m(11048),s=m(11044),F=m(11074);function k(V){return Math.pow(V,s.m)}function j(V){return V<=.04045?.0773993808*V:Math.pow(.947867299*(V+.055),2.4)}function E(V){return Math.pow(V,s.k)}function K(V){return V<=.0031308?12.92*V:1.055*Math.pow(V,.41666)-.055}class Y{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.r=V,this.g=I,this.b=m}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"dY"}getHashCode(){let V=255*this.r|0;return V=397*V^255*this.g,V=397*V^255*this.b,V}toArray(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return V[I]=this.r,V[I+1]=this.g,V[I+2]=this.b,this}km(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Y.FromArrayToRef(V,I,this),this}toColor4(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new X(this.r,this.g,this.b,V)}UF(){return[this.r,this.g,this.b]}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(V){return new Y(this.r*V.r,this.g*V.g,this.b*V.b)}multiplyToRef(V,I){return I.r=this.r*V.r,I.g=this.g*V.g,I.b=this.b*V.b,I}multiplyInPlace(V){return this.r*=V.r,this.g*=V.g,this.b*=V.b,this}multiplyByFloats(V,I,m){return new Y(this.r*V,this.g*I,this.b*m)}divide(V){throw new ReferenceError("Can not divide a color")}divideToRef(V,I){throw new ReferenceError("Can not divide a color")}divideInPlace(V){throw new ReferenceError("Can not divide a color")}minimizeInPlace(V){return this.minimizeInPlaceFromFloats(V.r,V.g,V.b)}maximizeInPlace(V){return this.maximizeInPlaceFromFloats(V.r,V.g,V.b)}minimizeInPlaceFromFloats(V,I,m){return this.r=Math.min(V,this.r),this.g=Math.min(I,this.g),this.b=Math.min(m,this.b),this}maximizeInPlaceFromFloats(V,I,m){return this.r=Math.max(V,this.r),this.g=Math.max(I,this.g),this.b=Math.max(m,this.b),this}floorToRef(V){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(V){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}equals(V){return V&&this.r===V.r&&this.g===V.g&&this.b===V.b}equalsFloats(V,I,m){return this.equalsToFloats(V,I,m)}equalsToFloats(V,I,m){return this.r===V&&this.g===I&&this.b===m}equalsWithEpsilon(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.c;return(0,F.WithinEpsilon)(this.r,V.r,I)&&(0,F.WithinEpsilon)(this.g,V.g,I)&&(0,F.WithinEpsilon)(this.b,V.b,I)}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(V){throw new ReferenceError("Can not negate a color")}scale(V){return new Y(this.r*V,this.g*V,this.b*V)}scaleInPlace(V){return this.r*=V,this.g*=V,this.b*=V,this}scaleToRef(V,I){return I.r=this.r*V,I.g=this.g*V,I.b=this.b*V,I}scaleAndAddToRef(V,I){return I.r+=this.r*V,I.g+=this.g*V,I.b+=this.b*V,I}clampToRef(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m=arguments.length>2?arguments[2]:void 0;return m.r=(0,F.Clamp)(this.r,V,I),m.g=(0,F.Clamp)(this.g,V,I),m.b=(0,F.Clamp)(this.b,V,I),m}add(V){return new Y(this.r+V.r,this.g+V.g,this.b+V.b)}addInPlace(V){return this.r+=V.r,this.g+=V.g,this.b+=V.b,this}addInPlaceFromFloats(V,I,m){return this.r+=V,this.g+=I,this.b+=m,this}addToRef(V,I){return I.r=this.r+V.r,I.g=this.g+V.g,I.b=this.b+V.b,I}Fm(V){return new Y(this.r-V.r,this.g-V.g,this.b-V.b)}subtractToRef(V,I){return I.r=this.r-V.r,I.g=this.g-V.g,I.b=this.b-V.b,I}WK(V){return this.r-=V.r,this.g-=V.g,this.b-=V.b,this}subtractFromFloats(V,I,m){return new Y(this.r-V,this.g-I,this.b-m)}subtractFromFloatsToRef(V,I,m,C){return C.r=this.r-V,C.g=this.g-I,C.b=this.b-m,C}clone(){return new Y(this.r,this.g,this.b)}C(V){return this.r=V.r,this.g=V.g,this.b=V.b,this}aF(V,I,m){return this.r=V,this.g=I,this.b=m,this}set(V,I,m){return this.aF(V,I,m)}mk(V){return this.r=this.g=this.b=V,this}toHexString(){const V=Math.round(255*this.r),I=Math.round(255*this.g),m=Math.round(255*this.b);return"#"+(0,F.ToHex)(V)+(0,F.ToHex)(I)+(0,F.ToHex)(m)}fromHexString(V){return"#"!==V.substring(0,1)||7!==V.length||(this.r=parseInt(V.substring(1,3),16)/255,this.g=parseInt(V.substring(3,5),16)/255,this.b=parseInt(V.substring(5,7),16)/255),this}toHSV(){return this.toHSVToRef(new Y)}toHSVToRef(V){const I=this.r,m=this.g,C=this.b,l=Math.max(I,m,C),s=Math.min(I,m,C);let F=0,k=0;const j=l,E=l-s;return 0!==l&&(k=E/l),l!=s&&(l==I?(F=(m-C)/E,m<C&&(F+=6)):l==m?F=(C-I)/E+2:l==C&&(F=(I-m)/E+4),F*=60),V.r=F,V.g=k,V.b=j,V}toLinearSpace(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const I=new Y;return this.toLinearSpaceToRef(I,V),I}toLinearSpaceToRef(V){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(V.r=j(this.r),V.g=j(this.g),V.b=j(this.b)):(V.r=k(this.r),V.g=k(this.g),V.b=k(this.b)),this}toGammaSpace(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const I=new Y;return this.toGammaSpaceToRef(I,V),I}toGammaSpaceToRef(V){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(V.r=K(this.r),V.g=K(this.g),V.b=K(this.b)):(V.r=E(this.r),V.g=E(this.g),V.b=E(this.b)),this}static HSVtoRGBToRef(V,I,m,C){const l=m*I,s=V/60,F=l*(1-Math.abs(s%2-1));let k=0,j=0,E=0;s>=0&&s<=1?(k=l,j=F):s>=1&&s<=2?(k=F,j=l):s>=2&&s<=3?(j=l,E=F):s>=3&&s<=4?(j=F,E=l):s>=4&&s<=5?(k=F,E=l):s>=5&&s<=6&&(k=l,E=F);const K=m-l;return C.r=k+K,C.g=j+K,C.b=E+K,C}static FromHSV(V,I,m){const C=new Y(0,0,0);return Y.HSVtoRGBToRef(V,I,m,C),C}static FromHexString(V){return new Y(0,0,0).fromHexString(V)}static Ik(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new Y(V[I],V[I+1],V[I+2])}static FromArrayToRef(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2?arguments[2]:void 0;m.r=V[I],m.g=V[I+1],m.b=V[I+2]}static FromInts(V,I,m){return new Y(V/255,I/255,m/255)}static Lerp(V,I,m){const C=new Y(0,0,0);return Y.LerpToRef(V,I,m,C),C}static LerpToRef(V,I,m,C){C.r=V.r+(I.r-V.r)*m,C.g=V.g+(I.g-V.g)*m,C.b=V.b+(I.b-V.b)*m}static Hermite(V,I,m,C,l){const s=l*l,F=l*s,k=2*F-3*s+1,j=-2*F+3*s,E=F-2*s+l,K=F-s,X=V.r*k+m.r*j+I.r*E+C.r*K,O=V.g*k+m.g*j+I.g*E+C.g*K,v=V.b*k+m.b*j+I.b*E+C.b*K;return new Y(X,O,v)}static Hermite1stDerivative(V,I,m,C,l){const s=Y.Black();return this.Hermite1stDerivativeToRef(V,I,m,C,l,s),s}static Hermite1stDerivativeToRef(V,I,m,C,l,s){const F=l*l;s.r=6*(F-l)*V.r+(3*F-4*l+1)*I.r+6*(-F+l)*m.r+(3*F-2*l)*C.r,s.g=6*(F-l)*V.g+(3*F-4*l+1)*I.g+6*(-F+l)*m.g+(3*F-2*l)*C.g,s.b=6*(F-l)*V.b+(3*F-4*l+1)*I.b+6*(-F+l)*m.b+(3*F-2*l)*C.b}static Red(){return new Y(1,0,0)}static Green(){return new Y(0,1,0)}static Blue(){return new Y(0,0,1)}static Black(){return new Y(0,0,0)}static get BlackReadOnly(){return Y._BlackReadOnly}static White(){return new Y(1,1,1)}static Purple(){return new Y(.5,0,.5)}static Magenta(){return new Y(1,0,1)}static Yellow(){return new Y(1,1,0)}static Gray(){return new Y(.5,.5,.5)}static Teal(){return new Y(0,1,1)}static Random(){return new Y(Math.random(),Math.random(),Math.random())}}Y._V8PerformanceHack=new Y(.5,.5,.5),Y._BlackReadOnly=Y.Black(),Object.defineProperties(Y.prototype,{dimension:{value:[3]},rank:{value:1}});class X{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=V,this.g=I,this.b=m,this.a=C}UF(){return[this.r,this.g,this.b,this.a]}toArray(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return V[I]=this.r,V[I+1]=this.g,V[I+2]=this.b,V[I+3]=this.a,this}km(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=V[I],this.g=V[I+1],this.b=V[I+2],this.a=V[I+3],this}equals(V){return V&&this.r===V.r&&this.g===V.g&&this.b===V.b&&this.a===V.a}add(V){return new X(this.r+V.r,this.g+V.g,this.b+V.b,this.a+V.a)}addToRef(V,I){return I.r=this.r+V.r,I.g=this.g+V.g,I.b=this.b+V.b,I.a=this.a+V.a,I}addInPlace(V){return this.r+=V.r,this.g+=V.g,this.b+=V.b,this.a+=V.a,this}addInPlaceFromFloats(V,I,m,C){return this.r+=V,this.g+=I,this.b+=m,this.a+=C,this}Fm(V){return new X(this.r-V.r,this.g-V.g,this.b-V.b,this.a-V.a)}subtractToRef(V,I){return I.r=this.r-V.r,I.g=this.g-V.g,I.b=this.b-V.b,I.a=this.a-V.a,I}WK(V){return this.r-=V.r,this.g-=V.g,this.b-=V.b,this.a-=V.a,this}subtractFromFloats(V,I,m,C){return new X(this.r-V,this.g-I,this.b-m,this.a-C)}subtractFromFloatsToRef(V,I,m,C,l){return l.r=this.r-V,l.g=this.g-I,l.b=this.b-m,l.a=this.a-C,l}scale(V){return new X(this.r*V,this.g*V,this.b*V,this.a*V)}scaleInPlace(V){return this.r*=V,this.g*=V,this.b*=V,this.a*=V,this}scaleToRef(V,I){return I.r=this.r*V,I.g=this.g*V,I.b=this.b*V,I.a=this.a*V,I}scaleAndAddToRef(V,I){return I.r+=this.r*V,I.g+=this.g*V,I.b+=this.b*V,I.a+=this.a*V,I}clampToRef(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m=arguments.length>2?arguments[2]:void 0;return m.r=(0,F.Clamp)(this.r,V,I),m.g=(0,F.Clamp)(this.g,V,I),m.b=(0,F.Clamp)(this.b,V,I),m.a=(0,F.Clamp)(this.a,V,I),m}multiply(V){return new X(this.r*V.r,this.g*V.g,this.b*V.b,this.a*V.a)}multiplyToRef(V,I){return I.r=this.r*V.r,I.g=this.g*V.g,I.b=this.b*V.b,I.a=this.a*V.a,I}multiplyInPlace(V){return this.r*=V.r,this.g*=V.g,this.b*=V.b,this.a*=V.a,this}multiplyByFloats(V,I,m,C){return new X(this.r*V,this.g*I,this.b*m,this.a*C)}divide(V){throw new ReferenceError("Can not divide a color")}divideToRef(V,I){throw new ReferenceError("Can not divide a color")}divideInPlace(V){throw new ReferenceError("Can not divide a color")}minimizeInPlace(V){return this.r=Math.min(this.r,V.r),this.g=Math.min(this.g,V.g),this.b=Math.min(this.b,V.b),this.a=Math.min(this.a,V.a),this}maximizeInPlace(V){return this.r=Math.max(this.r,V.r),this.g=Math.max(this.g,V.g),this.b=Math.max(this.b,V.b),this.a=Math.max(this.a,V.a),this}minimizeInPlaceFromFloats(V,I,m,C){return this.r=Math.min(V,this.r),this.g=Math.min(I,this.g),this.b=Math.min(m,this.b),this.a=Math.min(C,this.a),this}maximizeInPlaceFromFloats(V,I,m,C){return this.r=Math.max(V,this.r),this.g=Math.max(I,this.g),this.b=Math.max(m,this.b),this.a=Math.max(C,this.a),this}floorToRef(V){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(V){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(V){throw new ReferenceError("Can not negate a color")}equalsWithEpsilon(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.c;return(0,F.WithinEpsilon)(this.r,V.r,I)&&(0,F.WithinEpsilon)(this.g,V.g,I)&&(0,F.WithinEpsilon)(this.b,V.b,I)&&(0,F.WithinEpsilon)(this.a,V.a,I)}equalsToFloats(V,I,m,C){return this.r===V&&this.g===I&&this.b===m&&this.a===C}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"dX"}getHashCode(){let V=255*this.r|0;return V=397*V^255*this.g,V=397*V^255*this.b,V=397*V^255*this.a,V}clone(){return(new X).C(this)}C(V){return this.r=V.r,this.g=V.g,this.b=V.b,this.a=V.a,this}aF(V,I,m,C){return this.r=V,this.g=I,this.b=m,this.a=C,this}set(V,I,m,C){return this.aF(V,I,m,C)}mk(V){return this.r=this.g=this.b=this.a=V,this}toHexString(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const I=Math.round(255*this.r),m=Math.round(255*this.g),C=Math.round(255*this.b);if(V)return"#"+(0,F.ToHex)(I)+(0,F.ToHex)(m)+(0,F.ToHex)(C);const l=Math.round(255*this.a);return"#"+(0,F.ToHex)(I)+(0,F.ToHex)(m)+(0,F.ToHex)(C)+(0,F.ToHex)(l)}fromHexString(V){return"#"!==V.substring(0,1)||9!==V.length&&7!==V.length||(this.r=parseInt(V.substring(1,3),16)/255,this.g=parseInt(V.substring(3,5),16)/255,this.b=parseInt(V.substring(5,7),16)/255,9===V.length&&(this.a=parseInt(V.substring(7,9),16)/255)),this}toLinearSpace(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const I=new X;return this.toLinearSpaceToRef(I,V),I}toLinearSpaceToRef(V){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(V.r=j(this.r),V.g=j(this.g),V.b=j(this.b)):(V.r=k(this.r),V.g=k(this.g),V.b=k(this.b)),V.a=this.a,this}toGammaSpace(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const I=new X;return this.toGammaSpaceToRef(I,V),I}toGammaSpaceToRef(V){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(V.r=K(this.r),V.g=K(this.g),V.b=K(this.b)):(V.r=E(this.r),V.g=E(this.g),V.b=E(this.b)),V.a=this.a,this}static FromHexString(V){return"#"!==V.substring(0,1)||9!==V.length&&7!==V.length?new X(0,0,0,0):new X(0,0,0,1).fromHexString(V)}static Lerp(V,I,m){return X.LerpToRef(V,I,m,new X)}static LerpToRef(V,I,m,C){return C.r=V.r+(I.r-V.r)*m,C.g=V.g+(I.g-V.g)*m,C.b=V.b+(I.b-V.b)*m,C.a=V.a+(I.a-V.a)*m,C}static Hermite(V,I,m,C,l){const s=l*l,F=l*s,k=2*F-3*s+1,j=-2*F+3*s,E=F-2*s+l,K=F-s,Y=V.r*k+m.r*j+I.r*E+C.r*K,O=V.g*k+m.g*j+I.g*E+C.g*K,v=V.b*k+m.b*j+I.b*E+C.b*K,N=V.a*k+m.a*j+I.a*E+C.a*K;return new X(Y,O,v,N)}static Hermite1stDerivative(V,I,m,C,l){const s=new X;return this.Hermite1stDerivativeToRef(V,I,m,C,l,s),s}static Hermite1stDerivativeToRef(V,I,m,C,l,s){const F=l*l;s.r=6*(F-l)*V.r+(3*F-4*l+1)*I.r+6*(-F+l)*m.r+(3*F-2*l)*C.r,s.g=6*(F-l)*V.g+(3*F-4*l+1)*I.g+6*(-F+l)*m.g+(3*F-2*l)*C.g,s.b=6*(F-l)*V.b+(3*F-4*l+1)*I.b+6*(-F+l)*m.b+(3*F-2*l)*C.b,s.a=6*(F-l)*V.a+(3*F-4*l+1)*I.a+6*(-F+l)*m.a+(3*F-2*l)*C.a}static FromColor3(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new X(V.r,V.g,V.b,I)}static Ik(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new X(V[I],V[I+1],V[I+2],V[I+3])}static FromArrayToRef(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2?arguments[2]:void 0;m.r=V[I],m.g=V[I+1],m.b=V[I+2],m.a=V[I+3]}static FromInts(V,I,m,C){return new X(V/255,I/255,m/255,C/255)}static CheckColors4(V,I){if(V.length===3*I){const I=[];for(let m=0;m<V.length;m+=3){const C=m/3*4;I[C]=V[m],I[C+1]=V[m+1],I[C+2]=V[m+2],I[C+3]=1}return I}return V}}X._V8PerformanceHack=new X(.5,.5,.5,.5),Object.defineProperties(X.prototype,{dimension:{value:[4]},rank:{value:1}});class O{}O.dY=(0,C.d)(3,Y.Black),O.dX=(0,C.d)(3,(()=>new X(0,0,0,0))),(0,l.h)("BABYLON.Color3",Y),(0,l.h)("BABYLON.Color4",X)},11044:(V,I,m)=>{m.d(I,{c:()=>F,g:()=>s,k:()=>C,m:()=>l});const C=1/2.2,l=2.2,s=(1+Math.sqrt(5))/2,F=.001},11400:(V,I,m)=>{m.d(I,{b:()=>l});var C=m(11289);class l{static GetPlanes(V){const I=[];for(let m=0;m<6;m++)I.push(new C.e(0,0,0,0));return l.GetPlanesToRef(V,I),I}static GetNearPlaneToRef(V,I){const m=V.m;I.XC.x=m[3]+m[2],I.XC.y=m[7]+m[6],I.XC.z=m[11]+m[10],I.d=m[15]+m[14],I.normalize()}static GetFarPlaneToRef(V,I){const m=V.m;I.XC.x=m[3]-m[2],I.XC.y=m[7]-m[6],I.XC.z=m[11]-m[10],I.d=m[15]-m[14],I.normalize()}static GetLeftPlaneToRef(V,I){const m=V.m;I.XC.x=m[3]+m[0],I.XC.y=m[7]+m[4],I.XC.z=m[11]+m[8],I.d=m[15]+m[12],I.normalize()}static GetRightPlaneToRef(V,I){const m=V.m;I.XC.x=m[3]-m[0],I.XC.y=m[7]-m[4],I.XC.z=m[11]-m[8],I.d=m[15]-m[12],I.normalize()}static GetTopPlaneToRef(V,I){const m=V.m;I.XC.x=m[3]-m[1],I.XC.y=m[7]-m[5],I.XC.z=m[11]-m[9],I.d=m[15]-m[13],I.normalize()}static GetBottomPlaneToRef(V,I){const m=V.m;I.XC.x=m[3]+m[1],I.XC.y=m[7]+m[5],I.XC.z=m[11]+m[9],I.d=m[15]+m[13],I.normalize()}static GetPlanesToRef(V,I){l.GetNearPlaneToRef(V,I[0]),l.GetFarPlaneToRef(V,I[1]),l.GetLeftPlaneToRef(V,I[2]),l.GetRightPlaneToRef(V,I[3]),l.GetTopPlaneToRef(V,I[4]),l.GetBottomPlaneToRef(V,I[5])}static IsPointInFrustum(V,I){for(let m=0;m<6;m++)if(I[m].dotCoordinate(V)<0)return!1;return!0}}},11271:(V,I,m)=>{m.d(I,{b:()=>k,e:()=>j});var C=m(11206),l=m(11040),s=m(11214);class F{static extractMinAndMaxIndexed(V,I,m,C,l,s){for(let F=m;F<m+C;F++){const m=3*I[F],C=V[m],k=V[m+1],j=V[m+2];l.minimizeInPlaceFromFloats(C,k,j),s.maximizeInPlaceFromFloats(C,k,j)}}static extractMinAndMax(V,I,m,C,l,s){for(let F=I,k=I*C;F<I+m;F++,k+=C){const I=V[k],m=V[k+1],C=V[k+2];l.minimizeInPlaceFromFloats(I,m,C),s.maximizeInPlaceFromFloats(I,m,C)}}}function k(V,I,m,C){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const k=new l.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),j=new l.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return F.extractMinAndMaxIndexed(V,I,m,C,k,j),s&&(k.x-=k.x*s.x+s.y,k.y-=k.y*s.x+s.y,k.z-=k.z*s.x+s.y,j.x+=j.x*s.x+s.y,j.y+=j.y*s.x+s.y,j.z+=j.z*s.x+s.y),{minimum:k,maximum:j}}function j(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4?arguments[4]:void 0;const k=new l.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),j=new l.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return s||(s=3),F.extractMinAndMax(V,I,m,s,k,j),C&&(k.x-=k.x*C.x+C.y,k.y-=k.y*C.x+C.y,k.z-=k.z*C.x+C.y,j.x+=j.x*C.x+C.y,j.y+=j.y*C.x+C.y,j.z+=j.z*C.x+C.y),{minimum:k,maximum:j}}(0,C.d)([s.c.filter((function(){for(var V=arguments.length,I=new Array(V),m=0;m<V;m++)I[m]=arguments[m];let[C,l]=I;return!Array.isArray(C)&&!Array.isArray(l)}))],F,"extractMinAndMaxIndexed",null),(0,C.d)([s.c.filter((function(){for(var V=arguments.length,I=new Array(V),m=0;m<V;m++)I[m]=arguments[m];let[C]=I;return!Array.isArray(C)}))],F,"extractMinAndMax",null)},11496:(V,I,m)=>{m.d(I,{d:()=>C.b,e:()=>C.e,g:()=>C.g,j:()=>C.m});m(11372),m(11312),m(11044),m(11400),m(11498),m(11289),m(11501);var C=m(11040);m(11393)},11498:(V,I,m)=>{m.d(I,{d:()=>k,e:()=>X,g:()=>K,j:()=>Y});var C,l=m(11074),s=m(11040),F=m(11044);!function(V){V[V.CW=0]="CW",V[V.CCW=1]="CCW"}(C||(C={}));class k{static Interpolate(V,I,m,C,l){if(0===V)return 0;const s=1-3*C+3*I,F=3*C-6*I,k=3*I;let j=V;for(let E=0;E<5;E++){const I=j*j;j-=(s*(I*j)+F*I+k*j-V)*(1/(3*s*I+2*F*j+k)),j=Math.min(1,Math.max(0,j))}return 3*Math.pow(1-j,2)*j*m+3*(1-j)*Math.pow(j,2)*l+Math.pow(j,3)}}class j{constructor(V){this._radians=V,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}static BetweenTwoPoints(V,I){const m=I.Fm(V),C=Math.atan2(m.y,m.x);return new j(C)}static BetweenTwoVectors(V,I){let m=V.lengthSquared()*I.lengthSquared();if(0===m)return new j(Math.PI/2);m=Math.sqrt(m);let C=V.dot(I)/m;C=(0,l.Clamp)(C,-1,1);const s=Math.acos(C);return new j(s)}static FromRadians(V){return new j(V)}static FromDegrees(V){return new j(V*Math.PI/180)}}class E{constructor(V,I,m){this.startPoint=V,this.midPoint=I,this.endPoint=m;const C=Math.pow(I.x,2)+Math.pow(I.y,2),l=(Math.pow(V.x,2)+Math.pow(V.y,2)-C)/2,F=(C-Math.pow(m.x,2)-Math.pow(m.y,2))/2,k=(V.x-I.x)*(I.y-m.y)-(I.x-m.x)*(V.y-I.y);this.centerPoint=new s.k((l*(I.y-m.y)-F*(V.y-I.y))/k,((V.x-I.x)*F-(I.x-m.x)*l)/k),this.radius=this.centerPoint.Fm(this.startPoint).length(),this.startAngle=j.BetweenTwoPoints(this.centerPoint,this.startPoint);const E=this.startAngle.degrees();let K=j.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),Y=j.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();K-E>180&&(K-=360),K-E<-180&&(K+=360),Y-K>180&&(Y-=360),Y-K<-180&&(Y+=360),this.orientation=K-E<0?0:1,this.angle=j.FromDegrees(0===this.orientation?E-Y:Y-E)}}class K{constructor(V,I){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new s.k(V,I))}addLineTo(V,I){if(this.closed)return this;const m=new s.k(V,I),C=this._points[this._points.length-1];return this._points.push(m),this._length+=m.Fm(C).length(),this}addArcTo(V,I,m,C){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const F=this._points[this._points.length-1],k=new s.k(V,I),j=new s.k(m,C),K=new E(F,k,j);let Y=K.angle.radians()/l;0===K.orientation&&(Y*=-1);let X=K.startAngle.radians()+Y;for(let s=0;s<l;s++){const V=Math.cos(X)*K.radius+K.centerPoint.x,I=Math.sin(X)*K.radius+K.centerPoint.y;this.addLineTo(V,I),X+=Y}return this}addQuadraticCurveTo(V,I,m,C){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const s=(V,I,m,C)=>(1-V)*(1-V)*I+2*V*(1-V)*m+V*V*C,F=this._points[this._points.length-1];for(let k=0;k<=l;k++){const j=k/l,E=s(j,F.x,V,m),K=s(j,F.y,I,C);this.addLineTo(E,K)}return this}addBezierCurveTo(V,I,m,C,l,s){let F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:36;if(this.closed)return this;const k=(V,I,m,C,l)=>(1-V)*(1-V)*(1-V)*I+3*V*(1-V)*(1-V)*m+3*V*V*(1-V)*C+V*V*V*l,j=this._points[this._points.length-1];for(let E=0;E<=F;E++){const K=E/F,Y=k(K,j.x,V,m,l),X=k(K,j.y,I,C,s);this.addLineTo(Y,X)}return this}isPointInside(V){let I=!1;const m=this._points.length;for(let C=m-1,l=0;l<m;C=l++){let m=this._points[C],s=this._points[l],F=s.x-m.x,k=s.y-m.y;if(Math.abs(k)>Number.EPSILON){if(k<0&&(m=this._points[l],F=-F,s=this._points[C],k=-k),V.y<m.y||V.y>s.y)continue;if(V.y===m.y&&V.x===m.x)return!0;{const C=k*(V.x-m.x)-F*(V.y-m.y);if(0===C)return!0;if(C<0)continue;I=!I}}else{if(V.y!==m.y)continue;if(s.x<=V.x&&V.x<=m.x||m.x<=V.x&&V.x<=s.x)return!0}}return I}close(){return this.closed=!0,this}length(){let V=this._length;if(this.closed){const I=this._points[this._points.length-1];V+=this._points[0].Fm(I).length()}return V}area(){const V=this._points.length;let I=0;for(let m=V-1,C=0;C<V;m=C++)I+=this._points[m].x*this._points[C].y-this._points[C].x*this._points[m].y;return.5*I}getPoints(){return this._points}getPointAtLengthPosition(V){if(V<0||V>1)return s.k.Zero();const I=V*this.length();let m=0;for(let C=0;C<this._points.length;C++){const V=(C+1)%this._points.length,l=this._points[C],F=this._points[V].Fm(l),k=F.length()+m;if(I>=m&&I<=k){const V=F.normalize(),C=I-m;return new s.k(l.x+V.x*C,l.y+V.y*C)}m=k}return s.k.Zero()}static StartingAt(V,I){return new K(V,I)}}class Y{constructor(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2?arguments[2]:void 0,C=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.path=V,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:s.m.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:s.b.Identity()};for(let l=0;l<V.length;l++)this._curve[l]=V[l].clone();this._raw=m||!1,this._alignTangentsWithPath=C,this._compute(I,C)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(V){return this._updatePointAtData(V).point}getTangentAt(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(V,I),I?s.m.TransformCoordinates(s.m.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(V,I),I?s.m.TransformCoordinates(s.m.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(V,I),I?s.m.TransformCoordinates(s.m.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(V){return this.length()*V}getPreviousPointIndexAt(V){return this._updatePointAtData(V),this._pointAtData.previousPointArrayIndex}getSubPositionAt(V){return this._updatePointAtData(V),this._pointAtData.subPosition}getClosestPositionTo(V){let I=Number.MAX_VALUE,m=0;for(let C=0;C<this._curve.length-1;C++){const l=this._curve[C+0],F=this._curve[C+1].Fm(l).normalize(),k=this._distances[C+1]-this._distances[C+0],j=Math.min(Math.max(s.m.Dot(F,V.Fm(l).normalize()),0)*s.m.Distance(l,V)/k,1),E=s.m.Distance(l.add(F.scale(j*k)),V);E<I&&(I=E,m=(this._distances[C+0]+k*j)/this.length())}return m}slice(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(V<0&&(V=1- -1*V%1),I<0&&(I=1- -1*I%1),V>I){const m=V;V=I,I=m}const m=this.getCurve(),C=this.getPointAt(V);let l=this.getPreviousPointIndexAt(V);const s=this.getPointAt(I),F=this.getPreviousPointIndexAt(I)+1,k=[];return 0!==V&&(l++,k.push(C)),k.push(...m.slice(l,F)),1===I&&1!==V||k.push(s),new Y(k,this.getNormalAt(V),this._raw,this._alignTangentsWithPath)}update(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(let C=0;C<V.length;C++)this._curve[C].x=V[C].x,this._curve[C].y=V[C].y,this._curve[C].z=V[C].z;return this._compute(I,m),this}_compute(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const m=this._curve.length;if(m<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[m-1]=this._curve[m-1].Fm(this._curve[m-2]),this._raw||this._tangents[m-1].normalize();const C=this._tangents[0],l=this._normalVector(C,V);let F,k,j,E,K;this._normals[0]=l,this._raw||this._normals[0].normalize(),this._binormals[0]=s.m.Cross(C,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let Y=1;Y<m;Y++)F=this._getLastNonNullVector(Y),Y<m-1&&(k=this._getFirstNonNullVector(Y),this._tangents[Y]=I?k:F.add(k),this._tangents[Y].normalize()),this._distances[Y]=this._distances[Y-1]+this._curve[Y].Fm(this._curve[Y-1]).length(),j=this._tangents[Y],K=this._binormals[Y-1],this._normals[Y]=s.m.Cross(K,j),this._raw||(0===this._normals[Y].length()?(E=this._normals[Y-1],this._normals[Y]=E.clone()):this._normals[Y].normalize()),this._binormals[Y]=s.m.Cross(j,this._normals[Y]),this._raw||this._binormals[Y].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(V){let I=1,m=this._curve[V+I].Fm(this._curve[V]);for(;0===m.length()&&V+I+1<this._curve.length;)I++,m=this._curve[V+I].Fm(this._curve[V]);return m}_getLastNonNullVector(V){let I=1,m=this._curve[V].Fm(this._curve[V-I]);for(;0===m.length()&&V>I+1;)I++,m=this._curve[V].Fm(this._curve[V-I]);return m}_normalVector(V,I){let m,C=V.length();if(0===C&&(C=1),void 0===I||null===I){let I;I=(0,l.WithinEpsilon)(Math.abs(V.y)/C,1,F.c)?(0,l.WithinEpsilon)(Math.abs(V.x)/C,1,F.c)?(0,l.WithinEpsilon)(Math.abs(V.z)/C,1,F.c)?s.m.Zero():new s.m(0,0,1):new s.m(1,0,0):new s.m(0,-1,0),m=s.m.Cross(V,I)}else m=s.m.Cross(V,I),s.m.CrossToRef(m,V,m);return m.normalize(),m}_updatePointAtData(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._pointAtData.id===V)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=V;const m=this.getPoints();if(V<=0)return this._setPointAtData(0,0,m[0],0,I);if(V>=1)return this._setPointAtData(1,1,m[m.length-1],m.length-1,I);let C,l=m[0],F=0;const k=V*this.length();for(let j=1;j<m.length;j++){C=m[j];const E=s.m.Distance(l,C);if(F+=E,F===k)return this._setPointAtData(V,1,C,j,I);if(F>k){const m=(F-k)/E,s=l.Fm(C),K=C.add(s.scaleInPlace(m));return this._setPointAtData(V,1-m,K,j-1,I)}l=C}return this._pointAtData}_setPointAtData(V,I,m,C,l){return this._pointAtData.point=m,this._pointAtData.position=V,this._pointAtData.subPosition=I,this._pointAtData.previousPointArrayIndex=C,this._pointAtData.interpolateReady=l,l&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=s.b.Identity();const V=this._pointAtData.previousPointArrayIndex;if(V!==this._tangents.length-1){const I=V+1,m=this._tangents[V].clone(),C=this._normals[V].clone(),l=this._binormals[V].clone(),F=this._tangents[I].clone(),k=this._normals[I].clone(),j=this._binormals[I].clone(),E=s.e.RotationQuaternionFromAxis(C,l,m),K=s.e.RotationQuaternionFromAxis(k,j,F);s.e.Slerp(E,K,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}class X{static CreateQuadraticBezier(V,I,m,C){C=C>2?C:3;const l=[],F=(V,I,m,C)=>(1-V)*(1-V)*I+2*V*(1-V)*m+V*V*C;for(let k=0;k<=C;k++)l.push(new s.m(F(k/C,V.x,I.x,m.x),F(k/C,V.y,I.y,m.y),F(k/C,V.z,I.z,m.z)));return new X(l)}static CreateCubicBezier(V,I,m,C,l){l=l>3?l:4;const F=[],k=(V,I,m,C,l)=>(1-V)*(1-V)*(1-V)*I+3*V*(1-V)*(1-V)*m+3*V*V*(1-V)*C+V*V*V*l;for(let j=0;j<=l;j++)F.push(new s.m(k(j/l,V.x,I.x,m.x,C.x),k(j/l,V.y,I.y,m.y,C.y),k(j/l,V.z,I.z,m.z,C.z)));return new X(F)}static CreateHermiteSpline(V,I,m,C,l){const F=[],k=1/l;for(let j=0;j<=l;j++)F.push(s.m.Hermite(V,I,m,C,j*k));return new X(F)}static CreateCatmullRomSpline(V,I,m){const C=[],l=1/I;let F=0;if(m){const m=V.length;for(let k=0;k<m;k++){F=0;for(let j=0;j<I;j++)C.push(s.m.CatmullRom(V[k%m],V[(k+1)%m],V[(k+2)%m],V[(k+3)%m],F)),F+=l}C.push(C[0])}else{const m=[];m.push(V[0].clone()),Array.prototype.push.apply(m,V),m.push(V[V.length-1].clone());let k=0;for(;k<m.length-3;k++){F=0;for(let V=0;V<I;V++)C.push(s.m.CatmullRom(m[k],m[k+1],m[k+2],m[k+3],F)),F+=l}k--,C.push(s.m.CatmullRom(m[k],m[k+1],m[k+2],m[k+3],F))}return new X(C)}static ArcThru3Points(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,l=arguments.length>4&&void 0!==arguments[4]&&arguments[4],F=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const k=[],j=I.Fm(V),E=m.Fm(I),K=V.Fm(m),Y=s.m.Cross(j,E),O=Y.length();if(O<Math.pow(10,-8))return new X(k);const v=j.lengthSquared(),N=E.lengthSquared(),t=K.lengthSquared(),D=Y.lengthSquared(),b=.5*j.length()*E.length()*K.length()/O,T=-.5*N*s.m.Dot(j,K)/D,n=-.5*t*s.m.Dot(j,E)/D,x=-.5*v*s.m.Dot(E,K)/D,S=V.scale(T).add(I.scale(n)).add(m.scale(x)),c=V.Fm(S).normalize(),H=s.m.Cross(Y,c).normalize();if(F){const I=2*Math.PI/C;for(let V=0;V<=2*Math.PI;V+=I)k.push(S.add(c.scale(b*Math.cos(V)).add(H.scale(b*Math.sin(V)))));k.push(V)}else{const I=1/C;let F=0,j=s.m.Zero();do{j=S.add(c.scale(b*Math.cos(F)).add(H.scale(b*Math.sin(F)))),k.push(j),F+=I}while(!j.equalsWithEpsilon(m,b*I*1.1));k.push(m),l&&k.push(V)}return new X(k)}constructor(V){this._length=0,this._points=V,this._length=this._computeLength(V)}getPoints(){return this._points}length(){return this._length}continue(V){const I=this._points[this._points.length-1],m=this._points.slice(),C=V.getPoints();for(let l=1;l<C.length;l++)m.push(C[l].Fm(C[0]).add(I));return new X(m)}_computeLength(V){let I=0;for(let m=1;m<V.length;m++)I+=V[m].Fm(V[m-1]).length();return I}}},11289:(V,I,m)=>{m.d(I,{e:()=>l});var C=m(11040);class l{constructor(V,I,m,l){this.XC=new C.m(V,I,m),this.d=l}UF(){return[this.XC.x,this.XC.y,this.XC.z,this.d]}clone(){return new l(this.XC.x,this.XC.y,this.XC.z,this.d)}getClassName(){return"Plane"}getHashCode(){let V=this.XC.getHashCode();return V=397*V^this.d,V}normalize(){const V=Math.sqrt(this.XC.x*this.XC.x+this.XC.y*this.XC.y+this.XC.z*this.XC.z);let I=0;return 0!==V&&(I=1/V),this.XC.x*=I,this.XC.y*=I,this.XC.z*=I,this.d*=I,this}transform(V){const I=l._TmpMatrix;V.invertToRef(I);const m=I.m,C=this.XC.x,s=this.XC.y,F=this.XC.z,k=this.d,j=C*m[0]+s*m[1]+F*m[2]+k*m[3],E=C*m[4]+s*m[5]+F*m[6]+k*m[7],K=C*m[8]+s*m[9]+F*m[10]+k*m[11],Y=C*m[12]+s*m[13]+F*m[14]+k*m[15];return new l(j,E,K,Y)}dotCoordinate(V){return this.XC.x*V.x+this.XC.y*V.y+this.XC.z*V.z+this.d}copyFromPoints(V,I,m){const C=I.x-V.x,l=I.y-V.y,s=I.z-V.z,F=m.x-V.x,k=m.y-V.y,j=m.z-V.z,E=l*j-s*k,K=s*F-C*j,Y=C*k-l*F,X=Math.sqrt(E*E+K*K+Y*Y);let O;return O=0!==X?1/X:0,this.XC.x=E*O,this.XC.y=K*O,this.XC.z=Y*O,this.d=-(this.XC.x*V.x+this.XC.y*V.y+this.XC.z*V.z),this}isFrontFacingTo(V,I){return C.m.Dot(this.XC,V)<=I}signedDistanceTo(V){return C.m.Dot(V,this.XC)+this.d}static Ik(V){return new l(V[0],V[1],V[2],V[3])}static FromPoints(V,I,m){const C=new l(0,0,0,0);return C.copyFromPoints(V,I,m),C}static FromPositionAndNormal(V,I){const m=new l(0,0,0,0);return this.FromPositionAndNormalToRef(V,I,m)}static FromPositionAndNormalToRef(V,I,m){return m.XC.C(I),m.XC.normalize(),m.d=-V.dot(m.XC),m}static SignedDistanceToPlaneFromPositionAndNormal(V,I,m){const l=-(I.x*V.x+I.y*V.y+I.z*V.z);return C.m.Dot(m,I)+l}}l._TmpMatrix=C.b.Identity()},11074:(V,I,m)=>{function C(V){return parseInt(V.toString().replace(/\W/g,""))}function l(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1401298e-51;return Math.abs(V-I)<=m}function s(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1401298e-51;return V<I-C||V>m+C}function F(V,I){return V===I?V:Math.random()*(I-V)+V}function k(V,I,m){return V+(I-V)*m}function j(V,I,m){let C=t(I-V,360);return C>180&&(C-=360),V+C*X(m)}function E(V,I,m){let C=0;return C=V!=I?X((m-V)/(I-V)):0,C}function K(V,I,m,C,l){const s=l*l,F=l*s;return V*(2*F-3*s+1)+m*(-2*F+3*s)+I*(F-2*s+l)+C*(F-s)}function Y(V,I,m,C,l){const s=l*l;return 6*(s-l)*V+(3*s-4*l+1)*I+6*(-s+l)*m+(3*s-2*l)*C}function X(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(m,Math.max(I,V))}function O(V){return V-=2*Math.PI*Math.floor((V+Math.PI)/(2*Math.PI))}function v(V){const I=V.toString(16);return V<=15?("0"+I).toUpperCase():I.toUpperCase()}function N(V){if(Math.log2)return Math.floor(Math.log2(V));if(V<0)return NaN;if(0===V)return-1/0;let I=0;if(V<1){for(;V<1;)I++,V*=2;I=-I}else if(V>1)for(;V>1;)I++,V=Math.floor(V/2);return I}function t(V,I){return V-Math.floor(V/I)*I}function D(V,I,m){return(V-I)/(m-I)}function b(V,I,m){return V*(m-I)+I}function T(V,I){let m=t(I-V,360);return m>180&&(m-=360),m}function n(V,I){const m=t(V,2*I);return I-Math.abs(m-I)}function x(V,I,m){let C=X(m);return C=-2*C*C*C+3*C*C,I*C+V*(1-C)}function S(V,I,m){let C=0;return C=Math.abs(I-V)<=m?I:V+Math.sign(I-V)*m,C}function c(V,I,m){const C=T(V,I);let l=0;return l=-m<C&&C<m?I:S(V,I=V+C,m),l}function H(V,I,m){return(V-I)/(m-I)}function y(V,I,m){return(m-I)*V+I}function z(V,I){const m=V%I;return 0===m?I:z(I,m)}m.r(I),m.d(I,{Clamp:()=>X,DeltaAngle:()=>T,Denormalize:()=>b,ExtractAsInt:()=>C,Hermite:()=>K,Hermite1stDerivative:()=>Y,HighestCommonFactor:()=>z,ILog2:()=>N,InverseLerp:()=>E,Lerp:()=>k,LerpAngle:()=>j,MoveTowards:()=>S,MoveTowardsAngle:()=>c,Normalize:()=>D,NormalizeRadians:()=>O,OutsideRange:()=>s,PercentToRange:()=>y,PingPong:()=>n,RandomRange:()=>F,RangeToPercent:()=>H,Repeat:()=>t,SmoothStep:()=>x,ToHex:()=>v,WithinEpsilon:()=>l})},11501:(V,I,m)=>{m.d(I,{c:()=>C});class C{constructor(V,I){this.width=V,this.height=I}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let V=0|this.width;return V=397*V^this.height,V}C(V){this.width=V.width,this.height=V.height}aF(V,I){return this.width=V,this.height=I,this}set(V,I){return this.aF(V,I)}multiplyByFloats(V,I){return new C(this.width*V,this.height*I)}clone(){return new C(this.width,this.height)}equals(V){return!!V&&(this.width===V.width&&this.height===V.height)}get surface(){return this.width*this.height}static Zero(){return new C(0,0)}add(V){return new C(this.width+V.width,this.height+V.height)}Fm(V){return new C(this.width-V.width,this.height-V.height)}scale(V){return new C(this.width*V,this.height*V)}static Lerp(V,I,m){const l=V.width+(I.width-V.width)*m,s=V.height+(I.height-V.height)*m;return new C(l,s)}}},11040:(V,I,m)=>{m.d(I,{b:()=>b,e:()=>D,g:()=>n,k:()=>v,m:()=>N,n:()=>t});var C=m(11044),l=m(11046),s=m(11048),F=m(11055),k=m(11061),j=m(11074);class E{}function K(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const l=V.UF(),s=I.UF(),F=l[0],k=l[1],j=l[2],E=l[3],K=l[4],Y=l[5],X=l[6],O=l[7],v=l[8],N=l[9],t=l[10],D=l[11],b=l[12],T=l[13],n=l[14],x=l[15],S=s[0],c=s[1],H=s[2],y=s[3],z=s[4],Z=s[5],B=s[6],W=s[7],Q=s[8],G=s[9],r=s[10],g=s[11],h=s[12],d=s[13],R=s[14],i=s[15];m[C]=F*S+k*z+j*Q+E*h,m[C+1]=F*c+k*Z+j*G+E*d,m[C+2]=F*H+k*B+j*r+E*R,m[C+3]=F*y+k*W+j*g+E*i,m[C+4]=K*S+Y*z+X*Q+O*h,m[C+5]=K*c+Y*Z+X*G+O*d,m[C+6]=K*H+Y*B+X*r+O*R,m[C+7]=K*y+Y*W+X*g+O*i,m[C+8]=v*S+N*z+t*Q+D*h,m[C+9]=v*c+N*Z+t*G+D*d,m[C+10]=v*H+N*B+t*r+D*R,m[C+11]=v*y+N*W+t*g+D*i,m[C+12]=b*S+T*z+n*Q+x*h,m[C+13]=b*c+T*Z+n*G+x*d,m[C+14]=b*H+T*B+n*r+x*R,m[C+15]=b*y+T*W+n*g+x*i}function Y(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const C=V.UF();I[m]=C[0],I[m+1]=C[1],I[m+2]=C[2],I[m+3]=C[3],I[m+4]=C[4],I[m+5]=C[5],I[m+6]=C[6],I[m+7]=C[7],I[m+8]=C[8],I[m+9]=C[9],I[m+10]=C[10],I[m+11]=C[11],I[m+12]=C[12],I[m+13]=C[13],I[m+14]=C[14],I[m+15]=C[15]}function X(V,I){const m=V.UF(),C=m[0],l=m[1],s=m[2],F=m[3],k=m[4],j=m[5],E=m[6],K=m[7],Y=m[8],X=m[9],O=m[10],v=m[11],N=m[12],t=m[13],D=m[14],b=m[15],T=O*b-D*v,n=X*b-t*v,x=X*D-t*O,S=Y*b-N*v,c=Y*D-O*N,H=Y*t-N*X,y=+(j*T-E*n+K*x),z=-(k*T-E*S+K*c),Z=+(k*n-j*S+K*H),B=-(k*x-j*c+E*H),W=C*y+l*z+s*Z+F*B;if(0===W)return!1;const Q=1/W,G=E*b-D*K,r=j*b-t*K,g=j*D-t*E,h=k*b-N*K,d=k*D-N*E,R=k*t-N*j,i=E*v-O*K,q=j*v-X*K,P=j*O-X*E,u=k*v-Y*K,o=k*O-Y*E,p=k*X-Y*j,M=-(l*T-s*n+F*x),f=+(C*T-s*S+F*c),w=-(C*n-l*S+F*H),A=+(C*x-l*c+s*H),J=+(l*G-s*r+F*g),U=-(C*G-s*h+F*d),e=+(C*r-l*h+F*R),a=-(C*g-l*d+s*R),L=-(l*i-s*q+F*P),VV=+(C*i-s*u+F*o),IV=-(C*q-l*u+F*p),mV=+(C*P-l*o+s*p);return I[0]=y*Q,I[1]=M*Q,I[2]=J*Q,I[3]=L*Q,I[4]=z*Q,I[5]=f*Q,I[6]=U*Q,I[7]=VV*Q,I[8]=Z*Q,I[9]=w*Q,I[10]=e*Q,I[11]=IV*Q,I[12]=B*Q,I[13]=A*Q,I[14]=a*Q,I[15]=mV*Q,!0}E._UpdateFlagSeed=0;const O=V=>parseInt(V.toString().replace(/\W/g,""));class v{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=V,this.y=I}toString(){return`{X: ${this.x} Y: ${this.y}}`}getClassName(){return"Vector2"}getHashCode(){let V=O(this.x);return V=397*V^O(this.y),V}toArray(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return V[I]=this.x,V[I+1]=this.y,this}km(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return v.FromArrayToRef(V,I,this),this}UF(){return[this.x,this.y]}C(V){return this.x=V.x,this.y=V.y,this}aF(V,I){return this.x=V,this.y=I,this}set(V,I){return this.aF(V,I)}mk(V){return this.aF(V,V)}add(V){return new v(this.x+V.x,this.y+V.y)}addToRef(V,I){return I.x=this.x+V.x,I.y=this.y+V.y,I}addInPlace(V){return this.x+=V.x,this.y+=V.y,this}addInPlaceFromFloats(V,I){return this.x+=V,this.y+=I,this}addVector3(V){return new v(this.x+V.x,this.y+V.y)}Fm(V){return new v(this.x-V.x,this.y-V.y)}subtractToRef(V,I){return I.x=this.x-V.x,I.y=this.y-V.y,I}WK(V){return this.x-=V.x,this.y-=V.y,this}multiplyInPlace(V){return this.x*=V.x,this.y*=V.y,this}multiply(V){return new v(this.x*V.x,this.y*V.y)}multiplyToRef(V,I){return I.x=this.x*V.x,I.y=this.y*V.y,I}multiplyByFloats(V,I){return new v(this.x*V,this.y*I)}divide(V){return new v(this.x/V.x,this.y/V.y)}divideToRef(V,I){return I.x=this.x/V.x,I.y=this.y/V.y,I}divideInPlace(V){return this.x=this.x/V.x,this.y=this.y/V.y,this}minimizeInPlace(V){return this.minimizeInPlaceFromFloats(V.x,V.y)}maximizeInPlace(V){return this.maximizeInPlaceFromFloats(V.x,V.y)}minimizeInPlaceFromFloats(V,I){return this.x=Math.min(V,this.x),this.y=Math.min(I,this.y),this}maximizeInPlaceFromFloats(V,I){return this.x=Math.max(V,this.x),this.y=Math.max(I,this.y),this}subtractFromFloats(V,I){return new v(this.x-V,this.y-I)}subtractFromFloatsToRef(V,I,m){return m.x=this.x-V,m.y=this.y-I,m}negate(){return new v(-this.x,-this.y)}negateInPlace(){return this.x*=-1,this.y*=-1,this}negateToRef(V){return V.x=-this.x,V.y=-this.y,V}scaleInPlace(V){return this.x*=V,this.y*=V,this}scale(V){return new v(this.x*V,this.y*V)}scaleToRef(V,I){return I.x=this.x*V,I.y=this.y*V,I}scaleAndAddToRef(V,I){return I.x+=this.x*V,I.y+=this.y*V,I}equals(V){return V&&this.x===V.x&&this.y===V.y}equalsWithEpsilon(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:C.c;return V&&(0,j.WithinEpsilon)(this.x,V.x,I)&&(0,j.WithinEpsilon)(this.y,V.y,I)}equalsToFloats(V,I){return this.x===V&&this.y===I}floor(){return new v(Math.floor(this.x),Math.floor(this.y))}floorToRef(V){return V.x=Math.floor(this.x),V.y=Math.floor(this.y),V}fract(){return new v(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}fractToRef(V){return V.x=this.x-Math.floor(this.x),V.y=this.y-Math.floor(this.y),V}rotate(V){return this.rotateToRef(V,new v)}rotateToRef(V,I){const m=Math.cos(V),C=Math.sin(V);return I.x=m*this.x-C*this.y,I.y=C*this.x+m*this.y,I}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(V){return 0===V||1===V?this:this.scaleInPlace(1/V)}normalizeToNew(){const V=new v;return this.normalizeToRef(V),V}normalizeToRef(V){const I=this.length();return 0===I&&(V.x=this.x,V.y=this.y),this.scaleToRef(1/I,V)}clone(){return new v(this.x,this.y)}dot(V){return this.x*V.x+this.y*V.y}static Zero(){return new v(0,0)}static One(){return new v(1,1)}static Random(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new v((0,j.RandomRange)(V,I),(0,j.RandomRange)(V,I))}static RandomToRef(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).aF((0,j.RandomRange)(V,I),(0,j.RandomRange)(V,I))}static get ZeroReadOnly(){return v._ZeroReadOnly}static Ik(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new v(V[I],V[I+1])}static FromArrayToRef(V,I,m){return m.x=V[I],m.y=V[I+1],m}static FromFloatsToRef(V,I,m){return m.aF(V,I),m}static CatmullRom(V,I,m,C,l){const s=l*l,F=l*s,k=.5*(2*I.x+(-V.x+m.x)*l+(2*V.x-5*I.x+4*m.x-C.x)*s+(-V.x+3*I.x-3*m.x+C.x)*F),j=.5*(2*I.y+(-V.y+m.y)*l+(2*V.y-5*I.y+4*m.y-C.y)*s+(-V.y+3*I.y-3*m.y+C.y)*F);return new v(k,j)}static ClampToRef(V,I,m,C){return C.x=(0,j.Clamp)(V.x,I.x,m.x),C.y=(0,j.Clamp)(V.y,I.y,m.y),C}static Clamp(V,I,m){const C=(0,j.Clamp)(V.x,I.x,m.x),l=(0,j.Clamp)(V.y,I.y,m.y);return new v(C,l)}static Hermite(V,I,m,C,l){const s=l*l,F=l*s,k=2*F-3*s+1,j=-2*F+3*s,E=F-2*s+l,K=F-s,Y=V.x*k+m.x*j+I.x*E+C.x*K,X=V.y*k+m.y*j+I.y*E+C.y*K;return new v(Y,X)}static Hermite1stDerivative(V,I,m,C,l){return this.Hermite1stDerivativeToRef(V,I,m,C,l,new v)}static Hermite1stDerivativeToRef(V,I,m,C,l,s){const F=l*l;return s.x=6*(F-l)*V.x+(3*F-4*l+1)*I.x+6*(-F+l)*m.x+(3*F-2*l)*C.x,s.y=6*(F-l)*V.y+(3*F-4*l+1)*I.y+6*(-F+l)*m.y+(3*F-2*l)*C.y,s}static Lerp(V,I,m){return v.LerpToRef(V,I,m,new v)}static LerpToRef(V,I,m,C){return C.x=V.x+(I.x-V.x)*m,C.y=V.y+(I.y-V.y)*m,C}static Dot(V,I){return V.x*I.x+V.y*I.y}static Normalize(V){return v.NormalizeToRef(V,new v)}static NormalizeToRef(V,I){return V.normalizeToRef(I),I}static Minimize(V,I){const m=V.x<I.x?V.x:I.x,C=V.y<I.y?V.y:I.y;return new v(m,C)}static Maximize(V,I){const m=V.x>I.x?V.x:I.x,C=V.y>I.y?V.y:I.y;return new v(m,C)}static Transform(V,I){return v.TransformToRef(V,I,new v)}static TransformToRef(V,I,m){const C=I.m,l=V.x*C[0]+V.y*C[4]+C[12],s=V.x*C[1]+V.y*C[5]+C[13];return m.x=l,m.y=s,m}static PointInTriangle(V,I,m,C){const l=.5*(-m.y*C.x+I.y*(-m.x+C.x)+I.x*(m.y-C.y)+m.x*C.y),s=l<0?-1:1,F=(I.y*C.x-I.x*C.y+(C.y-I.y)*V.x+(I.x-C.x)*V.y)*s,k=(I.x*m.y-I.y*m.x+(I.y-m.y)*V.x+(m.x-I.x)*V.y)*s;return F>0&&k>0&&F+k<2*l*s}static Distance(V,I){return Math.sqrt(v.DistanceSquared(V,I))}static DistanceSquared(V,I){const m=V.x-I.x,C=V.y-I.y;return m*m+C*C}static Center(V,I){return v.CenterToRef(V,I,new v)}static CenterToRef(V,I,m){return m.aF((V.x+I.x)/2,(V.y+I.y)/2)}static DistanceOfPointFromSegment(V,I,m){const C=v.DistanceSquared(I,m);if(0===C)return v.Distance(V,I);const l=m.Fm(I),s=Math.max(0,Math.min(1,v.Dot(V.Fm(I),l)/C)),F=I.add(l.multiplyByFloats(s,s));return v.Distance(V,F)}}v._V8PerformanceHack=new v(.5,.5),v._ZeroReadOnly=v.Zero(),Object.defineProperties(v.prototype,{dimension:{value:[2]},rank:{value:1}});class N{get x(){return this._x}set x(V){this._x=V,this._isDirty=!0}get y(){return this._y}set y(V){this._y=V,this._isDirty=!0}get z(){return this._z}set z(V){this._z=V,this._isDirty=!0}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._isDirty=!0,this._x=V,this._y=I,this._z=m}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z}}`}getClassName(){return"LF"}getHashCode(){let V=O(this._x);return V=397*V^O(this._y),V=397*V^O(this._z),V}UF(){return[this._x,this._y,this._z]}toArray(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return V[I]=this._x,V[I+1]=this._y,V[I+2]=this._z,this}km(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return N.FromArrayToRef(V,I,this),this}toQuaternion(){return D.RotationYawPitchRoll(this._y,this._x,this._z)}addInPlace(V){return this._x+=V._x,this._y+=V._y,this._z+=V._z,this._isDirty=!0,this}addInPlaceFromFloats(V,I,m){return this._x+=V,this._y+=I,this._z+=m,this._isDirty=!0,this}add(V){return new N(this._x+V._x,this._y+V._y,this._z+V._z)}addToRef(V,I){return I._x=this._x+V._x,I._y=this._y+V._y,I._z=this._z+V._z,I._isDirty=!0,I}WK(V){return this._x-=V._x,this._y-=V._y,this._z-=V._z,this._isDirty=!0,this}Fm(V){return new N(this._x-V._x,this._y-V._y,this._z-V._z)}subtractToRef(V,I){return this.subtractFromFloatsToRef(V._x,V._y,V._z,I)}subtractFromFloats(V,I,m){return new N(this._x-V,this._y-I,this._z-m)}subtractFromFloatsToRef(V,I,m,C){return C._x=this._x-V,C._y=this._y-I,C._z=this._z-m,C._isDirty=!0,C}negate(){return new N(-this._x,-this._y,-this._z)}negateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}negateToRef(V){return V._x=-1*this._x,V._y=-1*this._y,V._z=-1*this._z,V._isDirty=!0,V}scaleInPlace(V){return this._x*=V,this._y*=V,this._z*=V,this._isDirty=!0,this}scale(V){return new N(this._x*V,this._y*V,this._z*V)}scaleToRef(V,I){return I._x=this._x*V,I._y=this._y*V,I._z=this._z*V,I._isDirty=!0,I}getNormalToRef(V){const I=this.length();let m=Math.acos(this._y/I);const C=Math.atan2(this._z,this._x);m>Math.PI/2?m-=Math.PI/2:m+=Math.PI/2;const l=I*Math.sin(m)*Math.cos(C),s=I*Math.cos(m),F=I*Math.sin(m)*Math.sin(C);return V.set(l,s,F),V}applyRotationQuaternionToRef(V,I){const m=this._x,C=this._y,l=this._z,s=V._x,F=V._y,k=V._z,j=V._w,E=2*(F*l-k*C),K=2*(k*m-s*l),Y=2*(s*C-F*m);return I._x=m+j*E+F*Y-k*K,I._y=C+j*K+k*E-s*Y,I._z=l+j*Y+s*K-F*E,I._isDirty=!0,I}applyRotationQuaternionInPlace(V){return this.applyRotationQuaternionToRef(V,this)}applyRotationQuaternion(V){return this.applyRotationQuaternionToRef(V,new N)}scaleAndAddToRef(V,I){return I._x+=this._x*V,I._y+=this._y*V,I._z+=this._z*V,I._isDirty=!0,I}projectOnPlane(V,I){return this.projectOnPlaneToRef(V,I,new N)}projectOnPlaneToRef(V,I,m){const C=V.XC,l=V.d,s=T.LF[0];this.subtractToRef(I,s),s.normalize();const F=N.Dot(s,C);if(Math.abs(F)<1e-10)m.mk(1/0);else{const V=-(N.Dot(I,C)+l)/F,k=s.scaleInPlace(V);I.addToRef(k,m)}return m}equals(V){return V&&this._x===V._x&&this._y===V._y&&this._z===V._z}equalsWithEpsilon(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:C.c;return V&&(0,j.WithinEpsilon)(this._x,V._x,I)&&(0,j.WithinEpsilon)(this._y,V._y,I)&&(0,j.WithinEpsilon)(this._z,V._z,I)}equalsToFloats(V,I,m){return this._x===V&&this._y===I&&this._z===m}multiplyInPlace(V){return this._x*=V._x,this._y*=V._y,this._z*=V._z,this._isDirty=!0,this}multiply(V){return this.multiplyByFloats(V._x,V._y,V._z)}multiplyToRef(V,I){return I._x=this._x*V._x,I._y=this._y*V._y,I._z=this._z*V._z,I._isDirty=!0,I}multiplyByFloats(V,I,m){return new N(this._x*V,this._y*I,this._z*m)}divide(V){return new N(this._x/V._x,this._y/V._y,this._z/V._z)}divideToRef(V,I){return I._x=this._x/V._x,I._y=this._y/V._y,I._z=this._z/V._z,I._isDirty=!0,I}divideInPlace(V){return this._x=this._x/V._x,this._y=this._y/V._y,this._z=this._z/V._z,this._isDirty=!0,this}minimizeInPlace(V){return this.minimizeInPlaceFromFloats(V._x,V._y,V._z)}maximizeInPlace(V){return this.maximizeInPlaceFromFloats(V._x,V._y,V._z)}minimizeInPlaceFromFloats(V,I,m){return V<this._x&&(this.x=V),I<this._y&&(this.y=I),m<this._z&&(this.z=m),this}maximizeInPlaceFromFloats(V,I,m){return V>this._x&&(this.x=V),I>this._y&&(this.y=I),m>this._z&&(this.z=m),this}isNonUniformWithinEpsilon(V){const I=Math.abs(this._x),m=Math.abs(this._y);if(!(0,j.WithinEpsilon)(I,m,V))return!0;const C=Math.abs(this._z);return!(0,j.WithinEpsilon)(I,C,V)||!(0,j.WithinEpsilon)(m,C,V)}get isNonUniform(){const V=Math.abs(this._x);if(V!==Math.abs(this._y))return!0;return V!==Math.abs(this._z)}floorToRef(V){return V._x=Math.floor(this._x),V._y=Math.floor(this._y),V._z=Math.floor(this._z),V._isDirty=!0,V}floor(){return new N(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))}fractToRef(V){return V._x=this._x-Math.floor(this._x),V._y=this._y-Math.floor(this._y),V._z=this._z-Math.floor(this._z),V._isDirty=!0,V}fract(){return new N(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z))}length(){return Math.sqrt(this.lengthSquared())}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z}get hasAZeroComponent(){return this._x*this._y*this._z===0}normalize(){return this.normalizeFromLength(this.length())}reorderInPlace(V){if("xyz"===(V=V.toLowerCase()))return this;const I=T.LF[0].C(this);return this.x=I[V[0]],this.y=I[V[1]],this.z=I[V[2]],this}rotateByQuaternionToRef(V,I){return V.toRotationMatrix(T.Matrix[0]),N.TransformCoordinatesToRef(this,T.Matrix[0],I),I}rotateByQuaternionAroundPointToRef(V,I,m){return this.subtractToRef(I,T.LF[0]),T.LF[0].rotateByQuaternionToRef(V,T.LF[0]),I.addToRef(T.LF[0],m),m}cross(V){return N.CrossToRef(this,V,new N)}normalizeFromLength(V){return 0===V||1===V?this:this.scaleInPlace(1/V)}normalizeToNew(){return this.normalizeToRef(new N)}normalizeToRef(V){const I=this.length();return 0===I||1===I?(V._x=this._x,V._y=this._y,V._z=this._z,V._isDirty=!0,V):this.scaleToRef(1/I,V)}clone(){return new N(this._x,this._y,this._z)}C(V){return this.aF(V._x,V._y,V._z)}aF(V,I,m){return this._x=V,this._y=I,this._z=m,this._isDirty=!0,this}set(V,I,m){return this.aF(V,I,m)}mk(V){return this._x=this._y=this._z=V,this._isDirty=!0,this}static GetClipFactor(V,I,m,C){const l=N.Dot(V,m);return(l-C)/(l-N.Dot(I,m))}static GetAngleBetweenVectors(V,I,m){const C=V.normalizeToRef(T.LF[1]),l=I.normalizeToRef(T.LF[2]);let s=N.Dot(C,l);s=(0,j.Clamp)(s,-1,1);const F=Math.acos(s),k=T.LF[3];return N.CrossToRef(C,l,k),N.Dot(k,m)>0?isNaN(F)?0:F:isNaN(F)?-Math.PI:-Math.acos(s)}static GetAngleBetweenVectorsOnPlane(V,I,m){T.LF[0].C(V);const C=T.LF[0];T.LF[1].C(I);const l=T.LF[1];T.LF[2].C(m);const s=T.LF[2],F=T.LF[3],k=T.LF[4];C.normalize(),l.normalize(),s.normalize(),N.CrossToRef(s,C,F),N.CrossToRef(F,s,k);const E=Math.atan2(N.Dot(l,F),N.Dot(l,k));return(0,j.NormalizeRadians)(E)}static PitchYawRollToMoveBetweenPointsToRef(V,I,m){const C=n.LF[0];return I.subtractToRef(V,C),m._y=Math.atan2(C.x,C.z)||0,m._x=Math.atan2(Math.sqrt(C.x**2+C.z**2),C.y)||0,m._z=0,m._isDirty=!0,m}static PitchYawRollToMoveBetweenPoints(V,I){const m=N.Zero();return N.PitchYawRollToMoveBetweenPointsToRef(V,I,m)}static SlerpToRef(V,I,m,l){m=(0,j.Clamp)(m,0,1);const s=T.LF[0],F=T.LF[1];s.C(V);const k=s.length();s.normalizeFromLength(k),F.C(I);const E=F.length();F.normalizeFromLength(E);const K=N.Dot(s,F);let Y,X;if(K<1-C.c){const V=Math.acos(K),I=1/Math.sin(V);Y=Math.sin((1-m)*V)*I,X=Math.sin(m*V)*I}else Y=1-m,X=m;return s.scaleInPlace(Y),F.scaleInPlace(X),l.C(s).addInPlace(F),l.scaleInPlace((0,j.Lerp)(k,E,m)),l}static SmoothToRef(V,I,m,C,l){return N.SlerpToRef(V,I,0===C?1:m/C,l),l}static Ik(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new N(V[I],V[I+1],V[I+2])}static FromFloatArray(V,I){return N.Ik(V,I)}static FromArrayToRef(V,I,m){return m._x=V[I],m._y=V[I+1],m._z=V[I+2],m._isDirty=!0,m}static FromFloatArrayToRef(V,I,m){return N.FromArrayToRef(V,I,m)}static FromFloatsToRef(V,I,m,C){return C.aF(V,I,m),C}static Zero(){return new N(0,0,0)}static One(){return new N(1,1,1)}static Up(){return new N(0,1,0)}static get UpReadOnly(){return N._UpReadOnly}static get DownReadOnly(){return N._DownReadOnly}static get RightReadOnly(){return N._RightReadOnly}static get LeftReadOnly(){return N._LeftReadOnly}static get LeftHandedForwardReadOnly(){return N._LeftHandedForwardReadOnly}static get RightHandedForwardReadOnly(){return N._RightHandedForwardReadOnly}static get LeftHandedBackwardReadOnly(){return N._LeftHandedBackwardReadOnly}static get RightHandedBackwardReadOnly(){return N._RightHandedBackwardReadOnly}static get ZeroReadOnly(){return N._ZeroReadOnly}static get OneReadOnly(){return N._OneReadOnly}static Down(){return new N(0,-1,0)}static Forward(){return new N(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?-1:1)}static Backward(){return new N(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?1:-1)}static Right(){return new N(1,0,0)}static Left(){return new N(-1,0,0)}static Random(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new N((0,j.RandomRange)(V,I),(0,j.RandomRange)(V,I),(0,j.RandomRange)(V,I))}static RandomToRef(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).aF((0,j.RandomRange)(V,I),(0,j.RandomRange)(V,I),(0,j.RandomRange)(V,I))}static TransformCoordinates(V,I){const m=N.Zero();return N.TransformCoordinatesToRef(V,I,m),m}static TransformCoordinatesToRef(V,I,m){return N.TransformCoordinatesFromFloatsToRef(V._x,V._y,V._z,I,m),m}static TransformCoordinatesFromFloatsToRef(V,I,m,C,l){const s=C.m,F=V*s[0]+I*s[4]+m*s[8]+s[12],k=V*s[1]+I*s[5]+m*s[9]+s[13],j=V*s[2]+I*s[6]+m*s[10]+s[14],E=1/(V*s[3]+I*s[7]+m*s[11]+s[15]);return l._x=F*E,l._y=k*E,l._z=j*E,l._isDirty=!0,l}static TransformNormal(V,I){const m=N.Zero();return N.TransformNormalToRef(V,I,m),m}static TransformNormalToRef(V,I,m){return this.TransformNormalFromFloatsToRef(V._x,V._y,V._z,I,m),m}static TransformNormalFromFloatsToRef(V,I,m,C,l){const s=C.m;return l._x=V*s[0]+I*s[4]+m*s[8],l._y=V*s[1]+I*s[5]+m*s[9],l._z=V*s[2]+I*s[6]+m*s[10],l._isDirty=!0,l}static CatmullRom(V,I,m,C,l){const s=l*l,F=l*s,k=.5*(2*I._x+(-V._x+m._x)*l+(2*V._x-5*I._x+4*m._x-C._x)*s+(-V._x+3*I._x-3*m._x+C._x)*F),j=.5*(2*I._y+(-V._y+m._y)*l+(2*V._y-5*I._y+4*m._y-C._y)*s+(-V._y+3*I._y-3*m._y+C._y)*F),E=.5*(2*I._z+(-V._z+m._z)*l+(2*V._z-5*I._z+4*m._z-C._z)*s+(-V._z+3*I._z-3*m._z+C._z)*F);return new N(k,j,E)}static Clamp(V,I,m){const C=new N;return N.ClampToRef(V,I,m,C),C}static ClampToRef(V,I,m,C){let l=V._x;l=l>m._x?m._x:l,l=l<I._x?I._x:l;let s=V._y;s=s>m._y?m._y:s,s=s<I._y?I._y:s;let F=V._z;return F=F>m._z?m._z:F,F=F<I._z?I._z:F,C.aF(l,s,F),C}static CheckExtends(V,I,m){I.minimizeInPlace(V),m.maximizeInPlace(V)}static Hermite(V,I,m,C,l){const s=l*l,F=l*s,k=2*F-3*s+1,j=-2*F+3*s,E=F-2*s+l,K=F-s,Y=V._x*k+m._x*j+I._x*E+C._x*K,X=V._y*k+m._y*j+I._y*E+C._y*K,O=V._z*k+m._z*j+I._z*E+C._z*K;return new N(Y,X,O)}static Hermite1stDerivative(V,I,m,C,l){const s=new N;return this.Hermite1stDerivativeToRef(V,I,m,C,l,s),s}static Hermite1stDerivativeToRef(V,I,m,C,l,s){const F=l*l;return s._x=6*(F-l)*V._x+(3*F-4*l+1)*I._x+6*(-F+l)*m._x+(3*F-2*l)*C._x,s._y=6*(F-l)*V._y+(3*F-4*l+1)*I._y+6*(-F+l)*m._y+(3*F-2*l)*C._y,s._z=6*(F-l)*V._z+(3*F-4*l+1)*I._z+6*(-F+l)*m._z+(3*F-2*l)*C._z,s._isDirty=!0,s}static Lerp(V,I,m){const C=new N(0,0,0);return N.LerpToRef(V,I,m,C),C}static LerpToRef(V,I,m,C){return C._x=V._x+(I._x-V._x)*m,C._y=V._y+(I._y-V._y)*m,C._z=V._z+(I._z-V._z)*m,C._isDirty=!0,C}static Dot(V,I){return V._x*I._x+V._y*I._y+V._z*I._z}dot(V){return this._x*V._x+this._y*V._y+this._z*V._z}static Cross(V,I){const m=new N;return N.CrossToRef(V,I,m),m}static CrossToRef(V,I,m){const C=V._y*I._z-V._z*I._y,l=V._z*I._x-V._x*I._z,s=V._x*I._y-V._y*I._x;return m.aF(C,l,s),m}static Normalize(V){const I=N.Zero();return N.NormalizeToRef(V,I),I}static NormalizeToRef(V,I){return V.normalizeToRef(I),I}static Project(V,I,m,C){const l=new N;return N.ProjectToRef(V,I,m,C,l),l}static ProjectToRef(V,I,m,C,l){var s;const F=C.width,j=C.height,E=C.x,K=C.y,Y=T.Matrix[1],X=null===(s=k.c.LastCreatedEngine)||void 0===s?void 0:s.isNDCHalfZRange,O=X?1:.5,v=X?0:.5;b.FromValuesToRef(F/2,0,0,0,0,-j/2,0,0,0,0,O,0,E+F/2,j/2+K,v,1,Y);const t=T.Matrix[0];return I.multiplyToRef(m,t),t.multiplyToRef(Y,t),N.TransformCoordinatesToRef(V,t,l),l}static Reflect(V,I){return this.ReflectToRef(V,I,new N)}static ReflectToRef(V,I,m){const C=n.LF[0];return C.C(I).scaleInPlace(2*N.Dot(V,I)),m.C(V).WK(C)}static _UnprojectFromInvertedMatrixToRef(V,I,m){N.TransformCoordinatesToRef(V,I,m);const C=I.m,l=V._x*C[3]+V._y*C[7]+V._z*C[11]+C[15];return(0,j.WithinEpsilon)(l,1)&&m.scaleInPlace(1/l),m}static UnprojectFromTransform(V,I,m,C,l){return this.Unproject(V,I,m,C,l,b.IdentityReadOnly)}static Unproject(V,I,m,C,l,s){const F=new N;return N.UnprojectToRef(V,I,m,C,l,s,F),F}static UnprojectToRef(V,I,m,C,l,s,F){return N.UnprojectFloatsToRef(V._x,V._y,V._z,I,m,C,l,s,F),F}static UnprojectFloatsToRef(V,I,m,C,l,s,F,j,E){var K;const Y=T.Matrix[0];s.multiplyToRef(F,Y),Y.multiplyToRef(j,Y),Y.invert();const X=T.LF[0];return X.x=V/C*2-1,X.y=-(I/l*2-1),null!==(K=k.c.LastCreatedEngine)&&void 0!==K&&K.isNDCHalfZRange?X.z=m:X.z=2*m-1,N._UnprojectFromInvertedMatrixToRef(X,Y,E),E}static Minimize(V,I){const m=new N;return m.C(V),m.minimizeInPlace(I),m}static Maximize(V,I){const m=new N;return m.C(V),m.maximizeInPlace(I),m}static Distance(V,I){return Math.sqrt(N.DistanceSquared(V,I))}static DistanceSquared(V,I){const m=V._x-I._x,C=V._y-I._y,l=V._z-I._z;return m*m+C*C+l*l}static ProjectOnTriangleToRef(V,I,m,l,s){const F=T.LF[0],k=T.LF[1],E=T.LF[2],K=T.LF[3],Y=T.LF[4];m.subtractToRef(I,F),l.subtractToRef(I,k),l.subtractToRef(m,E);const X=F.length(),O=k.length(),v=E.length();if(X<C.c||O<C.c||v<C.c)return s.C(I),N.Distance(V,I);V.subtractToRef(I,Y),N.CrossToRef(F,k,K);const t=K.length();if(t<C.c)return s.C(I),N.Distance(V,I);K.normalizeFromLength(t);let D=Y.length();if(D<C.c)return s.C(I),0;Y.normalizeFromLength(D);const b=N.Dot(K,Y),n=T.LF[5],x=T.LF[6];n.C(K).scaleInPlace(-D*b),x.C(V).addInPlace(n);const S=T.LF[4],c=T.LF[5],H=T.LF[7],y=T.LF[8];S.C(F).scaleInPlace(1/X),y.C(k).scaleInPlace(1/O),S.addInPlace(y).scaleInPlace(-1),c.C(F).scaleInPlace(-1/X),y.C(E).scaleInPlace(1/v),c.addInPlace(y).scaleInPlace(-1),H.C(E).scaleInPlace(-1/v),y.C(k).scaleInPlace(-1/O),H.addInPlace(y).scaleInPlace(-1);const z=T.LF[9];let Z;z.C(x).WK(I),N.CrossToRef(S,z,y),Z=N.Dot(y,K);const B=Z;z.C(x).WK(m),N.CrossToRef(c,z,y),Z=N.Dot(y,K);const W=Z;z.C(x).WK(l),N.CrossToRef(H,z,y),Z=N.Dot(y,K);const Q=Z,G=T.LF[10];let r,g;B>0&&W<0?(G.C(F),r=I,g=m):W>0&&Q<0?(G.C(E),r=m,g=l):(G.C(k).scaleInPlace(-1),r=l,g=I);const h=T.LF[9],d=T.LF[4];r.subtractToRef(x,y),g.subtractToRef(x,h),N.CrossToRef(y,h,d);if(!(N.Dot(d,K)<0))return s.C(x),Math.abs(D*b);const R=T.LF[5];N.CrossToRef(G,d,R),R.normalize();const i=T.LF[9];i.C(r).WK(x);const q=i.length();if(q<C.c)return s.C(r),N.Distance(V,r);i.normalizeFromLength(q);const P=N.Dot(R,i),u=T.LF[7];u.C(x).addInPlace(R.scaleInPlace(q*P)),y.C(u).WK(r),D=G.length(),G.normalizeFromLength(D);let o=N.Dot(y,G)/Math.max(D,C.c);return o=(0,j.Clamp)(o,0,1),u.C(r).addInPlace(G.scaleInPlace(o*D)),s.C(u),N.Distance(V,u)}static Center(V,I){return N.CenterToRef(V,I,N.Zero())}static CenterToRef(V,I,m){return m.aF((V._x+I._x)/2,(V._y+I._y)/2,(V._z+I._z)/2)}static RotationFromAxis(V,I,m){const C=new N;return N.RotationFromAxisToRef(V,I,m,C),C}static RotationFromAxisToRef(V,I,m,C){const l=T.Quaternion[0];return D.RotationQuaternionFromAxisToRef(V,I,m,l),l.toEulerAnglesToRef(C),C}}N._V8PerformanceHack=new N(.5,.5,.5),N._UpReadOnly=N.Up(),N._DownReadOnly=N.Down(),N._LeftHandedForwardReadOnly=N.Forward(!1),N._RightHandedForwardReadOnly=N.Forward(!0),N._LeftHandedBackwardReadOnly=N.Backward(!1),N._RightHandedBackwardReadOnly=N.Backward(!0),N._RightReadOnly=N.Right(),N._LeftReadOnly=N.Left(),N._ZeroReadOnly=N.Zero(),N._OneReadOnly=N.One(),Object.defineProperties(N.prototype,{dimension:{value:[3]},rank:{value:1}});class t{get x(){return this._x}set x(V){this._x=V,this._isDirty=!0}get y(){return this._y}set y(V){this._y=V,this._isDirty=!0}get z(){return this._z}set z(V){this._z=V,this._isDirty=!0}get w(){return this._w}set w(V){this._w=V,this._isDirty=!0}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._isDirty=!0,this._x=V,this._y=I,this._z=m,this._w=C}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Vector4"}getHashCode(){let V=O(this._x);return V=397*V^O(this._y),V=397*V^O(this._z),V=397*V^O(this._w),V}UF(){return[this._x,this._y,this._z,this._w]}toArray(V,I){return void 0===I&&(I=0),V[I]=this._x,V[I+1]=this._y,V[I+2]=this._z,V[I+3]=this._w,this}km(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.FromArrayToRef(V,I,this),this}addInPlace(V){return this.x+=V._x,this.y+=V._y,this.z+=V._z,this.w+=V._w,this}addInPlaceFromFloats(V,I,m,C){return this.x+=V,this.y+=I,this.z+=m,this.w+=C,this}add(V){return new t(this._x+V.x,this._y+V.y,this._z+V.z,this._w+V.w)}addToRef(V,I){return I.x=this._x+V.x,I.y=this._y+V.y,I.z=this._z+V.z,I.w=this._w+V.w,I}WK(V){return this.x-=V.x,this.y-=V.y,this.z-=V.z,this.w-=V.w,this}Fm(V){return new t(this._x-V.x,this._y-V.y,this._z-V.z,this._w-V.w)}subtractToRef(V,I){return I.x=this._x-V.x,I.y=this._y-V.y,I.z=this._z-V.z,I.w=this._w-V.w,I}subtractFromFloats(V,I,m,C){return new t(this._x-V,this._y-I,this._z-m,this._w-C)}subtractFromFloatsToRef(V,I,m,C,l){return l.x=this._x-V,l.y=this._y-I,l.z=this._z-m,l.w=this._w-C,l}negate(){return new t(-this._x,-this._y,-this._z,-this._w)}negateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}negateToRef(V){return V.x=-this._x,V.y=-this._y,V.z=-this._z,V.w=-this._w,V}scaleInPlace(V){return this.x*=V,this.y*=V,this.z*=V,this.w*=V,this}scale(V){return new t(this._x*V,this._y*V,this._z*V,this._w*V)}scaleToRef(V,I){return I.x=this._x*V,I.y=this._y*V,I.z=this._z*V,I.w=this._w*V,I}scaleAndAddToRef(V,I){return I.x+=this._x*V,I.y+=this._y*V,I.z+=this._z*V,I.w+=this._w*V,I}equals(V){return V&&this._x===V.x&&this._y===V.y&&this._z===V.z&&this._w===V.w}equalsWithEpsilon(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:C.c;return V&&(0,j.WithinEpsilon)(this._x,V.x,I)&&(0,j.WithinEpsilon)(this._y,V.y,I)&&(0,j.WithinEpsilon)(this._z,V.z,I)&&(0,j.WithinEpsilon)(this._w,V.w,I)}equalsToFloats(V,I,m,C){return this._x===V&&this._y===I&&this._z===m&&this._w===C}multiplyInPlace(V){return this.x*=V.x,this.y*=V.y,this.z*=V.z,this.w*=V.w,this}multiply(V){return new t(this._x*V.x,this._y*V.y,this._z*V.z,this._w*V.w)}multiplyToRef(V,I){return I.x=this._x*V.x,I.y=this._y*V.y,I.z=this._z*V.z,I.w=this._w*V.w,I}multiplyByFloats(V,I,m,C){return new t(this._x*V,this._y*I,this._z*m,this._w*C)}divide(V){return new t(this._x/V.x,this._y/V.y,this._z/V.z,this._w/V.w)}divideToRef(V,I){return I.x=this._x/V.x,I.y=this._y/V.y,I.z=this._z/V.z,I.w=this._w/V.w,I}divideInPlace(V){return this.divideToRef(V,this)}minimizeInPlace(V){return V.x<this._x&&(this.x=V.x),V.y<this._y&&(this.y=V.y),V.z<this._z&&(this.z=V.z),V.w<this._w&&(this.w=V.w),this}maximizeInPlace(V){return V.x>this._x&&(this.x=V.x),V.y>this._y&&(this.y=V.y),V.z>this._z&&(this.z=V.z),V.w>this._w&&(this.w=V.w),this}minimizeInPlaceFromFloats(V,I,m,C){return this.x=Math.min(V,this._x),this.y=Math.min(I,this._y),this.z=Math.min(m,this._z),this.w=Math.min(C,this._w),this}maximizeInPlaceFromFloats(V,I,m,C){return this.x=Math.max(V,this._x),this.y=Math.max(I,this._y),this.z=Math.max(m,this._z),this.w=Math.max(C,this._w),this}floorToRef(V){return V.x=Math.floor(this._x),V.y=Math.floor(this._y),V.z=Math.floor(this._z),V.w=Math.floor(this._w),V}floor(){return new t(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z),Math.floor(this._w))}fractToRef(V){return V.x=this._x-Math.floor(this._x),V.y=this._y-Math.floor(this._y),V.z=this._z-Math.floor(this._z),V.w=this._w-Math.floor(this._w),V}fract(){return new t(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z),this._w-Math.floor(this._w))}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(V){return 0===V||1===V?this:this.scaleInPlace(1/V)}normalizeToNew(){return this.normalizeToRef(new t)}normalizeToRef(V){const I=this.length();return 0===I||1===I?(V.x=this._x,V.y=this._y,V.z=this._z,V.w=this._w,V):this.scaleToRef(1/I,V)}toVector3(){return new N(this._x,this._y,this._z)}clone(){return new t(this._x,this._y,this._z,this._w)}C(V){return this.x=V.x,this.y=V.y,this.z=V.z,this.w=V.w,this}aF(V,I,m,C){return this.x=V,this.y=I,this.z=m,this.w=C,this}set(V,I,m,C){return this.aF(V,I,m,C)}mk(V){return this.x=this.y=this.z=this.w=V,this}dot(V){return this._x*V.x+this._y*V.y+this._z*V.z+this._w*V.w}static Ik(V,I){return I||(I=0),new t(V[I],V[I+1],V[I+2],V[I+3])}static FromArrayToRef(V,I,m){return m.x=V[I],m.y=V[I+1],m.z=V[I+2],m.w=V[I+3],m}static FromFloatArrayToRef(V,I,m){return t.FromArrayToRef(V,I,m),m}static FromFloatsToRef(V,I,m,C,l){return l.x=V,l.y=I,l.z=m,l.w=C,l}static Zero(){return new t(0,0,0,0)}static One(){return new t(1,1,1,1)}static Random(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new t((0,j.RandomRange)(V,I),(0,j.RandomRange)(V,I),(0,j.RandomRange)(V,I),(0,j.RandomRange)(V,I))}static RandomToRef(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m=arguments.length>2?arguments[2]:void 0;return m.x=(0,j.RandomRange)(V,I),m.y=(0,j.RandomRange)(V,I),m.z=(0,j.RandomRange)(V,I),m.w=(0,j.RandomRange)(V,I),m}static Clamp(V,I,m){return t.ClampToRef(V,I,m,new t)}static ClampToRef(V,I,m,C){return C.x=(0,j.Clamp)(V.x,I.x,m.x),C.y=(0,j.Clamp)(V.y,I.y,m.y),C.z=(0,j.Clamp)(V.z,I.z,m.z),C.w=(0,j.Clamp)(V.w,I.w,m.w),C}static CheckExtends(V,I,m){I.minimizeInPlace(V),m.maximizeInPlace(V)}static get ZeroReadOnly(){return t._ZeroReadOnly}static Normalize(V){return t.NormalizeToRef(V,new t)}static NormalizeToRef(V,I){return V.normalizeToRef(I),I}static Minimize(V,I){const m=new t;return m.C(V),m.minimizeInPlace(I),m}static Maximize(V,I){const m=new t;return m.C(V),m.maximizeInPlace(I),m}static Distance(V,I){return Math.sqrt(t.DistanceSquared(V,I))}static DistanceSquared(V,I){const m=V.x-I.x,C=V.y-I.y,l=V.z-I.z,s=V.w-I.w;return m*m+C*C+l*l+s*s}static Center(V,I){return t.CenterToRef(V,I,new t)}static CenterToRef(V,I,m){return m.x=(V.x+I.x)/2,m.y=(V.y+I.y)/2,m.z=(V.z+I.z)/2,m.w=(V.w+I.w)/2,m}static TransformCoordinates(V,I){return t.TransformCoordinatesToRef(V,I,new t)}static TransformCoordinatesToRef(V,I,m){return t.TransformCoordinatesFromFloatsToRef(V._x,V._y,V._z,I,m),m}static TransformCoordinatesFromFloatsToRef(V,I,m,C,l){const s=C.m,F=V*s[0]+I*s[4]+m*s[8]+s[12],k=V*s[1]+I*s[5]+m*s[9]+s[13],j=V*s[2]+I*s[6]+m*s[10]+s[14],E=V*s[3]+I*s[7]+m*s[11]+s[15];return l.x=F,l.y=k,l.z=j,l.w=E,l}static TransformNormal(V,I){return t.TransformNormalToRef(V,I,new t)}static TransformNormalToRef(V,I,m){const C=I.m,l=V.x*C[0]+V.y*C[4]+V.z*C[8],s=V.x*C[1]+V.y*C[5]+V.z*C[9],F=V.x*C[2]+V.y*C[6]+V.z*C[10];return m.x=l,m.y=s,m.z=F,m.w=V.w,m}static TransformNormalFromFloatsToRef(V,I,m,C,l,s){const F=l.m;return s.x=V*F[0]+I*F[4]+m*F[8],s.y=V*F[1]+I*F[5]+m*F[9],s.z=V*F[2]+I*F[6]+m*F[10],s.w=C,s}static FromVector3(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new t(V._x,V._y,V._z,I)}static Dot(V,I){return V.x*I.x+V.y*I.y+V.z*I.z+V.w*I.w}}t._V8PerformanceHack=new t(.5,.5,.5,.5),t._ZeroReadOnly=t.Zero(),Object.defineProperties(t.prototype,{dimension:{value:[4]},rank:{value:1}});class D{get x(){return this._x}set x(V){this._x=V,this._isDirty=!0}get y(){return this._y}set y(V){this._y=V,this._isDirty=!0}get z(){return this._z}set z(V){this._z=V,this._isDirty=!0}get w(){return this._w}set w(V){this._w=V,this._isDirty=!0}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this._isDirty=!0,this._x=V,this._y=I,this._z=m,this._w=C}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Quaternion"}getHashCode(){let V=O(this._x);return V=397*V^O(this._y),V=397*V^O(this._z),V=397*V^O(this._w),V}UF(){return[this._x,this._y,this._z,this._w]}toArray(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return V[I]=this._x,V[I+1]=this._y,V[I+2]=this._z,V[I+3]=this._w,this}km(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return D.FromArrayToRef(V,I,this)}equals(V){return V&&this._x===V._x&&this._y===V._y&&this._z===V._z&&this._w===V._w}equalsWithEpsilon(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:C.c;return V&&(0,j.WithinEpsilon)(this._x,V._x,I)&&(0,j.WithinEpsilon)(this._y,V._y,I)&&(0,j.WithinEpsilon)(this._z,V._z,I)&&(0,j.WithinEpsilon)(this._w,V._w,I)}isApprox(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:C.c;return V&&((0,j.WithinEpsilon)(this._x,V._x,I)&&(0,j.WithinEpsilon)(this._y,V._y,I)&&(0,j.WithinEpsilon)(this._z,V._z,I)&&(0,j.WithinEpsilon)(this._w,V._w,I)||(0,j.WithinEpsilon)(this._x,-V._x,I)&&(0,j.WithinEpsilon)(this._y,-V._y,I)&&(0,j.WithinEpsilon)(this._z,-V._z,I)&&(0,j.WithinEpsilon)(this._w,-V._w,I))}clone(){return new D(this._x,this._y,this._z,this._w)}C(V){return this._x=V._x,this._y=V._y,this._z=V._z,this._w=V._w,this._isDirty=!0,this}aF(V,I,m,C){return this._x=V,this._y=I,this._z=m,this._w=C,this._isDirty=!0,this}set(V,I,m,C){return this.aF(V,I,m,C)}mk(V){return this.aF(V,V,V,V)}add(V){return new D(this._x+V._x,this._y+V._y,this._z+V._z,this._w+V._w)}addInPlace(V){return this._x+=V._x,this._y+=V._y,this._z+=V._z,this._w+=V._w,this._isDirty=!0,this}addToRef(V,I){return I._x=this._x+V._x,I._y=this._y+V._y,I._z=this._z+V._z,I._w=this._w+V._w,I._isDirty=!0,I}addInPlaceFromFloats(V,I,m,C){return this._x+=V,this._y+=I,this._z+=m,this._w+=C,this._isDirty=!0,this}subtractToRef(V,I){return I._x=this._x-V._x,I._y=this._y-V._y,I._z=this._z-V._z,I._w=this._w-V._w,I._isDirty=!0,I}subtractFromFloats(V,I,m,C){return this.subtractFromFloatsToRef(V,I,m,C,new D)}subtractFromFloatsToRef(V,I,m,C,l){return l._x=this._x-V,l._y=this._y-I,l._z=this._z-m,l._w=this._w-C,l._isDirty=!0,l}Fm(V){return new D(this._x-V._x,this._y-V._y,this._z-V._z,this._w-V._w)}WK(V){return this._x-=V._x,this._y-=V._y,this._z-=V._z,this._w-=V._w,this._isDirty=!0,this}scale(V){return new D(this._x*V,this._y*V,this._z*V,this._w*V)}scaleToRef(V,I){return I._x=this._x*V,I._y=this._y*V,I._z=this._z*V,I._w=this._w*V,I._isDirty=!0,I}scaleInPlace(V){return this._x*=V,this._y*=V,this._z*=V,this._w*=V,this._isDirty=!0,this}scaleAndAddToRef(V,I){return I._x+=this._x*V,I._y+=this._y*V,I._z+=this._z*V,I._w+=this._w*V,I._isDirty=!0,I}multiply(V){const I=new D(0,0,0,1);return this.multiplyToRef(V,I),I}multiplyToRef(V,I){const m=this._x*V._w+this._y*V._z-this._z*V._y+this._w*V._x,C=-this._x*V._z+this._y*V._w+this._z*V._x+this._w*V._y,l=this._x*V._y-this._y*V._x+this._z*V._w+this._w*V._z,s=-this._x*V._x-this._y*V._y-this._z*V._z+this._w*V._w;return I.aF(m,C,l,s),I}multiplyInPlace(V){return this.multiplyToRef(V,this)}multiplyByFloats(V,I,m,C){return this._x*=V,this._y*=I,this._z*=m,this._w*=C,this._isDirty=!0,this}divide(V){throw new ReferenceError("Can not divide a quaternion")}divideToRef(V,I){throw new ReferenceError("Can not divide a quaternion")}divideInPlace(V){throw new ReferenceError("Can not divide a quaternion")}minimizeInPlace(){throw new ReferenceError("Can not minimize a quaternion")}minimizeInPlaceFromFloats(){throw new ReferenceError("Can not minimize a quaternion")}maximizeInPlace(){throw new ReferenceError("Can not maximize a quaternion")}maximizeInPlaceFromFloats(){throw new ReferenceError("Can not maximize a quaternion")}negate(){return this.negateToRef(new D)}negateInPlace(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._isDirty=!0,this}negateToRef(V){return V._x=-this._x,V._y=-this._y,V._z=-this._z,V._w=-this._w,V._isDirty=!0,V}equalsToFloats(V,I,m,C){return this._x===V&&this._y===I&&this._z===m&&this._w===C}floorToRef(V){throw new ReferenceError("Can not floor a quaternion")}floor(){throw new ReferenceError("Can not floor a quaternion")}fractToRef(V){throw new ReferenceError("Can not fract a quaternion")}fract(){throw new ReferenceError("Can not fract a quaternion")}conjugateToRef(V){return V.aF(-this._x,-this._y,-this._z,this._w),V}conjugateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}conjugate(){return new D(-this._x,-this._y,-this._z,this._w)}invert(){const V=this.conjugate(),I=this.lengthSquared();return 0==I||1==I||V.scaleInPlace(1/I),V}invertInPlace(){this.conjugateInPlace();const V=this.lengthSquared();return 0==V||1==V||this.scaleInPlace(1/V),this}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this.lengthSquared())}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(V){return 0===V||1===V?this:this.scaleInPlace(1/V)}normalizeToNew(){const V=new D(0,0,0,1);return this.normalizeToRef(V),V}normalizeToRef(V){const I=this.length();return 0===I||1===I?V.aF(this._x,this._y,this._z,this._w):this.scaleToRef(1/I,V)}toEulerAngles(){const V=N.Zero();return this.toEulerAnglesToRef(V),V}toEulerAnglesToRef(V){const I=this._z,m=this._x,C=this._y,l=this._w,s=C*I-m*l,F=.4999999;if(s<-F)V._y=2*Math.atan2(C,l),V._x=Math.PI/2,V._z=0,V._isDirty=!0;else if(s>F)V._y=2*Math.atan2(C,l),V._x=-Math.PI/2,V._z=0,V._isDirty=!0;else{const F=l*l,k=I*I,j=m*m,E=C*C;V._z=Math.atan2(2*(m*C+I*l),-k-j+E+F),V._x=Math.asin(-2*s),V._y=Math.atan2(2*(I*m+C*l),k-j-E+F),V._isDirty=!0}return V}toAlphaBetaGammaToRef(V){const I=this._z,m=this._x,C=this._y,l=this._w,s=Math.sqrt(m*m+C*C),F=Math.sqrt(I*I+l*l),k=2*Math.atan2(s,F),j=2*Math.atan2(I,l),E=2*Math.atan2(C,m),K=(j+E)/2,Y=(j-E)/2;return V.set(Y,k,K),V}toRotationMatrix(V){return b.FromQuaternionToRef(this,V),V}fromRotationMatrix(V){return D.FromRotationMatrixToRef(V,this),this}dot(V){return this._x*V._x+this._y*V._y+this._z*V._z+this._w*V._w}toAxisAngle(){const V=N.Zero();return{axis:V,angle:this.toAxisAngleToRef(V)}}toAxisAngleToRef(V){let I=0;const m=Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z),C=this._w;return m>0?(I=2*Math.atan2(m,C),V.set(this._x/m,this._y/m,this._z/m)):(I=0,V.set(1,0,0)),I}static FromRotationMatrix(V){const I=new D;return D.FromRotationMatrixToRef(V,I),I}static FromRotationMatrixToRef(V,I){const m=V.m,C=m[0],l=m[4],s=m[8],F=m[1],k=m[5],j=m[9],E=m[2],K=m[6],Y=m[10],X=C+k+Y;let O;return X>0?(O=.5/Math.sqrt(X+1),I._w=.25/O,I._x=(K-j)*O,I._y=(s-E)*O,I._z=(F-l)*O,I._isDirty=!0):C>k&&C>Y?(O=2*Math.sqrt(1+C-k-Y),I._w=(K-j)/O,I._x=.25*O,I._y=(l+F)/O,I._z=(s+E)/O,I._isDirty=!0):k>Y?(O=2*Math.sqrt(1+k-C-Y),I._w=(s-E)/O,I._x=(l+F)/O,I._y=.25*O,I._z=(j+K)/O,I._isDirty=!0):(O=2*Math.sqrt(1+Y-C-k),I._w=(F-l)/O,I._x=(s+E)/O,I._y=(j+K)/O,I._z=.25*O,I._isDirty=!0),I}static Dot(V,I){return V._x*I._x+V._y*I._y+V._z*I._z+V._w*I._w}static AreClose(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1;const C=D.Dot(V,I);return 1-C*C<=m}static SmoothToRef(V,I,m,C,l){let s=0===C?1:m/C;return s=(0,j.Clamp)(s,0,1),D.SlerpToRef(V,I,s,l),l}static Zero(){return new D(0,0,0,0)}static Inverse(V){return new D(-V._x,-V._y,-V._z,V._w)}static InverseToRef(V,I){return I.set(-V._x,-V._y,-V._z,V._w),I}static Identity(){return new D(0,0,0,1)}static IsIdentity(V){return V&&0===V._x&&0===V._y&&0===V._z&&1===V._w}static RotationAxis(V,I){return D.RotationAxisToRef(V,I,new D)}static RotationAxisToRef(V,I,m){m._w=Math.cos(I/2);const C=Math.sin(I/2)/V.length();return m._x=V._x*C,m._y=V._y*C,m._z=V._z*C,m._isDirty=!0,m}static Ik(V,I){return I||(I=0),new D(V[I],V[I+1],V[I+2],V[I+3])}static FromArrayToRef(V,I,m){return m._x=V[I],m._y=V[I+1],m._z=V[I+2],m._w=V[I+3],m._isDirty=!0,m}static FromFloatsToRef(V,I,m,C,l){return l.aF(V,I,m,C),l}static FromEulerAngles(V,I,m){const C=new D;return D.RotationYawPitchRollToRef(I,V,m,C),C}static FromEulerAnglesToRef(V,I,m,C){return D.RotationYawPitchRollToRef(I,V,m,C),C}static FromEulerVector(V){const I=new D;return D.RotationYawPitchRollToRef(V._y,V._x,V._z,I),I}static FromEulerVectorToRef(V,I){return D.RotationYawPitchRollToRef(V._y,V._x,V._z,I),I}static FromUnitVectorsToRef(V,I,m){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:C.c;const s=N.Dot(V,I)+1;return s<l?Math.abs(V.x)>Math.abs(V.z)?m.set(-V.y,V.x,0,0):m.set(0,-V.z,V.y,0):(N.CrossToRef(V,I,n.LF[0]),m.set(n.LF[0].x,n.LF[0].y,n.LF[0].z,s)),m.normalize()}static RotationYawPitchRoll(V,I,m){const C=new D;return D.RotationYawPitchRollToRef(V,I,m,C),C}static RotationYawPitchRollToRef(V,I,m,C){const l=.5*m,s=.5*I,F=.5*V,k=Math.sin(l),j=Math.cos(l),E=Math.sin(s),K=Math.cos(s),Y=Math.sin(F),X=Math.cos(F);return C._x=X*E*j+Y*K*k,C._y=Y*K*j-X*E*k,C._z=X*K*k-Y*E*j,C._w=X*K*j+Y*E*k,C._isDirty=!0,C}static RotationAlphaBetaGamma(V,I,m){const C=new D;return D.RotationAlphaBetaGammaToRef(V,I,m,C),C}static RotationAlphaBetaGammaToRef(V,I,m,C){const l=.5*(m+V),s=.5*(m-V),F=.5*I;return C._x=Math.cos(s)*Math.sin(F),C._y=Math.sin(s)*Math.sin(F),C._z=Math.sin(l)*Math.cos(F),C._w=Math.cos(l)*Math.cos(F),C._isDirty=!0,C}static RotationQuaternionFromAxis(V,I,m){const C=new D(0,0,0,0);return D.RotationQuaternionFromAxisToRef(V,I,m,C),C}static RotationQuaternionFromAxisToRef(V,I,m,C){const l=T.Matrix[0];return V=V.normalizeToRef(T.LF[0]),I=I.normalizeToRef(T.LF[1]),m=m.normalizeToRef(T.LF[2]),b.FromXYZAxesToRef(V,I,m,l),D.FromRotationMatrixToRef(l,C),C}static FromLookDirectionLH(V,I){const m=new D;return D.FromLookDirectionLHToRef(V,I,m),m}static FromLookDirectionLHToRef(V,I,m){const C=T.Matrix[0];return b.LookDirectionLHToRef(V,I,C),D.FromRotationMatrixToRef(C,m),m}static FromLookDirectionRH(V,I){const m=new D;return D.FromLookDirectionRHToRef(V,I,m),m}static FromLookDirectionRHToRef(V,I,m){const C=T.Matrix[0];return b.LookDirectionRHToRef(V,I,C),D.FromRotationMatrixToRef(C,m)}static Slerp(V,I,m){const C=D.Identity();return D.SlerpToRef(V,I,m,C),C}static SlerpToRef(V,I,m,C){let l,s,F=V._x*I._x+V._y*I._y+V._z*I._z+V._w*I._w,k=!1;if(F<0&&(k=!0,F=-F),F>.999999)s=1-m,l=k?-m:m;else{const V=Math.acos(F),I=1/Math.sin(V);s=Math.sin((1-m)*V)*I,l=k?-Math.sin(m*V)*I:Math.sin(m*V)*I}return C._x=s*V._x+l*I._x,C._y=s*V._y+l*I._y,C._z=s*V._z+l*I._z,C._w=s*V._w+l*I._w,C._isDirty=!0,C}static Hermite(V,I,m,C,l){const s=l*l,F=l*s,k=2*F-3*s+1,j=-2*F+3*s,E=F-2*s+l,K=F-s,Y=V._x*k+m._x*j+I._x*E+C._x*K,X=V._y*k+m._y*j+I._y*E+C._y*K,O=V._z*k+m._z*j+I._z*E+C._z*K,v=V._w*k+m._w*j+I._w*E+C._w*K;return new D(Y,X,O,v)}static Hermite1stDerivative(V,I,m,C,l){const s=new D;return this.Hermite1stDerivativeToRef(V,I,m,C,l,s),s}static Hermite1stDerivativeToRef(V,I,m,C,l,s){const F=l*l;return s._x=6*(F-l)*V._x+(3*F-4*l+1)*I._x+6*(-F+l)*m._x+(3*F-2*l)*C._x,s._y=6*(F-l)*V._y+(3*F-4*l+1)*I._y+6*(-F+l)*m._y+(3*F-2*l)*C._y,s._z=6*(F-l)*V._z+(3*F-4*l+1)*I._z+6*(-F+l)*m._z+(3*F-2*l)*C._z,s._w=6*(F-l)*V._w+(3*F-4*l+1)*I._w+6*(-F+l)*m._w+(3*F-2*l)*C._w,s._isDirty=!0,s}static Normalize(V){const I=D.Zero();return D.NormalizeToRef(V,I),I}static NormalizeToRef(V,I){return V.normalizeToRef(I),I}static Clamp(V,I,m){const C=new D;return D.ClampToRef(V,I,m,C),C}static ClampToRef(V,I,m,C){return C.aF((0,j.Clamp)(V.x,I.x,m.x),(0,j.Clamp)(V.y,I.y,m.y),(0,j.Clamp)(V.z,I.z,m.z),(0,j.Clamp)(V.w,I.w,m.w))}static Random(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new D((0,j.RandomRange)(V,I),(0,j.RandomRange)(V,I),(0,j.RandomRange)(V,I),(0,j.RandomRange)(V,I))}static RandomToRef(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).aF((0,j.RandomRange)(V,I),(0,j.RandomRange)(V,I),(0,j.RandomRange)(V,I),(0,j.RandomRange)(V,I))}static Minimize(){throw new ReferenceError("Quaternion.Minimize does not make sense")}static Maximize(){throw new ReferenceError("Quaternion.Maximize does not make sense")}static Distance(V,I){return Math.sqrt(D.DistanceSquared(V,I))}static DistanceSquared(V,I){const m=V.x-I.x,C=V.y-I.y,l=V.z-I.z,s=V.w-I.w;return m*m+C*C+l*l+s*s}static Center(V,I){return D.CenterToRef(V,I,D.Zero())}static CenterToRef(V,I,m){return m.aF((V.x+I.x)/2,(V.y+I.y)/2,(V.z+I.z)/2,(V.w+I.w)/2)}}D._V8PerformanceHack=new D(.5,.5,.5,.5),Object.defineProperties(D.prototype,{dimension:{value:[4]},rank:{value:1}});class b{static get Use64Bits(){return F.d.MatrixUse64Bits}get m(){return this.aY}markAsUpdated(){this.updateFlag=E._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}_updateIdentityStatus(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._isIdentity=V,this._isIdentity3x2=V||m,this._isIdentityDirty=!this._isIdentity&&I,this._isIdentity3x2Dirty=!this._isIdentity3x2&&C}constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,F.d.MatrixTrackPrecisionChange&&F.d.MatrixTrackedMatrices.push(this),this.aY=new F.d.MatrixCurrentType(16),this.markAsUpdated()}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const V=this.aY;this._isIdentity=1===V[0]&&0===V[1]&&0===V[2]&&0===V[3]&&0===V[4]&&1===V[5]&&0===V[6]&&0===V[7]&&0===V[8]&&0===V[9]&&1===V[10]&&0===V[11]&&0===V[12]&&0===V[13]&&0===V[14]&&1===V[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this.aY[0]||1!==this.aY[5]||1!==this.aY[15]||0!==this.aY[1]||0!==this.aY[2]||0!==this.aY[3]||0!==this.aY[4]||0!==this.aY[6]||0!==this.aY[7]||0!==this.aY[8]||0!==this.aY[9]||0!==this.aY[10]||0!==this.aY[11]||0!==this.aY[12]||0!==this.aY[13]||0!==this.aY[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const V=this.aY,I=V[0],m=V[1],C=V[2],l=V[3],s=V[4],F=V[5],k=V[6],j=V[7],E=V[8],K=V[9],Y=V[10],X=V[11],O=V[12],v=V[13],N=V[14],t=V[15],D=Y*t-N*X,b=K*t-v*X,T=K*N-v*Y,n=E*t-O*X,x=E*N-Y*O,S=E*v-O*K;return I*+(F*D-k*b+j*T)+m*-(s*D-k*n+j*x)+C*+(s*b-F*n+j*S)+l*-(s*T-F*x+k*S)}toString(){return`{${this.m[0]}, ${this.m[1]}, ${this.m[2]}, ${this.m[3]}\n${this.m[4]}, ${this.m[5]}, ${this.m[6]}, ${this.m[7]}\n${this.m[8]}, ${this.m[9]}, ${this.m[10]}, ${this.m[11]}\n${this.m[12]}, ${this.m[13]}, ${this.m[14]}, ${this.m[15]}}`}toArray(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!V)return this.aY;const m=this.aY;for(let C=0;C<16;C++)V[I+C]=m[C];return this}UF(){return this.aY}km(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return b.FromArrayToRef(V,I,this)}aF(){for(var V=arguments.length,I=new Array(V),m=0;m<V;m++)I[m]=arguments[m];return b.FromArrayToRef(I,0,this)}set(){const V=this.aY;for(let I=0;I<16;I++)V[I]=I<0||arguments.length<=I?void 0:arguments[I];return this.markAsUpdated(),this}mk(V){const I=this.aY;for(let m=0;m<16;m++)I[m]=V;return this.markAsUpdated(),this}invert(){return this.invertToRef(this),this}reset(){return b.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(V){const I=new b;return this.addToRef(V,I),I}addToRef(V,I){const m=this.aY,C=I.aY,l=V.m;for(let s=0;s<16;s++)C[s]=m[s]+l[s];return I.markAsUpdated(),I}addToSelf(V){const I=this.aY,m=V.m;return I[0]+=m[0],I[1]+=m[1],I[2]+=m[2],I[3]+=m[3],I[4]+=m[4],I[5]+=m[5],I[6]+=m[6],I[7]+=m[7],I[8]+=m[8],I[9]+=m[9],I[10]+=m[10],I[11]+=m[11],I[12]+=m[12],I[13]+=m[13],I[14]+=m[14],I[15]+=m[15],this.markAsUpdated(),this}addInPlace(V){const I=this.aY,m=V.m;for(let C=0;C<16;C++)I[C]+=m[C];return this.markAsUpdated(),this}addInPlaceFromFloats(){const V=this.aY;for(let I=0;I<16;I++)V[I]+=I<0||arguments.length<=I?void 0:arguments[I];return this.markAsUpdated(),this}Fm(V){const I=this.aY,m=V.m;for(let C=0;C<16;C++)I[C]-=m[C];return this.markAsUpdated(),this}subtractToRef(V,I){const m=this.aY,C=V.m,l=I.aY;for(let s=0;s<16;s++)l[s]=m[s]-C[s];return I.markAsUpdated(),I}WK(V){const I=this.aY,m=V.m;for(let C=0;C<16;C++)I[C]-=m[C];return this.markAsUpdated(),this}subtractFromFloats(){for(var V=arguments.length,I=new Array(V),m=0;m<V;m++)I[m]=arguments[m];return this.subtractFromFloatsToRef(...I,new b)}subtractFromFloatsToRef(){for(var V=arguments.length,I=new Array(V),m=0;m<V;m++)I[m]=arguments[m];const C=I.pop(),l=this.aY,s=C.aY,F=I;for(let k=0;k<16;k++)s[k]=l[k]-F[k];return C.markAsUpdated(),C}invertToRef(V){return!0===this._isIdentity?(b.IdentityToRef(V),V):(X(this,V.UF())?V.markAsUpdated():V.C(this),V)}addAtIndex(V,I){return this.aY[V]+=I,this.markAsUpdated(),this}multiplyAtIndex(V,I){return this.aY[V]*=I,this.markAsUpdated(),this}setTranslationFromFloats(V,I,m){return this.aY[12]=V,this.aY[13]=I,this.aY[14]=m,this.markAsUpdated(),this}addTranslationFromFloats(V,I,m){return this.aY[12]+=V,this.aY[13]+=I,this.aY[14]+=m,this.markAsUpdated(),this}setTranslation(V){return this.setTranslationFromFloats(V._x,V._y,V._z)}getTranslation(){return new N(this.aY[12],this.aY[13],this.aY[14])}getTranslationToRef(V){return V.x=this.aY[12],V.y=this.aY[13],V.z=this.aY[14],V}removeRotationAndScaling(){const V=this.m;return b.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,V[12],V[13],V[14],V[15],this),this._updateIdentityStatus(0===V[12]&&0===V[13]&&0===V[14]&&1===V[15]),this}C(V){V.copyToArray(this.aY);const I=V;return this.updateFlag=I.updateFlag,this._updateIdentityStatus(I._isIdentity,I._isIdentityDirty,I._isIdentity3x2,I._isIdentity3x2Dirty),this}copyToArray(V){return Y(this,V,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),this}multiply(V){const I=new b;return this.multiplyToRef(V,I),I}multiplyInPlace(V){const I=this.aY,m=V.m;for(let C=0;C<16;C++)I[C]*=m[C];return this.markAsUpdated(),this}multiplyByFloats(){const V=this.aY;for(let I=0;I<16;I++)V[I]*=I<0||arguments.length<=I?void 0:arguments[I];return this.markAsUpdated(),this}multiplyByFloatsToRef(){for(var V=arguments.length,I=new Array(V),m=0;m<V;m++)I[m]=arguments[m];const C=I.pop(),l=this.aY,s=C.aY,F=I;for(let k=0;k<16;k++)s[k]=l[k]*F[k];return C.markAsUpdated(),C}multiplyToRef(V,I){return this._isIdentity?(I.C(V),I):V._isIdentity?(I.C(this),I):(this.multiplyToArray(V,I.aY,0),I.markAsUpdated(),I)}multiplyToArray(V,I,m){return K(this,V,I,m),this}divide(V){return this.divideToRef(V,new b)}divideToRef(V,I){const m=this.aY,C=V.m,l=I.aY;for(let s=0;s<16;s++)l[s]=m[s]/C[s];return I.markAsUpdated(),I}divideInPlace(V){const I=this.aY,m=V.m;for(let C=0;C<16;C++)I[C]/=m[C];return this.markAsUpdated(),this}minimizeInPlace(V){const I=this.aY,m=V.m;for(let C=0;C<16;C++)I[C]=Math.min(I[C],m[C]);return this.markAsUpdated(),this}minimizeInPlaceFromFloats(){const V=this.aY;for(let I=0;I<16;I++)V[I]=Math.min(V[I],I<0||arguments.length<=I?void 0:arguments[I]);return this.markAsUpdated(),this}maximizeInPlace(V){const I=this.aY,m=V.m;for(let C=0;C<16;C++)I[C]=Math.min(I[C],m[C]);return this.markAsUpdated(),this}maximizeInPlaceFromFloats(){const V=this.aY;for(let I=0;I<16;I++)V[I]=Math.min(V[I],I<0||arguments.length<=I?void 0:arguments[I]);return this.markAsUpdated(),this}negate(){return this.negateToRef(new b)}negateInPlace(){const V=this.aY;for(let I=0;I<16;I++)V[I]=-V[I];return this.markAsUpdated(),this}negateToRef(V){const I=this.aY,m=V.aY;for(let C=0;C<16;C++)m[C]=-I[C];return V.markAsUpdated(),V}equals(V){const I=V;if(!I)return!1;if((this._isIdentity||I._isIdentity)&&!this._isIdentityDirty&&!I._isIdentityDirty)return this._isIdentity&&I._isIdentity;const m=this.m,C=I.m;return m[0]===C[0]&&m[1]===C[1]&&m[2]===C[2]&&m[3]===C[3]&&m[4]===C[4]&&m[5]===C[5]&&m[6]===C[6]&&m[7]===C[7]&&m[8]===C[8]&&m[9]===C[9]&&m[10]===C[10]&&m[11]===C[11]&&m[12]===C[12]&&m[13]===C[13]&&m[14]===C[14]&&m[15]===C[15]}equalsWithEpsilon(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const m=this.aY,C=V.m;for(let l=0;l<16;l++)if(!(0,j.WithinEpsilon)(m[l],C[l],I))return!1;return!0}equalsToFloats(){const V=this.aY;for(let I=0;I<16;I++)if(V[I]!=(I<0||arguments.length<=I?void 0:arguments[I]))return!1;return!0}floor(){return this.floorToRef(new b)}floorToRef(V){const I=this.aY,m=V.aY;for(let C=0;C<16;C++)m[C]=Math.floor(I[C]);return V.markAsUpdated(),V}fract(){return this.fractToRef(new b)}fractToRef(V){const I=this.aY,m=V.aY;for(let C=0;C<16;C++)m[C]=I[C]-Math.floor(I[C]);return V.markAsUpdated(),V}clone(){const V=new b;return V.C(this),V}getClassName(){return"Matrix"}getHashCode(){let V=O(this.aY[0]);for(let I=1;I<16;I++)V=397*V^O(this.aY[I]);return V}decomposeToTransformNode(V){return V.rotationQuaternion=V.rotationQuaternion||new D,this.decompose(V.Vk,V.rotationQuaternion,V.position)}decompose(V,I,m,C){let l=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._isIdentity)return m&&m.mk(0),V&&V.mk(1),I&&I.aF(0,0,0,1),!0;const s=this.aY;if(m&&m.aF(s[12],s[13],s[14]),(V=V||T.LF[0]).x=Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]),V.y=Math.sqrt(s[4]*s[4]+s[5]*s[5]+s[6]*s[6]),V.z=Math.sqrt(s[8]*s[8]+s[9]*s[9]+s[10]*s[10]),C){const I=(l?C.absoluteScaling.x:C.Vk.x)<0?-1:1,m=(l?C.absoluteScaling.y:C.Vk.y)<0?-1:1,s=(l?C.absoluteScaling.z:C.Vk.z)<0?-1:1;V.x*=I,V.y*=m,V.z*=s}else this.determinant()<=0&&(V.y*=-1);if(0===V._x||0===V._y||0===V._z)return I&&I.aF(0,0,0,1),!1;if(I){const m=1/V._x,C=1/V._y,l=1/V._z;b.FromValuesToRef(s[0]*m,s[1]*m,s[2]*m,0,s[4]*C,s[5]*C,s[6]*C,0,s[8]*l,s[9]*l,s[10]*l,0,0,0,0,1,T.Matrix[0]),D.FromRotationMatrixToRef(T.Matrix[0],I)}return!0}getRow(V){if(V<0||V>3)return null;const I=4*V;return new t(this.aY[I+0],this.aY[I+1],this.aY[I+2],this.aY[I+3])}getRowToRef(V,I){if(V>=0&&V<=3){const m=4*V;I.x=this.aY[m+0],I.y=this.aY[m+1],I.z=this.aY[m+2],I.w=this.aY[m+3]}return I}setRow(V,I){return this.setRowFromFloats(V,I.x,I.y,I.z,I.w)}transpose(){const V=new b;return b.TransposeToRef(this,V),V}transposeToRef(V){return b.TransposeToRef(this,V),V}setRowFromFloats(V,I,m,C,l){if(V<0||V>3)return this;const s=4*V;return this.aY[s+0]=I,this.aY[s+1]=m,this.aY[s+2]=C,this.aY[s+3]=l,this.markAsUpdated(),this}scale(V){const I=new b;return this.scaleToRef(V,I),I}scaleToRef(V,I){for(let m=0;m<16;m++)I.aY[m]=this.aY[m]*V;return I.markAsUpdated(),I}scaleAndAddToRef(V,I){for(let m=0;m<16;m++)I.aY[m]+=this.aY[m]*V;return I.markAsUpdated(),I}scaleInPlace(V){const I=this.aY;for(let m=0;m<16;m++)I[m]*=V;return this.markAsUpdated(),this}toNormalMatrix(V){const I=T.Matrix[0];this.invertToRef(I),I.transposeToRef(V);const m=V.aY;return b.FromValuesToRef(m[0],m[1],m[2],0,m[4],m[5],m[6],0,m[8],m[9],m[10],0,0,0,0,1,V),V}getRotationMatrix(){const V=new b;return this.getRotationMatrixToRef(V),V}getRotationMatrixToRef(V){const I=T.LF[0];if(!this.decompose(I))return b.IdentityToRef(V),V;const m=this.aY,C=1/I._x,l=1/I._y,s=1/I._z;return b.FromValuesToRef(m[0]*C,m[1]*C,m[2]*C,0,m[4]*l,m[5]*l,m[6]*l,0,m[8]*s,m[9]*s,m[10]*s,0,0,0,0,1,V),V}toggleModelMatrixHandInPlace(){const V=this.aY;return V[2]*=-1,V[6]*=-1,V[8]*=-1,V[9]*=-1,V[14]*=-1,this.markAsUpdated(),this}toggleProjectionMatrixHandInPlace(){const V=this.aY;return V[8]*=-1,V[9]*=-1,V[10]*=-1,V[11]*=-1,this.markAsUpdated(),this}static Ik(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const m=new b;return b.FromArrayToRef(V,I,m),m}static FromArrayToRef(V,I,m){for(let C=0;C<16;C++)m.aY[C]=V[C+I];return m.markAsUpdated(),m}static FromFloat32ArrayToRefScaled(V,I,m,C){return C.aY[0]=V[0+I]*m,C.aY[1]=V[1+I]*m,C.aY[2]=V[2+I]*m,C.aY[3]=V[3+I]*m,C.aY[4]=V[4+I]*m,C.aY[5]=V[5+I]*m,C.aY[6]=V[6+I]*m,C.aY[7]=V[7+I]*m,C.aY[8]=V[8+I]*m,C.aY[9]=V[9+I]*m,C.aY[10]=V[10+I]*m,C.aY[11]=V[11+I]*m,C.aY[12]=V[12+I]*m,C.aY[13]=V[13+I]*m,C.aY[14]=V[14+I]*m,C.aY[15]=V[15+I]*m,C.markAsUpdated(),C}static get IdentityReadOnly(){return b._IdentityReadOnly}static FromValuesToRef(V,I,m,C,l,s,F,k,j,E,K,Y,X,O,v,N,t){const D=t.aY;D[0]=V,D[1]=I,D[2]=m,D[3]=C,D[4]=l,D[5]=s,D[6]=F,D[7]=k,D[8]=j,D[9]=E,D[10]=K,D[11]=Y,D[12]=X,D[13]=O,D[14]=v,D[15]=N,t.markAsUpdated()}static FromValues(V,I,m,C,l,s,F,k,j,E,K,Y,X,O,v,N){const t=new b,D=t.aY;return D[0]=V,D[1]=I,D[2]=m,D[3]=C,D[4]=l,D[5]=s,D[6]=F,D[7]=k,D[8]=j,D[9]=E,D[10]=K,D[11]=Y,D[12]=X,D[13]=O,D[14]=v,D[15]=N,t.markAsUpdated(),t}static Compose(V,I,m){const C=new b;return b.ComposeToRef(V,I,m,C),C}static ComposeToRef(V,I,m,C){const l=C.aY,s=I._x,F=I._y,k=I._z,j=I._w,E=s+s,K=F+F,Y=k+k,X=s*E,O=s*K,v=s*Y,N=F*K,t=F*Y,D=k*Y,b=j*E,T=j*K,n=j*Y,x=V._x,S=V._y,c=V._z;return l[0]=(1-(N+D))*x,l[1]=(O+n)*x,l[2]=(v-T)*x,l[3]=0,l[4]=(O-n)*S,l[5]=(1-(X+D))*S,l[6]=(t+b)*S,l[7]=0,l[8]=(v+T)*c,l[9]=(t-b)*c,l[10]=(1-(X+N))*c,l[11]=0,l[12]=m._x,l[13]=m._y,l[14]=m._z,l[15]=1,C.markAsUpdated(),C}static Identity(){const V=b.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return V._updateIdentityStatus(!0),V}static IdentityToRef(V){return b.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,V),V._updateIdentityStatus(!0),V}static Zero(){const V=b.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return V._updateIdentityStatus(!1),V}static RotationX(V){const I=new b;return b.RotationXToRef(V,I),I}static Invert(V){const I=new b;return V.invertToRef(I),I}static RotationXToRef(V,I){const m=Math.sin(V),C=Math.cos(V);return b.FromValuesToRef(1,0,0,0,0,C,m,0,0,-m,C,0,0,0,0,1,I),I._updateIdentityStatus(1===C&&0===m),I}static RotationY(V){const I=new b;return b.RotationYToRef(V,I),I}static RotationYToRef(V,I){const m=Math.sin(V),C=Math.cos(V);return b.FromValuesToRef(C,0,-m,0,0,1,0,0,m,0,C,0,0,0,0,1,I),I._updateIdentityStatus(1===C&&0===m),I}static RotationZ(V){const I=new b;return b.RotationZToRef(V,I),I}static RotationZToRef(V,I){const m=Math.sin(V),C=Math.cos(V);return b.FromValuesToRef(C,m,0,0,-m,C,0,0,0,0,1,0,0,0,0,1,I),I._updateIdentityStatus(1===C&&0===m),I}static RotationAxis(V,I){const m=new b;return b.RotationAxisToRef(V,I,m),m}static RotationAxisToRef(V,I,m){const C=Math.sin(-I),l=Math.cos(-I),s=1-l;V=V.normalizeToRef(T.LF[0]);const F=m.aY;return F[0]=V._x*V._x*s+l,F[1]=V._x*V._y*s-V._z*C,F[2]=V._x*V._z*s+V._y*C,F[3]=0,F[4]=V._y*V._x*s+V._z*C,F[5]=V._y*V._y*s+l,F[6]=V._y*V._z*s-V._x*C,F[7]=0,F[8]=V._z*V._x*s-V._y*C,F[9]=V._z*V._y*s+V._x*C,F[10]=V._z*V._z*s+l,F[11]=0,F[12]=0,F[13]=0,F[14]=0,F[15]=1,m.markAsUpdated(),m}static RotationAlignToRef(V,I,m){let l=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s=N.Dot(I,V),F=m.aY;if(s<-1+C.c)F[0]=-1,F[1]=0,F[2]=0,F[3]=0,F[4]=0,F[5]=l?1:-1,F[6]=0,F[7]=0,F[8]=0,F[9]=0,F[10]=l?-1:1,F[11]=0;else{const m=N.Cross(I,V),C=1/(1+s);F[0]=m._x*m._x*C+s,F[1]=m._y*m._x*C-m._z,F[2]=m._z*m._x*C+m._y,F[3]=0,F[4]=m._x*m._y*C+m._z,F[5]=m._y*m._y*C+s,F[6]=m._z*m._y*C-m._x,F[7]=0,F[8]=m._x*m._z*C-m._y,F[9]=m._y*m._z*C+m._x,F[10]=m._z*m._z*C+s,F[11]=0}return F[12]=0,F[13]=0,F[14]=0,F[15]=1,m.markAsUpdated(),m}static RotationYawPitchRoll(V,I,m){const C=new b;return b.RotationYawPitchRollToRef(V,I,m,C),C}static RotationYawPitchRollToRef(V,I,m,C){return D.RotationYawPitchRollToRef(V,I,m,T.Quaternion[0]),T.Quaternion[0].toRotationMatrix(C),C}static Scaling(V,I,m){const C=new b;return b.ScalingToRef(V,I,m,C),C}static ScalingToRef(V,I,m,C){return b.FromValuesToRef(V,0,0,0,0,I,0,0,0,0,m,0,0,0,0,1,C),C._updateIdentityStatus(1===V&&1===I&&1===m),C}static Translation(V,I,m){const C=new b;return b.TranslationToRef(V,I,m,C),C}static TranslationToRef(V,I,m,C){return b.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,V,I,m,1,C),C._updateIdentityStatus(0===V&&0===I&&0===m),C}static Lerp(V,I,m){const C=new b;return b.LerpToRef(V,I,m,C),C}static LerpToRef(V,I,m,C){const l=C.aY,s=V.m,F=I.m;for(let k=0;k<16;k++)l[k]=s[k]*(1-m)+F[k]*m;return C.markAsUpdated(),C}static DecomposeLerp(V,I,m){const C=new b;return b.DecomposeLerpToRef(V,I,m,C),C}static DecomposeLerpToRef(V,I,m,C){const l=T.LF[0],s=T.Quaternion[0],F=T.LF[1];V.decompose(l,s,F);const k=T.LF[2],j=T.Quaternion[1],E=T.LF[3];I.decompose(k,j,E);const K=T.LF[4];N.LerpToRef(l,k,m,K);const Y=T.Quaternion[2];D.SlerpToRef(s,j,m,Y);const X=T.LF[5];return N.LerpToRef(F,E,m,X),b.ComposeToRef(K,Y,X,C),C}static LookAtLH(V,I,m){const C=new b;return b.LookAtLHToRef(V,I,m,C),C}static LookAtLHToRef(V,I,m,C){const l=T.LF[0],s=T.LF[1],F=T.LF[2];I.subtractToRef(V,F),F.normalize(),N.CrossToRef(m,F,l);const k=l.lengthSquared();0===k?l.x=1:l.normalizeFromLength(Math.sqrt(k)),N.CrossToRef(F,l,s),s.normalize();const j=-N.Dot(l,V),E=-N.Dot(s,V),K=-N.Dot(F,V);return b.FromValuesToRef(l._x,s._x,F._x,0,l._y,s._y,F._y,0,l._z,s._z,F._z,0,j,E,K,1,C),C}static LookAtRH(V,I,m){const C=new b;return b.LookAtRHToRef(V,I,m,C),C}static LookAtRHToRef(V,I,m,C){const l=T.LF[0],s=T.LF[1],F=T.LF[2];V.subtractToRef(I,F),F.normalize(),N.CrossToRef(m,F,l);const k=l.lengthSquared();0===k?l.x=1:l.normalizeFromLength(Math.sqrt(k)),N.CrossToRef(F,l,s),s.normalize();const j=-N.Dot(l,V),E=-N.Dot(s,V),K=-N.Dot(F,V);return b.FromValuesToRef(l._x,s._x,F._x,0,l._y,s._y,F._y,0,l._z,s._z,F._z,0,j,E,K,1,C),C}static LookDirectionLH(V,I){const m=new b;return b.LookDirectionLHToRef(V,I,m),m}static LookDirectionLHToRef(V,I,m){const C=T.LF[0];C.C(V),C.scaleInPlace(-1);const l=T.LF[1];return N.CrossToRef(I,C,l),b.FromValuesToRef(l._x,l._y,l._z,0,I._x,I._y,I._z,0,C._x,C._y,C._z,0,0,0,0,1,m),m}static LookDirectionRH(V,I){const m=new b;return b.LookDirectionRHToRef(V,I,m),m}static LookDirectionRHToRef(V,I,m){const C=T.LF[2];return N.CrossToRef(I,V,C),b.FromValuesToRef(C._x,C._y,C._z,0,I._x,I._y,I._z,0,V._x,V._y,V._z,0,0,0,0,1,m),m}static OrthoLH(V,I,m,C,l){const s=new b;return b.OrthoLHToRef(V,I,m,C,s,l),s}static OrthoLHToRef(V,I,m,C,l,s){const F=2/V,k=2/I,j=2/(C-m),E=-(C+m)/(C-m);return b.FromValuesToRef(F,0,0,0,0,k,0,0,0,0,j,0,0,0,E,1,l),s&&l.multiplyToRef(x,l),l._updateIdentityStatus(1===F&&1===k&&1===j&&0===E),l}static OrthoOffCenterLH(V,I,m,C,l,s,F){const k=new b;return b.OrthoOffCenterLHToRef(V,I,m,C,l,s,k,F),k}static OrthoOffCenterLHToRef(V,I,m,C,l,s,F,k){const j=2/(I-V),E=2/(C-m),K=2/(s-l),Y=-(s+l)/(s-l),X=(V+I)/(V-I),O=(C+m)/(m-C);return b.FromValuesToRef(j,0,0,0,0,E,0,0,0,0,K,0,X,O,Y,1,F),k&&F.multiplyToRef(x,F),F.markAsUpdated(),F}static ObliqueOffCenterLHToRef(V,I,m,C,l,s,F,k,j,E,K){const Y=-F*Math.cos(k),X=-F*Math.sin(k);return b.TranslationToRef(0,0,-j,T.Matrix[1]),b.FromValuesToRef(1,0,0,0,0,1,0,0,Y,X,1,0,0,0,0,1,T.Matrix[0]),T.Matrix[1].multiplyToRef(T.Matrix[0],T.Matrix[0]),b.TranslationToRef(0,0,j,T.Matrix[1]),T.Matrix[0].multiplyToRef(T.Matrix[1],T.Matrix[0]),b.OrthoOffCenterLHToRef(V,I,m,C,l,s,E,K),T.Matrix[0].multiplyToRef(E,E),E}static OrthoOffCenterRH(V,I,m,C,l,s,F){const k=new b;return b.OrthoOffCenterRHToRef(V,I,m,C,l,s,k,F),k}static OrthoOffCenterRHToRef(V,I,m,C,l,s,F,k){return b.OrthoOffCenterLHToRef(V,I,m,C,l,s,F,k),F.aY[10]*=-1,F}static ObliqueOffCenterRHToRef(V,I,m,C,l,s,F,k,j,E,K){const Y=F*Math.cos(k),X=F*Math.sin(k);return b.TranslationToRef(0,0,j,T.Matrix[1]),b.FromValuesToRef(1,0,0,0,0,1,0,0,Y,X,1,0,0,0,0,1,T.Matrix[0]),T.Matrix[1].multiplyToRef(T.Matrix[0],T.Matrix[0]),b.TranslationToRef(0,0,-j,T.Matrix[1]),T.Matrix[0].multiplyToRef(T.Matrix[1],T.Matrix[0]),b.OrthoOffCenterRHToRef(V,I,m,C,l,s,E,K),T.Matrix[0].multiplyToRef(E,E),E}static PerspectiveLH(V,I,m,C,l){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const F=new b,k=2*m/V,j=2*m/I,E=(C+m)/(C-m),K=-2*C*m/(C-m),Y=Math.tan(s);return b.FromValuesToRef(k,0,0,0,0,j,0,Y,0,0,E,1,0,0,K,0,F),l&&F.multiplyToRef(x,F),F._updateIdentityStatus(!1),F}static PerspectiveFovLH(V,I,m,C,l){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,F=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const k=new b;return b.PerspectiveFovLHToRef(V,I,m,C,k,!0,l,s,F),k}static PerspectiveFovLHToRef(V,I,m,C,l){let s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],F=arguments.length>6?arguments[6]:void 0,k=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,j=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const E=m,K=C,Y=1/Math.tan(.5*V),X=s?Y/I:Y,O=s?Y:Y*I,v=j&&0===E?-1:0!==K?(K+E)/(K-E):1,N=j&&0===E?2*K:0!==K?-2*K*E/(K-E):-2*E,t=Math.tan(k);return b.FromValuesToRef(X,0,0,0,0,O,0,t,0,0,v,1,0,0,N,0,l),F&&l.multiplyToRef(x,l),l._updateIdentityStatus(!1),l}static PerspectiveFovReverseLHToRef(V,I,m,C,l){let s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],F=arguments.length>6?arguments[6]:void 0,k=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const j=1/Math.tan(.5*V),E=s?j/I:j,K=s?j:j*I,Y=Math.tan(k);return b.FromValuesToRef(E,0,0,0,0,K,0,Y,0,0,-m,1,0,0,1,0,l),F&&l.multiplyToRef(x,l),l._updateIdentityStatus(!1),l}static PerspectiveFovRH(V,I,m,C,l){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,F=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const k=new b;return b.PerspectiveFovRHToRef(V,I,m,C,k,!0,l,s,F),k}static PerspectiveFovRHToRef(V,I,m,C,l){let s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],F=arguments.length>6?arguments[6]:void 0,k=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,j=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const E=m,K=C,Y=1/Math.tan(.5*V),X=s?Y/I:Y,O=s?Y:Y*I,v=j&&0===E?1:0!==K?-(K+E)/(K-E):-1,N=j&&0===E?2*K:0!==K?-2*K*E/(K-E):-2*E,t=Math.tan(k);return b.FromValuesToRef(X,0,0,0,0,O,0,t,0,0,v,-1,0,0,N,0,l),F&&l.multiplyToRef(x,l),l._updateIdentityStatus(!1),l}static PerspectiveFovReverseRHToRef(V,I,m,C,l){let s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],F=arguments.length>6?arguments[6]:void 0,k=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const j=1/Math.tan(.5*V),E=s?j/I:j,K=s?j:j*I,Y=Math.tan(k);return b.FromValuesToRef(E,0,0,0,0,K,0,Y,0,0,-m,-1,0,0,-1,0,l),F&&l.multiplyToRef(x,l),l._updateIdentityStatus(!1),l}static GetFinalMatrix(V,I,m,C,l,s){const F=V.width,k=V.height,j=V.x,E=V.y,K=b.FromValues(F/2,0,0,0,0,-k/2,0,0,0,0,s-l,0,j+F/2,k/2+E,l,1),Y=new b;return I.multiplyToRef(m,Y),Y.multiplyToRef(C,Y),Y.multiplyToRef(K,Y)}static GetAsMatrix2x2(V){const I=V.m,m=[I[0],I[1],I[4],I[5]];return F.d.MatrixUse64Bits?m:new Float32Array(m)}static GetAsMatrix3x3(V){const I=V.m,m=[I[0],I[1],I[2],I[4],I[5],I[6],I[8],I[9],I[10]];return F.d.MatrixUse64Bits?m:new Float32Array(m)}static Transpose(V){const I=new b;return b.TransposeToRef(V,I),I}static TransposeToRef(V,I){const m=V.m,C=m[0],l=m[4],s=m[8],F=m[12],k=m[1],j=m[5],E=m[9],K=m[13],Y=m[2],X=m[6],O=m[10],v=m[14],N=m[3],t=m[7],D=m[11],b=m[15],T=I.aY;return T[0]=C,T[1]=l,T[2]=s,T[3]=F,T[4]=k,T[5]=j,T[6]=E,T[7]=K,T[8]=Y,T[9]=X,T[10]=O,T[11]=v,T[12]=N,T[13]=t,T[14]=D,T[15]=b,I.markAsUpdated(),I._updateIdentityStatus(V._isIdentity,V._isIdentityDirty),I}static Reflection(V){const I=new b;return b.ReflectionToRef(V,I),I}static ReflectionToRef(V,I){V.normalize();const m=V.XC.x,C=V.XC.y,l=V.XC.z,s=-2*m,F=-2*C,k=-2*l;return b.FromValuesToRef(s*m+1,F*m,k*m,0,s*C,F*C+1,k*C,0,s*l,F*l,k*l+1,0,s*V.d,F*V.d,k*V.d,1,I),I}static FromXYZAxesToRef(V,I,m,C){return b.FromValuesToRef(V._x,V._y,V._z,0,I._x,I._y,I._z,0,m._x,m._y,m._z,0,0,0,0,1,C),C}static FromQuaternionToRef(V,I){const m=V._x*V._x,C=V._y*V._y,l=V._z*V._z,s=V._x*V._y,F=V._z*V._w,k=V._z*V._x,j=V._y*V._w,E=V._y*V._z,K=V._x*V._w;return I.aY[0]=1-2*(C+l),I.aY[1]=2*(s+F),I.aY[2]=2*(k-j),I.aY[3]=0,I.aY[4]=2*(s-F),I.aY[5]=1-2*(l+m),I.aY[6]=2*(E+K),I.aY[7]=0,I.aY[8]=2*(k+j),I.aY[9]=2*(E-K),I.aY[10]=1-2*(C+m),I.aY[11]=0,I.aY[12]=0,I.aY[13]=0,I.aY[14]=0,I.aY[15]=1,I.markAsUpdated(),I}}b._IdentityReadOnly=b.Identity(),Object.defineProperties(b.prototype,{dimension:{value:[4,4]},rank:{value:2}});class T{}T.LF=(0,l.h)(11,N.Zero),T.Matrix=(0,l.h)(2,b.Identity),T.Quaternion=(0,l.h)(3,D.Zero);class n{}n.Vector2=(0,l.h)(3,v.Zero),n.LF=(0,l.h)(13,N.Zero),n.Vector4=(0,l.h)(3,t.Zero),n.Quaternion=(0,l.h)(3,D.Zero),n.Matrix=(0,l.h)(8,b.Identity),(0,s.h)("BABYLON.Vector2",v),(0,s.h)("BABYLON.Vector3",N),(0,s.h)("BABYLON.Vector4",t),(0,s.h)("BABYLON.Matrix",b);const x=b.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)},11393:(V,I,m)=>{m.d(I,{e:()=>C});class C{constructor(V,I,m,C){this.x=V,this.y=I,this.width=m,this.height=C}toGlobal(V,I){return new C(this.x*V,this.y*I,this.width*V,this.height*I)}toGlobalToRef(V,I,m){return m.x=this.x*V,m.y=this.y*I,m.width=this.width*V,m.height=this.height*I,this}clone(){return new C(this.x,this.y,this.width,this.height)}}},11488:(V,I,m)=>{m.d(I,{b:()=>E,c:()=>K});var C=m(11040),l=m(11496);const s=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],F=[()=>1,V=>V.y,V=>V.z,V=>V.x,V=>V.x*V.y,V=>V.y*V.z,V=>3*V.z*V.z-1,V=>V.x*V.z,V=>V.x*V.x-V.y*V.y],k=(V,I)=>s[V]*F[V](I),j=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class E{constructor(){this.preScaled=!1,this.l00=C.m.Zero(),this.l1_1=C.m.Zero(),this.l10=C.m.Zero(),this.l11=C.m.Zero(),this.l2_2=C.m.Zero(),this.l2_1=C.m.Zero(),this.l20=C.m.Zero(),this.l21=C.m.Zero(),this.l22=C.m.Zero()}addLight(V,I,m){l.g.LF[0].set(I.r,I.g,I.b);const C=l.g.LF[0],s=l.g.LF[1];C.scaleToRef(m,s),s.scaleToRef(k(0,V),l.g.LF[2]),this.l00.addInPlace(l.g.LF[2]),s.scaleToRef(k(1,V),l.g.LF[2]),this.l1_1.addInPlace(l.g.LF[2]),s.scaleToRef(k(2,V),l.g.LF[2]),this.l10.addInPlace(l.g.LF[2]),s.scaleToRef(k(3,V),l.g.LF[2]),this.l11.addInPlace(l.g.LF[2]),s.scaleToRef(k(4,V),l.g.LF[2]),this.l2_2.addInPlace(l.g.LF[2]),s.scaleToRef(k(5,V),l.g.LF[2]),this.l2_1.addInPlace(l.g.LF[2]),s.scaleToRef(k(6,V),l.g.LF[2]),this.l20.addInPlace(l.g.LF[2]),s.scaleToRef(k(7,V),l.g.LF[2]),this.l21.addInPlace(l.g.LF[2]),s.scaleToRef(k(8,V),l.g.LF[2]),this.l22.addInPlace(l.g.LF[2])}scaleInPlace(V){this.l00.scaleInPlace(V),this.l1_1.scaleInPlace(V),this.l10.scaleInPlace(V),this.l11.scaleInPlace(V),this.l2_2.scaleInPlace(V),this.l2_1.scaleInPlace(V),this.l20.scaleInPlace(V),this.l21.scaleInPlace(V),this.l22.scaleInPlace(V)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(j[0]),this.l1_1.scaleInPlace(j[1]),this.l10.scaleInPlace(j[2]),this.l11.scaleInPlace(j[3]),this.l2_2.scaleInPlace(j[4]),this.l2_1.scaleInPlace(j[5]),this.l20.scaleInPlace(j[6]),this.l21.scaleInPlace(j[7]),this.l22.scaleInPlace(j[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(s[0]),this.l1_1.scaleInPlace(s[1]),this.l10.scaleInPlace(s[2]),this.l11.scaleInPlace(s[3]),this.l2_2.scaleInPlace(s[4]),this.l2_1.scaleInPlace(s[5]),this.l20.scaleInPlace(s[6]),this.l21.scaleInPlace(s[7]),this.l22.scaleInPlace(s[8])}updateFromArray(V){return C.m.FromArrayToRef(V[0],0,this.l00),C.m.FromArrayToRef(V[1],0,this.l1_1),C.m.FromArrayToRef(V[2],0,this.l10),C.m.FromArrayToRef(V[3],0,this.l11),C.m.FromArrayToRef(V[4],0,this.l2_2),C.m.FromArrayToRef(V[5],0,this.l2_1),C.m.FromArrayToRef(V[6],0,this.l20),C.m.FromArrayToRef(V[7],0,this.l21),C.m.FromArrayToRef(V[8],0,this.l22),this}updateFromFloatsArray(V){return C.m.FromFloatsToRef(V[0],V[1],V[2],this.l00),C.m.FromFloatsToRef(V[3],V[4],V[5],this.l1_1),C.m.FromFloatsToRef(V[6],V[7],V[8],this.l10),C.m.FromFloatsToRef(V[9],V[10],V[11],this.l11),C.m.FromFloatsToRef(V[12],V[13],V[14],this.l2_2),C.m.FromFloatsToRef(V[15],V[16],V[17],this.l2_1),C.m.FromFloatsToRef(V[18],V[19],V[20],this.l20),C.m.FromFloatsToRef(V[21],V[22],V[23],this.l21),C.m.FromFloatsToRef(V[24],V[25],V[26],this.l22),this}static Ik(V){return(new E).updateFromArray(V)}static FromPolynomial(V){const I=new E;return I.l00=V.xx.scale(.376127).add(V.yy.scale(.376127)).add(V.zz.scale(.376126)),I.l1_1=V.y.scale(.977204),I.l10=V.z.scale(.977204),I.l11=V.x.scale(.977204),I.l2_2=V.xy.scale(1.16538),I.l2_1=V.yz.scale(1.16538),I.l20=V.zz.scale(1.34567).Fm(V.xx.scale(.672834)).Fm(V.yy.scale(.672834)),I.l21=V.zx.scale(1.16538),I.l22=V.xx.scale(1.16538).Fm(V.yy.scale(1.16538)),I.l1_1.scaleInPlace(-1),I.l11.scaleInPlace(-1),I.l2_1.scaleInPlace(-1),I.l21.scaleInPlace(-1),I.scaleInPlace(Math.PI),I}}class K{constructor(){this.x=C.m.Zero(),this.y=C.m.Zero(),this.z=C.m.Zero(),this.xx=C.m.Zero(),this.yy=C.m.Zero(),this.zz=C.m.Zero(),this.xy=C.m.Zero(),this.yz=C.m.Zero(),this.zx=C.m.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=E.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(V){l.g.LF[0].aF(V.r,V.g,V.b);const I=l.g.LF[0];this.xx.addInPlace(I),this.yy.addInPlace(I),this.zz.addInPlace(I)}scaleInPlace(V){this.x.scaleInPlace(V),this.y.scaleInPlace(V),this.z.scaleInPlace(V),this.xx.scaleInPlace(V),this.yy.scaleInPlace(V),this.zz.scaleInPlace(V),this.yz.scaleInPlace(V),this.zx.scaleInPlace(V),this.xy.scaleInPlace(V)}updateFromHarmonics(V){return this._harmonics=V,this.x.C(V.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.C(V.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.C(V.l10),this.z.scaleInPlace(1.02333),this.xx.C(V.l00),l.g.LF[0].C(V.l20).scaleInPlace(.247708),l.g.LF[1].C(V.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).WK(l.g.LF[0]).addInPlace(l.g.LF[1]),this.yy.C(V.l00),this.yy.scaleInPlace(.886277).WK(l.g.LF[0]).WK(l.g.LF[1]),this.zz.C(V.l00),l.g.LF[0].C(V.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(l.g.LF[0]),this.yz.C(V.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.C(V.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.C(V.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(V){return(new K).updateFromHarmonics(V)}static Ik(V){const I=new K;return C.m.FromArrayToRef(V[0],0,I.x),C.m.FromArrayToRef(V[1],0,I.y),C.m.FromArrayToRef(V[2],0,I.z),C.m.FromArrayToRef(V[3],0,I.xx),C.m.FromArrayToRef(V[4],0,I.yy),C.m.FromArrayToRef(V[5],0,I.zz),C.m.FromArrayToRef(V[6],0,I.yz),C.m.FromArrayToRef(V[7],0,I.zx),C.m.FromArrayToRef(V[8],0,I.xy),I}}},11736:(V,I,m)=>{m.d(I,{c:()=>D,f:()=>b});var C=m(11040),l=m(11312),s=m(11384),F=m(11350),k=m(11085),j=m(11233),E=m(11498),K=m(11044),Y=m(11061);class X extends C.k{constructor(V,I){super(V.x,V.y),this.index=I}}class O{constructor(){this.elements=[]}add(V){const I=[];for(const m of V){const V=new X(m,this.elements.length);I.push(V),this.elements.push(V)}return I}computeBounds(){const V=new C.k(this.elements[0].x,this.elements[0].y),I=new C.k(this.elements[0].x,this.elements[0].y);for(const m of this.elements)m.x<V.x?V.x=m.x:m.x>I.x&&(I.x=m.x),m.y<V.y?V.y=m.y:m.y>I.y&&(I.y=m.y);return{min:V,max:I,width:I.x-V.x,height:I.y-V.y}}}class v{_addToepoint(V){for(const I of V)this._epoints.push(I.x,I.y)}constructor(V,I,m){let C,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new O,this._outlinepoints=new O,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=l,this._name=V,this._scene=m||Y.c.LastCreatedScene,C=I instanceof E.g?I.getPoints():I,this._addToepoint(C),this._points.add(C),this._outlinepoints.add(C),"undefined"===typeof this.bjsEarcut&&k.d.Warn("Earcut was not found, the polygon will not be built.")}addHole(V){this._points.add(V);const I=new O;return I.add(V),this._holes.push(I),this._eholes.push(this._epoints.length/2),this._addToepoint(V),this}build(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const C=new s.c(this._name,this._scene),l=this.buildVertexData(I,m);return C.hV(j.e.PositionKind,l.yV,V),C.hV(j.e.NormalKind,l.zV,V),C.hV(j.e.UVKind,l.BV,V),C.setIndices(l.indices),C}buildVertexData(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const m=new F.c,C=[],l=[],s=[],k=this._points.computeBounds();for(const F of this._points.elements)C.push(0,1,0),l.push(F.x,0,F.y),s.push((F.x-k.min.x)/k.width,(F.y-k.min.y)/k.height);const j=[],E=this.bjsEarcut(this._epoints,this._eholes,2);for(let F=0;F<E.length;F++)j.push(E[F]);if(V>0){const m=l.length/3;for(const I of this._points.elements)C.push(0,-1,0),l.push(I.x,-V,I.y),s.push(1-(I.x-k.min.x)/k.width,1-(I.y-k.min.y)/k.height);const F=j.length;for(let V=0;V<F;V+=3){const I=j[V+0],C=j[V+1],l=j[V+2];j.push(l+m),j.push(C+m),j.push(I+m)}this._addSide(l,C,s,j,k,this._outlinepoints,V,!1,I);for(const E of this._holes)this._addSide(l,C,s,j,k,E,V,!0,I)}return m.indices=j,m.yV=l,m.zV=C,m.BV=s,m}_addSide(V,I,m,l,s,F,k,j,E){let Y=V.length/3,X=0;for(let O=0;O<F.elements.length;O++){const v=F.elements[O],N=F.elements[(O+1)%F.elements.length];V.push(v.x,0,v.y),V.push(v.x,-k,v.y),V.push(N.x,0,N.y),V.push(N.x,-k,N.y);const t=F.elements[(O+F.elements.length-1)%F.elements.length],D=F.elements[(O+2)%F.elements.length];let b=new C.m(-(N.y-v.y),0,N.x-v.x),T=new C.m(-(v.y-t.y),0,v.x-t.x),n=new C.m(-(D.y-N.y),0,D.x-N.x);j||(b=b.scale(-1),T=T.scale(-1),n=n.scale(-1));const x=b.normalizeToNew();let S=T.normalizeToNew(),c=n.normalizeToNew();const H=C.m.Dot(S,x);S=H>E?H<K.c-1?new C.m(v.x,0,v.y).Fm(new C.m(N.x,0,N.y)).normalize():T.add(b).normalize():x;const y=C.m.Dot(n,b);c=y>E?y<K.c-1?new C.m(N.x,0,N.y).Fm(new C.m(v.x,0,v.y)).normalize():n.add(b).normalize():x,m.push(X/s.width,0),m.push(X/s.width,1),X+=b.length(),m.push(X/s.width,0),m.push(X/s.width,1),I.push(S.x,S.y,S.z),I.push(S.x,S.y,S.z),I.push(c.x,c.y,c.z),I.push(c.x,c.y,c.z),j?(l.push(Y),l.push(Y+2),l.push(Y+1),l.push(Y+1),l.push(Y+2),l.push(Y+3)):(l.push(Y),l.push(Y+1),l.push(Y+2),l.push(Y+1),l.push(Y+3),l.push(Y+2)),Y+=4}}}var N=m(11415);function t(V,I,m,s,k,E,K){const Y=m||new Array(3),X=s,O=[],v=K||!1;for(let F=0;F<3;F++)void 0===Y[F]&&(Y[F]=new C.n(0,0,1,1)),X&&void 0===X[F]&&(X[F]=new l.d(1,1,1,1));const t=V.getVerticesData(j.e.PositionKind),D=V.getVerticesData(j.e.NormalKind),b=V.getVerticesData(j.e.UVKind),T=V.AF(),n=t.length/9;let x=0,S=0,c=0,H=0,y=0;const z=[0];if(v)for(let C=n;C<t.length/3;C+=4)S=t[3*(C+2)]-t[3*C],c=t[3*(C+2)+2]-t[3*C+2],H=Math.sqrt(S*S+c*c),y+=H,z.push(y);let Z=0,B=0;for(let C=0;C<D.length;C+=3)Math.abs(D[C+1])<.001&&(B=1),Math.abs(D[C+1]-1)<.001&&(B=0),Math.abs(D[C+1]+1)<.001&&(B=2),Z=C/3,1===B?(x=Z-n,b[2*Z]=x%4<1.5?v?Y[B].x+(Y[B].z-Y[B].x)*z[Math.floor(x/4)]/y:Y[B].x:v?Y[B].x+(Y[B].z-Y[B].x)*z[Math.floor(x/4)+1]/y:Y[B].z,b[2*Z+1]=x%2===0?N.e?1-Y[B].w:Y[B].w:N.e?1-Y[B].y:Y[B].y):(b[2*Z]=(1-b[2*Z])*Y[B].x+b[2*Z]*Y[B].z,b[2*Z+1]=(1-b[2*Z+1])*Y[B].y+b[2*Z+1]*Y[B].w,N.e&&(b[2*Z+1]=1-b[2*Z+1])),X&&O.push(X[B].r,X[B].g,X[B].b,X[B].a);F.c._ComputeSides(I,t,T,D,b,k,E);const W=new F.c;if(W.indices=T,W.yV=t,W.zV=D,W.BV=b,X){const V=I===F.c.DOUBLESIDE?O.concat(O):O;W.ZV=V}return W}function D(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;I.sideOrientation=s.c._GetDefaultSideOrientation(I.sideOrientation);const F=I.shape,k=I.holes||[],j=I.depth||0,E=I.smoothingThreshold||2,K=[];let X=[];for(let s=0;s<F.length;s++)K[s]=new C.k(F[s].x,F[s].z);K[0].equalsWithEpsilon(K[K.length-1],1e-8)&&K.pop();const O=new v(V,K,m||Y.c.LastCreatedScene,l);for(let s=0;s<k.length;s++){X=[];for(let V=0;V<k[s].length;V++)X.push(new C.k(k[s][V].x,k[s][V].z));O.addHole(X)}const N=O.build(!1,j,E);N._originalBuilderSideOrientation=I.sideOrientation;return t(N,I.sideOrientation,I.faceUV,I.faceColors,I.frontUVs,I.backUVs,I.wrap).QV(N,I.updatable),N}function b(V,I){return D(V,I,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}F.c.CreatePolygon=t,s.c.CreatePolygon=function(V,I,m,C,l,s){return D(V,{shape:I,holes:C,updatable:l,sideOrientation:s},m,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},s.c.ExtrudePolygon=function(V,I,m,C,l,s,F){return b(V,{shape:I,holes:l,depth:m,updatable:s,sideOrientation:F},C,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)}},11731:(V,I,m)=>{m.d(I,{e:()=>K,h:()=>Y});var C=m(11498),l=m(11040),s=m(11384),F=m(11332),k=m(11736);class j{constructor(V){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=V}moveTo(V,I){this._currentPath=new C.g(V,I),this._tempPaths.push(this._currentPath)}lineTo(V,I){this._currentPath.addLineTo(V,I)}quadraticCurveTo(V,I,m,C){this._currentPath.addQuadraticCurveTo(V,I,m,C,this._resolution)}bezierCurveTo(V,I,m,C,l,s){this._currentPath.addBezierCurveTo(V,I,m,C,l,s,this._resolution)}extractHoles(){for(const V of this._tempPaths)V.area()>0?this._holes.push(V):this._paths.push(V);if(!this._paths.length&&this._holes.length){const V=this._holes;this._holes=this._paths,this._paths=V}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function E(V,I,m,C,l,s){const F=s.glyphs[V]||s.glyphs["?"];if(!F)return null;const k=new j(l);if(F.o){const V=F.o.split(" ");for(let l=0,s=V.length;l<s;){switch(V[l++]){case"m":{const s=parseInt(V[l++])*I+m,F=parseInt(V[l++])*I+C;k.moveTo(s,F);break}case"l":{const s=parseInt(V[l++])*I+m,F=parseInt(V[l++])*I+C;k.lineTo(s,F);break}case"q":{const s=parseInt(V[l++])*I+m,F=parseInt(V[l++])*I+C,j=parseInt(V[l++])*I+m,E=parseInt(V[l++])*I+C;k.quadraticCurveTo(j,E,s,F);break}case"b":{const s=parseInt(V[l++])*I+m,F=parseInt(V[l++])*I+C,j=parseInt(V[l++])*I+m,E=parseInt(V[l++])*I+C,K=parseInt(V[l++])*I+m,Y=parseInt(V[l++])*I+C;k.bezierCurveTo(j,E,K,Y,s,F);break}}}}return k.extractHoles(),{offsetX:F.ha*I,shapePath:k}}function K(V,I,m,C){const l=Array.from(V),s=I/C.resolution,F=(C.boundingBox.yMax-C.boundingBox.yMin+C.underlineThickness)*s,k=[];let j=0,K=0;for(let Y=0;Y<l.length;Y++){const V=l[Y];if("\n"===V)j=0,K-=F;else{const I=E(V,s,j,K,m,C);I&&(j+=I.offsetX,k.push(I.shapePath))}}return k}function Y(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const Y=K(I,C.size||50,C.resolution||8,m),X=[];let O=0;for(const F of Y){if(!F.paths.length)continue;const I=F.holes.slice();for(const m of F.paths){var v,N;const F=[],K=[],Y=m.getPoints();for(const V of Y)K.push(new l.m(V.x,0,V.y));const t=I.slice();for(const V of t){const C=V.getPoints();let s=!1;for(const V of C)if(m.isPointInside(V)){s=!0;break}if(!s)continue;const k=[];for(const V of C)k.push(new l.m(V.x,0,V.y));F.push(k),I.splice(I.indexOf(V),1)}if(!F.length&&I.length)for(const V of I){const I=V.getPoints(),m=[];for(const V of I)m.push(new l.m(V.x,0,V.y));F.push(m)}const D=(0,k.f)(V,{shape:K,holes:F.length?F:void 0,depth:C.depth||1,faceUV:C.faceUV||(null===(v=C.perLetterFaceUV)||void 0===v?void 0:v.call(C,O)),faceColors:C.faceColors||(null===(N=C.perLetterFaceColors)||void 0===N?void 0:N.call(C,O)),sideOrientation:s.c._GetDefaultSideOrientation(C.sideOrientation||s.c.DOUBLESIDE)},j,E);X.push(D),O++}}const t=s.c.MergeMeshes(X,!0,!0);if(t){const I=t.getBoundingInfo().boundingBox;t.position.x+=-(I.minimumWorld.x+I.maximumWorld.x)/2,t.position.y+=-(I.minimumWorld.y+I.maximumWorld.y)/2,t.position.z+=-(I.minimumWorld.z+I.maximumWorld.z)/2+I.extendSize.z,t.name=V;const m=new F.c("pivot",j);m.rotation.x=-Math.PI/2,t.parent=m,t.bakeCurrentTransformIntoVertices(),t.parent=null,m.dispose()}return t}},11748:(V,I,m)=>{m.d(I,{e:()=>j,i:()=>F,k:()=>k});var C=m(11076),l=m(11757),s=m(11760);function F(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}function k(V){return!!(V.wasmUrl&&(V.wasmBinary||V.wasmBinaryUrl)&&"object"===typeof WebAssembly||V.fallbackUrl)}class j{constructor(V){if(V.workerPool)return void(this._workerPoolPromise=Promise.resolve(V.workerPool));const I=V.wasmBinary,m=V.numWorkers??F(),k=m&&"function"===typeof Worker&&"function"===typeof URL,j=k||!V.jsModule,E=V.wasmUrl&&V.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:j?C.d.GetBabylonScriptURL(V.wasmUrl,!0):"",wasmBinaryPromise:I?Promise.resolve(I):C.d.LoadFileAsync(C.d.GetBabylonScriptURL(V.wasmBinaryUrl,!0))}:{url:j?C.d.GetBabylonScriptURL(V.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};k?this._workerPoolPromise=E.wasmBinaryPromise.then((V=>{const I=this._getWorkerContent(),C=URL.createObjectURL(new Blob([I],{type:"application/javascript"}));return new l.b(m,(()=>{const I=new Worker(C);return(0,s.l)(I,V,E.url)}))})):this._modulePromise=E.wasmBinaryPromise.then((async I=>{if(!this._isModuleAvailable()&&!V.jsModule){if(!E.url)throw new Error("Draco codec module is not available");await C.d.LoadBabylonScriptAsync(E.url)}return await this._createModuleAsync(I,V.jsModule)}))}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._modulePromise&&await this._modulePromise}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((V=>{V.dispose()})),delete this._workerPoolPromise,delete this._modulePromise}}},11760:(V,I,m)=>{function C(V,I,m,C){const l=V;let s=null,F=null,k=null,j=null;const E={},K=I.find((V=>"POSITION"===V.dracoName));if(!K)throw new Error("Position attribute is required for Draco encoding");if(!m){const V=K.data.length/K.size;m=new(V>65535?Uint32Array:Uint16Array)(V);for(let I=0;I<V;I++)m[I]=I}try{s=new l.Encoder,F=new l.MeshBuilder,k=new l.Mesh,F.AddFacesToMesh(k,m.length/3,m);const V=new Map([[Float32Array,(V,I,m,C,l,s)=>V.AddFloatAttribute(I,m,C,l,s)],[Uint32Array,(V,I,m,C,l,s)=>V.AddUInt32Attribute(I,m,C,l,s)],[Uint16Array,(V,I,m,C,l,s)=>V.AddUInt16Attribute(I,m,C,l,s)],[Uint8Array,(V,I,m,C,l,s)=>V.AddUInt8Attribute(I,m,C,l,s)],[Int32Array,(V,I,m,C,l,s)=>V.AddInt32Attribute(I,m,C,l,s)],[Int16Array,(V,I,m,C,l,s)=>V.AddInt16Attribute(I,m,C,l,s)],[Int8Array,(V,I,m,C,l,s)=>V.AddInt8Attribute(I,m,C,l,s)]]);for(const m of I){m.data instanceof Uint8ClampedArray&&(m.data=new Uint8Array(m.data));const I=V.get(m.data.constructor),j=m.data.length/m.size;E[m.kind]=I(F,k,l[m.dracoName],j,m.size,m.data),C.quantizationBits&&C.quantizationBits[m.dracoName]&&s.SetAttributeQuantization(l[m.dracoName],C.quantizationBits[m.dracoName])}C.method&&s.SetEncodingMethod(l[C.method]),void 0!==C.encodeSpeed&&void 0!==C.decodeSpeed&&s.SetSpeedOptions(C.encodeSpeed,C.decodeSpeed),j=new l.DracoInt8Array;const K=s.EncodeMeshToDracoBuffer(k,j);if(K<=0)throw new Error("Draco encoding failed.");const Y=new Int8Array(K);for(let I=0;I<K;I++)Y[I]=j.GetValue(I);return{data:Y,attributeIds:E}}finally{k&&l.destroy(k),F&&l.destroy(F),s&&l.destroy(s),j&&l.destroy(j)}}function l(){let V;onmessage=I=>{const m=I.data;switch(m.id){case"init":{m.url&&importScripts(m.url);const I=m.wasmBinary?{wasmBinary:m.wasmBinary}:{};V=DracoEncoderModule(I),postMessage({id:"initDone"});break}case"encodeMesh":if(!V)throw new Error("Draco encoder module is not available");V.then((V=>{const I=C(V,m.attributes,m.indices,m.options);postMessage({id:"encodeMeshDone",encodedMeshData:I},I?[I.data.buffer]:void 0)}))}}}function s(V,I,m,C,l){const s=V;let F=null,k=null,j=null;try{let V;F=new s.Decoder,k=new s.DecoderBuffer,k.Init(I,I.byteLength);const E=F.GetEncodedGeometryType(k);switch(E){case s.TRIANGULAR_MESH:{const I=new s.Mesh;if(V=F.DecodeBufferToMesh(k,I),!V.ok()||0===I.ptr)throw new Error(V.error_msg());const m=3*I.num_faces(),l=4*m,E=s._malloc(l);try{F.GetTrianglesUInt32Array(I,l,E);const V=new Uint32Array(m);V.set(new Uint32Array(s.HEAPF32.buffer,E,m)),C(V)}finally{s._free(E)}j=I;break}case s.POINT_CLOUD:{const I=new s.PointCloud;if(V=F.DecodeBufferToPointCloud(k,I),!V.ok()||!I.ptr)throw new Error(V.error_msg());j=I;break}default:throw new Error(`Invalid geometry type ${E}`)}const K=j.num_points(),Y=(V,I,m,C)=>{const F=C.data_type(),k=C.num_components(),j=C.normalized(),E=C.byte_stride(),Y=C.byte_offset(),X={[s.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:s.HEAPF32},[s.DT_INT8]:{typedArrayConstructor:Int8Array,heap:s.HEAP8},[s.DT_INT16]:{typedArrayConstructor:Int16Array,heap:s.HEAP16},[s.DT_INT32]:{typedArrayConstructor:Int32Array,heap:s.HEAP32},[s.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:s.HEAPU8},[s.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:s.HEAPU16},[s.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:s.HEAPU32}}[F];if(!X)throw new Error(`Invalid data type ${F}`);const O=K*k,v=O*X.typedArrayConstructor.BYTES_PER_ELEMENT,N=s._malloc(v);try{V.GetAttributeDataArrayForAllPoints(I,C,F,v,N);const s=new X.typedArrayConstructor(X.heap.buffer,N,O);l(m,s.slice(),k,Y,E,j)}finally{s._free(N)}};if(m)for(const I in m){const V=m[I],C=F.GetAttributeByUniqueId(j,V);Y(F,j,I,C)}else{const V={position:s.POSITION,XC:s.NORMAL,color:s.COLOR,uv:s.TEX_COORD};for(const I in V){const m=F.GetAttributeId(j,V[I]);if(-1!==m){const V=F.GetAttribute(j,m);Y(F,j,I,V)}}}return K}finally{j&&s.destroy(j),k&&s.destroy(k),F&&s.destroy(F)}}function F(){let V;onmessage=I=>{const m=I.data;switch(m.id){case"init":{m.url&&importScripts(m.url);const I=m.wasmBinary?{wasmBinary:m.wasmBinary}:{};V=DracoDecoderModule(I),postMessage({id:"initDone"});break}case"decodeMesh":if(!V)throw new Error("Draco decoder module is not available");V.then((V=>{const I=s(V,m.dataView,m.attributes,(V=>{postMessage({id:"indices",data:V},[V.buffer])}),((V,I,m,C,l,s)=>{postMessage({id:"attribute",kind:V,data:I,size:m,byteOffset:C,byteStride:l,normalized:s},[I.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:I})}))}}}async function k(V,I,m){return await new Promise(((C,l)=>{const s=I=>{V.removeEventListener("error",s),V.removeEventListener("message",F),l(I)},F=I=>{"initDone"===I.data.id&&(V.removeEventListener("error",s),V.removeEventListener("message",F),C(V))};if(V.addEventListener("error",s),V.addEventListener("message",F),I){const C=I.slice(0);V.postMessage({id:"init",url:m,wasmBinary:C},[C])}else V.postMessage({id:"init",url:m})}))}m.d(I,{c:()=>s,e:()=>F,f:()=>C,j:()=>l,l:()=>k})},11444:(V,I,m)=>{m.d(I,{b:()=>l});var C=m(11238);class l extends C.e{constructor(V){super(),this._buffer=V}get underlyingResource(){return this._buffer}}},11342:(V,I,m)=>{m.d(I,{e:()=>c});var C=m(11206),l=m(11067),s=m(11040),F=m(11233),k=m(11350),j=m(11332),E=m(11366),K=m(11251),Y=m(11283);class X{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new s.m(0,0,0),this._diffPositionForCollisions=new s.m(0,0,0),this._collisionResponse=!0}}var O=m(11095),v=m(11271),N=m(11312),t=m(11044),D=m(11372),b=m(11048),T=m(11214),n=m(11136);class x{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=s.m.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class S{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new x,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=new Map,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new X,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class c extends j.c{static get BILLBOARDMODE_NONE(){return j.c.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return j.c.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return j.c.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return j.c.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return j.c.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return j.c.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(V){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=V}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(V){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=V}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(V){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=V}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(V){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=V}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(V){this._internalAbstractMeshDataInfo._collisionRetryCount=V}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(V){this._internalAbstractMeshDataInfo._morphTargetManager!==V&&(this._internalAbstractMeshDataInfo._morphTargetManager=V,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(V){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==V&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=V,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(V){return!!super._updateNonUniformScalingState(V)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(V){this._internalAbstractMeshDataInfo._rawBoundingInfo=V}set wX(V){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(V)}set onCollisionPositionChange(V){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(V)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(V){if(this._internalAbstractMeshDataInfo._visibility===V)return;const I=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=V,(1===I&&1!==V||1!==I&&1===V)&&this._markSubMeshesAsDirty((V=>{V.markAsMiscDirty(),V.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(V){this._internalAbstractMeshDataInfo._inheritVisibility=V}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let V=this._parentNode;for(;V;){const I=V.isVisible;if("undefined"!==typeof I)return I;V=V.parent}}return this._isVisible}set isVisible(V){this._isVisible=V}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(V){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=V}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(V){this._internalAbstractMeshDataInfo._renderingGroupId=V}get material(){return this._internalAbstractMeshDataInfo._material}set material(V){this._setMaterial(V)}_setMaterial(V){this._internalAbstractMeshDataInfo._material!==V&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=V,V&&V.meshMap&&(V.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.kk&&(this.resetDrawCache(void 0,null==V),this._unBindEffect()))}getMaterialForRenderPass(V){var I;return null===(I=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===I?void 0:I[V]}setMaterialForRenderPass(V,I){var m;this.resetDrawCache(V),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]);const C=this._internalAbstractMeshDataInfo._materialForRenderPass[V];null!==C&&void 0!==C&&null!==(m=C.meshMap)&&void 0!==m&&m[this.uniqueId]&&(C.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._materialForRenderPass[V]=I,I&&I.meshMap&&(I.meshMap[this.uniqueId]=this)}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(V){this._internalAbstractMeshDataInfo._receiveShadows!==V&&(this._internalAbstractMeshDataInfo._receiveShadows=V,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(V){this._internalAbstractMeshDataInfo._hasVertexAlpha!==V&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=V,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(V){this._internalAbstractMeshDataInfo._useVertexColors!==V&&(this._internalAbstractMeshDataInfo._useVertexColors=V,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(V){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==V&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=V,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(V){this._internalAbstractMeshDataInfo._numBoneInfluencers!==V&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=V,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(V){this._internalAbstractMeshDataInfo._applyFog!==V&&(this._internalAbstractMeshDataInfo._applyFog=V,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(V){this._internalAbstractMeshDataInfo._enableDistantPicking=V}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(V){V!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=V,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(V){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(V)?-1:V}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(V){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=V}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(V){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(V)?-1:V}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(V){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=V}get lightSources(){return this._lightSources}set skeleton(V){const I=this._internalAbstractMeshDataInfo._skeleton;I&&I.needInitialSkinMatrix&&I._unregisterMeshWithPoseMatrix(this),V&&V.needInitialSkinMatrix&&V._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=V,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(V){var I;let m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(V,m,!1),I=this,this._internalAbstractMeshDataInfo=new S,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.pK=c.MK,this.onCollideObservable=new l.e,this.onCollisionPositionChangeObservable=new l.e,this.onMaterialChangedObservable=new l.e,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.Tj=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=N.c.Red(),this.outlineWidth=.02,this.overlayColor=N.c.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.bk=!1,this.GV=!1,this.actionManager=null,this.ellipsoid=new s.m(.5,1,.5),this.ellipsoidOffset=new s.m(0,0,0),this.edgesWidth=1,this.edgesColor=new N.d(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,Dk:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new l.e,this._onCollisionPositionChange=function(V,m){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;m.subtractToRef(I._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,I._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),I._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>n.b.CollisionsEpsilon&&I.position.addInPlace(I._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),C&&I.onCollideObservable.notifyObservers(C),I.onCollisionPositionChangeObservable.notifyObservers(I.position)},m=this.cV(),m.GE(this),this._resyncLightSources(),this._uniformBuffer=new Y.e(this.cV().getEngine(),void 0,void 0,V,!this.cV().getEngine().isWebGPU),this._buildUniformLayout(),m.performancePriority){case 2:this.GV=!0;case 1:this.bk=!0,this.Tj=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(V){const I=this._uniformBuffer;I.lk("world",V),I.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),I.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(V){let I="Name: "+this.name+", isInstance: "+("InstancedMesh"===this.getClassName()?"YES":"NO");I+=", # of submeshes: "+(this.kk?this.kk.length:0);const m=this._internalAbstractMeshDataInfo._skeleton;return m&&(I+=", skeleton: "+m.name),V&&(I+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],I+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.Dk?"YES":"NO")),I}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==j.c.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(I||this.actionManager.isRecursive)){if(!V)return this.actionManager;if(this.actionManager.hasSpecificTrigger(V))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(V,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.kk){for(const V of this.kk)V._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const V of this.cV().lights)V.isEnabled()&&V.canAffectMesh(this)&&this._lightSources.push(V);this._markSubMeshesAsLightDirty()}_resyncLightSource(V){const I=V.isEnabled()&&V.canAffectMesh(this),m=this._lightSources.indexOf(V);let C=!1;if(-1===m){if(!I)return;this._lightSources.push(V)}else{if(I)return;C=!0,this._lightSources.splice(m,1)}this._markSubMeshesAsLightDirty(C)}_unBindEffect(){for(const V of this.kk)V.setEffect(null)}_removeLightSource(V,I){const m=this._lightSources.indexOf(V);-1!==m&&(this._lightSources.splice(m,1),this._markSubMeshesAsLightDirty(I))}_markSubMeshesAsDirty(V){if(this.kk)for(const I of this.kk)for(let m=0;m<I._drawWrappers.length;++m){const C=I._drawWrappers[m];C&&C.defines&&C.defines.markAllAsDirty&&V(C.defines)}}_markSubMeshesAsLightDirty(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((I=>I.markAsLightDirty(V)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((V=>V.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((V=>V.markAsMiscDirty()))}bE(V){return this._currentRenderId=Number.MAX_VALUE,super.bE(V),this._isDirty=!0,this}resetDrawCache(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.kk)for(const m of this.kk)m.resetDrawCache(V,I)}get isBlocked(){return!1}getLOD(V){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}AF(){return null}getVerticesData(V){return null}hV(V,I,m,C){return this}updateVerticesData(V,I,m,C){return this}setIndices(V,I){return this}isVerticesDataPresent(V){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.rV()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(V){return this._boundingInfo=V,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(V,I,m){return this._boundingInfo=new K.d(V,I,m),this._boundingInfo}normalizeToUnitCube(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(V,I,m)}get useBones(){return this.skeleton&&this.cV().skeletonsEnabled&&this.isVerticesDataPresent(F.e.MatricesIndicesKind)&&this.isVerticesDataPresent(F.e.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(V){}_activate(V,I){return this._renderId=V,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===j.c.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(V,I,m){return this.position.addInPlace(this.calcMovePOV(V,I,m)),this}calcMovePOV(V,I,m){const C=new s.b;(this.rotationQuaternion?this.rotationQuaternion:s.e.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(C);const l=s.m.Zero(),F=this.definedFacingForward?-1:1;return s.m.TransformCoordinatesFromFloatsToRef(V*F,I,m*F,C,l),l}rotatePOV(V,I,m){return this.rotation.addInPlace(this.calcRotatePOV(V,I,m)),this}calcRotatePOV(V,I,m){const C=this.definedFacingForward?1:-1;return new s.m(V*C,I,m*C)}gV(V,I){if(V){const m=(0,v.e)(V,0,this.getTotalVertices(),I);this._boundingInfo?this._boundingInfo.reConstruct(m.minimum,m.maximum):this._boundingInfo=new K.d(m.minimum,m.maximum)}if(this.kk)for(let m=0;m<this.kk.length;m++)this.kk[m].refreshBoundingInfo(V);this.rV()}_refreshBoundingInfoDirect(V){if(this._boundingInfo?this._boundingInfo.reConstruct(V.minimum,V.maximum):this._boundingInfo=new K.d(V.minimum,V.maximum),this.kk)for(let I=0;I<this.kk.length;I++)this.kk[I].refreshBoundingInfo(null);this.rV()}static _ApplySkeleton(V,I,m,C,l,k,j){!function(V,I,m,C,l,k,j){const E=s.g.LF[0],K=s.g.Matrix[0],Y=s.g.Matrix[1],X=I===F.e.NormalKind?s.m.TransformNormalFromFloatsToRef:s.m.TransformCoordinatesFromFloatsToRef;for(let F=0,O=0;F<V.length;F+=3,O+=4){let I,v;for(K.reset(),I=0;I<4;I++)v=l[O+I],v>0&&(s.b.FromFloat32ArrayToRefScaled(m,Math.floor(16*C[O+I]),v,Y),K.addToSelf(Y));if(k&&j)for(I=0;I<4;I++)v=j[O+I],v>0&&(s.b.FromFloat32ArrayToRefScaled(m,Math.floor(16*k[O+I]),v,Y),K.addToSelf(Y));X(V[F],V[F+1],V[F+2],K,E),E.toArray(V,F)}}(V,I,m,C,l,k,j)}_getData(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F.e.PositionKind;const C=V.cache,l=V=>{if(C){const I=C._vertexData||(C._vertexData={});return I[V]||this.copyVerticesData(V,I),I[V]}return this.getVerticesData(V)};if(I||(I=l(m)),!I)return null;if(C?(C._outputData?C._outputData.set(I):C._outputData=new Float32Array(I),I=C._outputData):(V.applyMorph&&this.morphTargetManager||V.applySkeleton&&this.skeleton)&&(I=I.slice()),V.applyMorph&&this.morphTargetManager&&function(V,I,m){let C=null;switch(I){case F.e.PositionKind:C=V=>V.getPositions();break;case F.e.NormalKind:C=V=>V.getNormals();break;case F.e.TangentKind:C=V=>V.getTangents();break;case F.e.UVKind:C=V=>V.getUVs();break;case F.e.UV2Kind:C=V=>V.getUV2s();break;case F.e.ColorKind:C=V=>V.getColors();break;default:return}for(let l=0;l<V.length;l++){let I=V[l];for(let s=0;s<m.numTargets;s++){const F=m.getTarget(s),k=F.influence;if(0!==k){const m=C(F);m&&(I+=(m[l]-V[l])*k)}}V[l]=I}}(I,m,this.morphTargetManager),V.applySkeleton&&this.skeleton){const V=l(F.e.MatricesIndicesKind),C=l(F.e.MatricesWeightsKind);if(C&&V){const s=this.numBoneInfluencers>4,k=s?l(F.e.MatricesIndicesExtraKind):null,j=s?l(F.e.MatricesWeightsExtraKind):null,E=this.skeleton.getTransformMatrices(this);c._ApplySkeleton(I,m,E,V,C,k,j)}}if(!1!==V.updatePositionsArray&&m===F.e.PositionKind){const V=this._internalAbstractMeshDataInfo._positions||[],m=V.length;if(V.length=I.length/3,m<V.length)for(let I=m;I<V.length;I++)V[I]=new s.m;for(let C=0,l=0;C<V.length;C++,l+=3)V[C].aF(I[l],I[l+1],I[l+2]);this._internalAbstractMeshDataInfo._positions=V}return I}getNormalsData(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:V,applyMorph:I,updatePositionsArray:!1},null,F.e.NormalKind)}Hk(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:V,applyMorph:I,updatePositionsArray:!1},m,F.e.PositionKind)}rV(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new K.d(s.m.Zero(),s.m.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(V){if(!this.kk)return this;const I=this.kk.length;for(let m=0;m<I;m++){const C=this.kk[m];(I>1||!C.IsGlobal)&&C.updateBoundingInfo(V)}return this}_afterComputeWorldMatrix(){this.GV||(this._boundingInfoIsDirty=!0)}isInFrustum(V){return this.getBoundingInfo().isInFrustum(V,this.pK)}isCompletelyInFrustum(V){return this.getBoundingInfo().isCompletelyInFrustum(V)}intersectsMesh(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2?arguments[2]:void 0;const C=this.getBoundingInfo(),l=V.getBoundingInfo();if(C.intersects(l,I))return!0;if(m)for(const s of this.getChildMeshes())if(s.intersectsMesh(V,I,!0))return!0;return!1}intersectsPoint(V){return this.getBoundingInfo().intersectsPoint(V)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(V){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=V}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const m=this.cV().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=m.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,m.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,V,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId,I),this}_collideForSubMesh(V,I,m){var C;if(this._generatePointsArray(),!this._positions)return this;if(!V._lastColliderWorldVertices||!V._lastColliderTransformMatrix.equals(I)){V._lastColliderTransformMatrix=I.clone(),V._lastColliderWorldVertices=[],V._trianglePlanes=[];const m=V.verticesStart,C=V.verticesStart+V.verticesCount;for(let l=m;l<C;l++)V._lastColliderWorldVertices.push(s.m.TransformCoordinates(this._positions[l],I))}return m._collide(V._trianglePlanes,V._lastColliderWorldVertices,this.AF(),V.indexStart,V.indexStart+V.indexCount,V.verticesStart,!!V.dV(),this,this._shouldConvertRHS(),7===(null===(C=V.dV())||void 0===C?void 0:C.fillMode)),this}_processCollisionsForSubMeshes(V,I){const m=this._scene.getCollidingSubMeshCandidates(this,V),C=m.length;for(let l=0;l<C;l++){const s=m.data[l];C>1&&!s._checkCollision(V)||this._collideForSubMesh(s,I,V)}return this}_shouldConvertRHS(){return!1}_checkCollision(V){if(!this.getBoundingInfo()._checkCollision(V))return this;const I=s.g.Matrix[0],m=s.g.Matrix[1];return s.b.ScalingToRef(1/V._radius.x,1/V._radius.y,1/V._radius.z,I),this.worldMatrixFromCache.multiplyToRef(I,m),this._processCollisionsForSubMeshes(V,m),this}_generatePointsArray(){return!1}intersects(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=arguments.length>4?arguments[4]:void 0,F=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const k=new E.b,j=this.getClassName(),K="InstancedLinesMesh"===j||"LinesMesh"===j||"GreasedLineMesh"===j?this.intersectionThreshold:0,Y=this.getBoundingInfo();if(!this.kk)return k;if(!F&&(!V.intersectsSphere(Y.boundingSphere,K)||!V.intersectsBox(Y.boundingBox,K)))return k;if(C)return k.hit=!F,k.pickedMesh=F?null:this,k.distance=F?0:s.m.Distance(V.origin,Y.boundingSphere.center),k.subMeshId=0,k;if(!this._generatePointsArray())return k;let X=null;const O=this._scene.getIntersectingSubMeshCandidates(this,V),v=O.length;let N=!1;for(let s=0;s<v;s++){const V=O.data[s].dV();if(V&&(7==V.fillMode||0==V.fillMode||1==V.fillMode||2==V.fillMode||4==V.fillMode)){N=!0;break}}if(!N)return k.hit=!0,k.pickedMesh=this,k.distance=s.m.Distance(V.origin,Y.boundingSphere.center),k.subMeshId=-1,k;for(let s=0;s<v;s++){const C=O.data[s];if(v>1&&!F&&!C.canIntersects(V))continue;const l=C.intersects(V,this._positions,this.AF(),I,m);if(l&&(I||!X||l.distance<X.distance)&&(X=l,X.subMeshId=s,I))break}if(X){const I=l??this.getWorldMatrix(),m=s.g.LF[0],C=s.g.LF[1];s.m.TransformCoordinatesToRef(V.origin,I,m),V.direction.scaleToRef(X.distance,C);const F=s.m.TransformNormal(C,I).addInPlace(m);return k.hit=!0,k.distance=s.m.Distance(m,F),k.pickedPoint=F,k.pickedMesh=this,k.bu=X.bu||0,k.bv=X.bv||0,k.subMeshFaceId=X.faceId,k.faceId=X.faceId+O.data[X.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),k.subMeshId=X.subMeshId,k}return k}clone(V,I,m){return null}releaseSubMeshes(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.kk)for(;this.kk.length;)this.kk[0].dispose(V);else this.kk=[];return this}dispose(V){let I,m=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const C=this.cV();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),C.freeActiveMeshes(),C.freeRenderingGroups(),C.renderingManager.maintainStateBetweenFrames&&C.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((V=>V!==this&&V.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),I=0;I<this._intersectionsInProgress.length;I++){const V=this._intersectionsInProgress[I],m=V._intersectionsInProgress.indexOf(this);V._intersectionsInProgress.splice(m,1)}this._intersectionsInProgress.length=0;const l=C.lights;for(const F of l){let V=F.includedOnlyMeshes.indexOf(this);-1!==V&&F.includedOnlyMeshes.splice(V,1),V=F.excludedMeshes.indexOf(this),-1!==V&&F.excludedMeshes.splice(V,1);const I=F.getShadowGenerators();if(I){const m=I.values();for(let I=m.next();!0!==I.done;I=m.next()){const m=I.value.getShadowMap();m&&m.renderList&&(V=m.renderList.indexOf(this),-1!==V&&m.renderList.splice(V,1))}}}"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes(!0);const s=C.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,s.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),s.wipeCaches(),C.QE(this),this._parentContainer){const V=this._parentContainer.meshes.indexOf(this);V>-1&&this._parentContainer.meshes.splice(V,1),this._parentContainer=null}if(m&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!V)for(I=0;I<C.ZY.length;I++)C.ZY[I].i===this&&(C.ZY[I].dispose(),I--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(V,m)}_initFacetData(){const V=this._internalAbstractMeshDataInfo._facetData;V.facetNormals||(V.facetNormals=[]),V.facetPositions||(V.facetPositions=[]),V.facetPartitioning||(V.facetPartitioning=new Array),V.facetNb=this.AF().length/3|0,V.partitioningSubdivisions=V.partitioningSubdivisions?V.partitioningSubdivisions:10,V.partitioningBBoxRatio=V.partitioningBBoxRatio?V.partitioningBBoxRatio:1.01;for(let I=0;I<V.facetNb;I++)V.facetNormals[I]=s.m.Zero(),V.facetPositions[I]=s.m.Zero();return V.facetDataEnabled=!0,this}updateFacetData(){const V=this._internalAbstractMeshDataInfo._facetData;V.facetDataEnabled||this._initFacetData();const I=this.getVerticesData(F.e.PositionKind),m=this.AF(),C=this.getVerticesData(F.e.NormalKind),l=this.getBoundingInfo();if(V.facetDepthSort&&!V.facetDepthSortEnabled){if(V.facetDepthSortEnabled=!0,m instanceof Uint16Array)V.depthSortedIndices=new Uint16Array(m);else if(m instanceof Uint32Array)V.depthSortedIndices=new Uint32Array(m);else{let I=!1;for(let V=0;V<m.length;V++)if(m[V]>65535){I=!0;break}V.depthSortedIndices=I?new Uint32Array(m):new Uint16Array(m)}if(V.facetDepthSortFunction=function(V,I){return I.sqDistance-V.sqDistance},!V.facetDepthSortFrom){const I=this.cV().activeCamera;V.facetDepthSortFrom=I?I.position:s.m.Zero()}V.depthSortedFacets=[];for(let I=0;I<V.facetNb;I++){const m={ind:3*I,sqDistance:0};V.depthSortedFacets.push(m)}V.invertedMatrix=s.b.Identity(),V.facetDepthSortOrigin=s.m.Zero()}V.bbSize.x=l.maximum.x-l.minimum.x>t.c?l.maximum.x-l.minimum.x:t.c,V.bbSize.y=l.maximum.y-l.minimum.y>t.c?l.maximum.y-l.minimum.y:t.c,V.bbSize.z=l.maximum.z-l.minimum.z>t.c?l.maximum.z-l.minimum.z:t.c;let j=V.bbSize.x>V.bbSize.y?V.bbSize.x:V.bbSize.y;if(j=j>V.bbSize.z?j:V.bbSize.z,V.subDiv.max=V.partitioningSubdivisions,V.subDiv.X=Math.floor(V.subDiv.max*V.bbSize.x/j),V.subDiv.Y=Math.floor(V.subDiv.max*V.bbSize.y/j),V.subDiv.Z=Math.floor(V.subDiv.max*V.bbSize.z/j),V.subDiv.X=V.subDiv.X<1?1:V.subDiv.X,V.subDiv.Y=V.subDiv.Y<1?1:V.subDiv.Y,V.subDiv.Z=V.subDiv.Z<1?1:V.subDiv.Z,V.facetParameters.facetNormals=this.getFacetLocalNormals(),V.facetParameters.facetPositions=this.getFacetLocalPositions(),V.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),V.facetParameters.bInfo=l,V.facetParameters.bbSize=V.bbSize,V.facetParameters.subDiv=V.subDiv,V.facetParameters.ratio=this.partitioningBBoxRatio,V.facetParameters.depthSort=V.facetDepthSort,V.facetDepthSort&&V.facetDepthSortEnabled&&(this.fF(!0),this._worldMatrix.invertToRef(V.invertedMatrix),s.m.TransformCoordinatesToRef(V.facetDepthSortFrom,V.invertedMatrix,V.facetDepthSortOrigin),V.facetParameters.distanceTo=V.facetDepthSortOrigin),V.facetParameters.depthSortedFacets=V.depthSortedFacets,C&&k.c.ComputeNormals(I,m,C,V.facetParameters),V.facetDepthSort&&V.facetDepthSortEnabled){V.depthSortedFacets.sort(V.facetDepthSortFunction);const I=V.depthSortedIndices.length/3|0;for(let C=0;C<I;C++){const I=V.depthSortedFacets[C].ind;V.depthSortedIndices[3*C]=m[I],V.depthSortedIndices[3*C+1]=m[I+1],V.depthSortedIndices[3*C+2]=m[I+2]}this.updateIndices(V.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const V=this._internalAbstractMeshDataInfo._facetData;return V.facetNormals||this.updateFacetData(),V.facetNormals}getFacetLocalPositions(){const V=this._internalAbstractMeshDataInfo._facetData;return V.facetPositions||this.updateFacetData(),V.facetPositions}getFacetLocalPartitioning(){const V=this._internalAbstractMeshDataInfo._facetData;return V.facetPartitioning||this.updateFacetData(),V.facetPartitioning}getFacetPosition(V){const I=s.m.Zero();return this.getFacetPositionToRef(V,I),I}getFacetPositionToRef(V,I){const m=this.getFacetLocalPositions()[V],C=this.getWorldMatrix();return s.m.TransformCoordinatesToRef(m,C,I),this}getFacetNormal(V){const I=s.m.Zero();return this.getFacetNormalToRef(V,I),I}getFacetNormalToRef(V,I){const m=this.getFacetLocalNormals()[V];return s.m.TransformNormalToRef(m,this.getWorldMatrix(),I),this}getFacetsAtLocalCoordinates(V,I,m){const C=this.getBoundingInfo(),l=this._internalAbstractMeshDataInfo._facetData,s=Math.floor((V-C.minimum.x*l.partitioningBBoxRatio)*l.subDiv.X*l.partitioningBBoxRatio/l.bbSize.x),F=Math.floor((I-C.minimum.y*l.partitioningBBoxRatio)*l.subDiv.Y*l.partitioningBBoxRatio/l.bbSize.y),k=Math.floor((m-C.minimum.z*l.partitioningBBoxRatio)*l.subDiv.Z*l.partitioningBBoxRatio/l.bbSize.z);return s<0||s>l.subDiv.max||F<0||F>l.subDiv.max||k<0||k>l.subDiv.max?null:l.facetPartitioning[s+l.subDiv.max*F+l.subDiv.max*l.subDiv.max*k]}getClosestFacetAtCoordinates(V,I,m,C){let l=arguments.length>4&&void 0!==arguments[4]&&arguments[4],F=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const k=this.getWorldMatrix(),j=s.g.Matrix[5];k.invertToRef(j);const E=s.g.LF[8];s.m.TransformCoordinatesFromFloatsToRef(V,I,m,j,E);const K=this.getClosestFacetAtLocalCoordinates(E.x,E.y,E.z,C,l,F);return C&&s.m.TransformCoordinatesFromFloatsToRef(C.x,C.y,C.z,k,C),K}getClosestFacetAtLocalCoordinates(V,I,m,C){let l=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],F=null,k=0,j=0,E=0,K=0,Y=0,X=0,O=0,v=0;const N=this.getFacetLocalPositions(),t=this.getFacetLocalNormals(),D=this.getFacetsAtLocalCoordinates(V,I,m);if(!D)return null;let b,T,n,x=Number.MAX_VALUE,S=x;for(let c=0;c<D.length;c++)b=D[c],T=t[b],n=N[b],K=(V-n.x)*T.x+(I-n.y)*T.y+(m-n.z)*T.z,(!l||l&&s&&K>=0||l&&!s&&K<=0)&&(K=T.x*n.x+T.y*n.y+T.z*n.z,Y=-(T.x*V+T.y*I+T.z*m-K)/(T.x*T.x+T.y*T.y+T.z*T.z),X=V+T.x*Y,O=I+T.y*Y,v=m+T.z*Y,k=X-V,j=O-I,E=v-m,S=k*k+j*j+E*E,S<x&&(x=S,F=b,C&&(C.x=X,C.y=O,C.z=v)));return F}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const V=this._internalAbstractMeshDataInfo._facetData;return V.facetDataEnabled&&(V.facetDataEnabled=!1,V.facetPositions=[],V.facetNormals=[],V.facetPartitioning=new Array,V.facetParameters={},V.depthSortedIndices=new Uint32Array(0)),this}updateIndices(V,I){return this}createNormals(V){const I=this.getVerticesData(F.e.PositionKind),m=this.AF();let C;return C=this.isVerticesDataPresent(F.e.NormalKind)?this.getVerticesData(F.e.NormalKind):[],k.c.ComputeNormals(I,m,C,{useRightHandedSystem:this.cV().useRightHandedSystem}),this.hV(F.e.NormalKind,C,V),this}async optimizeIndicesAsync(){const V=this.AF();if(!V)return this;const{OptimizeIndices:I}=await m.e(35).then(m.bind(m,13691));return I(V),this.setIndices(V,this.getTotalVertices()),this}alignWithNormal(V,I){I||(I=D.c.Y);const m=s.g.LF[0],C=s.g.LF[1];return s.m.CrossToRef(I,V,C),s.m.CrossToRef(V,C,m),this.rotationQuaternion?s.e.RotationQuaternionFromAxisToRef(m,V,C,this.rotationQuaternion):s.m.RotationFromAxisToRef(m,V,C,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,O.c)("EdgesRenderer")}enableEdgesRendering(V,I,m){throw(0,O.c)("EdgesRenderer")}BY(){return this._scene.ZY.filter((V=>V.i===this))}}c.OCCLUSION_TYPE_NONE=0,c.OCCLUSION_TYPE_OPTIMISTIC=1,c.OCCLUSION_TYPE_STRICT=2,c.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,c.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,c.CULLINGSTRATEGY_STANDARD=0,c.MK=1,c.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,c.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,C.d)([T.c.filter((function(){for(var V=arguments.length,I=new Array(V),m=0;m<V;m++)I[m]=arguments[m];let[C,l,s,F,k]=I;return!Array.isArray(C)&&!Array.isArray(l)&&!Array.isArray(s)&&!Array.isArray(F)&&!Array.isArray(k)}))],c,"_ApplySkeleton",null),(0,b.h)("BABYLON.AbstractMesh",c)},11765:(V,I,m)=>{m.d(I,{e:()=>C.e});var C=m(11233)},11406:(V,I,m)=>{m.d(I,{e:()=>t});var C=m(11040),l=m(11312),s=m(11350),F=m(11233),k=m(11224),j=m(11409),E=m(11251),K=m(11076),Y=m(11305),X=m(11271),O=m(11061),v=m(11415),N=m(11240);class t{get boundingBias(){return this._boundingBias}set boundingBias(V){this._boundingBias?this._boundingBias.C(V):this._boundingBias=V.clone(),this.rV(!0,null)}static CreateGeometryForMesh(V){const I=new t(t.RandomId(),V.cV());return I.QV(V),I}get meshes(){return this._meshes}constructor(V,I,m){let l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._extend={minimum:new C.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),maximum:new C.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=I||O.c.LastCreatedScene,this._scene&&(this.id=V,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=l,m?this.setAllVerticesData(m,l):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),s&&(this.QV(s),s.fF(!0)))}get extend(){return this._extend}cV(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let V=0;V<this._meshes.length;V++)if(!this._meshes[V].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const V=new Set;for(const I in this._vertexBuffers)V.add(this._vertexBuffers[I].getWrapperBuffer());V.forEach((V=>{V._rebuild()}))}setAllVerticesData(V,I){V.applyToGeometry(this,I),this._notifyUpdate()}hV(V,I){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3?arguments[3]:void 0;m&&Array.isArray(I)&&(I=new Float32Array(I));const l=new F.e(this._engine,I,V,{updatable:m,postponeInternalCreation:0===this._meshes.length,stride:C,label:"Geometry_"+this.id+"_"+V});this.setVerticesBuffer(l)}removeVerticesData(V){this._vertexBuffers[V]&&(this._vertexBuffers[V].dispose(),delete this._vertexBuffers[V]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const l=V.getKind();this._vertexBuffers[l]&&m&&this._vertexBuffers[l].dispose(),V._buffer&&V._buffer._increaseReferences(),this._vertexBuffers[l]=V;const s=this._meshes,k=s.length;if(l===F.e.PositionKind){this._totalVertices=I??V._maxVerticesCount,this._updateExtend(V.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const m=this._extend&&this._extend.minimum||new C.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),l=this._extend&&this._extend.maximum||new C.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let V=0;V<k;V++){const I=s[V];I.buildBoundingInfo(m,l),I._createGlobalSubMesh(I.isUnIndexed),I.fF(!0),I.synchronizeInstances()}}this._notifyUpdate(l)}updateVerticesDataDirectly(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const l=this.getVertexBuffer(V);l&&(l.updateDirectly(I,m,C),this._notifyUpdate(V))}updateVerticesData(V,I){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const C=this.getVertexBuffer(V);C&&(C.update(I),V===F.e.PositionKind&&this.rV(m,I),this._notifyUpdate(V))}rV(V,I){if(V&&this._updateExtend(I),this._resetPointsArrayCache(),V){const V=this._meshes;for(const I of V){I.hasBoundingInfo?I.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):I.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const V=I.kk;for(const I of V)I.refreshBoundingInfo()}}}_bind(V,I,m,C){if(!V)return;void 0===I&&(I=this._indexBuffer);const l=this.getVertexBuffers();if(!l)return;if(I!=this._indexBuffer||!this._vertexArrayObjects&&!C)return void this._engine.bindBuffers(l,I,V,m);const s=C||this._vertexArrayObjects,F=this._engine;s[V.key]||(s[V.key]=F.recordVertexArrayObject(l,I,V,m)),F.bindVertexArrayObject(s[V.key],I)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(V,I,m){const C=this.getVertexBuffer(V);return C?C.getFloatData(this._totalVertices,m||I&&1!==this._meshes.length):null}copyVerticesData(V,I){const m=this.getVertexBuffer(V);if(!m)return;I[V]||(I[V]=new Float32Array(this._totalVertices*m.getSize()));const C=m.getData();C&&(0,N.i)(C,m.getSize(),m.type,m.byteOffset,m.byteStride,m.normalized,this._totalVertices,I[V])}isVertexBufferUpdatable(V){const I=this._vertexBuffers[V];return!!I&&I.isUpdatable()}getVertexBuffer(V){return this.isReady()?this._vertexBuffers[V]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(V){return this._vertexBuffers?void 0!==this._vertexBuffers[V]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(V)}getVerticesDataKinds(){const V=[];let I;if(!this._vertexBuffers&&this._delayInfo)for(I in this._delayInfo)V.push(I);else for(I in this._vertexBuffers)V.push(I);return V}updateIndices(V,I){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const C=V.length!==this._indices.length;if(m||(this._indices=V.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,V,I),C)for(const V of this._meshes)V._createGlobalSubMesh(!0)}else this.setIndices(V,null,!0)}setIndexBuffer(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=V,this._totalVertices=I,this._totalIndices=m,V.is32Bits=null===C?I>65535:C;for(const l of this._meshes)l._createGlobalSubMesh(!0),l.synchronizeInstances();this._notifyUpdate()}setIndices(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=V,this._indexBufferIsUpdatable=m,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,m,"Geometry_"+this.id+"_IndexBuffer")),void 0!=I&&(this._totalVertices=I);for(const l of this._meshes)l._createGlobalSubMesh(!C),l.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}AF(V,I){if(!this.isReady())return null;const m=this._indices;return I||V&&1!==this._meshes.length?m.slice():m}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;V&&this._vertexArrayObjects&&this._vertexArrayObjects[V.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[V.key]),delete this._vertexArrayObjects[V.key])}releaseForMesh(V,I){const m=this._meshes,C=m.indexOf(V);-1!==C&&(m.splice(C,1),this._vertexArrayObjects&&V._invalidateInstanceVertexArrayObject(),V._geometry=null,0===m.length&&I&&this.dispose())}QV(V){if(V._geometry===this)return;const I=V._geometry;I&&I.releaseForMesh(V),this._vertexArrayObjects&&V._invalidateInstanceVertexArrayObject();const m=this._meshes;V._geometry=this,V._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),m.push(V),this.isReady()?this._applyToMesh(V):this._boundingInfo&&V.setBoundingInfo(this._boundingInfo)}_updateExtend(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!V&&(V=this.getVerticesData(F.e.PositionKind),!V))return;this._extend=(0,X.e)(V,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(V){const I=this._meshes.length;for(const m in this._vertexBuffers)1===I&&this._vertexBuffers[m].create(),m===F.e.PositionKind&&(this._extend||this._updateExtend(),V.buildBoundingInfo(this._extend.minimum,this._extend.maximum),V._createGlobalSubMesh(V.isUnIndexed),V.rV());1===I&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),V._syncGeometryWithMorphTargetManager(),V.synchronizeInstances()}_notifyUpdate(V){this.onGeometryUpdated&&this.onGeometryUpdated(this,V),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const I of this._meshes)I._markSubMeshesAsAttributesDirty()}load(V,I){2!==this.delayLoadState&&(this.isReady()?I&&I():(this.delayLoadState=2,this._queueLoad(V,I)))}_queueLoad(V,I){this.delayLoadingFile&&(V.addPendingData(this),V._loadFile(this.delayLoadingFile,(m=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(m),this),this.delayLoadState=1,this._delayInfo=[],V.removePendingData(this);const C=this._meshes,l=C.length;for(let V=0;V<l;V++)this._applyToMesh(C[V]);I&&I()}),void 0,!0))}toLeftHanded(){const V=this.AF(!1);if(null!=V&&V.length>0){for(let I=0;I<V.length;I+=3){const m=V[I+0];V[I+0]=V[I+2],V[I+2]=m}this.setIndices(V)}const I=this.getVerticesData(F.e.PositionKind,!1);if(null!=I&&I.length>0){for(let V=0;V<I.length;V+=3)I[V+2]=-I[V+2];this.hV(F.e.PositionKind,I,!1)}const m=this.getVerticesData(F.e.NormalKind,!1);if(null!=m&&m.length>0){for(let V=0;V<m.length;V+=3)m[V+2]=-m[V+2];this.hV(F.e.NormalKind,m,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const V=this.getVerticesData(F.e.PositionKind);if(!V||0===V.length)return!1;for(let I=3*this._positionsCache.length,m=this._positionsCache.length;I<V.length;I+=3,++m)this._positionsCache[m]=C.m.Ik(V,I);for(let I=0,m=0;I<V.length;I+=3,++m)this._positionsCache[m].set(V[0+I],V[1+I],V[2+I]);return this._positionsCache.length=V.length/3,this._positions=this._positionsCache,!0}K(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const m in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[m]);this._vertexArrayObjects={};const V=this._meshes,I=V.length;for(let m=0;m<I;m++)V[m]._invalidateInstanceVertexArrayObject()}}dispose(){const V=this._meshes,I=V.length;let m;for(m=0;m<I;m++)this.releaseForMesh(V[m]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const C in this._vertexBuffers)this._vertexBuffers[C].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const V=this._parentContainer.geometries.indexOf(this);V>-1&&this._parentContainer.geometries.splice(V,1),this._parentContainer=null}this._isDisposed=!0}j(V){const I=new s.c;I.indices=[];const m=this.AF();if(m)for(let s=0;s<m.length;s++)I.indices.push(m[s]);let C,l=!1,F=!1;for(C in this._vertexBuffers){const V=this.getVerticesData(C);if(V&&(V instanceof Float32Array?I.set(new Float32Array(V),C):I.set(V.slice(0),C),!F)){const V=this.getVertexBuffer(C);V&&(l=V.isUpdatable(),F=!l)}}const k=new t(V,this._scene,I,l);for(C in k.delayLoadState=this.delayLoadState,k.delayLoadingFile=this.delayLoadingFile,k._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)k._delayInfo=k._delayInfo||[],k._delayInfo.push(C);return k._boundingInfo=new E.d(this._extend.minimum,this._extend.maximum),k}serialize(){const V={};return V.id=this.id,V.uniqueId=this.uniqueId,V.updatable=this._updatable,Y.b&&Y.b.HasTags(this)&&(V.tags=Y.b.GetTags(this)),V}_toNumberArray(V){return Array.isArray(V)?V:Array.prototype.slice.call(V)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const V in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,V)&&(this._vertexBuffers[V]._buffer._data=null)}serializeVerticeData(){const V=this.serialize();return this.isVerticesDataPresent(F.e.PositionKind)&&(V.yV=this._toNumberArray(this.getVerticesData(F.e.PositionKind)),this.isVertexBufferUpdatable(F.e.PositionKind)&&(V.positionsUpdatable=!0)),this.isVerticesDataPresent(F.e.NormalKind)&&(V.zV=this._toNumberArray(this.getVerticesData(F.e.NormalKind)),this.isVertexBufferUpdatable(F.e.NormalKind)&&(V.normalsUpdatable=!0)),this.isVerticesDataPresent(F.e.TangentKind)&&(V.tangents=this._toNumberArray(this.getVerticesData(F.e.TangentKind)),this.isVertexBufferUpdatable(F.e.TangentKind)&&(V.tangentsUpdatable=!0)),this.isVerticesDataPresent(F.e.UVKind)&&(V.BV=this._toNumberArray(this.getVerticesData(F.e.UVKind)),this.isVertexBufferUpdatable(F.e.UVKind)&&(V.uvsUpdatable=!0)),this.isVerticesDataPresent(F.e.UV2Kind)&&(V.uvs2=this._toNumberArray(this.getVerticesData(F.e.UV2Kind)),this.isVertexBufferUpdatable(F.e.UV2Kind)&&(V.uvs2Updatable=!0)),this.isVerticesDataPresent(F.e.UV3Kind)&&(V.uvs3=this._toNumberArray(this.getVerticesData(F.e.UV3Kind)),this.isVertexBufferUpdatable(F.e.UV3Kind)&&(V.uvs3Updatable=!0)),this.isVerticesDataPresent(F.e.UV4Kind)&&(V.uvs4=this._toNumberArray(this.getVerticesData(F.e.UV4Kind)),this.isVertexBufferUpdatable(F.e.UV4Kind)&&(V.uvs4Updatable=!0)),this.isVerticesDataPresent(F.e.UV5Kind)&&(V.uvs5=this._toNumberArray(this.getVerticesData(F.e.UV5Kind)),this.isVertexBufferUpdatable(F.e.UV5Kind)&&(V.uvs5Updatable=!0)),this.isVerticesDataPresent(F.e.UV6Kind)&&(V.uvs6=this._toNumberArray(this.getVerticesData(F.e.UV6Kind)),this.isVertexBufferUpdatable(F.e.UV6Kind)&&(V.uvs6Updatable=!0)),this.isVerticesDataPresent(F.e.ColorKind)&&(V.ZV=this._toNumberArray(this.getVerticesData(F.e.ColorKind)),this.isVertexBufferUpdatable(F.e.ColorKind)&&(V.colorsUpdatable=!0)),this.isVerticesDataPresent(F.e.MatricesIndicesKind)&&(V.matricesIndices=this._toNumberArray(this.getVerticesData(F.e.MatricesIndicesKind)),V.matricesIndicesExpanded=!0,this.isVertexBufferUpdatable(F.e.MatricesIndicesKind)&&(V.matricesIndicesUpdatable=!0)),this.isVerticesDataPresent(F.e.MatricesWeightsKind)&&(V.matricesWeights=this._toNumberArray(this.getVerticesData(F.e.MatricesWeightsKind)),this.isVertexBufferUpdatable(F.e.MatricesWeightsKind)&&(V.matricesWeightsUpdatable=!0)),V.indices=this._toNumberArray(this.AF()),V}static ExtractFromMesh(V,I){const m=V._geometry;return m?m.j(I):null}static RandomId(){return K.d.RandomId()}static _GetGeometryByLoadedUniqueId(V,I){for(let m=0;m<I.geometries.length;m++)if(I.geometries[m]._loadedUniqueId===V)return I.geometries[m];return null}static _ImportGeometry(V,I){const m=I.cV(),C=V.geometryUniqueId,s=V.geometryId;if(C||s){const V=C?this._GetGeometryByLoadedUniqueId(C,m):m.getGeometryById(s);V&&V.QV(I)}else if(V instanceof ArrayBuffer){const m=I._binaryInfo;if(m.positionsAttrDesc&&m.positionsAttrDesc.count>0){const C=new Float32Array(V,m.positionsAttrDesc.offset,m.positionsAttrDesc.count);I.hV(F.e.PositionKind,C,!1)}if(m.normalsAttrDesc&&m.normalsAttrDesc.count>0){const C=new Float32Array(V,m.normalsAttrDesc.offset,m.normalsAttrDesc.count);I.hV(F.e.NormalKind,C,!1)}if(m.tangetsAttrDesc&&m.tangetsAttrDesc.count>0){const C=new Float32Array(V,m.tangetsAttrDesc.offset,m.tangetsAttrDesc.count);I.hV(F.e.TangentKind,C,!1)}if(m.uvsAttrDesc&&m.uvsAttrDesc.count>0){const C=new Float32Array(V,m.uvsAttrDesc.offset,m.uvsAttrDesc.count);if(v.e)for(let V=1;V<C.length;V+=2)C[V]=1-C[V];I.hV(F.e.UVKind,C,!1)}if(m.uvs2AttrDesc&&m.uvs2AttrDesc.count>0){const C=new Float32Array(V,m.uvs2AttrDesc.offset,m.uvs2AttrDesc.count);if(v.e)for(let V=1;V<C.length;V+=2)C[V]=1-C[V];I.hV(F.e.UV2Kind,C,!1)}if(m.uvs3AttrDesc&&m.uvs3AttrDesc.count>0){const C=new Float32Array(V,m.uvs3AttrDesc.offset,m.uvs3AttrDesc.count);if(v.e)for(let V=1;V<C.length;V+=2)C[V]=1-C[V];I.hV(F.e.UV3Kind,C,!1)}if(m.uvs4AttrDesc&&m.uvs4AttrDesc.count>0){const C=new Float32Array(V,m.uvs4AttrDesc.offset,m.uvs4AttrDesc.count);if(v.e)for(let V=1;V<C.length;V+=2)C[V]=1-C[V];I.hV(F.e.UV4Kind,C,!1)}if(m.uvs5AttrDesc&&m.uvs5AttrDesc.count>0){const C=new Float32Array(V,m.uvs5AttrDesc.offset,m.uvs5AttrDesc.count);if(v.e)for(let V=1;V<C.length;V+=2)C[V]=1-C[V];I.hV(F.e.UV5Kind,C,!1)}if(m.uvs6AttrDesc&&m.uvs6AttrDesc.count>0){const C=new Float32Array(V,m.uvs6AttrDesc.offset,m.uvs6AttrDesc.count);if(v.e)for(let V=1;V<C.length;V+=2)C[V]=1-C[V];I.hV(F.e.UV6Kind,C,!1)}if(m.colorsAttrDesc&&m.colorsAttrDesc.count>0){const C=new Float32Array(V,m.colorsAttrDesc.offset,m.colorsAttrDesc.count);I.hV(F.e.ColorKind,C,!1,m.colorsAttrDesc.stride)}if(m.matricesIndicesAttrDesc&&m.matricesIndicesAttrDesc.count>0){const C=new Int32Array(V,m.matricesIndicesAttrDesc.offset,m.matricesIndicesAttrDesc.count),l=[];for(let V=0;V<C.length;V++){const I=C[V];l.push(255&I),l.push((65280&I)>>8),l.push((16711680&I)>>16),l.push(I>>24&255)}I.hV(F.e.MatricesIndicesKind,l,!1)}if(m.matricesIndicesExtraAttrDesc&&m.matricesIndicesExtraAttrDesc.count>0){const C=new Int32Array(V,m.matricesIndicesExtraAttrDesc.offset,m.matricesIndicesExtraAttrDesc.count),l=[];for(let V=0;V<C.length;V++){const I=C[V];l.push(255&I),l.push((65280&I)>>8),l.push((16711680&I)>>16),l.push(I>>24&255)}I.hV(F.e.MatricesIndicesExtraKind,l,!1)}if(m.matricesWeightsAttrDesc&&m.matricesWeightsAttrDesc.count>0){const C=new Float32Array(V,m.matricesWeightsAttrDesc.offset,m.matricesWeightsAttrDesc.count);I.hV(F.e.MatricesWeightsKind,C,!1)}if(m.indicesAttrDesc&&m.indicesAttrDesc.count>0){const C=new Int32Array(V,m.indicesAttrDesc.offset,m.indicesAttrDesc.count);I.setIndices(C,null)}if(m.subMeshesAttrDesc&&m.subMeshesAttrDesc.count>0){const C=new Int32Array(V,m.subMeshesAttrDesc.offset,5*m.subMeshesAttrDesc.count);I.kk=[];for(let V=0;V<m.subMeshesAttrDesc.count;V++){const m=C[5*V+0],l=C[5*V+1],s=C[5*V+2],F=C[5*V+3],j=C[5*V+4];k.e.AddToMesh(m,l,s,F,j,I)}}}else if(V.yV&&V.zV&&V.indices){if(I.hV(F.e.PositionKind,V.yV,V.yV._updatable||V.positionsUpdatable),I.hV(F.e.NormalKind,V.zV,V.zV._updatable||V.normalsUpdatable),V.tangents&&I.hV(F.e.TangentKind,V.tangents,V.tangents._updatable||V.tangentsUpdatable),V.BV&&I.hV(F.e.UVKind,V.BV,V.BV._updatable||V.uvsUpdatable),V.uvs2&&I.hV(F.e.UV2Kind,V.uvs2,V.uvs2._updatable||V.uvs2Updatable),V.uvs3&&I.hV(F.e.UV3Kind,V.uvs3,V.uvs3._updatable||V.uvs3Updatable),V.uvs4&&I.hV(F.e.UV4Kind,V.uvs4,V.uvs4._updatable||V.uvs4Updatable),V.uvs5&&I.hV(F.e.UV5Kind,V.uvs5,V.uvs5._updatable||V.uvs5Updatable),V.uvs6&&I.hV(F.e.UV6Kind,V.uvs6,V.uvs6._updatable||V.uvs6Updatable),V.ZV&&I.hV(F.e.ColorKind,l.d.CheckColors4(V.ZV,V.yV.length/3),V.ZV._updatable),V.matricesIndices)if(V.matricesIndices._isExpanded||V.matricesIndicesExpanded)delete V.matricesIndices._isExpanded,delete V.matricesIndicesExpanded,I.hV(F.e.MatricesIndicesKind,V.matricesIndices,V.matricesIndices._updatable||V.matricesIndicesUpdatable);else{const m=[];for(let I=0;I<V.matricesIndices.length;I++){const C=V.matricesIndices[I];m.push(255&C),m.push((65280&C)>>8),m.push((16711680&C)>>16),m.push(C>>24&255)}I.hV(F.e.MatricesIndicesKind,m,V.matricesIndices._updatable||V.matricesIndicesUpdatable)}if(V.matricesIndicesExtra)if(V.matricesIndicesExtraExpanded||V.matricesIndicesExtra._isExpanded)delete V.matricesIndices._isExpanded,delete V.matricesIndicesExtraExpanded,I.hV(F.e.MatricesIndicesExtraKind,V.matricesIndicesExtra,V.matricesIndicesExtra._updatable||V.matricesIndicesExtraUpdatable);else{const m=[];for(let I=0;I<V.matricesIndicesExtra.length;I++){const C=V.matricesIndicesExtra[I];m.push(255&C),m.push((65280&C)>>8),m.push((16711680&C)>>16),m.push(C>>24&255)}I.hV(F.e.MatricesIndicesExtraKind,m,V.matricesIndicesExtra._updatable||V.matricesIndicesExtraUpdatable)}V.matricesWeights&&(t._CleanMatricesWeights(V,I),I.hV(F.e.MatricesWeightsKind,V.matricesWeights,V.matricesWeights._updatable)),V.matricesWeightsExtra&&I.hV(F.e.MatricesWeightsExtraKind,V.matricesWeightsExtra,V.matricesWeights._updatable),I.setIndices(V.indices,null)}if(V.kk){I.kk=[];for(let m=0;m<V.kk.length;m++){const C=V.kk[m];k.e.AddToMesh(C.materialIndex,C.verticesStart,C.verticesCount,C.indexStart,C.indexCount,I)}}I._shouldGenerateFlatShading&&(I.convertToFlatShadedMesh(),I._shouldGenerateFlatShading=!1),I.fF(!0),m.onMeshImportedObservable.notifyObservers(I)}static _CleanMatricesWeights(V,I){const m=.001;if(!j.d.CleanBoneMatrixWeights)return;let C=0;if(!(V.skeletonId>-1))return;{const m=I.cV().getLastSkeletonById(V.skeletonId);if(!m)return;C=m.bones.length}const l=I.getVerticesData(F.e.MatricesIndicesKind),s=I.getVerticesData(F.e.MatricesIndicesExtraKind),k=V.matricesWeights,E=V.matricesWeightsExtra,K=V.numBoneInfluencer,Y=k.length;for(let F=0;F<Y;F+=4){let V=0,I=-1;for(let C=0;C<4;C++){const l=k[F+C];V+=l,l<m&&I<0&&(I=C)}if(E)for(let C=0;C<4;C++){const l=E[F+C];V+=l,l<m&&I<0&&(I=C+4)}if((I<0||I>K-1)&&(I=K-1),V>m){const I=1/V;for(let V=0;V<4;V++)k[F+V]*=I;if(E)for(let V=0;V<4;V++)E[F+V]*=I}else I>=4?(E[F+I-4]=1-V,s[F+I-4]=C):(k[F+I]=1-V,l[F+I]=C)}I.hV(F.e.MatricesIndicesKind,l),V.matricesWeightsExtra&&I.hV(F.e.MatricesIndicesExtraKind,s)}static Parse(V,I,m){const l=new t(V.id,I,void 0,V.updatable);return l._loadedUniqueId=V.uniqueId,Y.b&&Y.b.AddTagsTo(l,V.tags),V.delayLoadingFile?(l.delayLoadState=4,l.delayLoadingFile=m+V.delayLoadingFile,l._boundingInfo=new E.d(C.m.Ik(V.boundingBoxMinimum),C.m.Ik(V.boundingBoxMaximum)),l._delayInfo=[],V.hasUVs&&l._delayInfo.push(F.e.UVKind),V.hasUVs2&&l._delayInfo.push(F.e.UV2Kind),V.hasUVs3&&l._delayInfo.push(F.e.UV3Kind),V.hasUVs4&&l._delayInfo.push(F.e.UV4Kind),V.hasUVs5&&l._delayInfo.push(F.e.UV5Kind),V.hasUVs6&&l._delayInfo.push(F.e.UV6Kind),V.hasColors&&l._delayInfo.push(F.e.ColorKind),V.hasMatricesIndices&&l._delayInfo.push(F.e.MatricesIndicesKind),V.hasMatricesWeights&&l._delayInfo.push(F.e.MatricesWeightsKind),l._delayLoadingFunction=s.c.ImportVertexData):s.c.ImportVertexData(V,l),I.pushGeometry(l,!0),l}}},11380:(V,I,m)=>{m.d(I,{c:()=>X});var C=m(11040),l=m(11085),s=m(11342),F=m(11384),k=m(11089),j=m(11332),E=m(11233),K=m(11076),Y=m(11048);F.c._instancedMeshFactory=(V,I)=>{const m=new X(V,I);if(I.instancedBuffers){m.instancedBuffers={};for(const V in I.instancedBuffers)m.instancedBuffers[V]=I.instancedBuffers[V]}return m};class X extends s.e{constructor(V,I){super(V,I.cV()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,I.MY(this),this._sourceMesh=I,this._unIndexed=I._unIndexed,this.position.C(I.position),this.rotation.C(I.rotation),this.Vk.C(I.Vk),I.rotationQuaternion&&(this.rotationQuaternion=I.rotationQuaternion.clone()),this.animations=I.animations.slice();for(const m of I.getAnimationRanges())null!=m&&this.createAnimationRange(m.name,m.from,m.to);if(this.infiniteDistance=I.infiniteDistance,this.setPivotMatrix(I.getPivotMatrix()),I.skeleton||I.morphTargetManager||!I.hasBoundingInfo)this.refreshBoundingInfo(!0,!0);else{const V=I.getBoundingInfo();this.buildBoundingInfo(V.minimum,V.maximum)}this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(V){var I;(null===(I=this._sourceMesh)||void 0===I?void 0:I.receiveShadows)!==V&&K.d.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(V){var I;(null===(I=this._sourceMesh)||void 0===I?void 0:I.material)!==V&&K.d.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(V){var I;(null===(I=this._sourceMesh)||void 0===I?void 0:I.visibility)!==V&&K.d.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(V){var I;(null===(I=this._sourceMesh)||void 0===I?void 0:I.skeleton)!==V&&K.d.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(V){this._sourceMesh&&V!==this._sourceMesh.renderingGroupId&&l.d.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}get wF(){return this._sourceMesh._geometry}createInstance(V){return this._sourceMesh.createInstance(V)}isReady(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(V,!0)}getVerticesData(V,I,m){return this._sourceMesh.getVerticesData(V,I,m)}copyVerticesData(V,I){this._sourceMesh.copyVerticesData(V,I)}hV(V,I,m,C){return this.sourceMesh&&this.sourceMesh.hV(V,I,m,C),this.sourceMesh}updateVerticesData(V,I,m,C){return this.sourceMesh&&this.sourceMesh.updateVerticesData(V,I,m,C),this.sourceMesh}setIndices(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(V,I),this.sourceMesh}isVerticesDataPresent(V){return this._sourceMesh.isVerticesDataPresent(V)}AF(){return this._sourceMesh.AF()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let V,I=arguments.length>0&&void 0!==arguments[0]&&arguments[0],m=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;V="object"===typeof I?I:{applySkeleton:I,applyMorph:m};const C=this._sourceMesh.wF?this._sourceMesh.wF.boundingBias:null;return this.gV(this._sourceMesh._getData(V,null,E.e.PositionKind),C),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(V,I){if(super._activate(V,I),this._sourceMesh.kk||l.d.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,V),I){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD!==this._sourceMesh&&this._currentLOD.billboardMode!==j.c.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new C.b);const V=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,C.g.LF[7].C(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.C(this._currentLOD.fF(!0)),this._currentLOD.position.C(C.g.LF[7]),this._currentLOD._masterMesh=V,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(V){if(!V)return this;const I=this.sourceMesh.getLODLevels();if(I&&0!==I.length){const I=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(V,I.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(V){return this.sourceMesh._preActivateForIntermediateRendering(V)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.kk)for(let V=0;V<this._sourceMesh.kk.length;V++)this._sourceMesh.kk[V].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}rV(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2?arguments[2]:void 0;const C=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).createInstance(V);if(k.e.DeepCopy(this,C,["name","kk","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","zY","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo","wF"],[]),this.refreshBoundingInfo(),I&&(C.parent=I),!m)for(let l=0;l<this.cV().meshes.length;l++){const V=this.cV().meshes[l];V.parent===this&&V.clone(V.name,C)}return C.fF(!0),this.onClonedObservable.notifyObservers(C),C}dispose(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.pY(this),super.dispose(V,I)}_serializeAsParent(V){super._serializeAsParent(V),V.parentId=this._sourceMesh.uniqueId,V.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,I=arguments.length>1?arguments[1]:void 0,m=arguments.length>2?arguments[2]:void 0;const C=this.clone("Clone of "+(this.name||this.id),V||this.parent,!0,I&&I.newSourcedMesh);C&&m&&m(this,C);for(const l of this.getChildTransformNodes(!0))l.instantiateHierarchy(C,I,m);return C}}F.c.prototype.registerInstancedBuffer=function(V,I){var m,C;if(null===(m=this._userInstancedBuffersStorage)||void 0===m||null===(C=m.vertexBuffers[V])||void 0===C||C.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const V of this.instances)V.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[V]=null,this._userInstancedBuffersStorage.strides[V]=I,this._userInstancedBuffersStorage.sizes[V]=32*I,this._userInstancedBuffersStorage.data[V]=new Float32Array(this._userInstancedBuffersStorage.sizes[V]),this._userInstancedBuffersStorage.vertexBuffers[V]=new E.e(this.getEngine(),this._userInstancedBuffersStorage.data[V],V,!0,!1,I,!0);for(const l of this.instances)l.instancedBuffers[V]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},F.c.prototype._processInstancedBuffers=function(V,I){const m=V?V.length:0;for(const C in this.instancedBuffers){let l=this._userInstancedBuffersStorage.sizes[C];const s=this._userInstancedBuffersStorage.strides[C],F=(m+1)*s;for(;l<F;)l*=2;this._userInstancedBuffersStorage.data[C].length!=l&&(this._userInstancedBuffersStorage.data[C]=new Float32Array(l),this._userInstancedBuffersStorage.sizes[C]=l,this._userInstancedBuffersStorage.vertexBuffers[C]&&(this._userInstancedBuffersStorage.vertexBuffers[C].dispose(),this._userInstancedBuffersStorage.vertexBuffers[C]=null));const k=this._userInstancedBuffersStorage.data[C];let j=0;if(I){const V=this.instancedBuffers[C];V.toArray?V.toArray(k,j):V.copyToArray?V.copyToArray(k,j):k[j]=V,j+=s}for(let I=0;I<m;I++){const m=V[I].instancedBuffers[C];m.toArray?m.toArray(k,j):m.copyToArray?m.copyToArray(k,j):k[j]=m,j+=s}this._userInstancedBuffersStorage.vertexBuffers[C]?this._userInstancedBuffersStorage.vertexBuffers[C].updateDirectly(k,0):(this._userInstancedBuffersStorage.vertexBuffers[C]=new E.e(this.getEngine(),this._userInstancedBuffersStorage.data[C],C,!0,!1,s,!0),this._invalidateInstanceVertexArrayObject())}},F.c.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const V in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[V]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},F.c.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const V in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[V]&&this._userInstancedBuffersStorage.vertexBuffers[V].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,Y.h)("BABYLON.InstancedMesh",X)},11715:(V,I,m)=>{m.d(I,{e:()=>E});var C=m(11312),l=m(11233),s=m(11384),F=m(11380),k=m(11202),j=m(11724);s.c._LinesMeshParser=(V,I)=>E.Parse(V,I);class E extends s.c{_isShaderMaterial(V){return"ShaderMaterial"===V.getClassName()}constructor(V){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>5?arguments[5]:void 0,F=arguments.length>6?arguments[6]:void 0,k=arguments.length>7?arguments[7]:void 0;super(V,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,I,arguments.length>4?arguments[4]:void 0),this.useVertexColor=s,this.useVertexAlpha=F,this.color=new C.c(1,1,1),this.alpha=1,this._shaderLanguage=0,I&&(this.color=I.color.clone(),this.alpha=I.alpha,this.useVertexColor=I.useVertexColor,this.useVertexAlpha=I.useVertexAlpha),this.intersectionThreshold=.1;const K={attributes:[l.e.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(this.useVertexAlpha?K.defines.push("#define VERTEXALPHA"):K.needAlphaBlending=!1,this.useVertexColor?(K.defines.push("#define VERTEXCOLOR"),K.attributes.push(l.e.ColorKind)):(K.uniforms.push("color"),this._color4=new C.d),k)this.material=k;else{this.cV().getEngine().isWebGPU&&!E.ForceGLSL&&(this._shaderLanguage=1),K.shaderLanguage=this._shaderLanguage,K.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([m.e(23).then(m.bind(m,14323)),m.e(19).then(m.bind(m,14329))]):await Promise.all([m.e(17).then(m.bind(m,14334)),m.e(16).then(m.bind(m,14338))])},this.material=new j.d("colorShader",this.cV(),"color",K,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(V){this._lineMaterial=V,this._lineMaterial.fillMode=k.d.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(V){}_bind(V,I){if(!this._geometry)return this;const m=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(I,m):this._geometry._bind(I,m,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:V,g:I,b:m}=this.color;this._color4.set(V,I,m,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(V,I,m){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const C=this.cV().getEngine();return this._unIndexed?C.drawArraysType(k.d.LineListDrawMode,V.verticesStart,V.verticesCount,m):C.drawElementsType(k.d.LineListDrawMode,V.indexStart,V.indexCount,m),this}dispose(V){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(V)}clone(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2?arguments[2]:void 0;if(I&&void 0===I._addToSceneRootNodes){const m=I;return m.source=this,new E(V,this.cV(),m.parent,m.source,m.doNotCloneChildren)}return new E(V,this.cV(),I,this,m)}createInstance(V){const I=new K(V,this);if(this.instancedBuffers){I.instancedBuffers={};for(const V in this.instancedBuffers)I.instancedBuffers[V]=this.instancedBuffers[V]}return I}serialize(V){super.serialize(V),V.color=this.color.UF(),V.alpha=this.alpha}static Parse(V,I){const m=new E(V.name,I);return m.color=C.c.Ik(V.color),m.alpha=V.alpha,m}}E.ForceGLSL=!1;class K extends F.c{constructor(V,I){super(V,I),this.intersectionThreshold=I.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}},11384:(V,I,m)=>{m.d(I,{c:()=>r,g:()=>z});var C=m(11067),l=m(11076),s=m(11089),F=m(11305),k=m(11358),j=m(11386),E=m(11040),K=m(11312),Y=m(11337),X=m(11233),O=m(11350),v=m(11406),N=m(11342),t=m(11224),D=m(11202),b=m(11419),T=m(11409),n=m(11297),x=m(11085),S=m(11048),c=m(11095),H=m(11421);class y{constructor(V,I){this.distanceOrScreenCoverage=V,this.mesh=I}}class z{}class Z{constructor(){this.visibleInstances={},this.batchCache=new B,this.batchCacheReplacementModeInFrozenMode=new B,this.instancesBufferSize=2048}}class B{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class W{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class Q{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}const G={source:null,parent:null,doNotCloneChildren:!1,clonePhysicsImpostor:!0,cloneThinInstances:!1};class r extends N.e{static _GetDefaultSideOrientation(V){return V||r.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(V){this._internalMeshDataInfo._useLODScreenCoverage=V,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(V){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==V&&(V&&this._internalMeshDataInfo._sourcePositions&&(this.hV(X.e.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.hV(X.e.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=V,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new C.e),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new C.e),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new C.e),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new C.e),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new C.e),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(V){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(V)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(V){this._internalMeshDataInfo._forcedInstanceCount=V}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(V){this._internalMeshDataInfo._sideOrientation=V,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===V||!this._scene.useRightHandedSystem&&0===V}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(V){this.sideOrientation=V,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(V){this._internalMeshDataInfo._overrideRenderingFillMode=V}get material(){return this._internalAbstractMeshDataInfo._material}set material(V){V&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(V.sideOrientation=null),this._setMaterial(V)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(V){this._unIndexed!==V&&(this._unIndexed=V,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(V){this._instanceDataStorage.manualUpdate=V}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(V){this._instanceDataStorage.previousManualUpdate=V}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(V){this._instanceDataStorage.forceMatrixUpdates=V}_copySource(V,I){let m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],C=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const l=this.cV();if(V._geometry&&V._geometry.QV(this),s.e.DeepCopy(V,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","wF","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","zY","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=V,l.useClonedMeshMap&&(V._internalMeshDataInfo.meshMap||(V._internalMeshDataInfo.meshMap={}),V._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=V._originalBuilderSideOrientation,this._creationDataStorage=V._creationDataStorage,V._ranges){const I=V._ranges;for(const V in I)Object.prototype.hasOwnProperty.call(I,V)&&I[V]&&this.createAnimationRange(V,I[V].from,I[V].to)}if(V.metadata&&V.metadata.clone?this.metadata=V.metadata.clone():this.metadata=V.metadata,this._internalMetadata=V._internalMetadata,F.b&&F.b.HasTags(V)&&F.b.AddTagsTo(this,F.b.GetTags(V,!0)),this.Sk(V.isEnabled(!1)),this.parent=V.parent,this.setPivotMatrix(V.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+V.id,this.material=V.material,!I){const l=V.getDescendants(!0);for(let V=0;V<l.length;V++){const s=l[V];s._isMesh?(G.parent=this,G.doNotCloneChildren=I,G.clonePhysicsImpostor=m,G.cloneThinInstances=C,s.clone(this.name+"."+s.name,G)):s.clone&&s.clone(this.name+"."+s.name,this)}}if(V.morphTargetManager&&(this.morphTargetManager=V.morphTargetManager),l.getPhysicsEngine){const I=l.getPhysicsEngine();if(m&&I)if(1===I.getPluginVersion()){const m=I.getImpostorForPhysicsObject(V);m&&(this.physicsImpostor=m.clone(this))}else 2===I.getPluginVersion()&&V.physicsBody&&V.physicsBody.clone(this)}for(let s=0;s<l.ZY.length;s++){const I=l.ZY[s];I.i===V&&I.clone(I.name,this)}if(this.skeleton=V.skeleton,C&&(V._thinInstanceDataStorage.matrixData?(this.fK("matrix",new Float32Array(V._thinInstanceDataStorage.matrixData),16,!V._thinInstanceDataStorage.matrixBuffer.isUpdatable()),this._thinInstanceDataStorage.matrixBufferSize=V._thinInstanceDataStorage.matrixBufferSize,this._thinInstanceDataStorage.instancesCount=V._thinInstanceDataStorage.instancesCount):this._thinInstanceDataStorage.matrixBufferSize=V._thinInstanceDataStorage.matrixBufferSize,V._userThinInstanceBuffersStorage)){const I=V._userThinInstanceBuffersStorage;for(const V in I.data){var k,j;this.fK(V,new Float32Array(I.data[V]),I.strides[V],!(null!==(k=I.vertexBuffers)&&void 0!==k&&null!==(j=k[V])&&void 0!==j&&j.isUpdatable())),this._userThinInstanceBuffersStorage.sizes[V]=I.sizes[V]}}this.refreshBoundingInfo(!0,!0),this.fF(!0)}constructor(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4?arguments[4]:void 0,F=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(V,I),this._internalMeshDataInfo=new Q,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new Z,this._thinInstanceDataStorage=new W,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=r.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,I=this.cV(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(V,I,m)=>{V&&m&&(this._uniformBuffer?this.transferToEffect(I):m.bindOnlyWorldMatrix(I))};let k=null,j=!1;if(m&&void 0===m._addToSceneRootNodes){const V=m;k=V.parent??null,l=V.source??null,s=V.doNotCloneChildren??!1,F=V.clonePhysicsImpostor??!0,j=V.cloneThinInstances??!1}else k=m;l&&this._copySource(l,s,F,j),null!==k&&(this.parent=k),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=V=>{V.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new C.e(this._internalMeshDataInfo._onMeshReadyObserverAdded),l&&l.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,I=arguments.length>1?arguments[1]:void 0,m=arguments.length>2?arguments[2]:void 0;const C=0===this.getTotalVertices()||I&&I.doNotInstantiate&&(!0===I.doNotInstantiate||I.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),V||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));C.parent=V||this.parent,C.position=this.position.clone(),C.Vk=this.Vk.clone(),this.rotationQuaternion?C.rotationQuaternion=this.rotationQuaternion.clone():C.rotation=this.rotation.clone(),m&&m(this,C);for(const l of this.getChildTransformNodes(!0))"InstancedMesh"===l.getClassName()&&"Mesh"===C.getClassName()&&l.sourceMesh===this?l.instantiateHierarchy(C,{doNotInstantiate:I&&I.doNotInstantiate||!1,newSourcedMesh:C},m):l.instantiateHierarchy(C,I,m);return C}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(V){let I=super.toString(V);if(I+=", n vertices: "+this.getTotalVertices(),I+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let m=0;m<this.animations.length;m++)I+=", animation[0]: "+this.animations[m].toString(V);if(V)if(this._geometry){const V=this.AF(),m=this.getVerticesData(X.e.PositionKind);m&&V&&(I+=", flat shading: "+(m.length/3===V.length?"YES":"NO"))}else I+=", flat shading: UNKNOWN";return I}_unBindEffect(){super._unBindEffect();for(const V of this.instances)V._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const V=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((I,m)=>I.distanceOrScreenCoverage<m.distanceOrScreenCoverage?V:I.distanceOrScreenCoverage>m.distanceOrScreenCoverage?-V:0))}addLODLevel(V,I){if(I&&I._masterMesh)return x.d.Warn("You cannot use a mesh as LOD level twice"),this;const m=new y(V,I);return this._internalMeshDataInfo._LODLevels.push(m),I&&(I._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(V){const I=this._internalMeshDataInfo;for(let m=0;m<I._LODLevels.length;m++){const C=I._LODLevels[m];if(C.distanceOrScreenCoverage===V)return C.mesh}return null}removeLODLevel(V){const I=this._internalMeshDataInfo;for(let m=0;m<I._LODLevels.length;m++)I._LODLevels[m].mesh===V&&(I._LODLevels.splice(m,1),V&&(V._masterMesh=null));return this._sortLODLevels(),this}getLOD(V,I){const m=this._internalMeshDataInfo;if(!m._LODLevels||0===m._LODLevels.length)return this;const C=I||this.getBoundingInfo().boundingSphere,l=V.mode===j.c.ORTHOGRAPHIC_CAMERA?V.Fk:C.centerWorld.Fm(V.globalPosition).length();let s=l,F=1;if(m._useLODScreenCoverage){const I=V.screenArea;let m=C.radiusWorld*V.Fk/l;m=m*m*Math.PI,s=m/I,F=-1}if(F*m._LODLevels[m._LODLevels.length-1].distanceOrScreenCoverage>F*s)return this.onLODLevelSelection&&this.onLODLevelSelection(s,this,this),this;for(let k=0;k<m._LODLevels.length;k++){const V=m._LODLevels[k];if(F*V.distanceOrScreenCoverage<F*s){if(V.mesh){if(4===V.mesh.delayLoadState)return V.mesh._checkDelayState(),this;if(2===V.mesh.delayLoadState)return this;V.mesh._preActivate(),V.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(s,this,V.mesh),V.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(s,this,this),this}get wF(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(V,I,m,C){var l,s;if(!this._geometry)return null;let F=C||null===(l=this._userInstancedBuffersStorage)||void 0===l||null===(s=l.vertexBuffers[V])||void 0===s?void 0:s.getFloatData(this.instances.length+1,m||I&&1!==this._geometry.meshes.length);return F||(F=this._geometry.getVerticesData(V,I,m)),F}copyVerticesData(V,I){this._geometry&&this._geometry.copyVerticesData(V,I)}getVertexBuffer(V,I){var m;return this._geometry?(I||null===(m=this._userInstancedBuffersStorage)||void 0===m?void 0:m.vertexBuffers[V])??this._geometry.getVertexBuffer(V):null}isVerticesDataPresent(V,I){var m;return this._geometry?!I&&void 0!==(null===(m=this._userInstancedBuffersStorage)||void 0===m?void 0:m.vertexBuffers[V])||this._geometry.isVerticesDataPresent(V):!!this._delayInfo&&-1!==this._delayInfo.indexOf(V)}isVertexBufferUpdatable(V,I){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(V);if(!I){var m;const I=null===(m=this._userInstancedBuffersStorage)||void 0===m?void 0:m.vertexBuffers[V];if(I)return I.isUpdatable()}return this._geometry.isVertexBufferUpdatable(V)}getVerticesDataKinds(V){if(!this._geometry){const V=[];if(this._delayInfo)for(const I of this._delayInfo)V.push(I);return V}const I=this._geometry.getVerticesDataKinds();if(!V&&this._userInstancedBuffersStorage)for(const m in this._userInstancedBuffersStorage.vertexBuffers)-1===I.indexOf(m)&&I.push(m);return I}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}AF(V,I){return this._geometry?this._geometry.AF(V,I):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(V))return!1;if(!this.kk||0===this.kk.length)return!0;if(!V)return!0;const m=this.getEngine(),C=this.cV(),l=I||m.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.fF();const s=this.material||C.defaultMaterial;if(s)if(s._storeEffectOnSubMeshes)for(const X of this.kk){const V=X.dV();if(V)if(V._storeEffectOnSubMeshes){if(!V.isReadyForSubMesh(this,X,l))return!1}else if(!V.isReady(this,l))return!1}else if(!s.isReady(this,l))return!1;const F=m.currentRenderPassId;for(const X of this.lightSources){const V=X.getShadowGenerators();if(!V)continue;const I=V.values();for(let C=I.next();!0!==C.done;C=I.next()){var k,j,E,K;const V=C.value;if(V&&(null===(k=V.getShadowMap())||void 0===k||!k.renderList||null!==(j=V.getShadowMap())&&void 0!==j&&j.renderList&&-1!==(null===(E=V.getShadowMap())||void 0===E||null===(K=E.renderList)||void 0===K?void 0:K.indexOf(this)))){const I=V.getShadowMap().renderPassIds??[m.currentRenderPassId];for(let C=0;C<I.length;++C){m.currentRenderPassId=I[C];for(const I of this.kk){var Y;if(!V.isReady(I,l,(null===(Y=I.dV())||void 0===Y?void 0:Y.needAlphaBlendingForMesh(this))??!1))return m.currentRenderPassId=F,!1}}m.currentRenderPassId=F}}}for(const X of this._internalMeshDataInfo._LODLevels)if(X.mesh&&!X.mesh.isReady(l))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}VK(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(V){this._instanceDataStorage.overridenInstanceCount=V}_preActivate(){const V=this._internalMeshDataInfo,I=this.cV().getRenderId();return V._preActivateId===I||(V._preActivateId=I,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(V){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=V),this}_registerInstanceForRenderId(V,I){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:I,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[I]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=I,this._instanceDataStorage.visibleInstances[I]=new Array),this._instanceDataStorage.visibleInstances[I].push(V),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.GV||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let V,I=arguments.length>0&&void 0!==arguments[0]&&arguments[0],m=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;V="object"===typeof I?I:{applySkeleton:I,applyMorph:m};const C=this.wF?this.wF.boundingBias:null;return this.gV(this._getData(V,null,X.e.PositionKind),C),this}_createGlobalSubMesh(V){const I=this.getTotalVertices();if(!I||!this.AF())return null;if(this.kk&&this.kk.length>0){const m=this.AF();if(!m)return null;const C=m.length;let l=!1;if(V)l=!0;else for(const V of this.kk){if(V.indexStart+V.indexCount>C){l=!0;break}if(V.verticesStart+V.verticesCount>I){l=!0;break}}if(!l)return this.kk[0]}return this.releaseSubMeshes(),new t.e(0,0,I,0,this.getTotalIndices()||I,this)}subdivide(V){if(V<1)return;const I=this.getTotalIndices();let m=I/V|0,C=0;for(;m%3!==0;)m++;this.releaseSubMeshes();for(let l=0;l<V&&!(C>=I);l++)t.e.CreateFromIndices(0,C,l===V-1?I-C:m,this,void 0,!1),C+=m;this.refreshBoundingInfo(),this.synchronizeInstances()}hV(V,I){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.hV(V,I,m,C);else{const C=new O.c;C.set(I,V);const l=this.cV();new v.e(v.e.RandomId(),l,C,m,this)}return this}removeVerticesData(V){this._geometry&&this._geometry.removeVerticesData(V)}markVerticesDataAsUpdatable(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const m=this.getVertexBuffer(V);m&&m.isUpdatable()!==I&&this.hV(V,this.getVerticesData(V),I)}setVerticesBuffer(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=v.e.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(V,null,I),this}updateVerticesData(V,I,m,C){return this._geometry?(C?(this.makeGeometryUnique(),this.updateVerticesData(V,I,m,!1)):this._geometry.updateVerticesData(V,I,m),this):this}updateMeshPositions(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const m=this.getVerticesData(X.e.PositionKind);if(!m)return this;if(V(m),this.updateVerticesData(X.e.PositionKind,m,!1,!1),I){const V=this.AF(),I=this.getVerticesData(X.e.NormalKind);if(!I)return this;O.c.ComputeNormals(m,V,I),this.updateVerticesData(X.e.NormalKind,I,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const V=this._geometry,I=this._geometry.j(v.e.RandomId());return V.releaseForMesh(this,!0),I.QV(this),this}setIndexBuffer(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=this._geometry;l||(l=new v.e(v.e.RandomId(),this.cV(),void 0,void 0,this)),l.setIndexBuffer(V,I,m,C)}setIndices(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(V,I,m,C);else{const I=new O.c;I.indices=V;const C=this.cV();new v.e(v.e.RandomId(),C,I,m,this)}return this}updateIndices(V,I){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(V,I,m),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(V,I,m){let C=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const l=this.cV().getEngine();let s;if(this._unIndexed)if(this._getRenderingFillMode(m)===D.d.WireFrameFillMode)s=V._getLinesIndexBuffer(this.AF(),l);else s=null;else switch(this._getRenderingFillMode(m)){case D.d.PointFillMode:s=null;break;case D.d.WireFrameFillMode:s=V._getLinesIndexBuffer(this.AF(),l);break;default:case D.d.TriangleFillMode:s=this._geometry.getIndexBuffer()}return this._bindDirect(I,s,C)}_bindDirect(V,I){let m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(V),m&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(V,I,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(V,I),this):this}_draw(V,I,m){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const C=this.cV().getEngine();return this._unIndexed&&I!==D.d.WireFrameFillMode||I==D.d.PointFillMode?C.drawArraysType(I,V.verticesStart,V.verticesCount,this.forcedInstanceCount||m):I==D.d.WireFrameFillMode?C.drawElementsType(I,0,V._linesIndexCount,this.forcedInstanceCount||m):C.drawElementsType(I,V.indexStart,V.indexCount,this.forcedInstanceCount||m),this}registerBeforeRender(V){return this.onBeforeRenderObservable.add(V),this}unregisterBeforeRender(V){return this.onBeforeRenderObservable.removeCallback(V),this}registerAfterRender(V){return this.onAfterRenderObservable.add(V),this}unregisterAfterRender(V){return this.onAfterRenderObservable.removeCallback(V),this}_getInstancesRenderList(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(I)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[V]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[V]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const m=this.cV(),C=m._isInIntermediateRendering(),l=C?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,s=this._instanceDataStorage.batchCache;if(s.mustReturn=!1,s.renderSelf[V]=I||!l&&this.isEnabled()&&this.isVisible,s.visibleInstances[V]=null,this._instanceDataStorage.visibleInstances&&!I){const I=this._instanceDataStorage.visibleInstances,l=m.getRenderId(),F=C?I.intermediateDefaultRenderId:I.defaultRenderId;s.visibleInstances[V]=I[l],!s.visibleInstances[V]&&F&&(s.visibleInstances[V]=I[F])}return s.hardwareInstancedRendering[V]=!I&&this._instanceDataStorage.hardwareInstancedRendering&&null!==s.visibleInstances[V]&&void 0!==s.visibleInstances[V],this._instanceDataStorage.previousBatch=s,s}_updateInstancedBuffers(V,I,m,C,l,s){const F=I.visibleInstances[V._id],k=F?F.length:0,j=this._instanceDataStorage;let K=j.instancesBuffer,Y=j.instancesPreviousBuffer,O=0,v=0;const N=I.renderSelf[V._id],t=!K||m!==j.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!j.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||j.isFrozen&&!t)v=(N?1:0)+k;else{const I=this.getWorldMatrix();if(N&&(this._scene.needsPreviousWorldMatrices&&(j.masterMeshPreviousWorldMatrix?(j.masterMeshPreviousWorldMatrix.copyToArray(j.instancesPreviousData,O),j.masterMeshPreviousWorldMatrix.C(I)):(j.masterMeshPreviousWorldMatrix=I.clone(),j.masterMeshPreviousWorldMatrix.copyToArray(j.instancesPreviousData,O))),I.copyToArray(j.instancesData,O),O+=16,v++),F){var D;if(r.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(D=V.dV())&&void 0!==D&&D.needAlphaBlendingForMesh(V.getRenderingMesh())){const V=this._scene.activeCamera.globalPosition;for(let I=0;I<F.length;I++){const m=F[I];m._distanceToCamera=E.m.Distance(m.getBoundingInfo().boundingSphere.centerWorld,V)}F.sort(((V,I)=>V._distanceToCamera>I._distanceToCamera?-1:V._distanceToCamera<I._distanceToCamera?1:0))}for(let V=0;V<F.length;V++){const I=F[V],m=I.getWorldMatrix();m.copyToArray(j.instancesData,O),this._scene.needsPreviousWorldMatrices&&(I._previousWorldMatrix?(I._previousWorldMatrix.copyToArray(j.instancesPreviousData,O),I._previousWorldMatrix.C(m)):(I._previousWorldMatrix=m.clone(),I._previousWorldMatrix.copyToArray(j.instancesPreviousData,O))),O+=16,v++}}}t?(K&&K.dispose(),Y&&Y.dispose(),K=new X.c(C,j.instancesData,!0,16,!1,!0),j.instancesBuffer=K,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=K.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=K.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=K.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=K.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(Y=new X.c(C,j.instancesPreviousData,!0,16,!1,!0),j.instancesPreviousBuffer=Y,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=Y.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=Y.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=Y.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=Y.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(K.updateDirectly(j.instancesData,0,v),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||Y.updateDirectly(j.instancesPreviousData,0,v)),this._processInstancedBuffers(F,N),s&&void 0!==l&&(this.cV()._activeIndices.addCount(V.indexCount*v,!1),C._currentDrawContext&&(C._currentDrawContext.useInstancing=!0),this._bind(V,s,l),this._draw(V,l,v)),!this._scene.needsPreviousWorldMatrices||t||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||Y.updateDirectly(j.instancesData,0,v)}_renderWithInstances(V,I,m,C,l){const s=m.visibleInstances[V._id],F=s?s.length:0,k=this._instanceDataStorage,j=k.instancesBufferSize,E=16*(F+1)*4;for(;k.instancesBufferSize<E;)k.instancesBufferSize*=2;return k.instancesData&&j==k.instancesBufferSize||(k.instancesData=new Float32Array(k.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!k.instancesPreviousData||j!=k.instancesBufferSize)&&(k.instancesPreviousData=new Float32Array(k.instancesBufferSize/4)),this._updateInstancedBuffers(V,m,j,l,I,C),l.unbindInstanceAttributes(),this}_renderWithThinInstances(V,I,m,C){var l;const s=(null===(l=this._thinInstanceDataStorage)||void 0===l?void 0:l.instancesCount)??0;this.cV()._activeIndices.addCount(V.indexCount*s,!1),C._currentDrawContext&&(C._currentDrawContext.useInstancing=!0),this._bind(V,m,I),this._draw(V,I,s),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,s):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),C.unbindInstanceAttributes()}_processInstancedBuffers(V,I){}_processRendering(V,I,m,C,l,s,F,k){const j=this.cV(),E=j.getEngine();if(C=this._getRenderingFillMode(C),s&&I.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(I,C,m,E),this;if(s)this._renderWithInstances(I,C,l,m,E);else{E._currentDrawContext&&(E._currentDrawContext.useInstancing=!1);let m=0;l.renderSelf[I._id]&&(F&&F(!1,V.getWorldMatrix(),k),m++,this._draw(I,C,this._instanceDataStorage.overridenInstanceCount));const s=l.visibleInstances[I._id];if(s){const V=s.length;m+=V;for(let m=0;m<V;m++){const V=s[m].getWorldMatrix();F&&F(!0,V,k),this._draw(I,C)}}j._activeIndices.addCount(I.indexCount*m,!1)}return this}_rebuild(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(V&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const I in this._userInstancedBuffersStorage.vertexBuffers){const m=this._userInstancedBuffersStorage.vertexBuffers[I];m&&(V&&m.dispose(),this._userInstancedBuffersStorage.vertexBuffers[I]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(V)}_freeze(){if(this.kk){for(let V=0;V<this.kk.length;V++)this._getInstancesRenderList(V);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(V,I,m,C){let l=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const s=this._scene.getEngine(),F=s.currentRenderPassId;if(void 0!==V&&(s.currentRenderPassId=V),C)(!l||l&&C.isInFrustum(this._scene._frustumPlanes))&&this.render(C,!!I,m);else for(let k=0;k<this.kk.length;k++){const V=this.kk[k];(!l||l&&V.isInFrustum(this._scene._frustumPlanes))&&this.render(V,!!I,m)}return void 0!==V&&(s.currentRenderPassId=F),this}directRender(){if(!this.kk)return this;for(const V of this.kk)this.render(V,!1);return this}render(V,I,m){var C,l,s;const F=this.cV();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const k=(null===(C=F.activeCameras)||void 0===C?void 0:C.length)??0;if((k>1&&F.activeCamera===F.activeCameras[0]||k<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const j=this._getInstancesRenderList(V._id,!!m);if(j.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const E=F.getEngine();let K=0,Y=null;this.ignoreCameraMaxZ&&F.activeCamera&&!F._isInIntermediateRendering()&&(K=F.activeCamera.maxZ,Y=F.activeCamera,F.activeCamera.maxZ=0,F.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const X=V.getRenderingMesh(),O=j.hardwareInstancedRendering[V._id]||X.hasThinInstances||!!this._userInstancedBuffersStorage&&!V.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,v=this._instanceDataStorage,N=V.dV();if(!N)return Y&&(Y.maxZ=K,F.updateTransformMatrix(!0)),this;if(v.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===N){if(N._storeEffectOnSubMeshes&&(null===(l=V._drawWrapper)||void 0===l||!l._wasPreviouslyReady)||!N._storeEffectOnSubMeshes&&!N._getDrawWrapper()._wasPreviouslyReady)return Y&&(Y.maxZ=K,F.updateTransformMatrix(!0)),this}else{if(N._storeEffectOnSubMeshes){if(!N.isReadyForSubMesh(this,V,O))return Y&&(Y.maxZ=K,F.updateTransformMatrix(!0)),this}else if(!N.isReady(this,O))return Y&&(Y.maxZ=K,F.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=N}let t;I&&E.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),t=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?V._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const b=(null===(s=t)||void 0===s?void 0:s.effect)??null;for(const D of F._beforeRenderingMeshStage)D.action(this,V,j,b);if(!t||!b)return Y&&(Y.maxZ=K,F.updateTransformMatrix(!0)),this;const T=m||this;let n;if(v.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.JF&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)n=v.sideOrientation;else{const V=T._getWorldMatrixDeterminant();n=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),V<0&&(n=n===D.d.ClockWiseSideOrientation?D.d.CounterClockWiseSideOrientation:D.d.ClockWiseSideOrientation),v.sideOrientation=n}const x=this._internalMeshDataInfo._effectiveMaterial._preBind(t,n);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&E.setDepthWrite(!0);const S=this._internalMeshDataInfo._effectiveMaterial,c=S.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),O||this._bind(V,b,c,!1);const H=T.getWorldMatrix();S._storeEffectOnSubMeshes?S.bindForSubMesh(H,this,V):S.bind(H,this),!S.JF&&S.separateCullingPass&&(E.setState(!0,S.zOffset,!1,!x,S.cullBackFaces,S.stencil,S.zOffsetUnits),this._processRendering(this,V,b,c,j,O,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),E.setState(!0,S.zOffset,!1,x,S.cullBackFaces,S.stencil,S.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(V)),this._processRendering(this,V,b,c,j,O,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const D of F._afterRenderingMeshStage)D.action(this,V,j,b);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),Y&&(Y.maxZ=K,F.updateTransformMatrix(!0)),2!==F.performancePriority||v.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(X.e.MatricesWeightsKind)&&(this.isVerticesDataPresent(X.e.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const V=this.getVerticesData(X.e.MatricesWeightsKind),I=V.length;for(let m=0;m<I;m+=4){const I=V[m]+V[m+1]+V[m+2]+V[m+3];if(0===I)V[m]=1;else{const C=1/I;V[m]*=C,V[m+1]*=C,V[m+2]*=C,V[m+3]*=C}}this.hV(X.e.MatricesWeightsKind,V)}_normalizeSkinWeightsAndExtra(){const V=this.getVerticesData(X.e.MatricesWeightsExtraKind),I=this.getVerticesData(X.e.MatricesWeightsKind),m=I.length;for(let C=0;C<m;C+=4){let m=I[C]+I[C+1]+I[C+2]+I[C+3];if(m+=V[C]+V[C+1]+V[C+2]+V[C+3],0===m)I[C]=1;else{const l=1/m;I[C]*=l,I[C+1]*=l,I[C+2]*=l,I[C+3]*=l,V[C]*=l,V[C+1]*=l,V[C+2]*=l,V[C+3]*=l}}this.hV(X.e.MatricesWeightsKind,I),this.hV(X.e.MatricesWeightsKind,V)}validateSkinning(){const V=this.getVerticesData(X.e.MatricesWeightsExtraKind),I=this.getVerticesData(X.e.MatricesWeightsKind);if(null===I||null==this.skeleton)return{skinned:!1,valid:!0,xv:"not skinned"};const m=I.length;let C=0,l=0,s=0,F=0;const k=null===V?4:8,j=[];for(let X=0;X<=k;X++)j[X]=0;for(let X=0;X<m;X+=4){let m=I[X],E=m,K=0===E?0:1;for(let l=1;l<k;l++){const s=l<4?I[X+l]:V[X+l-4];s>m&&C++,0!==s&&K++,E+=s,m=s}if(j[K]++,K>s&&(s=K),0===E)l++;else{const m=1/E;let C=0;for(let l=0;l<k;l++)C+=l<4?Math.abs(I[X+l]-I[X+l]*m):Math.abs(V[X+l-4]-V[X+l-4]*m);C>.001&&F++}}const E=this.skeleton.bones.length,K=this.getVerticesData(X.e.MatricesIndicesKind),Y=this.getVerticesData(X.e.MatricesIndicesExtraKind);let O=0;for(let X=0;X<m;X+=4)for(let V=0;V<k;V++){const I=V<4?K[X+V]:Y[X+V-4];(I>=E||I<0)&&O++}return{skinned:!0,valid:0===l&&0===F&&0===O,xv:"Number of Weights = "+m/4+"\nMaximum influences = "+s+"\nMissing Weights = "+l+"\nNot Sorted = "+C+"\nNot Normalized = "+F+"\nWeightCounts = ["+j+"]\nNumber of bones = "+E+"\nBad Bone Indices = "+O}}_checkDelayState(){const V=this.cV();return this._geometry?this._geometry.load(V):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(V)),this}_queueLoad(V){V.addPendingData(this);const I=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return l.d.LoadFile(this.delayLoadingFile,(I=>{I instanceof ArrayBuffer?this._delayLoadingFunction(I,this):this._delayLoadingFunction(JSON.parse(I),this);for(const V of this.instances)V.refreshBoundingInfo(),V._syncSubMeshes();this.delayLoadState=1,V.removePendingData(this)}),(()=>{}),V.offlineProvider,I),this}isInFrustum(V){return 2!==this.delayLoadState&&(!!super.isInFrustum(V)&&(this._checkDelayState(),!0))}setMaterialById(V){const I=this.cV().materials;let m;for(m=I.length-1;m>-1;m--)if(I[m].id===V)return this.material=I[m],this;const C=this.cV().multiMaterials;for(m=C.length-1;m>-1;m--)if(C[m].id===V)return this.material=C[m],this;return this}getAnimatables(){const V=[];return this.material&&V.push(this.material),this.skeleton&&V.push(this.skeleton),V}bakeTransformIntoVertices(V){if(!this.isVerticesDataPresent(X.e.PositionKind))return this;const I=this.kk.splice(0);this._resetPointsArrayCache();let m=this.getVerticesData(X.e.PositionKind);const C=E.m.Zero();let l;for(l=0;l<m.length;l+=3)E.m.TransformCoordinatesFromFloatsToRef(m[l],m[l+1],m[l+2],V,C).toArray(m,l);if(this.hV(X.e.PositionKind,m,this.getVertexBuffer(X.e.PositionKind).isUpdatable()),this.isVerticesDataPresent(X.e.NormalKind)){for(m=this.getVerticesData(X.e.NormalKind),l=0;l<m.length;l+=3)E.m.TransformNormalFromFloatsToRef(m[l],m[l+1],m[l+2],V,C).normalize().toArray(m,l);this.hV(X.e.NormalKind,m,this.getVertexBuffer(X.e.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(X.e.TangentKind)){for(m=this.getVerticesData(X.e.TangentKind),l=0;l<m.length;l+=4)E.m.TransformNormalFromFloatsToRef(m[l],m[l+1],m[l+2],V,C).normalize().toArray(m,l);this.hV(X.e.TangentKind,m,this.getVertexBuffer(X.e.TangentKind).isUpdatable())}return V.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.kk=I,this}bakeCurrentTransformIntoVertices(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&this.makeGeometryUnique(),this.bakeTransformIntoVertices(this.fF(!0)),this.resetLocalMatrix(V),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2?arguments[2]:void 0,C=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(I&&void 0===I._addToSceneRootNodes){const m=I;return G.source=this,G.doNotCloneChildren=m.doNotCloneChildren,G.clonePhysicsImpostor=m.clonePhysicsImpostor,G.cloneThinInstances=m.cloneThinInstances,new r(V,this.cV(),G)}return new r(V,this.cV(),I,this,m,C)}dispose(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const m=this._internalMeshDataInfo;if(m._onBeforeDrawObservable&&m._onBeforeDrawObservable.clear(),m._onBeforeBindObservable&&m._onBeforeBindObservable.clear(),m._onBeforeRenderObservable&&m._onBeforeRenderObservable.clear(),m._onAfterRenderObservable&&m._onAfterRenderObservable.clear(),m._onBetweenPassObservable&&m._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(m.meshMap)for(const V in m.meshMap){const I=m.meshMap[V];I&&(I._internalMeshDataInfo._source=null,m.meshMap[V]=void 0)}m._source&&m._source._internalMeshDataInfo.meshMap&&(m._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const V=this.cV().meshes;for(const I of V){const V=I;V._internalMeshDataInfo&&V._internalMeshDataInfo._source&&V._internalMeshDataInfo._source===this&&(V._internalMeshDataInfo._source=null)}}m._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(V,I)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(V,I,m,C,s,F){let k=arguments.length>6&&void 0!==arguments[6]&&arguments[6],j=arguments.length>7?arguments[7]:void 0;const E=this.cV();return l.d.LoadImage(V,(V=>{const l=V.width,j=V.height,E=this.getEngine().createCanvas(l,j).getContext("2d");E.drawImage(V,0,0);const K=E.getImageData(0,0,l,j).data;this.applyDisplacementMapFromBuffer(K,l,j,I,m,s,F,k),C&&C(this)}),j||(()=>{}),E.offlineProvider),this}applyDisplacementMapFromBuffer(V,I,m,C,l,s,F){let k=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(X.e.PositionKind)||!this.isVerticesDataPresent(X.e.NormalKind)||!this.isVerticesDataPresent(X.e.UVKind))return x.d.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const j=this.getVerticesData(X.e.PositionKind,!0,!0),K=this.getVerticesData(X.e.NormalKind),Y=this.getVerticesData(X.e.UVKind);let v=E.m.Zero();const N=E.m.Zero(),t=E.k.Zero();s=s||E.k.Zero(),F=F||new E.k(1,1);for(let X=0;X<j.length;X+=3){E.m.FromArrayToRef(j,X,v),E.m.FromArrayToRef(K,X,N),E.k.FromArrayToRef(Y,X/3*2,t);const k=4*((Math.abs(t.x*F.x+s.x%1)*(I-1)%I|0)+(Math.abs(t.y*F.y+s.y%1)*(m-1)%m|0)*I),O=.3*(V[k]/255)+.59*(V[k+1]/255)+.11*(V[k+2]/255);N.normalize(),N.scaleInPlace(C+(l-C)*O),v=v.add(N),v.toArray(j,X)}return O.c.ComputeNormals(j,this.AF(),K),k?(this.hV(X.e.PositionKind,j),this.hV(X.e.NormalKind,K),this.hV(X.e.UVKind,Y)):(this.updateVerticesData(X.e.PositionKind,j),this.updateVerticesData(X.e.NormalKind,K)),this}_getFlattenedNormals(V,I){const m=new Float32Array(3*V.length);let C=0;const l=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let s=0;s<V.length;s+=3){const F=E.m.Ik(I,3*V[s]),k=E.m.Ik(I,3*V[s+1]),j=E.m.Ik(I,3*V[s+2]),K=F.Fm(k),Y=j.Fm(k),X=E.m.Normalize(E.m.Cross(K,Y));l&&X.scaleInPlace(-1);for(let V=0;V<3;V++)m[C++]=X.x,m[C++]=X.y,m[C++]=X.z}return m}_convertToUnIndexedMesh(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const I=this.getVerticesDataKinds().filter((V=>{var I;return!(null!==(I=this.getVertexBuffer(V))&&void 0!==I&&I.getIsInstanced())})),m=this.AF(),C={},l=(V,I)=>{const C=new Float32Array(m.length*I);let l=0;for(let s=0;s<m.length;s++)for(let F=0;F<I;F++)C[l++]=V[m[s]*I+F];return C},s=this.getBoundingInfo(),F=this.wF?this.kk.slice(0):[];for(const k of I)C[k]=this.getVerticesData(k);for(const k of I){const I=this.getVertexBuffer(k),s=I.getSize();if(V&&k===X.e.NormalKind){const V=this._getFlattenedNormals(m,C[X.e.PositionKind]);this.hV(X.e.NormalKind,V,I.isUpdatable(),s)}else this.hV(k,l(C[k],s),I.isUpdatable(),s)}if(this.morphTargetManager){for(let I=0;I<this.morphTargetManager.numTargets;I++){const C=this.morphTargetManager.getTarget(I),s=C.getPositions();C.setPositions(l(s,3));const F=C.getNormals();F&&C.setNormals(V?this._getFlattenedNormals(m,s):l(F,3));const k=C.getTangents();k&&C.setTangents(l(k,3));const j=C.getUVs();j&&C.setUVs(l(j,2));const E=C.getColors();E&&C.setColors(l(E,4))}this.morphTargetManager.synchronize()}for(let k=0;k<m.length;k++)m[k]=k;this.setIndices(m),this._unIndexed=!0,this.releaseSubMeshes();for(const k of F){const V=k.getBoundingInfo();t.e.AddToMesh(k.materialIndex,k.indexStart,k.indexCount,k.indexStart,k.indexCount,this).setBoundingInfo(V)}return this.setBoundingInfo(s),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const I=O.c.ExtractFromMesh(this);let m;if(V&&this.isVerticesDataPresent(X.e.NormalKind)&&I.zV){for(m=0;m<I.zV.length;m++)I.zV[m]*=-1;this.hV(X.e.NormalKind,I.zV,this.isVertexBufferUpdatable(X.e.NormalKind))}if(I.indices){let V;for(m=0;m<I.indices.length;m+=3)V=I.indices[m+1],I.indices[m+1]=I.indices[m+2],I.indices[m+2]=V;this.setIndices(I.indices,null,this.isVertexBufferUpdatable(X.e.PositionKind),!0)}return this}increaseVertices(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const I=O.c.ExtractFromMesh(this),m=I.indices&&!Array.isArray(I.indices)&&Array.from?Array.from(I.indices):I.indices,C=I.yV&&!Array.isArray(I.yV)&&Array.from?Array.from(I.yV):I.yV,l=I.BV&&!Array.isArray(I.BV)&&Array.from?Array.from(I.BV):I.BV,s=I.zV&&!Array.isArray(I.zV)&&Array.from?Array.from(I.zV):I.zV;if(m&&C){I.indices=m,I.yV=C,l&&(I.BV=l),s&&(I.zV=s);const F=V+1,k=[];for(let V=0;V<F+1;V++)k[V]=[];let j,K;const Y=new E.m(0,0,0),O=new E.m(0,0,0),v=new E.k(0,0),N=[],t=[],D=[];let b,T,n,x=C.length;l&&(T=l.length),s&&(n=s.length);for(let V=0;V<m.length;V+=3){t[0]=m[V],t[1]=m[V+1],t[2]=m[V+2];for(let V=0;V<3;V++)if(j=t[V],K=t[(V+1)%3],void 0===D[j]&&void 0===D[K]?(D[j]=[],D[K]=[]):(void 0===D[j]&&(D[j]=[]),void 0===D[K]&&(D[K]=[])),void 0===D[j][K]&&void 0===D[K][j]){D[j][K]=[],Y.x=(C[3*K]-C[3*j])/F,Y.y=(C[3*K+1]-C[3*j+1])/F,Y.z=(C[3*K+2]-C[3*j+2])/F,s&&(O.x=(s[3*K]-s[3*j])/F,O.y=(s[3*K+1]-s[3*j+1])/F,O.z=(s[3*K+2]-s[3*j+2])/F),l&&(v.x=(l[2*K]-l[2*j])/F,v.y=(l[2*K+1]-l[2*j+1])/F),D[j][K].push(j);for(let V=1;V<F;V++)D[j][K].push(C.length/3),C[x++]=C[3*j]+V*Y.x,C[x++]=C[3*j+1]+V*Y.y,C[x++]=C[3*j+2]+V*Y.z,s&&(s[n++]=s[3*j]+V*O.x,s[n++]=s[3*j+1]+V*O.y,s[n++]=s[3*j+2]+V*O.z),l&&(l[T++]=l[2*j]+V*v.x,l[T++]=l[2*j+1]+V*v.y);D[j][K].push(K),D[K][j]=[],b=D[j][K].length;for(let V=0;V<b;V++)D[K][j][V]=D[j][K][b-1-V]}k[0][0]=m[V],k[1][0]=D[m[V]][m[V+1]][1],k[1][1]=D[m[V]][m[V+2]][1];for(let I=2;I<F;I++){k[I][0]=D[m[V]][m[V+1]][I],k[I][I]=D[m[V]][m[V+2]][I],Y.x=(C[3*k[I][I]]-C[3*k[I][0]])/I,Y.y=(C[3*k[I][I]+1]-C[3*k[I][0]+1])/I,Y.z=(C[3*k[I][I]+2]-C[3*k[I][0]+2])/I,s&&(O.x=(s[3*k[I][I]]-s[3*k[I][0]])/I,O.y=(s[3*k[I][I]+1]-s[3*k[I][0]+1])/I,O.z=(s[3*k[I][I]+2]-s[3*k[I][0]+2])/I),l&&(v.x=(l[2*k[I][I]]-l[2*k[I][0]])/I,v.y=(l[2*k[I][I]+1]-l[2*k[I][0]+1])/I);for(let V=1;V<I;V++)k[I][V]=C.length/3,C[x++]=C[3*k[I][0]]+V*Y.x,C[x++]=C[3*k[I][0]+1]+V*Y.y,C[x++]=C[3*k[I][0]+2]+V*Y.z,s&&(s[n++]=s[3*k[I][0]]+V*O.x,s[n++]=s[3*k[I][0]+1]+V*O.y,s[n++]=s[3*k[I][0]+2]+V*O.z),l&&(l[T++]=l[2*k[I][0]]+V*v.x,l[T++]=l[2*k[I][0]+1]+V*v.y)}k[F]=D[m[V+1]][m[V+2]],N.push(k[0][0],k[1][0],k[1][1]);for(let V=1;V<F;V++){let I;for(I=0;I<V;I++)N.push(k[V][I],k[V+1][I],k[V+1][I+1]),N.push(k[V][I],k[V+1][I+1],k[V][I+1]);N.push(k[V][I],k[V+1][I],k[V+1][I+1])}}I.indices=N,I.QV(this,this.isVertexBufferUpdatable(X.e.PositionKind))}else x.d.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const V=O.c.ExtractFromMesh(this),I=V.BV,m=V.indices,C=V.yV,l=V.ZV,s=V.matricesIndices,F=V.matricesWeights,k=V.matricesIndicesExtra,j=V.matricesWeightsExtra;if(void 0===m||void 0===C||null===m||null===C)x.d.Warn("VertexData contains empty entries");else{const E=[],K=[],Y=[],v=[],N=[],t=[],D=[],b=[];let T=[],n=0;const x={};let S,c;for(let V=0;V<m.length;V+=3){c=[m[V],m[V+1],m[V+2]],T=[];for(let V=0;V<3;V++){T[V]="";for(let I=0;I<3;I++)Math.abs(C[3*c[V]+I])<1e-8&&(C[3*c[V]+I]=0),T[V]+=C[3*c[V]+I]+"|"}if(T[0]!=T[1]&&T[0]!=T[2]&&T[1]!=T[2])for(let V=0;V<3;V++){if(S=x[T[V]],void 0===S){x[T[V]]=n,S=n++;for(let I=0;I<3;I++)E.push(C[3*c[V]+I]);if(null!==l&&void 0!==l)for(let I=0;I<4;I++)v.push(l[4*c[V]+I]);if(null!==I&&void 0!==I)for(let m=0;m<2;m++)Y.push(I[2*c[V]+m]);if(null!==s&&void 0!==s)for(let I=0;I<4;I++)N.push(s[4*c[V]+I]);if(null!==F&&void 0!==F)for(let I=0;I<4;I++)t.push(F[4*c[V]+I]);if(null!==k&&void 0!==k)for(let I=0;I<4;I++)D.push(k[4*c[V]+I]);if(null!==j&&void 0!==j)for(let I=0;I<4;I++)b.push(j[4*c[V]+I])}K.push(S)}}const H=[];O.c.ComputeNormals(E,K,H),V.yV=E,V.indices=K,V.zV=H,null!==I&&void 0!==I&&(V.BV=Y),null!==l&&void 0!==l&&(V.ZV=v),null!==s&&void 0!==s&&(V.matricesIndices=N),null!==F&&void 0!==F&&(V.matricesWeights=t),null!==k&&void 0!==k&&(V.matricesIndicesExtra=D),null!==F&&void 0!==F&&(V.matricesWeightsExtra=b),V.QV(this,this.isVertexBufferUpdatable(X.e.PositionKind))}}static _instancedMeshFactory(V,I){throw(0,c.c)("InstancedMesh")}static _PhysicsImpostorParser(V,I,m){throw(0,c.c)("PhysicsImpostor")}createInstance(V){const I=r._instancedMeshFactory(V,this);return I.parent=this.parent,I}synchronizeInstances(){for(let V=0;V<this.instances.length;V++){this.instances[V]._syncSubMeshes()}return this}optimizeIndices(V){const I=this.AF(),m=this.getVerticesData(X.e.PositionKind);if(!m||!I)return this;const C=[];for(let l=0;l<m.length;l+=3)C.push(E.m.Ik(m,l));const s=[];return l.c.SyncAsyncForLoop(C.length,40,(V=>{const I=C.length-1-V,m=C[I];for(let l=0;l<I;++l){const V=C[l];if(m.equals(V)){s[I]=l;break}}}),(()=>{for(let V=0;V<I.length;++V)I[V]=s[I[V]]||I[V];const m=this.kk.slice(0);this.setIndices(I),this.kk=m,V&&V(this)})),this}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};V.name=this.name,V.id=this.id,V.uniqueId=this.uniqueId,V.type=this.getClassName(),F.b&&F.b.HasTags(this)&&(V.tags=F.b.GetTags(this)),V.position=this.position.UF(),this.rotationQuaternion?V.rotationQuaternion=this.rotationQuaternion.UF():this.rotation&&(V.rotation=this.rotation.UF()),V.Vk=this.Vk.UF(),this._postMultiplyPivotMatrix?V.pivotMatrix=this.getPivotMatrix().UF():V.localMatrix=this.getPivotMatrix().UF(),V.isEnabled=this.isEnabled(!1),V.isVisible=this.isVisible,V.infiniteDistance=this.infiniteDistance,V.pickable=this.Tj,V.receiveShadows=this.receiveShadows,V.billboardMode=this.billboardMode,V.visibility=this.visibility,V.bk=this.bk,V.checkCollisions=this.checkCollisions,V.ellipsoid=this.ellipsoid.UF(),V.ellipsoidOffset=this.ellipsoidOffset.UF(),V.GV=this.GV,V.isBlocker=this.isBlocker,V.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(V),V.isUnIndexed=this.isUnIndexed;const I=this._geometry;if(I&&this.kk){V.geometryUniqueId=I.uniqueId,V.geometryId=I.id,V.kk=[];for(let I=0;I<this.kk.length;I++){const m=this.kk[I];V.kk.push({materialIndex:m.materialIndex,verticesStart:m.verticesStart,verticesCount:m.verticesCount,indexStart:m.indexStart,indexCount:m.indexCount})}}if(this.material?this.material.doNotSerialize||(V.materialUniqueId=this.material.uniqueId,V.materialId=this.material.id):(this.material=null,V.materialUniqueId=this._scene.defaultMaterial.uniqueId,V.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(V.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(V.skeletonId=this.skeleton.id,V.numBoneInfluencers=this.numBoneInfluencers),this.cV()._getComponent(H.c.NAME_PHYSICSENGINE)){const I=this.getPhysicsImpostor();I&&(V.physicsMass=I.getParam("QC"),V.physicsFriction=I.getParam("friction"),V.physicsRestitution=I.getParam("QC"),V.physicsImpostor=I.type)}this.metadata&&(V.metadata=this.metadata),V.instances=[];for(let m=0;m<this.instances.length;m++){const I=this.instances[m];if(I.doNotSerialize)continue;const C={name:I.name,id:I.id,isEnabled:I.isEnabled(!1),isVisible:I.isVisible,Tj:I.Tj,checkCollisions:I.checkCollisions,position:I.position.UF(),Vk:I.Vk.UF()};if(I.parent&&I.parent._serializeAsParent(C),I.rotationQuaternion?C.rotationQuaternion=I.rotationQuaternion.UF():I.rotation&&(C.rotation=I.rotation.UF()),this.cV()._getComponent(H.c.NAME_PHYSICSENGINE)){const V=I.getPhysicsImpostor();V&&(C.physicsMass=V.getParam("QC"),C.physicsFriction=V.getParam("friction"),C.physicsRestitution=V.getParam("QC"),C.physicsImpostor=V.type)}I.metadata&&(C.metadata=I.metadata),I.actionManager&&(C.actions=I.actionManager.serialize(I.name)),V.instances.push(C),n.d.AppendSerializedAnimations(I,C),C.ranges=I.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(V.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const I={data:{},sizes:{},strides:{}};for(const V in this._userThinInstanceBuffersStorage.data)I.data[V]=Array.from(this._userThinInstanceBuffersStorage.data[V]),I.sizes[V]=this._userThinInstanceBuffersStorage.sizes[V],I.strides[V]=this._userThinInstanceBuffersStorage.strides[V];V.thinInstances.userThinInstance=I}return n.d.AppendSerializedAnimations(this,V),V.ranges=this.serializeAnimationRanges(),V.layerMask=this.layerMask,V.alphaIndex=this.alphaIndex,V.hasVertexAlpha=this.hasVertexAlpha,V.overlayAlpha=this.overlayAlpha,V.overlayColor=this.overlayColor.UF(),V.renderOverlay=this.renderOverlay,V.applyFog=this.applyFog,this.actionManager&&(V.actions=this.actionManager.serialize(this.name)),V}_syncGeometryWithMorphTargetManager(){if(!this.wF)return;this._markSubMeshesAsAttributesDirty();const V=this._internalAbstractMeshDataInfo._morphTargetManager;if(V&&V.vertexCount){if(V.vertexCount!==this.getTotalVertices())return x.d.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(V.isUsingTextureForTargets)return;for(let I=0;I<V.numInfluencers;I++){const m=V.getActiveTarget(I),C=m.getPositions();if(!C)return void x.d.Error("Invalid morph target. Target must have positions.");this.wF.hV(X.e.PositionKind+I,C,!1,3);const l=m.getNormals();l&&this.wF.hV(X.e.NormalKind+I,l,!1,3);const s=m.getTangents();s&&this.wF.hV(X.e.TangentKind+I,s,!1,3);const F=m.getUVs();F&&this.wF.hV(X.e.UVKind+"_"+I,F,!1,2);const k=m.getUV2s();k&&this.wF.hV(X.e.UV2Kind+"_"+I,k,!1,2);const j=m.getColors();j&&this.wF.hV(X.e.ColorKind+I,j,!1,4)}}else{let V=0;for(;this.wF.isVerticesDataPresent(X.e.PositionKind+V);)this.wF.removeVerticesData(X.e.PositionKind+V),this.wF.isVerticesDataPresent(X.e.NormalKind+V)&&this.wF.removeVerticesData(X.e.NormalKind+V),this.wF.isVerticesDataPresent(X.e.TangentKind+V)&&this.wF.removeVerticesData(X.e.TangentKind+V),this.wF.isVerticesDataPresent(X.e.UVKind+V)&&this.wF.removeVerticesData(X.e.UVKind+"_"+V),this.wF.isVerticesDataPresent(X.e.UV2Kind+V)&&this.wF.removeVerticesData(X.e.UV2Kind+"_"+V),this.wF.isVerticesDataPresent(X.e.ColorKind+V)&&this.wF.removeVerticesData(X.e.ColorKind+V),V++}}static Parse(V,I,m){let C;if(C=V.type&&"LinesMesh"===V.type?r._LinesMeshParser(V,I):V.type&&"GroundMesh"===V.type?r._GroundMeshParser(V,I):V.type&&"GoldbergMesh"===V.type?r._GoldbergMeshParser(V,I):V.type&&"GreasedLineMesh"===V.type?r._GreasedLineMeshParser(V,I):V.type&&"TrailMesh"===V.type?r._TrailMeshParser(V,I):new r(V.name,I),C.id=V.id,C._waitingParsedUniqueId=V.uniqueId,F.b&&F.b.AddTagsTo(C,V.tags),C.position=E.m.Ik(V.position),void 0!==V.metadata&&(C.metadata=V.metadata),V.rotationQuaternion?C.rotationQuaternion=E.e.Ik(V.rotationQuaternion):V.rotation&&(C.rotation=E.m.Ik(V.rotation)),C.Vk=E.m.Ik(V.Vk),V.localMatrix?C.setPreTransformMatrix(E.b.Ik(V.localMatrix)):V.pivotMatrix&&C.setPivotMatrix(E.b.Ik(V.pivotMatrix)),C.Sk(V.isEnabled),C.isVisible=V.isVisible,C.infiniteDistance=V.infiniteDistance,C.bk=!!V.bk,C.showBoundingBox=V.showBoundingBox,C.showSubMeshesBoundingBox=V.showSubMeshesBoundingBox,void 0!==V.applyFog&&(C.applyFog=V.applyFog),void 0!==V.pickable&&(C.Tj=V.pickable),void 0!==V.alphaIndex&&(C.alphaIndex=V.alphaIndex),C.receiveShadows=V.receiveShadows,void 0!==V.billboardMode&&(C.billboardMode=V.billboardMode),void 0!==V.visibility&&(C.visibility=V.visibility),C.checkCollisions=V.checkCollisions,C.GV=!!V.GV,V.ellipsoid&&(C.ellipsoid=E.m.Ik(V.ellipsoid)),V.ellipsoidOffset&&(C.ellipsoidOffset=E.m.Ik(V.ellipsoidOffset)),null!=V.overrideMaterialSideOrientation&&(C.sideOrientation=V.overrideMaterialSideOrientation),void 0!==V.sideOrientation&&(C.sideOrientation=V.sideOrientation),void 0!==V.isBlocker&&(C.isBlocker=V.isBlocker),C._shouldGenerateFlatShading=V.useFlatShading,V.Dk&&(C._waitingData.Dk=V.Dk),void 0!==V.parentId&&(C._waitingParentId=V.parentId),void 0!==V.parentInstanceIndex&&(C._waitingParentInstanceIndex=V.parentInstanceIndex),void 0!==V.actions&&(C._waitingData.actions=V.actions),void 0!==V.overlayAlpha&&(C.overlayAlpha=V.overlayAlpha),void 0!==V.overlayColor&&(C.overlayColor=K.c.Ik(V.overlayColor)),void 0!==V.renderOverlay&&(C.renderOverlay=V.renderOverlay),C.isUnIndexed=!!V.isUnIndexed,C.hasVertexAlpha=V.hasVertexAlpha,V.delayLoadingFile?(C.delayLoadState=4,C.delayLoadingFile=m+V.delayLoadingFile,C.buildBoundingInfo(E.m.Ik(V.boundingBoxMinimum),E.m.Ik(V.boundingBoxMaximum)),V._binaryInfo&&(C._binaryInfo=V._binaryInfo),C._delayInfo=[],V.hasUVs&&C._delayInfo.push(X.e.UVKind),V.hasUVs2&&C._delayInfo.push(X.e.UV2Kind),V.hasUVs3&&C._delayInfo.push(X.e.UV3Kind),V.hasUVs4&&C._delayInfo.push(X.e.UV4Kind),V.hasUVs5&&C._delayInfo.push(X.e.UV5Kind),V.hasUVs6&&C._delayInfo.push(X.e.UV6Kind),V.hasColors&&C._delayInfo.push(X.e.ColorKind),V.hasMatricesIndices&&C._delayInfo.push(X.e.MatricesIndicesKind),V.hasMatricesWeights&&C._delayInfo.push(X.e.MatricesWeightsKind),C._delayLoadingFunction=v.e._ImportGeometry,T.d.ForceFullSceneLoadingForIncremental&&C._checkDelayState()):v.e._ImportGeometry(V,C),V.materialUniqueId?C._waitingMaterialId=V.materialUniqueId:V.materialId&&(C._waitingMaterialId=V.materialId),V.morphTargetManagerId>-1&&(C._waitingMorphTargetManagerId=V.morphTargetManagerId),void 0!==V.skeletonId&&null!==V.skeletonId&&(C.skeleton=I.getLastSkeletonById(V.skeletonId),V.numBoneInfluencers&&(C.numBoneInfluencers=V.numBoneInfluencers)),V.animations){for(let I=0;I<V.animations.length;I++){const m=V.animations[I],l=(0,S.d)("BABYLON.Animation");l&&C.animations.push(l.Parse(m))}Y.c.ParseAnimationRanges(C,V,I)}if(V.autoAnimate&&I.beginAnimation(C,V.autoAnimateFrom,V.autoAnimateTo,V.autoAnimateLoop,V.autoAnimateSpeed||1),V.layerMask&&!isNaN(V.layerMask)?C.layerMask=Math.abs(parseInt(V.layerMask)):C.layerMask=268435455,V.physicsImpostor&&(C.physicsImpostor=r._PhysicsImpostorParser(I,C,V)),V.lodMeshIds&&(C._waitingData.lods={ids:V.lodMeshIds,distances:V.lodDistances?V.lodDistances:null,coverages:V.lodCoverages?V.lodCoverages:null}),V.instances)for(let l=0;l<V.instances.length;l++){const m=V.instances[l],s=C.createInstance(m.name);if(m.id&&(s.id=m.id),F.b&&(m.tags?F.b.AddTagsTo(s,m.tags):F.b.AddTagsTo(s,V.tags)),s.position=E.m.Ik(m.position),void 0!==m.metadata&&(s.metadata=m.metadata),void 0!==m.parentId&&(s._waitingParentId=m.parentId),void 0!==m.parentInstanceIndex&&(s._waitingParentInstanceIndex=m.parentInstanceIndex),void 0!==m.isEnabled&&null!==m.isEnabled&&s.Sk(m.isEnabled),void 0!==m.isVisible&&null!==m.isVisible&&(s.isVisible=m.isVisible),void 0!==m.Tj&&null!==m.Tj&&(s.Tj=m.Tj),m.rotationQuaternion?s.rotationQuaternion=E.e.Ik(m.rotationQuaternion):m.rotation&&(s.rotation=E.m.Ik(m.rotation)),s.Vk=E.m.Ik(m.Vk),void 0!=m.checkCollisions&&null!=m.checkCollisions&&(s.checkCollisions=m.checkCollisions),void 0!=m.pickable&&null!=m.pickable&&(s.Tj=m.pickable),void 0!=m.showBoundingBox&&null!=m.showBoundingBox&&(s.showBoundingBox=m.showBoundingBox),void 0!=m.showSubMeshesBoundingBox&&null!=m.showSubMeshesBoundingBox&&(s.showSubMeshesBoundingBox=m.showSubMeshesBoundingBox),void 0!=m.alphaIndex&&null!=m.showSubMeshesBoundingBox&&(s.alphaIndex=m.alphaIndex),m.physicsImpostor&&(s.physicsImpostor=r._PhysicsImpostorParser(I,s,m)),void 0!==m.actions&&(s._waitingData.actions=m.actions),m.animations){for(let V=0;V<m.animations.length;V++){const I=m.animations[V],C=(0,S.d)("BABYLON.Animation");C&&s.animations.push(C.Parse(I))}Y.c.ParseAnimationRanges(s,m,I),m.autoAnimate&&I.beginAnimation(s,m.autoAnimateFrom,m.autoAnimateTo,m.autoAnimateLoop,m.autoAnimateSpeed||1)}}if(V.thinInstances){const I=V.thinInstances;if(C.thinInstanceEnablePicking=!!I.enablePicking,I.matrixData?(C.fK("matrix",new Float32Array(I.matrixData),16,!1),C._thinInstanceDataStorage.matrixBufferSize=I.matrixBufferSize,C._thinInstanceDataStorage.instancesCount=I.instancesCount):C._thinInstanceDataStorage.matrixBufferSize=I.matrixBufferSize,V.thinInstances.userThinInstance){const I=V.thinInstances.userThinInstance;for(const V in I.data)C.fK(V,new Float32Array(I.data[V]),I.strides[V],!1),C._userThinInstanceBuffersStorage.sizes[V]=I.sizes[V]}}return C}setPositionsForCPUSkinning(){const V=this._internalMeshDataInfo;if(!V._sourcePositions){const I=this.getVerticesData(X.e.PositionKind);if(!I)return V._sourcePositions;V._sourcePositions=new Float32Array(I),this.isVertexBufferUpdatable(X.e.PositionKind)||this.hV(X.e.PositionKind,I,!0)}return V._sourcePositions}setNormalsForCPUSkinning(){const V=this._internalMeshDataInfo;if(!V._sourceNormals){const I=this.getVerticesData(X.e.NormalKind);if(!I)return V._sourceNormals;V._sourceNormals=new Float32Array(I),this.isVertexBufferUpdatable(X.e.NormalKind)||this.hV(X.e.NormalKind,I,!0)}return V._sourceNormals}applySkeleton(V){if(!this.wF)return this;if(this.wF._softwareSkinningFrameId==this.cV().getFrameId())return this;if(this.wF._softwareSkinningFrameId=this.cV().getFrameId(),!this.isVerticesDataPresent(X.e.PositionKind))return this;if(!this.isVerticesDataPresent(X.e.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(X.e.MatricesWeightsKind))return this;const I=this.isVerticesDataPresent(X.e.NormalKind),m=this._internalMeshDataInfo;if(!m._sourcePositions){const V=this.kk.slice();this.setPositionsForCPUSkinning(),this.kk=V}I&&!m._sourceNormals&&this.setNormalsForCPUSkinning();let C=this.getVerticesData(X.e.PositionKind);if(!C)return this;C instanceof Float32Array||(C=new Float32Array(C));let l=this.getVerticesData(X.e.NormalKind);if(I){if(!l)return this;l instanceof Float32Array||(l=new Float32Array(l))}const s=this.getVerticesData(X.e.MatricesIndicesKind),F=this.getVerticesData(X.e.MatricesWeightsKind);if(!F||!s)return this;const k=this.numBoneInfluencers>4,j=k?this.getVerticesData(X.e.MatricesIndicesExtraKind):null,K=k?this.getVerticesData(X.e.MatricesWeightsExtraKind):null,Y=V.getTransformMatrices(this),O=E.m.Zero(),v=new E.b,N=new E.b;let t,D=0;for(let X=0;X<C.length;X+=3,D+=4){let V;for(t=0;t<4;t++)V=F[D+t],V>0&&(E.b.FromFloat32ArrayToRefScaled(Y,Math.floor(16*s[D+t]),V,N),v.addToSelf(N));if(k)for(t=0;t<4;t++)V=K[D+t],V>0&&(E.b.FromFloat32ArrayToRefScaled(Y,Math.floor(16*j[D+t]),V,N),v.addToSelf(N));E.m.TransformCoordinatesFromFloatsToRef(m._sourcePositions[X],m._sourcePositions[X+1],m._sourcePositions[X+2],v,O),O.toArray(C,X),I&&(E.m.TransformNormalFromFloatsToRef(m._sourceNormals[X],m._sourceNormals[X+1],m._sourceNormals[X+2],v,O),O.toArray(l,X)),v.reset()}return this.updateVerticesData(X.e.PositionKind,C),I&&this.updateVerticesData(X.e.NormalKind,l),this}static MinMax(V){let I=null,m=null;for(const C of V){const V=C.getBoundingInfo().boundingBox;I&&m?(I.minimizeInPlace(V.minimumWorld),m.maximizeInPlace(V.maximumWorld)):(I=V.minimumWorld,m=V.maximumWorld)}return I&&m?{min:I,max:m}:{min:E.m.Zero(),max:E.m.Zero()}}static Center(V){const I=V instanceof Array?r.MinMax(V):V;return E.m.Center(I.min,I.max)}static MergeMeshes(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],m=arguments.length>2?arguments[2]:void 0,C=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0;return(0,k.i)(r._MergeMeshesCoroutine(V,I,m,C,l,s,!1))}static async MergeMeshesAsync(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],m=arguments.length>2?arguments[2]:void 0,C=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0;return await(0,k.e)(r._MergeMeshesCoroutine(V,I,m,C,l,s,!0),(0,k.c)())}static*_MergeMeshesCoroutine(V){let I,m=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],C=arguments.length>2?arguments[2]:void 0,l=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,F=arguments.length>5?arguments[5]:void 0,k=arguments.length>6?arguments[6]:void 0;if(0===(V=V.filter(Boolean)).length)return null;if(!C){let m=0;for(I=0;I<V.length;I++)if(m+=V[I].getTotalVertices(),m>=65536)return x.d.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}F&&(s=!1);const j=new Array,E=new Array,K=new Array,Y=V[0].sideOrientation;for(I=0;I<V.length;I++){const m=V[I];if(m.isAnInstance)return x.d.Warn("Cannot merge instance meshes."),null;if(Y!==m.sideOrientation)return x.d.Warn("Cannot merge meshes with different sideOrientation values."),null;if(s&&K.push(m.getTotalIndices()),F)if(m.material){const V=m.material;if(V instanceof b.d){for(let I=0;I<V.jk.length;I++)j.indexOf(V.jk[I])<0&&j.push(V.jk[I]);for(let I=0;I<m.kk.length;I++)E.push(j.indexOf(V.jk[m.kk[I].materialIndex])),K.push(m.kk[I].indexCount)}else{j.indexOf(V)<0&&j.push(V);for(let I=0;I<m.kk.length;I++)E.push(j.indexOf(V)),K.push(m.kk[I].indexCount)}}else for(let V=0;V<m.kk.length;V++)E.push(0),K.push(m.kk[V].indexCount)}const X=V[0],v=V=>{const I=V.fF(!0);return{vertexData:O.c.ExtractFromMesh(V,!1,!1),transform:I}},{vertexData:N,transform:D}=v(X);k&&(yield);const T=new Array(V.length-1);for(let O=1;O<V.length;O++)T[O-1]=v(V[O]),k&&(yield);const n=N._mergeCoroutine(D,T,C,k,!m);let S=n.next();for(;!S.done;)k&&(yield),S=n.next();const c=S.value;l||(l=new r(X.name+"_merged",X.cV()));const H=c._applyToCoroutine(l,void 0,k);let y=H.next();for(;!y.done;)k&&(yield),y=H.next();if(l.checkCollisions=X.checkCollisions,l.sideOrientation=X.sideOrientation,m)for(I=0;I<V.length;I++)V[I].dispose();if(s||F){l.releaseSubMeshes(),I=0;let V=0;for(;I<K.length;)t.e.CreateFromIndices(0,V,K[I],l,void 0,!1),V+=K[I],I++;for(const I of l.kk)I.refreshBoundingInfo();l.fF(!0)}if(F){const V=new b.d(X.name+"_merged",X.cV());V.jk=j;for(let I=0;I<l.kk.length;I++)l.kk[I].materialIndex=E[I];l.material=V}else l.material=X.material;return l}MY(V){V._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(V)}pY(V){const I=V._indexInSourceMeshInstanceArray;if(-1!=I){if(I!==this.instances.length-1){const V=this.instances[this.instances.length-1];this.instances[I]=V,V._indexInSourceMeshInstanceArray=I}V._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===D.d.CounterClockWiseSideOrientation}_getRenderingFillMode(V){const I=this.cV();return I.forcePointsCloud?D.d.PointFillMode:I.forceWireframe?D.d.WireFrameFillMode:this.overrideRenderingFillMode??V}setMaterialByID(V){return this.setMaterialById(V)}static CreateRibbon(V,I,m,C,l,s,F,k,j){throw new Error("Import MeshBuilder to populate this function")}static CreateDisc(V,I,m,C,l,s){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(V,I,m,C,l){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(V,I,m,C,l,s){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(V,I,m,C){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(V,I,m,C,l,s,F,k,j){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(V,I,m,C,l,s,F){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(V,I,m,C,l,s,F,k,j,E){throw new Error("Import MeshBuilder to populate this function")}static ej(V,I,m,C,l){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(V,I,m,C,l,s,F,k){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(V,I,m,C,l,s,F){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(V,I,m,C,l,s,F,k){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(V,I,m,C,l,s,F,k,j,E){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(V,I,m,C,l,s,F,k,j,E,K,Y){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(V,I,m,C,l,s,F){throw new Error("Import MeshBuilder to populate this function")}static Lj(V,I,m,C,l){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(V,I,m,C,l,s){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(V,I,m,C,l,s,F,k,j){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(V,I,m,C,l,s,F,k,j,E,K){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(V,I,m,C,l,s,F,k,j,E){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(V,I,m){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(V,I,m){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(V,I,m,C,l,s){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(V,I,m){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(V){throw new Error("Import MeshBuilder to populate this function")}}r.FRONTSIDE=O.c.FRONTSIDE,r.BACKSIDE=O.c.BACKSIDE,r.DOUBLESIDE=O.c.DOUBLESIDE,r.DEFAULTSIDE=O.c.DEFAULTSIDE,r.NO_CAP=0,r.CAP_START=1,r.CAP_END=2,r.CAP_ALL=3,r.NO_FLIP=0,r.FLIP_TILE=1,r.ROTATE_TILE=2,r.FLIP_ROW=3,r.ROTATE_ROW=4,r.FLIP_N_ROTATE_TILE=5,r.FLIP_N_ROTATE_ROW=6,r.CENTER=0,r.LEFT=1,r.RIGHT=2,r.TOP=3,r.BOTTOM=4,r.INSTANCEDMESH_SORT_TRANSPARENT=!1,r._GroundMeshParser=(V,I)=>{throw(0,c.c)("GroundMesh")},r._GoldbergMeshParser=(V,I)=>{throw(0,c.c)("GoldbergMesh")},r._LinesMeshParser=(V,I)=>{throw(0,c.c)("LinesMesh")},r._GreasedLineMeshParser=(V,I)=>{throw(0,c.c)("GreasedLineMesh")},r._GreasedLineRibbonMeshParser=(V,I)=>{throw(0,c.c)("GreasedLineRibbonMesh")},r._TrailMeshParser=(V,I)=>{throw(0,c.c)("TrailMesh")},(0,S.h)("BABYLON.Mesh",r)},11350:(V,I,m)=>{m.d(I,{c:()=>v});var C=m(11206),l=m(11040),s=m(11233),F=m(11095),k=m(11312),j=m(11085),E=m(11214),K=m(11358),Y=m(11111),X=m(11224);class O{}class v{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,K.d)(this._applyToCoroutine.bind(this)),this.uniqueId=v._UniqueIdGenerator,v._UniqueIdGenerator++}set(V,I){switch(V.length||j.d.Warn(`Setting vertex data kind '${I}' with an empty array`),I){case s.e.PositionKind:this.yV=V;break;case s.e.NormalKind:this.zV=V;break;case s.e.TangentKind:this.tangents=V;break;case s.e.UVKind:this.BV=V;break;case s.e.UV2Kind:this.uvs2=V;break;case s.e.UV3Kind:this.uvs3=V;break;case s.e.UV4Kind:this.uvs4=V;break;case s.e.UV5Kind:this.uvs5=V;break;case s.e.UV6Kind:this.uvs6=V;break;case s.e.ColorKind:this.ZV=V;break;case s.e.MatricesIndicesKind:this.matricesIndices=V;break;case s.e.MatricesWeightsKind:this.matricesWeights=V;break;case s.e.MatricesIndicesExtraKind:this.matricesIndicesExtra=V;break;case s.e.MatricesWeightsExtraKind:this.matricesWeightsExtra=V}}QV(V,I){return this._applyTo(V,I,!1),this}applyToGeometry(V,I){return this._applyTo(V,I,!1),this}updateMesh(V){return this._update(V),this}updateGeometry(V){return this._update(V),this}*_applyToCoroutine(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2?arguments[2]:void 0;if(this.yV&&(V.hV(s.e.PositionKind,this.yV,I),m&&(yield)),this.zV&&(V.hV(s.e.NormalKind,this.zV,I),m&&(yield)),this.tangents&&(V.hV(s.e.TangentKind,this.tangents,I),m&&(yield)),this.BV&&(V.hV(s.e.UVKind,this.BV,I),m&&(yield)),this.uvs2&&(V.hV(s.e.UV2Kind,this.uvs2,I),m&&(yield)),this.uvs3&&(V.hV(s.e.UV3Kind,this.uvs3,I),m&&(yield)),this.uvs4&&(V.hV(s.e.UV4Kind,this.uvs4,I),m&&(yield)),this.uvs5&&(V.hV(s.e.UV5Kind,this.uvs5,I),m&&(yield)),this.uvs6&&(V.hV(s.e.UV6Kind,this.uvs6,I),m&&(yield)),this.ZV){const C=this.yV&&this.ZV.length===this.yV.length?3:4;V.hV(s.e.ColorKind,this.ZV,I,C),this.hasVertexAlpha&&void 0!==V.hasVertexAlpha&&(V.hasVertexAlpha=!0),m&&(yield)}if(this.matricesIndices&&(V.hV(s.e.MatricesIndicesKind,this.matricesIndices,I),m&&(yield)),this.matricesWeights&&(V.hV(s.e.MatricesWeightsKind,this.matricesWeights,I),m&&(yield)),this.matricesIndicesExtra&&(V.hV(s.e.MatricesIndicesExtraKind,this.matricesIndicesExtra,I),m&&(yield)),this.matricesWeightsExtra&&(V.hV(s.e.MatricesWeightsExtraKind,this.matricesWeightsExtra,I),m&&(yield)),this.indices?(V.setIndices(this.indices,null,I),m&&(yield)):V.setIndices([],null),V.kk&&this.materialInfos&&this.materialInfos.length>1){const I=V;I.kk=[];for(const V of this.materialInfos)new X.e(V.materialIndex,V.verticesStart,V.verticesCount,V.indexStart,V.indexCount,I)}return this}_update(V,I,m){return this.yV&&V.updateVerticesData(s.e.PositionKind,this.yV,I,m),this.zV&&V.updateVerticesData(s.e.NormalKind,this.zV,I,m),this.tangents&&V.updateVerticesData(s.e.TangentKind,this.tangents,I,m),this.BV&&V.updateVerticesData(s.e.UVKind,this.BV,I,m),this.uvs2&&V.updateVerticesData(s.e.UV2Kind,this.uvs2,I,m),this.uvs3&&V.updateVerticesData(s.e.UV3Kind,this.uvs3,I,m),this.uvs4&&V.updateVerticesData(s.e.UV4Kind,this.uvs4,I,m),this.uvs5&&V.updateVerticesData(s.e.UV5Kind,this.uvs5,I,m),this.uvs6&&V.updateVerticesData(s.e.UV6Kind,this.uvs6,I,m),this.ZV&&V.updateVerticesData(s.e.ColorKind,this.ZV,I,m),this.matricesIndices&&V.updateVerticesData(s.e.MatricesIndicesKind,this.matricesIndices,I,m),this.matricesWeights&&V.updateVerticesData(s.e.MatricesWeightsKind,this.matricesWeights,I,m),this.matricesIndicesExtra&&V.updateVerticesData(s.e.MatricesIndicesExtraKind,this.matricesIndicesExtra,I,m),this.matricesWeightsExtra&&V.updateVerticesData(s.e.MatricesWeightsExtraKind,this.matricesWeightsExtra,I,m),this.indices&&V.setIndices(this.indices,null),this}static _TransformVector3Coordinates(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:V.length;const s=l.g.LF[0],F=l.g.LF[1];for(let k=m;k<m+C;k+=3)l.m.FromArrayToRef(V,k,s),l.m.TransformCoordinatesToRef(s,I,F),V[k]=F.x,V[k+1]=F.y,V[k+2]=F.z}static _TransformVector3Normals(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:V.length;const s=l.g.LF[0],F=l.g.LF[1];for(let k=m;k<m+C;k+=3)l.m.FromArrayToRef(V,k,s),l.m.TransformNormalToRef(s,I,F),V[k]=F.x,V[k+1]=F.y,V[k+2]=F.z}static _TransformVector4Normals(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:V.length;const s=l.g.Vector4[0],F=l.g.Vector4[1];for(let k=m;k<m+C;k+=4)l.n.FromArrayToRef(V,k,s),l.n.TransformNormalToRef(s,I,F),V[k]=F.x,V[k+1]=F.y,V[k+2]=F.z,V[k+3]=F.w}static _FlipFaces(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:V.length;for(let C=I;C<I+m;C+=3){const I=V[C+1];V[C+1]=V[C+2],V[C+2]=I}}transform(V){const I=V.determinant()<0;return this.yV&&v._TransformVector3Coordinates(this.yV,V),this.zV&&v._TransformVector3Normals(this.zV,V),this.tangents&&v._TransformVector4Normals(this.tangents,V),I&&this.indices&&v._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const V=[];for(const I of this.materialInfos){const m=new v;if(this.yV&&(m.yV=this.yV.slice(3*I.verticesStart,3*(I.verticesCount+I.verticesStart))),this.zV&&(m.zV=this.zV.slice(3*I.verticesStart,3*(I.verticesCount+I.verticesStart))),this.tangents&&(m.tangents=this.tangents.slice(4*I.verticesStart,4*(I.verticesCount+I.verticesStart))),this.ZV&&(m.ZV=this.ZV.slice(4*I.verticesStart,4*(I.verticesCount+I.verticesStart))),this.BV&&(m.BV=this.BV.slice(2*I.verticesStart,2*(I.verticesCount+I.verticesStart))),this.uvs2&&(m.uvs2=this.uvs2.slice(2*I.verticesStart,2*(I.verticesCount+I.verticesStart))),this.uvs3&&(m.uvs3=this.uvs3.slice(2*I.verticesStart,2*(I.verticesCount+I.verticesStart))),this.uvs4&&(m.uvs4=this.uvs4.slice(2*I.verticesStart,2*(I.verticesCount+I.verticesStart))),this.uvs5&&(m.uvs5=this.uvs5.slice(2*I.verticesStart,2*(I.verticesCount+I.verticesStart))),this.uvs6&&(m.uvs6=this.uvs6.slice(2*I.verticesStart,2*(I.verticesCount+I.verticesStart))),this.matricesIndices&&(m.matricesIndices=this.matricesIndices.slice(4*I.verticesStart,4*(I.verticesCount+I.verticesStart))),this.matricesIndicesExtra&&(m.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*I.verticesStart,4*(I.verticesCount+I.verticesStart))),this.matricesWeights&&(m.matricesWeights=this.matricesWeights.slice(4*I.verticesStart,4*(I.verticesCount+I.verticesStart))),this.matricesWeightsExtra&&(m.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*I.verticesStart,4*(I.verticesCount+I.verticesStart))),this.indices){m.indices=[];for(let V=I.indexStart;V<I.indexStart+I.indexCount;V++)m.indices.push(this.indices[V]-I.verticesStart)}const C=new O;C.indexStart=0,C.indexCount=m.indices?m.indices.length:0,C.materialIndex=I.materialIndex,C.verticesStart=0,C.verticesCount=(m.yV?m.yV.length:0)/3,m.materialInfos=[C],V.push(m)}return V}merge(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const s=Array.isArray(V)?V.map((V=>({vertexData:V}))):[{vertexData:V}];return(0,K.i)(this._mergeCoroutine(void 0,s,I,!1,m,C,l))}*_mergeCoroutine(V,I){var m,C;let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],F=arguments.length>3?arguments[3]:void 0,k=arguments.length>4?arguments[4]:void 0,j=arguments.length>5&&void 0!==arguments[5]&&arguments[5],E=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let K=I.map((V=>V.vertexData)),Y=this;if(E)for(const s of K)s&&(s._validate(),!this.zV&&s.zV&&(this.zV=new Float32Array(this.yV.length)),!this.tangents&&s.tangents&&(this.tangents=new Float32Array(this.yV.length/3*4)),!this.BV&&s.BV&&(this.BV=new Float32Array(this.yV.length/3*2)),!this.uvs2&&s.uvs2&&(this.uvs2=new Float32Array(this.yV.length/3*2)),!this.uvs3&&s.uvs3&&(this.uvs3=new Float32Array(this.yV.length/3*2)),!this.uvs4&&s.uvs4&&(this.uvs4=new Float32Array(this.yV.length/3*2)),!this.uvs5&&s.uvs5&&(this.uvs5=new Float32Array(this.yV.length/3*2)),!this.uvs6&&s.uvs6&&(this.uvs6=new Float32Array(this.yV.length/3*2)),!this.ZV&&s.ZV&&(this.ZV=new Float32Array(this.yV.length/3*4),this.ZV.fill(1)),!this.matricesIndices&&s.matricesIndices&&(this.matricesIndices=new Float32Array(this.yV.length/3*4)),!this.matricesWeights&&s.matricesWeights&&(this.matricesWeights=new Float32Array(this.yV.length/3*4)),!this.matricesIndicesExtra&&s.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.yV.length/3*4)),!this.matricesWeightsExtra&&s.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.yV.length/3*4)));for(const s of K)if(s)if(E)this.zV&&!s.zV&&(s.zV=new Float32Array(s.yV.length)),this.tangents&&!s.tangents&&(s.tangents=new Float32Array(s.yV.length/3*4)),this.BV&&!s.BV&&(s.BV=new Float32Array(s.yV.length/3*2)),this.uvs2&&!s.uvs2&&(s.uvs2=new Float32Array(s.yV.length/3*2)),this.uvs3&&!s.uvs3&&(s.uvs3=new Float32Array(s.yV.length/3*2)),this.uvs4&&!s.uvs4&&(s.uvs4=new Float32Array(s.yV.length/3*2)),this.uvs5&&!s.uvs5&&(s.uvs5=new Float32Array(s.yV.length/3*2)),this.uvs6&&!s.uvs6&&(s.uvs6=new Float32Array(s.yV.length/3*2)),this.ZV&&!s.ZV&&(s.ZV=new Float32Array(s.yV.length/3*4),s.ZV.fill(1)),this.matricesIndices&&!s.matricesIndices&&(s.matricesIndices=new Float32Array(s.yV.length/3*4)),this.matricesWeights&&!s.matricesWeights&&(s.matricesWeights=new Float32Array(s.yV.length/3*4)),this.matricesIndicesExtra&&!s.matricesIndicesExtra&&(s.matricesIndicesExtra=new Float32Array(s.yV.length/3*4)),this.matricesWeightsExtra&&!s.matricesWeightsExtra&&(s.matricesWeightsExtra=new Float32Array(s.yV.length/3*4));else if(s._validate(),!this.zV!==!s.zV||!this.tangents!==!s.tangents||!this.BV!==!s.BV||!this.uvs2!==!s.uvs2||!this.uvs3!==!s.uvs3||!this.uvs4!==!s.uvs4||!this.uvs5!==!s.uvs5||!this.uvs6!==!s.uvs6||!this.ZV!==!s.ZV||!this.matricesIndices!==!s.matricesIndices||!this.matricesWeights!==!s.matricesWeights||!this.matricesIndicesExtra!==!s.matricesIndicesExtra||!this.matricesWeightsExtra!==!s.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(j){let m=0,C=0,l=0;const s=[];let F=null;const k=[];for(const I of this.splitBasedOnMaterialID())k.push({vertexData:I,transform:V});for(const V of I)if(V.vertexData)for(const I of V.vertexData.splitBasedOnMaterialID())k.push({vertexData:I,transform:V.transform});k.sort(((V,I)=>{const m=V.vertexData.materialInfos?V.vertexData.materialInfos[0].materialIndex:0,C=I.vertexData.materialInfos?I.vertexData.materialInfos[0].materialIndex:0;return m>C?1:m===C?0:-1}));for(const V of k){const I=V.vertexData;if(m=I.materialInfos?I.materialInfos[0].materialIndex:0,F&&F.materialIndex===m)F.indexCount+=I.indices.length,F.verticesCount+=I.yV.length/3;else{const V=new O;V.materialIndex=m,V.indexStart=C,V.indexCount=I.indices.length,V.verticesStart=l,V.verticesCount=I.yV.length/3,s.push(V),F=V}C+=I.indices.length,l+=I.yV.length/3}const j=k.splice(0,1)[0];Y=j.vertexData,V=j.transform,K=k.map((V=>V.vertexData)),I=k,this.materialInfos=s}const X=K.reduce(((V,I)=>{var m;return V+((null===(m=I.indices)||void 0===m?void 0:m.length)??0)}),(null===(m=Y.indices)||void 0===m?void 0:m.length)??0);let N=k||K.some((V=>V.indices===Y.indices))?null===(C=Y.indices)||void 0===C?void 0:C.slice():Y.indices;if(X>0){var t;let m=(null===(t=N)||void 0===t?void 0:t.length)??0;if(N||(N=new Array(X)),N.length!==X){if(Array.isArray(N))N.length=X;else{const V=l||N instanceof Uint32Array?new Uint32Array(X):new Uint16Array(X);V.set(N),N=V}V&&V.determinant()<0&&v._FlipFaces(N,0,m)}let C=Y.yV?Y.yV.length/3:0;for(const{vertexData:V,transform:l}of I)if(V.indices){for(let I=0;I<V.indices.length;I++)N[m+I]=V.indices[I]+C;l&&l.determinant()<0&&v._FlipFaces(N,m,V.indices.length),C+=V.yV.length/3,m+=V.indices.length,F&&(yield)}}return this.indices=N,this.yV=v._MergeElement(s.e.PositionKind,Y.yV,V,I.map((V=>[V.vertexData.yV,V.transform]))),F&&(yield),Y.zV&&(this.zV=v._MergeElement(s.e.NormalKind,Y.zV,V,I.map((V=>[V.vertexData.zV,V.transform]))),F&&(yield)),Y.tangents&&(this.tangents=v._MergeElement(s.e.TangentKind,Y.tangents,V,I.map((V=>[V.vertexData.tangents,V.transform]))),F&&(yield)),Y.BV&&(this.BV=v._MergeElement(s.e.UVKind,Y.BV,V,I.map((V=>[V.vertexData.BV,V.transform]))),F&&(yield)),Y.uvs2&&(this.uvs2=v._MergeElement(s.e.UV2Kind,Y.uvs2,V,I.map((V=>[V.vertexData.uvs2,V.transform]))),F&&(yield)),Y.uvs3&&(this.uvs3=v._MergeElement(s.e.UV3Kind,Y.uvs3,V,I.map((V=>[V.vertexData.uvs3,V.transform]))),F&&(yield)),Y.uvs4&&(this.uvs4=v._MergeElement(s.e.UV4Kind,Y.uvs4,V,I.map((V=>[V.vertexData.uvs4,V.transform]))),F&&(yield)),Y.uvs5&&(this.uvs5=v._MergeElement(s.e.UV5Kind,Y.uvs5,V,I.map((V=>[V.vertexData.uvs5,V.transform]))),F&&(yield)),Y.uvs6&&(this.uvs6=v._MergeElement(s.e.UV6Kind,Y.uvs6,V,I.map((V=>[V.vertexData.uvs6,V.transform]))),F&&(yield)),Y.ZV&&(this.ZV=v._MergeElement(s.e.ColorKind,Y.ZV,V,I.map((V=>[V.vertexData.ZV,V.transform]))),(void 0!==Y.hasVertexAlpha||I.some((V=>void 0!==V.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=Y.hasVertexAlpha||I.some((V=>V.vertexData.hasVertexAlpha))),F&&(yield)),Y.matricesIndices&&(this.matricesIndices=v._MergeElement(s.e.MatricesIndicesKind,Y.matricesIndices,V,I.map((V=>[V.vertexData.matricesIndices,V.transform]))),F&&(yield)),Y.matricesWeights&&(this.matricesWeights=v._MergeElement(s.e.MatricesWeightsKind,Y.matricesWeights,V,I.map((V=>[V.vertexData.matricesWeights,V.transform]))),F&&(yield)),Y.matricesIndicesExtra&&(this.matricesIndicesExtra=v._MergeElement(s.e.MatricesIndicesExtraKind,Y.matricesIndicesExtra,V,I.map((V=>[V.vertexData.matricesIndicesExtra,V.transform]))),F&&(yield)),Y.matricesWeightsExtra&&(this.matricesWeightsExtra=v._MergeElement(s.e.MatricesWeightsExtraKind,Y.matricesWeightsExtra,V,I.map((V=>[V.vertexData.matricesWeightsExtra,V.transform])))),this}static _MergeElement(V,I,m,C){const l=C.filter((V=>null!==V[0]&&void 0!==V[0]));if(!I&&0==l.length)return I;if(!I)return this._MergeElement(V,l[0][0],l[0][1],l.slice(1));const F=l.reduce(((V,I)=>V+I[0].length),I.length),k=V===s.e.PositionKind?v._TransformVector3Coordinates:V===s.e.NormalKind?v._TransformVector3Normals:V===s.e.TangentKind?v._TransformVector4Normals:()=>{};if(I instanceof Float32Array){const V=new Float32Array(F);V.set(I),m&&k(V,m,0,I.length);let C=I.length;for(const[I,m]of l)V.set(I,C),m&&k(V,m,C,I.length),C+=I.length;return V}{const V=new Array(F);for(let m=0;m<I.length;m++)V[m]=I[m];m&&k(V,m,0,I.length);let C=I.length;for(const[I,m]of l){for(let m=0;m<I.length;m++)V[C+m]=I[m];m&&k(V,m,C,I.length),C+=I.length}return V}}_validate(){if(!this.yV)throw new Y.g("Positions are required",Y.e.MeshInvalidPositionsError);const V=(V,I)=>{const m=s.e.DeduceStride(V);if(I.length%m!==0)throw new Error("The "+V+"s array count must be a multiple of "+m);return I.length/m},I=V(s.e.PositionKind,this.yV),m=(m,C)=>{const l=V(m,C);if(l!==I)throw new Error("The "+m+"s element count ("+l+") does not match the positions count ("+I+")")};this.zV&&m(s.e.NormalKind,this.zV),this.tangents&&m(s.e.TangentKind,this.tangents),this.BV&&m(s.e.UVKind,this.BV),this.uvs2&&m(s.e.UV2Kind,this.uvs2),this.uvs3&&m(s.e.UV3Kind,this.uvs3),this.uvs4&&m(s.e.UV4Kind,this.uvs4),this.uvs5&&m(s.e.UV5Kind,this.uvs5),this.uvs6&&m(s.e.UV6Kind,this.uvs6),this.ZV&&m(s.e.ColorKind,this.ZV),this.matricesIndices&&m(s.e.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&m(s.e.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&m(s.e.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&m(s.e.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const V=this.serialize();return v.Parse(V)}serialize(){const V={};if(this.yV&&(V.yV=Array.from(this.yV)),this.zV&&(V.zV=Array.from(this.zV)),this.tangents&&(V.tangents=Array.from(this.tangents)),this.BV&&(V.BV=Array.from(this.BV)),this.uvs2&&(V.uvs2=Array.from(this.uvs2)),this.uvs3&&(V.uvs3=Array.from(this.uvs3)),this.uvs4&&(V.uvs4=Array.from(this.uvs4)),this.uvs5&&(V.uvs5=Array.from(this.uvs5)),this.uvs6&&(V.uvs6=Array.from(this.uvs6)),this.ZV&&(V.ZV=Array.from(this.ZV),V.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(V.matricesIndices=Array.from(this.matricesIndices),V.matricesIndicesExpanded=!0),this.matricesWeights&&(V.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(V.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),V.matricesIndicesExtraExpanded=!0),this.matricesWeightsExtra&&(V.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),V.indices=this.indices?Array.from(this.indices):[],this.materialInfos){V.materialInfos=[];for(const I of this.materialInfos){const m={indexStart:I.indexStart,indexCount:I.indexCount,materialIndex:I.materialIndex,verticesStart:I.verticesStart,verticesCount:I.verticesCount};V.materialInfos.push(m)}}return V}static ExtractFromMesh(V,I,m){return v._ExtractFrom(V,I,m)}static ExtractFromGeometry(V,I,m){return v._ExtractFrom(V,I,m)}static _ExtractFrom(V,I,m){const C=new v;if(V.isVerticesDataPresent(s.e.PositionKind)&&(C.yV=V.getVerticesData(s.e.PositionKind,I,m)),V.isVerticesDataPresent(s.e.NormalKind)&&(C.zV=V.getVerticesData(s.e.NormalKind,I,m)),V.isVerticesDataPresent(s.e.TangentKind)&&(C.tangents=V.getVerticesData(s.e.TangentKind,I,m)),V.isVerticesDataPresent(s.e.UVKind)&&(C.BV=V.getVerticesData(s.e.UVKind,I,m)),V.isVerticesDataPresent(s.e.UV2Kind)&&(C.uvs2=V.getVerticesData(s.e.UV2Kind,I,m)),V.isVerticesDataPresent(s.e.UV3Kind)&&(C.uvs3=V.getVerticesData(s.e.UV3Kind,I,m)),V.isVerticesDataPresent(s.e.UV4Kind)&&(C.uvs4=V.getVerticesData(s.e.UV4Kind,I,m)),V.isVerticesDataPresent(s.e.UV5Kind)&&(C.uvs5=V.getVerticesData(s.e.UV5Kind,I,m)),V.isVerticesDataPresent(s.e.UV6Kind)&&(C.uvs6=V.getVerticesData(s.e.UV6Kind,I,m)),V.isVerticesDataPresent(s.e.ColorKind)){const l=V.wF||V,F=l.getVertexBuffer(s.e.ColorKind),k=l.getVerticesData(s.e.ColorKind,I,m);if(3===F.getSize()){const V=new Float32Array(4*k.length/3);for(let I=0,m=0;I<k.length;I+=3,m+=4)V[m]=k[I],V[m+1]=k[I+1],V[m+2]=k[I+2],V[m+3]=1;C.ZV=V}else{if(4!==F.getSize())throw new Error(`Unexpected number of color components: ${F.getSize()}`);C.ZV=k}}return V.isVerticesDataPresent(s.e.MatricesIndicesKind)&&(C.matricesIndices=V.getVerticesData(s.e.MatricesIndicesKind,I,m)),V.isVerticesDataPresent(s.e.MatricesWeightsKind)&&(C.matricesWeights=V.getVerticesData(s.e.MatricesWeightsKind,I,m)),V.isVerticesDataPresent(s.e.MatricesIndicesExtraKind)&&(C.matricesIndicesExtra=V.getVerticesData(s.e.MatricesIndicesExtraKind,I,m)),V.isVerticesDataPresent(s.e.MatricesWeightsExtraKind)&&(C.matricesWeightsExtra=V.getVerticesData(s.e.MatricesWeightsExtraKind,I,m)),C.indices=V.AF(I,m),C}static CreateRibbon(V){throw(0,F.c)("ribbonBuilder")}static CreateBox(V){throw(0,F.c)("boxBuilder")}static CreateTiledBox(V){throw(0,F.c)("tiledBoxBuilder")}static CreateTiledPlane(V){throw(0,F.c)("tiledPlaneBuilder")}static CreateSphere(V){throw(0,F.c)("sphereBuilder")}static CreateCylinder(V){throw(0,F.c)("cylinderBuilder")}static CreateTorus(V){throw(0,F.c)("torusBuilder")}static CreateLineSystem(V){throw(0,F.c)("linesBuilder")}static CreateDashedLines(V){throw(0,F.c)("linesBuilder")}static CreateGround(V){throw(0,F.c)("groundBuilder")}static CreateTiledGround(V){throw(0,F.c)("groundBuilder")}static CreateGroundFromHeightMap(V){throw(0,F.c)("groundBuilder")}static Lj(V){throw(0,F.c)("planeBuilder")}static CreateDisc(V){throw(0,F.c)("discBuilder")}static CreatePolygon(V,I,m,C,l,s,k){throw(0,F.c)("polygonBuilder")}static CreateIcoSphere(V){throw(0,F.c)("icoSphereBuilder")}static CreatePolyhedron(V){throw(0,F.c)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||l.m.Up();throw(0,F.c)("capsuleBuilder")}static CreateTorusKnot(V){throw(0,F.c)("torusKnotBuilder")}static ComputeNormals(V,I,m,C){let s=0,F=0,k=0,j=0,E=0,K=0,Y=0,X=0,O=0,v=0,N=0,t=0,D=0,b=0,T=0,n=0,x=0,S=0,c=0,H=0,y=!1,z=!1,Z=!1,B=!1,W=1,Q=0,G=null;C&&(y=!!C.facetNormals,z=!!C.facetPositions,Z=!!C.facetPartitioning,W=!0===C.useRightHandedSystem?-1:1,Q=C.ratio||0,B=!!C.depthSort,G=C.distanceTo,B&&void 0===G&&(G=l.m.Zero()));let r=0,g=0,h=0,d=0;for(Z&&C&&C.bbSize&&(r=C.subDiv.X*Q/C.bbSize.x,g=C.subDiv.Y*Q/C.bbSize.y,h=C.subDiv.Z*Q/C.bbSize.z,d=C.subDiv.max*C.subDiv.max,C.facetPartitioning.length=0),s=0;s<V.length;s++)m[s]=0;const R=I.length/3|0;for(s=0;s<R;s++){if(t=3*I[3*s],D=t+1,b=t+2,T=3*I[3*s+1],n=T+1,x=T+2,S=3*I[3*s+2],c=S+1,H=S+2,F=V[t]-V[T],k=V[D]-V[n],j=V[b]-V[x],E=V[S]-V[T],K=V[c]-V[n],Y=V[H]-V[x],X=W*(k*Y-j*K),O=W*(j*E-F*Y),v=W*(F*K-k*E),N=Math.sqrt(X*X+O*O+v*v),N=0===N?1:N,X/=N,O/=N,v/=N,y&&C&&(C.facetNormals[s].x=X,C.facetNormals[s].y=O,C.facetNormals[s].z=v),z&&C&&(C.facetPositions[s].x=(V[t]+V[T]+V[S])/3,C.facetPositions[s].y=(V[D]+V[n]+V[c])/3,C.facetPositions[s].z=(V[b]+V[x]+V[H])/3),Z&&C){const I=Math.floor((C.facetPositions[s].x-C.bInfo.minimum.x*Q)*r),m=Math.floor((C.facetPositions[s].y-C.bInfo.minimum.y*Q)*g),l=Math.floor((C.facetPositions[s].z-C.bInfo.minimum.z*Q)*h),F=Math.floor((V[t]-C.bInfo.minimum.x*Q)*r),k=Math.floor((V[D]-C.bInfo.minimum.y*Q)*g),j=Math.floor((V[b]-C.bInfo.minimum.z*Q)*h),E=Math.floor((V[T]-C.bInfo.minimum.x*Q)*r),K=Math.floor((V[n]-C.bInfo.minimum.y*Q)*g),Y=Math.floor((V[x]-C.bInfo.minimum.z*Q)*h),X=Math.floor((V[S]-C.bInfo.minimum.x*Q)*r),O=Math.floor((V[c]-C.bInfo.minimum.y*Q)*g),v=Math.floor((V[H]-C.bInfo.minimum.z*Q)*h),N=F+C.subDiv.max*k+d*j,y=E+C.subDiv.max*K+d*Y,z=X+C.subDiv.max*O+d*v,Z=I+C.subDiv.max*m+d*l;C.facetPartitioning[Z]=C.facetPartitioning[Z]?C.facetPartitioning[Z]:[],C.facetPartitioning[N]=C.facetPartitioning[N]?C.facetPartitioning[N]:[],C.facetPartitioning[y]=C.facetPartitioning[y]?C.facetPartitioning[y]:[],C.facetPartitioning[z]=C.facetPartitioning[z]?C.facetPartitioning[z]:[],C.facetPartitioning[N].push(s),y!=N&&C.facetPartitioning[y].push(s),z!=y&&z!=N&&C.facetPartitioning[z].push(s),Z!=N&&Z!=y&&Z!=z&&C.facetPartitioning[Z].push(s)}if(B&&C&&C.facetPositions){const V=C.depthSortedFacets[s];V.ind=3*s,V.sqDistance=l.m.DistanceSquared(C.facetPositions[s],G)}m[t]+=X,m[D]+=O,m[b]+=v,m[T]+=X,m[n]+=O,m[x]+=v,m[S]+=X,m[c]+=O,m[H]+=v}for(s=0;s<m.length/3;s++)X=m[3*s],O=m[3*s+1],v=m[3*s+2],N=Math.sqrt(X*X+O*O+v*v),N=0===N?1:N,X/=N,O/=N,v/=N,m[3*s]=X,m[3*s+1]=O,m[3*s+2]=v}static _ComputeSides(V,I,m,C,s,F,k){const j=m.length,E=C.length;let K,Y;switch(V=V||v.DEFAULTSIDE){case v.FRONTSIDE:break;case v.BACKSIDE:for(K=0;K<j;K+=3){const V=m[K];m[K]=m[K+2],m[K+2]=V}for(Y=0;Y<E;Y++)C[Y]=-C[Y];break;case v.DOUBLESIDE:{const V=I.length,X=V/3;for(let m=0;m<V;m++)I[V+m]=I[m];for(K=0;K<j;K+=3)m[K+j]=m[K+2]+X,m[K+1+j]=m[K+1]+X,m[K+2+j]=m[K]+X;for(Y=0;Y<E;Y++)C[E+Y]=-C[Y];const O=s.length;let v=0;for(v=0;v<O;v++)s[v+O]=s[v];for(F=F||new l.n(0,0,1,1),k=k||new l.n(0,0,1,1),v=0,K=0;K<O/2;K++)s[v]=F.x+(F.z-F.x)*s[v],s[v+1]=F.y+(F.w-F.y)*s[v+1],s[v+O]=k.x+(k.z-k.x)*s[v+O],s[v+O+1]=k.y+(k.w-k.y)*s[v+O+1],v+=2;break}}}static Parse(V){const I=new v,m=V.yV;m&&I.set(m,s.e.PositionKind);const C=V.zV;C&&I.set(C,s.e.NormalKind);const l=V.tangents;l&&I.set(l,s.e.TangentKind);const F=V.BV;F&&I.set(F,s.e.UVKind);const j=V.uvs2;j&&I.set(j,s.e.UV2Kind);const E=V.uvs3;E&&I.set(E,s.e.UV3Kind);const K=V.uvs4;K&&I.set(K,s.e.UV4Kind);const Y=V.uvs5;Y&&I.set(Y,s.e.UV5Kind);const X=V.uvs6;X&&I.set(X,s.e.UV6Kind);const N=V.ZV;N&&(I.set(k.d.CheckColors4(N,m.length/3),s.e.ColorKind),void 0!==V.hasVertexAlpha&&(I.hasVertexAlpha=V.hasVertexAlpha));const t=V.matricesIndices;t&&I.set(t,s.e.MatricesIndicesKind);const D=V.matricesWeights;D&&I.set(D,s.e.MatricesWeightsKind);const b=V.indices;b&&(I.indices=b);const T=V.materialInfos;if(T){I.materialInfos=[];for(const V of T){const m=new O;m.indexCount=V.indexCount,m.indexStart=V.indexStart,m.verticesCount=V.verticesCount,m.verticesStart=V.verticesStart,m.materialIndex=V.materialIndex,I.materialInfos.push(m)}}return I}static ImportVertexData(V,I){const m=v.Parse(V);I.setAllVerticesData(m,V.updatable)}}v.FRONTSIDE=0,v.BACKSIDE=1,v.DOUBLESIDE=2,v.DEFAULTSIDE=0,v._UniqueIdGenerator=0,(0,C.d)([E.c.filter((function(){for(var V=arguments.length,I=new Array(V),m=0;m<V;m++)I[m]=arguments[m];let[C]=I;return!Array.isArray(C)}))],v,"_TransformVector3Coordinates",null),(0,C.d)([E.c.filter((function(){for(var V=arguments.length,I=new Array(V),m=0;m<V;m++)I[m]=arguments[m];let[C]=I;return!Array.isArray(C)}))],v,"_TransformVector3Normals",null),(0,C.d)([E.c.filter((function(){for(var V=arguments.length,I=new Array(V),m=0;m<V;m++)I[m]=arguments[m];let[C]=I;return!Array.isArray(C)}))],v,"_TransformVector4Normals",null),(0,C.d)([E.c.filter((function(){for(var V=arguments.length,I=new Array(V),m=0;m<V;m++)I[m]=arguments[m];let[C]=I;return!Array.isArray(C)}))],v,"_FlipFaces",null)},11224:(V,I,m)=>{m.d(I,{e:()=>j});var C=m(11233),l=m(11246),s=m(11251),F=m(11271),k=m(11274);class j{get materialDefines(){var V;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(V=this._getDrawWrapper())||void 0===V?void 0:V.defines}set materialDefines(V){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=V}_getDrawWrapper(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];V=V??this._engine.currentRenderPassId;let m=this._drawWrappers[V];return!m&&I&&(this._drawWrappers[V]=m=new k.b(this._mesh.cV().getEngine())),m}_removeDrawWrapper(V){let I=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var m;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(m=this._drawWrappers[V])||void 0===m||m.dispose(I));this._drawWrappers[V]=void 0}get effect(){var V;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(V=this._getDrawWrapper())||void 0===V?void 0:V.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(V){this._mainDrawWrapperOverride=V}setEffect(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2?arguments[2]:void 0,C=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const l=this._drawWrapper;l.setEffect(V,I,C),void 0!==m&&(l.materialContext=m),V||(l.defines=null,l.materialContext=void 0)}resetDrawCache(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==V)return void this._removeDrawWrapper(V,!0,I);for(const V of this._drawWrappers)null===V||void 0===V||V.dispose(I)}this._drawWrappers=[]}static AddToMesh(V,I,m,C,l,s,F){return new j(V,I,m,C,l,s,F,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(V,I,m,C,l,s,F){let k=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],j=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=V,this.verticesStart=I,this.verticesCount=m,this.indexStart=C,this.indexCount=l,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=s,this._renderingMesh=F||s,j&&s.kk.push(this),this._engine=this._mesh.cV().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=s.kk.length-1,k&&(this.refreshBoundingInfo(),s.fF(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(V){return this._boundingInfo=V,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const V=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return V||this._renderingMesh}dV(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const I=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!I)return V&&this._mesh.cV()._hasDefaultMaterial?this._mesh.cV().defaultMaterial:null;if(this._isMultiMaterial(I)){const V=I.getSubMaterial(this.materialIndex);return this._currentMaterial!==V&&(this._currentMaterial=V,this.resetDrawCache()),V}return I}_isMultiMaterial(V){return void 0!==V.getSubMaterial}refreshBoundingInfo(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.wF)return this;if(V||(V=this._renderingMesh.getVerticesData(C.e.PositionKind)),!V)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const I=this._renderingMesh.AF();let m;if(0===this.indexStart&&this.indexCount===I.length){const V=this._renderingMesh.getBoundingInfo();m={minimum:V.minimum.clone(),maximum:V.maximum.clone()}}else m=(0,F.b)(V,I,this.indexStart,this.indexCount,this._renderingMesh.wF.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(m.minimum,m.maximum):this._boundingInfo=new s.d(m.minimum,m.maximum),this}_checkCollision(V){return this.getBoundingInfo()._checkCollision(V)}updateBoundingInfo(V){let I=this.getBoundingInfo();return I||(this.refreshBoundingInfo(),I=this.getBoundingInfo()),I&&I.update(V),this}isInFrustum(V){const I=this.getBoundingInfo();return!!I&&I.isInFrustum(V,this._mesh.pK)}isCompletelyInFrustum(V){const I=this.getBoundingInfo();return!!I&&I.isCompletelyInFrustum(V)}render(V){return this._renderingMesh.render(this,V,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(V,I){if(!this._linesIndexBuffer){const m=6*Math.floor(this.indexCount/3),C=this.verticesStart+this.verticesCount>65535?new Uint32Array(m):new Uint16Array(m);let l=0;if(0===V.length)for(let V=this.indexStart;V<this.indexStart+this.indexCount;V+=3)C[l++]=V,C[l++]=V+1,C[l++]=V+1,C[l++]=V+2,C[l++]=V+2,C[l++]=V;else for(let I=this.indexStart;I<this.indexStart+this.indexCount;I+=3)C[l++]=V[I],C[l++]=V[I+1],C[l++]=V[I+1],C[l++]=V[I+2],C[l++]=V[I+2],C[l++]=V[I];this._linesIndexBuffer=I.createIndexBuffer(C),this._linesIndexCount=C.length}return this._linesIndexBuffer}canIntersects(V){const I=this.getBoundingInfo();return!!I&&V.intersectsBox(I.boundingBox)}intersects(V,I,m,C,l){const s=this.dV();if(!s)return null;let F=3,k=!1;switch(s.fillMode){case 3:case 5:case 6:case 8:return null;case 7:F=1,k=!0}return 4===s.fillMode?m.length?this._intersectLines(V,I,m,this._mesh.intersectionThreshold,C):this._intersectUnIndexedLines(V,I,m,this._mesh.intersectionThreshold,C):!m.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(V,I,m,C,l):this._intersectTriangles(V,I,m,F,k,C,l)}_intersectLines(V,I,m,C,s){let F=null;for(let k=this.indexStart;k<this.indexStart+this.indexCount;k+=2){const j=I[m[k]],E=I[m[k+1]],K=V.intersectionSegment(j,E,C);if(!(K<0)&&((s||!F||K<F.distance)&&(F=new l.d(null,null,K),F.faceId=k/2,s)))break}return F}_intersectUnIndexedLines(V,I,m,C,s){let F=null;for(let k=this.verticesStart;k<this.verticesStart+this.verticesCount;k+=2){const m=I[k],j=I[k+1],E=V.intersectionSegment(m,j,C);if(!(E<0)&&((s||!F||E<F.distance)&&(F=new l.d(null,null,E),F.faceId=k/2,s)))break}return F}_intersectTriangles(V,I,m,C,l,s,F){let k=null,j=-1;for(let E=this.indexStart;E<this.indexStart+this.indexCount-(3-C);E+=C){j++;const C=m[E],K=m[E+1],Y=m[E+2];if(l&&4294967295===Y){E+=2;continue}const X=I[C],O=I[K],v=I[Y];if(!X||!O||!v)continue;if(F&&!F(X,O,v,V,C,K,Y))continue;const N=V.intersectsTriangle(X,O,v);if(N){if(N.distance<0)continue;if((s||!k||N.distance<k.distance)&&(k=N,k.faceId=j,s))break}}return k}_intersectUnIndexedTriangles(V,I,m,C,l){let s=null;for(let F=this.verticesStart;F<this.verticesStart+this.verticesCount;F+=3){const m=I[F],k=I[F+1],j=I[F+2];if(l&&!l(m,k,j,V,-1,-1,-1))continue;const E=V.intersectsTriangle(m,k,j);if(E){if(E.distance<0)continue;if((C||!s||E.distance<s.distance)&&(s=E,s.faceId=F/3,C))break}}return s}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(V,I){const m=new j(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,V,I,!1);if(!this.IsGlobal){const V=this.getBoundingInfo();if(!V)return m;m._boundingInfo=new s.d(V.minimum,V.maximum)}return m}dispose(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.cV().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const I=this._mesh.kk.indexOf(this);this._mesh.kk.splice(I,1),this.resetDrawCache(void 0,V)}getClassName(){return"SubMesh"}static CreateFromIndices(V,I,m,C,l){let s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],F=Number.MAX_VALUE,k=-Number.MAX_VALUE;const E=(l||C).AF();for(let j=I;j<I+m;j++){const V=E[j];V<F&&(F=V),V>k&&(k=V)}return new j(V,F,k-F+1,I,m,C,l,s)}}},11744:(V,I,m)=>{var C=m(11384),l=m(11233),s=m(11040),F=m(11085),k=m(11251);C.c.prototype.thinInstanceAdd=function(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.cV().getEngine().getCaps().instancedArrays)return F.d.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(V)?V.length:1);const m=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(V))for(let C=0;C<V.length;++C)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,V[C],C===V.length-1&&I);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,V,I);return m},C.c.prototype.thinInstanceAddSelf=function(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(s.b.IdentityReadOnly,V)},C.c.prototype.thinInstanceRegisterAttribute=function(V,I){V===l.e.ColorKind&&(V=l.e.ColorInstanceKind),this.removeVerticesData(V),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[V]=I,this._userThinInstanceBuffersStorage.sizes[V]=I*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[V]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[V]),this._userThinInstanceBuffersStorage.vertexBuffers[V]=new l.e(this.getEngine(),this._userThinInstanceBuffersStorage.data[V],V,!0,!1,I,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[V])},C.c.prototype.thinInstanceSetMatrixAt=function(V,I){let m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||V>=this._thinInstanceDataStorage.instancesCount)return!1;const C=this._thinInstanceDataStorage.matrixData;return I.copyToArray(C,16*V),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[V]=I),m&&(this.wK("matrix"),this.GV||this.thinInstanceRefreshBoundingInfo(!1)),!0},C.c.prototype.thinInstanceSetAttributeAt=function(V,I,m){let C=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return V===l.e.ColorKind&&(V=l.e.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[V]||I>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(V,0),this._userThinInstanceBuffersStorage.data[V].set(m,I*this._userThinInstanceBuffersStorage.strides[V]),C&&this.wK(V),!0)},Object.defineProperty(C.c.prototype,"Ek",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(V){var I;const m=this._thinInstanceDataStorage.matrixData??(null===(I=this.source)||void 0===I?void 0:I._thinInstanceDataStorage.matrixData);V<=(m?m.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=V)},enumerable:!0,configurable:!0}),C.c.prototype._thinInstanceCreateMatrixBuffer=function(V,I){let m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const C=new l.c(this.getEngine(),I,!m,16,!1,!0);for(let l=0;l<4;l++)this.setVerticesBuffer(C.createVertexBuffer(V+l,4*l,4));return C},C.c.prototype.fK=function(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,C=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var s;if(m=m||16,"matrix"===V)null===(s=this._thinInstanceDataStorage.matrixBuffer)||void 0===s||s.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=I?I.length:32*m,this._thinInstanceDataStorage.matrixData=I,this._thinInstanceDataStorage.worldMatrices=null,null!==I?(this._thinInstanceDataStorage.instancesCount=I.length/m,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",I,C),this.GV||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.GV||this.refreshBoundingInfo());else if("previousMatrix"===V){var F;null===(F=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===F||F.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=I,null!==I&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",I,C))}else{var k;if(V===l.e.ColorKind&&(V=l.e.ColorInstanceKind),null===I)null!==(k=this._userThinInstanceBuffersStorage)&&void 0!==k&&k.data[V]&&(this.removeVerticesData(V),delete this._userThinInstanceBuffersStorage.data[V],delete this._userThinInstanceBuffersStorage.strides[V],delete this._userThinInstanceBuffersStorage.sizes[V],delete this._userThinInstanceBuffersStorage.vertexBuffers[V]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[V]=I,this._userThinInstanceBuffersStorage.strides[V]=m,this._userThinInstanceBuffersStorage.sizes[V]=I.length,this._userThinInstanceBuffersStorage.vertexBuffers[V]=new l.e(this.getEngine(),I,V,!C,!1,m,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[V])}},C.c.prototype.wK=function(V){var I;if("matrix"===V)this.UY&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(V),null===(I=this._thinInstanceDataStorage.matrixBuffer)||void 0===I||I.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===V){var m;this.UY&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(V),null===(m=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===m||m.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var C;V===l.e.ColorKind&&(V=l.e.ColorInstanceKind),null!==(C=this._userThinInstanceBuffersStorage)&&void 0!==C&&C.vertexBuffers[V]&&(this.UY&&!this._userThinInstanceBuffersStorage.vertexBuffers[V].isUpdatable()&&this._thinInstanceRecreateBuffer(V),this._userThinInstanceBuffersStorage.vertexBuffers[V].updateDirectly(this._userThinInstanceBuffersStorage.data[V],0))}},C.c.prototype.thinInstancePartialBufferUpdate=function(V,I,m){var C;"matrix"===V?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(I,m):(V===l.e.ColorKind&&(V=l.e.ColorInstanceKind),null!==(C=this._userThinInstanceBuffersStorage)&&void 0!==C&&C.vertexBuffers[V]&&this._userThinInstanceBuffersStorage.vertexBuffers[V].updateDirectly(I,m))},C.c.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const V=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let I=0;I<this._thinInstanceDataStorage.instancesCount;++I)this._thinInstanceDataStorage.worldMatrices[I]=s.b.Ik(V,16*I)}return this._thinInstanceDataStorage.worldMatrices},C.c.prototype.thinInstanceRefreshBoundingInfo=function(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const C=this._thinInstanceDataStorage.boundingVectors;if(V||!this.rawBoundingInfo){C.length=0,this.refreshBoundingInfo(I,m);const V=this.getBoundingInfo();this.rawBoundingInfo=new k.d(V.minimum,V.maximum)}const l=this.getBoundingInfo(),F=this._thinInstanceDataStorage.matrixData;if(0===C.length)for(let s=0;s<l.boundingBox.vectors.length;++s)C.push(l.boundingBox.vectors[s].clone());s.g.LF[0].mk(Number.POSITIVE_INFINITY),s.g.LF[1].mk(Number.NEGATIVE_INFINITY);for(let k=0;k<this._thinInstanceDataStorage.instancesCount;++k){s.b.FromArrayToRef(F,16*k,s.g.Matrix[0]);for(let V=0;V<C.length;++V)s.m.TransformCoordinatesToRef(C[V],s.g.Matrix[0],s.g.LF[2]),s.g.LF[0].minimizeInPlace(s.g.LF[2]),s.g.LF[1].maximizeInPlace(s.g.LF[2])}l.reConstruct(s.g.LF[0],s.g.LF[1]),this.rV()},C.c.prototype._thinInstanceRecreateBuffer=function(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var m;if("matrix"===V)null===(m=this._thinInstanceDataStorage.matrixBuffer)||void 0===m||m.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,I);else if("previousMatrix"===V){var C;if(this._scene.needsPreviousWorldMatrices)null===(C=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===C||C.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,I)}else{var s;V===l.e.ColorKind&&(V=l.e.ColorInstanceKind),null===(s=this._userThinInstanceBuffersStorage.vertexBuffers[V])||void 0===s||s.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[V]=new l.e(this.getEngine(),this._userThinInstanceBuffersStorage.data[V],V,!I,!1,this._userThinInstanceBuffersStorage.strides[V],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[V])}},C.c.prototype._thinInstanceUpdateBufferSize=function(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;V===l.e.ColorKind&&(V=l.e.ColorInstanceKind);const m="matrix"===V;if(!m&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[V]))return;const C=m?16:this._userThinInstanceBuffersStorage.strides[V],s=m?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[V];let F=m?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[V];const k=(this._thinInstanceDataStorage.instancesCount+I)*C;let j=s;for(;j<k;)j*=2;if(!F||s!=j){if(F){const V=new Float32Array(j);V.set(F,0),F=V}else F=new Float32Array(j);var E,K,Y;if(m){if(null===(E=this._thinInstanceDataStorage.matrixBuffer)||void 0===E||E.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",F,!1),this._thinInstanceDataStorage.matrixData=F,this._thinInstanceDataStorage.matrixBufferSize=j,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(K=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===K||K.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",F,!1)}else null===(Y=this._userThinInstanceBuffersStorage.vertexBuffers[V])||void 0===Y||Y.dispose(),this._userThinInstanceBuffersStorage.data[V]=F,this._userThinInstanceBuffersStorage.sizes[V]=j,this._userThinInstanceBuffersStorage.vertexBuffers[V]=new l.e(this.getEngine(),F,V,!0,!1,C,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[V])}},C.c.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},C.c.prototype._disposeThinInstanceSpecificData=function(){var V;null!==(V=this._thinInstanceDataStorage)&&void 0!==V&&V.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},11332:(V,I,m)=>{m.d(I,{c:()=>K});var C=m(11206),l=m(11214),s=m(11297),F=m(11067),k=m(11040),j=m(11337),E=m(11048);class K extends j.c{get billboardMode(){return this._billboardMode}set billboardMode(V){this._billboardMode!==V&&(this._billboardMode=V,this._cache.useBillboardPosition=0!==(this._billboardMode&K.BILLBOARDMODE_USE_POSITION))}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(V){this._infiniteDistance!==V&&(this._infiniteDistance=V)}constructor(V){let I=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(V,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new k.m(0,0,1),this._up=new k.m(0,1,0),this._right=new k.m(1,0,0),this._position=k.m.Zero(),this._rotation=k.m.Zero(),this._rotationQuaternion=null,this._scaling=k.m.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=K.BILLBOARDMODE_NONE,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.LY=k.b.Zero(),this._usePivotMatrix=!1,this._absolutePosition=k.m.Zero(),this._absoluteScaling=k.m.Zero(),this._absoluteRotationQuaternion=k.e.Identity(),this._pivotMatrix=k.b.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new F.e,this._nonUniformScaling=!1,I&&this.cV().addTransformNode(this)}getClassName(){return"Sv"}get position(){return this._position}set position(V){this._position=V,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(V){this._rotation=V,this._rotationQuaternion=null,this._markAsDirtyInternal()}get Vk(){return this._scaling}set Vk(V){this._scaling=V,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(V){this._rotationQuaternion=V,V&&this._rotation.mk(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return k.m.TransformNormalFromFloatsToRef(0,0,this.cV().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return k.m.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return k.m.TransformNormalFromFloatsToRef(this.cV().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(V){return this._poseMatrix?(this._poseMatrix.C(V),this):(this._poseMatrix=V.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=k.b.Identity()),this._poseMatrix}_isSynchronized(){const V=this._cache;return this._billboardMode===V.billboardMode&&this._billboardMode===K.BILLBOARDMODE_NONE&&(!V.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const V=this._cache;V.localMatrixUpdated=!1,V.billboardMode=-1,V.infiniteDistance=!1,V.useBillboardPosition=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(V){return this.setPivotMatrix(V,!1)}setPivotMatrix(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.C(V),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=I,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=k.b.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,I=arguments.length>1?arguments[1]:void 0,m=arguments.length>2?arguments[2]:void 0;const C=this.clone("Clone of "+(this.name||this.id),V||this.parent,!0);C&&m&&m(this,C);for(const l of this.getChildTransformNodes(!0))l.instantiateHierarchy(C,I,m);return C}Dk(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return V?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.mk(0),this._rotationQuaternion=this._rotationQuaternion||k.e.Identity(),V.decompose(this._scaling,this._rotationQuaternion,this._position),this.fF(!0)):(this._worldMatrix=V,this._absolutePosition.aF(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.fF(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.fF(!0),this}get zY(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.fF(),this._absolutePosition}setAbsolutePosition(V){if(!V)return this;let I,m,C;if(void 0===V.x){if(arguments.length<3)return this;I=arguments[0],m=arguments[1],C=arguments[2]}else I=V.x,m=V.y,C=V.z;if(this.parent){const V=k.g.Matrix[0];this.parent.getWorldMatrix().invertToRef(V),k.m.TransformCoordinatesFromFloatsToRef(I,m,C,V,this.position)}else this.position.x=I,this.position.y=m,this.position.z=C;return this._absolutePosition.C(V),this}setPositionWithLocalVector(V){return this.fF(),this.position=k.m.TransformNormal(V,this.LY),this}getPositionExpressedInLocalSpace(){this.fF();const V=k.g.Matrix[0];return this.LY.invertToRef(V),k.m.TransformNormal(this.position,V)}locallyTranslate(V){return this.fF(!0),this.position=k.m.TransformCoordinates(V,this.LY),this}lookAt(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const s=K._LookAtVectorCache,F=0===l?this.position:this.getAbsolutePosition();if(V.subtractToRef(F,s),this.setDirection(s,I,m,C),1===l&&this.parent)if(this.rotationQuaternion){const V=k.g.Matrix[0];this.rotationQuaternion.toRotationMatrix(V);const I=k.g.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(I),I.invert(),V.multiplyToRef(I,V),this.rotationQuaternion.fromRotationMatrix(V)}else{const V=k.g.Quaternion[0];k.e.FromEulerVectorToRef(this.rotation,V);const I=k.g.Matrix[0];V.toRotationMatrix(I);const m=k.g.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(m),m.invert(),I.multiplyToRef(m,I),V.fromRotationMatrix(I),V.toEulerAnglesToRef(this.rotation)}return this}Kj(V){const I=k.m.Zero();return this.getDirectionToRef(V,I),I}getDirectionToRef(V,I){return k.m.TransformNormalToRef(V,this.getWorldMatrix(),I),this}setDirection(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const l=-Math.atan2(V.z,V.x)+Math.PI/2,s=Math.sqrt(V.x*V.x+V.z*V.z),F=-Math.atan2(V.y,s);return this.rotationQuaternion?k.e.RotationYawPitchRollToRef(l+I,F+m,C,this.rotationQuaternion):(this.rotation.x=F+m,this.rotation.y=l+I,this.rotation.z=C),this}setPivotPoint(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.cV().getRenderId()&&this.fF(!0);const m=this.getWorldMatrix();if(1==I){const I=k.g.Matrix[0];m.invertToRef(I),V=k.m.TransformCoordinates(V,I)}return this.setPivotMatrix(k.b.Translation(-V.x,-V.y,-V.z),!0)}getPivotPoint(){const V=k.m.Zero();return this.getPivotPointToRef(V),V}getPivotPointToRef(V){return V.x=-this._pivotMatrix.m[12],V.y=-this._pivotMatrix.m[13],V.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const V=k.m.Zero();return this.getAbsolutePivotPointToRef(V),V}getAbsolutePivotPointToRef(V){return this.getPivotPointToRef(V),k.m.TransformCoordinatesToRef(V,this.getWorldMatrix(),V),this}bE(V){if(this._isDirty)return this;if(this._children)for(const I of this._children)I.bE(V);return super.bE(V)}setParent(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!V&&!this.parent)return this;const C=k.g.Quaternion[0],l=k.g.LF[0],s=k.g.LF[1],F=k.g.Matrix[1];k.b.IdentityToRef(F);const j=k.g.Matrix[0];this.fF(!0);let E=this.rotationQuaternion;return E||(E=K._TmpRotation,k.e.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,E)),k.b.ComposeToRef(this.Vk,E,this.position,j),this.parent&&j.multiplyToRef(this.parent.fF(!0),j),V&&(V.fF(!0).invertToRef(F),j.multiplyToRef(F,j)),j.decompose(s,C,l,I?this:void 0),this.rotationQuaternion?this.rotationQuaternion.C(C):C.toEulerAnglesToRef(this.rotation),this.Vk.C(s),this.position.C(l),this.parent=V,m&&this.setPivotMatrix(k.b.Identity()),this}addChild(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return V.setParent(this,I),this}removeChild(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return V.parent!==this||V.setParent(null,I),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(V){return this._nonUniformScaling!==V&&(this._nonUniformScaling=V,!0)}attachToBone(V,I){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=I,this.parent=V,V.getSkeleton().prepare(!0),V.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=V?this._currentParentWhenAttachingToBone:null,this):(V&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(V,I,m){let C;if(V.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.mk(0)),m&&0!==m){if(this.parent){const m=this.parent.getWorldMatrix(),C=k.g.Matrix[0];m.invertToRef(C),V=k.m.TransformNormal(V,C),m.determinant()<0&&(I*=-1)}C=k.e.RotationAxisToRef(V,I,K._RotationAxisCache),C.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else C=k.e.RotationAxisToRef(V,I,K._RotationAxisCache),this.rotationQuaternion.multiplyToRef(C,this.rotationQuaternion);return this}rotateAround(V,I,m){I.normalize(),this.rotationQuaternion||(this.rotationQuaternion=k.e.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.mk(0));const C=k.g.LF[0],l=k.g.LF[1],s=k.g.LF[2],F=k.g.Quaternion[0],j=k.g.Matrix[0],E=k.g.Matrix[1],K=k.g.Matrix[2],Y=k.g.Matrix[3];return V.subtractToRef(this.position,C),k.b.TranslationToRef(C.x,C.y,C.z,j),k.b.TranslationToRef(-C.x,-C.y,-C.z,E),k.b.RotationAxisToRef(I,m,K),E.multiplyToRef(K,Y),Y.multiplyToRef(j,Y),Y.decompose(l,F,s),this.position.addInPlace(s),F.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(V,I,m){const C=V.scale(I);if(m&&0!==m)this.setAbsolutePosition(this.getAbsolutePosition().add(C));else{const V=this.getPositionExpressedInLocalSpace().add(C);this.setPositionWithLocalVector(V)}return this}addRotation(V,I,m){let C;this.rotationQuaternion?C=this.rotationQuaternion:(C=k.g.Quaternion[1],k.e.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,C));const l=k.g.Quaternion[0];return k.e.RotationYawPitchRollToRef(I,V,m,l),C.multiplyInPlace(l),this.rotationQuaternion||C.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==K.BILLBOARDMODE_NONE}fF(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const m=this.cV().getRenderId();if(!this._isDirty&&!V&&(this._currentRenderId===m||this.isSynchronized()))return this._currentRenderId=m,this._worldMatrix;I=I||this.cV().activeCamera,this._updateCache();const C=this._cache;C.pivotMatrixUpdated=!1,C.billboardMode=this.billboardMode,C.infiniteDistance=this.infiniteDistance,C.parent=this._parentNode,this._currentRenderId=m,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const l=this._getEffectiveParent(),s=K._TmpScaling;let F,j=this._position;if(this._infiniteDistance&&!this.parent&&I){const V=I.getWorldMatrix(),m=new k.m(V.m[12],V.m[13],V.m[14]);j=K._TmpTranslation,j.aF(this._position.x+m.x,this._position.y+m.y,this._position.z+m.z)}if(s.aF(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,F=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(k.e.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.aF(0,0,0))}}else F=K._TmpRotation,k.e.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,F);if(this._usePivotMatrix){const V=k.g.Matrix[1];k.b.ScalingToRef(s.x,s.y,s.z,V);const I=k.g.Matrix[0];F.toRotationMatrix(I),this._pivotMatrix.multiplyToRef(V,k.g.Matrix[4]),k.g.Matrix[4].multiplyToRef(I,this.LY),this._postMultiplyPivotMatrix&&this.LY.multiplyToRef(this._pivotMatrixInverse,this.LY),this.LY.addTranslationFromFloats(j.x,j.y,j.z)}else k.b.ComposeToRef(s,F,j,this.LY);if(l&&l.getWorldMatrix){if(V&&l.fF(V),this.billboardMode){if(this._transformToBoneReferal){const V=this.parent;V.getSkeleton().prepare(),V.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),k.g.Matrix[7])}else k.g.Matrix[7].C(l.getWorldMatrix());const V=k.g.LF[5],I=k.g.LF[6],m=k.g.Quaternion[0];k.g.Matrix[7].decompose(I,m,V),k.b.ScalingToRef(I.x,I.y,I.z,k.g.Matrix[7]),k.g.Matrix[7].setTranslation(V),K.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(m,V),this.LY.setTranslation(V)),this.LY.multiplyToRef(k.g.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const V=this.parent;V.getSkeleton().prepare(),this.LY.multiplyToRef(V.getFinalMatrix(),k.g.Matrix[6]),k.g.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.LY.multiplyToRef(l.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.C(this.LY);if(I&&this.billboardMode)if(C.useBillboardPosition){if(C.useBillboardPosition){const V=k.g.LF[0];this._worldMatrix.getTranslationToRef(V);const m=I.globalPosition;this._worldMatrix.invertToRef(k.g.Matrix[1]);const C=k.g.LF[1];k.m.TransformCoordinatesToRef(m,k.g.Matrix[1],C),C.normalize();const l=-Math.atan2(C.z,C.x)+Math.PI/2,s=Math.sqrt(C.x*C.x+C.z*C.z),F=-Math.atan2(C.y,s);if(k.e.RotationYawPitchRollToRef(l,F,0,k.g.Quaternion[0]),(this.billboardMode&K.BILLBOARDMODE_ALL)!==K.BILLBOARDMODE_ALL){const V=k.g.LF[1];k.g.Quaternion[0].toEulerAnglesToRef(V),(this.billboardMode&K.BILLBOARDMODE_X)!==K.BILLBOARDMODE_X&&(V.x=0),(this.billboardMode&K.BILLBOARDMODE_Y)!==K.BILLBOARDMODE_Y&&(V.y=0),(this.billboardMode&K.BILLBOARDMODE_Z)!==K.BILLBOARDMODE_Z&&(V.z=0),k.b.RotationYawPitchRollToRef(V.y,V.x,V.z,k.g.Matrix[0])}else k.b.FromQuaternionToRef(k.g.Quaternion[0],k.g.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(k.g.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(k.g.LF[0])}}else{const V=k.g.LF[0];if(this._worldMatrix.getTranslationToRef(V),k.g.Matrix[1].C(I.getViewMatrix()),k.g.Matrix[1].setTranslationFromFloats(0,0,0),k.g.Matrix[1].invertToRef(k.g.Matrix[0]),(this.billboardMode&K.BILLBOARDMODE_ALL)!==K.BILLBOARDMODE_ALL){k.g.Matrix[0].decompose(void 0,k.g.Quaternion[0],void 0);const V=k.g.LF[1];k.g.Quaternion[0].toEulerAnglesToRef(V),(this.billboardMode&K.BILLBOARDMODE_X)!==K.BILLBOARDMODE_X&&(V.x=0),(this.billboardMode&K.BILLBOARDMODE_Y)!==K.BILLBOARDMODE_Y&&(V.y=0),(this.billboardMode&K.BILLBOARDMODE_Z)!==K.BILLBOARDMODE_Z&&(V.z=0),k.b.RotationYawPitchRollToRef(V.y,V.x,V.z,k.g.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(k.g.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(k.g.LF[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):l&&l._nonUniformScaling?this._updateNonUniformScalingState(l._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.aF(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=k.b.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.fF(),V){const V=this.getChildren();for(let I=0;I<V.length;++I){const m=V[I];if(m){m.fF();const V=k.g.Matrix[0];m.LY.multiplyToRef(this.LY,V);const I=k.g.Quaternion[0];V.decompose(m.Vk,I,m.position),m.rotationQuaternion?m.rotationQuaternion.C(I):I.toEulerAnglesToRef(m.rotation)}}}this.Vk.aF(1,1,1),this.position.aF(0,0,0),this.rotation.aF(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=k.e.Identity()),this._worldMatrix=k.b.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(V){return this.onAfterWorldMatrixUpdateObservable.add(V),this}unregisterAfterWorldMatrixUpdate(V){return this.onAfterWorldMatrixUpdateObservable.removeCallback(V),this}getPositionInCameraSpace(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return V||(V=this.cV().activeCamera),k.m.TransformCoordinates(this.getAbsolutePosition(),V.getViewMatrix())}getDistanceToCamera(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return V||(V=this.cV().activeCamera),this.getAbsolutePosition().Fm(V.globalPosition).length()}clone(V,I,m){const C=s.d.Clone((()=>new K(V,this.cV())),this);if(C.name=V,C.id=V,I&&(C.parent=I),!m){const I=this.getDescendants(!0);for(let m=0;m<I.length;m++){const l=I[m];l.clone&&l.clone(V+"."+l.name,C)}}return C}serialize(V){const I=s.d.Serialize(this,V);return I.type=this.getClassName(),I.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(I),I.localMatrix=this.getPivotMatrix().UF(),I.isEnabled=this.isEnabled(),s.d.AppendSerializedAnimations(this,I),I.ranges=this.serializeAnimationRanges(),I}static Parse(V,I,m){const C=s.d.Parse((()=>new K(V.name,I)),V,I,m);if(V.localMatrix?C.setPreTransformMatrix(k.b.Ik(V.localMatrix)):V.pivotMatrix&&C.setPivotMatrix(k.b.Ik(V.pivotMatrix)),C.Sk(V.isEnabled),C._waitingParsedUniqueId=V.uniqueId,void 0!==V.parentId&&(C._waitingParentId=V.parentId),void 0!==V.parentInstanceIndex&&(C._waitingParentInstanceIndex=V.parentInstanceIndex),V.animations){for(let I=0;I<V.animations.length;I++){const m=V.animations[I],l=(0,E.d)("BABYLON.Animation");l&&C.animations.push(l.Parse(m))}j.c.ParseAnimationRanges(C,V,I)}return V.autoAnimate&&I.beginAnimation(C,V.autoAnimateFrom,V.autoAnimateTo,V.autoAnimateLoop,V.autoAnimateSpeed||1),C}getChildTransformNodes(V,I){const m=[];return this._getDescendants(m,V,(V=>(!I||I(V))&&V instanceof K)),m}dispose(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.cV().stopAnimation(this),this.cV().removeTransformNode(this),this._parentContainer){const V=this._parentContainer.transformNodes.indexOf(this);V>-1&&this._parentContainer.transformNodes.splice(V,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),V){const V=this.getChildTransformNodes(!0);for(const I of V)I.parent=null,I.fF(!0)}super.dispose(V,I)}normalizeToUnitCube(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2?arguments[2]:void 0,C=null,l=null;I&&(this.rotationQuaternion?(l=this.rotationQuaternion.clone(),this.rotationQuaternion.aF(0,0,0,1)):this.rotation&&(C=this.rotation.clone(),this.rotation.aF(0,0,0)));const s=this.getHierarchyBoundingVectors(V,m),F=s.max.Fm(s.min),k=Math.max(F.x,F.y,F.z);if(0===k)return this;const j=1/k;return this.Vk.scaleInPlace(j),I&&(this.rotationQuaternion&&l?this.rotationQuaternion.C(l):this.rotation&&C&&this.rotation.C(C)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}K.BILLBOARDMODE_NONE=0,K.BILLBOARDMODE_X=1,K.BILLBOARDMODE_Y=2,K.BILLBOARDMODE_Z=4,K.BILLBOARDMODE_ALL=7,K.BILLBOARDMODE_USE_POSITION=128,K.BillboardUseParentOrientation=!1,K._TmpRotation=k.e.Zero(),K._TmpScaling=k.m.Zero(),K._TmpTranslation=k.m.Zero(),K._LookAtVectorCache=new k.m(0,0,0),K._RotationAxisCache=new k.e,(0,C.d)([(0,l.x)("position")],K.prototype,"_position",void 0),(0,C.d)([(0,l.x)("rotation")],K.prototype,"_rotation",void 0),(0,C.d)([(0,l.p)("rotationQuaternion")],K.prototype,"_rotationQuaternion",void 0),(0,C.d)([(0,l.x)("Vk")],K.prototype,"_scaling",void 0),(0,C.d)([(0,l.B)("billboardMode")],K.prototype,"_billboardMode",void 0),(0,C.d)([(0,l.B)()],K.prototype,"scalingDeterminant",void 0),(0,C.d)([(0,l.B)("infiniteDistance")],K.prototype,"_infiniteDistance",void 0),(0,C.d)([(0,l.B)()],K.prototype,"ignoreNonUniformScaling",void 0),(0,C.d)([(0,l.B)()],K.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},11678:(V,I,m)=>{m.d(I,{c:()=>E});var C=m(11040),l=m(11074),s=m(11488),F=m(11044),k=m(11312);class j{constructor(V,I,m,C){this.name=V,this.worldAxisForNormal=I,this.worldAxisForFileX=m,this.worldAxisForFileY=C}}class E{static ConvertCubeMapTextureToSphericalPolynomial(V){var I;if(!V.isCube)return null;null===(I=V.cV())||void 0===I||I.getEngine().flushFramebuffer();const m=V.getSize().width,C=V.readPixels(0,void 0,void 0,!1),l=V.readPixels(1,void 0,void 0,!1);let s,F;V.isRenderTarget?(s=V.readPixels(3,void 0,void 0,!1),F=V.readPixels(2,void 0,void 0,!1)):(s=V.readPixels(2,void 0,void 0,!1),F=V.readPixels(3,void 0,void 0,!1));const k=V.readPixels(4,void 0,void 0,!1),j=V.readPixels(5,void 0,void 0,!1),E=V.gammaSpace;let K=0;return 1!=V.textureType&&2!=V.textureType||(K=1),new Promise((V=>{Promise.all([l,C,s,F,k,j]).then((I=>{let[C,l,s,F,k,j]=I;const Y={size:m,right:l,left:C,up:s,down:F,front:k,back:j,format:5,type:K,gammaSpace:E};V(this.ConvertCubeMapToSphericalPolynomial(Y))}))}))}static _AreaElement(V,I){return Math.atan2(V*I,Math.sqrt(V*V+I*I+1))}static ConvertCubeMapToSphericalPolynomial(V){const I=new s.b;let m=0;const C=2/V.size,j=C,E=.5*C,K=E-1;for(let s=0;s<6;s++){const Y=this._FileFaces[s],X=V[Y.name];let O=K;const v=5===V.format?4:3;for(let s=0;s<V.size;s++){let N=K;for(let j=0;j<V.size;j++){const K=Y.worldAxisForFileX.scale(N).add(Y.worldAxisForFileY.scale(O)).add(Y.worldAxisForNormal);K.normalize();const t=this._AreaElement(N-E,O-E)-this._AreaElement(N-E,O+E)-this._AreaElement(N+E,O-E)+this._AreaElement(N+E,O+E);let D=X[s*V.size*v+j*v+0],b=X[s*V.size*v+j*v+1],T=X[s*V.size*v+j*v+2];isNaN(D)&&(D=0),isNaN(b)&&(b=0),isNaN(T)&&(T=0),0===V.type&&(D/=255,b/=255,T/=255),V.gammaSpace&&(D=Math.pow((0,l.Clamp)(D),F.m),b=Math.pow((0,l.Clamp)(b),F.m),T=Math.pow((0,l.Clamp)(T),F.m));const n=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const V=Math.max(D,b,T);if(V>n){const I=n/V;D*=I,b*=I,T*=I}}else D=(0,l.Clamp)(D,0,n),b=(0,l.Clamp)(b,0,n),T=(0,l.Clamp)(T,0,n);const x=new k.c(D,b,T);I.addLight(K,x,t),m+=t,N+=C}O+=j}}const Y=6*(4*Math.PI)/6/m;return I.scaleInPlace(Y),I.convertIncidentRadianceToIrradiance(),I.convertIrradianceToLambertianRadiance(),s.c.FromHarmonics(I)}}E._FileFaces=[new j("right",new C.m(1,0,0),new C.m(0,0,-1),new C.m(0,-1,0)),new j("left",new C.m(-1,0,0),new C.m(0,0,1),new C.m(0,-1,0)),new j("up",new C.m(0,1,0),new C.m(1,0,0),new C.m(0,0,1)),new j("down",new C.m(0,-1,0),new C.m(1,0,0),new C.m(0,0,-1)),new j("front",new C.m(0,0,1),new C.m(1,0,0),new C.m(0,-1,0)),new j("back",new C.m(0,0,-1),new C.m(-1,0,0),new C.m(0,-1,0))],E.MAX_HDRI_VALUE=4096,E.PRESERVE_CLAMPED_COLORS=!1},11046:(V,I,m)=>{function C(V,I){const m=[];for(let C=0;C<V;++C)m.push(I());return m}function l(V,I){return C(V,I)}m.d(I,{d:()=>C,h:()=>l,l:()=>F});const s=["push","splice","pop","shift","unshift"];function F(V,I){const m=s.map((m=>function(V,I,m){const C=V[I];if("function"!==typeof C)return null;const l=function(){const C=V.length,s=l.previous.apply(V,arguments);return m(I,C),s};return C.next=l,l.previous=C,V[I]=l,()=>{const m=l.previous;if(!m)return;const C=l.next;C?(m.next=C,C.previous=m):(m.next=void 0,V[I]=m),l.next=void 0,l.previous=void 0}}(V,m,I)));return()=>{for(const V of m)null===V||void 0===V||V()}}},11574:(V,I,m)=>{m.d(I,{d:()=>F});var C=m(11518),l=m(11583);let s=0;const F=V=>{if(!V.environmentBRDFTexture){const I=V.useDelayedTextureLoading;V.useDelayedTextureLoading=!1;const m=V._blockEntityCollection;V._blockEntityCollection=!1;const F=C.e.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+s++,V,!0,!1,C.e.BILINEAR_SAMPLINGMODE);V._blockEntityCollection=m;const k=V.getEngine().getLoadedTexturesCache(),j=k.indexOf(F.getInternalTexture());-1!==j&&k.splice(j,1),F.isRGBD=!0,F.wrapU=C.e.CLAMP_ADDRESSMODE,F.wrapV=C.e.CLAMP_ADDRESSMODE,V.environmentBRDFTexture=F,V.useDelayedTextureLoading=I,l.e.ExpandRGBDTexture(F);const E=V.getEngine().onContextRestoredObservable.add((()=>{F.isRGBD=!0;const I=V.onBeforeRenderObservable.add((()=>{F.isReady()&&(V.onBeforeRenderObservable.remove(I),l.e.ExpandRGBDTexture(F))}))}));V.Ck.add((()=>{V.getEngine().onContextRestoredObservable.remove(E)}))}return V.environmentBRDFTexture}},11358:(V,I,m)=>{function C(V,I,m){try{const C=V.next();C.done?I(C):C.value?C.value.then((()=>{C.value=void 0,I(C)}),m):I(C)}catch(C){m(C)}}function l(){let V,I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(m,l,s)=>{const F=performance.now();void 0===V||F-V>I?(V=F,setTimeout((()=>{C(m,l,s)}),0)):C(m,l,s)}}function s(V,I,m,C,l){const s=()=>{let F;const k=V=>{V.done?m(V.value):void 0===F?F=!0:s()};do{F=void 0,l&&l.aborted?C(new Error("Aborted")):I(V,k,C),void 0===F&&(F=!1)}while(F)};s()}function F(V,I){let m;return s(V,C,(V=>m=V),(V=>{throw V}),I),m}async function k(V,I,m){return await new Promise(((C,l)=>{s(V,I,C,l,m)}))}function j(V,I){return function(){return F(V(...arguments),I)}}m.d(I,{c:()=>l,d:()=>j,e:()=>k,i:()=>F})},11222:(V,I,m)=>{m.d(I,{e:()=>s,f:()=>F});const C={},l={};function s(V){const I=V.getClassName();return l[I]||(l[I]={}),l[I]}function F(V){const I=V.getClassName();if(C[I])return C[I];C[I]={};const m=C[I];let s=V,F=I;for(;F;){const V=l[F];for(const l in V)m[l]=V[l];let I,C=!1;do{if(I=Object.getPrototypeOf(s),!I.getClassName){C=!0;break}if(I.getClassName()!==F)break;s=I}while(I);if(C)break;F=I.getClassName(),s=I}return m}},11214:(V,I,m)=>{m.d(I,{B:()=>F,b:()=>s,c:()=>b,d:()=>O,e:()=>j,f:()=>v,g:()=>E,k:()=>N,l:()=>D,m:()=>X,p:()=>t,s:()=>k,w:()=>K,x:()=>Y});var C=m(11222);function l(V,I){return(m,l)=>{const s=(0,C.e)(m);s[l]||(s[l]={type:V,sourceName:I})}}function s(V){return function(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(m,C)=>{const l=I||"_"+C;Object.defineProperty(m,C,{get:function(){return this[l]},set:function(I){var C;"function"===typeof(null===(C=this[l])||void 0===C?void 0:C.equals)&&this[l].equals(I)||this[l]!==I&&(this[l]=I,m[V].apply(this))},enumerable:!0,configurable:!0})}}(V,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)}function F(V){return l(0,V)}function k(V){return l(1,V)}function j(V){return l(2,V)}function E(V){return l(3,V)}function K(V){return l(4,V)}function Y(V){return l(5,V)}function X(V){return l(6,V)}function O(V){return l(7,V)}function v(V){return l(8,V)}function N(V){return l(9,V)}function t(V){return l(10,V)}function D(V){return l(12,V)}function b(V,I,m,C){const l=m.value;m.value=function(){let m=l;if("undefined"!==typeof _native&&_native[I]){const V=_native[I];m=C?function(){return C(...arguments)?V(...arguments):l(...arguments)}:V}return V[I]=m,m(...arguments)}}b.filter=function(V){return(I,m,C)=>b(I,m,C,V)}},11297:(V,I,m)=>{m.d(I,{d:()=>E});var C=m(11095),l=m(11305),s=m(11312),F=m(11040),k=m(11222);const j=function(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const s=V();l.b&&l.b.HasTags(I)&&l.b.AddTagsTo(s,l.b.GetTags(I,!0));const F=(0,k.f)(s),j={};for(const l in F){const V=F[l],k=I[l],K=V.type;if(void 0!==k&&null!==k&&("uniqueId"!==l||E.AllowLoadingUniqueId))switch(K){case 0:case 6:case 9:case 11:s[l]=k;break;case 1:C.cloneTexturesOnlyOnce&&j[k.uniqueId]?s[l]=j[k.uniqueId]:(s[l]=m||k.isRenderTarget?k:k.clone(),j[k.uniqueId]=s[l]);break;case 2:case 3:case 4:case 5:case 7:case 8:case 10:case 12:s[l]=m?k:k.clone()}}return s};class E{static AppendSerializedAnimations(V,I){if(V.animations){I.animations=[];for(let m=0;m<V.animations.length;m++){const C=V.animations[m];I.animations.push(C.serialize())}}}static Serialize(V,I){I||(I={}),l.b&&(I.tags=l.b.GetTags(V));const m=(0,k.f)(V);for(const C in m){const l=m[C],s=l.sourceName||C,F=l.type,k=V[C];if(void 0!==k&&null!==k&&("uniqueId"!==C||E.AllowLoadingUniqueId))switch(F){case 0:I[s]=k;break;case 1:case 3:case 7:case 9:I[s]=k.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:I[s]=k.UF();break;case 6:case 11:I[s]=k.id}}return I}static ParseProperties(V,I,m,C){C||(C="");const l=(0,k.f)(I);for(const k in l){const j=l[k],K=V[j.sourceName||k],Y=j.type;if(void 0!==K&&null!==K&&("uniqueId"!==k||E.AllowLoadingUniqueId)){const V=I;switch(Y){case 0:V[k]=K;break;case 1:m&&(V[k]=E._TextureParser(K,m,C));break;case 2:V[k]=s.c.Ik(K);break;case 3:V[k]=E._FresnelParametersParser(K);break;case 4:V[k]=F.k.Ik(K);break;case 5:V[k]=F.m.Ik(K);break;case 6:m&&(V[k]=m.getLastMeshById(K));break;case 7:V[k]=E._ColorCurvesParser(K);break;case 8:V[k]=s.d.Ik(K);break;case 9:V[k]=E._ImageProcessingConfigurationParser(K);break;case 10:V[k]=F.e.Ik(K);break;case 11:m&&(V[k]=m.getCameraById(K));break;case 12:V[k]=F.b.Ik(K)}}}}static Parse(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const s=V();return l.b&&l.b.AddTagsTo(s,I.tags),E.ParseProperties(I,s,m,C),s}static Clone(V,I){return j(V,I,!1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}static Instanciate(V,I){return j(V,I,!0)}}E.AllowLoadingUniqueId=!1,E._ImageProcessingConfigurationParser=V=>{throw(0,C.c)("ImageProcessingConfiguration")},E._FresnelParametersParser=V=>{throw(0,C.c)("FresnelParameters")},E._ColorCurvesParser=V=>{throw(0,C.c)("ColorCurves")},E._TextureParser=(V,I,m)=>{throw(0,C.c)("Texture")}},11089:(V,I,m)=>{m.d(I,{e:()=>s});var C=m(11085);const l=(V,I,m)=>V?V.getClassName&&"Mesh"===V.getClassName()?null:!V.getClassName||"SubMesh"!==V.getClassName()&&"PhysicsBody"!==V.getClassName()?V.clone?V.clone():Array.isArray(V)?V.slice():m&&"object"===typeof V?{...V}:null:V.clone(I):null;class s{static DeepCopy(V,I,m,s){let F=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const k=function(V){const I=[];do{const m=Object.getOwnPropertyNames(V);for(const V of m)-1===I.indexOf(V)&&I.push(V)}while(V=Object.getPrototypeOf(V));return I}(V);for(const E of k){if("_"===E[0]&&(!s||-1===s.indexOf(E)))continue;if(E.endsWith("Observable"))continue;if(m&&-1!==m.indexOf(E))continue;const k=V[E],K=typeof k;if("function"!==K)try{if("object"===K)if(k instanceof Uint8Array)I[E]=Uint8Array.from(k);else if(k instanceof Array){if(I[E]=[],k.length>0)if("object"==typeof k[0])for(let V=0;V<k.length;V++){const m=l(k[V],I,F);-1===I[E].indexOf(m)&&I[E].push(m)}else I[E]=k.slice(0)}else I[E]=l(k,I,F);else I[E]=k}catch(j){C.d.Warn(j.message)}}}}},11769:(V,I,m)=>{function C(){const V=V=>!!V&&"object"===typeof V;for(var I=arguments.length,m=new Array(I),l=0;l<I;l++)m[l]=arguments[l];return m.reduce(((I,m)=>{const l=Object.keys(m);for(const s of l){const l=I[s],F=m[s];Array.isArray(l)&&Array.isArray(F)?I[s]=l.concat(...F):V(l)&&V(F)?I[s]=C(l,F):I[s]=F}return I}),{})}m.d(I,{c:()=>C})},11095:(V,I,m)=>{m.d(I,{c:()=>l});const C={};function l(V){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!C[V])return C[V]=!0,`${V} needs to be imported before as it contains a side-effect required by your code.`}},11081:(V,I,m)=>{function C(){return"undefined"!==typeof window}function l(){return"undefined"!==typeof navigator}function s(){return"undefined"!==typeof document}function F(V){let I="",m=V.firstChild;for(;m;)3===m.nodeType&&(I+=m.textContent),m=m.nextSibling;return I}m.d(I,{e:()=>F,i:()=>s,l:()=>l,o:()=>C})},11560:(V,I,m)=>{m.r(I),m.d(I,{Dispose:()=>X,DumpData:()=>Y,DumpDataAsync:()=>K,DumpFramebuffer:()=>E,DumpTools:()=>O});var C=m(11533),l=m(11076),s=m(11074),F=m(11061);let k,j=null;async function E(V,I,m,C){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",s=arguments.length>5?arguments[5]:void 0,F=arguments.length>6?arguments[6]:void 0;const k=await m.readPixels(0,0,V,I);Y(V,I,new Uint8Array(k.buffer),C,l,s,!0,void 0,F)}async function K(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",l=arguments.length>4?arguments[4]:void 0,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],F=arguments.length>6&&void 0!==arguments[6]&&arguments[6],k=arguments.length>7?arguments[7]:void 0;return await new Promise((j=>{Y(V,I,m,(V=>j(V)),C,l,s,F,k)}))}function Y(V,I,E,K){let Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",O=arguments.length>5?arguments[5]:void 0,v=arguments.length>6&&void 0!==arguments[6]&&arguments[6],N=arguments.length>7&&void 0!==arguments[7]&&arguments[7],t=arguments.length>8?arguments[8]:void 0;(async function(){return j||(j=new Promise(((V,I)=>{let l,s=null;const j={PE:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(m.bind(m,11433)).then((E=>{let{ThinEngine:K}=E;const Y=F.c.Instances.length;try{l=new OffscreenCanvas(100,100),s=new K(l,!1,j)}catch(N){var O;Y<F.c.Instances.length&&(null===(O=F.c.Instances.pop())||void 0===O||O.dispose()),l=document.createElement("canvas"),s=new K(l,!1,j)}F.c.Instances.pop(),F.c.OnEnginesDisposedObservable.add((V=>{s&&V!==s&&!s.K&&0===F.c.Instances.length&&X()})),s.getCaps().parallelShaderCompile=void 0;const v=new C.d(s);m.e(37).then(m.bind(m,13706)).then((m=>{let{passPixelShader:F}=m;if(!s)return void I("Engine is not defined");const j=new C.f({rF:s,name:F.name,fragmentShader:F.shader,samplerNames:["textureSampler"]});k={canvas:l,rF:s,renderer:v,wrapper:j},V(k)}))})).catch(I)}))),await j})().then((m=>{if(m.rF.setSize(V,I,!0),E instanceof Float32Array){const V=new Uint8Array(E.length);let I=E.length;for(;I--;){const m=E[I];V[I]=Math.round(255*(0,s.Clamp)(m))}E=V}const C=m.rF.createRawTexture(E,V,I,5,!1,!v,1);m.renderer.setViewport(),m.renderer.applyEffectWrapper(m.wrapper),m.wrapper.effect._bindTexture("textureSampler",C),m.renderer.draw(),N?l.d.ToBlob(m.canvas,(V=>{const I=new FileReader;I.onload=V=>{const I=V.target.result;K&&K(I)},I.readAsArrayBuffer(V)}),Y,t):l.d.EncodeScreenshotCanvasData(m.canvas,K,Y,O,t),C.dispose()}))}function X(){var V;k?(k.wrapper.dispose(),k.renderer.dispose(),k.rF.dispose()):null===(V=j)||void 0===V||V.then((V=>{V.wrapper.dispose(),V.renderer.dispose(),V.rF.dispose()}));j=null,k=null}const O={DumpData:Y,DumpDataAsync:K,DumpFramebuffer:E,Dispose:X};l.d.DumpData=Y,l.d.DumpDataAsync=K,l.d.DumpFramebuffer=E},11111:(V,I,m)=>{m.d(I,{b:()=>C,e:()=>l,g:()=>s});class C extends Error{}C._setPrototypeOf=Object.setPrototypeOf||((V,I)=>(V.__proto__=I,V));const l={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};class s extends C{constructor(V,I,m){super(V),this.errorCode=I,this.innerError=m,this.name="RuntimeError",C._setPrototypeOf(this,s.prototype)}}},11102:(V,I,m)=>{m.d(I,{b:()=>Q,f:()=>T,j:()=>z,l:()=>B,r:()=>H,o:()=>t,u:()=>S,x:()=>c,A:()=>y,E:()=>n});var C=m(11099),l=m(11081),s=m(11067);class F{}F.FilesToLoad={};var k=m(11111),j=m(11118),E=m(11121),K=m(11061),Y=m(11085),X=m(11129),O=m(11125),v=m(11136);const N=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class t extends k.g{constructor(V,I){super(V,k.e.LoadFileError),this.name="LoadFileError",k.b._setPrototypeOf(this,t.prototype),I instanceof C.c?this.request=I:this.file=I}}class D extends k.g{constructor(V,I){super(V,k.e.RequestFileError),this.request=I,this.name="RequestFileError",k.b._setPrototypeOf(this,D.prototype)}}class b extends k.g{constructor(V,I){super(V,k.e.ReadFileError),this.file=I,this.name="ReadFileError",k.b._setPrototypeOf(this,b.prototype)}}const T={DefaultRetryStrategy:class{static ExponentialBackoff(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return(m,C,l)=>0!==C.status||l>=V||-1!==m.indexOf("file:")?-1:Math.pow(2,l)*I}}.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:V=>V,ScriptBaseUrl:"",ScriptPreprocessUrl:V=>V,CleanUrl:V=>V=V.replace(/#/gm,"%23")},n=(V,I)=>{if((!V||0!==V.indexOf("data:"))&&T.CorsBehavior)if("string"===typeof T.CorsBehavior||T.CorsBehavior instanceof String)I.crossOrigin=T.CorsBehavior;else{const m=T.CorsBehavior(V);m&&(I.crossOrigin=m)}},x={getRequiredSize:null},S=function(V,I,m,l){let s,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",E=arguments.length>5?arguments[5]:void 0,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:K.c.LastCreatedEngine;if("undefined"===typeof HTMLImageElement&&(null===Y||void 0===Y||!Y._features.forceBitmapOverHTMLImageElement))return m("LoadImage is only supported in web or BabylonNative environments."),null;let X=!1;V instanceof ArrayBuffer||ArrayBuffer.isView(V)?"undefined"!==typeof Blob&&"undefined"!==typeof URL?(s=URL.createObjectURL(new Blob([V],{type:k})),X=!0):s=`data:${k};base64,`+(0,j.k)(V):V instanceof Blob?(s=URL.createObjectURL(V),X=!0):(s=T.CleanUrl(V),s=T.PreprocessUrl(s));const O=I=>{if(m){const C=s||V.toString();m(`Error while trying to load image: ${0===C.indexOf("http")||C.length<=128?C:C.slice(0,128)+"..."}`,I)}};if(null!==Y&&void 0!==Y&&Y._features.forceBitmapOverHTMLImageElement)return H(s,(C=>{Y.createImageBitmap(new Blob([C],{type:k}),{premultiplyAlpha:"none",...E}).then((V=>{I(V),X&&URL.revokeObjectURL(s)})).catch((I=>{m&&m("Error while trying to load image: "+V,I)}))}),void 0,l||void 0,!0,((V,I)=>{O(I)})),null;const v=new Image;if(x.getRequiredSize){const I=x.getRequiredSize(V);I.width&&(v.width=I.width),I.height&&(v.height=I.height)}n(s,v);const N=[],t=()=>{for(const V of N)V.target.removeEventListener(V.name,V.handler);N.length=0};N.push({target:v,name:"load",handler:()=>{t(),I(v),X&&v.src&&URL.revokeObjectURL(v.src)}}),N.push({target:v,name:"error",handler:V=>{t(),O(V),X&&v.src&&URL.revokeObjectURL(v.src)}}),N.push({target:document,name:"securitypolicyviolation",handler:V=>{if(V.blockedURI!==v.src||"xv"===V.disposition)return;t();const I=new Error(`CSP violation of policy ${V.effectiveDirective} ${V.blockedURI}. Current policy is ${V.originalPolicy}`);K.c.UseFallbackTexture=!1,O(I),X&&v.src&&URL.revokeObjectURL(v.src),v.src=""}}),(()=>{for(const V of N)V.target.addEventListener(V.name,V.handler)})();const D="blob:"===s.substring(0,5),b="data:"===s.substring(0,5),S=()=>{D||b||!C.c.IsCustomRequestAvailable?v.src=s:H(s,((V,I,m)=>{const C=new Blob([V],{type:!k&&m?m:k}),l=URL.createObjectURL(C);X=!0,v.src=l}),void 0,l||void 0,!0,((V,I)=>{O(I)}))},c=()=>{l&&l.loadImage(s,v)};if(!D&&!b&&l&&l.enableTexturesOffline)l.open(c,S);else{if(-1!==s.indexOf("file:")){const V=decodeURIComponent(s.substring(5).toLowerCase());if(F.FilesToLoad[V]&&"undefined"!==typeof URL){try{let I;try{I=URL.createObjectURL(F.FilesToLoad[V])}catch(y){I=URL.createObjectURL(F.FilesToLoad[V])}v.src=I,X=!0}catch(z){v.src=""}return v}}S()}return v},c=(V,I,m,C,l)=>{const F=new FileReader,k={onCompleteObservable:new s.e,abort:()=>F.abort()};return F.onloadend=()=>k.onCompleteObservable.notifyObservers(k),l&&(F.onerror=()=>{l(new b(`Unable to read ${V.name}`,V))}),F.onload=V=>{I(V.target.result)},m&&(F.onprogress=m),C?F.readAsArrayBuffer(V):F.readAsText(V),k},H=(V,I,m,C,l,j,E)=>{if(V.name)return c(V,I,m,l,j?V=>{j(void 0,V)}:void 0);const K=V;if(-1!==K.indexOf("file:")){let V=decodeURIComponent(K.substring(5).toLowerCase());0===V.indexOf("./")&&(V=V.substring(2));const C=F.FilesToLoad[V];if(C)return c(C,I,m,l,j?V=>j(void 0,new t(V.message,V.file)):void 0)}const{match:O,type:v}=W(K);if(O){const V={onCompleteObservable:new s.e,abort:()=>()=>{}};try{const V=l?Q(K):G(K);I(V,void 0,v)}catch(k){j?j(void 0,k):Y.d.Error(k.message||"Failed to parse the Data URL")}return X.e.SetImmediate((()=>{V.onCompleteObservable.notifyObservers(V)})),V}return y(K,((V,m)=>{I(V,null===m||void 0===m?void 0:m.responseURL,null===m||void 0===m?void 0:m.getResponseHeader("content-type"))}),m,C,l,j?V=>{j(V.request,new t(V.message,V.request))}:void 0,E)},y=(V,I,m,F,k,j,E)=>{V=T.CleanUrl(V),V=T.PreprocessUrl(V);const K=T.BaseUrl+V;let X=!1;const O={onCompleteObservable:new s.e,abort:()=>X=!0},v=()=>{let V,s=new C.c,F=null;const v=()=>{s&&(m&&s.removeEventListener("progress",m),V&&s.removeEventListener("readystatechange",V),s.removeEventListener("loadend",N))};let N=()=>{v(),O.onCompleteObservable.notifyObservers(O),O.onCompleteObservable.clear(),m=void 0,V=null,N=null,j=void 0,E=void 0,I=void 0};O.abort=()=>{X=!0,N&&N(),s&&s.readyState!==(XMLHttpRequest.DONE||4)&&s.abort(),null!==F&&(clearTimeout(F),F=null),s=null};const t=V=>{const I=V.message||"Unknown error";j&&s?j(new D(I,s)):Y.d.Error(I)},b=Y=>{if(s){if(s.open("GET",K),E)try{E(s)}catch(O){return void t(O)}k&&(s.responseType="arraybuffer"),m&&s.addEventListener("progress",m),N&&s.addEventListener("loadend",N),V=()=>{if(!X&&s&&s.readyState===(XMLHttpRequest.DONE||4)){if(V&&s.removeEventListener("readystatechange",V),s.status>=200&&s.status<300||0===s.status&&(!(0,l.o)()||Z())){const V=k?s.response:s.responseText;if(null!==V){try{I&&I(V,s)}catch(O){t(O)}return}}const m=T.DefaultRetryStrategy;if(m){const V=m(K,s,Y);if(-1!==V)return v(),s=new C.c,void(F=setTimeout((()=>b(Y+1)),V))}const E=new D("Error status: "+s.status+" "+s.statusText+" - Unable to load "+K,s);j&&j(E)}},s.addEventListener("readystatechange",V),s.send()}};b(0)};if(F&&F.enableSceneOffline){const C=V=>{V&&V.status>400?j&&j(V):v()},l=()=>{F&&F.loadFile(T.BaseUrl+V,(V=>{!X&&I&&I(V),O.onCompleteObservable.notifyObservers(O)}),m?V=>{!X&&m&&m(V)}:void 0,C,k)};F.open(l,C)}else v();return O},z=V=>{const{match:I,type:m}=W(V);if(I)return m||void 0;const C=V.lastIndexOf(".");switch(V.substring(C+1).toLowerCase()){case"glb":return"model/gltf-binary";case"bin":return"application/octet-stream";case"sk":return"model/gltf+json";case"jpg":case"jpeg":return"image/jpeg";case"png":return"image/png";case"webp":return"image/webp";default:return}},Z=()=>"undefined"!==typeof location&&"file:"===location.protocol,B=V=>N.test(V),W=V=>{const I=N.exec(V);if(null===I||0===I.length)return{match:!1,type:""};return{match:!0,type:I[0].replace("data:","").replace("base64,","")}};function Q(V){return(0,j.c)(V.split(",")[1])}const G=V=>(0,j.d)(V.split(",")[1]);let r;v.b._FileToolsLoadImage=S,O.e.loadFile=H,E.o.loadFile=H;((V,I,m,C,l,s,F,k,j,E)=>{r={DecodeBase64UrlToBinary:V,DecodeBase64UrlToString:I,DefaultRetryStrategy:m.DefaultRetryStrategy,BaseUrl:m.BaseUrl,CorsBehavior:m.CorsBehavior,PreprocessUrl:m.PreprocessUrl,IsBase64DataUrl:C,IsFileURL:l,LoadFile:s,LoadImage:F,ReadFile:k,RequestFile:j,SetCorsBehavior:E},Object.defineProperty(r,"DefaultRetryStrategy",{get:function(){return m.DefaultRetryStrategy},set:function(V){m.DefaultRetryStrategy=V}}),Object.defineProperty(r,"BaseUrl",{get:function(){return m.BaseUrl},set:function(V){m.BaseUrl=V}}),Object.defineProperty(r,"PreprocessUrl",{get:function(){return m.PreprocessUrl},set:function(V){m.PreprocessUrl=V}}),Object.defineProperty(r,"CorsBehavior",{get:function(){return m.CorsBehavior},set:function(V){m.CorsBehavior=V}})})(Q,G,T,B,Z,H,S,c,y,n)},11188:(V,I,m)=>{function C(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(V=>{const I=16*Math.random()|0;return("x"===V?I:3&I|8).toString(16)}))}m.d(I,{d:()=>C})},11181:(V,I,m)=>{m.d(I,{c:()=>s});var C=m(11085),l=m(11048);class s{static Instantiate(V){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[V])return this.RegisteredExternalClasses[V];const I=(0,l.d)(V);if(I)return I;C.d.Warn(V+" not found, you may have missed an import.");const m=V.split(".");let s=window||this;for(let C=0,l=m.length;C<l;C++)s=s[m[C]];return"function"!==typeof s?null:s}}s.RegisteredExternalClasses={}},11085:(V,I,m)=>{m.d(I,{d:()=>C});class C{static _CheckLimit(V,I){let m=C._LogLimitOutputs[V];return m?m.current++:(m={limit:I,current:1},C._LogLimitOutputs[V]=m),m.current<=m.limit}static _GenerateLimitMessage(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const m=C._LogLimitOutputs[V];if(!m||!C.MessageLimitReached)return;const l=this._Levels[I];m.current===m.limit&&C[l.name](C.MessageLimitReached.replace(/%LIMIT%/g,""+m.limit).replace(/%TYPE%/g,l.name??""))}static _AddLogEntry(V){C._LogCache=V+C._LogCache,C.OnNewCacheEntry&&C.OnNewCacheEntry(V)}static _FormatMessage(V){const I=V=>V<10?"0"+V:""+V,m=new Date;return"["+I(m.getHours())+":"+I(m.getMinutes())+":"+I(m.getSeconds())+"]: "+V}static _LogDisabled(V,I){}static _LogEnabled(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1?arguments[1]:void 0,m=arguments.length>2?arguments[2]:void 0;const l=Array.isArray(I)?I[0]:I;if(void 0!==m&&!C._CheckLimit(l,m))return;const s=C._FormatMessage(l),F=this._Levels[V],k=Array.isArray(I)?I.slice(1):[];F.logFunc&&F.logFunc("BJS - "+s,...k);const j=`<div style='color:${F.color}'>${s}</div><br>`;C._AddLogEntry(j),C._GenerateLimitMessage(l,V)}static get LogCache(){return C._LogCache}static ClearLogCache(){C._LogCache="",C._LogLimitOutputs={},C.errorsCount=0}static set LogLevels(V){C.Log=C._LogDisabled,C.Warn=C._LogDisabled,C.Error=C._LogDisabled;const I=[C.MessageLogLevel,C.WarningLogLevel,C.ErrorLogLevel];for(const m of I)if((V&m)===m){const V=this._Levels[m];C[V.name]=C._LogEnabled.bind(C,m)}}}C.NoneLogLevel=0,C.MessageLogLevel=1,C.WarningLogLevel=2,C.ErrorLogLevel=4,C.AllLogLevel=7,C.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",C._LogCache="",C._LogLimitOutputs={},C._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],C.errorsCount=0,C.Log=C._LogEnabled.bind(C,C.MessageLogLevel),C.Warn=C._LogEnabled.bind(C,C.WarningLogLevel),C.Error=C._LogEnabled.bind(C,C.ErrorLogLevel)},11067:(V,I,m)=>{m.d(I,{e:()=>F});const C="undefined"!==typeof WeakRef;class l{constructor(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2?arguments[2]:void 0,C=arguments.length>3?arguments[3]:void 0;this.initialize(V,I,m,C)}initialize(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2?arguments[2]:void 0,C=arguments.length>3?arguments[3]:void 0;return this.mask=V,this.skipNextObservers=I,this.target=m,this.currentTarget=C,this}}class s{constructor(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=V,this.mask=I,this.scope=m,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(V)}}class F{static FromPromise(V,I){const m=new F;return V.then((V=>{m.notifyObservers(V)})).catch((V=>{if(!I)throw V;I.notifyObservers(V)})),m}get observers(){return this._observers}constructor(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=I,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new l(0),V&&(this._onObserverAdded=V)}add(V){let I=arguments.length>2&&void 0!==arguments[2]&&arguments[2],m=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!V)return null;const l=new s(V,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);l.unregisterOnNextCall=m,I?this._observers.unshift(l):this._observers.push(l),this._onObserverAdded&&this._onObserverAdded(l),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(l,this._lastNotifiedValue);const F=C?new WeakRef(this):{deref:()=>this};return l._remove=function(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const I=F.deref();I&&(V?I.remove(l):I._remove(l))},l}addOnce(V){return this.add(V,void 0,void 0,void 0,!0)}remove(V){if(!V)return!1;V._remove=null;return-1!==this._observers.indexOf(V)&&(this._deferUnregister(V),!0)}removeCallback(V,I){for(let m=0;m<this._observers.length;m++){const C=this._observers[m];if(!C._willBeUnregistered&&(C.callback===V&&(!I||I===C.scope)))return this._deferUnregister(C),!0}return!1}_deferUnregister(V){V._willBeUnregistered||(this._numObserversMarkedAsDeleted++,V.unregisterOnNextCall=!1,V._willBeUnregistered=!0,setTimeout((()=>{this._remove(V)}),0))}_remove(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!V)return!1;const m=this._observers.indexOf(V);return-1!==m&&(I&&this._numObserversMarkedAsDeleted--,this._observers.splice(m,1),!0)}makeObserverTopPriority(V){this._remove(V,!1),this._observers.unshift(V)}makeObserverBottomPriority(V){this._remove(V,!1),this._observers.push(V)}notifyObservers(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,m=arguments.length>2?arguments[2]:void 0,C=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=V),!this._observers.length)return!0;const s=this._eventState;s.mask=I,s.target=m,s.currentTarget=C,s.skipNextObservers=!1,s.lastReturnValue=V,s.userInfo=l;for(const F of this._observers)if(!F._willBeUnregistered&&(F.mask&I&&(F.unregisterOnNextCall&&this._deferUnregister(F),F.scope?s.lastReturnValue=F.callback.apply(F.scope,[V,s]):s.lastReturnValue=F.callback(V,s)),s.skipNextObservers))return!1;return!0}notifyObserver(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=I),V._willBeUnregistered)return;const C=this._eventState;C.mask=m,C.skipNextObservers=!1,V.unregisterOnNextCall&&this._deferUnregister(V),V.callback(I,C)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const V=this._observers.pop();V&&(V._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const V=new F;return V._observers=this._observers.slice(0),V}hasSpecificMask(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const I of this._observers)if(I.mask&V||I.mask===V)return!0;return!1}}},11510:(V,I,m)=>{m.d(I,{e:()=>l});var C=m(11091);class l{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(V,I){l.Enabled&&(this._current+=V,I&&this._fetchResult())}beginMonitoring(){l.Enabled&&(this._startMonitoringTime=C.d.Now)}endMonitoring(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!l.Enabled)return;V&&this.fetchNewFrame();const I=C.d.Now;this._current=I-this._startMonitoringTime,V&&this._fetchResult()}bY(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const V=C.d.Now;V-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=V,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}l.Enabled=!0},11091:(V,I,m)=>{m.d(I,{d:()=>l});var C=m(11081);class l{static get Now(){return(0,C.o)()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}},11583:(V,I,m)=>{m.d(I,{e:()=>s});var C=m(11530),l=m(11514);class s{static ExpandRGBDTexture(V){const I=V._texture;if(!I||!V.isRGBD)return;const l=I.getEngine(),s=l.getCaps(),F=I.isReady;let k=!1;s.textureHalfFloatRender&&s.textureHalfFloatLinearFiltering?(k=!0,I.type=2):s.textureFloatRender&&s.textureFloatLinearFiltering&&(k=!0,I.type=1),k&&(I.isReady=!1,I._isRGBD=!1,I.invertY=!1);const j=async()=>{const s=l.isWebGPU,F=s?1:0;I.isReady=!1,s?await m.e(21).then(m.bind(m,13759)):await m.e(14).then(m.bind(m,13761));const k=new C.e("rgbdDecode","rgbdDecode",null,null,1,null,3,l,!1,void 0,I.type,void 0,null,!1,void 0,F);k.externalTextureSamplerBinding=!0;const j=l.createRenderTargetTexture(I.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:I.samplingMode,type:I.type,format:5});k.onEffectCreatedObservable.addOnce((m=>{m.executeWhenCompiled((()=>{k.onApply=V=>{V._bindTexture("textureSampler",I),V.setFloat2("scale",1,1)},V.cV().postProcessManager.directRender([k],j,!0),l.restoreDefaultFramebuffer(),l._releaseTexture(I),k&&k.dispose(),j._swapAndDie(I),I.isReady=!0}))}))};k&&(F?j():V.onLoadObservable.addOnce(j))}static async EncodeTextureToRGBD(V,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return I.getEngine().isWebGPU?await m.e(22).then(m.bind(m,13774)):await m.e(15).then(m.bind(m,13768)),await(0,l.c)("rgbdEncode",V,I,C,1,5)}}},11389:(V,I,m)=>{m.d(I,{c:()=>l,g:()=>C});class C{constructor(V){this.length=0,this.data=new Array(V),this._id=C._GlobalId++}push(V){this.data[this.length++]=V,this.length>this.data.length&&(this.data.length*=2)}forEach(V){for(let I=0;I<this.length;I++)V(this.data[I])}sort(V){this.data.sort(V)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(V){if(0!==V.length){this.length+V.length>this.data.length&&(this.data.length=2*(this.length+V.length));for(let I=0;I<V.length;I++)this.data[this.length++]=(V.data||V)[I]}}indexOf(V){const I=this.data.indexOf(V);return I>=this.length?-1:I}contains(V){return-1!==this.indexOf(V)}}C._GlobalId=0;class l extends C{constructor(){super(...arguments),this._duplicateId=0}push(V){super.push(V),V.__smartArrayFlags||(V.__smartArrayFlags={}),V.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(V){return(!V.__smartArrayFlags||V.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(V),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(V){if(0!==V.length){this.length+V.length>this.data.length&&(this.data.length=2*(this.length+V.length));for(let I=0;I<V.length;I++){const m=(V.data||V)[I];this.pushNoDuplicate(m)}}}}},11118:(V,I,m)=>{m.d(I,{c:()=>F,d:()=>s,h:()=>C,k:()=>l});const C=V=>{if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(V);let I="";for(let m=0;m<V.byteLength;m++)I+=String.fromCharCode(V[m]);return I},l=V=>{const I="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let m,C,l,s,F,k,j,E="",K=0;const Y=ArrayBuffer.isView(V)?new Uint8Array(V.buffer,V.byteOffset,V.byteLength):new Uint8Array(V);for(;K<Y.length;)m=Y[K++],C=K<Y.length?Y[K++]:Number.NaN,l=K<Y.length?Y[K++]:Number.NaN,s=m>>2,F=(3&m)<<4|C>>4,k=(15&C)<<2|l>>6,j=63&l,isNaN(C)?k=j=64:isNaN(l)&&(j=64),E+=I.charAt(s)+I.charAt(F)+I.charAt(k)+I.charAt(j);return E},s=V=>atob(V),F=V=>{const I=s(V),m=I.length,C=new Uint8Array(new ArrayBuffer(m));for(let l=0;l<m;l++)C[l]=I.charCodeAt(l);return C.buffer}},11305:(V,I,m)=>{m.d(I,{b:()=>l});class C{static Eval(V,I){return"true"===(V=V.match(/\([^()]*\)/g)?V.replace(/\([^()]*\)/g,(V=>(V=V.slice(1,V.length-1),C._HandleParenthesisContent(V,I)))):C._HandleParenthesisContent(V,I))||"false"!==V&&C.Eval(V,I)}static _HandleParenthesisContent(V,I){let m;I=I||(V=>"true"===V);const l=V.split("||");for(const s in l)if(Object.prototype.hasOwnProperty.call(l,s)){let V=C._SimplifyNegation(l[s].trim());const F=V.split("&&");if(F.length>1)for(let l=0;l<F.length;++l){const s=C._SimplifyNegation(F[l].trim());if(m="true"!==s&&"false"!==s?"!"===s[0]?!I(s.substring(1)):I(s):"true"===s,!m){V="false";break}}if(m||"true"===V){m=!0;break}m="true"!==V&&"false"!==V?"!"===V[0]?!I(V.substring(1)):I(V):"true"===V}return m?"true":"false"}static _SimplifyNegation(V){return"!true"===(V=(V=V.replace(/^[\s!]+/,(V=>(V=V.replace(/[\s]/g,(()=>""))).length%2?"!":""))).trim())?V="false":"!false"===V&&(V="true"),V}}class l{static EnableFor(V){V._tags=V._tags||{},V.hasTags=()=>l.HasTags(V),V.addTags=I=>l.AddTagsTo(V,I),V.removeTags=I=>l.RemoveTagsFrom(V,I),V.matchesTagsQuery=I=>l.MatchesQuery(V,I)}static DisableFor(V){delete V._tags,delete V.hasTags,delete V.addTags,delete V.removeTags,delete V.matchesTagsQuery}static HasTags(V){if(!V._tags)return!1;const I=V._tags;for(const m in I)if(Object.prototype.hasOwnProperty.call(I,m))return!0;return!1}static GetTags(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!V._tags)return null;if(I){const I=[];for(const m in V._tags)Object.prototype.hasOwnProperty.call(V._tags,m)&&!0===V._tags[m]&&I.push(m);return I.join(" ")}return V._tags}static AddTagsTo(V,I){if(!I)return;if("string"!==typeof I)return;const m=I.split(" ");for(const C of m)l._AddTagTo(V,C)}static _AddTagTo(V,I){""!==(I=I.trim())&&"true"!==I&&"false"!==I&&(I.match(/[\s]/)||I.match(/^([!]|([|]|[&]){2})/)||(l.EnableFor(V),V._tags[I]=!0))}static RemoveTagsFrom(V,I){if(!l.HasTags(V))return;const m=I.split(" ");for(const C in m)l._RemoveTagFrom(V,m[C])}static _RemoveTagFrom(V,I){delete V._tags[I]}static MatchesQuery(V,I){return void 0===I||(""===I?l.HasTags(V):C.Eval(I,(I=>l.HasTags(V)&&V._tags[I])))}}},11514:(V,I,m)=>{m.d(I,{c:()=>D,e:()=>x,f:()=>c,j:()=>H,n:()=>n});var C=m(11518),l=m(11520),s=m(11206),F=m(11530),k=m(11136),j=m(11048),E=m(11297),K=m(11533),Y=m(11428);class X extends K.f{_gatherImports(V,I){V?(this._webGPUReady=!0,I.push(Promise.all([m.e(36).then(m.bind(m,13699))]))):I.push(Promise.all([m.e(37).then(m.bind(m,13706))])),super._gatherImports(V,I)}constructor(V){super({...arguments.length>2?arguments[2]:void 0,name:V,rF:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||Y.c.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:X.FragmentUrl})}}X.FragmentUrl="pass";class O extends K.f{_gatherImports(V,I){V?(this._webGPUReady=!0,I.push(Promise.all([m.e(43).then(m.bind(m,13746))]))):I.push(Promise.all([m.e(44).then(m.bind(m,13752))])),super._gatherImports(V,I)}constructor(V){super({...arguments.length>2?arguments[2]:void 0,name:V,rF:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||Y.c.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:O.FragmentUrl,defines:"#define POSITIVEX"}),this._face=0}get face(){return this._face}set face(V){if(!(V<0||V>5))switch(this._face=V,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ")}}}O.FragmentUrl="passCube";var v=m(11214);class N extends F.e{getClassName(){return"PassPostProcess"}constructor(V,I){let m=arguments.length>4?arguments[4]:void 0;const C={size:"number"===typeof I?I:void 0,camera:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,samplingMode:arguments.length>3?arguments[3]:void 0,rF:m,reusable:arguments.length>5?arguments[5]:void 0,textureType:arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,blockCompilation:arguments.length>7&&void 0!==arguments[7]&&arguments[7],...I};super(V,X.FragmentUrl,{effectWrapper:"number"!==typeof I&&I.effectWrapper?void 0:new X(V,m,C),...C})}static _Parse(V,I,m,C){return E.d.Parse((()=>new N(V.name,V.options,I,V.renderTargetSamplingMode,V._engine,V.reusable)),V,m,C)}}(0,j.h)("BABYLON.PassPostProcess",N);class t extends F.e{get face(){return this._effectWrapper.face}set face(V){this._effectWrapper.face=V}getClassName(){return"PassCubePostProcess"}constructor(V,I){let m=arguments.length>4?arguments[4]:void 0;const C={size:"number"===typeof I?I:void 0,camera:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,samplingMode:arguments.length>3?arguments[3]:void 0,rF:m,reusable:arguments.length>5?arguments[5]:void 0,textureType:arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,blockCompilation:arguments.length>7&&void 0!==arguments[7]&&arguments[7],...I};super(V,X.FragmentUrl,{effectWrapper:"number"!==typeof I&&I.effectWrapper?void 0:new O(V,m,C),...C})}static _Parse(V,I,m,C){return E.d.Parse((()=>new t(V.name,V.options,I,V.renderTargetSamplingMode,V._engine,V.reusable)),V,m,C)}}function D(V,I,m,C,l,s,k,j){const E=I.getEngine();return I.isReady=!1,l=l??I.samplingMode,C=C??I.type,s=s??I.format,k=k??I.width,j=j??I.height,-1===C&&(C=0),new Promise((K=>{const Y=new F.e("postprocess",V,null,null,1,null,l,E,!1,void 0,C,void 0,null,!1,s);Y.externalTextureSamplerBinding=!0;const X=E.createRenderTargetTexture({width:k,height:j},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:l,type:C,format:s});Y.onEffectCreatedObservable.addOnce((V=>{V.executeWhenCompiled((()=>{Y.onApply=V=>{V._bindTexture("textureSampler",I),V.setFloat2("scale",1,1)},m.postProcessManager.directRender([Y],X,!0),E.restoreDefaultFramebuffer(),E._releaseTexture(I),Y&&Y.dispose(),X._swapAndDie(I),I.type=C,I.format=5,I.isReady=!0,K(I)}))}))}))}let b,T;function n(V){b||(b=new Float32Array(1),T=new Int32Array(b.buffer)),b[0]=V;const I=T[0];let m=I>>16&32768,C=I>>12&2047;const l=I>>23&255;return l<103?m:l>142?(m|=31744,m|=(255==l?0:1)&&8388607&I,m):l<113?(C|=2048,m|=(C>>114-l)+(C>>113-l&1),m):(m|=l-112<<10|C>>1,m+=1&C,m)}function x(V){const I=(32768&V)>>15,m=(31744&V)>>10,C=1023&V;return 0===m?(I?-1:1)*Math.pow(2,-14)*(C/Math.pow(2,10)):31==m?C?NaN:1/0*(I?-1:1):(I?-1:1)*Math.pow(2,m-15)*(1+C/Math.pow(2,10))}(0,s.d)([(0,v.B)()],t.prototype,"face",null),k.b._RescalePostProcessFactory=V=>new N("rescale",1,null,2,V,!1,0);const S=async(V,I,s,k,j)=>{const E=V.cV(),K=E.getEngine();let Y;if(K.isWebGPU?V.isCube?await m.e(40).then(m.bind(m,13729)):await m.e(41).then(m.bind(m,13732)):V.isCube?await m.e(38).then(m.bind(m,13714)):await m.e(39).then(m.bind(m,13720)),V.isCube){const V=["#define POSITIVEX","#define NEGATIVEX","#define POSITIVEY","#define NEGATIVEY","#define POSITIVEZ","#define NEGATIVEZ"];Y=new F.e("lodCube","lodCube",{uniforms:["lod","gamma"],samplingMode:C.e.NEAREST_NEAREST_MIPNEAREST,rF:K,defines:V[k],shaderLanguage:K.isWebGPU?1:0})}else Y=new F.e("lod","lod",{uniforms:["lod","gamma"],samplingMode:C.e.NEAREST_NEAREST_MIPNEAREST,rF:K,shaderLanguage:K.isWebGPU?1:0});await new Promise((V=>{Y.onEffectCreatedObservable.addOnce((I=>{I.executeWhenCompiled((()=>{V(0)}))}))}));const X=new l.c("temp",{width:I,height:s},E,!1);Y.onApply=function(I){I.setTexture("textureSampler",V),I.setFloat("lod",j),I.setInt("gamma",V.gammaSpace?1:0)};const O=V.getInternalTexture();try{if(X.renderTarget&&O){const m=O.samplingMode;0!==j?V.updateSamplingMode(C.e.NEAREST_NEAREST_MIPNEAREST):V.updateSamplingMode(C.e.NEAREST_NEAREST),E.postProcessManager.directRender([Y],X.renderTarget,!0),V.updateSamplingMode(m);const l=await K.readPixels(0,0,I,s),F=new Uint8Array(l.buffer,0,l.byteLength);return K.unBindFramebuffer(X.renderTarget),F}throw Error("Render to texture failed.")}finally{X.dispose(),Y.dispose()}};async function c(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return!V.isReady()&&V._texture&&await new Promise(((I,m)=>{null!==V._texture?V._texture.onLoadedObservable.addOnce((()=>{I(0)})):m(0)})),await S(V,I,m,C,l)}const H={CreateResizedCopy:function(V,I,m){let s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const F=V.cV(),k=F.getEngine(),j=new l.c("resized"+V.name,{width:I,height:m},F,!V.noMipmap,!0,V._texture.type,!1,V.samplingMode,!1);j.wrapU=V.wrapU,j.wrapV=V.wrapV,j.uOffset=V.uOffset,j.vOffset=V.vOffset,j.uScale=V.uScale,j.vScale=V.vScale,j.uAng=V.uAng,j.vAng=V.vAng,j.wAng=V.wAng,j.coordinatesIndex=V.coordinatesIndex,j.level=V.level,j.anisotropicFilteringLevel=V.anisotropicFilteringLevel,j._texture.isReady=!1,V.wrapU=C.e.CLAMP_ADDRESSMODE,V.wrapV=C.e.CLAMP_ADDRESSMODE;const E=new N("pass",1,null,s?C.e.BILINEAR_SAMPLINGMODE:C.e.NEAREST_SAMPLINGMODE,k,!1,0);return E.externalTextureSamplerBinding=!0,E.onEffectCreatedObservable.addOnce((I=>{I.executeWhenCompiled((()=>{E.onApply=function(I){I.setTexture("textureSampler",V)};const I=j.renderTarget;I&&(F.postProcessManager.directRender([E],I),k.unBindFramebuffer(I),j.disposeFramebufferObjects(),E.dispose(),j.getInternalTexture().isReady=!0)}))})),j},ApplyPostProcess:D,ToHalfFloat:n,FromHalfFloat:x,GetTextureDataAsync:c}},11129:(V,I,m)=>{m.d(I,{e:()=>l,i:()=>F});let C=[];class l{static SetImmediate(V){0===C.length&&setTimeout((()=>{const V=C;C=[];for(const I of V)I()}),1),C.push(V)}}function s(V,I,m){try{if(V())return I(),!0}catch(C){return null===m||void 0===m||m(C),!0}return!1}const F=function(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,F=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&s(V,I,m))return null;const k=setInterval((()=>{s(V,I,m)?clearInterval(k):(l-=C,l<0&&(clearInterval(k),null===m||void 0===m||m(new Error("Operation timed out after maximum retries. "+(F||"")),!0)))}),C);return()=>clearInterval(k)}},11193:(V,I,m)=>{function C(V){let I=1;do{I*=2}while(I<V);return I===V}function l(V,I,m){return V*(1-m)+I*m}function s(V){const I=F(V),m=k(V);return I-V>V-m?m:I}function F(V){return V--,V|=V>>1,V|=V>>2,V|=V>>4,V|=V>>8,V|=V>>16,++V}function k(V){return V|=V>>1,V|=V>>2,V|=V>>4,V|=V>>8,(V|=V>>16)-(V>>1)}function j(V,I){let m;switch(arguments.length>2&&void 0!==arguments[2]?arguments[2]:2){case 1:m=k(V);break;case 2:m=s(V);break;default:m=F(V)}return Math.min(m,I)}m.d(I,{e:()=>k,h:()=>j,l:()=>C,p:()=>l,s:()=>s})},11076:(V,I,m)=>{m.d(I,{c:()=>D,d:()=>t});var C=m(11067),l=m(11081),s=m(11085),F=m(11089),k=m(11091),j=m(11095),E=m(11099),K=m(11061),Y=m(11102),X=m(11129),O=m(11181),v=m(11188),N=m(11193);class t{static get BaseUrl(){return Y.f.BaseUrl}static set BaseUrl(V){Y.f.BaseUrl=V}static get CleanUrl(){return Y.f.CleanUrl}static set CleanUrl(V){Y.f.CleanUrl=V}static IsAbsoluteUrl(V){return 0===V.indexOf("//")||-1!==V.indexOf("://")&&(-1!==V.indexOf(".")&&(-1!==V.indexOf("/")&&(!(V.indexOf(":")>V.indexOf("/"))&&(V.indexOf("://")<V.indexOf(".")||(0===V.indexOf("data:")||0===V.indexOf("blob:"))))))}static set ScriptBaseUrl(V){Y.f.ScriptBaseUrl=V}static get ScriptBaseUrl(){return Y.f.ScriptBaseUrl}static set CDNBaseUrl(V){t.ScriptBaseUrl=V,t.AssetBaseUrl=V}static set ScriptPreprocessUrl(V){Y.f.ScriptPreprocessUrl=V}static get ScriptPreprocessUrl(){return Y.f.ScriptPreprocessUrl}static get DefaultRetryStrategy(){return Y.f.DefaultRetryStrategy}static set DefaultRetryStrategy(V){Y.f.DefaultRetryStrategy=V}static get CorsBehavior(){return Y.f.CorsBehavior}static set CorsBehavior(V){Y.f.CorsBehavior=V}static get UseFallbackTexture(){return K.c.UseFallbackTexture}static set UseFallbackTexture(V){K.c.UseFallbackTexture=V}static get RegisteredExternalClasses(){return O.c.RegisteredExternalClasses}static set RegisteredExternalClasses(V){O.c.RegisteredExternalClasses=V}static get fallbackTexture(){return K.c.FallbackTexture}static set fallbackTexture(V){K.c.FallbackTexture=V}static FetchToRef(V,I,m,C,l,s){const F=4*((Math.abs(V)*m%m|0)+(Math.abs(I)*C%C|0)*m);s.r=l[F]/255,s.g=l[F+1]/255,s.b=l[F+2]/255,s.a=l[F+3]/255}static Mix(V,I,m){return 0}static Instantiate(V){return O.c.Instantiate(V)}static SetImmediate(V){X.e.SetImmediate(V)}static IsExponentOfTwo(V){return!0}static FloatRound(V){return Math.fround(V)}static GetFilename(V){const I=V.lastIndexOf("/");return I<0?V:V.substring(I+1)}static GetFolderPath(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const m=V.lastIndexOf("/");return m<0?I?V:"":V.substring(0,m+1)}static ToDegrees(V){return 180*V/Math.PI}static ToRadians(V){return V*Math.PI/180}static SmoothAngleChange(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9;const C=this.ToRadians(V),l=this.ToRadians(I);return this.ToDegrees(Math.atan2((1-m)*Math.sin(l)+m*Math.sin(C),(1-m)*Math.cos(l)+m*Math.cos(C)))}static MakeArray(V,I){return!0===I||void 0!==V&&null!=V?Array.isArray(V)?V:[V]:null}static GetPointerPrefix(V){return(0,l.o)()&&!window.PointerEvent?"mouse":"pointer"}static SetCorsBehavior(V,I){(0,Y.E)(V,I)}static SetReferrerPolicyBehavior(V,I){I.referrerPolicy=V}static get PreprocessUrl(){return Y.f.PreprocessUrl}static set PreprocessUrl(V){Y.f.PreprocessUrl=V}static LoadImage(V,I,m,C,l,s){return(0,Y.u)(V,I,m,C,l,s)}static LoadFile(V,I,m,C,l,s){return(0,Y.r)(V,I,m,C,l,s)}static async LoadFileAsync(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return await new Promise(((m,C)=>{(0,Y.r)(V,(V=>{m(V)}),void 0,void 0,I,((V,I)=>{C(I)}))}))}static GetAssetUrl(V){if(!V)return"";if(t.AssetBaseUrl&&V.startsWith(t._DefaultAssetsUrl)){const I="/"===t.AssetBaseUrl[t.AssetBaseUrl.length-1]?t.AssetBaseUrl.substring(0,t.AssetBaseUrl.length-1):t.AssetBaseUrl;return V.replace(t._DefaultAssetsUrl,I)}return V}static GetBabylonScriptURL(V,I){if(!V)return"";if(t.ScriptBaseUrl&&V.startsWith(t._DefaultCdnUrl)){const I="/"===t.ScriptBaseUrl[t.ScriptBaseUrl.length-1]?t.ScriptBaseUrl.substring(0,t.ScriptBaseUrl.length-1):t.ScriptBaseUrl;V=V.replace(t._DefaultCdnUrl,I)}return V=t.ScriptPreprocessUrl(V),I&&(V=t.GetAbsoluteUrl(V)),V}static LoadBabylonScript(V,I,m,C){V=t.GetBabylonScriptURL(V),t.LoadScript(V,I,m)}static async LoadBabylonScriptAsync(V){return V=t.GetBabylonScriptURL(V),await t.LoadScriptAsync(V)}static LoadScript(V,I,m,C){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("function"===typeof importScripts){try{importScripts(V),I&&I()}catch(j){null===m||void 0===m||m(`Unable to load script '${V}' in worker`,j)}return}if(!(0,l.o)())return void(null===m||void 0===m||m(`Cannot load script '${V}' outside of a window or a worker`));const F=document.getElementsByTagName("head")[0],k=document.createElement("script");s?(k.setAttribute("type","module"),k.innerText=V):(k.setAttribute("type","text/javascript"),k.setAttribute("src",V)),C&&(k.id=C),k.onload=()=>{I&&I()},k.onerror=I=>{m&&m(`Unable to load script '${V}'`,I)},F.appendChild(k)}static async LoadScriptAsync(V,I){return await new Promise(((m,C)=>{this.LoadScript(V,(()=>{m()}),((V,I)=>{C(I||new Error(V))}),I)}))}static ReadFileAsDataURL(V,I,m){const l=new FileReader,s={onCompleteObservable:new C.e,abort:()=>l.abort()};return l.onloadend=()=>{s.onCompleteObservable.notifyObservers(s)},l.onload=V=>{I(V.target.result)},l.onprogress=m,l.readAsDataURL(V),s}static ReadFile(V,I,m,C,l){return(0,Y.x)(V,I,m,C,l)}static FileAsURL(V){const I=new Blob([V]);return window.URL.createObjectURL(I)}static Format(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return V.toFixed(I)}static DeepCopy(V,I,m,C){F.e.DeepCopy(V,I,m,C)}static IsEmpty(V){for(const I in V)if(Object.prototype.hasOwnProperty.call(V,I))return!1;return!0}static RegisterTopRootEvents(V,I){for(let C=0;C<I.length;C++){const l=I[C];V.addEventListener(l.name,l.handler,!1);try{window.parent&&window.parent.addEventListener(l.name,l.handler,!1)}catch(m){}}}static UnregisterTopRootEvents(V,I){for(let C=0;C<I.length;C++){const l=I[C];V.removeEventListener(l.name,l.handler);try{V.parent&&V.parent.removeEventListener(l.name,l.handler)}catch(m){}}}static async DumpFramebuffer(V,I,m,C){throw(0,j.c)("DumpTools")}static DumpData(V,I,m,C){throw(0,j.c)("DumpTools")}static async DumpDataAsync(V,I,m){throw(0,j.c)("DumpTools")}static _IsOffScreenCanvas(V){return void 0!==V.convertToBlob}static ToBlob(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",C=arguments.length>3?arguments[3]:void 0;t._IsOffScreenCanvas(V)||V.toBlob||(V.toBlob=function(V,I,m){setTimeout((()=>{const C=atob(this.toDataURL(I,m).split(",")[1]),l=C.length,s=new Uint8Array(l);for(let V=0;V<l;V++)s[V]=C.charCodeAt(V);V(new Blob([s]))}))}),t._IsOffScreenCanvas(V)?V.convertToBlob({type:m,quality:C}).then((V=>I(V))):V.toBlob((function(V){I(V)}),m,C)}static DownloadBlob(V,I){if("download"in document.createElement("a")){if(!I){const V=new Date;I="screenshot_"+((V.getFullYear()+"-"+(V.getMonth()+1)).slice(2)+"-"+V.getDate()+"_"+V.getHours()+"-"+("0"+V.getMinutes()).slice(-2))+".png"}t.Download(V,I)}else if(V&&"undefined"!==typeof URL){const I=URL.createObjectURL(V),m=window.open("");if(!m)return;const C=m.document.createElement("img");C.onload=function(){URL.revokeObjectURL(I)},C.src=I,m.document.body.appendChild(C)}}static EncodeScreenshotCanvasData(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",C=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0;if("string"!==typeof C&&I){if(I){if(t._IsOffScreenCanvas(V))return void V.convertToBlob({type:m,quality:l}).then((V=>{const m=new FileReader;m.readAsDataURL(V),m.onloadend=()=>{const V=m.result;I(V)}}));const C=V.toDataURL(m,l);I(C)}}else this.ToBlob(V,(function(V){V&&t.DownloadBlob(V,C),I&&I("")}),m,l)}static Download(V,I){if("undefined"===typeof URL)return;const m=window.URL.createObjectURL(V),C=document.createElement("a");document.body.appendChild(C),C.style.display="none",C.href=m,C.download=I,C.addEventListener("click",(()=>{C.parentElement&&C.parentElement.removeChild(C)})),C.click(),window.URL.revokeObjectURL(m)}static BackCompatCameraNoPreventDefault(V){return"boolean"===typeof V[0]?V[0]:"boolean"===typeof V[1]&&V[1]}static CreateScreenshot(V,I,m,C){throw(0,j.c)("ScreenshotTools")}static async CreateScreenshotAsync(V,I,m){throw(0,j.c)("ScreenshotTools")}static CreateScreenshotUsingRenderTarget(V,I,m,C){throw(0,j.c)("ScreenshotTools")}static async CreateScreenshotUsingRenderTargetAsync(V,I,m){throw(0,j.c)("ScreenshotTools")}static RandomId(){return(0,v.d)()}static IsBase64(V){return(0,Y.l)(V)}static DecodeBase64(V){return(0,Y.b)(V)}static get errorsCount(){return s.d.errorsCount}static Log(V){s.d.Log(V)}static Warn(V){s.d.Warn(V)}static Error(V){s.d.Error(V)}static get LogCache(){return s.d.LogCache}static ClearLogCache(){s.d.ClearLogCache()}static set LogLevels(V){s.d.LogLevels=V}static set PerformanceLogLevel(V){return(V&t.PerformanceUserMarkLogLevel)===t.PerformanceUserMarkLogLevel?(t.StartPerformanceCounter=t._StartUserMark,void(t.EndPerformanceCounter=t._EndUserMark)):(V&t.PerformanceConsoleLogLevel)===t.PerformanceConsoleLogLevel?(t.StartPerformanceCounter=t._StartPerformanceConsole,void(t.EndPerformanceCounter=t._EndPerformanceConsole)):(t.StartPerformanceCounter=t._StartPerformanceCounterDisabled,void(t.EndPerformanceCounter=t._EndPerformanceCounterDisabled))}static _StartPerformanceCounterDisabled(V,I){}static _EndPerformanceCounterDisabled(V,I){}static _StartUserMark(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!t._Performance){if(!(0,l.o)())return;t._Performance=window.performance}I&&t._Performance.mark&&t._Performance.mark(V+"-Begin")}static _EndUserMark(V){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&t._Performance.mark&&(t._Performance.mark(V+"-End"),t._Performance.measure(V,V+"-Begin",V+"-End"))}static _StartPerformanceConsole(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];I&&(t._StartUserMark(V,I),console.time&&console.time(V))}static _EndPerformanceConsole(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];I&&(t._EndUserMark(V,I),console.timeEnd(V))}static get Now(){return k.d.Now}static GetClassName(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=null;if(!I&&V.getClassName)m=V.getClassName();else{if(V instanceof Object){m=(I?V:Object.getPrototypeOf(V)).constructor.__bjsclassName__}m||(m=typeof V)}return m}static First(V,I){for(const m of V)if(I(m))return m;return null}static getFullClassName(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=null,C=null;if(!I&&V.getClassName)m=V.getClassName();else{if(V instanceof Object){const l=I?V:Object.getPrototypeOf(V);m=l.constructor.__bjsclassName__,C=l.constructor.__bjsmoduleName__}m||(m=typeof V)}return m?(null!=C?C+".":"")+m:null}static async DelayAsync(V){await new Promise((I=>{setTimeout((()=>{I()}),V)}))}static IsSafari(){return!!(0,l.l)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}t.AssetBaseUrl="",t.UseCustomRequestHeaders=!1,t.CustomRequestHeaders=E.c.CustomRequestHeaders,t.GetDOMTextContent=l.e,t._DefaultCdnUrl="https://cdn.babylonjs.com",t._DefaultAssetsUrl="https://assets.babylonjs.com/core",t.GetAbsoluteUrl="object"===typeof document?V=>{const I=document.createElement("a");return I.href=V,I.href}:"function"===typeof URL&&"object"===typeof location?V=>new URL(V,location.origin).href:()=>{throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},t.NoneLogLevel=s.d.NoneLogLevel,t.MessageLogLevel=s.d.MessageLogLevel,t.WarningLogLevel=s.d.WarningLogLevel,t.ErrorLogLevel=s.d.ErrorLogLevel,t.AllLogLevel=s.d.AllLogLevel,t.IsWindowObjectExist=l.o,t.PerformanceNoneLogLevel=0,t.PerformanceUserMarkLogLevel=1,t.PerformanceConsoleLogLevel=2,t.StartPerformanceCounter=t._StartPerformanceCounterDisabled,t.EndPerformanceCounter=t._EndPerformanceCounterDisabled;class D{constructor(V,I,m){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.iterations=V,this.index=C-1,this._done=!1,this._fn=I,this._successCallback=m}executeNext(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}breakLoop(){this._done=!0,this._successCallback()}static Run(V,I,m){const C=new D(V,I,m,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return C.executeNext(),C}static SyncAsyncForLoop(V,I,m,C,l){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return D.Run(Math.ceil(V/I),(C=>{l&&l()?C.breakLoop():setTimeout((()=>{for(let s=0;s<I;++s){const F=C.index*I+s;if(F>=V)break;if(m(F),l&&l()){C.breakLoop();break}}C.executeNext()}),s)}),C)}}t.Mix=N.p,t.IsExponentOfTwo=N.l,K.c.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},11048:(V,I,m)=>{m.d(I,{d:()=>s,h:()=>l});const C={};function l(V,I){C[V]=I}function s(V){return C[V]}},11639:(V,I,m)=>{m.d(I,{d:()=>C});class C{static get UniqueId(){const V=this._UniqueIdCounter;return this._UniqueIdCounter++,V}}C._UniqueIdCounter=1},11099:(V,I,m)=>{m.d(I,{c:()=>C});class C{constructor(){this._xhr="undefined"!==typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(C.CustomRequestHeaders).length>0||C.CustomRequestModifiers.length>0}get requestURL(){return this._requestURL}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const V in C.CustomRequestHeaders){const I=C.CustomRequestHeaders[V];I&&this._xhr.setRequestHeader(V,I)}}_shouldSkipRequestModifications(V){return C.SkipRequestModificationForBabylonCDN&&(V.includes("preview.babylonjs.com")||V.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(V){this._xhr.onprogress=V}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(V){this._xhr.responseType=V}get timeout(){return this._xhr.timeout}set timeout(V){this._xhr.timeout=V}addEventListener(V,I,m){this._xhr.addEventListener(V,I,m)}removeEventListener(V,I,m){this._xhr.removeEventListener(V,I,m)}abort(){this._xhr.abort()}send(V){C.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(V)}open(V,I){for(const m of C.CustomRequestModifiers){if(this._shouldSkipRequestModifications(I))return;I=m(this._xhr,I)||I}I=(I=I.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=I,this._xhr.open(V,I,!0)}setRequestHeader(V,I){this._xhr.setRequestHeader(V,I)}getResponseHeader(V){return this._xhr.getResponseHeader(V)}}C.CustomRequestHeaders={},C.CustomRequestModifiers=new Array,C.SkipRequestModificationForBabylonCDN=!0},11757:(V,I,m)=>{m.d(I,{b:()=>l});class C{constructor(V){this._pendingActions=new Array,this._workerInfos=V.map((V=>({workerPromise:Promise.resolve(V),idle:!0})))}dispose(){for(const V of this._workerInfos)V.workerPromise.then((V=>{V.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(V){this._executeOnIdleWorker(V)||this._pendingActions.push(V)}_executeOnIdleWorker(V){for(const I of this._workerInfos)if(I.idle)return this._execute(I,V),!0;return!1}_execute(V,I){V.idle=!1,V.workerPromise.then((m=>{I(m,(()=>{const I=this._pendingActions.shift();I?this._execute(V,I):V.idle=!0}))}))}}class l extends C{constructor(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.DefaultOptions;super([]),this._maxWorkers=V,this._createWorkerAsync=I,this._options=m}push(V){if(!this._executeOnIdleWorker(V))if(this._workerInfos.length<this._maxWorkers){const I={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(I),this._execute(I,V)}else this._pendingActions.push(V)}_execute(V,I){V.timeoutId&&(clearTimeout(V.timeoutId),delete V.timeoutId),super._execute(V,((m,C)=>{I(m,(()=>{C(),V.idle&&(V.timeoutId=setTimeout((()=>{V.workerPromise.then((V=>{V.terminate()}));const I=this._workerInfos.indexOf(V);-1!==I&&this._workerInfos.splice(I,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}l.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},11705:(V,I,m)=>{m.d(I,{e:()=>K});var C=m(11206),l=m(11067),s=m(11061),F=m(11233),k=m(11214),j=m(11297),E=m(11048);class K{get influence(){return this._influence}set influence(V){if(this._influence===V)return;const I=this._influence;this._influence=V,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===I||0===V)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(V){this._animationPropertiesOverride=V}constructor(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=V,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uv2s=null,this._colors=null,this._uniqueId=0,this.onInfluenceChanged=new l.e,this._onDataLayoutChanged=new l.e,this._animationPropertiesOverride=null,this.id=V,this._scene=m||s.c.LastCreatedScene,this.influence=I,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}get hasUV2s(){return!!this._uv2s}get hasColors(){return!!this._colors}get vertexCount(){return this._positions?this._positions.length/3:this._normals?this._normals.length/3:this._tangents?this._tangents.length/3:this._uvs?this._uvs.length/2:this._uv2s?this._uv2s.length/2:this._colors?this._colors.length/4:0}setPositions(V){const I=this.hasPositions;this._positions=V,I!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(V){const I=this.hasNormals;this._normals=V,I!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(V){const I=this.hasTangents;this._tangents=V,I!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(V){const I=this.hasUVs;this._uvs=V,I!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}setUV2s(V){const I=this.hasUV2s;this._uv2s=V,I!==this.hasUV2s&&this._onDataLayoutChanged.notifyObservers(void 0)}getUV2s(){return this._uv2s}setColors(V){const I=this.hasColors;this._colors=V,I!==this.hasColors&&this._onDataLayoutChanged.notifyObservers(void 0)}getColors(){return this._colors}clone(){const V=j.d.Clone((()=>new K(this.name,this.influence,this._scene)),this);return V._positions=this._positions,V._normals=this._normals,V._tangents=this._tangents,V._uvs=this._uvs,V._uv2s=this._uv2s,V._colors=this._colors,V}serialize(){const V={};return V.name=this.name,V.influence=this.influence,V.yV=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(V.id=this.id),this.hasNormals&&(V.zV=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(V.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(V.BV=Array.prototype.slice.call(this.getUVs())),this.hasUV2s&&(V.uv2s=Array.prototype.slice.call(this.getUV2s())),this.hasColors&&(V.ZV=Array.prototype.slice.call(this.getColors())),j.d.AppendSerializedAnimations(this,V),V}getClassName(){return"MorphTarget"}static Parse(V,I){const m=new K(V.name,V.influence);if(m.setPositions(V.yV),null!=V.id&&(m.id=V.id),V.zV&&m.setNormals(V.zV),V.tangents&&m.setTangents(V.tangents),V.BV&&m.setUVs(V.BV),V.uv2s&&m.setUV2s(V.uv2s),V.ZV&&m.setColors(V.ZV),V.animations){for(let I=0;I<V.animations.length;I++){const C=V.animations[I],l=(0,E.d)("BABYLON.Animation");l&&m.animations.push(l.Parse(C))}V.autoAnimate&&I&&I.beginAnimation(m,V.autoAnimateFrom,V.autoAnimateTo,V.autoAnimateLoop,V.autoAnimateSpeed||1)}return m}static FromMesh(V,I,m){I||(I=V.name);const C=new K(I,m,V.cV());return C.setPositions(V.getVerticesData(F.e.PositionKind)),V.isVerticesDataPresent(F.e.NormalKind)&&C.setNormals(V.getVerticesData(F.e.NormalKind)),V.isVerticesDataPresent(F.e.TangentKind)&&C.setTangents(V.getVerticesData(F.e.TangentKind)),V.isVerticesDataPresent(F.e.UVKind)&&C.setUVs(V.getVerticesData(F.e.UVKind)),V.isVerticesDataPresent(F.e.UV2Kind)&&C.setUV2s(V.getVerticesData(F.e.UV2Kind)),V.isVerticesDataPresent(F.e.ColorKind)&&C.setColors(V.getVerticesData(F.e.ColorKind)),C}}(0,C.d)([(0,k.B)()],K.prototype,"id",void 0)},11530:(V,I,m)=>{m.d(I,{e:()=>v});var C=m(11206),l=m(11389),s=m(11067),F=m(11040),k=m(11143),j=m(11214),E=m(11297),K=m(11048),Y=m(11136),X=m(11193),O=m(11533);Y.b.prototype.setTextureFromPostProcess=function(V,I,m){var C;let l=null;I&&(I._forcedOutputTexture?l=I._forcedOutputTexture:I._textures.data[I._currentRenderTextureInd]&&(l=I._textures.data[I._currentRenderTextureInd])),this._bindTexture(V,(null===(C=l)||void 0===C?void 0:C.texture)??null,m)},Y.b.prototype.setTextureFromPostProcessOutput=function(V,I,m){var C;this._bindTexture(V,(null===I||void 0===I||null===(C=I._outputTexture)||void 0===C?void 0:C.texture)??null,m)},k.c.prototype.setTextureFromPostProcess=function(V,I){this._engine.setTextureFromPostProcess(this._samplers[V],I,V)},k.c.prototype.setTextureFromPostProcessOutput=function(V,I){this._engine.setTextureFromPostProcessOutput(this._samplers[V],I,V)};class v{static get ForceGLSL(){return O.f.ForceGLSL}static set ForceGLSL(V){O.f.ForceGLSL=V}static RegisterShaderCodeProcessing(V,I){O.f.RegisterShaderCodeProcessing(V,I)}get name(){return this._effectWrapper.name}set name(V){this._effectWrapper.name=V}get alphaMode(){return this._effectWrapper.alphaMode}set alphaMode(V){this._effectWrapper.alphaMode=V}get samples(){return this._samples}set samples(V){this._samples=Math.min(V,this._engine.getCaps().maxMSAASamples),this._textures.forEach((V=>{V.setSamples(this._samples)}))}get shaderLanguage(){return this._shaderLanguage}getEffectName(){return this._fragmentUrl}set onActivate(V){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),V&&(this._onActivateObserver=this.onActivateObservable.add(V))}set onSizeChanged(V){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(V)}set onApply(V){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(V)}set onBeforeRender(V){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(V)}set onAfterRender(V){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(V)}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}set inputTexture(V){this._forcedOutputTexture=V}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}getCamera(){return this._camera}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.aF(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}constructor(V,I,m,C,k,j){var E;let K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,Y=arguments.length>7?arguments[7]:void 0,X=arguments.length>8?arguments[8]:void 0,N=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,t=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,D=arguments.length>11&&void 0!==arguments[11]?arguments[11]:"postprocess",b=arguments.length>12?arguments[12]:void 0,T=arguments.length>13&&void 0!==arguments[13]&&arguments[13],n=arguments.length>14&&void 0!==arguments[14]?arguments[14]:5,x=arguments.length>15?arguments[15]:void 0,S=arguments.length>16?arguments[16]:void 0;this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.FY=!0,this.forceAutoClearInAlphaMode=!1,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new l.g(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new F.k(1,1),this._texelSize=F.k.Zero(),this.onActivateObservable=new s.e,this.onSizeChangedObservable=new s.e,this.onApplyObservable=new s.e,this.onBeforeRenderObservable=new s.e,this.onAfterRenderObservable=new s.e,this.Ck=new s.e;let c,H=1,y=null;if(m&&!Array.isArray(m)){const V=m;m=V.uniforms??null,C=V.samplers??null,H=V.size??1,j=V.camera??null,K=V.samplingMode??1,Y=V.rF,X=V.reusable,N=Array.isArray(V.defines)?V.defines.join("\n"):V.defines??null,t=V.textureType??0,D=V.vertexUrl??"postprocess",b=V.indexParameters,T=V.blockCompilation??!1,n=V.textureFormat??5,x=V.shaderLanguage??0,y=V.uniformBuffers??null,S=V.extraInitializations,c=V.effectWrapper}else k&&(H="number"===typeof k?k:{width:k.width,height:k.height});if(this._useExistingThinPostProcess=!!c,this._effectWrapper=c??new O.f({name:V,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:I,rF:Y||(null===(E=j)||void 0===E?void 0:E.cV().getEngine()),uniforms:m,samplers:C,uniformBuffers:y,defines:N,vertexUrl:D,indexParameters:b,blockCompilation:!0,shaderLanguage:x,extraInitializations:void 0}),this.name=V,this.onEffectCreatedObservable=this._effectWrapper.onEffectCreatedObservable,null!=j?(this._camera=j,this._scene=j.cV(),j.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):Y&&(this._engine=Y,this._engine.postProcesses.push(this)),this._options=H,this.renderTargetSamplingMode=K||1,this._reusable=X||!1,this._textureType=t,this._textureFormat=n,this._shaderLanguage=x||0,this._samplers=C||[],-1===this._samplers.indexOf("textureSampler")&&this._samplers.push("textureSampler"),this._fragmentUrl=I,this._vertexUrl=D,this._parameters=m||[],-1===this._parameters.indexOf("scale")&&this._parameters.push("scale"),this._uniformBuffers=y||[],this._indexParameters=b,!this._useExistingThinPostProcess){this._webGPUReady=1===this._shaderLanguage;const V=[];this._gatherImports(this._engine.isWebGPU&&!v.ForceGLSL,V),this._effectWrapper._webGPUReady=this._webGPUReady,this._effectWrapper._postConstructor(T,N,S,V)}}_gatherImports(){let V=arguments.length>1?arguments[1]:void 0;arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this._webGPUReady?V.push(Promise.all([m.e(42).then(m.bind(m,13740))])):V.push(Promise.all([Promise.resolve().then(m.bind(m,11538))]))}getClassName(){return"PostProcess"}getEngine(){return this._engine}getEffect(){return this._effectWrapper.drawWrapper.effect}shareOutputWith(V){return this._disposeTextures(),this._shareOutputWithPostProcess=V,this}useOwnOutput(){0==this._textures.length&&(this._textures=new l.g(2)),this._shareOutputWithPostProcess=null}updateEffect(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,F=arguments.length>6?arguments[6]:void 0,k=arguments.length>7?arguments[7]:void 0;this._effectWrapper.updateEffect(V,I,m,C,l,s,F,k),this._postProcessDefines=Array.isArray(this._effectWrapper.options.defines)?this._effectWrapper.options.defines.join("\n"):this._effectWrapper.options.defines}isReusable(){return this._reusable}markTextureDirty(){this.width=-1}_createRenderTargetTexture(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let l=0;l<this._textureCache.length;l++)if(this._textureCache[l].texture.width===V.width&&this._textureCache[l].texture.height===V.height&&this._textureCache[l].postProcessChannel===m&&this._textureCache[l].texture._generateDepthBuffer===I.generateDepthBuffer&&this._textureCache[l].texture.samples===I.samples)return this._textureCache[l].texture;const C=this._engine.createRenderTargetTexture(V,I);return this._textureCache.push({texture:C,postProcessChannel:m,lastUsedRenderId:-1}),C}_flushTextureCache(){const V=this._renderId;for(let I=this._textureCache.length-1;I>=0;I--)if(V-this._textureCache[I].lastUsedRenderId>100){let V=!1;for(let m=0;m<this._textures.length;m++)if(this._textures.data[m]===this._textureCache[I].texture){V=!0;break}V||(this._textureCache[I].texture.dispose(),this._textureCache.splice(I,1))}}resize(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._textures.length>0&&this._textures.reset(),this.width=V,this.height=I;let s=null;if(m)for(let j=0;j<m._postProcesses.length;j++)if(null!==m._postProcesses[j]){s=m._postProcesses[j];break}const F={width:this.width,height:this.height},k={generateMipMaps:C,generateDepthBuffer:l||s===this,generateStencilBuffer:(l||s===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(F,k,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(F,k,1)),this._texelSize.aF(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}_getTarget(){let V;if(this._shareOutputWithPostProcess)V=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)V=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{let I;V=this.inputTexture;for(let m=0;m<this._textureCache.length;m++)if(this._textureCache[m].texture===V){I=this._textureCache[m];break}I&&(I.lastUsedRenderId=this._renderId)}return V}activate(V){var I,m;let C=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2?arguments[2]:void 0;const s=null===V||void 0!==V.cameraRigMode?V||this._camera:null,F=(null===s||void 0===s?void 0:s.cV())??V,k=F.getEngine(),j=k.getCaps().maxTextureSize,E=(C?C.width:this._engine.getRenderWidth(!0))*this._options|0,K=(C?C.height:this._engine.getRenderHeight(!0))*this._options|0;let Y=this._options.width||E,O=this._options.height||K;const v=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;let N=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){const V=k.currentViewport;V&&(Y*=V.width,O*=V.height)}(v||this.alwaysForcePOT)&&(this._options.width||(Y=k.needPOTTextures?(0,X.h)(Y,j,this.scaleMode):Y),this._options.height||(O=k.needPOTTextures?(0,X.h)(O,j,this.scaleMode):O)),this.width===Y&&this.height===O&&(N=this._getTarget())||this.resize(Y,O,s,v,l),this._textures.forEach((V=>{V.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(V,this.samples)})),this._flushTextureCache(),this._renderId++}return N||(N=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.aF(E/Y,K/O),this._engine.bindFramebuffer(N,0,E,K,this.forceFullscreenViewport)):(this._scaleRatio.aF(1,1),this._engine.bindFramebuffer(N,0,void 0,void 0,this.forceFullscreenViewport)),null===(I=(m=this._engine)._debugInsertMarker)||void 0===I||I.call(m,`post process ${this.name} input`),this.onActivateObservable.notifyObservers(s),this.FY&&(0===this.alphaMode||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:F.clearColor,F._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),N}get isSupported(){return this._effectWrapper.drawWrapper.effect.isSupported}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}isReady(){return this._effectWrapper.isReady()}apply(){if(!this._effectWrapper.isReady())return null;let V;var I;(this._engine.enableEffect(this._effectWrapper.drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),this._engine.setAlphaMode(this.alphaMode),V=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding)||this._effectWrapper.drawWrapper.effect._bindTexture("textureSampler",null===(I=V)||void 0===I?void 0:I.texture);return this._effectWrapper.drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effectWrapper.drawWrapper.effect),this._effectWrapper.bind(!0),this._effectWrapper.drawWrapper.effect}_disposeTextures(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())}_disposeTextureCache(){for(let V=this._textureCache.length-1;V>=0;V--)this._textureCache[V].texture.dispose();this._textureCache.length=0}setPrePassRenderer(V){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=V.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)}dispose(V){let I;if(V=V||this._camera,this._useExistingThinPostProcess||this._effectWrapper.dispose(),this._disposeTextures(),this._scene&&(I=this._scene.postProcesses.indexOf(this),-1!==I&&this._scene.postProcesses.splice(I,1)),this._parentContainer){const V=this._parentContainer.postProcesses.indexOf(this);V>-1&&this._parentContainer.postProcesses.splice(V,1),this._parentContainer=null}if(I=this._engine.postProcesses.indexOf(this),-1!==I&&this._engine.postProcesses.splice(I,1),this.Ck.notifyObservers(),V){if(V.detachPostProcess(this),I=V._postProcesses.indexOf(this),0===I&&V._postProcesses.length>0){const V=this._camera._getFirstPostProcess();V&&V.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}}serialize(){const V=E.d.Serialize(this),I=this.getCamera()||this._scene&&this._scene.activeCamera;return V.customType="BABYLON."+this.getClassName(),V.cameraId=I?I.id:null,V.reusable=this._reusable,V.textureType=this._textureType,V.fragmentUrl=this._fragmentUrl,V.parameters=this._parameters,V.samplers=this._samplers,V.uniformBuffers=this._uniformBuffers,V.options=this._options,V.defines=this._postProcessDefines,V.textureFormat=this._textureFormat,V.vertexUrl=this._vertexUrl,V.indexParameters=this._indexParameters,V}clone(){const V=this.serialize();V._engine=this._engine,V.cameraId=null;const I=v.Parse(V,this._scene,"");return I?(I.onActivateObservable=this.onActivateObservable.clone(),I.onSizeChangedObservable=this.onSizeChangedObservable.clone(),I.onApplyObservable=this.onApplyObservable.clone(),I.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),I.onAfterRenderObservable=this.onAfterRenderObservable.clone(),I._prePassEffectConfiguration=this._prePassEffectConfiguration,I):null}static Parse(V,I,m){const C=(0,K.d)(V.customType);if(!C||!C._Parse)return null;const l=I?I.getCameraById(V.cameraId):null;return C._Parse(V,l,I,m)}static _Parse(V,I,m,C){return E.d.Parse((()=>new v(V.name,V.fragmentUrl,V.parameters,V.samplers,V.options,I,V.renderTargetSamplingMode,V._engine,V.reusable,V.defines,V.textureType,V.vertexUrl,V.indexParameters,!1,V.textureFormat)),V,m,C)}}(0,C.d)([(0,j.B)()],v.prototype,"uniqueId",void 0),(0,C.d)([(0,j.B)()],v.prototype,"name",null),(0,C.d)([(0,j.B)()],v.prototype,"width",void 0),(0,C.d)([(0,j.B)()],v.prototype,"height",void 0),(0,C.d)([(0,j.B)()],v.prototype,"renderTargetSamplingMode",void 0),(0,C.d)([(0,j.f)()],v.prototype,"clearColor",void 0),(0,C.d)([(0,j.B)()],v.prototype,"FY",void 0),(0,C.d)([(0,j.B)()],v.prototype,"forceAutoClearInAlphaMode",void 0),(0,C.d)([(0,j.B)()],v.prototype,"alphaMode",null),(0,C.d)([(0,j.B)()],v.prototype,"alphaConstants",void 0),(0,C.d)([(0,j.B)()],v.prototype,"enablePixelPerfectMode",void 0),(0,C.d)([(0,j.B)()],v.prototype,"forceFullscreenViewport",void 0),(0,C.d)([(0,j.B)()],v.prototype,"scaleMode",void 0),(0,C.d)([(0,j.B)()],v.prototype,"alwaysForcePOT",void 0),(0,C.d)([(0,j.B)("samples")],v.prototype,"_samples",void 0),(0,C.d)([(0,j.B)()],v.prototype,"adaptScaleToCurrentViewport",void 0),(0,K.h)("BABYLON.PostProcess",v)},11524:(V,I,m)=>{m.d(I,{d:()=>s});var C=m(11233),l=m(11067);class s{constructor(V){this._vertexBuffers={},this.onBeforeRenderObservable=new l.e,this._scene=V}_prepareBuffers(){if(this._vertexBuffers[C.e.PositionKind])return;const V=[];V.push(1,1),V.push(-1,1),V.push(-1,-1),V.push(1,-1),this._vertexBuffers[C.e.PositionKind]=new C.e(this._scene.getEngine(),V,C.e.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const V=[];V.push(0),V.push(1),V.push(2),V.push(0),V.push(2),V.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(V)}_rebuild(){const V=this._vertexBuffers[C.e.PositionKind];V&&(V._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const m=this._scene.activeCamera;return!!m&&(I=I||m._postProcesses.filter((V=>null!=V)),!(!I||0===I.length||!this._scene.postProcessesEnabled)&&(I[0].activate(m,V,null!==I&&void 0!==I),!0))}directRender(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:V.length;const k=this._scene.getEngine();for(let E=0;E<F;E++){var j;if(E<V.length-1)V[E+1].activate(this._scene.activeCamera||this._scene,null===I||void 0===I?void 0:I.texture);else I?k.bindFramebuffer(I,C,void 0,void 0,m,l):s||k.restoreDefaultFramebuffer(),null===(j=k._debugInsertMarker)||void 0===j||j.call(k,`post process ${V[E].name} output`);const F=V[E],K=F.apply();K&&(F.onBeforeRenderObservable.notifyObservers(K),this._prepareBuffers(),k.bindBuffers(this._vertexBuffers,this._indexBuffer,K),k.drawElementsType(0,0,6),F.onAfterRenderObservable.notifyObservers(K))}k.setDepthBuffer(!0),k.setDepthWrite(!0)}_finalizeFrame(V,I,m,C){let l=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const s=this._scene.activeCamera;if(!s)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(C=C||s._postProcesses.filter((V=>null!=V))).length||!this._scene.postProcessesEnabled)return;const F=this._scene.getEngine();for(let j=0,E=C.length;j<E;j++){const K=C[j];var k;if(j<E-1)K._outputTexture=C[j+1].activate(s,null===I||void 0===I?void 0:I.texture);else I?(F.bindFramebuffer(I,m,void 0,void 0,l),K._outputTexture=I):(F.restoreDefaultFramebuffer(),K._outputTexture=null),null===(k=F._debugInsertMarker)||void 0===k||k.call(F,`post process ${C[j].name} output`);if(V)break;const Y=K.apply();Y&&(K.onBeforeRenderObservable.notifyObservers(Y),this._prepareBuffers(),F.bindBuffers(this._vertexBuffers,this._indexBuffer,Y),F.drawElementsType(0,0,6),K.onAfterRenderObservable.notifyObservers(Y))}F.setDepthBuffer(!0),F.setDepthWrite(!0),F.setAlphaMode(0)}dispose(){const V=this._vertexBuffers[C.e.PositionKind];V&&(V.dispose(),this._vertexBuffers[C.e.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11527:(V,I,m)=>{m.d(I,{c:()=>k});var C=m(11389),l=m(11040);class s{set opaqueSortCompareFn(V){this._opaqueSortCompareFn=V||s.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(V){this._alphaTestSortCompareFn=V||s.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(V){this._transparentSortCompareFn=V||s.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=V,this._opaqueSubMeshes=new C.g(256),this._transparentSubMeshes=new C.g(256),this._alphaTestSubMeshes=new C.g(256),this._depthOnlySubMeshes=new C.g(256),this._particleSystems=new C.g(256),this._spriteManagers=new C.g(256),this._empty=!0,this._edgesRenderers=new C.c(16),this._scene=I,this.opaqueSortCompareFn=m,this.alphaTestSortCompareFn=l,this.transparentSortCompareFn=s}render(V,I,m,C){if(V)return void V(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const l=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(l.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),l.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const s=l.getStencilBuffer();if(l.setStencilBuffer(!1),I&&this._renderSprites(),m&&this._renderParticles(C),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(l.setStencilBuffer(s),this._scene.useOrderIndependentTransparency){const V=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);V.length&&this._renderTransparent(V)}else this._renderTransparent(this._transparentSubMeshes);l.setAlphaMode(0)}if(l.setStencilBuffer(!1),this._edgesRenderers.length){for(let V=0;V<this._edgesRenderers.length;V++)this._edgesRenderers.data[V].render();l.setAlphaMode(0)}l.setStencilBuffer(s)}_renderOpaqueSorted(V){s._RenderSorted(V,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(V){s._RenderSorted(V,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(V){s._RenderSorted(V,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(V,I,m,C){let F,k=0;const j=m?m.globalPosition:s._ZeroVector;if(C)for(;k<V.length;k++)F=V.data[k],F._alphaIndex=F.getMesh().alphaIndex,F._distanceToCamera=l.m.Distance(F.getBoundingInfo().boundingSphere.centerWorld,j);const E=V.length===V.data.length?V.data:V.data.slice(0,V.length);I&&E.sort(I);const K=E[0].getMesh().cV();for(k=0;k<E.length;k++)if(F=E[k],!K._activeMeshesFrozenButKeepClipping||F.isInFrustum(K._frustumPlanes)){if(C){const V=F.dV();if(V&&V.needDepthPrePass){const I=V.cV().getEngine();I.setColorWrite(!1),I.setAlphaMode(0),F.render(!1),I.setColorWrite(!0)}}F.render(C)}}static defaultTransparentSortCompare(V,I){return V._alphaIndex>I._alphaIndex?1:V._alphaIndex<I._alphaIndex?-1:s.backToFrontSortCompare(V,I)}static backToFrontSortCompare(V,I){return V._distanceToCamera<I._distanceToCamera?1:V._distanceToCamera>I._distanceToCamera?-1:0}static frontToBackSortCompare(V,I){return V._distanceToCamera<I._distanceToCamera?-1:V._distanceToCamera>I._distanceToCamera?1:0}static PainterSortCompare(V,I){const m=V.getMesh(),C=I.getMesh();return m.material&&C.material?m.material.uniqueId-C.material.uniqueId:m.uniqueId-C.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(V,I,m){void 0===I&&(I=V.getMesh()),void 0===m&&(m=V.dV()),null!==m&&void 0!==m&&(m.needAlphaBlendingForMesh(I)?this._transparentSubMeshes.push(V):m.needAlphaTestingForMesh(I)?(m.needDepthPrePass&&this._depthOnlySubMeshes.push(V),this._alphaTestSubMeshes.push(V)):(m.needDepthPrePass&&this._depthOnlySubMeshes.push(V),this._opaqueSubMeshes.push(V)),I._renderingGroup=this,I._edgesRenderer&&I.isEnabled()&&I.isVisible&&I._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(I._edgesRenderer),this._empty=!1)}dispatchSprites(V){this._spriteManagers.push(V),this._empty=!1}dispatchParticles(V){this._particleSystems.push(V),this._empty=!1}_renderParticles(V){if(0===this._particleSystems.length)return;const I=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let m=0;m<this._particleSystems.length;m++){const C=this._particleSystems.data[m];if(0===(I&&I.layerMask&C.layerMask))continue;const l=C.i;l.position&&V&&-1===V.indexOf(l)||this._scene._activeParticles.addCount(C.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const V=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let I=0;I<this._spriteManagers.length;I++){const m=this._spriteManagers.data[I];0!==(V&&V.layerMask&m.layerMask)&&m.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}s._ZeroVector=l.m.Zero();class F{}class k{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(V){V!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=V,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const V of this._scene.meshes)if(V.kk)for(const I of V.kk)I._wasDispatched=!1;if(this._scene.spriteManagers)for(const V of this._scene.spriteManagers)V._wasDispatched=!1;for(const V of this._scene.ZY)V._wasDispatched=!1}constructor(V){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new F,this._maintainStateBetweenFrames=!1,this._scene=V;for(let I=k.MIN_RENDERINGGROUPS;I<k.MAX_RENDERINGGROUPS;I++)this._autoClearDepthStencil[I]={FY:!0,depth:!0,stencil:!0}}getRenderingGroup(V){const I=V||0;return this._prepareRenderingGroup(I),this._renderingGroups[I]}_clearDepthStencilBuffer(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,V,I),this._depthStencilBufferAlreadyCleaned=!0)}render(V,I,m,C){const l=this._renderingGroupInfo;if(l.OI=this._scene,l.camera=this._scene.activeCamera,l.renderingManager=this,this._scene.spriteManagers&&C)for(let s=0;s<this._scene.spriteManagers.length;s++){const V=this._scene.spriteManagers[s];this.dispatchSprites(V)}for(let s=k.MIN_RENDERINGGROUPS;s<k.MAX_RENDERINGGROUPS;s++){this._depthStencilBufferAlreadyCleaned=s===k.MIN_RENDERINGGROUPS;const F=this._renderingGroups[s];if(!F||F._empty)continue;const j=1<<s;if(l.renderingGroupId=s,this._scene.onBeforeRenderingGroupObservable.notifyObservers(l,j),k.AUTOCLEAR){const V=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(s):this._autoClearDepthStencil[s];V&&V.FY&&this._clearDepthStencilBuffer(V.depth,V.stencil)}for(const V of this._scene._beforeRenderingGroupDrawStage)V.action(s);F.render(V,C,m,I);for(const V of this._scene._afterRenderingGroupDrawStage)V.action(s);this._scene.onAfterRenderingGroupObservable.notifyObservers(l,j)}}reset(){if(!this.maintainStateBetweenFrames)for(let V=k.MIN_RENDERINGGROUPS;V<k.MAX_RENDERINGGROUPS;V++){const I=this._renderingGroups[V];I&&I.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let V=k.MIN_RENDERINGGROUPS;V<k.MAX_RENDERINGGROUPS;V++){const I=this._renderingGroups[V];I&&I.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let V=k.MIN_RENDERINGGROUPS;V<k.MAX_RENDERINGGROUPS;V++){const I=this._renderingGroups[V];I&&I.dispose()}}_prepareRenderingGroup(V){void 0===this._renderingGroups[V]&&(this._renderingGroups[V]=new s(V,this._scene,this._customOpaqueSortCompareFn[V],this._customAlphaTestSortCompareFn[V],this._customTransparentSortCompareFn[V]))}dispatchSprites(V){this.maintainStateBetweenFrames&&V._wasDispatched||(V._wasDispatched=!0,this.getRenderingGroup(V.renderingGroupId).dispatchSprites(V))}dispatchParticles(V){this.maintainStateBetweenFrames&&V._wasDispatched||(V._wasDispatched=!0,this.getRenderingGroup(V.renderingGroupId).dispatchParticles(V))}dispatch(V,I,m){void 0===I&&(I=V.getMesh()),this.maintainStateBetweenFrames&&V._wasDispatched||(V._wasDispatched=!0,this.getRenderingGroup(I.renderingGroupId).dispatch(V,I,m))}setRenderingOrder(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[V]=I,this._customAlphaTestSortCompareFn[V]=m,this._customTransparentSortCompareFn[V]=C,this._renderingGroups[V]){const I=this._renderingGroups[V];I.opaqueSortCompareFn=this._customOpaqueSortCompareFn[V],I.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[V],I.transparentSortCompareFn=this._customTransparentSortCompareFn[V]}}setRenderingAutoClearDepthStencil(V,I){let m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],C=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[V]={FY:I,depth:m,stencil:C}}getAutoClearDepthStencilSetup(V){return this._autoClearDepthStencil[V]}}k.MAX_RENDERINGGROUPS=4,k.MIN_RENDERINGGROUPS=0,k.AUTOCLEAR=!0},11538:(V,I,m)=>{m.r(I),m.d(I,{postprocessVertexShader:()=>F});var C=m(11150);const l="postprocessVertexShader",s="attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";C.e.ShadersStore[l]||(C.e.ShadersStore[l]=s);const F={name:l,shader:s}},11633:(V,I,m)=>{m.d(I,{d:()=>C});class C{}C._IsPickingAvailable=!1},11337:(V,I,m)=>{m.d(I,{c:()=>Y});var C=m(11206),l=m(11040),s=m(11214),F=m(11067),k=m(11061),j=m(11095),E=m(11297);class K{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new F.e,this._onClonedObservable=new F.e}}class Y{static AddNodeConstructor(V,I){this._NodeConstructors[V]=I}static Construct(V,I,m,C){const l=this._NodeConstructors[V];return l?l(I,m,C):null}set accessibilityTag(V){this._accessibilityTag=V,this.onAccessibilityTagChangedObservable.notifyObservers(V)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(V){this._nodeDataStorage._doNotSerialize=V}K(){return this._nodeDataStorage._isDisposed}set parent(V){if(this._parentNode===V)return;const I=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const I=this._parentNode._children.indexOf(this);-1!==I&&this._parentNode._children.splice(I,1),V||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=V,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),I||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(V){V.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const V=this._scene.rootNodes,I=V.length-1;V[this._nodeDataStorage._sceneRootNodesIndex]=V[I],V[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(V){this._animationPropertiesOverride=V}getClassName(){return"Node"}set onDispose(V){this._onDisposeObserver&&this.Ck.remove(this._onDisposeObserver),this._onDisposeObserver=this.Ck.add(V)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new K,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new F.e,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=l.b.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.Ck=new F.e,this._onDisposeObserver=null,this._behaviors=new Array,this.name=V,this.id=V,this._scene=I||k.c.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),m&&this._addToSceneRootNodes()}cV(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(V)||(V.init(),this._scene.isLoading&&!I?this._scene.onDataLoadedObservable.addOnce((()=>{V.attach(this)})):V.attach(this),this._behaviors.push(V)),this}removeBehavior(V){const I=this._behaviors.indexOf(V);return-1===I||(this._behaviors[I].detach(),this._behaviors.splice(I,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(V){for(const I of this._behaviors)if(I.name===V)return I;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.fF(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(V){!V&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(V){return this.parent?this.parent._getActionManagerForTrigger(V,!1):null}_updateCache(V){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}bE(V){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){if(this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children)for(const V of this._children)V._syncParentEnabledState()}Sk(V){this._nodeDataStorage._isEnabled!==V&&(this._nodeDataStorage._isEnabled=V,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(V))}isDescendantOf(V){return!!this.parent&&(this.parent===V||this.parent.isDescendantOf(V))}_getDescendants(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2?arguments[2]:void 0;if(this._children)for(let C=0;C<this._children.length;C++){const l=this._children[C];m&&!m(l)||V.push(l),I||l._getDescendants(V,!1,m)}}getDescendants(V,I){const m=[];return this._getDescendants(m,V,I),m}getChildMeshes(V,I){const m=[];return this._getDescendants(m,V,(V=>(!I||I(V))&&void 0!==V.pK)),m}getChildren(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(I,V)}_setReady(V){V!==this._nodeDataStorage._isReady&&(V?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(V){for(let I=0;I<this.animations.length;I++){const m=this.animations[I];if(m.name===V)return m}return null}createAnimationRange(V,I,m){if(!this._ranges[V]){this._ranges[V]=Y._AnimationRangeFactory(V,I,m);for(let C=0,l=this.animations.length;C<l;C++)this.animations[C]&&this.animations[C].createRange(V,I,m)}}deleteAnimationRange(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let m=0,C=this.animations.length;m<C;m++)this.animations[m]&&this.animations[m].deleteRange(V,I);this._ranges[V]=null}getAnimationRange(V){return this._ranges[V]||null}clone(V,I,m){const C=E.d.Clone((()=>new Y(V,this.cV())),this);if(I&&(C.parent=I),!m){const I=this.getDescendants(!0);for(let m=0;m<I.length;m++){const l=I[m];l.clone(V+"."+l.name,C)}}return C}getAnimationRanges(){const V=[];let I;for(I in this._ranges)V.push(this._ranges[I]);return V}beginAnimation(V,I,m,C){const l=this.getAnimationRange(V);return l?this._scene.beginAnimation(this,l.from,l.to,I,m,C):null}serializeAnimationRanges(){const V=[];for(const I in this._ranges){const m=this._ranges[I];if(!m)continue;const C={};C.name=I,C.from=m.from,C.to=m.to,V.push(C)}return V}fF(V){return this._worldMatrix||(this._worldMatrix=l.b.Identity()),this._worldMatrix}dispose(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!V){const m=this.getDescendants(!0);for(const C of m)C.dispose(V,I)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.Ck.notifyObservers(this),this.Ck.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const m of this._behaviors)m.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(V,I,m){if(I.ranges)for(let C=0;C<I.ranges.length;C++){const m=I.ranges[C];V.createAnimationRange(m.name,m.from,m.to)}}getHierarchyBoundingVectors(){let V,I,m=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],C=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.cV().incrementRenderId(),this.fF(!0);const s=this;if(s.getBoundingInfo&&s.kk){const m=s.getBoundingInfo();V=m.boundingBox.minimumWorld.clone(),I=m.boundingBox.maximumWorld.clone()}else V=new l.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),I=new l.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(m){const m=this.getDescendants(!1);for(const s of m){const m=s;if(m.fF(!0),C&&!C(m))continue;if(!m.getBoundingInfo||0===m.getTotalVertices())continue;const F=m.getBoundingInfo().boundingBox,k=F.minimumWorld,j=F.maximumWorld;l.m.CheckExtends(k,V,I),l.m.CheckExtends(j,V,I)}}return{min:V,max:I}}}Y._AnimationRangeFactory=(V,I,m)=>{throw(0,j.c)("AnimationRange")},Y._NodeConstructors={},(0,C.d)([(0,s.B)()],Y.prototype,"name",void 0),(0,C.d)([(0,s.B)()],Y.prototype,"id",void 0),(0,C.d)([(0,s.B)()],Y.prototype,"uniqueId",void 0),(0,C.d)([(0,s.B)()],Y.prototype,"state",void 0),(0,C.d)([(0,s.B)()],Y.prototype,"metadata",void 0)},11596:(V,I,m)=>{m.d(I,{e:()=>VV});var C=m(11076),l=m(11091),s=m(11067),F=m(11389);class k{constructor(){this._count=0,this._data={}}C(V){this.clear(),V.forEach(((V,I)=>this.add(V,I)))}get(V){const I=this._data[V];if(void 0!==I)return I}getOrAddWithFactory(V,I){let m=this.get(V);return void 0!==m||(m=I(V),m&&this.add(V,m)),m}getOrAdd(V,I){const m=this.get(V);return void 0!==m?m:(this.add(V,I),I)}contains(V){return void 0!==this._data[V]}add(V,I){return void 0===this._data[V]&&(this._data[V]=I,++this._count,!0)}set(V,I){return void 0!==this._data[V]&&(this._data[V]=I,!0)}getAndRemove(V){const I=this.get(V);return void 0!==I?(delete this._data[V],--this._count,I):null}remove(V){return!!this.contains(V)&&(delete this._data[V],--this._count,!0)}clear(){this._data={},this._count=0}get count(){return this._count}forEach(V){for(const I in this._data){V(I,this._data[I])}}first(V){for(const I in this._data){const m=V(I,this._data[I]);if(m)return m}return null}}var j=m(11305),E=m(11040),K=m(11605),Y=m(11283),X=m(11366);class O{constructor(V,I,m,C,l,s){this.source=V,this.pointerX=I,this.pointerY=m,this.meshUnderPointer=C,this.sourceEvent=l,this.additionalData=s}static CreateNew(V,I,m){const C=V.cV();return new O(V,C.pointerX,C.pointerY,C.meshUnderPointer||V,I,m)}static CreateNewFromSprite(V,I,m,C){return new O(V,I.pointerX,I.pointerY,I.meshUnderPointer,m,C)}static CreateNewFromScene(V,I){return new O(null,V.pointerX,V.pointerY,V.meshUnderPointer,I)}static CreateNewFromPrimitive(V,I,m,C){return new O(V,I.x,I.y,null,m,C)}}var v=m(11524),N=m(11527),t=m(11421),D=m(11081),b=m(11061),T=m(11095),n=m(11616);class x{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasTriggers(){for(const V in x.Triggers)if(Object.prototype.hasOwnProperty.call(x.Triggers,V))return!0;return!1}static get HasPickTriggers(){for(const V in x.Triggers)if(Object.prototype.hasOwnProperty.call(x.Triggers,V)){const I=parseInt(V);if(I>=1&&I<=7)return!0}return!1}static HasSpecificTrigger(V){for(const I in x.Triggers)if(Object.prototype.hasOwnProperty.call(x.Triggers,I)){if(parseInt(I)===V)return!0}return!1}}x.Triggers={};var S,c,H,y,z,Z,B,W=m(11624);!function(V){V[V.Generic=0]="Generic",V[V.Keyboard=1]="Keyboard",V[V.Mouse=2]="Mouse",V[V.Touch=3]="Touch",V[V.DualShock=4]="DualShock",V[V.Xbox=5]="Xbox",V[V.Switch=6]="Switch",V[V.DualSense=7]="DualSense"}(S||(S={})),function(V){V[V.Horizontal=0]="Horizontal",V[V.Vertical=1]="Vertical",V[V.LeftClick=2]="LeftClick",V[V.MiddleClick=3]="MiddleClick",V[V.RightClick=4]="RightClick",V[V.BrowserBack=5]="BrowserBack",V[V.BrowserForward=6]="BrowserForward",V[V.MouseWheelX=7]="MouseWheelX",V[V.MouseWheelY=8]="MouseWheelY",V[V.MouseWheelZ=9]="MouseWheelZ",V[V.Move=12]="Move"}(c||(c={})),function(V){V[V.Horizontal=0]="Horizontal",V[V.Vertical=1]="Vertical",V[V.LeftClick=2]="LeftClick",V[V.MiddleClick=3]="MiddleClick",V[V.RightClick=4]="RightClick",V[V.BrowserBack=5]="BrowserBack",V[V.BrowserForward=6]="BrowserForward",V[V.MouseWheelX=7]="MouseWheelX",V[V.MouseWheelY=8]="MouseWheelY",V[V.MouseWheelZ=9]="MouseWheelZ",V[V.DeltaHorizontal=10]="DeltaHorizontal",V[V.DeltaVertical=11]="DeltaVertical"}(H||(H={})),function(V){V[V.Cross=0]="Cross",V[V.Circle=1]="Circle",V[V.Square=2]="Square",V[V.Triangle=3]="Triangle",V[V.L1=4]="L1",V[V.R1=5]="R1",V[V.L2=6]="L2",V[V.R2=7]="R2",V[V.Share=8]="Share",V[V.Options=9]="Options",V[V.L3=10]="L3",V[V.R3=11]="R3",V[V.DPadUp=12]="DPadUp",V[V.DPadDown=13]="DPadDown",V[V.DPadLeft=14]="DPadLeft",V[V.DPadRight=15]="DPadRight",V[V.Home=16]="Home",V[V.TouchPad=17]="TouchPad",V[V.LStickXAxis=18]="LStickXAxis",V[V.LStickYAxis=19]="LStickYAxis",V[V.RStickXAxis=20]="RStickXAxis",V[V.RStickYAxis=21]="RStickYAxis"}(y||(y={})),function(V){V[V.Cross=0]="Cross",V[V.Circle=1]="Circle",V[V.Square=2]="Square",V[V.Triangle=3]="Triangle",V[V.L1=4]="L1",V[V.R1=5]="R1",V[V.L2=6]="L2",V[V.R2=7]="R2",V[V.Create=8]="Create",V[V.Options=9]="Options",V[V.L3=10]="L3",V[V.R3=11]="R3",V[V.DPadUp=12]="DPadUp",V[V.DPadDown=13]="DPadDown",V[V.DPadLeft=14]="DPadLeft",V[V.DPadRight=15]="DPadRight",V[V.Home=16]="Home",V[V.TouchPad=17]="TouchPad",V[V.LStickXAxis=18]="LStickXAxis",V[V.LStickYAxis=19]="LStickYAxis",V[V.RStickXAxis=20]="RStickXAxis",V[V.RStickYAxis=21]="RStickYAxis"}(z||(z={})),function(V){V[V.A=0]="A",V[V.B=1]="B",V[V.X=2]="X",V[V.Y=3]="Y",V[V.LB=4]="LB",V[V.RB=5]="RB",V[V.LT=6]="LT",V[V.RT=7]="RT",V[V.Back=8]="Back",V[V.Start=9]="Start",V[V.LS=10]="LS",V[V.RS=11]="RS",V[V.DPadUp=12]="DPadUp",V[V.DPadDown=13]="DPadDown",V[V.DPadLeft=14]="DPadLeft",V[V.DPadRight=15]="DPadRight",V[V.Home=16]="Home",V[V.LStickXAxis=17]="LStickXAxis",V[V.LStickYAxis=18]="LStickYAxis",V[V.RStickXAxis=19]="RStickXAxis",V[V.RStickYAxis=20]="RStickYAxis"}(Z||(Z={})),function(V){V[V.B=0]="B",V[V.A=1]="A",V[V.Y=2]="Y",V[V.X=3]="X",V[V.L=4]="L",V[V.R=5]="R",V[V.ZL=6]="ZL",V[V.ZR=7]="ZR",V[V.Minus=8]="Minus",V[V.Plus=9]="Plus",V[V.LS=10]="LS",V[V.RS=11]="RS",V[V.DPadUp=12]="DPadUp",V[V.DPadDown=13]="DPadDown",V[V.DPadLeft=14]="DPadLeft",V[V.DPadRight=15]="DPadRight",V[V.Home=16]="Home",V[V.Capture=17]="Capture",V[V.LStickXAxis=18]="LStickXAxis",V[V.LStickYAxis=19]="LStickYAxis",V[V.RStickXAxis=20]="RStickXAxis",V[V.RStickYAxis=21]="RStickYAxis"}(B||(B={}));var Q=m(11626);class G{static CreateDeviceEvent(V,I,m,C,l,s,F){switch(V){case S.Keyboard:return this._CreateKeyboardEvent(m,C,l,s);case S.Mouse:if(m===c.MouseWheelX||m===c.MouseWheelY||m===c.MouseWheelZ)return this._CreateWheelEvent(V,I,m,C,l,s);case S.Touch:return this._CreatePointerEvent(V,I,m,C,l,s,F);default:throw`Unable to generate event for device ${S[V]}`}}static _CreatePointerEvent(V,I,m,C,l,s,F){const k=this._CreateMouseEvent(V,I,m,C,l,s);V===S.Mouse?(k.deviceType=S.Mouse,k.pointerId=1,k.pointerType="mouse"):(k.deviceType=S.Touch,k.pointerId=F??I,k.pointerType="touch");let j=0;return j+=l.pollInput(V,I,c.LeftClick),j+=2*l.pollInput(V,I,c.RightClick),j+=4*l.pollInput(V,I,c.MiddleClick),k.buttons=j,m===c.Move?k.type="pointermove":m>=c.LeftClick&&m<=c.RightClick&&(k.type=1===C?"pointerdown":"pointerup",k.button=m-2),k}static _CreateWheelEvent(V,I,m,C,l,s){const F=this._CreateMouseEvent(V,I,m,C,l,s);switch(F.pointerId=1,F.type="wheel",F.deltaMode=Q.c.DOM_DELTA_PIXEL,F.deltaX=0,F.deltaY=0,F.deltaZ=0,m){case c.MouseWheelX:F.deltaX=C;break;case c.MouseWheelY:F.deltaY=C;break;case c.MouseWheelZ:F.deltaZ=C}return F}static _CreateMouseEvent(V,I,m,C,l,s){const F=this._CreateEvent(s),k=l.pollInput(V,I,c.Horizontal),j=l.pollInput(V,I,c.Vertical);return s?(F.movementX=0,F.movementY=0,F.offsetX=F.movementX-s.getBoundingClientRect().x,F.offsetY=F.movementY-s.getBoundingClientRect().y):(F.movementX=l.pollInput(V,I,10),F.movementY=l.pollInput(V,I,11),F.offsetX=0,F.offsetY=0),this._CheckNonCharacterKeys(F,l),F.clientX=k,F.clientY=j,F.x=k,F.y=j,F.deviceType=V,F.deviceSlot=I,F.inputIndex=m,F}static _CreateKeyboardEvent(V,I,m,C){const l=this._CreateEvent(C);return this._CheckNonCharacterKeys(l,m),l.deviceType=S.Keyboard,l.deviceSlot=0,l.inputIndex=V,l.type=1===I?"keydown":"keyup",l.key=String.fromCharCode(V),l.keyCode=V,l}static _CheckNonCharacterKeys(V,I){const m=I.isDeviceAvailable(S.Keyboard),C=m&&1===I.pollInput(S.Keyboard,0,18),l=m&&1===I.pollInput(S.Keyboard,0,17),s=m&&(1===I.pollInput(S.Keyboard,0,91)||1===I.pollInput(S.Keyboard,0,92)||1===I.pollInput(S.Keyboard,0,93)),F=m&&1===I.pollInput(S.Keyboard,0,16);V.altKey=C,V.ctrlKey=l,V.metaKey=s,V.shiftKey=F}static _CreateEvent(V){const I={preventDefault:()=>{}};return I.target=V,I}}class r{constructor(V,I,m){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(V,I,((V,I,C,l)=>{const s=G.CreateDeviceEvent(V,I,C,l,this);m(V,I,s)})):this._createDummyNativeInput()}pollInput(V,I,m){return this._nativeInput.pollInput(V,I,m)}isDeviceAvailable(V){return V===S.Mouse||V===S.Touch}dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}}const g=Object.keys(c).length/2;class h{constructor(V,I,m,l){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=C.d.IsSafari(),this._usingMacOs=(0,D.l)()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=V=>{},this._keyboardUpEvent=V=>{},this._keyboardBlurEvent=V=>{},this._pointerMoveEvent=V=>{},this._pointerDownEvent=V=>{},this._pointerUpEvent=V=>{},this._pointerCancelEvent=V=>{},this._pointerCancelTouch=V=>{},this._pointerLeaveEvent=V=>{},this._pointerWheelEvent=V=>{},this._pointerBlurEvent=V=>{},this._pointerMacOsChromeOutEvent=V=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=(0,D.l)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=(0,D.l)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=V=>{},this._gamepadDisconnectedEvent=V=>{},this._eventPrefix=C.d.GetPointerPrefix(V),this._engine=V,this._onDeviceConnected=I,this._onDeviceDisconnected=m,this._onInputChanged=l,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOs&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}pollInput(V,I,m){const l=this._inputs[V][I];if(!l)throw`Unable to find device ${S[V]}`;V>=S.DualShock&&V<=S.DualSense&&this._updateDevice(V,I,m);const s=l[m];if(void 0===s)throw`Unable to find input ${m} for device ${S[V]} in slot ${I}`;return m===c.Move&&C.d.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),s}isDeviceAvailable(V){return void 0!==this._inputs[V]}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_enableEvents(){const V=null===this||void 0===this?void 0:this._engine.getInputElement();if(V&&(!this._eventsAttached||this._elementToAttachTo!==V)){if(this._disableEvents(),this._inputs)for(const V of this._inputs)if(V)for(const I in V){const m=V[+I];if(m)for(let V=0;V<m.length;V++)m[V]=0}this._elementToAttachTo=V,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"leave",this._pointerLeaveEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOs&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOsChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_checkForConnectedDevices(){if(navigator.getGamepads){const V=navigator.getGamepads();for(const I of V)I&&this._addGamePad(I)}"function"===typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(S.Mouse,0,0,0)}_addGamePad(V){const I=this._getGamepadDeviceType(V.id),m=V.index;this._gamepads=this._gamepads||new Array(V.index+1),this._registerDevice(I,m,V.buttons.length+V.axes.length),this._gamepads[m]=I}_addPointerDevice(V,I,m,C){this._pointerActive||(this._pointerActive=!0),this._registerDevice(V,I,g);const l=this._inputs[V][I];l[0]=m,l[1]=C}_registerDevice(V,I,m){if(void 0===I)throw`Unable to register device ${S[V]} to undefined slot.`;if(this._inputs[V]||(this._inputs[V]={}),!this._inputs[V][I]){const C=new Array(m);C.fill(0),this._inputs[V][I]=C,this._onDeviceConnected(V,I)}}_unregisterDevice(V,I){this._inputs[V][I]&&(delete this._inputs[V][I],this._onDeviceDisconnected(V,I))}_handleKeyActions(){this._keyboardDownEvent=V=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(S.Keyboard,0,255));const I=this._inputs[S.Keyboard][0];if(I){I[V.keyCode]=1;const m=V;m.inputIndex=V.keyCode,this._usingMacOs&&V.metaKey&&"Meta"!==V.key&&(this._metaKeys.includes(V.keyCode)||this._metaKeys.push(V.keyCode)),this._onInputChanged(S.Keyboard,0,m)}},this._keyboardUpEvent=V=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(S.Keyboard,0,255));const I=this._inputs[S.Keyboard][0];if(I){I[V.keyCode]=0;const m=V;if(m.inputIndex=V.keyCode,this._usingMacOs&&"Meta"===V.key&&this._metaKeys.length>0){for(const V of this._metaKeys){const m=G.CreateDeviceEvent(S.Keyboard,0,V,0,this,this._elementToAttachTo);I[V]=0,this._onInputChanged(S.Keyboard,0,m)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(S.Keyboard,0,m)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const V=this._inputs[S.Keyboard][0];for(let I=0;I<V.length;I++)if(0!==V[I]){V[I]=0;const m=G.CreateDeviceEvent(S.Keyboard,0,I,0,this,this._elementToAttachTo);this._onInputChanged(S.Keyboard,0,m)}this._usingMacOs&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_handlePointerActions(){this._maxTouchPoints=(0,D.l)()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let C=0;C<this._maxTouchPoints;C++)this._activeTouchIds[C]=-1;this._pointerMoveEvent=V=>{const I=this._getPointerType(V);let m=I===S.Mouse?0:this._activeTouchIds.indexOf(V.pointerId);if(I===S.Touch&&-1===m){const l=this._activeTouchIds.indexOf(-1);if(!(l>=0))return void C.d.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);m=l,this._activeTouchIds[l]=V.pointerId,this._onDeviceConnected(I,m)}this._inputs[I]||(this._inputs[I]={}),this._inputs[I][m]||this._addPointerDevice(I,m,V.clientX,V.clientY);const l=this._inputs[I][m];if(l){const C=V;C.inputIndex=c.Move,l[c.Horizontal]=V.clientX,l[c.Vertical]=V.clientY,I===S.Touch&&0===l[c.LeftClick]&&(l[c.LeftClick]=1),void 0===V.pointerId&&(V.pointerId=this._mouseId),this._onInputChanged(I,m,C),this._usingSafari||-1===V.button||(C.inputIndex=V.button+2,l[V.button+2]=l[V.button+2]?0:1,this._onInputChanged(I,m,C))}},this._pointerDownEvent=V=>{const I=this._getPointerType(V);let m=I===S.Mouse?0:V.pointerId;if(I===S.Touch){let I=this._activeTouchIds.indexOf(V.pointerId);if(-1===I&&(I=this._activeTouchIds.indexOf(-1)),!(I>=0))return void C.d.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);m=I,this._activeTouchIds[I]=V.pointerId}this._inputs[I]||(this._inputs[I]={}),this._inputs[I][m]?I===S.Touch&&this._onDeviceConnected(I,m):this._addPointerDevice(I,m,V.clientX,V.clientY);const l=this._inputs[I][m];if(l){const C=l[c.Horizontal],F=l[c.Vertical];if(I===S.Mouse){if(void 0===V.pointerId&&(V.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(s){}}else if(V.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(V.pointerId)}catch(s){}l[c.Horizontal]=V.clientX,l[c.Vertical]=V.clientY,l[V.button+2]=1;const k=V;k.inputIndex=V.button+2,this._onInputChanged(I,m,k),C===V.clientX&&F===V.clientY||(k.inputIndex=c.Move,this._onInputChanged(I,m,k))}},this._pointerUpEvent=V=>{var I;const m=this._getPointerType(V),C=m===S.Mouse?0:this._activeTouchIds.indexOf(V.pointerId);if(m===S.Touch){if(-1===C)return;this._activeTouchIds[C]=-1}const l=null===(I=this._inputs[m])||void 0===I?void 0:I[C];let s=V.button,F=l&&0!==l[s+2];if(!F&&this._isUsingFirefox&&this._usingMacOs&&l&&(s=2===s?0:2,F=0!==l[s+2]),F){var k,j,E,K;const I=l[c.Horizontal],F=l[c.Vertical];l[c.Horizontal]=V.clientX,l[c.Vertical]=V.clientY,l[s+2]=0;const Y=V;void 0===V.pointerId&&(V.pointerId=this._mouseId),I===V.clientX&&F===V.clientY||(Y.inputIndex=c.Move,this._onInputChanged(m,C,Y)),Y.inputIndex=s+2,m===S.Mouse&&this._mouseId>=0&&null!==(k=(j=this._elementToAttachTo).hasPointerCapture)&&void 0!==k&&k.call(j,this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):V.pointerId&&null!==(E=(K=this._elementToAttachTo).hasPointerCapture)&&void 0!==E&&E.call(K,V.pointerId)&&this._elementToAttachTo.releasePointerCapture(V.pointerId),this._onInputChanged(m,C,Y),m===S.Touch&&this._onDeviceDisconnected(m,C)}},this._pointerCancelTouch=V=>{var I,m;const C=this._activeTouchIds.indexOf(V);if(-1===C)return;null!==(I=(m=this._elementToAttachTo).hasPointerCapture)&&void 0!==I&&I.call(m,V)&&this._elementToAttachTo.releasePointerCapture(V),this._inputs[S.Touch][C][c.LeftClick]=0;const l=G.CreateDeviceEvent(S.Touch,C,c.LeftClick,0,this,this._elementToAttachTo,V);this._onInputChanged(S.Touch,C,l),this._activeTouchIds[C]=-1,this._onDeviceDisconnected(S.Touch,C)},this._pointerCancelEvent=V=>{if("mouse"===V.pointerType){var I,m;const V=this._inputs[S.Mouse][0];this._mouseId>=0&&null!==(I=(m=this._elementToAttachTo).hasPointerCapture)&&void 0!==I&&I.call(m,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let I=c.LeftClick;I<=c.BrowserForward;I++)if(1===V[I]){V[I]=0;const m=G.CreateDeviceEvent(S.Mouse,0,I,0,this,this._elementToAttachTo);this._onInputChanged(S.Mouse,0,m)}}else this._pointerCancelTouch(V.pointerId)},this._pointerLeaveEvent=V=>{"pen"===V.pointerType&&this._pointerCancelTouch(V.pointerId)},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let V=!1;const I=function(){};try{const m=Object.defineProperty({},"passive",{get:function(){V=!0}});this._elementToAttachTo.addEventListener("test",I,m),this._elementToAttachTo.removeEventListener("test",I,m)}catch(m){}this._pointerBlurEvent=()=>{if(this.isDeviceAvailable(S.Mouse)){var V,I;const m=this._inputs[S.Mouse][0];this._mouseId>=0&&null!==(V=(I=this._elementToAttachTo).hasPointerCapture)&&void 0!==V&&V.call(I,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let V=c.LeftClick;V<=c.BrowserForward;V++)if(1===m[V]){m[V]=0;const I=G.CreateDeviceEvent(S.Mouse,0,V,0,this,this._elementToAttachTo);this._onInputChanged(S.Mouse,0,I)}}if(this.isDeviceAvailable(S.Touch)){const V=this._inputs[S.Touch];for(let I=0;I<this._activeTouchIds.length;I++){var m,C,l;const s=this._activeTouchIds[I];if(null!==(m=(C=this._elementToAttachTo).hasPointerCapture)&&void 0!==m&&m.call(C,s)&&this._elementToAttachTo.releasePointerCapture(s),-1!==s&&1===(null===(l=V[I])||void 0===l?void 0:l[c.LeftClick])){V[I][c.LeftClick]=0;const m=G.CreateDeviceEvent(S.Touch,I,c.LeftClick,0,this,this._elementToAttachTo,s);this._onInputChanged(S.Touch,I,m),this._activeTouchIds[I]=-1,this._onDeviceDisconnected(S.Touch,I)}}}},this._pointerWheelEvent=V=>{const I=S.Mouse;this._inputs[I]||(this._inputs[I]=[]),this._inputs[I][0]||(this._pointerActive=!0,this._registerDevice(I,0,g));const m=this._inputs[I][0];if(m){m[c.MouseWheelX]=V.deltaX||0,m[c.MouseWheelY]=V.deltaY||V.wheelDelta||0,m[c.MouseWheelZ]=V.deltaZ||0;const C=V;void 0===V.pointerId&&(V.pointerId=this._mouseId),0!==m[c.MouseWheelX]&&(C.inputIndex=c.MouseWheelX,this._onInputChanged(I,0,C)),0!==m[c.MouseWheelY]&&(C.inputIndex=c.MouseWheelY,this._onInputChanged(I,0,C)),0!==m[c.MouseWheelZ]&&(C.inputIndex=c.MouseWheelZ,this._onInputChanged(I,0,C))}},this._usingMacOs&&this._isUsingChromium&&(this._pointerMacOsChromeOutEvent=V=>{V.buttons>1&&this._pointerCancelEvent(V)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOsChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"leave",this._pointerLeaveEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!V&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((()=>{if(this.isDeviceAvailable(S.Mouse)){const V=this._inputs[S.Mouse][0];V[c.MouseWheelX]=0,V[c.MouseWheelY]=0,V[c.MouseWheelZ]=0}}))}_handleGamepadActions(){this._gamepadConnectedEvent=V=>{this._addGamePad(V.gamepad)},this._gamepadDisconnectedEvent=V=>{if(this._gamepads){const I=this._getGamepadDeviceType(V.gamepad.id),m=V.gamepad.index;this._unregisterDevice(I,m),delete this._gamepads[m]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_updateDevice(V,I,m){const C=navigator.getGamepads()[I];if(C&&V===this._gamepads[I]){const l=this._inputs[V][I];m>=C.buttons.length?l[m]=C.axes[m-C.buttons.length].valueOf():l[m]=C.buttons[m].value}}_getGamepadDeviceType(V){return-1!==V.indexOf("054c")?-1!==V.indexOf("0ce6")?S.DualSense:S.DualShock:-1!==V.indexOf("Xbox One")||-1!==V.search("Xbox 360")||-1!==V.search("xinput")?S.Xbox:-1!==V.indexOf("057e")?S.Switch:S.Generic}_getPointerType(V){let I=S.Mouse;return("touch"===V.pointerType||"pen"===V.pointerType||V.touches)&&(I=S.Touch),I}}class d{constructor(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.deviceType=I,this.deviceSlot=m,this.onInputChangedObservable=new s.e,this._deviceInputSystem=V}getInput(V){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,V)}}class R{constructor(V){this._registeredManagers=new Array,this._refCount=0,this.registerManager=V=>{for(let I=0;I<this._devices.length;I++){const m=this._devices[I];for(const C in m){const m=+C;V._addDevice(new d(this._deviceInputSystem,I,m))}}this._registeredManagers.push(V)},this.unregisterManager=V=>{const I=this._registeredManagers.indexOf(V);I>-1&&this._registeredManagers.splice(I,1)};const I=Object.keys(S).length/2;this._devices=new Array(I);const m=(V,I)=>{this._devices[V]||(this._devices[V]=new Array),this._devices[V][I]||(this._devices[V][I]=I);for(const m of this._registeredManagers){const C=new d(this._deviceInputSystem,V,I);m._addDevice(C)}},C=(V,I)=>{var m;null!==(m=this._devices[V])&&void 0!==m&&m[I]&&delete this._devices[V][I];for(const C of this._registeredManagers)C._removeDevice(V,I)},l=(V,I,m)=>{if(m)for(const C of this._registeredManagers)C._onInputChanged(V,I,m)};"undefined"!==typeof _native?this._deviceInputSystem=new r(m,C,l):this._deviceInputSystem=new h(V,m,C,l)}dispose(){this._deviceInputSystem.dispose()}}class i{getDeviceSource(V,I){if(void 0===I){if(void 0===this._firstDevice[V])return null;I=this._firstDevice[V]}return this._devices[V]&&void 0!==this._devices[V][I]?this._devices[V][I]:null}getDeviceSources(V){return this._devices[V]?this._devices[V].filter((V=>!!V)):[]}constructor(V){const I=Object.keys(S).length/2;this._devices=new Array(I),this._firstDevice=new Array(I),this._engine=V,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new R(V)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new s.e((V=>{for(const I of this._devices)if(I)for(const m of I)m&&this.onDeviceConnectedObservable.notifyObserver(V,m)})),this.onDeviceDisconnectedObservable=new s.e,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=V.Ck.add((()=>{this.dispose()}))}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.Ck.remove(this._onDisposeObserver)}_addDevice(V){this._devices[V.deviceType]||(this._devices[V.deviceType]=[]),this._devices[V.deviceType][V.deviceSlot]||(this._devices[V.deviceType][V.deviceSlot]=V,this._updateFirstDevices(V.deviceType)),this.onDeviceConnectedObservable.notifyObservers(V)}_removeDevice(V,I){var m,C;const l=null===(m=this._devices[V])||void 0===m?void 0:m[I];this.onDeviceDisconnectedObservable.notifyObservers(l),null!==(C=this._devices[V])&&void 0!==C&&C[I]&&delete this._devices[V][I],this._updateFirstDevices(V)}_onInputChanged(V,I,m){var C,l;null===(C=this._devices[V])||void 0===C||null===(l=C[I])||void 0===l||l.onInputChangedObservable.notifyObservers(m)}_updateFirstDevices(V){switch(V){case S.Keyboard:case S.Mouse:this._firstDevice[V]=0;break;case S.Touch:case S.DualSense:case S.DualShock:case S.Xbox:case S.Switch:case S.Generic:{delete this._firstDevice[V];const I=this._devices[V];if(I)for(let m=0;m<I.length;m++)if(I[m]){this._firstDevice[V]=m;break}break}}}}var q=m(11633);class P{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get JC(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(V){this._singleClick=V}set JC(V){this._doubleClick=V}set hasSwiped(V){this._hasSwiped=V}set ignore(V){this._ignore=V}}class u{constructor(V){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._activePointerIds=new Array,this._activePointerIdsCount=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new E.k(0,0),this._previousStartingPointerPosition=new E.k(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=V||b.c.LastCreatedScene,this._scene}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(V){return this._meshUnderPointerId[V]||null}get unTranslatedPointer(){return new E.k(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(V){this._pointerX=V}get pointerY(){return this._pointerY}set pointerY(V){this._pointerY=V}_updatePointerPosition(V){const I=this._scene.getEngine().getInputElementClientRect();I&&(this._pointerX=V.clientX-I.left,this._pointerY=V.clientY-I.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(V,I){const m=this._scene,C=m.getEngine(),l=C.getInputElement();l&&(l.tabIndex=C.canvasTabIndex,m.doNotHandleCursors||(l.style.cursor=m.defaultCursor)),this._setCursorAndPointerOverMesh(V,I,m);for(const j of m._pointerMoveStage){var s;const m=!(null===(s=V=V||this._pickMove(I))||void 0===s||!s.pickedMesh);V=j.action(this._unTranslatedPointerX,this._unTranslatedPointerY,V,m,l)}const F=I.inputIndex>=c.MouseWheelX&&I.inputIndex<=c.MouseWheelZ?n.c.POINTERWHEEL:n.c.POINTERMOVE;let k;m.onPointerMove&&(V=V||this._pickMove(I),m.onPointerMove(I,V,F)),V?(k=new n.h(F,I,V),this._setRayOnPointerInfo(V,I)):(k=new n.h(F,I,null,this),this._movePointerInfo=k),m.onPointerObservable.hasObservers()&&m.onPointerObservable.notifyObservers(k,F)}_setRayOnPointerInfo(V,I){const m=this._scene;V&&q.d._IsPickingAvailable&&(V.ray||(V.ray=m.createPickingRay(I.offsetX,I.offsetY,E.b.Identity(),m.activeCamera)))}_addCameraPointerObserver(V,I){return this._cameraObserverCount++,this._scene.onPointerObservable.add(V,I)}_removeCameraPointerObserver(V){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(V)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(V,I,m){const C=this._scene,l=new n.f(m,I,this._unTranslatedPointerX,this._unTranslatedPointerY);return V&&(l.originalPickingInfo=V,l.ray=V.ray,"xr-near"===I.pointerType&&V.originMesh&&(l.nearInteractionPickingInfo=V)),C.onPrePointerObservable.notifyObservers(l,m),!!l.skipOnPointerObservable}_pickMove(V){const I=this._scene,m=I.sm(this._unTranslatedPointerX,this._unTranslatedPointerY,I.pointerMovePredicate,I.pointerMoveFastCheck,I.cameraToUseForPointers,I.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(m,V,I),m}_setCursorAndPointerOverMesh(V,I,m){const C=m.getEngine().getInputElement();if(null!==V&&void 0!==V&&V.pickedMesh){if(this.setPointerOverMesh(V.pickedMesh,I.pointerId,V,I),!m.doNotHandleCursors&&C&&this._pointerOverMesh){const V=this._pointerOverMesh._getActionManagerForTrigger();V&&V.hasPointerTriggers&&(C.style.cursor=V.hoverCursor||m.hoverCursor)}}else this.setPointerOverMesh(null,I.pointerId,V,I)}simulatePointerMove(V,I){const m=new PointerEvent("pointermove",I);m.inputIndex=c.Move,this._checkPrePointerObservable(V,m,n.c.POINTERMOVE)||this._processPointerMove(V,m)}simulatePointerDown(V,I){const m=new PointerEvent("pointerdown",I);m.inputIndex=m.button+2,this._checkPrePointerObservable(V,m,n.c.POINTERDOWN)||this._processPointerDown(V,m)}_processPointerDown(V,I){var m;const C=this._scene;if(null!==(m=V)&&void 0!==m&&m.pickedMesh){this._pickedDownMesh=V.pickedMesh;const m=V.pickedMesh._getActionManagerForTrigger();if(m){if(m.hasPickTriggers)switch(m.processTrigger(5,new O(V.pickedMesh,C.pointerX,C.pointerY,V.pickedMesh,I,V)),I.button){case 0:m.processTrigger(2,new O(V.pickedMesh,C.pointerX,C.pointerY,V.pickedMesh,I,V));break;case 1:m.processTrigger(4,new O(V.pickedMesh,C.pointerX,C.pointerY,V.pickedMesh,I,V));break;case 2:m.processTrigger(3,new O(V.pickedMesh,C.pointerX,C.pointerY,V.pickedMesh,I,V))}m.hasSpecificTrigger(8)&&window.setTimeout((()=>{const V=C.sm(this._unTranslatedPointerX,this._unTranslatedPointerY,(V=>V.Tj&&V.isVisible&&V.isReady()&&V.actionManager&&V.actionManager.hasSpecificTrigger(8)&&V===this._pickedDownMesh),!1,C.cameraToUseForPointers);null!==V&&void 0!==V&&V.pickedMesh&&m&&0!==this._activePointerIdsCount&&Date.now()-this._startingPointerTime>u.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,m.processTrigger(8,O.CreateNew(V.pickedMesh,I)))}),u.LongPressDelay)}}else for(const F of C._pointerDownStage)V=F.action(this._unTranslatedPointerX,this._unTranslatedPointerY,V,I,!1);let l;const s=n.c.POINTERDOWN;V?(C.onPointerDown&&C.onPointerDown(I,V,s),l=new n.h(s,I,V),this._setRayOnPointerInfo(V,I)):l=new n.h(s,I,null,this),C.onPointerObservable.hasObservers()&&C.onPointerObservable.notifyObservers(l,s)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(V,I,m){const C=new PointerEvent("pointerup",I);C.inputIndex=c.Move;const l=new P;m?l.JC=!0:l.singleClick=!0,this._checkPrePointerObservable(V,C,n.c.POINTERUP)||this._processPointerUp(V,C,l)}_processPointerUp(V,I,m){var C;const l=this._scene;if(null!==(C=V)&&void 0!==C&&C.pickedMesh){if(this._pickedUpMesh=V.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(l.onPointerPick&&l.onPointerPick(I,V),m.singleClick&&!m.ignore&&l.onPointerObservable.observers.length>this._cameraObserverCount)){const m=n.c.POINTERPICK,C=new n.h(m,I,V);this._setRayOnPointerInfo(V,I),l.onPointerObservable.notifyObservers(C,m)}const C=V.pickedMesh._getActionManagerForTrigger();if(C&&!m.ignore){C.processTrigger(7,O.CreateNew(V.pickedMesh,I,V)),!m.hasSwiped&&m.singleClick&&C.processTrigger(1,O.CreateNew(V.pickedMesh,I,V));const l=V.pickedMesh._getActionManagerForTrigger(6);m.JC&&l&&l.processTrigger(6,O.CreateNew(V.pickedMesh,I,V))}}else if(!m.ignore)for(const s of l._pointerUpStage)V=s.action(this._unTranslatedPointerX,this._unTranslatedPointerY,V,I,m.JC);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const V=this._pickedDownMesh._getActionManagerForTrigger(16);V&&V.processTrigger(16,O.CreateNew(this._pickedDownMesh,I))}if(!m.ignore){const C=new n.h(n.c.POINTERUP,I,V);if(this._setRayOnPointerInfo(V,I),l.onPointerObservable.notifyObservers(C,n.c.POINTERUP),l.onPointerUp&&l.onPointerUp(I,V,n.c.POINTERUP),!m.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let C=0;if(m.singleClick?C=n.c.POINTERTAP:m.JC&&(C=n.c.POINTERDOUBLETAP),C){const m=new n.h(C,I,V);l.onPointerObservable.hasObservers()&&l.onPointerObservable.hasSpecificMask(C)&&l.onPointerObservable.notifyObservers(m,C)}}}}isPointerCaptured(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._pointerCaptures[V]}attachControl(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const l=this._scene,s=l.getEngine();C||(C=s.getInputElement()),this._alreadyAttached&&this.sY(),C&&(this._alreadyAttachedTo=C),this._deviceSourceManager=new i(s),this._initActionManager=V=>{if(!this._meshPickProceed){const I=l.skipPointerUpPicking||0===l._registeredActions&&!this._checkForPicking()&&!l.onPointerUp?null:l.sm(this._unTranslatedPointerX,this._unTranslatedPointerY,l.pointerUpPredicate,l.pointerUpFastCheck,l.cameraToUseForPointers,l.pointerUpTrianglePredicate);this._currentPickResult=I,I&&(V=I.hit&&I.pickedMesh?I.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return V},this._delayedSimpleClick=(V,I,m)=>{if((Date.now()-this._previousStartingPointerTime>u.DoubleClickDelay&&!this._doubleClickOccured||V!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,I.singleClick=!0,I.ignore=!1,this._delayedClicks[V])){const I=this._delayedClicks[V].evt,m=n.c.POINTERTAP,C=new n.h(m,I,this._currentPickResult);l.onPointerObservable.hasObservers()&&l.onPointerObservable.hasSpecificMask(m)&&l.onPointerObservable.notifyObservers(C,m),this._delayedClicks[V]=null}},this._initClickEvent=(V,I,m,C)=>{const l=new P;this._currentPickResult=null;let s=null,F=V.hasSpecificMask(n.c.POINTERPICK)||I.hasSpecificMask(n.c.POINTERPICK)||V.hasSpecificMask(n.c.POINTERTAP)||I.hasSpecificMask(n.c.POINTERTAP)||V.hasSpecificMask(n.c.POINTERDOUBLETAP)||I.hasSpecificMask(n.c.POINTERDOUBLETAP);!F&&x&&(s=this._initActionManager(s,l),s&&(F=s.hasPickTriggers));let k=!1;if(F=F&&!this._isMultiTouchGesture,F){const F=m.button;if(l.hasSwiped=this._isPointerSwiping(),!l.hasSwiped){let K=!u.ExclusiveDoubleClickMode;if(K||(K=!V.hasSpecificMask(n.c.POINTERDOUBLETAP)&&!I.hasSpecificMask(n.c.POINTERDOUBLETAP),K&&!x.HasSpecificTrigger(6)&&(s=this._initActionManager(s,l),s&&(K=!s.hasSpecificTrigger(6)))),K)(Date.now()-this._previousStartingPointerTime>u.DoubleClickDelay||F!==this._previousButtonPressed)&&(l.singleClick=!0,C(l,this._currentPickResult),k=!0);else{const V={evt:m,clickInfo:l,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,F,l,C),u.DoubleClickDelay)};this._delayedClicks[F]=V}let Y=V.hasSpecificMask(n.c.POINTERDOUBLETAP)||I.hasSpecificMask(n.c.POINTERDOUBLETAP);if(!Y&&x.HasSpecificTrigger(6)&&(s=this._initActionManager(s,l),s&&(Y=s.hasSpecificTrigger(6))),Y)if(F===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<u.DoubleClickDelay&&!this._doubleClickOccured){if(l.hasSwiped||this._isPointerSwiping())if(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=F,u.ExclusiveDoubleClickMode){var j;if(this._delayedClicks[F])clearTimeout(null===(j=this._delayedClicks[F])||void 0===j?void 0:j.timeoutId),this._delayedClicks[F]=null;C(l,this._previousPickResult)}else C(l,this._currentPickResult);else{var E;if(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,l.JC=!0,l.ignore=!1,u.ExclusiveDoubleClickMode&&this._delayedClicks[F])clearTimeout(null===(E=this._delayedClicks[F])||void 0===E?void 0:E.timeoutId),this._delayedClicks[F]=null;C(l,this._currentPickResult)}k=!0}else this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=F}}k||C(l,this._currentPickResult)},this._onPointerMove=V=>{if(this._updatePointerPosition(V),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>u.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>u.DragMovementThreshold),s.isPointerLock&&s._verifyPointerLock(),this._checkPrePointerObservable(null,V,V.inputIndex>=c.MouseWheelX&&V.inputIndex<=c.MouseWheelZ?n.c.POINTERWHEEL:n.c.POINTERMOVE))return;if(!l.cameraToUseForPointers&&!l.activeCamera)return;if(l.XY)return void this._processPointerMove(new X.b,V);l.pointerMovePredicate||(l.pointerMovePredicate=V=>V.Tj&&V.isVisible&&V.isReady()&&V.isEnabled()&&(V.enablePointerMoveEvents||l.constantlyUpdateMeshUnderPointer||null!==V._getActionManagerForTrigger())&&(!l.cameraToUseForPointers||0!==(l.cameraToUseForPointers.layerMask&V.layerMask)));const I=l._registeredActions>0||l.constantlyUpdateMeshUnderPointer?this._pickMove(V):null;this._processPointerMove(I,V)},this._onPointerDown=V=>{const I=this._activePointerIds.indexOf(-1);if(-1===I?this._activePointerIds.push(V.pointerId):this._activePointerIds[I]=V.pointerId,this._activePointerIdsCount++,this._pickedDownMesh=null,this._meshPickProceed=!1,u.ExclusiveDoubleClickMode)for(let C=0;C<this._delayedClicks.length;C++)if(this._delayedClicks[C])if(V.button===C){var m;clearTimeout(null===(m=this._delayedClicks[C])||void 0===m?void 0:m.timeoutId)}else{const V=this._delayedClicks[C].clickInfo;this._doubleClickOccured=!1,V.singleClick=!0,V.ignore=!1;const I=this._delayedClicks[C].evt,m=n.c.POINTERTAP,s=new n.h(m,I,this._currentPickResult);l.onPointerObservable.hasObservers()&&l.onPointerObservable.hasSpecificMask(m)&&l.onPointerObservable.notifyObservers(s,m),this._delayedClicks[C]=null}if(this._updatePointerPosition(V),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=V.button),l.preventDefaultOnPointerDown&&C&&(V.preventDefault(),C.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,V,n.c.POINTERDOWN))return;if(!l.cameraToUseForPointers&&!l.activeCamera)return;let s;this._pointerCaptures[V.pointerId]=!0,l.pointerDownPredicate||(l.pointerDownPredicate=V=>V.Tj&&V.isVisible&&V.isReady()&&V.isEnabled()&&(!l.cameraToUseForPointers||0!==(l.cameraToUseForPointers.layerMask&V.layerMask))),this._pickedDownMesh=null,s=l.skipPointerDownPicking||0===l._registeredActions&&!this._checkForPicking()&&!l.onPointerDown?new X.b:l.sm(this._unTranslatedPointerX,this._unTranslatedPointerY,l.pointerDownPredicate,l.pointerDownFastCheck,l.cameraToUseForPointers,l.pointerDownTrianglePredicate),this._processPointerDown(s,V)},this._onPointerUp=V=>{const I=this._activePointerIds.indexOf(V.pointerId);-1!==I&&(this._activePointerIds[I]=-1,this._activePointerIdsCount--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(V),l.preventDefaultOnPointerUp&&C&&(V.preventDefault(),C.focus()),this._initClickEvent(l.onPrePointerObservable,l.onPointerObservable,V,((I,m)=>{if(l.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!I.ignore)){if(this._checkPrePointerObservable(null,V,n.c.POINTERUP))return this._swipeButtonPressed===V.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),void(0===V.buttons&&(this._pointerCaptures[V.pointerId]=!1));I.hasSwiped||(I.singleClick&&l.onPrePointerObservable.hasSpecificMask(n.c.POINTERTAP)&&this._checkPrePointerObservable(null,V,n.c.POINTERTAP)&&(this._skipPointerTap=!0),I.JC&&l.onPrePointerObservable.hasSpecificMask(n.c.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,V,n.c.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}this._pointerCaptures[V.pointerId]?(0===V.buttons&&(this._pointerCaptures[V.pointerId]=!1),(l.cameraToUseForPointers||l.activeCamera)&&(l.pointerUpPredicate||(l.pointerUpPredicate=V=>V.Tj&&V.isVisible&&V.isReady()&&V.isEnabled()&&(!l.cameraToUseForPointers||0!==(l.cameraToUseForPointers.layerMask&V.layerMask))),!this._meshPickProceed&&(x&&x.HasTriggers||this._checkForPicking()||l.onPointerUp)&&this._initActionManager(null,I),m||(m=this._currentPickResult),this._processPointerUp(m,V,I),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===V.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))):this._swipeButtonPressed===V.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1)})))},this._onKeyDown=V=>{const I=W.c.KEYDOWN;if(l.onPreKeyboardObservable.hasObservers()){const m=new W.d(I,V);if(l.onPreKeyboardObservable.notifyObservers(m,I),m.skipOnKeyboardObservable)return}if(l.onKeyboardObservable.hasObservers()){const m=new W.g(I,V);l.onKeyboardObservable.notifyObservers(m,I)}l.actionManager&&l.actionManager.processTrigger(14,O.CreateNewFromScene(l,V))},this._onKeyUp=V=>{const I=W.c.KEYUP;if(l.onPreKeyboardObservable.hasObservers()){const m=new W.d(I,V);if(l.onPreKeyboardObservable.notifyObservers(m,I),m.skipOnKeyboardObservable)return}if(l.onKeyboardObservable.hasObservers()){const m=new W.g(I,V);l.onKeyboardObservable.notifyObservers(m,I)}l.actionManager&&l.actionManager.processTrigger(15,O.CreateNewFromScene(l,V))},this._deviceSourceManager.onDeviceConnectedObservable.add((C=>{C.deviceType===S.Mouse?C.onInputChangedObservable.add((l=>{this._originMouseEvent=l,l.inputIndex===c.LeftClick||l.inputIndex===c.MiddleClick||l.inputIndex===c.RightClick||l.inputIndex===c.BrowserBack||l.inputIndex===c.BrowserForward?I&&1===C.getInput(l.inputIndex)?this._onPointerDown(l):V&&0===C.getInput(l.inputIndex)&&this._onPointerUp(l):m&&(l.inputIndex===c.Move?this._onPointerMove(l):l.inputIndex!==c.MouseWheelX&&l.inputIndex!==c.MouseWheelY&&l.inputIndex!==c.MouseWheelZ||this._onPointerMove(l))})):C.deviceType===S.Touch?C.onInputChangedObservable.add((l=>{l.inputIndex===c.LeftClick&&(I&&1===C.getInput(l.inputIndex)?(this._onPointerDown(l),this._activePointerIdsCount>1&&(this._isMultiTouchGesture=!0)):V&&0===C.getInput(l.inputIndex)&&(this._onPointerUp(l),0===this._activePointerIdsCount&&(this._isMultiTouchGesture=!1))),m&&l.inputIndex===c.Move&&this._onPointerMove(l)})):C.deviceType===S.Keyboard&&C.onInputChangedObservable.add((V=>{"keydown"===V.type?this._onKeyDown(V):"keyup"===V.type&&this._onKeyUp(V)}))})),this._alreadyAttached=!0}sY(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2?arguments[2]:void 0,C=arguments.length>3?arguments[3]:void 0;if(this._meshUnderPointerId[I]===V&&(!V||!V._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const l=this._meshUnderPointerId[I];let s;l&&(s=l._getActionManagerForTrigger(10),s&&s.processTrigger(10,new O(l,this._pointerX,this._pointerY,V,C,{pointerId:I}))),V?(this._meshUnderPointerId[I]=V,this._pointerOverMesh=V,s=V._getActionManagerForTrigger(9),s&&s.processTrigger(9,new O(V,this._pointerX,this._pointerY,V,C,{pointerId:I,pickResult:m}))):(delete this._meshUnderPointerId[I],this._pointerOverMesh=null),this._scene.onMeshUnderPointerUpdatedObservable.hasObservers()&&this._scene.onMeshUnderPointerUpdatedObservable.notifyObservers({mesh:V,pointerId:I})}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(V){this._pointerOverMesh===V&&(this._pointerOverMesh=null),this._pickedDownMesh===V&&(this._pickedDownMesh=null),this._pickedUpMesh===V&&(this._pickedUpMesh=null);for(const I in this._meshUnderPointerId)this._meshUnderPointerId[I]===V&&delete this._meshUnderPointerId[I]}}u.DragMovementThreshold=10,u.LongPressDelay=500,u.DoubleClickDelay=300,u.ExclusiveDoubleClickMode=!1;var o=m(11510),p=m(11312),M=m(11400),f=m(11639),w=m(11102),A=m(11320),J=m(11046);class U{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.XY=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}var e,a=m(11085),L=m(11048);!function(V){V[V.BackwardCompatible=0]="BackwardCompatible",V[V.Intermediate=1]="Intermediate",V[V.Aggressive=2]="Aggressive"}(e||(e={}));class VV{static DefaultMaterialFactory(V){throw(0,T.c)("Xk")}static CollisionCoordinatorFactory(){throw(0,T.c)("DefaultCollisionCoordinator")}get clearColor(){return this._clearColor}set clearColor(V){V!==this._clearColor&&(this._clearColor=V,this.onClearColorChangedObservable.notifyObservers(this._clearColor))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get performancePriority(){return this._performancePriority}set performancePriority(V){if(V!==this._performancePriority){switch(this._performancePriority=V,V){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.XY=!1,this.FY=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.XY=!0,this.FY=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.XY=!0,this.FY=!1}this.onScenePerformancePriorityChangedObservable.notifyObservers(V)}}set forceWireframe(V){this._forceWireframe!==V&&(this._forceWireframe=V,this.markAllMaterialsAsDirty(16))}get forceWireframe(){return this._forceWireframe}set skipFrustumClipping(V){this._skipFrustumClipping!==V&&(this._skipFrustumClipping=V)}get skipFrustumClipping(){return this._skipFrustumClipping}set forcePointsCloud(V){this._forcePointsCloud!==V&&(this._forcePointsCloud=V,this.markAllMaterialsAsDirty(16))}get forcePointsCloud(){return this._forcePointsCloud}get environmentTexture(){return this._environmentTexture}set environmentTexture(V){this._environmentTexture!==V&&(this._environmentTexture=V,this.onEnvironmentTextureChangedObservable.notifyObservers(V),this.markAllMaterialsAsDirty(1))}getNodes(){let V=[];V=V.concat(this.meshes),V=V.concat(this.lights),V=V.concat(this.cameras),V=V.concat(this.transformNodes);for(const I of this.skeletons)V=V.concat(I.bones);return V}get animationPropertiesOverride(){return this._animationPropertiesOverride}set animationPropertiesOverride(V){this._animationPropertiesOverride=V}set onDispose(V){this._onDisposeObserver&&this.Ck.remove(this._onDisposeObserver),this._onDisposeObserver=this.Ck.add(V)}set beforeRender(V){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),V&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(V))}set afterRender(V){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),V&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(V))}set beforeCameraRender(V){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(V)}set afterCameraRender(V){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(V)}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}set pointerDownPredicate(V){this._pointerPickingConfiguration.pointerDownPredicate=V}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}set pointerUpPredicate(V){this._pointerPickingConfiguration.pointerUpPredicate=V}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}set pointerMovePredicate(V){this._pointerPickingConfiguration.pointerMovePredicate=V}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}set pointerDownFastCheck(V){this._pointerPickingConfiguration.pointerDownFastCheck=V}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}set pointerUpFastCheck(V){this._pointerPickingConfiguration.pointerUpFastCheck=V}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}set pointerMoveFastCheck(V){this._pointerPickingConfiguration.pointerMoveFastCheck=V}get XY(){return this._pointerPickingConfiguration.XY}set XY(V){this._pointerPickingConfiguration.XY=V}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}set skipPointerDownPicking(V){this._pointerPickingConfiguration.skipPointerDownPicking=V}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}set skipPointerUpPicking(V){this._pointerPickingConfiguration.skipPointerUpPicking=V}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}static get DragMovementThreshold(){return u.DragMovementThreshold}static set DragMovementThreshold(V){u.DragMovementThreshold=V}static get LongPressDelay(){return u.LongPressDelay}static set LongPressDelay(V){u.LongPressDelay=V}static get DoubleClickDelay(){return u.DoubleClickDelay}static set DoubleClickDelay(V){u.DoubleClickDelay=V}static get ExclusiveDoubleClickMode(){return u.ExclusiveDoubleClickMode}static set ExclusiveDoubleClickMode(V){u.ExclusiveDoubleClickMode=V}bindEyePosition(V){var I;let m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vEyePosition",C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const l=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:(null===(I=this.activeCamera)||void 0===I?void 0:I.globalPosition)??E.m.ZeroReadOnly,s=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return E.g.Vector4[0].set(l.x,l.y,l.z,s?-1:1),V&&(C?V.setFloat3(m,E.g.Vector4[0].x,E.g.Vector4[0].y,E.g.Vector4[0].z):V.setVector4(m,E.g.Vector4[0])),E.g.Vector4[0]}finalizeSceneUbo(){const V=this.getSceneUniformBuffer(),I=this.bindEyePosition(null);return V.updateFloat4("vEyePosition",I.x,I.y,I.z,I.w),V.update(),V}set useRightHandedSystem(V){this._useRightHandedSystem!==V&&(this._useRightHandedSystem=V,this.markAllMaterialsAsDirty(16))}get useRightHandedSystem(){return this._useRightHandedSystem}setStepId(V){this._currentStepId=V}getStepId(){return this._currentStepId}getInternalStep(){return this._currentInternalStep}set fogEnabled(V){this._fogEnabled!==V&&(this._fogEnabled=V,this.markAllMaterialsAsDirty(16))}get fogEnabled(){return this._fogEnabled}set fogMode(V){this._fogMode!==V&&(this._fogMode=V,this.markAllMaterialsAsDirty(16))}get fogMode(){return this._fogMode}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set shadowsEnabled(V){this._shadowsEnabled!==V&&(this._shadowsEnabled=V,this.markAllMaterialsAsDirty(2))}get shadowsEnabled(){return this._shadowsEnabled}set lightsEnabled(V){this._lightsEnabled!==V&&(this._lightsEnabled=V,this.markAllMaterialsAsDirty(2))}get lightsEnabled(){return this._lightsEnabled}get activeCameras(){return this._activeCameras}set activeCameras(V){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),V&&(this._unObserveActiveCameras=(0,J.l)(V,(()=>{this.onActiveCamerasChanged.notifyObservers(this)}))),this._activeCameras=V}get activeCamera(){return this._activeCamera}set activeCamera(V){V!==this._activeCamera&&(this._activeCamera=V,this.onActiveCameraChanged.notifyObservers(this))}get _hasDefaultMaterial(){return VV.DefaultMaterialFactory!==VV._OriginalDefaultMaterialFactory}get defaultMaterial(){return this.hK||(this.hK=VV.DefaultMaterialFactory(this)),this.hK}set defaultMaterial(V){this.hK=V}set texturesEnabled(V){this._texturesEnabled!==V&&(this._texturesEnabled=V,this.markAllMaterialsAsDirty(1))}get texturesEnabled(){return this._texturesEnabled}get frameGraph(){return this._frameGraph}set frameGraph(V){if(this._frameGraph)return this._frameGraph=V,void(V||(this.customRenderFunction=this._currentCustomRenderFunction));this._frameGraph=V,V&&(this._currentCustomRenderFunction=this.customRenderFunction,this.customRenderFunction=this._renderWithFrameGraph,this.activeCamera=null)}set skeletonsEnabled(V){this._skeletonsEnabled!==V&&(this._skeletonsEnabled=V,this.markAllMaterialsAsDirty(8))}get skeletonsEnabled(){return this._skeletonsEnabled}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=VV.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get renderingManager(){return this._renderingManager}get frustumPlanes(){return this._frustumPlanes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const V of this._transientComponents)V.register();this._transientComponents.length=0}}o(V){this._components.push(V),this._transientComponents.push(V);const I=V;I.addFromContainer&&I.serialize&&this._serializableComponents.push(I)}_getComponent(V){for(const I of this._components)if(I.name===V)return I;return null}get uniqueId(){return this._uniqueId}constructor(V,I){this._inputManager=new u(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.FY=!0,this.autoClearDepthAndStencil=!0,this._clearColor=new p.d(.2,.2,.3,1),this.onClearColorChangedObservable=new s.e,this.ambientColor=new p.c(0,0,0),this.environmentIntensity=1,this.iblIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new s.e,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.ZY=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.effectLayers=[],this.KX=null,this.layers=[],this.lensFlareSystems=[],this.proceduralTextures=[],this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.Ck=new s.e,this._onDisposeObserver=null,this.onBeforeRenderObservable=new s.e,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new s.e,this.onAfterRenderCameraObservable=new s.e,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new s.e,this.onAfterAnimationsObservable=new s.e,this.onBeforeDrawPhaseObservable=new s.e,this.onAfterDrawPhaseObservable=new s.e,this.onReadyObservable=new s.e,this.onBeforeCameraRenderObservable=new s.e,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new s.e,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new s.e,this.onAfterActiveMeshesEvaluationObservable=new s.e,this.onBeforeParticlesRenderingObservable=new s.e,this.onAfterParticlesRenderingObservable=new s.e,this.onDataLoadedObservable=new s.e,this.onNewCameraAddedObservable=new s.e,this.onCameraRemovedObservable=new s.e,this.onNewLightAddedObservable=new s.e,this.onLightRemovedObservable=new s.e,this.onNewGeometryAddedObservable=new s.e,this.onGeometryRemovedObservable=new s.e,this.onNewTransformNodeAddedObservable=new s.e,this.onTransformNodeRemovedObservable=new s.e,this.onNewMeshAddedObservable=new s.e,this.onMeshRemovedObservable=new s.e,this.onNewSkeletonAddedObservable=new s.e,this.onSkeletonRemovedObservable=new s.e,this.onNewMaterialAddedObservable=new s.e,this.onNewMultiMaterialAddedObservable=new s.e,this.onMaterialRemovedObservable=new s.e,this.onMultiMaterialRemovedObservable=new s.e,this.onNewTextureAddedObservable=new s.e,this.onTextureRemovedObservable=new s.e,this.onBeforeRenderTargetsRenderObservable=new s.e,this.onAfterRenderTargetsRenderObservable=new s.e,this.onBeforeStepObservable=new s.e,this.onAfterStepObservable=new s.e,this.onActiveCameraChanged=new s.e,this.onActiveCamerasChanged=new s.e,this.onBeforeRenderingGroupObservable=new s.e,this.onAfterRenderingGroupObservable=new s.e,this.onMeshImportedObservable=new s.e,this.onAnimationFileImportedObservable=new s.e,this.onEnvironmentTextureChangedObservable=new s.e,this.onMeshUnderPointerUpdatedObservable=new s.e,this._registeredForLateAnimationBindings=new F.c(256),this._pointerPickingConfiguration=new U,this.onPrePointerObservable=new s.e,this.onPointerObservable=new s.e,this.onPreKeyboardObservable=new s.e,this.onKeyboardObservable=new s.e,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=VV.FOGMODE_NONE,this.fogColor=new p.c(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this._frameGraph=null,this.frameGraphs=[],this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new E.m(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new F.c(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new o.e,this._activeIndices=new o.e,this._activeParticles=new o.e,this._activeBones=new o.e,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=[],this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new F.g(256),this._processedMaterials=new F.g(256),this._renderTargets=new F.c(256),this._materialsRenderTargets=new F.c(256),this._activeParticleSystems=new F.g(256),this._activeSkeletons=new F.c(32),this._softwareSkinnedMeshes=new F.c(32),this._activeAnimatables=new Array,this._transformMatrix=E.b.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=t.e.Create(),this._beforeClearStage=t.e.Create(),this._beforeRenderTargetClearStage=t.e.Create(),this._gatherRenderTargetsStage=t.e.Create(),this._gatherActiveCameraRenderTargetsStage=t.e.Create(),this._isReadyForMeshStage=t.e.Create(),this._beforeEvaluateActiveMeshStage=t.e.Create(),this._evaluateSubMeshStage=t.e.Create(),this._preActiveMeshStage=t.e.Create(),this._cameraDrawRenderTargetStage=t.e.Create(),this._beforeCameraDrawStage=t.e.Create(),this._beforeRenderTargetDrawStage=t.e.Create(),this._beforeRenderingGroupDrawStage=t.e.Create(),this._beforeRenderingMeshStage=t.e.Create(),this._afterRenderingMeshStage=t.e.Create(),this._afterRenderingGroupDrawStage=t.e.Create(),this._afterCameraDrawStage=t.e.Create(),this._afterCameraPostProcessStage=t.e.Create(),this._afterRenderTargetDrawStage=t.e.Create(),this._afterRenderTargetPostProcessStage=t.e.Create(),this._afterRenderStage=t.e.Create(),this._pointerMoveStage=t.e.Create(),this._pointerDownStage=t.e.Create(),this._pointerUpStage=t.e.Create(),this._geometriesByUniqueId=null,this._uniqueId=0,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._useCurrentFrameBuffer=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[],this._uniqueId=this.getUniqueId();const m={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...I};V=this._engine=V||b.c.LastCreatedEngine,m.virtual?V._virtualScenes.push(this):(b.c._LastCreatedScene=this,V.scenes.push(this)),this._uid=null,this._renderingManager=new N.c(this),v.d&&(this.postProcessManager=new v.d(this)),(0,D.o)()&&this.attachControl(),this._createUbo(),K.e&&(this._imageProcessingConfiguration=new K.e),this.setDefaultCandidateProviders(),m.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=m.useMaterialMeshMap,this.useClonedMeshMap=m.useClonedMeshMap,I&&I.virtual||V.onNewSceneAddedObservable.notifyObservers(this)}getClassName(){return"Scene"}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_getDefaultSubMeshCandidates(V){return this._defaultSubMeshCandidates.data=V.kk,this._defaultSubMeshCandidates.length=V.kk.length,this._defaultSubMeshCandidates}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=V=>this._getDefaultSubMeshCandidates(V),this.getIntersectingSubMeshCandidates=(V,I)=>this._getDefaultSubMeshCandidates(V),this.getCollidingSubMeshCandidates=(V,I)=>this._getDefaultSubMeshCandidates(V)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}get pointerX(){return this._inputManager.pointerX}set pointerX(V){this._inputManager.pointerX=V}get pointerY(){return this._inputManager.pointerY}set pointerY(V){this._inputManager.pointerY=V}getCachedMaterial(){return this._cachedMaterial}getCachedEffect(){return this._cachedEffect}getCachedVisibility(){return this._cachedVisibility}isCachedMaterialInvalid(V,I){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this._cachedEffect!==I||this._cachedMaterial!==V||this._cachedVisibility!==m}getEngine(){return this._engine}getTotalVertices(){return this._totalVertices.current}get totalVerticesPerfCounter(){return this._totalVertices}getActiveIndices(){return this._activeIndices.current}get totalActiveIndicesPerfCounter(){return this._activeIndices}getActiveParticles(){return this._activeParticles.current}get activeParticlesPerfCounter(){return this._activeParticles}getActiveBones(){return this._activeBones.current}get activeBonesPerfCounter(){return this._activeBones}getActiveMeshes(){return this._activeMeshes}getAnimationRatio(){return void 0!==this._animationRatio?this._animationRatio:1}getRenderId(){return this._renderId}getFrameId(){return this._frameId}incrementRenderId(){this._renderId++}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}simulatePointerMove(V,I){return this._inputManager.simulatePointerMove(V,I),this}simulatePointerDown(V,I){return this._inputManager.simulatePointerDown(V,I),this}simulatePointerUp(V,I,m){return this._inputManager.simulatePointerUp(V,I,m),this}isPointerCaptured(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._inputManager.isPointerCaptured(V)}attachControl(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._inputManager.attachControl(V,I,m)}sY(){this._inputManager.sY()}isReady(){var V,I;let m,C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._isDisposed)return!1;const l=this.getEngine(),s=l.currentRenderPassId;l.currentRenderPassId=(null===(V=this.activeCamera)||void 0===V?void 0:V.renderPassId)??s;let F=!0;for(this._pendingData.length>0&&(F=!1),null===(I=this.prePassRenderer)||void 0===I||I.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&F&&(F=this.depthPeelingRenderer.isReady()),C&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),m=0;m<this.meshes.length;m++){const V=this.meshes[m];if(!V.kk||0===V.kk.length)continue;if(!V.isReady(!0)){F=!1;continue}const I=V.hasThinInstances||"InstancedMesh"===V.getClassName()||"InstancedLinesMesh"===V.getClassName()||l.getCaps().instancedArrays&&V.instances.length>0;for(const m of this._isReadyForMeshStage)m.action(V,I)||(F=!1);if(!C)continue;const s=V.material||this.defaultMaterial;if(s)if(s._storeEffectOnSubMeshes)for(const m of V.kk){const V=m.dV();V&&V.hasRenderTargetTextures&&null!=V.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(V)&&(this._processedMaterials.push(V),this._materialsRenderTargets.concatWithNoDuplicate(V.getRenderTargetTextures()))}else s.hasRenderTargetTextures&&null!=s.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(s)&&(this._processedMaterials.push(s),this._materialsRenderTargets.concatWithNoDuplicate(s.getRenderTargetTextures()))}if(C)for(m=0;m<this._materialsRenderTargets.length;++m){this._materialsRenderTargets.data[m].isReadyForRendering()||(F=!1)}for(m=0;m<this.geometries.length;m++){2===this.geometries[m].delayLoadState&&(F=!1)}if(this.activeCameras&&this.activeCameras.length>0)for(const k of this.activeCameras)k.isReady(!0)||(F=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(F=!1));for(const k of this.ZY)k.isReady()||(F=!1);if(this.layers)for(const k of this.layers)k.isReady()||(F=!1);if(this.effectLayers)for(const k of this.effectLayers)k.isLayerReady()||(F=!1);return l.areAllEffectsReady()||(F=!1),l.currentRenderPassId=s,F}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}registerBeforeRender(V){this.onBeforeRenderObservable.add(V)}unregisterBeforeRender(V){this.onBeforeRenderObservable.removeCallback(V)}registerAfterRender(V){this.onAfterRenderObservable.add(V)}unregisterAfterRender(V){this.onAfterRenderObservable.removeCallback(V)}_executeOnceBeforeRender(V){const I=()=>{V(),setTimeout((()=>{this.unregisterBeforeRender(I)}))};this.registerBeforeRender(I)}executeOnceBeforeRender(V,I){void 0!==I?setTimeout((()=>{this._executeOnceBeforeRender(V)}),I):this._executeOnceBeforeRender(V)}addPendingData(V){this._pendingData.push(V)}removePendingData(V){const I=this.isLoading,m=this._pendingData.indexOf(V);-1!==m&&this._pendingData.splice(m,1),I&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}getWaitingItemsCount(){return this._pendingData.length}get isLoading(){return this._pendingData.length>0}executeWhenReady(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.onReadyObservable.addOnce(V),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(I)}async whenReadyAsync(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return await new Promise((I=>{this.executeWhenReady((()=>{I()}),V)}))}_checkIsReady(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._registerTransientComponents(),this.isReady(V)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((()=>{this.incrementRenderId(),this._checkIsReady(V)}),100))}get animatables(){return this._activeAnimatables}resetLastAnimationTimeFrame(){this._animationTimeLast=l.d.Now}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projectionMatrix}getTransformMatrix(){return this._transformMatrix}setTransformMatrix(V,I,m,C){m||C||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===V.updateFlag&&this._projectionUpdateFlag===I.updateFlag||(this._viewUpdateFlag=V.updateFlag,this._projectionUpdateFlag=I.updateFlag,this._viewMatrix=V,this._projectionMatrix=I,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?M.b.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=M.b.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(m,C):this._sceneUbo.useUbo&&(this._sceneUbo.lk("viewProjection",this._transformMatrix),this._sceneUbo.lk("view",this._viewMatrix),this._sceneUbo.lk("projection",this._projectionMatrix)))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}createSceneUniformBuffer(V){const I=new Y.e(this._engine,void 0,!1,V??"OI");return I.addUniform("viewProjection",16),I.addUniform("view",16),I.addUniform("projection",16),I.addUniform("vEyePosition",4),I}setSceneUniformBuffer(V){this._sceneUbo=V,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}getUniqueId(){return f.d.UniqueId}GE(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._blockEntityCollection&&(this.meshes.push(V),V._resyncLightSources(),V.parent||V._addToSceneRootNodes(),C.d.SetImmediate((()=>{this.onNewMeshAddedObservable.notifyObservers(V)})),I)){const I=V.getChildMeshes();for(const V of I)this.GE(V)}}QE(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const m=this.meshes.indexOf(V);if(-1!==m&&(this.meshes.splice(m,1),V.parent||V._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(V),this.onMeshRemovedObservable.notifyObservers(V),I){const I=V.getChildMeshes();for(const V of I)this.QE(V)}return m}addTransformNode(V){this._blockEntityCollection||V.cV()===this&&-1!==V._indexInSceneTransformNodesArray||(V._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(V),V.parent||V._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(V))}removeTransformNode(V){const I=V._indexInSceneTransformNodesArray;if(-1!==I){if(I!==this.transformNodes.length-1){const V=this.transformNodes[this.transformNodes.length-1];this.transformNodes[I]=V,V._indexInSceneTransformNodesArray=I}V._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),V.parent||V._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(V),I}removeSkeleton(V){const I=this.skeletons.indexOf(V);return-1!==I&&(this.skeletons.splice(I,1),this.onSkeletonRemovedObservable.notifyObservers(V),this._executeActiveContainerCleanup(this._activeSkeletons)),I}removeMorphTargetManager(V){const I=this.morphTargetManagers.indexOf(V);return-1!==I&&this.morphTargetManagers.splice(I,1),I}removeLight(V){const I=this.lights.indexOf(V);if(-1!==I){for(const I of this.meshes)I._removeLightSource(V,!1);this.lights.splice(I,1),this.sortLightsByPriority(),V.parent||V._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(V),I}removeCamera(V){const I=this.cameras.indexOf(V);if(-1!==I&&(this.cameras.splice(I,1),V.parent||V._removeFromSceneRootNodes()),this.activeCameras){const I=this.activeCameras.indexOf(V);-1!==I&&this.activeCameras.splice(I,1)}return this.activeCamera===V&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(V),I}removeParticleSystem(V){const I=this.ZY.indexOf(V);return-1!==I&&(this.ZY.splice(I,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),I}removeAnimation(V){const I=this.animations.indexOf(V);return-1!==I&&this.animations.splice(I,1),I}stopAnimation(V,I,m){}removeAnimationGroup(V){const I=this.animationGroups.indexOf(V);return-1!==I&&this.animationGroups.splice(I,1),I}removeMultiMaterial(V){const I=this.multiMaterials.indexOf(V);return-1!==I&&this.multiMaterials.splice(I,1),this.onMultiMaterialRemovedObservable.notifyObservers(V),I}removeMaterial(V){const I=V._indexInSceneMaterialArray;if(-1!==I&&I<this.materials.length){if(I!==this.materials.length-1){const V=this.materials[this.materials.length-1];this.materials[I]=V,V._indexInSceneMaterialArray=I}V._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(V),I}removeActionManager(V){const I=this.actionManagers.indexOf(V);return-1!==I&&this.actionManagers.splice(I,1),I}removeTexture(V){const I=this.textures.indexOf(V);return-1!==I&&this.textures.splice(I,1),this.onTextureRemovedObservable.notifyObservers(V),I}addLight(V){if(!this._blockEntityCollection){this.lights.push(V),this.sortLightsByPriority(),V.parent||V._addToSceneRootNodes();for(const I of this.meshes)-1===I.lightSources.indexOf(V)&&(I.lightSources.push(V),I._resyncLightSources());C.d.SetImmediate((()=>{this.onNewLightAddedObservable.notifyObservers(V)}))}}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(A.b.CompareLightsPriority)}addCamera(V){this._blockEntityCollection||(this.cameras.push(V),C.d.SetImmediate((()=>{this.onNewCameraAddedObservable.notifyObservers(V)})),V.parent||V._addToSceneRootNodes())}addSkeleton(V){this._blockEntityCollection||(this.skeletons.push(V),C.d.SetImmediate((()=>{this.onNewSkeletonAddedObservable.notifyObservers(V)})))}addParticleSystem(V){this._blockEntityCollection||this.ZY.push(V)}addAnimation(V){this._blockEntityCollection||this.animations.push(V)}addAnimationGroup(V){this._blockEntityCollection||this.animationGroups.push(V)}addMultiMaterial(V){this._blockEntityCollection||(this.multiMaterials.push(V),C.d.SetImmediate((()=>{this.onNewMultiMaterialAddedObservable.notifyObservers(V)})))}addMaterial(V){this._blockEntityCollection||V.cV()===this&&-1!==V._indexInSceneMaterialArray||(V._indexInSceneMaterialArray=this.materials.length,this.materials.push(V),C.d.SetImmediate((()=>{this.onNewMaterialAddedObservable.notifyObservers(V)})))}addMorphTargetManager(V){this._blockEntityCollection||this.morphTargetManagers.push(V)}addGeometry(V){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[V.uniqueId]=this.geometries.length),this.geometries.push(V))}addActionManager(V){this.actionManagers.push(V)}addTexture(V){this._blockEntityCollection||(this.textures.push(V),this.onNewTextureAddedObservable.notifyObservers(V))}switchActiveCamera(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.sY(),this.activeCamera=V,I&&V.attachControl())}setActiveCameraById(V){const I=this.getCameraById(V);return I?(this.activeCamera=I,I):null}setActiveCameraByName(V){const I=this.getCameraByName(V);return I?(this.activeCamera=I,I):null}getAnimationGroupByName(V){for(let I=0;I<this.animationGroups.length;I++)if(this.animationGroups[I].name===V)return this.animationGroups[I];return null}_getMaterial(V,I){for(let m=0;m<this.materials.length;m++){const V=this.materials[m];if(I(V))return V}if(V)for(let m=0;m<this.multiMaterials.length;m++){const V=this.multiMaterials[m];if(I(V))return V}return null}getMaterialByUniqueID(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.getMaterialByUniqueId(V,I)}getMaterialByUniqueId(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(I,(I=>I.uniqueId===V))}getMaterialById(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(I,(I=>I.id===V))}getMaterialByName(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(I,(I=>I.name===V))}getLastMaterialById(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(let m=this.materials.length-1;m>=0;m--)if(this.materials[m].id===V)return this.materials[m];if(I)for(let m=this.multiMaterials.length-1;m>=0;m--)if(this.multiMaterials[m].id===V)return this.multiMaterials[m];return null}getTextureByUniqueId(V){for(let I=0;I<this.textures.length;I++)if(this.textures[I].uniqueId===V)return this.textures[I];return null}getTextureByName(V){for(let I=0;I<this.textures.length;I++)if(this.textures[I].name===V)return this.textures[I];return null}getCameraById(V){for(let I=0;I<this.cameras.length;I++)if(this.cameras[I].id===V)return this.cameras[I];return null}getCameraByUniqueId(V){for(let I=0;I<this.cameras.length;I++)if(this.cameras[I].uniqueId===V)return this.cameras[I];return null}getCameraByName(V){for(let I=0;I<this.cameras.length;I++)if(this.cameras[I].name===V)return this.cameras[I];return null}getBoneById(V){for(let I=0;I<this.skeletons.length;I++){const m=this.skeletons[I];for(let I=0;I<m.bones.length;I++)if(m.bones[I].id===V)return m.bones[I]}return null}getBoneByName(V){for(let I=0;I<this.skeletons.length;I++){const m=this.skeletons[I];for(let I=0;I<m.bones.length;I++)if(m.bones[I].name===V)return m.bones[I]}return null}getLightByName(V){for(let I=0;I<this.lights.length;I++)if(this.lights[I].name===V)return this.lights[I];return null}getLightById(V){for(let I=0;I<this.lights.length;I++)if(this.lights[I].id===V)return this.lights[I];return null}getLightByUniqueId(V){for(let I=0;I<this.lights.length;I++)if(this.lights[I].uniqueId===V)return this.lights[I];return null}getParticleSystemById(V){for(let I=0;I<this.ZY.length;I++)if(this.ZY[I].id===V)return this.ZY[I];return null}getGeometryById(V){for(let I=0;I<this.geometries.length;I++)if(this.geometries[I].id===V)return this.geometries[I];return null}_getGeometryByUniqueId(V){if(this._geometriesByUniqueId){const I=this._geometriesByUniqueId[V];if(void 0!==I)return this.geometries[I]}else for(let I=0;I<this.geometries.length;I++)if(this.geometries[I].uniqueId===V)return this.geometries[I];return null}getFrameGraphByName(V){for(let I=0;I<this.frameGraphs.length;I++)if(this.frameGraphs[I].name===V)return this.frameGraphs[I];return null}pushGeometry(V,I){return!(!I&&this._getGeometryByUniqueId(V.uniqueId))&&(this.addGeometry(V),C.d.SetImmediate((()=>{this.onNewGeometryAddedObservable.notifyObservers(V)})),!0)}removeGeometry(V){let I;if(this._geometriesByUniqueId){if(I=this._geometriesByUniqueId[V.uniqueId],void 0===I)return!1}else if(I=this.geometries.indexOf(V),I<0)return!1;if(I!==this.geometries.length-1){const V=this.geometries[this.geometries.length-1];V&&(this.geometries[I]=V,this._geometriesByUniqueId&&(this._geometriesByUniqueId[V.uniqueId]=I))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[V.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(V),!0}getGeometries(){return this.geometries}getMeshById(V){for(let I=0;I<this.meshes.length;I++)if(this.meshes[I].id===V)return this.meshes[I];return null}getMeshesById(V){return this.meshes.filter((function(I){return I.id===V}))}getTransformNodeById(V){for(let I=0;I<this.transformNodes.length;I++)if(this.transformNodes[I].id===V)return this.transformNodes[I];return null}getTransformNodeByUniqueId(V){for(let I=0;I<this.transformNodes.length;I++)if(this.transformNodes[I].uniqueId===V)return this.transformNodes[I];return null}getTransformNodesById(V){return this.transformNodes.filter((function(I){return I.id===V}))}getMeshByUniqueId(V){for(let I=0;I<this.meshes.length;I++)if(this.meshes[I].uniqueId===V)return this.meshes[I];return null}getLastMeshById(V){for(let I=this.meshes.length-1;I>=0;I--)if(this.meshes[I].id===V)return this.meshes[I];return null}getLastTransformNodeById(V){for(let I=this.transformNodes.length-1;I>=0;I--)if(this.transformNodes[I].id===V)return this.transformNodes[I];return null}getLastEntryById(V){let I;for(I=this.meshes.length-1;I>=0;I--)if(this.meshes[I].id===V)return this.meshes[I];for(I=this.transformNodes.length-1;I>=0;I--)if(this.transformNodes[I].id===V)return this.transformNodes[I];for(I=this.cameras.length-1;I>=0;I--)if(this.cameras[I].id===V)return this.cameras[I];for(I=this.lights.length-1;I>=0;I--)if(this.lights[I].id===V)return this.lights[I];return null}getNodeById(V){const I=this.getMeshById(V);if(I)return I;const m=this.getTransformNodeById(V);if(m)return m;const C=this.getLightById(V);if(C)return C;const l=this.getCameraById(V);if(l)return l;const s=this.getBoneById(V);return s||null}getNodeByName(V){const I=this.getMeshByName(V);if(I)return I;const m=this.getTransformNodeByName(V);if(m)return m;const C=this.getLightByName(V);if(C)return C;const l=this.getCameraByName(V);if(l)return l;const s=this.getBoneByName(V);return s||null}getMeshByName(V){for(let I=0;I<this.meshes.length;I++)if(this.meshes[I].name===V)return this.meshes[I];return null}getTransformNodeByName(V){for(let I=0;I<this.transformNodes.length;I++)if(this.transformNodes[I].name===V)return this.transformNodes[I];return null}getLastSkeletonById(V){for(let I=this.skeletons.length-1;I>=0;I--)if(this.skeletons[I].id===V)return this.skeletons[I];return null}getSkeletonByUniqueId(V){for(let I=0;I<this.skeletons.length;I++)if(this.skeletons[I].uniqueId===V)return this.skeletons[I];return null}getSkeletonById(V){for(let I=0;I<this.skeletons.length;I++)if(this.skeletons[I].id===V)return this.skeletons[I];return null}getSkeletonByName(V){for(let I=0;I<this.skeletons.length;I++)if(this.skeletons[I].name===V)return this.skeletons[I];return null}getMorphTargetManagerById(V){for(let I=0;I<this.morphTargetManagers.length;I++)if(this.morphTargetManagers[I].uniqueId===V)return this.morphTargetManagers[I];return null}getMorphTargetById(V){for(let I=0;I<this.morphTargetManagers.length;++I){const m=this.morphTargetManagers[I];for(let I=0;I<m.numTargets;++I){const C=m.getTarget(I);if(C.id===V)return C}}return null}getMorphTargetByName(V){for(let I=0;I<this.morphTargetManagers.length;++I){const m=this.morphTargetManagers[I];for(let I=0;I<m.numTargets;++I){const C=m.getTarget(I);if(C.name===V)return C}}return null}getPostProcessByName(V){for(let I=0;I<this.postProcesses.length;++I){const m=this.postProcesses[I];if(m.name===V)return m}return null}isActiveMesh(V){return-1!==this._activeMeshes.indexOf(V)}get uid(){return this._uid||(this._uid=C.d.RandomId()),this._uid}addExternalData(V,I){return this._externalData||(this._externalData=new k),this._externalData.add(V,I)}getExternalData(V){return this._externalData?this._externalData.get(V):null}getOrAddExternalDataWithFactory(V,I){return this._externalData||(this._externalData=new k),this._externalData.getOrAddWithFactory(V,I)}removeExternalData(V){return this._externalData.remove(V)}_evaluateSubMesh(V,I,m,C){if(C||V.isInFrustum(this._frustumPlanes)){for(const C of this._evaluateSubMeshStage)C.action(I,V);const m=V.dV();null!==m&&void 0!==m&&(m.hasRenderTargetTextures&&null!=m.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(m)&&(this._processedMaterials.push(m),this._materialsRenderTargets.concatWithNoDuplicate(m.getRenderTargetTextures())),this._renderingManager.dispatch(V,I,m))}}freeProcessedMaterials(){this._processedMaterials.dispose()}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set blockfreeActiveMeshesAndRenderingGroups(V){this._preventFreeActiveMeshesAndRenderingGroups!==V&&(V&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=V)}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let V=0;V<this.activeCameras.length;V++){const I=this.activeCameras[V];I&&I._activeMeshes&&I._activeMeshes.dispose()}}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let V=0;V<this.textures.length;V++){const I=this.textures[V];I&&I.renderList&&I.freeRenderingGroups()}}_isInIntermediateRendering(){return this._intermediateRendering}freezeActiveMeshes(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1?arguments[1]:void 0,m=arguments.length>2?arguments[2]:void 0,C=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],l=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.executeWhenReady((()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=l,this._skipEvaluateActiveMeshesCompletely=V,C)for(let V=0;V<this._activeMeshes.length;V++)this._activeMeshes.data[V]._freeze();I&&I()}else m&&m("No active camera found")})),this}unfreezeActiveMeshes(){for(let V=0;V<this.meshes.length;V++){const I=this.meshes[V];I._internalAbstractMeshDataInfo&&(I._internalAbstractMeshDataInfo._isActive=!1)}for(let V=0;V<this._activeMeshes.length;V++)this._activeMeshes.data[V]._unFreeze();return this._activeMeshesFrozen=!1,this}_executeActiveContainerCleanup(V){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((()=>V.dispose()))}_evaluateActiveMeshes(){if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode){var V;if(this._activeMeshes.length>0)null===(V=this.activeCamera)||void 0===V||V._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();return}if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const V=this._activeMeshes.length;for(let I=0;I<V;I++){this._activeMeshes.data[I].fF()}}if(this._activeParticleSystems){const V=this._activeParticleSystems.length;for(let I=0;I<V;I++)this._activeParticleSystems.data[I].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const C of this._beforeEvaluateActiveMeshStage)C.action();const I=this.getActiveMeshCandidates(),m=I.length;for(let C=0;C<m;C++){const V=I.data[C];let m=V._internalAbstractMeshDataInfo._currentLOD.get(this.activeCamera);if(m?m[1]=-1:(m=[V,-1],V._internalAbstractMeshDataInfo._currentLOD.set(this.activeCamera,m)),V.isBlocked)continue;if(this._totalVertices.addCount(V.getTotalVertices(),!1),!V.isReady()||!V.isEnabled()||V.Vk.hasAZeroComponent)continue;V.fF(),V.actionManager&&V.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(V);let l=this.customLODSelector?this.customLODSelector(V,this.activeCamera):V.getLOD(this.activeCamera);if(m[0]=l,m[1]=this._frameId,void 0!==l&&null!==l&&(l!==V&&0!==l.billboardMode&&l.fF(),V._preActivate(),V.isVisible&&V.visibility>0&&0!==(V.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||V.bk||V.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(V),this.activeCamera._activeMeshes.push(V),l!==V&&l._activate(this._renderId,!1);for(const I of this._preActiveMeshStage)I.action(V);V._activate(this._renderId,!1)&&(V.isAnInstance?V._internalAbstractMeshDataInfo._actAsRegularMesh&&(l=V):l._internalAbstractMeshDataInfo._onlyForInstances=!1,l._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(V,l)),V._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let V=0;V<this.ZY.length;V++){const I=this.ZY[V];if(!I.isStarted()||!I.i)continue;const m=I.i;m.position&&!m.isEnabled()||(this._activeParticleSystems.push(I),I.animate(),this._renderingManager.dispatchParticles(I))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}_prepareSkeleton(V){this._skeletonsEnabled&&V.skeleton&&(this._activeSkeletons.pushNoDuplicate(V.skeleton)&&(V.skeleton.prepare(),this._activeBones.addCount(V.skeleton.bones.length,!1)),V.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(V)&&this.frameGraph&&V.applySkeleton(V.skeleton))}_activeMesh(V,I){this._prepareSkeleton(I);let m=V.hasInstances||V.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||I.bk;if(I&&I.kk&&I.kk.length>0){const C=this.getActiveSubMeshCandidates(I),l=C.length;m=m||1===l;for(let s=0;s<l;s++){const l=C.data[s];this._evaluateSubMesh(l,I,V,m)}}}updateTransformMatrix(V){const I=this.activeCamera;if(I)if(I._renderingMultiview){const m=I._rigCameras[0],C=I._rigCameras[1];this.setTransformMatrix(m.getViewMatrix(),m.getProjectionMatrix(V),C.getViewMatrix(),C.getProjectionMatrix(V))}else this.setTransformMatrix(I.getViewMatrix(),I.getProjectionMatrix(V))}_bindFrameBuffer(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._useCurrentFrameBuffer||(V&&V._multiviewTexture?V._multiviewTexture._bindFrameBuffer():V&&V.outputRenderTarget?V.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer()),I&&this._clearFrameBuffer(V)}_clearFrameBuffer(V){if(V&&V._multiviewTexture);else if(V&&V.outputRenderTarget&&!V._renderingMultiview){const I=V.outputRenderTarget;I.onClearObservable.hasObservers()?I.onClearObservable.notifyObservers(this._engine):I.skipInitialClear||V.isRightCamera||(this.FY&&this._engine.clear(I.clearColor||this._clearColor,!I._cleared,!0,!0),I._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_renderForCamera(V,I){var m;let l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(V&&V._skipRendering)return;const s=this._engine;if(this._activeCamera=V,!this.activeCamera)throw new Error("Active camera not set");if(s.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&l){let I=!0;V._renderingMultiview&&V.outputRenderTarget&&(I=V.outputRenderTarget.skipInitialClear,this.FY&&(this._defaultFrameBufferCleared=!1,V.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),V._renderingMultiview&&V.outputRenderTarget&&(V.outputRenderTarget.skipInitialClear=I)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let C=0;C<this._softwareSkinnedMeshes.length;C++){const V=this._softwareSkinnedMeshes.data[C];V.applySkeleton(V.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),V.customRenderTargets&&V.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(V.customRenderTargets),I&&I.customRenderTargets&&I.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(I.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const C of this._gatherActiveCameraRenderTargetsStage)C.action(this._renderTargets);let F=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){C.d.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let V=0;V<this._renderTargets.length;V++){const I=this._renderTargets.data[V];if(I._shouldRender()){this._renderId++;const V=I.activeCamera&&I.activeCamera!==this.activeCamera;I.render(V,this.dumpNextRenderTargets),F=!0}}C.d.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const V of this._cameraDrawRenderTargetStage)F=V.action(this.activeCamera)||F;this._intermediateRendering=!1}this._engine.currentRenderPassId=(null===(m=V.outputRenderTarget)||void 0===m?void 0:m.renderPassId)??V.renderPassId??0,F&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||V._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const C of this._beforeCameraDrawStage)C.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),s.snapshotRendering&&1===s.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const C of this._afterCameraDrawStage)C.action(this.activeCamera);if(this.postProcessManager&&!V._multiviewTexture){const I=V.outputRenderTarget?V.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(V.isIntermediate,I)}for(const C of this._afterCameraPostProcessStage)C.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}_processSubCameras(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(0===V.cameraRigMode||V._renderingMultiview)return V._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(V,void 0,I),void this.onAfterRenderCameraObservable.notifyObservers(V);if(V._useMultiviewToSingleView)this._renderMultiviewToSingleView(V);else{this.onBeforeCameraRenderObservable.notifyObservers(V);for(let I=0;I<V._rigCameras.length;I++)this._renderForCamera(V._rigCameras[I],V)}this._activeCamera=V,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(V)}_checkIntersections(){for(let V=0;V<this._meshesForIntersections.length;V++){const I=this._meshesForIntersections.data[V];if(I.actionManager)for(let V=0;I.actionManager&&V<I.actionManager.actions.length;V++){const m=I.actionManager.actions[V];if(12===m.trigger||13===m.trigger){const V=m.getTriggerParameter(),C=V.mesh?V.mesh:V,l=C.intersectsMesh(I,V.usePreciseIntersection),s=I._intersectionsInProgress.indexOf(C);l&&-1===s?12===m.trigger?(m._executeCurrent(O.CreateNew(I,void 0,C)),I._intersectionsInProgress.push(C)):13===m.trigger&&I._intersectionsInProgress.push(C):!l&&s>-1&&(13===m.trigger&&m._executeCurrent(O.CreateNew(I,void 0,C)),I.actionManager.hasSpecificTrigger(13,(V=>{const I=V.mesh?V.mesh:V;return C===I}))&&13!==m.trigger||I._intersectionsInProgress.splice(s,1))}}}}_advancePhysicsEngineStep(V){}_animate(V){}animate(){if(this._engine.isDeterministicLockStep()){let V=Math.max(VV.MinDeltaTime,Math.min(this._engine.getDeltaTime(),VV.MaxDeltaTime))+this._timeAccumulator;const I=this._engine.getTimeStep(),m=1e3/I/1e3;let C=0;const l=this._engine.getLockstepMaxSteps();let s=Math.floor(V/I);for(s=Math.min(s,l);V>0&&C<s;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=I*m,this._animate(I),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(I),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,C++,V-=I;this._timeAccumulator=V<0?0:V}else{const V=this.useConstantAnimationDeltaTime?16:Math.max(VV.MinDeltaTime,Math.min(this._engine.getDeltaTime(),VV.MaxDeltaTime));this._animationRatio=.06*V,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(V)}}_clear(){(this.autoClearDepthAndStencil||this.FY)&&this._engine.clear(this._clearColor,this.FY||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}_checkCameraRenderTarget(V){var I;if(null===V||void 0===V||!V.outputRenderTarget||null!==V&&void 0!==V&&V.isRigCamera||(V.outputRenderTarget._cleared=!1),null!==V&&void 0!==V&&null!==(I=V.rigCameras)&&void 0!==I&&I.length)for(let m=0;m<V.rigCameras.length;++m){const I=V.rigCameras[m].outputRenderTarget;I&&(I._cleared=!1)}}resetDrawCache(V){if(this.meshes)for(const I of this.meshes)I.resetDrawCache(V)}_renderWithFrameGraph(){var V;let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.activeCamera=null,this._activeParticleSystems.reset(),this._activeSkeletons.reset(),I)for(const l of this.cameras)if(l.update(),0!==l.cameraRigMode)for(let V=0;V<l._rigCameras.length;V++)l._rigCameras[V].update();this.onBeforeRenderObservable.notifyObservers(this);for(const l of this._beforeClearStage)l.action();const m=this.getActiveMeshCandidates(),C=m.length;for(let l=0;l<C;l++){const V=m.data[l];V.isBlocked||(this._totalVertices.addCount(V.getTotalVertices(),!1),V.isReady()&&V.isEnabled()&&!V.Vk.hasAZeroComponent&&(V.fF(),V.actionManager&&V.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(V)))}if(this.particlesEnabled)for(let l=0;l<this.ZY.length;l++){const V=this.ZY[l];if(!V.isStarted()||!V.i)continue;const I=V.i;I.position&&!I.isEnabled()||(this._activeParticleSystems.push(V),V.animate())}null===(V=this.frameGraph)||void 0===V||V.execute()}_renderRenderTarget(V,I){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._intermediateRendering=!0,V._shouldRender()){if(this._renderId++,this.activeCamera=I,!this.activeCamera)throw new Error("Active camera not set");this._engine.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),V.render(m,C)}this._intermediateRendering=!1}render(){var V;let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],m=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.K){if(this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),null!==(V=this.activeCameras)&&void 0!==V&&V.length)for(const V of this.activeCameras)this._checkCameraRenderTarget(V);this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),m||this.animate();for(const V of this._beforeCameraUpdateStage)V.action();if(I)if(this.activeCameras&&this.activeCameras.length>0)for(let V=0;V<this.activeCameras.length;V++){const I=this.activeCameras[V];if(I.update(),0!==I.cameraRigMode)for(let V=0;V<I._rigCameras.length;V++)I._rigCameras[V].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let V=0;V<this.activeCamera._rigCameras.length;V++)this.activeCamera._rigCameras[V].update();if(this.customRenderFunction)this._renderId++,this._engine.currentRenderPassId=0,this.customRenderFunction(I,m);else{var l;this.onBeforeRenderObservable.notifyObservers(this),this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const V=null!==(l=this.activeCameras)&&void 0!==l&&l.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){C.d.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0);for(let I=0;I<this.customRenderTargets.length;I++){const m=this.customRenderTargets[I],C=m.activeCamera||this.activeCamera;this._renderRenderTarget(m,C,V!==C,this.dumpNextRenderTargets)}C.d.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._renderId++}this._engine.currentRenderPassId=(null===V||void 0===V?void 0:V.renderPassId)??0,this.activeCamera=V,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const I of this._beforeClearStage)I.action();this._clearFrameBuffer(this.activeCamera);for(const I of this._gatherRenderTargetsStage)I.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let I=0;I<this.activeCameras.length;I++)this._processSubCameras(this.activeCameras[I],I>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}}this._checkIntersections();for(const V of this._afterRenderStage)V.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let V=0;V<this._toBeDisposed.length;V++){const I=this._toBeDisposed[V];I&&I.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}}freezeMaterials(){for(let V=0;V<this.materials.length;V++)this.materials[V].freeze()}unfreezeMaterials(){for(let V=0;V<this.materials.length;V++)this.materials[V].unfreeze()}dispose(){if(this.K)return;if(this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this._activeAnimatables&&this.stopAllAnimations){for(const V of this._activeAnimatables)V.onAnimationEndObservable.clear(),V.onAnimationEnd=null;this.stopAllAnimations()}this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const V=this._activeRequests.slice();for(const l of V)l.abort();this._activeRequests.length=0;try{this.Ck.notifyObservers(this)}catch(C){a.d.Error("An error occurred while calling onDisposeObservable!",C)}this.sY();if(this._engine.getInputElement())for(let l=0;l<this.cameras.length;l++)this.cameras[l].sY();this._disposeList(this.animationGroups),this._disposeList(this.lights),this.hK&&this.hK.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.meshes,(V=>V.dispose(!0))),this._disposeList(this.transformNodes,(V=>V.dispose(!0)));const I=this.cameras;this._disposeList(I),this._disposeList(this.ZY),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let m=this._engine.scenes.indexOf(this);if(m>-1&&this._engine.scenes.splice(m,1),b.c._LastCreatedScene===this){b.c._LastCreatedScene=null;let V=b.c.Instances.length-1;for(;V>=0;){const I=b.c.Instances[V];if(I.scenes.length>0){b.c._LastCreatedScene=I.scenes[this._engine.scenes.length-1];break}V--}}m=this._engine._virtualScenes.indexOf(this),m>-1&&this._engine._virtualScenes.splice(m,1),this._engine.wipeCaches(!0),this.Ck.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this.onClearColorChangedObservable.clear(),this.onEnvironmentTextureChangedObservable.clear(),this.onMeshUnderPointerUpdatedObservable.clear(),this._isDisposed=!0}_disposeList(V,I){const m=V.slice(0);I=I??(V=>V.dispose());for(const C of m)I(C);V.length=0}get K(){return this._isDisposed}clearCachedVertexData(){for(let V=0;V<this.meshes.length;V++){const I=this.meshes[V].wF;I&&I.clearCachedData()}}cleanCachedTextureBuffer(){for(const V of this.textures){V._buffer&&(V._buffer=null)}}getWorldExtends(V){const I=new E.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),m=new E.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);V=V||(()=>!0);const C=this.meshes.filter(V);for(const l of C){if(l.fF(!0),!l.kk||0===l.kk.length||l.infiniteDistance)continue;const V=l.getBoundingInfo(),C=V.boundingBox.minimumWorld,s=V.boundingBox.maximumWorld;E.m.CheckExtends(C,I,m),E.m.CheckExtends(s,I,m)}return{min:I,max:m}}createPickingRay(V,I,m,C){throw(0,T.c)("Ray")}createPickingRayToRef(V,I,m,C,l){throw(0,T.c)("Ray")}createPickingRayInCameraSpace(V,I,m){throw(0,T.c)("Ray")}createPickingRayInCameraSpaceToRef(V,I,m,C){throw(0,T.c)("Ray")}sm(V,I,m,C,l,s){const F=(0,T.c)("Ray",!0);return F&&a.d.Warn(F),new X.b}pickWithBoundingInfo(V,I,m,C,l){const s=(0,T.c)("Ray",!0);return s&&a.d.Warn(s),new X.b}pickWithRay(V,I,m,C){throw(0,T.c)("Ray")}multiPick(V,I,m,C,l){throw(0,T.c)("Ray")}multiPickWithRay(V,I,m){throw(0,T.c)("Ray")}setPointerOverMesh(V,I,m){this._inputManager.setPointerOverMesh(V,I,m)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_rebuildGeometries(){for(const V of this.geometries)V._rebuild();for(const V of this.meshes)V._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const V of this._components)V.rebuild();for(const V of this.ZY)V.rebuild();if(this.spriteManagers)for(const V of this.spriteManagers)V.rebuild()}_rebuildTextures(){for(const V of this.textures)V._rebuild(!0);this.markAllMaterialsAsDirty(1)}_getByTags(V,I,m){if(void 0===I)return V;const C=[];for(const l in V){const s=V[l];j.b&&j.b.MatchesQuery(s,I)&&(!m||m(s))&&C.push(s)}return C}getMeshesByTags(V,I){return this._getByTags(this.meshes,V,I)}getCamerasByTags(V,I){return this._getByTags(this.cameras,V,I)}getLightsByTags(V,I){return this._getByTags(this.lights,V,I)}getMaterialByTags(V,I){return this._getByTags(this.materials,V,I).concat(this._getByTags(this.multiMaterials,V,I))}getTransformNodesByTags(V,I){return this._getByTags(this.transformNodes,V,I)}setRenderingOrder(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(V,I,m,C)}setRenderingAutoClearDepthStencil(V,I){let m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],C=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(V,I,m,C)}getAutoClearDepthStencilSetup(V){return this._renderingManager.getAutoClearDepthStencilSetup(V)}_forceBlockMaterialDirtyMechanism(V){this._blockMaterialDirtyMechanism=V}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set blockMaterialDirtyMechanism(V){this._blockMaterialDirtyMechanism!==V&&(this._blockMaterialDirtyMechanism=V,V||this.markAllMaterialsAsDirty(127))}markAllMaterialsAsDirty(V,I){if(!this._blockMaterialDirtyMechanism)for(const m of this.materials)I&&!I(m)||m.bE(V)}_loadFile(V,I,m,C,l,s,F){const k=(0,w.r)(V,I,m,C?this.offlineProvider:void 0,l,s,F);return this._activeRequests.push(k),k.onCompleteObservable.add((V=>{this._activeRequests.splice(this._activeRequests.indexOf(V),1)})),k}async _loadFileAsync(V,I,m,C,l){return await new Promise(((s,F)=>{this._loadFile(V,(V=>{s(V)}),I,m,C,((V,I)=>{F(I)}),l)}))}_requestFile(V,I,m,C,l,s,F){const k=(0,w.A)(V,I,m,C?this.offlineProvider:void 0,l,s,F);return this._activeRequests.push(k),k.onCompleteObservable.add((V=>{this._activeRequests.splice(this._activeRequests.indexOf(V),1)})),k}async _requestFileAsync(V,I,m,C,l){return await new Promise(((s,F)=>{this._requestFile(V,(V=>{s(V)}),I,m,C,(V=>{F(V)}),l)}))}_readFile(V,I,m,C,l){const s=(0,w.x)(V,I,m,C,l);return this._activeRequests.push(s),s.onCompleteObservable.add((V=>{this._activeRequests.splice(this._activeRequests.indexOf(V),1)})),s}async _readFileAsync(V,I,m){return await new Promise(((C,l)=>{this._readFile(V,(V=>{C(V)}),I,m,(V=>{l(V)}))}))}getPerfCollector(){throw(0,T.c)("performanceViewerSceneExtension")}setActiveCameraByID(V){return this.setActiveCameraById(V)}getMaterialByID(V){return this.getMaterialById(V)}getLastMaterialByID(V){return this.getLastMaterialById(V)}getTextureByUniqueID(V){return this.getTextureByUniqueId(V)}getCameraByID(V){return this.getCameraById(V)}getCameraByUniqueID(V){return this.getCameraByUniqueId(V)}getBoneByID(V){return this.getBoneById(V)}getLightByID(V){return this.getLightById(V)}getLightByUniqueID(V){return this.getLightByUniqueId(V)}getParticleSystemByID(V){return this.getParticleSystemById(V)}getGeometryByID(V){return this.getGeometryById(V)}getMeshByID(V){return this.getMeshById(V)}getMeshByUniqueID(V){return this.getMeshByUniqueId(V)}getLastMeshByID(V){return this.getLastMeshById(V)}getMeshesByID(V){return this.getMeshesById(V)}getTransformNodeByID(V){return this.getTransformNodeById(V)}getTransformNodeByUniqueID(V){return this.getTransformNodeByUniqueId(V)}getTransformNodesByID(V){return this.getTransformNodesById(V)}getNodeByID(V){return this.getNodeById(V)}getLastEntryByID(V){return this.getLastEntryById(V)}getLastSkeletonByID(V){return this.getLastSkeletonById(V)}}VV.FOGMODE_NONE=0,VV.FOGMODE_EXP=1,VV.FOGMODE_EXP2=2,VV.FOGMODE_LINEAR=3,VV.MinDeltaTime=1,VV.MaxDeltaTime=1e3,VV._OriginalDefaultMaterialFactory=VV.DefaultMaterialFactory,(0,L.h)("BABYLON.Scene",VV)},11421:(V,I,m)=>{m.d(I,{c:()=>C,e:()=>l});class C{}C.NAME_EFFECTLAYER="EffectLayer",C.NAME_LAYER="Layer",C.NAME_LENSFLARESYSTEM="LensFlareSystem",C.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",C.NAME_PARTICLESYSTEM="cv",C.NAME_GAMEPAD="Gamepad",C.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",C.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",C.NAME_PREPASSRENDERER="PrePassRenderer",C.NAME_DEPTHRENDERER="DepthRenderer",C.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",C.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",C.NAME_SPRITE="Sprite",C.NAME_SUBSURFACE="SubSurface",C.NAME_OUTLINERENDERER="Outline",C.NAME_PROCEDURALTEXTURE="ProceduralTexture",C.NAME_SHADOWGENERATOR="ShadowGenerator",C.NAME_OCTREE="Hv",C.NAME_PHYSICSENGINE="PhysicsEngine",C.NAME_AUDIO="Audio",C.NAME_FLUIDRENDERER="FluidRenderer",C.NAME_IBLCDFGENERATOR="iblCDFGenerator",C.STEP_ISREADYFORMESH_EFFECTLAYER=0,C.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,C.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,C.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,C.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,C.STEP_BEFORECAMERADRAW_PREPASS=0,C.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,C.STEP_BEFORECAMERADRAW_LAYER=2,C.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,C.STEP_BEFORERENDERTARGETDRAW_LAYER=1,C.STEP_BEFORERENDERINGMESH_PREPASS=0,C.STEP_BEFORERENDERINGMESH_OUTLINE=1,C.STEP_AFTERRENDERINGMESH_PREPASS=0,C.STEP_AFTERRENDERINGMESH_OUTLINE=1,C.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,C.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,C.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,C.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,C.STEP_BEFORECLEAR_PREPASS=1,C.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,C.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,C.STEP_AFTERRENDERTARGETDRAW_LAYER=1,C.STEP_AFTERCAMERADRAW_PREPASS=0,C.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,C.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,C.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,C.STEP_AFTERCAMERADRAW_LAYER=4,C.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,C.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,C.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,C.STEP_AFTERRENDER_AUDIO=0,C.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,C.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,C.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,C.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,C.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,C.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,C.STEP_POINTERMOVE_SPRITE=0,C.STEP_POINTERDOWN_SPRITE=0,C.STEP_POINTERUP_SPRITE=0;class l extends Array{constructor(V){super(...V)}static Create(){return Object.create(l.prototype)}registerStep(V,I,m){let C=0,l=Number.MAX_VALUE;for(;C<this.length;C++){if(l=this[C].index,V<l)break}this.splice(C,0,{index:V,component:I,action:m.bind(I)})}clear(){this.length=0}}},11206:(V,I,m)=>{m.d(I,{d:()=>C});function C(V,I,m,C){var l,s=arguments.length,F=s<3?I:null===C?C=Object.getOwnPropertyDescriptor(I,m):C;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)F=Reflect.decorate(V,I,m,C);else for(var k=V.length-1;k>=0;k--)(l=V[k])&&(F=(s<3?l(F):s>3?l(I,m,F):l(I,m))||F);return s>3&&F&&Object.defineProperty(I,m,F),F}Object.create;Object.create}}]);