"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[9],{11847:(G,V,W)=>{W.d(V,{e:()=>p,g:()=>g,h:()=>B,k:()=>q,l:()=>Y,m:()=>t,o:()=>L});var J=W(11136),R=W(11424),d=W(11182),k=W(11159),z=W(11855),X=W(11465),P=W(11636),A=W(11222),x=W(11411);const q=Object.freeze(new J.g(0,0,0,0)),L=Object.freeze(J.o.Zero()),t=Object.freeze(J.k.Zero()),Y=Object.freeze(P.c.Zero()),g=Object.freeze(R.d.Black()),B=Object.freeze(new R.h(0,0,0,0)),S={key:0,repeatCount:0,loopMode:2};class p{static _PrepareAnimation(G,V,W,d,k,z,X,A){let x;if(!isNaN(parseFloat(k))&&isFinite(k)?x=p.ANIMATIONTYPE_FLOAT:k instanceof J.g?x=p.ANIMATIONTYPE_QUATERNION:k instanceof J.o?x=p.ANIMATIONTYPE_VECTOR3:k instanceof J.k?x=p.ANIMATIONTYPE_VECTOR2:k instanceof R.d?x=p.ANIMATIONTYPE_COLOR3:k instanceof R.h?x=p.ANIMATIONTYPE_COLOR4:k instanceof P.c&&(x=p.ANIMATIONTYPE_SIZE),void 0==x)return null;const q=new p(G,V,W,x,X),L=[{frame:0,value:k},{frame:d,value:z}];return q.setKeys(L),void 0!==A&&q.setEasingFunction(A),q}static CreateAnimation(G,V,W,J){const R=new p(G+"Animation",G,W,V,p.ANIMATIONLOOPMODE_CONSTANT);return R.setEasingFunction(J),R}static CreateAndStartAnimation(G,V,W,J,R,d,k,z,X,P,A){const x=p._PrepareAnimation(G,W,J,R,d,k,z,X);return x?(V.HG&&(A=V.HG()),A?A.beginDirectAnimation(V,[x],0,R,x.loopMode!==p.ANIMATIONLOOPMODE_CONSTANT,1,P):null):null}static CreateAndStartHierarchyAnimation(G,V,W,J,R,d,k,z,X,P,A){const x=p._PrepareAnimation(G,J,R,d,k,z,X,P);if(!x)return null;return V.HG().beginDirectHierarchyAnimation(V,W,[x],0,d,1===x.loopMode,1,A)}static CreateMergeAndStartAnimation(G,V,W,J,R,d,k,z,X,P){const A=p._PrepareAnimation(G,W,J,R,d,k,z,X);return A?(V.animations.push(A),V.HG().beginAnimation(V,0,R,1===A.loopMode,1,P)):null}static MakeAnimationAdditive(G,V,W){let R;R="object"===typeof V?V:{referenceFrame:V??0,range:W,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let d=G;if(R.cloneOriginalAnimation&&(d=G.clone(),d.name=R.clonedAnimationName||d.name),!d._keys.length)return d;const k=R.referenceFrame&&R.referenceFrame>=0?R.referenceFrame:0;let z=0;const X=d._keys[0];let P=d._keys.length-1;const A=d._keys[P],x={referenceValue:X.value,referencePosition:J.h.ed[0],referenceQuaternion:J.h.Quaternion[0],referenceScaling:J.h.ed[1],keyPosition:J.h.ed[2],keyQuaternion:J.h.Quaternion[1],keyScaling:J.h.ed[3]};let q=X.frame,L=A.frame;if(R.range){const G=d.getRange(R.range);G&&(q=G.from,L=G.to)}else q=R.fromFrame??q,L=R.toFrame??L;if(q!==X.frame&&(z=d.createKeyForFrame(q)),L!==A.frame&&(P=d.createKeyForFrame(L)),1===d._keys.length){const G=d._getKeyValue(d._keys[0]);x.referenceValue=G.clone?G.clone():G}else if(k<=X.frame){const G=d._getKeyValue(X.value);x.referenceValue=G.clone?G.clone():G}else if(k>=A.frame){const G=d._getKeyValue(A.value);x.referenceValue=G.clone?G.clone():G}else{S.key=0;const G=d._interpolate(k,S);x.referenceValue=G.clone?G.clone():G}d.dataType===p.ANIMATIONTYPE_QUATERNION?x.referenceValue.normalize().conjugateInPlace():d.dataType===p.ANIMATIONTYPE_MATRIX&&(x.referenceValue.decompose(x.referenceScaling,x.referenceQuaternion,x.referencePosition),x.referenceQuaternion.normalize().conjugateInPlace());let t=Number.MAX_VALUE;const Y=R.clipKeys?[]:null;for(let g=z;g<=P;g++){let G=d._keys[g];if((Y||R.cloneOriginalAnimation)&&(G={frame:G.frame,value:G.value.clone?G.value.clone():G.value,inTangent:G.inTangent,outTangent:G.outTangent,interpolation:G.interpolation,lockedTangent:G.lockedTangent},Y&&(t===Number.MAX_VALUE&&(t=G.frame),G.frame-=t,Y.push(G))),!g||d.dataType===p.ANIMATIONTYPE_FLOAT||G.value!==X.value)switch(d.dataType){case p.ANIMATIONTYPE_MATRIX:G.value.decompose(x.keyScaling,x.keyQuaternion,x.keyPosition),x.keyPosition.FA(x.referencePosition),x.keyScaling.divideInPlace(x.referenceScaling),x.referenceQuaternion.multiplyToRef(x.keyQuaternion,x.keyQuaternion),J.c.ComposeToRef(x.keyScaling,x.keyQuaternion,x.keyPosition,G.value);break;case p.ANIMATIONTYPE_QUATERNION:x.referenceValue.multiplyToRef(G.value,G.value);break;case p.ANIMATIONTYPE_VECTOR2:case p.ANIMATIONTYPE_VECTOR3:case p.ANIMATIONTYPE_COLOR3:case p.ANIMATIONTYPE_COLOR4:G.value.subtractToRef(x.referenceValue,G.value);break;case p.ANIMATIONTYPE_SIZE:G.value.width-=x.referenceValue.width,G.value.height-=x.referenceValue.height;break;default:G.value-=x.referenceValue}}return Y&&d.setKeys(Y,!0),d}static TransitionTo(G,V,W,J,R,d,k){let z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(k<=0)return W[G]=V,z&&z(),null;const X=R*(k/1e3);d.setKeys([{frame:0,value:W[G].clone?W[G].clone():W[G]},{frame:X,value:V}]),W.animations||(W.animations=[]),W.animations.push(d);const P=J.beginAnimation(W,0,X,!1);return P.onAnimationEnd=z,P}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const G of this._runtimeAnimations)if(!G.isStopped())return!0;return!1}constructor(G,V,W,J,R,d){this.name=G,this.targetProperty=V,this.framePerSecond=W,this.dataType=J,this.loopMode=R,this.enableBlending=d,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this._coreAnimation=null,this.targetPropertyPath=V.split("."),this.dataType=J,this.loopMode=void 0===R?p.ANIMATIONLOOPMODE_CYCLE:R,this.uniqueId=p._UniqueIdGenerator++}toString(G){let V="Name: "+this.name+", property: "+this.targetProperty;if(V+=", datatype: "+["Float","ed","Quaternion","Matrix","pz","Vector2"][this.dataType],V+=", nKeys: "+(this._keys?this._keys.length:"none"),V+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),G){V+=", Ranges: {";let G=!0;for(const W in this._ranges)G&&(V+=", ",G=!1),V+=W;V+="}"}return V}addEvent(G){this._events.push(G),this._events.sort(((G,V)=>G.frame-V.frame))}removeEvents(G){for(let V=0;V<this._events.length;V++)this._events[V].frame===G&&(this._events.splice(V,1),V--)}getEvents(){return this._events}createRange(G,V,W){this._ranges[G]||(this._ranges[G]=new z.d(G,V,W))}deleteRange(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const W=this._ranges[G];if(W){if(V){const G=W.from,V=W.to;for(let W=this._keys.length-1;W>=0;W--)this._keys[W].frame>=G&&this._keys[W].frame<=V&&this._keys.splice(W,1)}this._ranges[G]=null}}getRange(G){return this._ranges[G]}getKeys(){return this._keys}getHighestFrame(){let G=0;for(let V=0,W=this._keys.length;V<W;V++)G<this._keys[V].frame&&(G=this._keys[V].frame);return G}getEasingFunction(){return this._easingFunction}setEasingFunction(G){this._easingFunction=G}floatInterpolateFunction(G,V,W){return(0,d.Lerp)(G,V,W)}floatInterpolateFunctionWithTangents(G,V,W,J,R){return(0,d.Hermite)(G,V,W,J,R)}quaternionInterpolateFunction(G,V,W){return J.g.Slerp(G,V,W)}quaternionInterpolateFunctionWithTangents(G,V,W,R,d){return J.g.Hermite(G,V,W,R,d).normalize()}vector3InterpolateFunction(G,V,W){return J.o.Lerp(G,V,W)}vector3InterpolateFunctionWithTangents(G,V,W,R,d){return J.o.Hermite(G,V,W,R,d)}vector2InterpolateFunction(G,V,W){return J.k.Lerp(G,V,W)}vector2InterpolateFunctionWithTangents(G,V,W,R,d){return J.k.Hermite(G,V,W,R,d)}sizeInterpolateFunction(G,V,W){return P.c.Lerp(G,V,W)}color3InterpolateFunction(G,V,W){return R.d.Lerp(G,V,W)}color3InterpolateFunctionWithTangents(G,V,W,J,d){return R.d.Hermite(G,V,W,J,d)}color4InterpolateFunction(G,V,W){return R.h.Lerp(G,V,W)}color4InterpolateFunctionWithTangents(G,V,W,J,d){return R.h.Hermite(G,V,W,J,d)}_getKeyValue(G){return"function"===typeof G?G():G}evaluate(G){return S.key=0,this._interpolate(G,S)}_interpolate(G,V){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(V.loopMode===p.ANIMATIONLOOPMODE_CONSTANT&&V.repeatCount>0)return V.highLimitValue.clone?V.highLimitValue.clone():V.highLimitValue;const J=this._keys;let R;if(this._coreAnimation)R=this._coreAnimation._key;else{const d=J.length;for(R=V.key;R>=0&&G<J[R].frame;)--R;for(;R+1<=d-1&&G>=J[R+1].frame;)++R;if(V.key=R,R<0)return W?void 0:this._getKeyValue(J[0].value);if(R+1>d-1)return W?void 0:this._getKeyValue(J[d-1].value);this._key=R}const d=J[R],k=J[R+1];if(W&&(G===d.frame||G===k.frame))return;const z=this._getKeyValue(d.value),X=this._getKeyValue(k.value);if(1===d.interpolation)return k.frame>G?z:X;const P=void 0!==d.outTangent&&void 0!==k.inTangent,A=k.frame-d.frame;let x=(G-d.frame)/A;const S=d.easingFunction||this.getEasingFunction();switch(S&&(x=S.ease(x)),this.dataType){case p.ANIMATIONTYPE_FLOAT:{const G=P?this.floatInterpolateFunctionWithTangents(z,d.outTangent*A,X,k.inTangent*A,x):this.floatInterpolateFunction(z,X,x);switch(V.loopMode){case p.ANIMATIONLOOPMODE_CYCLE:case p.ANIMATIONLOOPMODE_CONSTANT:case p.ANIMATIONLOOPMODE_YOYO:return G;case p.ANIMATIONLOOPMODE_RELATIVE:case p.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(V.offsetValue??0)*V.repeatCount+G}break}case p.ANIMATIONTYPE_QUATERNION:{const G=P?this.quaternionInterpolateFunctionWithTangents(z,d.outTangent.scale(A),X,k.inTangent.scale(A),x):this.quaternionInterpolateFunction(z,X,x);switch(V.loopMode){case p.ANIMATIONLOOPMODE_CYCLE:case p.ANIMATIONLOOPMODE_CONSTANT:case p.ANIMATIONLOOPMODE_YOYO:return G;case p.ANIMATIONLOOPMODE_RELATIVE:case p.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return G.addInPlace((V.offsetValue||q).scale(V.repeatCount))}return G}case p.ANIMATIONTYPE_VECTOR3:{const G=P?this.vector3InterpolateFunctionWithTangents(z,d.outTangent.scale(A),X,k.inTangent.scale(A),x):this.vector3InterpolateFunction(z,X,x);switch(V.loopMode){case p.ANIMATIONLOOPMODE_CYCLE:case p.ANIMATIONLOOPMODE_CONSTANT:case p.ANIMATIONLOOPMODE_YOYO:return G;case p.ANIMATIONLOOPMODE_RELATIVE:case p.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return G.add((V.offsetValue||L).scale(V.repeatCount))}break}case p.ANIMATIONTYPE_VECTOR2:{const G=P?this.vector2InterpolateFunctionWithTangents(z,d.outTangent.scale(A),X,k.inTangent.scale(A),x):this.vector2InterpolateFunction(z,X,x);switch(V.loopMode){case p.ANIMATIONLOOPMODE_CYCLE:case p.ANIMATIONLOOPMODE_CONSTANT:case p.ANIMATIONLOOPMODE_YOYO:return G;case p.ANIMATIONLOOPMODE_RELATIVE:case p.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return G.add((V.offsetValue||t).scale(V.repeatCount))}break}case p.ANIMATIONTYPE_SIZE:switch(V.loopMode){case p.ANIMATIONLOOPMODE_CYCLE:case p.ANIMATIONLOOPMODE_CONSTANT:case p.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(z,X,x);case p.ANIMATIONLOOPMODE_RELATIVE:case p.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(z,X,x).add((V.offsetValue||Y).scale(V.repeatCount))}break;case p.ANIMATIONTYPE_COLOR3:{const G=P?this.color3InterpolateFunctionWithTangents(z,d.outTangent.scale(A),X,k.inTangent.scale(A),x):this.color3InterpolateFunction(z,X,x);switch(V.loopMode){case p.ANIMATIONLOOPMODE_CYCLE:case p.ANIMATIONLOOPMODE_CONSTANT:case p.ANIMATIONLOOPMODE_YOYO:return G;case p.ANIMATIONLOOPMODE_RELATIVE:case p.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return G.add((V.offsetValue||g).scale(V.repeatCount))}break}case p.ANIMATIONTYPE_COLOR4:{const G=P?this.color4InterpolateFunctionWithTangents(z,d.outTangent.scale(A),X,k.inTangent.scale(A),x):this.color4InterpolateFunction(z,X,x);switch(V.loopMode){case p.ANIMATIONLOOPMODE_CYCLE:case p.ANIMATIONLOOPMODE_CONSTANT:case p.ANIMATIONLOOPMODE_YOYO:return G;case p.ANIMATIONLOOPMODE_RELATIVE:case p.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return G.add((V.offsetValue||B).scale(V.repeatCount))}break}case p.ANIMATIONTYPE_MATRIX:switch(V.loopMode){case p.ANIMATIONLOOPMODE_CYCLE:case p.ANIMATIONLOOPMODE_CONSTANT:case p.ANIMATIONLOOPMODE_YOYO:return p.AllowMatricesInterpolation?this.matrixInterpolateFunction(z,X,x,V.workValue):z;case p.ANIMATIONLOOPMODE_RELATIVE:case p.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return z}}return 0}matrixInterpolateFunction(G,V,W,R){return p.AllowMatrixDecomposeForInterpolation?R?(J.c.DecomposeLerpToRef(G,V,W,R),R):J.c.DecomposeLerp(G,V,W):R?(J.c.LerpToRef(G,V,W,R),R):J.c.Lerp(G,V,W)}clone(){const G=new p(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(G.enableBlending=this.enableBlending,G.blendingSpeed=this.blendingSpeed,this._keys&&G.setKeys(this._keys),this._ranges){G._ranges={};for(const V in this._ranges){const W=this._ranges[V];W&&(G._ranges[V]=W.clone())}}return G}setKeys(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=V?G:G.slice(0)}createKeyForFrame(G){S.key=0;const V=this._interpolate(G,S,!0);if(!V)return this._keys[S.key].frame===G?S.key:S.key+1;const W={frame:G,value:V.clone?V.clone():V};return this._keys.splice(S.key+1,0,W),S.key+1}serialize(){const G={};G.name=this.name,G.property=this.targetProperty,G.framePerSecond=this.framePerSecond,G.dataType=this.dataType,G.loopBehavior=this.loopMode,G.enableBlending=this.enableBlending,G.blendingSpeed=this.blendingSpeed;const V=this.dataType;G.keys=[];const W=this.getKeys();for(let J=0;J<W.length;J++){const R=W[J],d={};switch(d.frame=R.frame,V){case p.ANIMATIONTYPE_FLOAT:d.values=[R.value],void 0!==R.inTangent&&d.values.push(R.inTangent),void 0!==R.outTangent&&(void 0===R.inTangent&&d.values.push(void 0),d.values.push(R.outTangent)),void 0!==R.interpolation&&(void 0===R.inTangent&&d.values.push(void 0),void 0===R.outTangent&&d.values.push(void 0),d.values.push(R.interpolation));break;case p.ANIMATIONTYPE_QUATERNION:case p.ANIMATIONTYPE_MATRIX:case p.ANIMATIONTYPE_VECTOR3:case p.ANIMATIONTYPE_COLOR3:case p.ANIMATIONTYPE_COLOR4:d.values=R.value.Bd(),void 0!=R.inTangent&&d.values.push(R.inTangent.Bd()),void 0!=R.outTangent&&(void 0===R.inTangent&&d.values.push(void 0),d.values.push(R.outTangent.Bd())),void 0!==R.interpolation&&(void 0===R.inTangent&&d.values.push(void 0),void 0===R.outTangent&&d.values.push(void 0),d.values.push(R.interpolation))}G.keys.push(d)}G.ranges=[];for(const J in this._ranges){const V=this._ranges[J];if(!V)continue;const W={};W.name=J,W.from=V.from,W.to=V.to,G.ranges.push(W)}return G}static _UniversalLerp(G,V,W){const J=G.constructor;return J.Lerp?J.Lerp(G,V,W):J.Slerp?J.Slerp(G,V,W):G.toFixed?G*(1-W)+W*V:V}static Parse(G){const V=new p(G.name,G.property,G.framePerSecond,G.dataType,G.loopBehavior),W=G.dataType,d=[];let k,z;for(G.enableBlending&&(V.enableBlending=G.enableBlending),G.blendingSpeed&&(V.blendingSpeed=G.blendingSpeed),z=0;z<G.keys.length;z++){const V=G.keys[z];let X,P,A;switch(W){case p.ANIMATIONTYPE_FLOAT:k=V.values[0],V.values.length>=2&&(X=V.values[1]),V.values.length>=3&&(P=V.values[2]),V.values.length>=4&&(A=V.values[3]);break;case p.ANIMATIONTYPE_QUATERNION:if(k=J.g.ld(V.values),V.values.length>=8){const G=J.g.ld(V.values.slice(4,8));G.equals(J.g.Zero())||(X=G)}if(V.values.length>=12){const G=J.g.ld(V.values.slice(8,12));G.equals(J.g.Zero())||(P=G)}V.values.length>=13&&(A=V.values[12]);break;case p.ANIMATIONTYPE_MATRIX:k=J.c.ld(V.values),V.values.length>=17&&(A=V.values[16]);break;case p.ANIMATIONTYPE_COLOR3:k=R.d.ld(V.values),V.values[3]&&(X=R.d.ld(V.values[3])),V.values[4]&&(P=R.d.ld(V.values[4])),V.values[5]&&(A=V.values[5]);break;case p.ANIMATIONTYPE_COLOR4:k=R.h.ld(V.values),V.values[4]&&(X=R.h.ld(V.values[4])),V.values[5]&&(P=R.h.ld(V.values[5])),V.values[6]&&(A=R.h.ld(V.values[6]));break;case p.ANIMATIONTYPE_VECTOR3:default:k=J.o.ld(V.values),V.values[3]&&(X=J.o.ld(V.values[3])),V.values[4]&&(P=J.o.ld(V.values[4])),V.values[5]&&(A=V.values[5])}const x={};x.frame=V.frame,x.value=k,void 0!=X&&(x.inTangent=X),void 0!=P&&(x.outTangent=P),void 0!=A&&(x.interpolation=A),d.push(x)}if(V.setKeys(d),G.ranges)for(z=0;z<G.ranges.length;z++)k=G.ranges[z],V.createRange(k.name,k.from,k.to);return V}static AppendSerializedAnimations(G,V){x.e.AppendSerializedAnimations(G,V)}static async ParseFromFileAsync(G,V){return await new Promise(((W,J)=>{const R=new A.b;R.addEventListener("readystatechange",(()=>{if(4==R.readyState)if(200==R.status){let V=JSON.parse(R.responseText);if(V.animations&&(V=V.animations),V.length){const G=[];for(const W of V)G.push(this.Parse(W));W(G)}else{const J=this.Parse(V);G&&(J.name=G),W(J)}}else J("Unable to load the animation")})),R.open("GET",V),R.send()}))}static async ParseFromSnippetAsync(G){return await new Promise(((V,W)=>{const J=new A.b;J.addEventListener("readystatechange",(()=>{if(4==J.readyState)if(200==J.status){const W=JSON.parse(JSON.parse(J.responseText).jsonPayload);if(W.animations){const J=JSON.parse(W.animations),R=[];for(const V of J.animations){const W=this.Parse(V);W.snippetId=G,R.push(W)}V(R)}else{const J=JSON.parse(W.animation),R=this.Parse(J);R.snippetId=G,V(R)}}else W("Unable to load the snippet "+G)})),J.open("GET",this.SnippetUrl+"/"+G.replace(/#/g,"/")),J.send()}))}}p._UniqueIdGenerator=0,p.AllowMatricesInterpolation=!1,p.AllowMatrixDecomposeForInterpolation=!0,p.SnippetUrl="https://snippet.babylonjs.com",p.ANIMATIONTYPE_FLOAT=0,p.ANIMATIONTYPE_VECTOR3=1,p.ANIMATIONTYPE_QUATERNION=2,p.ANIMATIONTYPE_MATRIX=3,p.ANIMATIONTYPE_COLOR3=4,p.ANIMATIONTYPE_COLOR4=7,p.ANIMATIONTYPE_VECTOR2=5,p.ANIMATIONTYPE_SIZE=6,p.ANIMATIONLOOPMODE_RELATIVE=0,p.ANIMATIONLOOPMODE_CYCLE=1,p.ANIMATIONLOOPMODE_CONSTANT=2,p.ANIMATIONLOOPMODE_YOYO=4,p.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,p.CreateFromSnippetAsync=p.ParseFromSnippetAsync,(0,k.d)("BABYLON.Animation",p),X.d._AnimationRangeFactory=(G,V,W)=>new z.d(G,V,W)},11855:(G,V,W)=>{W.d(V,{d:()=>J});class J{constructor(G,V,W){this.name=G,this.from=V,this.to=W}clone(){return new J(this.name,this.from,this.to)}}},11345:(G,V,W)=>{W.d(V,{b:()=>k,c:()=>z});var J=W(11353),R=W(11201),d=W(11358);class k{get P(){return this._isDisposed}constructor(G,V,W){let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,d=arguments.length>4&&void 0!==arguments[4]&&arguments[4],k=arguments.length>5&&void 0!==arguments[5]&&arguments[5],z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7?arguments[7]:void 0,P=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,G&&G.HG?this._engine=G.HG().getEngine():this._engine=G,this._updatable=W,this._instanced=k,this._divisor=X||1,this._label=P,V instanceof J.e?(this._data=null,this._buffer=V):(this._data=V,this._buffer=null),this.byteStride=z?R:R*Float32Array.BYTES_PER_ELEMENT,d||this.create()}createVertexBuffer(G,V,W,J,R){let d=arguments.length>5&&void 0!==arguments[5]&&arguments[5],k=arguments.length>6?arguments[6]:void 0;const X=d?V:V*Float32Array.BYTES_PER_ELEMENT,P=J?d?J:J*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new z(this._engine,this,G,this._updatable,!0,P,void 0===R?this._instanced:R,X,W,void 0,void 0,!0,this._divisor||k)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!G&&this._buffer||(G=G||this._data,G&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,G),this._data=G):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(G,this._label),this._data=G):this._buffer=this._engine.createVertexBuffer(G,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.DV>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.DV,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.DV,void 0,this._label));R.c.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(G){this.create(G)}updateDirectly(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,G,J?V:V*Float32Array.BYTES_PER_ELEMENT,W?W*this.byteStride:void 0),this._data=0===V&&void 0===W?G:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class z{get P(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(G){const V=0!=G;this._instanceDivisor=G,V!==this._instanced&&(this._instanced=V,this._computeHashCode())}get _maxVerticesCount(){const G=this.getData();return G?Array.isArray(G)?G.length/(this.byteStride/4)-this.byteOffset/4:(G.byteLength-this.byteOffset)/this.byteStride:0}constructor(G,V,W,J,R,X,P,A,x,q){let L=arguments.length>10&&void 0!==arguments[10]&&arguments[10],t=arguments.length>11&&void 0!==arguments[11]&&arguments[11],Y=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,g=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let B=!1;if(this.Ik=G,"object"===typeof J&&null!==J?(B=J.updatable??!1,R=J.postponeInternalCreation,X=J.stride,P=J.instanced,A=J.offset,x=J.size,q=J.type,L=J.normalized??!1,t=J.useBytes??!1,Y=J.divisor??1,g=J.takeBufferOwnership??!1,this._label=J.label):B=!!J,V instanceof k?(this._buffer=V,this._ownsBuffer=g):(this._buffer=new k(G,V,B,X,R,P,t,Y,this._label),this._ownsBuffer=!0),this.uniqueId=z._Counter++,this._kind=W,void 0===q){const G=this.getData();this.type=G?z.GetDataType(G):z.FLOAT}else this.type=q;const S=(0,d.k)(this.type);t?(this._size=x||(X?X/S:z.DeduceStride(W)),this.byteStride=X||this._buffer.byteStride||this._size*S,this.byteOffset=A||0):(this._size=x||X||z.DeduceStride(W),this.byteStride=X?X*S:this._buffer.byteStride||this._size*S,this.byteOffset=(A||0)*S),this.normalized=L,this._instanced=void 0!==P&&P,this._instanceDivisor=P?Y:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var G;null===(G=this._buffer)||void 0===G||G._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(G,V){const W=this.getData();return W?(0,d.g)(W,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,G,V):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,d.k)(this.type)}getOffset(){return this.byteOffset/(0,d.k)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,d.k)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(G){this._buffer.create(G),this._alignBuffer()}update(G){this._buffer.update(G),this._alignBuffer()}updateDirectly(G,V){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(G,V,void 0,W),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(G,V){(0,d.f)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,G,this.normalized,((G,W)=>{for(let J=0;J<this._size;J++)V(G[J],W+J)}))}_alignBuffer(){}static DeduceStride(G){switch(G){case z.UVKind:case z.UV2Kind:case z.UV3Kind:case z.UV4Kind:case z.UV5Kind:case z.UV6Kind:return 2;case z.NormalKind:case z.PositionKind:return 3;case z.ColorKind:case z.ColorInstanceKind:case z.MatricesIndicesKind:case z.MatricesIndicesExtraKind:case z.MatricesWeightsKind:case z.MatricesWeightsExtraKind:case z.TangentKind:return 4;default:throw new Error("Invalid kind '"+G+"'")}}static GetDataType(G){return G instanceof Int8Array?z.BYTE:G instanceof Uint8Array?z.UNSIGNED_BYTE:G instanceof Int16Array?z.SHORT:G instanceof Uint16Array?z.UNSIGNED_SHORT:G instanceof Int32Array?z.INT:G instanceof Uint32Array?z.UNSIGNED_INT:z.FLOAT}static GetTypeByteLength(G){return(0,d.k)(G)}static ForEach(G,V,W,J,R,k,z,X){(0,d.f)(G,V,W,J,R,k,z,((G,V)=>{for(let W=0;W<J;W++)X(G[W],V+W)}))}static GetFloatData(G,V,W,J,R,k,z,X){return(0,d.g)(G,V,W,J,R,k,z,X)}}z._Counter=0,z.BYTE=5120,z.UNSIGNED_BYTE=5121,z.SHORT=5122,z.UNSIGNED_SHORT=5123,z.INT=5124,z.UNSIGNED_INT=5125,z.FLOAT=5126,z.PositionKind="position",z.NormalKind="normal",z.TangentKind="tangent",z.UVKind="uv",z.UV2Kind="uv2",z.UV3Kind="uv3",z.UV4Kind="uv4",z.UV5Kind="uv5",z.UV6Kind="uv6",z.ColorKind="color",z.ColorInstanceKind="instanceColor",z.MatricesIndicesKind="matricesIndices",z.MatricesWeightsKind="matricesWeights",z.MatricesIndicesExtraKind="matricesIndicesExtra",z.MatricesWeightsExtraKind="matricesWeightsExtra"},11358:(G,V,W)=>{W.d(V,{c:()=>q,e:()=>x,f:()=>X,g:()=>P,k:()=>k,o:()=>z,s:()=>A});var J=W(11201);function R(G,V,W,J){switch(V){case 5120:{let V=G.getInt8(W);return J&&(V=Math.max(V/127,-1)),V}case 5121:{let V=G.getUint8(W);return J&&(V/=255),V}case 5122:{let V=G.getInt16(W,!0);return J&&(V=Math.max(V/32767,-1)),V}case 5123:{let V=G.getUint16(W,!0);return J&&(V/=65535),V}case 5124:return G.getInt32(W,!0);case 5125:return G.getUint32(W,!0);case 5126:return G.getFloat32(W,!0);default:throw new Error(`Invalid component type ${V}`)}}function d(G,V,W,J,R){switch(V){case 5120:J&&(R=Math.round(127*R)),G.setInt8(W,R);break;case 5121:J&&(R=Math.round(255*R)),G.setUint8(W,R);break;case 5122:J&&(R=Math.round(32767*R)),G.setInt16(W,R,!0);break;case 5123:J&&(R=Math.round(65535*R)),G.setUint16(W,R,!0);break;case 5124:G.setInt32(W,R,!0);break;case 5125:G.setUint32(W,R,!0);break;case 5126:G.setFloat32(W,R,!0);break;default:throw new Error(`Invalid component type ${V}`)}}function k(G){switch(G){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${G}'`)}}function z(G){switch(G){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${G}'`)}}function X(G,V,W,J,z,X,P,A){const x=new Array(J),q=new Array(J);if(G instanceof Array){let R=V/4;const d=W/4;for(let V=0;V<X;V+=J){for(let V=0;V<J;V++)x[V]=q[V]=G[R+V];A(q,V);for(let V=0;V<J;V++)x[V]!==q[V]&&(G[R+V]=q[V]);R+=d}}else{const L=ArrayBuffer.isView(G)?new DataView(G.buffer,G.byteOffset,G.byteLength):new DataView(G),t=k(z);for(let G=0;G<X;G+=J){for(let G=0,W=V;G<J;G++,W+=t)x[G]=q[G]=R(L,z,W,P);A(q,G);for(let G=0,W=V;G<J;G++,W+=t)x[G]!==q[G]&&d(L,z,W,P,q[G]);V+=W}}}function P(G,V,W,R,d,z,P,A){const x=V*k(W),q=P*V;if(5126!==W||d!==x){const J=new Float32Array(q);return X(G,R,d,V,W,q,z,((G,W)=>{for(let R=0;R<V;R++)J[W+R]=G[R]})),J}if(!(G instanceof Array||G instanceof Float32Array)||0!==R||G.length!==q){if(G instanceof Array){const V=R/4;return G.slice(V,V+q)}if(G instanceof ArrayBuffer)return new Float32Array(G,R,q);{const V=G.byteOffset+R;return 0!==(3&V)&&(J.c.Warn("Float array must be aligned to 4-bytes border"),A=!0),A?new Float32Array(G.buffer.slice(V,V+q*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(G.buffer,V,q)}}return A?G.slice():G}function A(G,V,W,R,d,P,A,x){const q=k(W),L=z(W),t=A*V;if(Array.isArray(G)){if(0!==(3&R)||0!==(3&d))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const J=R/4,k=d/4;if(J+(A-1)*k+V>G.length)throw new Error("Last accessed index is out of bounds.");if(k<V)throw new Error("Data stride cannot be smaller than the component size.");if(k!==V){const J=new L(t);return X(G,R,d,V,W,t,P,((G,W)=>{for(let R=0;R<V;R++)J[W+R]=G[R]})),J}return new L(G.slice(J,J+t))}let Y,g=R;G instanceof ArrayBuffer?Y=G:(Y=G.buffer,g+=G.byteOffset);if(g+(A-1)*d+V*q>Y.byteLength)throw new Error("Last accessed byte is out of bounds.");const B=V*q;if(d<B)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(d!==B){const G=new L(t);return X(Y,g,d,V,W,t,P,((W,J)=>{for(let R=0;R<V;R++)G[J+R]=W[R]})),G}return 1!==q&&0!==(g&q-1)&&(J.c.Warn("Array must be aligned to border of element size. Data will be copied."),x=!0),x?new L(Y.slice(g,g+t*q)):new L(Y,g,t)}function x(G,V,W,R,d,z,P,A){const x=V*k(W),q=P*V;if(A.length!==q)throw new Error("Output length is not valid");if(5126===W&&d===x)if(G instanceof Array){const V=R/4;A.set(G,V)}else if(G instanceof ArrayBuffer){const V=new Float32Array(G,R,q);A.set(V)}else{const V=G.byteOffset+R;if(0!==(3&V))return J.c.Warn("Float array must be aligned to 4-bytes border"),void A.set(new Float32Array(G.buffer.slice(V,V+q*Float32Array.BYTES_PER_ELEMENT)));const W=new Float32Array(G.buffer,V,q);A.set(W)}else X(G,R,d,V,W,q,z,((G,W)=>{for(let J=0;J<V;J++)A[W+J]=G[J]}))}function q(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(G)){for(let R=0;R<V;R++)if(G[W+R]-J>65535)return!0;return!1}return 4===G.BYTES_PER_ELEMENT}},11353:(G,V,W)=>{W.d(V,{e:()=>J});class J{get underlyingResource(){return null}constructor(){this.references=0,this.DV=0,this.is32Bits=!1,this.uniqueId=J._Counter++}}J._Counter=0},11516:(G,V,W)=>{W.d(V,{c:()=>g});var J=W(11317),R=W(11324),d=W(11525),k=W(11189),z=W(11176),X=W(11136),P=W(11465),A=W(11201),x=W(11159),q=W(11218),L=W(11530),t=W(11532),Y=W(11411);class g extends P.d{get position(){return this._position}set position(G){this._position=G}set upVector(G){this._upVector=G}get upVector(){return this._upVector}get screenArea(){let G=0,V=0;if(this.mode===g.PERSPECTIVE_CAMERA)this.fovMode===g.FOVMODE_VERTICAL_FIXED?(V=2*this.Zd*Math.tan(this.fov/2),G=this.getEngine().getAspectRatio(this)*V):(G=2*this.Zd*Math.tan(this.fov/2),V=G/this.getEngine().getAspectRatio(this));else{const W=this.getEngine().getRenderWidth()/2,J=this.getEngine().getRenderHeight()/2;G=(this.orthoRight??W)-(this.orthoLeft??-W),V=(this.orthoTop??J)-(this.orthoBottom??-J)}return G*V}set orthoLeft(G){this._orthoLeft=G;for(const V of this._rigCameras)V.orthoLeft=G}get orthoLeft(){return this._orthoLeft}set orthoRight(G){this._orthoRight=G;for(const V of this._rigCameras)V.orthoRight=G}get orthoRight(){return this._orthoRight}set orthoBottom(G){this._orthoBottom=G;for(const V of this._rigCameras)V.orthoBottom=G}get orthoBottom(){return this._orthoBottom}set orthoTop(G){this._orthoTop=G;for(const V of this._rigCameras)V.orthoTop=G}get orthoTop(){return this._orthoTop}setFocalLength(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:36;this.fov=2*Math.atan(V/(2*G))}set mode(G){this._mode=G;for(const V of this._rigCameras)V.mode=G}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(G,V,W){let J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(G,W,!1),this._position=X.o.Zero(),this._upVector=X.o.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.Zd=1,this.maxZ=1e4,this.inertia=.9,this._mode=g.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new L.e(0,0,1,1),this.layerMask=268435455,this.fovMode=g.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=g.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new z.b,this.onProjectionMatrixChangedObservable=new z.b,this.onAfterCheckInputsObservable=new z.b,this.onRestoreStateObservable=new z.b,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new X.c,this._postProcesses=new Array,this._activeMeshes=new d.f(256),this._globalPosition=X.o.Zero(),this._computedViewMatrix=X.c.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=X.c.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=X.g.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.HG().addCamera(this),J&&!this.HG().activeCamera&&(this.HG().activeCamera=this),this.position=V,this.renderPassId=this.HG().getEngine().createRenderPassId(`Camera ${G}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"KP"}toString(G){let V="Name: "+this.name;if(V+=", type: "+this.getClassName(),this.animations)for(let W=0;W<this.animations.length;W++)V+=", animation[0]: "+this.animations[W].toString(G);return V}applyVerticalCorrection(){const G=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-G.x:G.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(G){return-1!==this._activeMeshes.indexOf(G)}isReady(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(G)for(const V of this._postProcesses)if(V&&!V.isReady())return!1;return super.isReady(G)}_initCache(){super._initCache(),this._cache.position=new X.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new X.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.Zd=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(G){G||super._updateCache(),this._cache.position.J(this.position),this._cache.upVector.J(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let G=this._cache.mode===this.mode&&this._cache.Zd===this.Zd&&this._cache.maxZ===this.maxZ;if(!G)return!1;const V=this.getEngine();return this.mode===g.PERSPECTIVE_CAMERA?G=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===V.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(G=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===V.getRenderWidth()&&this._cache.renderHeight===V.getRenderHeight(),this.oblique&&(G=G&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),G}attachControl(G,V){}zx(G){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==g.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let G=0;G<this._postProcesses.length;G++)if(null!==this._postProcesses[G])return this._postProcesses[G];return null}_cascadePostProcessesToRigCams(){const G=this._getFirstPostProcess();G&&G.markTextureDirty();for(let V=0,W=this._rigCameras.length;V<W;V++){const G=this._rigCameras[V],W=G._rigPostProcess;if(W){"pass"===W.getEffectName()&&(G.isIntermediate=0===this._postProcesses.length),G._postProcesses=this._postProcesses.slice(0).concat(W),W.markTextureDirty()}else G._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!G.isReusable()&&this._postProcesses.indexOf(G)>-1?(A.c.Error("You're trying to reuse a post process not defined as reusable."),0):(null==V||V<0?this._postProcesses.push(G):null===this._postProcesses[V]?this._postProcesses[V]=G:this._postProcesses.splice(V,0,G),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.pP(),this._postProcesses.indexOf(G))}detachPostProcess(G){const V=this._postProcesses.indexOf(G);-1!==V&&(this._postProcesses[V]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.pP(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return X.c.Identity()}getViewMatrix(G){return!G&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.HG().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(G){this._doNotComputeProjectionMatrix=!0,void 0!==G&&(this._projectionMatrix=G)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(G){if(this._doNotComputeProjectionMatrix||!G&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.Zd=this.Zd,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const V=this.getEngine(),W=this.HG(),J=V.useReverseDepthBuffer;if(this.mode===g.PERSPECTIVE_CAMERA){let G;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=V.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.Zd<=0&&(this.Zd=.1),G=W.useRightHandedSystem?X.c.PerspectiveFovRHToRef:X.c.PerspectiveFovLHToRef,G(this.fov,V.getAspectRatio(this),J?this.maxZ:this.Zd,J?this.Zd:this.maxZ,this._projectionMatrix,this.fovMode===g.FOVMODE_VERTICAL_FIXED,V.isNDCHalfZRange,this.projectionPlaneTilt,J)}else{var R,d,k;const G=V.getRenderWidth()/2,z=V.getRenderHeight()/2;W.useRightHandedSystem?this.oblique?X.c.ObliqueOffCenterRHToRef(this.orthoLeft??-G,this.orthoRight??G,this.orthoBottom??-z,this.orthoTop??z,J?this.maxZ:this.Zd,J?this.Zd:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,V.isNDCHalfZRange):X.c.OrthoOffCenterRHToRef(this.orthoLeft??-G,this.orthoRight??G,this.orthoBottom??-z,this.orthoTop??z,J?this.maxZ:this.Zd,J?this.Zd:this.maxZ,this._projectionMatrix,V.isNDCHalfZRange):this.oblique?X.c.ObliqueOffCenterLHToRef(this.orthoLeft??-G,this.orthoRight??G,this.orthoBottom??-z,this.orthoTop??z,J?this.maxZ:this.Zd,J?this.Zd:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,V.isNDCHalfZRange):X.c.OrthoOffCenterLHToRef(this.orthoLeft??-G,this.orthoRight??G,this.orthoBottom??-z,this.orthoTop??z,J?this.maxZ:this.Zd,J?this.Zd:this.maxZ,this._projectionMatrix,V.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(R=this.oblique)||void 0===R?void 0:R.angle,this._cache.obliqueLength=null===(d=this.oblique)||void 0===d?void 0:d.length,this._cache.obliqueOffset=null===(k=this.oblique)||void 0===k?void 0:k.offset,this._cache.renderWidth=V.getRenderWidth(),this._cache.renderHeight=V.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(G){return(this.radius||(this.target?X.o.Distance(this.position,this.target):this.position.length()))+G}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?t.c.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=t.c.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),V&&this.rigCameras.length>0){let V=!1;for(const W of this.rigCameras)W._updateFrustumPlanes(),V=V||G.isInFrustum(W._frustumPlanes);return V}return G.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(G){return this._updateFrustumPlanes(),G.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,q.e)("Ray")}getForwardRayToRef(G){throw(0,q.e)("Ray")}dispose(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.HG().stopAnimation(this),this.HG().removeCamera(this);this._rigCameras.length>0;){const G=this._rigCameras.pop();G&&G.dispose()}if(this._parentContainer){const G=this._parentContainer.cameras.indexOf(this);G>-1&&this._parentContainer.cameras.splice(G,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==g.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let G=this._postProcesses.length;for(;--G>=0;){const V=this._postProcesses[G];V&&V.dispose(this)}}let W=this.customRenderTargets.length;for(;--W>=0;)this.customRenderTargets[W].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.HG().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(G,V)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(G,V){if(this.cameraRigMode!==G){for(;this._rigCameras.length>0;){const G=this._rigCameras.pop();G&&G.dispose()}if(this.cameraRigMode=G,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=V.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=k.h.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==g.RIG_MODE_NONE){const G=this.createRigCamera(this.name+"_L",0);G&&(G._isLeftCamera=!0);const V=this.createRigCamera(this.name+"_R",1);V&&(V._isRightCamera=!0),G&&V&&(this._rigCameras.push(G),this._rigCameras.push(V))}this._setRigMode(V),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(G){}_getVRProjectionMatrix(){return X.c.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.Zd,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(G,V){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[G]=V,"interaxialDistance"===G&&(this._cameraRigParams.stereoHalfAngle=k.h.ToRadians(V/.0637))}createRigCamera(G,V){return null}_updateRigCameras(){for(let G=0;G<this._rigCameras.length;G++)this._rigCameras[G].Zd=this.Zd,this._rigCameras[G].maxZ=this.maxZ,this._rigCameras[G].fov=this.fov,this._rigCameras[G].upVector.J(this.upVector);this.cameraRigMode===g.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const G=Y.e.Serialize(this);return G.uniqueId=this.uniqueId,G.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(G),this.inputs&&this.inputs.serialize(G),Y.e.AppendSerializedAnimations(this,G),G.ranges=this.serializeAnimationRanges(),G.isEnabled=this.isEnabled(),G}clone(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=Y.e.Clone(g.GetConstructorFromName(this.getClassName(),G,this.HG(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return W.name=G,W.parent=V,this.onClonedObservable.notifyObservers(W),W}xX(G){const V=X.o.Zero();return this.getDirectionToRef(G,V),V}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(G,V){X.o.TransformNormalToRef(G,this.getWorldMatrix(),V)}static GetConstructorFromName(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,R=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const d=P.d.Construct(G,V,W,{interaxial_distance:J,isStereoscopicSideBySide:R});return d||(()=>g._CreateDefaultParsedCamera(V,W))}kd(){return this.getWorldMatrix()}static Parse(G,V){const W=G.type,J=g.GetConstructorFromName(W,G.name,V,G.interaxial_distance,G.isStereoscopicSideBySide),R=Y.e.Parse(J,G,V);if(void 0!==G.parentId&&(R._waitingParentId=G.parentId),void 0!==G.parentInstanceIndex&&(R._waitingParentInstanceIndex=G.parentInstanceIndex),R.inputs&&(R.inputs.parse(G),R._setupInputs()),G.upVector&&(R.upVector=X.o.ld(G.upVector)),R.setPosition&&(R.position.rd(0,0,0),R.setPosition(X.o.ld(G.position))),G.target&&R.setTarget&&R.setTarget(X.o.ld(G.target)),G.cameraRigMode){const V=G.interaxial_distance?{interaxialDistance:G.interaxial_distance}:{};R.setCameraRigMode(G.cameraRigMode,V)}if(G.animations){for(let V=0;V<G.animations.length;V++){const W=G.animations[V],J=(0,x.c)("BABYLON.Animation");J&&R.animations.push(J.Parse(W))}P.d.ParseAnimationRanges(R,G,V)}return G.autoAnimate&&V.beginAnimation(R,G.autoAnimateFrom,G.autoAnimateTo,G.autoAnimateLoop,G.autoAnimateSpeed||1),void 0!==G.isEnabled&&R.rz(G.isEnabled),R}_calculateHandednessMultiplier(){let G=this.HG().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(G*=-1),G}}g._CreateDefaultParsedCamera=(G,V)=>{throw(0,q.e)("UniversalCamera")},g.PERSPECTIVE_CAMERA=0,g.ORTHOGRAPHIC_CAMERA=1,g.FOVMODE_VERTICAL_FIXED=0,g.FOVMODE_HORIZONTAL_FIXED=1,g.RIG_MODE_NONE=0,g.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,g.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,g.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,g.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,g.RIG_MODE_STEREOSCOPIC_INTERLACED=14,g.RIG_MODE_VR=20,g.RIG_MODE_CUSTOM=22,g.ForceAttachControlToAlwaysPreventDefault=!1,(0,J.e)([(0,R.F)("position")],g.prototype,"_position",void 0),(0,J.e)([(0,R.F)("upVector")],g.prototype,"_upVector",void 0),(0,J.e)([(0,R.I)()],g.prototype,"orthoLeft",null),(0,J.e)([(0,R.I)()],g.prototype,"orthoRight",null),(0,J.e)([(0,R.I)()],g.prototype,"orthoBottom",null),(0,J.e)([(0,R.I)()],g.prototype,"orthoTop",null),(0,J.e)([(0,R.I)()],g.prototype,"fov",void 0),(0,J.e)([(0,R.I)()],g.prototype,"projectionPlaneTilt",void 0),(0,J.e)([(0,R.I)()],g.prototype,"Zd",void 0),(0,J.e)([(0,R.I)()],g.prototype,"maxZ",void 0),(0,J.e)([(0,R.I)()],g.prototype,"inertia",void 0),(0,J.e)([(0,R.I)()],g.prototype,"mode",null),(0,J.e)([(0,R.I)()],g.prototype,"layerMask",void 0),(0,J.e)([(0,R.I)()],g.prototype,"fovMode",void 0),(0,J.e)([(0,R.I)()],g.prototype,"cameraRigMode",void 0),(0,J.e)([(0,R.I)()],g.prototype,"interaxialDistance",void 0),(0,J.e)([(0,R.I)()],g.prototype,"isStereoscopicSideBySide",void 0)},11718:(G,V,W)=>{W.d(V,{e:()=>x});var J=W(11317),R=W(11324),d=W(11516),k=W(11136),z=W(11145),X=W(11496);W(11465).d.AddNodeConstructor("TargetCamera",((G,V)=>()=>new x(G,k.o.Zero(),V)));const P=k.c.Zero(),A=k.g.Identity();class x extends d.c{constructor(G,V,W){super(G,V,W,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this.cameraDirection=new k.o(0,0,0),this.cameraRotation=new k.k(0,0),this.updateUpVectorFromRotation=!1,this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=k.o.Zero(),this._initialFocalDistance=1,this._viewMatrix=k.c.Zero(),this._cameraTransformMatrix=k.c.Zero(),this._cameraRotationMatrix=k.c.Zero(),this._transformedReferencePoint=k.o.Zero(),this._deferredPositionUpdate=new k.o,this._deferredRotationQuaternionUpdate=new k.g,this._deferredRotationUpdate=new k.o,this._deferredUpdated=!1,this._deferOnly=!1,this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0,this._referencePoint=k.o.Forward(this.HG().useRightHandedSystem),this.rotation=new k.o(0,this.HG().useRightHandedSystem?Math.PI:0,0)}getFrontPosition(G){this.getWorldMatrix();const V=k.h.ed[0],W=k.h.ed[1];return W.set(0,0,this._scene.useRightHandedSystem?-1:1),this.getDirectionToRef(W,V),V.scaleInPlace(G),this.globalPosition.add(V)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const G=this.lockedTarget;G.kd().getTranslationToRef(G.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.rd(0,0,0),this.cameraRotation.rd(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new k.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new k.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new k.g(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(G){G||super._updateCache();const V=this._getLockedTargetPosition();V?this._cache.lockedTarget?this._cache.lockedTarget.J(V):this._cache.lockedTarget=V.clone():this._cache.lockedTarget=null,this._cache.rotation.J(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.J(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const G=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(G):!G)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const G=this.getEngine();return this.speed*Math.sqrt(G.getDeltaTime()/(100*G.getFps()))}setTarget(G){this.upVector.normalize(),this._initialFocalDistance=G.zW(this.position).length(),this.position.z===G.z&&(this.position.z+=z.c),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),this.HG().useRightHandedSystem?k.c.LookAtRHToRef(this.position,G,k.o.UpReadOnly,P):k.c.LookAtLHToRef(this.position,G,k.o.UpReadOnly,P),P.invert();const V=this.rotationQuaternion||A;k.g.FromRotationMatrixToRef(P,V),V.toEulerAnglesToRef(this.rotation),this.rotation.z=0}get target(){return this.getTarget()}set target(G){this.setTarget(G)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(k.h.Matrix[0]),k.o.TransformNormalToRef(this.cameraDirection,k.h.Matrix[0],k.h.ed[0]),this._deferredPositionUpdate.addInPlace(k.h.ed[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.J(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.J(this._deferredPositionUpdate)}_checkInputs(){const G=this.invertRotation?-this.inverseRotationSpeed:1,V=this._decideIfNeedsToMove(),W=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.J(this.rotation),this._deferredPositionUpdate.J(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.J(this.rotationQuaternion),V&&this._updatePosition(),W){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*G,this._deferredRotationUpdate.y+=this.cameraRotation.y*G,!this.noRotationConstraint){const G=1.570796;this._deferredRotationUpdate.x>G&&(this._deferredRotationUpdate.x=G),this._deferredRotationUpdate.x<-G&&(this._deferredRotationUpdate.x=-G)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.J(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(k.g.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.J(this._deferredRotationQuaternionUpdate))}}V&&(Math.abs(this.cameraDirection.x)<this.speed*z.c&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*z.c&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*z.c&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),W&&(Math.abs(this.cameraRotation.x)<this.speed*z.c&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*z.c&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):k.c.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return k.o.TransformNormalToRef(k.o.UpReadOnly,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),k.o.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?X.e.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(k.g.FromEulerVectorToRef(this.rotation,A),X.e.Y.rotateByQuaternionToRef(A,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(G,V,W){if(this.HG().useRightHandedSystem?k.c.LookAtRHToRef(G,V,W,this._viewMatrix):k.c.LookAtLHToRef(G,V,W,this._viewMatrix),this.parent){const G=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(G,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.J(G)}createRigCamera(G,V){if(this.cameraRigMode!==d.c.RIG_MODE_NONE){const V=new x(G,this.position.clone(),this.HG());return V.isRigCamera=!0,V.rigParent=this,this.cameraRigMode===d.c.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new k.g),V._cameraRigParams={},V.rotationQuaternion=new k.g),V.mode=this.mode,V.orthoLeft=this.orthoLeft,V.orthoRight=this.orthoRight,V.orthoTop=this.orthoTop,V.orthoBottom=this.orthoBottom,V}return null}_updateRigCameras(){const G=this._rigCameras[0],V=this._rigCameras[1];switch(this.kd(),this.cameraRigMode){case d.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case d.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case d.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case d.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case d.c.RIG_MODE_STEREOSCOPIC_INTERLACED:{const W=this.cameraRigMode===d.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,J=this.cameraRigMode===d.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*W,G),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*J,V);break}case d.c.RIG_MODE_VR:G.rotationQuaternion?(G.rotationQuaternion.J(this.rotationQuaternion),V.rotationQuaternion.J(this.rotationQuaternion)):(G.rotation.J(this.rotation),V.rotation.J(this.rotation)),G.position.J(this.position),V.position.J(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(G,V){this.getTarget().subtractToRef(this.position,x._TargetFocalPoint),x._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const W=x._TargetFocalPoint.addInPlace(this.position);k.c.TranslationToRef(-W.x,-W.y,-W.z,x._TargetTransformMatrix),x._TargetTransformMatrix.multiplyToRef(k.c.RotationAxis(V.upVector,G),x._RigCamTransformMatrix),k.c.TranslationToRef(W.x,W.y,W.z,x._TargetTransformMatrix),x._RigCamTransformMatrix.multiplyToRef(x._TargetTransformMatrix,x._RigCamTransformMatrix),k.o.TransformCoordinatesToRef(this.position,x._RigCamTransformMatrix,V.position),V.setTarget(W)}getClassName(){return"TargetCamera"}}x._RigCamTransformMatrix=new k.c,x._TargetTransformMatrix=new k.c,x._TargetFocalPoint=new k.o,(0,J.e)([(0,R.I)()],x.prototype,"updateUpVectorFromRotation",void 0),(0,J.e)([(0,R.F)()],x.prototype,"rotation",void 0),(0,J.e)([(0,R.I)()],x.prototype,"speed",void 0),(0,J.e)([(0,R.v)("lockedTargetId")],x.prototype,"lockedTarget",void 0)},11360:(G,V,W)=>{W.d(V,{e:()=>J});class J{constructor(G,V,W){this.bu=G,this.bv=V,this.distance=W,this.faceId=0,this.subMeshId=0}}},11492:(G,V,W)=>{W.d(V,{d:()=>d});var J=W(11136),R=W(11345);class d{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(){var G;let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],W=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.pickedMesh||W&&!this.pickedMesh.isVerticesDataPresent(R.c.NormalKind))return null;let d,k=this.pickedMesh.Pd();0===(null===(G=k)||void 0===G?void 0:G.length)&&(k=null);const z=J.h.ed[0],X=J.h.ed[1],P=J.h.ed[2];if(W){const G=this.pickedMesh.getVerticesData(R.c.NormalKind);let V=k?J.o.FromArrayToRef(G,3*k[3*this.faceId],z):z.rd(G[3*this.faceId*3],G[3*this.faceId*3+1],G[3*this.faceId*3+2]),W=k?J.o.FromArrayToRef(G,3*k[3*this.faceId+1],X):X.rd(G[3*(3*this.faceId+1)],G[3*(3*this.faceId+1)+1],G[3*(3*this.faceId+1)+2]),A=k?J.o.FromArrayToRef(G,3*k[3*this.faceId+2],P):P.rd(G[3*(3*this.faceId+2)],G[3*(3*this.faceId+2)+1],G[3*(3*this.faceId+2)+2]);V=V.scale(this.bu),W=W.scale(this.bv),A=A.scale(1-this.bu-this.bv),d=new J.o(V.x+W.x+A.x,V.y+W.y+A.y,V.z+W.z+A.z)}else{const G=this.pickedMesh.getVerticesData(R.c.PositionKind),V=k?J.o.FromArrayToRef(G,3*k[3*this.faceId],z):z.rd(G[3*this.faceId*3],G[3*this.faceId*3+1],G[3*this.faceId*3+2]),W=k?J.o.FromArrayToRef(G,3*k[3*this.faceId+1],X):X.rd(G[3*(3*this.faceId+1)],G[3*(3*this.faceId+1)+1],G[3*(3*this.faceId+1)+2]),A=k?J.o.FromArrayToRef(G,3*k[3*this.faceId+2],P):P.rd(G[3*(3*this.faceId+2)],G[3*(3*this.faceId+2)+1],G[3*(3*this.faceId+2)+2]),x=V.zW(W),q=A.zW(W);d=J.o.Cross(x,q)}const A=(G,V)=>{if(-1!==this.thinInstanceIndex){const W=G.thinInstanceGetWorldMatrices()[this.thinInstanceIndex];W&&J.o.TransformNormalToRef(V,W,V)}let W=G.getWorldMatrix();G.nonUniformScaling&&(J.h.Matrix[0].J(W),W=J.h.Matrix[0],W.setTranslationFromFloats(0,0,0),W.invert(),W.transposeToRef(J.h.Matrix[1]),W=J.h.Matrix[1]),J.o.TransformNormalToRef(V,W,V)};if(V&&A(this.pickedMesh,d),this.ray){const G=J.h.ed[0].J(d);V||A(this.pickedMesh,G),J.o.Dot(G,this.ray.direction)>0&&d.negateInPlace()}return d.normalize(),d}getTextureCoordinates(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R.c.UVKind;if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(G))return null;const V=this.pickedMesh.Pd();if(!V)return null;const W=this.pickedMesh.getVerticesData(G);if(!W)return null;let d=J.k.ld(W,2*V[3*this.faceId]),k=J.k.ld(W,2*V[3*this.faceId+1]),z=J.k.ld(W,2*V[3*this.faceId+2]);return d=d.scale(this.bu),k=k.scale(this.bv),z=z.scale(1-this.bu-this.bv),new J.k(d.x+k.x+z.x,d.y+k.y+z.y)}}},11552:(G,V,W)=>{W.d(V,{b:()=>J});let J=!1},11373:(G,V,W)=>{W.d(V,{b:()=>k});var J=W(11152),R=W(11136),d=W(11145);class k{constructor(G,V,W){this.vectors=(0,J.b)(8,R.o.Zero),this.center=R.o.Zero(),this.centerWorld=R.o.Zero(),this.extendSize=R.o.Zero(),this.extendSizeWorld=R.o.Zero(),this.directions=(0,J.b)(3,R.o.Zero),this.vectorsWorld=(0,J.b)(8,R.o.Zero),this.minimumWorld=R.o.Zero(),this.maximumWorld=R.o.Zero(),this.minimum=R.o.Zero(),this.maximum=R.o.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(G,V,W)}reConstruct(G,V,W){const J=G.x,d=G.y,k=G.z,z=V.x,X=V.y,P=V.z,A=this.vectors;this.minimum.rd(J,d,k),this.maximum.rd(z,X,P),A[0].rd(J,d,k),A[1].rd(z,X,P),A[2].rd(z,d,k),A[3].rd(J,X,k),A[4].rd(J,d,P),A[5].rd(z,X,k),A[6].rd(J,X,P),A[7].rd(z,d,P),V.addToRef(G,this.center).scaleInPlace(.5),V.subtractToRef(G,this.extendSize).scaleInPlace(.5),this._worldMatrix=W||R.c.IdentityReadOnly,this._update(this._worldMatrix)}scale(G){const V=k._TmpVector3,W=this.maximum.subtractToRef(this.minimum,V[0]),J=W.length();W.normalizeFromLength(J);const R=J*G,d=W.scaleInPlace(.5*R),z=this.center.subtractToRef(d,V[1]),X=this.center.addToRef(d,V[2]);return this.reConstruct(z,X,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(G){const V=this.minimumWorld,W=this.maximumWorld,J=this.directions,d=this.vectorsWorld,k=this.vectors;if(G.isIdentity()){V.J(this.minimum),W.J(this.maximum);for(let G=0;G<8;++G)d[G].J(k[G]);this.extendSizeWorld.J(this.extendSize),this.centerWorld.J(this.center)}else{V.Ud(Number.MAX_VALUE),W.Ud(-Number.MAX_VALUE);for(let J=0;J<8;++J){const z=d[J];R.o.TransformCoordinatesToRef(k[J],G,z),V.minimizeInPlace(z),W.maximizeInPlace(z)}W.subtractToRef(V,this.extendSizeWorld).scaleInPlace(.5),W.addToRef(V,this.centerWorld).scaleInPlace(.5)}R.o.FromArrayToRef(G.m,0,J[0]),R.o.FromArrayToRef(G.m,4,J[1]),R.o.FromArrayToRef(G.m,8,J[2]),this._worldMatrix=G}isInFrustum(G){return k.IsInFrustum(this.vectorsWorld,G)}isCompletelyInFrustum(G){return k.IsCompletelyInFrustum(this.vectorsWorld,G)}intersectsPoint(G){const V=this.minimumWorld,W=this.maximumWorld,J=V.x,R=V.y,k=V.z,z=W.x,X=W.y,P=W.z,A=G.x,x=G.y,q=G.z,L=-d.c;return!(z-A<L||L>A-J)&&(!(X-x<L||L>x-R)&&!(P-q<L||L>q-k))}intersectsSphere(G){return k.IntersectsSphere(this.minimumWorld,this.maximumWorld,G.centerWorld,G.radiusWorld)}intersectsMinMax(G,V){const W=this.minimumWorld,J=this.maximumWorld,R=W.x,d=W.y,k=W.z,z=J.x,X=J.y,P=J.z,A=G.x,x=G.y,q=G.z,L=V.x,t=V.y,Y=V.z;return!(z<A||R>L)&&(!(X<x||d>t)&&!(P<q||k>Y))}dispose(){var G,V;null===(G=this._drawWrapperFront)||void 0===G||G.dispose(),null===(V=this._drawWrapperBack)||void 0===V||V.dispose()}static Intersects(G,V){return G.intersectsMinMax(V.minimumWorld,V.maximumWorld)}static IntersectsSphere(G,V,W,J){const d=k._TmpVector3[0];R.o.ClampToRef(W,G,V,d);return R.o.DistanceSquared(W,d)<=J*J}static IsCompletelyInFrustum(G,V){for(let W=0;W<6;++W){const J=V[W];for(let V=0;V<8;++V)if(J.dotCoordinate(G[V])<0)return!1}return!0}static IsInFrustum(G,V){for(let W=0;W<6;++W){let J=!0;const R=V[W];for(let V=0;V<8;++V)if(R.dotCoordinate(G[V])>=0){J=!1;break}if(J)return!1}return!0}}k._TmpVector3=(0,J.b)(3,R.o.Zero)},11368:(G,V,W)=>{W.d(V,{d:()=>x});var J=W(11152),R=W(11136),d=W(11373),k=W(11381);const z={min:0,max:0},X={min:0,max:0},P=(G,V,W)=>{const J=R.o.Dot(V.centerWorld,G),d=Math.abs(R.o.Dot(V.directions[0],G))*V.extendSize.x+Math.abs(R.o.Dot(V.directions[1],G))*V.extendSize.y+Math.abs(R.o.Dot(V.directions[2],G))*V.extendSize.z;W.min=J-d,W.max=J+d},A=(G,V,W)=>(P(G,V,z),P(G,W,X),!(z.min>X.max||X.min>z.max));class x{constructor(G,V,W){this._isLocked=!1,this.boundingBox=new d.b(G,V,W),this.boundingSphere=new k.e(G,V,W)}reConstruct(G,V,W){this.boundingBox.reConstruct(G,V,W),this.boundingSphere.reConstruct(G,V,W)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(G){this._isLocked=G}update(G){this._isLocked||(this.boundingBox._update(G),this.boundingSphere._update(G))}centerOn(G,V){const W=x._TmpVector3[0].J(G).FA(V),J=x._TmpVector3[1].J(G).addInPlace(V);return this.boundingBox.reConstruct(W,J,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(W,J,this.boundingBox.getWorldMatrix()),this}encapsulate(G){const V=R.o.Minimize(this.minimum,G),W=R.o.Maximize(this.maximum,G);return this.reConstruct(V,W,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(G){const V=R.h.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(V);const W=R.h.ed[0];return R.o.TransformCoordinatesToRef(G.boundingBox.minimumWorld,V,W),this.encapsulate(W),R.o.TransformCoordinatesToRef(G.boundingBox.maximumWorld,V,W),this.encapsulate(W),this}scale(G){return this.boundingBox.scale(G),this.boundingSphere.scale(G),this}isInFrustum(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===V||3===V)&&this.boundingSphere.isCenterInFrustum(G))return!0;if(!this.boundingSphere.isInFrustum(G))return!1;return!(1!==V&&3!==V)||this.boundingBox.isInFrustum(G)}get diagonalLength(){const G=this.boundingBox;return G.maximumWorld.subtractToRef(G.minimumWorld,x._TmpVector3[0]).length()}isCompletelyInFrustum(G){return this.boundingBox.isCompletelyInFrustum(G)}_checkCollision(G){return G._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(G){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(G)&&!!this.boundingBox.intersectsPoint(G))}intersects(G,V){if(!k.e.Intersects(this.boundingSphere,G.boundingSphere))return!1;if(!d.b.Intersects(this.boundingBox,G.boundingBox))return!1;if(!V)return!0;const W=this.boundingBox,J=G.boundingBox;return!!A(W.directions[0],W,J)&&(!!A(W.directions[1],W,J)&&(!!A(W.directions[2],W,J)&&(!!A(J.directions[0],W,J)&&(!!A(J.directions[1],W,J)&&(!!A(J.directions[2],W,J)&&(!!A(R.o.Cross(W.directions[0],J.directions[0]),W,J)&&(!!A(R.o.Cross(W.directions[0],J.directions[1]),W,J)&&(!!A(R.o.Cross(W.directions[0],J.directions[2]),W,J)&&(!!A(R.o.Cross(W.directions[1],J.directions[0]),W,J)&&(!!A(R.o.Cross(W.directions[1],J.directions[1]),W,J)&&(!!A(R.o.Cross(W.directions[1],J.directions[2]),W,J)&&(!!A(R.o.Cross(W.directions[2],J.directions[0]),W,J)&&(!!A(R.o.Cross(W.directions[2],J.directions[1]),W,J)&&!!A(R.o.Cross(W.directions[2],J.directions[2]),W,J))))))))))))))}}x._TmpVector3=(0,J.b)(2,R.o.Zero)},11381:(G,V,W)=>{W.d(V,{e:()=>d});var J=W(11152),R=W(11136);class d{constructor(G,V,W){this.center=R.o.Zero(),this.centerWorld=R.o.Zero(),this.minimum=R.o.Zero(),this.maximum=R.o.Zero(),this.reConstruct(G,V,W)}reConstruct(G,V,W){this.minimum.J(G),this.maximum.J(V);const J=R.o.Distance(G,V);V.addToRef(G,this.center).scaleInPlace(.5),this.radius=.5*J,this._update(W||R.c.IdentityReadOnly)}scale(G){const V=this.radius*G,W=d._TmpVector3,J=W[0].Ud(V),R=this.center.subtractToRef(J,W[1]),k=this.center.addToRef(J,W[2]);return this.reConstruct(R,k,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(G){if(G.isIdentity())this.centerWorld.J(this.center),this.radiusWorld=this.radius;else{R.o.TransformCoordinatesToRef(this.center,G,this.centerWorld);const V=d._TmpVector3[0];R.o.TransformNormalFromFloatsToRef(1,1,1,G,V),this.radiusWorld=Math.max(Math.abs(V.x),Math.abs(V.y),Math.abs(V.z))*this.radius}}isInFrustum(G){const V=this.centerWorld,W=this.radiusWorld;for(let J=0;J<6;J++)if(G[J].dotCoordinate(V)<=-W)return!1;return!0}isCenterInFrustum(G){const V=this.centerWorld;for(let W=0;W<6;W++)if(G[W].dotCoordinate(V)<0)return!1;return!0}intersectsPoint(G){const V=R.o.DistanceSquared(this.centerWorld,G);return!(this.radiusWorld*this.radiusWorld<V)}static Intersects(G,V){const W=R.o.DistanceSquared(G.centerWorld,V.centerWorld),J=G.radiusWorld+V.radiusWorld;return!(J*J<W)}static CreateFromCenterAndRadius(G,V,W){this._TmpVector3[0].J(G),this._TmpVector3[1].rd(0,0,V),this._TmpVector3[2].J(G),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].FA(this._TmpVector3[1]);const J=new d(this._TmpVector3[0],this._TmpVector3[2]);return J._worldMatrix=W||R.c.Identity(),J}}d._TmpVector3=(0,J.b)(3,R.o.Zero)},11615:(G,V,W)=>{W(11262).b.prototype.createDepthStencilTexture=function(G,V,W){if(V.isCube){const W=G.width||G;return this._createDepthStencilCubeTexture(W,V)}return this._createDepthStencilTexture(G,V,W)}},11593:(G,V,W)=>{W(11568).ThinEngine.prototype.setAlphaMode=function(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._alphaMode!==G){switch(G){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}V||(this.depthCullingState.depthMask=0===G),this._alphaMode=G}else if(!V){const V=0===G;this.depthCullingState.depthMask!==V&&(this.depthCullingState.depthMask=V)}}},11595:(G,V,W)=>{var J=W(11568);J.ThinEngine.prototype.updateDynamicIndexBuffer=function(G,V){let W;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(G),W=G.is32Bits?V instanceof Uint32Array?V:new Uint32Array(V):V instanceof Uint16Array?V:new Uint16Array(V),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,W,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},J.ThinEngine.prototype.updateDynamicVertexBuffer=function(G,V,W,J){this.bindArrayBuffer(G),void 0===W&&(W=0);const R=V.byteLength||V.length;void 0===J||J>=R&&0===W?V instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,W,new Float32Array(V)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,W,V):V instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,W,new Float32Array(V).subarray(0,J/4)):(V=V instanceof ArrayBuffer?new Uint8Array(V,0,J):new Uint8Array(V.buffer,V.byteOffset,J),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,W,V)),this._resetVertexBufferBinding()}},11604:(G,V,W)=>{var J=W(11285),R=W(11201),d=W(11568),k=W(11606),z=W(11588);class X extends k.c{setDepthStencilTexture(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(super.setDepthStencilTexture(G,V),!G)return;const W=this._engine,J=this._context,R=G._hardwareTexture;if(R&&G._autoMSAAManagement&&this._MSAAFramebuffer){const V=W._currentFramebuffer;W._bindUnboundFramebuffer(this._MSAAFramebuffer),J.framebufferRenderbuffer(J.FRAMEBUFFER,(0,z.c)(G.format)?J.DEPTH_STENCIL_ATTACHMENT:J.DEPTH_ATTACHMENT,J.RENDERBUFFER,R.getMSAARenderBuffer()),W._bindUnboundFramebuffer(V)}}constructor(G,V,W,J,R){super(G,V,W,J),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=R}_cloneRenderTargetWrapper(){let G=null;return this._colorTextureArray&&this._depthStencilTextureArray?(G=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),G.texture.isReady=!0):G=super._cloneRenderTargetWrapper(),G}_swapRenderTargetWrapper(G){super._swapRenderTargetWrapper(G),G._framebuffer=this._framebuffer,G._depthStencilBuffer=this._depthStencilBuffer,G._MSAAFramebuffer=this._MSAAFramebuffer,G._colorTextureArray=this._colorTextureArray,G._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,d=arguments.length>5?arguments[5]:void 0;if(this._depthStencilBuffer){const G=this._engine,V=G._currentFramebuffer,W=this._context;G._bindUnboundFramebuffer(this._framebuffer),W.framebufferRenderbuffer(W.FRAMEBUFFER,W.DEPTH_STENCIL_ATTACHMENT,W.RENDERBUFFER,null),W.framebufferRenderbuffer(W.FRAMEBUFFER,W.DEPTH_ATTACHMENT,W.RENDERBUFFER,null),W.framebufferRenderbuffer(W.FRAMEBUFFER,W.STENCIL_ATTACHMENT,W.RENDERBUFFER,null),G._bindUnboundFramebuffer(V),W.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(G,V,W,J,R,d)}shareDepth(G){super.shareDepth(G);const V=this._context,W=this._depthStencilBuffer,J=G._MSAAFramebuffer||G._framebuffer,R=this._engine;G._depthStencilBuffer&&G._depthStencilBuffer!==W&&V.deleteRenderbuffer(G._depthStencilBuffer),G._depthStencilBuffer=W;const d=G._generateStencilBuffer?V.DEPTH_STENCIL_ATTACHMENT:V.DEPTH_ATTACHMENT;R._bindUnboundFramebuffer(J),V.framebufferRenderbuffer(V.FRAMEBUFFER,d,V.RENDERBUFFER,W),R._bindUnboundFramebuffer(null)}_bindTextureRenderTarget(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const R=G._hardwareTexture;if(!R)return;const d=this._framebuffer,k=this._engine,z=k._currentFramebuffer;let X;if(k._bindUnboundFramebuffer(d),k.webGLVersion>1){const d=this._context;var P;if(X=d["COLOR_ATTACHMENT"+V],G.is2DArray||G.is3D)W=W??(null===(P=this.layerIndices)||void 0===P?void 0:P[V])??0,d.framebufferTextureLayer(d.FRAMEBUFFER,X,R.underlyingResource,J,W);else if(G.isCube){var A;W=W??(null===(A=this.faceIndices)||void 0===A?void 0:A[V])??0,d.framebufferTexture2D(d.FRAMEBUFFER,X,d.TEXTURE_CUBE_MAP_POSITIVE_X+W,R.underlyingResource,J)}else d.framebufferTexture2D(d.FRAMEBUFFER,X,d.TEXTURE_2D,R.underlyingResource,J)}else{const G=this._context;X=G["COLOR_ATTACHMENT"+V+"_WEBGL"];const d=void 0!==W?G.TEXTURE_CUBE_MAP_POSITIVE_X+W:G.TEXTURE_2D;G.framebufferTexture2D(G.FRAMEBUFFER,X,d,R.underlyingResource,J)}if(G._autoMSAAManagement&&this._MSAAFramebuffer){const G=this._context;k._bindUnboundFramebuffer(this._MSAAFramebuffer),G.framebufferRenderbuffer(G.FRAMEBUFFER,X,G.RENDERBUFFER,R.getMSAARenderBuffer())}k._bindUnboundFramebuffer(z)}setTexture(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super.setTexture(G,V,W),this._bindTextureRenderTarget(G,V)}setLayerAndFaceIndices(G,V){var W;if(super.setLayerAndFaceIndices(G,V),!this.textures||!this.layerIndices||!this.faceIndices)return;const J=(null===(W=this._attachments)||void 0===W?void 0:W.length)??this.textures.length;for(let R=0;R<J;R++){const G=this.textures[R];G&&(G.is2DArray||G.is3D?this._bindTextureRenderTarget(G,R,this.layerIndices[R]):G.isCube?this._bindTextureRenderTarget(G,R,this.faceIndices[R]):this._bindTextureRenderTarget(G,R))}}setLayerAndFaceIndex(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1?arguments[1]:void 0,W=arguments.length>2?arguments[2]:void 0;if(super.setLayerAndFaceIndex(G,V,W),!this.textures||!this.layerIndices||!this.faceIndices)return;const J=this.textures[G];J.is2DArray||J.is3D?this._bindTextureRenderTarget(this.textures[G],G,this.layerIndices[G]):J.isCube&&this._bindTextureRenderTarget(this.textures[G],G,this.faceIndices[G])}resolveMSAATextures(){const G=this._engine,V=G._currentFramebuffer;G._bindUnboundFramebuffer(this._MSAAFramebuffer),super.resolveMSAATextures(),G._bindUnboundFramebuffer(V)}dispose(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._disposeOnlyFramebuffers;const V=this._context;G||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(V.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(V.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(V.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(G)}}W(11615);d.ThinEngine.prototype._createHardwareRenderTargetWrapper=function(G,V,W){const J=new X(G,V,W,this,this._gl);return this._renderTargetWrapperCache.push(J),J},d.ThinEngine.prototype.createRenderTargetTexture=function(G,V){const W=this._createHardwareRenderTargetWrapper(!1,!1,G);let J,R,d=!0,k=!1,z=!1,X=1;void 0!==V&&"object"===typeof V&&(d=V.generateDepthBuffer??!0,k=!!V.generateStencilBuffer,z=!!V.noColorAttachment,J=V.colorAttachment,X=V.samples??1,R=V.label);const P=J||(z?null:this._createInternalTexture(G,V,!0,5)),A=G.width||G,x=G.height||G,q=this._currentFramebuffer,L=this._gl,t=L.createFramebuffer();if(this._bindUnboundFramebuffer(t),W._depthStencilBuffer=this._setupFramebufferDepthAttachments(k,d,A,x),!P||P.is2DArray||P.is3D||L.framebufferTexture2D(L.FRAMEBUFFER,L.COLOR_ATTACHMENT0,L.TEXTURE_2D,P._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(q),W.label=R??"RenderTargetWrapper",W._framebuffer=t,W._generateDepthBuffer=d,W._generateStencilBuffer=k,W.setTextures(P),J){if(W._samples=J.samples,J.samples>1){const G=J._hardwareTexture.getMSAARenderBuffer(0);W._MSAAFramebuffer=L.createFramebuffer(),this._bindUnboundFramebuffer(W._MSAAFramebuffer),L.framebufferRenderbuffer(L.FRAMEBUFFER,L.COLOR_ATTACHMENT0,L.RENDERBUFFER,G),this._bindUnboundFramebuffer(null)}}else this.updateRenderTargetTextureSampleCount(W,X);return W},d.ThinEngine.prototype._createDepthStencilTexture=function(G,V,W){const d=this._gl,k=G.layers||0,X=G.depth||0;let P=d.TEXTURE_2D;0!==k?P=d.TEXTURE_2D_ARRAY:0!==X&&(P=d.TEXTURE_3D);const A=new J.d(this,12);if(A.label=V.label,!this._caps.depthTextureExtension)return R.c.Error("Depth texture is not supported by your browser or hardware."),A;const x={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...V};if(this._bindTextureDirectly(P,A,!0),this._setupDepthStencilTexture(A,G,0!==x.comparisonFunction&&x.bilinearFiltering,x.comparisonFunction,x.samples),void 0!==x.depthTextureFormat){if(15!==x.depthTextureFormat&&16!==x.depthTextureFormat&&17!==x.depthTextureFormat&&13!==x.depthTextureFormat&&14!==x.depthTextureFormat&&18!==x.depthTextureFormat)return R.c.Error(`Depth texture ${x.depthTextureFormat} format is not supported.`),A;A.format=x.depthTextureFormat}else A.format=x.generateStencil?13:16;const q=(0,z.c)(A.format),L=this._getWebGLTextureTypeFromDepthTextureFormat(A.format),t=q?d.DEPTH_STENCIL:d.DEPTH_COMPONENT,Y=this._getInternalFormatFromDepthTextureFormat(A.format,!0,q);return A.is2DArray?d.texImage3D(P,0,Y,A.width,A.height,k,0,t,L,null):A.is3D?d.texImage3D(P,0,Y,A.width,A.height,X,0,t,L,null):d.texImage2D(P,0,Y,A.width,A.height,0,t,L,null),this._bindTextureDirectly(P,null),this._internalTexturesCache.push(A),W._depthStencilBuffer&&(d.deleteRenderbuffer(W._depthStencilBuffer),W._depthStencilBuffer=null),this._bindUnboundFramebuffer(W._MSAAFramebuffer??W._framebuffer),W._generateStencilBuffer=q,W._depthStencilTextureWithStencil=q,W._depthStencilBuffer=this._setupFramebufferDepthAttachments(W._generateStencilBuffer,W._generateDepthBuffer,W.width,W.height,W.samples,A.format),this._bindUnboundFramebuffer(null),A},d.ThinEngine.prototype.updateRenderTargetTextureSampleCount=function(G,V){var W;if(this.webGLVersion<2||!G)return 1;if(G.samples===V)return V;const J=this._gl;V=Math.min(V,this.getCaps().maxMSAASamples),G._depthStencilBuffer&&(J.deleteRenderbuffer(G._depthStencilBuffer),G._depthStencilBuffer=null),G._MSAAFramebuffer&&(J.deleteFramebuffer(G._MSAAFramebuffer),G._MSAAFramebuffer=null);const R=null===(W=G.texture)||void 0===W?void 0:W._hardwareTexture;if(null===R||void 0===R||R.releaseMSAARenderBuffers(),G.texture&&V>1&&"function"===typeof J.renderbufferStorageMultisample){const W=J.createFramebuffer();if(!W)throw new Error("Unable to create multi sampled framebuffer");G._MSAAFramebuffer=W,this._bindUnboundFramebuffer(G._MSAAFramebuffer);const d=this._createRenderBuffer(G.texture.width,G.texture.height,V,-1,this._getRGBABufferInternalSizedFormat(G.texture.type,G.texture.format,G.texture._useSRGBBuffer),J.COLOR_ATTACHMENT0,!1);if(!d)throw new Error("Unable to create multi sampled framebuffer");null===R||void 0===R||R.addMSAARenderBuffer(d)}this._bindUnboundFramebuffer(G._MSAAFramebuffer??G._framebuffer),G.texture&&(G.texture.samples=V),G._samples=V;const d=G._depthStencilTexture?G._depthStencilTexture.format:void 0;return G._depthStencilBuffer=this._setupFramebufferDepthAttachments(G._generateStencilBuffer,G._generateDepthBuffer,G.width,G.height,V,d),this._bindUnboundFramebuffer(null),V},d.ThinEngine.prototype._setupDepthStencilTexture=function(G,V,W,J){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const d=V.width??V,k=V.height??V,z=V.layers||0,X=V.depth||0;G.baseWidth=d,G.baseHeight=k,G.width=d,G.height=k,G.is2DArray=z>0,G.depth=z||X,G.isReady=!0,G.samples=R,G.generateMipMaps=!1,G.samplingMode=W?2:1,G.type=0,G._comparisonFunction=J;const P=this._gl,A=this._getTextureTarget(G),x=this._getSamplingParameters(G.samplingMode,!1);P.texParameteri(A,P.TEXTURE_MAG_FILTER,x.mag),P.texParameteri(A,P.TEXTURE_MIN_FILTER,x.min),P.texParameteri(A,P.TEXTURE_WRAP_S,P.CLAMP_TO_EDGE),P.texParameteri(A,P.TEXTURE_WRAP_T,P.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===J?(P.texParameteri(A,P.TEXTURE_COMPARE_FUNC,515),P.texParameteri(A,P.TEXTURE_COMPARE_MODE,P.NONE)):(P.texParameteri(A,P.TEXTURE_COMPARE_FUNC,J),P.texParameteri(A,P.TEXTURE_COMPARE_MODE,P.COMPARE_REF_TO_TEXTURE)))}},11245:(G,V,W)=>{W.d(V,{e:()=>H,g:()=>y,n:()=>u,j:()=>v,q:()=>C});class J{constructor(){this.children=[]}isValid(G){return!0}process(G,V,W){let J="";if(this.line){let W=this.line;const A=V.processor;if(A){var R,d,k,z,X,P;A.lineProcessor&&(W=A.lineProcessor(W,V.isFragment,V.processingContext));const J=(null===(R=V.processor)||void 0===R?void 0:R.attributeKeywordName)??"attribute",x=V.isFragment&&null!==(d=V.processor)&&void 0!==d&&d.varyingFragmentKeywordName?null===(k=V.processor)||void 0===k?void 0:k.varyingFragmentKeywordName:!V.isFragment&&null!==(z=V.processor)&&void 0!==z&&z.varyingVertexKeywordName?null===(X=V.processor)||void 0===X?void 0:X.varyingVertexKeywordName:"varying";if(!V.isFragment&&A.attributeProcessor&&this.line.startsWith(J))W=A.attributeProcessor(this.line,G,V.processingContext);else if(A.varyingProcessor&&(null!==(P=A.varyingCheck)&&void 0!==P&&P.call(A,this.line,V.isFragment)||!A.varyingCheck&&this.line.startsWith(x)))W=A.varyingProcessor(this.line,V.isFragment,G,V.processingContext);else if(A.uniformProcessor&&A.uniformRegexp&&A.uniformRegexp.test(this.line))V.lookForClosingBracketForUniformBuffer||(W=A.uniformProcessor(this.line,V.isFragment,G,V.processingContext));else if(A.uniformBufferProcessor&&A.uniformBufferRegexp&&A.uniformBufferRegexp.test(this.line))V.lookForClosingBracketForUniformBuffer||(W=A.uniformBufferProcessor(this.line,V.isFragment,V.processingContext),V.lookForClosingBracketForUniformBuffer=!0);else if(A.textureProcessor&&A.textureRegexp&&A.textureRegexp.test(this.line))W=A.textureProcessor(this.line,V.isFragment,G,V.processingContext);else if((A.uniformProcessor||A.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!V.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?A.uniformProcessor&&(W=A.uniformProcessor(this.line,V.isFragment,G,V.processingContext)):A.uniformBufferProcessor&&(W=A.uniformBufferProcessor(this.line,V.isFragment,V.processingContext),V.lookForClosingBracketForUniformBuffer=!0)}V.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(V.lookForClosingBracketForUniformBuffer=!1,A.endOfUniformBufferProcessor&&(W=A.endOfUniformBufferProcessor(this.line,V.isFragment,V.processingContext)))}J+=W+"\n"}for(const A of this.children)J+=A.process(G,V,W);return this.additionalDefineKey&&(G[this.additionalDefineKey]=this.additionalDefineValue||"true",W[this.additionalDefineKey]=G[this.additionalDefineKey]),J}}class R{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(G){this._lines.length=0;for(const V of G){if(!V||"\r"===V)continue;if("#"===V[0]){this._lines.push(V);continue}const G=V.trim();if(!G)continue;if(G.startsWith("//")){this._lines.push(V);continue}const W=G.indexOf(";");if(-1===W)this._lines.push(G);else if(W===G.length-1)G.length>1&&this._lines.push(G);else{const G=V.split(";");for(let V=0;V<G.length;V++){let W=G[V];W&&(W=W.trim(),W&&this._lines.push(W+(V!==G.length-1?";":"")))}}}}}class d extends J{process(G,V,W){for(let J=0;J<this.children.length;J++){const R=this.children[J];if(R.isValid(G))return R.process(G,V,W)}return""}}class k extends J{isValid(G){return this.testExpression.isTrue(G)}}class z{isTrue(G){return!0}static postfixToInfix(G){const V=[];for(const W of G)if(void 0===z._OperatorPriority[W])V.push(W);else{const G=V[V.length-1],J=V[V.length-2];V.length-=2,V.push(`(${J}${W}${G})`)}return V[V.length-1]}static infixToPostfix(G){const V=z._InfixToPostfixCache.get(G);if(V)return V.accessTime=Date.now(),V.result;if(!G.includes("&&")&&!G.includes("||")&&!G.includes(")")&&!G.includes("("))return[G];const W=[];let J=-1;const R=()=>{A=A.trim(),""!==A&&(W.push(A),A="")},d=G=>{J<z._Stack.length-1&&(z._Stack[++J]=G)},k=()=>z._Stack[J],X=()=>-1===J?"!!INVALID EXPRESSION!!":z._Stack[J--];let P=0,A="";for(;P<G.length;){const V=G.charAt(P),x=P<G.length-1?G.substring(P,2+P):"";if("("===V)A="",d(V);else if(")"===V){for(R();-1!==J&&"("!==k();)W.push(X());X()}else if(z._OperatorPriority[x]>1){for(R();-1!==J&&z._OperatorPriority[k()]>=z._OperatorPriority[x];)W.push(X());d(x),P++}else A+=V;P++}for(R();-1!==J;)"("===k()?X():W.push(X());return z._InfixToPostfixCache.size>=z.InfixToPostfixCacheLimitSize&&z.ClearCache(),z._InfixToPostfixCache.set(G,{result:W,accessTime:Date.now()}),W}static ClearCache(){const G=Array.from(z._InfixToPostfixCache.entries()).sort(((G,V)=>G[1].accessTime-V[1].accessTime));for(let V=0;V<z.InfixToPostfixCacheCleanupSize;V++)z._InfixToPostfixCache.delete(G[V][0])}}z.InfixToPostfixCacheLimitSize=5e4,z.InfixToPostfixCacheCleanupSize=25e3,z._InfixToPostfixCache=new Map,z._OperatorPriority={")":0,"(":1,"||":2,"&&":3},z._Stack=["","","","","","","","","","","","","","","","","","","",""];class X extends z{constructor(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=G,this.not=V}isTrue(G){let V=void 0!==G[this.define];return this.not&&(V=!V),V}}class P extends z{isTrue(G){return this.leftOperand.isTrue(G)||this.rightOperand.isTrue(G)}}class A extends z{isTrue(G){return this.leftOperand.isTrue(G)&&this.rightOperand.isTrue(G)}}class x extends z{constructor(G,V,W){super(),this.define=G,this.operand=V,this.testValue=W}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(G){let V=!1;const W=parseInt(void 0!=G[this.define]?G[this.define]:this.define),J=parseInt(void 0!=G[this.testValue]?G[this.testValue]:this.testValue);if(isNaN(W)||isNaN(J))return!1;switch(this.operand){case">":V=W>J;break;case"<":V=W<J;break;case"<=":V=W<=J;break;case">=":V=W>=J;break;case"==":V=W===J;break;case"!=":V=W!==J}return V}}var q=W(11218),L=W(11250);const t=/defined\s*?\((.+?)\)/g,Y=/defined\s*?\[(.+?)\]/g,g=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,B=/__decl__/,S=/light\{X\}.(\w*)/g,p=/\{X\}/g,b=[],r=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function y(G){G.processor&&G.processor.initializeShaders&&G.processor.initializeShaders(G.processingContext)}function u(G,V,W,J){var R;null!==(R=V.processor)&&void 0!==R&&R.preProcessShaderCode&&(G=V.processor.preProcessShaderCode(G,V.isFragment)),v(G,V,(G=>{V.processCodeAfterIncludes&&(G=V.processCodeAfterIncludes(V.isFragment?"fragment":"vertex",G,V.defines));const R=function(G,V,W){let J=function(G,V){var W;if(null!==(W=V.processor)&&void 0!==W&&W.noPrecision)return G;const J=V.shouldUseHighPrecisionShader;-1===G.indexOf("precision highp float")?G=J?"precision highp float;\n"+G:"precision mediump float;\n"+G:J||(G=G.replace("precision highp float","precision mediump float"));return G}(G,V);if(!V.processor)return J;if(0===V.processor.shaderLanguage&&-1!==J.indexOf("#version 3")&&(J=J.replace("#version 300 es",""),!V.processor.parseGLES3))return J;const R=V.defines,d=f(V,W);V.processor.preProcessor&&(J=V.processor.preProcessor(J,R,d,V.isFragment,V.processingContext));const k={};J=F(J,d,V,k),V.processor.postProcessor&&(J=V.processor.postProcessor(J,R,V.isFragment,V.processingContext,W?{drawBuffersExtensionDisabled:!W.getCaps().drawBuffersExtension}:{},d,k));null!==W&&void 0!==W&&W._features.needShaderCodeInlining&&(J=W.inlineShaderCode(J));return J}(G,V,J);W(R,G)}))}function H(G,V,W){return W.processor&&W.processor.finalizeShaders?W.processor.finalizeShaders(G,V,W.processingContext):{vertexCode:G,fragmentCode:V}}function n(G){const V=/defined\((.+)\)/.exec(G);if(V&&V.length)return new X(V[1].trim(),"!"===G[0]);const W=["==","!=",">=","<=","<",">"];let J="",R=0;for(J of W)if(R=G.indexOf(J),R>-1)break;if(-1===R)return new X(G);const d=G.substring(0,R).trim(),k=G.substring(R+J.length).trim();return new x(d,J,k)}function D(G,V){const W=new k,J=G.substring(0,V);let R=G.substring(V);return R=R.substring(0,(R.indexOf("//")+1||R.length+1)-1).trim(),W.testExpression="#ifdef"===J?new X(R):"#ifndef"===J?new X(R,!0):function(G){G=G.replace(t,"defined[$1]");const V=z.infixToPostfix(G),W=[];for(const R of V)if("||"!==R&&"&&"!==R)W.push(R);else if(W.length>=2){let G=W[W.length-1],V=W[W.length-2];W.length-=2;const J="&&"==R?new A:new P;"string"===typeof G&&(G=G.replace(Y,"defined($1)")),"string"===typeof V&&(V=V.replace(Y,"defined($1)")),J.leftOperand="string"===typeof V?n(V):V,J.rightOperand="string"===typeof G?n(G):G,W.push(J)}let J=W[W.length-1];return"string"===typeof J&&(J=J.replace(Y,"defined($1)")),"string"===typeof J?n(J):J}(R),W}function i(G,V,W,R){let d=G.currentLine;for(;e(G,W,R);){d=G.currentLine;const k=d.substring(0,5).toLowerCase();if("#else"===k){const W=new J;return V.children.push(W),void e(G,W,R)}if("#elif"===k){const G=D(d,5);V.children.push(G),W=G}}}function e(G,V,W){for(;G.canRead;){G.lineIndex++;const R=G.currentLine;if(R.indexOf("#")>=0){const J=r.exec(R);if(J&&J.length){switch(J[0]){case"#ifdef":{const J=new d;V.children.push(J);const k=D(R,6);J.children.push(k),i(G,J,k,W);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const J=new d;V.children.push(J);const k=D(R,7);J.children.push(k),i(G,J,k,W);break}case"#if":{const J=new d,k=D(R,3);V.children.push(J),J.children.push(k),i(G,J,k,W);break}}continue}}const k=new J;if(k.line=R,V.children.push(k),"#"===R[0]&&"d"===R[1]){const G=R.replace(";","").split(" ");k.additionalDefineKey=G[1],3===G.length&&(k.additionalDefineValue=G[2])}}return!1}function F(G,V,W,d){const k=new J,z=new R;return z.lineIndex=-1,z.lines=G.split("\n"),e(z,k,d),k.process(V,W,d)}function f(G,V){var W;const J=G.defines,R={};for(const d of J){const G=d.replace("#define","").replace(";","").trim().split(" ");R[G[0]]=G.length>1?G[1]:""}return 0===(null===(W=G.processor)||void 0===W?void 0:W.shaderLanguage)&&(R.GL_ES="true"),R.__VERSION__=G.version,R[G.platformName]="true",(0,L.i)(R,null===V||void 0===V?void 0:V.isNDCHalfZRange,null===V||void 0===V?void 0:V.useReverseDepthBuffer,null===V||void 0===V?void 0:V.useExactSrgbConversions),R}function v(G,V,W){let J;for(b.length=0;null!==(J=g.exec(G));)b.push(J);let R=String(G),d=[G],k=!1;for(const z of b){let G=z[1];if(-1!==G.indexOf("__decl__")&&(G=G.replace(B,""),V.supportsUniformBuffers&&(G=G.replace("Vertex","Ubo").replace("Fragment","Ubo")),G+="Declaration"),!V.includesShadersStore[G]){const J=V.shadersRepository+"ShadersInclude/"+G+".fx";return void C.loadFile(J,(J=>{V.includesShadersStore[G]=J,v(d.join(""),V,W)}))}{let W=V.includesShadersStore[G];if(z[2]){const G=z[3].split(",");for(let V=0;V<G.length;V+=2){const J=new RegExp(G[V],"g"),R=G[V+1];W=W.replace(J,R)}}if(z[4]){const G=z[5];if(-1!==G.indexOf("..")){const J=G.split(".."),R=parseInt(J[0]);let d=parseInt(J[1]),k=W.slice(0);W="",isNaN(d)&&(d=V.indexParameters[J[1]]);for(let G=R;G<d;G++)V.supportsUniformBuffers||(k=k.replace(S,((G,V)=>V+"{X}"))),W+=k.replace(p,G.toString())+"\n"}else V.supportsUniformBuffers||(W=W.replace(S,((G,V)=>V+"{X}"))),W=W.replace(p,G)}const J=[];for(const G of d){const V=G.split(z[0]);for(let G=0;G<V.length-1;G++)J.push(V[G]),J.push(W);J.push(V[V.length-1])}d=J,k=k||W.indexOf("#include<")>=0||W.indexOf("#include <")>=0}}b.length=0,R=d.join(""),k?v(R.toString(),V,W):W(R)}const C={loadFile:(G,V,W,J,R,d)=>{throw(0,q.e)("FileTools")}}},11580:(G,V,W)=>{W.d(V,{e:()=>J});class J{get underlyingResource(){return this._webGLTexture}constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,V=arguments.length>1?arguments[1]:void 0;if(this._MSAARenderBuffers=null,this._context=V,!G&&(G=V.createTexture(),!G))throw new Error("Unable to create webGL texture");this.set(G)}setUsage(){}set(G){this._webGLTexture=G}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(G){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(G)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const G of this._MSAARenderBuffers)this._context.deleteRenderbuffer(G);this._MSAARenderBuffers=null}}getMSAARenderBuffer(){var G;let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(G=this._MSAARenderBuffers)||void 0===G?void 0:G[V])??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},11250:(G,V,W)=>{W.d(V,{c:()=>R,f:()=>d,i:()=>z,k:()=>k,n:()=>X});var J=W(11218);W(11196);const R={};function d(G,V){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(V?V+"\n":"")+G}function k(G,V,W,d,k,z,X){const P=X||R.loadFile;if(P){return P(G,V,W,d,k,z)}throw(0,J.e)("FileTools")}function z(G,V,W,J){if(G)return V?G.IS_NDC_HALF_ZRANGE="":delete G.IS_NDC_HALF_ZRANGE,W?G.USE_REVERSE_DEPTHBUFFER="":delete G.USE_REVERSE_DEPTHBUFFER,void(J?G.USE_EXACT_SRGB_CONVERSIONS="":delete G.USE_EXACT_SRGB_CONVERSIONS);{let G="";return V&&(G+="#define IS_NDC_HALF_ZRANGE"),W&&(G&&(G+="\n"),G+="#define USE_REVERSE_DEPTHBUFFER"),J&&(G&&(G+="\n"),G+="#define USE_EXACT_SRGB_CONVERSIONS"),G}}function X(G,V){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3?arguments[3]:void 0;switch(G){case 3:{const G=(ArrayBuffer,new Int8Array(V));return J&&G.set(new Int8Array(J)),G}case 0:{const G=(ArrayBuffer,new Uint8Array(V));return J&&G.set(new Uint8Array(J)),G}case 4:{const G=V instanceof ArrayBuffer?new Int16Array(V):new Int16Array(W?V/2:V);return J&&G.set(new Int16Array(J)),G}case 5:case 8:case 9:case 10:case 2:{const G=V instanceof ArrayBuffer?new Uint16Array(V):new Uint16Array(W?V/2:V);return J&&G.set(new Uint16Array(J)),G}case 6:{const G=V instanceof ArrayBuffer?new Int32Array(V):new Int32Array(W?V/4:V);return J&&G.set(new Int32Array(J)),G}case 7:case 11:case 12:case 13:case 14:case 15:{const G=V instanceof ArrayBuffer?new Uint32Array(V):new Uint32Array(W?V/4:V);return J&&G.set(new Uint32Array(J)),G}case 1:{const G=V instanceof ArrayBuffer?new Float32Array(V):new Float32Array(W?V/4:V);return J&&G.set(new Float32Array(J)),G}}const R=(ArrayBuffer,new Uint8Array(V));return J&&R.set(new Uint8Array(J)),R}},11262:(G,V,W)=>{W.d(V,{b:()=>p});var J=W(11169),R=W(11201),d=W(11268),k=W(11165),z=W(11211);class X{constructor(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,G&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(G){this._zOffset!==G&&(this._zOffset=G,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(G){this._zOffsetUnits!==G&&(this._zOffsetUnits=G,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(G){this._cullFace!==G&&(this._cullFace=G,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(G){this._cull!==G&&(this._cull=G,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(G){this._depthFunc!==G&&(this._depthFunc=G,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(G){this._depthMask!==G&&(this._depthMask=G,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(G){this._depthTest!==G&&(this._depthTest=G,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(G){this._frontFace!==G&&(this._frontFace=G,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(G){this.isDirty&&(this._isCullDirty&&(this.cull?G.enable(G.CULL_FACE):G.disable(G.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(G.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(G.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?G.enable(G.DEPTH_TEST):G.disable(G.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(G.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(G.enable(G.POLYGON_OFFSET_FILL),G.polygonOffset(this.zOffset,this.zOffsetUnits)):G.disable(G.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(G.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}class P{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(G){this._func!==G&&(this._func=G,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(G){this._funcRef!==G&&(this._funcRef=G,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(G){this._funcMask!==G&&(this._funcMask=G,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(G){this._opStencilFail!==G&&(this._opStencilFail=G,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(G){this._opDepthFail!==G&&(this._opDepthFail=G,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(G){this._opStencilDepthPass!==G&&(this._opStencilDepthPass=G,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(G){this._mask!==G&&(this._mask=G,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(G){this._enabled!==G&&(this._enabled=G,this._isStencilTestDirty=!0)}constructor(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,G&&this.reset()}reset(){var G;this.stencilMaterial=void 0,null===(G=this.stencilGlobal)||void 0===G||G.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(G){var V;if(!G)return;const W=!this.useStencilGlobalOnly&&!(null===(V=this.stencilMaterial)||void 0===V||!V.enabled);this.enabled=W?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=W?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=W?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=W?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=W?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=W?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=W?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=W?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?G.enable(G.STENCIL_TEST):G.disable(G.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(G.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(G.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(G.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}class A{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=A.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=A.KEEP,this.opDepthFail=A.KEEP,this.opStencilDepthPass=A.REPLACE}get stencilFunc(){return this.func}set stencilFunc(G){this.func=G}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(G){this.funcRef=G}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(G){this.funcMask=G}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(G){this.opStencilFail=G}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(G){this.opDepthFail=G}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(G){this.opStencilDepthPass=G}get stencilMask(){return this.mask}set stencilMask(G){this.mask=G}get stencilTest(){return this.enabled}set stencilTest(G){this.enabled=G}}A.ALWAYS=519,A.KEEP=7680,A.REPLACE=7681;class x{constructor(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._alphaBlend}set alphaBlend(G){this._alphaBlend!==G&&(this._alphaBlend=G,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(G,V,W,J){this._blendConstants[0]===G&&this._blendConstants[1]===V&&this._blendConstants[2]===W&&this._blendConstants[3]===J||(this._blendConstants[0]=G,this._blendConstants[1]=V,this._blendConstants[2]=W,this._blendConstants[3]=J,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(G,V,W,J){this._blendFunctionParameters[0]===G&&this._blendFunctionParameters[1]===V&&this._blendFunctionParameters[2]===W&&this._blendFunctionParameters[3]===J||(this._blendFunctionParameters[0]=G,this._blendFunctionParameters[1]=V,this._blendFunctionParameters[2]=W,this._blendFunctionParameters[3]=J,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(G,V){this._blendEquationParameters[0]===G&&this._blendEquationParameters[1]===V||(this._blendEquationParameters[0]=G,this._blendEquationParameters[1]=V,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(G){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?G.enable(G.BLEND):G.disable(G.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(G.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(G.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(G.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}var q=W(11218),L=W(11285),t=W(11196),Y=W(11176),g=W(11250),B=W(11298);function S(G,V){if((0,t.m)()){const{requestAnimationFrame:W}=V||window;if("function"===typeof W)return W(G)}else if("function"===typeof requestAnimationFrame)return requestAnimationFrame(G);return setTimeout(G,16)}class p{get frameId(){return this._frameId}get isWebGPU(){return this._isWebGPU}_getShaderProcessor(G){return this._shaderProcessor}get shaderPlatformName(){return this._shaderPlatformName}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}set useReverseDepthBuffer(G){G!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=G,this._depthCullingState.depthFunc=G?518:515)}setColorWrite(G){G!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=G)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}_getGlobalDefines(G){if(G)return this.isNDCHalfZRange?G.IS_NDC_HALF_ZRANGE="":delete G.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?G.USE_REVERSE_DEPTHBUFFER="":delete G.USE_REVERSE_DEPTHBUFFER,void(this.useExactSrgbConversions?G.USE_EXACT_SRGB_CONVERSIONS="":delete G.USE_EXACT_SRGB_CONVERSIONS);{let G="";return this.isNDCHalfZRange&&(G+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(G&&(G+="\n"),G+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(G&&(G+="\n"),G+="#define USE_EXACT_SRGB_CONVERSIONS"),G}}_rebuildInternalTextures(){const G=this._internalTexturesCache.slice();for(const V of G)V._rebuild()}_rebuildRenderTargetWrappers(){const G=this._renderTargetWrapperCache.slice();for(const V of G)V._rebuild()}_rebuildEffects(){for(const G in this._compiledEffects){const V=this._compiledEffects[G];V._pipelineContext=null,V._prepareEffect()}d.b.ResetCache()}_rebuildGraphicsResources(){var G;this.wipeCaches(!0),this._rebuildEffects(),null===(G=this._rebuildComputeEffects)||void 0===G||G.call(this),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_flagContextRestored(){R.c.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}_restoreEngineAfterContextLost(G){setTimeout((()=>{this._clearEmptyResources();const V=this._depthCullingState.depthTest,W=this._depthCullingState.depthFunc,J=this._depthCullingState.depthMask,R=this._stencilState.stencilTest;G(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=V,this._depthCullingState.depthFunc=W,this._depthCullingState.depthMask=J,this._stencilState.stencilTest=R,this._flagContextRestored()}),0)}get P(){return this._isDisposed}get snapshotRendering(){return!1}set snapshotRendering(G){}get snapshotRenderingMode(){return 0}set snapshotRenderingMode(G){}getClassName(){return"AbstractEngine"}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){const G=new Uint8Array(4),V=[G,G,G,G,G,G];this._emptyCubeTexture=this.createRawCubeTexture(V,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get activeRenderLoops(){return this._activeRenderLoops}stopRenderLoop(G){if(!G)return this._activeRenderLoops.length=0,void this._cancelFrame();const V=this._activeRenderLoops.indexOf(G);V>=0&&(this._activeRenderLoops.splice(V,1),0==this._activeRenderLoops.length&&this._cancelFrame())}_cancelFrame(){if(0!==this._frameHandler){const G=this._frameHandler;if(this._frameHandler=0,(0,t.m)()){const{cancelAnimationFrame:V}=this.getHostWindow()||window;if("function"===typeof V)return V(G)}else if("function"===typeof cancelAnimationFrame)return cancelAnimationFrame(G);return clearTimeout(G)}}bx(){this.onBeginFrameObservable.notifyObservers(this)}yx(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}get maxFPS(){return this._maxFPS}set maxFPS(G){this._maxFPS=G,void 0!==G&&(this._minFrameTime=G<=0?Number.MAX_VALUE:1e3/G)}_isOverFrameTime(G){if(!G||void 0===this._maxFPS)return!1;const V=G-this._lastFrameTime;return this._lastFrameTime=G,this._renderAccumulator+=V,this._renderAccumulator<this._minFrameTime||(this._renderAccumulator-=this._minFrameTime,this._renderAccumulator>this._minFrameTime&&(this._renderAccumulator=this._minFrameTime),!1)}_processFrame(G){if(this._frameHandler=0,!this._contextWasLost&&!this._isOverFrameTime(G)){let G=!0;(this.P||!this.renderEvenInBackground&&this._windowIsBackground)&&(G=!1),G&&(this.bx(),this.skipFrameRender||this._renderViews()||this._renderFrame(),this.yx())}}_renderLoop(G){this._processFrame(G),this._activeRenderLoops.length>0&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_renderFrame(){for(let G=0;G<this._activeRenderLoops.length;G++){(0,this._activeRenderLoops[G])()}}_renderViews(){return!1}_queueNewFrame(G,V){return S(G,V)}runRenderLoop(G){-1===this._activeRenderLoops.indexOf(G)&&(this._activeRenderLoops.push(G),1===this._activeRenderLoops.length&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(G){this._depthCullingState.depthTest=G}setZOffset(G){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-G:G}getZOffset(){const G=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-G:G}setZOffsetUnits(G){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-G:G}getZOffsetUnits(){const G=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-G:G}getHostWindow(){return(0,t.m)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(G){this._compatibilityMode=!0}_rebuildTextures(){for(const G of this.scenes)G._rebuildTextures();for(const G of this._virtualScenes)G._rebuildTextures()}_releaseRenderTargetWrapper(G){const V=this._renderTargetWrapperCache.indexOf(G);-1!==V&&this._renderTargetWrapperCache.splice(V,1)}get currentViewport(){return this._cachedViewport}setViewport(G,V,W){const J=V||this.getRenderWidth(),R=W||this.getRenderHeight(),d=G.x||0,k=G.y||0;this._cachedViewport=G,this._viewport(d*J,k*R,J*G.width,R*G.height)}createCanvasImage(){return document.createElement("img")}createCanvasPath2D(G){return new Path2D(G)}get description(){let G=this.name+this.version;return this._caps.parallelShaderCompile&&(G+=" - Parallel shader compilation"),G}_createTextureBase(G,V,W,d){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,P=arguments.length>7?arguments[7]:void 0,A=arguments.length>8?arguments[8]:void 0,x=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,q=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,t=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,Y=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,g=arguments.length>13?arguments[13]:void 0,S=arguments.length>14?arguments[14]:void 0,b=arguments.length>15?arguments[15]:void 0;const r="data:"===(G=G||"").substring(0,5),y="blob:"===G.substring(0,5),u=r&&-1!==G.indexOf(";base64,"),H=q||new L.d(this,1);H!==q&&(H.label=G.substring(0,60));const n=G;!this._transformTextureUrl||u||q||x||(G=this._transformTextureUrl(G)),n!==G&&(H._originalUrl=n);const D=G.lastIndexOf(".");let i=Y||(D>-1?G.substring(D).toLowerCase():"");i.indexOf("?")>-1&&(i=i.split("?")[0]);const e=(0,B.b)(i,g);d&&d.addPendingData(H),H.url=G,H.generateMipMaps=!V,H.samplingMode=k,H.invertY=W,H._useSRGBBuffer=this._getUseSRGBBuffer(!!b,V),this._doNotHandleContextLost||(H._buffer=x);let F=null;z&&!q&&(F=H.onLoadedObservable.add(z)),q||this._internalTexturesCache.push(H);const f=(W,q)=>{d&&d.removePendingData(H),G===n?(F&&H.onLoadedObservable.remove(F),J.c.UseFallbackTexture&&G!==J.c.FallbackTexture&&this._createTextureBase(J.c.FallbackTexture,V,H.invertY,d,k,null,X,P,A,x,H),W=(W||"Unknown error")+(J.c.UseFallbackTexture?" - Fallback texture was used":""),H.onErrorObservable.notifyObservers({message:W,exception:q}),X&&X(W,q)):(R.c.Warn(`Failed to load ${G}, falling back to ${n}`),this._createTextureBase(n,V,H.invertY,d,k,z,X,P,A,x,H,t,Y,g,S,b))};if(e){const V=async G=>{(await e).loadData(G,H,((G,V,W,J,R,z)=>{z?f("TextureLoader failed to load data"):P(H,i,d,{width:G,height:V},H.invertY,!W,J,(()=>(R(),!1)),k)}),S)};x?x instanceof ArrayBuffer?V(new Uint8Array(x)):ArrayBuffer.isView(x)?V(x):X&&X("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(G,(G=>{V(new Uint8Array(G))}),void 0,d?d.offlineProvider:void 0,!0,((G,V)=>{f("Unable to load "+(G&&G.responseURL,V))}))}else{const W=G=>{y&&!this._doNotHandleContextLost&&(H._buffer=G),P(H,i,d,G,H.invertY,V,!1,A,k)};!r||u?x&&("string"===typeof x.decoding||x.close)?W(x):p._FileToolsLoadImage(G||"",W,f,d?d.offlineProvider:null,g,H.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0,this):"string"===typeof x||x instanceof ArrayBuffer||ArrayBuffer.isView(x)||x instanceof Blob?p._FileToolsLoadImage(x,W,f,d?d.offlineProvider:null,g,H.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0,this):x&&W(x)}return H}_rebuildBuffers(){for(const G of this._uniformBuffers)G._rebuildAfterContextLost()}get _shouldUseHighPrecisionShader(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,t.e)()?document:null}getLoadedTexturesCache(){return this._internalTexturesCache}clearInternalTexturesCache(){this._internalTexturesCache.length=0}getCaps(){return this._caps}resetTextureCache(){for(const G in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,G)&&(this._boundTexturesCache[G]=null);this._currentTextureChannel=-1}get name(){return this._name}set name(G){this._name=G}static get NpmPackage(){return"babylonjs@8.13.0"}static get Version(){return"8.13.0"}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}setHardwareScalingLevel(G){this._hardwareScalingLevel=G,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(G){this._doNotHandleContextLost=G}get isStencilEnable(){return this._isStencilEnable}getCreationOptions(){return this._creationOptions}constructor(G,V,W){var R,d;this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new X,this._stencilStateComposer=new P,this._stencilState=new A,this._alphaState=new x,this._alphaMode=1,this._alphaEquation=0,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new Y.b,this.onCanvasFocusObservable=new Y.b,this.onNewSceneAddedObservable=new Y.b,this.onResizeObservable=new Y.b,this.onCanvasPointerOutObservable=new Y.b,this.onEffectErrorObservable=new Y.b,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new Y.b,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=G=>this._renderLoop(G),this._lastFrameTime=0,this._renderAccumulator=0,this.skipFrameRender=!1,this.onBeforeShaderCompilationObservable=new Y.b,this.onAfterShaderCompilationObservable=new Y.b,this.onBeginFrameObservable=new Y.b,this.onEndFrameObservable=new Y.b,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new Y.b,this.onContextRestoredObservable=new Y.b,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.Md=new Y.b,this.onReleaseEffectsObservable=new Y.b,J.c.Instances.push(this),this.startTime=z.e.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,k.e.SetMatrixPrecision(!!V.useHighPrecisionMatrix),(0,t.i)()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=W??!1,V.antialias=G??V.antialias,V.deterministicLockstep=V.deterministicLockstep??!1,V.lockstepMaxSteps=V.lockstepMaxSteps??4,V.timeStep=V.timeStep??1/60,V.stencil=V.stencil??!0,this._audioContext=(null===(R=V.audioEngineOptions)||void 0===R?void 0:R.audioContext)??null,this._audioDestination=(null===(d=V.audioEngineOptions)||void 0===d?void 0:d.audioDestination)??null,this.premultipliedAlpha=V.premultipliedAlpha??!0,this._doNotHandleContextLost=!!V.doNotHandleContextLost,this._isStencilEnable=!!V.stencil,this.useExactSrgbConversions=V.useExactSrgbConversions??!1;const q=(0,t.m)()&&window.devicePixelRatio||1,L=V.limitDeviceRatio||q;W=W||V.adaptToDeviceRatio||!1,this._hardwareScalingLevel=W?1/Math.min(L,q):1,this._lastDevicePixelRatio=q,this._creationOptions=V}resize(){let G,V,W=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.adaptToDeviceRatio){const G=(0,t.m)()&&window.devicePixelRatio||1,V=this._lastDevicePixelRatio/G;this._lastDevicePixelRatio=G,this._hardwareScalingLevel*=V}if((0,t.m)()&&(0,t.e)())if(this._renderingCanvas){var J,R;const W=null===(J=(R=this._renderingCanvas).getBoundingClientRect)||void 0===J?void 0:J.call(R);G=this._renderingCanvas.clientWidth||(null===W||void 0===W?void 0:W.width)||this._renderingCanvas.width*this._hardwareScalingLevel||100,V=this._renderingCanvas.clientHeight||(null===W||void 0===W?void 0:W.height)||this._renderingCanvas.height*this._hardwareScalingLevel||100}else G=window.innerWidth,V=window.innerHeight;else G=this._renderingCanvas?this._renderingCanvas.width:100,V=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(G/this._hardwareScalingLevel,V/this._hardwareScalingLevel,W)}setSize(G,V){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._renderingCanvas)return!1;if(G|=0,V|=0,!W&&this._renderingCanvas.width===G&&this._renderingCanvas.height===V)return!1;if(this._renderingCanvas.width=G,this._renderingCanvas.height=V,this.scenes){for(let G=0;G<this.scenes.length;G++){const V=this.scenes[G];for(let G=0;G<V.cameras.length;G++){V.cameras[G]._currentRenderId=0}}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}createRawTexture(G,V,W,J,R,d,k,z,X,P,A){throw(0,q.e)("engine.rawTexture")}createRawCubeTexture(G,V,W,J,R,d,k,z){throw(0,q.e)("engine.rawTexture")}createRawTexture3D(G,V,W,J,R,d,k,z,X,P,A){throw(0,q.e)("engine.rawTexture")}createRawTexture2DArray(G,V,W,J,R,d,k,z,X,P,A){throw(0,q.e)("engine.rawTexture")}_sharedInit(G){this._renderingCanvas=G}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const G=navigator.userAgent;this.hostInformation.isMobile=-1!==G.indexOf("Mobile")||-1!==G.indexOf("Mac")&&(0,t.e)()&&"ontouchend"in document},this._checkForMobile(),(0,t.m)()&&window.addEventListener("resize",this._checkForMobile))}createVideoElement(G){return document.createElement("video")}_reportDrawCall(){var G;let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;null===(G=this._drawCalls)||void 0===G||G.addCount(V,!1)}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return 1e3*this._timeStep}_createImageBitmapFromSource(G,V){throw new Error("createImageBitmapFromSource is not implemented")}createImageBitmap(G,V){return createImageBitmap(G,V)}resizeImageBitmap(G,V,W){throw new Error("resizeImageBitmap is not implemented")}getFontOffset(G){throw new Error("getFontOffset is not implemented")}static _CreateCanvas(G,V){if("undefined"===typeof document)return new OffscreenCanvas(G,V);const W=document.createElement("canvas");return W.width=G,W.height=V,W}createCanvas(G,V){return p._CreateCanvas(G,V)}static _FileToolsLoadImage(G,V,W,J,R,d,k){throw(0,q.e)("FileTools")}_loadFile(G,V,W,J,R,d){const k=(0,g.k)(G,V,W,J,R,d);return this._activeRequests.push(k),k.onCompleteObservable.add((()=>{const G=this._activeRequests.indexOf(k);-1!==G&&this._activeRequests.splice(G,1)})),k}static _FileToolsLoadFile(G,V,W,J,R,d){if(g.c.loadFile)return g.c.loadFile(G,V,W,J,R,d);throw(0,q.e)("FileTools")}dispose(){var G;for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();null===(G=this.releaseComputeEffects)||void 0===G||G.call(this),d.b.ResetCache();for(const W of this._activeRequests)W.abort();this._boundRenderFunction=null,this.Md.notifyObservers(this),this.Md.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),this.onEffectErrorObservable.clear(),(0,t.m)()&&window.removeEventListener("resize",this._checkForMobile);const V=J.c.Instances.indexOf(this);V>=0&&J.c.Instances.splice(V,1),J.c.Instances.length||(J.c.OnEnginesDisposedObservable.notifyObservers(this),J.c.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}static DefaultLoadingScreenFactory(G){throw(0,q.e)("LoadingScreen")}static MarkAllMaterialsAsDirty(G,V){for(let W=0;W<J.c.Instances.length;W++){const R=J.c.Instances[W];for(let W=0;W<R.scenes.length;W++)R.scenes[W].markAllMaterialsAsDirty(G,V)}}}p._RenderPassIdCounter=0,p._RescalePostProcessFactory=null,p.CollisionsEpsilon=.001,p.QueueNewFrame=S},11705:(G,V,W)=>{W.d(V,{d:()=>J});class J{}J.AUTOSAMPLERSUFFIX="Sampler",J.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",J.ALPHA_DISABLE=0,J.ALPHA_ADD=1,J.ALPHA_COMBINE=2,J.ALPHA_SUBTRACT=3,J.ALPHA_MULTIPLY=4,J.ALPHA_MAXIMIZED=5,J.ALPHA_ONEONE=6,J.ALPHA_PREMULTIPLIED=7,J.ALPHA_PREMULTIPLIED_PORTERDUFF=8,J.ALPHA_INTERPOLATE=9,J.ALPHA_SCREENMODE=10,J.ALPHA_ONEONE_ONEONE=11,J.ALPHA_ALPHATOCOLOR=12,J.ALPHA_REVERSEONEMINUS=13,J.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,J.ALPHA_ONEONE_ONEZERO=15,J.ALPHA_EXCLUSION=16,J.ALPHA_LAYER_ACCUMULATE=17,J.ALPHA_EQUATION_ADD=0,J.ALPHA_EQUATION_SUBSTRACT=1,J.ALPHA_EQUATION_REVERSE_SUBTRACT=2,J.ALPHA_EQUATION_MAX=3,J.ALPHA_EQUATION_MIN=4,J.ALPHA_EQUATION_DARKEN=5,J.DELAYLOADSTATE_NONE=0,J.DELAYLOADSTATE_LOADED=1,J.DELAYLOADSTATE_LOADING=2,J.DELAYLOADSTATE_NOTLOADED=4,J.NEVER=512,J.ALWAYS=519,J.LESS=513,J.EQUAL=514,J.LEQUAL=515,J.GREATER=516,J.GEQUAL=518,J.NOTEQUAL=517,J.KEEP=7680,J.ZERO=0,J.REPLACE=7681,J.INCR=7682,J.DECR=7683,J.INVERT=5386,J.INCR_WRAP=34055,J.DECR_WRAP=34056,J.TEXTURE_CLAMP_ADDRESSMODE=0,J.TEXTURE_WRAP_ADDRESSMODE=1,J.TEXTURE_MIRROR_ADDRESSMODE=2,J.TEXTURE_CREATIONFLAG_STORAGE=1,J.TEXTUREFORMAT_ALPHA=0,J.TEXTUREFORMAT_LUMINANCE=1,J.TEXTUREFORMAT_LUMINANCE_ALPHA=2,J.TEXTUREFORMAT_RGB=4,J.TEXTUREFORMAT_RGBA=5,J.TEXTUREFORMAT_RED=6,J.TEXTUREFORMAT_R=6,J.TEXTUREFORMAT_R16_UNORM=33322,J.TEXTUREFORMAT_RG16_UNORM=33324,J.TEXTUREFORMAT_RGB16_UNORM=32852,J.TEXTUREFORMAT_RGBA16_UNORM=32859,J.TEXTUREFORMAT_R16_SNORM=36760,J.TEXTUREFORMAT_RG16_SNORM=36761,J.TEXTUREFORMAT_RGB16_SNORM=36762,J.TEXTUREFORMAT_RGBA16_SNORM=36763,J.TEXTUREFORMAT_RG=7,J.TEXTUREFORMAT_RED_INTEGER=8,J.TEXTUREFORMAT_R_INTEGER=8,J.TEXTUREFORMAT_RG_INTEGER=9,J.TEXTUREFORMAT_RGB_INTEGER=10,J.TEXTUREFORMAT_RGBA_INTEGER=11,J.TEXTUREFORMAT_BGRA=12,J.TEXTUREFORMAT_DEPTH24_STENCIL8=13,J.TEXTUREFORMAT_DEPTH32_FLOAT=14,J.TEXTUREFORMAT_DEPTH16=15,J.TEXTUREFORMAT_DEPTH24=16,J.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,J.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,J.TEXTUREFORMAT_STENCIL8=19,J.TEXTUREFORMAT_UNDEFINED=4294967295,J.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,J.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,J.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,J.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,J.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,J.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,J.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,J.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,J.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,J.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,J.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,J.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,J.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,J.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,J.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,J.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,J.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,J.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,J.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,J.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,J.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,J.TEXTURETYPE_UNSIGNED_BYTE=0,J.TEXTURETYPE_UNSIGNED_INT=0,J.TEXTURETYPE_FLOAT=1,J.TEXTURETYPE_HALF_FLOAT=2,J.TEXTURETYPE_BYTE=3,J.TEXTURETYPE_SHORT=4,J.TEXTURETYPE_UNSIGNED_SHORT=5,J.TEXTURETYPE_INT=6,J.TEXTURETYPE_UNSIGNED_INTEGER=7,J.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,J.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,J.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,J.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,J.TEXTURETYPE_UNSIGNED_INT_24_8=12,J.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,J.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,J.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,J.TEXTURETYPE_UNDEFINED=16,J.TEXTURE_2D=3553,J.TEXTURE_2D_ARRAY=35866,J.TEXTURE_CUBE_MAP=34067,J.TEXTURE_CUBE_MAP_ARRAY=3735928559,J.TEXTURE_3D=32879,J.TEXTURE_NEAREST_SAMPLINGMODE=1,J.TEXTURE_NEAREST_NEAREST=1,J.TEXTURE_BILINEAR_SAMPLINGMODE=2,J.TEXTURE_LINEAR_LINEAR=2,J.TEXTURE_TRILINEAR_SAMPLINGMODE=3,J.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,J.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,J.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,J.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,J.TEXTURE_NEAREST_LINEAR=7,J.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,J.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,J.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,J.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,J.TEXTURE_LINEAR_NEAREST=12,J.TEXTURE_EXPLICIT_MODE=0,J.TEXTURE_SPHERICAL_MODE=1,J.TEXTURE_PLANAR_MODE=2,J.TEXTURE_CUBIC_MODE=3,J.TEXTURE_PROJECTION_MODE=4,J.TEXTURE_SKYBOX_MODE=5,J.TEXTURE_INVCUBIC_MODE=6,J.TEXTURE_EQUIRECTANGULAR_MODE=7,J.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,J.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,J.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,J.TEXTURE_FILTERING_QUALITY_HIGH=64,J.TEXTURE_FILTERING_QUALITY_MEDIUM=16,J.TEXTURE_FILTERING_QUALITY_LOW=8,J.SCALEMODE_FLOOR=1,J.SCALEMODE_NEAREST=2,J.SCALEMODE_CEILING=3,J.MATERIAL_TextureDirtyFlag=1,J.MATERIAL_LightDirtyFlag=2,J.MATERIAL_FresnelDirtyFlag=4,J.MATERIAL_AttributesDirtyFlag=8,J.MATERIAL_MiscDirtyFlag=16,J.MATERIAL_PrePassDirtyFlag=32,J.MATERIAL_ImageProcessingDirtyFlag=64,J.MATERIAL_AllDirtyFlag=127,J.MATERIAL_TriangleFillMode=0,J.MATERIAL_WireFrameFillMode=1,J.MATERIAL_PointFillMode=2,J.MATERIAL_PointListDrawMode=3,J.MATERIAL_LineListDrawMode=4,J.MATERIAL_LineLoopDrawMode=5,J.MATERIAL_LineStripDrawMode=6,J.MATERIAL_TriangleStripDrawMode=7,J.MATERIAL_TriangleFanDrawMode=8,J.MATERIAL_ClockWiseSideOrientation=0,J.MATERIAL_CounterClockWiseSideOrientation=1,J.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR=0,J.MATERIAL_DIFFUSE_MODEL_BURLEY=1,J.MATERIAL_DIFFUSE_MODEL_LAMBERT=2,J.MATERIAL_DIFFUSE_MODEL_LEGACY=3,J.MATERIAL_DIELECTRIC_SPECULAR_MODEL_GLTF=0,J.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR=1,J.MATERIAL_CONDUCTOR_SPECULAR_MODEL_GLTF=0,J.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR=1,J.ACTION_NothingTrigger=0,J.ACTION_OnPickTrigger=1,J.ACTION_OnLeftPickTrigger=2,J.ACTION_OnRightPickTrigger=3,J.ACTION_OnCenterPickTrigger=4,J.ACTION_OnPickDownTrigger=5,J.ACTION_OnDoublePickTrigger=6,J.ACTION_OnPickUpTrigger=7,J.ACTION_OnPickOutTrigger=16,J.ACTION_OnLongPressTrigger=8,J.ACTION_OnPointerOverTrigger=9,J.ACTION_OnPointerOutTrigger=10,J.ACTION_OnEveryFrameTrigger=11,J.ACTION_OnIntersectionEnterTrigger=12,J.ACTION_OnIntersectionExitTrigger=13,J.ACTION_OnKeyDownTrigger=14,J.ACTION_OnKeyUpTrigger=15,J.PARTICLES_BILLBOARDMODE_Y=2,J.PARTICLES_BILLBOARDMODE_ALL=7,J.PARTICLES_BILLBOARDMODE_STRETCHED=8,J.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,J.MESHES_CULLINGSTRATEGY_STANDARD=0,J.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,J.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,J.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,J.SCENELOADER_NO_LOGGING=0,J.SCENELOADER_MINIMAL_LOGGING=1,J.SCENELOADER_SUMMARY_LOGGING=2,J.SCENELOADER_DETAILED_LOGGING=3,J.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,J.PREPASS_POSITION_TEXTURE_TYPE=1,J.PREPASS_VELOCITY_TEXTURE_TYPE=2,J.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,J.PREPASS_COLOR_TEXTURE_TYPE=4,J.PREPASS_DEPTH_TEXTURE_TYPE=5,J.PREPASS_NORMAL_TEXTURE_TYPE=6,J.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,J.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,J.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,J.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,J.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,J.PREPASS_ALBEDO_TEXTURE_TYPE=12,J.PREPASS_NORMALIZED_VIEW_DEPTH_TEXTURE_TYPE=13,J.BUFFER_CREATIONFLAG_READ=1,J.BUFFER_CREATIONFLAG_WRITE=2,J.BUFFER_CREATIONFLAG_READWRITE=3,J.BUFFER_CREATIONFLAG_UNIFORM=4,J.BUFFER_CREATIONFLAG_VERTEX=8,J.BUFFER_CREATIONFLAG_INDEX=16,J.BUFFER_CREATIONFLAG_STORAGE=32,J.BUFFER_CREATIONFLAG_INDIRECT=64,J.RENDERPASS_MAIN=0,J.INPUT_ALT_KEY=18,J.INPUT_CTRL_KEY=17,J.INPUT_META_KEY1=91,J.INPUT_META_KEY2=92,J.INPUT_META_KEY3=93,J.INPUT_SHIFT_KEY=16,J.SNAPSHOTRENDERING_STANDARD=0,J.SNAPSHOTRENDERING_FAST=1,J.PERSPECTIVE_CAMERA=0,J.ORTHOGRAPHIC_CAMERA=1,J.FOVMODE_VERTICAL_FIXED=0,J.FOVMODE_HORIZONTAL_FIXED=1,J.RIG_MODE_NONE=0,J.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,J.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,J.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,J.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,J.RIG_MODE_STEREOSCOPIC_INTERLACED=14,J.RIG_MODE_VR=20,J.RIG_MODE_CUSTOM=22,J.MAX_SUPPORTED_UV_SETS=6,J.GL_ALPHA_EQUATION_ADD=32774,J.GL_ALPHA_EQUATION_MIN=32775,J.GL_ALPHA_EQUATION_MAX=32776,J.GL_ALPHA_EQUATION_SUBTRACT=32778,J.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,J.GL_ALPHA_FUNCTION_SRC=768,J.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,J.GL_ALPHA_FUNCTION_SRC_ALPHA=770,J.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,J.GL_ALPHA_FUNCTION_DST_ALPHA=772,J.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,J.GL_ALPHA_FUNCTION_DST_COLOR=774,J.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,J.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,J.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,J.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,J.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,J.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,J.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,J.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,J.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,J.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,J.SnippetUrl="https://snippet.babylonjs.com",J.FOGMODE_NONE=0,J.FOGMODE_EXP=1,J.FOGMODE_EXP2=2,J.FOGMODE_LINEAR=3,J.BYTE=5120,J.UNSIGNED_BYTE=5121,J.SHORT=5122,J.UNSIGNED_SHORT=5123,J.INT=5124,J.UNSIGNED_INT=5125,J.FLOAT=5126,J.PositionKind="position",J.NormalKind="IV",J.TangentKind="tangent",J.UVKind="uv",J.UV2Kind="uv2",J.UV3Kind="uv3",J.UV4Kind="uv4",J.UV5Kind="uv5",J.UV6Kind="uv6",J.ColorKind="color",J.ColorInstanceKind="instanceColor",J.MatricesIndicesKind="matricesIndices",J.MatricesWeightsKind="matricesWeights",J.MatricesIndicesExtraKind="matricesIndicesExtra",J.MatricesWeightsExtraKind="matricesWeightsExtra",J.ANIMATIONTYPE_FLOAT=0,J.ANIMATIONTYPE_VECTOR3=1,J.ANIMATIONTYPE_QUATERNION=2,J.ANIMATIONTYPE_MATRIX=3,J.ANIMATIONTYPE_COLOR3=4,J.ANIMATIONTYPE_COLOR4=7,J.ANIMATIONTYPE_VECTOR2=5,J.ANIMATIONTYPE_SIZE=6,J.ShadowMinZ=0,J.ShadowMaxZ=1e4},11564:(G,V,W)=>{W.d(V,{c:()=>H});var J=W(11285),R=W(11169),d=W(11568),k=W(11211);class z{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;this._enabled=!0,this._rollingFrameTime=new X(G)}sampleFrame(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k.e.Now;if(this._enabled){if(null!=this._lastFrameTimeMs){const V=G-this._lastFrameTimeMs;this._rollingFrameTime.add(V)}this._lastFrameTimeMs=G}}get averageFrameTime(){return this._rollingFrameTime.average}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFPS(){return 1e3/this._rollingFrameTime.average}get instantaneousFPS(){const G=this._rollingFrameTime.history(0);return 0===G?0:1e3/G}get isSaturated(){return this._rollingFrameTime.isSaturated()}enable(){this._enabled=!0}disable(){this._enabled=!1,this._lastFrameTimeMs=null}get isEnabled(){return this._enabled}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class X{constructor(G){this._samples=new Array(G),this.reset()}add(G){let V;if(this.isSaturated()){const G=this._samples[this._pos];V=G-this.average,this.average-=V/(this._sampleCount-1),this._m2-=V*(G-this.average)}else this._sampleCount++;V=G-this.average,this.average+=V/this._sampleCount,this._m2+=V*(G-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=G,this._pos++,this._pos%=this._samples.length}history(G){if(G>=this._sampleCount||G>=this._samples.length)return 0;const V=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(V-G)]}isSaturated(){return this._sampleCount>=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(G){const V=this._samples.length;return(G%V+V)%V}}var P=W(11574),A=W(11201),x=W(11580),q=(W(11593),W(11307));function L(G,V,W,J){let R,d=1;1===J?R=new Float32Array(V*W*4):2===J?(R=new Uint16Array(V*W*4),d=15360):R=7===J?new Uint32Array(V*W*4):new Uint8Array(V*W*4);for(let k=0;k<V;k++)for(let J=0;J<W;J++){const W=3*(J*V+k),z=4*(J*V+k);R[z+0]=G[W+0],R[z+1]=G[W+1],R[z+2]=G[W+2],R[z+3]=d}return R}function t(G){return function(V,W,R,d,k,z,X,P){let A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,x=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const q=G?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,L=G?10:11,t=new J.d(this,L);t.baseWidth=W,t.baseHeight=R,t.baseDepth=d,t.width=W,t.height=R,t.depth=d,t.format=k,t.type=x,t.generateMipMaps=z,t.samplingMode=P,G?t.is3D=!0:t.is2DArray=!0,this._doNotHandleContextLost||(t._bufferView=V),G?this.updateRawTexture3D(t,V,k,X,A,x):this.updateRawTexture2DArray(t,V,k,X,A,x),this._bindTextureDirectly(q,t,!0);const Y=this._getSamplingParameters(P,z);return this._gl.texParameteri(q,this._gl.TEXTURE_MAG_FILTER,Y.mag),this._gl.texParameteri(q,this._gl.TEXTURE_MIN_FILTER,Y.min),z&&this._gl.generateMipmap(q),this._bindTextureDirectly(q,null),this._internalTexturesCache.push(t),t}}function Y(G){return function(V,W,J,R){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const z=G?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,X=this._getWebGLTextureType(k),P=this._getInternalFormat(J),A=this._getRGBABufferInternalSizedFormat(k,J);this._bindTextureDirectly(z,V,!0),this._unpackFlipY(void 0===R||!!R),this._doNotHandleContextLost||(V._bufferView=W,V.format=J,V.invertY=R,V._compression=d),V.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),d&&W?this._gl.compressedTexImage3D(z,0,this.getCaps().s3tc[d],V.width,V.height,V.depth,0,W):this._gl.texImage3D(z,0,A,V.width,V.height,V.depth,0,P,X,W),V.generateMipMaps&&this._gl.generateMipmap(z),this._bindTextureDirectly(z,null),V.isReady=!0}}d.ThinEngine.prototype.updateRawTexture=function(G,V,W,J){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,k=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!G)return;const z=this._getRGBABufferInternalSizedFormat(d,W,k),X=this._getInternalFormat(W),P=this._getWebGLTextureType(d);this._bindTextureDirectly(this._gl.TEXTURE_2D,G,!0),this._unpackFlipY(void 0===J||!!J),this._doNotHandleContextLost||(G._bufferView=V,G.format=W,G.type=d,G.invertY=J,G._compression=R),G.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),R&&V?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[R],G.width,G.height,0,V):this._gl.texImage2D(this._gl.TEXTURE_2D,0,z,G.width,G.height,0,X,P,V),G.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),G.isReady=!0},d.ThinEngine.prototype.createRawTexture=function(G,V,W,R,d,k,z){let X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,P=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,A=arguments.length>10&&void 0!==arguments[10]&&arguments[10];const x=new J.d(this,3);x.baseWidth=V,x.baseHeight=W,x.width=V,x.height=W,x.format=R,x.generateMipMaps=d,x.samplingMode=z,x.invertY=k,x._compression=X,x.type=P,x._useSRGBBuffer=this._getUseSRGBBuffer(A,!d),this._doNotHandleContextLost||(x._bufferView=G),this.updateRawTexture(x,G,R,k,X,P,x._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,x,!0);const q=this._getSamplingParameters(z,d);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,q.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,q.min),d&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(x),x},d.ThinEngine.prototype.createRawCubeTexture=function(G,V,W,R,d,k,z){let X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;const P=this._gl,x=new J.d(this,8);x.isCube=!0,x.format=W,x.type=R,this._doNotHandleContextLost||(x._bufferViewArray=G);const L=this._getWebGLTextureType(R);let t=this._getInternalFormat(W);t===P.RGB&&(t=P.RGBA),L!==P.FLOAT||this._caps.textureFloatLinearFiltering?L!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?L!==P.FLOAT||this._caps.textureFloatRender?L!==P.HALF_FLOAT||this._caps.colorBufferFloat||(d=!1,A.c.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(d=!1,A.c.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(d=!1,z=1,A.c.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(d=!1,z=1,A.c.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));const Y=V,g=Y;x.width=Y,x.height=g,x.invertY=k,x._compression=X;if(!this.needPOTTextures||(0,q.j)(x.width)&&(0,q.j)(x.height)||(d=!1),G)this.updateRawCubeTexture(x,G,W,R,k,X);else{const G=this._getRGBABufferInternalSizedFormat(R),V=0;this._bindTextureDirectly(P.TEXTURE_CUBE_MAP,x,!0);for(let W=0;W<6;W++)X?P.compressedTexImage2D(P.TEXTURE_CUBE_MAP_POSITIVE_X+W,V,this.getCaps().s3tc[X],x.width,x.height,0,void 0):P.texImage2D(P.TEXTURE_CUBE_MAP_POSITIVE_X+W,V,G,x.width,x.height,0,t,L,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,x,!0),G&&d&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);const B=this._getSamplingParameters(z,d);return P.texParameteri(P.TEXTURE_CUBE_MAP,P.TEXTURE_MAG_FILTER,B.mag),P.texParameteri(P.TEXTURE_CUBE_MAP,P.TEXTURE_MIN_FILTER,B.min),P.texParameteri(P.TEXTURE_CUBE_MAP,P.TEXTURE_WRAP_S,P.CLAMP_TO_EDGE),P.texParameteri(P.TEXTURE_CUBE_MAP,P.TEXTURE_WRAP_T,P.CLAMP_TO_EDGE),this._bindTextureDirectly(P.TEXTURE_CUBE_MAP,null),x.generateMipMaps=d,x.samplingMode=z,x.isReady=!0,x},d.ThinEngine.prototype.updateRawCubeTexture=function(G,V,W,J,R){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;G._bufferViewArray=V,G.format=W,G.type=J,G.invertY=R,G._compression=d;const z=this._gl,X=this._getWebGLTextureType(J);let P=this._getInternalFormat(W);const A=this._getRGBABufferInternalSizedFormat(J);let x=!1;P===z.RGB&&(P=z.RGBA,x=!0),this._bindTextureDirectly(z.TEXTURE_CUBE_MAP,G,!0),this._unpackFlipY(void 0===R||!!R),G.width%4!==0&&z.pixelStorei(z.UNPACK_ALIGNMENT,1);for(let q=0;q<6;q++){let W=V[q];d?z.compressedTexImage2D(z.TEXTURE_CUBE_MAP_POSITIVE_X+q,k,this.getCaps().s3tc[d],G.width,G.height,0,W):(x&&(W=L(W,G.width,G.height,J)),z.texImage2D(z.TEXTURE_CUBE_MAP_POSITIVE_X+q,k,A,G.width,G.height,0,P,X,W))}(!this.needPOTTextures||(0,q.j)(G.width)&&(0,q.j)(G.height))&&G.generateMipMaps&&0===k&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),G.isReady=!0},d.ThinEngine.prototype.createRawCubeTextureFromUrl=function(G,V,W,J,R,d,k,z){let X=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,P=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,A=arguments.length>10&&void 0!==arguments[10]?arguments[10]:3,x=arguments.length>11&&void 0!==arguments[11]&&arguments[11];const q=this._gl,t=this.createRawCubeTexture(null,W,J,R,!d,x,A,null);null===V||void 0===V||V.addPendingData(t),t.url=G,t.isReady=!1,this._internalTexturesCache.push(t);const Y=G=>{if(!t._hardwareTexture)return;const W=t.width,d=k(G);if(d){if(z){const G=this._getWebGLTextureType(R);let V=this._getInternalFormat(J);const k=this._getRGBABufferInternalSizedFormat(R);let X=!1;V===q.RGB&&(V=q.RGBA,X=!0),this._bindTextureDirectly(q.TEXTURE_CUBE_MAP,t,!0),this._unpackFlipY(!1);const P=z(d);for(let J=0;J<P.length;J++){const d=W>>J;for(let W=0;W<6;W++){let z=P[J][W];X&&(z=L(z,d,d,R)),q.texImage2D(W,J,k,d,d,0,V,G,z)}}this._bindTextureDirectly(q.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(t,d,J,R,x);t.isReady=!0,null===V||void 0===V||V.removePendingData(t),t.onLoadedObservable.notifyObservers(t),t.onLoadedObservable.clear(),X&&X()}};return this._loadFile(G,(G=>{Y(G)}),void 0,null===V||void 0===V?void 0:V.offlineProvider,!0,((G,W)=>{null===V||void 0===V||V.removePendingData(t),P&&G&&P(G.status+" "+G.statusText,W)})),t},d.ThinEngine.prototype.createRawTexture2DArray=t(!1),d.ThinEngine.prototype.createRawTexture3D=t(!0),d.ThinEngine.prototype.updateRawTexture2DArray=Y(!1),d.ThinEngine.prototype.updateRawTexture3D=Y(!0);var g=W(11250);d.ThinEngine.prototype._readTexturePixelsSync=function(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,k=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],z=arguments.length>7&&void 0!==arguments[7]&&arguments[7],X=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,P=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const A=this._gl;if(!A)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const G=A.createFramebuffer();if(!G)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=G}var x,q;(A.bindFramebuffer(A.FRAMEBUFFER,this._dummyFramebuffer),J>-1)?A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_CUBE_MAP_POSITIVE_X+J,null===(x=G._hardwareTexture)||void 0===x?void 0:x.underlyingResource,R):A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_2D,null===(q=G._hardwareTexture)||void 0===q?void 0:q.underlyingResource,R);let L=void 0!==G.type?this._getWebGLTextureType(G.type):A.UNSIGNED_BYTE;if(z)d||(d=(0,g.n)(G.type,4*V*W));else if(L===A.UNSIGNED_BYTE)d||(d=new Uint8Array(4*V*W)),L=A.UNSIGNED_BYTE;else d||(d=new Float32Array(4*V*W)),L=A.FLOAT;return k&&this.flushFramebuffer(),A.readPixels(X,P,V,W,A.RGBA,L,d),A.bindFramebuffer(A.FRAMEBUFFER,this._currentFramebuffer),d},d.ThinEngine.prototype._readTexturePixels=function(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,k=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],z=arguments.length>7&&void 0!==arguments[7]&&arguments[7],X=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,P=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;return Promise.resolve(this._readTexturePixelsSync(G,V,W,J,R,d,k,z,X,P))};W(11595);d.ThinEngine.prototype._createDepthStencilCubeTexture=function(G,V){const W=new J.d(this,12);if(W.isCube=!0,1===this.webGLVersion)return A.c.Error("Depth cube texture is not supported by WebGL 1."),W;const R={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...V},d=this._gl;this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,W,!0),this._setupDepthStencilTexture(W,G,R.bilinearFiltering,R.comparisonFunction);for(let J=0;J<6;J++)R.generateStencil?d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+J,0,d.DEPTH24_STENCIL8,G,G,0,d.DEPTH_STENCIL,d.UNSIGNED_INT_24_8,null):d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+J,0,d.DEPTH_COMPONENT24,G,G,0,d.DEPTH_COMPONENT,d.UNSIGNED_INT,null);return this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(W),W},d.ThinEngine.prototype._setCubeMapTextureParams=function(G,V,W){const J=this._gl;J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MAG_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MIN_FILTER,V?J.LINEAR_MIPMAP_LINEAR:J.LINEAR),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),G.samplingMode=V?3:2,V&&this.getCaps().textureMaxLevel&&void 0!==W&&W>0&&(J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MAX_LEVEL,W),G._maxLodLevel=W),this._bindTextureDirectly(J.TEXTURE_CUBE_MAP,null)},d.ThinEngine.prototype.createCubeTexture=function(G,V,W,J){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,k=arguments.length>6?arguments[6]:void 0,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,X=arguments.length>8&&void 0!==arguments[8]&&arguments[8],P=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,x=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,L=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,t=arguments.length>13&&void 0!==arguments[13]&&arguments[13],Y=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null;const g=this._gl;return this.createCubeTextureBase(G,V,W,!!J,R,d,k,z,X,P,x,L,(G=>this._bindTextureDirectly(g.TEXTURE_CUBE_MAP,G,!0)),((G,V)=>{const W=this.needPOTTextures?(0,q.f)(V[0].width,this._caps.maxCubemapTextureSize):V[0].width,d=W,z=[g.TEXTURE_CUBE_MAP_POSITIVE_X,g.TEXTURE_CUBE_MAP_POSITIVE_Y,g.TEXTURE_CUBE_MAP_POSITIVE_Z,g.TEXTURE_CUBE_MAP_NEGATIVE_X,g.TEXTURE_CUBE_MAP_NEGATIVE_Y,g.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(g.TEXTURE_CUBE_MAP,G,!0),this._unpackFlipY(!1);const X=k?this._getInternalFormat(k,G._useSRGBBuffer):G._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:g.RGBA;let P=k?this._getInternalFormat(k):g.RGBA;G._useSRGBBuffer&&1===this.webGLVersion&&(P=X);for(let J=0;J<z.length;J++)if(V[J].width!==W||V[J].height!==d){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void A.c.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=W,this._workingCanvas.height=d,this._workingContext.drawImage(V[J],0,0,V[J].width,V[J].height,0,0,W,d),g.texImage2D(z[J],0,X,P,g.UNSIGNED_BYTE,this._workingCanvas)}else g.texImage2D(z[J],0,X,P,g.UNSIGNED_BYTE,V[J]);J||g.generateMipmap(g.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(G,!J),G.width=W,G.height=d,G.isReady=!0,k&&(G.format=k),G.onLoadedObservable.notifyObservers(G),G.onLoadedObservable.clear(),R&&R()}),!!t,Y)},d.ThinEngine.prototype.generateMipMapsForCubemap=function(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(G.generateMipMaps){const W=this._gl;this._bindTextureDirectly(W.TEXTURE_CUBE_MAP,G,!0),W.generateMipmap(W.TEXTURE_CUBE_MAP),V&&this._bindTextureDirectly(W.TEXTURE_CUBE_MAP,null)}};W(11604);d.ThinEngine.prototype.setDepthStencilTexture=function(G,V,W,J){void 0!==G&&(V&&(this._boundUniforms[G]=V),W&&W.depthStencilTexture?this._setTexture(G,W,!1,!0,J):this._setTexture(G,null,void 0,void 0,J))},d.ThinEngine.prototype.createRenderTargetCubeTexture=function(G,V){const W=this._createHardwareRenderTargetWrapper(!1,!0,G),R={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...V};R.generateStencilBuffer=R.generateDepthBuffer&&R.generateStencilBuffer,(1!==R.type||this._caps.textureFloatLinearFiltering)&&(2!==R.type||this._caps.textureHalfFloatLinearFiltering)||(R.samplingMode=1);const d=this._gl,k=new J.d(this,5);this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,k,!0);const z=this._getSamplingParameters(R.samplingMode,R.generateMipMaps);1!==R.type||this._caps.textureFloat||(R.type=0,A.c.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MAG_FILTER,z.mag),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MIN_FILTER,z.min),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);for(let J=0;J<6;J++)d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+J,0,this._getRGBABufferInternalSizedFormat(R.type,R.format),G,G,0,this._getInternalFormat(R.format),this._getWebGLTextureType(R.type),null);const X=d.createFramebuffer();return this._bindUnboundFramebuffer(X),W._depthStencilBuffer=this._setupFramebufferDepthAttachments(R.generateStencilBuffer,R.generateDepthBuffer,G,G),R.generateMipMaps&&d.generateMipmap(d.TEXTURE_CUBE_MAP),this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),W._framebuffer=X,W._generateDepthBuffer=R.generateDepthBuffer,W._generateStencilBuffer=R.generateStencilBuffer,k.width=G,k.height=G,k.isReady=!0,k.isCube=!0,k.samples=1,k.generateMipMaps=R.generateMipMaps,k.samplingMode=R.samplingMode,k.type=R.type,k.format=R.format,this._internalTexturesCache.push(k),W.setTextures(k),W};var B=W(11620),S=W(11645);d.ThinEngine.prototype.createPrefilteredCubeTexture=function(G,V,R,d){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,X=arguments.length>6?arguments[6]:void 0,P=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,x=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];return this.createCubeTexture(G,V,null,!1,(async G=>{if(!G)return void(k&&k(null));const z=G.texture;if(x?G.info.sphericalPolynomial&&(z._sphericalPolynomial=G.info.sphericalPolynomial):z._sphericalPolynomial=new B.g,z._source=9,this.getCaps().textureLOD)return void(k&&k(z));const X=this._gl,P=G.width;if(!P)return;const{DDSTools:q}=await W.e(26).then(W.bind(W,13772)),L=[];for(let W=0;W<3;W++){const k=1-W/2,x=d,t=Math.log2(P)*R+d,Y=x+(t-x)*k,g=Math.round(Math.min(Math.max(Y,0),t)),B=new J.d(this,2);if(B.type=z.type,B.format=z.format,B.width=Math.pow(2,Math.max(Math.log2(P)-g,0)),B.height=B.width,B.isCube=!0,B._cachedWrapU=0,B._cachedWrapV=0,this._bindTextureDirectly(X.TEXTURE_CUBE_MAP,B,!0),B.samplingMode=2,X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_MAG_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),G.isDDS){const V=G.info,W=G.data;this._unpackFlipY(V.isCompressed),q.UploadDDSLevels(this,B,W,V,!0,6,g)}else A.c.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(X.TEXTURE_CUBE_MAP,null);const p=new S.b(V);p._isCube=!0,p._texture=B,B.isReady=!0,L.push(p)}z._lodTextureHigh=L[2],z._lodTextureMid=L[1],z._lodTextureLow=L[0],k&&k(z)}),z,X,P,x,R,d)},d.ThinEngine.prototype.createUniformBuffer=function(G,V){const W=this._gl.createBuffer();if(!W)throw new Error("Unable to create uniform buffer");const J=new P.b(W);return this.bindUniformBuffer(J),G instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,G,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(G),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),J.references=1,J},d.ThinEngine.prototype.createDynamicUniformBuffer=function(G,V){const W=this._gl.createBuffer();if(!W)throw new Error("Unable to create dynamic uniform buffer");const J=new P.b(W);return this.bindUniformBuffer(J),G instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,G,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(G),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),J.references=1,J},d.ThinEngine.prototype.updateUniformBuffer=function(G,V,W,J){this.bindUniformBuffer(G),void 0===W&&(W=0),void 0===J?V instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,W,V):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,W,new Float32Array(V)):V instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,V.subarray(W,W+J)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(V).subarray(W,W+J)),this.bindUniformBuffer(null)},d.ThinEngine.prototype.bindUniformBuffer=function(G){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,G?G.underlyingResource:null)},d.ThinEngine.prototype.bindUniformBufferBase=function(G,V,W){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,V,G?G.underlyingResource:null)},d.ThinEngine.prototype.bindUniformBlock=function(G,V,W){const J=G.program,R=this._gl.getUniformBlockIndex(J,V);4294967295!==R&&this._gl.uniformBlockBinding(J,R,W)};var p=W(11196),b=W(11262);b.b.prototype.displayLoadingUI=function(){if(!(0,p.m)())return;const G=this.loadingScreen;G&&G.displayLoadingUI()},b.b.prototype.hideLoadingUI=function(){if(!(0,p.m)())return;const G=this._loadingScreen;G&&G.hideLoadingUI()},Object.defineProperty(b.b.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=b.b.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(G){this._loadingScreen=G},enumerable:!0,configurable:!0}),Object.defineProperty(b.b.prototype,"loadingUIText",{set:function(G){this.loadingScreen.loadingUIText=G},enumerable:!0,configurable:!0}),Object.defineProperty(b.b.prototype,"loadingUIBackgroundColor",{set:function(G){this.loadingScreen.loadingUIBackgroundColor=G},enumerable:!0,configurable:!0}),b.b.prototype.getInputElement=function(){return this._renderingCanvas},b.b.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},b.b.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},b.b.prototype.getAspectRatio=function(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const W=G.viewport;return this.getRenderWidth(V)*W.width/(this.getRenderHeight(V)*W.height)},b.b.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},b.b.prototype._verifyPointerLock=function(){var G;null===(G=this._onPointerLockChange)||void 0===G||G.call(this)},b.b.prototype.setAlphaEquation=function(G){if(this._alphaEquation!==G){switch(G){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=G}},b.b.prototype.getInputElement=function(){return this._renderingCanvas},b.b.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},b.b.prototype.setDepthFunction=function(G){this._depthCullingState.depthFunc=G},b.b.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},b.b.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},b.b.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},b.b.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},b.b.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},b.b.prototype.setDepthWrite=function(G){this._depthCullingState.depthMask=G},b.b.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},b.b.prototype.setStencilBuffer=function(G){this._stencilState.stencilTest=G},b.b.prototype.getStencilMask=function(){return this._stencilState.stencilMask},b.b.prototype.setStencilMask=function(G){this._stencilState.stencilMask=G},b.b.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},b.b.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},b.b.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},b.b.prototype.setStencilFunction=function(G){this._stencilState.stencilFunc=G},b.b.prototype.setStencilFunctionReference=function(G){this._stencilState.stencilFuncRef=G},b.b.prototype.setStencilFunctionMask=function(G){this._stencilState.stencilFuncMask=G},b.b.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},b.b.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},b.b.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},b.b.prototype.setStencilOperationFail=function(G){this._stencilState.stencilOpStencilFail=G},b.b.prototype.setStencilOperationDepthFail=function(G){this._stencilState.stencilOpDepthFail=G},b.b.prototype.setStencilOperationPass=function(G){this._stencilState.stencilOpStencilDepthPass=G},b.b.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},b.b.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},b.b.prototype.setAlphaConstants=function(G,V,W,J){this._alphaState.setAlphaBlendConstants(G,V,W,J)},b.b.prototype.getAlphaMode=function(){return this._alphaMode},b.b.prototype.getAlphaEquation=function(){return this._alphaEquation},b.b.prototype.getRenderPassNames=function(){return this._renderPassNames},b.b.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},b.b.prototype.createRenderPassId=function(G){const V=++b.b._RenderPassIdCounter;return this._renderPassNames[V]=G??"NONAME",V},b.b.prototype.releaseRenderPassId=function(G){this._renderPassNames[G]=void 0;for(let V=0;V<this.scenes.length;++V){const W=this.scenes[V];for(let V=0;V<W.meshes.length;++V){const J=W.meshes[V];if(J.Ed)for(let V=0;V<J.Ed.length;++V){J.Ed[V]._removeDrawWrapper(G)}}}};W(11615);function r(G){if(G.requestPointerLock){const V=G.requestPointerLock();V instanceof Promise?V.then((()=>{G.focus()})).catch((()=>{})):G.focus()}}var y=W(11654),u=W(11254);class H extends d.ThinEngine{static get NpmPackage(){return b.b.NpmPackage}static get Version(){return b.b.Version}static get Instances(){return R.c.Instances}static get LastCreatedEngine(){return R.c.LastCreatedEngine}static get LastCreatedScene(){return R.c.LastCreatedScene}static DefaultLoadingScreenFactory(G){return b.b.DefaultLoadingScreenFactory(G)}get _supportsHardwareTextureRescaling(){return!!H._RescalePostProcessFactory}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}get performanceMonitor(){return this._performanceMonitor}constructor(G,V,W){super(G,V,W,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this.customAnimationFrameRequester=null,this._performanceMonitor=new z,this._drawCalls=new y.c,G&&(this._features.supportRenderPasses=!0,W=this._creationOptions)}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_sharedInit(G){super._sharedInit(G),function(G,V,W){G._onCanvasFocus=()=>{G.onCanvasFocusObservable.notifyObservers(G)},G._onCanvasBlur=()=>{G.onCanvasBlurObservable.notifyObservers(G)},G._onCanvasContextMenu=V=>{G.disableContextMenu&&V.preventDefault()},V.addEventListener("focus",G._onCanvasFocus),V.addEventListener("blur",G._onCanvasBlur),V.addEventListener("contextmenu",G._onCanvasContextMenu),G._onBlur=()=>{G.disablePerformanceMonitorInBackground&&G.performanceMonitor.disable(),G._windowIsBackground=!0},G._onFocus=()=>{G.disablePerformanceMonitorInBackground&&G.performanceMonitor.enable(),G._windowIsBackground=!1},G._onCanvasPointerOut=W=>{document.elementFromPoint(W.clientX,W.clientY)!==V&&G.onCanvasPointerOutObservable.notifyObservers(W)};const J=G.getHostWindow();J&&"function"===typeof J.addEventListener&&(J.addEventListener("blur",G._onBlur),J.addEventListener("focus",G._onFocus)),V.addEventListener("pointerout",G._onCanvasPointerOut),W.doNotHandleTouchAction||function(G){G&&G.setAttribute&&(G.setAttribute("touch-action","none"),G.style.touchAction="none",G.style.webkitTapHighlightColor="transparent")}(V),!b.b.audioEngine&&W.audioEngine&&b.b.AudioEngineFactory&&(b.b.audioEngine=b.b.AudioEngineFactory(G.getRenderingCanvas(),G.getAudioContext(),G.getAudioDestination())),(0,p.e)()&&(G._onFullscreenChange=()=>{G.isFullscreen=!!document.fullscreenElement,G.isFullscreen&&G._pointerLockRequested&&V&&r(V)},document.addEventListener("fullscreenchange",G._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",G._onFullscreenChange,!1),G._onPointerLockChange=()=>{G.isPointerLock=document.pointerLockElement===V},document.addEventListener("pointerlockchange",G._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",G._onPointerLockChange,!1)),G.enableOfflineSupport=void 0!==b.b.OfflineProviderFactory,G._deterministicLockstep=!!W.deterministicLockstep,G._lockstepMaxSteps=W.lockstepMaxSteps||0,G._timeStep=W.timeStep||1/60}(this,G,this._creationOptions)}resizeImageBitmap(G,V,W){return function(G,V,W,J){const R=G.createCanvas(W,J).getContext("2d");if(!R)throw new Error("Unable to get 2d context for resizeImageBitmap");return R.drawImage(V,0,0),R.getImageData(0,0,W,J).data}(this,G,V,W)}async _createImageBitmapFromSource(G,V){return await async function(G,V,W){return await new Promise(((J,R)=>{const d=new Image;d.onload=()=>{d.decode().then((()=>{G.createImageBitmap(d,W).then((G=>{J(G)}))}))},d.onerror=()=>{R(`Error loading image ${d.src}`)},d.src=V}))}(this,G,V)}switchFullscreen(G){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(G)}enterFullscreen(G){this.isFullscreen||(this._pointerLockRequested=G,this._renderingCanvas&&function(G){const V=G.requestFullscreen||G.webkitRequestFullscreen;V&&V.call(G)}(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&function(){const G=document;document.exitFullscreen?document.exitFullscreen():G.webkitCancelFullScreen&&G.webkitCancelFullScreen()}()}setDitheringState(G){G?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(G){G?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}setDirectViewport(G,V,W,J){const R=this._cachedViewport;return this._cachedViewport=null,this._viewport(G,V,W,J),R}scissorClear(G,V,W,J,R){this.enableScissor(G,V,W,J),this.clear(R,!0,!0,!0),this.disableScissor()}enableScissor(G,V,W,J){const R=this._gl;R.enable(R.SCISSOR_TEST),R.scissor(G,V,W,J)}disableScissor(){const G=this._gl;G.disable(G.SCISSOR_TEST)}async _loadFileAsync(G,V,W){return await new Promise(((J,R)=>{this._loadFile(G,(G=>{J(G)}),void 0,V,W,((G,V)=>{R(V)}))}))}getVertexShaderSource(G){const V=this._gl.getAttachedShaders(G);return V?this._gl.getShaderSource(V[0]):null}getFragmentShaderSource(G){const V=this._gl.getAttachedShaders(G);return V?this._gl.getShaderSource(V[1]):null}set framebufferDimensionsObject(G){this._framebufferDimensionsObject=G,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}_rebuildBuffers(){for(const G of this.scenes)G.resetCachedMaterial(),G._rebuildGeometries();for(const G of this._virtualScenes)G.resetCachedMaterial(),G._rebuildGeometries();super._rebuildBuffers()}getFontOffset(G){return function(G){const V=document.createElement("span");V.textContent="Hg",V.style.font=G;const W=document.createElement("div");W.style.display="inline-block",W.style.width="1px",W.style.height="0px",W.style.verticalAlign="bottom";const J=document.createElement("div");J.style.whiteSpace="nowrap",J.appendChild(V),J.appendChild(W),document.body.appendChild(J);let R=0,d=0;try{d=W.getBoundingClientRect().top-V.getBoundingClientRect().top,W.style.verticalAlign="baseline",R=W.getBoundingClientRect().top-V.getBoundingClientRect().top}finally{document.body.removeChild(J)}return{ascent:R,height:d,descent:d-R}}(G)}_cancelFrame(){if(this.customAnimationFrameRequester){if(0!==this._frameHandler){this._frameHandler=0;const{cancelAnimationFrame:G}=this.customAnimationFrameRequester;G&&G(this.customAnimationFrameRequester.A)}}else super._cancelFrame()}_renderLoop(G){this._processFrame(G),this._activeRenderLoops.length>0&&0===this._frameHandler&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.A=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.A):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}enterPointerlock(){this._renderingCanvas&&r(this._renderingCanvas)}exitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}bx(){this._measureFps(),super.bx()}_deletePipelineContext(G){const V=G;V&&V.program&&V.transformFeedback&&(this.deleteTransformFeedback(V.transformFeedback),V.transformFeedback=null),super._deletePipelineContext(G)}createShaderProgram(G,V,W,J,R){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;R=R||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const k=super.createShaderProgram(G,V,W,J,R,d);return this.onAfterShaderCompilationObservable.notifyObservers(this),k}_createShaderProgram(G,V,W,J){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const d=J.createProgram();if(G.program=d,!d)throw new Error("Unable to create program");if(J.attachShader(d,V),J.attachShader(d,W),this.webGLVersion>1&&R){const V=this.createTransformFeedback();this.bindTransformFeedback(V),this.setTranformFeedbackVaryings(d,R),G.transformFeedback=V}return J.linkProgram(d),this.webGLVersion>1&&R&&this.bindTransformFeedback(null),G.context=J,G.vertexShader=V,G.fragmentShader=W,G.isParallelCompiled||this._finalizePipelineContext(G),d}_releaseTexture(G){super._releaseTexture(G)}_releaseRenderTargetWrapper(G){super._releaseRenderTargetWrapper(G);for(const V of this.scenes){for(const W of V.postProcesses)W._outputTexture===G&&(W._outputTexture=null);for(const W of V.cameras)for(const V of W._postProcesses)V&&V._outputTexture===G&&(V._outputTexture=null)}}_rescaleTexture(G,V,W,J,R){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const d=this.createRenderTargetTexture({width:V.width,height:V.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});if(!this._rescalePostProcess&&H._RescalePostProcessFactory&&(this._rescalePostProcess=H._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;const k=()=>{this._rescalePostProcess.onApply=function(V){V._bindTexture("textureSampler",G)};let k=W;k||(k=this.scenes[this.scenes.length-1]),k.postProcessManager.directRender([this._rescalePostProcess],d,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,V,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,J,0,0,V.width,V.height,0),this.unBindFramebuffer(d),d.dispose(),R&&R()},z=this._rescalePostProcess.getEffect();z?z.executeWhenCompiled(k):this._rescalePostProcess.onEffectCreatedObservable.addOnce((G=>{G.executeWhenCompiled(k)}))}}wrapWebGLTexture(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const k=new x.e(G,this._gl),z=new J.d(this,0,!0);return z._hardwareTexture=k,z.baseWidth=R,z.baseHeight=d,z.width=R,z.height=d,z.isReady=!0,z.useMipMaps=V,this.updateTextureSamplingMode(W,z),z}_uploadImageToTexture(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const R=this._gl,d=this._getWebGLTextureType(G.type),k=this._getInternalFormat(G.format),z=this._getRGBABufferInternalSizedFormat(G.type,k),X=G.isCube?R.TEXTURE_CUBE_MAP:R.TEXTURE_2D;this._bindTextureDirectly(X,G,!0),this._unpackFlipY(G.invertY);let P=R.TEXTURE_2D;G.isCube&&(P=R.TEXTURE_CUBE_MAP_POSITIVE_X+W),R.texImage2D(P,J,z,k,d,V),this._bindTextureDirectly(X,null,!0)}updateTextureComparisonFunction(G,V){if(1===this.webGLVersion)return void A.c.Error("WebGL 1 does not support texture comparison.");const W=this._gl;G.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,G,!0),0===V?(W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_COMPARE_FUNC,515),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_COMPARE_MODE,W.NONE)):(W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_COMPARE_FUNC,V),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_COMPARE_MODE,W.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,G,!0),0===V?(W.texParameteri(W.TEXTURE_2D,W.TEXTURE_COMPARE_FUNC,515),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_COMPARE_MODE,W.NONE)):(W.texParameteri(W.TEXTURE_2D,W.TEXTURE_COMPARE_FUNC,V),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_COMPARE_MODE,W.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),G._comparisonFunction=V}createInstancesBuffer(G){const V=this._gl.createBuffer();if(!V)throw new Error("Unable to create instance buffer");const W=new P.b(V);return W.DV=G,this.bindArrayBuffer(W),this._gl.bufferData(this._gl.ARRAY_BUFFER,G,this._gl.DYNAMIC_DRAW),W.references=1,W}deleteInstancesBuffer(G){this._gl.deleteBuffer(G)}async _clientWaitAsync(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;const J=this._gl;return await new Promise(((R,d)=>{(0,u.f)((()=>{const W=J.clientWaitSync(G,V,0);if(W==J.WAIT_FAILED)throw new Error("clientWaitSync failed");return W!=J.TIMEOUT_EXPIRED}),R,d,W)}))}_readPixelsAsync(G,V,W,J,R,d,k){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const z=this._gl,X=z.createBuffer();z.bindBuffer(z.PIXEL_PACK_BUFFER,X),z.bufferData(z.PIXEL_PACK_BUFFER,k.byteLength,z.STREAM_READ),z.readPixels(G,V,W,J,R,d,0),z.bindBuffer(z.PIXEL_PACK_BUFFER,null);const P=z.fenceSync(z.SYNC_GPU_COMMANDS_COMPLETE,0);return P?(z.flush(),this._clientWaitAsync(P,0,10).then((()=>(z.deleteSync(P),z.bindBuffer(z.PIXEL_PACK_BUFFER,X),z.getBufferSubData(z.PIXEL_PACK_BUFFER,0,k),z.bindBuffer(z.PIXEL_PACK_BUFFER,null),z.deleteBuffer(X),k)))):null}dispose(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),function(G,V){1===R.c.Instances.length&&b.b.audioEngine&&(b.b.audioEngine.dispose(),b.b.audioEngine=null);const W=G.getHostWindow();W&&"function"===typeof W.removeEventListener&&(W.removeEventListener("blur",G._onBlur),W.removeEventListener("focus",G._onFocus)),V&&(V.removeEventListener("focus",G._onCanvasFocus),V.removeEventListener("blur",G._onCanvasBlur),V.removeEventListener("pointerout",G._onCanvasPointerOut),V.removeEventListener("contextmenu",G._onCanvasContextMenu)),(0,p.e)()&&(document.removeEventListener("fullscreenchange",G._onFullscreenChange),document.removeEventListener("mozfullscreenchange",G._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",G._onFullscreenChange),document.removeEventListener("msfullscreenchange",G._onFullscreenChange),document.removeEventListener("pointerlockchange",G._onPointerLockChange),document.removeEventListener("mspointerlockchange",G._onPointerLockChange),document.removeEventListener("mozpointerlockchange",G._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",G._onPointerLockChange))}(this,this._renderingCanvas),super.dispose()}}H.ALPHA_DISABLE=0,H.ALPHA_ADD=1,H.ALPHA_COMBINE=2,H.ALPHA_SUBTRACT=3,H.ALPHA_MULTIPLY=4,H.ALPHA_MAXIMIZED=5,H.ALPHA_ONEONE=6,H.ALPHA_PREMULTIPLIED=7,H.ALPHA_PREMULTIPLIED_PORTERDUFF=8,H.ALPHA_INTERPOLATE=9,H.ALPHA_SCREENMODE=10,H.DELAYLOADSTATE_NONE=0,H.DELAYLOADSTATE_LOADED=1,H.DELAYLOADSTATE_LOADING=2,H.DELAYLOADSTATE_NOTLOADED=4,H.NEVER=512,H.ALWAYS=519,H.LESS=513,H.EQUAL=514,H.LEQUAL=515,H.GREATER=516,H.GEQUAL=518,H.NOTEQUAL=517,H.KEEP=7680,H.REPLACE=7681,H.INCR=7682,H.DECR=7683,H.INVERT=5386,H.INCR_WRAP=34055,H.DECR_WRAP=34056,H.TEXTURE_CLAMP_ADDRESSMODE=0,H.TEXTURE_WRAP_ADDRESSMODE=1,H.TEXTURE_MIRROR_ADDRESSMODE=2,H.TEXTUREFORMAT_ALPHA=0,H.TEXTUREFORMAT_LUMINANCE=1,H.TEXTUREFORMAT_LUMINANCE_ALPHA=2,H.TEXTUREFORMAT_RGB=4,H.TEXTUREFORMAT_RGBA=5,H.TEXTUREFORMAT_RED=6,H.TEXTUREFORMAT_R=6,H.TEXTUREFORMAT_R16_UNORM=33322,H.TEXTUREFORMAT_RG16_UNORM=33324,H.TEXTUREFORMAT_RGB16_UNORM=32852,H.TEXTUREFORMAT_RGBA16_UNORM=32859,H.TEXTUREFORMAT_R16_SNORM=36760,H.TEXTUREFORMAT_RG16_SNORM=36761,H.TEXTUREFORMAT_RGB16_SNORM=36762,H.TEXTUREFORMAT_RGBA16_SNORM=36763,H.TEXTUREFORMAT_RG=7,H.TEXTUREFORMAT_RED_INTEGER=8,H.TEXTUREFORMAT_R_INTEGER=8,H.TEXTUREFORMAT_RG_INTEGER=9,H.TEXTUREFORMAT_RGB_INTEGER=10,H.TEXTUREFORMAT_RGBA_INTEGER=11,H.TEXTURETYPE_UNSIGNED_BYTE=0,H.TEXTURETYPE_UNSIGNED_INT=0,H.TEXTURETYPE_FLOAT=1,H.TEXTURETYPE_HALF_FLOAT=2,H.TEXTURETYPE_BYTE=3,H.TEXTURETYPE_SHORT=4,H.TEXTURETYPE_UNSIGNED_SHORT=5,H.TEXTURETYPE_INT=6,H.TEXTURETYPE_UNSIGNED_INTEGER=7,H.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,H.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,H.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,H.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,H.TEXTURETYPE_UNSIGNED_INT_24_8=12,H.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,H.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,H.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,H.TEXTURE_NEAREST_SAMPLINGMODE=1,H.TEXTURE_BILINEAR_SAMPLINGMODE=2,H.TEXTURE_TRILINEAR_SAMPLINGMODE=3,H.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,H.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,H.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,H.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,H.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,H.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,H.TEXTURE_NEAREST_LINEAR=7,H.TEXTURE_NEAREST_NEAREST=1,H.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,H.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,H.TEXTURE_LINEAR_LINEAR=2,H.TEXTURE_LINEAR_NEAREST=12,H.TEXTURE_EXPLICIT_MODE=0,H.TEXTURE_SPHERICAL_MODE=1,H.TEXTURE_PLANAR_MODE=2,H.TEXTURE_CUBIC_MODE=3,H.TEXTURE_PROJECTION_MODE=4,H.TEXTURE_SKYBOX_MODE=5,H.TEXTURE_INVCUBIC_MODE=6,H.TEXTURE_EQUIRECTANGULAR_MODE=7,H.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,H.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,H.SCALEMODE_FLOOR=1,H.SCALEMODE_NEAREST=2,H.SCALEMODE_CEILING=3},11169:(G,V,W)=>{W.d(V,{c:()=>R});var J=W(11176);class R{static get LastCreatedEngine(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}static get LastCreatedScene(){return this._LastCreatedScene}}R.Instances=[],R.OnEnginesDisposedObservable=new J.b,R._LastCreatedScene=null,R.UseFallbackTexture=!0,R.FallbackTexture=""},11165:(G,V,W)=>{W.d(V,{e:()=>J});class J{static SetMatrixPrecision(G){if(J.MatrixTrackPrecisionChange=!1,G&&!J.MatrixUse64Bits&&J.MatrixTrackedMatrices)for(let V=0;V<J.MatrixTrackedMatrices.length;++V){const G=J.MatrixTrackedMatrices[V],W=G.kq;G.kq=new Array(16);for(let V=0;V<16;++V)G.kq[V]=W[V]}J.MatrixUse64Bits=G,J.MatrixCurrentType=J.MatrixUse64Bits?Array:Float32Array,J.MatrixTrackedMatrices=null}}J.MatrixUse64Bits=!1,J.MatrixTrackPrecisionChange=!0,J.MatrixCurrentType=Float32Array,J.MatrixTrackedMatrices=[]},11606:(G,V,W)=>{W.d(V,{c:()=>R});var J=W(11588);class R{get depthStencilTexture(){return this._depthStencilTexture}setDepthStencilTexture(G){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this._depthStencilTexture&&this._depthStencilTexture.dispose(),this._depthStencilTexture=G,this._generateDepthBuffer=this._generateStencilBuffer=this._depthStencilTextureWithStencil=!1,G&&(this._generateDepthBuffer=!0,this._generateStencilBuffer=this._depthStencilTextureWithStencil=(0,J.c)(G.format))}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}get isCube(){return this._isCube}get isMulti(){return this._isMulti}get is2DArray(){return this.layers>0}get is3D(){return this.depth>0}get size(){return this.width}get width(){return this._size.width??this._size}get height(){return this._size.height??this._size}get layers(){return this._size.layers||0}get depth(){return this._size.depth||0}get texture(){var G;return(null===(G=this._textures)||void 0===G?void 0:G[0])??null}get textures(){return this._textures}get faceIndices(){return this._faceIndices}get layerIndices(){return this._layerIndices}getBaseArrayLayer(G){var V,W;if(!this._textures)return-1;const J=this._textures[G],R=(null===(V=this._layerIndices)||void 0===V?void 0:V[G])??0,d=(null===(W=this._faceIndices)||void 0===W?void 0:W[G])??0;return J.isCube?6*R+d:J.is3D?0:R}get samples(){return this._samples}setSamples(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.samples===G&&!W)return G;const J=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,G,V):this._engine.updateRenderTargetTextureSampleCount(this,G);return this._samples=G,J}resolveMSAATextures(){this.isMulti?this._engine.resolveMultiFramebuffer(this):this._engine.resolveFramebuffer(this)}generateMipMaps(){this._engine._currentRenderTarget===this&&this._engine.unBindFramebuffer(this,!0),this.isMulti?this._engine.generateMipMapsMultiFramebuffer(this):this._engine.generateMipMapsFramebuffer(this)}constructor(G,V,W,J,R){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this.disableAutomaticMSAAResolve=!1,this.resolveMSAAColors=!0,this.resolveMSAADepth=!1,this.resolveMSAAStencil=!1,this._isMulti=G,this._isCube=V,this._size=W,this._engine=J,this._depthStencilTexture=null,this.label=R}setTextures(G){Array.isArray(G)?this._textures=G:this._textures=G?[G]:null}setTexture(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._textures||(this._textures=[]),this._textures[V]!==G&&(this._textures[V]&&W&&this._textures[V].dispose(),this._textures[V]=G)}setLayerAndFaceIndices(G,V){this._layerIndices=G,this._faceIndices=V}setLayerAndFaceIndex(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1?arguments[1]:void 0,W=arguments.length>2?arguments[2]:void 0;this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),void 0!==V&&V>=0&&(this._layerIndices[G]=V),void 0!==W&&W>=0&&(this._faceIndices[G]=W)}createDepthStencilTexture(){var G;let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,W=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],J=arguments.length>2&&void 0!==arguments[2]&&arguments[2],R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,k=arguments.length>5?arguments[5]:void 0;return null===(G=this._depthStencilTexture)||void 0===G||G.dispose(),this._depthStencilTextureWithStencil=J,this._depthStencilTextureLabel=k,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:W,comparisonFunction:V,generateStencil:J,isCube:this._isCube,samples:R,depthTextureFormat:d,label:k},this),this._depthStencilTexture}_shareDepth(G){this.shareDepth(G)}shareDepth(G){this._depthStencilTexture&&(G._depthStencilTexture&&G._depthStencilTexture.dispose(),G._depthStencilTexture=this._depthStencilTexture,G._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}_swapAndDie(G){this.texture&&this.texture._swapAndDie(G),this._textures=null,this.dispose(!0)}_cloneRenderTargetWrapper(){let G=null;if(this._isMulti){const V=this.textures;if(V&&V.length>0){let W=!1,J=V.length,R=-1;const d=V[V.length-1]._source;14!==d&&12!==d||(W=!0,R=V[V.length-1].format,J--);const k=[],z=[],X=[],P=[],A=[],x=[],q=[],L={};for(let G=0;G<J;++G){const W=V[G];k.push(W.samplingMode),z.push(W.type),X.push(W.format);void 0!==L[W.uniqueId]?(P.push(-1),q.push(0)):(L[W.uniqueId]=G,W.is2DArray?(P.push(35866),q.push(W.depth)):W.isCube?(P.push(34067),q.push(0)):W.is3D?(P.push(32879),q.push(W.depth)):(P.push(3553),q.push(0))),this._faceIndices&&A.push(this._faceIndices[G]??0),this._layerIndices&&x.push(this._layerIndices[G]??0)}const t={samplingModes:k,generateMipMaps:V[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:W,depthTextureFormat:R,types:z,formats:X,textureCount:J,targetTypes:P,faceIndex:A,layerIndex:x,layerCounts:q,label:this.label},Y={width:this.width,height:this.height,depth:this.depth};G=this._engine.createMultipleRenderTarget(Y,t);for(let g=0;g<J;++g){if(-1!==P[g])continue;const W=L[V[g].uniqueId];G.setTexture(G.textures[W],g)}}}else{var V,W,J,R;const k={};if(k.generateDepthBuffer=this._generateDepthBuffer,k.generateMipMaps=(null===(V=this.texture)||void 0===V?void 0:V.generateMipMaps)??!1,k.generateStencilBuffer=this._generateStencilBuffer,k.samplingMode=null===(W=this.texture)||void 0===W?void 0:W.samplingMode,k.type=null===(J=this.texture)||void 0===J?void 0:J.type,k.format=null===(R=this.texture)||void 0===R?void 0:R.format,k.noColorAttachment=!this._textures,k.label=this.label,this.isCube)G=this._engine.createRenderTargetCubeTexture(this.width,k);else{var d;const V={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?null===(d=this.texture)||void 0===d?void 0:d.depth:void 0};G=this._engine.createRenderTargetTexture(V,k)}G.texture&&(G.texture.isReady=!0)}return G}_swapRenderTargetWrapper(G){if(this._textures&&G._textures)for(let V=0;V<this._textures.length;++V)this._textures[V]._swapAndDie(G._textures[V],!1),G._textures[V].isReady=!0;this._depthStencilTexture&&G._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(G._depthStencilTexture),G._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}_rebuild(){const G=this._cloneRenderTargetWrapper();if(G){if(this._depthStencilTexture){const V=this._depthStencilTexture.samplingMode,W=this._depthStencilTexture.format,J=2===V||3===V||11===V;G.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,J,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,W,this._depthStencilTextureLabel)}this.samples>1&&G.setSamples(this.samples),G._swapRenderTargetWrapper(this),G.dispose()}}releaseTextures(){if(this._textures)for(let G=0;G<this._textures.length;++G)this._textures[G].dispose();this._textures=null}dispose(){var G;arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(null===(G=this._depthStencilTexture)||void 0===G||G.dispose(),this._depthStencilTexture=null,this.releaseTextures());this._engine._releaseRenderTargetWrapper(this)}}},11270:(G,V,W)=>{W.d(V,{d:()=>J});class J{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?J.ShadersRepository:J.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?J.ShadersStore:J.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?J.IncludesShadersStore:J.IncludesShadersStoreWGSL}}J.ShadersRepository="src/Shaders/",J.ShadersStore={},J.IncludesShadersStore={},J.ShadersRepositoryWGSL="src/ShadersWGSL/",J.ShadersStoreWGSL={},J.IncludesShadersStoreWGSL={}},11279:(G,V,W)=>{W.d(V,{d:()=>q,h:()=>p,l:()=>t,m:()=>L,o:()=>Y,r:()=>S,u:()=>x,y:()=>P,B:()=>A,E:()=>X,F:()=>z});class J{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.Ik._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(G){G&&this.program&&G(this.program)}setEngine(G){this.Ik=G}_fillEffectInformation(G,V,W,J,R,d,k,z){const X=this.Ik;if(X.supportsUniformBuffers)for(const A in V)G.bindUniformBlock(A,V[A]);let P;for(this.Ik.getUniforms(this,W).forEach(((G,V)=>{J[W[V]]=G})),this._uniforms=J,P=0;P<R.length;P++){null==G.getUniform(R[P])&&(R.splice(P,1),P--)}R.forEach(((G,V)=>{d[G]=V}));for(const A of X.getAttributes(this,k))z.push(A)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(G,V){const W=this._valueCache[G],J=V.updateFlag;return(void 0===W||W!==J)&&(this._valueCache[G]=J,!0)}_cacheFloat2(G,V,W){let J=this._valueCache[G];if(!J||2!==J.length)return J=[V,W],this._valueCache[G]=J,!0;let R=!1;return J[0]!==V&&(J[0]=V,R=!0),J[1]!==W&&(J[1]=W,R=!0),R}_cacheFloat3(G,V,W,J){let R=this._valueCache[G];if(!R||3!==R.length)return R=[V,W,J],this._valueCache[G]=R,!0;let d=!1;return R[0]!==V&&(R[0]=V,d=!0),R[1]!==W&&(R[1]=W,d=!0),R[2]!==J&&(R[2]=J,d=!0),d}_cacheFloat4(G,V,W,J,R){let d=this._valueCache[G];if(!d||4!==d.length)return d=[V,W,J,R],this._valueCache[G]=d,!0;let k=!1;return d[0]!==V&&(d[0]=V,k=!0),d[1]!==W&&(d[1]=W,k=!0),d[2]!==J&&(d[2]=J,k=!0),d[3]!==R&&(d[3]=R,k=!0),k}setInt(G,V){const W=this._valueCache[G];void 0!==W&&W===V||this.Ik.setInt(this._uniforms[G],V)&&(this._valueCache[G]=V)}setInt2(G,V,W){this._cacheFloat2(G,V,W)&&(this.Ik.setInt2(this._uniforms[G],V,W)||(this._valueCache[G]=null))}setInt3(G,V,W,J){this._cacheFloat3(G,V,W,J)&&(this.Ik.setInt3(this._uniforms[G],V,W,J)||(this._valueCache[G]=null))}setInt4(G,V,W,J,R){this._cacheFloat4(G,V,W,J,R)&&(this.Ik.setInt4(this._uniforms[G],V,W,J,R)||(this._valueCache[G]=null))}setIntArray(G,V){this._valueCache[G]=null,this.Ik.setIntArray(this._uniforms[G],V)}setIntArray2(G,V){this._valueCache[G]=null,this.Ik.setIntArray2(this._uniforms[G],V)}setIntArray3(G,V){this._valueCache[G]=null,this.Ik.setIntArray3(this._uniforms[G],V)}setIntArray4(G,V){this._valueCache[G]=null,this.Ik.setIntArray4(this._uniforms[G],V)}setUInt(G,V){const W=this._valueCache[G];void 0!==W&&W===V||this.Ik.setUInt(this._uniforms[G],V)&&(this._valueCache[G]=V)}setUInt2(G,V,W){this._cacheFloat2(G,V,W)&&(this.Ik.setUInt2(this._uniforms[G],V,W)||(this._valueCache[G]=null))}setUInt3(G,V,W,J){this._cacheFloat3(G,V,W,J)&&(this.Ik.setUInt3(this._uniforms[G],V,W,J)||(this._valueCache[G]=null))}setUInt4(G,V,W,J,R){this._cacheFloat4(G,V,W,J,R)&&(this.Ik.setUInt4(this._uniforms[G],V,W,J,R)||(this._valueCache[G]=null))}setUIntArray(G,V){this._valueCache[G]=null,this.Ik.setUIntArray(this._uniforms[G],V)}setUIntArray2(G,V){this._valueCache[G]=null,this.Ik.setUIntArray2(this._uniforms[G],V)}setUIntArray3(G,V){this._valueCache[G]=null,this.Ik.setUIntArray3(this._uniforms[G],V)}setUIntArray4(G,V){this._valueCache[G]=null,this.Ik.setUIntArray4(this._uniforms[G],V)}setArray(G,V){this._valueCache[G]=null,this.Ik.setArray(this._uniforms[G],V)}setArray2(G,V){this._valueCache[G]=null,this.Ik.setArray2(this._uniforms[G],V)}setArray3(G,V){this._valueCache[G]=null,this.Ik.setArray3(this._uniforms[G],V)}setArray4(G,V){this._valueCache[G]=null,this.Ik.setArray4(this._uniforms[G],V)}setMatrices(G,V){V&&(this._valueCache[G]=null,this.Ik.setMatrices(this._uniforms[G],V))}setMatrix(G,V){this._cacheMatrix(G,V)&&(this.Ik.setMatrices(this._uniforms[G],V.Bd())||(this._valueCache[G]=null))}setMatrix3x3(G,V){this._valueCache[G]=null,this.Ik.setMatrix3x3(this._uniforms[G],V)}setMatrix2x2(G,V){this._valueCache[G]=null,this.Ik.setMatrix2x2(this._uniforms[G],V)}setFloat(G,V){const W=this._valueCache[G];void 0!==W&&W===V||this.Ik.setFloat(this._uniforms[G],V)&&(this._valueCache[G]=V)}setVector2(G,V){this._cacheFloat2(G,V.x,V.y)&&(this.Ik.setFloat2(this._uniforms[G],V.x,V.y)||(this._valueCache[G]=null))}setFloat2(G,V,W){this._cacheFloat2(G,V,W)&&(this.Ik.setFloat2(this._uniforms[G],V,W)||(this._valueCache[G]=null))}setVector3(G,V){this._cacheFloat3(G,V.x,V.y,V.z)&&(this.Ik.setFloat3(this._uniforms[G],V.x,V.y,V.z)||(this._valueCache[G]=null))}setFloat3(G,V,W,J){this._cacheFloat3(G,V,W,J)&&(this.Ik.setFloat3(this._uniforms[G],V,W,J)||(this._valueCache[G]=null))}setVector4(G,V){this._cacheFloat4(G,V.x,V.y,V.z,V.w)&&(this.Ik.setFloat4(this._uniforms[G],V.x,V.y,V.z,V.w)||(this._valueCache[G]=null))}setQuaternion(G,V){this._cacheFloat4(G,V.x,V.y,V.z,V.w)&&(this.Ik.setFloat4(this._uniforms[G],V.x,V.y,V.z,V.w)||(this._valueCache[G]=null))}setFloat4(G,V,W,J,R){this._cacheFloat4(G,V,W,J,R)&&(this.Ik.setFloat4(this._uniforms[G],V,W,J,R)||(this._valueCache[G]=null))}setColor3(G,V){this._cacheFloat3(G,V.r,V.g,V.b)&&(this.Ik.setFloat3(this._uniforms[G],V.r,V.g,V.b)||(this._valueCache[G]=null))}setColor4(G,V,W){this._cacheFloat4(G,V.r,V.g,V.b,W)&&(this.Ik.setFloat4(this._uniforms[G],V.r,V.g,V.b,W)||(this._valueCache[G]=null))}setDirectColor4(G,V){this._cacheFloat4(G,V.r,V.g,V.b,V.a)&&(this.Ik.setFloat4(this._uniforms[G],V.r,V.g,V.b,V.a)||(this._valueCache[G]=null))}_getVertexShaderCode(){return this.vertexShader?this.Ik._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.Ik._getShaderSource(this.fragmentShader):null}}var R=W(11250);const d=new WeakMap,k={_webGLVersion:2,cachedPipelines:{}};function z(G){let V=d.get(G);if(!V){if(!G)return k;V={_webGLVersion:G.TEXTURE_BINDING_3D?2:1,_context:G,parallelShaderCompile:G.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},d.set(G,V)}return V}function X(G){d.delete(G)}function P(G,V,W,J,R,d){const k=z(J);d||(d=k._createShaderProgramInjection??q);return d(G,B(V,"vertex",J,k._contextWasLost),B(W,"fragment",J,k._contextWasLost),J,R,k.validateShaderPrograms)}function A(G,V,W,J,R){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,k=arguments.length>6?arguments[6]:void 0;const X=z(R);k||(k=X._createShaderProgramInjection??q);const P=X._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return k(G,g(V,"vertex",J,P,R,X._contextWasLost),g(W,"fragment",J,P,R,X._contextWasLost),R,d,X.validateShaderPrograms)}function x(G,V){const W=new J,R=z(G);return R.parallelShaderCompile&&!R.disableParallelShaderCompile&&(W.isParallelCompiled=!0),W.context=R._context,W}function q(G,V,W,J){let R=arguments.length>5?arguments[5]:void 0;const d=J.createProgram();if(G.program=d,!d)throw new Error("Unable to create program");return J.attachShader(d,V),J.attachShader(d,W),J.linkProgram(d),G.context=J,G.vertexShader=V,G.fragmentShader=W,G.isParallelCompiled||t(G,J,R),d}function L(G,V,W){const J=G;if(J._isDisposed)return!1;const R=z(V);return!!(R&&R.parallelShaderCompile&&R.parallelShaderCompile.COMPLETION_STATUS_KHR&&J.program&&V.getProgramParameter(J.program,R.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(t(J,V,W),!0)}function t(G,V,W){const J=G.context,R=G.vertexShader,d=G.fragmentShader,k=G.program;if(!J.getProgramParameter(k,J.LINK_STATUS)){if(!V.getShaderParameter(R,V.COMPILE_STATUS)){const W=V.getShaderInfoLog(R);if(W)throw G.vertexCompilationError=W,new Error("VERTEX SHADER "+W)}if(!V.getShaderParameter(d,V.COMPILE_STATUS)){const W=V.getShaderInfoLog(d);if(W)throw G.fragmentCompilationError=W,new Error("FRAGMENT SHADER "+W)}const W=J.getProgramInfoLog(k);if(W)throw G.programLinkError=W,new Error(W)}if(W){J.validateProgram(k);if(!J.getProgramParameter(k,J.VALIDATE_STATUS)){const V=J.getProgramInfoLog(k);if(V)throw G.programValidationError=V,new Error(V)}}J.deleteShader(R),J.deleteShader(d),G.vertexShader=void 0,G.fragmentShader=void 0,G.onCompiled&&(G.onCompiled(),G.onCompiled=void 0)}function Y(G,V,W,J,R,d,k,X,x){let q=arguments.length>10?arguments[10]:void 0,L=arguments.length>11?arguments[11]:void 0,t=arguments.length>12?arguments[12]:void 0;const Y=z(G.context);L||(L=Y.createRawShaderProgramInjection??P),t||(t=Y.createShaderProgramInjection??A);const g=G;g.program=J?L(g,V,W,g.context,x):t(g,V,W,X,g.context,x),g.program.__SPECTOR_rebuildProgram=k,q()}function g(G,V,W,J,d,k){return B((0,R.f)(G,W,J),V,d,k)}function B(G,V,W,J){const R=W.createShader("vertex"===V?W.VERTEX_SHADER:W.FRAGMENT_SHADER);if(!R){let G=W.NO_ERROR,R=W.NO_ERROR;for(;(R=W.getError())!==W.NO_ERROR;)G=R;throw new Error(`Something went wrong while creating a gl ${V} shader object. gl error=${G}, gl isContextLost=${W.isContextLost()}, _contextWasLost=${J}`)}return W.shaderSource(R,G),W.compileShader(R),R}function S(G,V){V.useProgram(G)}function p(G,V){const W=G;if(!W.isParallelCompiled)return void V(G);const J=W.onCompiled;W.onCompiled=()=>{null===J||void 0===J||J(),V(G)}}},11568:(G,V,W)=>{W.r(V),W.d(V,{ThinEngine:()=>b});var J=W(11279),R=W(11570),d=W(11201),k=W(11196);class z{constructor(){this.shaderLanguage=0}postProcessor(G,V,W,J,R){if(R.drawBuffersExtensionDisabled){const V=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;G=G.replace(V,"")}return G}}const X=/(flat\s)?\s*varying\s*.*/;class P{constructor(){this.shaderLanguage=0}attributeProcessor(G){return G.replace("attribute","in")}varyingCheck(G,V){return X.test(G)}varyingProcessor(G,V){return G.replace("varying",V?"in":"out")}postProcessor(G,V,W){const J=-1!==G.search(/#extension.+GL_EXT_draw_buffers.+require/);if(G=(G=G.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),W){const V=-1!==G.search(/layout *\(location *= *0\) *out/g);G=(G=(G=(G=(G=(G=(G=G.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(J||V?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==V.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+G}return G}}var A=W(11574),x=W(11307),q=W(11262),L=W(11580),t=W(11285),Y=W(11268),g=W(11250),B=W(11274),S=W(11588);class p{}class b extends q.b{get name(){return this._name}set name(G){this._name=G}get version(){return this._webGLVersion}static get ShadersRepository(){return Y.b.ShadersRepository}static set ShadersRepository(G){Y.b.ShadersRepository=G}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(G){this._framebufferDimensionsObject=G}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(G,V,W,R){if(W=W||{},super(V??W.antialias,W,R),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!G)return;let k=null;if(G.getContext){if(k=G,void 0===W.TP&&(W.TP=!1),void 0===W.xrCompatible&&(W.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const G=navigator.userAgent;for(const V of b.ExceptionList){const J=V.key,R=V.targets;if(new RegExp(J).test(G)){if(V.capture&&V.captureConstraint){const W=V.capture,J=V.captureConstraint,R=new RegExp(W).exec(G);if(R&&R.length>0){if(parseInt(R[R.length-1])>=J)continue}}for(const G of R)switch(G){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":W.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost?this._onContextLost=()=>{(0,J.E)(this._gl)}:(this._onContextLost=G=>{G.preventDefault(),this._contextWasLost=!0,(0,J.E)(this._gl),d.c.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},k.addEventListener("webglcontextrestored",this._onContextRestored,!1),W.powerPreference=W.powerPreference||"high-performance"),k.addEventListener("webglcontextlost",this._onContextLost,!1),this._badDesktopOS&&(W.xrCompatible=!1),!W.disableWebGL2Support)try{this._gl=k.getContext("webgl2",W)||k.getContext("experimental-webgl2",W),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(x){}if(!this._gl){if(!k)throw new Error("The provided canvas is null or undefined.");try{this._gl=k.getContext("webgl",W)||k.getContext("experimental-webgl",W)}catch(x){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=G,k=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const V=this._gl.getContextAttributes();V&&(W.stencil=V.stencil)}this._sharedInit(k),this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==W.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=W.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let J=0;J<this._caps.maxVertexAttribs;J++)this._currentBufferPointers[J]=new p;this._shaderProcessor=this.webGLVersion>1?new P:new z;const X=`Babylon.js v${b.Version}`;d.c.Log(X+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",X);const A=(0,J.F)(this._gl);A.validateShaderPrograms=this.validateShaderPrograms,A.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(G){return null}areAllEffectsReady(){for(const G in this._compiledEffects){if(!this._compiledEffects[G].isReady())return!1}return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1,textureNorm16:!!this._gl.getExtension("EXT_texture_norm16")},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const G=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=G&&(this._glRenderer=this._gl.getParameter(G.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(G.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.textureNorm16&&(this._gl.R16_EXT=33322,this._gl.RG16_EXT=33324,this._gl.RGB16_EXT=32852,this._gl.RGBA16_EXT=32859,this._gl.R16_SNORM_EXT=36760,this._gl.RG16_SNORM_EXT=36761,this._gl.RGB16_SNORM_EXT=36762,this._gl.RGBA16_SNORM_EXT=36763),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{const G=this._gl.getExtension("WEBGL_draw_buffers");if(null!==G){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=G.drawBuffersWEBGL.bind(G),this._caps.maxDrawBuffers=this._gl.getParameter(G.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let V=0;V<16;V++)this._gl["COLOR_ATTACHMENT"+V+"_WEBGL"]=G["COLOR_ATTACHMENT"+V+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const G=this._gl.getExtension("WEBGL_depth_texture");null!=G&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=G.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const G=this._gl.getExtension("OES_vertex_array_object");null!=G&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=G.createVertexArrayOES.bind(G),this._gl.bindVertexArray=G.bindVertexArrayOES.bind(G),this._gl.deleteVertexArray=G.deleteVertexArrayOES.bind(G))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const G=this._gl.getExtension("ANGLE_instanced_arrays");null!=G?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=G.drawArraysInstancedANGLE.bind(G),this._gl.drawElementsInstanced=G.drawElementsInstancedANGLE.bind(G),this._gl.vertexAttribDivisor=G.vertexAttribDivisorANGLE.bind(G)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const G=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),V=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);G&&V&&(this._caps.highPrecisionShaderSupported=0!==G.precision&&0!==V.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const G=this._gl.getExtension("EXT_blend_minmax");null!=G&&(this._caps.blendMinMax=!0,this._gl.MAX=G.MAX_EXT,this._gl.MIN=G.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const G=this._gl.getExtension("EXT_sRGB");null!=G&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:G.SRGB_EXT,SRGB8:G.SRGB_ALPHA_EXT,SRGB8_ALPHA8:G.SRGB_ALPHA_EXT})}if(this._creationOptions){const G=this._creationOptions.forceSRGBBufferSupportState;void 0!==G&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&G)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let V=0;V<this._maxSimultaneousTextures;V++)this._nextFreeTextureSlots.push(V);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"===typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const G=this._workingCanvas.getContext("2d");G&&(this._workingContext=G)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const G=this.getGlInfo();return G&&G.renderer?G.renderer:""}getRenderWidth(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const R=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=R;let d=0;if(V&&G){let V=!0;if(this._currentRenderTarget){var k;const W=null===(k=this._currentRenderTarget.texture)||void 0===k?void 0:k.format;if(8===W||9===W||10===W||11===W){var z;const W=null===(z=this._currentRenderTarget.texture)||void 0===z?void 0:z.type;7===W||5===W?(b._TempClearColorUint32[0]=255*G.r,b._TempClearColorUint32[1]=255*G.g,b._TempClearColorUint32[2]=255*G.b,b._TempClearColorUint32[3]=255*G.a,this._gl.clearBufferuiv(this._gl.COLOR,0,b._TempClearColorUint32),V=!1):(b._TempClearColorInt32[0]=255*G.r,b._TempClearColorInt32[1]=255*G.g,b._TempClearColorInt32[2]=255*G.b,b._TempClearColorInt32[3]=255*G.a,this._gl.clearBufferiv(this._gl.COLOR,0,b._TempClearColorInt32),V=!1)}}V&&(this._gl.clearColor(G.r,G.g,G.b,void 0!==G.a?G.a:1),d|=this._gl.COLOR_BUFFER_BIT)}W&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),d|=this._gl.DEPTH_BUFFER_BIT),J&&(this._gl.clearStencil(0),d|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(d)}_viewport(G,V,W,J){G===this._viewportCached.x&&V===this._viewportCached.y&&W===this._viewportCached.z&&J===this._viewportCached.w||(this._viewportCached.x=G,this._viewportCached.y=V,this._viewportCached.z=W,this._viewportCached.w=J,this._gl.viewport(G,V,W,J))}yx(){super.yx(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0,J=arguments.length>3?arguments[3]:void 0,R=arguments.length>4?arguments[4]:void 0,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const X=G;this._currentRenderTarget&&this._resolveAndGenerateMipMapsFramebuffer(this._currentRenderTarget),this._currentRenderTarget=G,this._bindUnboundFramebuffer(X._framebuffer);const P=this._gl;var A;if(!G.isMulti)if(G.is2DArray||G.is3D)P.framebufferTextureLayer(P.FRAMEBUFFER,P.COLOR_ATTACHMENT0,null===(A=G.texture._hardwareTexture)||void 0===A?void 0:A.underlyingResource,k,z),X._currentLOD=k;else if(G.isCube){var x;P.framebufferTexture2D(P.FRAMEBUFFER,P.COLOR_ATTACHMENT0,P.TEXTURE_CUBE_MAP_POSITIVE_X+V,null===(x=G.texture._hardwareTexture)||void 0===x?void 0:x.underlyingResource,k)}else if(X._currentLOD!==k){var q;P.framebufferTexture2D(P.FRAMEBUFFER,P.COLOR_ATTACHMENT0,P.TEXTURE_2D,null===(q=G.texture._hardwareTexture)||void 0===q?void 0:q.underlyingResource,k),X._currentLOD=k}const L=G._depthStencilTexture;if(L){G.is3D&&(G.texture.width===L.width&&G.texture.height===L.height&&G.texture.depth===L.depth||d.c.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const W=G._depthStencilTextureWithStencil?P.DEPTH_STENCIL_ATTACHMENT:P.DEPTH_ATTACHMENT;var t;if(G.is2DArray||G.is3D)P.framebufferTextureLayer(P.FRAMEBUFFER,W,null===(t=L._hardwareTexture)||void 0===t?void 0:t.underlyingResource,k,z);else if(G.isCube){var Y;P.framebufferTexture2D(P.FRAMEBUFFER,W,P.TEXTURE_CUBE_MAP_POSITIVE_X+V,null===(Y=L._hardwareTexture)||void 0===Y?void 0:Y.underlyingResource,k)}else{var g;P.framebufferTexture2D(P.FRAMEBUFFER,W,P.TEXTURE_2D,null===(g=L._hardwareTexture)||void 0===g?void 0:g.underlyingResource,k)}}X._MSAAFramebuffer&&this._bindUnboundFramebuffer(X._MSAAFramebuffer),this._cachedViewport&&!R?this.setViewport(this._cachedViewport,W,J):(W||(W=G.width,k&&(W/=Math.pow(2,k))),J||(J=G.height,k&&(J/=Math.pow(2,k))),this._viewport(0,0,W,J)),this.wipeCaches()}setStateCullFaceType(G,V){const W=this.cullBackFaces??G??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==W||V)&&(this._depthCullingState.cullFace=W)}setState(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0,J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],R=arguments.length>4?arguments[4]:void 0,d=arguments.length>5?arguments[5]:void 0,k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(this._depthCullingState.cull!==G||W)&&(this._depthCullingState.cull=G),this.setStateCullFaceType(R,W),this.setZOffset(V),this.setZOffsetUnits(k);const z=J?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==z||W)&&(this._depthCullingState.frontFace=z),this._stencilStateComposer.stencilMaterial=d}_resolveAndGenerateMipMapsFramebuffer(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];G.disableAutomaticMSAAResolve||(G.isMulti?this.resolveMultiFramebuffer(G):this.resolveFramebuffer(G)),V||(G.isMulti?this.generateMipMapsMultiFramebuffer(G):this.generateMipMapsFramebuffer(G))}_bindUnboundFramebuffer(G){this._currentFramebuffer!==G&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,G),this._currentFramebuffer=G)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(G){const V=this._getTextureTarget(G);this._bindTextureDirectly(V,G,!0),this._gl.generateMipmap(V),this._bindTextureDirectly(V,null)}unBindFramebuffer(G,V,W){const J=G;this._currentRenderTarget=null,this._resolveAndGenerateMipMapsFramebuffer(G,V),W&&(J._MSAAFramebuffer&&this._bindUnboundFramebuffer(J._framebuffer),W()),this._bindUnboundFramebuffer(null)}generateMipMapsFramebuffer(G){var V;G.isMulti||null===(V=G.texture)||void 0===V||!V.generateMipMaps||G.isCube||this.generateMipmaps(G.texture)}resolveFramebuffer(G){const V=G,W=this._gl;if(!V._MSAAFramebuffer||V.isMulti)return;let J=V.resolveMSAAColors?W.COLOR_BUFFER_BIT:0;J|=V._generateDepthBuffer&&V.resolveMSAADepth?W.DEPTH_BUFFER_BIT:0,J|=V._generateStencilBuffer&&V.resolveMSAAStencil?W.STENCIL_BUFFER_BIT:0,W.bindFramebuffer(W.READ_FRAMEBUFFER,V._MSAAFramebuffer),W.bindFramebuffer(W.DRAW_FRAMEBUFFER,V._framebuffer),W.blitFramebuffer(0,0,G.width,G.height,0,0,G.width,G.height,J,W.NEAREST)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(G,V,W){return this._createVertexBuffer(G,this._gl.STATIC_DRAW)}_createVertexBuffer(G,V){const W=this._gl.createBuffer();if(!W)throw new Error("Unable to create vertex buffer");const J=new A.b(W);return this.bindArrayBuffer(J),"number"!==typeof G?G instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(G),V),J.DV=4*G.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,G,V),J.DV=G.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(G),V),J.DV=G),this._resetVertexBufferBinding(),J.references=1,J}createDynamicVertexBuffer(G,V){return this._createVertexBuffer(G,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(G,V,W){const J=this._gl.createBuffer(),R=new A.b(J);if(!J)throw new Error("Unable to create index buffer");this.bindIndexBuffer(R);const d=this._normalizeIndexData(G);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,d,V?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),R.references=1,R.is32Bits=4===d.BYTES_PER_ELEMENT,R}_normalizeIndexData(G){if(2===G.BYTES_PER_ELEMENT)return G;if(this._caps.uintIndices){if(G instanceof Uint32Array)return G;for(let V=0;V<G.length;V++)if(G[V]>=65535)return new Uint32Array(G);return new Uint16Array(G)}return new Uint16Array(G)}bindArrayBuffer(G){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(G,this._gl.ARRAY_BUFFER)}bindUniformBlock(G,V,W){const J=G.program,R=this._gl.getUniformBlockIndex(J,V);this._gl.uniformBlockBinding(J,R,W)}bindIndexBuffer(G){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(G,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(G,V){(this._vaoRecordInProgress||this._currentBoundBuffer[V]!==G)&&(this._gl.bindBuffer(V,G?G.underlyingResource:null),this._currentBoundBuffer[V]=G)}updateArrayBuffer(G){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,G)}_vertexAttribPointer(G,V,W,J,R,d,k){const z=this._currentBufferPointers[V];if(!z)return;let X=!1;z.active?(z.buffer!==G&&(z.buffer=G,X=!0),z.size!==W&&(z.size=W,X=!0),z.type!==J&&(z.type=J,X=!0),z.normalized!==R&&(z.normalized=R,X=!0),z.stride!==d&&(z.stride=d,X=!0),z.offset!==k&&(z.offset=k,X=!0)):(X=!0,z.active=!0,z.index=V,z.size=W,z.type=J,z.normalized=R,z.stride=d,z.offset=k,z.buffer=G),(X||this._vaoRecordInProgress)&&(this.bindArrayBuffer(G),J===this._gl.UNSIGNED_INT||J===this._gl.INT?this._gl.vertexAttribIPointer(V,W,J,d,k):this._gl.vertexAttribPointer(V,W,J,R,d,k))}_bindIndexBufferWithCache(G){null!=G&&this._cachedIndexBuffer!==G&&(this._cachedIndexBuffer=G,this.bindIndexBuffer(G),this._uintIndicesCurrentlySet=G.is32Bits)}_bindVertexBuffersAttributes(G,V,W){const J=V.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let R=0;R<J.length;R++){const d=V.getAttributeLocation(R);if(d>=0){const V=J[R];let k=null;if(W&&(k=W[V]),k||(k=G[V]),!k)continue;this._gl.enableVertexAttribArray(d),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[d]=!0);const z=k.getBuffer();z&&(this._vertexAttribPointer(z,d,k.getSize(),k.type,k.normalized,k.byteStride,k.byteOffset),k.getIsInstanced()&&(this._gl.vertexAttribDivisor(d,k.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(d),this._currentInstanceBuffers.push(z))))}}}recordVertexArrayObject(G,V,W,J){const R=this._gl.createVertexArray();if(!R)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(R),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(G,W,J),this.bindIndexBuffer(V),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),R}bindVertexArrayObject(G,V){this._cachedVertexArrayObject!==G&&(this._cachedVertexArrayObject=G,this._gl.bindVertexArray(G),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=V&&V.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(G,V,W,J,R){if(this._cachedVertexBuffers!==G||this._cachedEffectForVertexBuffers!==R){this._cachedVertexBuffers=G,this._cachedEffectForVertexBuffers=R;const V=R.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let d=0;for(let k=0;k<V;k++)if(k<W.length){const V=R.getAttributeLocation(k);V>=0&&(this._gl.enableVertexAttribArray(V),this._vertexAttribArraysEnabled[V]=!0,this._vertexAttribPointer(G,V,W[k],this._gl.FLOAT,!1,J,d)),d+=4*W[k]}}this._bindIndexBufferWithCache(V)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(G,V,W,J){this._cachedVertexBuffers===G&&this._cachedEffectForVertexBuffers===W||(this._cachedVertexBuffers=G,this._cachedEffectForVertexBuffers=W,this._bindVertexBuffersAttributes(G,W,J)),this._bindIndexBufferWithCache(V)}unbindInstanceAttributes(){let G;for(let V=0,W=this._currentInstanceLocations.length;V<W;V++){const W=this._currentInstanceBuffers[V];G!=W&&W.references&&(G=W,this.bindArrayBuffer(W));const J=this._currentInstanceLocations[V];this._gl.vertexAttribDivisor(J,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(G){this._gl.deleteVertexArray(G)}_releaseBuffer(G){return G.references--,0===G.references&&(this._deleteBuffer(G),!0)}_deleteBuffer(G){this._gl.deleteBuffer(G.underlyingResource)}updateAndBindInstancesBuffer(G,V,W){if(this.bindArrayBuffer(G),V&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,V),void 0!==W[0].index)this.bindInstancesBuffer(G,W,!0);else for(let J=0;J<4;J++){const V=W[J];this._vertexAttribArraysEnabled[V]||(this._gl.enableVertexAttribArray(V),this._vertexAttribArraysEnabled[V]=!0),this._vertexAttribPointer(G,V,4,this._gl.FLOAT,!1,64,16*J),this._gl.vertexAttribDivisor(V,1),this._currentInstanceLocations.push(V),this._currentInstanceBuffers.push(G)}}bindInstancesBuffer(G,V){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.bindArrayBuffer(G);let J=0;if(W)for(let R=0;R<V.length;R++){J+=4*V[R].attributeSize}for(let R=0;R<V.length;R++){const W=V[R];void 0===W.index&&(W.index=this._currentEffect.getAttributeLocationByName(W.attributeName)),W.index<0||(this._vertexAttribArraysEnabled[W.index]||(this._gl.enableVertexAttribArray(W.index),this._vertexAttribArraysEnabled[W.index]=!0),this._vertexAttribPointer(G,W.index,W.attributeSize,W.attributeType||this._gl.FLOAT,W.normalized||!1,J,W.offset),this._gl.vertexAttribDivisor(W.index,void 0===W.divisor?1:W.divisor),this._currentInstanceLocations.push(W.index),this._currentInstanceBuffers.push(G))}}disableInstanceAttributeByName(G){if(!this._currentEffect)return;const V=this._currentEffect.getAttributeLocationByName(G);this.disableInstanceAttribute(V)}disableInstanceAttribute(G){let V,W=!1;for(;-1!==(V=this._currentInstanceLocations.indexOf(G));)this._currentInstanceLocations.splice(V,1),this._currentInstanceBuffers.splice(V,1),W=!0,V=this._currentInstanceLocations.indexOf(G);W&&(this._gl.vertexAttribDivisor(G,0),this.disableAttributeByIndex(G))}disableAttributeByIndex(G){this._gl.disableVertexAttribArray(G),this._vertexAttribArraysEnabled[G]=!1,this._currentBufferPointers[G].active=!1}draw(G,V,W,J){this.drawElementsType(G?0:1,V,W,J)}drawPointClouds(G,V,W){this.drawArraysType(2,G,V,W)}drawUnIndexed(G,V,W,J){this.drawArraysType(G?0:1,V,W,J)}drawElementsType(G,V,W,J){this.applyStates(),this._reportDrawCall();const R=this._drawMode(G),d=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,k=this._uintIndicesCurrentlySet?4:2;J?this._gl.drawElementsInstanced(R,W,d,V*k,J):this._gl.drawElements(R,W,d,V*k)}drawArraysType(G,V,W,J){this.applyStates(),this._reportDrawCall();const R=this._drawMode(G);J?this._gl.drawArraysInstanced(R,V,W,J):this._gl.drawArrays(R,V,W)}_drawMode(G){switch(G){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(G){this._compiledEffects[G._key]&&delete this._compiledEffects[G._key];const V=G.getPipelineContext();V&&this._deletePipelineContext(V)}_deletePipelineContext(G){const V=G;V&&V.program&&(V.program.__SPECTOR_rebuildProgram=null,(0,B.i)(V),this._gl&&(this._currentProgram===V.program&&this._setProgram(null),this._gl.deleteProgram(V.program)))}_getGlobalDefines(G){return(0,g.i)(G,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(G,V,W,R,d,k,z,X,P){let A=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,x=arguments.length>10?arguments[10]:void 0;const q="string"===typeof G?G:G.vertexToken||G.vertexSource||G.vertexElement||G.vertex,L="string"===typeof G?G:G.fragmentToken||G.fragmentSource||G.fragmentElement||G.fragment,t=this._getGlobalDefines(),g=void 0!==V.attributes;let B=d??V.defines??"";t&&(B+=t);const S=q+"+"+L+"@"+B;if(this._compiledEffects[S]){const G=this._compiledEffects[S];return z&&G.isReady()&&z(G),G._refCount++,G}this._gl&&(0,J.F)(this._gl);const p=new Y.b(G,V,g?this:W,R,this,d,k,z,X,P,S,V.shaderLanguage??A,V.extraInitializationsAsync??x);return this._compiledEffects[S]=p,p}_getShaderSource(G){return this._gl.getShaderSource(G)}createRawShaderProgram(G,V,W,R){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const k=(0,J.F)(this._gl);return k._contextWasLost=this._contextWasLost,k.validateShaderPrograms=this.validateShaderPrograms,(0,J.y)(G,V,W,R||this._gl,d)}createShaderProgram(G,V,W,R,d){let k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const z=(0,J.F)(this._gl);return z._contextWasLost=this._contextWasLost,z.validateShaderPrograms=this.validateShaderPrograms,(0,J.B)(G,V,W,R,d||this._gl,k)}inlineShaderCode(G){return G}createPipelineContext(G){if(this._gl){(0,J.F)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const V=(0,J.u)(this._gl,G);return V.Ik=this,V}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(G){return(0,J.l)(G,this._gl,this.validateShaderPrograms)}_preparePipelineContextAsync(G,V,W,R,d,k,z,X,P,A,x){const q=(0,J.F)(this._gl);return q._contextWasLost=this._contextWasLost,q.validateShaderPrograms=this.validateShaderPrograms,q._createShaderProgramInjection=this._createShaderProgram.bind(this),q.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),q.createShaderProgramInjection=this.createShaderProgram.bind(this),q.loadFileInjection=this._loadFile.bind(this),(0,J.o)(G,V,W,R,d,k,z,X,P,A,x)}_createShaderProgram(G,V,W,R){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,J.d)(G,V,W,R,d)}_isRenderingStateCompiled(G){return!this._isDisposed&&(0,J.m)(G,this._gl,this.validateShaderPrograms)}_executeWhenRenderingStateIsCompiled(G,V){(0,J.h)(G,V)}getUniforms(G,V){const W=new Array,J=G;for(let R=0;R<V.length;R++)W.push(this._gl.getUniformLocation(J.program,V[R]));return W}getAttributes(G,V){const W=[],J=G;for(let d=0;d<V.length;d++)try{W.push(this._gl.getAttribLocation(J.program,V[d]))}catch(R){W.push(-1)}return W}enableEffect(G){(G=null!==G&&(0,R.b)(G)?G.effect:G)&&G!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(G),this._currentEffect=G,G.onBind&&G.onBind(G),G._onBindObservable&&G._onBindObservable.notifyObservers(G))}setInt(G,V){return!!G&&(this._gl.uniform1i(G,V),!0)}setInt2(G,V,W){return!!G&&(this._gl.uniform2i(G,V,W),!0)}setInt3(G,V,W,J){return!!G&&(this._gl.uniform3i(G,V,W,J),!0)}setInt4(G,V,W,J,R){return!!G&&(this._gl.uniform4i(G,V,W,J,R),!0)}setIntArray(G,V){return!!G&&(this._gl.uniform1iv(G,V),!0)}setIntArray2(G,V){return!(!G||V.length%2!==0)&&(this._gl.uniform2iv(G,V),!0)}setIntArray3(G,V){return!(!G||V.length%3!==0)&&(this._gl.uniform3iv(G,V),!0)}setIntArray4(G,V){return!(!G||V.length%4!==0)&&(this._gl.uniform4iv(G,V),!0)}setUInt(G,V){return!!G&&(this._gl.uniform1ui(G,V),!0)}setUInt2(G,V,W){return!!G&&(this._gl.uniform2ui(G,V,W),!0)}setUInt3(G,V,W,J){return!!G&&(this._gl.uniform3ui(G,V,W,J),!0)}setUInt4(G,V,W,J,R){return!!G&&(this._gl.uniform4ui(G,V,W,J,R),!0)}setUIntArray(G,V){return!!G&&(this._gl.uniform1uiv(G,V),!0)}setUIntArray2(G,V){return!(!G||V.length%2!==0)&&(this._gl.uniform2uiv(G,V),!0)}setUIntArray3(G,V){return!(!G||V.length%3!==0)&&(this._gl.uniform3uiv(G,V),!0)}setUIntArray4(G,V){return!(!G||V.length%4!==0)&&(this._gl.uniform4uiv(G,V),!0)}setArray(G,V){return!!G&&(!(V.length<1)&&(this._gl.uniform1fv(G,V),!0))}setArray2(G,V){return!(!G||V.length%2!==0)&&(this._gl.uniform2fv(G,V),!0)}setArray3(G,V){return!(!G||V.length%3!==0)&&(this._gl.uniform3fv(G,V),!0)}setArray4(G,V){return!(!G||V.length%4!==0)&&(this._gl.uniform4fv(G,V),!0)}setMatrices(G,V){return!!G&&(this._gl.uniformMatrix4fv(G,!1,V),!0)}setMatrix3x3(G,V){return!!G&&(this._gl.uniformMatrix3fv(G,!1,V),!0)}setMatrix2x2(G,V){return!!G&&(this._gl.uniformMatrix2fv(G,!1,V),!0)}setFloat(G,V){return!!G&&(this._gl.uniform1f(G,V),!0)}setFloat2(G,V,W){return!!G&&(this._gl.uniform2f(G,V,W),!0)}setFloat3(G,V,W,J){return!!G&&(this._gl.uniform3f(G,V,W,J),!0)}setFloat4(G,V,W,J,R){return!!G&&(this._gl.uniform4f(G,V,W,J,R),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const G=this._colorWrite;this._gl.colorMask(G,G,G,G)}}wipeCaches(G){this.preventCacheWipeBetweenFrames&&!G||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),G&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(G,V){const W=this._gl;let J=W.NEAREST,R=W.NEAREST,d=!1;switch(G){case 11:J=W.LINEAR,R=V?W.LINEAR_MIPMAP_NEAREST:W.LINEAR;break;case 3:J=W.LINEAR,d=!0,R=V?W.LINEAR_MIPMAP_LINEAR:W.LINEAR;break;case 8:d=!0,J=W.NEAREST,R=V?W.NEAREST_MIPMAP_LINEAR:W.NEAREST;break;case 4:J=W.NEAREST,R=V?W.NEAREST_MIPMAP_NEAREST:W.NEAREST;break;case 5:J=W.NEAREST,R=V?W.LINEAR_MIPMAP_NEAREST:W.LINEAR;break;case 6:d=!0,J=W.NEAREST,R=V?W.LINEAR_MIPMAP_LINEAR:W.LINEAR;break;case 7:J=W.NEAREST,R=W.LINEAR;break;case 1:J=W.NEAREST,R=W.NEAREST;break;case 9:J=W.LINEAR,R=V?W.NEAREST_MIPMAP_NEAREST:W.NEAREST;break;case 10:d=!0,J=W.LINEAR,R=V?W.NEAREST_MIPMAP_LINEAR:W.NEAREST;break;case 2:J=W.LINEAR,R=W.LINEAR;break;case 12:J=W.LINEAR,R=W.NEAREST}return{min:R,mag:J,hasMipMaps:d}}_createTexture(){const G=this._gl.createTexture();if(!G)throw new Error("Unable to create texture");return G}_createHardwareTexture(){return new L.e(this._createTexture(),this._gl)}_createInternalTexture(G,V){let W,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,R=!1,k=!1,z=0,X=3,P=5,A=!1,x=1,q=!1,L=0;void 0!==V&&"object"===typeof V?(R=!!V.generateMipMaps,k=!!V.createMipMaps,z=void 0===V.type?0:V.type,X=void 0===V.samplingMode?3:V.samplingMode,P=void 0===V.format?5:V.format,A=void 0!==V.useSRGBBuffer&&V.useSRGBBuffer,x=V.samples??1,W=V.label,q=!!V.createMSAATexture,L=V.comparisonFunction||0):R=!!V,A&&(A=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==z||this._caps.textureFloatLinearFiltering)&&(2!==z||this._caps.textureHalfFloatLinearFiltering)||(X=1),1!==z||this._caps.textureFloat||(z=0,d.c.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const Y=(0,S.e)(P),g=(0,S.c)(P),B=this._gl,p=new t.d(this,J),b=G.width||G,r=G.height||G,y=G.depth||0,u=G.layers||0,H=this._getSamplingParameters(X,(R||k)&&!Y),n=0!==u?B.TEXTURE_2D_ARRAY:0!==y?B.TEXTURE_3D:B.TEXTURE_2D,D=Y?this._getInternalFormatFromDepthTextureFormat(P,!0,g):this._getRGBABufferInternalSizedFormat(z,P,A),i=Y?g?B.DEPTH_STENCIL:B.DEPTH_COMPONENT:this._getInternalFormat(P),e=Y?this._getWebGLTextureTypeFromDepthTextureFormat(P):this._getWebGLTextureType(z);if(this._bindTextureDirectly(n,p),0!==u?(p.is2DArray=!0,B.texImage3D(n,0,D,b,r,u,0,i,e,null)):0!==y?(p.is3D=!0,B.texImage3D(n,0,D,b,r,y,0,i,e,null)):B.texImage2D(n,0,D,b,r,0,i,e,null),B.texParameteri(n,B.TEXTURE_MAG_FILTER,H.mag),B.texParameteri(n,B.TEXTURE_MIN_FILTER,H.min),B.texParameteri(n,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE),B.texParameteri(n,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE),Y&&this.webGLVersion>1&&(0===L?(B.texParameteri(n,B.TEXTURE_COMPARE_FUNC,515),B.texParameteri(n,B.TEXTURE_COMPARE_MODE,B.NONE)):(B.texParameteri(n,B.TEXTURE_COMPARE_FUNC,L),B.texParameteri(n,B.TEXTURE_COMPARE_MODE,B.COMPARE_REF_TO_TEXTURE))),(R||k)&&this._gl.generateMipmap(n),this._bindTextureDirectly(n,null),p._useSRGBBuffer=A,p.baseWidth=b,p.baseHeight=r,p.width=b,p.height=r,p.depth=u||y,p.isReady=!0,p.samples=x,p.generateMipMaps=R,p.samplingMode=X,p.type=z,p.format=P,p.label=W,p.comparisonFunction=L,this._internalTexturesCache.push(p),q){let G=null;if(G=(0,S.e)(p.format)?this._setupFramebufferDepthAttachments((0,S.c)(p.format),19!==p.format,p.width,p.height,x,p.format,!0):this._createRenderBuffer(p.width,p.height,x,-1,this._getRGBABufferInternalSizedFormat(p.type,p.format,p._useSRGBBuffer),-1),!G)throw new Error("Unable to create render buffer");p._autoMSAAManagement=!0;let V=p._hardwareTexture;V||(V=p._hardwareTexture=this._createHardwareTexture()),V.addMSAARenderBuffer(G)}return p}_getUseSRGBBuffer(G,V){return G&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||V)}createTexture(G,V,W,J){var R=this;let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,P=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,A=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,x=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,q=arguments.length>11?arguments[11]:void 0,L=arguments.length>12?arguments[12]:void 0,Y=arguments.length>13?arguments[13]:void 0,g=arguments.length>14?arguments[14]:void 0;return this._createTextureBase(G,V,W,J,d,k,z,(function(){for(var G=arguments.length,V=new Array(G),W=0;W<G;W++)V[W]=arguments[W];return R._prepareWebGLTexture(...V,A)}),((G,V,W,R,d,k)=>{const z=this._gl,X=W.width===G&&W.height===V;d._creationFlags=Y??0;const P=this._getTexImageParametersForCreateTexture(d.format,d._useSRGBBuffer);if(X)return z.texImage2D(z.TEXTURE_2D,0,P.internalFormat,P.format,P.type,W),!1;const A=this._caps.maxTextureSize;if(W.width>A||W.height>A||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=G,this._workingCanvas.height=V,this._workingContext.drawImage(W,0,0,W.width,W.height,0,0,G,V),z.texImage2D(z.TEXTURE_2D,0,P.internalFormat,P.format,P.type,this._workingCanvas),d.width=G,d.height=V,!1);{const G=new t.d(this,2);this._bindTextureDirectly(z.TEXTURE_2D,G,!0),z.texImage2D(z.TEXTURE_2D,0,P.internalFormat,P.format,P.type,W),this._rescaleTexture(G,d,J,P.format,(()=>{this._releaseTexture(G),this._bindTextureDirectly(z.TEXTURE_2D,d,!0),k()}))}return!0}),X,P,A,x,q,L,g)}_getTexImageParametersForCreateTexture(G,V){let W,J;return 1===this.webGLVersion?(W=this._getInternalFormat(G,V),J=W):(W=this._getInternalFormat(G,!1),J=this._getRGBABufferInternalSizedFormat(0,G,V)),{internalFormat:J,format:W,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(G,V,W,J,R){}_unpackFlipY(G){this._unpackFlipYCached!==G&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,G?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=G))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(G){return G.isCube?this._gl.TEXTURE_CUBE_MAP:G.is3D?this._gl.TEXTURE_3D:G.is2DArray||G.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(G,V){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const J=this._getTextureTarget(V),R=this._getSamplingParameters(G,V.useMipMaps||W);this._setTextureParameterInteger(J,this._gl.TEXTURE_MAG_FILTER,R.mag,V),this._setTextureParameterInteger(J,this._gl.TEXTURE_MIN_FILTER,R.min),W&&R.hasMipMaps&&(V.generateMipMaps=!0,this._gl.generateMipmap(J)),this._bindTextureDirectly(J,null),V.samplingMode=G}updateTextureDimensions(G,V,W){}updateTextureWrappingMode(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const R=this._getTextureTarget(G);null!==V&&(this._setTextureParameterInteger(R,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(V),G),G._cachedWrapU=V),null!==W&&(this._setTextureParameterInteger(R,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(W),G),G._cachedWrapV=W),(G.is2DArray||G.is3D)&&null!==J&&(this._setTextureParameterInteger(R,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(J),G),G._cachedWrapR=J),this._bindTextureDirectly(R,null)}_uploadCompressedDataToTextureDirectly(G,V,W,J,R){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const z=this._gl;let X=z.TEXTURE_2D;if(G.isCube&&(X=z.TEXTURE_CUBE_MAP_POSITIVE_X+d),G._useSRGBBuffer)switch(V){case 37492:case 36196:this._caps.etc2?V=z.COMPRESSED_SRGB8_ETC2:G._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?V=z.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:G._useSRGBBuffer=!1;break;case 36492:V=z.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:V=z.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?V=z.COMPRESSED_SRGB_S3TC_DXT1_EXT:G._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?V=z.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:G._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?V=z.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:G._useSRGBBuffer=!1;break;default:G._useSRGBBuffer=!1}this._gl.compressedTexImage2D(X,k,V,W,J,0,R)}_uploadDataToTextureDirectly(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,R=arguments.length>4?arguments[4]:void 0,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const k=this._gl,z=this._getWebGLTextureType(G.type),X=this._getInternalFormat(G.format),P=void 0===R?this._getRGBABufferInternalSizedFormat(G.type,G.format,G._useSRGBBuffer):this._getInternalFormat(R,G._useSRGBBuffer);this._unpackFlipY(G.invertY);let A=k.TEXTURE_2D;G.isCube&&(A=k.TEXTURE_CUBE_MAP_POSITIVE_X+W);const x=Math.round(Math.log(G.width)*Math.LOG2E),q=Math.round(Math.log(G.height)*Math.LOG2E),L=d?G.width:Math.pow(2,Math.max(x-J,0)),t=d?G.height:Math.pow(2,Math.max(q-J,0));k.texImage2D(A,J,P,L,t,0,X,z,V)}updateTextureData(G,V,W,J,R,d){let k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,X=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const P=this._gl,A=this._getWebGLTextureType(G.type),x=this._getInternalFormat(G.format);this._unpackFlipY(G.invertY);let q=P.TEXTURE_2D,L=P.TEXTURE_2D;G.isCube&&(L=P.TEXTURE_CUBE_MAP_POSITIVE_X+k,q=P.TEXTURE_CUBE_MAP),this._bindTextureDirectly(q,G,!0),P.texSubImage2D(L,z,W,J,R,d,x,A,V),X&&this._gl.generateMipmap(L),this._bindTextureDirectly(q,null)}_uploadArrayBufferViewToTexture(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const R=this._gl,d=G.isCube?R.TEXTURE_CUBE_MAP:R.TEXTURE_2D;this._bindTextureDirectly(d,G,!0),this._uploadDataToTextureDirectly(G,V,W,J),this._bindTextureDirectly(d,null,!0)}_prepareWebGLTextureContinuation(G,V,W,J,R){const d=this._gl;if(!d)return;const k=this._getSamplingParameters(R,!W);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,k.mag),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,k.min),W||J||d.generateMipmap(d.TEXTURE_2D),this._bindTextureDirectly(d.TEXTURE_2D,null),V&&V.removePendingData(G),G.onLoadedObservable.notifyObservers(G),G.onLoadedObservable.clear()}_prepareWebGLTexture(G,V,W,J,R,d,k,z,X,P){const A=this.getCaps().maxTextureSize,q=Math.min(A,this.needPOTTextures?(0,x.f)(J.width,A):J.width),L=Math.min(A,this.needPOTTextures?(0,x.f)(J.height,A):J.height),t=this._gl;t&&(G._hardwareTexture?(this._bindTextureDirectly(t.TEXTURE_2D,G,!0),this._unpackFlipY(void 0===R||!!R),G.baseWidth=J.width,G.baseHeight=J.height,G.width=q,G.height=L,G.isReady=!0,G.type=-1!==G.type?G.type:0,G.format=-1!==G.format?G.format:P??(".jpg"!==V||G._useSRGBBuffer?5:4),z(q,L,J,V,G,(()=>{this._prepareWebGLTextureContinuation(G,W,d,k,X)}))||this._prepareWebGLTextureContinuation(G,W,d,k,X)):W&&W.removePendingData(G))}_getInternalFormatFromDepthTextureFormat(G,V,W){const J=this._gl;if(!V)return J.STENCIL_INDEX8;let R=W?J.DEPTH_STENCIL:J.DEPTH_COMPONENT;return this.webGLVersion>1?15===G?R=J.DEPTH_COMPONENT16:16===G?R=J.DEPTH_COMPONENT24:17===G||13===G?R=W?J.DEPTH24_STENCIL8:J.DEPTH_COMPONENT24:14===G?R=J.DEPTH_COMPONENT32F:18===G&&(R=W?J.DEPTH32F_STENCIL8:J.DEPTH_COMPONENT32F):R=J.DEPTH_COMPONENT16,R}_getWebGLTextureTypeFromDepthTextureFormat(G){const V=this._gl;let W=V.UNSIGNED_INT;return 15===G?W=V.UNSIGNED_SHORT:17===G||13===G?W=V.UNSIGNED_INT_24_8:14===G?W=V.FLOAT:18===G?W=V.FLOAT_32_UNSIGNED_INT_24_8_REV:19===G&&(W=V.UNSIGNED_BYTE),W}_setupFramebufferDepthAttachments(G,V,W,J){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,d=arguments.length>5?arguments[5]:void 0,k=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const z=this._gl;d=d??(G?13:14);const X=this._getInternalFormatFromDepthTextureFormat(d,V,G);return G&&V?this._createRenderBuffer(W,J,R,z.DEPTH_STENCIL,X,k?-1:z.DEPTH_STENCIL_ATTACHMENT):V?this._createRenderBuffer(W,J,R,X,X,k?-1:z.DEPTH_ATTACHMENT):G?this._createRenderBuffer(W,J,R,X,X,k?-1:z.STENCIL_ATTACHMENT):null}_createRenderBuffer(G,V,W,J,R,d){let k=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const z=this._gl.createRenderbuffer();return this._updateRenderBuffer(z,G,V,W,J,R,d,k)}_updateRenderBuffer(G,V,W,J,R,d,k){let z=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const X=this._gl;return X.bindRenderbuffer(X.RENDERBUFFER,G),J>1&&X.renderbufferStorageMultisample?X.renderbufferStorageMultisample(X.RENDERBUFFER,J,d,V,W):X.renderbufferStorage(X.RENDERBUFFER,R,V,W),-1!==k&&X.framebufferRenderbuffer(X.FRAMEBUFFER,k,X.RENDERBUFFER,G),z&&X.bindRenderbuffer(X.RENDERBUFFER,null),G}_releaseTexture(G){this._deleteTexture(G._hardwareTexture),this.unbindAllTextures();const V=this._internalTexturesCache.indexOf(G);-1!==V&&this._internalTexturesCache.splice(V,1),G._lodTextureHigh&&G._lodTextureHigh.dispose(),G._lodTextureMid&&G._lodTextureMid.dispose(),G._lodTextureLow&&G._lodTextureLow.dispose(),G._irradianceTexture&&G._irradianceTexture.dispose()}_deleteTexture(G){null===G||void 0===G||G.release()}_setProgram(G){this._currentProgram!==G&&((0,J.r)(G,this._gl),this._currentProgram=G)}bindSamplers(G){const V=G.getPipelineContext();this._setProgram(V.program);const W=G.getSamplers();for(let J=0;J<W.length;J++){const V=G.getUniform(W[J]);V&&(this._boundUniforms[J]=V)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(G,V){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],R=!1;const k=V&&V._associatedChannel>-1;W&&k&&(this._activeChannel=V._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==V||J){if(this._activateCurrentTexture(),V&&V.isMultiview)throw d.c.Error(["_bindTextureDirectly called with a multiview texture!",G,V]),"_bindTextureDirectly called with a multiview texture!";var z;this._gl.bindTexture(G,(null===V||void 0===V||null===(z=V._hardwareTexture)||void 0===z?void 0:z.underlyingResource)??null),this._boundTexturesCache[this._activeChannel]=V,V&&(V._associatedChannel=this._activeChannel)}else W&&(R=!0,this._activateCurrentTexture());return k&&!W&&this._bindSamplerUniformToChannel(V._associatedChannel,this._activeChannel),R}_bindTexture(G,V,W){if(void 0===G)return;V&&(V._associatedChannel=G),this._activeChannel=G;const J=V?this._getTextureTarget(V):this._gl.TEXTURE_2D;this._bindTextureDirectly(J,V)}unbindAllTextures(){for(let G=0;G<this._maxSimultaneousTextures;G++)this._activeChannel=G,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(G,V,W,J){void 0!==G&&(V&&(this._boundUniforms[G]=V),this._setTexture(G,W))}_bindSamplerUniformToChannel(G,V){const W=this._boundUniforms[G];W&&W._currentState!==V&&(this._gl.uniform1i(W,V),W._currentState=V)}_getTextureWrapMode(G){switch(G){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(G,V){let W,J=arguments.length>2&&void 0!==arguments[2]&&arguments[2],R=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!V)return null!=this._boundTexturesCache[G]&&(this._activeChannel=G,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(V.video){this._activeChannel=G;const W=V.getInternalTexture();W&&(W._associatedChannel=G),V.update()}else if(4===V.delayLoadState)return V.delayLoad(),!1;W=R?V.depthStencilTexture:V.isReady()?V.getInternalTexture():V.isCube?this.emptyCubeTexture:V.is3D?this.emptyTexture3D:V.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!J&&W&&(W._associatedChannel=G);let d=!0;this._boundTexturesCache[G]===W&&(J||this._bindSamplerUniformToChannel(W._associatedChannel,G),d=!1),this._activeChannel=G;const k=this._getTextureTarget(W);if(d&&this._bindTextureDirectly(k,W,J),W&&!W.isMultiview){if(W.isCube&&W._cachedCoordinatesMode!==V.coordinatesMode){W._cachedCoordinatesMode=V.coordinatesMode;const G=3!==V.coordinatesMode&&5!==V.coordinatesMode?1:0;V.wrapU=G,V.wrapV=G}W._cachedWrapU!==V.wrapU&&(W._cachedWrapU=V.wrapU,this._setTextureParameterInteger(k,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(V.wrapU),W)),W._cachedWrapV!==V.wrapV&&(W._cachedWrapV=V.wrapV,this._setTextureParameterInteger(k,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(V.wrapV),W)),W.is3D&&W._cachedWrapR!==V.wrapR&&(W._cachedWrapR=V.wrapR,this._setTextureParameterInteger(k,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(V.wrapR),W)),this._setAnisotropicLevel(k,W,V.anisotropicFilteringLevel)}return!0}setTextureArray(G,V,W,J){if(void 0!==G&&V){this._textureUnits&&this._textureUnits.length===W.length||(this._textureUnits=new Int32Array(W.length));for(let V=0;V<W.length;V++){const J=W[V].getInternalTexture();J?(this._textureUnits[V]=G+V,J._associatedChannel=G+V):this._textureUnits[V]=-1}this._gl.uniform1iv(V,this._textureUnits);for(let G=0;G<W.length;G++)this._setTexture(this._textureUnits[G],W[G],!0)}}_setAnisotropicLevel(G,V,W){const J=this._caps.textureAnisotropicFilterExtension;11!==V.samplingMode&&3!==V.samplingMode&&2!==V.samplingMode&&(W=1),J&&V._cachedAnisotropicFilteringLevel!==W&&(this._setTextureParameterFloat(G,J.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(W,this._caps.maxAnisotropy),V),V._cachedAnisotropicFilteringLevel=W)}_setTextureParameterFloat(G,V,W,J){this._bindTextureDirectly(G,J,!0,!0),this._gl.texParameterf(G,V,W)}_setTextureParameterInteger(G,V,W,J){J&&this._bindTextureDirectly(G,J,!0,!0),this._gl.texParameteri(G,V,W)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let G=0;G<this._caps.maxVertexAttribs;G++)this.disableAttributeByIndex(G)}else for(let G=0,V=this._vertexAttribArraysEnabled.length;G<V;G++)G>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[G]||this.disableAttributeByIndex(G)}releaseEffects(){this._compiledEffects={},this.onReleaseEffectsObservable.notifyObservers(this)}dispose(){var G;((0,k.m)()&&this._renderingCanvas&&(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._onContextRestored&&this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored)),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose)&&(null===(G=this._gl.getExtension("WEBGL_lose_context"))||void 0===G||G.loseContext());(0,J.E)(this._gl)}attachContextLostEvent(G){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",G,!1)}attachContextRestoredEvent(G){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",G,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(G){const V=this._gl;for(;V.getError()!==V.NO_ERROR;);let W=!0;const J=V.createTexture();V.bindTexture(V.TEXTURE_2D,J),V.texImage2D(V.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(G),1,1,0,V.RGBA,this._getWebGLTextureType(G),null),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MIN_FILTER,V.NEAREST),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MAG_FILTER,V.NEAREST);const R=V.createFramebuffer();V.bindFramebuffer(V.FRAMEBUFFER,R),V.framebufferTexture2D(V.FRAMEBUFFER,V.COLOR_ATTACHMENT0,V.TEXTURE_2D,J,0);const d=V.checkFramebufferStatus(V.FRAMEBUFFER);if(W=W&&d===V.FRAMEBUFFER_COMPLETE,W=W&&V.getError()===V.NO_ERROR,W&&(V.clear(V.COLOR_BUFFER_BIT),W=W&&V.getError()===V.NO_ERROR),W){V.bindFramebuffer(V.FRAMEBUFFER,null);const G=V.RGBA,J=V.UNSIGNED_BYTE,R=new Uint8Array(4);V.readPixels(0,0,1,1,G,J,R),W=W&&V.getError()===V.NO_ERROR}for(V.deleteTexture(J),V.deleteFramebuffer(R),V.bindFramebuffer(V.FRAMEBUFFER,null);!W&&V.getError()!==V.NO_ERROR;);return W}_getWebGLTextureType(G){if(1===this._webGLVersion){switch(G){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(G){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=V?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(G){case 0:W=this._gl.ALPHA;break;case 1:W=this._gl.LUMINANCE;break;case 2:W=this._gl.LUMINANCE_ALPHA;break;case 6:case 33322:case 36760:W=this._gl.RED;break;case 7:case 33324:case 36761:W=this._gl.RG;break;case 4:case 32852:case 36762:W=V?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:case 32859:case 36763:W=V?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(G){case 8:W=this._gl.RED_INTEGER;break;case 9:W=this._gl.RG_INTEGER;break;case 10:W=this._gl.RGB_INTEGER;break;case 11:W=this._gl.RGBA_INTEGER}return W}_getRGBABufferInternalSizedFormat(G,V){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(1===this._webGLVersion){if(void 0!==V)switch(V){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return W?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(G){case 3:switch(V){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(V){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return W?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return W?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(V){case 8:return this._gl.R16I;case 36760:return this._gl.R16_SNORM_EXT;case 36761:return this._gl.RG16_SNORM_EXT;case 36762:return this._gl.RGB16_SNORM_EXT;case 36763:return this._gl.RGBA16_SNORM_EXT;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(V){case 8:return this._gl.R16UI;case 33322:return this._gl.R16_EXT;case 33324:return this._gl.RG16_EXT;case 32852:return this._gl.RGB16_EXT;case 32859:return this._gl.RGBA16_EXT;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(V){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(V){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(V){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(V){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(V){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return W?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(G,V,W,J){let R=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],k=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;const X=R?4:3,P=R?this._gl.RGBA:this._gl.RGB,A=W*J*X;if(z){if(z.length<A)return d.c.Error(`Data buffer is too small to store the read pixels (${z.length} should be more than ${A})`),Promise.resolve(z)}else z=new Uint8Array(A);return k&&this.flushFramebuffer(),this._gl.readPixels(G,V,W,J,P,this._gl.UNSIGNED_BYTE,z),Promise.resolve(z)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const G=q.b._CreateCanvas(1,1),V=G.getContext("webgl")||G.getContext("experimental-webgl");this._IsSupported=null!=V&&!!window.WebGLRenderingContext}catch(G){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const G=q.b._CreateCanvas(1,1),V=G.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||G.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!V}catch(G){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}b._TempClearColorUint32=new Uint32Array(4),b._TempClearColorInt32=new Int32Array(4),b.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],b._ConcatenateShader=g.f,b._IsSupported=null,b._HasMajorPerformanceCaveat=null},11777:(G,V,W)=>{var J;W.d(V,{c:()=>R}),function(G){G[G.PointerMove=0]="PointerMove",G[G.PointerDown=1]="PointerDown",G[G.PointerUp=2]="PointerUp"}(J||(J={}));class R{}R.DOM_DELTA_PIXEL=0,R.DOM_DELTA_LINE=1,R.DOM_DELTA_PAGE=2},11771:(G,V,W)=>{W.d(V,{e:()=>J,i:()=>d,k:()=>R});class J{}J.KEYDOWN=1,J.KEYUP=2;class R{constructor(G,V){this.type=G,this.event=V}}class d extends R{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(G){this.skipOnKeyboardObservable=G}constructor(G,V){super(G,V),this.type=G,this.event=V,this.skipOnKeyboardObservable=!1}}},11762:(G,V,W)=>{W.d(V,{c:()=>R,g:()=>k,k:()=>z});var J=W(11136);class R{}R.POINTERDOWN=1,R.POINTERUP=2,R.POINTERMOVE=4,R.POINTERWHEEL=8,R.POINTERPICK=16,R.POINTERTAP=32,R.POINTERDOUBLETAP=64;class d{constructor(G,V){this.type=G,this.event=V}}class k extends d{constructor(G,V,W,R){super(G,V),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new J.k(W,R)}}class z extends d{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}constructor(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(G,V),this._pickInfo=W,this._inputManager=J}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}},11868:(G,V,W)=>{W.d(V,{e:()=>q});var J=W(11317),R=W(11324),d=W(11136),k=W(11424),z=W(11465),X=W(11400),P=W(11159),A=W(11440),x=W(11411);class q extends z.d{get range(){return this._range}set range(G){this._range=G,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(G){this._intensityMode=G,this._computePhotometricScale()}get radius(){return this._radius}set radius(G){this._radius=G,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(G){this._shadowEnabled!==G&&(this._shadowEnabled=G,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(G){this._includedOnlyMeshes=G,this._hookArrayForIncludedOnly(G)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(G){this._excludedMeshes=G,this._hookArrayForExcluded(G)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(G){this._excludeWithLayerMask=G,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(G){this._includeOnlyWithLayerMask=G,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(G){this._lightmapMode!==G&&(this._lightmapMode=G,this._markMeshesAsLightDirty())}getViewMatrix(G){return null}getProjectionMatrix(G,V){return null}constructor(G,V){super(G,V,!1),this.Pz=new k.d(1,1,1),this.sP=new k.d(1,1,1),this.falloffType=q.FALLOFF_DEFAULT,this.Xz=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=q.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.HG().addLight(this),this._uniformBuffer=new X.c(this.HG().getEngine(),void 0,void 0,G),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(G,V){return this}_bindLight(G,V,W,J){let R=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const d=G.toString();let z=!1;if(this._uniformBuffer.bindToEffect(W,"Light"+d),this._renderId!==V.getRenderId()||this._lastUseSpecular!==J||!this._uniformBuffer.useUbo){this._renderId=V.getRenderId(),this._lastUseSpecular=J;const G=this.getScaledIntensity();this.transferToEffect(W,d),this.Pz.scaleToRef(G,k.j.pz[0]),this._uniformBuffer.updateColor4("vLightDiffuse",k.j.pz[0],this.range,d),J&&(this.sP.scaleToRef(G,k.j.pz[1]),this._uniformBuffer.updateColor4("vLightSpecular",k.j.pz[1],this.radius,d)),z=!0}if(this.transferTexturesToEffect(W,d),V.shadowsEnabled&&this.shadowEnabled&&R){const G=this.getShadowGenerator(V.activeCamera)??this.getShadowGenerator();G&&(G.bindShadowLight(d,W),z=!0)}z?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(G){let V="Name: "+this.name;if(V+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let W=0;W<this.animations.length;W++)V+=", animation[0]: "+this.animations[W].toString(G);return V}_syncParentEnabledState(){super._syncParentEnabledState(),this.P()||this._resyncMeshes()}rz(G){super.rz(G),this._resyncMeshes()}getShadowGenerator(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(G)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return d.o.Zero()}canAffectMesh(G){return!G||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(G))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(G))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&G.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&G.layerMask)))}dispose(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const G=this._shadowGenerators.values();for(let V=G.next();!0!==V.done;V=G.next()){V.value.dispose()}this._shadowGenerators=null}if(this.HG().stopAnimation(this),this._parentContainer){const G=this._parentContainer.lights.indexOf(this);G>-1&&this._parentContainer.lights.splice(G,1),this._parentContainer=null}for(const W of this.HG().meshes)W._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.HG().removeLight(this),super.dispose(G,V)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.Xz}clone(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=q.GetConstructorFromName(this.getTypeID(),G,this.HG());if(!W)return null;const J=x.e.Clone(W,this);return G&&(J.name=G),V&&(J.parent=V),J.rz(this.isEnabled()),this.onClonedObservable.notifyObservers(J),J}serialize(){const G=x.e.Serialize(this);if(G.uniqueId=this.uniqueId,G.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(G),this.excludedMeshes.length>0){G.excludedMeshesIds=[];for(const V of this.excludedMeshes)G.excludedMeshesIds.push(V.id)}if(this.includedOnlyMeshes.length>0){G.includedOnlyMeshesIds=[];for(const V of this.includedOnlyMeshes)G.includedOnlyMeshesIds.push(V.id)}return x.e.AppendSerializedAnimations(this,G),G.ranges=this.serializeAnimationRanges(),G.isEnabled=this.isEnabled(),G}static GetConstructorFromName(G,V,W){const J=z.d.Construct("Light_Type_"+G,V,W);return J||null}static Parse(G,V){const W=q.GetConstructorFromName(G.type,G.name,V);if(!W)return null;const J=x.e.Parse(W,G,V);if(G.excludedMeshesIds&&(J._excludedMeshesIds=G.excludedMeshesIds),G.includedOnlyMeshesIds&&(J._includedOnlyMeshesIds=G.includedOnlyMeshesIds),void 0!==G.parentId&&(J._waitingParentId=G.parentId),void 0!==G.parentInstanceIndex&&(J._waitingParentInstanceIndex=G.parentInstanceIndex),void 0!==G.falloffType&&(J.falloffType=G.falloffType),void 0!==G.lightmapMode&&(J.lightmapMode=G.lightmapMode),G.animations){for(let V=0;V<G.animations.length;V++){const W=G.animations[V],R=(0,P.c)("BABYLON.Animation");R&&J.animations.push(R.Parse(W))}z.d.ParseAnimationRanges(J,G,V)}return G.autoAnimate&&V.beginAnimation(J,G.autoAnimateFrom,G.autoAnimateTo,G.autoAnimateLoop,G.autoAnimateSpeed||1),void 0!==G.isEnabled&&J.rz(G.isEnabled),J}_hookArrayForExcluded(G){var V=this;const W=G.push;G.push=function(){for(var J=arguments.length,R=new Array(J),d=0;d<J;d++)R[d]=arguments[d];const k=W.apply(G,R);for(const G of R)G._resyncLightSource(V);return k};const J=G.splice;G.splice=(V,W)=>{const R=J.apply(G,[V,W]);for(const G of R)G._resyncLightSource(this);return R};for(const R of G)R._resyncLightSource(this)}_hookArrayForIncludedOnly(G){var V=this;const W=G.push;G.push=function(){for(var J=arguments.length,R=new Array(J),d=0;d<J;d++)R[d]=arguments[d];const k=W.apply(G,R);return V._resyncMeshes(),k};const J=G.splice;G.splice=(V,W)=>{const R=J.apply(G,[V,W]);return this._resyncMeshes(),R},this._resyncMeshes()}_resyncMeshes(){for(const G of this.HG().meshes)G._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const G of this.HG().meshes)-1!==G.lightSources.indexOf(this)&&G._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.HG().resetCachedMaterial()}_getPhotometricScale(){let G=0;const V=this.getTypeID();let W=this.intensityMode;switch(W===q.INTENSITYMODE_AUTOMATIC&&(W=V===q.LIGHTTYPEID_DIRECTIONALLIGHT?q.INTENSITYMODE_ILLUMINANCE:q.INTENSITYMODE_LUMINOUSINTENSITY),V){case q.LIGHTTYPEID_POINTLIGHT:case q.LIGHTTYPEID_SPOTLIGHT:switch(W){case q.INTENSITYMODE_LUMINOUSPOWER:G=1/(4*Math.PI);break;case q.INTENSITYMODE_LUMINOUSINTENSITY:G=1;break;case q.INTENSITYMODE_LUMINANCE:G=this.radius*this.radius}break;case q.LIGHTTYPEID_DIRECTIONALLIGHT:switch(W){case q.INTENSITYMODE_ILLUMINANCE:G=1;break;case q.INTENSITYMODE_LUMINANCE:{let V=this.radius;V=Math.max(V,.001);G=2*Math.PI*(1-Math.cos(V));break}}break;case q.LIGHTTYPEID_HEMISPHERICLIGHT:G=1}return G}_reorderLightsInScene(){const G=this.HG();0!=this._renderPriority&&(G.requireLightSorting=!0),this.HG().sortLightsByPriority()}_isReady(){return!0}}q.FALLOFF_DEFAULT=A.b.FALLOFF_DEFAULT,q.FALLOFF_PHYSICAL=A.b.FALLOFF_PHYSICAL,q.FALLOFF_GLTF=A.b.FALLOFF_GLTF,q.FALLOFF_STANDARD=A.b.FALLOFF_STANDARD,q.LIGHTMAP_DEFAULT=A.b.LIGHTMAP_DEFAULT,q.LIGHTMAP_SPECULAR=A.b.LIGHTMAP_SPECULAR,q.LIGHTMAP_SHADOWSONLY=A.b.LIGHTMAP_SHADOWSONLY,q.INTENSITYMODE_AUTOMATIC=A.b.INTENSITYMODE_AUTOMATIC,q.INTENSITYMODE_LUMINOUSPOWER=A.b.INTENSITYMODE_LUMINOUSPOWER,q.INTENSITYMODE_LUMINOUSINTENSITY=A.b.INTENSITYMODE_LUMINOUSINTENSITY,q.INTENSITYMODE_ILLUMINANCE=A.b.INTENSITYMODE_ILLUMINANCE,q.INTENSITYMODE_LUMINANCE=A.b.INTENSITYMODE_LUMINANCE,q.LIGHTTYPEID_POINTLIGHT=A.b.LIGHTTYPEID_POINTLIGHT,q.LIGHTTYPEID_DIRECTIONALLIGHT=A.b.LIGHTTYPEID_DIRECTIONALLIGHT,q.LIGHTTYPEID_SPOTLIGHT=A.b.LIGHTTYPEID_SPOTLIGHT,q.LIGHTTYPEID_HEMISPHERICLIGHT=A.b.LIGHTTYPEID_HEMISPHERICLIGHT,q.LIGHTTYPEID_RECT_AREALIGHT=A.b.LIGHTTYPEID_RECT_AREALIGHT,(0,J.e)([(0,R.m)()],q.prototype,"diffuse",void 0),(0,J.e)([(0,R.m)()],q.prototype,"specular",void 0),(0,J.e)([(0,R.I)()],q.prototype,"falloffType",void 0),(0,J.e)([(0,R.I)()],q.prototype,"intensity",void 0),(0,J.e)([(0,R.I)()],q.prototype,"range",null),(0,J.e)([(0,R.I)()],q.prototype,"intensityMode",null),(0,J.e)([(0,R.I)()],q.prototype,"radius",null),(0,J.e)([(0,R.I)()],q.prototype,"_renderPriority",void 0),(0,J.e)([(0,R.b)("_reorderLightsInScene")],q.prototype,"renderPriority",void 0),(0,J.e)([(0,R.I)("shadowEnabled")],q.prototype,"_shadowEnabled",void 0),(0,J.e)([(0,R.I)("excludeWithLayerMask")],q.prototype,"_excludeWithLayerMask",void 0),(0,J.e)([(0,R.I)("includeOnlyWithLayerMask")],q.prototype,"_includeOnlyWithLayerMask",void 0),(0,J.e)([(0,R.I)("lightmapMode")],q.prototype,"_lightmapMode",void 0)},11440:(G,V,W)=>{W.d(V,{b:()=>J});class J{static CompareLightsPriority(G,V){return G.shadowEnabled!==V.shadowEnabled?(V.shadowEnabled?1:0)-(G.shadowEnabled?1:0):V.renderPriority-G.renderPriority}}J.FALLOFF_DEFAULT=0,J.FALLOFF_PHYSICAL=1,J.FALLOFF_GLTF=2,J.FALLOFF_STANDARD=3,J.LIGHTMAP_DEFAULT=0,J.LIGHTMAP_SPECULAR=1,J.LIGHTMAP_SHADOWSONLY=2,J.INTENSITYMODE_AUTOMATIC=0,J.INTENSITYMODE_LUMINOUSPOWER=1,J.INTENSITYMODE_LUMINOUSINTENSITY=2,J.INTENSITYMODE_ILLUMINANCE=3,J.INTENSITYMODE_LUMINANCE=4,J.LIGHTTYPEID_POINTLIGHT=0,J.LIGHTTYPEID_DIRECTIONALLIGHT=1,J.LIGHTTYPEID_SPOTLIGHT=2,J.LIGHTTYPEID_HEMISPHERICLIGHT=3,J.LIGHTTYPEID_RECT_AREALIGHT=4},11939:(G,V,W)=>{W.d(V,{b:()=>X});var J=W(11317),R=W(11324),d=W(11136),k=W(11868),z=W(11496);class X extends k.e{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=d.c.Identity(),this._projectionMatrix=d.c.Identity()}_setPosition(G){this._position=G}get position(){return this._position}set position(G){this._setPosition(G)}_setDirection(G){this._direction=G}get direction(){return this._direction}set direction(G){this._setDirection(G)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(G){this._shadowMinZ=G,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(G){this._shadowMaxZ=G,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=d.o.Zero()),d.o.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=d.o.Zero()),d.o.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(G){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(G){return this.direction=d.o.Normalize(G.zW(this.position)),this.direction}getRotation(){this.direction.normalize();const G=d.o.Cross(this.direction,z.e.Y),V=d.o.Cross(G,this.direction);return d.o.RotationFromAxis(G,V,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=d.o.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}kd(G){return!G&&this.isSynchronized()?(this._currentRenderId=this.HG().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.J(this.position),this._worldMatrix||(this._worldMatrix=d.c.Identity()),d.c.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(G){return void 0!==this.shadowMinZ?this.shadowMinZ:(null===G||void 0===G?void 0:G.Zd)||0}getDepthMaxZ(G){return void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===G||void 0===G?void 0:G.maxZ)||1e4}setShadowProjectionMatrix(G,V,W){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(V,W,G):this._setDefaultShadowProjectionMatrix(G,V,W),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(G){const V=d.h.ed[0];let W=this.position;this.computeTransformedInformation()&&(W=this.transformedPosition),d.o.NormalizeToRef(this.getShadowDirection(G),V),1===Math.abs(d.o.Dot(V,d.o.Up()))&&(V.z=1e-13);const J=d.h.ed[1];return W.addToRef(V,J),d.c.LookAtLHToRef(W,J,d.o.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(G,V){return this.setShadowProjectionMatrix(this._projectionMatrix,G??this._viewMatrix,V??[]),this._projectionMatrix}}(0,J.e)([(0,R.F)()],X.prototype,"position",null),(0,J.e)([(0,R.F)()],X.prototype,"direction",null),(0,J.e)([(0,R.I)()],X.prototype,"shadowMinZ",null),(0,J.e)([(0,R.I)()],X.prototype,"shadowMaxZ",null)},11543:(G,V,W)=>{W.d(V,{d:()=>J});class J{static get ForceFullSceneLoadingForIncremental(){return J._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(G){J._ForceFullSceneLoadingForIncremental=G}static get ShowLoadingScreen(){return J._ShowLoadingScreen}static set ShowLoadingScreen(G){J._ShowLoadingScreen=G}static get loggingLevel(){return J._LoggingLevel}static set loggingLevel(G){J._LoggingLevel=G}static get CleanBoneMatrixWeights(){return J._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(G){J._CleanBoneMatrixWeights=G}}J._ForceFullSceneLoadingForIncremental=!1,J._ShowLoadingScreen=!0,J._CleanBoneMatrixWeights=!1,J._LoggingLevel=0},11734:(G,V,W)=>{W.d(V,{b:()=>M});var J=W(11317),R=W(11324),d=W(11201),k=W(11525),z=W(11727),X=W(11737),P=W(11136),A=W(11345),x=W(11794),q=W(11798);class L extends x.c{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1,this.MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,this.LEGACY_SPECULAR_ENERGY_CONSERVATION=!1,this.BASE_DIFFUSE_MODEL=0,this.DIELECTRIC_SPECULAR_MODEL=0,this.CONDUCTOR_SPECULAR_MODEL=0}}class t extends q.b{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(G,"PBRBRDF",90,new L,V),this._useEnergyConservation=t.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=t.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=t.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=t.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=t.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=t.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=t.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=t.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._mixIblRadianceWithIrradiance=t.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this.mixIblRadianceWithIrradiance=t.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this._useLegacySpecularEnergyConservation=t.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this.useLegacySpecularEnergyConservation=t.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this._baseDiffuseModel=t.DEFAULT_DIFFUSE_MODEL,this.baseDiffuseModel=t.DEFAULT_DIFFUSE_MODEL,this._dielectricSpecularModel=t.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this.dielectricSpecularModel=t.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this._conductorSpecularModel=t.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this.conductorSpecularModel=t.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this._internalMarkAllSubMeshesAsMiscDirty=G._dirtyCallbacks[16],this._enable(!0)}prepareDefines(G){G.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,G.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,G.SPHERICAL_HARMONICS=this._useSphericalHarmonics,G.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation,G.MIX_IBL_RADIANCE_WITH_IRRADIANCE=this._mixIblRadianceWithIrradiance,G.LEGACY_SPECULAR_ENERGY_CONSERVATION=this._useLegacySpecularEnergyConservation,G.BASE_DIFFUSE_MODEL=this._baseDiffuseModel,G.DIELECTRIC_SPECULAR_MODEL=this._dielectricSpecularModel,G.CONDUCTOR_SPECULAR_MODEL=this._conductorSpecularModel}getClassName(){return"PBRBRDFConfiguration"}}t.DEFAULT_USE_ENERGY_CONSERVATION=!0,t.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,t.DEFAULT_USE_SPHERICAL_HARMONICS=!0,t.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,t.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,t.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION=!0,t.DEFAULT_DIFFUSE_MODEL=0,t.DEFAULT_DIELECTRIC_SPECULAR_MODEL=0,t.DEFAULT_CONDUCTOR_SPECULAR_MODEL=0,(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsMiscDirty")],t.prototype,"useEnergyConservation",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsMiscDirty")],t.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsMiscDirty")],t.prototype,"useSphericalHarmonics",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsMiscDirty")],t.prototype,"useSpecularGlossinessInputEnergyConservation",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsMiscDirty")],t.prototype,"mixIblRadianceWithIrradiance",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsMiscDirty")],t.prototype,"useLegacySpecularEnergyConservation",void 0),(0,J.e)([(0,R.I)("baseDiffuseModel"),(0,R.b)("_markAllSubMeshesAsMiscDirty")],t.prototype,"baseDiffuseModel",void 0),(0,J.e)([(0,R.I)("dielectricSpecularModel"),(0,R.b)("_markAllSubMeshesAsMiscDirty")],t.prototype,"dielectricSpecularModel",void 0),(0,J.e)([(0,R.I)("conductorSpecularModel"),(0,R.b)("_markAllSubMeshesAsMiscDirty")],t.prototype,"conductorSpecularModel",void 0);var Y=W(11804),g=W(11424),B=W(11744),S=W(11313),p=W(11811),b=W(11666),r=W(11818),y=(W(11820),W(11832)),u=W(11432);class H extends x.c{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class n extends q.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(G,"PBRClearCoat",100,new H,V),this._isEnabled=!1,this.isEnabled=!1,this.Xz=1,this.roughness=0,this._indexOfRefraction=n._DefaultIndexOfRefraction,this.indexOfRefraction=n._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=g.d.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=G._dirtyCallbacks[1]}isReadyForSubMesh(G,V,W){if(!this._isEnabled)return!0;const J=this._material._disableBumpMap;if(G._areTexturesDirty&&V.texturesEnabled){if(this._texture&&r.c.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&r.c.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(W.getCaps().standardDerivatives&&this._bumpTexture&&r.c.ClearCoatBumpTextureEnabled&&!J&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&r.c.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(G,V){this._isEnabled?(G.CLEARCOAT=!0,G.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,G.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,G._areTexturesDirty&&V.texturesEnabled&&(this._texture&&r.c.ClearCoatTextureEnabled?(0,u.R)(this._texture,G,"CLEARCOAT_TEXTURE"):G.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&r.c.ClearCoatTextureEnabled?(0,u.R)(this._textureRoughness,G,"CLEARCOAT_TEXTURE_ROUGHNESS"):G.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&r.c.ClearCoatBumpTextureEnabled?(0,u.R)(this._bumpTexture,G,"CLEARCOAT_BUMP"):G.CLEARCOAT_BUMP=!1,G.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===n._DefaultIndexOfRefraction,this._isTintEnabled?(G.CLEARCOAT_TINT=!0,this._tintTexture&&r.c.ClearCoatTintTextureEnabled?((0,u.R)(this._tintTexture,G,"CLEARCOAT_TINT_TEXTURE"),G.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):G.CLEARCOAT_TINT_TEXTURE=!1):(G.CLEARCOAT_TINT=!1,G.CLEARCOAT_TINT_TEXTURE=!1))):(G.CLEARCOAT=!1,G.CLEARCOAT_TEXTURE=!1,G.CLEARCOAT_TEXTURE_ROUGHNESS=!1,G.CLEARCOAT_BUMP=!1,G.CLEARCOAT_TINT=!1,G.CLEARCOAT_TINT_TEXTURE=!1,G.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,G.CLEARCOAT_DEFAULTIOR=!1,G.CLEARCOAT_TEXTUREDIRECTUV=0,G.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,G.CLEARCOAT_BUMPDIRECTUV=0,G.CLEARCOAT_REMAP_F0=!1,G.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,G.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(G,V,W,J){if(!this._isEnabled)return;const R=J.materialDefines,d=this._material.isFrozen,k=this._material._disableBumpMap,z=this._material._invertNormalMapX,X=this._material._invertNormalMapY;if(!G.useUbo||!d||!G.isSync){var P,A,x,q;if((this._texture||this._textureRoughness)&&r.c.ClearCoatTextureEnabled)G.updateFloat4("vClearCoatInfos",(null===(P=this._texture)||void 0===P?void 0:P.coordinatesIndex)??0,(null===(A=this._texture)||void 0===A?void 0:A.level)??0,(null===(x=this._textureRoughness)||void 0===x?void 0:x.coordinatesIndex)??0,(null===(q=this._textureRoughness)||void 0===q?void 0:q.level)??0),this._texture&&(0,u.t)(this._texture,G,"clearCoat"),this._textureRoughness&&!R.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,u.t)(this._textureRoughness,G,"clearCoatRoughness");this._bumpTexture&&W.getCaps().standardDerivatives&&r.c.ClearCoatTextureEnabled&&!k&&(G.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,u.t)(this._bumpTexture,G,"clearCoatBump"),V._mirroredCameraPosition?G.updateFloat2("vClearCoatTangentSpaceParams",z?1:-1,X?1:-1):G.updateFloat2("vClearCoatTangentSpaceParams",z?-1:1,X?-1:1)),this._tintTexture&&r.c.ClearCoatTintTextureEnabled&&(G.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,u.t)(this._tintTexture,G,"clearCoatTint")),G.updateFloat2("vClearCoatParams",this.Xz,this.roughness);const J=1-this._indexOfRefraction,d=1+this._indexOfRefraction,L=Math.pow(-J/d,2),t=1/this._indexOfRefraction;G.updateFloat4("vClearCoatRefractionParams",L,t,J,d),this._isTintEnabled&&(G.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),G.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}V.texturesEnabled&&(this._texture&&r.c.ClearCoatTextureEnabled&&G.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!R.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&r.c.ClearCoatTextureEnabled&&G.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&W.getCaps().standardDerivatives&&r.c.ClearCoatBumpTextureEnabled&&!k&&G.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&r.c.ClearCoatTintTextureEnabled&&G.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(G){return this._texture===G||(this._textureRoughness===G||(this._bumpTexture===G||this._tintTexture===G))}getActiveTextures(G){this._texture&&G.push(this._texture),this._textureRoughness&&G.push(this._textureRoughness),this._bumpTexture&&G.push(this._bumpTexture),this._tintTexture&&G.push(this._tintTexture)}getAnimatables(G){this._texture&&this._texture.animations&&this._texture.animations.length>0&&G.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&G.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&G.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&G.push(this._tintTexture)}dispose(G){var V,W,J,R;G&&(null===(V=this._texture)||void 0===V||V.dispose(),null===(W=this._textureRoughness)||void 0===W||W.dispose(),null===(J=this._bumpTexture)||void 0===J||J.dispose(),null===(R=this._tintTexture)||void 0===R||R.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(G,V,W){return G.CLEARCOAT_BUMP&&V.addFallback(W++,"CLEARCOAT_BUMP"),G.CLEARCOAT_TINT&&V.addFallback(W++,"CLEARCOAT_TINT"),G.CLEARCOAT&&V.addFallback(W++,"CLEARCOAT"),W}getSamplers(G){G.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}n._DefaultIndexOfRefraction=1.5,(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"isEnabled",void 0),(0,J.e)([(0,R.I)()],n.prototype,"intensity",void 0),(0,J.e)([(0,R.I)()],n.prototype,"roughness",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"indexOfRefraction",void 0),(0,J.e)([(0,R.z)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"texture",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useRoughnessFromMainTexture",void 0),(0,J.e)([(0,R.z)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"textureRoughness",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"remapF0OnInterfaceChange",void 0),(0,J.e)([(0,R.z)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"bumpTexture",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"isTintEnabled",void 0),(0,J.e)([(0,R.m)()],n.prototype,"tintColor",void 0),(0,J.e)([(0,R.I)()],n.prototype,"tintColorAtDistance",void 0),(0,J.e)([(0,R.I)()],n.prototype,"tintThickness",void 0),(0,J.e)([(0,R.z)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"tintTexture",void 0);class D extends x.c{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class i extends q.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(G,"PBRIridescence",110,new D,V),this._isEnabled=!1,this.isEnabled=!1,this.Xz=1,this.minimumThickness=i._DefaultMinimumThickness,this.maximumThickness=i._DefaultMaximumThickness,this.indexOfRefraction=i._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=G._dirtyCallbacks[1]}isReadyForSubMesh(G,V){if(!this._isEnabled)return!0;if(G._areTexturesDirty&&V.texturesEnabled){if(this._texture&&r.c.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&r.c.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(G,V){this._isEnabled?(G.IRIDESCENCE=!0,G._areTexturesDirty&&V.texturesEnabled&&(this._texture&&r.c.IridescenceTextureEnabled?(0,u.R)(this._texture,G,"IRIDESCENCE_TEXTURE"):G.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&r.c.IridescenceTextureEnabled?(0,u.R)(this._thicknessTexture,G,"IRIDESCENCE_THICKNESS_TEXTURE"):G.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(G.IRIDESCENCE=!1,G.IRIDESCENCE_TEXTURE=!1,G.IRIDESCENCE_THICKNESS_TEXTURE=!1,G.IRIDESCENCE_TEXTUREDIRECTUV=0,G.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(G,V){if(!this._isEnabled)return;const W=this._material.isFrozen;if(!G.useUbo||!W||!G.isSync){var J,R,d,k;if((this._texture||this._thicknessTexture)&&r.c.IridescenceTextureEnabled)G.updateFloat4("vIridescenceInfos",(null===(J=this._texture)||void 0===J?void 0:J.coordinatesIndex)??0,(null===(R=this._texture)||void 0===R?void 0:R.level)??0,(null===(d=this._thicknessTexture)||void 0===d?void 0:d.coordinatesIndex)??0,(null===(k=this._thicknessTexture)||void 0===k?void 0:k.level)??0),this._texture&&(0,u.t)(this._texture,G,"iridescence"),this._thicknessTexture&&(0,u.t)(this._thicknessTexture,G,"iridescenceThickness");G.updateFloat4("vIridescenceParams",this.Xz,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}V.texturesEnabled&&(this._texture&&r.c.IridescenceTextureEnabled&&G.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&r.c.IridescenceTextureEnabled&&G.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(G){return this._texture===G||this._thicknessTexture===G}getActiveTextures(G){this._texture&&G.push(this._texture),this._thicknessTexture&&G.push(this._thicknessTexture)}getAnimatables(G){this._texture&&this._texture.animations&&this._texture.animations.length>0&&G.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&G.push(this._thicknessTexture)}dispose(G){var V,W;G&&(null===(V=this._texture)||void 0===V||V.dispose(),null===(W=this._thicknessTexture)||void 0===W||W.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(G,V,W){return G.IRIDESCENCE&&V.addFallback(W++,"IRIDESCENCE"),W}getSamplers(G){G.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}i._DefaultMinimumThickness=100,i._DefaultMaximumThickness=400,i._DefaultIndexOfRefraction=1.3,(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isEnabled",void 0),(0,J.e)([(0,R.I)()],i.prototype,"intensity",void 0),(0,J.e)([(0,R.I)()],i.prototype,"minimumThickness",void 0),(0,J.e)([(0,R.I)()],i.prototype,"maximumThickness",void 0),(0,J.e)([(0,R.I)()],i.prototype,"indexOfRefraction",void 0),(0,J.e)([(0,R.z)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"texture",void 0),(0,J.e)([(0,R.z)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"thicknessTexture",void 0);class e extends x.c{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class F extends q.b{set angle(G){this.direction.x=Math.cos(G),this.direction.y=Math.sin(G)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(G,"PBRAnisotropic",110,new e,V),this._isEnabled=!1,this.isEnabled=!1,this.Xz=1,this.direction=new P.k(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=G._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=G._dirtyCallbacks[16]}isReadyForSubMesh(G,V){return!this._isEnabled||!(G._areTexturesDirty&&V.texturesEnabled&&this._texture&&r.c.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(G,V,W){this._isEnabled?(G.ANISOTROPIC=this._isEnabled,this._isEnabled&&!W.isVerticesDataPresent(A.c.TangentKind)&&(G._needUVs=!0,G.MAINUV1=!0),G._areTexturesDirty&&V.texturesEnabled&&(this._texture&&r.c.AnisotropicTextureEnabled?(0,u.R)(this._texture,G,"ANISOTROPIC_TEXTURE"):G.ANISOTROPIC_TEXTURE=!1),G._areMiscDirty&&(G.ANISOTROPIC_LEGACY=this._legacy)):(G.ANISOTROPIC=!1,G.ANISOTROPIC_TEXTURE=!1,G.ANISOTROPIC_TEXTUREDIRECTUV=0,G.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(G,V){if(!this._isEnabled)return;const W=this._material.isFrozen;G.useUbo&&W&&G.isSync||(this._texture&&r.c.AnisotropicTextureEnabled&&(G.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,u.t)(this._texture,G,"anisotropy")),G.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.Xz)),V.texturesEnabled&&this._texture&&r.c.AnisotropicTextureEnabled&&G.setTexture("anisotropySampler",this._texture)}hasTexture(G){return this._texture===G}getActiveTextures(G){this._texture&&G.push(this._texture)}getAnimatables(G){this._texture&&this._texture.animations&&this._texture.animations.length>0&&G.push(this._texture)}dispose(G){G&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(G,V,W){return G.ANISOTROPIC&&V.addFallback(W++,"ANISOTROPIC"),W}getSamplers(G){G.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(G,V,W){super.parse(G,V,W),void 0===G.legacy&&(this.legacy=!0)}}(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"isEnabled",void 0),(0,J.e)([(0,R.I)()],F.prototype,"intensity",void 0),(0,J.e)([(0,R.B)()],F.prototype,"direction",void 0),(0,J.e)([(0,R.z)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"texture",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsMiscDirty")],F.prototype,"legacy",void 0);class f extends x.c{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class v extends q.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(G,"Sheen",120,new f,V),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.Xz=1,this.color=g.d.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=G._dirtyCallbacks[1]}isReadyForSubMesh(G,V){if(!this._isEnabled)return!0;if(G._areTexturesDirty&&V.texturesEnabled){if(this._texture&&r.c.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&r.c.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(G,V){this._isEnabled?(G.SHEEN=!0,G.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,G.SHEEN_ROUGHNESS=null!==this._roughness,G.SHEEN_ALBEDOSCALING=this._albedoScaling,G.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,G._areTexturesDirty&&V.texturesEnabled&&(this._texture&&r.c.SheenTextureEnabled?((0,u.R)(this._texture,G,"SHEEN_TEXTURE"),G.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):G.SHEEN_TEXTURE=!1,this._textureRoughness&&r.c.SheenTextureEnabled?(0,u.R)(this._textureRoughness,G,"SHEEN_TEXTURE_ROUGHNESS"):G.SHEEN_TEXTURE_ROUGHNESS=!1)):(G.SHEEN=!1,G.SHEEN_TEXTURE=!1,G.SHEEN_TEXTURE_ROUGHNESS=!1,G.SHEEN_LINKWITHALBEDO=!1,G.SHEEN_ROUGHNESS=!1,G.SHEEN_ALBEDOSCALING=!1,G.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,G.SHEEN_GAMMATEXTURE=!1,G.SHEEN_TEXTUREDIRECTUV=0,G.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(G,V,W,J){if(!this._isEnabled)return;const R=J.materialDefines,d=this._material.isFrozen;if(!G.useUbo||!d||!G.isSync){var k,z,X,P;if((this._texture||this._textureRoughness)&&r.c.SheenTextureEnabled)G.updateFloat4("vSheenInfos",(null===(k=this._texture)||void 0===k?void 0:k.coordinatesIndex)??0,(null===(z=this._texture)||void 0===z?void 0:z.level)??0,(null===(X=this._textureRoughness)||void 0===X?void 0:X.coordinatesIndex)??0,(null===(P=this._textureRoughness)||void 0===P?void 0:P.level)??0),this._texture&&(0,u.t)(this._texture,G,"sheen"),this._textureRoughness&&!R.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,u.t)(this._textureRoughness,G,"sheenRoughness");G.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.Xz),null!==this._roughness&&G.updateFloat("vSheenRoughness",this._roughness)}V.texturesEnabled&&(this._texture&&r.c.SheenTextureEnabled&&G.setTexture("sheenSampler",this._texture),this._textureRoughness&&!R.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&r.c.SheenTextureEnabled&&G.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(G){return this._texture===G||this._textureRoughness===G}getActiveTextures(G){this._texture&&G.push(this._texture),this._textureRoughness&&G.push(this._textureRoughness)}getAnimatables(G){this._texture&&this._texture.animations&&this._texture.animations.length>0&&G.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&G.push(this._textureRoughness)}dispose(G){var V,W;G&&(null===(V=this._texture)||void 0===V||V.dispose(),null===(W=this._textureRoughness)||void 0===W||W.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(G,V,W){return G.SHEEN&&V.addFallback(W++,"SHEEN"),W}getSamplers(G){G.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"isEnabled",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"linkSheenWithAlbedo",void 0),(0,J.e)([(0,R.I)()],v.prototype,"intensity",void 0),(0,J.e)([(0,R.m)()],v.prototype,"color",void 0),(0,J.e)([(0,R.z)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"texture",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useRoughnessFromMainTexture",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"roughness",void 0),(0,J.e)([(0,R.z)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"textureRoughness",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"albedoScaling",void 0);class C extends x.c{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1,this.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1,this.SS_TRANSLUCENCY_LEGACY=!1}}class l extends q.b{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(G){this._scene.enableSubSurfaceForPrePass()&&G&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(G))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(G){this._volumeIndexOfRefraction=G>=1?G:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(G,"PBRSubSurface",130,new C,V),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=g.d.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=g.d.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this.applyAlbedoAfterSubSurface=l.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE,this.legacyTransluceny=l.DEFAULT_LEGACY_TRANSLUCENCY,this._scene=G.HG(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=G._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=G._dirtyCallbacks[32]}isReadyForSubMesh(G,V){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(G._areTexturesDirty&&V.texturesEnabled){if(this._thicknessTexture&&r.c.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&r.c.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&r.c.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const G=this._getRefractionTexture(V);if(G&&r.c.RefractionTextureEnabled&&!G.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(G,V){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return G.SUBSURFACE=!1,G.SS_DISPERSION=!1,G.SS_TRANSLUCENCY=!1,G.SS_SCATTERING=!1,G.SS_REFRACTION=!1,G.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,G.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,G.SS_THICKNESSANDMASK_TEXTURE=!1,G.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,G.SS_HAS_THICKNESS=!1,G.SS_REFRACTIONINTENSITY_TEXTURE=!1,G.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,G.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,G.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,G.SS_REFRACTIONMAP_3D=!1,G.SS_REFRACTIONMAP_OPPOSITEZ=!1,G.SS_LODINREFRACTIONALPHA=!1,G.SS_GAMMAREFRACTION=!1,G.SS_RGBDREFRACTION=!1,G.SS_LINEARSPECULARREFRACTION=!1,G.SS_LINKREFRACTIONTOTRANSPARENCY=!1,G.SS_ALBEDOFORREFRACTIONTINT=!1,G.SS_ALBEDOFORTRANSLUCENCYTINT=!1,G.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,G.SS_USE_THICKNESS_AS_DEPTH=!1,G.SS_USE_GLTF_TEXTURES=!1,G.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,G.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,G.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,void(G.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1);if(G._areTexturesDirty){if(G.SUBSURFACE=!0,G.SS_DISPERSION=this._isDispersionEnabled,G.SS_TRANSLUCENCY=this._isTranslucencyEnabled,G.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,G.SS_TRANSLUCENCY_LEGACY=this.legacyTransluceny,G.SS_SCATTERING=this._isScatteringEnabled,G.SS_THICKNESSANDMASK_TEXTURE=!1,G.SS_REFRACTIONINTENSITY_TEXTURE=!1,G.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,G.SS_HAS_THICKNESS=!1,G.SS_USE_GLTF_TEXTURES=!1,G.SS_REFRACTION=!1,G.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,G.SS_REFRACTIONMAP_3D=!1,G.SS_GAMMAREFRACTION=!1,G.SS_RGBDREFRACTION=!1,G.SS_LINEARSPECULARREFRACTION=!1,G.SS_REFRACTIONMAP_OPPOSITEZ=!1,G.SS_LODINREFRACTIONALPHA=!1,G.SS_LINKREFRACTIONTOTRANSPARENCY=!1,G.SS_ALBEDOFORREFRACTIONTINT=!1,G.SS_ALBEDOFORTRANSLUCENCYTINT=!1,G.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,G.SS_USE_THICKNESS_AS_DEPTH=!1,G.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,G.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=this.applyAlbedoAfterSubSurface,G._areTexturesDirty&&V.texturesEnabled&&(this._thicknessTexture&&r.c.ThicknessTextureEnabled&&(0,u.R)(this._thicknessTexture,G,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&r.c.RefractionIntensityTextureEnabled&&(0,u.R)(this._refractionIntensityTexture,G,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&r.c.TranslucencyIntensityTextureEnabled&&(0,u.R)(this._translucencyIntensityTexture,G,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&r.c.TranslucencyColorTextureEnabled&&((0,u.R)(this._translucencyColorTexture,G,"SS_TRANSLUCENCYCOLOR_TEXTURE"),G.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=this._translucencyColorTexture.gammaSpace)),G.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,G.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,G.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,G.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&V.texturesEnabled){const W=this._getRefractionTexture(V);W&&r.c.RefractionTextureEnabled&&(G.SS_REFRACTION=!0,G.SS_REFRACTIONMAP_3D=W.isCube,G.SS_GAMMAREFRACTION=W.gammaSpace,G.SS_RGBDREFRACTION=W.isRGBD,G.SS_LINEARSPECULARREFRACTION=W.linearSpecularLOD,G.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&W.isCube?!W.invertZ:W.invertZ,G.SS_LODINREFRACTIONALPHA=W.lodLevelInAlpha,G.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,G.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,G.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=W.isCube&&W.boundingBoxSize,G.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(G.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(G,V,W,J){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)G.updateFloat2("vThicknessParam",0,0);else{J.getRenderingMesh().getWorldMatrix().decompose(P.h.ed[0]);const V=Math.max(Math.abs(P.h.ed[0].x),Math.abs(P.h.ed[0].y),Math.abs(P.h.ed[0].z));G.updateFloat2("vThicknessParam",this.minimumThickness*V,(this.maximumThickness-this.minimumThickness)*V)}}bindForSubMesh(G,V,W,J){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const R=J.materialDefines,d=this._material.isFrozen,k=this._material.realTimeFiltering,z=R.LODBASEDMICROSFURACE,X=this._getRefractionTexture(V);if(!G.useUbo||!d||!G.isSync){if(this._thicknessTexture&&r.c.ThicknessTextureEnabled&&(G.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,u.t)(this._thicknessTexture,G,"thickness")),this._refractionIntensityTexture&&r.c.RefractionIntensityTextureEnabled&&R.SS_REFRACTIONINTENSITY_TEXTURE&&(G.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,u.t)(this._refractionIntensityTexture,G,"refractionIntensity")),this._translucencyColorTexture&&r.c.TranslucencyColorTextureEnabled&&R.SS_TRANSLUCENCYCOLOR_TEXTURE&&(G.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,u.t)(this._translucencyColorTexture,G,"translucencyColor")),this._translucencyIntensityTexture&&r.c.TranslucencyIntensityTextureEnabled&&R.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(G.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,u.t)(this._translucencyIntensityTexture,G,"translucencyIntensity")),X&&r.c.RefractionTextureEnabled){G.Td("refractionMatrix",X.getRefractionTextureMatrix());let V=1;X.isCube||X.depth&&(V=X.depth);const W=X.getSize().width,J=this.volumeIndexOfRefraction;if(G.updateFloat4("vRefractionInfos",X.level,1/J,V,this._invertRefractionY?-1:1),G.updateFloat4("vRefractionMicrosurfaceInfos",W,X.lodGenerationScale,X.lodGenerationOffset,1/this.indexOfRefraction),k&&G.updateFloat2("vRefractionFilteringInfo",W,Math.log2(W)),X.boundingBoxSize){const V=X;G.updateVector3("vRefractionPosition",V.boundingBoxPosition),G.updateVector3("vRefractionSize",V.boundingBoxSize)}}this._isScatteringEnabled&&G.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),G.updateColor3("vDiffusionDistance",this.diffusionDistance),G.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),G.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),G.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),G.updateFloat("dispersion",this.dispersion)}V.texturesEnabled&&(this._thicknessTexture&&r.c.ThicknessTextureEnabled&&G.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&r.c.RefractionIntensityTextureEnabled&&R.SS_REFRACTIONINTENSITY_TEXTURE&&G.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&r.c.TranslucencyIntensityTextureEnabled&&R.SS_TRANSLUCENCYINTENSITY_TEXTURE&&G.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&r.c.TranslucencyColorTextureEnabled&&R.SS_TRANSLUCENCYCOLOR_TEXTURE&&G.setTexture("translucencyColorSampler",this._translucencyColorTexture),X&&r.c.RefractionTextureEnabled&&(z?G.setTexture("refractionSampler",X):(G.setTexture("refractionSampler",X._lodTextureMid||X),G.setTexture("refractionSamplerLow",X._lodTextureLow||X),G.setTexture("refractionSamplerHigh",X._lodTextureHigh||X))))}_getRefractionTexture(G){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?G.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(G){r.c.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&G.push(this._refractionTexture)}hasTexture(G){return this._thicknessTexture===G||(this._refractionTexture===G||(this._refractionIntensityTexture===G||(this._translucencyIntensityTexture===G||this._translucencyColorTexture===G)))}hasRenderTargetTextures(){return!!(r.c.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(G){this._thicknessTexture&&G.push(this._thicknessTexture),this._refractionTexture&&G.push(this._refractionTexture),this._translucencyColorTexture&&G.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&G.push(this._translucencyIntensityTexture)}getAnimatables(G){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&G.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&G.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&G.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&G.push(this._translucencyIntensityTexture)}dispose(G){G&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(G,V,W){return G.SS_SCATTERING&&V.addFallback(W++,"SS_SCATTERING"),G.SS_TRANSLUCENCY&&V.addFallback(W++,"SS_TRANSLUCENCY"),W}getSamplers(G){G.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}l.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE=!1,l.DEFAULT_LEGACY_TRANSLUCENCY=!1,(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"isRefractionEnabled",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"isTranslucencyEnabled",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"isDispersionEnabled",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markScenePrePassDirty")],l.prototype,"isScatteringEnabled",void 0),(0,J.e)([(0,R.I)()],l.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,J.e)([(0,R.I)()],l.prototype,"refractionIntensity",void 0),(0,J.e)([(0,R.I)()],l.prototype,"translucencyIntensity",void 0),(0,J.e)([(0,R.I)()],l.prototype,"useAlbedoToTintRefraction",void 0),(0,J.e)([(0,R.I)()],l.prototype,"useAlbedoToTintTranslucency",void 0),(0,J.e)([(0,R.z)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"thicknessTexture",void 0),(0,J.e)([(0,R.z)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"refractionTexture",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"indexOfRefraction",void 0),(0,J.e)([(0,R.I)()],l.prototype,"_volumeIndexOfRefraction",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"volumeIndexOfRefraction",null),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"invertRefractionY",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"linkRefractionWithTransparency",void 0),(0,J.e)([(0,R.I)()],l.prototype,"minimumThickness",void 0),(0,J.e)([(0,R.I)()],l.prototype,"maximumThickness",void 0),(0,J.e)([(0,R.I)()],l.prototype,"useThicknessAsDepth",void 0),(0,J.e)([(0,R.m)()],l.prototype,"tintColor",void 0),(0,J.e)([(0,R.I)()],l.prototype,"tintColorAtDistance",void 0),(0,J.e)([(0,R.I)()],l.prototype,"dispersion",void 0),(0,J.e)([(0,R.m)()],l.prototype,"diffusionDistance",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"useMaskFromThicknessTexture",void 0),(0,J.e)([(0,R.z)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"refractionIntensityTexture",void 0),(0,J.e)([(0,R.z)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"translucencyIntensityTexture",void 0),(0,J.e)([(0,R.m)()],l.prototype,"translucencyColor",void 0),(0,J.e)([(0,R.z)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"translucencyColorTexture",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"useGltfStyleTextures",void 0),(0,J.e)([(0,R.I)()],l.prototype,"applyAlbedoAfterSubSurface",void 0),(0,J.e)([(0,R.I)()],l.prototype,"legacyTransluceny",void 0);var m=W(11835),w=W(11449),N=W(11838);const U={effect:null,subMesh:null};class a extends x.c{constructor(G){super(G),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.IBL_CDF_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BASE_WEIGHT=!1,this.BASE_WEIGHTDIRECTUV=0,this.BASE_DIFFUSE_ROUGHNESS=!1,this.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.MIRRORED=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class M extends p.d{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(G){this._realTimeFiltering=G,this.pP(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(G){this._realTimeFilteringQuality=G,this.pP(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(G){G!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=G||this.HG().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(G,V){super(G,V,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||M.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new P.q(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._baseWeightTexture=null,this._baseDiffuseRoughnessTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=M.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=g.d.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new g.d(0,0,0),this._albedoColor=new g.d(1,1,1),this._baseWeight=1,this._baseDiffuseRoughness=null,this._reflectivityColor=new g.d(1,1,1),this._reflectionColor=new g.d(1,1,1),this._emissiveColor=new g.d(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=M.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new k.f(16),this._globalAmbientColor=new g.d(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new t(this),this.clearCoat=new n(this),this.iridescence=new i(this),this.anisotropy=new F(this),this.sheen=new v(this),this.subSurface=new l(this),this.detailMap=new m.b(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),r.c.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,z.b)(this.HG()),this.prePassConfiguration=new Y.b}get hasRenderTargetTextures(){return!!(r.c.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var G;return this._transparencyMode===M.PBRMATERIAL_OPAQUE||this._transparencyMode===M.PBRMATERIAL_ALPHATEST||(null===(G=this.subSurface)||void 0===G?void 0:G.disableAlphaBlending)}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var G;return this._hasTransparencyMode?this._transparencyModeIsTest:(null===(G=this.subSurface)||void 0===G||!G.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===M.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.bd&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==M.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.bd||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(G,V,W){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const J=V._drawWrapper;if(J.effect&&this.isFrozen&&J._wasPreviouslyReady&&J._wasPreviouslyUsingInstances===W)return!0;V.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),V.materialDefines=new a(this._eventInfo.defineNames));const R=V.materialDefines;if(this._isReadyForSubMesh(V))return!0;const k=this.HG(),z=k.getEngine();if(R._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,k.texturesEnabled)){if(this._albedoTexture&&r.c.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._baseWeightTexture&&r.c.BaseWeightTextureEnabled&&!this._baseWeightTexture.isReadyOrNotBlocking())return!1;if(this._baseDiffuseRoughnessTexture&&r.c.BaseDiffuseRoughnessTextureEnabled&&!this._baseDiffuseRoughnessTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&r.c.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&r.c.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const G=this._getReflectionTexture();if(G&&r.c.ReflectionTextureEnabled){if(!G.isReadyOrNotBlocking())return!1;var X;if(G.irradianceTexture){if(!G.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!G.sphericalPolynomial&&null!==(X=G.getInternalTexture())&&void 0!==X&&X._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&r.c.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&r.c.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(r.c.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(z.getCaps().standardDerivatives&&this._bumpTexture&&r.c.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&r.c.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=R,this._eventInfo.subMesh=V,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(R._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;if(R.AREALIGHTUSED)for(let d=0;d<G.lightSources.length;d++)if(!G.lightSources[d]._isReady())return!1;z.getCaps().standardDerivatives||G.isVerticesDataPresent(A.c.NormalKind)||(G.createNormals(!0),d.c.Warn("PBRMaterial: Normals have been created for the mesh: "+G.name));const P=V.effect,x=R._areLightsDisposed;let q=this._prepareEffect(G,R,this.onCompiled,this.onError,W,null,V.getRenderingMesh().hasThinInstances),L=!1;if(q)if(this._onEffectCreatedObservable&&(U.effect=q,U.subMesh=V,this._onEffectCreatedObservable.notifyObservers(U)),this.allowShaderHotSwapping&&P&&!q.isReady()){if(q=P,R.markAsUnprocessed(),L=this.isFrozen,x)return R._areLightsDisposed=!0,!1}else k.resetCachedMaterial(),V.setEffect(q,R,this._materialContext);return!(!V.effect||!V.effect.isReady())&&(R._renderId=k.getRenderId(),J._wasPreviouslyReady=!L,J._wasPreviouslyUsingInstances=!!W,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(G,V){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(G,V,d,k,z),!V.isDirty)return null;V.markAsProcessed();const X=this.HG().getEngine(),P=new y.b;let x=0;V.USESPHERICALINVERTEX&&P.addFallback(x++,"USESPHERICALINVERTEX"),V.FOG&&P.addFallback(x,"FOG"),V.SPECULARAA&&P.addFallback(x,"SPECULARAA"),V.POINTSIZE&&P.addFallback(x,"POINTSIZE"),V.LOGARITHMICDEPTH&&P.addFallback(x,"LOGARITHMICDEPTH"),V.PARALLAX&&P.addFallback(x,"PARALLAX"),V.PARALLAX_RHS&&P.addFallback(x,"PARALLAX_RHS"),V.PARALLAXOCCLUSION&&P.addFallback(x++,"PARALLAXOCCLUSION"),V.ENVIRONMENTBRDF&&P.addFallback(x++,"ENVIRONMENTBRDF"),V.TANGENT&&P.addFallback(x++,"TANGENT"),V.BUMP&&P.addFallback(x++,"BUMP"),x=(0,u.v)(V,P,this._maxSimultaneousLights,x++),V.SPECULARTERM&&P.addFallback(x++,"SPECULARTERM"),V.USESPHERICALFROMREFLECTIONMAP&&P.addFallback(x++,"USESPHERICALFROMREFLECTIONMAP"),V.USEIRRADIANCEMAP&&P.addFallback(x++,"USEIRRADIANCEMAP"),V.LIGHTMAP&&P.addFallback(x++,"LIGHTMAP"),V.NORMAL&&P.addFallback(x++,"NORMAL"),V.AMBIENT&&P.addFallback(x++,"AMBIENT"),V.EMISSIVE&&P.addFallback(x++,"EMISSIVE"),V.VERTEXCOLOR&&P.addFallback(x++,"VERTEXCOLOR"),V.MORPHTARGETS&&P.addFallback(x++,"MORPHTARGETS"),V.MULTIVIEW&&P.addFallback(0,"MULTIVIEW");const q=[A.c.PositionKind];V.NORMAL&&q.push(A.c.NormalKind),V.TANGENT&&q.push(A.c.TangentKind);for(let W=1;W<=6;++W)V["UV"+W]&&q.push(`uv${1===W?"":W}`);V.VERTEXCOLOR&&q.push(A.c.ColorKind),(0,u.B)(q,G,V,P),(0,u.D)(q,V),(0,u.F)(q,G,V),(0,u.y)(q,G,V);let L="pbr";const t=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","baseWeight","baseDiffuseRoughness","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vBaseWeightInfos","vBaseDiffuseRoughnessInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","baseWeightMatrix","baseDiffuseRoughnessMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vReflectionDominantDirection","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],g=["albedoSampler","baseWeightSampler","baseDiffuseRoughnessSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","icdfSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],S=["Material","Scene","Mesh"],p={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:V.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=P,this._eventInfo.fallbackRank=x,this._eventInfo.defines=V,this._eventInfo.uniforms=t,this._eventInfo.attributes=q,this._eventInfo.samplers=g,this._eventInfo.uniformBuffersNames=S,this._eventInfo.customCode=void 0,this._eventInfo.mesh=G,this._eventInfo.indexParameters=p,this._callbackPluginEventGeneric(128,this._eventInfo),N.e.AddUniformsAndSamplers(t,g),Y.b.AddUniforms(t),Y.b.AddSamplers(g),(0,w.c)(t),B.e&&(B.e.PrepareUniforms(t,V),B.e.PrepareSamplers(g,V)),(0,u.db)({uniformsNames:t,uniformBuffersNames:S,samplers:g,defines:V,maxSimultaneousLights:this._maxSimultaneousLights});const b={};this.customShaderNameResolve&&(L=this.customShaderNameResolve(L,t,S,g,V,q,b));const r=V.toString(),H=X.createEffect(L,{attributes:q,uniformsNames:t,uniformBuffersNames:S,samplers:g,defines:r,fallbacks:P,onCompiled:J,onError:R,indexParameters:p,processFinalCode:b.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:V.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([W.e(20),W.e(45)]).then(W.bind(W,13901)),Promise.all([W.e(18),W.e(46)]).then(W.bind(W,14032))]):await Promise.all([Promise.all([W.e(13),W.e(48)]).then(W.bind(W,14123)),Promise.all([W.e(12),W.e(49)]).then(W.bind(W,14281))]),this._shadersLoaded=!0}},X);return this._eventInfo.customCode=void 0,H}_prepareDefines(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,R=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const d=this.HG(),k=d.getEngine();(0,u.P)(d,G,V,!0,this._maxSimultaneousLights,this._disableLighting),V._needNormals=!0,(0,u.W)(d,V);const z=this.needAlphaBlendingForMesh(G)&&this.HG().useOrderIndependentTransparency;if((0,u.ab)(d,V,this.canRenderToMRT&&!z),(0,u.Z)(d,V,z),N.e.PrepareDefines(k.currentRenderPassId,G,V),V.METALLICWORKFLOW=this.isMetallicWorkflow(),V._areTexturesDirty){V._needUVs=!1;for(let G=1;G<=6;++G)V["MAINUV"+G]=!1;if(d.texturesEnabled){V.ALBEDODIRECTUV=0,V.BASE_WEIGHTDIRECTUV=0,V.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,V.AMBIENTDIRECTUV=0,V.OPACITYDIRECTUV=0,V.EMISSIVEDIRECTUV=0,V.REFLECTIVITYDIRECTUV=0,V.MICROSURFACEMAPDIRECTUV=0,V.METALLIC_REFLECTANCEDIRECTUV=0,V.REFLECTANCEDIRECTUV=0,V.BUMPDIRECTUV=0,V.LIGHTMAPDIRECTUV=0,k.getCaps().textureLOD&&(V.LODBASEDMICROSFURACE=!0),this._albedoTexture&&r.c.DiffuseTextureEnabled?((0,u.R)(this._albedoTexture,V,"ALBEDO"),V.GAMMAALBEDO=this._albedoTexture.gammaSpace):V.ALBEDO=!1,this._baseWeightTexture&&r.c.BaseWeightTextureEnabled?(0,u.R)(this._baseWeightTexture,V,"BASE_WEIGHT"):V.BASE_WEIGHT=!1,this._baseDiffuseRoughnessTexture&&r.c.BaseDiffuseRoughnessTextureEnabled?(0,u.R)(this._baseDiffuseRoughnessTexture,V,"BASE_DIFFUSE_ROUGHNESS"):V.BASE_DIFFUSE_ROUGHNESS=!1,this._ambientTexture&&r.c.AmbientTextureEnabled?((0,u.R)(this._ambientTexture,V,"AMBIENT"),V.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):V.AMBIENT=!1,this._opacityTexture&&r.c.OpacityTextureEnabled?((0,u.R)(this._opacityTexture,V,"OPACITY"),V.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):V.OPACITY=!1;const G=this._getReflectionTexture();if(G&&r.c.ReflectionTextureEnabled){switch(V.REFLECTION=!0,V.GAMMAREFLECTION=G.gammaSpace,V.RGBDREFLECTION=G.isRGBD,V.LODINREFLECTIONALPHA=G.lodLevelInAlpha,V.LINEARSPECULARREFLECTION=G.linearSpecularLOD,V.USEIRRADIANCEMAP=!1,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(V.NUM_SAMPLES=""+this.realTimeFilteringQuality,k._features.needTypeSuffixInShaderConstants&&(V.NUM_SAMPLES=V.NUM_SAMPLES+"u"),V.REALTIME_FILTERING=!0,this.HG().iblCdfGenerator&&(V.IBL_CDF_FILTERING=!0)):V.REALTIME_FILTERING=!1,V.INVERTCUBICMAP=G.coordinatesMode===b.d.INVCUBIC_MODE,V.REFLECTIONMAP_3D=G.isCube,V.REFLECTIONMAP_OPPOSITEZ=V.REFLECTIONMAP_3D&&this.HG().useRightHandedSystem?!G.invertZ:G.invertZ,V.REFLECTIONMAP_CUBIC=!1,V.REFLECTIONMAP_EXPLICIT=!1,V.REFLECTIONMAP_PLANAR=!1,V.REFLECTIONMAP_PROJECTION=!1,V.REFLECTIONMAP_SKYBOX=!1,V.REFLECTIONMAP_SPHERICAL=!1,V.REFLECTIONMAP_EQUIRECTANGULAR=!1,V.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,V.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,G.coordinatesMode){case b.d.EXPLICIT_MODE:V.REFLECTIONMAP_EXPLICIT=!0;break;case b.d.PLANAR_MODE:V.REFLECTIONMAP_PLANAR=!0;break;case b.d.PROJECTION_MODE:V.REFLECTIONMAP_PROJECTION=!0;break;case b.d.SKYBOX_MODE:V.REFLECTIONMAP_SKYBOX=!0;break;case b.d.SPHERICAL_MODE:V.REFLECTIONMAP_SPHERICAL=!0;break;case b.d.EQUIRECTANGULAR_MODE:V.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case b.d.FIXED_EQUIRECTANGULAR_MODE:V.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case b.d.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:V.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case b.d.CUBIC_MODE:case b.d.INVCUBIC_MODE:default:V.REFLECTIONMAP_CUBIC=!0,V.USE_LOCAL_REFLECTIONMAP_CUBIC=!!G.boundingBoxSize}G.coordinatesMode!==b.d.SKYBOX_MODE&&(G.irradianceTexture?(V.USEIRRADIANCEMAP=!0,V.USESPHERICALFROMREFLECTIONMAP=!1,V.USESPHERICALINVERTEX=!1,G.irradianceTexture._dominantDirection&&(V.USE_IRRADIANCE_DOMINANT_DIRECTION=!0)):G.isCube&&(V.USESPHERICALFROMREFLECTIONMAP=!0,V.USEIRRADIANCEMAP=!1,V.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||k.getCaps().maxVaryingVectors<=8||this._baseDiffuseRoughnessTexture?V.USESPHERICALINVERTEX=!1:V.USESPHERICALINVERTEX=!0))}else V.REFLECTION=!1,V.REFLECTIONMAP_3D=!1,V.REFLECTIONMAP_SPHERICAL=!1,V.REFLECTIONMAP_PLANAR=!1,V.REFLECTIONMAP_CUBIC=!1,V.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,V.REFLECTIONMAP_PROJECTION=!1,V.REFLECTIONMAP_SKYBOX=!1,V.REFLECTIONMAP_EXPLICIT=!1,V.REFLECTIONMAP_EQUIRECTANGULAR=!1,V.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,V.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,V.INVERTCUBICMAP=!1,V.USESPHERICALFROMREFLECTIONMAP=!1,V.USEIRRADIANCEMAP=!1,V.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,V.USESPHERICALINVERTEX=!1,V.REFLECTIONMAP_OPPOSITEZ=!1,V.LODINREFLECTIONALPHA=!1,V.GAMMAREFLECTION=!1,V.RGBDREFLECTION=!1,V.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&r.c.LightmapTextureEnabled?((0,u.R)(this._lightmapTexture,V,"LIGHTMAP"),V.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,V.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,V.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):V.LIGHTMAP=!1,this._emissiveTexture&&r.c.EmissiveTextureEnabled?((0,u.R)(this._emissiveTexture,V,"EMISSIVE"),V.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):V.EMISSIVE=!1,r.c.SpecularTextureEnabled?(this._metallicTexture?((0,u.R)(this._metallicTexture,V,"REFLECTIVITY"),V.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,V.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,V.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,V.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,V.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,u.R)(this._reflectivityTexture,V,"REFLECTIVITY"),V.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,V.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,V.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):V.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(V.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,u.R)(this._metallicReflectanceTexture,V,"METALLIC_REFLECTANCE"),V.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):V.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,u.R)(this._reflectanceTexture,V,"REFLECTANCE"),V.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):V.REFLECTANCE=!1):(V.METALLIC_REFLECTANCE=!1,V.REFLECTANCE=!1),this._microSurfaceTexture?(0,u.R)(this._microSurfaceTexture,V,"MICROSURFACEMAP"):V.MICROSURFACEMAP=!1):(V.REFLECTIVITY=!1,V.MICROSURFACEMAP=!1),k.getCaps().standardDerivatives&&this._bumpTexture&&r.c.BumpTextureEnabled&&!this._disableBumpMap?((0,u.R)(this._bumpTexture,V,"BUMP"),this._useParallax&&this._albedoTexture&&r.c.DiffuseTextureEnabled?(V.PARALLAX=!0,V.PARALLAX_RHS=d.useRightHandedSystem,V.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):V.PARALLAX=!1,V.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(V.BUMP=!1,V.PARALLAX=!1,V.PARALLAX_RHS=!1,V.PARALLAXOCCLUSION=!1,V.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&r.c.ReflectionTextureEnabled?(V.ENVIRONMENTBRDF=!0,V.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(V.ENVIRONMENTBRDF=!1,V.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?V.ALPHAFROMALBEDO=!0:V.ALPHAFROMALBEDO=!1}V.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===M.LIGHTFALLOFF_STANDARD?(V.USEPHYSICALLIGHTFALLOFF=!1,V.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===M.LIGHTFALLOFF_GLTF?(V.USEPHYSICALLIGHTFALLOFF=!1,V.USEGLTFLIGHTFALLOFF=!0):(V.USEPHYSICALLIGHTFALLOFF=!0,V.USEGLTFLIGHTFALLOFF=!1),V.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.gd&&this._twoSidedLighting?V.TWOSIDEDLIGHTING=!0:V.TWOSIDEDLIGHTING=!1,V.MIRRORED=!!d._mirroredCameraPosition,V.SPECULARAA=k.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(V._areTexturesDirty||V._areMiscDirty)&&(V.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,V.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,V.ALPHABLEND=this.needAlphaBlendingForMesh(G),V.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,V.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),V._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(V),V.FORCENORMALFORWARD=this._forceNormalForward,V.RADIANCEOCCLUSION=this._useRadianceOcclusion,V.HORIZONOCCLUSION=this._useHorizonOcclusion,V._areMiscDirty&&((0,u.U)(G,d,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(G),V,this._applyDecalMapAfterDetailMap),V.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!G.isVerticesDataPresent(A.c.NormalKind),V.DEBUGMODE=this._debugMode),(0,u.N)(d,k,this,V,!!W,J,R),this._eventInfo.defines=V,this._eventInfo.mesh=G,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,u.M)(G,V,!0,!0,!0,this._transparencyMode!==M.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(G,V,W){const J={clipPlane:!1,useInstances:!1,...W};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const W=new a(this._eventInfo.defineNames),R=this._prepareEffect(G,W,void 0,void 0,J.useInstances,J.clipPlane,G.hasThinInstances);this._onEffectCreatedObservable&&(U.effect=R,U.subMesh=null,this._onEffectCreatedObservable.notifyObservers(U)),R.isReady()?V&&V(this):R.onCompileObservable.add((()=>{V&&V(this)}))})()}buildUniformLayout(){const G=this._uniformBuffer;G.addUniform("vAlbedoInfos",2),G.addUniform("vBaseWeightInfos",2),G.addUniform("vBaseDiffuseRoughnessInfos",2),G.addUniform("vAmbientInfos",4),G.addUniform("vOpacityInfos",2),G.addUniform("vEmissiveInfos",2),G.addUniform("vLightmapInfos",2),G.addUniform("vReflectivityInfos",3),G.addUniform("vMicroSurfaceSamplerInfos",2),G.addUniform("vReflectionInfos",2),G.addUniform("vReflectionFilteringInfo",2),G.addUniform("vReflectionPosition",3),G.addUniform("vReflectionSize",3),G.addUniform("vBumpInfos",3),G.addUniform("albedoMatrix",16),G.addUniform("baseWeightMatrix",16),G.addUniform("baseDiffuseRoughnessMatrix",16),G.addUniform("ambientMatrix",16),G.addUniform("opacityMatrix",16),G.addUniform("emissiveMatrix",16),G.addUniform("lightmapMatrix",16),G.addUniform("reflectivityMatrix",16),G.addUniform("microSurfaceSamplerMatrix",16),G.addUniform("bumpMatrix",16),G.addUniform("vTangentSpaceParams",2),G.addUniform("reflectionMatrix",16),G.addUniform("vReflectionColor",3),G.addUniform("vAlbedoColor",4),G.addUniform("baseWeight",1),G.addUniform("baseDiffuseRoughness",1),G.addUniform("vLightingIntensity",4),G.addUniform("vReflectionMicrosurfaceInfos",3),G.addUniform("vReflectionDominantDirection",3),G.addUniform("pointSize",1),G.addUniform("vReflectivityColor",4),G.addUniform("vEmissiveColor",3),G.addUniform("vAmbientColor",3),G.addUniform("vDebugMode",2),G.addUniform("vMetallicReflectanceFactors",4),G.addUniform("vMetallicReflectanceInfos",2),G.addUniform("metallicReflectanceMatrix",16),G.addUniform("vReflectanceInfos",2),G.addUniform("reflectanceMatrix",16),G.addUniform("vSphericalL00",3),G.addUniform("vSphericalL1_1",3),G.addUniform("vSphericalL10",3),G.addUniform("vSphericalL11",3),G.addUniform("vSphericalL2_2",3),G.addUniform("vSphericalL2_1",3),G.addUniform("vSphericalL20",3),G.addUniform("vSphericalL21",3),G.addUniform("vSphericalL22",3),G.addUniform("vSphericalX",3),G.addUniform("vSphericalY",3),G.addUniform("vSphericalZ",3),G.addUniform("vSphericalXX_ZZ",3),G.addUniform("vSphericalYY_ZZ",3),G.addUniform("vSphericalZZ",3),G.addUniform("vSphericalXY",3),G.addUniform("vSphericalYZ",3),G.addUniform("vSphericalZX",3),G.addUniform("cameraInfo",4),super.buildUniformLayout()}bindForSubMesh(G,V,W){const J=this.HG(),R=W.materialDefines;if(!R)return;const d=W.effect;if(!d)return;this._activeEffect=d,V.getMeshUniformBuffer().bindToEffect(d,"Mesh"),V.transferToEffect(G);const k=J.getEngine();this._uniformBuffer.bindToEffect(d,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,J,V,G,this.isFrozen),N.e.Bind(k.currentRenderPassId,this._activeEffect,V,G,this);const z=J.activeCamera;z?this._uniformBuffer.updateFloat4("cameraInfo",z.Zd,z.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=W,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),R.OBJECTSPACE_NORMALMAP&&(G.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const P=this._mustRebind(J,d,W,V.visibility);(0,u.c)(V,this._activeEffect,this.prePassConfiguration);let A=null;const x=this._uniformBuffer;if(P){if(this.bindViewProjection(d),A=this._getReflectionTexture(),!x.useUbo||!this.isFrozen||!x.isSync||W._drawWrapper._forceRebindOnNextCall){var q;if(J.texturesEnabled){if(this._albedoTexture&&r.c.DiffuseTextureEnabled&&(x.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,u.t)(this._albedoTexture,x,"albedo")),this._baseWeightTexture&&r.c.BaseWeightTextureEnabled&&(x.updateFloat2("vBaseWeightInfos",this._baseWeightTexture.coordinatesIndex,this._baseWeightTexture.level),(0,u.t)(this._baseWeightTexture,x,"baseWeight")),this._baseDiffuseRoughnessTexture&&r.c.BaseDiffuseRoughnessTextureEnabled&&(x.updateFloat2("vBaseDiffuseRoughnessInfos",this._baseDiffuseRoughnessTexture.coordinatesIndex,this._baseDiffuseRoughnessTexture.level),(0,u.t)(this._baseDiffuseRoughnessTexture,x,"baseDiffuseRoughness")),this._ambientTexture&&r.c.AmbientTextureEnabled&&(x.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,u.t)(this._ambientTexture,x,"ambient")),this._opacityTexture&&r.c.OpacityTextureEnabled&&(x.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,u.t)(this._opacityTexture,x,"opacity")),A&&r.c.ReflectionTextureEnabled){if(x.Td("reflectionMatrix",A.getReflectionTextureMatrix()),x.updateFloat2("vReflectionInfos",A.level*J.iblIntensity,0),A.boundingBoxSize){const G=A;x.updateVector3("vReflectionPosition",G.boundingBoxPosition),x.updateVector3("vReflectionSize",G.boundingBoxSize)}if(this.realTimeFiltering){const G=A.getSize().width;x.updateFloat2("vReflectionFilteringInfo",G,Math.log2(G))}if(R.USEIRRADIANCEMAP)R.USEIRRADIANCEMAP&&R.USE_IRRADIANCE_DOMINANT_DIRECTION&&x.updateVector3("vReflectionDominantDirection",A.irradianceTexture._dominantDirection);else{const G=A.sphericalPolynomial;if(R.USESPHERICALFROMREFLECTIONMAP&&G)if(R.SPHERICAL_HARMONICS){const V=G.preScaledHarmonics;x.updateVector3("vSphericalL00",V.l00),x.updateVector3("vSphericalL1_1",V.l1_1),x.updateVector3("vSphericalL10",V.l10),x.updateVector3("vSphericalL11",V.l11),x.updateVector3("vSphericalL2_2",V.l2_2),x.updateVector3("vSphericalL2_1",V.l2_1),x.updateVector3("vSphericalL20",V.l20),x.updateVector3("vSphericalL21",V.l21),x.updateVector3("vSphericalL22",V.l22)}else x.updateFloat3("vSphericalX",G.x.x,G.x.y,G.x.z),x.updateFloat3("vSphericalY",G.y.x,G.y.y,G.y.z),x.updateFloat3("vSphericalZ",G.z.x,G.z.y,G.z.z),x.updateFloat3("vSphericalXX_ZZ",G.xx.x-G.zz.x,G.xx.y-G.zz.y,G.xx.z-G.zz.z),x.updateFloat3("vSphericalYY_ZZ",G.yy.x-G.zz.x,G.yy.y-G.zz.y,G.yy.z-G.zz.z),x.updateFloat3("vSphericalZZ",G.zz.x,G.zz.y,G.zz.z),x.updateFloat3("vSphericalXY",G.xy.x,G.xy.y,G.xy.z),x.updateFloat3("vSphericalYZ",G.yz.x,G.yz.y,G.yz.z),x.updateFloat3("vSphericalZX",G.zx.x,G.zx.y,G.zx.z)}x.updateFloat3("vReflectionMicrosurfaceInfos",A.getSize().width,A.lodGenerationScale,A.lodGenerationOffset)}this._emissiveTexture&&r.c.EmissiveTextureEnabled&&(x.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,u.t)(this._emissiveTexture,x,"emissive")),this._lightmapTexture&&r.c.LightmapTextureEnabled&&(x.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,u.t)(this._lightmapTexture,x,"lightmap")),r.c.SpecularTextureEnabled&&(this._metallicTexture?(x.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,u.t)(this._metallicTexture,x,"reflectivity")):this._reflectivityTexture&&(x.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,u.t)(this._reflectivityTexture,x,"reflectivity")),this._metallicReflectanceTexture&&(x.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,u.t)(this._metallicReflectanceTexture,x,"metallicReflectance")),this._reflectanceTexture&&R.REFLECTANCE&&(x.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,u.t)(this._reflectanceTexture,x,"reflectance")),this._microSurfaceTexture&&(x.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,u.t)(this._microSurfaceTexture,x,"microSurfaceSampler"))),this._bumpTexture&&k.getCaps().standardDerivatives&&r.c.BumpTextureEnabled&&!this._disableBumpMap&&(x.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,u.t)(this._bumpTexture,x,"bump"),J._mirroredCameraPosition?x.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):x.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&x.updateFloat("pointSize",this.pointSize),R.METALLICWORKFLOW){var L;g.j.nz[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,g.j.nz[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness;const G=(null===(L=this.subSurface)||void 0===L?void 0:L._indexOfRefraction)??1.5,V=1;g.j.nz[0].b=G;const W=Math.pow((G-V)/(G+V),2);g.j.nz[0].a=W,x.updateDirectColor4("vReflectivityColor",g.j.nz[0]),x.updateColor4("vMetallicReflectanceFactors",this._metallicReflectanceColor,this._metallicF0Factor)}else x.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);x.updateColor3("vEmissiveColor",r.c.EmissiveTextureEnabled?this._emissiveColor:g.d.BlackReadOnly),x.updateColor3("vReflectionColor",this._reflectionColor),!R.SS_REFRACTION&&null!==(q=this.subSurface)&&void 0!==q&&q._linkRefractionWithTransparency?x.updateColor4("vAlbedoColor",this._albedoColor,1):x.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),x.updateFloat("baseWeight",this._baseWeight),x.updateFloat("baseDiffuseRoughness",this._baseDiffuseRoughness||0),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*J.environmentIntensity,this._lightingInfos.w=this._specularIntensity,x.updateVector4("vLightingIntensity",this._lightingInfos),J.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),x.updateColor3("vAmbientColor",this._globalAmbientColor),x.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}if(J.texturesEnabled){if(this._albedoTexture&&r.c.DiffuseTextureEnabled&&x.setTexture("albedoSampler",this._albedoTexture),this._baseWeightTexture&&r.c.BaseWeightTextureEnabled&&x.setTexture("baseWeightSampler",this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&r.c.BaseDiffuseRoughnessTextureEnabled&&x.setTexture("baseDiffuseRoughnessSampler",this._baseDiffuseRoughnessTexture),this._ambientTexture&&r.c.AmbientTextureEnabled&&x.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&r.c.OpacityTextureEnabled&&x.setTexture("opacitySampler",this._opacityTexture),A&&r.c.ReflectionTextureEnabled){R.LODBASEDMICROSFURACE?x.setTexture("reflectionSampler",A):(x.setTexture("reflectionSampler",A._lodTextureMid||A),x.setTexture("reflectionSamplerLow",A._lodTextureLow||A),x.setTexture("reflectionSamplerHigh",A._lodTextureHigh||A)),R.USEIRRADIANCEMAP&&x.setTexture("irradianceSampler",A.irradianceTexture);const G=this.HG().iblCdfGenerator;this.realTimeFiltering&&G&&x.setTexture("icdfSampler",G.getIcdfTexture())}R.ENVIRONMENTBRDF&&x.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&r.c.EmissiveTextureEnabled&&x.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&r.c.LightmapTextureEnabled&&x.setTexture("lightmapSampler",this._lightmapTexture),r.c.SpecularTextureEnabled&&(this._metallicTexture?x.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&x.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&x.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&R.REFLECTANCE&&x.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&x.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&k.getCaps().standardDerivatives&&r.c.BumpTextureEnabled&&!this._disableBumpMap&&x.setTexture("bumpSampler",this._bumpTexture)}this.HG().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(V)&&this.HG().depthPeelingRenderer.bind(d),this._eventInfo.subMesh=W,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,w.f)(this._activeEffect,this,J),this.bindEyePosition(d)}else J.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(P||!this.isFrozen){var t;if(J.lightsEnabled&&!this._disableLighting&&(0,u.h)(J,V,this._activeEffect,R,this._maxSimultaneousLights),(J.fogEnabled&&V.applyFog&&J.fogMode!==X.e.FOGMODE_NONE||A||this.subSurface.refractionTexture||V.receiveShadows||R.PREPASS)&&this.bindView(d),(0,u.f)(J,V,this._activeEffect,!0),R.NUM_MORPH_INFLUENCERS&&(0,u.n)(V,this._activeEffect),R.BAKED_VERTEX_ANIMATION_TEXTURE)null===(t=V.bakedVertexAnimationManager)||void 0===t||t.bind(d,R.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,u.j)(R,this._activeEffect,J)}this._afterBind(V,this._activeEffect,W),x.update()}getAnimatables(){const G=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&G.push(this._albedoTexture),this._baseWeightTexture&&this._baseWeightTexture.animations&&this._baseWeightTexture.animations.length>0&&G.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&this._baseDiffuseRoughnessTexture.animations&&this._baseDiffuseRoughnessTexture.animations.length>0&&G.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&G.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&G.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&G.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&G.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?G.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&G.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&G.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&G.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&G.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&G.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&G.push(this._microSurfaceTexture),G}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.HG().environmentTexture}getActiveTextures(){const G=super.getActiveTextures();return this._albedoTexture&&G.push(this._albedoTexture),this._baseWeightTexture&&G.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&G.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&G.push(this._ambientTexture),this._opacityTexture&&G.push(this._opacityTexture),this._reflectionTexture&&G.push(this._reflectionTexture),this._emissiveTexture&&G.push(this._emissiveTexture),this._reflectivityTexture&&G.push(this._reflectivityTexture),this._metallicTexture&&G.push(this._metallicTexture),this._metallicReflectanceTexture&&G.push(this._metallicReflectanceTexture),this._reflectanceTexture&&G.push(this._reflectanceTexture),this._microSurfaceTexture&&G.push(this._microSurfaceTexture),this._bumpTexture&&G.push(this._bumpTexture),this._lightmapTexture&&G.push(this._lightmapTexture),G}hasTexture(G){return!!super.hasTexture(G)||(this._albedoTexture===G||(this._baseWeightTexture===G||(this._baseDiffuseRoughnessTexture===G||(this._ambientTexture===G||(this._opacityTexture===G||(this._reflectionTexture===G||(this._emissiveTexture===G||(this._reflectivityTexture===G||(this._metallicTexture===G||(this._metallicReflectanceTexture===G||(this._reflectanceTexture===G||(this._microSurfaceTexture===G||(this._bumpTexture===G||this._lightmapTexture===G)))))))))))))}setPrePassRenderer(){var G;if(null===(G=this.subSurface)||void 0===G||!G.isScatteringEnabled)return!1;const V=this.HG().enableSubSurfaceForPrePass();return V&&(V.enabled=!0),!0}dispose(G,V){var W,J,R,d,k,z,X,P,A,x,q,L,t,Y;(this._breakShaderLoadedCheck=!0,V)&&(this._environmentBRDFTexture&&this.HG().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(W=this._albedoTexture)||void 0===W||W.dispose(),null===(J=this._baseWeightTexture)||void 0===J||J.dispose(),null===(R=this._baseDiffuseRoughnessTexture)||void 0===R||R.dispose(),null===(d=this._ambientTexture)||void 0===d||d.dispose(),null===(k=this._opacityTexture)||void 0===k||k.dispose(),null===(z=this._reflectionTexture)||void 0===z||z.dispose(),null===(X=this._emissiveTexture)||void 0===X||X.dispose(),null===(P=this._metallicTexture)||void 0===P||P.dispose(),null===(A=this._reflectivityTexture)||void 0===A||A.dispose(),null===(x=this._bumpTexture)||void 0===x||x.dispose(),null===(q=this._lightmapTexture)||void 0===q||q.dispose(),null===(L=this._metallicReflectanceTexture)||void 0===L||L.dispose(),null===(t=this._reflectanceTexture)||void 0===t||t.dispose(),null===(Y=this._microSurfaceTexture)||void 0===Y||Y.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(G,V)}}M.PBRMATERIAL_OPAQUE=S.e.MATERIAL_OPAQUE,M.PBRMATERIAL_ALPHATEST=S.e.MATERIAL_ALPHATEST,M.PBRMATERIAL_ALPHABLEND=S.e.MATERIAL_ALPHABLEND,M.PBRMATERIAL_ALPHATESTANDBLEND=S.e.MATERIAL_ALPHATESTANDBLEND,M.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,M.LIGHTFALLOFF_PHYSICAL=0,M.LIGHTFALLOFF_GLTF=1,M.LIGHTFALLOFF_STANDARD=2,M.ForceGLSL=!1,(0,J.e)([(0,R.q)()],M.prototype,"_imageProcessingConfiguration",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsMiscDirty")],M.prototype,"debugMode",void 0)},11720:(G,V,W)=>{W.d(V,{d:()=>x});var J=W(11317),R=W(11324),d=W(11727),k=W(11424),z=W(11734),X=W(11159),P=W(11313),A=W(11411);class x extends z.b{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(G){this.subSurface.refractionTexture=G,G?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(G){this.subSurface.indexOfRefraction=G}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(G){this.subSurface.invertRefractionY=G}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(G){this.subSurface.linkRefractionWithTransparency=G,G&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===z.b.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(G){G!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=G?z.b.LIGHTFALLOFF_PHYSICAL:z.b.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===z.b.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(G){G!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=G?z.b.LIGHTFALLOFF_GLTF:z.b.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(G){this._attachImageProcessingConfiguration(G),this._markAllSubMeshesAsImageProcessingDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(G){this.imageProcessingConfiguration.colorCurvesEnabled=G}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(G){this.imageProcessingConfiguration.colorGradingEnabled=G}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(G){this._imageProcessingConfiguration.toneMappingEnabled=G}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(G){this._imageProcessingConfiguration.exposure=G}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(G){this._imageProcessingConfiguration.contrast=G}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(G){this._imageProcessingConfiguration.colorGradingTexture=G}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(G){this._imageProcessingConfiguration.colorCurves=G}constructor(G,V){super(G,V,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=x.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=k.d.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new k.d(0,0,0),this.albedoColor=new k.d(1,1,1),this.baseWeight=1,this.reflectivityColor=new k.d(1,1,1),this.reflectionColor=new k.d(1,1,1),this.emissiveColor=new k.d(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,d.b)(this.HG())}getClassName(){return"PBRMaterial"}clone(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const J=A.e.Clone((()=>new x(G,this.HG())),this,{cloneTexturesOnlyOnce:V});return J.id=G,J.name=G,this.stencil.copyTo(J.stencil),this._clonePlugins(J,W),J}serialize(){const G=super.serialize();return G.customType="BABYLON.PBRMaterial",G}static Parse(G,V,W){const J=A.e.Parse((()=>new x(G.name,V)),G,V,W);return G.stencil&&J.stencil.parse(G.stencil,V,W),P.e._ParsePlugins(G,J,V,W),G.clearCoat&&J.clearCoat.parse(G.clearCoat,V,W),G.anisotropy&&J.anisotropy.parse(G.anisotropy,V,W),G.brdf&&J.brdf.parse(G.brdf,V,W),G.sheen&&J.sheen.parse(G.sheen,V,W),G.subSurface&&J.subSurface.parse(G.subSurface,V,W),G.iridescence&&J.iridescence.parse(G.iridescence,V,W),J}}x.PBRMATERIAL_OPAQUE=z.b.PBRMATERIAL_OPAQUE,x.PBRMATERIAL_ALPHATEST=z.b.PBRMATERIAL_ALPHATEST,x.PBRMATERIAL_ALPHABLEND=z.b.PBRMATERIAL_ALPHABLEND,x.PBRMATERIAL_ALPHATESTANDBLEND=z.b.PBRMATERIAL_ALPHATESTANDBLEND,x.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=z.b.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"directIntensity",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"emissiveIntensity",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"environmentIntensity",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"specularIntensity",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"disableBumpMap",void 0),(0,J.e)([(0,R.z)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"albedoTexture",void 0),(0,J.e)([(0,R.z)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"baseWeightTexture",void 0),(0,J.e)([(0,R.z)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"baseDiffuseRoughnessTexture",void 0),(0,J.e)([(0,R.z)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"ambientTexture",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"ambientTextureStrength",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,J.e)([(0,R.z)(),(0,R.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],x.prototype,"opacityTexture",void 0),(0,J.e)([(0,R.z)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"reflectionTexture",void 0),(0,J.e)([(0,R.z)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"emissiveTexture",void 0),(0,J.e)([(0,R.z)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"reflectivityTexture",void 0),(0,J.e)([(0,R.z)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"metallicTexture",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"metallic",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"roughness",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"metallicF0Factor",void 0),(0,J.e)([(0,R.m)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"metallicReflectanceColor",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,J.e)([(0,R.z)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"metallicReflectanceTexture",void 0),(0,J.e)([(0,R.z)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"reflectanceTexture",void 0),(0,J.e)([(0,R.z)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"microSurfaceTexture",void 0),(0,J.e)([(0,R.z)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"bumpTexture",void 0),(0,J.e)([(0,R.z)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty",null)],x.prototype,"lightmapTexture",void 0),(0,J.e)([(0,R.m)("ambient"),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"ambientColor",void 0),(0,J.e)([(0,R.m)("albedo"),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"albedoColor",void 0),(0,J.e)([(0,R.I)("baseWeight"),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"baseWeight",void 0),(0,J.e)([(0,R.I)("baseDiffuseRoughness"),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"baseDiffuseRoughness",void 0),(0,J.e)([(0,R.m)("reflectivity"),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"reflectivityColor",void 0),(0,J.e)([(0,R.m)("reflection"),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"reflectionColor",void 0),(0,J.e)([(0,R.m)("emissive"),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"emissiveColor",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"microSurface",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useLightmapAsShadowmap",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],x.prototype,"useAlphaFromAlbedoTexture",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],x.prototype,"forceAlphaTest",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],x.prototype,"alphaCutOff",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useSpecularOverAlpha",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useAmbientInGrayScale",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,J.e)([(0,R.I)()],x.prototype,"usePhysicalLightFalloff",null),(0,J.e)([(0,R.I)()],x.prototype,"useGLTFLightFalloff",null),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useRadianceOverAlpha",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useObjectSpaceNormalMap",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useParallax",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useParallaxOcclusion",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"parallaxScaleBias",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsLightsDirty")],x.prototype,"disableLighting",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"forceIrradianceInFragment",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsLightsDirty")],x.prototype,"maxSimultaneousLights",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"invertNormalMapX",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"invertNormalMapY",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"twoSidedLighting",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useAlphaFresnel",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useLinearAlphaFresnel",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"environmentBRDFTexture",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"forceNormalForward",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"enableSpecularAntiAliasing",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useHorizonOcclusion",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useRadianceOcclusion",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsMiscDirty")],x.prototype,"unlit",void 0),(0,J.e)([(0,R.I)(),(0,R.b)("_markAllSubMeshesAsMiscDirty")],x.prototype,"applyDecalMapAfterDetailMap",void 0),(0,X.d)("BABYLON.PBRMaterial",x)},11298:(G,V,W)=>{W.d(V,{b:()=>k});var J=W(11201);const R=new Map;function d(G,V){(function(G){return R.delete(G)})(G)&&J.c.Warn(`Extension with the name '${G}' already exists`),R.set(G,V)}function k(G,V){"image/ktx"!==V&&"image/ktx2"!==V||(G=".ktx"),R.has(G)||(G.endsWith(".ies")&&d(".ies",(async()=>await W.e(28).then(W.bind(W,13756)).then((G=>new G._IESTextureLoader)))),G.endsWith(".dds")&&d(".dds",(async()=>await W.e(25).then(W.bind(W,13765)).then((G=>new G._DDSTextureLoader)))),G.endsWith(".basis")&&d(".basis",(async()=>await W.e(29).then(W.bind(W,13779)).then((G=>new G._BasisTextureLoader)))),G.endsWith(".env")&&d(".env",(async()=>await Promise.all([W.e(24),W.e(30)]).then(W.bind(W,13784)).then((G=>new G._ENVTextureLoader)))),G.endsWith(".hdr")&&d(".hdr",(async()=>await W.e(31).then(W.bind(W,13789)).then((G=>new G._HDRTextureLoader)))),(G.endsWith(".ktx")||G.endsWith(".ktx2"))&&(d(".ktx",(async()=>await W.e(32).then(W.bind(W,13797)).then((G=>new G._KTXTextureLoader)))),d(".ktx2",(async()=>await W.e(32).then(W.bind(W,13797)).then((G=>new G._KTXTextureLoader))))),G.endsWith(".tga")&&d(".tga",(async()=>await W.e(33).then(W.bind(W,13800)).then((G=>new G._TGATextureLoader)))),G.endsWith(".exr")&&d(".exr",(async()=>await W.e(34).then(W.bind(W,13808)).then((G=>new G._ExrTextureLoader)))));const J=R.get(G);return J?Promise.resolve(J(V)):null}},11645:(G,V,W)=>{W.d(V,{b:()=>q});var J=W(11317),R=W(11324),d=W(11176),k=W(11136),z=W(11169),X=W(11304),P=(W(11227),W(11636));class A{get wrapU(){return this._wrapU}set wrapU(G){this._wrapU=G}get wrapV(){return this._wrapV}set wrapV(G){this._wrapV=G}get coordinatesMode(){return 0}get isCube(){return!!this._texture&&this._texture.isCube}set isCube(G){this._texture&&(this._texture.isCube=G)}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(G){this._texture&&(this._texture.is3D=G)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(G){this._texture&&(this._texture.is2DArray=G)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(G){return void 0!==(null===G||void 0===G?void 0:G.shareDepth)}constructor(G){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=P.c.Zero(),this._cachedBaseSize=P.c.Zero(),this._initialSamplingMode=2,this._texture=A._IsRenderTargetWrapper(G)?G.texture:G,this._texture&&(this._engine=this._texture.getEngine(),this.wrapU=this._texture._cachedWrapU??this.wrapU,this.wrapV=this._texture._cachedWrapV??this.wrapV,this.wrapR=this._texture._cachedWrapR??this.wrapR)}isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(G){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(G,this._texture,this._texture.generateMipMaps)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}var x=W(11411);class q extends A{set bd(G){this._hasAlpha!==G&&(this._hasAlpha=G,this._scene&&this._scene.markAllMaterialsAsDirty(1,(G=>G.hasTexture(this))))}get bd(){return this._hasAlpha}set getAlphaFromRGB(G){this._getAlphaFromRGB!==G&&(this._getAlphaFromRGB=G,this._scene&&this._scene.markAllMaterialsAsDirty(1,(G=>G.hasTexture(this))))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(G){this._coordinatesIndex!==G&&(this._coordinatesIndex=G,this._scene&&this._scene.markAllMaterialsAsDirty(1,(G=>G.hasTexture(this))))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(G){this._coordinatesMode!==G&&(this._coordinatesMode=G,this._scene&&this._scene.markAllMaterialsAsDirty(1,(G=>G.hasTexture(this))))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(G){this._wrapU=G}get wrapV(){return this._wrapV}set wrapV(G){this._wrapV=G}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(G){this._texture?this._texture.isCube=G:this._isCube=G}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(G){this._texture&&(this._texture.is3D=G)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(G){this._texture&&(this._texture.is2DArray=G)}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set gammaSpace(G){var V;if(this._texture){if(this._texture._gammaSpace===G)return;this._texture._gammaSpace=G}else{if(this._gammaSpace===G)return;this._gammaSpace=G}null===(V=this.HG())||void 0===V||V.markAllMaterialsAsDirty(1,(G=>G.hasTexture(this)))}get isRGBD(){return null!=this._texture&&this._texture._isRGBD}set isRGBD(G){var V;G!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=G),null===(V=this.HG())||void 0===V||V.markAllMaterialsAsDirty(1,(G=>G.hasTexture(this))))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(G){this._texture&&(this._texture._lodGenerationOffset=G)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(G){this._texture&&(this._texture._lodGenerationScale=G)}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}set linearSpecularLOD(G){this._texture&&(this._texture._linearSpecularLOD=G)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(G){this._texture&&(this._texture._irradianceTexture=G)}get uid(){return this._uid||(this._uid=(0,X.b)()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(G){this._onDisposeObserver&&this.Md.remove(this._onDisposeObserver),this._onDisposeObserver=this.Md.add(G)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=q.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this._dominantDirection=null,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.Md=new d.b,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,G?q._IsScene(G)?this._scene=G:this._engine=G:this._scene=z.c.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=V,this._uid=null}HG(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return k.c.IdentityReadOnly}getReflectionTextureMatrix(){return k.c.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(G){}get canRescale(){return!1}_getFromCache(G,V,W,J,R,d){const k=this._getEngine();if(!k)return null;const z=k._getUseSRGBBuffer(!!R,V),X=k.getLoadedTexturesCache();for(let P=0;P<X.length;P++){const k=X[P];if((void 0===R||z===k._useSRGBBuffer)&&(void 0===J||J===k.invertY)&&k.url===G&&k.generateMipMaps===!V&&(!W||W===k.samplingMode)&&(void 0===d||d===k.isCube))return k.incrementReferences(),k}return null}_rebuild(){}clone(){return null}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const G=this.HG();G&&G.markAllMaterialsAsDirty(1)}readPixels(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],R=arguments.length>4&&void 0!==arguments[4]&&arguments[4],d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Number.MAX_VALUE,X=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Number.MAX_VALUE;if(!this._texture)return null;const P=this._getEngine();if(!P)return null;const A=this.getSize();let x=A.width,q=A.height;0!==V&&(x/=Math.pow(2,V),q/=Math.pow(2,V),x=Math.round(x),q=Math.round(q)),z=Math.min(x,z),X=Math.min(q,X);try{return this._texture.isCube?P._readTexturePixels(this._texture,z,X,G,V,W,J,R,d,k):P._readTexturePixels(this._texture,z,X,-1,V,W,J,R,d,k)}catch(L){return null}}_readPixelsSync(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],R=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!this._texture)return null;const d=this.getSize();let k=d.width,z=d.height;const X=this._getEngine();if(!X)return null;0!=V&&(k/=Math.pow(2,V),z/=Math.pow(2,V),k=Math.round(k),z=Math.round(z));try{return this._texture.isCube?X._readTexturePixelsSync(this._texture,k,z,G,V,W,J,R):X._readTexturePixelsSync(this._texture,k,z,-1,V,W,J,R)}catch(P){return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const G=this._scene.textures.indexOf(this);if(G>=0&&this._scene.textures.splice(G,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const G=this._parentContainer.textures.indexOf(this);G>-1&&this._parentContainer.textures.splice(G,1),this._parentContainer=null}}this.Md.notifyObservers(this),this.Md.clear(),this.metadata=null,super.dispose()}serialize(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.name&&!G)return null;const V=x.e.Serialize(this);return x.e.AppendSerializedAnimations(this,V),V}static WhenAllReady(G,V){let W=G.length;if(0!==W)for(let J=0;J<G.length;J++){const R=G[J];if(R.isReady())0===--W&&V();else{const G=R.onLoadObservable;G?G.addOnce((()=>{0===--W&&V()})):0===--W&&V()}}else V()}static _IsScene(G){return"Scene"===G.getClassName()}}q.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,J.e)([(0,R.I)()],q.prototype,"uniqueId",void 0),(0,J.e)([(0,R.I)()],q.prototype,"name",void 0),(0,J.e)([(0,R.I)()],q.prototype,"displayName",void 0),(0,J.e)([(0,R.I)()],q.prototype,"metadata",void 0),(0,J.e)([(0,R.I)("bd")],q.prototype,"_hasAlpha",void 0),(0,J.e)([(0,R.I)("getAlphaFromRGB")],q.prototype,"_getAlphaFromRGB",void 0),(0,J.e)([(0,R.I)()],q.prototype,"level",void 0),(0,J.e)([(0,R.I)("coordinatesIndex")],q.prototype,"_coordinatesIndex",void 0),(0,J.e)([(0,R.I)()],q.prototype,"optimizeUVAllocation",void 0),(0,J.e)([(0,R.I)("coordinatesMode")],q.prototype,"_coordinatesMode",void 0),(0,J.e)([(0,R.I)()],q.prototype,"wrapU",null),(0,J.e)([(0,R.I)()],q.prototype,"wrapV",null),(0,J.e)([(0,R.I)()],q.prototype,"wrapR",void 0),(0,J.e)([(0,R.I)()],q.prototype,"anisotropicFilteringLevel",void 0),(0,J.e)([(0,R.I)()],q.prototype,"isCube",null),(0,J.e)([(0,R.I)()],q.prototype,"is3D",null),(0,J.e)([(0,R.I)()],q.prototype,"is2DArray",null),(0,J.e)([(0,R.I)()],q.prototype,"gammaSpace",null),(0,J.e)([(0,R.I)()],q.prototype,"invertZ",void 0),(0,J.e)([(0,R.I)()],q.prototype,"lodLevelInAlpha",void 0),(0,J.e)([(0,R.I)()],q.prototype,"lodGenerationOffset",null),(0,J.e)([(0,R.I)()],q.prototype,"lodGenerationScale",null),(0,J.e)([(0,R.I)()],q.prototype,"linearSpecularLOD",null),(0,J.e)([(0,R.z)()],q.prototype,"irradianceTexture",null),(0,J.e)([(0,R.I)()],q.prototype,"isRenderTarget",void 0)},11820:(G,V,W)=>{var J=W(11827),R=W(11645);R.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(R.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=J.b.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((G=>{this._texture._sphericalPolynomial=G,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(G){this._texture&&(this._texture._sphericalPolynomial=G)},enumerable:!0,configurable:!0})},11285:(G,V,W)=>{W.d(V,{d:()=>k});var J,R=W(11176),d=W(11292);!function(G){G[G.Unknown=0]="Unknown",G[G.Url=1]="Url",G[G.Temp=2]="Temp",G[G.Raw=3]="Raw",G[G.Dynamic=4]="Dynamic",G[G.RenderTarget=5]="RenderTarget",G[G.MultiRenderTarget=6]="MultiRenderTarget",G[G.Cube=7]="Cube",G[G.CubeRaw=8]="CubeRaw",G[G.CubePrefiltered=9]="CubePrefiltered",G[G.Raw3D=10]="Raw3D",G[G.Raw2DArray=11]="Raw2DArray",G[G.DepthStencil=12]="DepthStencil",G[G.CubeRawRGBD=13]="CubeRawRGBD",G[G.Depth=14]="Depth"}(J||(J={}));class k extends d.b{get useMipMaps(){return this.generateMipMaps}set useMipMaps(G){this.generateMipMaps=G}get uniqueId(){return this._uniqueId}_setUniqueId(G){this._uniqueId=G}getEngine(){return this._engine}get source(){return this._source}constructor(G,V){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new R.b,this.onErrorObservable=new R.b,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._autoMSAAManagement=!1,this._engine=G,this._source=V,this._uniqueId=k._Counter++,W||(this._hardwareTexture=G._createHardwareTexture())}incrementReferences(){this._references++}updateSize(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._engine.updateTextureDimensions(this,G,V,W),this.width=G,this.height=V,this.depth=W,this.baseWidth=G,this.baseHeight=V,this.baseDepth=W,this._size=G*V*W}_rebuild(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const G=this.onRebuildCallback(this),V=V=>{V._swapAndDie(this,!1),this.isReady=G.isReady};return void(G.isAsync?G.proxy.then(V):V(G.proxy))}let G;switch(this.source){case 2:case 12:case 14:break;case 1:return void(G=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(G=>{G._swapAndDie(this,!1),this.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case 3:G=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),G._swapAndDie(this,!1),this.isReady=!0;break;case 10:G=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),G._swapAndDie(this,!1),this.isReady=!0;break;case 11:G=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),G._swapAndDie(this,!1),this.isReady=!0;break;case 4:G=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),G._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:return void(G=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(()=>{G._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null));case 8:G=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),G._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:return G=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(G=>{G&&G._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension),void(G._sphericalPolynomial=this._sphericalPolynomial)}}_swapAndDie(G){var V;let W=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null===(V=this._hardwareTexture)||void 0===V||V.setUsage(G._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),G._hardwareTexture=this._hardwareTexture,W&&(G._isRGBD=this._isRGBD),this._lodTextureHigh&&(G._lodTextureHigh&&G._lodTextureHigh.dispose(),G._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(G._lodTextureMid&&G._lodTextureMid.dispose(),G._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(G._lodTextureLow&&G._lodTextureLow.dispose(),G._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(G._irradianceTexture&&G._irradianceTexture.dispose(),G._irradianceTexture=this._irradianceTexture);const J=this._engine.getLoadedTexturesCache();let R=J.indexOf(this);-1!==R&&J.splice(R,1),R=J.indexOf(G),-1===R&&J.push(G)}dispose(){this._references--,0===this._references&&(this.onLoadedObservable.clear(),this.onErrorObservable.clear(),this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}}k._Counter=0},11701:(G,V,W)=>{W.d(V,{b:()=>R});var J=W(11666);class R extends J.d{constructor(G,V,W,R,d){let k=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,P=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,A=arguments.length>9?arguments[9]:void 0,x=arguments.length>10?arguments[10]:void 0,q=arguments.length>11?arguments[11]:void 0;super(null,d,!k,z,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,A),this.format=R,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==P||(X=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==P||(X=1),this._texture=this._engine.createRawTexture(G,V,W,R,k,z,X,null,P,A??0,x??!1),this.wrapU=J.d.CLAMP_ADDRESSMODE,this.wrapV=J.d.CLAMP_ADDRESSMODE,this._waitingForData=!!q&&!G)}update(G){this._getEngine().updateRawTexture(this._texture,G,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer),this._waitingForData=!1}clone(){if(!this._texture)return super.clone();const G=new R(null,this.getSize().width,this.getSize().height,this.format,this.HG(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return G._texture=this._texture,this._texture.incrementReferences(),G}isReady(){return super.isReady()&&!this._waitingForData}static CreateLuminanceTexture(G,V,W,J){return new R(G,V,W,1,J,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(G,V,W,J){return new R(G,V,W,2,J,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(G,V,W,J){return new R(G,V,W,0,J,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(G,V,W,J){return new R(G,V,W,4,J,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(G,V,W,J){return new R(G,V,W,5,J,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9],arguments.length>10&&void 0!==arguments[10]&&arguments[10])}static CreateRGBAStorageTexture(G,V,W,J){return new R(G,V,W,5,J,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(G,V,W,d){let k=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:J.d.TRILINEAR_SAMPLINGMODE;return new R(G,V,W,6,d,k,z,X,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(G,V,W,d){let k=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:J.d.TRILINEAR_SAMPLINGMODE;return new R(G,V,W,6,d,k,z,X,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},11670:(G,V,W)=>{W.d(V,{e:()=>L});var J=W(11176),R=W(11136),d=W(11666),k=W(11676),z=W(11307),X=W(11268),P=W(11201),A=W(11683),x=W(11152);class q{get renderList(){return this._renderList}set renderList(G){this._renderList!==G&&(this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),G&&(this._unObserveRenderList=(0,x.f)(G,this._renderListHasChanged)),this._renderList=G)}get disableImageProcessing(){return this._disableImageProcessing}set disableImageProcessing(G){G!==this._disableImageProcessing&&(this._disableImageProcessing=G,this._scene.markAllMaterialsAsDirty(64))}get name(){return this._name}set name(G){if(this._name===G)return;if(this._name=G,!this._scene)return;const V=this._scene.getEngine();for(let W=0;W<this._renderPassIds.length;++W){const G=this._renderPassIds[W];V._renderPassNames[G]=`${this._name}#${W}`}}get renderPassIds(){return this._renderPassIds}get currentRefreshId(){return this._currentRefreshId}setMaterialForRendering(G,V){let W;W=Array.isArray(G)?G:[G];for(let J=0;J<W.length;++J)for(let G=0;G<this.options.numPasses;++G){let R=W[J];W[J].isAnInstance&&(R=W[J].sourceMesh),R.setMaterialForRenderPass(this._renderPassIds[G],void 0!==V?Array.isArray(V)?V[G]:V:void 0)}}constructor(G,V,W){this._unObserveRenderList=null,this._renderListHasChanged=(G,V)=>{const W=this._renderList?this._renderList.length:0;if(0===V&&W>0||0===W)for(const J of this._scene.meshes)J._markSubMeshesAsLightDirty()},this.particleSystemList=null,this.getCustomRenderList=null,this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this._disableImageProcessing=!1,this.onBeforeRenderObservable=new J.b,this.onAfterRenderObservable=new J.b,this.onBeforeRenderingManagerRenderObservable=new J.b,this.onAfterRenderingManagerRenderObservable=new J.b,this.onFastPathRenderObservable=new J.b,this._currentRefreshId=-1,this._refreshRate=1,this._currentApplyByPostProcessSetting=!1,this._currentSceneCamera=null,this.name=G,this._scene=V,this.renderList=[],this._renderPassIds=[],this.options={numPasses:1,doNotChangeAspectRatio:!0,...W},this._createRenderPassId(),this.renderPassId=this._renderPassIds[0],this._renderingManager=new A.e(V),this._renderingManager._useSceneAutoClearSetup=!0}_releaseRenderPassId(){const G=this._scene.getEngine();for(let V=0;V<this.options.numPasses;++V)G.releaseRenderPassId(this._renderPassIds[V]);this._renderPassIds.length=0}_createRenderPassId(){this._releaseRenderPassId();const G=this._scene.getEngine();for(let V=0;V<this.options.numPasses;++V)this._renderPassIds[V]=G.createRenderPassId(`${this.name}#${V}`)}resetRefreshCounter(){this._currentRefreshId=-1}get refreshRate(){return this._refreshRate}set refreshRate(G){this._refreshRate=G,this.resetRefreshCounter()}shouldRender(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}isReadyForRendering(G,V){this.prepareRenderList(),this.initRender(G,V);const W=this._checkReadiness();return this.finishRender(),W}prepareRenderList(){const G=this._scene;if(this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(let V=0;V<this._waitingRenderList.length;V++){const W=this._waitingRenderList[V],J=G.getMeshById(W);J&&this.renderList.push(J)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];const G=this._scene.meshes;for(let V=0;V<G.length;V++){const W=G[V];this.renderListPredicate(W)&&this.renderList.push(W)}}this._currentApplyByPostProcessSetting=this._scene.imageProcessingConfiguration.applyByPostProcess,this._disableImageProcessing&&(this._scene.imageProcessingConfiguration._applyByPostProcess=this._disableImageProcessing)}initRender(G,V){const W=this._scene.getEngine(),J=this.activeCamera??this._scene.activeCamera;this._currentSceneCamera=this._scene.activeCamera,J&&(J!==this._scene.activeCamera&&(this._scene.setTransformMatrix(J.getViewMatrix(),J.getProjectionMatrix(!0)),this._scene.activeCamera=J),W.setViewport(J.rigParent?J.rigParent.viewport:J.viewport,G,V)),this._defaultRenderListPrepared=!1}finishRender(){const G=this._scene;this._disableImageProcessing&&(G.imageProcessingConfiguration._applyByPostProcess=this._currentApplyByPostProcessSetting),G.activeCamera=this._currentSceneCamera,this._currentSceneCamera&&(this.activeCamera&&this.activeCamera!==G.activeCamera&&G.setTransformMatrix(this._currentSceneCamera.getViewMatrix(),this._currentSceneCamera.getProjectionMatrix(!0)),G.getEngine().setViewport(this._currentSceneCamera.viewport)),G.resetCachedMaterial()}render(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const W=this._scene,J=W.getEngine(),R=J.currentRenderPassId;J.currentRenderPassId=this._renderPassIds[G],this.onBeforeRenderObservable.notifyObservers(G);if(J.snapshotRendering&&1===J.snapshotRenderingMode)this.onFastPathRenderObservable.notifyObservers(G);else{let V=null;const J=this.renderList?this.renderList:W.getActiveMeshes().data,R=this.renderList?this.renderList.length:W.getActiveMeshes().length;this.getCustomRenderList&&(V=this.getCustomRenderList(G,J,R)),V?this._prepareRenderingManager(V,V.length,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(J,R,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),V=J),this.onBeforeRenderingManagerRenderObservable.notifyObservers(G),this._renderingManager.render(this.customRenderFunction,V,this.renderParticles,this.renderSprites),this.onAfterRenderingManagerRenderObservable.notifyObservers(G)}V||this.onAfterRenderObservable.notifyObservers(G),J.currentRenderPassId=R}_checkReadiness(){const G=this._scene,V=G.getEngine(),W=V.currentRenderPassId;let J=!0;G.getViewMatrix()||G.updateTransformMatrix();const R=this.options.numPasses;for(let k=0;k<R&&J;k++){let W=null;const d=this.renderList?this.renderList:G.getActiveMeshes().data,z=this.renderList?this.renderList.length:G.getActiveMeshes().length;V.currentRenderPassId=this._renderPassIds[k],this.onBeforeRenderObservable.notifyObservers(k),this.getCustomRenderList&&(W=this.getCustomRenderList(k,d,z)),W||(W=d),this.options.doNotChangeAspectRatio||G.updateTransformMatrix(!0);for(let G=0;G<W.length&&J;++G){const V=W[G];if(V.isEnabled()&&!V.isBlocked&&V.isVisible&&V.Ed)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(V,this.refreshRate,!0)){J=!1;continue}}else if(!V.isReady(!0)){J=!1;continue}}this.onAfterRenderObservable.notifyObservers(k),R>1&&(G.incrementRenderId(),G.resetCachedMaterial())}const d=this.particleSystemList||G.mx;for(const k of d)k.isReady()||(J=!1);return V.currentRenderPassId=W,J}_prepareRenderingManager(G,V,W){const J=this._scene,R=J.activeCamera,d=this.cameraForLOD??R;this._renderingManager.reset();const k=J.getRenderId(),z=J.getFrameId();for(let P=0;P<V;P++){const V=G[P];if(V&&!V.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(V,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!V.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}let G,X=null;if(d){const G=V._internalAbstractMeshDataInfo._currentLOD.get(d);G&&G[1]===z?X=G[0]:(X=J.customLODSelector?J.customLODSelector(V,d):V.getLOD(d),G?(G[0]=X,G[1]=z):V._internalAbstractMeshDataInfo._currentLOD.set(d,[X,z]))}else X=V;if(!X)continue;if(X!==V&&0!==X.billboardMode&&X.kd(),X._preActivateForIntermediateRendering(k),G=!(!W||!R)&&0===(V.layerMask&R.layerMask),V.isEnabled()&&V.isVisible&&V.Ed&&!G){if(X!==V&&X._activate(k,!0),V._activate(k,!0)&&V.Ed.length){V.isAnInstance?V._internalAbstractMeshDataInfo._actAsRegularMesh&&(X=V):X._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,X._internalAbstractMeshDataInfo._isActiveIntermediate=!0,J._prepareSkeleton(X);for(let G=0;G<X.Ed.length;G++){const V=X.Ed[G];this._renderingManager.dispatch(V,X)}}V._postActivate()}}}const X=this.particleSystemList||J.mx;for(let P=0;P<X.length;P++){const G=X[P],V=G.j;G.isStarted()&&V&&(!V.position||V.isEnabled())&&this._renderingManager.dispatchParticles(G)}}setRenderingOrder(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(G,V,W,J)}setRenderingAutoClearDepthStencil(G,V){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(G,V,W,J),this._renderingManager._useSceneAutoClearSetup=!1}clone(){const G=new q(this.name,this._scene,this.options);return this.renderList&&(G.renderList=this.renderList.slice(0)),G}dispose(){const G=this.renderList?this.renderList:this._scene.getActiveMeshes().data,V=this.renderList?this.renderList.length:this._scene.getActiveMeshes().length;for(let W=0;W<V;W++){const V=G[W];V&&void 0!==V.getMaterialForRenderPass(this.renderPassId)&&V.setMaterialForRenderPass(this.renderPassId,void 0)}this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderingManagerRenderObservable.clear(),this.onAfterRenderingManagerRenderObservable.clear(),this.onFastPathRenderObservable.clear(),this._releaseRenderPassId(),this.renderList=null}_rebuild(){this.refreshRate===q.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=q.REFRESHRATE_RENDER_ONCE)}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}}q.REFRESHRATE_RENDER_ONCE=0,q.REFRESHRATE_RENDER_ONEVERYFRAME=1,q.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,X.b.prototype.setDepthStencilTexture=function(G,V){this._engine.setDepthStencilTexture(this._samplers[G],this._uniforms[G],V,G)};class L extends d.d{get renderListPredicate(){return this._objectRenderer.renderListPredicate}set renderListPredicate(G){this._objectRenderer.renderListPredicate=G}get renderList(){return this._objectRenderer.renderList}set renderList(G){this._objectRenderer.renderList=G}get particleSystemList(){return this._objectRenderer.particleSystemList}set particleSystemList(G){this._objectRenderer.particleSystemList=G}get getCustomRenderList(){return this._objectRenderer.getCustomRenderList}set getCustomRenderList(G){this._objectRenderer.getCustomRenderList=G}get renderParticles(){return this._objectRenderer.renderParticles}set renderParticles(G){this._objectRenderer.renderParticles=G}get renderSprites(){return this._objectRenderer.renderSprites}set renderSprites(G){this._objectRenderer.renderSprites=G}get forceLayerMaskCheck(){return this._objectRenderer.forceLayerMaskCheck}set forceLayerMaskCheck(G){this._objectRenderer.forceLayerMaskCheck=G}get activeCamera(){return this._objectRenderer.activeCamera}set activeCamera(G){this._objectRenderer.activeCamera=G}get cameraForLOD(){return this._objectRenderer.cameraForLOD}set cameraForLOD(G){this._objectRenderer.cameraForLOD=G}get disableImageProcessing(){return this._objectRenderer.disableImageProcessing}set disableImageProcessing(G){this._objectRenderer.disableImageProcessing=G}get customIsReadyFunction(){return this._objectRenderer.customIsReadyFunction}set customIsReadyFunction(G){this._objectRenderer.customIsReadyFunction=G}get customRenderFunction(){return this._objectRenderer.customRenderFunction}set customRenderFunction(G){this._objectRenderer.customRenderFunction=G}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(G){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(G)}get onBeforeRenderObservable(){return this._objectRenderer.onBeforeRenderObservable}set onBeforeRender(G){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(G)}get onAfterRenderObservable(){return this._objectRenderer.onAfterRenderObservable}set onAfterRender(G){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(G)}set onClear(G){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(G)}get _waitingRenderList(){return this._objectRenderer._waitingRenderList}set _waitingRenderList(G){this._objectRenderer._waitingRenderList=G}get renderPassId(){return this._objectRenderer.renderPassId}get renderPassIds(){return this._objectRenderer.renderPassIds}get currentRefreshId(){return this._objectRenderer.currentRefreshId}setMaterialForRendering(G,V){this._objectRenderer.setMaterialForRendering(G,V)}get isMulti(){var G;return(null===(G=this._renderTarget)||void 0===G?void 0:G.isMulti)??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(G){if(this._boundingBoxSize&&this._boundingBoxSize.equals(G))return;this._boundingBoxSize=G;const V=this.HG();V&&V.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){var G;return(null===(G=this._renderTarget)||void 0===G?void 0:G._depthStencilTexture)??null}constructor(G,V,W){let k,z,X=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],x=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,L=arguments.length>6&&void 0!==arguments[6]&&arguments[6],t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:d.d.TRILINEAR_SAMPLINGMODE,Y=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],g=arguments.length>9&&void 0!==arguments[9]&&arguments[9],B=arguments.length>10&&void 0!==arguments[10]&&arguments[10],S=arguments.length>11&&void 0!==arguments[11]?arguments[11]:5,p=arguments.length>12&&void 0!==arguments[12]&&arguments[12],b=arguments.length>13?arguments[13]:void 0,r=arguments.length>14?arguments[14]:void 0,y=arguments.length>15&&void 0!==arguments[15]&&arguments[15],u=arguments.length>16&&void 0!==arguments[16]&&arguments[16],H=!0;if("object"===typeof X){const G=X;X=!!G.generateMipMaps,A=G.doNotChangeAspectRatio??!0,x=G.type??0,L=!!G.isCube,t=G.samplingMode??d.d.TRILINEAR_SAMPLINGMODE,Y=G.generateDepthBuffer??!0,g=!!G.generateStencilBuffer,B=!!G.isMulti,S=G.format??5,p=!!G.delayAllocation,b=G.samples,r=G.creationFlags,y=!!G.noColorAttachment,u=!!G.useSRGBBuffer,k=G.colorAttachment,H=G.gammaSpace??H,z=G.existingObjectRenderer}if(super(null,W,!X,void 0,t,void 0,void 0,void 0,void 0,S),this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new J.b,this.onAfterUnbindObservable=new J.b,this.onClearObservable=new J.b,this.onResizeObservable=new J.b,this._cleared=!1,this.skipInitialClear=!1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this._dontDisposeObjectRenderer=!1,this.boundingBoxPosition=R.o.Zero(),this._disableEngineStages=!1,this._dumpToolsLoading=!1,!(W=this.HG()))return;const n=this.HG().getEngine();this._gammaSpace=H,this._coordinatesMode=d.d.PROJECTION_MODE,this.name=G,this.isRenderTarget=!0,this._initialSizeParameter=V,this._dontDisposeObjectRenderer=!!z,this._processSizeParameter(V),this._objectRenderer=z??new q(G,W,{numPasses:L?6:this.getRenderLayers()||1,doNotChangeAspectRatio:A}),this._onBeforeRenderingManagerRenderObserver=this._objectRenderer.onBeforeRenderingManagerRenderObservable.add((()=>{if(!this._disableEngineStages)for(const G of this._scene._beforeRenderTargetClearStage)G.action(this,this._currentFaceIndex,this._currentLayer);if(this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(n):this.skipInitialClear||n.clear(this.clearColor||this._scene.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||this._scene.updateTransformMatrix(!0),!this._disableEngineStages)for(const G of this._scene._beforeRenderTargetDrawStage)G.action(this,this._currentFaceIndex,this._currentLayer)})),this._onAfterRenderingManagerRenderObserver=this._objectRenderer.onAfterRenderingManagerRenderObservable.add((()=>{var G;if(!this._disableEngineStages)for(const W of this._scene._afterRenderTargetDrawStage)W.action(this,this._currentFaceIndex,this._currentLayer);const V=(null===(G=this._texture)||void 0===G?void 0:G.generateMipMaps)??!1;if(this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,this._currentFaceIndex,this._postProcesses,this.ignoreCameraViewport):this._currentUseCameraPostProcess&&this._scene.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,this._currentFaceIndex),!this._disableEngineStages)for(const W of this._scene._afterRenderTargetPostProcessStage)W.action(this,this._currentFaceIndex,this._currentLayer);this._texture&&(this._texture.generateMipMaps=V),this._doNotChangeAspectRatio||this._scene.updateTransformMatrix(!0),this._currentDumpForDebug&&(this._dumpTools?this._dumpTools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),n):P.c.Error("dumpTools module is still being loaded. To speed up the process import dump tools directly in your project"))})),this._onFastPathRenderObserver=this._objectRenderer.onFastPathRenderObservable.add((()=>{this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(n):this.skipInitialClear||n.clear(this.clearColor||this._scene.clearColor,!0,!0,!0)})),this._resizeObserver=n.onResizeObservable.add((()=>{})),this._generateMipMaps=!!X,this._doNotChangeAspectRatio=A,B||(this._renderTargetOptions={generateMipMaps:X,type:x,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:Y,generateStencilBuffer:g,samples:b,creationFlags:r,noColorAttachment:y,useSRGBBuffer:u,colorAttachment:k,label:this.name},this.samplingMode===d.d.NEAREST_SAMPLINGMODE&&(this.wrapU=d.d.CLAMP_ADDRESSMODE,this.wrapV=d.d.CLAMP_ADDRESSMODE),p||(L?(this._renderTarget=W.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=d.d.INVCUBIC_MODE,this._textureMatrix=R.c.Identity()):this._renderTarget=W.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==b&&(this.samples=b)))}createDepthStencilTexture(){var G;let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,W=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],J=arguments.length>2&&void 0!==arguments[2]&&arguments[2],R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,k=arguments.length>5?arguments[5]:void 0;null===(G=this._renderTarget)||void 0===G||G.createDepthStencilTexture(V,W,J,R,d,k)}_processSizeParameter(G){if(G.ratio){this._sizeRatio=G.ratio;const V=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(V.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(V.getRenderHeight(),this._sizeRatio)}}else this._size=G}get samples(){var G;return(null===(G=this._renderTarget)||void 0===G?void 0:G.samples)??this._samples}set samples(G){this._renderTarget&&(this._samples=this._renderTarget.setSamples(G))}addPostProcess(G){if(!this._postProcessManager){const G=this.HG();if(!G)return;this._postProcessManager=new k.d(G),this._postProcesses=new Array}this._postProcesses.push(G),this._postProcesses[0].Xx=!1}clearPostProcesses(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._postProcesses){if(G)for(const G of this._postProcesses)G.dispose();this._postProcesses=[]}}removePostProcess(G){if(!this._postProcesses)return;const V=this._postProcesses.indexOf(G);-1!==V&&(this._postProcesses.splice(V,1),this._postProcesses.length>0&&(this._postProcesses[0].Xx=!1))}resetRefreshCounter(){this._objectRenderer.resetRefreshCounter()}get refreshRate(){return this._objectRenderer.refreshRate}set refreshRate(G){this._objectRenderer.refreshRate=G}_shouldRender(){return this._objectRenderer.shouldRender()}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){const G=this._size.layers;if(G)return G;const V=this._size.depth;return V||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(G){const V=Math.max(1,this.getRenderSize()*G);this.resize(V)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(G){var V;const W=this.isCube;null===(V=this._renderTarget)||void 0===V||V.dispose(),this._renderTarget=null;const J=this.HG();J&&(this._processSizeParameter(G),this._renderTarget=W?J.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):J.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._render(G,V)}isReadyForRendering(){this._dumpToolsLoading||(this._dumpToolsLoading=!0,Promise.resolve().then(W.bind(W,11710)).then((G=>this._dumpTools=G))),this._objectRenderer.prepareRenderList(),this.onBeforeBindObservable.notifyObservers(this),this._objectRenderer.initRender(this.getRenderWidth(),this.getRenderHeight());const G=this._objectRenderer._checkReadiness();return this.onAfterUnbindObservable.notifyObservers(this),this._objectRenderer.finishRender(),G}_render(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const W=this.HG();if(W){if(void 0!==this.useCameraPostProcesses&&(G=this.useCameraPostProcesses),this._objectRenderer.prepareRenderList(),this.onBeforeBindObservable.notifyObservers(this),this._objectRenderer.initRender(this.getRenderWidth(),this.getRenderHeight()),!this.is2DArray&&!this.is3D||this.isMulti)if(this.isCube&&!this.isMulti)for(let J=0;J<6;J++)this._renderToTarget(J,G,V),W.incrementRenderId(),W.resetCachedMaterial();else this._renderToTarget(0,G,V);else for(let J=0;J<this.getRenderLayers();J++)this._renderToTarget(0,G,V,J),W.incrementRenderId(),W.resetCachedMaterial();this.onAfterUnbindObservable.notifyObservers(this),this._objectRenderer.finishRender()}}_bestReflectionRenderTargetDimension(G,V){const W=G*V,J=(0,z.l)(W+16384/(128+W));return Math.min((0,z.e)(G),J)}_bindFrameBuffer(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const W=this.HG();if(!W)return;const J=W.getEngine();this._renderTarget&&J.bindFramebuffer(this._renderTarget,this.isCube?G:void 0,void 0,void 0,this.ignoreCameraViewport,0,V)}_unbindFrameBuffer(G,V){this._renderTarget&&G.unBindFramebuffer(this._renderTarget,this.isCube,(()=>{this.onAfterRenderObservable.notifyObservers(V)}))}_prepareFrame(G,V,W,J){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses)||this._bindFrameBuffer(V,W):J&&G.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(V,W)}_renderToTarget(G,V,W){var J,R;let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const k=this.HG();if(!k)return;const z=k.getEngine();this._currentFaceIndex=G,this._currentLayer=d,this._currentUseCameraPostProcess=V,this._currentDumpForDebug=W,this._prepareFrame(k,G,d,V),null===(J=z._debugPushGroup)||void 0===J||J.call(z,`render to face #${G} layer #${d}`,2),this._objectRenderer.render(G+d,!0),null===(R=z._debugPopGroup)||void 0===R||R.call(z,2),this._unbindFrameBuffer(z,G),this._texture&&this.isCube&&5===G&&z.generateMipMapsForCubemap(this._texture,!0)}setRenderingOrder(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._objectRenderer.setRenderingOrder(G,V,W,J)}setRenderingAutoClearDepthStencil(G,V){this._objectRenderer.setRenderingAutoClearDepthStencil(G,V)}clone(){const G=this.getSize(),V=new L(this.name,G,this.HG(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return V.bd=this.bd,V.level=this.level,V.coordinatesMode=this.coordinatesMode,this.renderList&&(V.renderList=this.renderList.slice(0)),V}serialize(){if(!this.name)return null;const G=super.serialize();if(G.renderTargetSize=this.getRenderSize(),G.renderList=[],this.renderList)for(let V=0;V<this.renderList.length;V++)G.renderList.push(this.renderList[V].id);return G}disposeFramebufferObjects(){var G;null===(G=this._renderTarget)||void 0===G||G.dispose(!0)}releaseInternalTexture(){var G;null===(G=this._renderTarget)||void 0===G||G.releaseTextures(),this._texture=null}dispose(){var G;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._objectRenderer.onBeforeRenderingManagerRenderObservable.remove(this._onBeforeRenderingManagerRenderObserver),this._objectRenderer.onAfterRenderingManagerRenderObservable.remove(this._onAfterRenderingManagerRenderObserver),this._objectRenderer.onFastPathRenderObservable.remove(this._onFastPathRenderObserver),this._dontDisposeObjectRenderer||this._objectRenderer.dispose(),this.clearPostProcesses(!0),this._resizeObserver&&(this.HG().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null);const V=this.HG();if(!V)return;let W=V.customRenderTargets.indexOf(this);W>=0&&V.customRenderTargets.splice(W,1);for(const J of V.cameras)W=J.customRenderTargets.indexOf(this),W>=0&&J.customRenderTargets.splice(W,1);null===(G=this._renderTarget)||void 0===G||G.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this._objectRenderer._rebuild(),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._objectRenderer.freeRenderingGroups()}getViewCount(){return 1}}L.REFRESHRATE_RENDER_ONCE=q.REFRESHRATE_RENDER_ONCE,L.REFRESHRATE_RENDER_ONEVERYFRAME=q.REFRESHRATE_RENDER_ONEVERYFRAME,L.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=q.REFRESHRATE_RENDER_ONEVERYTWOFRAMES,d.d._CreateRenderTargetTexture=(G,V,W,J,R)=>new L(G,V,W,J)},11666:(G,V,W)=>{W.d(V,{d:()=>p});var J=W(11317),R=W(11324),d=W(11176),k=W(11136),z=W(11645),X=W(11159),P=W(11218),A=W(11254),x=W(11301),q=W(11409),L=W(11236);function t(G,V){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const J=V.width,R=V.height;if(G instanceof Float32Array){let V=G.byteLength/G.BYTES_PER_ELEMENT;const W=new Uint8Array(V);for(;--V>=0;){let J=G[V];J<0?J=0:J>1&&(J=1),W[V]=255*J}G=W}const d=document.createElement("canvas");d.width=J,d.height=R;const k=d.getContext("2d");if(!k)return null;const z=k.createImageData(J,R);if(z.data.set(G),k.putImageData(z,0,0),W){const G=document.createElement("canvas");G.width=J,G.height=R;const V=G.getContext("2d");return V?(V.translate(0,R),V.scale(1,-1),V.drawImage(d,0,0),G.toDataURL("image/png")):null}return d.toDataURL("image/png")}function Y(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const J=G.getInternalTexture();if(!J)return null;const R=G._readPixelsSync(V,W);return R?t(R,G.getSize(),J.invertY):null}async function g(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const J=G.getInternalTexture();if(!J)return null;const R=await G.readPixels(V,W);return R?t(R,G.getSize(),J.invertY):null}var B=W(11552),S=W(11411);class p extends z.b{static _CreateVideoTexture(G,V,W){arguments.length>5&&void 0!==arguments[5]||p.TRILINEAR_SAMPLINGMODE;throw(0,P.e)("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(G){this._isBlocking=G}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(G,V,W,J){let R,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:p.TRILINEAR_SAMPLINGMODE,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,P=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,x=arguments.length>8&&void 0!==arguments[8]&&arguments[8],q=arguments.length>9?arguments[9]:void 0,L=arguments.length>10?arguments[10]:void 0,t=arguments.length>11?arguments[11]:void 0,Y=arguments.length>12?arguments[12]:void 0,g=arguments.length>13?arguments[13]:void 0;super(V),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new d.b,this._isBlocking=!0,this.name=G||"",this.url=G;let S=!1,b=null,r=!0;"object"===typeof W&&null!==W?(R=W.noMipmap??!1,J=W.invertY??!B.b,k=W.samplingMode??p.TRILINEAR_SAMPLINGMODE,z=W.h??null,X=W.onError??null,P=W.buffer??null,x=W.deleteBuffer??!1,q=W.format,L=W.mimeType,t=W.loaderOptions,Y=W.creationFlags,S=W.useSRGBBuffer??!1,b=W.internalTexture??null,r=W.gammaSpace??r,g=W.forcedExtension??g):R=!!W,this._gammaSpace=r,this._noMipmap=R,this._invertY=void 0===J?!B.b:J,this._initialSamplingMode=k,this._buffer=P,this._deleteBuffer=x,this._mimeType=L,this._loaderOptions=t,this._creationFlags=Y,this._useSRGBBuffer=S,this._forcedExtension=g,void 0!==q&&(this._format=q);const y=this.HG(),u=this._getEngine();if(!u)return;u.onBeforeTextureInitObservable.notifyObservers(this);const H=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),z&&z(),!this.isBlocking&&y&&y.resetCachedMaterial()},n=(G,V)=>{this._loadingError=!0,this._errorObject={message:G,exception:V},X&&X(G,V),p.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!b)return this._delayedOnLoad=H,void(this._delayedOnError=n);if(this._texture=b??this._getFromCache(this.url,R,k,this._invertY,S,this.isCube),this._texture)if(this._texture.isReady)A.c.SetImmediate((()=>H()));else{const G=this._texture.onLoadedObservable.add(H);this._texture.onErrorObservable.add((V=>{var W;n(V.message,V.exception),null===(W=this._texture)||void 0===W||W.onLoadedObservable.remove(G)}))}else if(y&&y.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=H,this._delayedOnError=n;else{try{this._texture=u.createTexture(this.url,R,this._invertY,y,k,H,n,this._buffer,void 0,this._format,this._forcedExtension,L,t,Y,S)}catch(D){throw n("error loading",D),D}x&&(this._buffer=null)}}updateURL(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0,J=arguments.length>3?arguments[3]:void 0;this.url&&(this.releaseInternalTexture(),this.HG().markAllMaterialsAsDirty(1,(G=>G.hasTexture(this)))),this.name&&!this.name.startsWith("data:")||(this.name=G),this.url=G,this._buffer=V,this._forcedExtension=J,this.delayLoadState=4,W&&(this._delayedOnLoad=W),this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;const G=this.HG();G&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?A.c.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=G.getEngine().createTexture(this.url,this._noMipmap,this._invertY,G,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(G,V,W,J){G*=this._cachedUScale,V*=this._cachedVScale,G-=this.uRotationCenter*this._cachedUScale,V-=this.vRotationCenter*this._cachedVScale,W-=this.wRotationCenter,k.o.TransformCoordinatesFromFloatsToRef(G,V,W,this._rowGenerationMatrix,J),J.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,J.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,J.z+=this.wRotationCenter}getTextureMatrix(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*G===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*G,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=k.c.Zero(),this._rowGenerationMatrix=new k.c,this._t0=k.o.Zero(),this._t1=k.o.Zero(),this._t2=k.o.Zero()),k.c.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(k.c.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,k.h.Matrix[0]),k.c.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,k.h.Matrix[1]),k.c.ScalingToRef(this._cachedUScale,this._cachedVScale,0,k.h.Matrix[2]),k.c.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,k.h.Matrix[3]),k.h.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(k.h.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(k.h.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(k.h.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.FA(this._t0),this._t2.FA(this._t0),k.c.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const V=this.HG();if(!V)return this._cachedTextureMatrix;const W=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&W!==this._cachedIdentity3x2&&V.markAllMaterialsAsDirty(1,(G=>G.hasTexture(this))),this._cachedTextureMatrix}getReflectionTextureMatrix(){const G=this.HG();if(!G)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==p.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===G.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=k.c.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=k.c.Zero());const V=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case p.PLANAR_MODE:k.c.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case p.PROJECTION_MODE:{k.c.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const V=G.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=V.updateFlag,V.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:k.c.IdentityToRef(this._cachedReflectionTextureMatrix)}return V&&G.markAllMaterialsAsDirty(1,(G=>G.hasTexture(this))),this._cachedReflectionTextureMatrix}clone(){const G={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,h:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return S.e.Clone((()=>new p(this._texture?this._texture.url:null,this.HG(),G)),this)}serialize(){var G;const V=this.name;p.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const W=super.serialize(p._SerializeInternalTextureUniqueId);if(!W)return null;if(p.SerializeBuffers||p.ForceSerializeBuffers)if("string"===typeof this._buffer&&this._buffer.startsWith("data:"))W.base64String=this._buffer,W.name=W.name.replace("data:","");else if(this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array){const G=this.mimeType||"image/png";W.base64String=`data:${G};base64,${(0,L.k)(this._buffer)}`}else(p.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(W.base64String=!this._engine||this._engine._features.supportSyncTextureRead?Y(this):g(this));var J;(W.invertY=this._invertY,W.samplingMode=this.samplingMode,W._creationFlags=this._creationFlags,W._useSRGBBuffer=this._useSRGBBuffer,p._SerializeInternalTextureUniqueId)&&(W.internalTextureUniqueId=null===(J=this._texture)||void 0===J?void 0:J.uniqueId);return W.internalTextureLabel=null===(G=this._texture)||void 0===G?void 0:G.label,W.noMipmap=this._noMipmap,this.name=V,W}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(G,V,W){if(G.customType){const J=x.b.Instantiate(G.customType).Parse(G,V,W);return G.samplingMode&&J.updateSamplingMode&&J._samplingMode&&J._samplingMode!==G.samplingMode&&J.updateSamplingMode(G.samplingMode),J}if(G.isCube&&!G.isRenderTarget)return p._CubeTextureParser(G,V,W);const J=void 0!==G.internalTextureUniqueId;if(!G.name&&!G.isRenderTarget&&!J)return null;let R;if(J){const W=V.getEngine().getLoadedTexturesCache();for(const V of W)if(V.uniqueId===G.internalTextureUniqueId){R=V;break}}const d=V=>{if(V&&V._texture&&(V._texture._cachedWrapU=null,V._texture._cachedWrapV=null,V._texture._cachedWrapR=null),G.samplingMode){const W=G.samplingMode;V&&V.samplingMode!==W&&V.updateSamplingMode(W)}if(V&&G.animations)for(let W=0;W<G.animations.length;W++){const J=G.animations[W],R=(0,X.c)("BABYLON.Animation");R&&V.animations.push(R.Parse(J))}V&&V._texture&&(J&&!R&&V._texture._setUniqueId(G.internalTextureUniqueId),V._texture.label=G.internalTextureLabel)};return S.e.Parse((()=>{let J=!0;if(G.noMipmap&&(J=!1),G.mirrorPlane){const W=p._CreateMirror(G.name,G.renderTargetSize,V,J);return W._waitingRenderList=G.renderList,W.mirrorPlane=q.c.ld(G.mirrorPlane),d(W),W}if(G.isRenderTarget){let W=null;if(G.isCube){if(V.reflectionProbes)for(let J=0;J<V.reflectionProbes.length;J++){const W=V.reflectionProbes[J];if(W.name===G.name)return W.cubeTexture}}else W=p._CreateRenderTargetTexture(G.name,G.renderTargetSize,V,J,G._creationFlags??0),W._waitingRenderList=G.renderList;return d(W),W}if(G.isVideo){const R=p._CreateVideoTexture(W+(G.url||G.name),W+(G.src||G.url),V,J,G.invertY,G.samplingMode,G.settings||{});return d(R),R}{let k;if(G.base64String&&!R)k=p.CreateFromBase64String(G.base64String,G.base64String,V,!J,G.invertY,G.samplingMode,(()=>{d(k)}),G._creationFlags??0,G._useSRGBBuffer??!1),k.name=G.name;else{let z;z=G.name&&(G.name.indexOf("://")>0||G.name.startsWith("data:"))?G.name:W+G.name,G.url&&(G.url.startsWith("data:")||p.UseSerializedUrlIfAny)&&(z=G.url);const X={noMipmap:!J,invertY:G.invertY,samplingMode:G.samplingMode,h:()=>{d(k)},internalTexture:R};k=new p(z,V,X)}return k}}),G,V)}static CreateFromBase64String(G,V,W,J,R){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:p.TRILINEAR_SAMPLINGMODE;return new p("data:"+V,W,J,R,d,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,G,!1,arguments.length>8&&void 0!==arguments[8]?arguments[8]:5,void 0,void 0,arguments.length>9?arguments[9]:void 0,arguments.length>10?arguments[10]:void 0)}static LoadFromDataString(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],R=arguments.length>4?arguments[4]:void 0,d=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:p.TRILINEAR_SAMPLINGMODE,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,X=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,P=arguments.length>9&&void 0!==arguments[9]?arguments[9]:5,A=arguments.length>10?arguments[10]:void 0,x=arguments.length>11?arguments[11]:void 0;return"data:"!==G.substring(0,5)&&(G="data:"+G),new p(G,W,R,d,k,z,X,V,J,P,void 0,void 0,A,x)}}p.SerializeBuffers=!0,p.ForceSerializeBuffers=!1,p.OnTextureLoadErrorObservable=new d.b,p._SerializeInternalTextureUniqueId=!1,p._CubeTextureParser=(G,V,W)=>{throw(0,P.e)("CubeTexture")},p._CreateMirror=(G,V,W,J)=>{throw(0,P.e)("MirrorTexture")},p._CreateRenderTargetTexture=(G,V,W,J,R)=>{throw(0,P.e)("RenderTargetTexture")},p.NEAREST_SAMPLINGMODE=1,p.NEAREST_NEAREST_MIPLINEAR=8,p.BILINEAR_SAMPLINGMODE=2,p.LINEAR_LINEAR_MIPNEAREST=11,p.TRILINEAR_SAMPLINGMODE=3,p.LINEAR_LINEAR_MIPLINEAR=3,p.NEAREST_NEAREST_MIPNEAREST=4,p.NEAREST_LINEAR_MIPNEAREST=5,p.NEAREST_LINEAR_MIPLINEAR=6,p.NEAREST_LINEAR=7,p.NEAREST_NEAREST=1,p.LINEAR_NEAREST_MIPNEAREST=9,p.LINEAR_NEAREST_MIPLINEAR=10,p.LINEAR_LINEAR=2,p.LINEAR_NEAREST=12,p.EXPLICIT_MODE=0,p.SPHERICAL_MODE=1,p.PLANAR_MODE=2,p.CUBIC_MODE=3,p.PROJECTION_MODE=4,p.SKYBOX_MODE=5,p.INVCUBIC_MODE=6,p.EQUIRECTANGULAR_MODE=7,p.FIXED_EQUIRECTANGULAR_MODE=8,p.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,p.CLAMP_ADDRESSMODE=0,p.WRAP_ADDRESSMODE=1,p.MIRROR_ADDRESSMODE=2,p.UseSerializedUrlIfAny=!1,(0,J.e)([(0,R.I)()],p.prototype,"url",void 0),(0,J.e)([(0,R.I)()],p.prototype,"uOffset",void 0),(0,J.e)([(0,R.I)()],p.prototype,"vOffset",void 0),(0,J.e)([(0,R.I)()],p.prototype,"uScale",void 0),(0,J.e)([(0,R.I)()],p.prototype,"vScale",void 0),(0,J.e)([(0,R.I)()],p.prototype,"uAng",void 0),(0,J.e)([(0,R.I)()],p.prototype,"vAng",void 0),(0,J.e)([(0,R.I)()],p.prototype,"wAng",void 0),(0,J.e)([(0,R.I)()],p.prototype,"uRotationCenter",void 0),(0,J.e)([(0,R.I)()],p.prototype,"vRotationCenter",void 0),(0,J.e)([(0,R.I)()],p.prototype,"wRotationCenter",void 0),(0,J.e)([(0,R.I)()],p.prototype,"homogeneousRotationInUVTransform",void 0),(0,J.e)([(0,R.I)()],p.prototype,"isBlocking",null),(0,X.d)("BABYLON.Texture",p),S.e._TextureParser=p.Parse},11588:(G,V,W)=>{function J(G){return 13===G||14===G||15===G||16===G||17===G||18===G||19===G}function R(G){return 13===G||17===G||18===G||19===G}W.d(V,{c:()=>R,e:()=>J})},11292:(G,V,W)=>{W.d(V,{b:()=>J});class J{get wrapU(){return this._cachedWrapU}set wrapU(G){this._cachedWrapU=G}get wrapV(){return this._cachedWrapV}set wrapV(G){this._cachedWrapV=G}get wrapR(){return this._cachedWrapR}set wrapR(G){this._cachedWrapR=G}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(G){this._cachedAnisotropicFilteringLevel=G}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(G){this._comparisonFunction=G}get useMipMaps(){return this._useMipMaps}set useMipMaps(G){this._useMipMaps=G}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this._cachedWrapU=G,this._cachedWrapV=V,this._cachedWrapR=W,this._cachedAnisotropicFilteringLevel=J,this.samplingMode=R,this._comparisonFunction=d,this}compareSampler(G){return this._cachedWrapU===G._cachedWrapU&&this._cachedWrapV===G._cachedWrapV&&this._cachedWrapR===G._cachedWrapR&&this._cachedAnisotropicFilteringLevel===G._cachedAnisotropicFilteringLevel&&this.samplingMode===G.samplingMode&&this._comparisonFunction===G._comparisonFunction&&this._useMipMaps===G._useMipMaps}}},11449:(G,V,W)=>{function J(G){-1===G.indexOf("vClipPlane")&&G.push("vClipPlane"),-1===G.indexOf("vClipPlane2")&&G.push("vClipPlane2"),-1===G.indexOf("vClipPlane3")&&G.push("vClipPlane3"),-1===G.indexOf("vClipPlane4")&&G.push("vClipPlane4"),-1===G.indexOf("vClipPlane5")&&G.push("vClipPlane5"),-1===G.indexOf("vClipPlane6")&&G.push("vClipPlane6")}function R(G,V,W){const J=!!(G.clipPlane??V.clipPlane),R=!!(G.clipPlane2??V.clipPlane2),d=!!(G.clipPlane3??V.clipPlane3),k=!!(G.clipPlane4??V.clipPlane4),z=!!(G.clipPlane5??V.clipPlane5),X=!!(G.clipPlane6??V.clipPlane6);J&&W.push("#define CLIPPLANE"),R&&W.push("#define CLIPPLANE2"),d&&W.push("#define CLIPPLANE3"),k&&W.push("#define CLIPPLANE4"),z&&W.push("#define CLIPPLANE5"),X&&W.push("#define CLIPPLANE6")}function d(G,V,W){let J=!1;const R=!!(G.clipPlane??V.clipPlane),d=!!(G.clipPlane2??V.clipPlane2),k=!!(G.clipPlane3??V.clipPlane3),z=!!(G.clipPlane4??V.clipPlane4),X=!!(G.clipPlane5??V.clipPlane5),P=!!(G.clipPlane6??V.clipPlane6);return W.CLIPPLANE!==R&&(W.CLIPPLANE=R,J=!0),W.CLIPPLANE2!==d&&(W.CLIPPLANE2=d,J=!0),W.CLIPPLANE3!==k&&(W.CLIPPLANE3=k,J=!0),W.CLIPPLANE4!==z&&(W.CLIPPLANE4=z,J=!0),W.CLIPPLANE5!==X&&(W.CLIPPLANE5=X,J=!0),W.CLIPPLANE6!==P&&(W.CLIPPLANE6=P,J=!0),J}function k(G,V,W){let J=V.clipPlane??W.clipPlane;z(G,"vClipPlane",J),J=V.clipPlane2??W.clipPlane2,z(G,"vClipPlane2",J),J=V.clipPlane3??W.clipPlane3,z(G,"vClipPlane3",J),J=V.clipPlane4??W.clipPlane4,z(G,"vClipPlane4",J),J=V.clipPlane5??W.clipPlane5,z(G,"vClipPlane5",J),J=V.clipPlane6??W.clipPlane6,z(G,"vClipPlane6",J)}function z(G,V,W){W&&G.setFloat4(V,W.IV.x,W.IV.y,W.IV.z,W.d)}W.d(V,{c:()=>J,f:()=>k,j:()=>d,l:()=>R})},11750:(G,V,W)=>{function J(G){G.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}W.d(V,{d:()=>J})},11570:(G,V,W)=>{function J(G){return void 0===G.getPipelineContext}W.d(V,{b:()=>J})},11392:(G,V,W)=>{W.d(V,{c:()=>R});var J=W(11254);class R{static GetEffect(G){return void 0===G.getPipelineContext?G.effect:G}constructor(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=G.createDrawContext(),V&&(this.materialContext=G.createMaterialContext())}setEffect(G,V){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var J;(this.effect=G,void 0!==V&&(this.defines=V),W)&&(null===(J=this.drawContext)||void 0===J||J.reset())}dispose(){var G;let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const G=this.effect;V?G.dispose():J.c.SetImmediate((()=>{G.getEngine().onEndFrameObservable.addOnce((()=>{G.dispose()}))})),this.effect=null}null===(G=this.drawContext)||void 0===G||G.dispose()}}},11274:(G,V,W)=>{W.d(V,{b:()=>x,d:()=>L,g:()=>P,i:()=>A});var J=W(11196),R=W(11279),d=W(11270),k=W(11201),z=W(11245),X=W(11250);function P(G,V){return(0,R.F)(V).cachedPipelines[G]}function A(G){const V=G._name,W=G.context;if(V&&W){const G=(0,R.F)(W),J=G.cachedPipelines[V];null===J||void 0===J||J.dispose(),delete G.cachedPipelines[V]}}function x(G,V,W,R,d,k,X){let P,A;const x=(0,J.m)()?null===k||void 0===k?void 0:k.getHostDocument():null;P="string"===typeof V?V:V.vertexSource?"source:"+V.vertexSource:V.vertexElement?(null===x||void 0===x?void 0:x.getElementById(V.vertexElement))||V.vertexElement:V.vertex||V,A="string"===typeof V?V:V.fragmentSource?"source:"+V.fragmentSource:V.fragmentElement?(null===x||void 0===x?void 0:x.getElementById(V.fragmentElement))||V.fragmentElement:V.fragment||V;const L=[void 0,void 0],t=()=>{if(L[0]&&L[1]){G.isFragment=!0;const[J,P]=L;(0,z.n)(P,G,((k,P)=>{X&&(X._fragmentSourceCodeBeforeMigration=P),W&&(k=W("fragment",k));const A=(0,z.e)(J,k,G);G=null;const x=function(G,V,W,J){if(W){return{vertexSourceCode:(1===J?"//":"")+"#define SHADER_NAME vertex:"+(W.vertexElement||W.vertex||W.spectorName||W)+"\n"+G,fragmentSourceCode:(1===J?"//":"")+"#define SHADER_NAME fragment:"+(W.fragmentElement||W.fragment||W.spectorName||W)+"\n"+V}}return{vertexSourceCode:G,fragmentSourceCode:V}}(A.vertexCode,A.fragmentCode,V,d);null===R||void 0===R||R(x.vertexSourceCode,x.fragmentSourceCode)}),k)}};q(P,"Vertex","",(V=>{(0,z.g)(G),(0,z.n)(V,G,((G,J)=>{X&&(X._rawVertexSourceCode=V,X._vertexSourceCodeBeforeMigration=J),W&&(G=W("vertex",G)),L[0]=G,t()}),k)}),d),q(A,"Fragment","Pixel",(G=>{X&&(X._rawFragmentSourceCode=G),L[1]=G,t()}),d)}function q(G,V,W,R,k,z){if("undefined"!==typeof HTMLElement&&G instanceof HTMLElement){return void R((0,J.b)(G))}if("source:"===G.substring(0,7))return void R(G.substring(7));if("base64:"===G.substring(0,7)){return void R(window.atob(G.substring(7)))}const P=d.d.GetShadersStore(k);if(P[G+V+"Shader"])return void R(P[G+V+"Shader"]);if(W&&P[G+W+"Shader"])return void R(P[G+W+"Shader"]);let A;if(A="."===G[0]||"/"===G[0]||G.indexOf("http")>-1?G:d.d.GetShadersRepository(k)+G,!(z=z||X.k))throw new Error("loadFileInjection is not defined");z(A+"."+V.toLowerCase()+".fx",R)}const L=(G,V,W,J)=>{try{const d=G.context?(0,R.F)(G.context):null;d&&(d.disableParallelShaderCompile=G.disableParallelCompilation);const k=G.existingPipelineContext||V(G.shaderProcessingContext);return k._name=G.name,G.name&&d&&(d.cachedPipelines[G.name]=k),W(k,G.vertex,G.fragment,!!G.createAsRaw,"","",G.rebuildRebind,G.defines,G.transformFeedbackVaryings,"",(()=>{J(k,(()=>{var V;null===(V=G.onRenderingStateCompiled)||void 0===V||V.call(G,k)}))})),k}catch(d){throw k.c.Error("Error compiling effect"),d}}},11268:(G,V,W)=>{W.d(V,{b:()=>X});var J=W(11176),R=W(11201),d=W(11270),k=W(11274),z=W(11254);class X{static get ShadersRepository(){return d.d.ShadersRepository}static set ShadersRepository(G){d.d.ShadersRepository=G}get P(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new J.b),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(G,V,W){let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4?arguments[4]:void 0,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,P=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,q=arguments.length>9?arguments[9]:void 0,L=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",t=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,Y=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new J.b,this.onErrorObservable=new J.b,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=G,this._key=L;const g=this._key.replace(/\r/g,"").replace(/\n/g,"|");let B;if(V.attributes){const G=V;if(this._engine=W,this._attributesNames=G.attributes,this._uniformsNames=G.uniformsNames.concat(G.samplers),this._samplerList=G.samplers.slice(),this.defines=G.defines,this.onError=G.onError,this.onCompiled=G.onCompiled,this._fallbacks=G.fallbacks,this._indexParameters=G.indexParameters,this._transformFeedbackVaryings=G.transformFeedbackVaryings||null,this._multiTarget=!!G.multiTarget,this._shaderLanguage=G.shaderLanguage??0,this._disableParallelShaderCompilation=!!G.disableParallelShaderCompilation,G.uniformBuffersNames){this._uniformBuffersNamesList=G.uniformBuffersNames.slice();for(let V=0;V<G.uniformBuffersNames.length;V++)this._uniformBuffersNames[G.uniformBuffersNames[V]]=V}this._processFinalCode=G.processFinalCode??null,this._processCodeAfterIncludes=G.processCodeAfterIncludes??void 0,Y=G.extraInitializationsAsync,B=G.existingPipelineContext}else this._engine=d,this.defines=null==z?"":z,this._uniformsNames=W.concat(R),this._samplerList=R?R.slice():[],this._attributesNames=V,this._uniformBuffersNamesList=[],this._shaderLanguage=t,this.onError=x,this.onCompiled=A,this._indexParameters=q,this._fallbacks=P;"WEBGL2"===this._engine.shaderPlatformName&&(B=(0,k.g)(g,this._engine._gl)??B),this._attributeLocationByName={},this.uniqueId=X._UniqueIdSeed++,B?(this._pipelineContext=B,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,Y),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.P||this.dispose(!0)}))}async _processShaderCodeAsync(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3?arguments[3]:void 0;J&&await J(),this._processingContext=W||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const R={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:G??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:d.d.GetShadersRepository(this._shaderLanguage),includesShadersStore:d.d.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,k.b)(R,this.name,this._processFinalCode,((G,W)=>{this._vertexSourceCode=G,this._fragmentSourceCode=W,this._prepareEffect(V)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.P||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(G){return this._attributes[G]}getAttributeLocationByName(G){return this._attributeLocationByName[G]}getAttributesCount(){return this._attributes.length}getUniformIndex(G){return this._uniformsNames.indexOf(G)}getUniform(G){return this._uniforms[G]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((G=>{this.executeWhenCompiled(G)}))}executeWhenCompiled(G){this.isReady()?G(this):(this.onCompileObservable.add((V=>{G(V)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(G){(0,z.f)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(V=>{this._processCompilationErrors(V,G)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var G;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(G=this._pipelineContext)||void 0===G?void 0:G._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var G;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(G=this._pipelineContext)||void 0===G?void 0:G._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(G,V,W,J){this._isReady=!1,this._vertexSourceCodeOverride=G,this._fragmentSourceCodeOverride=V,this.onError=(G,V)=>{J&&J(V)},this.onCompiled=()=>{var G,V;const J=this.getEngine().scenes;if(J)for(let W=0;W<J.length;W++)J[W].markAllMaterialsAsDirty(127);null===(G=(V=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===G||G.call(V,W)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(G){if(this._pipelineContext=G,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let V=0;V<this._attributesNames.length;V++){const G=this._attributesNames[V];this._attributeLocationByName[G]=this._attributes[V]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),X.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const V=this._pipelineContext;this._isReady=!1;try{const W=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),J=W?null:this.defines,R=W?this._vertexSourceCodeOverride:this._vertexSourceCode,d=W?this._fragmentSourceCodeOverride:this._fragmentSourceCode,z=this._engine;this._pipelineContext=(0,k.d)({existingPipelineContext:G?V:null,vertex:R,fragment:d,context:"WEBGL2"===z.shaderPlatformName||"WEBGL1"===z.shaderPlatformName?z._gl:void 0,rebuildRebind:(G,V,W,J)=>this._rebuildProgram(G,V,W,J),defines:J,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:W,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:W=>{V&&!G&&this._engine._deletePipelineContext(V),W&&this._onRenderingStateCompiled(W)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(V)}catch(W){this._processCompilationErrors(W,V)}}_getShaderCodeAndErrorLine(G,V,W){const J=W?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let R=null;if(V&&G){const d=V.match(J);if(d&&2===d.length){const V=parseInt(d[1]),J=G.split("\n",-1);J.length>=V&&(R=`Offending line [${V}] in ${W?"fragment":"vertex"} code: ${J[V-1]}`)}}return[G,R]}_processCompilationErrors(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=G.message;const W=this._attributesNames,J=this._fallbacks;if(R.c.Error("Unable to compile effect:"),R.c.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),R.c.Error(`Attributes: ${W.join(" ")}`),R.c.Error("Defines:\n"+this.defines),X.LogShaderCodeOnCompilationError){var d,k;let G=null,V=null,W=null;var z;if(null!==(d=this._pipelineContext)&&void 0!==d&&d._getVertexShaderCode()&&([W,G]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),W&&(R.c.Error("Vertex code:"),R.c.Error(W))),null!==(k=this._pipelineContext)&&void 0!==k&&k._getFragmentShaderCode())[W,V]=this._getShaderCodeAndErrorLine(null===(z=this._pipelineContext)||void 0===z?void 0:z._getFragmentShaderCode(),this._compilationError,!0),W&&(R.c.Error("Fragment code:"),R.c.Error(W));G&&R.c.Error(G),V&&R.c.Error(V)}R.c.Error("Error: "+this._compilationError);const P=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};V&&(this._pipelineContext=V,this._isReady=!0,P()),J?(this._pipelineContext=null,J.hasMoreFallbacks?(this._allFallbacksProcessed=!1,R.c.Error("Trying next fallback."),this.defines=J.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,P(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,V||P())}get isSupported(){return""===this._compilationError}_bindTexture(G,V){this._engine._bindTexture(this._samplers[G],V,G)}setTexture(G,V){this._engine.setTexture(this._samplers[G],this._uniforms[G],V,G)}setTextureArray(G,V){const W=G+"Ex";if(-1===this._samplerList.indexOf(W+"0")){const J=this._samplerList.indexOf(G);for(let G=1;G<V.length;G++){const V=W+(G-1).toString();this._samplerList.splice(J+G,0,V)}let R=0;for(const G of this._samplerList)this._samplers[G]=R,R+=1}this._engine.setTextureArray(this._samplers[G],this._uniforms[G],V,G)}bindUniformBuffer(G,V){const W=this._uniformBuffersNames[V];void 0===W||X._BaseCache[W]===G&&this._engine._features.useUBOBindingCache||(X._BaseCache[W]=G,this._engine.bindUniformBufferBase(G,W,V))}bindUniformBlock(G,V){this._engine.bindUniformBlock(this._pipelineContext,G,V)}setInt(G,V){return this._pipelineContext.setInt(G,V),this}setInt2(G,V,W){return this._pipelineContext.setInt2(G,V,W),this}setInt3(G,V,W,J){return this._pipelineContext.setInt3(G,V,W,J),this}setInt4(G,V,W,J,R){return this._pipelineContext.setInt4(G,V,W,J,R),this}setIntArray(G,V){return this._pipelineContext.setIntArray(G,V),this}setIntArray2(G,V){return this._pipelineContext.setIntArray2(G,V),this}setIntArray3(G,V){return this._pipelineContext.setIntArray3(G,V),this}setIntArray4(G,V){return this._pipelineContext.setIntArray4(G,V),this}setUInt(G,V){return this._pipelineContext.setUInt(G,V),this}setUInt2(G,V,W){return this._pipelineContext.setUInt2(G,V,W),this}setUInt3(G,V,W,J){return this._pipelineContext.setUInt3(G,V,W,J),this}setUInt4(G,V,W,J,R){return this._pipelineContext.setUInt4(G,V,W,J,R),this}setUIntArray(G,V){return this._pipelineContext.setUIntArray(G,V),this}setUIntArray2(G,V){return this._pipelineContext.setUIntArray2(G,V),this}setUIntArray3(G,V){return this._pipelineContext.setUIntArray3(G,V),this}setUIntArray4(G,V){return this._pipelineContext.setUIntArray4(G,V),this}setFloatArray(G,V){return this._pipelineContext.setArray(G,V),this}setFloatArray2(G,V){return this._pipelineContext.setArray2(G,V),this}setFloatArray3(G,V){return this._pipelineContext.setArray3(G,V),this}setFloatArray4(G,V){return this._pipelineContext.setArray4(G,V),this}setArray(G,V){return this._pipelineContext.setArray(G,V),this}setArray2(G,V){return this._pipelineContext.setArray2(G,V),this}setArray3(G,V){return this._pipelineContext.setArray3(G,V),this}setArray4(G,V){return this._pipelineContext.setArray4(G,V),this}setMatrices(G,V){return this._pipelineContext.setMatrices(G,V),this}setMatrix(G,V){return this._pipelineContext.setMatrix(G,V),this}setMatrix3x3(G,V){return this._pipelineContext.setMatrix3x3(G,V),this}setMatrix2x2(G,V){return this._pipelineContext.setMatrix2x2(G,V),this}setFloat(G,V){return this._pipelineContext.setFloat(G,V),this}setBool(G,V){return this._pipelineContext.setInt(G,V?1:0),this}setVector2(G,V){return this._pipelineContext.setVector2(G,V),this}setFloat2(G,V,W){return this._pipelineContext.setFloat2(G,V,W),this}setVector3(G,V){return this._pipelineContext.setVector3(G,V),this}setFloat3(G,V,W,J){return this._pipelineContext.setFloat3(G,V,W,J),this}setVector4(G,V){return this._pipelineContext.setVector4(G,V),this}setQuaternion(G,V){return this._pipelineContext.setQuaternion(G,V),this}setFloat4(G,V,W,J,R){return this._pipelineContext.setFloat4(G,V,W,J,R),this}setColor3(G,V){return this._pipelineContext.setColor3(G,V),this}setColor4(G,V,W){return this._pipelineContext.setColor4(G,V,W),this}setDirectColor4(G,V){return this._pipelineContext.setDirectColor4(G,V),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(X.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,k.i)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;V&&(d.d.GetShadersStore(J)[`${G}PixelShader`]=V),W&&(d.d.GetShadersStore(J)[`${G}VertexShader`]=W)}static ResetCache(){X._BaseCache={}}}X.LogShaderCodeOnCompilationError=!0,X.PersistentMode=!1,X.AutomaticallyClearCodeCache=!1,X._UniqueIdSeed=0,X._BaseCache={},X.ShadersStore=d.d.ShadersStore,X.IncludesShadersStore=d.d.IncludesShadersStore},11832:(G,V,W)=>{W.d(V,{b:()=>J});class J{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(G,V){this._defines[G]||(G<this._currentRank&&(this._currentRank=G),G>this._maxRank&&(this._maxRank=G),this._defines[G]=new Array),this._defines[G].push(V)}addCPUSkinningFallback(G,V){this._mesh=V,G<this._currentRank&&(this._currentRank=G),G>this._maxRank&&(this._maxRank=G)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(G,V){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,G=G.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),V._bonesComputationForcedToCPU=!0;const W=this._mesh.HG();for(let G=0;G<W.meshes.length;G++){const J=W.meshes[G];if(J.material){if(J.computeBonesUsingShaders&&0!==J.numBoneInfluencers)if(J.material.getEffect()===V)J.computeBonesUsingShaders=!1;else if(J.Ed)for(const G of J.Ed){if(G.effect===V){J.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&J.computeBonesUsingShaders&&J.numBoneInfluencers>0&&(J.computeBonesUsingShaders=!1)}}else{const V=this._defines[this._currentRank];if(V)for(let W=0;W<V.length;W++)G=G.replace("#define "+V[W],"");this._currentRank++}return G}}},11691:(G,V,W)=>{W.d(V,{b:()=>P,d:()=>A});var J=W(11345),R=W(11530),d=W(11176),k=W(11268),z=W(11392);W(11693);const X={DG:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class P{constructor(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:X;this._fullscreenViewport=new R.e(0,0,1,1);const W=V.DG??X.DG,d=V.indices??X.indices;this.Ik=G,this._vertexBuffers={[J.c.PositionKind]:new J.c(G,W,J.c.PositionKind,!1,!1,2)},this._indexBuffer=G.createIndexBuffer(d),this._indexBufferLength=d.length,this._onContextRestoredObserver=G.onContextRestoredObservable.add((()=>{this._indexBuffer=G.createIndexBuffer(d);for(const G in this._vertexBuffers){this._vertexBuffers[G]._rebuild()}}))}setViewport(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._fullscreenViewport;this.Ik.setViewport(G)}bindBuffers(G){this.Ik.bindBuffers(this._vertexBuffers,this._indexBuffer,G)}applyEffectWrapper(G){this.Ik.setState(!0),this.Ik.depthCullingState.depthTest=!1,this.Ik.stencilState.stencilTest=!1,this.Ik.enableEffect(G.drawWrapper),this.bindBuffers(G.effect),G.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.Ik.depthCullingState.depthTest,this._savedStateStencilTest=this.Ik.stencilState.stencilTest}restoreStates(){this.Ik.depthCullingState.depthTest=this._savedStateDepthTest,this.Ik.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.Ik.drawElementsType(0,0,this._indexBufferLength)}_isRenderTargetTexture(G){return void 0!==G.renderTarget}render(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!G.effect.isReady())return;this.saveStates(),this.setViewport();const W=null===V?null:this._isRenderTargetTexture(V)?V.renderTarget:V;W&&this.Ik.bindFramebuffer(W),this.applyEffectWrapper(G),this.draw(),W&&this.Ik.unBindFramebuffer(W),this.restoreStates()}dispose(){const G=this._vertexBuffers[J.c.PositionKind];G&&(G.dispose(),delete this._vertexBuffers[J.c.PositionKind]),this._indexBuffer&&this.Ik._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.Ik.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class A{static RegisterShaderCodeProcessing(G,V){V?A._CustomShaderCodeProcessing[G??""]=V:delete A._CustomShaderCodeProcessing[G??""]}static _GetShaderCodeProcessing(G){return A._CustomShaderCodeProcessing[G]??A._CustomShaderCodeProcessing[""]}get name(){return this.options.name}set name(G){this.options.name=G}isReady(){var G;return(null===(G=this._drawWrapper.effect)||void 0===G?void 0:G.isReady())??!1}get drawWrapper(){return this._drawWrapper}get effect(){return this._drawWrapper.effect}set effect(G){this._drawWrapper.effect=G}constructor(G){this.alphaMode=0,this.onEffectCreatedObservable=new d.b(void 0,!0),this.onApplyObservable=new d.b,this._shadersLoaded=!1,this._webGPUReady=!1,this._importPromises=[],this.options={...G,name:G.name||"effectWrapper",Ik:G.Ik,uniforms:G.uniforms||G.uniformNames||[],uniformNames:void 0,samplers:G.samplers||G.samplerNames||[],samplerNames:void 0,attributeNames:G.attributeNames||["position"],uniformBuffers:G.uniformBuffers||[],defines:G.defines||"",useShaderStore:G.useShaderStore||!1,vertexUrl:G.vertexUrl||G.vertexShader||"postprocess",vertexShader:void 0,fragmentShader:G.fragmentShader||"pass",indexParameters:G.indexParameters,blockCompilation:G.blockCompilation||!1,shaderLanguage:G.shaderLanguage||0,onCompiled:G.onCompiled||void 0,extraInitializations:G.extraInitializations||void 0,extraInitializationsAsync:G.extraInitializationsAsync||void 0,useAsPostProcess:G.useAsPostProcess??!1},this.options.uniformNames=this.options.uniforms,this.options.samplerNames=this.options.samplers,this.options.vertexShader=this.options.vertexUrl,this.options.useAsPostProcess&&(-1===this.options.samplers.indexOf("textureSampler")&&this.options.samplers.push("textureSampler"),-1===this.options.uniforms.indexOf("scale")&&this.options.uniforms.push("scale")),G.vertexUrl||G.vertexShader?this._shaderPath={vertexSource:this.options.vertexShader}:(this.options.useAsPostProcess||(this.options.uniforms.push("scale"),this.onApplyObservable.add((()=>{this.effect.setFloat2("scale",1,1)}))),this._shaderPath={vertex:this.options.vertexShader}),this._shaderPath.fragmentSource=this.options.fragmentShader,this._shaderPath.spectorName=this.options.name,this.options.useShaderStore&&(this._shaderPath.fragment=this._shaderPath.fragmentSource,this._shaderPath.vertex||(this._shaderPath.vertex=this._shaderPath.vertexSource),delete this._shaderPath.fragmentSource,delete this._shaderPath.vertexSource),this.onApplyObservable.add((()=>{this.bind()})),this.options.useShaderStore||(this._onContextRestoredObserver=this.options.Ik.onContextRestoredObservable.add((()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()}))),this._drawWrapper=new z.c(this.options.Ik),this._webGPUReady=1===this.options.shaderLanguage;const V=Array.isArray(this.options.defines)?this.options.defines.join("\n"):this.options.defines;this._postConstructor(this.options.blockCompilation,V,this.options.extraInitializations)}_gatherImports(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],V=arguments.length>1?arguments[1]:void 0;this.options.useAsPostProcess&&(G&&this._webGPUReady?V.push(Promise.all([W.e(42).then(W.bind(W,13857))])):V.push(Promise.all([Promise.resolve().then(W.bind(W,11693))])))}_postConstructor(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0,J=arguments.length>3?arguments[3]:void 0;this._importPromises.length=0,J&&this._importPromises.push(...J);const R=this.options.Ik.isWebGPU&&!A.ForceGLSL;this._gatherImports(R,this._importPromises),void 0!==W&&W(R,this._importPromises),R&&this._webGPUReady&&(this.options.shaderLanguage=1),G||this.updateEffect(V)}updateEffect(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3?arguments[3]:void 0,R=arguments.length>4?arguments[4]:void 0,d=arguments.length>5?arguments[5]:void 0,z=arguments.length>6?arguments[6]:void 0,X=arguments.length>7?arguments[7]:void 0;const P=A._GetShaderCodeProcessing(this.name);if(null!==P&&void 0!==P&&P.defineCustomBindings){var x,q;const J=(null===(x=V)||void 0===x?void 0:x.slice())??[];J.push(...this.options.uniforms);const R=(null===(q=W)||void 0===q?void 0:q.slice())??[];R.push(...this.options.samplers),G=P.defineCustomBindings(this.name,G,J,R),V=J,W=R}this.options.defines=G||"";const L=this._shadersLoaded||0===this._importPromises.length?void 0:async()=>{await Promise.all(this._importPromises),this._shadersLoaded=!0};let t;t=this.options.extraInitializationsAsync?async()=>{null===L||void 0===L||L(),await this.options.extraInitializationsAsync()}:L,this.options.useShaderStore?this._drawWrapper.effect=this.options.Ik.createEffect({vertex:z??this._shaderPath.vertex,fragment:X??this._shaderPath.fragment},{attributes:this.options.attributeNames,uniformsNames:V||this.options.uniforms,uniformBuffersNames:this.options.uniformBuffers,samplers:W||this.options.samplers,defines:null!==G?G:"",fallbacks:null,onCompiled:R??this.options.onCompiled,onError:d??null,indexParameters:J||this.options.indexParameters,processCodeAfterIncludes:null!==P&&void 0!==P&&P.processCodeAfterIncludes?(G,V)=>P.processCodeAfterIncludes(this.name,G,V):null,processFinalCode:null!==P&&void 0!==P&&P.processFinalCode?(G,V)=>P.processFinalCode(this.name,G,V):null,shaderLanguage:this.options.shaderLanguage,extraInitializationsAsync:t},this.options.Ik):this._drawWrapper.effect=new k.b(this._shaderPath,this.options.attributeNames,V||this.options.uniforms,W||this.options.samplerNames,this.options.Ik,G,void 0,R||this.options.onCompiled,void 0,void 0,void 0,this.options.shaderLanguage,t),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)}bind(){var G,V;let W=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.options.useAsPostProcess&&!W&&(this.options.Ik.setAlphaMode(this.alphaMode),this.drawWrapper.effect.setFloat2("scale",1,1)),null===(G=A._GetShaderCodeProcessing(this.name))||void 0===G||null===(V=G.bindCustomBindings)||void 0===V||V.call(G,this.name,this._drawWrapper.effect)}dispose(){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.onEffectCreatedObservable.clear(),this._drawWrapper.dispose(!0)}}A.ForceGLSL=!1,A._CustomShaderCodeProcessing={}},11755:(G,V,W)=>{W.d(V,{b:()=>d,f:()=>R});var J=W(11750);function R(G,V){V.EXPOSURE&&G.push("exposureLinear"),V.CONTRAST&&G.push("contrast"),V.COLORGRADING&&G.push("colorTransformSettings"),(V.VIGNETTE||V.DITHER)&&G.push("vInverseScreenSize"),V.VIGNETTE&&(G.push("vignetteSettings1"),G.push("vignetteSettings2")),V.COLORCURVES&&(0,J.d)(G),V.DITHER&&G.push("ditherIntensity")}function d(G,V){V.COLORGRADING&&G.push("txColorTransform")}},11744:(G,V,W)=>{W.d(V,{e:()=>L});var J=W(11317),R=W(11324),d=W(11176),k=W(11424),z=W(11411),X=W(11750);class P{constructor(){this._dirty=!0,this._tempColor=new k.h(0,0,0,0),this._globalCurve=new k.h(0,0,0,0),this._highlightsCurve=new k.h(0,0,0,0),this._midtonesCurve=new k.h(0,0,0,0),this._shadowsCurve=new k.h(0,0,0,0),this._positiveCurve=new k.h(0,0,0,0),this._negativeCurve=new k.h(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get globalHue(){return this._globalHue}set globalHue(G){this._globalHue=G,this._dirty=!0}get globalDensity(){return this._globalDensity}set globalDensity(G){this._globalDensity=G,this._dirty=!0}get globalSaturation(){return this._globalSaturation}set globalSaturation(G){this._globalSaturation=G,this._dirty=!0}get globalExposure(){return this._globalExposure}set globalExposure(G){this._globalExposure=G,this._dirty=!0}get highlightsHue(){return this._highlightsHue}set highlightsHue(G){this._highlightsHue=G,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}set highlightsDensity(G){this._highlightsDensity=G,this._dirty=!0}get highlightsSaturation(){return this._highlightsSaturation}set highlightsSaturation(G){this._highlightsSaturation=G,this._dirty=!0}get highlightsExposure(){return this._highlightsExposure}set highlightsExposure(G){this._highlightsExposure=G,this._dirty=!0}get midtonesHue(){return this._midtonesHue}set midtonesHue(G){this._midtonesHue=G,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesDensity(G){this._midtonesDensity=G,this._dirty=!0}get midtonesSaturation(){return this._midtonesSaturation}set midtonesSaturation(G){this._midtonesSaturation=G,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set midtonesExposure(G){this._midtonesExposure=G,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set shadowsHue(G){this._shadowsHue=G,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set shadowsDensity(G){this._shadowsDensity=G,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}set shadowsSaturation(G){this._shadowsSaturation=G,this._dirty=!0}get shadowsExposure(){return this._shadowsExposure}set shadowsExposure(G){this._shadowsExposure=G,this._dirty=!0}getClassName(){return"ColorCurves"}static Bind(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vCameraColorCurvePositive",J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vCameraColorCurveNeutral",R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"vCameraColorCurveNegative";G._dirty&&(G._dirty=!1,G._getColorGradingDataToRef(G._globalHue,G._globalDensity,G._globalSaturation,G._globalExposure,G._globalCurve),G._getColorGradingDataToRef(G._highlightsHue,G._highlightsDensity,G._highlightsSaturation,G._highlightsExposure,G._tempColor),G._tempColor.multiplyToRef(G._globalCurve,G._highlightsCurve),G._getColorGradingDataToRef(G._midtonesHue,G._midtonesDensity,G._midtonesSaturation,G._midtonesExposure,G._tempColor),G._tempColor.multiplyToRef(G._globalCurve,G._midtonesCurve),G._getColorGradingDataToRef(G._shadowsHue,G._shadowsDensity,G._shadowsSaturation,G._shadowsExposure,G._tempColor),G._tempColor.multiplyToRef(G._globalCurve,G._shadowsCurve),G._highlightsCurve.subtractToRef(G._midtonesCurve,G._positiveCurve),G._midtonesCurve.subtractToRef(G._shadowsCurve,G._negativeCurve)),V&&(V.setFloat4(W,G._positiveCurve.r,G._positiveCurve.g,G._positiveCurve.b,G._positiveCurve.a),V.setFloat4(J,G._midtonesCurve.r,G._midtonesCurve.g,G._midtonesCurve.b,G._midtonesCurve.a),V.setFloat4(R,G._negativeCurve.r,G._negativeCurve.g,G._negativeCurve.b,G._negativeCurve.a))}_getColorGradingDataToRef(G,V,W,J,R){null!=G&&(G=P._Clamp(G,0,360),V=P._Clamp(V,-100,100),W=P._Clamp(W,-100,100),J=P._Clamp(J,-100,100),V=P._ApplyColorGradingSliderNonlinear(V),V*=.5,J=P._ApplyColorGradingSliderNonlinear(J),V<0&&(V*=-1,G=(G+180)%360),P._FromHSBToRef(G,V,50+.25*J,R),R.scaleToRef(2,R),R.a=1+.01*W)}static _ApplyColorGradingSliderNonlinear(G){G/=100;let V=Math.abs(G);return V=Math.pow(V,2),G<0&&(V*=-1),V*=100,V}static _FromHSBToRef(G,V,W,J){let R=P._Clamp(G,0,360);const d=P._Clamp(V/100,0,1),k=P._Clamp(W/100,0,1);if(0===d)J.r=k,J.g=k,J.b=k;else{R/=60;const G=Math.floor(R),V=R-G,W=k*(1-d),z=k*(1-d*V),X=k*(1-d*(1-V));switch(G){case 0:J.r=k,J.g=X,J.b=W;break;case 1:J.r=z,J.g=k,J.b=W;break;case 2:J.r=W,J.g=k,J.b=X;break;case 3:J.r=W,J.g=z,J.b=k;break;case 4:J.r=X,J.g=W,J.b=k;break;default:J.r=k,J.g=W,J.b=z}}J.a=1}static _Clamp(G,V,W){return Math.min(Math.max(G,V),W)}clone(){return z.e.Clone((()=>new P),this)}serialize(){return z.e.Serialize(this)}static Parse(G){return z.e.Parse((()=>new P),G,null,null)}}P.PrepareUniforms=X.d,(0,J.e)([(0,R.I)()],P.prototype,"_globalHue",void 0),(0,J.e)([(0,R.I)()],P.prototype,"_globalDensity",void 0),(0,J.e)([(0,R.I)()],P.prototype,"_globalSaturation",void 0),(0,J.e)([(0,R.I)()],P.prototype,"_globalExposure",void 0),(0,J.e)([(0,R.I)()],P.prototype,"_highlightsHue",void 0),(0,J.e)([(0,R.I)()],P.prototype,"_highlightsDensity",void 0),(0,J.e)([(0,R.I)()],P.prototype,"_highlightsSaturation",void 0),(0,J.e)([(0,R.I)()],P.prototype,"_highlightsExposure",void 0),(0,J.e)([(0,R.I)()],P.prototype,"_midtonesHue",void 0),(0,J.e)([(0,R.I)()],P.prototype,"_midtonesDensity",void 0),(0,J.e)([(0,R.I)()],P.prototype,"_midtonesSaturation",void 0),(0,J.e)([(0,R.I)()],P.prototype,"_midtonesExposure",void 0),z.e._ColorCurvesParser=P.Parse;var A=W(11307),x=W(11755),q=W(11159);class L{constructor(){this.colorCurves=new P,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=L.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new k.h(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=L.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.outputTextureWidth=0,this.outputTextureHeight=0,this.onUpdateParameters=new d.b}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(G){this._colorCurvesEnabled!==G&&(this._colorCurvesEnabled=G,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(G){this._colorGradingTexture!==G&&(this._colorGradingTexture=G,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(G){this._colorGradingEnabled!==G&&(this._colorGradingEnabled=G,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(G){this._colorGradingWithGreenDepth!==G&&(this._colorGradingWithGreenDepth=G,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(G){this._colorGradingBGR!==G&&(this._colorGradingBGR=G,this._updateParameters())}get exposure(){return this._exposure}set exposure(G){this._exposure!==G&&(this._exposure=G,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(G){this._toneMappingEnabled!==G&&(this._toneMappingEnabled=G,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(G){this._toneMappingType!==G&&(this._toneMappingType=G,this._updateParameters())}get contrast(){return this._contrast}set contrast(G){this._contrast!==G&&(this._contrast=G,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(G){this.vignetteCenterY=G}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(G){this.vignetteCenterX=G}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(G){this._vignetteBlendMode!==G&&(this._vignetteBlendMode=G,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(G){this._vignetteEnabled!==G&&(this._vignetteEnabled=G,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(G){this._ditheringEnabled!==G&&(this._ditheringEnabled=G,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(G){this._ditheringIntensity!==G&&(this._ditheringIntensity=G,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(G){this._skipFinalColorClamp!==G&&(this._skipFinalColorClamp=G,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(G){this._applyByPostProcess!==G&&(this._applyByPostProcess=G,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(G){this._isEnabled!==G&&(this._isEnabled=G,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}prepareDefines(G){if((arguments.length>1&&void 0!==arguments[1]&&arguments[1])!==this.applyByPostProcess||!this._isEnabled)return G.VIGNETTE=!1,G.TONEMAPPING=0,G.CONTRAST=!1,G.EXPOSURE=!1,G.COLORCURVES=!1,G.COLORGRADING=!1,G.COLORGRADING3D=!1,G.DITHER=!1,G.IMAGEPROCESSING=!1,G.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(G.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(G.VIGNETTE=this.vignetteEnabled,G.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===L._VIGNETTEMODE_MULTIPLY,G.VIGNETTEBLENDMODEOPAQUE=!G.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case L.TONEMAPPING_KHR_PBR_NEUTRAL:G.TONEMAPPING=3;break;case L.TONEMAPPING_ACES:G.TONEMAPPING=2;break;default:G.TONEMAPPING=1}else G.TONEMAPPING=0;G.CONTRAST=1!==this.contrast,G.EXPOSURE=1!==this.exposure,G.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,G.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,G.COLORGRADING?G.COLORGRADING3D=this.colorGradingTexture.is3D:G.COLORGRADING3D=!1,G.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,G.SAMPLER3DBGRMAP=this.colorGradingBGR,G.DITHER=this._ditheringEnabled,G.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,G.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,G.IMAGEPROCESSING=G.VIGNETTE||!!G.TONEMAPPING||G.CONTRAST||G.EXPOSURE||G.COLORCURVES||G.COLORGRADING||G.DITHER}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(G,V){if(this._colorCurvesEnabled&&this.colorCurves&&P.Bind(this.colorCurves,G),this._vignetteEnabled||this._ditheringEnabled){const W=1/(this.outputTextureWidth||G.getEngine().getRenderWidth()),J=1/(this.outputTextureHeight||G.getEngine().getRenderHeight());if(G.setFloat2("vInverseScreenSize",W,J),this._ditheringEnabled&&G.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const R=null!=V?V:J/W;let d=Math.tan(.5*this.vignetteCameraFov),k=d*R;const z=Math.sqrt(k*d);k=(0,A.k)(k,z,this.vignetteStretch),d=(0,A.k)(d,z,this.vignetteStretch),G.setFloat4("vignetteSettings1",k,d,-k*this.vignetteCenterX,-d*this.vignetteCenterY);const X=-2*this.vignetteWeight;G.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,X)}}if(G.setFloat("exposureLinear",this.exposure),G.setFloat("contrast",this.contrast),this.colorGradingTexture){G.setTexture("txColorTransform",this.colorGradingTexture);const V=this.colorGradingTexture.getSize().height;G.setFloat4("colorTransformSettings",(V-1)/V,.5/V,V,this.colorGradingTexture.level)}}clone(){return z.e.Clone((()=>new L),this)}serialize(){return z.e.Serialize(this)}static Parse(G){const V=z.e.Parse((()=>new L),G,null,null);return void 0!==G.vignetteCentreX&&(V.vignetteCenterX=G.vignetteCentreX),void 0!==G.vignetteCentreY&&(V.vignetteCenterY=G.vignetteCentreY),V}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}L.TONEMAPPING_STANDARD=0,L.TONEMAPPING_ACES=1,L.TONEMAPPING_KHR_PBR_NEUTRAL=2,L.PrepareUniforms=x.f,L.PrepareSamplers=x.b,L._VIGNETTEMODE_MULTIPLY=0,L._VIGNETTEMODE_OPAQUE=1,(0,J.e)([(0,R.i)()],L.prototype,"colorCurves",void 0),(0,J.e)([(0,R.I)()],L.prototype,"_colorCurvesEnabled",void 0),(0,J.e)([(0,R.z)("colorGradingTexture")],L.prototype,"_colorGradingTexture",void 0),(0,J.e)([(0,R.I)()],L.prototype,"_colorGradingEnabled",void 0),(0,J.e)([(0,R.I)()],L.prototype,"_colorGradingWithGreenDepth",void 0),(0,J.e)([(0,R.I)()],L.prototype,"_colorGradingBGR",void 0),(0,J.e)([(0,R.I)()],L.prototype,"_exposure",void 0),(0,J.e)([(0,R.I)()],L.prototype,"_toneMappingEnabled",void 0),(0,J.e)([(0,R.I)()],L.prototype,"_toneMappingType",void 0),(0,J.e)([(0,R.I)()],L.prototype,"_contrast",void 0),(0,J.e)([(0,R.I)()],L.prototype,"vignetteStretch",void 0),(0,J.e)([(0,R.I)()],L.prototype,"vignetteCenterX",void 0),(0,J.e)([(0,R.I)()],L.prototype,"vignetteCenterY",void 0),(0,J.e)([(0,R.I)()],L.prototype,"vignetteWeight",void 0),(0,J.e)([(0,R.n)()],L.prototype,"vignetteColor",void 0),(0,J.e)([(0,R.I)()],L.prototype,"vignetteCameraFov",void 0),(0,J.e)([(0,R.I)()],L.prototype,"_vignetteBlendMode",void 0),(0,J.e)([(0,R.I)()],L.prototype,"_vignetteEnabled",void 0),(0,J.e)([(0,R.I)()],L.prototype,"_ditheringEnabled",void 0),(0,J.e)([(0,R.I)()],L.prototype,"_ditheringIntensity",void 0),(0,J.e)([(0,R.I)()],L.prototype,"_skipFinalColorClamp",void 0),(0,J.e)([(0,R.I)()],L.prototype,"_applyByPostProcess",void 0),(0,J.e)([(0,R.I)()],L.prototype,"_isEnabled",void 0),(0,J.e)([(0,R.I)()],L.prototype,"outputTextureWidth",void 0),(0,J.e)([(0,R.I)()],L.prototype,"outputTextureHeight",void 0),z.e._ImageProcessingConfigurationParser=L.Parse,(0,q.d)("BABYLON.ImageProcessingConfiguration",L)},11835:(G,V,W)=>{W.d(V,{b:()=>x});var J=W(11317),R=W(11313),d=W(11324),k=W(11818),z=W(11794),X=W(11798),P=W(11432);class A extends z.c{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class x extends X.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(G,"DetailMap",140,new A,V),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=R.e.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=G._dirtyCallbacks[1]}isReadyForSubMesh(G,V,W){return!this._isEnabled||!(G._areTexturesDirty&&V.texturesEnabled&&W.getCaps().standardDerivatives&&this._texture&&k.c.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(G,V){if(this._isEnabled){G.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const W=V.getEngine();G._areTexturesDirty&&(W.getCaps().standardDerivatives&&this._texture&&k.c.DetailTextureEnabled&&this._isEnabled?((0,P.R)(this._texture,G,"DETAIL"),G.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):G.DETAIL=!1)}else G.DETAIL=!1}bindForSubMesh(G,V){if(!this._isEnabled)return;const W=this._material.isFrozen;G.useUbo&&W&&G.isSync||this._texture&&k.c.DetailTextureEnabled&&(G.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),(0,P.t)(this._texture,G,"detail")),V.texturesEnabled&&this._texture&&k.c.DetailTextureEnabled&&G.setTexture("detailSampler",this._texture)}hasTexture(G){return this._texture===G}getActiveTextures(G){this._texture&&G.push(this._texture)}getAnimatables(G){this._texture&&this._texture.animations&&this._texture.animations.length>0&&G.push(this._texture)}dispose(G){var V;G&&(null===(V=this._texture)||void 0===V||V.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(G){G.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,J.e)([(0,d.z)("detailTexture"),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"texture",void 0),(0,J.e)([(0,d.I)()],x.prototype,"diffuseBlendLevel",void 0),(0,J.e)([(0,d.I)()],x.prototype,"roughnessBlendLevel",void 0),(0,J.e)([(0,d.I)()],x.prototype,"bumpLevel",void 0),(0,J.e)([(0,d.I)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"normalBlendMethod",void 0),(0,J.e)([(0,d.I)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"isEnabled",void 0)},11313:(G,V,W)=>{W.d(V,{e:()=>g});var J=W(11317),R=W(11324),d=W(11189),k=W(11176),z=W(11169),X=W(11339),P=W(11400),A=W(11201),x=W(11409),q=W(11392),L=W(11411);class t{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(G){this._func=G}get funcRef(){return this._funcRef}set funcRef(G){this._funcRef=G}get funcMask(){return this._funcMask}set funcMask(G){this._funcMask=G}get opStencilFail(){return this._opStencilFail}set opStencilFail(G){this._opStencilFail=G}get opDepthFail(){return this._opDepthFail}set opDepthFail(G){this._opDepthFail=G}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(G){this._opStencilDepthPass=G}get mask(){return this._mask}set mask(G){this._mask=G}get enabled(){return this._enabled}set enabled(G){this._enabled=G}getClassName(){return"MaterialStencilState"}copyTo(G){L.e.Clone((()=>G),this)}serialize(){return L.e.Serialize(this)}parse(G,V,W){L.e.Parse((()=>this),G,V,W)}}(0,J.e)([(0,R.I)()],t.prototype,"func",null),(0,J.e)([(0,R.I)()],t.prototype,"funcRef",null),(0,J.e)([(0,R.I)()],t.prototype,"funcMask",null),(0,J.e)([(0,R.I)()],t.prototype,"opStencilFail",null),(0,J.e)([(0,R.I)()],t.prototype,"opDepthFail",null),(0,J.e)([(0,R.I)()],t.prototype,"opStencilDepthPass",null),(0,J.e)([(0,R.I)()],t.prototype,"mask",null),(0,J.e)([(0,R.I)()],t.prototype,"enabled",null);var Y=W(11432);class g{get _supportGlowLayer(){return!1}set _glowModeEnabled(G){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(G){if(this._alpha===G)return;const V=this._alpha;this._alpha=G,1!==V&&1!==G||this.pP(g.MiscDirtyFlag+g.PrePassDirtyFlag)}get alpha(){return this._alpha}set gd(G){this._backFaceCulling!==G&&(this._backFaceCulling=G,this.pP(g.TextureDirtyFlag))}get gd(){return this._backFaceCulling}set cullBackFaces(G){this._cullBackFaces!==G&&(this._cullBackFaces=G,this.pP(g.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(G){this._blockDirtyMechanism!==G&&(this._blockDirtyMechanism=G,G||this.Sx())}atomicMaterialsUpdate(G){this.blockDirtyMechanism=!0;try{G(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(G){this._onDisposeObserver&&this.Md.remove(this._onDisposeObserver),this._onDisposeObserver=this.Md.add(G)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new k.b),this._onBindObservable}set onBind(G){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(G)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new k.b),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new k.b),this._onEffectCreatedObservable}set alphaMode(G){this._alphaMode!==G&&(this._alphaMode=G,this.pP(g.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(G){this._needDepthPrePass!==G&&(this._needDepthPrePass=G,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(G){this._fogEnabled!==G&&(this._fogEnabled=G,this.pP(g.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case g.WireFrameFillMode:case g.LineListDrawMode:case g.LineLoopDrawMode:case g.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(G){this.fillMode=G?g.WireFrameFillMode:g.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case g.PointFillMode:case g.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(G){this.fillMode=G?g.PointFillMode:g.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(G){this._fillMode!==G&&(this._fillMode=G,this.pP(g.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(G){const V=this.HG().getEngine().getCaps().fragmentDepthSupported;G&&!V&&A.c.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=G&&V,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(G){this._drawWrapper=G}constructor(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.Md=new k.b,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new t,this._useUBO=!1,this._fillMode=g.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=G;const R=V||z.c.LastCreatedScene;R&&(this._scene=R,this._dirtyCallbacks={},this._forceGLSL=J,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=G||d.h.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new q.c(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new P.c(this._scene.getEngine(),void 0,void 0,G),this._useUBO=this.HG().getEngine().supportsUniformBuffers,this._createUniformBuffer(),W||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),g.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var G;const V=this.HG().getEngine();null===(G=this._uniformBuffer)||void 0===G||G.dispose(),V.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new P.c(V,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new P.c(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(G){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.Sx(),this.checkReadyOnlyOnce=!0}unfreeze(){this.Sx(),this.checkReadyOnlyOnce=!1}isReady(G,V){return!0}isReadyForSubMesh(G,V,W){const J=V.materialDefines;return!!J&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=J,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}HG(){return this._scene}_getEffectiveOrientation(G){return null!==this.sideOrientation?this.sideOrientation:G.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(G){this._transparencyMode!==G&&(this._transparencyMode=G,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===g.MATERIAL_ALPHABLEND||this._transparencyMode===g.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===g.MATERIAL_ALPHATEST||this._transparencyMode===g.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===g.MATERIAL_OPAQUE||this._transparencyMode===g.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(G){return this._hasTransparencyMode?this._transparencyModeIsBlend:G.visibility<1||!this._disableAlphaBlending&&(G.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(G){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(G)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}Sx(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const V=this.HG().meshes;for(const W of V)if(W.Ed)for(const V of W.Ed)if(V.NG()===this)for(const W of V._drawWrappers)W&&this._materialContext===W.materialContext&&(W._wasPreviouslyReady=!1,W._wasPreviouslyUsingInstances=null,W._forceRebindOnNextCall=G);G&&this.pP(g.AllDirtyFlag)}_preBind(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=this._scene.getEngine(),J=(null==V?this.sideOrientation:V)===g.ClockWiseSideOrientation;return W.enableEffect(G||this._getDrawWrapper()),W.setState(this.gd,this.zOffset,!1,J,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),J}bind(G,V){}buildUniformLayout(){const G=this._uniformBuffer;this._eventInfo.ubo=G,this._callbackPluginEventGeneric(8,this._eventInfo),G.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(G,V,W){const J=W._drawWrapper;this._eventInfo.subMesh=W,this._callbackPluginEventBindForSubMesh(this._eventInfo),J._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(G){}bindView(G){this._useUBO?this._needToBindSceneUbo=!0:G.setMatrix("view",this.HG().getViewMatrix())}bindViewProjection(G){this._useUBO?this._needToBindSceneUbo=!0:(G.setMatrix("viewProjection",this.HG().getTransformMatrix()),G.setMatrix("projection",this.HG().getProjectionMatrix()))}bindEyePosition(G,V){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(G,V)}_afterBind(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&V&&(this._needToBindSceneUbo=!1,(0,Y.r)(V,this.HG().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=G?G.visibility:1,this._onBindObservable&&G&&this._onBindObservable.notifyObservers(G),this.disableDepthWrite){const G=this._scene.getEngine();this._cachedDepthWriteState=G.getDepthWrite(),G.setDepthWrite(!1)}if(this.disableColorWrite){const G=this._scene.getEngine();this._cachedColorWriteState=G.getColorWrite(),G.setColorWrite(!1)}if(0!==this.depthFunction){const G=this._scene.getEngine();this._cachedDepthFunctionState=G.getDepthFunction()||0,G.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(G){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=G,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(G){return null}_clonePlugins(G,V){const W={};if(this._serializePlugins(W),g._ParsePlugins(W,G,this._scene,V),this.pluginManager)for(const J of this.pluginManager._plugins){const V=G.pluginManager.getPlugin(J.name);V&&J.copyTo(V)}}getBindedMeshes(){if(this.meshMap){const G=[];for(const V in this.meshMap){const W=this.meshMap[V];W&&G.push(W)}return G}return this._scene.meshes.filter((G=>G.material===this))}forceCompilation(G,V,W,J){const R={clipPlane:!1,useInstances:!1,...W},d=this.HG(),k=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const z=()=>{if(!this._scene||!this._scene.getEngine())return;const W=d.clipPlane;if(R.clipPlane&&(d.clipPlane=new x.c(0,0,0,1)),this._storeEffectOnSubMeshes){let W=!0,d=null;if(G.Ed){const V=new X.e(0,0,0,0,0,G,void 0,!1,!1);V.materialDefines&&(V.materialDefines._renderId=-1),this.isReadyForSubMesh(G,V,R.useInstances)||(V.effect&&V.effect.getCompilationError()&&V.effect.allFallbacksProcessed()?d=V.effect.getCompilationError():(W=!1,setTimeout(z,16)))}W&&(this.allowShaderHotSwapping=k,d&&J&&J(d),V&&V(this))}else this.isReady()?(this.allowShaderHotSwapping=k,V&&V(this)):setTimeout(z,16);R.clipPlane&&(d.clipPlane=W)};z()}async forceCompilationAsync(G,V){return await new Promise(((W,J)=>{this.forceCompilation(G,(()=>{W()}),V,(G=>{J(G)}))}))}pP(G){this.HG().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(g._DirtyCallbackArray.length=0,G&g.ImageProcessingDirtyFlag&&g._DirtyCallbackArray.push(g._ImageProcessingDirtyCallBack),G&g.TextureDirtyFlag&&g._DirtyCallbackArray.push(g._TextureDirtyCallBack),G&g.LightDirtyFlag&&g._DirtyCallbackArray.push(g._LightsDirtyCallBack),G&g.FresnelDirtyFlag&&g._DirtyCallbackArray.push(g._FresnelDirtyCallBack),G&g.AttributesDirtyFlag&&g._DirtyCallbackArray.push(g._AttributeDirtyCallBack),G&g.MiscDirtyFlag&&g._DirtyCallbackArray.push(g._MiscDirtyCallBack),G&g.PrePassDirtyFlag&&g._DirtyCallbackArray.push(g._PrePassDirtyCallBack),g._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(g._RunDirtyCallBacks),this.HG().resetCachedMaterial())}resetDrawCache(){const G=this.HG().meshes;for(const V of G)if(V.Ed)for(const G of V.Ed)G.NG()===this&&G.resetDrawCache()}_markAllSubMeshesAsDirty(G){const V=this.HG();if(V.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const W=V.meshes;for(const J of W)if(J.Ed)for(const W of J.Ed){if((W.NG()||(V._hasDefaultMaterial?V.defaultMaterial:null))===this)for(const V of W._drawWrappers)V&&V.defines&&V.defines.markAllAsDirty&&this._materialContext===V.materialContext&&G(V.defines)}}_markScenePrePassDirty(){if(this.HG().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const G=this.HG().enablePrePassRenderer();G&&G.pP()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(g._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(g._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(g._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(g._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(g._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(g._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(g._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(g._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(g._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(g._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const G=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.Md.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(G)}))}}setPrePassRenderer(G){return!1}dispose(G,V,W){const J=this.HG();if(J.stopAnimation(this),J.freeProcessedMaterials(),J.removeMaterial(this),this._eventInfo.forceDisposeTextures=V,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const G=this._parentContainer.materials.indexOf(this);G>-1&&this._parentContainer.materials.splice(G,1),this._parentContainer=null}if(!0!==W)if(this.meshMap)for(const R in this.meshMap){const G=this.meshMap[R];this._disposeMeshResources(G)}else{const G=J.meshes;for(const V of G)this._disposeMeshResources(V)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.Md.notifyObservers(this),this.Md.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(G){if(!G)return;const V=G.zd,W=G._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(G.Ed&&W)for(const R of G.Ed){const G=R._drawWrappers;for(let d=0;d<G.length;d++){var J;const k=null===(J=G[d])||void 0===J?void 0:J.effect;if(!k)continue;W[d]===this&&(null===V||void 0===V||V._releaseVertexArrayObject(k),R._removeDrawWrapper(d,!0,!0))}}}else null===V||void 0===V||V._releaseVertexArrayObject(this._drawWrapper.effect);G.material!==this||G.sourceMesh||(G.material=null)}serialize(){const G=L.e.Serialize(this);return G.stencil=this.stencil.serialize(),G.uniqueId=this.uniqueId,this._serializePlugins(G),G}_serializePlugins(G){if(G.plugins={},this.pluginManager)for(const V of this.pluginManager._plugins)V.doNotSerialize||(G.plugins[V.getClassName()]=V.serialize())}static Parse(G,V,W){if(G.customType){if("BABYLON.PBRMaterial"===G.customType&&G.overloadedAlbedo&&(G.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return A.c.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else G.customType="BABYLON.StandardMaterial";const J=d.h.Instantiate(G.customType).Parse(G,V,W);return J._loadedUniqueId=G.uniqueId,J}static _ParsePlugins(G,V,W,J){if(G.plugins)for(const z in G.plugins){var R,k;const X=G.plugins[z];let P=null===(R=V.pluginManager)||void 0===R?void 0:R.getPlugin(X.name);if(!P){const G=d.h.Instantiate("BABYLON."+z);G&&(P=new G(V))}null===(k=P)||void 0===k||k.parse(X,W,J)}}}g.TriangleFillMode=0,g.WireFrameFillMode=1,g.PointFillMode=2,g.PointListDrawMode=3,g.LineListDrawMode=4,g.LineLoopDrawMode=5,g.LineStripDrawMode=6,g.TriangleStripDrawMode=7,g.TriangleFanDrawMode=8,g.ClockWiseSideOrientation=0,g.CounterClockWiseSideOrientation=1,g.ImageProcessingDirtyFlag=64,g.TextureDirtyFlag=1,g.LightDirtyFlag=2,g.FresnelDirtyFlag=4,g.AttributesDirtyFlag=8,g.MiscDirtyFlag=16,g.PrePassDirtyFlag=32,g.AllDirtyFlag=127,g.MATERIAL_OPAQUE=0,g.MATERIAL_ALPHATEST=1,g.MATERIAL_ALPHABLEND=2,g.MATERIAL_ALPHATESTANDBLEND=3,g.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,g.MATERIAL_NORMALBLENDMETHOD_RNM=1,g.OnEventObservable=new k.b,g._AllDirtyCallBack=G=>G.markAllAsDirty(),g._ImageProcessingDirtyCallBack=G=>G.markAsImageProcessingDirty(),g._TextureDirtyCallBack=G=>G.markAsTexturesDirty(),g._FresnelDirtyCallBack=G=>G.markAsFresnelDirty(),g._MiscDirtyCallBack=G=>G.markAsMiscDirty(),g._PrePassDirtyCallBack=G=>G.markAsPrePassDirty(),g._LightsDirtyCallBack=G=>G.markAsLightDirty(),g._AttributeDirtyCallBack=G=>G.markAsAttributesDirty(),g._FresnelAndMiscDirtyCallBack=G=>{g._FresnelDirtyCallBack(G),g._MiscDirtyCallBack(G)},g._TextureAndMiscDirtyCallBack=G=>{g._TextureDirtyCallBack(G),g._MiscDirtyCallBack(G)},g._DirtyCallbackArray=[],g._RunDirtyCallBacks=G=>{for(const V of g._DirtyCallbackArray)V(G)},(0,J.e)([(0,R.I)()],g.prototype,"id",void 0),(0,J.e)([(0,R.I)()],g.prototype,"uniqueId",void 0),(0,J.e)([(0,R.I)()],g.prototype,"name",void 0),(0,J.e)([(0,R.I)()],g.prototype,"metadata",void 0),(0,J.e)([(0,R.I)()],g.prototype,"checkReadyOnEveryCall",void 0),(0,J.e)([(0,R.I)()],g.prototype,"checkReadyOnlyOnce",void 0),(0,J.e)([(0,R.I)()],g.prototype,"state",void 0),(0,J.e)([(0,R.I)("alpha")],g.prototype,"_alpha",void 0),(0,J.e)([(0,R.I)("gd")],g.prototype,"_backFaceCulling",void 0),(0,J.e)([(0,R.I)("cullBackFaces")],g.prototype,"_cullBackFaces",void 0),(0,J.e)([(0,R.I)()],g.prototype,"sideOrientation",void 0),(0,J.e)([(0,R.I)("alphaMode")],g.prototype,"_alphaMode",void 0),(0,J.e)([(0,R.I)()],g.prototype,"_needDepthPrePass",void 0),(0,J.e)([(0,R.I)()],g.prototype,"disableDepthWrite",void 0),(0,J.e)([(0,R.I)()],g.prototype,"disableColorWrite",void 0),(0,J.e)([(0,R.I)()],g.prototype,"forceDepthWrite",void 0),(0,J.e)([(0,R.I)()],g.prototype,"depthFunction",void 0),(0,J.e)([(0,R.I)()],g.prototype,"separateCullingPass",void 0),(0,J.e)([(0,R.I)("fogEnabled")],g.prototype,"_fogEnabled",void 0),(0,J.e)([(0,R.I)()],g.prototype,"pointSize",void 0),(0,J.e)([(0,R.I)()],g.prototype,"zOffset",void 0),(0,J.e)([(0,R.I)()],g.prototype,"zOffsetUnits",void 0),(0,J.e)([(0,R.I)()],g.prototype,"pointsCloud",null),(0,J.e)([(0,R.I)()],g.prototype,"fillMode",null),(0,J.e)([(0,R.I)()],g.prototype,"useLogarithmicDepth",null),(0,J.e)([(0,R.I)()],g.prototype,"transparencyMode",null)},11794:(G,V,W)=>{W.d(V,{c:()=>J});class J{constructor(G){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=G,G)for(const V in G)Object.prototype.hasOwnProperty.call(G,V)&&this._setDefaultValue(V)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||G,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const G of Object.keys(this))"_"!==G[0]&&this._keys.push(G);if(this._externalProperties)for(const G in this._externalProperties)-1===this._keys.indexOf(G)&&this._keys.push(G)}isEqual(G){if(this._keys.length!==G._keys.length)return!1;for(let V=0;V<this._keys.length;V++){const W=this._keys[V];if(this[W]!==G[W])return!1}return!0}cloneTo(G){this._keys.length!==G._keys.length&&(G._keys=this._keys.slice(0));for(let V=0;V<this._keys.length;V++){const W=this._keys[V];G[W]=this[W]}}reset(){for(const G of this._keys)this._setDefaultValue(G)}_setDefaultValue(G){var V,W,J,R;const d=(null===(V=this._externalProperties)||void 0===V||null===(W=V[G])||void 0===W?void 0:W.type)??typeof this[G],k=null===(J=this._externalProperties)||void 0===J||null===(R=J[G])||void 0===R?void 0:R.default;switch(d){case"number":this[G]=k??0;break;case"string":this[G]=k??"";break;default:this[G]=k??!1}}toString(){let G="";for(let V=0;V<this._keys.length;V++){const W=this._keys[V],J=this[W];switch(typeof J){case"number":case"string":G+="#define "+W+" "+J+"\n";break;default:J&&(G+="#define "+W+"\n")}}return G}}},11818:(G,V,W)=>{W.d(V,{c:()=>R});var J=W(11262);class R{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(G){this._DiffuseTextureEnabled!==G&&(this._DiffuseTextureEnabled=G,J.b.MarkAllMaterialsAsDirty(1))}static get BaseWeightTextureEnabled(){return this._BaseWeightTextureEnabled}static set BaseWeightTextureEnabled(G){this._BaseWeightTextureEnabled!==G&&(this._BaseWeightTextureEnabled=G,J.b.MarkAllMaterialsAsDirty(1))}static get BaseDiffuseRoughnessTextureEnabled(){return this._BaseDiffuseRoughnessTextureEnabled}static set BaseDiffuseRoughnessTextureEnabled(G){this._BaseDiffuseRoughnessTextureEnabled!==G&&(this._BaseDiffuseRoughnessTextureEnabled=G,J.b.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(G){this._DetailTextureEnabled!==G&&(this._DetailTextureEnabled=G,J.b.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(G){this._DecalMapEnabled!==G&&(this._DecalMapEnabled=G,J.b.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(G){this._AmbientTextureEnabled!==G&&(this._AmbientTextureEnabled=G,J.b.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(G){this._OpacityTextureEnabled!==G&&(this._OpacityTextureEnabled=G,J.b.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(G){this._ReflectionTextureEnabled!==G&&(this._ReflectionTextureEnabled=G,J.b.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(G){this._EmissiveTextureEnabled!==G&&(this._EmissiveTextureEnabled=G,J.b.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(G){this._SpecularTextureEnabled!==G&&(this._SpecularTextureEnabled=G,J.b.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(G){this._BumpTextureEnabled!==G&&(this._BumpTextureEnabled=G,J.b.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(G){this._LightmapTextureEnabled!==G&&(this._LightmapTextureEnabled=G,J.b.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(G){this._RefractionTextureEnabled!==G&&(this._RefractionTextureEnabled=G,J.b.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(G){this._ColorGradingTextureEnabled!==G&&(this._ColorGradingTextureEnabled=G,J.b.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(G){this._FresnelEnabled!==G&&(this._FresnelEnabled=G,J.b.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(G){this._ClearCoatTextureEnabled!==G&&(this._ClearCoatTextureEnabled=G,J.b.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(G){this._ClearCoatBumpTextureEnabled!==G&&(this._ClearCoatBumpTextureEnabled=G,J.b.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(G){this._ClearCoatTintTextureEnabled!==G&&(this._ClearCoatTintTextureEnabled=G,J.b.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(G){this._SheenTextureEnabled!==G&&(this._SheenTextureEnabled=G,J.b.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(G){this._AnisotropicTextureEnabled!==G&&(this._AnisotropicTextureEnabled=G,J.b.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(G){this._ThicknessTextureEnabled!==G&&(this._ThicknessTextureEnabled=G,J.b.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(G){this._RefractionIntensityTextureEnabled!==G&&(this._RefractionIntensityTextureEnabled=G,J.b.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(G){this._TranslucencyIntensityTextureEnabled!==G&&(this._TranslucencyIntensityTextureEnabled=G,J.b.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(G){this._TranslucencyColorTextureEnabled!==G&&(this._TranslucencyColorTextureEnabled=G,J.b.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(G){this._IridescenceTextureEnabled!==G&&(this._IridescenceTextureEnabled=G,J.b.MarkAllMaterialsAsDirty(1))}}R._DiffuseTextureEnabled=!0,R._BaseWeightTextureEnabled=!0,R._BaseDiffuseRoughnessTextureEnabled=!0,R._DetailTextureEnabled=!0,R._DecalMapEnabled=!0,R._AmbientTextureEnabled=!0,R._OpacityTextureEnabled=!0,R._ReflectionTextureEnabled=!0,R._EmissiveTextureEnabled=!0,R._SpecularTextureEnabled=!0,R._BumpTextureEnabled=!0,R._LightmapTextureEnabled=!0,R._RefractionTextureEnabled=!0,R._ColorGradingTextureEnabled=!0,R._FresnelEnabled=!0,R._ClearCoatTextureEnabled=!0,R._ClearCoatBumpTextureEnabled=!0,R._ClearCoatTintTextureEnabled=!0,R._SheenTextureEnabled=!0,R._AnisotropicTextureEnabled=!0,R._ThicknessTextureEnabled=!0,R._RefractionIntensityTextureEnabled=!0,R._TranslucencyIntensityTextureEnabled=!0,R._TranslucencyColorTextureEnabled=!0,R._IridescenceTextureEnabled=!0},11432:(G,V,W)=>{W.d(V,{B:()=>u,D:()=>H,F:()=>L,I:()=>q,M:()=>f,N:()=>F,P:()=>i,R:()=>B,U:()=>D,W:()=>v,Z:()=>C,ab:()=>l,c:()=>b,db:()=>w,f:()=>x,h:()=>y,hb:()=>t,j:()=>A,n:()=>Y,r:()=>g,t:()=>S,v:()=>n,y:()=>p});var J=W(11201),R=W(11424),d=W(11169),k=W(11440),z=W(11449);const X=R.d.Black(),P={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function A(G,V,W){if(!G||G.LOGARITHMICDEPTH||G.indexOf&&G.indexOf("LOGARITHMICDEPTH")>=0){const G=W.activeCamera;1===G.mode&&J.c.Error("Logarithmic depth is not compatible with orthographic cameras!",20),V.setFloat("logarithmicDepthConstant",2/(Math.log(G.maxZ+1)/Math.LN2))}}function x(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];W&&G.fogEnabled&&(!V||V.applyFog)&&0!==G.fogMode&&(W.setFloat4("vFogInfos",G.fogMode,G.fogStart,G.fogEnd,G.fogDensity),J?(G.fogColor.toLinearSpaceToRef(X,G.getEngine().useExactSrgbConversions),W.setColor3("vFogColor",X)):W.setColor3("vFogColor",G.fogColor))}function q(G,V,W,J,R,d,k,z,X,A){const x=G.numMaxInfluencers||G.numInfluencers;return x<=0?0:(V.push("#define MORPHTARGETS"),G.hasPositions&&V.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),G.hasNormals&&V.push("#define MORPHTARGETTEXTURE_HASNORMALS"),G.hasTangents&&V.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),G.hasUVs&&V.push("#define MORPHTARGETTEXTURE_HASUVS"),G.hasUV2s&&V.push("#define MORPHTARGETTEXTURE_HASUV2S"),G.hasColors&&V.push("#define MORPHTARGETTEXTURE_HASCOLORS"),G.supportsPositions&&R&&V.push("#define MORPHTARGETS_POSITION"),G.supportsNormals&&d&&V.push("#define MORPHTARGETS_NORMAL"),G.supportsTangents&&k&&V.push("#define MORPHTARGETS_TANGENT"),G.supportsUVs&&z&&V.push("#define MORPHTARGETS_UV"),G.supportsUV2s&&X&&V.push("#define MORPHTARGETS_UV2"),G.supportsColors&&A&&V.push("#define MORPHTARGETS_COLOR"),V.push("#define NUM_MORPH_INFLUENCERS "+x),G.isUsingTextureForTargets&&V.push("#define MORPHTARGETS_TEXTURE"),P.NUM_MORPH_INFLUENCERS=x,P.NORMAL=d,P.TANGENT=k,P.UV=z,P.UV2=X,P.COLOR=A,L(W,J,P,R),x)}function L(G,V,W){let R=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const k=W.NUM_MORPH_INFLUENCERS;if(k>0&&d.c.LastCreatedEngine){const z=d.c.LastCreatedEngine.getCaps().maxVertexAttribs,X=V.morphTargetManager;if(null!==X&&void 0!==X&&X.isUsingTextureForTargets)return;const P=X&&X.supportsPositions&&R,A=X&&X.supportsNormals&&W.NORMAL,x=X&&X.supportsTangents&&W.TANGENT,q=X&&X.supportsUVs&&W.UV1,L=X&&X.supportsUV2s&&W.UV2,t=X&&X.supportsColors&&W.VERTEXCOLOR;for(let W=0;W<k;W++)P&&G.push("position"+W),A&&G.push("normal"+W),x&&G.push("tangent"+W),q&&G.push("uv_"+W),L&&G.push("uv2_"+W),t&&G.push("color"+W),G.length>z&&J.c.Error("Cannot add more vertex attributes for mesh "+V.name)}}function t(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];G.push("world0"),G.push("world1"),G.push("world2"),G.push("world3"),V&&(G.push("previousWorld0"),G.push("previousWorld1"),G.push("previousWorld2"),G.push("previousWorld3"))}function Y(G,V){const W=G.morphTargetManager;G&&W&&V.setFloatArray("morphTargetInfluences",W.influences)}function g(G,V){V.bindToEffect(G,"Scene")}function B(G,V,W){V._needUVs=!0,V[W]=!0,G.optimizeUVAllocation&&G.getTextureMatrix().isIdentityAs3x2()?(V[W+"DIRECTUV"]=G.coordinatesIndex+1,V["MAINUV"+(G.coordinatesIndex+1)]=!0):V[W+"DIRECTUV"]=0}function S(G,V,W){const J=G.getTextureMatrix();V.Td(W+"Matrix",J)}function p(G,V,W){W.BAKED_VERTEX_ANIMATION_TEXTURE&&W.INSTANCES&&G.push("bakedVertexAnimationSettingsInstanced")}function b(G,V,W){var J;if(V&&G&&(G.computeBonesUsingShaders&&V._bonesComputationForcedToCPU&&(G.computeBonesUsingShaders=!1),G.useBones&&G.computeBonesUsingShaders&&G.skeleton)){const R=G.skeleton;if(R.isUsingTextureForMatrices&&V.getUniformIndex("boneTextureWidth")>-1){const W=R.getTransformMatrixTexture(G);V.setTexture("boneSampler",W),V.setFloat("boneTextureWidth",4*(R.bones.length+1))}else{const d=R.getTransformMatrices(G);d&&(V.setMatrices("mBones",d),W&&G.HG().prePassRenderer&&G.HG().prePassRenderer.getIndex(2)&&(W.previousBones[G.uniqueId]||(W.previousBones[G.uniqueId]=d.slice()),V.setMatrices("mPreviousBones",W.previousBones[G.uniqueId]),J=d,W.previousBones[G.uniqueId].set(J)))}}}function r(G,V,W,J,R){let d=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];G._bindLight(V,W,J,R,d)}function y(G,V,W,J){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const d=Math.min(V.lightSources.length,R);for(let k=0;k<d;k++){r(V.lightSources[k],k,G,W,"boolean"===typeof J?J:J.SPECULARTERM,V.receiveShadows)}}function u(G,V,W,J){W.NUM_BONE_INFLUENCERS>0&&(J.addCPUSkinningFallback(0,V),G.push("matricesIndices"),G.push("matricesWeights"),W.NUM_BONE_INFLUENCERS>4&&(G.push("matricesIndicesExtra"),G.push("matricesWeightsExtra")))}function H(G,V){(V.INSTANCES||V.THIN_INSTANCES)&&t(G,!!V.PREPASS_VELOCITY),V.INSTANCESCOLOR&&G.push("instanceColor")}function n(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,R=0;for(let d=0;d<W&&G["LIGHT"+d];d++)d>0&&(R=J+d,V.addFallback(R,"LIGHT"+d)),G.SHADOWS||(G["SHADOW"+d]&&V.addFallback(J,"SHADOW"+d),G["SHADOWPCF"+d]&&V.addFallback(J,"SHADOWPCF"+d),G["SHADOWPCSS"+d]&&V.addFallback(J,"SHADOWPCSS"+d),G["SHADOWPOISSON"+d]&&V.addFallback(J,"SHADOWPOISSON"+d),G["SHADOWESM"+d]&&V.addFallback(J,"SHADOWESM"+d),G["SHADOWCLOSEESM"+d]&&V.addFallback(J,"SHADOWCLOSEESM"+d));return R++}function D(G,V,W,J,R,d,k){let z=arguments.length>7&&void 0!==arguments[7]&&arguments[7];k._areMiscDirty&&(k.LOGARITHMICDEPTH=W,k.POINTSIZE=J,k.FOG=R&&function(G,V){return V.fogEnabled&&G.applyFog&&0!==V.fogMode}(G,V),k.NONUNIFORMSCALING=G.nonUniformScaling,k.ALPHATEST=d,k.DECAL_AFTER_DETAIL=z)}function i(G,V,W,J){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!W._areLightsDirty)return W._needNormals;let k=0;const z={needNormals:W._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(G.lightsEnabled&&!d)for(const P of V.lightSources)if(e(G,V,P,k,W,J,z),k++,k===R)break;W.SPECULARTERM=z.specularEnabled,W.SHADOWS=z.shadowEnabled;for(let P=k;P<R;P++)void 0!==W["LIGHT"+P]&&(W["LIGHT"+P]=!1,W["HEMILIGHT"+P]=!1,W["POINTLIGHT"+P]=!1,W["DIRLIGHT"+P]=!1,W["SPOTLIGHT"+P]=!1,W["AREALIGHT"+P]=!1,W["SHADOW"+P]=!1,W["SHADOWCSM"+P]=!1,W["SHADOWCSMDEBUG"+P]=!1,W["SHADOWCSMNUM_CASCADES"+P]=!1,W["SHADOWCSMUSESHADOWMAXZ"+P]=!1,W["SHADOWCSMNOBLEND"+P]=!1,W["SHADOWCSM_RIGHTHANDED"+P]=!1,W["SHADOWPCF"+P]=!1,W["SHADOWPCSS"+P]=!1,W["SHADOWPOISSON"+P]=!1,W["SHADOWESM"+P]=!1,W["SHADOWCLOSEESM"+P]=!1,W["SHADOWCUBE"+P]=!1,W["SHADOWLOWQUALITY"+P]=!1,W["SHADOWMEDIUMQUALITY"+P]=!1);const X=G.getEngine().getCaps();return void 0===W.SHADOWFLOAT&&(z.needRebuild=!0),W.SHADOWFLOAT=z.shadowEnabled&&(X.textureFloatRender&&X.textureFloatLinearFiltering||X.textureHalfFloatRender&&X.textureHalfFloatLinearFiltering),W.LIGHTMAPEXCLUDED=z.lightmapMode,z.needRebuild&&W.rebuild(),z.needNormals}function e(G,V,W,J,R,d,z){switch(z.needNormals=!0,void 0===R["LIGHT"+J]&&(z.needRebuild=!0),R["LIGHT"+J]=!0,R["SPOTLIGHT"+J]=!1,R["HEMILIGHT"+J]=!1,R["POINTLIGHT"+J]=!1,R["DIRLIGHT"+J]=!1,R["AREALIGHT"+J]=!1,W.prepareLightSpecificDefines(R,J),R["LIGHT_FALLOFF_PHYSICAL"+J]=!1,R["LIGHT_FALLOFF_GLTF"+J]=!1,R["LIGHT_FALLOFF_STANDARD"+J]=!1,W.falloffType){case k.b.FALLOFF_GLTF:R["LIGHT_FALLOFF_GLTF"+J]=!0;break;case k.b.FALLOFF_PHYSICAL:R["LIGHT_FALLOFF_PHYSICAL"+J]=!0;break;case k.b.FALLOFF_STANDARD:R["LIGHT_FALLOFF_STANDARD"+J]=!0}if(d&&!W.sP.equalsFloats(0,0,0)&&(z.specularEnabled=!0),R["SHADOW"+J]=!1,R["SHADOWCSM"+J]=!1,R["SHADOWCSMDEBUG"+J]=!1,R["SHADOWCSMNUM_CASCADES"+J]=!1,R["SHADOWCSMUSESHADOWMAXZ"+J]=!1,R["SHADOWCSMNOBLEND"+J]=!1,R["SHADOWCSM_RIGHTHANDED"+J]=!1,R["SHADOWPCF"+J]=!1,R["SHADOWPCSS"+J]=!1,R["SHADOWPOISSON"+J]=!1,R["SHADOWESM"+J]=!1,R["SHADOWCLOSEESM"+J]=!1,R["SHADOWCUBE"+J]=!1,R["SHADOWLOWQUALITY"+J]=!1,R["SHADOWMEDIUMQUALITY"+J]=!1,V&&V.receiveShadows&&G.shadowsEnabled&&W.shadowEnabled){const V=W.getShadowGenerator(G.activeCamera)??W.getShadowGenerator();if(V){const G=V.getShadowMap();G&&G.renderList&&G.renderList.length>0&&(z.shadowEnabled=!0,V.prepareDefines(R,J))}}W.lightmapMode!=k.b.LIGHTMAP_DEFAULT?(z.lightmapMode=!0,R["LIGHTMAPEXCLUDED"+J]=!0,R["LIGHTMAPNOSPECULAR"+J]=W.lightmapMode==k.b.LIGHTMAP_SHADOWSONLY):(R["LIGHTMAPEXCLUDED"+J]=!1,R["LIGHTMAPNOSPECULAR"+J]=!1)}function F(G,V,W,J,R){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,k=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=function(G,V){let W=!1;if(G.activeCamera){const J=V.CAMERA_ORTHOGRAPHIC?1:0,R=V.CAMERA_PERSPECTIVE?1:0,d=1===G.activeCamera.mode?1:0,k=0===G.activeCamera.mode?1:0;(J^d||R^k)&&(V.CAMERA_ORTHOGRAPHIC=1===d,V.CAMERA_PERSPECTIVE=1===k,W=!0)}return W}(G,J);!1!==d&&(X=(0,z.j)(W,G,J)),J.DEPTHPREPASS!==!V.getColorWrite()&&(J.DEPTHPREPASS=!J.DEPTHPREPASS,X=!0),J.INSTANCES!==R&&(J.INSTANCES=R,X=!0),J.THIN_INSTANCES!==k&&(J.THIN_INSTANCES=k,X=!0),X&&J.markAsUnprocessed()}function f(G,V,W,J){let R=arguments.length>4&&void 0!==arguments[4]&&arguments[4],d=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],k=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!V._areAttributesDirty&&V._needNormals===V._normals&&V._needUVs===V._uvs)return!1;V._normals=V._needNormals,V._uvs=V._needUVs,V.NORMAL=V._needNormals&&G.isVerticesDataPresent("normal"),V._needNormals&&G.isVerticesDataPresent("tangent")&&(V.TANGENT=!0);for(let z=1;z<=6;++z)V["UV"+z]=!!V._needUVs&&G.isVerticesDataPresent(`uv${1===z?"":z}`);if(W){const W=G.useVertexColors&&G.isVerticesDataPresent("color");V.VERTEXCOLOR=W,V.VERTEXALPHA=G.hasVertexAlpha&&W&&d}return G.isVerticesDataPresent("instanceColor")&&(G.hasInstances||G.hasThinInstances)&&(V.INSTANCESCOLOR=!0),J&&function(G,V){if(G.useBones&&G.computeBonesUsingShaders&&G.skeleton){V.NUM_BONE_INFLUENCERS=G.numBoneInfluencers;const W=void 0!==V.BONETEXTURE;if(G.skeleton.isUsingTextureForMatrices&&W)V.BONETEXTURE=!0;else{V.BonesPerMesh=G.skeleton.bones.length+1,V.BONETEXTURE=!W&&void 0;const J=G.HG().prePassRenderer;if(J&&J.enabled){const W=-1===J.excludedSkinnedMesh.indexOf(G);V.BONES_VELOCITY_ENABLED=W}}}else V.NUM_BONE_INFLUENCERS=0,V.BonesPerMesh=0,void 0!==V.BONETEXTURE&&(V.BONETEXTURE=!1)}(G,V),R&&function(G,V){const W=G.morphTargetManager;W?(V.MORPHTARGETS_UV=W.supportsUVs&&V.UV1,V.MORPHTARGETS_UV2=W.supportsUV2s&&V.UV2,V.MORPHTARGETS_TANGENT=W.supportsTangents&&V.TANGENT,V.MORPHTARGETS_NORMAL=W.supportsNormals&&V.NORMAL,V.MORPHTARGETS_POSITION=W.supportsPositions,V.MORPHTARGETS_COLOR=W.supportsColors,V.MORPHTARGETTEXTURE_HASUVS=W.hasUVs,V.MORPHTARGETTEXTURE_HASUV2S=W.hasUV2s,V.MORPHTARGETTEXTURE_HASTANGENTS=W.hasTangents,V.MORPHTARGETTEXTURE_HASNORMALS=W.hasNormals,V.MORPHTARGETTEXTURE_HASPOSITIONS=W.hasPositions,V.MORPHTARGETTEXTURE_HASCOLORS=W.hasColors,V.NUM_MORPH_INFLUENCERS=W.numMaxInfluencers||W.numInfluencers,V.MORPHTARGETS=V.NUM_MORPH_INFLUENCERS>0,V.MORPHTARGETS_TEXTURE=W.isUsingTextureForTargets):(V.MORPHTARGETS_UV=!1,V.MORPHTARGETS_UV2=!1,V.MORPHTARGETS_TANGENT=!1,V.MORPHTARGETS_NORMAL=!1,V.MORPHTARGETS_POSITION=!1,V.MORPHTARGETS_COLOR=!1,V.MORPHTARGETTEXTURE_HASUVS=!1,V.MORPHTARGETTEXTURE_HASUV2S=!1,V.MORPHTARGETTEXTURE_HASTANGENTS=!1,V.MORPHTARGETTEXTURE_HASNORMALS=!1,V.MORPHTARGETTEXTURE_HASPOSITIONS=!1,V.MORPHTARGETTEXTURE_HAS_COLORS=!1,V.MORPHTARGETS=!1,V.NUM_MORPH_INFLUENCERS=0)}(G,V),k&&function(G,V){const W=G.bakedVertexAnimationManager;V.BAKED_VERTEX_ANIMATION_TEXTURE=!(!W||!W.isEnabled)}(G,V),!0}function v(G,V){if(G.activeCamera){const W=V.MULTIVIEW;V.MULTIVIEW=null!==G.activeCamera.outputRenderTarget&&G.activeCamera.outputRenderTarget.getViewCount()>1,V.MULTIVIEW!=W&&V.markAsUnprocessed()}}function C(G,V,W){const J=V.ORDER_INDEPENDENT_TRANSPARENCY,R=V.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;V.ORDER_INDEPENDENT_TRANSPARENCY=G.useOrderIndependentTransparency&&W,V.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!G.getEngine().getCaps().textureFloatLinearFiltering,J===V.ORDER_INDEPENDENT_TRANSPARENCY&&R===V.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||V.markAsUnprocessed()}function l(G,V,W){const J=V.PREPASS;if(!V._arePrePassDirty)return;const R=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(G.prePassRenderer&&G.prePassRenderer.enabled&&W){V.PREPASS=!0,V.SCENE_MRT_COUNT=G.prePassRenderer.mrtCount,V.PREPASS_NORMAL_WORLDSPACE=G.prePassRenderer.generateNormalsInWorldSpace,V.PREPASS_COLOR=!0,V.PREPASS_COLOR_INDEX=0;for(let W=0;W<R.length;W++){const J=G.prePassRenderer.getIndex(R[W].type);-1!==J?(V[R[W].define]=!0,V[R[W].index]=J):V[R[W].define]=!1}}else{V.PREPASS=!1;for(let G=0;G<R.length;G++)V[R[G].define]=!1}V.PREPASS!=J&&(V.markAsUnprocessed(),V.markAsImageProcessingDirty())}function m(G,V,W,J){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5],k=arguments.length>6&&void 0!==arguments[6]&&arguments[6];R&&R.push("Light"+G),d||(V.push("vLightData"+G,"vLightDiffuse"+G,"vLightSpecular"+G,"vLightDirection"+G,"vLightWidth"+G,"vLightHeight"+G,"vLightFalloff"+G,"vLightGround"+G,"lightMatrix"+G,"shadowsInfo"+G,"depthValues"+G),W.push("shadowTexture"+G),W.push("depthTexture"+G),V.push("viewFrustumZ"+G,"cascadeBlendFactor"+G,"lightSizeUVCorrection"+G,"depthCorrection"+G,"penumbraDarkness"+G,"frustumLengths"+G),J&&(W.push("projectionLightTexture"+G),V.push("textureProjectionMatrix"+G)),k&&W.push("iesLightTexture"+G))}function w(G,V,W){let J,R,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(G.uniformsNames){const k=G;J=k.uniformsNames,R=k.uniformBuffersNames,V=k.samplers,W=k.defines,d=k.maxSimultaneousLights||0}else J=G,V||(V=[]);for(let k=0;k<d&&W["LIGHT"+k];k++)m(k,J,V,W["PROJECTEDLIGHTTEXTURE"+k],R,!1,W["IESLIGHTTEXTURE"+k]);W.NUM_MORPH_INFLUENCERS&&(J.push("morphTargetInfluences"),J.push("morphTargetCount")),W.BAKED_VERTEX_ANIMATION_TEXTURE&&(J.push("bakedVertexAnimationSettings"),J.push("bakedVertexAnimationTextureSizeInverted"),J.push("bakedVertexAnimationTime"),V.push("bakedVertexAnimationTexture"))}},11838:(G,V,W)=>{W.d(V,{e:()=>d});var J,R=W(11136);!function(G){G[G.Zero=0]="Zero",G[G.One=1]="One",G[G.MaxViewZ=2]="MaxViewZ"}(J||(J={}));class d{static CreateConfiguration(G){return d._Configurations[G]={defines:{},previousWorldMatrices:{},previousViewProjection:R.c.Zero(),currentViewProjection:R.c.Zero(),previousBones:{},lastUpdateFrameId:-1,excludedSkinnedMesh:[],reverseCulling:!1},d._Configurations[G]}static DeleteConfiguration(G){delete d._Configurations[G]}static GetConfiguration(G){return d._Configurations[G]}static AddUniformsAndSamplers(G,V){G.push("previousWorld","previousViewProjection","mPreviousBones")}static MarkAsDirty(G,V){for(const W of V)if(W.Ed)for(const V of W.Ed)V._removeDrawWrapper(G)}static PrepareDefines(G,V,W){if(!W._arePrePassDirty)return;const J=d._Configurations[G];if(!J)return;W.PREPASS=!0,W.PREPASS_COLOR=!1,W.PREPASS_COLOR_INDEX=-1;let R=0;for(let k=0;k<d.GeometryTextureDescriptions.length;k++){const G=d.GeometryTextureDescriptions[k],V=G.define,z=G.defineIndex,X=J.defines[z];void 0!==X?(W[V]=!0,W[z]=X,R++):(W[V]=!1,delete W[z])}W.SCENE_MRT_COUNT=R,W.BONES_VELOCITY_ENABLED=V.useBones&&V.computeBonesUsingShaders&&V.skeleton&&!V.skeleton.isUsingTextureForMatrices&&-1===J.excludedSkinnedMesh.indexOf(V)}static Bind(G,V,W,J,R){const k=d._Configurations[G];if(!k)return;const z=W.HG(),X=z.getEngine();if(k.reverseCulling&&X.setStateCullFaceType(z._mirroredCameraPosition?R.cullBackFaces:!R.cullBackFaces),(void 0!==k.defines.PREPASS_VELOCITY_INDEX||void 0!==k.defines.PREPASS_VELOCITY_LINEAR_INDEX)&&(k.previousWorldMatrices[W.uniqueId]||(k.previousWorldMatrices[W.uniqueId]=J.clone()),k.previousViewProjection||(k.previousViewProjection=z.getTransformMatrix().clone(),k.currentViewProjection=z.getTransformMatrix().clone()),k.currentViewProjection.updateFlag!==z.getTransformMatrix().updateFlag?(k.lastUpdateFrameId=X.frameId,k.previousViewProjection.J(k.currentViewProjection),k.currentViewProjection.J(z.getTransformMatrix())):k.lastUpdateFrameId!==X.frameId&&(k.lastUpdateFrameId=X.frameId,k.previousViewProjection.J(k.currentViewProjection)),V.setMatrix("previousWorld",k.previousWorldMatrices[W.uniqueId]),V.setMatrix("previousViewProjection",k.previousViewProjection),k.previousWorldMatrices[W.uniqueId]=J.clone(),W.useBones&&W.computeBonesUsingShaders&&W.skeleton)){const G=W.skeleton;if(!G.isUsingTextureForMatrices||-1===V.getUniformIndex("boneTextureWidth")){const J=G.getTransformMatrices(W);J&&(k.previousBones[W.uniqueId]||(k.previousBones[W.uniqueId]=J.slice()),V.setMatrices("mPreviousBones",k.previousBones[W.uniqueId]),k.previousBones[W.uniqueId].set(J))}}}}d.GeometryTextureDescriptions=[{type:0,name:"Irradiance",clearType:0,define:"PREPASS_IRRADIANCE",defineIndex:"PREPASS_IRRADIANCE_INDEX"},{type:1,name:"WorldPosition",clearType:0,define:"PREPASS_POSITION",defineIndex:"PREPASS_POSITION_INDEX"},{type:2,name:"Velocity",clearType:0,define:"PREPASS_VELOCITY",defineIndex:"PREPASS_VELOCITY_INDEX"},{type:3,name:"Reflectivity",clearType:0,define:"PREPASS_REFLECTIVITY",defineIndex:"PREPASS_REFLECTIVITY_INDEX"},{type:5,name:"ViewDepth",clearType:2,define:"PREPASS_DEPTH",defineIndex:"PREPASS_DEPTH_INDEX"},{type:6,name:"ViewNormal",clearType:0,define:"PREPASS_NORMAL",defineIndex:"PREPASS_NORMAL_INDEX"},{type:7,name:"AlbedoSqrt",clearType:0,define:"PREPASS_ALBEDO_SQRT",defineIndex:"PREPASS_ALBEDO_SQRT_INDEX"},{type:8,name:"WorldNormal",clearType:0,define:"PREPASS_WORLD_NORMAL",defineIndex:"PREPASS_WORLD_NORMAL_INDEX"},{type:9,name:"LocalPosition",clearType:0,define:"PREPASS_LOCAL_POSITION",defineIndex:"PREPASS_LOCAL_POSITION_INDEX"},{type:10,name:"ScreenDepth",clearType:1,define:"PREPASS_SCREENSPACE_DEPTH",defineIndex:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:11,name:"LinearVelocity",clearType:0,define:"PREPASS_VELOCITY_LINEAR",defineIndex:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:12,name:"Albedo",clearType:0,define:"PREPASS_ALBEDO",defineIndex:"PREPASS_ALBEDO_INDEX"},{type:13,name:"NormalizedViewDepth",clearType:1,define:"PREPASS_NORMALIZED_VIEW_DEPTH",defineIndex:"PREPASS_NORMALIZED_VIEW_DEPTH_INDEX"}],d._Configurations={}},11798:(G,V,W)=>{W.d(V,{b:()=>B});var J=W(11317),R=W(11324),d=W(11313),k=W(11169),z=W(11245),X=W(11270);const P=new RegExp("^([gimus]+)!");class A{constructor(G){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=G,this._scene=G.HG(),this._engine=this._scene.getEngine()}_addPlugin(G){for(let J=0;J<this._plugins.length;++J)if(this._plugins[J].name===G.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!G.isCompatible(this._material.shaderLanguage))throw`The plugin "${G.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const V=G.getClassName();A._MaterialPluginClassToMainDefine[V]||(A._MaterialPluginClassToMainDefine[V]="MATERIALPLUGIN_"+ ++A._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(G,V)=>this._handlePluginEvent(G,V),this._plugins.push(G),this._plugins.sort(((G,V)=>G.priority-V.priority)),this._codeInjectionPoints={};const W={};W[A._MaterialPluginClassToMainDefine[V]]={type:"boolean",default:!0};for(const J of this._plugins)J.collectDefines(W),this._collectPointNames("vertex",J.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",J.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=W,!0}_activatePlugin(G){-1===this._activePlugins.indexOf(G)&&(this._activePlugins.push(G),this._activePlugins.sort(((G,V)=>G.priority-V.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),G.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(G),this._activePluginsForExtraEvents.sort(((G,V)=>G.priority-V.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(G){for(let V=0;V<this._plugins.length;++V)if(this._plugins[V].name===G)return this._plugins[V];return null}_handlePluginEventIsReadyForSubMesh(G){let V=!0;for(const W of this._activePlugins)V=V&&W.isReadyForSubMesh(G.defines,this._scene,this._engine,G.subMesh);G.isReadyForSubMesh=V}_handlePluginEventPrepareDefinesBeforeAttributes(G){for(const V of this._activePlugins)V.prepareDefinesBeforeAttributes(G.defines,this._scene,G.mesh)}_handlePluginEventPrepareDefines(G){for(const V of this._activePlugins)V.prepareDefines(G.defines,this._scene,G.mesh)}_handlePluginEventHardBindForSubMesh(G){for(const V of this._activePluginsForExtraEvents)V.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,G.subMesh)}_handlePluginEventBindForSubMesh(G){for(const V of this._activePlugins)V.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,G.subMesh)}_handlePluginEventHasRenderTargetTextures(G){let V=!1;for(const W of this._activePluginsForExtraEvents)if(V=W.hasRenderTargetTextures(),V)break;G.hasRenderTargetTextures=V}_handlePluginEventFillRenderTargetTextures(G){for(const V of this._activePluginsForExtraEvents)V.fillRenderTargetTextures(G.renderTargets)}_handlePluginEvent(G,V){switch(G){case 512:{const G=V;for(const V of this._activePlugins)V.getActiveTextures(G.activeTextures);break}case 256:{const G=V;for(const V of this._activePlugins)V.getAnimatables(G.animatables);break}case 1024:{const G=V;let W=!1;for(const V of this._activePlugins)if(W=V.hasTexture(G.texture),W)break;G.hasTexture=W;break}case 2:{const G=V;for(const V of this._plugins)V.dispose(G.forceDisposeTextures);break}case 4:V.defineNames=this._defineNamesFromPlugins;break;case 128:{const G=V;for(const V of this._activePlugins)G.fallbackRank=V.addFallbacks(G.defines,G.fallbacks,G.fallbackRank),V.getAttributes(G.attributes,this._scene,G.mesh);this._uniformList.length>0&&G.uniforms.push(...this._uniformList),this._samplerList.length>0&&G.samplers.push(...this._samplerList),this._uboList.length>0&&G.uniformBuffersNames.push(...this._uboList),G.customCode=this._injectCustomCode(G,G.customCode);break}case 8:{const G=V;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const W=1===this._material.shaderLanguage;for(const V of this._plugins){const J=V.getUniforms(this._material.shaderLanguage);if(J){if(J.ubo)for(const V of J.ubo){if(V.size&&V.type){const J=V.arraySize??0;if(G.ubo.addUniform(V.name,V.size,J),W){let G;switch(V.type){case"mat4":G="mat4x4f";break;case"float":G="f32";break;default:G=`${V.type}f`}this._uboDeclaration+=J>0?`uniform ${V.name}: array<${G}, ${J}>;\n`:`uniform ${V.name}: ${G};\n`}else this._uboDeclaration+=`${V.type} ${V.name}${J>0?`[${J}]`:""};\n`}this._uniformList.push(V.name)}J.vertex&&(this._vertexDeclaration+=J.vertex+"\n"),J.fragment&&(this._fragmentDeclaration+=J.fragment+"\n")}V.getSamplers(this._samplerList),V.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(G,V){if(V)for(const W in V)this._codeInjectionPoints[G]||(this._codeInjectionPoints[G]={}),this._codeInjectionPoints[G][W]=!0}_injectCustomCode(G,V){return(W,J)=>{var R;V&&(J=V(W,J)),this._uboDeclaration&&(J=J.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(J=J.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(J=J.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const d=null===(R=this._codeInjectionPoints)||void 0===R?void 0:R[W];if(!d)return J;let k=null;for(let V in d){let R="";for(const J of this._activePlugins){var A;let d=null===(A=J.getCustomCode(W,this._material.shaderLanguage))||void 0===A?void 0:A[V];if(d){if(J.resolveIncludes){if(null===k){const V=0;k={defines:[],indexParameters:G.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:X.d.GetShadersRepository(V),includesShadersStore:X.d.GetIncludesShadersStore(V),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}k.isFragment="fragment"===W,(0,z.j)(d,k,(G=>d=G))}R+=d+"\n"}}if(R.length>0)if("!"===V.charAt(0)){V=V.substring(1);let G="g";if("!"===V.charAt(0))G="",V=V.substring(1);else{const W=P.exec(V);W&&W.length>=2&&(G=W[1],V=V.substring(G.length+1))}G.indexOf("g")<0&&(G+="g");const W=J,d=new RegExp(V,G);let k=d.exec(W);for(;null!==k;){let G=R;for(let V=0;V<k.length;++V)G=G.replace("$"+V,k[V]);J=J.replace(k[0],G),k=d.exec(W)}}else{const G="#define "+V;J=J.replace(G,"\n"+R+"\n"+G)}}return J}}}A._MaterialPluginClassToMainDefine={},A._MaterialPluginCounter=0,k.c.OnEnginesDisposedObservable.add((()=>{t()}));const x=[];let q=!1,L=null;function t(){x.length=0,q=!1,d.e.OnEventObservable.remove(L),L=null}var Y=W(11411),g=W(11159);class B{isCompatible(G){return 0===G}_enable(G){G&&this._pluginManager._activatePlugin(this)}constructor(G,V,W,J){let R=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],d=arguments.length>5&&void 0!==arguments[5]&&arguments[5],k=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this.doNotSerialize=!1,this._material=G,this.name=V,this.priority=W,this.resolveIncludes=k,G.pluginManager||(G.pluginManager=new A(G),G.Md.add((()=>{G.pluginManager=void 0}))),this._pluginDefineNames=J,this._pluginManager=G.pluginManager,R&&this._pluginManager._addPlugin(this),d&&this._enable(!0),this.markAllDefinesAsDirty=G._dirtyCallbacks[127]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(G,V,W,J){return!0}hardBindForSubMesh(G,V,W,J){}bindForSubMesh(G,V,W,J){}dispose(G){}getCustomCode(G){return null}collectDefines(G){if(this._pluginDefineNames)for(const V of Object.keys(this._pluginDefineNames)){if("_"===V[0])continue;const W=typeof this._pluginDefineNames[V];G[V]={type:"number"===W?"number":"string"===W?"string":"boolean"===W?"boolean":"object",default:this._pluginDefineNames[V]}}}prepareDefinesBeforeAttributes(G,V,W){}prepareDefines(G,V,W){}hasTexture(G){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(G){}getActiveTextures(G){}getAnimatables(G){}addFallbacks(G,V,W){return W}getSamplers(G){}getAttributes(G,V,W){}getUniformBuffersNames(G){}getUniforms(){return{}}copyTo(G){Y.e.Clone((()=>G),this)}serialize(){return Y.e.Serialize(this)}parse(G,V,W){Y.e.Parse((()=>this),G,V,W)}}(0,J.e)([(0,R.I)()],B.prototype,"name",void 0),(0,J.e)([(0,R.I)()],B.prototype,"priority",void 0),(0,J.e)([(0,R.I)()],B.prototype,"resolveIncludes",void 0),(0,J.e)([(0,R.I)()],B.prototype,"registerForExtraEvents",void 0),(0,g.d)("BABYLON.MaterialPluginBase",B)},11557:(G,V,W)=>{W.d(V,{d:()=>k});var J=W(11313),R=W(11416),d=W(11159);class k extends J.e{get od(){return this._subMaterials}set od(G){this._subMaterials=G,this._hookArray(G)}getChildren(){return this.od}constructor(G,V){super(G,V,!0),this._waitingSubMaterialsUniqueIds=[],this.HG().addMultiMaterial(this),this.od=[],this._storeEffectOnSubMeshes=!0}_hookArray(G){var V=this;const W=G.push;G.push=function(){for(var J=arguments.length,R=new Array(J),d=0;d<J;d++)R[d]=arguments[d];const k=W.apply(G,R);return V._markAllSubMeshesAsTexturesDirty(),k};const J=G.splice;G.splice=(V,W)=>{const R=J.apply(G,[V,W]);return this._markAllSubMeshesAsTexturesDirty(),R}}getSubMaterial(G){return G<0||G>=this.od.length?this.HG().defaultMaterial:this.od[G]}getActiveTextures(){return super.getActiveTextures().concat(...this.od.map((G=>G?G.getActiveTextures():[])))}hasTexture(G){if(super.hasTexture(G))return!0;for(let W=0;W<this.od.length;W++){var V;if(null!==(V=this.od[W])&&void 0!==V&&V.hasTexture(G))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(G,V,W){for(let J=0;J<this.od.length;J++){const R=this.od[J];if(R){if(R._storeEffectOnSubMeshes){if(!R.isReadyForSubMesh(G,V,W))return!1;continue}if(!R.isReady(G))return!1}}return!0}clone(G,V){const W=new k(G,this.HG());for(let J=0;J<this.od.length;J++){let R=null;const d=this.od[J];R=V&&d?d.clone(G+"-"+d.name):this.od[J],W.od.push(R)}return W}serialize(){const G={};G.name=this.name,G.id=this.id,G.uniqueId=this.uniqueId,R.c&&(G.tags=R.c.GetTags(this)),G.materialsUniqueIds=[],G.materials=[];for(let V=0;V<this.od.length;V++){const W=this.od[V];W?(G.materialsUniqueIds.push(W.uniqueId),G.materials.push(W.id)):(G.materialsUniqueIds.push(null),G.materials.push(null))}return G}dispose(G,V,W){const J=this.HG();if(!J)return;if(W)for(let d=0;d<this.od.length;d++){const W=this.od[d];W&&W.dispose(G,V)}const R=J.multiMaterials.indexOf(this);R>=0&&J.multiMaterials.splice(R,1),super.dispose(G,V)}static ParseMultiMaterial(G,V){const W=new k(G.name,V);if(W.id=G.id,W._loadedUniqueId=G.uniqueId,R.c&&R.c.AddTagsTo(W,G.tags),G.materialsUniqueIds)W._waitingSubMaterialsUniqueIds=G.materialsUniqueIds;else for(const J of G.materials)W.od.push(V.getLastMaterialById(J));return W}}(0,d.d)("BABYLON.MultiMaterial",k)},11804:(G,V,W)=>{W.d(V,{b:()=>J});class J{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(G){G.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(G){}bindForSubMesh(G,V,W,J,R){if(V.prePassRenderer&&V.prePassRenderer.enabled&&V.prePassRenderer.currentRTisSceneRT&&(-1!==V.prePassRenderer.getIndex(2)||-1!==V.prePassRenderer.getIndex(11))){this.previousWorldMatrices[W.uniqueId]||(this.previousWorldMatrices[W.uniqueId]=J.clone()),this.previousViewProjection||(this.previousViewProjection=V.getTransformMatrix().clone(),this.currentViewProjection=V.getTransformMatrix().clone());const R=V.getEngine();this.currentViewProjection.updateFlag!==V.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=R.frameId,this.previousViewProjection.J(this.currentViewProjection),this.currentViewProjection.J(V.getTransformMatrix())):this._lastUpdateFrameId!==R.frameId&&(this._lastUpdateFrameId=R.frameId,this.previousViewProjection.J(this.currentViewProjection)),G.setMatrix("previousWorld",this.previousWorldMatrices[W.uniqueId]),G.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[W.uniqueId]=J.clone()}}}},11811:(G,V,W)=>{W.d(V,{d:()=>d});var J=W(11136),R=W(11313);class d extends R.e{constructor(G,V){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(G,V,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new J.c,this._storeEffectOnSubMeshes=W}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(G,V){return!!G&&(!this._storeEffectOnSubMeshes||(!G.Ed||0===G.Ed.length||this.isReadyForSubMesh(G,G.Ed[0],V)))}_isReadyForSubMesh(G){const V=G.materialDefines;return!(this.checkReadyOnEveryCall||!G.effect||!V||V._renderId!==this.HG().getRenderId())}bindOnlyWorldMatrix(G){this._activeEffect.setMatrix("world",G)}bindOnlyNormalMatrix(G){this._activeEffect.setMatrix("normalMatrix",G)}bind(G,V){V&&this.bindForSubMesh(G,V,V.Ed[0])}_afterBind(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0;super._afterBind(G,V,W),this.HG()._cachedEffect=V,W?W._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return W._drawWrapper._forceRebindOnNextCall||G.isCachedMaterialInvalid(this,V,J)}dispose(G,V,W){this._activeEffect=void 0,super.dispose(G,V,W)}}},11881:(G,V,W)=>{W.d(V,{d:()=>g});var J=W(11411),R=W(11737),d=W(11136),k=W(11345),z=W(11666),X=W(11159),P=W(11832),A=W(11222),x=W(11811),q=W(11169),L=W(11449),t=W(11432);const Y={effect:null,subMesh:null};class g extends x.d{constructor(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(G,V,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new d.c,this._cachedWorldViewProjectionMatrix=new d.c,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=W,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","IV","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...J}}get shaderPath(){return this._shaderPath}set shaderPath(G){this._shaderPath=G}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(G){-1===this._options.uniforms.indexOf(G)&&this._options.uniforms.push(G)}setTexture(G,V){return-1===this._options.samplers.indexOf(G)&&this._options.samplers.push(G),this._textures[G]=V,this}removeTexture(G){delete this._textures[G]}setTextureArray(G,V){return-1===this._options.samplers.indexOf(G)&&this._options.samplers.push(G),this._checkUniform(G),this._textureArrays[G]=V,this}setExternalTexture(G,V){return-1===this._options.externalTextures.indexOf(G)&&this._options.externalTextures.push(G),this._externalTextures[G]=V,this}setFloat(G,V){return this._checkUniform(G),this._floats[G]=V,this}setInt(G,V){return this._checkUniform(G),this._ints[G]=V,this}setUInt(G,V){return this._checkUniform(G),this._uints[G]=V,this}setFloats(G,V){return this._checkUniform(G),this._floatsArrays[G]=V,this}setColor3(G,V){return this._checkUniform(G),this._colors3[G]=V,this}setColor3Array(G,V){return this._checkUniform(G),this._colors3Arrays[G]=V.reduce(((G,V)=>(G.push(V.r,V.g,V.b),G)),[]),this}setColor4(G,V){return this._checkUniform(G),this._colors4[G]=V,this}setColor4Array(G,V){return this._checkUniform(G),this._colors4Arrays[G]=V.reduce(((G,V)=>(G.push(V.r,V.g,V.b,V.a),G)),[]),this}setVector2(G,V){return this._checkUniform(G),this._vectors2[G]=V,this}setVector3(G,V){return this._checkUniform(G),this._vectors3[G]=V,this}setVector4(G,V){return this._checkUniform(G),this._vectors4[G]=V,this}setQuaternion(G,V){return this._checkUniform(G),this._quaternions[G]=V,this}setQuaternionArray(G,V){return this._checkUniform(G),this._quaternionsArrays[G]=V.reduce(((G,V)=>(V.toArray(G,G.length),G)),[]),this}setMatrix(G,V){return this._checkUniform(G),this._matrices[G]=V,this}setMatrices(G,V){this._checkUniform(G);const W=new Float32Array(16*V.length);for(let J=0;J<V.length;J++){V[J].copyToArray(W,16*J)}return this._matrixArrays[G]=W,this}setMatrix3x3(G,V){return this._checkUniform(G),this._matrices3x3[G]=V,this}setMatrix2x2(G,V){return this._checkUniform(G),this._matrices2x2[G]=V,this}setArray2(G,V){return this._checkUniform(G),this._vectors2Arrays[G]=V,this}setArray3(G,V){return this._checkUniform(G),this._vectors3Arrays[G]=V,this}setArray4(G,V){return this._checkUniform(G),this._vectors4Arrays[G]=V,this}setUniformBuffer(G,V){return-1===this._options.uniformBuffers.indexOf(G)&&this._options.uniformBuffers.push(G),this._uniformBuffers[G]=V,this}setTextureSampler(G,V){return-1===this._options.samplerObjects.indexOf(G)&&this._options.samplerObjects.push(G),this._textureSamplers[G]=V,this}setStorageBuffer(G,V){return-1===this._options.storageBuffers.indexOf(G)&&this._options.storageBuffers.push(G),this._storageBuffers[G]=V,this}setDefine(G,V){const W=G.trimEnd()+" ",J=this.options.defines.findIndex((V=>V===G||V.startsWith(W)));return J>=0&&this.options.defines.splice(J,1),("boolean"!==typeof V||V)&&this.options.defines.push(W+V),this}isReadyForSubMesh(G,V,W){return this.isReady(G,W,V)}isReady(G,V,W){var J;const d=W&&this._storeEffectOnSubMeshes;if(this.isFrozen){const G=d?W._drawWrapper:this._drawWrapper;if(G.effect&&G._wasPreviouslyReady&&G._wasPreviouslyUsingInstances===V)return!0}const z=this.HG(),X=z.getEngine(),A=[],x=[];let q=null,g=this._shaderPath,B=this._options.uniforms,S=this._options.uniformBuffers,p=this._options.samplers;X.getCaps().multiview&&z.activeCamera&&z.activeCamera.outputRenderTarget&&z.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,A.push("#define MULTIVIEW"),-1!==B.indexOf("viewProjection")&&-1===B.indexOf("viewProjectionR")&&B.push("viewProjectionR"));for(let R=0;R<this._options.defines.length;R++){const G=0===this._options.defines[R].indexOf("#define")?this._options.defines[R]:`#define ${this._options.defines[R]}`;A.push(G)}for(let R=0;R<this._options.attributes.length;R++)x.push(this._options.attributes[R]);if(G&&G.isVerticesDataPresent(k.c.ColorKind)&&(-1===x.indexOf(k.c.ColorKind)&&x.push(k.c.ColorKind),A.push("#define VERTEXCOLOR")),V&&(A.push("#define INSTANCES"),(0,t.hb)(x,this._materialHelperNeedsPreviousMatrices),null!==G&&void 0!==G&&G.hasThinInstances&&(A.push("#define THIN_INSTANCES"),G&&G.isVerticesDataPresent(k.c.ColorInstanceKind)&&(x.push(k.c.ColorInstanceKind),A.push("#define INSTANCESCOLOR")))),G&&G.useBones&&G.computeBonesUsingShaders&&G.skeleton){x.push(k.c.MatricesIndicesKind),x.push(k.c.MatricesWeightsKind),G.numBoneInfluencers>4&&(x.push(k.c.MatricesIndicesExtraKind),x.push(k.c.MatricesWeightsExtraKind));const V=G.skeleton;A.push("#define NUM_BONE_INFLUENCERS "+G.numBoneInfluencers),q=new P.b,q.addCPUSkinningFallback(0,G),V.isUsingTextureForMatrices?(A.push("#define BONETEXTURE"),-1===B.indexOf("boneTextureWidth")&&B.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(A.push("#define BonesPerMesh "+(V.bones.length+1)),-1===B.indexOf("mBones")&&B.push("mBones"))}else A.push("#define NUM_BONE_INFLUENCERS 0");let b=0;const r=G?G.morphTargetManager:null;if(r){const V=-1!==A.indexOf("#define UV1"),W=-1!==A.indexOf("#define UV2"),J=-1!==A.indexOf("#define TANGENT"),R=-1!==A.indexOf("#define NORMAL"),d=-1!==A.indexOf("#define VERTEXCOLOR");b=(0,t.I)(r,A,x,G,!0,R,J,V,W,d),r.isUsingTextureForTargets&&(-1===B.indexOf("morphTargetTextureIndices")&&B.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),b>0&&(B=B.slice(),B.push("morphTargetInfluences"),B.push("morphTargetCount"),B.push("morphTargetTextureInfo"),B.push("morphTargetTextureIndices"))}else A.push("#define NUM_MORPH_INFLUENCERS 0");if(G){const V=G.bakedVertexAnimationManager;V&&V.isEnabled&&(A.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===B.indexOf("bakedVertexAnimationSettings")&&B.push("bakedVertexAnimationSettings"),-1===B.indexOf("bakedVertexAnimationTextureSizeInverted")&&B.push("bakedVertexAnimationTextureSizeInverted"),-1===B.indexOf("bakedVertexAnimationTime")&&B.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,t.y)(x,G,A)}for(const R in this._textures)if(!this._textures[R].isReady())return!1;G&&this.needAlphaTestingForMesh(G)&&A.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,L.c)(B),(0,L.l)(this,z,A)),z.fogEnabled&&null!==G&&void 0!==G&&G.applyFog&&z.fogMode!==R.e.FOGMODE_NONE&&(A.push("#define FOG"),-1===B.indexOf("view")&&B.push("view"),-1===B.indexOf("vFogInfos")&&B.push("vFogInfos"),-1===B.indexOf("vFogColor")&&B.push("vFogColor")),this._useLogarithmicDepth&&(A.push("#define LOGARITHMICDEPTH"),-1===B.indexOf("logarithmicDepthConstant")&&B.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(B=B.slice(),S=S.slice(),p=p.slice(),g=this.customShaderNameResolve(this.name,B,S,p,A,x));const y=d?W._getDrawWrapper(void 0,!0):this._drawWrapper,u=(null===y||void 0===y?void 0:y.effect)??null,H=(null===y||void 0===y?void 0:y.defines)??null,n=A.join("\n");let D=u;return H!==n&&(D=X.createEffect(g,{attributes:x,uniformsNames:B,uniformBuffersNames:S,samplers:p,defines:n,fallbacks:q,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:b},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},X),d?W.setEffect(D,n,this._materialContext):y&&y.setEffect(D,n),this._onEffectCreatedObservable&&(Y.effect=D,Y.subMesh=W??(null===G||void 0===G?void 0:G.Ed[0])??null,this._onEffectCreatedObservable.notifyObservers(Y))),y._wasPreviouslyUsingInstances=!!V,!(null===(J=D)||void 0===J||!J.isReady())&&(u!==D&&z.resetCachedMaterial(),y._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(G,V){const W=V??this.getEffect();if(!W)return;const J=this._options.uniforms;-1!==J.indexOf("world")&&W.setMatrix("world",G);const R=this.HG();-1!==J.indexOf("worldView")&&(G.multiplyToRef(R.getViewMatrix(),this._cachedWorldViewMatrix),W.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==J.indexOf("worldViewProjection")&&(G.multiplyToRef(R.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),W.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==J.indexOf("view")&&W.setMatrix("view",R.getViewMatrix())}bindForSubMesh(G,V,W){var J;this.bind(G,V,null===(J=W._drawWrapperOverride)||void 0===J?void 0:J.effect,W)}bind(G,V,W,J){const R=J&&this._storeEffectOnSubMeshes,d=W??(R?J.effect:this.getEffect());if(!d)return;const k=this.HG();this._activeEffect=d,this.bindOnlyWorldMatrix(G,W);const z=this._options.uniformBuffers;let X=!1;if(d&&z&&z.length>0&&k.getEngine().supportsUniformBuffers)for(let x=0;x<z.length;++x){switch(z[x]){case"Mesh":V&&(V.getMeshUniformBuffer().bindToEffect(d,"Mesh"),V.transferToEffect(G));break;case"Scene":(0,t.r)(d,k.getSceneUniformBuffer()),k.finalizeSceneUbo(),X=!0}}const P=V&&R?this._mustRebind(k,d,J,V.visibility):k.getCachedMaterial()!==this;if(d&&P){let G;for(G in X||-1===this._options.uniforms.indexOf("view")||d.setMatrix("view",k.getViewMatrix()),X||-1===this._options.uniforms.indexOf("projection")||d.setMatrix("projection",k.getProjectionMatrix()),X||-1===this._options.uniforms.indexOf("viewProjection")||(d.setMatrix("viewProjection",k.getTransformMatrix()),this._multiview&&d.setMatrix("viewProjectionR",k._transformMatrixR)),k.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&d.setVector3("cameraPosition",k.activeCamera.globalPosition),(0,t.c)(V,d),(0,L.f)(d,this,k),this._useLogarithmicDepth&&(0,t.j)(R?J.materialDefines:d.defines,d,k),V&&(0,t.f)(k,V,d),this._textures)d.setTexture(G,this._textures[G]);for(G in this._textureArrays)d.setTextureArray(G,this._textureArrays[G]);for(G in this._ints)d.setInt(G,this._ints[G]);for(G in this._uints)d.setUInt(G,this._uints[G]);for(G in this._floats)d.setFloat(G,this._floats[G]);for(G in this._floatsArrays)d.setArray(G,this._floatsArrays[G]);for(G in this._colors3)d.setColor3(G,this._colors3[G]);for(G in this._colors3Arrays)d.setArray3(G,this._colors3Arrays[G]);for(G in this._colors4){const V=this._colors4[G];d.setFloat4(G,V.r,V.g,V.b,V.a)}for(G in this._colors4Arrays)d.setArray4(G,this._colors4Arrays[G]);for(G in this._vectors2)d.setVector2(G,this._vectors2[G]);for(G in this._vectors3)d.setVector3(G,this._vectors3[G]);for(G in this._vectors4)d.setVector4(G,this._vectors4[G]);for(G in this._quaternions)d.setQuaternion(G,this._quaternions[G]);for(G in this._matrices)d.setMatrix(G,this._matrices[G]);for(G in this._matrixArrays)d.setMatrices(G,this._matrixArrays[G]);for(G in this._matrices3x3)d.setMatrix3x3(G,this._matrices3x3[G]);for(G in this._matrices2x2)d.setMatrix2x2(G,this._matrices2x2[G]);for(G in this._vectors2Arrays)d.setArray2(G,this._vectors2Arrays[G]);for(G in this._vectors3Arrays)d.setArray3(G,this._vectors3Arrays[G]);for(G in this._vectors4Arrays)d.setArray4(G,this._vectors4Arrays[G]);for(G in this._quaternionsArrays)d.setArray4(G,this._quaternionsArrays[G]);for(G in this._uniformBuffers){const V=this._uniformBuffers[G].getBuffer();V&&d.bindUniformBuffer(V,G)}const W=k.getEngine(),z=W.setExternalTexture;if(z)for(G in this._externalTextures)z.call(W,G,this._externalTextures[G]);const P=W.setTextureSampler;if(P)for(G in this._textureSamplers)P.call(W,G,this._textureSamplers[G]);const A=W.setStorageBuffer;if(A)for(G in this._storageBuffers)A.call(W,G,this._storageBuffers[G])}if(d&&V&&(P||!this.isFrozen)){(0,t.n)(V,d),V.morphTargetManager&&V.morphTargetManager.isUsingTextureForTargets&&V.morphTargetManager._bind(d);const G=V.bakedVertexAnimationManager;if(G&&G.isEnabled){var A;const G=R?J._drawWrapper:this._drawWrapper;null===(A=V.bakedVertexAnimationManager)||void 0===A||A.bind(d,!!G._wasPreviouslyUsingInstances)}}this._afterBind(V,d,J)}getActiveTextures(){const G=super.getActiveTextures();for(const V in this._textures)G.push(this._textures[V]);for(const V in this._textureArrays){const W=this._textureArrays[V];for(let V=0;V<W.length;V++)G.push(W[V])}return G}hasTexture(G){if(super.hasTexture(G))return!0;for(const V in this._textures)if(this._textures[V]===G)return!0;for(const V in this._textureArrays){const W=this._textureArrays[V];for(let V=0;V<W.length;V++)if(W[V]===G)return!0}return!1}clone(G){const V=J.e.Clone((()=>new g(G,this.HG(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);V.name=G,V.id=G,"object"===typeof V._shaderPath&&(V._shaderPath={...V._shaderPath}),this._options={...this._options};const W=Object.keys(this._options);for(const J of W){const G=this._options[J];Array.isArray(G)&&(this._options[J]=G.slice(0))}this.stencil.copyTo(V.stencil);for(const J in this._textures)V.setTexture(J,this._textures[J]);for(const J in this._textureArrays)V.setTextureArray(J,this._textureArrays[J]);for(const J in this._externalTextures)V.setExternalTexture(J,this._externalTextures[J]);for(const J in this._ints)V.setInt(J,this._ints[J]);for(const J in this._uints)V.setUInt(J,this._uints[J]);for(const J in this._floats)V.setFloat(J,this._floats[J]);for(const J in this._floatsArrays)V.setFloats(J,this._floatsArrays[J]);for(const J in this._colors3)V.setColor3(J,this._colors3[J]);for(const J in this._colors3Arrays)V._colors3Arrays[J]=this._colors3Arrays[J];for(const J in this._colors4)V.setColor4(J,this._colors4[J]);for(const J in this._colors4Arrays)V._colors4Arrays[J]=this._colors4Arrays[J];for(const J in this._vectors2)V.setVector2(J,this._vectors2[J]);for(const J in this._vectors3)V.setVector3(J,this._vectors3[J]);for(const J in this._vectors4)V.setVector4(J,this._vectors4[J]);for(const J in this._quaternions)V.setQuaternion(J,this._quaternions[J]);for(const J in this._quaternionsArrays)V._quaternionsArrays[J]=this._quaternionsArrays[J];for(const J in this._matrices)V.setMatrix(J,this._matrices[J]);for(const J in this._matrixArrays)V._matrixArrays[J]=this._matrixArrays[J].slice();for(const J in this._matrices3x3)V.setMatrix3x3(J,this._matrices3x3[J]);for(const J in this._matrices2x2)V.setMatrix2x2(J,this._matrices2x2[J]);for(const J in this._vectors2Arrays)V.setArray2(J,this._vectors2Arrays[J]);for(const J in this._vectors3Arrays)V.setArray3(J,this._vectors3Arrays[J]);for(const J in this._vectors4Arrays)V.setArray4(J,this._vectors4Arrays[J]);for(const J in this._uniformBuffers)V.setUniformBuffer(J,this._uniformBuffers[J]);for(const J in this._textureSamplers)V.setTextureSampler(J,this._textureSamplers[J]);for(const J in this._storageBuffers)V.setStorageBuffer(J,this._storageBuffers[J]);return V}dispose(G,V,W){if(V){let G;for(G in this._textures)this._textures[G].dispose();for(G in this._textureArrays){const V=this._textureArrays[G];for(let G=0;G<V.length;G++)V[G].dispose()}}this._textures={},super.dispose(G,V,W)}serialize(){const G=J.e.Serialize(this);let V;for(V in G.customType="BABYLON.ShaderMaterial",G.uniqueId=this.uniqueId,G.options=this._options,G.shaderPath=this._shaderPath,G.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,G.stencil=this.stencil.serialize(),G.textures={},this._textures)G.textures[V]=this._textures[V].serialize();for(V in G.textureArrays={},this._textureArrays){G.textureArrays[V]=[];const W=this._textureArrays[V];for(let J=0;J<W.length;J++)G.textureArrays[V].push(W[J].serialize())}for(V in G.ints={},this._ints)G.ints[V]=this._ints[V];for(V in G.uints={},this._uints)G.uints[V]=this._uints[V];for(V in G.floats={},this._floats)G.floats[V]=this._floats[V];for(V in G.floatsArrays={},this._floatsArrays)G.floatsArrays[V]=this._floatsArrays[V];for(V in G.colors3={},this._colors3){const W=this._colors3[V];G.colors3[V]=[W.r,W.g,W.b]}for(V in G.colors3Arrays={},this._colors3Arrays)G.colors3Arrays[V]=this._colors3Arrays[V];for(V in G.colors4={},this._colors4){const W=this._colors4[V];G.colors4[V]=[W.r,W.g,W.b,W.a]}for(V in G.colors4Arrays={},this._colors4Arrays)G.colors4Arrays[V]=this._colors4Arrays[V];for(V in G.vectors2={},this._vectors2){const W=this._vectors2[V];G.vectors2[V]=[W.x,W.y]}for(V in G.vectors3={},this._vectors3){const W=this._vectors3[V];G.vectors3[V]=[W.x,W.y,W.z]}for(V in G.vectors4={},this._vectors4){const W=this._vectors4[V];G.vectors4[V]=[W.x,W.y,W.z,W.w]}for(V in G.quaternions={},this._quaternions)G.quaternions[V]=this._quaternions[V].Bd();for(V in G.matrices={},this._matrices)G.matrices[V]=this._matrices[V].Bd();for(V in G.matrixArray={},this._matrixArrays)G.matrixArray[V]=this._matrixArrays[V];for(V in G.matrices3x3={},this._matrices3x3)G.matrices3x3[V]=this._matrices3x3[V];for(V in G.matrices2x2={},this._matrices2x2)G.matrices2x2[V]=this._matrices2x2[V];for(V in G.vectors2Arrays={},this._vectors2Arrays)G.vectors2Arrays[V]=this._vectors2Arrays[V];for(V in G.vectors3Arrays={},this._vectors3Arrays)G.vectors3Arrays[V]=this._vectors3Arrays[V];for(V in G.vectors4Arrays={},this._vectors4Arrays)G.vectors4Arrays[V]=this._vectors4Arrays[V];for(V in G.quaternionsArrays={},this._quaternionsArrays)G.quaternionsArrays[V]=this._quaternionsArrays[V];return G}static Parse(G,V,W){const R=J.e.Parse((()=>new g(G.name,V,G.shaderPath,G.options,G.storeEffectOnSubMeshes)),G,V,W);let k;for(k in G.stencil&&R.stencil.parse(G.stencil,V,W),G.textures)R.setTexture(k,z.d.Parse(G.textures[k],V,W));for(k in G.textureArrays){const J=G.textureArrays[k],d=[];for(let G=0;G<J.length;G++)d.push(z.d.Parse(J[G],V,W));R.setTextureArray(k,d)}for(k in G.ints)R.setInt(k,G.ints[k]);for(k in G.uints)R.setUInt(k,G.uints[k]);for(k in G.floats)R.setFloat(k,G.floats[k]);for(k in G.floatsArrays)R.setFloats(k,G.floatsArrays[k]);for(k in G.colors3){const V=G.colors3[k];R.setColor3(k,{r:V[0],g:V[1],b:V[2]})}for(k in G.colors3Arrays){const V=G.colors3Arrays[k].reduce(((G,V,W)=>(W%3===0?G.push([V]):G[G.length-1].push(V),G)),[]).map((G=>({r:G[0],g:G[1],b:G[2]})));R.setColor3Array(k,V)}for(k in G.colors4){const V=G.colors4[k];R.setColor4(k,{r:V[0],g:V[1],b:V[2],a:V[3]})}for(k in G.colors4Arrays){const V=G.colors4Arrays[k].reduce(((G,V,W)=>(W%4===0?G.push([V]):G[G.length-1].push(V),G)),[]).map((G=>({r:G[0],g:G[1],b:G[2],a:G[3]})));R.setColor4Array(k,V)}for(k in G.vectors2){const V=G.vectors2[k];R.setVector2(k,{x:V[0],y:V[1]})}for(k in G.vectors3){const V=G.vectors3[k];R.setVector3(k,{x:V[0],y:V[1],z:V[2]})}for(k in G.vectors4){const V=G.vectors4[k];R.setVector4(k,{x:V[0],y:V[1],z:V[2],w:V[3]})}for(k in G.quaternions)R.setQuaternion(k,d.g.ld(G.quaternions[k]));for(k in G.matrices)R.setMatrix(k,d.c.ld(G.matrices[k]));for(k in G.matrixArray)R._matrixArrays[k]=new Float32Array(G.matrixArray[k]);for(k in G.matrices3x3)R.setMatrix3x3(k,G.matrices3x3[k]);for(k in G.matrices2x2)R.setMatrix2x2(k,G.matrices2x2[k]);for(k in G.vectors2Arrays)R.setArray2(k,G.vectors2Arrays[k]);for(k in G.vectors3Arrays)R.setArray3(k,G.vectors3Arrays[k]);for(k in G.vectors4Arrays)R.setArray4(k,G.vectors4Arrays[k]);for(k in G.quaternionsArrays)R.setArray4(k,G.quaternionsArrays[k]);return R}static async ParseFromFileAsync(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return await new Promise(((R,d)=>{const k=new A.b;k.addEventListener("readystatechange",(()=>{if(4==k.readyState)if(200==k.status){const V=JSON.parse(k.responseText),d=this.Parse(V,W||q.c.LastCreatedScene,J);G&&(d.name=G),R(d)}else d("Unable to load the ShaderMaterial")})),k.open("GET",V),k.send()}))}static async ParseFromSnippetAsync(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return await new Promise(((J,R)=>{const d=new A.b;d.addEventListener("readystatechange",(()=>{if(4==d.readyState)if(200==d.status){const R=JSON.parse(JSON.parse(d.responseText).jsonPayload),k=JSON.parse(R.shaderMaterial),z=this.Parse(k,V||q.c.LastCreatedScene,W);z.snippetId=G,J(z)}else R("Unable to load the snippet "+G)})),d.open("GET",this.SnippetUrl+"/"+G.replace(/#/g,"/")),d.send()}))}}g.SnippetUrl="https://snippet.babylonjs.com",g.CreateFromSnippetAsync=g.ParseFromSnippetAsync,(0,X.d)("BABYLON.ShaderMaterial",g)},11845:(G,V,W)=>{W.d(V,{d:()=>n});var J=W(11317),R=W(11324),d=W(11525),k=W(11737),z=W(11424),X=W(11345),P=W(11804),A=W(11744),x=W(11313),q=W(11794),L=W(11811),t=W(11666),Y=W(11159),g=W(11818),B=W(11832),S=W(11835),p=W(11449),b=W(11432),r=W(11411),y=W(11838);const u={effect:null,subMesh:null};class H extends q.c{constructor(G){super(G),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(G){const V=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const W of V)this[W]=W===G}}class n extends L.d{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(G){this._attachImageProcessingConfiguration(G),this._markAllSubMeshesAsImageProcessingDirty()}_attachImageProcessingConfiguration(G){G!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=G||this.HG().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(G){this.imageProcessingConfiguration.colorCurvesEnabled=G}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(G){this.imageProcessingConfiguration.colorGradingEnabled=G}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(G){this._imageProcessingConfiguration.toneMappingEnabled=G}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(G){this._imageProcessingConfiguration.exposure=G}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(G){this._imageProcessingConfiguration.contrast=G}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(G){this._imageProcessingConfiguration.colorGradingTexture=G}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(G){this._imageProcessingConfiguration.colorCurves=G}get canRenderToMRT(){return!0}constructor(G,V){super(G,V,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||n.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new z.d(0,0,0),this.diffuseColor=new z.d(1,1,1),this.specularColor=new z.d(1,1,1),this.emissiveColor=new z.d(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new d.f(16),this._globalAmbientColor=new z.d(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new S.b(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new P.b,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),n.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),n.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(n.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(n.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}getClassName(){return"Az"}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return this._hasTransparencyMode?this._transparencyModeIsTest:this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===x.e.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.bd&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==x.e.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.bd||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(G,V){let J=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._uniformBufferLayoutBuilt||this.buildUniformLayout();const R=V._drawWrapper;if(R.effect&&this.isFrozen&&R._wasPreviouslyReady&&R._wasPreviouslyUsingInstances===J)return!0;V.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),V.materialDefines=new H(this._eventInfo.defineNames));const d=this.HG(),k=V.materialDefines;if(this._isReadyForSubMesh(V))return!0;const z=d.getEngine();k._needNormals=(0,b.P)(d,G,k,!0,this._maxSimultaneousLights,this._disableLighting),(0,b.W)(d,k);const x=this.needAlphaBlendingForMesh(G)&&this.HG().useOrderIndependentTransparency;if((0,b.ab)(d,k,this.canRenderToMRT&&!x),(0,b.Z)(d,k,x),y.e.PrepareDefines(z.currentRenderPassId,G,k),k._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,k._needUVs=!1;for(let G=1;G<=6;++G)k["MAINUV"+G]=!1;if(d.texturesEnabled){if(k.DIFFUSEDIRECTUV=0,k.BUMPDIRECTUV=0,k.AMBIENTDIRECTUV=0,k.OPACITYDIRECTUV=0,k.EMISSIVEDIRECTUV=0,k.SPECULARDIRECTUV=0,k.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&n.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,b.R)(this._diffuseTexture,k,"DIFFUSE")}else k.DIFFUSE=!1;if(this._ambientTexture&&n.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;(0,b.R)(this._ambientTexture,k,"AMBIENT")}else k.AMBIENT=!1;if(this._opacityTexture&&n.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;(0,b.R)(this._opacityTexture,k,"OPACITY"),k.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else k.OPACITY=!1;if(this._reflectionTexture&&n.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(k._needNormals=!0,k.REFLECTION=!0,k.ROUGHNESS=this._roughness>0,k.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,k.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===t.d.INVCUBIC_MODE,k.REFLECTIONMAP_3D=this._reflectionTexture.isCube,k.REFLECTIONMAP_OPPOSITEZ=k.REFLECTIONMAP_3D&&this.HG().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,k.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case t.d.EXPLICIT_MODE:k.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case t.d.PLANAR_MODE:k.setReflectionMode("REFLECTIONMAP_PLANAR");break;case t.d.PROJECTION_MODE:k.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case t.d.SKYBOX_MODE:k.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case t.d.SPHERICAL_MODE:k.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case t.d.EQUIRECTANGULAR_MODE:k.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case t.d.FIXED_EQUIRECTANGULAR_MODE:k.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case t.d.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:k.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case t.d.CUBIC_MODE:case t.d.INVCUBIC_MODE:default:k.setReflectionMode("REFLECTIONMAP_CUBIC")}k.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else k.REFLECTION=!1,k.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&n.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;(0,b.R)(this._emissiveTexture,k,"EMISSIVE")}else k.EMISSIVE=!1;if(this._lightmapTexture&&n.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;(0,b.R)(this._lightmapTexture,k,"LIGHTMAP"),k.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,k.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else k.LIGHTMAP=!1;if(this._specularTexture&&n.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;(0,b.R)(this._specularTexture,k,"SPECULAR"),k.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else k.SPECULAR=!1;if(d.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&n.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,b.R)(this._bumpTexture,k,"BUMP"),k.PARALLAX=this._useParallax,k.PARALLAX_RHS=d.useRightHandedSystem,k.PARALLAXOCCLUSION=this._useParallaxOcclusion,k.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else k.BUMP=!1,k.PARALLAX=!1,k.PARALLAX_RHS=!1,k.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&n.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;k._needUVs=!0,k.REFRACTION=!0,k.REFRACTIONMAP_3D=this._refractionTexture.isCube,k.RGBDREFRACTION=this._refractionTexture.isRGBD,k.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else k.REFRACTION=!1;k.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else k.DIFFUSE=!1,k.AMBIENT=!1,k.OPACITY=!1,k.REFLECTION=!1,k.EMISSIVE=!1,k.LIGHTMAP=!1,k.BUMP=!1,k.REFRACTION=!1;k.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),k.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,k.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,k.SPECULAROVERALPHA=this._useSpecularOverAlpha,k.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,k.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,k.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(G)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=k,this._eventInfo.subMesh=V,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(k._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(k),k.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,k.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(k._areFresnelDirty&&(n.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(k.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,k.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,k.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,k.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,k.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,k.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,k._needNormals=!0,k.FRESNEL=!0):k.FRESNEL=!1),k.AREALIGHTUSED)for(let W=0;W<G.lightSources.length;W++)if(!G.lightSources[W]._isReady())return!1;(0,b.U)(G,d,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(G),k,this._applyDecalMapAfterDetailMap),(0,b.N)(d,z,this,k,J,null,V.getRenderingMesh().hasThinInstances),this._eventInfo.defines=k,this._eventInfo.mesh=G,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,b.M)(G,k,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let q=!1;if(k.isDirty){const J=k._areLightsDisposed;k.markAsProcessed();const R=new B.b;k.REFLECTION&&R.addFallback(0,"REFLECTION"),k.SPECULAR&&R.addFallback(0,"SPECULAR"),k.BUMP&&R.addFallback(0,"BUMP"),k.PARALLAX&&R.addFallback(1,"PARALLAX"),k.PARALLAX_RHS&&R.addFallback(1,"PARALLAX_RHS"),k.PARALLAXOCCLUSION&&R.addFallback(0,"PARALLAXOCCLUSION"),k.SPECULAROVERALPHA&&R.addFallback(0,"SPECULAROVERALPHA"),k.FOG&&R.addFallback(1,"FOG"),k.POINTSIZE&&R.addFallback(0,"POINTSIZE"),k.LOGARITHMICDEPTH&&R.addFallback(0,"LOGARITHMICDEPTH"),(0,b.v)(k,R,this._maxSimultaneousLights),k.SPECULARTERM&&R.addFallback(0,"SPECULARTERM"),k.DIFFUSEFRESNEL&&R.addFallback(1,"DIFFUSEFRESNEL"),k.OPACITYFRESNEL&&R.addFallback(2,"OPACITYFRESNEL"),k.REFLECTIONFRESNEL&&R.addFallback(3,"REFLECTIONFRESNEL"),k.EMISSIVEFRESNEL&&R.addFallback(4,"EMISSIVEFRESNEL"),k.FRESNEL&&R.addFallback(4,"FRESNEL"),k.MULTIVIEW&&R.addFallback(0,"MULTIVIEW");const x=[X.c.PositionKind];k.NORMAL&&x.push(X.c.NormalKind),k.TANGENT&&x.push(X.c.TangentKind);for(let G=1;G<=6;++G)k["UV"+G]&&x.push(`uv${1===G?"":G}`);k.VERTEXCOLOR&&x.push(X.c.ColorKind),(0,b.B)(x,G,k,R),(0,b.D)(x,k),(0,b.F)(x,G,k),(0,b.y)(x,G,k);let L="default";const t=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],Y=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],g=["Material","Scene","Mesh"],S={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:k.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=R,this._eventInfo.fallbackRank=0,this._eventInfo.defines=k,this._eventInfo.uniforms=t,this._eventInfo.attributes=x,this._eventInfo.samplers=Y,this._eventInfo.uniformBuffersNames=g,this._eventInfo.customCode=void 0,this._eventInfo.mesh=G,this._eventInfo.indexParameters=S,this._callbackPluginEventGeneric(128,this._eventInfo),y.e.AddUniformsAndSamplers(t,Y),P.b.AddUniforms(t),P.b.AddSamplers(Y),A.e&&(A.e.PrepareUniforms(t,k),A.e.PrepareSamplers(Y,k)),(0,b.db)({uniformsNames:t,uniformBuffersNames:g,samplers:Y,defines:k,maxSimultaneousLights:this._maxSimultaneousLights}),(0,p.c)(t);const r={};this.customShaderNameResolve&&(L=this.customShaderNameResolve(L,t,g,Y,k,x,r));const H=k.toString(),n=V.effect;let D=d.getEngine().createEffect(L,{attributes:x,uniformsNames:t,uniformBuffersNames:g,samplers:Y,defines:H,fallbacks:R,onCompiled:this.onCompiled,onError:this.onError,indexParameters:S,processFinalCode:r.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:k.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([W.e(20),W.e(51)]).then(W.bind(W,14386)),Promise.all([W.e(18),W.e(52)]).then(W.bind(W,14397))]):await Promise.all([Promise.all([W.e(13),W.e(53)]).then(W.bind(W,14403)),Promise.all([W.e(12),W.e(54)]).then(W.bind(W,14413))]),this._shadersLoaded=!0}},z);if(this._eventInfo.customCode=void 0,D)if(this._onEffectCreatedObservable&&(u.effect=D,u.subMesh=V,this._onEffectCreatedObservable.notifyObservers(u)),this.allowShaderHotSwapping&&n&&!D.isReady()){if(D=n,k.markAsUnprocessed(),q=this.isFrozen,J)return k._areLightsDisposed=!0,!1}else d.resetCachedMaterial(),V.setEffect(D,k,this._materialContext)}return!(!V.effect||!V.effect.isReady())&&(k._renderId=d.getRenderId(),R._wasPreviouslyReady=!q,R._wasPreviouslyUsingInstances=J,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const G=this._uniformBuffer;G.addUniform("diffuseLeftColor",4),G.addUniform("diffuseRightColor",4),G.addUniform("opacityParts",4),G.addUniform("reflectionLeftColor",4),G.addUniform("reflectionRightColor",4),G.addUniform("refractionLeftColor",4),G.addUniform("refractionRightColor",4),G.addUniform("emissiveLeftColor",4),G.addUniform("emissiveRightColor",4),G.addUniform("vDiffuseInfos",2),G.addUniform("vAmbientInfos",2),G.addUniform("vOpacityInfos",2),G.addUniform("vReflectionInfos",2),G.addUniform("vReflectionPosition",3),G.addUniform("vReflectionSize",3),G.addUniform("vEmissiveInfos",2),G.addUniform("vLightmapInfos",2),G.addUniform("vSpecularInfos",2),G.addUniform("vBumpInfos",3),G.addUniform("diffuseMatrix",16),G.addUniform("ambientMatrix",16),G.addUniform("opacityMatrix",16),G.addUniform("reflectionMatrix",16),G.addUniform("emissiveMatrix",16),G.addUniform("lightmapMatrix",16),G.addUniform("specularMatrix",16),G.addUniform("bumpMatrix",16),G.addUniform("vTangentSpaceParams",2),G.addUniform("pointSize",1),G.addUniform("alphaCutOff",1),G.addUniform("refractionMatrix",16),G.addUniform("vRefractionInfos",4),G.addUniform("vRefractionPosition",3),G.addUniform("vRefractionSize",3),G.addUniform("vSpecularColor",4),G.addUniform("vEmissiveColor",3),G.addUniform("vDiffuseColor",4),G.addUniform("vAmbientColor",3),G.addUniform("cameraInfo",4),super.buildUniformLayout()}bindForSubMesh(G,V,W){const J=this.HG(),R=W.materialDefines;if(!R)return;const d=W.effect;if(!d)return;this._activeEffect=d,V.getMeshUniformBuffer().bindToEffect(d,"Mesh"),V.transferToEffect(G),this._uniformBuffer.bindToEffect(d,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,J,V,G,this.isFrozen),y.e.Bind(J.getEngine().currentRenderPassId,this._activeEffect,V,G,this);const X=J.activeCamera;X?this._uniformBuffer.updateFloat4("cameraInfo",X.Zd,X.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=W,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),R.OBJECTSPACE_NORMALMAP&&(G.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const P=this._mustRebind(J,d,W,V.visibility);(0,b.c)(V,d);const A=this._uniformBuffer;if(P){if(this.bindViewProjection(d),!A.useUbo||!this.isFrozen||!A.isSync||W._drawWrapper._forceRebindOnNextCall){if(n.FresnelEnabled&&R.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(A.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),A.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&A.updateColor4("opacityParts",new z.d(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(A.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),A.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(A.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),A.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(A.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),A.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),J.texturesEnabled){if(this._diffuseTexture&&n.DiffuseTextureEnabled&&(A.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,b.t)(this._diffuseTexture,A,"diffuse")),this._ambientTexture&&n.AmbientTextureEnabled&&(A.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,b.t)(this._ambientTexture,A,"ambient")),this._opacityTexture&&n.OpacityTextureEnabled&&(A.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,b.t)(this._opacityTexture,A,"opacity")),this._hasAlphaChannel()&&A.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&n.ReflectionTextureEnabled){if(A.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),A.Td("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize){const G=this._reflectionTexture;A.updateVector3("vReflectionPosition",G.boundingBoxPosition),A.updateVector3("vReflectionSize",G.boundingBoxSize)}}else A.updateFloat2("vReflectionInfos",0,this.roughness);if(this._emissiveTexture&&n.EmissiveTextureEnabled&&(A.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,b.t)(this._emissiveTexture,A,"emissive")),this._lightmapTexture&&n.LightmapTextureEnabled&&(A.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,b.t)(this._lightmapTexture,A,"lightmap")),this._specularTexture&&n.SpecularTextureEnabled&&(A.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,b.t)(this._specularTexture,A,"specular")),this._bumpTexture&&J.getEngine().getCaps().standardDerivatives&&n.BumpTextureEnabled&&(A.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,b.t)(this._bumpTexture,A,"bump"),J._mirroredCameraPosition?A.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):A.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&n.RefractionTextureEnabled){let G=1;if(this._refractionTexture.isCube||(A.Td("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(G=this._refractionTexture.depth)),A.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,G,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const G=this._refractionTexture;A.updateVector3("vRefractionPosition",G.boundingBoxPosition),A.updateVector3("vRefractionSize",G.boundingBoxSize)}}}this.pointsCloud&&A.updateFloat("pointSize",this.pointSize),A.updateColor4("vSpecularColor",this.specularColor,this.specularPower),A.updateColor3("vEmissiveColor",n.EmissiveTextureEnabled?this.emissiveColor:z.d.BlackReadOnly),A.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),J.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),A.updateColor3("vAmbientColor",this._globalAmbientColor)}J.texturesEnabled&&(this._diffuseTexture&&n.DiffuseTextureEnabled&&d.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&n.AmbientTextureEnabled&&d.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&n.OpacityTextureEnabled&&d.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&n.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?d.setTexture("reflectionCubeSampler",this._reflectionTexture):d.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&n.EmissiveTextureEnabled&&d.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&n.LightmapTextureEnabled&&d.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&n.SpecularTextureEnabled&&d.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&J.getEngine().getCaps().standardDerivatives&&n.BumpTextureEnabled&&d.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&n.RefractionTextureEnabled&&(this._refractionTexture.isCube?d.setTexture("refractionCubeSampler",this._refractionTexture):d.setTexture("refraction2DSampler",this._refractionTexture))),this.HG().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(V)&&this.HG().depthPeelingRenderer.bind(d),this._eventInfo.subMesh=W,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,p.f)(d,this,J),this.bindEyePosition(d)}else J.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(P||!this.isFrozen){var x;if(J.lightsEnabled&&!this._disableLighting&&(0,b.h)(J,V,d,R,this._maxSimultaneousLights),(J.fogEnabled&&V.applyFog&&J.fogMode!==k.e.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||V.receiveShadows||R.PREPASS)&&this.bindView(d),(0,b.f)(J,V,d),R.NUM_MORPH_INFLUENCERS&&(0,b.n)(V,d),R.BAKED_VERTEX_ANIMATION_TEXTURE)null===(x=V.bakedVertexAnimationManager)||void 0===x||x.bind(d,R.INSTANCES);this.useLogarithmicDepth&&(0,b.j)(R,d,J),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)}this._afterBind(V,this._activeEffect,W),A.update()}getAnimatables(){const G=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&G.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&G.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&G.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&G.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&G.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&G.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&G.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&G.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&G.push(this._refractionTexture),G}getActiveTextures(){const G=super.getActiveTextures();return this._diffuseTexture&&G.push(this._diffuseTexture),this._ambientTexture&&G.push(this._ambientTexture),this._opacityTexture&&G.push(this._opacityTexture),this._reflectionTexture&&G.push(this._reflectionTexture),this._emissiveTexture&&G.push(this._emissiveTexture),this._specularTexture&&G.push(this._specularTexture),this._bumpTexture&&G.push(this._bumpTexture),this._lightmapTexture&&G.push(this._lightmapTexture),this._refractionTexture&&G.push(this._refractionTexture),G}hasTexture(G){return!!super.hasTexture(G)||(this._diffuseTexture===G||(this._ambientTexture===G||(this._opacityTexture===G||(this._reflectionTexture===G||(this._emissiveTexture===G||(this._specularTexture===G||(this._bumpTexture===G||(this._lightmapTexture===G||this._refractionTexture===G))))))))}dispose(G,V){var W,J,R,d,k,z,X,P,A;V&&(null===(W=this._diffuseTexture)||void 0===W||W.dispose(),null===(J=this._ambientTexture)||void 0===J||J.dispose(),null===(R=this._opacityTexture)||void 0===R||R.dispose(),null===(d=this._reflectionTexture)||void 0===d||d.dispose(),null===(k=this._emissiveTexture)||void 0===k||k.dispose(),null===(z=this._specularTexture)||void 0===z||z.dispose(),null===(X=this._bumpTexture)||void 0===X||X.dispose(),null===(P=this._lightmapTexture)||void 0===P||P.dispose(),null===(A=this._refractionTexture)||void 0===A||A.dispose());this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(G,V)}clone(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const J=r.e.Clone((()=>new n(G,this.HG())),this,{cloneTexturesOnlyOnce:V});return J.name=G,J.id=G,this.stencil.copyTo(J.stencil),this._clonePlugins(J,W),J}static Parse(G,V,W){const J=r.e.Parse((()=>new n(G.name,V)),G,V,W);return G.stencil&&J.stencil.parse(G.stencil,V,W),x.e._ParsePlugins(G,J,V,W),J}static get DiffuseTextureEnabled(){return g.c.DiffuseTextureEnabled}static set DiffuseTextureEnabled(G){g.c.DiffuseTextureEnabled=G}static get DetailTextureEnabled(){return g.c.DetailTextureEnabled}static set DetailTextureEnabled(G){g.c.DetailTextureEnabled=G}static get AmbientTextureEnabled(){return g.c.AmbientTextureEnabled}static set AmbientTextureEnabled(G){g.c.AmbientTextureEnabled=G}static get OpacityTextureEnabled(){return g.c.OpacityTextureEnabled}static set OpacityTextureEnabled(G){g.c.OpacityTextureEnabled=G}static get ReflectionTextureEnabled(){return g.c.ReflectionTextureEnabled}static set ReflectionTextureEnabled(G){g.c.ReflectionTextureEnabled=G}static get EmissiveTextureEnabled(){return g.c.EmissiveTextureEnabled}static set EmissiveTextureEnabled(G){g.c.EmissiveTextureEnabled=G}static get SpecularTextureEnabled(){return g.c.SpecularTextureEnabled}static set SpecularTextureEnabled(G){g.c.SpecularTextureEnabled=G}static get BumpTextureEnabled(){return g.c.BumpTextureEnabled}static set BumpTextureEnabled(G){g.c.BumpTextureEnabled=G}static get LightmapTextureEnabled(){return g.c.LightmapTextureEnabled}static set LightmapTextureEnabled(G){g.c.LightmapTextureEnabled=G}static get RefractionTextureEnabled(){return g.c.RefractionTextureEnabled}static set RefractionTextureEnabled(G){g.c.RefractionTextureEnabled=G}static get ColorGradingTextureEnabled(){return g.c.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(G){g.c.ColorGradingTextureEnabled=G}static get FresnelEnabled(){return g.c.FresnelEnabled}static set FresnelEnabled(G){g.c.FresnelEnabled=G}}n.ForceGLSL=!1,(0,J.e)([(0,R.z)("diffuseTexture")],n.prototype,"_diffuseTexture",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],n.prototype,"diffuseTexture",void 0),(0,J.e)([(0,R.z)("ambientTexture")],n.prototype,"_ambientTexture",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"ambientTexture",void 0),(0,J.e)([(0,R.z)("opacityTexture")],n.prototype,"_opacityTexture",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],n.prototype,"opacityTexture",void 0),(0,J.e)([(0,R.z)("reflectionTexture")],n.prototype,"_reflectionTexture",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"reflectionTexture",void 0),(0,J.e)([(0,R.z)("emissiveTexture")],n.prototype,"_emissiveTexture",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"emissiveTexture",void 0),(0,J.e)([(0,R.z)("specularTexture")],n.prototype,"_specularTexture",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"specularTexture",void 0),(0,J.e)([(0,R.z)("bumpTexture")],n.prototype,"_bumpTexture",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"bumpTexture",void 0),(0,J.e)([(0,R.z)("lightmapTexture")],n.prototype,"_lightmapTexture",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"lightmapTexture",void 0),(0,J.e)([(0,R.z)("refractionTexture")],n.prototype,"_refractionTexture",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"refractionTexture",void 0),(0,J.e)([(0,R.m)("ambient")],n.prototype,"ambientColor",void 0),(0,J.e)([(0,R.m)("diffuse")],n.prototype,"diffuseColor",void 0),(0,J.e)([(0,R.m)("specular")],n.prototype,"specularColor",void 0),(0,J.e)([(0,R.m)("emissive")],n.prototype,"emissiveColor",void 0),(0,J.e)([(0,R.I)()],n.prototype,"specularPower",void 0),(0,J.e)([(0,R.I)("useAlphaFromDiffuseTexture")],n.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],n.prototype,"useAlphaFromDiffuseTexture",void 0),(0,J.e)([(0,R.I)("useEmissiveAsIllumination")],n.prototype,"_useEmissiveAsIllumination",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useEmissiveAsIllumination",void 0),(0,J.e)([(0,R.I)("linkEmissiveWithDiffuse")],n.prototype,"_linkEmissiveWithDiffuse",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"linkEmissiveWithDiffuse",void 0),(0,J.e)([(0,R.I)("useSpecularOverAlpha")],n.prototype,"_useSpecularOverAlpha",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useSpecularOverAlpha",void 0),(0,J.e)([(0,R.I)("useReflectionOverAlpha")],n.prototype,"_useReflectionOverAlpha",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useReflectionOverAlpha",void 0),(0,J.e)([(0,R.I)("disableLighting")],n.prototype,"_disableLighting",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsLightsDirty")],n.prototype,"disableLighting",void 0),(0,J.e)([(0,R.I)("useObjectSpaceNormalMap")],n.prototype,"_useObjectSpaceNormalMap",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useObjectSpaceNormalMap",void 0),(0,J.e)([(0,R.I)("useParallax")],n.prototype,"_useParallax",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useParallax",void 0),(0,J.e)([(0,R.I)("useParallaxOcclusion")],n.prototype,"_useParallaxOcclusion",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useParallaxOcclusion",void 0),(0,J.e)([(0,R.I)()],n.prototype,"parallaxScaleBias",void 0),(0,J.e)([(0,R.I)("roughness")],n.prototype,"_roughness",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"roughness",void 0),(0,J.e)([(0,R.I)()],n.prototype,"indexOfRefraction",void 0),(0,J.e)([(0,R.I)()],n.prototype,"invertRefractionY",void 0),(0,J.e)([(0,R.I)()],n.prototype,"alphaCutOff",void 0),(0,J.e)([(0,R.I)("useLightmapAsShadowmap")],n.prototype,"_useLightmapAsShadowmap",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useLightmapAsShadowmap",void 0),(0,J.e)([(0,R.p)("diffuseFresnelParameters")],n.prototype,"_diffuseFresnelParameters",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsFresnelDirty")],n.prototype,"diffuseFresnelParameters",void 0),(0,J.e)([(0,R.p)("opacityFresnelParameters")],n.prototype,"_opacityFresnelParameters",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsFresnelAndMiscDirty")],n.prototype,"opacityFresnelParameters",void 0),(0,J.e)([(0,R.p)("reflectionFresnelParameters")],n.prototype,"_reflectionFresnelParameters",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsFresnelDirty")],n.prototype,"reflectionFresnelParameters",void 0),(0,J.e)([(0,R.p)("refractionFresnelParameters")],n.prototype,"_refractionFresnelParameters",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsFresnelDirty")],n.prototype,"refractionFresnelParameters",void 0),(0,J.e)([(0,R.p)("emissiveFresnelParameters")],n.prototype,"_emissiveFresnelParameters",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsFresnelDirty")],n.prototype,"emissiveFresnelParameters",void 0),(0,J.e)([(0,R.I)("useReflectionFresnelFromSpecular")],n.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsFresnelDirty")],n.prototype,"useReflectionFresnelFromSpecular",void 0),(0,J.e)([(0,R.I)("useGlossinessFromSpecularMapAlpha")],n.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,J.e)([(0,R.I)("maxSimultaneousLights")],n.prototype,"_maxSimultaneousLights",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsLightsDirty")],n.prototype,"maxSimultaneousLights",void 0),(0,J.e)([(0,R.I)("invertNormalMapX")],n.prototype,"_invertNormalMapX",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"invertNormalMapX",void 0),(0,J.e)([(0,R.I)("invertNormalMapY")],n.prototype,"_invertNormalMapY",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"invertNormalMapY",void 0),(0,J.e)([(0,R.I)("twoSidedLighting")],n.prototype,"_twoSidedLighting",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"twoSidedLighting",void 0),(0,J.e)([(0,R.I)("applyDecalMapAfterDetailMap")],n.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,J.e)([(0,R.b)("_markAllSubMeshesAsMiscDirty")],n.prototype,"applyDecalMapAfterDetailMap",void 0),(0,Y.d)("BABYLON.StandardMaterial",n),k.e.DefaultMaterialFactory=G=>new n("default material",G)},11400:(G,V,W)=>{W.d(V,{c:()=>d});var J=W(11201),R=W(11189);class d{constructor(G,V,W,J){let R=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._valueCache={},this._engine=G,this._noUBO=!G.supportsUniformBuffers||R,this._dynamic=W,this._name=J??"no-name",this._data=V||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.Td=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.Td=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get useUbo(){return!this._noUBO}get isSync(){return!this._needSync}isDynamic(){return void 0!==this._dynamic}getData(){return this._bufferData}getBuffer(){return this._buffer}_fillAlignment(G){let V;if(V=G<=2?G:4,this._uniformLocationPointer%V!==0){const G=this._uniformLocationPointer;this._uniformLocationPointer+=V-this._uniformLocationPointer%V;const W=this._uniformLocationPointer-G;for(let V=0;V<W;V++)this._data.push(0)}}addUniform(G,V){let W,J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this._noUBO&&void 0===this._uniformLocations[G]){if(J>0){if(V instanceof Array)throw"addUniform should not be use with Array in UBO: "+G;if(this._fillAlignment(4),this._uniformArraySizes[G]={strideSize:V,arraySize:J},16==V)V*=J;else{V=V*J+(4-V)*J}W=[];for(let G=0;G<V;G++)W.push(0)}else{if(V instanceof Array)W=V,V=W.length;else{W=[];for(let G=0;G<V;G++)W.push(0)}this._fillAlignment(V)}this._uniformSizes[G]=V,this._uniformLocations[G]=this._uniformLocationPointer,this._uniformLocationPointer+=V;for(let G=0;G<V;G++)this._data.push(W[G]);this._needSync=!0}}addMatrix(G,V){this.addUniform(G,Array.prototype.slice.call(V.Bd()))}addFloat2(G,V,W){const J=[V,W];this.addUniform(G,J)}addFloat3(G,V,W,J){const R=[V,W,J];this.addUniform(G,R)}addColor3(G,V){const W=[V.r,V.g,V.b];this.addUniform(G,W)}addColor4(G,V,W){const J=[V.r,V.g,V.b,W];this.addUniform(G,J)}addVector3(G,V){const W=[V.x,V.y,V.z];this.addUniform(G,W)}addMatrix3x3(G){this.addUniform(G,12)}addMatrix2x2(G){this.addUniform(G,8)}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}_getNames(){const G=[];let V=0;for(const W in this._uniformLocations)if(G.push(W),10===++V)break;return G.join(",")}_rebuild(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}get _numBuffers(){return this._buffers.length}get _indexBuffer(){return this._bufferIndex}get name(){return this._name}get currentEffect(){return this._currentEffect}_buffersEqual(G,V){for(let W=0;W<G.length;++W)if(G[W]!==V[W])return!1;return!0}_copyBuffer(G,V){for(let W=0;W<G.length;++W)V[W]=G[W]}update(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(d._UpdatedUbosInFrame[this._name]||(d._UpdatedUbosInFrame[this._name]=0),d._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}updateUniform(G,V,W){this._checkNewFrame();let R=this._uniformLocations[G];if(void 0===R){if(this._buffer)return void J.c.Error("Cannot add an uniform after UBO has been created. uniformName="+G);this.addUniform(G,W),R=this._uniformLocations[G]}if(this._buffer||this.create(),this._dynamic)for(let J=0;J<W;J++)this._bufferData[R+J]=V[J];else{let G=!1;for(let J=0;J<W;J++)(16===W&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[R+J]!==Math.fround(V[J]))&&(G=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[R+J]=V[J]);this._needSync=this._needSync||G}}updateUniformArray(G,V,W){this._checkNewFrame();const d=this._uniformLocations[G];if(void 0===d)return void J.c.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");this._buffer||this.create();const k=this._uniformArraySizes[G];if(this._dynamic)for(let J=0;J<W;J++)this._bufferData[d+J]=V[J];else{let G=!1,J=0,z=0;for(let X=0;X<W;X++)if(this._bufferData[d+4*z+J]!==R.h.FloatRound(V[X])&&(G=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[d+4*z+J]=V[X]),J++,J===k.strideSize){for(;J<4;J++)this._bufferData[d+4*z+J]=0;J=0,z++}this._needSync=this._needSync||G}}_cacheMatrix(G,V){this._checkNewFrame();const W=this._valueCache[G],J=V.updateFlag;return(void 0===W||W!==J)&&(this._valueCache[G]=J,!0)}_updateMatrix3x3ForUniform(G,V){for(let W=0;W<3;W++)d._TempBuffer[4*W]=V[3*W],d._TempBuffer[4*W+1]=V[3*W+1],d._TempBuffer[4*W+2]=V[3*W+2],d._TempBuffer[4*W+3]=0;this.updateUniform(G,d._TempBuffer,12)}_updateMatrix3x3ForEffect(G,V){this._currentEffect.setMatrix3x3(G,V)}_updateMatrix2x2ForEffect(G,V){this._currentEffect.setMatrix2x2(G,V)}_updateMatrix2x2ForUniform(G,V){for(let W=0;W<2;W++)d._TempBuffer[4*W]=V[2*W],d._TempBuffer[4*W+1]=V[2*W+1],d._TempBuffer[4*W+2]=0,d._TempBuffer[4*W+3]=0;this.updateUniform(G,d._TempBuffer,8)}_updateFloatForEffect(G,V){this._currentEffect.setFloat(G,V)}_updateFloatForUniform(G,V){d._TempBuffer[0]=V,this.updateUniform(G,d._TempBuffer,1)}_updateFloat2ForEffect(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setFloat2(G+J,V,W)}_updateFloat2ForUniform(G,V,W){d._TempBuffer[0]=V,d._TempBuffer[1]=W,this.updateUniform(G,d._TempBuffer,2)}_updateFloat3ForEffect(G,V,W,J){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setFloat3(G+R,V,W,J)}_updateFloat3ForUniform(G,V,W,J){d._TempBuffer[0]=V,d._TempBuffer[1]=W,d._TempBuffer[2]=J,this.updateUniform(G,d._TempBuffer,3)}_updateFloat4ForEffect(G,V,W,J,R){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setFloat4(G+d,V,W,J,R)}_updateFloat4ForUniform(G,V,W,J,R){d._TempBuffer[0]=V,d._TempBuffer[1]=W,d._TempBuffer[2]=J,d._TempBuffer[3]=R,this.updateUniform(G,d._TempBuffer,4)}_updateFloatArrayForEffect(G,V){this._currentEffect.setFloatArray(G,V)}_updateFloatArrayForUniform(G,V){this.updateUniformArray(G,V,V.length)}_updateArrayForEffect(G,V){this._currentEffect.setArray(G,V)}_updateArrayForUniform(G,V){this.updateUniformArray(G,V,V.length)}_updateIntArrayForEffect(G,V){this._currentEffect.setIntArray(G,V)}_updateIntArrayForUniform(G,V){d._TempBufferInt32View.set(V),this.updateUniformArray(G,d._TempBuffer,V.length)}_updateUIntArrayForEffect(G,V){this._currentEffect.setUIntArray(G,V)}_updateUIntArrayForUniform(G,V){d._TempBufferUInt32View.set(V),this.updateUniformArray(G,d._TempBuffer,V.length)}_updateMatrixForEffect(G,V){this._currentEffect.setMatrix(G,V)}_updateMatrixForUniform(G,V){this._cacheMatrix(G,V)&&this.updateUniform(G,V.Bd(),16)}_updateMatricesForEffect(G,V){this._currentEffect.setMatrices(G,V)}_updateMatricesForUniform(G,V){this.updateUniform(G,V,V.length)}_updateVector3ForEffect(G,V){this._currentEffect.setVector3(G,V)}_updateVector3ForUniform(G,V){d._TempBuffer[0]=V.x,d._TempBuffer[1]=V.y,d._TempBuffer[2]=V.z,this.updateUniform(G,d._TempBuffer,3)}_updateVector4ForEffect(G,V){this._currentEffect.setVector4(G,V)}_updateVector4ForUniform(G,V){d._TempBuffer[0]=V.x,d._TempBuffer[1]=V.y,d._TempBuffer[2]=V.z,d._TempBuffer[3]=V.w,this.updateUniform(G,d._TempBuffer,4)}_updateColor3ForEffect(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setColor3(G+W,V)}_updateColor3ForUniform(G,V){d._TempBuffer[0]=V.r,d._TempBuffer[1]=V.g,d._TempBuffer[2]=V.b,this.updateUniform(G,d._TempBuffer,3)}_updateColor4ForEffect(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setColor4(G+J,V,W)}_updateDirectColor4ForEffect(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setDirectColor4(G+W,V)}_updateColor4ForUniform(G,V,W){d._TempBuffer[0]=V.r,d._TempBuffer[1]=V.g,d._TempBuffer[2]=V.b,d._TempBuffer[3]=W,this.updateUniform(G,d._TempBuffer,4)}_updateDirectColor4ForUniform(G,V){d._TempBuffer[0]=V.r,d._TempBuffer[1]=V.g,d._TempBuffer[2]=V.b,d._TempBuffer[3]=V.a,this.updateUniform(G,d._TempBuffer,4)}_updateIntForEffect(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setInt(G+W,V)}_updateIntForUniform(G,V){d._TempBufferInt32View[0]=V,this.updateUniform(G,d._TempBuffer,1)}_updateInt2ForEffect(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setInt2(G+J,V,W)}_updateInt2ForUniform(G,V,W){d._TempBufferInt32View[0]=V,d._TempBufferInt32View[1]=W,this.updateUniform(G,d._TempBuffer,2)}_updateInt3ForEffect(G,V,W,J){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setInt3(G+R,V,W,J)}_updateInt3ForUniform(G,V,W,J){d._TempBufferInt32View[0]=V,d._TempBufferInt32View[1]=W,d._TempBufferInt32View[2]=J,this.updateUniform(G,d._TempBuffer,3)}_updateInt4ForEffect(G,V,W,J,R){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setInt4(G+d,V,W,J,R)}_updateInt4ForUniform(G,V,W,J,R){d._TempBufferInt32View[0]=V,d._TempBufferInt32View[1]=W,d._TempBufferInt32View[2]=J,d._TempBufferInt32View[3]=R,this.updateUniform(G,d._TempBuffer,4)}_updateUIntForEffect(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setUInt(G+W,V)}_updateUIntForUniform(G,V){d._TempBufferUInt32View[0]=V,this.updateUniform(G,d._TempBuffer,1)}_updateUInt2ForEffect(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setUInt2(G+J,V,W)}_updateUInt2ForUniform(G,V,W){d._TempBufferUInt32View[0]=V,d._TempBufferUInt32View[1]=W,this.updateUniform(G,d._TempBuffer,2)}_updateUInt3ForEffect(G,V,W,J){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setUInt3(G+R,V,W,J)}_updateUInt3ForUniform(G,V,W,J){d._TempBufferUInt32View[0]=V,d._TempBufferUInt32View[1]=W,d._TempBufferUInt32View[2]=J,this.updateUniform(G,d._TempBuffer,3)}_updateUInt4ForEffect(G,V,W,J,R){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setUInt4(G+d,V,W,J,R)}_updateUInt4ForUniform(G,V,W,J,R){d._TempBufferUInt32View[0]=V,d._TempBufferUInt32View[1]=W,d._TempBufferUInt32View[2]=J,d._TempBufferUInt32View[3]=R,this.updateUniform(G,d._TempBuffer,4)}setTexture(G,V){this._currentEffect.setTexture(G,V)}setTextureArray(G,V){this._currentEffect.setTextureArray(G,V)}bindTexture(G,V){this._currentEffect._bindTexture(G,V)}updateUniformDirectly(G,V){this.updateUniform(G,V,V.length),this.update()}bindToEffect(G,V){this._currentEffect=G,this._currentEffectName=V}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}setDataBuffer(G){if(!this._buffers)return this._buffer===G;for(let V=0;V<this._buffers.length;++V){if(this._buffers[V][0]===G)return this._bufferIndex=V,this._buffer=G,this._createBufferOnWrite=!1,this._currentEffect=void 0,this._buffers.length>1&&this._buffers[V][1]&&this._bufferData.set(this._buffers[V][1]),this._valueCache={},this._currentFrameId=this._engine.frameId,!0}return!1}dispose(){if(this._noUBO)return;const G=this._engine._uniformBuffers,V=G.indexOf(this);if(-1!==V&&(G[V]=G[G.length-1],G.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let W=0;W<this._buffers.length;++W){const G=this._buffers[W][0];this._engine._releaseBuffer(G)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}d._UpdatedUbosInFrame={},d._MAX_UNIFORM_SIZE=256,d._TempBuffer=new Float32Array(d._MAX_UNIFORM_SIZE),d._TempBufferInt32View=new Int32Array(d._TempBuffer.buffer),d._TempBufferUInt32View=new Uint32Array(d._TempBuffer.buffer)},11496:(G,V,W)=>{W.d(V,{e:()=>k,h:()=>J});var J,R,d=W(11136);!function(G){G[G.LOCAL=0]="LOCAL",G[G.WORLD=1]="WORLD",G[G.BONE=2]="BONE"}(J||(J={}));class k{}k.X=new d.o(1,0,0),k.Y=new d.o(0,1,0),k.Z=new d.o(0,0,1),function(G){G[G.X=0]="X",G[G.Y=1]="Y",G[G.Z=2]="Z"}(R||(R={}))},11424:(G,V,W)=>{W.d(V,{d:()=>x,h:()=>q,j:()=>L});var J=W(11152),R=W(11159),d=W(11145),k=W(11182);function z(G){return Math.pow(G,d.g)}function X(G){return G<=.04045?.0773993808*G:Math.pow(.947867299*(G+.055),2.4)}function P(G){return Math.pow(G,d.f)}function A(G){return G<=.0031308?12.92*G:1.055*Math.pow(G,.41666)-.055}class x{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.r=G,this.g=V,this.b=W}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"pz"}getHashCode(){let G=255*this.r|0;return G=397*G^255*this.g,G=397*G^255*this.b,G}toArray(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return G[V]=this.r,G[V+1]=this.g,G[V+2]=this.b,this}XW(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return x.FromArrayToRef(G,V,this),this}toColor4(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new q(this.r,this.g,this.b,G)}Bd(){return[this.r,this.g,this.b]}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(G){return new x(this.r*G.r,this.g*G.g,this.b*G.b)}multiplyToRef(G,V){return V.r=this.r*G.r,V.g=this.g*G.g,V.b=this.b*G.b,V}multiplyInPlace(G){return this.r*=G.r,this.g*=G.g,this.b*=G.b,this}multiplyByFloats(G,V,W){return new x(this.r*G,this.g*V,this.b*W)}divide(G){throw new ReferenceError("Can not divide a color")}divideToRef(G,V){throw new ReferenceError("Can not divide a color")}divideInPlace(G){throw new ReferenceError("Can not divide a color")}minimizeInPlace(G){return this.minimizeInPlaceFromFloats(G.r,G.g,G.b)}maximizeInPlace(G){return this.maximizeInPlaceFromFloats(G.r,G.g,G.b)}minimizeInPlaceFromFloats(G,V,W){return this.r=Math.min(G,this.r),this.g=Math.min(V,this.g),this.b=Math.min(W,this.b),this}maximizeInPlaceFromFloats(G,V,W){return this.r=Math.max(G,this.r),this.g=Math.max(V,this.g),this.b=Math.max(W,this.b),this}floorToRef(G){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(G){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}equals(G){return G&&this.r===G.r&&this.g===G.g&&this.b===G.b}equalsFloats(G,V,W){return this.equalsToFloats(G,V,W)}equalsToFloats(G,V,W){return this.r===G&&this.g===V&&this.b===W}equalsWithEpsilon(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.c;return(0,k.WithinEpsilon)(this.r,G.r,V)&&(0,k.WithinEpsilon)(this.g,G.g,V)&&(0,k.WithinEpsilon)(this.b,G.b,V)}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(G){throw new ReferenceError("Can not negate a color")}scale(G){return new x(this.r*G,this.g*G,this.b*G)}scaleInPlace(G){return this.r*=G,this.g*=G,this.b*=G,this}scaleToRef(G,V){return V.r=this.r*G,V.g=this.g*G,V.b=this.b*G,V}scaleAndAddToRef(G,V){return V.r+=this.r*G,V.g+=this.g*G,V.b+=this.b*G,V}clampToRef(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,W=arguments.length>2?arguments[2]:void 0;return W.r=(0,k.Clamp)(this.r,G,V),W.g=(0,k.Clamp)(this.g,G,V),W.b=(0,k.Clamp)(this.b,G,V),W}add(G){return new x(this.r+G.r,this.g+G.g,this.b+G.b)}addInPlace(G){return this.r+=G.r,this.g+=G.g,this.b+=G.b,this}addInPlaceFromFloats(G,V,W){return this.r+=G,this.g+=V,this.b+=W,this}addToRef(G,V){return V.r=this.r+G.r,V.g=this.g+G.g,V.b=this.b+G.b,V}zW(G){return new x(this.r-G.r,this.g-G.g,this.b-G.b)}subtractToRef(G,V){return V.r=this.r-G.r,V.g=this.g-G.g,V.b=this.b-G.b,V}FA(G){return this.r-=G.r,this.g-=G.g,this.b-=G.b,this}subtractFromFloats(G,V,W){return new x(this.r-G,this.g-V,this.b-W)}subtractFromFloatsToRef(G,V,W,J){return J.r=this.r-G,J.g=this.g-V,J.b=this.b-W,J}clone(){return new x(this.r,this.g,this.b)}J(G){return this.r=G.r,this.g=G.g,this.b=G.b,this}rd(G,V,W){return this.r=G,this.g=V,this.b=W,this}set(G,V,W){return this.rd(G,V,W)}Ud(G){return this.r=this.g=this.b=G,this}toHexString(){const G=Math.round(255*this.r),V=Math.round(255*this.g),W=Math.round(255*this.b);return"#"+(0,k.ToHex)(G)+(0,k.ToHex)(V)+(0,k.ToHex)(W)}fromHexString(G){return"#"!==G.substring(0,1)||7!==G.length||(this.r=parseInt(G.substring(1,3),16)/255,this.g=parseInt(G.substring(3,5),16)/255,this.b=parseInt(G.substring(5,7),16)/255),this}toHSV(){return this.toHSVToRef(new x)}toHSVToRef(G){const V=this.r,W=this.g,J=this.b,R=Math.max(V,W,J),d=Math.min(V,W,J);let k=0,z=0;const X=R,P=R-d;return 0!==R&&(z=P/R),R!=d&&(R==V?(k=(W-J)/P,W<J&&(k+=6)):R==W?k=(J-V)/P+2:R==J&&(k=(V-W)/P+4),k*=60),G.r=k,G.g=z,G.b=X,G}toLinearSpace(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const V=new x;return this.toLinearSpaceToRef(V,G),V}toLinearSpaceToRef(G){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(G.r=X(this.r),G.g=X(this.g),G.b=X(this.b)):(G.r=z(this.r),G.g=z(this.g),G.b=z(this.b)),this}toGammaSpace(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const V=new x;return this.toGammaSpaceToRef(V,G),V}toGammaSpaceToRef(G){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(G.r=A(this.r),G.g=A(this.g),G.b=A(this.b)):(G.r=P(this.r),G.g=P(this.g),G.b=P(this.b)),this}static HSVtoRGBToRef(G,V,W,J){const R=W*V,d=G/60,k=R*(1-Math.abs(d%2-1));let z=0,X=0,P=0;d>=0&&d<=1?(z=R,X=k):d>=1&&d<=2?(z=k,X=R):d>=2&&d<=3?(X=R,P=k):d>=3&&d<=4?(X=k,P=R):d>=4&&d<=5?(z=k,P=R):d>=5&&d<=6&&(z=R,P=k);const A=W-R;return J.r=z+A,J.g=X+A,J.b=P+A,J}static FromHSV(G,V,W){const J=new x(0,0,0);return x.HSVtoRGBToRef(G,V,W,J),J}static FromHexString(G){return new x(0,0,0).fromHexString(G)}static ld(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new x(G[V],G[V+1],G[V+2])}static FromArrayToRef(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0;W.r=G[V],W.g=G[V+1],W.b=G[V+2]}static FromInts(G,V,W){return new x(G/255,V/255,W/255)}static Lerp(G,V,W){const J=new x(0,0,0);return x.LerpToRef(G,V,W,J),J}static LerpToRef(G,V,W,J){J.r=G.r+(V.r-G.r)*W,J.g=G.g+(V.g-G.g)*W,J.b=G.b+(V.b-G.b)*W}static Hermite(G,V,W,J,R){const d=R*R,k=R*d,z=2*k-3*d+1,X=-2*k+3*d,P=k-2*d+R,A=k-d,q=G.r*z+W.r*X+V.r*P+J.r*A,L=G.g*z+W.g*X+V.g*P+J.g*A,t=G.b*z+W.b*X+V.b*P+J.b*A;return new x(q,L,t)}static Hermite1stDerivative(G,V,W,J,R){const d=x.Black();return this.Hermite1stDerivativeToRef(G,V,W,J,R,d),d}static Hermite1stDerivativeToRef(G,V,W,J,R,d){const k=R*R;d.r=6*(k-R)*G.r+(3*k-4*R+1)*V.r+6*(-k+R)*W.r+(3*k-2*R)*J.r,d.g=6*(k-R)*G.g+(3*k-4*R+1)*V.g+6*(-k+R)*W.g+(3*k-2*R)*J.g,d.b=6*(k-R)*G.b+(3*k-4*R+1)*V.b+6*(-k+R)*W.b+(3*k-2*R)*J.b}static Red(){return new x(1,0,0)}static Green(){return new x(0,1,0)}static Blue(){return new x(0,0,1)}static Black(){return new x(0,0,0)}static get BlackReadOnly(){return x._BlackReadOnly}static White(){return new x(1,1,1)}static Purple(){return new x(.5,0,.5)}static Magenta(){return new x(1,0,1)}static Yellow(){return new x(1,1,0)}static Gray(){return new x(.5,.5,.5)}static Teal(){return new x(0,1,1)}static Random(){return new x(Math.random(),Math.random(),Math.random())}}x._V8PerformanceHack=new x(.5,.5,.5),x._BlackReadOnly=x.Black(),Object.defineProperties(x.prototype,{dimension:{value:[3]},rank:{value:1}});class q{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=G,this.g=V,this.b=W,this.a=J}Bd(){return[this.r,this.g,this.b,this.a]}toArray(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return G[V]=this.r,G[V+1]=this.g,G[V+2]=this.b,G[V+3]=this.a,this}XW(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=G[V],this.g=G[V+1],this.b=G[V+2],this.a=G[V+3],this}equals(G){return G&&this.r===G.r&&this.g===G.g&&this.b===G.b&&this.a===G.a}add(G){return new q(this.r+G.r,this.g+G.g,this.b+G.b,this.a+G.a)}addToRef(G,V){return V.r=this.r+G.r,V.g=this.g+G.g,V.b=this.b+G.b,V.a=this.a+G.a,V}addInPlace(G){return this.r+=G.r,this.g+=G.g,this.b+=G.b,this.a+=G.a,this}addInPlaceFromFloats(G,V,W,J){return this.r+=G,this.g+=V,this.b+=W,this.a+=J,this}zW(G){return new q(this.r-G.r,this.g-G.g,this.b-G.b,this.a-G.a)}subtractToRef(G,V){return V.r=this.r-G.r,V.g=this.g-G.g,V.b=this.b-G.b,V.a=this.a-G.a,V}FA(G){return this.r-=G.r,this.g-=G.g,this.b-=G.b,this.a-=G.a,this}subtractFromFloats(G,V,W,J){return new q(this.r-G,this.g-V,this.b-W,this.a-J)}subtractFromFloatsToRef(G,V,W,J,R){return R.r=this.r-G,R.g=this.g-V,R.b=this.b-W,R.a=this.a-J,R}scale(G){return new q(this.r*G,this.g*G,this.b*G,this.a*G)}scaleInPlace(G){return this.r*=G,this.g*=G,this.b*=G,this.a*=G,this}scaleToRef(G,V){return V.r=this.r*G,V.g=this.g*G,V.b=this.b*G,V.a=this.a*G,V}scaleAndAddToRef(G,V){return V.r+=this.r*G,V.g+=this.g*G,V.b+=this.b*G,V.a+=this.a*G,V}clampToRef(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,W=arguments.length>2?arguments[2]:void 0;return W.r=(0,k.Clamp)(this.r,G,V),W.g=(0,k.Clamp)(this.g,G,V),W.b=(0,k.Clamp)(this.b,G,V),W.a=(0,k.Clamp)(this.a,G,V),W}multiply(G){return new q(this.r*G.r,this.g*G.g,this.b*G.b,this.a*G.a)}multiplyToRef(G,V){return V.r=this.r*G.r,V.g=this.g*G.g,V.b=this.b*G.b,V.a=this.a*G.a,V}multiplyInPlace(G){return this.r*=G.r,this.g*=G.g,this.b*=G.b,this.a*=G.a,this}multiplyByFloats(G,V,W,J){return new q(this.r*G,this.g*V,this.b*W,this.a*J)}divide(G){throw new ReferenceError("Can not divide a color")}divideToRef(G,V){throw new ReferenceError("Can not divide a color")}divideInPlace(G){throw new ReferenceError("Can not divide a color")}minimizeInPlace(G){return this.r=Math.min(this.r,G.r),this.g=Math.min(this.g,G.g),this.b=Math.min(this.b,G.b),this.a=Math.min(this.a,G.a),this}maximizeInPlace(G){return this.r=Math.max(this.r,G.r),this.g=Math.max(this.g,G.g),this.b=Math.max(this.b,G.b),this.a=Math.max(this.a,G.a),this}minimizeInPlaceFromFloats(G,V,W,J){return this.r=Math.min(G,this.r),this.g=Math.min(V,this.g),this.b=Math.min(W,this.b),this.a=Math.min(J,this.a),this}maximizeInPlaceFromFloats(G,V,W,J){return this.r=Math.max(G,this.r),this.g=Math.max(V,this.g),this.b=Math.max(W,this.b),this.a=Math.max(J,this.a),this}floorToRef(G){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(G){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(G){throw new ReferenceError("Can not negate a color")}equalsWithEpsilon(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.c;return(0,k.WithinEpsilon)(this.r,G.r,V)&&(0,k.WithinEpsilon)(this.g,G.g,V)&&(0,k.WithinEpsilon)(this.b,G.b,V)&&(0,k.WithinEpsilon)(this.a,G.a,V)}equalsToFloats(G,V,W,J){return this.r===G&&this.g===V&&this.b===W&&this.a===J}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"nz"}getHashCode(){let G=255*this.r|0;return G=397*G^255*this.g,G=397*G^255*this.b,G=397*G^255*this.a,G}clone(){return(new q).J(this)}J(G){return this.r=G.r,this.g=G.g,this.b=G.b,this.a=G.a,this}rd(G,V,W,J){return this.r=G,this.g=V,this.b=W,this.a=J,this}set(G,V,W,J){return this.rd(G,V,W,J)}Ud(G){return this.r=this.g=this.b=this.a=G,this}toHexString(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const V=Math.round(255*this.r),W=Math.round(255*this.g),J=Math.round(255*this.b);if(G)return"#"+(0,k.ToHex)(V)+(0,k.ToHex)(W)+(0,k.ToHex)(J);const R=Math.round(255*this.a);return"#"+(0,k.ToHex)(V)+(0,k.ToHex)(W)+(0,k.ToHex)(J)+(0,k.ToHex)(R)}fromHexString(G){return"#"!==G.substring(0,1)||9!==G.length&&7!==G.length||(this.r=parseInt(G.substring(1,3),16)/255,this.g=parseInt(G.substring(3,5),16)/255,this.b=parseInt(G.substring(5,7),16)/255,9===G.length&&(this.a=parseInt(G.substring(7,9),16)/255)),this}toLinearSpace(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const V=new q;return this.toLinearSpaceToRef(V,G),V}toLinearSpaceToRef(G){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(G.r=X(this.r),G.g=X(this.g),G.b=X(this.b)):(G.r=z(this.r),G.g=z(this.g),G.b=z(this.b)),G.a=this.a,this}toGammaSpace(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const V=new q;return this.toGammaSpaceToRef(V,G),V}toGammaSpaceToRef(G){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(G.r=A(this.r),G.g=A(this.g),G.b=A(this.b)):(G.r=P(this.r),G.g=P(this.g),G.b=P(this.b)),G.a=this.a,this}static FromHexString(G){return"#"!==G.substring(0,1)||9!==G.length&&7!==G.length?new q(0,0,0,0):new q(0,0,0,1).fromHexString(G)}static Lerp(G,V,W){return q.LerpToRef(G,V,W,new q)}static LerpToRef(G,V,W,J){return J.r=G.r+(V.r-G.r)*W,J.g=G.g+(V.g-G.g)*W,J.b=G.b+(V.b-G.b)*W,J.a=G.a+(V.a-G.a)*W,J}static Hermite(G,V,W,J,R){const d=R*R,k=R*d,z=2*k-3*d+1,X=-2*k+3*d,P=k-2*d+R,A=k-d,x=G.r*z+W.r*X+V.r*P+J.r*A,L=G.g*z+W.g*X+V.g*P+J.g*A,t=G.b*z+W.b*X+V.b*P+J.b*A,Y=G.a*z+W.a*X+V.a*P+J.a*A;return new q(x,L,t,Y)}static Hermite1stDerivative(G,V,W,J,R){const d=new q;return this.Hermite1stDerivativeToRef(G,V,W,J,R,d),d}static Hermite1stDerivativeToRef(G,V,W,J,R,d){const k=R*R;d.r=6*(k-R)*G.r+(3*k-4*R+1)*V.r+6*(-k+R)*W.r+(3*k-2*R)*J.r,d.g=6*(k-R)*G.g+(3*k-4*R+1)*V.g+6*(-k+R)*W.g+(3*k-2*R)*J.g,d.b=6*(k-R)*G.b+(3*k-4*R+1)*V.b+6*(-k+R)*W.b+(3*k-2*R)*J.b,d.a=6*(k-R)*G.a+(3*k-4*R+1)*V.a+6*(-k+R)*W.a+(3*k-2*R)*J.a}static FromColor3(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new q(G.r,G.g,G.b,V)}static ld(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new q(G[V],G[V+1],G[V+2],G[V+3])}static FromArrayToRef(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0;W.r=G[V],W.g=G[V+1],W.b=G[V+2],W.a=G[V+3]}static FromInts(G,V,W,J){return new q(G/255,V/255,W/255,J/255)}static CheckColors4(G,V){if(G.length===3*V){const V=[];for(let W=0;W<G.length;W+=3){const J=W/3*4;V[J]=G[W],V[J+1]=G[W+1],V[J+2]=G[W+2],V[J+3]=1}return V}return G}}q._V8PerformanceHack=new q(.5,.5,.5,.5),Object.defineProperties(q.prototype,{dimension:{value:[4]},rank:{value:1}});class L{}L.pz=(0,J.b)(3,x.Black),L.nz=(0,J.b)(3,(()=>new q(0,0,0,0))),(0,R.d)("BABYLON.Color3",x),(0,R.d)("BABYLON.Color4",q)},11145:(G,V,W)=>{W.d(V,{c:()=>k,e:()=>d,f:()=>J,g:()=>R});const J=1/2.2,R=2.2,d=(1+Math.sqrt(5))/2,k=.001},11532:(G,V,W)=>{W.d(V,{c:()=>R});var J=W(11409);class R{static GetPlanes(G){const V=[];for(let W=0;W<6;W++)V.push(new J.c(0,0,0,0));return R.GetPlanesToRef(G,V),V}static GetNearPlaneToRef(G,V){const W=G.m;V.IV.x=W[3]+W[2],V.IV.y=W[7]+W[6],V.IV.z=W[11]+W[10],V.d=W[15]+W[14],V.normalize()}static GetFarPlaneToRef(G,V){const W=G.m;V.IV.x=W[3]-W[2],V.IV.y=W[7]-W[6],V.IV.z=W[11]-W[10],V.d=W[15]-W[14],V.normalize()}static GetLeftPlaneToRef(G,V){const W=G.m;V.IV.x=W[3]+W[0],V.IV.y=W[7]+W[4],V.IV.z=W[11]+W[8],V.d=W[15]+W[12],V.normalize()}static GetRightPlaneToRef(G,V){const W=G.m;V.IV.x=W[3]-W[0],V.IV.y=W[7]-W[4],V.IV.z=W[11]-W[8],V.d=W[15]-W[12],V.normalize()}static GetTopPlaneToRef(G,V){const W=G.m;V.IV.x=W[3]-W[1],V.IV.y=W[7]-W[5],V.IV.z=W[11]-W[9],V.d=W[15]-W[13],V.normalize()}static GetBottomPlaneToRef(G,V){const W=G.m;V.IV.x=W[3]+W[1],V.IV.y=W[7]+W[5],V.IV.z=W[11]+W[9],V.d=W[15]+W[13],V.normalize()}static GetPlanesToRef(G,V){R.GetNearPlaneToRef(G,V[0]),R.GetFarPlaneToRef(G,V[1]),R.GetLeftPlaneToRef(G,V[2]),R.GetRightPlaneToRef(G,V[3]),R.GetTopPlaneToRef(G,V[4]),R.GetBottomPlaneToRef(G,V[5])}static IsPointInFrustum(G,V){for(let W=0;W<6;W++)if(V[W].dotCoordinate(G)<0)return!1;return!0}}},11390:(G,V,W)=>{W.d(V,{c:()=>z,d:()=>X});var J=W(11317),R=W(11136),d=W(11324);class k{static extractMinAndMaxIndexed(G,V,W,J,R,d){for(let k=W;k<W+J;k++){const W=3*V[k],J=G[W],z=G[W+1],X=G[W+2];R.minimizeInPlaceFromFloats(J,z,X),d.maximizeInPlaceFromFloats(J,z,X)}}static extractMinAndMax(G,V,W,J,R,d){for(let k=V,z=V*J;k<V+W;k++,z+=J){const V=G[z],W=G[z+1],J=G[z+2];R.minimizeInPlaceFromFloats(V,W,J),d.maximizeInPlaceFromFloats(V,W,J)}}}function z(G,V,W,J){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const z=new R.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),X=new R.o(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return k.extractMinAndMaxIndexed(G,V,W,J,z,X),d&&(z.x-=z.x*d.x+d.y,z.y-=z.y*d.x+d.y,z.z-=z.z*d.x+d.y,X.x+=X.x*d.x+d.y,X.y+=X.y*d.x+d.y,X.z+=X.z*d.x+d.y),{minimum:z,maximum:X}}function X(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4?arguments[4]:void 0;const z=new R.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),X=new R.o(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return d||(d=3),k.extractMinAndMax(G,V,W,d,z,X),J&&(z.x-=z.x*J.x+J.y,z.y-=z.y*J.x+J.y,z.z-=z.z*J.x+J.y,X.x+=X.x*J.x+J.y,X.y+=X.y*J.x+J.y,X.z+=X.z*J.x+J.y),{minimum:z,maximum:X}}(0,J.e)([d.f.filter((function(){for(var G=arguments.length,V=new Array(G),W=0;W<G;W++)V[W]=arguments[W];let[J,R]=V;return!Array.isArray(J)&&!Array.isArray(R)}))],k,"extractMinAndMaxIndexed",null),(0,J.e)([d.f.filter((function(){for(var G=arguments.length,V=new Array(G),W=0;W<G;W++)V[W]=arguments[W];let[J]=V;return!Array.isArray(J)}))],k,"extractMinAndMax",null)},11623:(G,V,W)=>{W.d(V,{d:()=>J.c,h:()=>J.g,k:()=>J.h,o:()=>J.o});W(11496),W(11424),W(11145),W(11532),W(11627),W(11409),W(11636);var J=W(11136);W(11530)},11627:(G,V,W)=>{W.d(V,{c:()=>z,g:()=>q,k:()=>A,n:()=>x});var J,R=W(11182),d=W(11136),k=W(11145);!function(G){G[G.CW=0]="CW",G[G.CCW=1]="CCW"}(J||(J={}));class z{static Interpolate(G,V,W,J,R){if(0===G)return 0;const d=1-3*J+3*V,k=3*J-6*V,z=3*V;let X=G;for(let P=0;P<5;P++){const V=X*X;X-=(d*(V*X)+k*V+z*X-G)*(1/(3*d*V+2*k*X+z)),X=Math.min(1,Math.max(0,X))}return 3*Math.pow(1-X,2)*X*W+3*(1-X)*Math.pow(X,2)*R+Math.pow(X,3)}}class X{constructor(G){this._radians=G,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}static BetweenTwoPoints(G,V){const W=V.zW(G),J=Math.atan2(W.y,W.x);return new X(J)}static BetweenTwoVectors(G,V){let W=G.lengthSquared()*V.lengthSquared();if(0===W)return new X(Math.PI/2);W=Math.sqrt(W);let J=G.dot(V)/W;J=(0,R.Clamp)(J,-1,1);const d=Math.acos(J);return new X(d)}static FromRadians(G){return new X(G)}static FromDegrees(G){return new X(G*Math.PI/180)}}class P{constructor(G,V,W){this.startPoint=G,this.midPoint=V,this.endPoint=W;const J=Math.pow(V.x,2)+Math.pow(V.y,2),R=(Math.pow(G.x,2)+Math.pow(G.y,2)-J)/2,k=(J-Math.pow(W.x,2)-Math.pow(W.y,2))/2,z=(G.x-V.x)*(V.y-W.y)-(V.x-W.x)*(G.y-V.y);this.centerPoint=new d.k((R*(V.y-W.y)-k*(G.y-V.y))/z,((G.x-V.x)*k-(V.x-W.x)*R)/z),this.radius=this.centerPoint.zW(this.startPoint).length(),this.startAngle=X.BetweenTwoPoints(this.centerPoint,this.startPoint);const P=this.startAngle.degrees();let A=X.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),x=X.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();A-P>180&&(A-=360),A-P<-180&&(A+=360),x-A>180&&(x-=360),x-A<-180&&(x+=360),this.orientation=A-P<0?0:1,this.angle=X.FromDegrees(0===this.orientation?P-x:x-P)}}class A{constructor(G,V){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new d.k(G,V))}addLineTo(G,V){if(this.closed)return this;const W=new d.k(G,V),J=this._points[this._points.length-1];return this._points.push(W),this._length+=W.zW(J).length(),this}addArcTo(G,V,W,J){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const k=this._points[this._points.length-1],z=new d.k(G,V),X=new d.k(W,J),A=new P(k,z,X);let x=A.angle.radians()/R;0===A.orientation&&(x*=-1);let q=A.startAngle.radians()+x;for(let d=0;d<R;d++){const G=Math.cos(q)*A.radius+A.centerPoint.x,V=Math.sin(q)*A.radius+A.centerPoint.y;this.addLineTo(G,V),q+=x}return this}addQuadraticCurveTo(G,V,W,J){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const d=(G,V,W,J)=>(1-G)*(1-G)*V+2*G*(1-G)*W+G*G*J,k=this._points[this._points.length-1];for(let z=0;z<=R;z++){const X=z/R,P=d(X,k.x,G,W),A=d(X,k.y,V,J);this.addLineTo(P,A)}return this}addBezierCurveTo(G,V,W,J,R,d){let k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:36;if(this.closed)return this;const z=(G,V,W,J,R)=>(1-G)*(1-G)*(1-G)*V+3*G*(1-G)*(1-G)*W+3*G*G*(1-G)*J+G*G*G*R,X=this._points[this._points.length-1];for(let P=0;P<=k;P++){const A=P/k,x=z(A,X.x,G,W,R),q=z(A,X.y,V,J,d);this.addLineTo(x,q)}return this}isPointInside(G){let V=!1;const W=this._points.length;for(let J=W-1,R=0;R<W;J=R++){let W=this._points[J],d=this._points[R],k=d.x-W.x,z=d.y-W.y;if(Math.abs(z)>Number.EPSILON){if(z<0&&(W=this._points[R],k=-k,d=this._points[J],z=-z),G.y<W.y||G.y>d.y)continue;if(G.y===W.y&&G.x===W.x)return!0;{const J=z*(G.x-W.x)-k*(G.y-W.y);if(0===J)return!0;if(J<0)continue;V=!V}}else{if(G.y!==W.y)continue;if(d.x<=G.x&&G.x<=W.x||W.x<=G.x&&G.x<=d.x)return!0}}return V}close(){return this.closed=!0,this}length(){let G=this._length;if(this.closed){const V=this._points[this._points.length-1];G+=this._points[0].zW(V).length()}return G}area(){const G=this._points.length;let V=0;for(let W=G-1,J=0;J<G;W=J++)V+=this._points[W].x*this._points[J].y-this._points[J].x*this._points[W].y;return.5*V}getPoints(){return this._points}getPointAtLengthPosition(G){if(G<0||G>1)return d.k.Zero();const V=G*this.length();let W=0;for(let J=0;J<this._points.length;J++){const G=(J+1)%this._points.length,R=this._points[J],k=this._points[G].zW(R),z=k.length()+W;if(V>=W&&V<=z){const G=k.normalize(),J=V-W;return new d.k(R.x+G.x*J,R.y+G.y*J)}W=z}return d.k.Zero()}static StartingAt(G,V){return new A(G,V)}}class x{constructor(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0,J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.path=G,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:d.o.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:d.c.Identity()};for(let R=0;R<G.length;R++)this._curve[R]=G[R].clone();this._raw=W||!1,this._alignTangentsWithPath=J,this._compute(V,J)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(G){return this._updatePointAtData(G).point}getTangentAt(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(G,V),V?d.o.TransformCoordinates(d.o.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(G,V),V?d.o.TransformCoordinates(d.o.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(G,V),V?d.o.TransformCoordinates(d.o.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(G){return this.length()*G}getPreviousPointIndexAt(G){return this._updatePointAtData(G),this._pointAtData.previousPointArrayIndex}getSubPositionAt(G){return this._updatePointAtData(G),this._pointAtData.subPosition}getClosestPositionTo(G){let V=Number.MAX_VALUE,W=0;for(let J=0;J<this._curve.length-1;J++){const R=this._curve[J+0],k=this._curve[J+1].zW(R).normalize(),z=this._distances[J+1]-this._distances[J+0],X=Math.min(Math.max(d.o.Dot(k,G.zW(R).normalize()),0)*d.o.Distance(R,G)/z,1),P=d.o.Distance(R.add(k.scale(X*z)),G);P<V&&(V=P,W=(this._distances[J+0]+z*X)/this.length())}return W}slice(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(G<0&&(G=1- -1*G%1),V<0&&(V=1- -1*V%1),G>V){const W=G;G=V,V=W}const W=this.getCurve(),J=this.getPointAt(G);let R=this.getPreviousPointIndexAt(G);const d=this.getPointAt(V),k=this.getPreviousPointIndexAt(V)+1,z=[];return 0!==G&&(R++,z.push(J)),z.push(...W.slice(R,k)),1===V&&1!==G||z.push(d),new x(z,this.getNormalAt(G),this._raw,this._alignTangentsWithPath)}update(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(let J=0;J<G.length;J++)this._curve[J].x=G[J].x,this._curve[J].y=G[J].y,this._curve[J].z=G[J].z;return this._compute(V,W),this}_compute(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const W=this._curve.length;if(W<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[W-1]=this._curve[W-1].zW(this._curve[W-2]),this._raw||this._tangents[W-1].normalize();const J=this._tangents[0],R=this._normalVector(J,G);let k,z,X,P,A;this._normals[0]=R,this._raw||this._normals[0].normalize(),this._binormals[0]=d.o.Cross(J,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let x=1;x<W;x++)k=this._getLastNonNullVector(x),x<W-1&&(z=this._getFirstNonNullVector(x),this._tangents[x]=V?z:k.add(z),this._tangents[x].normalize()),this._distances[x]=this._distances[x-1]+this._curve[x].zW(this._curve[x-1]).length(),X=this._tangents[x],A=this._binormals[x-1],this._normals[x]=d.o.Cross(A,X),this._raw||(0===this._normals[x].length()?(P=this._normals[x-1],this._normals[x]=P.clone()):this._normals[x].normalize()),this._binormals[x]=d.o.Cross(X,this._normals[x]),this._raw||this._binormals[x].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(G){let V=1,W=this._curve[G+V].zW(this._curve[G]);for(;0===W.length()&&G+V+1<this._curve.length;)V++,W=this._curve[G+V].zW(this._curve[G]);return W}_getLastNonNullVector(G){let V=1,W=this._curve[G].zW(this._curve[G-V]);for(;0===W.length()&&G>V+1;)V++,W=this._curve[G].zW(this._curve[G-V]);return W}_normalVector(G,V){let W,J=G.length();if(0===J&&(J=1),void 0===V||null===V){let V;V=(0,R.WithinEpsilon)(Math.abs(G.y)/J,1,k.c)?(0,R.WithinEpsilon)(Math.abs(G.x)/J,1,k.c)?(0,R.WithinEpsilon)(Math.abs(G.z)/J,1,k.c)?d.o.Zero():new d.o(0,0,1):new d.o(1,0,0):new d.o(0,-1,0),W=d.o.Cross(G,V)}else W=d.o.Cross(G,V),d.o.CrossToRef(W,G,W);return W.normalize(),W}_updatePointAtData(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._pointAtData.id===G)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=G;const W=this.getPoints();if(G<=0)return this._setPointAtData(0,0,W[0],0,V);if(G>=1)return this._setPointAtData(1,1,W[W.length-1],W.length-1,V);let J,R=W[0],k=0;const z=G*this.length();for(let X=1;X<W.length;X++){J=W[X];const P=d.o.Distance(R,J);if(k+=P,k===z)return this._setPointAtData(G,1,J,X,V);if(k>z){const W=(k-z)/P,d=R.zW(J),A=J.add(d.scaleInPlace(W));return this._setPointAtData(G,1-W,A,X-1,V)}R=J}return this._pointAtData}_setPointAtData(G,V,W,J,R){return this._pointAtData.point=W,this._pointAtData.position=G,this._pointAtData.subPosition=V,this._pointAtData.previousPointArrayIndex=J,this._pointAtData.interpolateReady=R,R&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=d.c.Identity();const G=this._pointAtData.previousPointArrayIndex;if(G!==this._tangents.length-1){const V=G+1,W=this._tangents[G].clone(),J=this._normals[G].clone(),R=this._binormals[G].clone(),k=this._tangents[V].clone(),z=this._normals[V].clone(),X=this._binormals[V].clone(),P=d.g.RotationQuaternionFromAxis(J,R,W),A=d.g.RotationQuaternionFromAxis(z,X,k);d.g.Slerp(P,A,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}class q{static CreateQuadraticBezier(G,V,W,J){J=J>2?J:3;const R=[],k=(G,V,W,J)=>(1-G)*(1-G)*V+2*G*(1-G)*W+G*G*J;for(let z=0;z<=J;z++)R.push(new d.o(k(z/J,G.x,V.x,W.x),k(z/J,G.y,V.y,W.y),k(z/J,G.z,V.z,W.z)));return new q(R)}static CreateCubicBezier(G,V,W,J,R){R=R>3?R:4;const k=[],z=(G,V,W,J,R)=>(1-G)*(1-G)*(1-G)*V+3*G*(1-G)*(1-G)*W+3*G*G*(1-G)*J+G*G*G*R;for(let X=0;X<=R;X++)k.push(new d.o(z(X/R,G.x,V.x,W.x,J.x),z(X/R,G.y,V.y,W.y,J.y),z(X/R,G.z,V.z,W.z,J.z)));return new q(k)}static CreateHermiteSpline(G,V,W,J,R){const k=[],z=1/R;for(let X=0;X<=R;X++)k.push(d.o.Hermite(G,V,W,J,X*z));return new q(k)}static CreateCatmullRomSpline(G,V,W){const J=[],R=1/V;let k=0;if(W){const W=G.length;for(let z=0;z<W;z++){k=0;for(let X=0;X<V;X++)J.push(d.o.CatmullRom(G[z%W],G[(z+1)%W],G[(z+2)%W],G[(z+3)%W],k)),k+=R}J.push(J[0])}else{const W=[];W.push(G[0].clone()),Array.prototype.push.apply(W,G),W.push(G[G.length-1].clone());let z=0;for(;z<W.length-3;z++){k=0;for(let G=0;G<V;G++)J.push(d.o.CatmullRom(W[z],W[z+1],W[z+2],W[z+3],k)),k+=R}z--,J.push(d.o.CatmullRom(W[z],W[z+1],W[z+2],W[z+3],k))}return new q(J)}static ArcThru3Points(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,R=arguments.length>4&&void 0!==arguments[4]&&arguments[4],k=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const z=[],X=V.zW(G),P=W.zW(V),A=G.zW(W),x=d.o.Cross(X,P),L=x.length();if(L<Math.pow(10,-8))return new q(z);const t=X.lengthSquared(),Y=P.lengthSquared(),g=A.lengthSquared(),B=x.lengthSquared(),S=.5*X.length()*P.length()*A.length()/L,p=-.5*Y*d.o.Dot(X,A)/B,b=-.5*g*d.o.Dot(X,P)/B,r=-.5*t*d.o.Dot(P,A)/B,y=G.scale(p).add(V.scale(b)).add(W.scale(r)),u=G.zW(y).normalize(),H=d.o.Cross(x,u).normalize();if(k){const V=2*Math.PI/J;for(let G=0;G<=2*Math.PI;G+=V)z.push(y.add(u.scale(S*Math.cos(G)).add(H.scale(S*Math.sin(G)))));z.push(G)}else{const V=1/J;let k=0,X=d.o.Zero();do{X=y.add(u.scale(S*Math.cos(k)).add(H.scale(S*Math.sin(k)))),z.push(X),k+=V}while(!X.equalsWithEpsilon(W,S*V*1.1));z.push(W),R&&z.push(G)}return new q(z)}constructor(G){this._length=0,this._points=G,this._length=this._computeLength(G)}getPoints(){return this._points}length(){return this._length}continue(G){const V=this._points[this._points.length-1],W=this._points.slice(),J=G.getPoints();for(let R=1;R<J.length;R++)W.push(J[R].zW(J[0]).add(V));return new q(W)}_computeLength(G){let V=0;for(let W=1;W<G.length;W++)V+=G[W].zW(G[W-1]).length();return V}}},11409:(G,V,W)=>{W.d(V,{c:()=>R});var J=W(11136);class R{constructor(G,V,W,R){this.IV=new J.o(G,V,W),this.d=R}Bd(){return[this.IV.x,this.IV.y,this.IV.z,this.d]}clone(){return new R(this.IV.x,this.IV.y,this.IV.z,this.d)}getClassName(){return"Plane"}getHashCode(){let G=this.IV.getHashCode();return G=397*G^this.d,G}normalize(){const G=Math.sqrt(this.IV.x*this.IV.x+this.IV.y*this.IV.y+this.IV.z*this.IV.z);let V=0;return 0!==G&&(V=1/G),this.IV.x*=V,this.IV.y*=V,this.IV.z*=V,this.d*=V,this}transform(G){const V=R._TmpMatrix;G.invertToRef(V);const W=V.m,J=this.IV.x,d=this.IV.y,k=this.IV.z,z=this.d,X=J*W[0]+d*W[1]+k*W[2]+z*W[3],P=J*W[4]+d*W[5]+k*W[6]+z*W[7],A=J*W[8]+d*W[9]+k*W[10]+z*W[11],x=J*W[12]+d*W[13]+k*W[14]+z*W[15];return new R(X,P,A,x)}dotCoordinate(G){return this.IV.x*G.x+this.IV.y*G.y+this.IV.z*G.z+this.d}copyFromPoints(G,V,W){const J=V.x-G.x,R=V.y-G.y,d=V.z-G.z,k=W.x-G.x,z=W.y-G.y,X=W.z-G.z,P=R*X-d*z,A=d*k-J*X,x=J*z-R*k,q=Math.sqrt(P*P+A*A+x*x);let L;return L=0!==q?1/q:0,this.IV.x=P*L,this.IV.y=A*L,this.IV.z=x*L,this.d=-(this.IV.x*G.x+this.IV.y*G.y+this.IV.z*G.z),this}isFrontFacingTo(G,V){return J.o.Dot(this.IV,G)<=V}signedDistanceTo(G){return J.o.Dot(G,this.IV)+this.d}static ld(G){return new R(G[0],G[1],G[2],G[3])}static FromPoints(G,V,W){const J=new R(0,0,0,0);return J.copyFromPoints(G,V,W),J}static FromPositionAndNormal(G,V){const W=new R(0,0,0,0);return this.FromPositionAndNormalToRef(G,V,W)}static FromPositionAndNormalToRef(G,V,W){return W.IV.J(V),W.IV.normalize(),W.d=-G.dot(W.IV),W}static SignedDistanceToPlaneFromPositionAndNormal(G,V,W){const R=-(V.x*G.x+V.y*G.y+V.z*G.z);return J.o.Dot(W,V)+R}}R._TmpMatrix=J.c.Identity()},11182:(G,V,W)=>{function J(G){return parseInt(G.toString().replace(/\W/g,""))}function R(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1401298e-51;return Math.abs(G-V)<=W}function d(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1401298e-51;return G<V-J||G>W+J}function k(G,V){return G===V?G:Math.random()*(V-G)+G}function z(G,V,W){return G+(V-G)*W}function X(G,V,W){let J=g(V-G,360);return J>180&&(J-=360),G+J*q(W)}function P(G,V,W){let J=0;return J=G!=V?q((W-G)/(V-G)):0,J}function A(G,V,W,J,R){const d=R*R,k=R*d;return G*(2*k-3*d+1)+W*(-2*k+3*d)+V*(k-2*d+R)+J*(k-d)}function x(G,V,W,J,R){const d=R*R;return 6*(d-R)*G+(3*d-4*R+1)*V+6*(-d+R)*W+(3*d-2*R)*J}function q(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(W,Math.max(V,G))}function L(G){return G-=2*Math.PI*Math.floor((G+Math.PI)/(2*Math.PI))}function t(G){const V=G.toString(16);return G<=15?("0"+V).toUpperCase():V.toUpperCase()}function Y(G){if(Math.log2)return Math.floor(Math.log2(G));if(G<0)return NaN;if(0===G)return-1/0;let V=0;if(G<1){for(;G<1;)V++,G*=2;V=-V}else if(G>1)for(;G>1;)V++,G=Math.floor(G/2);return V}function g(G,V){return G-Math.floor(G/V)*V}function B(G,V,W){return(G-V)/(W-V)}function S(G,V,W){return G*(W-V)+V}function p(G,V){let W=g(V-G,360);return W>180&&(W-=360),W}function b(G,V){const W=g(G,2*V);return V-Math.abs(W-V)}function r(G,V,W){let J=q(W);return J=-2*J*J*J+3*J*J,V*J+G*(1-J)}function y(G,V,W){let J=0;return J=Math.abs(V-G)<=W?V:G+Math.sign(V-G)*W,J}function u(G,V,W){const J=p(G,V);let R=0;return R=-W<J&&J<W?V:y(G,V=G+J,W),R}function H(G,V,W){return(G-V)/(W-V)}function n(G,V,W){return(W-V)*G+V}function D(G,V){const W=G%V;return 0===W?V:D(V,W)}W.r(V),W.d(V,{Clamp:()=>q,DeltaAngle:()=>p,Denormalize:()=>S,ExtractAsInt:()=>J,Hermite:()=>A,Hermite1stDerivative:()=>x,HighestCommonFactor:()=>D,ILog2:()=>Y,InverseLerp:()=>P,Lerp:()=>z,LerpAngle:()=>X,MoveTowards:()=>y,MoveTowardsAngle:()=>u,Normalize:()=>B,NormalizeRadians:()=>L,OutsideRange:()=>d,PercentToRange:()=>n,PingPong:()=>b,RandomRange:()=>k,RangeToPercent:()=>H,Repeat:()=>g,SmoothStep:()=>r,ToHex:()=>t,WithinEpsilon:()=>R})},11636:(G,V,W)=>{W.d(V,{c:()=>J});class J{constructor(G,V){this.width=G,this.height=V}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let G=0|this.width;return G=397*G^this.height,G}J(G){this.width=G.width,this.height=G.height}rd(G,V){return this.width=G,this.height=V,this}set(G,V){return this.rd(G,V)}multiplyByFloats(G,V){return new J(this.width*G,this.height*V)}clone(){return new J(this.width,this.height)}equals(G){return!!G&&(this.width===G.width&&this.height===G.height)}get surface(){return this.width*this.height}static Zero(){return new J(0,0)}add(G){return new J(this.width+G.width,this.height+G.height)}zW(G){return new J(this.width-G.width,this.height-G.height)}scale(G){return new J(this.width*G,this.height*G)}static Lerp(G,V,W){const R=G.width+(V.width-G.width)*W,d=G.height+(V.height-G.height)*W;return new J(R,d)}}},11136:(G,V,W)=>{W.d(V,{c:()=>S,g:()=>B,h:()=>b,k:()=>t,o:()=>Y,q:()=>g});var J=W(11145),R=W(11152),d=W(11159),k=W(11165),z=W(11169),X=W(11182);class P{}function A(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const R=G.Bd(),d=V.Bd(),k=R[0],z=R[1],X=R[2],P=R[3],A=R[4],x=R[5],q=R[6],L=R[7],t=R[8],Y=R[9],g=R[10],B=R[11],S=R[12],p=R[13],b=R[14],r=R[15],y=d[0],u=d[1],H=d[2],n=d[3],D=d[4],i=d[5],e=d[6],F=d[7],f=d[8],v=d[9],C=d[10],l=d[11],m=d[12],w=d[13],N=d[14],U=d[15];W[J]=k*y+z*D+X*f+P*m,W[J+1]=k*u+z*i+X*v+P*w,W[J+2]=k*H+z*e+X*C+P*N,W[J+3]=k*n+z*F+X*l+P*U,W[J+4]=A*y+x*D+q*f+L*m,W[J+5]=A*u+x*i+q*v+L*w,W[J+6]=A*H+x*e+q*C+L*N,W[J+7]=A*n+x*F+q*l+L*U,W[J+8]=t*y+Y*D+g*f+B*m,W[J+9]=t*u+Y*i+g*v+B*w,W[J+10]=t*H+Y*e+g*C+B*N,W[J+11]=t*n+Y*F+g*l+B*U,W[J+12]=S*y+p*D+b*f+r*m,W[J+13]=S*u+p*i+b*v+r*w,W[J+14]=S*H+p*e+b*C+r*N,W[J+15]=S*n+p*F+b*l+r*U}function x(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const J=G.Bd();V[W]=J[0],V[W+1]=J[1],V[W+2]=J[2],V[W+3]=J[3],V[W+4]=J[4],V[W+5]=J[5],V[W+6]=J[6],V[W+7]=J[7],V[W+8]=J[8],V[W+9]=J[9],V[W+10]=J[10],V[W+11]=J[11],V[W+12]=J[12],V[W+13]=J[13],V[W+14]=J[14],V[W+15]=J[15]}function q(G,V){const W=G.Bd(),J=W[0],R=W[1],d=W[2],k=W[3],z=W[4],X=W[5],P=W[6],A=W[7],x=W[8],q=W[9],L=W[10],t=W[11],Y=W[12],g=W[13],B=W[14],S=W[15],p=L*S-B*t,b=q*S-g*t,r=q*B-g*L,y=x*S-Y*t,u=x*B-L*Y,H=x*g-Y*q,n=+(X*p-P*b+A*r),D=-(z*p-P*y+A*u),i=+(z*b-X*y+A*H),e=-(z*r-X*u+P*H),F=J*n+R*D+d*i+k*e;if(0===F)return!1;const f=1/F,v=P*S-B*A,C=X*S-g*A,l=X*B-g*P,m=z*S-Y*A,w=z*B-Y*P,N=z*g-Y*X,U=P*t-L*A,a=X*t-q*A,M=X*L-q*P,T=z*t-x*A,K=z*L-x*P,s=z*q-x*X,Q=-(R*p-d*b+k*r),Z=+(J*p-d*y+k*u),E=-(J*b-R*y+k*H),h=+(J*r-R*u+d*H),o=+(R*v-d*C+k*l),c=-(J*v-d*m+k*w),j=+(J*C-R*m+k*N),I=-(J*l-R*w+d*N),O=-(R*U-d*a+k*M),GG=+(J*U-d*T+k*K),VG=-(J*a-R*T+k*s),WG=+(J*M-R*K+d*s);return V[0]=n*f,V[1]=Q*f,V[2]=o*f,V[3]=O*f,V[4]=D*f,V[5]=Z*f,V[6]=c*f,V[7]=GG*f,V[8]=i*f,V[9]=E*f,V[10]=j*f,V[11]=VG*f,V[12]=e*f,V[13]=h*f,V[14]=I*f,V[15]=WG*f,!0}P._UpdateFlagSeed=0;const L=G=>parseInt(G.toString().replace(/\W/g,""));class t{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=G,this.y=V}toString(){return`{X: ${this.x} Y: ${this.y}}`}getClassName(){return"Vector2"}getHashCode(){let G=L(this.x);return G=397*G^L(this.y),G}toArray(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return G[V]=this.x,G[V+1]=this.y,this}XW(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.FromArrayToRef(G,V,this),this}Bd(){return[this.x,this.y]}J(G){return this.x=G.x,this.y=G.y,this}rd(G,V){return this.x=G,this.y=V,this}set(G,V){return this.rd(G,V)}Ud(G){return this.rd(G,G)}add(G){return new t(this.x+G.x,this.y+G.y)}addToRef(G,V){return V.x=this.x+G.x,V.y=this.y+G.y,V}addInPlace(G){return this.x+=G.x,this.y+=G.y,this}addInPlaceFromFloats(G,V){return this.x+=G,this.y+=V,this}addVector3(G){return new t(this.x+G.x,this.y+G.y)}zW(G){return new t(this.x-G.x,this.y-G.y)}subtractToRef(G,V){return V.x=this.x-G.x,V.y=this.y-G.y,V}FA(G){return this.x-=G.x,this.y-=G.y,this}multiplyInPlace(G){return this.x*=G.x,this.y*=G.y,this}multiply(G){return new t(this.x*G.x,this.y*G.y)}multiplyToRef(G,V){return V.x=this.x*G.x,V.y=this.y*G.y,V}multiplyByFloats(G,V){return new t(this.x*G,this.y*V)}divide(G){return new t(this.x/G.x,this.y/G.y)}divideToRef(G,V){return V.x=this.x/G.x,V.y=this.y/G.y,V}divideInPlace(G){return this.x=this.x/G.x,this.y=this.y/G.y,this}minimizeInPlace(G){return this.minimizeInPlaceFromFloats(G.x,G.y)}maximizeInPlace(G){return this.maximizeInPlaceFromFloats(G.x,G.y)}minimizeInPlaceFromFloats(G,V){return this.x=Math.min(G,this.x),this.y=Math.min(V,this.y),this}maximizeInPlaceFromFloats(G,V){return this.x=Math.max(G,this.x),this.y=Math.max(V,this.y),this}subtractFromFloats(G,V){return new t(this.x-G,this.y-V)}subtractFromFloatsToRef(G,V,W){return W.x=this.x-G,W.y=this.y-V,W}negate(){return new t(-this.x,-this.y)}negateInPlace(){return this.x*=-1,this.y*=-1,this}negateToRef(G){return G.x=-this.x,G.y=-this.y,G}scaleInPlace(G){return this.x*=G,this.y*=G,this}scale(G){return new t(this.x*G,this.y*G)}scaleToRef(G,V){return V.x=this.x*G,V.y=this.y*G,V}scaleAndAddToRef(G,V){return V.x+=this.x*G,V.y+=this.y*G,V}equals(G){return G&&this.x===G.x&&this.y===G.y}equalsWithEpsilon(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J.c;return G&&(0,X.WithinEpsilon)(this.x,G.x,V)&&(0,X.WithinEpsilon)(this.y,G.y,V)}equalsToFloats(G,V){return this.x===G&&this.y===V}floor(){return new t(Math.floor(this.x),Math.floor(this.y))}floorToRef(G){return G.x=Math.floor(this.x),G.y=Math.floor(this.y),G}fract(){return new t(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}fractToRef(G){return G.x=this.x-Math.floor(this.x),G.y=this.y-Math.floor(this.y),G}rotate(G){return this.rotateToRef(G,new t)}rotateToRef(G,V){const W=Math.cos(G),J=Math.sin(G);return V.x=W*this.x-J*this.y,V.y=J*this.x+W*this.y,V}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(G){return 0===G||1===G?this:this.scaleInPlace(1/G)}normalizeToNew(){const G=new t;return this.normalizeToRef(G),G}normalizeToRef(G){const V=this.length();return 0===V&&(G.x=this.x,G.y=this.y),this.scaleToRef(1/V,G)}clone(){return new t(this.x,this.y)}dot(G){return this.x*G.x+this.y*G.y}static Zero(){return new t(0,0)}static One(){return new t(1,1)}static Random(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new t((0,X.RandomRange)(G,V),(0,X.RandomRange)(G,V))}static RandomToRef(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).rd((0,X.RandomRange)(G,V),(0,X.RandomRange)(G,V))}static get ZeroReadOnly(){return t._ZeroReadOnly}static ld(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new t(G[V],G[V+1])}static FromArrayToRef(G,V,W){return W.x=G[V],W.y=G[V+1],W}static FromFloatsToRef(G,V,W){return W.rd(G,V),W}static CatmullRom(G,V,W,J,R){const d=R*R,k=R*d,z=.5*(2*V.x+(-G.x+W.x)*R+(2*G.x-5*V.x+4*W.x-J.x)*d+(-G.x+3*V.x-3*W.x+J.x)*k),X=.5*(2*V.y+(-G.y+W.y)*R+(2*G.y-5*V.y+4*W.y-J.y)*d+(-G.y+3*V.y-3*W.y+J.y)*k);return new t(z,X)}static ClampToRef(G,V,W,J){return J.x=(0,X.Clamp)(G.x,V.x,W.x),J.y=(0,X.Clamp)(G.y,V.y,W.y),J}static Clamp(G,V,W){const J=(0,X.Clamp)(G.x,V.x,W.x),R=(0,X.Clamp)(G.y,V.y,W.y);return new t(J,R)}static Hermite(G,V,W,J,R){const d=R*R,k=R*d,z=2*k-3*d+1,X=-2*k+3*d,P=k-2*d+R,A=k-d,x=G.x*z+W.x*X+V.x*P+J.x*A,q=G.y*z+W.y*X+V.y*P+J.y*A;return new t(x,q)}static Hermite1stDerivative(G,V,W,J,R){return this.Hermite1stDerivativeToRef(G,V,W,J,R,new t)}static Hermite1stDerivativeToRef(G,V,W,J,R,d){const k=R*R;return d.x=6*(k-R)*G.x+(3*k-4*R+1)*V.x+6*(-k+R)*W.x+(3*k-2*R)*J.x,d.y=6*(k-R)*G.y+(3*k-4*R+1)*V.y+6*(-k+R)*W.y+(3*k-2*R)*J.y,d}static Lerp(G,V,W){return t.LerpToRef(G,V,W,new t)}static LerpToRef(G,V,W,J){return J.x=G.x+(V.x-G.x)*W,J.y=G.y+(V.y-G.y)*W,J}static Dot(G,V){return G.x*V.x+G.y*V.y}static Normalize(G){return t.NormalizeToRef(G,new t)}static NormalizeToRef(G,V){return G.normalizeToRef(V),V}static Minimize(G,V){const W=G.x<V.x?G.x:V.x,J=G.y<V.y?G.y:V.y;return new t(W,J)}static Maximize(G,V){const W=G.x>V.x?G.x:V.x,J=G.y>V.y?G.y:V.y;return new t(W,J)}static Transform(G,V){return t.TransformToRef(G,V,new t)}static TransformToRef(G,V,W){const J=V.m,R=G.x*J[0]+G.y*J[4]+J[12],d=G.x*J[1]+G.y*J[5]+J[13];return W.x=R,W.y=d,W}static PointInTriangle(G,V,W,J){const R=.5*(-W.y*J.x+V.y*(-W.x+J.x)+V.x*(W.y-J.y)+W.x*J.y),d=R<0?-1:1,k=(V.y*J.x-V.x*J.y+(J.y-V.y)*G.x+(V.x-J.x)*G.y)*d,z=(V.x*W.y-V.y*W.x+(V.y-W.y)*G.x+(W.x-V.x)*G.y)*d;return k>0&&z>0&&k+z<2*R*d}static Distance(G,V){return Math.sqrt(t.DistanceSquared(G,V))}static DistanceSquared(G,V){const W=G.x-V.x,J=G.y-V.y;return W*W+J*J}static Center(G,V){return t.CenterToRef(G,V,new t)}static CenterToRef(G,V,W){return W.rd((G.x+V.x)/2,(G.y+V.y)/2)}static DistanceOfPointFromSegment(G,V,W){const J=t.DistanceSquared(V,W);if(0===J)return t.Distance(G,V);const R=W.zW(V),d=Math.max(0,Math.min(1,t.Dot(G.zW(V),R)/J)),k=V.add(R.multiplyByFloats(d,d));return t.Distance(G,k)}}t._V8PerformanceHack=new t(.5,.5),t._ZeroReadOnly=t.Zero(),Object.defineProperties(t.prototype,{dimension:{value:[2]},rank:{value:1}});class Y{get x(){return this._x}set x(G){this._x=G,this._isDirty=!0}get y(){return this._y}set y(G){this._y=G,this._isDirty=!0}get z(){return this._z}set z(G){this._z=G,this._isDirty=!0}constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._isDirty=!0,this._x=G,this._y=V,this._z=W}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z}}`}getClassName(){return"ed"}getHashCode(){let G=L(this._x);return G=397*G^L(this._y),G=397*G^L(this._z),G}Bd(){return[this._x,this._y,this._z]}toArray(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return G[V]=this._x,G[V+1]=this._y,G[V+2]=this._z,this}XW(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Y.FromArrayToRef(G,V,this),this}toQuaternion(){return B.RotationYawPitchRoll(this._y,this._x,this._z)}addInPlace(G){return this._x+=G._x,this._y+=G._y,this._z+=G._z,this._isDirty=!0,this}addInPlaceFromFloats(G,V,W){return this._x+=G,this._y+=V,this._z+=W,this._isDirty=!0,this}add(G){return new Y(this._x+G._x,this._y+G._y,this._z+G._z)}addToRef(G,V){return V._x=this._x+G._x,V._y=this._y+G._y,V._z=this._z+G._z,V._isDirty=!0,V}FA(G){return this._x-=G._x,this._y-=G._y,this._z-=G._z,this._isDirty=!0,this}zW(G){return new Y(this._x-G._x,this._y-G._y,this._z-G._z)}subtractToRef(G,V){return this.subtractFromFloatsToRef(G._x,G._y,G._z,V)}subtractFromFloats(G,V,W){return new Y(this._x-G,this._y-V,this._z-W)}subtractFromFloatsToRef(G,V,W,J){return J._x=this._x-G,J._y=this._y-V,J._z=this._z-W,J._isDirty=!0,J}negate(){return new Y(-this._x,-this._y,-this._z)}negateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}negateToRef(G){return G._x=-1*this._x,G._y=-1*this._y,G._z=-1*this._z,G._isDirty=!0,G}scaleInPlace(G){return this._x*=G,this._y*=G,this._z*=G,this._isDirty=!0,this}scale(G){return new Y(this._x*G,this._y*G,this._z*G)}scaleToRef(G,V){return V._x=this._x*G,V._y=this._y*G,V._z=this._z*G,V._isDirty=!0,V}getNormalToRef(G){const V=this.length();let W=Math.acos(this._y/V);const J=Math.atan2(this._z,this._x);W>Math.PI/2?W-=Math.PI/2:W+=Math.PI/2;const R=V*Math.sin(W)*Math.cos(J),d=V*Math.cos(W),k=V*Math.sin(W)*Math.sin(J);return G.set(R,d,k),G}applyRotationQuaternionToRef(G,V){const W=this._x,J=this._y,R=this._z,d=G._x,k=G._y,z=G._z,X=G._w,P=2*(k*R-z*J),A=2*(z*W-d*R),x=2*(d*J-k*W);return V._x=W+X*P+k*x-z*A,V._y=J+X*A+z*P-d*x,V._z=R+X*x+d*A-k*P,V._isDirty=!0,V}applyRotationQuaternionInPlace(G){return this.applyRotationQuaternionToRef(G,this)}applyRotationQuaternion(G){return this.applyRotationQuaternionToRef(G,new Y)}scaleAndAddToRef(G,V){return V._x+=this._x*G,V._y+=this._y*G,V._z+=this._z*G,V._isDirty=!0,V}projectOnPlane(G,V){return this.projectOnPlaneToRef(G,V,new Y)}projectOnPlaneToRef(G,V,W){const J=G.IV,R=G.d,d=p.ed[0];this.subtractToRef(V,d),d.normalize();const k=Y.Dot(d,J);if(Math.abs(k)<1e-10)W.Ud(1/0);else{const G=-(Y.Dot(V,J)+R)/k,z=d.scaleInPlace(G);V.addToRef(z,W)}return W}equals(G){return G&&this._x===G._x&&this._y===G._y&&this._z===G._z}equalsWithEpsilon(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J.c;return G&&(0,X.WithinEpsilon)(this._x,G._x,V)&&(0,X.WithinEpsilon)(this._y,G._y,V)&&(0,X.WithinEpsilon)(this._z,G._z,V)}equalsToFloats(G,V,W){return this._x===G&&this._y===V&&this._z===W}multiplyInPlace(G){return this._x*=G._x,this._y*=G._y,this._z*=G._z,this._isDirty=!0,this}multiply(G){return this.multiplyByFloats(G._x,G._y,G._z)}multiplyToRef(G,V){return V._x=this._x*G._x,V._y=this._y*G._y,V._z=this._z*G._z,V._isDirty=!0,V}multiplyByFloats(G,V,W){return new Y(this._x*G,this._y*V,this._z*W)}divide(G){return new Y(this._x/G._x,this._y/G._y,this._z/G._z)}divideToRef(G,V){return V._x=this._x/G._x,V._y=this._y/G._y,V._z=this._z/G._z,V._isDirty=!0,V}divideInPlace(G){return this._x=this._x/G._x,this._y=this._y/G._y,this._z=this._z/G._z,this._isDirty=!0,this}minimizeInPlace(G){return this.minimizeInPlaceFromFloats(G._x,G._y,G._z)}maximizeInPlace(G){return this.maximizeInPlaceFromFloats(G._x,G._y,G._z)}minimizeInPlaceFromFloats(G,V,W){return G<this._x&&(this.x=G),V<this._y&&(this.y=V),W<this._z&&(this.z=W),this}maximizeInPlaceFromFloats(G,V,W){return G>this._x&&(this.x=G),V>this._y&&(this.y=V),W>this._z&&(this.z=W),this}isNonUniformWithinEpsilon(G){const V=Math.abs(this._x),W=Math.abs(this._y);if(!(0,X.WithinEpsilon)(V,W,G))return!0;const J=Math.abs(this._z);return!(0,X.WithinEpsilon)(V,J,G)||!(0,X.WithinEpsilon)(W,J,G)}get isNonUniform(){const G=Math.abs(this._x);if(G!==Math.abs(this._y))return!0;return G!==Math.abs(this._z)}floorToRef(G){return G._x=Math.floor(this._x),G._y=Math.floor(this._y),G._z=Math.floor(this._z),G._isDirty=!0,G}floor(){return new Y(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))}fractToRef(G){return G._x=this._x-Math.floor(this._x),G._y=this._y-Math.floor(this._y),G._z=this._z-Math.floor(this._z),G._isDirty=!0,G}fract(){return new Y(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z))}length(){return Math.sqrt(this.lengthSquared())}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z}get hasAZeroComponent(){return this._x*this._y*this._z===0}normalize(){return this.normalizeFromLength(this.length())}reorderInPlace(G){if("xyz"===(G=G.toLowerCase()))return this;const V=p.ed[0].J(this);return this.x=V[G[0]],this.y=V[G[1]],this.z=V[G[2]],this}rotateByQuaternionToRef(G,V){return G.toRotationMatrix(p.Matrix[0]),Y.TransformCoordinatesToRef(this,p.Matrix[0],V),V}rotateByQuaternionAroundPointToRef(G,V,W){return this.subtractToRef(V,p.ed[0]),p.ed[0].rotateByQuaternionToRef(G,p.ed[0]),V.addToRef(p.ed[0],W),W}cross(G){return Y.CrossToRef(this,G,new Y)}normalizeFromLength(G){return 0===G||1===G?this:this.scaleInPlace(1/G)}normalizeToNew(){return this.normalizeToRef(new Y)}normalizeToRef(G){const V=this.length();return 0===V||1===V?(G._x=this._x,G._y=this._y,G._z=this._z,G._isDirty=!0,G):this.scaleToRef(1/V,G)}clone(){return new Y(this._x,this._y,this._z)}J(G){return this.rd(G._x,G._y,G._z)}rd(G,V,W){return this._x=G,this._y=V,this._z=W,this._isDirty=!0,this}set(G,V,W){return this.rd(G,V,W)}Ud(G){return this._x=this._y=this._z=G,this._isDirty=!0,this}static GetClipFactor(G,V,W,J){const R=Y.Dot(G,W);return(R-J)/(R-Y.Dot(V,W))}static GetAngleBetweenVectors(G,V,W){const J=G.normalizeToRef(p.ed[1]),R=V.normalizeToRef(p.ed[2]);let d=Y.Dot(J,R);d=(0,X.Clamp)(d,-1,1);const k=Math.acos(d),z=p.ed[3];return Y.CrossToRef(J,R,z),Y.Dot(z,W)>0?isNaN(k)?0:k:isNaN(k)?-Math.PI:-Math.acos(d)}static GetAngleBetweenVectorsOnPlane(G,V,W){p.ed[0].J(G);const J=p.ed[0];p.ed[1].J(V);const R=p.ed[1];p.ed[2].J(W);const d=p.ed[2],k=p.ed[3],z=p.ed[4];J.normalize(),R.normalize(),d.normalize(),Y.CrossToRef(d,J,k),Y.CrossToRef(k,d,z);const P=Math.atan2(Y.Dot(R,k),Y.Dot(R,z));return(0,X.NormalizeRadians)(P)}static PitchYawRollToMoveBetweenPointsToRef(G,V,W){const J=b.ed[0];return V.subtractToRef(G,J),W._y=Math.atan2(J.x,J.z)||0,W._x=Math.atan2(Math.sqrt(J.x**2+J.z**2),J.y)||0,W._z=0,W._isDirty=!0,W}static PitchYawRollToMoveBetweenPoints(G,V){const W=Y.Zero();return Y.PitchYawRollToMoveBetweenPointsToRef(G,V,W)}static SlerpToRef(G,V,W,R){W=(0,X.Clamp)(W,0,1);const d=p.ed[0],k=p.ed[1];d.J(G);const z=d.length();d.normalizeFromLength(z),k.J(V);const P=k.length();k.normalizeFromLength(P);const A=Y.Dot(d,k);let x,q;if(A<1-J.c){const G=Math.acos(A),V=1/Math.sin(G);x=Math.sin((1-W)*G)*V,q=Math.sin(W*G)*V}else x=1-W,q=W;return d.scaleInPlace(x),k.scaleInPlace(q),R.J(d).addInPlace(k),R.scaleInPlace((0,X.Lerp)(z,P,W)),R}static SmoothToRef(G,V,W,J,R){return Y.SlerpToRef(G,V,0===J?1:W/J,R),R}static ld(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new Y(G[V],G[V+1],G[V+2])}static FromFloatArray(G,V){return Y.ld(G,V)}static FromArrayToRef(G,V,W){return W._x=G[V],W._y=G[V+1],W._z=G[V+2],W._isDirty=!0,W}static FromFloatArrayToRef(G,V,W){return Y.FromArrayToRef(G,V,W)}static FromFloatsToRef(G,V,W,J){return J.rd(G,V,W),J}static Zero(){return new Y(0,0,0)}static One(){return new Y(1,1,1)}static Up(){return new Y(0,1,0)}static get UpReadOnly(){return Y._UpReadOnly}static get DownReadOnly(){return Y._DownReadOnly}static get RightReadOnly(){return Y._RightReadOnly}static get LeftReadOnly(){return Y._LeftReadOnly}static get LeftHandedForwardReadOnly(){return Y._LeftHandedForwardReadOnly}static get RightHandedForwardReadOnly(){return Y._RightHandedForwardReadOnly}static get LeftHandedBackwardReadOnly(){return Y._LeftHandedBackwardReadOnly}static get RightHandedBackwardReadOnly(){return Y._RightHandedBackwardReadOnly}static get ZeroReadOnly(){return Y._ZeroReadOnly}static get OneReadOnly(){return Y._OneReadOnly}static Down(){return new Y(0,-1,0)}static Forward(){return new Y(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?-1:1)}static Backward(){return new Y(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?1:-1)}static Right(){return new Y(1,0,0)}static Left(){return new Y(-1,0,0)}static Random(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new Y((0,X.RandomRange)(G,V),(0,X.RandomRange)(G,V),(0,X.RandomRange)(G,V))}static RandomToRef(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).rd((0,X.RandomRange)(G,V),(0,X.RandomRange)(G,V),(0,X.RandomRange)(G,V))}static TransformCoordinates(G,V){const W=Y.Zero();return Y.TransformCoordinatesToRef(G,V,W),W}static TransformCoordinatesToRef(G,V,W){return Y.TransformCoordinatesFromFloatsToRef(G._x,G._y,G._z,V,W),W}static TransformCoordinatesFromFloatsToRef(G,V,W,J,R){const d=J.m,k=G*d[0]+V*d[4]+W*d[8]+d[12],z=G*d[1]+V*d[5]+W*d[9]+d[13],X=G*d[2]+V*d[6]+W*d[10]+d[14],P=1/(G*d[3]+V*d[7]+W*d[11]+d[15]);return R._x=k*P,R._y=z*P,R._z=X*P,R._isDirty=!0,R}static TransformNormal(G,V){const W=Y.Zero();return Y.TransformNormalToRef(G,V,W),W}static TransformNormalToRef(G,V,W){return this.TransformNormalFromFloatsToRef(G._x,G._y,G._z,V,W),W}static TransformNormalFromFloatsToRef(G,V,W,J,R){const d=J.m;return R._x=G*d[0]+V*d[4]+W*d[8],R._y=G*d[1]+V*d[5]+W*d[9],R._z=G*d[2]+V*d[6]+W*d[10],R._isDirty=!0,R}static CatmullRom(G,V,W,J,R){const d=R*R,k=R*d,z=.5*(2*V._x+(-G._x+W._x)*R+(2*G._x-5*V._x+4*W._x-J._x)*d+(-G._x+3*V._x-3*W._x+J._x)*k),X=.5*(2*V._y+(-G._y+W._y)*R+(2*G._y-5*V._y+4*W._y-J._y)*d+(-G._y+3*V._y-3*W._y+J._y)*k),P=.5*(2*V._z+(-G._z+W._z)*R+(2*G._z-5*V._z+4*W._z-J._z)*d+(-G._z+3*V._z-3*W._z+J._z)*k);return new Y(z,X,P)}static Clamp(G,V,W){const J=new Y;return Y.ClampToRef(G,V,W,J),J}static ClampToRef(G,V,W,J){let R=G._x;R=R>W._x?W._x:R,R=R<V._x?V._x:R;let d=G._y;d=d>W._y?W._y:d,d=d<V._y?V._y:d;let k=G._z;return k=k>W._z?W._z:k,k=k<V._z?V._z:k,J.rd(R,d,k),J}static CheckExtends(G,V,W){V.minimizeInPlace(G),W.maximizeInPlace(G)}static Hermite(G,V,W,J,R){const d=R*R,k=R*d,z=2*k-3*d+1,X=-2*k+3*d,P=k-2*d+R,A=k-d,x=G._x*z+W._x*X+V._x*P+J._x*A,q=G._y*z+W._y*X+V._y*P+J._y*A,L=G._z*z+W._z*X+V._z*P+J._z*A;return new Y(x,q,L)}static Hermite1stDerivative(G,V,W,J,R){const d=new Y;return this.Hermite1stDerivativeToRef(G,V,W,J,R,d),d}static Hermite1stDerivativeToRef(G,V,W,J,R,d){const k=R*R;return d._x=6*(k-R)*G._x+(3*k-4*R+1)*V._x+6*(-k+R)*W._x+(3*k-2*R)*J._x,d._y=6*(k-R)*G._y+(3*k-4*R+1)*V._y+6*(-k+R)*W._y+(3*k-2*R)*J._y,d._z=6*(k-R)*G._z+(3*k-4*R+1)*V._z+6*(-k+R)*W._z+(3*k-2*R)*J._z,d._isDirty=!0,d}static Lerp(G,V,W){const J=new Y(0,0,0);return Y.LerpToRef(G,V,W,J),J}static LerpToRef(G,V,W,J){return J._x=G._x+(V._x-G._x)*W,J._y=G._y+(V._y-G._y)*W,J._z=G._z+(V._z-G._z)*W,J._isDirty=!0,J}static Dot(G,V){return G._x*V._x+G._y*V._y+G._z*V._z}dot(G){return this._x*G._x+this._y*G._y+this._z*G._z}static Cross(G,V){const W=new Y;return Y.CrossToRef(G,V,W),W}static CrossToRef(G,V,W){const J=G._y*V._z-G._z*V._y,R=G._z*V._x-G._x*V._z,d=G._x*V._y-G._y*V._x;return W.rd(J,R,d),W}static Normalize(G){const V=Y.Zero();return Y.NormalizeToRef(G,V),V}static NormalizeToRef(G,V){return G.normalizeToRef(V),V}static Project(G,V,W,J){const R=new Y;return Y.ProjectToRef(G,V,W,J,R),R}static ProjectToRef(G,V,W,J,R){var d;const k=J.width,X=J.height,P=J.x,A=J.y,x=p.Matrix[1],q=null===(d=z.c.LastCreatedEngine)||void 0===d?void 0:d.isNDCHalfZRange,L=q?1:.5,t=q?0:.5;S.FromValuesToRef(k/2,0,0,0,0,-X/2,0,0,0,0,L,0,P+k/2,X/2+A,t,1,x);const g=p.Matrix[0];return V.multiplyToRef(W,g),g.multiplyToRef(x,g),Y.TransformCoordinatesToRef(G,g,R),R}static Reflect(G,V){return this.ReflectToRef(G,V,new Y)}static ReflectToRef(G,V,W){const J=b.ed[0];return J.J(V).scaleInPlace(2*Y.Dot(G,V)),W.J(G).FA(J)}static _UnprojectFromInvertedMatrixToRef(G,V,W){Y.TransformCoordinatesToRef(G,V,W);const J=V.m,R=G._x*J[3]+G._y*J[7]+G._z*J[11]+J[15];return(0,X.WithinEpsilon)(R,1)&&W.scaleInPlace(1/R),W}static UnprojectFromTransform(G,V,W,J,R){return this.Unproject(G,V,W,J,R,S.IdentityReadOnly)}static Unproject(G,V,W,J,R,d){const k=new Y;return Y.UnprojectToRef(G,V,W,J,R,d,k),k}static UnprojectToRef(G,V,W,J,R,d,k){return Y.UnprojectFloatsToRef(G._x,G._y,G._z,V,W,J,R,d,k),k}static UnprojectFloatsToRef(G,V,W,J,R,d,k,X,P){var A;const x=p.Matrix[0];d.multiplyToRef(k,x),x.multiplyToRef(X,x),x.invert();const q=p.ed[0];return q.x=G/J*2-1,q.y=-(V/R*2-1),null!==(A=z.c.LastCreatedEngine)&&void 0!==A&&A.isNDCHalfZRange?q.z=W:q.z=2*W-1,Y._UnprojectFromInvertedMatrixToRef(q,x,P),P}static Minimize(G,V){const W=new Y;return W.J(G),W.minimizeInPlace(V),W}static Maximize(G,V){const W=new Y;return W.J(G),W.maximizeInPlace(V),W}static Distance(G,V){return Math.sqrt(Y.DistanceSquared(G,V))}static DistanceSquared(G,V){const W=G._x-V._x,J=G._y-V._y,R=G._z-V._z;return W*W+J*J+R*R}static ProjectOnTriangleToRef(G,V,W,R,d){const k=p.ed[0],z=p.ed[1],P=p.ed[2],A=p.ed[3],x=p.ed[4];W.subtractToRef(V,k),R.subtractToRef(V,z),R.subtractToRef(W,P);const q=k.length(),L=z.length(),t=P.length();if(q<J.c||L<J.c||t<J.c)return d.J(V),Y.Distance(G,V);G.subtractToRef(V,x),Y.CrossToRef(k,z,A);const g=A.length();if(g<J.c)return d.J(V),Y.Distance(G,V);A.normalizeFromLength(g);let B=x.length();if(B<J.c)return d.J(V),0;x.normalizeFromLength(B);const S=Y.Dot(A,x),b=p.ed[5],r=p.ed[6];b.J(A).scaleInPlace(-B*S),r.J(G).addInPlace(b);const y=p.ed[4],u=p.ed[5],H=p.ed[7],n=p.ed[8];y.J(k).scaleInPlace(1/q),n.J(z).scaleInPlace(1/L),y.addInPlace(n).scaleInPlace(-1),u.J(k).scaleInPlace(-1/q),n.J(P).scaleInPlace(1/t),u.addInPlace(n).scaleInPlace(-1),H.J(P).scaleInPlace(-1/t),n.J(z).scaleInPlace(-1/L),H.addInPlace(n).scaleInPlace(-1);const D=p.ed[9];let i;D.J(r).FA(V),Y.CrossToRef(y,D,n),i=Y.Dot(n,A);const e=i;D.J(r).FA(W),Y.CrossToRef(u,D,n),i=Y.Dot(n,A);const F=i;D.J(r).FA(R),Y.CrossToRef(H,D,n),i=Y.Dot(n,A);const f=i,v=p.ed[10];let C,l;e>0&&F<0?(v.J(k),C=V,l=W):F>0&&f<0?(v.J(P),C=W,l=R):(v.J(z).scaleInPlace(-1),C=R,l=V);const m=p.ed[9],w=p.ed[4];C.subtractToRef(r,n),l.subtractToRef(r,m),Y.CrossToRef(n,m,w);if(!(Y.Dot(w,A)<0))return d.J(r),Math.abs(B*S);const N=p.ed[5];Y.CrossToRef(v,w,N),N.normalize();const U=p.ed[9];U.J(C).FA(r);const a=U.length();if(a<J.c)return d.J(C),Y.Distance(G,C);U.normalizeFromLength(a);const M=Y.Dot(N,U),T=p.ed[7];T.J(r).addInPlace(N.scaleInPlace(a*M)),n.J(T).FA(C),B=v.length(),v.normalizeFromLength(B);let K=Y.Dot(n,v)/Math.max(B,J.c);return K=(0,X.Clamp)(K,0,1),T.J(C).addInPlace(v.scaleInPlace(K*B)),d.J(T),Y.Distance(G,T)}static Center(G,V){return Y.CenterToRef(G,V,Y.Zero())}static CenterToRef(G,V,W){return W.rd((G._x+V._x)/2,(G._y+V._y)/2,(G._z+V._z)/2)}static RotationFromAxis(G,V,W){const J=new Y;return Y.RotationFromAxisToRef(G,V,W,J),J}static RotationFromAxisToRef(G,V,W,J){const R=p.Quaternion[0];return B.RotationQuaternionFromAxisToRef(G,V,W,R),R.toEulerAnglesToRef(J),J}}Y._V8PerformanceHack=new Y(.5,.5,.5),Y._UpReadOnly=Y.Up(),Y._DownReadOnly=Y.Down(),Y._LeftHandedForwardReadOnly=Y.Forward(!1),Y._RightHandedForwardReadOnly=Y.Forward(!0),Y._LeftHandedBackwardReadOnly=Y.Backward(!1),Y._RightHandedBackwardReadOnly=Y.Backward(!0),Y._RightReadOnly=Y.Right(),Y._LeftReadOnly=Y.Left(),Y._ZeroReadOnly=Y.Zero(),Y._OneReadOnly=Y.One(),Object.defineProperties(Y.prototype,{dimension:{value:[3]},rank:{value:1}});class g{get x(){return this._x}set x(G){this._x=G,this._isDirty=!0}get y(){return this._y}set y(G){this._y=G,this._isDirty=!0}get z(){return this._z}set z(G){this._z=G,this._isDirty=!0}get w(){return this._w}set w(G){this._w=G,this._isDirty=!0}constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._isDirty=!0,this._x=G,this._y=V,this._z=W,this._w=J}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Vector4"}getHashCode(){let G=L(this._x);return G=397*G^L(this._y),G=397*G^L(this._z),G=397*G^L(this._w),G}Bd(){return[this._x,this._y,this._z,this._w]}toArray(G,V){return void 0===V&&(V=0),G[V]=this._x,G[V+1]=this._y,G[V+2]=this._z,G[V+3]=this._w,this}XW(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return g.FromArrayToRef(G,V,this),this}addInPlace(G){return this.x+=G._x,this.y+=G._y,this.z+=G._z,this.w+=G._w,this}addInPlaceFromFloats(G,V,W,J){return this.x+=G,this.y+=V,this.z+=W,this.w+=J,this}add(G){return new g(this._x+G.x,this._y+G.y,this._z+G.z,this._w+G.w)}addToRef(G,V){return V.x=this._x+G.x,V.y=this._y+G.y,V.z=this._z+G.z,V.w=this._w+G.w,V}FA(G){return this.x-=G.x,this.y-=G.y,this.z-=G.z,this.w-=G.w,this}zW(G){return new g(this._x-G.x,this._y-G.y,this._z-G.z,this._w-G.w)}subtractToRef(G,V){return V.x=this._x-G.x,V.y=this._y-G.y,V.z=this._z-G.z,V.w=this._w-G.w,V}subtractFromFloats(G,V,W,J){return new g(this._x-G,this._y-V,this._z-W,this._w-J)}subtractFromFloatsToRef(G,V,W,J,R){return R.x=this._x-G,R.y=this._y-V,R.z=this._z-W,R.w=this._w-J,R}negate(){return new g(-this._x,-this._y,-this._z,-this._w)}negateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}negateToRef(G){return G.x=-this._x,G.y=-this._y,G.z=-this._z,G.w=-this._w,G}scaleInPlace(G){return this.x*=G,this.y*=G,this.z*=G,this.w*=G,this}scale(G){return new g(this._x*G,this._y*G,this._z*G,this._w*G)}scaleToRef(G,V){return V.x=this._x*G,V.y=this._y*G,V.z=this._z*G,V.w=this._w*G,V}scaleAndAddToRef(G,V){return V.x+=this._x*G,V.y+=this._y*G,V.z+=this._z*G,V.w+=this._w*G,V}equals(G){return G&&this._x===G.x&&this._y===G.y&&this._z===G.z&&this._w===G.w}equalsWithEpsilon(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J.c;return G&&(0,X.WithinEpsilon)(this._x,G.x,V)&&(0,X.WithinEpsilon)(this._y,G.y,V)&&(0,X.WithinEpsilon)(this._z,G.z,V)&&(0,X.WithinEpsilon)(this._w,G.w,V)}equalsToFloats(G,V,W,J){return this._x===G&&this._y===V&&this._z===W&&this._w===J}multiplyInPlace(G){return this.x*=G.x,this.y*=G.y,this.z*=G.z,this.w*=G.w,this}multiply(G){return new g(this._x*G.x,this._y*G.y,this._z*G.z,this._w*G.w)}multiplyToRef(G,V){return V.x=this._x*G.x,V.y=this._y*G.y,V.z=this._z*G.z,V.w=this._w*G.w,V}multiplyByFloats(G,V,W,J){return new g(this._x*G,this._y*V,this._z*W,this._w*J)}divide(G){return new g(this._x/G.x,this._y/G.y,this._z/G.z,this._w/G.w)}divideToRef(G,V){return V.x=this._x/G.x,V.y=this._y/G.y,V.z=this._z/G.z,V.w=this._w/G.w,V}divideInPlace(G){return this.divideToRef(G,this)}minimizeInPlace(G){return G.x<this._x&&(this.x=G.x),G.y<this._y&&(this.y=G.y),G.z<this._z&&(this.z=G.z),G.w<this._w&&(this.w=G.w),this}maximizeInPlace(G){return G.x>this._x&&(this.x=G.x),G.y>this._y&&(this.y=G.y),G.z>this._z&&(this.z=G.z),G.w>this._w&&(this.w=G.w),this}minimizeInPlaceFromFloats(G,V,W,J){return this.x=Math.min(G,this._x),this.y=Math.min(V,this._y),this.z=Math.min(W,this._z),this.w=Math.min(J,this._w),this}maximizeInPlaceFromFloats(G,V,W,J){return this.x=Math.max(G,this._x),this.y=Math.max(V,this._y),this.z=Math.max(W,this._z),this.w=Math.max(J,this._w),this}floorToRef(G){return G.x=Math.floor(this._x),G.y=Math.floor(this._y),G.z=Math.floor(this._z),G.w=Math.floor(this._w),G}floor(){return new g(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z),Math.floor(this._w))}fractToRef(G){return G.x=this._x-Math.floor(this._x),G.y=this._y-Math.floor(this._y),G.z=this._z-Math.floor(this._z),G.w=this._w-Math.floor(this._w),G}fract(){return new g(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z),this._w-Math.floor(this._w))}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(G){return 0===G||1===G?this:this.scaleInPlace(1/G)}normalizeToNew(){return this.normalizeToRef(new g)}normalizeToRef(G){const V=this.length();return 0===V||1===V?(G.x=this._x,G.y=this._y,G.z=this._z,G.w=this._w,G):this.scaleToRef(1/V,G)}toVector3(){return new Y(this._x,this._y,this._z)}clone(){return new g(this._x,this._y,this._z,this._w)}J(G){return this.x=G.x,this.y=G.y,this.z=G.z,this.w=G.w,this}rd(G,V,W,J){return this.x=G,this.y=V,this.z=W,this.w=J,this}set(G,V,W,J){return this.rd(G,V,W,J)}Ud(G){return this.x=this.y=this.z=this.w=G,this}dot(G){return this._x*G.x+this._y*G.y+this._z*G.z+this._w*G.w}static ld(G,V){return V||(V=0),new g(G[V],G[V+1],G[V+2],G[V+3])}static FromArrayToRef(G,V,W){return W.x=G[V],W.y=G[V+1],W.z=G[V+2],W.w=G[V+3],W}static FromFloatArrayToRef(G,V,W){return g.FromArrayToRef(G,V,W),W}static FromFloatsToRef(G,V,W,J,R){return R.x=G,R.y=V,R.z=W,R.w=J,R}static Zero(){return new g(0,0,0,0)}static One(){return new g(1,1,1,1)}static Random(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new g((0,X.RandomRange)(G,V),(0,X.RandomRange)(G,V),(0,X.RandomRange)(G,V),(0,X.RandomRange)(G,V))}static RandomToRef(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,W=arguments.length>2?arguments[2]:void 0;return W.x=(0,X.RandomRange)(G,V),W.y=(0,X.RandomRange)(G,V),W.z=(0,X.RandomRange)(G,V),W.w=(0,X.RandomRange)(G,V),W}static Clamp(G,V,W){return g.ClampToRef(G,V,W,new g)}static ClampToRef(G,V,W,J){return J.x=(0,X.Clamp)(G.x,V.x,W.x),J.y=(0,X.Clamp)(G.y,V.y,W.y),J.z=(0,X.Clamp)(G.z,V.z,W.z),J.w=(0,X.Clamp)(G.w,V.w,W.w),J}static CheckExtends(G,V,W){V.minimizeInPlace(G),W.maximizeInPlace(G)}static get ZeroReadOnly(){return g._ZeroReadOnly}static Normalize(G){return g.NormalizeToRef(G,new g)}static NormalizeToRef(G,V){return G.normalizeToRef(V),V}static Minimize(G,V){const W=new g;return W.J(G),W.minimizeInPlace(V),W}static Maximize(G,V){const W=new g;return W.J(G),W.maximizeInPlace(V),W}static Distance(G,V){return Math.sqrt(g.DistanceSquared(G,V))}static DistanceSquared(G,V){const W=G.x-V.x,J=G.y-V.y,R=G.z-V.z,d=G.w-V.w;return W*W+J*J+R*R+d*d}static Center(G,V){return g.CenterToRef(G,V,new g)}static CenterToRef(G,V,W){return W.x=(G.x+V.x)/2,W.y=(G.y+V.y)/2,W.z=(G.z+V.z)/2,W.w=(G.w+V.w)/2,W}static TransformCoordinates(G,V){return g.TransformCoordinatesToRef(G,V,new g)}static TransformCoordinatesToRef(G,V,W){return g.TransformCoordinatesFromFloatsToRef(G._x,G._y,G._z,V,W),W}static TransformCoordinatesFromFloatsToRef(G,V,W,J,R){const d=J.m,k=G*d[0]+V*d[4]+W*d[8]+d[12],z=G*d[1]+V*d[5]+W*d[9]+d[13],X=G*d[2]+V*d[6]+W*d[10]+d[14],P=G*d[3]+V*d[7]+W*d[11]+d[15];return R.x=k,R.y=z,R.z=X,R.w=P,R}static TransformNormal(G,V){return g.TransformNormalToRef(G,V,new g)}static TransformNormalToRef(G,V,W){const J=V.m,R=G.x*J[0]+G.y*J[4]+G.z*J[8],d=G.x*J[1]+G.y*J[5]+G.z*J[9],k=G.x*J[2]+G.y*J[6]+G.z*J[10];return W.x=R,W.y=d,W.z=k,W.w=G.w,W}static TransformNormalFromFloatsToRef(G,V,W,J,R,d){const k=R.m;return d.x=G*k[0]+V*k[4]+W*k[8],d.y=G*k[1]+V*k[5]+W*k[9],d.z=G*k[2]+V*k[6]+W*k[10],d.w=J,d}static FromVector3(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new g(G._x,G._y,G._z,V)}static Dot(G,V){return G.x*V.x+G.y*V.y+G.z*V.z+G.w*V.w}}g._V8PerformanceHack=new g(.5,.5,.5,.5),g._ZeroReadOnly=g.Zero(),Object.defineProperties(g.prototype,{dimension:{value:[4]},rank:{value:1}});class B{get x(){return this._x}set x(G){this._x=G,this._isDirty=!0}get y(){return this._y}set y(G){this._y=G,this._isDirty=!0}get z(){return this._z}set z(G){this._z=G,this._isDirty=!0}get w(){return this._w}set w(G){this._w=G,this._isDirty=!0}constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this._isDirty=!0,this._x=G,this._y=V,this._z=W,this._w=J}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Quaternion"}getHashCode(){let G=L(this._x);return G=397*G^L(this._y),G=397*G^L(this._z),G=397*G^L(this._w),G}Bd(){return[this._x,this._y,this._z,this._w]}toArray(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return G[V]=this._x,G[V+1]=this._y,G[V+2]=this._z,G[V+3]=this._w,this}XW(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return B.FromArrayToRef(G,V,this)}equals(G){return G&&this._x===G._x&&this._y===G._y&&this._z===G._z&&this._w===G._w}equalsWithEpsilon(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J.c;return G&&(0,X.WithinEpsilon)(this._x,G._x,V)&&(0,X.WithinEpsilon)(this._y,G._y,V)&&(0,X.WithinEpsilon)(this._z,G._z,V)&&(0,X.WithinEpsilon)(this._w,G._w,V)}isApprox(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J.c;return G&&((0,X.WithinEpsilon)(this._x,G._x,V)&&(0,X.WithinEpsilon)(this._y,G._y,V)&&(0,X.WithinEpsilon)(this._z,G._z,V)&&(0,X.WithinEpsilon)(this._w,G._w,V)||(0,X.WithinEpsilon)(this._x,-G._x,V)&&(0,X.WithinEpsilon)(this._y,-G._y,V)&&(0,X.WithinEpsilon)(this._z,-G._z,V)&&(0,X.WithinEpsilon)(this._w,-G._w,V))}clone(){return new B(this._x,this._y,this._z,this._w)}J(G){return this._x=G._x,this._y=G._y,this._z=G._z,this._w=G._w,this._isDirty=!0,this}rd(G,V,W,J){return this._x=G,this._y=V,this._z=W,this._w=J,this._isDirty=!0,this}set(G,V,W,J){return this.rd(G,V,W,J)}Ud(G){return this.rd(G,G,G,G)}add(G){return new B(this._x+G._x,this._y+G._y,this._z+G._z,this._w+G._w)}addInPlace(G){return this._x+=G._x,this._y+=G._y,this._z+=G._z,this._w+=G._w,this._isDirty=!0,this}addToRef(G,V){return V._x=this._x+G._x,V._y=this._y+G._y,V._z=this._z+G._z,V._w=this._w+G._w,V._isDirty=!0,V}addInPlaceFromFloats(G,V,W,J){return this._x+=G,this._y+=V,this._z+=W,this._w+=J,this._isDirty=!0,this}subtractToRef(G,V){return V._x=this._x-G._x,V._y=this._y-G._y,V._z=this._z-G._z,V._w=this._w-G._w,V._isDirty=!0,V}subtractFromFloats(G,V,W,J){return this.subtractFromFloatsToRef(G,V,W,J,new B)}subtractFromFloatsToRef(G,V,W,J,R){return R._x=this._x-G,R._y=this._y-V,R._z=this._z-W,R._w=this._w-J,R._isDirty=!0,R}zW(G){return new B(this._x-G._x,this._y-G._y,this._z-G._z,this._w-G._w)}FA(G){return this._x-=G._x,this._y-=G._y,this._z-=G._z,this._w-=G._w,this._isDirty=!0,this}scale(G){return new B(this._x*G,this._y*G,this._z*G,this._w*G)}scaleToRef(G,V){return V._x=this._x*G,V._y=this._y*G,V._z=this._z*G,V._w=this._w*G,V._isDirty=!0,V}scaleInPlace(G){return this._x*=G,this._y*=G,this._z*=G,this._w*=G,this._isDirty=!0,this}scaleAndAddToRef(G,V){return V._x+=this._x*G,V._y+=this._y*G,V._z+=this._z*G,V._w+=this._w*G,V._isDirty=!0,V}multiply(G){const V=new B(0,0,0,1);return this.multiplyToRef(G,V),V}multiplyToRef(G,V){const W=this._x*G._w+this._y*G._z-this._z*G._y+this._w*G._x,J=-this._x*G._z+this._y*G._w+this._z*G._x+this._w*G._y,R=this._x*G._y-this._y*G._x+this._z*G._w+this._w*G._z,d=-this._x*G._x-this._y*G._y-this._z*G._z+this._w*G._w;return V.rd(W,J,R,d),V}multiplyInPlace(G){return this.multiplyToRef(G,this)}multiplyByFloats(G,V,W,J){return this._x*=G,this._y*=V,this._z*=W,this._w*=J,this._isDirty=!0,this}divide(G){throw new ReferenceError("Can not divide a quaternion")}divideToRef(G,V){throw new ReferenceError("Can not divide a quaternion")}divideInPlace(G){throw new ReferenceError("Can not divide a quaternion")}minimizeInPlace(){throw new ReferenceError("Can not minimize a quaternion")}minimizeInPlaceFromFloats(){throw new ReferenceError("Can not minimize a quaternion")}maximizeInPlace(){throw new ReferenceError("Can not maximize a quaternion")}maximizeInPlaceFromFloats(){throw new ReferenceError("Can not maximize a quaternion")}negate(){return this.negateToRef(new B)}negateInPlace(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._isDirty=!0,this}negateToRef(G){return G._x=-this._x,G._y=-this._y,G._z=-this._z,G._w=-this._w,G._isDirty=!0,G}equalsToFloats(G,V,W,J){return this._x===G&&this._y===V&&this._z===W&&this._w===J}floorToRef(G){throw new ReferenceError("Can not floor a quaternion")}floor(){throw new ReferenceError("Can not floor a quaternion")}fractToRef(G){throw new ReferenceError("Can not fract a quaternion")}fract(){throw new ReferenceError("Can not fract a quaternion")}conjugateToRef(G){return G.rd(-this._x,-this._y,-this._z,this._w),G}conjugateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}conjugate(){return new B(-this._x,-this._y,-this._z,this._w)}invert(){const G=this.conjugate(),V=this.lengthSquared();return 0==V||1==V||G.scaleInPlace(1/V),G}invertInPlace(){this.conjugateInPlace();const G=this.lengthSquared();return 0==G||1==G||this.scaleInPlace(1/G),this}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this.lengthSquared())}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(G){return 0===G||1===G?this:this.scaleInPlace(1/G)}normalizeToNew(){const G=new B(0,0,0,1);return this.normalizeToRef(G),G}normalizeToRef(G){const V=this.length();return 0===V||1===V?G.rd(this._x,this._y,this._z,this._w):this.scaleToRef(1/V,G)}toEulerAngles(){const G=Y.Zero();return this.toEulerAnglesToRef(G),G}toEulerAnglesToRef(G){const V=this._z,W=this._x,J=this._y,R=this._w,d=J*V-W*R,k=.4999999;if(d<-k)G._y=2*Math.atan2(J,R),G._x=Math.PI/2,G._z=0,G._isDirty=!0;else if(d>k)G._y=2*Math.atan2(J,R),G._x=-Math.PI/2,G._z=0,G._isDirty=!0;else{const k=R*R,z=V*V,X=W*W,P=J*J;G._z=Math.atan2(2*(W*J+V*R),-z-X+P+k),G._x=Math.asin(-2*d),G._y=Math.atan2(2*(V*W+J*R),z-X-P+k),G._isDirty=!0}return G}toAlphaBetaGammaToRef(G){const V=this._z,W=this._x,J=this._y,R=this._w,d=Math.sqrt(W*W+J*J),k=Math.sqrt(V*V+R*R),z=2*Math.atan2(d,k),X=2*Math.atan2(V,R),P=2*Math.atan2(J,W),A=(X+P)/2,x=(X-P)/2;return G.set(x,z,A),G}toRotationMatrix(G){return S.FromQuaternionToRef(this,G),G}fromRotationMatrix(G){return B.FromRotationMatrixToRef(G,this),this}dot(G){return this._x*G._x+this._y*G._y+this._z*G._z+this._w*G._w}toAxisAngle(){const G=Y.Zero();return{axis:G,angle:this.toAxisAngleToRef(G)}}toAxisAngleToRef(G){let V=0;const W=Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z),J=this._w;return W>0?(V=2*Math.atan2(W,J),G.set(this._x/W,this._y/W,this._z/W)):(V=0,G.set(1,0,0)),V}static FromRotationMatrix(G){const V=new B;return B.FromRotationMatrixToRef(G,V),V}static FromRotationMatrixToRef(G,V){const W=G.m,J=W[0],R=W[4],d=W[8],k=W[1],z=W[5],X=W[9],P=W[2],A=W[6],x=W[10],q=J+z+x;let L;return q>0?(L=.5/Math.sqrt(q+1),V._w=.25/L,V._x=(A-X)*L,V._y=(d-P)*L,V._z=(k-R)*L,V._isDirty=!0):J>z&&J>x?(L=2*Math.sqrt(1+J-z-x),V._w=(A-X)/L,V._x=.25*L,V._y=(R+k)/L,V._z=(d+P)/L,V._isDirty=!0):z>x?(L=2*Math.sqrt(1+z-J-x),V._w=(d-P)/L,V._x=(R+k)/L,V._y=.25*L,V._z=(X+A)/L,V._isDirty=!0):(L=2*Math.sqrt(1+x-J-z),V._w=(k-R)/L,V._x=(d+P)/L,V._y=(X+A)/L,V._z=.25*L,V._isDirty=!0),V}static Dot(G,V){return G._x*V._x+G._y*V._y+G._z*V._z+G._w*V._w}static AreClose(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1;const J=B.Dot(G,V);return 1-J*J<=W}static SmoothToRef(G,V,W,J,R){let d=0===J?1:W/J;return d=(0,X.Clamp)(d,0,1),B.SlerpToRef(G,V,d,R),R}static Zero(){return new B(0,0,0,0)}static Inverse(G){return new B(-G._x,-G._y,-G._z,G._w)}static InverseToRef(G,V){return V.set(-G._x,-G._y,-G._z,G._w),V}static Identity(){return new B(0,0,0,1)}static IsIdentity(G){return G&&0===G._x&&0===G._y&&0===G._z&&1===G._w}static RotationAxis(G,V){return B.RotationAxisToRef(G,V,new B)}static RotationAxisToRef(G,V,W){W._w=Math.cos(V/2);const J=Math.sin(V/2)/G.length();return W._x=G._x*J,W._y=G._y*J,W._z=G._z*J,W._isDirty=!0,W}static ld(G,V){return V||(V=0),new B(G[V],G[V+1],G[V+2],G[V+3])}static FromArrayToRef(G,V,W){return W._x=G[V],W._y=G[V+1],W._z=G[V+2],W._w=G[V+3],W._isDirty=!0,W}static FromFloatsToRef(G,V,W,J,R){return R.rd(G,V,W,J),R}static FromEulerAngles(G,V,W){const J=new B;return B.RotationYawPitchRollToRef(V,G,W,J),J}static FromEulerAnglesToRef(G,V,W,J){return B.RotationYawPitchRollToRef(V,G,W,J),J}static FromEulerVector(G){const V=new B;return B.RotationYawPitchRollToRef(G._y,G._x,G._z,V),V}static FromEulerVectorToRef(G,V){return B.RotationYawPitchRollToRef(G._y,G._x,G._z,V),V}static FromUnitVectorsToRef(G,V,W){let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:J.c;const d=Y.Dot(G,V)+1;return d<R?Math.abs(G.x)>Math.abs(G.z)?W.set(-G.y,G.x,0,0):W.set(0,-G.z,G.y,0):(Y.CrossToRef(G,V,b.ed[0]),W.set(b.ed[0].x,b.ed[0].y,b.ed[0].z,d)),W.normalize()}static RotationYawPitchRoll(G,V,W){const J=new B;return B.RotationYawPitchRollToRef(G,V,W,J),J}static RotationYawPitchRollToRef(G,V,W,J){const R=.5*W,d=.5*V,k=.5*G,z=Math.sin(R),X=Math.cos(R),P=Math.sin(d),A=Math.cos(d),x=Math.sin(k),q=Math.cos(k);return J._x=q*P*X+x*A*z,J._y=x*A*X-q*P*z,J._z=q*A*z-x*P*X,J._w=q*A*X+x*P*z,J._isDirty=!0,J}static RotationAlphaBetaGamma(G,V,W){const J=new B;return B.RotationAlphaBetaGammaToRef(G,V,W,J),J}static RotationAlphaBetaGammaToRef(G,V,W,J){const R=.5*(W+G),d=.5*(W-G),k=.5*V;return J._x=Math.cos(d)*Math.sin(k),J._y=Math.sin(d)*Math.sin(k),J._z=Math.sin(R)*Math.cos(k),J._w=Math.cos(R)*Math.cos(k),J._isDirty=!0,J}static RotationQuaternionFromAxis(G,V,W){const J=new B(0,0,0,0);return B.RotationQuaternionFromAxisToRef(G,V,W,J),J}static RotationQuaternionFromAxisToRef(G,V,W,J){const R=p.Matrix[0];return G=G.normalizeToRef(p.ed[0]),V=V.normalizeToRef(p.ed[1]),W=W.normalizeToRef(p.ed[2]),S.FromXYZAxesToRef(G,V,W,R),B.FromRotationMatrixToRef(R,J),J}static FromLookDirectionLH(G,V){const W=new B;return B.FromLookDirectionLHToRef(G,V,W),W}static FromLookDirectionLHToRef(G,V,W){const J=p.Matrix[0];return S.LookDirectionLHToRef(G,V,J),B.FromRotationMatrixToRef(J,W),W}static FromLookDirectionRH(G,V){const W=new B;return B.FromLookDirectionRHToRef(G,V,W),W}static FromLookDirectionRHToRef(G,V,W){const J=p.Matrix[0];return S.LookDirectionRHToRef(G,V,J),B.FromRotationMatrixToRef(J,W)}static Slerp(G,V,W){const J=B.Identity();return B.SlerpToRef(G,V,W,J),J}static SlerpToRef(G,V,W,J){let R,d,k=G._x*V._x+G._y*V._y+G._z*V._z+G._w*V._w,z=!1;if(k<0&&(z=!0,k=-k),k>.999999)d=1-W,R=z?-W:W;else{const G=Math.acos(k),V=1/Math.sin(G);d=Math.sin((1-W)*G)*V,R=z?-Math.sin(W*G)*V:Math.sin(W*G)*V}return J._x=d*G._x+R*V._x,J._y=d*G._y+R*V._y,J._z=d*G._z+R*V._z,J._w=d*G._w+R*V._w,J._isDirty=!0,J}static Hermite(G,V,W,J,R){const d=R*R,k=R*d,z=2*k-3*d+1,X=-2*k+3*d,P=k-2*d+R,A=k-d,x=G._x*z+W._x*X+V._x*P+J._x*A,q=G._y*z+W._y*X+V._y*P+J._y*A,L=G._z*z+W._z*X+V._z*P+J._z*A,t=G._w*z+W._w*X+V._w*P+J._w*A;return new B(x,q,L,t)}static Hermite1stDerivative(G,V,W,J,R){const d=new B;return this.Hermite1stDerivativeToRef(G,V,W,J,R,d),d}static Hermite1stDerivativeToRef(G,V,W,J,R,d){const k=R*R;return d._x=6*(k-R)*G._x+(3*k-4*R+1)*V._x+6*(-k+R)*W._x+(3*k-2*R)*J._x,d._y=6*(k-R)*G._y+(3*k-4*R+1)*V._y+6*(-k+R)*W._y+(3*k-2*R)*J._y,d._z=6*(k-R)*G._z+(3*k-4*R+1)*V._z+6*(-k+R)*W._z+(3*k-2*R)*J._z,d._w=6*(k-R)*G._w+(3*k-4*R+1)*V._w+6*(-k+R)*W._w+(3*k-2*R)*J._w,d._isDirty=!0,d}static Normalize(G){const V=B.Zero();return B.NormalizeToRef(G,V),V}static NormalizeToRef(G,V){return G.normalizeToRef(V),V}static Clamp(G,V,W){const J=new B;return B.ClampToRef(G,V,W,J),J}static ClampToRef(G,V,W,J){return J.rd((0,X.Clamp)(G.x,V.x,W.x),(0,X.Clamp)(G.y,V.y,W.y),(0,X.Clamp)(G.z,V.z,W.z),(0,X.Clamp)(G.w,V.w,W.w))}static Random(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new B((0,X.RandomRange)(G,V),(0,X.RandomRange)(G,V),(0,X.RandomRange)(G,V),(0,X.RandomRange)(G,V))}static RandomToRef(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).rd((0,X.RandomRange)(G,V),(0,X.RandomRange)(G,V),(0,X.RandomRange)(G,V),(0,X.RandomRange)(G,V))}static Minimize(){throw new ReferenceError("Quaternion.Minimize does not make sense")}static Maximize(){throw new ReferenceError("Quaternion.Maximize does not make sense")}static Distance(G,V){return Math.sqrt(B.DistanceSquared(G,V))}static DistanceSquared(G,V){const W=G.x-V.x,J=G.y-V.y,R=G.z-V.z,d=G.w-V.w;return W*W+J*J+R*R+d*d}static Center(G,V){return B.CenterToRef(G,V,B.Zero())}static CenterToRef(G,V,W){return W.rd((G.x+V.x)/2,(G.y+V.y)/2,(G.z+V.z)/2,(G.w+V.w)/2)}}B._V8PerformanceHack=new B(.5,.5,.5,.5),Object.defineProperties(B.prototype,{dimension:{value:[4]},rank:{value:1}});class S{static get Use64Bits(){return k.e.MatrixUse64Bits}get m(){return this.kq}markAsUpdated(){this.updateFlag=P._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}_updateIdentityStatus(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._isIdentity=G,this._isIdentity3x2=G||W,this._isIdentityDirty=!this._isIdentity&&V,this._isIdentity3x2Dirty=!this._isIdentity3x2&&J}constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,k.e.MatrixTrackPrecisionChange&&k.e.MatrixTrackedMatrices.push(this),this.kq=new k.e.MatrixCurrentType(16),this.markAsUpdated()}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const G=this.kq;this._isIdentity=1===G[0]&&0===G[1]&&0===G[2]&&0===G[3]&&0===G[4]&&1===G[5]&&0===G[6]&&0===G[7]&&0===G[8]&&0===G[9]&&1===G[10]&&0===G[11]&&0===G[12]&&0===G[13]&&0===G[14]&&1===G[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this.kq[0]||1!==this.kq[5]||1!==this.kq[15]||0!==this.kq[1]||0!==this.kq[2]||0!==this.kq[3]||0!==this.kq[4]||0!==this.kq[6]||0!==this.kq[7]||0!==this.kq[8]||0!==this.kq[9]||0!==this.kq[10]||0!==this.kq[11]||0!==this.kq[12]||0!==this.kq[13]||0!==this.kq[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const G=this.kq,V=G[0],W=G[1],J=G[2],R=G[3],d=G[4],k=G[5],z=G[6],X=G[7],P=G[8],A=G[9],x=G[10],q=G[11],L=G[12],t=G[13],Y=G[14],g=G[15],B=x*g-Y*q,S=A*g-t*q,p=A*Y-t*x,b=P*g-L*q,r=P*Y-x*L,y=P*t-L*A;return V*+(k*B-z*S+X*p)+W*-(d*B-z*b+X*r)+J*+(d*S-k*b+X*y)+R*-(d*p-k*r+z*y)}toString(){return`{${this.m[0]}, ${this.m[1]}, ${this.m[2]}, ${this.m[3]}\n${this.m[4]}, ${this.m[5]}, ${this.m[6]}, ${this.m[7]}\n${this.m[8]}, ${this.m[9]}, ${this.m[10]}, ${this.m[11]}\n${this.m[12]}, ${this.m[13]}, ${this.m[14]}, ${this.m[15]}}`}toArray(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!G)return this.kq;const W=this.kq;for(let J=0;J<16;J++)G[V+J]=W[J];return this}Bd(){return this.kq}XW(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return S.FromArrayToRef(G,V,this)}rd(){for(var G=arguments.length,V=new Array(G),W=0;W<G;W++)V[W]=arguments[W];return S.FromArrayToRef(V,0,this)}set(){const G=this.kq;for(let V=0;V<16;V++)G[V]=V<0||arguments.length<=V?void 0:arguments[V];return this.markAsUpdated(),this}Ud(G){const V=this.kq;for(let W=0;W<16;W++)V[W]=G;return this.markAsUpdated(),this}invert(){return this.invertToRef(this),this}reset(){return S.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(G){const V=new S;return this.addToRef(G,V),V}addToRef(G,V){const W=this.kq,J=V.kq,R=G.m;for(let d=0;d<16;d++)J[d]=W[d]+R[d];return V.markAsUpdated(),V}addToSelf(G){const V=this.kq,W=G.m;return V[0]+=W[0],V[1]+=W[1],V[2]+=W[2],V[3]+=W[3],V[4]+=W[4],V[5]+=W[5],V[6]+=W[6],V[7]+=W[7],V[8]+=W[8],V[9]+=W[9],V[10]+=W[10],V[11]+=W[11],V[12]+=W[12],V[13]+=W[13],V[14]+=W[14],V[15]+=W[15],this.markAsUpdated(),this}addInPlace(G){const V=this.kq,W=G.m;for(let J=0;J<16;J++)V[J]+=W[J];return this.markAsUpdated(),this}addInPlaceFromFloats(){const G=this.kq;for(let V=0;V<16;V++)G[V]+=V<0||arguments.length<=V?void 0:arguments[V];return this.markAsUpdated(),this}zW(G){const V=this.kq,W=G.m;for(let J=0;J<16;J++)V[J]-=W[J];return this.markAsUpdated(),this}subtractToRef(G,V){const W=this.kq,J=G.m,R=V.kq;for(let d=0;d<16;d++)R[d]=W[d]-J[d];return V.markAsUpdated(),V}FA(G){const V=this.kq,W=G.m;for(let J=0;J<16;J++)V[J]-=W[J];return this.markAsUpdated(),this}subtractFromFloats(){for(var G=arguments.length,V=new Array(G),W=0;W<G;W++)V[W]=arguments[W];return this.subtractFromFloatsToRef(...V,new S)}subtractFromFloatsToRef(){for(var G=arguments.length,V=new Array(G),W=0;W<G;W++)V[W]=arguments[W];const J=V.pop(),R=this.kq,d=J.kq,k=V;for(let z=0;z<16;z++)d[z]=R[z]-k[z];return J.markAsUpdated(),J}invertToRef(G){return!0===this._isIdentity?(S.IdentityToRef(G),G):(q(this,G.Bd())?G.markAsUpdated():G.J(this),G)}addAtIndex(G,V){return this.kq[G]+=V,this.markAsUpdated(),this}multiplyAtIndex(G,V){return this.kq[G]*=V,this.markAsUpdated(),this}setTranslationFromFloats(G,V,W){return this.kq[12]=G,this.kq[13]=V,this.kq[14]=W,this.markAsUpdated(),this}addTranslationFromFloats(G,V,W){return this.kq[12]+=G,this.kq[13]+=V,this.kq[14]+=W,this.markAsUpdated(),this}setTranslation(G){return this.setTranslationFromFloats(G._x,G._y,G._z)}getTranslation(){return new Y(this.kq[12],this.kq[13],this.kq[14])}getTranslationToRef(G){return G.x=this.kq[12],G.y=this.kq[13],G.z=this.kq[14],G}removeRotationAndScaling(){const G=this.m;return S.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,G[12],G[13],G[14],G[15],this),this._updateIdentityStatus(0===G[12]&&0===G[13]&&0===G[14]&&1===G[15]),this}J(G){G.copyToArray(this.kq);const V=G;return this.updateFlag=V.updateFlag,this._updateIdentityStatus(V._isIdentity,V._isIdentityDirty,V._isIdentity3x2,V._isIdentity3x2Dirty),this}copyToArray(G){return x(this,G,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),this}multiply(G){const V=new S;return this.multiplyToRef(G,V),V}multiplyInPlace(G){const V=this.kq,W=G.m;for(let J=0;J<16;J++)V[J]*=W[J];return this.markAsUpdated(),this}multiplyByFloats(){const G=this.kq;for(let V=0;V<16;V++)G[V]*=V<0||arguments.length<=V?void 0:arguments[V];return this.markAsUpdated(),this}multiplyByFloatsToRef(){for(var G=arguments.length,V=new Array(G),W=0;W<G;W++)V[W]=arguments[W];const J=V.pop(),R=this.kq,d=J.kq,k=V;for(let z=0;z<16;z++)d[z]=R[z]*k[z];return J.markAsUpdated(),J}multiplyToRef(G,V){return this._isIdentity?(V.J(G),V):G._isIdentity?(V.J(this),V):(this.multiplyToArray(G,V.kq,0),V.markAsUpdated(),V)}multiplyToArray(G,V,W){return A(this,G,V,W),this}divide(G){return this.divideToRef(G,new S)}divideToRef(G,V){const W=this.kq,J=G.m,R=V.kq;for(let d=0;d<16;d++)R[d]=W[d]/J[d];return V.markAsUpdated(),V}divideInPlace(G){const V=this.kq,W=G.m;for(let J=0;J<16;J++)V[J]/=W[J];return this.markAsUpdated(),this}minimizeInPlace(G){const V=this.kq,W=G.m;for(let J=0;J<16;J++)V[J]=Math.min(V[J],W[J]);return this.markAsUpdated(),this}minimizeInPlaceFromFloats(){const G=this.kq;for(let V=0;V<16;V++)G[V]=Math.min(G[V],V<0||arguments.length<=V?void 0:arguments[V]);return this.markAsUpdated(),this}maximizeInPlace(G){const V=this.kq,W=G.m;for(let J=0;J<16;J++)V[J]=Math.min(V[J],W[J]);return this.markAsUpdated(),this}maximizeInPlaceFromFloats(){const G=this.kq;for(let V=0;V<16;V++)G[V]=Math.min(G[V],V<0||arguments.length<=V?void 0:arguments[V]);return this.markAsUpdated(),this}negate(){return this.negateToRef(new S)}negateInPlace(){const G=this.kq;for(let V=0;V<16;V++)G[V]=-G[V];return this.markAsUpdated(),this}negateToRef(G){const V=this.kq,W=G.kq;for(let J=0;J<16;J++)W[J]=-V[J];return G.markAsUpdated(),G}equals(G){const V=G;if(!V)return!1;if((this._isIdentity||V._isIdentity)&&!this._isIdentityDirty&&!V._isIdentityDirty)return this._isIdentity&&V._isIdentity;const W=this.m,J=V.m;return W[0]===J[0]&&W[1]===J[1]&&W[2]===J[2]&&W[3]===J[3]&&W[4]===J[4]&&W[5]===J[5]&&W[6]===J[6]&&W[7]===J[7]&&W[8]===J[8]&&W[9]===J[9]&&W[10]===J[10]&&W[11]===J[11]&&W[12]===J[12]&&W[13]===J[13]&&W[14]===J[14]&&W[15]===J[15]}equalsWithEpsilon(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const W=this.kq,J=G.m;for(let R=0;R<16;R++)if(!(0,X.WithinEpsilon)(W[R],J[R],V))return!1;return!0}equalsToFloats(){const G=this.kq;for(let V=0;V<16;V++)if(G[V]!=(V<0||arguments.length<=V?void 0:arguments[V]))return!1;return!0}floor(){return this.floorToRef(new S)}floorToRef(G){const V=this.kq,W=G.kq;for(let J=0;J<16;J++)W[J]=Math.floor(V[J]);return G.markAsUpdated(),G}fract(){return this.fractToRef(new S)}fractToRef(G){const V=this.kq,W=G.kq;for(let J=0;J<16;J++)W[J]=V[J]-Math.floor(V[J]);return G.markAsUpdated(),G}clone(){const G=new S;return G.J(this),G}getClassName(){return"Matrix"}getHashCode(){let G=L(this.kq[0]);for(let V=1;V<16;V++)G=397*G^L(this.kq[V]);return G}decomposeToTransformNode(G){return G.rotationQuaternion=G.rotationQuaternion||new B,this.decompose(G.vd,G.rotationQuaternion,G.position)}decompose(G,V,W,J){let R=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._isIdentity)return W&&W.Ud(0),G&&G.Ud(1),V&&V.rd(0,0,0,1),!0;const d=this.kq;if(W&&W.rd(d[12],d[13],d[14]),(G=G||p.ed[0]).x=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]),G.y=Math.sqrt(d[4]*d[4]+d[5]*d[5]+d[6]*d[6]),G.z=Math.sqrt(d[8]*d[8]+d[9]*d[9]+d[10]*d[10]),J){const V=(R?J.absoluteScaling.x:J.vd.x)<0?-1:1,W=(R?J.absoluteScaling.y:J.vd.y)<0?-1:1,d=(R?J.absoluteScaling.z:J.vd.z)<0?-1:1;G.x*=V,G.y*=W,G.z*=d}else this.determinant()<=0&&(G.y*=-1);if(0===G._x||0===G._y||0===G._z)return V&&V.rd(0,0,0,1),!1;if(V){const W=1/G._x,J=1/G._y,R=1/G._z;S.FromValuesToRef(d[0]*W,d[1]*W,d[2]*W,0,d[4]*J,d[5]*J,d[6]*J,0,d[8]*R,d[9]*R,d[10]*R,0,0,0,0,1,p.Matrix[0]),B.FromRotationMatrixToRef(p.Matrix[0],V)}return!0}getRow(G){if(G<0||G>3)return null;const V=4*G;return new g(this.kq[V+0],this.kq[V+1],this.kq[V+2],this.kq[V+3])}getRowToRef(G,V){if(G>=0&&G<=3){const W=4*G;V.x=this.kq[W+0],V.y=this.kq[W+1],V.z=this.kq[W+2],V.w=this.kq[W+3]}return V}setRow(G,V){return this.setRowFromFloats(G,V.x,V.y,V.z,V.w)}transpose(){const G=new S;return S.TransposeToRef(this,G),G}transposeToRef(G){return S.TransposeToRef(this,G),G}setRowFromFloats(G,V,W,J,R){if(G<0||G>3)return this;const d=4*G;return this.kq[d+0]=V,this.kq[d+1]=W,this.kq[d+2]=J,this.kq[d+3]=R,this.markAsUpdated(),this}scale(G){const V=new S;return this.scaleToRef(G,V),V}scaleToRef(G,V){for(let W=0;W<16;W++)V.kq[W]=this.kq[W]*G;return V.markAsUpdated(),V}scaleAndAddToRef(G,V){for(let W=0;W<16;W++)V.kq[W]+=this.kq[W]*G;return V.markAsUpdated(),V}scaleInPlace(G){const V=this.kq;for(let W=0;W<16;W++)V[W]*=G;return this.markAsUpdated(),this}toNormalMatrix(G){const V=p.Matrix[0];this.invertToRef(V),V.transposeToRef(G);const W=G.kq;return S.FromValuesToRef(W[0],W[1],W[2],0,W[4],W[5],W[6],0,W[8],W[9],W[10],0,0,0,0,1,G),G}getRotationMatrix(){const G=new S;return this.getRotationMatrixToRef(G),G}getRotationMatrixToRef(G){const V=p.ed[0];if(!this.decompose(V))return S.IdentityToRef(G),G;const W=this.kq,J=1/V._x,R=1/V._y,d=1/V._z;return S.FromValuesToRef(W[0]*J,W[1]*J,W[2]*J,0,W[4]*R,W[5]*R,W[6]*R,0,W[8]*d,W[9]*d,W[10]*d,0,0,0,0,1,G),G}toggleModelMatrixHandInPlace(){const G=this.kq;return G[2]*=-1,G[6]*=-1,G[8]*=-1,G[9]*=-1,G[14]*=-1,this.markAsUpdated(),this}toggleProjectionMatrixHandInPlace(){const G=this.kq;return G[8]*=-1,G[9]*=-1,G[10]*=-1,G[11]*=-1,this.markAsUpdated(),this}static ld(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const W=new S;return S.FromArrayToRef(G,V,W),W}static FromArrayToRef(G,V,W){for(let J=0;J<16;J++)W.kq[J]=G[J+V];return W.markAsUpdated(),W}static FromFloat32ArrayToRefScaled(G,V,W,J){return J.kq[0]=G[0+V]*W,J.kq[1]=G[1+V]*W,J.kq[2]=G[2+V]*W,J.kq[3]=G[3+V]*W,J.kq[4]=G[4+V]*W,J.kq[5]=G[5+V]*W,J.kq[6]=G[6+V]*W,J.kq[7]=G[7+V]*W,J.kq[8]=G[8+V]*W,J.kq[9]=G[9+V]*W,J.kq[10]=G[10+V]*W,J.kq[11]=G[11+V]*W,J.kq[12]=G[12+V]*W,J.kq[13]=G[13+V]*W,J.kq[14]=G[14+V]*W,J.kq[15]=G[15+V]*W,J.markAsUpdated(),J}static get IdentityReadOnly(){return S._IdentityReadOnly}static FromValuesToRef(G,V,W,J,R,d,k,z,X,P,A,x,q,L,t,Y,g){const B=g.kq;B[0]=G,B[1]=V,B[2]=W,B[3]=J,B[4]=R,B[5]=d,B[6]=k,B[7]=z,B[8]=X,B[9]=P,B[10]=A,B[11]=x,B[12]=q,B[13]=L,B[14]=t,B[15]=Y,g.markAsUpdated()}static FromValues(G,V,W,J,R,d,k,z,X,P,A,x,q,L,t,Y){const g=new S,B=g.kq;return B[0]=G,B[1]=V,B[2]=W,B[3]=J,B[4]=R,B[5]=d,B[6]=k,B[7]=z,B[8]=X,B[9]=P,B[10]=A,B[11]=x,B[12]=q,B[13]=L,B[14]=t,B[15]=Y,g.markAsUpdated(),g}static Compose(G,V,W){const J=new S;return S.ComposeToRef(G,V,W,J),J}static ComposeToRef(G,V,W,J){const R=J.kq,d=V._x,k=V._y,z=V._z,X=V._w,P=d+d,A=k+k,x=z+z,q=d*P,L=d*A,t=d*x,Y=k*A,g=k*x,B=z*x,S=X*P,p=X*A,b=X*x,r=G._x,y=G._y,u=G._z;return R[0]=(1-(Y+B))*r,R[1]=(L+b)*r,R[2]=(t-p)*r,R[3]=0,R[4]=(L-b)*y,R[5]=(1-(q+B))*y,R[6]=(g+S)*y,R[7]=0,R[8]=(t+p)*u,R[9]=(g-S)*u,R[10]=(1-(q+Y))*u,R[11]=0,R[12]=W._x,R[13]=W._y,R[14]=W._z,R[15]=1,J.markAsUpdated(),J}static Identity(){const G=S.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return G._updateIdentityStatus(!0),G}static IdentityToRef(G){return S.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,G),G._updateIdentityStatus(!0),G}static Zero(){const G=S.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return G._updateIdentityStatus(!1),G}static RotationX(G){const V=new S;return S.RotationXToRef(G,V),V}static Invert(G){const V=new S;return G.invertToRef(V),V}static RotationXToRef(G,V){const W=Math.sin(G),J=Math.cos(G);return S.FromValuesToRef(1,0,0,0,0,J,W,0,0,-W,J,0,0,0,0,1,V),V._updateIdentityStatus(1===J&&0===W),V}static RotationY(G){const V=new S;return S.RotationYToRef(G,V),V}static RotationYToRef(G,V){const W=Math.sin(G),J=Math.cos(G);return S.FromValuesToRef(J,0,-W,0,0,1,0,0,W,0,J,0,0,0,0,1,V),V._updateIdentityStatus(1===J&&0===W),V}static RotationZ(G){const V=new S;return S.RotationZToRef(G,V),V}static RotationZToRef(G,V){const W=Math.sin(G),J=Math.cos(G);return S.FromValuesToRef(J,W,0,0,-W,J,0,0,0,0,1,0,0,0,0,1,V),V._updateIdentityStatus(1===J&&0===W),V}static RotationAxis(G,V){const W=new S;return S.RotationAxisToRef(G,V,W),W}static RotationAxisToRef(G,V,W){const J=Math.sin(-V),R=Math.cos(-V),d=1-R;G=G.normalizeToRef(p.ed[0]);const k=W.kq;return k[0]=G._x*G._x*d+R,k[1]=G._x*G._y*d-G._z*J,k[2]=G._x*G._z*d+G._y*J,k[3]=0,k[4]=G._y*G._x*d+G._z*J,k[5]=G._y*G._y*d+R,k[6]=G._y*G._z*d-G._x*J,k[7]=0,k[8]=G._z*G._x*d-G._y*J,k[9]=G._z*G._y*d+G._x*J,k[10]=G._z*G._z*d+R,k[11]=0,k[12]=0,k[13]=0,k[14]=0,k[15]=1,W.markAsUpdated(),W}static RotationAlignToRef(G,V,W){let R=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const d=Y.Dot(V,G),k=W.kq;if(d<-1+J.c)k[0]=-1,k[1]=0,k[2]=0,k[3]=0,k[4]=0,k[5]=R?1:-1,k[6]=0,k[7]=0,k[8]=0,k[9]=0,k[10]=R?-1:1,k[11]=0;else{const W=Y.Cross(V,G),J=1/(1+d);k[0]=W._x*W._x*J+d,k[1]=W._y*W._x*J-W._z,k[2]=W._z*W._x*J+W._y,k[3]=0,k[4]=W._x*W._y*J+W._z,k[5]=W._y*W._y*J+d,k[6]=W._z*W._y*J-W._x,k[7]=0,k[8]=W._x*W._z*J-W._y,k[9]=W._y*W._z*J+W._x,k[10]=W._z*W._z*J+d,k[11]=0}return k[12]=0,k[13]=0,k[14]=0,k[15]=1,W.markAsUpdated(),W}static RotationYawPitchRoll(G,V,W){const J=new S;return S.RotationYawPitchRollToRef(G,V,W,J),J}static RotationYawPitchRollToRef(G,V,W,J){return B.RotationYawPitchRollToRef(G,V,W,p.Quaternion[0]),p.Quaternion[0].toRotationMatrix(J),J}static Scaling(G,V,W){const J=new S;return S.ScalingToRef(G,V,W,J),J}static ScalingToRef(G,V,W,J){return S.FromValuesToRef(G,0,0,0,0,V,0,0,0,0,W,0,0,0,0,1,J),J._updateIdentityStatus(1===G&&1===V&&1===W),J}static Translation(G,V,W){const J=new S;return S.TranslationToRef(G,V,W,J),J}static TranslationToRef(G,V,W,J){return S.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,G,V,W,1,J),J._updateIdentityStatus(0===G&&0===V&&0===W),J}static Lerp(G,V,W){const J=new S;return S.LerpToRef(G,V,W,J),J}static LerpToRef(G,V,W,J){const R=J.kq,d=G.m,k=V.m;for(let z=0;z<16;z++)R[z]=d[z]*(1-W)+k[z]*W;return J.markAsUpdated(),J}static DecomposeLerp(G,V,W){const J=new S;return S.DecomposeLerpToRef(G,V,W,J),J}static DecomposeLerpToRef(G,V,W,J){const R=p.ed[0],d=p.Quaternion[0],k=p.ed[1];G.decompose(R,d,k);const z=p.ed[2],X=p.Quaternion[1],P=p.ed[3];V.decompose(z,X,P);const A=p.ed[4];Y.LerpToRef(R,z,W,A);const x=p.Quaternion[2];B.SlerpToRef(d,X,W,x);const q=p.ed[5];return Y.LerpToRef(k,P,W,q),S.ComposeToRef(A,x,q,J),J}static LookAtLH(G,V,W){const J=new S;return S.LookAtLHToRef(G,V,W,J),J}static LookAtLHToRef(G,V,W,J){const R=p.ed[0],d=p.ed[1],k=p.ed[2];V.subtractToRef(G,k),k.normalize(),Y.CrossToRef(W,k,R);const z=R.lengthSquared();0===z?R.x=1:R.normalizeFromLength(Math.sqrt(z)),Y.CrossToRef(k,R,d),d.normalize();const X=-Y.Dot(R,G),P=-Y.Dot(d,G),A=-Y.Dot(k,G);return S.FromValuesToRef(R._x,d._x,k._x,0,R._y,d._y,k._y,0,R._z,d._z,k._z,0,X,P,A,1,J),J}static LookAtRH(G,V,W){const J=new S;return S.LookAtRHToRef(G,V,W,J),J}static LookAtRHToRef(G,V,W,J){const R=p.ed[0],d=p.ed[1],k=p.ed[2];G.subtractToRef(V,k),k.normalize(),Y.CrossToRef(W,k,R);const z=R.lengthSquared();0===z?R.x=1:R.normalizeFromLength(Math.sqrt(z)),Y.CrossToRef(k,R,d),d.normalize();const X=-Y.Dot(R,G),P=-Y.Dot(d,G),A=-Y.Dot(k,G);return S.FromValuesToRef(R._x,d._x,k._x,0,R._y,d._y,k._y,0,R._z,d._z,k._z,0,X,P,A,1,J),J}static LookDirectionLH(G,V){const W=new S;return S.LookDirectionLHToRef(G,V,W),W}static LookDirectionLHToRef(G,V,W){const J=p.ed[0];J.J(G),J.scaleInPlace(-1);const R=p.ed[1];return Y.CrossToRef(V,J,R),S.FromValuesToRef(R._x,R._y,R._z,0,V._x,V._y,V._z,0,J._x,J._y,J._z,0,0,0,0,1,W),W}static LookDirectionRH(G,V){const W=new S;return S.LookDirectionRHToRef(G,V,W),W}static LookDirectionRHToRef(G,V,W){const J=p.ed[2];return Y.CrossToRef(V,G,J),S.FromValuesToRef(J._x,J._y,J._z,0,V._x,V._y,V._z,0,G._x,G._y,G._z,0,0,0,0,1,W),W}static OrthoLH(G,V,W,J,R){const d=new S;return S.OrthoLHToRef(G,V,W,J,d,R),d}static OrthoLHToRef(G,V,W,J,R,d){const k=2/G,z=2/V,X=2/(J-W),P=-(J+W)/(J-W);return S.FromValuesToRef(k,0,0,0,0,z,0,0,0,0,X,0,0,0,P,1,R),d&&R.multiplyToRef(r,R),R._updateIdentityStatus(1===k&&1===z&&1===X&&0===P),R}static OrthoOffCenterLH(G,V,W,J,R,d,k){const z=new S;return S.OrthoOffCenterLHToRef(G,V,W,J,R,d,z,k),z}static OrthoOffCenterLHToRef(G,V,W,J,R,d,k,z){const X=2/(V-G),P=2/(J-W),A=2/(d-R),x=-(d+R)/(d-R),q=(G+V)/(G-V),L=(J+W)/(W-J);return S.FromValuesToRef(X,0,0,0,0,P,0,0,0,0,A,0,q,L,x,1,k),z&&k.multiplyToRef(r,k),k.markAsUpdated(),k}static ObliqueOffCenterLHToRef(G,V,W,J,R,d,k,z,X,P,A){const x=-k*Math.cos(z),q=-k*Math.sin(z);return S.TranslationToRef(0,0,-X,p.Matrix[1]),S.FromValuesToRef(1,0,0,0,0,1,0,0,x,q,1,0,0,0,0,1,p.Matrix[0]),p.Matrix[1].multiplyToRef(p.Matrix[0],p.Matrix[0]),S.TranslationToRef(0,0,X,p.Matrix[1]),p.Matrix[0].multiplyToRef(p.Matrix[1],p.Matrix[0]),S.OrthoOffCenterLHToRef(G,V,W,J,R,d,P,A),p.Matrix[0].multiplyToRef(P,P),P}static OrthoOffCenterRH(G,V,W,J,R,d,k){const z=new S;return S.OrthoOffCenterRHToRef(G,V,W,J,R,d,z,k),z}static OrthoOffCenterRHToRef(G,V,W,J,R,d,k,z){return S.OrthoOffCenterLHToRef(G,V,W,J,R,d,k,z),k.kq[10]*=-1,k}static ObliqueOffCenterRHToRef(G,V,W,J,R,d,k,z,X,P,A){const x=k*Math.cos(z),q=k*Math.sin(z);return S.TranslationToRef(0,0,X,p.Matrix[1]),S.FromValuesToRef(1,0,0,0,0,1,0,0,x,q,1,0,0,0,0,1,p.Matrix[0]),p.Matrix[1].multiplyToRef(p.Matrix[0],p.Matrix[0]),S.TranslationToRef(0,0,-X,p.Matrix[1]),p.Matrix[0].multiplyToRef(p.Matrix[1],p.Matrix[0]),S.OrthoOffCenterRHToRef(G,V,W,J,R,d,P,A),p.Matrix[0].multiplyToRef(P,P),P}static PerspectiveLH(G,V,W,J,R){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const k=new S,z=2*W/G,X=2*W/V,P=(J+W)/(J-W),A=-2*J*W/(J-W),x=Math.tan(d);return S.FromValuesToRef(z,0,0,0,0,X,0,x,0,0,P,1,0,0,A,0,k),R&&k.multiplyToRef(r,k),k._updateIdentityStatus(!1),k}static PerspectiveFovLH(G,V,W,J,R){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,k=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const z=new S;return S.PerspectiveFovLHToRef(G,V,W,J,z,!0,R,d,k),z}static PerspectiveFovLHToRef(G,V,W,J,R){let d=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],k=arguments.length>6?arguments[6]:void 0,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,X=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const P=W,A=J,x=1/Math.tan(.5*G),q=d?x/V:x,L=d?x:x*V,t=X&&0===P?-1:0!==A?(A+P)/(A-P):1,Y=X&&0===P?2*A:0!==A?-2*A*P/(A-P):-2*P,g=Math.tan(z);return S.FromValuesToRef(q,0,0,0,0,L,0,g,0,0,t,1,0,0,Y,0,R),k&&R.multiplyToRef(r,R),R._updateIdentityStatus(!1),R}static PerspectiveFovReverseLHToRef(G,V,W,J,R){let d=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],k=arguments.length>6?arguments[6]:void 0,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const X=1/Math.tan(.5*G),P=d?X/V:X,A=d?X:X*V,x=Math.tan(z);return S.FromValuesToRef(P,0,0,0,0,A,0,x,0,0,-W,1,0,0,1,0,R),k&&R.multiplyToRef(r,R),R._updateIdentityStatus(!1),R}static PerspectiveFovRH(G,V,W,J,R){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,k=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const z=new S;return S.PerspectiveFovRHToRef(G,V,W,J,z,!0,R,d,k),z}static PerspectiveFovRHToRef(G,V,W,J,R){let d=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],k=arguments.length>6?arguments[6]:void 0,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,X=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const P=W,A=J,x=1/Math.tan(.5*G),q=d?x/V:x,L=d?x:x*V,t=X&&0===P?1:0!==A?-(A+P)/(A-P):-1,Y=X&&0===P?2*A:0!==A?-2*A*P/(A-P):-2*P,g=Math.tan(z);return S.FromValuesToRef(q,0,0,0,0,L,0,g,0,0,t,-1,0,0,Y,0,R),k&&R.multiplyToRef(r,R),R._updateIdentityStatus(!1),R}static PerspectiveFovReverseRHToRef(G,V,W,J,R){let d=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],k=arguments.length>6?arguments[6]:void 0,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const X=1/Math.tan(.5*G),P=d?X/V:X,A=d?X:X*V,x=Math.tan(z);return S.FromValuesToRef(P,0,0,0,0,A,0,x,0,0,-W,-1,0,0,-1,0,R),k&&R.multiplyToRef(r,R),R._updateIdentityStatus(!1),R}static GetFinalMatrix(G,V,W,J,R,d){const k=G.width,z=G.height,X=G.x,P=G.y,A=S.FromValues(k/2,0,0,0,0,-z/2,0,0,0,0,d-R,0,X+k/2,z/2+P,R,1),x=new S;return V.multiplyToRef(W,x),x.multiplyToRef(J,x),x.multiplyToRef(A,x)}static GetAsMatrix2x2(G){const V=G.m,W=[V[0],V[1],V[4],V[5]];return k.e.MatrixUse64Bits?W:new Float32Array(W)}static GetAsMatrix3x3(G){const V=G.m,W=[V[0],V[1],V[2],V[4],V[5],V[6],V[8],V[9],V[10]];return k.e.MatrixUse64Bits?W:new Float32Array(W)}static Transpose(G){const V=new S;return S.TransposeToRef(G,V),V}static TransposeToRef(G,V){const W=G.m,J=W[0],R=W[4],d=W[8],k=W[12],z=W[1],X=W[5],P=W[9],A=W[13],x=W[2],q=W[6],L=W[10],t=W[14],Y=W[3],g=W[7],B=W[11],S=W[15],p=V.kq;return p[0]=J,p[1]=R,p[2]=d,p[3]=k,p[4]=z,p[5]=X,p[6]=P,p[7]=A,p[8]=x,p[9]=q,p[10]=L,p[11]=t,p[12]=Y,p[13]=g,p[14]=B,p[15]=S,V.markAsUpdated(),V._updateIdentityStatus(G._isIdentity,G._isIdentityDirty),V}static Reflection(G){const V=new S;return S.ReflectionToRef(G,V),V}static ReflectionToRef(G,V){G.normalize();const W=G.IV.x,J=G.IV.y,R=G.IV.z,d=-2*W,k=-2*J,z=-2*R;return S.FromValuesToRef(d*W+1,k*W,z*W,0,d*J,k*J+1,z*J,0,d*R,k*R,z*R+1,0,d*G.d,k*G.d,z*G.d,1,V),V}static FromXYZAxesToRef(G,V,W,J){return S.FromValuesToRef(G._x,G._y,G._z,0,V._x,V._y,V._z,0,W._x,W._y,W._z,0,0,0,0,1,J),J}static FromQuaternionToRef(G,V){const W=G._x*G._x,J=G._y*G._y,R=G._z*G._z,d=G._x*G._y,k=G._z*G._w,z=G._z*G._x,X=G._y*G._w,P=G._y*G._z,A=G._x*G._w;return V.kq[0]=1-2*(J+R),V.kq[1]=2*(d+k),V.kq[2]=2*(z-X),V.kq[3]=0,V.kq[4]=2*(d-k),V.kq[5]=1-2*(R+W),V.kq[6]=2*(P+A),V.kq[7]=0,V.kq[8]=2*(z+X),V.kq[9]=2*(P-A),V.kq[10]=1-2*(J+W),V.kq[11]=0,V.kq[12]=0,V.kq[13]=0,V.kq[14]=0,V.kq[15]=1,V.markAsUpdated(),V}}S._IdentityReadOnly=S.Identity(),Object.defineProperties(S.prototype,{dimension:{value:[4,4]},rank:{value:2}});class p{}p.ed=(0,R.e)(11,Y.Zero),p.Matrix=(0,R.e)(2,S.Identity),p.Quaternion=(0,R.e)(3,B.Zero);class b{}b.Vector2=(0,R.e)(3,t.Zero),b.ed=(0,R.e)(13,Y.Zero),b.Vector4=(0,R.e)(3,g.Zero),b.Quaternion=(0,R.e)(3,B.Zero),b.Matrix=(0,R.e)(8,S.Identity),(0,d.d)("BABYLON.Vector2",t),(0,d.d)("BABYLON.Vector3",Y),(0,d.d)("BABYLON.Vector4",g),(0,d.d)("BABYLON.Matrix",S);const r=S.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)},11530:(G,V,W)=>{W.d(V,{e:()=>J});class J{constructor(G,V,W,J){this.x=G,this.y=V,this.width=W,this.height=J}toGlobal(G,V){return new J(this.x*G,this.y*V,this.width*G,this.height*V)}toGlobalToRef(G,V,W){return W.x=this.x*G,W.y=this.y*V,W.width=this.width*G,W.height=this.height*V,this}clone(){return new J(this.x,this.y,this.width,this.height)}}},11620:(G,V,W)=>{W.d(V,{e:()=>P,g:()=>A});var J=W(11136),R=W(11623);const d=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],k=[()=>1,G=>G.y,G=>G.z,G=>G.x,G=>G.x*G.y,G=>G.y*G.z,G=>3*G.z*G.z-1,G=>G.x*G.z,G=>G.x*G.x-G.y*G.y],z=(G,V)=>d[G]*k[G](V),X=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class P{constructor(){this.preScaled=!1,this.l00=J.o.Zero(),this.l1_1=J.o.Zero(),this.l10=J.o.Zero(),this.l11=J.o.Zero(),this.l2_2=J.o.Zero(),this.l2_1=J.o.Zero(),this.l20=J.o.Zero(),this.l21=J.o.Zero(),this.l22=J.o.Zero()}addLight(G,V,W){R.k.ed[0].set(V.r,V.g,V.b);const J=R.k.ed[0],d=R.k.ed[1];J.scaleToRef(W,d),d.scaleToRef(z(0,G),R.k.ed[2]),this.l00.addInPlace(R.k.ed[2]),d.scaleToRef(z(1,G),R.k.ed[2]),this.l1_1.addInPlace(R.k.ed[2]),d.scaleToRef(z(2,G),R.k.ed[2]),this.l10.addInPlace(R.k.ed[2]),d.scaleToRef(z(3,G),R.k.ed[2]),this.l11.addInPlace(R.k.ed[2]),d.scaleToRef(z(4,G),R.k.ed[2]),this.l2_2.addInPlace(R.k.ed[2]),d.scaleToRef(z(5,G),R.k.ed[2]),this.l2_1.addInPlace(R.k.ed[2]),d.scaleToRef(z(6,G),R.k.ed[2]),this.l20.addInPlace(R.k.ed[2]),d.scaleToRef(z(7,G),R.k.ed[2]),this.l21.addInPlace(R.k.ed[2]),d.scaleToRef(z(8,G),R.k.ed[2]),this.l22.addInPlace(R.k.ed[2])}scaleInPlace(G){this.l00.scaleInPlace(G),this.l1_1.scaleInPlace(G),this.l10.scaleInPlace(G),this.l11.scaleInPlace(G),this.l2_2.scaleInPlace(G),this.l2_1.scaleInPlace(G),this.l20.scaleInPlace(G),this.l21.scaleInPlace(G),this.l22.scaleInPlace(G)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(X[0]),this.l1_1.scaleInPlace(X[1]),this.l10.scaleInPlace(X[2]),this.l11.scaleInPlace(X[3]),this.l2_2.scaleInPlace(X[4]),this.l2_1.scaleInPlace(X[5]),this.l20.scaleInPlace(X[6]),this.l21.scaleInPlace(X[7]),this.l22.scaleInPlace(X[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(d[0]),this.l1_1.scaleInPlace(d[1]),this.l10.scaleInPlace(d[2]),this.l11.scaleInPlace(d[3]),this.l2_2.scaleInPlace(d[4]),this.l2_1.scaleInPlace(d[5]),this.l20.scaleInPlace(d[6]),this.l21.scaleInPlace(d[7]),this.l22.scaleInPlace(d[8])}updateFromArray(G){return J.o.FromArrayToRef(G[0],0,this.l00),J.o.FromArrayToRef(G[1],0,this.l1_1),J.o.FromArrayToRef(G[2],0,this.l10),J.o.FromArrayToRef(G[3],0,this.l11),J.o.FromArrayToRef(G[4],0,this.l2_2),J.o.FromArrayToRef(G[5],0,this.l2_1),J.o.FromArrayToRef(G[6],0,this.l20),J.o.FromArrayToRef(G[7],0,this.l21),J.o.FromArrayToRef(G[8],0,this.l22),this}updateFromFloatsArray(G){return J.o.FromFloatsToRef(G[0],G[1],G[2],this.l00),J.o.FromFloatsToRef(G[3],G[4],G[5],this.l1_1),J.o.FromFloatsToRef(G[6],G[7],G[8],this.l10),J.o.FromFloatsToRef(G[9],G[10],G[11],this.l11),J.o.FromFloatsToRef(G[12],G[13],G[14],this.l2_2),J.o.FromFloatsToRef(G[15],G[16],G[17],this.l2_1),J.o.FromFloatsToRef(G[18],G[19],G[20],this.l20),J.o.FromFloatsToRef(G[21],G[22],G[23],this.l21),J.o.FromFloatsToRef(G[24],G[25],G[26],this.l22),this}static ld(G){return(new P).updateFromArray(G)}static FromPolynomial(G){const V=new P;return V.l00=G.xx.scale(.376127).add(G.yy.scale(.376127)).add(G.zz.scale(.376126)),V.l1_1=G.y.scale(.977204),V.l10=G.z.scale(.977204),V.l11=G.x.scale(.977204),V.l2_2=G.xy.scale(1.16538),V.l2_1=G.yz.scale(1.16538),V.l20=G.zz.scale(1.34567).zW(G.xx.scale(.672834)).zW(G.yy.scale(.672834)),V.l21=G.zx.scale(1.16538),V.l22=G.xx.scale(1.16538).zW(G.yy.scale(1.16538)),V.l1_1.scaleInPlace(-1),V.l11.scaleInPlace(-1),V.l2_1.scaleInPlace(-1),V.l21.scaleInPlace(-1),V.scaleInPlace(Math.PI),V}}class A{constructor(){this.x=J.o.Zero(),this.y=J.o.Zero(),this.z=J.o.Zero(),this.xx=J.o.Zero(),this.yy=J.o.Zero(),this.zz=J.o.Zero(),this.xy=J.o.Zero(),this.yz=J.o.Zero(),this.zx=J.o.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=P.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(G){R.k.ed[0].rd(G.r,G.g,G.b);const V=R.k.ed[0];this.xx.addInPlace(V),this.yy.addInPlace(V),this.zz.addInPlace(V)}scaleInPlace(G){this.x.scaleInPlace(G),this.y.scaleInPlace(G),this.z.scaleInPlace(G),this.xx.scaleInPlace(G),this.yy.scaleInPlace(G),this.zz.scaleInPlace(G),this.yz.scaleInPlace(G),this.zx.scaleInPlace(G),this.xy.scaleInPlace(G)}updateFromHarmonics(G){return this._harmonics=G,this.x.J(G.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.J(G.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.J(G.l10),this.z.scaleInPlace(1.02333),this.xx.J(G.l00),R.k.ed[0].J(G.l20).scaleInPlace(.247708),R.k.ed[1].J(G.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).FA(R.k.ed[0]).addInPlace(R.k.ed[1]),this.yy.J(G.l00),this.yy.scaleInPlace(.886277).FA(R.k.ed[0]).FA(R.k.ed[1]),this.zz.J(G.l00),R.k.ed[0].J(G.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(R.k.ed[0]),this.yz.J(G.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.J(G.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.J(G.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(G){return(new A).updateFromHarmonics(G)}static ld(G){const V=new A;return J.o.FromArrayToRef(G[0],0,V.x),J.o.FromArrayToRef(G[1],0,V.y),J.o.FromArrayToRef(G[2],0,V.z),J.o.FromArrayToRef(G[3],0,V.xx),J.o.FromArrayToRef(G[4],0,V.yy),J.o.FromArrayToRef(G[5],0,V.zz),J.o.FromArrayToRef(G[6],0,V.yz),J.o.FromArrayToRef(G[7],0,V.zx),J.o.FromArrayToRef(G[8],0,V.xy),V}}},11892:(G,V,W)=>{W.d(V,{e:()=>B,i:()=>S});var J=W(11136),R=W(11424),d=W(11510),k=W(11482),z=W(11201),X=W(11345),P=W(11627),A=W(11145),x=W(11169);class q extends J.k{constructor(G,V){super(G.x,G.y),this.index=V}}class L{constructor(){this.elements=[]}add(G){const V=[];for(const W of G){const G=new q(W,this.elements.length);V.push(G),this.elements.push(G)}return V}computeBounds(){const G=new J.k(this.elements[0].x,this.elements[0].y),V=new J.k(this.elements[0].x,this.elements[0].y);for(const W of this.elements)W.x<G.x?G.x=W.x:W.x>V.x&&(V.x=W.x),W.y<G.y?G.y=W.y:W.y>V.y&&(V.y=W.y);return{min:G,max:V,width:V.x-G.x,height:V.y-G.y}}}class t{_addToepoint(G){for(const V of G)this._epoints.push(V.x,V.y)}constructor(G,V,W){let J,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new L,this._outlinepoints=new L,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=R,this._name=G,this._scene=W||x.c.LastCreatedScene,J=V instanceof P.k?V.getPoints():V,this._addToepoint(J),this._points.add(J),this._outlinepoints.add(J),"undefined"===typeof this.bjsEarcut&&z.c.Warn("Earcut was not found, the polygon will not be built.")}addHole(G){this._points.add(G);const V=new L;return V.add(G),this._holes.push(V),this._eholes.push(this._epoints.length/2),this._addToepoint(G),this}build(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const J=new d.b(this._name,this._scene),R=this.buildVertexData(V,W);return J.wG(X.c.PositionKind,R.DG,G),J.wG(X.c.NormalKind,R.iG,G),J.wG(X.c.UVKind,R.FG,G),J.setIndices(R.indices),J}buildVertexData(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const W=new k.b,J=[],R=[],d=[],z=this._points.computeBounds();for(const k of this._points.elements)J.push(0,1,0),R.push(k.x,0,k.y),d.push((k.x-z.min.x)/z.width,(k.y-z.min.y)/z.height);const X=[],P=this.bjsEarcut(this._epoints,this._eholes,2);for(let k=0;k<P.length;k++)X.push(P[k]);if(G>0){const W=R.length/3;for(const V of this._points.elements)J.push(0,-1,0),R.push(V.x,-G,V.y),d.push(1-(V.x-z.min.x)/z.width,1-(V.y-z.min.y)/z.height);const k=X.length;for(let G=0;G<k;G+=3){const V=X[G+0],J=X[G+1],R=X[G+2];X.push(R+W),X.push(J+W),X.push(V+W)}this._addSide(R,J,d,X,z,this._outlinepoints,G,!1,V);for(const P of this._holes)this._addSide(R,J,d,X,z,P,G,!0,V)}return W.indices=X,W.DG=R,W.iG=J,W.FG=d,W}_addSide(G,V,W,R,d,k,z,X,P){let x=G.length/3,q=0;for(let L=0;L<k.elements.length;L++){const t=k.elements[L],Y=k.elements[(L+1)%k.elements.length];G.push(t.x,0,t.y),G.push(t.x,-z,t.y),G.push(Y.x,0,Y.y),G.push(Y.x,-z,Y.y);const g=k.elements[(L+k.elements.length-1)%k.elements.length],B=k.elements[(L+2)%k.elements.length];let S=new J.o(-(Y.y-t.y),0,Y.x-t.x),p=new J.o(-(t.y-g.y),0,t.x-g.x),b=new J.o(-(B.y-Y.y),0,B.x-Y.x);X||(S=S.scale(-1),p=p.scale(-1),b=b.scale(-1));const r=S.normalizeToNew();let y=p.normalizeToNew(),u=b.normalizeToNew();const H=J.o.Dot(y,r);y=H>P?H<A.c-1?new J.o(t.x,0,t.y).zW(new J.o(Y.x,0,Y.y)).normalize():p.add(S).normalize():r;const n=J.o.Dot(b,S);u=n>P?n<A.c-1?new J.o(Y.x,0,Y.y).zW(new J.o(t.x,0,t.y)).normalize():b.add(S).normalize():r,W.push(q/d.width,0),W.push(q/d.width,1),q+=S.length(),W.push(q/d.width,0),W.push(q/d.width,1),V.push(y.x,y.y,y.z),V.push(y.x,y.y,y.z),V.push(u.x,u.y,u.z),V.push(u.x,u.y,u.z),X?(R.push(x),R.push(x+2),R.push(x+1),R.push(x+1),R.push(x+2),R.push(x+3)):(R.push(x),R.push(x+1),R.push(x+2),R.push(x+1),R.push(x+3),R.push(x+2)),x+=4}}}var Y=W(11552);function g(G,V,W,d,z,P,A){const x=W||new Array(3),q=d,L=[],t=A||!1;for(let k=0;k<3;k++)void 0===x[k]&&(x[k]=new J.q(0,0,1,1)),q&&void 0===q[k]&&(q[k]=new R.h(1,1,1,1));const g=G.getVerticesData(X.c.PositionKind),B=G.getVerticesData(X.c.NormalKind),S=G.getVerticesData(X.c.UVKind),p=G.Pd(),b=g.length/9;let r=0,y=0,u=0,H=0,n=0;const D=[0];if(t)for(let J=b;J<g.length/3;J+=4)y=g[3*(J+2)]-g[3*J],u=g[3*(J+2)+2]-g[3*J+2],H=Math.sqrt(y*y+u*u),n+=H,D.push(n);let i=0,e=0;for(let J=0;J<B.length;J+=3)Math.abs(B[J+1])<.001&&(e=1),Math.abs(B[J+1]-1)<.001&&(e=0),Math.abs(B[J+1]+1)<.001&&(e=2),i=J/3,1===e?(r=i-b,S[2*i]=r%4<1.5?t?x[e].x+(x[e].z-x[e].x)*D[Math.floor(r/4)]/n:x[e].x:t?x[e].x+(x[e].z-x[e].x)*D[Math.floor(r/4)+1]/n:x[e].z,S[2*i+1]=r%2===0?Y.b?1-x[e].w:x[e].w:Y.b?1-x[e].y:x[e].y):(S[2*i]=(1-S[2*i])*x[e].x+S[2*i]*x[e].z,S[2*i+1]=(1-S[2*i+1])*x[e].y+S[2*i+1]*x[e].w,Y.b&&(S[2*i+1]=1-S[2*i+1])),q&&L.push(q[e].r,q[e].g,q[e].b,q[e].a);k.b._ComputeSides(V,g,p,B,S,z,P);const F=new k.b;if(F.indices=p,F.DG=g,F.iG=B,F.FG=S,q){const G=V===k.b.DOUBLESIDE?L.concat(L):L;F.eG=G}return F}function B(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;V.sideOrientation=d.b._GetDefaultSideOrientation(V.sideOrientation);const k=V.shape,z=V.holes||[],X=V.depth||0,P=V.smoothingThreshold||2,A=[];let q=[];for(let d=0;d<k.length;d++)A[d]=new J.k(k[d].x,k[d].z);A[0].equalsWithEpsilon(A[A.length-1],1e-8)&&A.pop();const L=new t(G,A,W||x.c.LastCreatedScene,R);for(let d=0;d<z.length;d++){q=[];for(let G=0;G<z[d].length;G++)q.push(new J.k(z[d][G].x,z[d][G].z));L.addHole(q)}const Y=L.build(!1,X,P);Y._originalBuilderSideOrientation=V.sideOrientation;return g(Y,V.sideOrientation,V.faceUV,V.faceColors,V.frontUVs,V.backUVs,V.wrap).vG(Y,V.updatable),Y}function S(G,V){return B(G,V,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}k.b.CreatePolygon=g,d.b.CreatePolygon=function(G,V,W,J,R,d){return B(G,{shape:V,holes:J,updatable:R,sideOrientation:d},W,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},d.b.ExtrudePolygon=function(G,V,W,J,R,d,k){return S(G,{shape:V,holes:R,depth:W,updatable:d,sideOrientation:k},J,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)}},11886:(G,V,W)=>{W.d(V,{c:()=>A,d:()=>x});var J=W(11627),R=W(11136),d=W(11510),k=W(11457),z=W(11892);class X{constructor(G){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=G}moveTo(G,V){this._currentPath=new J.k(G,V),this._tempPaths.push(this._currentPath)}lineTo(G,V){this._currentPath.addLineTo(G,V)}quadraticCurveTo(G,V,W,J){this._currentPath.addQuadraticCurveTo(G,V,W,J,this._resolution)}bezierCurveTo(G,V,W,J,R,d){this._currentPath.addBezierCurveTo(G,V,W,J,R,d,this._resolution)}extractHoles(){for(const G of this._tempPaths)G.area()>0?this._holes.push(G):this._paths.push(G);if(!this._paths.length&&this._holes.length){const G=this._holes;this._holes=this._paths,this._paths=G}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function P(G,V,W,J,R,d){const k=d.glyphs[G]||d.glyphs["?"];if(!k)return null;const z=new X(R);if(k.o){const G=k.o.split(" ");for(let R=0,d=G.length;R<d;){switch(G[R++]){case"m":{const d=parseInt(G[R++])*V+W,k=parseInt(G[R++])*V+J;z.moveTo(d,k);break}case"l":{const d=parseInt(G[R++])*V+W,k=parseInt(G[R++])*V+J;z.lineTo(d,k);break}case"q":{const d=parseInt(G[R++])*V+W,k=parseInt(G[R++])*V+J,X=parseInt(G[R++])*V+W,P=parseInt(G[R++])*V+J;z.quadraticCurveTo(X,P,d,k);break}case"b":{const d=parseInt(G[R++])*V+W,k=parseInt(G[R++])*V+J,X=parseInt(G[R++])*V+W,P=parseInt(G[R++])*V+J,A=parseInt(G[R++])*V+W,x=parseInt(G[R++])*V+J;z.bezierCurveTo(X,P,A,x,d,k);break}}}}return z.extractHoles(),{offsetX:k.ha*V,shapePath:z}}function A(G,V,W,J){const R=Array.from(G),d=V/J.resolution,k=(J.boundingBox.yMax-J.boundingBox.yMin+J.underlineThickness)*d,z=[];let X=0,A=0;for(let x=0;x<R.length;x++){const G=R[x];if("\n"===G)X=0,A-=k;else{const V=P(G,d,X,A,W,J);V&&(X+=V.offsetX,z.push(V.shapePath))}}return z}function x(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const x=A(V,J.size||50,J.resolution||8,W),q=[];let L=0;for(const k of x){if(!k.paths.length)continue;const V=k.holes.slice();for(const W of k.paths){var t,Y;const k=[],A=[],x=W.getPoints();for(const G of x)A.push(new R.o(G.x,0,G.y));const g=V.slice();for(const G of g){const J=G.getPoints();let d=!1;for(const G of J)if(W.isPointInside(G)){d=!0;break}if(!d)continue;const z=[];for(const G of J)z.push(new R.o(G.x,0,G.y));k.push(z),V.splice(V.indexOf(G),1)}if(!k.length&&V.length)for(const G of V){const V=G.getPoints(),W=[];for(const G of V)W.push(new R.o(G.x,0,G.y));k.push(W)}const B=(0,z.i)(G,{shape:A,holes:k.length?k:void 0,depth:J.depth||1,faceUV:J.faceUV||(null===(t=J.perLetterFaceUV)||void 0===t?void 0:t.call(J,L)),faceColors:J.faceColors||(null===(Y=J.perLetterFaceColors)||void 0===Y?void 0:Y.call(J,L)),sideOrientation:d.b._GetDefaultSideOrientation(J.sideOrientation||d.b.DOUBLESIDE)},X,P);q.push(B),L++}}const g=d.b.MergeMeshes(q,!0,!0);if(g){const V=g.getBoundingInfo().boundingBox;g.position.x+=-(V.minimumWorld.x+V.maximumWorld.x)/2,g.position.y+=-(V.minimumWorld.y+V.maximumWorld.y)/2,g.position.z+=-(V.minimumWorld.z+V.maximumWorld.z)/2+V.extendSize.z,g.name=G;const W=new k.b("pivot",X);W.rotation.x=-Math.PI/2,g.parent=W,g.bakeCurrentTransformIntoVertices(),g.parent=null,W.dispose()}return g}},11908:(G,V,W)=>{W.d(V,{b:()=>X,e:()=>k,i:()=>z});var J=W(11189),R=W(11911),d=W(11920);function k(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}function z(G){return!!(G.wasmUrl&&(G.wasmBinary||G.wasmBinaryUrl)&&"object"===typeof WebAssembly||G.fallbackUrl)}class X{constructor(G){if(G.workerPool)return void(this._workerPoolPromise=Promise.resolve(G.workerPool));const V=G.wasmBinary,W=G.numWorkers??k(),z=W&&"function"===typeof Worker&&"function"===typeof URL,X=z||!G.jsModule,P=G.wasmUrl&&G.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:X?J.h.GetBabylonScriptURL(G.wasmUrl,!0):"",wasmBinaryPromise:V?Promise.resolve(V):J.h.LoadFileAsync(J.h.GetBabylonScriptURL(G.wasmBinaryUrl,!0))}:{url:X?J.h.GetBabylonScriptURL(G.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};z?this._workerPoolPromise=P.wasmBinaryPromise.then((G=>{const V=this._getWorkerContent(),J=URL.createObjectURL(new Blob([V],{type:"application/javascript"}));return new R.b(W,(()=>{const V=new Worker(J);return(0,d.r)(V,G,P.url)}))})):this._modulePromise=P.wasmBinaryPromise.then((async V=>{if(!this._isModuleAvailable()&&!G.jsModule){if(!P.url)throw new Error("Draco codec module is not available");await J.h.LoadBabylonScriptAsync(P.url)}return await this._createModuleAsync(V,G.jsModule)}))}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._modulePromise&&await this._modulePromise}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((G=>{G.dispose()})),delete this._workerPoolPromise,delete this._modulePromise}}},11920:(G,V,W)=>{function J(G,V,W,J){const R=G;let d=null,k=null,z=null,X=null;const P={},A=V.find((G=>"POSITION"===G.dracoName));if(!A)throw new Error("Position attribute is required for Draco encoding");if(!W){const G=A.data.length/A.size;W=new(G>65535?Uint32Array:Uint16Array)(G);for(let V=0;V<G;V++)W[V]=V}try{d=new R.Encoder,k=new R.MeshBuilder,z=new R.Mesh,k.AddFacesToMesh(z,W.length/3,W);const G=new Map([[Float32Array,(G,V,W,J,R,d)=>G.AddFloatAttribute(V,W,J,R,d)],[Uint32Array,(G,V,W,J,R,d)=>G.AddUInt32Attribute(V,W,J,R,d)],[Uint16Array,(G,V,W,J,R,d)=>G.AddUInt16Attribute(V,W,J,R,d)],[Uint8Array,(G,V,W,J,R,d)=>G.AddUInt8Attribute(V,W,J,R,d)],[Int32Array,(G,V,W,J,R,d)=>G.AddInt32Attribute(V,W,J,R,d)],[Int16Array,(G,V,W,J,R,d)=>G.AddInt16Attribute(V,W,J,R,d)],[Int8Array,(G,V,W,J,R,d)=>G.AddInt8Attribute(V,W,J,R,d)]]);for(const W of V){W.data instanceof Uint8ClampedArray&&(W.data=new Uint8Array(W.data));const V=G.get(W.data.constructor),X=W.data.length/W.size;P[W.kind]=V(k,z,R[W.dracoName],X,W.size,W.data),J.quantizationBits&&J.quantizationBits[W.dracoName]&&d.SetAttributeQuantization(R[W.dracoName],J.quantizationBits[W.dracoName])}J.method&&d.SetEncodingMethod(R[J.method]),void 0!==J.encodeSpeed&&void 0!==J.decodeSpeed&&d.SetSpeedOptions(J.encodeSpeed,J.decodeSpeed),X=new R.DracoInt8Array;const A=d.EncodeMeshToDracoBuffer(z,X);if(A<=0)throw new Error("Draco encoding failed.");const x=new Int8Array(A);for(let V=0;V<A;V++)x[V]=X.GetValue(V);return{data:x,attributeIds:P}}finally{z&&R.destroy(z),k&&R.destroy(k),d&&R.destroy(d),X&&R.destroy(X)}}function R(){let G;onmessage=V=>{const W=V.data;switch(W.id){case"init":{W.url&&importScripts(W.url);const V=W.wasmBinary?{wasmBinary:W.wasmBinary}:{};G=DracoEncoderModule(V),postMessage({id:"initDone"});break}case"encodeMesh":if(!G)throw new Error("Draco encoder module is not available");G.then((G=>{const V=J(G,W.attributes,W.indices,W.options);postMessage({id:"encodeMeshDone",encodedMeshData:V},V?[V.data.buffer]:void 0)}))}}}function d(G,V,W,J,R){const d=G;let k=null,z=null,X=null;try{let G;k=new d.Decoder,z=new d.DecoderBuffer,z.Init(V,V.byteLength);const P=k.GetEncodedGeometryType(z);switch(P){case d.TRIANGULAR_MESH:{const V=new d.Mesh;if(G=k.DecodeBufferToMesh(z,V),!G.ok()||0===V.ptr)throw new Error(G.error_msg());const W=3*V.num_faces(),R=4*W,P=d._malloc(R);try{k.GetTrianglesUInt32Array(V,R,P);const G=new Uint32Array(W);G.set(new Uint32Array(d.HEAPF32.buffer,P,W)),J(G)}finally{d._free(P)}X=V;break}case d.POINT_CLOUD:{const V=new d.PointCloud;if(G=k.DecodeBufferToPointCloud(z,V),!G.ok()||!V.ptr)throw new Error(G.error_msg());X=V;break}default:throw new Error(`Invalid geometry type ${P}`)}const A=X.num_points(),x=(G,V,W,J)=>{const k=J.data_type(),z=J.num_components(),X=J.normalized(),P=J.byte_stride(),x=J.byte_offset(),q={[d.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:d.HEAPF32},[d.DT_INT8]:{typedArrayConstructor:Int8Array,heap:d.HEAP8},[d.DT_INT16]:{typedArrayConstructor:Int16Array,heap:d.HEAP16},[d.DT_INT32]:{typedArrayConstructor:Int32Array,heap:d.HEAP32},[d.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:d.HEAPU8},[d.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:d.HEAPU16},[d.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:d.HEAPU32}}[k];if(!q)throw new Error(`Invalid data type ${k}`);const L=A*z,t=L*q.typedArrayConstructor.BYTES_PER_ELEMENT,Y=d._malloc(t);try{G.GetAttributeDataArrayForAllPoints(V,J,k,t,Y);const d=new q.typedArrayConstructor(q.heap.buffer,Y,L);R(W,d.slice(),z,x,P,X)}finally{d._free(Y)}};if(W)for(const V in W){const G=W[V],J=k.GetAttributeByUniqueId(X,G);x(k,X,V,J)}else{const G={position:d.POSITION,IV:d.NORMAL,color:d.COLOR,uv:d.TEX_COORD};for(const V in G){const W=k.GetAttributeId(X,G[V]);if(-1!==W){const G=k.GetAttribute(X,W);x(k,X,V,G)}}}return A}finally{X&&d.destroy(X),z&&d.destroy(z),k&&d.destroy(k)}}function k(){let G;onmessage=V=>{const W=V.data;switch(W.id){case"init":{W.url&&importScripts(W.url);const V=W.wasmBinary?{wasmBinary:W.wasmBinary}:{};G=DracoDecoderModule(V),postMessage({id:"initDone"});break}case"decodeMesh":if(!G)throw new Error("Draco decoder module is not available");G.then((G=>{const V=d(G,W.dataView,W.attributes,(G=>{postMessage({id:"indices",data:G},[G.buffer])}),((G,V,W,J,R,d)=>{postMessage({id:"attribute",kind:G,data:V,size:W,byteOffset:J,byteStride:R,normalized:d},[V.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:V})}))}}}async function z(G,V,W){return await new Promise(((J,R)=>{const d=V=>{G.removeEventListener("error",d),G.removeEventListener("message",k),R(V)},k=V=>{"initDone"===V.data.id&&(G.removeEventListener("error",d),G.removeEventListener("message",k),J(G))};if(G.addEventListener("error",d),G.addEventListener("message",k),V){const J=V.slice(0);G.postMessage({id:"init",url:W,wasmBinary:J},[J])}else G.postMessage({id:"init",url:W})}))}W.d(V,{c:()=>d,g:()=>k,k:()=>J,n:()=>R,r:()=>z})},11574:(G,V,W)=>{W.d(V,{b:()=>R});var J=W(11353);class R extends J.e{constructor(G){super(),this._buffer=G}get underlyingResource(){return this._buffer}}},11473:(G,V,W)=>{W.d(V,{b:()=>u});var J=W(11317),R=W(11176),d=W(11136),k=W(11345),z=W(11482),X=W(11457),P=W(11492),A=W(11368),x=W(11400);class q{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new d.o(0,0,0),this._diffPositionForCollisions=new d.o(0,0,0),this._collisionResponse=!0}}var L=W(11218),t=W(11390),Y=W(11424),g=W(11145),B=W(11496),S=W(11159),p=W(11324),b=W(11262);class r{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=d.o.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class y{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new r,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=new Map,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new q,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class u extends X.b{static get BILLBOARDMODE_NONE(){return X.b.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return X.b.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return X.b.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return X.b.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return X.b.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return X.b.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(G){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=G}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(G){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=G}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(G){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=G}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(G){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=G}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(G){this._internalAbstractMeshDataInfo._collisionRetryCount=G}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(G){this._internalAbstractMeshDataInfo._morphTargetManager!==G&&(this._internalAbstractMeshDataInfo._morphTargetManager=G,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(G){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==G&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=G,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(G){return!!super._updateNonUniformScalingState(G)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(G){this._internalAbstractMeshDataInfo._rawBoundingInfo=G}set GL(G){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(G)}set onCollisionPositionChange(G){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(G)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(G){if(this._internalAbstractMeshDataInfo._visibility===G)return;const V=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=G,(1===V&&1!==G||1!==V&&1===G)&&this._markSubMeshesAsDirty((G=>{G.markAsMiscDirty(),G.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(G){this._internalAbstractMeshDataInfo._inheritVisibility=G}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let G=this._parentNode;for(;G;){const V=G.isVisible;if("undefined"!==typeof V)return V;G=G.parent}}return this._isVisible}set isVisible(G){this._isVisible=G}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(G){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=G}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(G){this._internalAbstractMeshDataInfo._renderingGroupId=G}get material(){return this._internalAbstractMeshDataInfo._material}set material(G){this._setMaterial(G)}_setMaterial(G){this._internalAbstractMeshDataInfo._material!==G&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=G,G&&G.meshMap&&(G.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.Ed&&(this.resetDrawCache(void 0,null==G),this._unBindEffect()))}getMaterialForRenderPass(G){var V;return null===(V=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===V?void 0:V[G]}setMaterialForRenderPass(G,V){var W;this.resetDrawCache(G),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]);const J=this._internalAbstractMeshDataInfo._materialForRenderPass[G];null!==J&&void 0!==J&&null!==(W=J.meshMap)&&void 0!==W&&W[this.uniqueId]&&(J.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._materialForRenderPass[G]=V,V&&V.meshMap&&(V.meshMap[this.uniqueId]=this)}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(G){this._internalAbstractMeshDataInfo._receiveShadows!==G&&(this._internalAbstractMeshDataInfo._receiveShadows=G,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(G){this._internalAbstractMeshDataInfo._hasVertexAlpha!==G&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=G,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(G){this._internalAbstractMeshDataInfo._useVertexColors!==G&&(this._internalAbstractMeshDataInfo._useVertexColors=G,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(G){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==G&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=G,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(G){this._internalAbstractMeshDataInfo._numBoneInfluencers!==G&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=G,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(G){this._internalAbstractMeshDataInfo._applyFog!==G&&(this._internalAbstractMeshDataInfo._applyFog=G,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(G){this._internalAbstractMeshDataInfo._enableDistantPicking=G}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(G){G!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=G,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(G){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(G)?-1:G}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(G){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=G}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(G){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(G)?-1:G}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(G){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=G}get lightSources(){return this._lightSources}set skeleton(G){const V=this._internalAbstractMeshDataInfo._skeleton;V&&V.needInitialSkinMatrix&&V._unregisterMeshWithPoseMatrix(this),G&&G.needInitialSkinMatrix&&G._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=G,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(G){var V;let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(G,W,!1),V=this,this._internalAbstractMeshDataInfo=new y,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.sA=u.QA,this.onCollideObservable=new R.b,this.onCollisionPositionChangeObservable=new R.b,this.onMaterialChangedObservable=new R.b,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.bX=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=Y.d.Red(),this.outlineWidth=.02,this.overlayColor=Y.d.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.gz=!1,this.CG=!1,this.actionManager=null,this.ellipsoid=new d.o(.5,1,.5),this.ellipsoidOffset=new d.o(0,0,0),this.edgesWidth=1,this.edgesColor=new Y.h(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,Yz:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new R.b,this._onCollisionPositionChange=function(G,W){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;W.subtractToRef(V._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,V._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),V._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>b.b.CollisionsEpsilon&&V.position.addInPlace(V._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),J&&V.onCollideObservable.notifyObservers(J),V.onCollisionPositionChangeObservable.notifyObservers(V.position)},W=this.HG(),W.CP(this),this._resyncLightSources(),this._uniformBuffer=new x.c(this.HG().getEngine(),void 0,void 0,G,!this.HG().getEngine().isWebGPU),this._buildUniformLayout(),W.performancePriority){case 2:this.CG=!0;case 1:this.gz=!0,this.bX=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(G){const V=this._uniformBuffer;V.Td("world",G),V.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),V.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(G){let V="Name: "+this.name+", isInstance: "+("InstancedMesh"===this.getClassName()?"YES":"NO");V+=", # of submeshes: "+(this.Ed?this.Ed.length:0);const W=this._internalAbstractMeshDataInfo._skeleton;return W&&(V+=", skeleton: "+W.name),G&&(V+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],V+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.Yz?"YES":"NO")),V}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==X.b.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(V||this.actionManager.isRecursive)){if(!G)return this.actionManager;if(this.actionManager.hasSpecificTrigger(G))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(G,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.Ed){for(const G of this.Ed)G._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const G of this.HG().lights)G.isEnabled()&&G.canAffectMesh(this)&&this._lightSources.push(G);this._markSubMeshesAsLightDirty()}_resyncLightSource(G){const V=G.isEnabled()&&G.canAffectMesh(this),W=this._lightSources.indexOf(G);let J=!1;if(-1===W){if(!V)return;this._lightSources.push(G)}else{if(V)return;J=!0,this._lightSources.splice(W,1)}this._markSubMeshesAsLightDirty(J)}_unBindEffect(){for(const G of this.Ed)G.setEffect(null)}_removeLightSource(G,V){const W=this._lightSources.indexOf(G);-1!==W&&(this._lightSources.splice(W,1),this._markSubMeshesAsLightDirty(V))}_markSubMeshesAsDirty(G){if(this.Ed)for(const V of this.Ed)for(let W=0;W<V._drawWrappers.length;++W){const J=V._drawWrappers[W];J&&J.defines&&J.defines.markAllAsDirty&&G(J.defines)}}_markSubMeshesAsLightDirty(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((V=>V.markAsLightDirty(G)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((G=>G.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((G=>G.markAsMiscDirty()))}pP(G){return this._currentRenderId=Number.MAX_VALUE,super.pP(G),this._isDirty=!0,this}resetDrawCache(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.Ed)for(const W of this.Ed)W.resetDrawCache(G,V)}get isBlocked(){return!1}getLOD(G){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}Pd(){return null}getVerticesData(G){return null}wG(G,V,W,J){return this}updateVerticesData(G,V,W,J){return this}setIndices(G,V){return this}isVerticesDataPresent(G){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.lG()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(G){return this._boundingInfo=G,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(G,V,W){return this._boundingInfo=new A.d(G,V,W),this._boundingInfo}normalizeToUnitCube(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(G,V,W)}get useBones(){return this.skeleton&&this.HG().skeletonsEnabled&&this.isVerticesDataPresent(k.c.MatricesIndicesKind)&&this.isVerticesDataPresent(k.c.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(G){}_activate(G,V){return this._renderId=G,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===X.b.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(G,V,W){return this.position.addInPlace(this.calcMovePOV(G,V,W)),this}calcMovePOV(G,V,W){const J=new d.c;(this.rotationQuaternion?this.rotationQuaternion:d.g.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(J);const R=d.o.Zero(),k=this.definedFacingForward?-1:1;return d.o.TransformCoordinatesFromFloatsToRef(G*k,V,W*k,J,R),R}rotatePOV(G,V,W){return this.rotation.addInPlace(this.calcRotatePOV(G,V,W)),this}calcRotatePOV(G,V,W){const J=this.definedFacingForward?1:-1;return new d.o(G*J,V,W*J)}mG(G,V){if(G){const W=(0,t.d)(G,0,this.getTotalVertices(),V);this._boundingInfo?this._boundingInfo.reConstruct(W.minimum,W.maximum):this._boundingInfo=new A.d(W.minimum,W.maximum)}if(this.Ed)for(let W=0;W<this.Ed.length;W++)this.Ed[W].refreshBoundingInfo(G);this.lG()}_refreshBoundingInfoDirect(G){if(this._boundingInfo?this._boundingInfo.reConstruct(G.minimum,G.maximum):this._boundingInfo=new A.d(G.minimum,G.maximum),this.Ed)for(let V=0;V<this.Ed.length;V++)this.Ed[V].refreshBoundingInfo(null);this.lG()}static _ApplySkeleton(G,V,W,J,R,z,X){!function(G,V,W,J,R,z,X){const P=d.h.ed[0],A=d.h.Matrix[0],x=d.h.Matrix[1],q=V===k.c.NormalKind?d.o.TransformNormalFromFloatsToRef:d.o.TransformCoordinatesFromFloatsToRef;for(let k=0,L=0;k<G.length;k+=3,L+=4){let V,t;for(A.reset(),V=0;V<4;V++)t=R[L+V],t>0&&(d.c.FromFloat32ArrayToRefScaled(W,Math.floor(16*J[L+V]),t,x),A.addToSelf(x));if(z&&X)for(V=0;V<4;V++)t=X[L+V],t>0&&(d.c.FromFloat32ArrayToRefScaled(W,Math.floor(16*z[L+V]),t,x),A.addToSelf(x));q(G[k],G[k+1],G[k+2],A,P),P.toArray(G,k)}}(G,V,W,J,R,z,X)}_getData(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.c.PositionKind;const J=G.cache,R=G=>{if(J){const V=J._vertexData||(J._vertexData={});return V[G]||this.copyVerticesData(G,V),V[G]}return this.getVerticesData(G)};if(V||(V=R(W)),!V)return null;if(J?(J._outputData?J._outputData.set(V):J._outputData=new Float32Array(V),V=J._outputData):(G.applyMorph&&this.morphTargetManager||G.applySkeleton&&this.skeleton)&&(V=V.slice()),G.applyMorph&&this.morphTargetManager&&function(G,V,W){let J=null;switch(V){case k.c.PositionKind:J=G=>G.getPositions();break;case k.c.NormalKind:J=G=>G.getNormals();break;case k.c.TangentKind:J=G=>G.getTangents();break;case k.c.UVKind:J=G=>G.getUVs();break;case k.c.UV2Kind:J=G=>G.getUV2s();break;case k.c.ColorKind:J=G=>G.getColors();break;default:return}for(let R=0;R<G.length;R++){let V=G[R];for(let d=0;d<W.numTargets;d++){const k=W.getTarget(d),z=k.influence;if(0!==z){const W=J(k);W&&(V+=(W[R]-G[R])*z)}}G[R]=V}}(V,W,this.morphTargetManager),G.applySkeleton&&this.skeleton){const G=R(k.c.MatricesIndicesKind),J=R(k.c.MatricesWeightsKind);if(J&&G){const d=this.numBoneInfluencers>4,z=d?R(k.c.MatricesIndicesExtraKind):null,X=d?R(k.c.MatricesWeightsExtraKind):null,P=this.skeleton.getTransformMatrices(this);u._ApplySkeleton(V,W,P,G,J,z,X)}}if(!1!==G.updatePositionsArray&&W===k.c.PositionKind){const G=this._internalAbstractMeshDataInfo._positions||[],W=G.length;if(G.length=V.length/3,W<G.length)for(let V=W;V<G.length;V++)G[V]=new d.o;for(let J=0,R=0;J<G.length;J++,R+=3)G[J].rd(V[R],V[R+1],V[R+2]);this._internalAbstractMeshDataInfo._positions=G}return V}getNormalsData(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:G,applyMorph:V,updatePositionsArray:!1},null,k.c.NormalKind)}uz(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:G,applyMorph:V,updatePositionsArray:!1},W,k.c.PositionKind)}lG(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new A.d(d.o.Zero(),d.o.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(G){if(!this.Ed)return this;const V=this.Ed.length;for(let W=0;W<V;W++){const J=this.Ed[W];(V>1||!J.IsGlobal)&&J.updateBoundingInfo(G)}return this}_afterComputeWorldMatrix(){this.CG||(this._boundingInfoIsDirty=!0)}isInFrustum(G){return this.getBoundingInfo().isInFrustum(G,this.sA)}isCompletelyInFrustum(G){return this.getBoundingInfo().isCompletelyInFrustum(G)}intersectsMesh(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2?arguments[2]:void 0;const J=this.getBoundingInfo(),R=G.getBoundingInfo();if(J.intersects(R,V))return!0;if(W)for(const d of this.getChildMeshes())if(d.intersectsMesh(G,V,!0))return!0;return!1}intersectsPoint(G){return this.getBoundingInfo().intersectsPoint(G)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(G){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=G}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const W=this.HG().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=W.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,W.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,G,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId,V),this}_collideForSubMesh(G,V,W){var J;if(this._generatePointsArray(),!this._positions)return this;if(!G._lastColliderWorldVertices||!G._lastColliderTransformMatrix.equals(V)){G._lastColliderTransformMatrix=V.clone(),G._lastColliderWorldVertices=[],G._trianglePlanes=[];const W=G.verticesStart,J=G.verticesStart+G.verticesCount;for(let R=W;R<J;R++)G._lastColliderWorldVertices.push(d.o.TransformCoordinates(this._positions[R],V))}return W._collide(G._trianglePlanes,G._lastColliderWorldVertices,this.Pd(),G.indexStart,G.indexStart+G.indexCount,G.verticesStart,!!G.NG(),this,this._shouldConvertRHS(),7===(null===(J=G.NG())||void 0===J?void 0:J.fillMode)),this}_processCollisionsForSubMeshes(G,V){const W=this._scene.getCollidingSubMeshCandidates(this,G),J=W.length;for(let R=0;R<J;R++){const d=W.data[R];J>1&&!d._checkCollision(G)||this._collideForSubMesh(d,V,G)}return this}_shouldConvertRHS(){return!1}_checkCollision(G){if(!this.getBoundingInfo()._checkCollision(G))return this;const V=d.h.Matrix[0],W=d.h.Matrix[1];return d.c.ScalingToRef(1/G._radius.x,1/G._radius.y,1/G._radius.z,V),this.worldMatrixFromCache.multiplyToRef(V,W),this._processCollisionsForSubMeshes(G,W),this}_generatePointsArray(){return!1}intersects(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],R=arguments.length>4?arguments[4]:void 0,k=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const z=new P.d,X=this.getClassName(),A="InstancedLinesMesh"===X||"LinesMesh"===X||"GreasedLineMesh"===X?this.intersectionThreshold:0,x=this.getBoundingInfo();if(!this.Ed)return z;if(!k&&(!G.intersectsSphere(x.boundingSphere,A)||!G.intersectsBox(x.boundingBox,A)))return z;if(J)return z.hit=!k,z.pickedMesh=k?null:this,z.distance=k?0:d.o.Distance(G.origin,x.boundingSphere.center),z.subMeshId=0,z;if(!this._generatePointsArray())return z;let q=null;const L=this._scene.getIntersectingSubMeshCandidates(this,G),t=L.length;let Y=!1;for(let d=0;d<t;d++){const G=L.data[d].NG();if(G&&(7==G.fillMode||0==G.fillMode||1==G.fillMode||2==G.fillMode||4==G.fillMode)){Y=!0;break}}if(!Y)return z.hit=!0,z.pickedMesh=this,z.distance=d.o.Distance(G.origin,x.boundingSphere.center),z.subMeshId=-1,z;for(let d=0;d<t;d++){const J=L.data[d];if(t>1&&!k&&!J.canIntersects(G))continue;const R=J.intersects(G,this._positions,this.Pd(),V,W);if(R&&(V||!q||R.distance<q.distance)&&(q=R,q.subMeshId=d,V))break}if(q){const V=R??this.getWorldMatrix(),W=d.h.ed[0],J=d.h.ed[1];d.o.TransformCoordinatesToRef(G.origin,V,W),G.direction.scaleToRef(q.distance,J);const k=d.o.TransformNormal(J,V).addInPlace(W);return z.hit=!0,z.distance=d.o.Distance(W,k),z.pickedPoint=k,z.pickedMesh=this,z.bu=q.bu||0,z.bv=q.bv||0,z.subMeshFaceId=q.faceId,z.faceId=q.faceId+L.data[q.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),z.subMeshId=q.subMeshId,z}return z}clone(G,V,W){return null}releaseSubMeshes(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.Ed)for(;this.Ed.length;)this.Ed[0].dispose(G);else this.Ed=[];return this}dispose(G){let V,W=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const J=this.HG();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),J.freeActiveMeshes(),J.freeRenderingGroups(),J.renderingManager.maintainStateBetweenFrames&&J.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((G=>G!==this&&G.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),V=0;V<this._intersectionsInProgress.length;V++){const G=this._intersectionsInProgress[V],W=G._intersectionsInProgress.indexOf(this);G._intersectionsInProgress.splice(W,1)}this._intersectionsInProgress.length=0;const R=J.lights;for(const k of R){let G=k.includedOnlyMeshes.indexOf(this);-1!==G&&k.includedOnlyMeshes.splice(G,1),G=k.excludedMeshes.indexOf(this),-1!==G&&k.excludedMeshes.splice(G,1);const V=k.getShadowGenerators();if(V){const W=V.values();for(let V=W.next();!0!==V.done;V=W.next()){const W=V.value.getShadowMap();W&&W.renderList&&(G=W.renderList.indexOf(this),-1!==G&&W.renderList.splice(G,1))}}}"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes(!0);const d=J.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,d.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),d.wipeCaches(),J.vP(this),this._parentContainer){const G=this._parentContainer.meshes.indexOf(this);G>-1&&this._parentContainer.meshes.splice(G,1),this._parentContainer=null}if(W&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!G)for(V=0;V<J.mx.length;V++)J.mx[V].j===this&&(J.mx[V].dispose(),V--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(G,W)}_initFacetData(){const G=this._internalAbstractMeshDataInfo._facetData;G.facetNormals||(G.facetNormals=[]),G.facetPositions||(G.facetPositions=[]),G.facetPartitioning||(G.facetPartitioning=new Array),G.facetNb=this.Pd().length/3|0,G.partitioningSubdivisions=G.partitioningSubdivisions?G.partitioningSubdivisions:10,G.partitioningBBoxRatio=G.partitioningBBoxRatio?G.partitioningBBoxRatio:1.01;for(let V=0;V<G.facetNb;V++)G.facetNormals[V]=d.o.Zero(),G.facetPositions[V]=d.o.Zero();return G.facetDataEnabled=!0,this}updateFacetData(){const G=this._internalAbstractMeshDataInfo._facetData;G.facetDataEnabled||this._initFacetData();const V=this.getVerticesData(k.c.PositionKind),W=this.Pd(),J=this.getVerticesData(k.c.NormalKind),R=this.getBoundingInfo();if(G.facetDepthSort&&!G.facetDepthSortEnabled){if(G.facetDepthSortEnabled=!0,W instanceof Uint16Array)G.depthSortedIndices=new Uint16Array(W);else if(W instanceof Uint32Array)G.depthSortedIndices=new Uint32Array(W);else{let V=!1;for(let G=0;G<W.length;G++)if(W[G]>65535){V=!0;break}G.depthSortedIndices=V?new Uint32Array(W):new Uint16Array(W)}if(G.facetDepthSortFunction=function(G,V){return V.sqDistance-G.sqDistance},!G.facetDepthSortFrom){const V=this.HG().activeCamera;G.facetDepthSortFrom=V?V.position:d.o.Zero()}G.depthSortedFacets=[];for(let V=0;V<G.facetNb;V++){const W={ind:3*V,sqDistance:0};G.depthSortedFacets.push(W)}G.invertedMatrix=d.c.Identity(),G.facetDepthSortOrigin=d.o.Zero()}G.bbSize.x=R.maximum.x-R.minimum.x>g.c?R.maximum.x-R.minimum.x:g.c,G.bbSize.y=R.maximum.y-R.minimum.y>g.c?R.maximum.y-R.minimum.y:g.c,G.bbSize.z=R.maximum.z-R.minimum.z>g.c?R.maximum.z-R.minimum.z:g.c;let X=G.bbSize.x>G.bbSize.y?G.bbSize.x:G.bbSize.y;if(X=X>G.bbSize.z?X:G.bbSize.z,G.subDiv.max=G.partitioningSubdivisions,G.subDiv.X=Math.floor(G.subDiv.max*G.bbSize.x/X),G.subDiv.Y=Math.floor(G.subDiv.max*G.bbSize.y/X),G.subDiv.Z=Math.floor(G.subDiv.max*G.bbSize.z/X),G.subDiv.X=G.subDiv.X<1?1:G.subDiv.X,G.subDiv.Y=G.subDiv.Y<1?1:G.subDiv.Y,G.subDiv.Z=G.subDiv.Z<1?1:G.subDiv.Z,G.facetParameters.facetNormals=this.getFacetLocalNormals(),G.facetParameters.facetPositions=this.getFacetLocalPositions(),G.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),G.facetParameters.bInfo=R,G.facetParameters.bbSize=G.bbSize,G.facetParameters.subDiv=G.subDiv,G.facetParameters.ratio=this.partitioningBBoxRatio,G.facetParameters.depthSort=G.facetDepthSort,G.facetDepthSort&&G.facetDepthSortEnabled&&(this.kd(!0),this._worldMatrix.invertToRef(G.invertedMatrix),d.o.TransformCoordinatesToRef(G.facetDepthSortFrom,G.invertedMatrix,G.facetDepthSortOrigin),G.facetParameters.distanceTo=G.facetDepthSortOrigin),G.facetParameters.depthSortedFacets=G.depthSortedFacets,J&&z.b.ComputeNormals(V,W,J,G.facetParameters),G.facetDepthSort&&G.facetDepthSortEnabled){G.depthSortedFacets.sort(G.facetDepthSortFunction);const V=G.depthSortedIndices.length/3|0;for(let J=0;J<V;J++){const V=G.depthSortedFacets[J].ind;G.depthSortedIndices[3*J]=W[V],G.depthSortedIndices[3*J+1]=W[V+1],G.depthSortedIndices[3*J+2]=W[V+2]}this.updateIndices(G.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const G=this._internalAbstractMeshDataInfo._facetData;return G.facetNormals||this.updateFacetData(),G.facetNormals}getFacetLocalPositions(){const G=this._internalAbstractMeshDataInfo._facetData;return G.facetPositions||this.updateFacetData(),G.facetPositions}getFacetLocalPartitioning(){const G=this._internalAbstractMeshDataInfo._facetData;return G.facetPartitioning||this.updateFacetData(),G.facetPartitioning}getFacetPosition(G){const V=d.o.Zero();return this.getFacetPositionToRef(G,V),V}getFacetPositionToRef(G,V){const W=this.getFacetLocalPositions()[G],J=this.getWorldMatrix();return d.o.TransformCoordinatesToRef(W,J,V),this}getFacetNormal(G){const V=d.o.Zero();return this.getFacetNormalToRef(G,V),V}getFacetNormalToRef(G,V){const W=this.getFacetLocalNormals()[G];return d.o.TransformNormalToRef(W,this.getWorldMatrix(),V),this}getFacetsAtLocalCoordinates(G,V,W){const J=this.getBoundingInfo(),R=this._internalAbstractMeshDataInfo._facetData,d=Math.floor((G-J.minimum.x*R.partitioningBBoxRatio)*R.subDiv.X*R.partitioningBBoxRatio/R.bbSize.x),k=Math.floor((V-J.minimum.y*R.partitioningBBoxRatio)*R.subDiv.Y*R.partitioningBBoxRatio/R.bbSize.y),z=Math.floor((W-J.minimum.z*R.partitioningBBoxRatio)*R.subDiv.Z*R.partitioningBBoxRatio/R.bbSize.z);return d<0||d>R.subDiv.max||k<0||k>R.subDiv.max||z<0||z>R.subDiv.max?null:R.facetPartitioning[d+R.subDiv.max*k+R.subDiv.max*R.subDiv.max*z]}getClosestFacetAtCoordinates(G,V,W,J){let R=arguments.length>4&&void 0!==arguments[4]&&arguments[4],k=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const z=this.getWorldMatrix(),X=d.h.Matrix[5];z.invertToRef(X);const P=d.h.ed[8];d.o.TransformCoordinatesFromFloatsToRef(G,V,W,X,P);const A=this.getClosestFacetAtLocalCoordinates(P.x,P.y,P.z,J,R,k);return J&&d.o.TransformCoordinatesFromFloatsToRef(J.x,J.y,J.z,z,J),A}getClosestFacetAtLocalCoordinates(G,V,W,J){let R=arguments.length>4&&void 0!==arguments[4]&&arguments[4],d=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],k=null,z=0,X=0,P=0,A=0,x=0,q=0,L=0,t=0;const Y=this.getFacetLocalPositions(),g=this.getFacetLocalNormals(),B=this.getFacetsAtLocalCoordinates(G,V,W);if(!B)return null;let S,p,b,r=Number.MAX_VALUE,y=r;for(let u=0;u<B.length;u++)S=B[u],p=g[S],b=Y[S],A=(G-b.x)*p.x+(V-b.y)*p.y+(W-b.z)*p.z,(!R||R&&d&&A>=0||R&&!d&&A<=0)&&(A=p.x*b.x+p.y*b.y+p.z*b.z,x=-(p.x*G+p.y*V+p.z*W-A)/(p.x*p.x+p.y*p.y+p.z*p.z),q=G+p.x*x,L=V+p.y*x,t=W+p.z*x,z=q-G,X=L-V,P=t-W,y=z*z+X*X+P*P,y<r&&(r=y,k=S,J&&(J.x=q,J.y=L,J.z=t)));return k}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const G=this._internalAbstractMeshDataInfo._facetData;return G.facetDataEnabled&&(G.facetDataEnabled=!1,G.facetPositions=[],G.facetNormals=[],G.facetPartitioning=new Array,G.facetParameters={},G.depthSortedIndices=new Uint32Array(0)),this}updateIndices(G,V){return this}createNormals(G){const V=this.getVerticesData(k.c.PositionKind),W=this.Pd();let J;return J=this.isVerticesDataPresent(k.c.NormalKind)?this.getVerticesData(k.c.NormalKind):[],z.b.ComputeNormals(V,W,J,{useRightHandedSystem:this.HG().useRightHandedSystem}),this.wG(k.c.NormalKind,J,G),this}async optimizeIndicesAsync(){const G=this.Pd();if(!G)return this;const{OptimizeIndices:V}=await W.e(35).then(W.bind(W,13815));return V(G),this.setIndices(G,this.getTotalVertices()),this}alignWithNormal(G,V){V||(V=B.e.Y);const W=d.h.ed[0],J=d.h.ed[1];return d.o.CrossToRef(V,G,J),d.o.CrossToRef(G,J,W),this.rotationQuaternion?d.g.RotationQuaternionFromAxisToRef(W,G,J,this.rotationQuaternion):d.o.RotationFromAxisToRef(W,G,J,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,L.e)("EdgesRenderer")}enableEdgesRendering(G,V,W){throw(0,L.e)("EdgesRenderer")}wx(){return this._scene.mx.filter((G=>G.j===this))}}u.OCCLUSION_TYPE_NONE=0,u.OCCLUSION_TYPE_OPTIMISTIC=1,u.OCCLUSION_TYPE_STRICT=2,u.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,u.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,u.CULLINGSTRATEGY_STANDARD=0,u.QA=1,u.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,u.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,J.e)([p.f.filter((function(){for(var G=arguments.length,V=new Array(G),W=0;W<G;W++)V[W]=arguments[W];let[J,R,d,k,z]=V;return!Array.isArray(J)&&!Array.isArray(R)&&!Array.isArray(d)&&!Array.isArray(k)&&!Array.isArray(z)}))],u,"_ApplySkeleton",null),(0,S.d)("BABYLON.AbstractMesh",u)},11929:(G,V,W)=>{W.d(V,{d:()=>J.c});var J=W(11345)},11538:(G,V,W)=>{W.d(V,{d:()=>g});var J=W(11136),R=W(11424),d=W(11482),k=W(11345),z=W(11339),X=W(11543),P=W(11368),A=W(11189),x=W(11416),q=W(11390),L=W(11169),t=W(11552),Y=W(11358);class g{get boundingBias(){return this._boundingBias}set boundingBias(G){this._boundingBias?this._boundingBias.J(G):this._boundingBias=G.clone(),this.lG(!0,null)}static CreateGeometryForMesh(G){const V=new g(g.RandomId(),G.HG());return V.vG(G),V}get meshes(){return this._meshes}constructor(G,V,W){let R=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._extend={minimum:new J.o(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),maximum:new J.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=V||L.c.LastCreatedScene,this._scene&&(this.id=G,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=R,W?this.setAllVerticesData(W,R):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),d&&(this.vG(d),d.kd(!0)))}get extend(){return this._extend}HG(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let G=0;G<this._meshes.length;G++)if(!this._meshes[G].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const G=new Set;for(const V in this._vertexBuffers)G.add(this._vertexBuffers[V].getWrapperBuffer());G.forEach((G=>{G._rebuild()}))}setAllVerticesData(G,V){G.applyToGeometry(this,V),this._notifyUpdate()}wG(G,V){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3?arguments[3]:void 0;W&&Array.isArray(V)&&(V=new Float32Array(V));const R=new k.c(this._engine,V,G,{updatable:W,postponeInternalCreation:0===this._meshes.length,stride:J,label:"Geometry_"+this.id+"_"+G});this.setVerticesBuffer(R)}removeVerticesData(G){this._vertexBuffers[G]&&(this._vertexBuffers[G].dispose(),delete this._vertexBuffers[G]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const R=G.getKind();this._vertexBuffers[R]&&W&&this._vertexBuffers[R].dispose(),G._buffer&&G._buffer._increaseReferences(),this._vertexBuffers[R]=G;const d=this._meshes,z=d.length;if(R===k.c.PositionKind){this._totalVertices=V??G._maxVerticesCount,this._updateExtend(G.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const W=this._extend&&this._extend.minimum||new J.o(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),R=this._extend&&this._extend.maximum||new J.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let G=0;G<z;G++){const V=d[G];V.buildBoundingInfo(W,R),V._createGlobalSubMesh(V.isUnIndexed),V.kd(!0),V.synchronizeInstances()}}this._notifyUpdate(R)}updateVerticesDataDirectly(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const R=this.getVertexBuffer(G);R&&(R.updateDirectly(V,W,J),this._notifyUpdate(G))}updateVerticesData(G,V){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const J=this.getVertexBuffer(G);J&&(J.update(V),G===k.c.PositionKind&&this.lG(W,V),this._notifyUpdate(G))}lG(G,V){if(G&&this._updateExtend(V),this._resetPointsArrayCache(),G){const G=this._meshes;for(const V of G){V.hasBoundingInfo?V.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):V.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const G=V.Ed;for(const V of G)V.refreshBoundingInfo()}}}_bind(G,V,W,J){if(!G)return;void 0===V&&(V=this._indexBuffer);const R=this.getVertexBuffers();if(!R)return;if(V!=this._indexBuffer||!this._vertexArrayObjects&&!J)return void this._engine.bindBuffers(R,V,G,W);const d=J||this._vertexArrayObjects,k=this._engine;d[G.key]||(d[G.key]=k.recordVertexArrayObject(R,V,G,W)),k.bindVertexArrayObject(d[G.key],V)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(G,V,W){const J=this.getVertexBuffer(G);return J?J.getFloatData(this._totalVertices,W||V&&1!==this._meshes.length):null}copyVerticesData(G,V){const W=this.getVertexBuffer(G);if(!W)return;V[G]||(V[G]=new Float32Array(this._totalVertices*W.getSize()));const J=W.getData();J&&(0,Y.e)(J,W.getSize(),W.type,W.byteOffset,W.byteStride,W.normalized,this._totalVertices,V[G])}isVertexBufferUpdatable(G){const V=this._vertexBuffers[G];return!!V&&V.isUpdatable()}getVertexBuffer(G){return this.isReady()?this._vertexBuffers[G]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(G){return this._vertexBuffers?void 0!==this._vertexBuffers[G]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(G)}getVerticesDataKinds(){const G=[];let V;if(!this._vertexBuffers&&this._delayInfo)for(V in this._delayInfo)G.push(V);else for(V in this._vertexBuffers)G.push(V);return G}updateIndices(G,V){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const J=G.length!==this._indices.length;if(W||(this._indices=G.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,G,V),J)for(const G of this._meshes)G._createGlobalSubMesh(!0)}else this.setIndices(G,null,!0)}setIndexBuffer(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=G,this._totalVertices=V,this._totalIndices=W,G.is32Bits=null===J?V>65535:J;for(const R of this._meshes)R._createGlobalSubMesh(!0),R.synchronizeInstances();this._notifyUpdate()}setIndices(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=G,this._indexBufferIsUpdatable=W,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,W,"Geometry_"+this.id+"_IndexBuffer")),void 0!=V&&(this._totalVertices=V);for(const R of this._meshes)R._createGlobalSubMesh(!J),R.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}Pd(G,V){if(!this.isReady())return null;const W=this._indices;return V||G&&1!==this._meshes.length?W.slice():W}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;G&&this._vertexArrayObjects&&this._vertexArrayObjects[G.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[G.key]),delete this._vertexArrayObjects[G.key])}releaseForMesh(G,V){const W=this._meshes,J=W.indexOf(G);-1!==J&&(W.splice(J,1),this._vertexArrayObjects&&G._invalidateInstanceVertexArrayObject(),G._geometry=null,0===W.length&&V&&this.dispose())}vG(G){if(G._geometry===this)return;const V=G._geometry;V&&V.releaseForMesh(G),this._vertexArrayObjects&&G._invalidateInstanceVertexArrayObject();const W=this._meshes;G._geometry=this,G._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),W.push(G),this.isReady()?this._applyToMesh(G):this._boundingInfo&&G.setBoundingInfo(this._boundingInfo)}_updateExtend(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!G&&(G=this.getVerticesData(k.c.PositionKind),!G))return;this._extend=(0,q.d)(G,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(G){const V=this._meshes.length;for(const W in this._vertexBuffers)1===V&&this._vertexBuffers[W].create(),W===k.c.PositionKind&&(this._extend||this._updateExtend(),G.buildBoundingInfo(this._extend.minimum,this._extend.maximum),G._createGlobalSubMesh(G.isUnIndexed),G.lG());1===V&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),G._syncGeometryWithMorphTargetManager(),G.synchronizeInstances()}_notifyUpdate(G){this.onGeometryUpdated&&this.onGeometryUpdated(this,G),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const V of this._meshes)V._markSubMeshesAsAttributesDirty()}load(G,V){2!==this.delayLoadState&&(this.isReady()?V&&V():(this.delayLoadState=2,this._queueLoad(G,V)))}_queueLoad(G,V){this.delayLoadingFile&&(G.addPendingData(this),G._loadFile(this.delayLoadingFile,(W=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(W),this),this.delayLoadState=1,this._delayInfo=[],G.removePendingData(this);const J=this._meshes,R=J.length;for(let G=0;G<R;G++)this._applyToMesh(J[G]);V&&V()}),void 0,!0))}toLeftHanded(){const G=this.Pd(!1);if(null!=G&&G.length>0){for(let V=0;V<G.length;V+=3){const W=G[V+0];G[V+0]=G[V+2],G[V+2]=W}this.setIndices(G)}const V=this.getVerticesData(k.c.PositionKind,!1);if(null!=V&&V.length>0){for(let G=0;G<V.length;G+=3)V[G+2]=-V[G+2];this.wG(k.c.PositionKind,V,!1)}const W=this.getVerticesData(k.c.NormalKind,!1);if(null!=W&&W.length>0){for(let G=0;G<W.length;G+=3)W[G+2]=-W[G+2];this.wG(k.c.NormalKind,W,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const G=this.getVerticesData(k.c.PositionKind);if(!G||0===G.length)return!1;for(let V=3*this._positionsCache.length,W=this._positionsCache.length;V<G.length;V+=3,++W)this._positionsCache[W]=J.o.ld(G,V);for(let V=0,W=0;V<G.length;V+=3,++W)this._positionsCache[W].set(G[0+V],G[1+V],G[2+V]);return this._positionsCache.length=G.length/3,this._positions=this._positionsCache,!0}P(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const W in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[W]);this._vertexArrayObjects={};const G=this._meshes,V=G.length;for(let W=0;W<V;W++)G[W]._invalidateInstanceVertexArrayObject()}}dispose(){const G=this._meshes,V=G.length;let W;for(W=0;W<V;W++)this.releaseForMesh(G[W]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const J in this._vertexBuffers)this._vertexBuffers[J].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const G=this._parentContainer.geometries.indexOf(this);G>-1&&this._parentContainer.geometries.splice(G,1),this._parentContainer=null}this._isDisposed=!0}i(G){const V=new d.b;V.indices=[];const W=this.Pd();if(W)for(let d=0;d<W.length;d++)V.indices.push(W[d]);let J,R=!1,k=!1;for(J in this._vertexBuffers){const G=this.getVerticesData(J);if(G&&(G instanceof Float32Array?V.set(new Float32Array(G),J):V.set(G.slice(0),J),!k)){const G=this.getVertexBuffer(J);G&&(R=G.isUpdatable(),k=!R)}}const z=new g(G,this._scene,V,R);for(J in z.delayLoadState=this.delayLoadState,z.delayLoadingFile=this.delayLoadingFile,z._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)z._delayInfo=z._delayInfo||[],z._delayInfo.push(J);return z._boundingInfo=new P.d(this._extend.minimum,this._extend.maximum),z}serialize(){const G={};return G.id=this.id,G.uniqueId=this.uniqueId,G.updatable=this._updatable,x.c&&x.c.HasTags(this)&&(G.tags=x.c.GetTags(this)),G}_toNumberArray(G){return Array.isArray(G)?G:Array.prototype.slice.call(G)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const G in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,G)&&(this._vertexBuffers[G]._buffer._data=null)}serializeVerticeData(){const G=this.serialize();return this.isVerticesDataPresent(k.c.PositionKind)&&(G.DG=this._toNumberArray(this.getVerticesData(k.c.PositionKind)),this.isVertexBufferUpdatable(k.c.PositionKind)&&(G.positionsUpdatable=!0)),this.isVerticesDataPresent(k.c.NormalKind)&&(G.iG=this._toNumberArray(this.getVerticesData(k.c.NormalKind)),this.isVertexBufferUpdatable(k.c.NormalKind)&&(G.normalsUpdatable=!0)),this.isVerticesDataPresent(k.c.TangentKind)&&(G.tangents=this._toNumberArray(this.getVerticesData(k.c.TangentKind)),this.isVertexBufferUpdatable(k.c.TangentKind)&&(G.tangentsUpdatable=!0)),this.isVerticesDataPresent(k.c.UVKind)&&(G.FG=this._toNumberArray(this.getVerticesData(k.c.UVKind)),this.isVertexBufferUpdatable(k.c.UVKind)&&(G.uvsUpdatable=!0)),this.isVerticesDataPresent(k.c.UV2Kind)&&(G.uvs2=this._toNumberArray(this.getVerticesData(k.c.UV2Kind)),this.isVertexBufferUpdatable(k.c.UV2Kind)&&(G.uvs2Updatable=!0)),this.isVerticesDataPresent(k.c.UV3Kind)&&(G.uvs3=this._toNumberArray(this.getVerticesData(k.c.UV3Kind)),this.isVertexBufferUpdatable(k.c.UV3Kind)&&(G.uvs3Updatable=!0)),this.isVerticesDataPresent(k.c.UV4Kind)&&(G.uvs4=this._toNumberArray(this.getVerticesData(k.c.UV4Kind)),this.isVertexBufferUpdatable(k.c.UV4Kind)&&(G.uvs4Updatable=!0)),this.isVerticesDataPresent(k.c.UV5Kind)&&(G.uvs5=this._toNumberArray(this.getVerticesData(k.c.UV5Kind)),this.isVertexBufferUpdatable(k.c.UV5Kind)&&(G.uvs5Updatable=!0)),this.isVerticesDataPresent(k.c.UV6Kind)&&(G.uvs6=this._toNumberArray(this.getVerticesData(k.c.UV6Kind)),this.isVertexBufferUpdatable(k.c.UV6Kind)&&(G.uvs6Updatable=!0)),this.isVerticesDataPresent(k.c.ColorKind)&&(G.eG=this._toNumberArray(this.getVerticesData(k.c.ColorKind)),this.isVertexBufferUpdatable(k.c.ColorKind)&&(G.colorsUpdatable=!0)),this.isVerticesDataPresent(k.c.MatricesIndicesKind)&&(G.matricesIndices=this._toNumberArray(this.getVerticesData(k.c.MatricesIndicesKind)),G.matricesIndicesExpanded=!0,this.isVertexBufferUpdatable(k.c.MatricesIndicesKind)&&(G.matricesIndicesUpdatable=!0)),this.isVerticesDataPresent(k.c.MatricesWeightsKind)&&(G.matricesWeights=this._toNumberArray(this.getVerticesData(k.c.MatricesWeightsKind)),this.isVertexBufferUpdatable(k.c.MatricesWeightsKind)&&(G.matricesWeightsUpdatable=!0)),G.indices=this._toNumberArray(this.Pd()),G}static ExtractFromMesh(G,V){const W=G._geometry;return W?W.i(V):null}static RandomId(){return A.h.RandomId()}static _GetGeometryByLoadedUniqueId(G,V){for(let W=0;W<V.geometries.length;W++)if(V.geometries[W]._loadedUniqueId===G)return V.geometries[W];return null}static _ImportGeometry(G,V){const W=V.HG(),J=G.geometryUniqueId,d=G.geometryId;if(J||d){const G=J?this._GetGeometryByLoadedUniqueId(J,W):W.getGeometryById(d);G&&G.vG(V)}else if(G instanceof ArrayBuffer){const W=V._binaryInfo;if(W.positionsAttrDesc&&W.positionsAttrDesc.count>0){const J=new Float32Array(G,W.positionsAttrDesc.offset,W.positionsAttrDesc.count);V.wG(k.c.PositionKind,J,!1)}if(W.normalsAttrDesc&&W.normalsAttrDesc.count>0){const J=new Float32Array(G,W.normalsAttrDesc.offset,W.normalsAttrDesc.count);V.wG(k.c.NormalKind,J,!1)}if(W.tangetsAttrDesc&&W.tangetsAttrDesc.count>0){const J=new Float32Array(G,W.tangetsAttrDesc.offset,W.tangetsAttrDesc.count);V.wG(k.c.TangentKind,J,!1)}if(W.uvsAttrDesc&&W.uvsAttrDesc.count>0){const J=new Float32Array(G,W.uvsAttrDesc.offset,W.uvsAttrDesc.count);if(t.b)for(let G=1;G<J.length;G+=2)J[G]=1-J[G];V.wG(k.c.UVKind,J,!1)}if(W.uvs2AttrDesc&&W.uvs2AttrDesc.count>0){const J=new Float32Array(G,W.uvs2AttrDesc.offset,W.uvs2AttrDesc.count);if(t.b)for(let G=1;G<J.length;G+=2)J[G]=1-J[G];V.wG(k.c.UV2Kind,J,!1)}if(W.uvs3AttrDesc&&W.uvs3AttrDesc.count>0){const J=new Float32Array(G,W.uvs3AttrDesc.offset,W.uvs3AttrDesc.count);if(t.b)for(let G=1;G<J.length;G+=2)J[G]=1-J[G];V.wG(k.c.UV3Kind,J,!1)}if(W.uvs4AttrDesc&&W.uvs4AttrDesc.count>0){const J=new Float32Array(G,W.uvs4AttrDesc.offset,W.uvs4AttrDesc.count);if(t.b)for(let G=1;G<J.length;G+=2)J[G]=1-J[G];V.wG(k.c.UV4Kind,J,!1)}if(W.uvs5AttrDesc&&W.uvs5AttrDesc.count>0){const J=new Float32Array(G,W.uvs5AttrDesc.offset,W.uvs5AttrDesc.count);if(t.b)for(let G=1;G<J.length;G+=2)J[G]=1-J[G];V.wG(k.c.UV5Kind,J,!1)}if(W.uvs6AttrDesc&&W.uvs6AttrDesc.count>0){const J=new Float32Array(G,W.uvs6AttrDesc.offset,W.uvs6AttrDesc.count);if(t.b)for(let G=1;G<J.length;G+=2)J[G]=1-J[G];V.wG(k.c.UV6Kind,J,!1)}if(W.colorsAttrDesc&&W.colorsAttrDesc.count>0){const J=new Float32Array(G,W.colorsAttrDesc.offset,W.colorsAttrDesc.count);V.wG(k.c.ColorKind,J,!1,W.colorsAttrDesc.stride)}if(W.matricesIndicesAttrDesc&&W.matricesIndicesAttrDesc.count>0){const J=new Int32Array(G,W.matricesIndicesAttrDesc.offset,W.matricesIndicesAttrDesc.count),R=[];for(let G=0;G<J.length;G++){const V=J[G];R.push(255&V),R.push((65280&V)>>8),R.push((16711680&V)>>16),R.push(V>>24&255)}V.wG(k.c.MatricesIndicesKind,R,!1)}if(W.matricesIndicesExtraAttrDesc&&W.matricesIndicesExtraAttrDesc.count>0){const J=new Int32Array(G,W.matricesIndicesExtraAttrDesc.offset,W.matricesIndicesExtraAttrDesc.count),R=[];for(let G=0;G<J.length;G++){const V=J[G];R.push(255&V),R.push((65280&V)>>8),R.push((16711680&V)>>16),R.push(V>>24&255)}V.wG(k.c.MatricesIndicesExtraKind,R,!1)}if(W.matricesWeightsAttrDesc&&W.matricesWeightsAttrDesc.count>0){const J=new Float32Array(G,W.matricesWeightsAttrDesc.offset,W.matricesWeightsAttrDesc.count);V.wG(k.c.MatricesWeightsKind,J,!1)}if(W.indicesAttrDesc&&W.indicesAttrDesc.count>0){const J=new Int32Array(G,W.indicesAttrDesc.offset,W.indicesAttrDesc.count);V.setIndices(J,null)}if(W.subMeshesAttrDesc&&W.subMeshesAttrDesc.count>0){const J=new Int32Array(G,W.subMeshesAttrDesc.offset,5*W.subMeshesAttrDesc.count);V.Ed=[];for(let G=0;G<W.subMeshesAttrDesc.count;G++){const W=J[5*G+0],R=J[5*G+1],d=J[5*G+2],k=J[5*G+3],X=J[5*G+4];z.e.AddToMesh(W,R,d,k,X,V)}}}else if(G.DG&&G.iG&&G.indices){if(V.wG(k.c.PositionKind,G.DG,G.DG._updatable||G.positionsUpdatable),V.wG(k.c.NormalKind,G.iG,G.iG._updatable||G.normalsUpdatable),G.tangents&&V.wG(k.c.TangentKind,G.tangents,G.tangents._updatable||G.tangentsUpdatable),G.FG&&V.wG(k.c.UVKind,G.FG,G.FG._updatable||G.uvsUpdatable),G.uvs2&&V.wG(k.c.UV2Kind,G.uvs2,G.uvs2._updatable||G.uvs2Updatable),G.uvs3&&V.wG(k.c.UV3Kind,G.uvs3,G.uvs3._updatable||G.uvs3Updatable),G.uvs4&&V.wG(k.c.UV4Kind,G.uvs4,G.uvs4._updatable||G.uvs4Updatable),G.uvs5&&V.wG(k.c.UV5Kind,G.uvs5,G.uvs5._updatable||G.uvs5Updatable),G.uvs6&&V.wG(k.c.UV6Kind,G.uvs6,G.uvs6._updatable||G.uvs6Updatable),G.eG&&V.wG(k.c.ColorKind,R.h.CheckColors4(G.eG,G.DG.length/3),G.eG._updatable),G.matricesIndices)if(G.matricesIndices._isExpanded||G.matricesIndicesExpanded)delete G.matricesIndices._isExpanded,delete G.matricesIndicesExpanded,V.wG(k.c.MatricesIndicesKind,G.matricesIndices,G.matricesIndices._updatable||G.matricesIndicesUpdatable);else{const W=[];for(let V=0;V<G.matricesIndices.length;V++){const J=G.matricesIndices[V];W.push(255&J),W.push((65280&J)>>8),W.push((16711680&J)>>16),W.push(J>>24&255)}V.wG(k.c.MatricesIndicesKind,W,G.matricesIndices._updatable||G.matricesIndicesUpdatable)}if(G.matricesIndicesExtra)if(G.matricesIndicesExtraExpanded||G.matricesIndicesExtra._isExpanded)delete G.matricesIndices._isExpanded,delete G.matricesIndicesExtraExpanded,V.wG(k.c.MatricesIndicesExtraKind,G.matricesIndicesExtra,G.matricesIndicesExtra._updatable||G.matricesIndicesExtraUpdatable);else{const W=[];for(let V=0;V<G.matricesIndicesExtra.length;V++){const J=G.matricesIndicesExtra[V];W.push(255&J),W.push((65280&J)>>8),W.push((16711680&J)>>16),W.push(J>>24&255)}V.wG(k.c.MatricesIndicesExtraKind,W,G.matricesIndicesExtra._updatable||G.matricesIndicesExtraUpdatable)}G.matricesWeights&&(g._CleanMatricesWeights(G,V),V.wG(k.c.MatricesWeightsKind,G.matricesWeights,G.matricesWeights._updatable)),G.matricesWeightsExtra&&V.wG(k.c.MatricesWeightsExtraKind,G.matricesWeightsExtra,G.matricesWeights._updatable),V.setIndices(G.indices,null)}if(G.Ed){V.Ed=[];for(let W=0;W<G.Ed.length;W++){const J=G.Ed[W];z.e.AddToMesh(J.materialIndex,J.verticesStart,J.verticesCount,J.indexStart,J.indexCount,V)}}V._shouldGenerateFlatShading&&(V.convertToFlatShadedMesh(),V._shouldGenerateFlatShading=!1),V.kd(!0),W.onMeshImportedObservable.notifyObservers(V)}static _CleanMatricesWeights(G,V){const W=.001;if(!X.d.CleanBoneMatrixWeights)return;let J=0;if(!(G.skeletonId>-1))return;{const W=V.HG().getLastSkeletonById(G.skeletonId);if(!W)return;J=W.bones.length}const R=V.getVerticesData(k.c.MatricesIndicesKind),d=V.getVerticesData(k.c.MatricesIndicesExtraKind),z=G.matricesWeights,P=G.matricesWeightsExtra,A=G.numBoneInfluencer,x=z.length;for(let k=0;k<x;k+=4){let G=0,V=-1;for(let J=0;J<4;J++){const R=z[k+J];G+=R,R<W&&V<0&&(V=J)}if(P)for(let J=0;J<4;J++){const R=P[k+J];G+=R,R<W&&V<0&&(V=J+4)}if((V<0||V>A-1)&&(V=A-1),G>W){const V=1/G;for(let G=0;G<4;G++)z[k+G]*=V;if(P)for(let G=0;G<4;G++)P[k+G]*=V}else V>=4?(P[k+V-4]=1-G,d[k+V-4]=J):(z[k+V]=1-G,R[k+V]=J)}V.wG(k.c.MatricesIndicesKind,R),G.matricesWeightsExtra&&V.wG(k.c.MatricesIndicesExtraKind,d)}static Parse(G,V,W){const R=new g(G.id,V,void 0,G.updatable);return R._loadedUniqueId=G.uniqueId,x.c&&x.c.AddTagsTo(R,G.tags),G.delayLoadingFile?(R.delayLoadState=4,R.delayLoadingFile=W+G.delayLoadingFile,R._boundingInfo=new P.d(J.o.ld(G.boundingBoxMinimum),J.o.ld(G.boundingBoxMaximum)),R._delayInfo=[],G.hasUVs&&R._delayInfo.push(k.c.UVKind),G.hasUVs2&&R._delayInfo.push(k.c.UV2Kind),G.hasUVs3&&R._delayInfo.push(k.c.UV3Kind),G.hasUVs4&&R._delayInfo.push(k.c.UV4Kind),G.hasUVs5&&R._delayInfo.push(k.c.UV5Kind),G.hasUVs6&&R._delayInfo.push(k.c.UV6Kind),G.hasColors&&R._delayInfo.push(k.c.ColorKind),G.hasMatricesIndices&&R._delayInfo.push(k.c.MatricesIndicesKind),G.hasMatricesWeights&&R._delayInfo.push(k.c.MatricesWeightsKind),R._delayLoadingFunction=d.b.ImportVertexData):d.b.ImportVertexData(G,R),V.pushGeometry(R,!0),R}}},11501:(G,V,W)=>{W.d(V,{c:()=>q});var J=W(11136),R=W(11201),d=W(11473),k=W(11510),z=W(11204),X=W(11457),P=W(11345),A=W(11189),x=W(11159);k.b._instancedMeshFactory=(G,V)=>{const W=new q(G,V);if(V.instancedBuffers){W.instancedBuffers={};for(const G in V.instancedBuffers)W.instancedBuffers[G]=V.instancedBuffers[G]}return W};class q extends d.b{constructor(G,V){super(G,V.HG()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,V.Ox(this),this._sourceMesh=V,this._unIndexed=V._unIndexed,this.position.J(V.position),this.rotation.J(V.rotation),this.vd.J(V.vd),V.rotationQuaternion&&(this.rotationQuaternion=V.rotationQuaternion.clone()),this.animations=V.animations.slice();for(const W of V.getAnimationRanges())null!=W&&this.createAnimationRange(W.name,W.from,W.to);if(this.infiniteDistance=V.infiniteDistance,this.setPivotMatrix(V.getPivotMatrix()),V.skeleton||V.morphTargetManager||!V.hasBoundingInfo)this.refreshBoundingInfo(!0,!0);else{const G=V.getBoundingInfo();this.buildBoundingInfo(G.minimum,G.maximum)}this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(G){var V;(null===(V=this._sourceMesh)||void 0===V?void 0:V.receiveShadows)!==G&&A.h.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(G){var V;(null===(V=this._sourceMesh)||void 0===V?void 0:V.material)!==G&&A.h.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(G){var V;(null===(V=this._sourceMesh)||void 0===V?void 0:V.visibility)!==G&&A.h.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(G){var V;(null===(V=this._sourceMesh)||void 0===V?void 0:V.skeleton)!==G&&A.h.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(G){this._sourceMesh&&G!==this._sourceMesh.renderingGroupId&&R.c.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}get zd(){return this._sourceMesh._geometry}createInstance(G){return this._sourceMesh.createInstance(G)}isReady(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(G,!0)}getVerticesData(G,V,W){return this._sourceMesh.getVerticesData(G,V,W)}copyVerticesData(G,V){this._sourceMesh.copyVerticesData(G,V)}wG(G,V,W,J){return this.sourceMesh&&this.sourceMesh.wG(G,V,W,J),this.sourceMesh}updateVerticesData(G,V,W,J){return this.sourceMesh&&this.sourceMesh.updateVerticesData(G,V,W,J),this.sourceMesh}setIndices(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(G,V),this.sourceMesh}isVerticesDataPresent(G){return this._sourceMesh.isVerticesDataPresent(G)}Pd(){return this._sourceMesh.Pd()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let G,V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],W=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;G="object"===typeof V?V:{applySkeleton:V,applyMorph:W};const J=this._sourceMesh.zd?this._sourceMesh.zd.boundingBias:null;return this.mG(this._sourceMesh._getData(G,null,P.c.PositionKind),J),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(G,V){if(super._activate(G,V),this._sourceMesh.Ed||R.c.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,G),V){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD!==this._sourceMesh&&this._currentLOD.billboardMode!==X.b.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new J.c);const G=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,J.h.ed[7].J(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.J(this._currentLOD.kd(!0)),this._currentLOD.position.J(J.h.ed[7]),this._currentLOD._masterMesh=G,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(G){if(!G)return this;const V=this.sourceMesh.getLODLevels();if(V&&0!==V.length){const V=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(G,V.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(G){return this.sourceMesh._preActivateForIntermediateRendering(G)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.Ed)for(let G=0;G<this._sourceMesh.Ed.length;G++)this._sourceMesh.Ed[G].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}lG(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0;const J=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).createInstance(G);if(z.d.DeepCopy(this,J,["name","Ed","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","lx","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo","zd"],[]),this.refreshBoundingInfo(),V&&(J.parent=V),!W)for(let R=0;R<this.HG().meshes.length;R++){const G=this.HG().meshes[R];G.parent===this&&G.clone(G.name,J)}return J.kd(!0),this.onClonedObservable.notifyObservers(J),J}dispose(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.Ix(this),super.dispose(G,V)}_serializeAsParent(G){super._serializeAsParent(G),G.parentId=this._sourceMesh.uniqueId,G.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,V=arguments.length>1?arguments[1]:void 0,W=arguments.length>2?arguments[2]:void 0;const J=this.clone("Clone of "+(this.name||this.id),G||this.parent,!0,V&&V.newSourcedMesh);J&&W&&W(this,J);for(const R of this.getChildTransformNodes(!0))R.instantiateHierarchy(J,V,W);return J}}k.b.prototype.registerInstancedBuffer=function(G,V){var W,J;if(null===(W=this._userInstancedBuffersStorage)||void 0===W||null===(J=W.vertexBuffers[G])||void 0===J||J.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const G of this.instances)G.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[G]=null,this._userInstancedBuffersStorage.strides[G]=V,this._userInstancedBuffersStorage.sizes[G]=32*V,this._userInstancedBuffersStorage.data[G]=new Float32Array(this._userInstancedBuffersStorage.sizes[G]),this._userInstancedBuffersStorage.vertexBuffers[G]=new P.c(this.getEngine(),this._userInstancedBuffersStorage.data[G],G,!0,!1,V,!0);for(const R of this.instances)R.instancedBuffers[G]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},k.b.prototype._processInstancedBuffers=function(G,V){const W=G?G.length:0;for(const J in this.instancedBuffers){let R=this._userInstancedBuffersStorage.sizes[J];const d=this._userInstancedBuffersStorage.strides[J],k=(W+1)*d;for(;R<k;)R*=2;this._userInstancedBuffersStorage.data[J].length!=R&&(this._userInstancedBuffersStorage.data[J]=new Float32Array(R),this._userInstancedBuffersStorage.sizes[J]=R,this._userInstancedBuffersStorage.vertexBuffers[J]&&(this._userInstancedBuffersStorage.vertexBuffers[J].dispose(),this._userInstancedBuffersStorage.vertexBuffers[J]=null));const z=this._userInstancedBuffersStorage.data[J];let X=0;if(V){const G=this.instancedBuffers[J];G.toArray?G.toArray(z,X):G.copyToArray?G.copyToArray(z,X):z[X]=G,X+=d}for(let V=0;V<W;V++){const W=G[V].instancedBuffers[J];W.toArray?W.toArray(z,X):W.copyToArray?W.copyToArray(z,X):z[X]=W,X+=d}this._userInstancedBuffersStorage.vertexBuffers[J]?this._userInstancedBuffersStorage.vertexBuffers[J].updateDirectly(z,0):(this._userInstancedBuffersStorage.vertexBuffers[J]=new P.c(this.getEngine(),this._userInstancedBuffersStorage.data[J],J,!0,!1,d,!0),this._invalidateInstanceVertexArrayObject())}},k.b.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const G in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[G]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},k.b.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const G in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[G]&&this._userInstancedBuffersStorage.vertexBuffers[G].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,x.d)("BABYLON.InstancedMesh",q)},11877:(G,V,W)=>{W.d(V,{e:()=>P});var J=W(11424),R=W(11345),d=W(11510),k=W(11501),z=W(11313),X=W(11881);d.b._LinesMeshParser=(G,V)=>P.Parse(G,V);class P extends d.b{_isShaderMaterial(G){return"ShaderMaterial"===G.getClassName()}constructor(G){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>5?arguments[5]:void 0,k=arguments.length>6?arguments[6]:void 0,z=arguments.length>7?arguments[7]:void 0;super(G,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,V,arguments.length>4?arguments[4]:void 0),this.useVertexColor=d,this.useVertexAlpha=k,this.color=new J.d(1,1,1),this.alpha=1,this._shaderLanguage=0,V&&(this.color=V.color.clone(),this.alpha=V.alpha,this.useVertexColor=V.useVertexColor,this.useVertexAlpha=V.useVertexAlpha),this.intersectionThreshold=.1;const A={attributes:[R.c.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(this.useVertexAlpha?A.defines.push("#define VERTEXALPHA"):A.needAlphaBlending=!1,this.useVertexColor?(A.defines.push("#define VERTEXCOLOR"),A.attributes.push(R.c.ColorKind)):(A.uniforms.push("color"),this._color4=new J.h),z)this.material=z;else{this.HG().getEngine().isWebGPU&&!P.ForceGLSL&&(this._shaderLanguage=1),A.shaderLanguage=this._shaderLanguage,A.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([W.e(23).then(W.bind(W,14420)),W.e(19).then(W.bind(W,14426))]):await Promise.all([W.e(17).then(W.bind(W,14431)),W.e(16).then(W.bind(W,14434))])},this.material=new X.d("colorShader",this.HG(),"color",A,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(G){this._lineMaterial=G,this._lineMaterial.fillMode=z.e.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(G){}_bind(G,V){if(!this._geometry)return this;const W=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(V,W):this._geometry._bind(V,W,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:G,g:V,b:W}=this.color;this._color4.set(G,V,W,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(G,V,W){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const J=this.HG().getEngine();return this._unIndexed?J.drawArraysType(z.e.LineListDrawMode,G.verticesStart,G.verticesCount,W):J.drawElementsType(z.e.LineListDrawMode,G.indexStart,G.indexCount,W),this}dispose(G){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(G)}clone(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0;if(V&&void 0===V._addToSceneRootNodes){const W=V;return W.source=this,new P(G,this.HG(),W.parent,W.source,W.doNotCloneChildren)}return new P(G,this.HG(),V,this,W)}createInstance(G){const V=new A(G,this);if(this.instancedBuffers){V.instancedBuffers={};for(const G in this.instancedBuffers)V.instancedBuffers[G]=this.instancedBuffers[G]}return V}serialize(G){super.serialize(G),G.color=this.color.Bd(),G.alpha=this.alpha}static Parse(G,V){const W=new P(G.name,V);return W.color=J.d.ld(G.color),W.alpha=G.alpha,W}}P.ForceGLSL=!1;class A extends k.c{constructor(G,V){super(G,V),this.intersectionThreshold=V.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}},11510:(G,V,W)=>{W.d(V,{b:()=>C,d:()=>D});var J=W(11176),R=W(11189),d=W(11204),k=W(11416),z=W(11489),X=W(11516),P=W(11136),A=W(11424),x=W(11465),q=W(11345),L=W(11482),t=W(11538),Y=W(11473),g=W(11339),B=W(11313),S=W(11557),p=W(11543),b=W(11411),r=W(11201),y=W(11159),u=W(11218),H=W(11561);class n{constructor(G,V){this.distanceOrScreenCoverage=G,this.mesh=V}}class D{}class i{constructor(){this.visibleInstances={},this.batchCache=new e,this.batchCacheReplacementModeInFrozenMode=new e,this.instancesBufferSize=2048}}class e{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class F{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class f{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}const v={source:null,parent:null,doNotCloneChildren:!1,clonePhysicsImpostor:!0,cloneThinInstances:!1};class C extends Y.b{static _GetDefaultSideOrientation(G){return G||C.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(G){this._internalMeshDataInfo._useLODScreenCoverage=G,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(G){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==G&&(G&&this._internalMeshDataInfo._sourcePositions&&(this.wG(q.c.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.wG(q.c.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=G,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new J.b),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new J.b),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new J.b),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new J.b),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new J.b),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(G){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(G)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(G){this._internalMeshDataInfo._forcedInstanceCount=G}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(G){this._internalMeshDataInfo._sideOrientation=G,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===G||!this._scene.useRightHandedSystem&&0===G}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(G){this.sideOrientation=G,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(G){this._internalMeshDataInfo._overrideRenderingFillMode=G}get material(){return this._internalAbstractMeshDataInfo._material}set material(G){G&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(G.sideOrientation=null),this._setMaterial(G)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(G){this._unIndexed!==G&&(this._unIndexed=G,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(G){this._instanceDataStorage.manualUpdate=G}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(G){this._instanceDataStorage.previousManualUpdate=G}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(G){this._instanceDataStorage.forceMatrixUpdates=G}_copySource(G,V){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const R=this.HG();if(G._geometry&&G._geometry.vG(this),d.d.DeepCopy(G,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","zd","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","lx","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=G,R.useClonedMeshMap&&(G._internalMeshDataInfo.meshMap||(G._internalMeshDataInfo.meshMap={}),G._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=G._originalBuilderSideOrientation,this._creationDataStorage=G._creationDataStorage,G._ranges){const V=G._ranges;for(const G in V)Object.prototype.hasOwnProperty.call(V,G)&&V[G]&&this.createAnimationRange(G,V[G].from,V[G].to)}if(G.metadata&&G.metadata.clone?this.metadata=G.metadata.clone():this.metadata=G.metadata,this._internalMetadata=G._internalMetadata,k.c&&k.c.HasTags(G)&&k.c.AddTagsTo(this,k.c.GetTags(G,!0)),this.rz(G.isEnabled(!1)),this.parent=G.parent,this.setPivotMatrix(G.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+G.id,this.material=G.material,!V){const R=G.getDescendants(!0);for(let G=0;G<R.length;G++){const d=R[G];d._isMesh?(v.parent=this,v.doNotCloneChildren=V,v.clonePhysicsImpostor=W,v.cloneThinInstances=J,d.clone(this.name+"."+d.name,v)):d.clone&&d.clone(this.name+"."+d.name,this)}}if(G.morphTargetManager&&(this.morphTargetManager=G.morphTargetManager),R.getPhysicsEngine){const V=R.getPhysicsEngine();if(W&&V)if(1===V.getPluginVersion()){const W=V.getImpostorForPhysicsObject(G);W&&(this.physicsImpostor=W.clone(this))}else 2===V.getPluginVersion()&&G.physicsBody&&G.physicsBody.clone(this)}for(let d=0;d<R.mx.length;d++){const V=R.mx[d];V.j===G&&V.clone(V.name,this)}if(this.skeleton=G.skeleton,J&&(G._thinInstanceDataStorage.matrixData?(this.EA("matrix",new Float32Array(G._thinInstanceDataStorage.matrixData),16,!G._thinInstanceDataStorage.matrixBuffer.isUpdatable()),this._thinInstanceDataStorage.matrixBufferSize=G._thinInstanceDataStorage.matrixBufferSize,this._thinInstanceDataStorage.instancesCount=G._thinInstanceDataStorage.instancesCount):this._thinInstanceDataStorage.matrixBufferSize=G._thinInstanceDataStorage.matrixBufferSize,G._userThinInstanceBuffersStorage)){const V=G._userThinInstanceBuffersStorage;for(const G in V.data){var z,X;this.EA(G,new Float32Array(V.data[G]),V.strides[G],!(null!==(z=V.vertexBuffers)&&void 0!==z&&null!==(X=z[G])&&void 0!==X&&X.isUpdatable())),this._userThinInstanceBuffersStorage.sizes[G]=V.sizes[G]}}this.refreshBoundingInfo(!0,!0),this.kd(!0)}constructor(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4?arguments[4]:void 0,k=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(G,V),this._internalMeshDataInfo=new f,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new i,this._thinInstanceDataStorage=new F,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=C.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,V=this.HG(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(G,V,W)=>{G&&W&&(this._uniformBuffer?this.transferToEffect(V):W.bindOnlyWorldMatrix(V))};let z=null,X=!1;if(W&&void 0===W._addToSceneRootNodes){const G=W;z=G.parent??null,R=G.source??null,d=G.doNotCloneChildren??!1,k=G.clonePhysicsImpostor??!0,X=G.cloneThinInstances??!1}else z=W;R&&this._copySource(R,d,k,X),null!==z&&(this.parent=z),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=G=>{G.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new J.b(this._internalMeshDataInfo._onMeshReadyObserverAdded),R&&R.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,V=arguments.length>1?arguments[1]:void 0,W=arguments.length>2?arguments[2]:void 0;const J=0===this.getTotalVertices()||V&&V.doNotInstantiate&&(!0===V.doNotInstantiate||V.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),G||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));J.parent=G||this.parent,J.position=this.position.clone(),J.vd=this.vd.clone(),this.rotationQuaternion?J.rotationQuaternion=this.rotationQuaternion.clone():J.rotation=this.rotation.clone(),W&&W(this,J);for(const R of this.getChildTransformNodes(!0))"InstancedMesh"===R.getClassName()&&"Mesh"===J.getClassName()&&R.sourceMesh===this?R.instantiateHierarchy(J,{doNotInstantiate:V&&V.doNotInstantiate||!1,newSourcedMesh:J},W):R.instantiateHierarchy(J,V,W);return J}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(G){let V=super.toString(G);if(V+=", n vertices: "+this.getTotalVertices(),V+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let W=0;W<this.animations.length;W++)V+=", animation[0]: "+this.animations[W].toString(G);if(G)if(this._geometry){const G=this.Pd(),W=this.getVerticesData(q.c.PositionKind);W&&G&&(V+=", flat shading: "+(W.length/3===G.length?"YES":"NO"))}else V+=", flat shading: UNKNOWN";return V}_unBindEffect(){super._unBindEffect();for(const G of this.instances)G._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const G=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((V,W)=>V.distanceOrScreenCoverage<W.distanceOrScreenCoverage?G:V.distanceOrScreenCoverage>W.distanceOrScreenCoverage?-G:0))}addLODLevel(G,V){if(V&&V._masterMesh)return r.c.Warn("You cannot use a mesh as LOD level twice"),this;const W=new n(G,V);return this._internalMeshDataInfo._LODLevels.push(W),V&&(V._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(G){const V=this._internalMeshDataInfo;for(let W=0;W<V._LODLevels.length;W++){const J=V._LODLevels[W];if(J.distanceOrScreenCoverage===G)return J.mesh}return null}removeLODLevel(G){const V=this._internalMeshDataInfo;for(let W=0;W<V._LODLevels.length;W++)V._LODLevels[W].mesh===G&&(V._LODLevels.splice(W,1),G&&(G._masterMesh=null));return this._sortLODLevels(),this}getLOD(G,V){const W=this._internalMeshDataInfo;if(!W._LODLevels||0===W._LODLevels.length)return this;const J=V||this.getBoundingInfo().boundingSphere,R=G.mode===X.c.ORTHOGRAPHIC_CAMERA?G.Zd:J.centerWorld.zW(G.globalPosition).length();let d=R,k=1;if(W._useLODScreenCoverage){const V=G.screenArea;let W=J.radiusWorld*G.Zd/R;W=W*W*Math.PI,d=W/V,k=-1}if(k*W._LODLevels[W._LODLevels.length-1].distanceOrScreenCoverage>k*d)return this.onLODLevelSelection&&this.onLODLevelSelection(d,this,this),this;for(let z=0;z<W._LODLevels.length;z++){const G=W._LODLevels[z];if(k*G.distanceOrScreenCoverage<k*d){if(G.mesh){if(4===G.mesh.delayLoadState)return G.mesh._checkDelayState(),this;if(2===G.mesh.delayLoadState)return this;G.mesh._preActivate(),G.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(d,this,G.mesh),G.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(d,this,this),this}get zd(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(G,V,W,J){var R,d;if(!this._geometry)return null;let k=J||null===(R=this._userInstancedBuffersStorage)||void 0===R||null===(d=R.vertexBuffers[G])||void 0===d?void 0:d.getFloatData(this.instances.length+1,W||V&&1!==this._geometry.meshes.length);return k||(k=this._geometry.getVerticesData(G,V,W)),k}copyVerticesData(G,V){this._geometry&&this._geometry.copyVerticesData(G,V)}getVertexBuffer(G,V){var W;return this._geometry?(V||null===(W=this._userInstancedBuffersStorage)||void 0===W?void 0:W.vertexBuffers[G])??this._geometry.getVertexBuffer(G):null}isVerticesDataPresent(G,V){var W;return this._geometry?!V&&void 0!==(null===(W=this._userInstancedBuffersStorage)||void 0===W?void 0:W.vertexBuffers[G])||this._geometry.isVerticesDataPresent(G):!!this._delayInfo&&-1!==this._delayInfo.indexOf(G)}isVertexBufferUpdatable(G,V){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(G);if(!V){var W;const V=null===(W=this._userInstancedBuffersStorage)||void 0===W?void 0:W.vertexBuffers[G];if(V)return V.isUpdatable()}return this._geometry.isVertexBufferUpdatable(G)}getVerticesDataKinds(G){if(!this._geometry){const G=[];if(this._delayInfo)for(const V of this._delayInfo)G.push(V);return G}const V=this._geometry.getVerticesDataKinds();if(!G&&this._userInstancedBuffersStorage)for(const W in this._userInstancedBuffersStorage.vertexBuffers)-1===V.indexOf(W)&&V.push(W);return V}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}Pd(G,V){return this._geometry?this._geometry.Pd(G,V):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(G))return!1;if(!this.Ed||0===this.Ed.length)return!0;if(!G)return!0;const W=this.getEngine(),J=this.HG(),R=V||W.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.kd();const d=this.material||J.defaultMaterial;if(d)if(d._storeEffectOnSubMeshes)for(const q of this.Ed){const G=q.NG();if(G)if(G._storeEffectOnSubMeshes){if(!G.isReadyForSubMesh(this,q,R))return!1}else if(!G.isReady(this,R))return!1}else if(!d.isReady(this,R))return!1;const k=W.currentRenderPassId;for(const q of this.lightSources){const G=q.getShadowGenerators();if(!G)continue;const V=G.values();for(let J=V.next();!0!==J.done;J=V.next()){var z,X,P,A;const G=J.value;if(G&&(null===(z=G.getShadowMap())||void 0===z||!z.renderList||null!==(X=G.getShadowMap())&&void 0!==X&&X.renderList&&-1!==(null===(P=G.getShadowMap())||void 0===P||null===(A=P.renderList)||void 0===A?void 0:A.indexOf(this)))){const V=G.getShadowMap().renderPassIds??[W.currentRenderPassId];for(let J=0;J<V.length;++J){W.currentRenderPassId=V[J];for(const V of this.Ed){var x;if(!G.isReady(V,R,(null===(x=V.NG())||void 0===x?void 0:x.needAlphaBlendingForMesh(this))??!1))return W.currentRenderPassId=k,!1}}W.currentRenderPassId=k}}}for(const q of this._internalMeshDataInfo._LODLevels)if(q.mesh&&!q.mesh.isReady(R))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}VA(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(G){this._instanceDataStorage.overridenInstanceCount=G}_preActivate(){const G=this._internalMeshDataInfo,V=this.HG().getRenderId();return G._preActivateId===V||(G._preActivateId=V,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(G){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=G),this}_registerInstanceForRenderId(G,V){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:V,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[V]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=V,this._instanceDataStorage.visibleInstances[V]=new Array),this._instanceDataStorage.visibleInstances[V].push(G),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.CG||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let G,V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],W=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;G="object"===typeof V?V:{applySkeleton:V,applyMorph:W};const J=this.zd?this.zd.boundingBias:null;return this.mG(this._getData(G,null,q.c.PositionKind),J),this}_createGlobalSubMesh(G){const V=this.getTotalVertices();if(!V||!this.Pd())return null;if(this.Ed&&this.Ed.length>0){const W=this.Pd();if(!W)return null;const J=W.length;let R=!1;if(G)R=!0;else for(const G of this.Ed){if(G.indexStart+G.indexCount>J){R=!0;break}if(G.verticesStart+G.verticesCount>V){R=!0;break}}if(!R)return this.Ed[0]}return this.releaseSubMeshes(),new g.e(0,0,V,0,this.getTotalIndices()||V,this)}subdivide(G){if(G<1)return;const V=this.getTotalIndices();let W=V/G|0,J=0;for(;W%3!==0;)W++;this.releaseSubMeshes();for(let R=0;R<G&&!(J>=V);R++)g.e.CreateFromIndices(0,J,R===G-1?V-J:W,this,void 0,!1),J+=W;this.refreshBoundingInfo(),this.synchronizeInstances()}wG(G,V){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.wG(G,V,W,J);else{const J=new L.b;J.set(V,G);const R=this.HG();new t.d(t.d.RandomId(),R,J,W,this)}return this}removeVerticesData(G){this._geometry&&this._geometry.removeVerticesData(G)}markVerticesDataAsUpdatable(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const W=this.getVertexBuffer(G);W&&W.isUpdatable()!==V&&this.wG(G,this.getVerticesData(G),V)}setVerticesBuffer(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=t.d.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(G,null,V),this}updateVerticesData(G,V,W,J){return this._geometry?(J?(this.makeGeometryUnique(),this.updateVerticesData(G,V,W,!1)):this._geometry.updateVerticesData(G,V,W),this):this}updateMeshPositions(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const W=this.getVerticesData(q.c.PositionKind);if(!W)return this;if(G(W),this.updateVerticesData(q.c.PositionKind,W,!1,!1),V){const G=this.Pd(),V=this.getVerticesData(q.c.NormalKind);if(!V)return this;L.b.ComputeNormals(W,G,V),this.updateVerticesData(q.c.NormalKind,V,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const G=this._geometry,V=this._geometry.i(t.d.RandomId());return G.releaseForMesh(this,!0),V.vG(this),this}setIndexBuffer(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,R=this._geometry;R||(R=new t.d(t.d.RandomId(),this.HG(),void 0,void 0,this)),R.setIndexBuffer(G,V,W,J)}setIndices(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(G,V,W,J);else{const V=new L.b;V.indices=G;const J=this.HG();new t.d(t.d.RandomId(),J,V,W,this)}return this}updateIndices(G,V){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(G,V,W),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(G,V,W){let J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const R=this.HG().getEngine();let d;if(this._unIndexed)if(this._getRenderingFillMode(W)===B.e.WireFrameFillMode)d=G._getLinesIndexBuffer(this.Pd(),R);else d=null;else switch(this._getRenderingFillMode(W)){case B.e.PointFillMode:d=null;break;case B.e.WireFrameFillMode:d=G._getLinesIndexBuffer(this.Pd(),R);break;default:case B.e.TriangleFillMode:d=this._geometry.getIndexBuffer()}return this._bindDirect(V,d,J)}_bindDirect(G,V){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(G),W&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(G,V,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(G,V),this):this}_draw(G,V,W){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const J=this.HG().getEngine();return this._unIndexed&&V!==B.e.WireFrameFillMode||V==B.e.PointFillMode?J.drawArraysType(V,G.verticesStart,G.verticesCount,this.forcedInstanceCount||W):V==B.e.WireFrameFillMode?J.drawElementsType(V,0,G._linesIndexCount,this.forcedInstanceCount||W):J.drawElementsType(V,G.indexStart,G.indexCount,this.forcedInstanceCount||W),this}registerBeforeRender(G){return this.onBeforeRenderObservable.add(G),this}unregisterBeforeRender(G){return this.onBeforeRenderObservable.removeCallback(G),this}registerAfterRender(G){return this.onAfterRenderObservable.add(G),this}unregisterAfterRender(G){return this.onAfterRenderObservable.removeCallback(G),this}_getInstancesRenderList(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(V)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[G]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[G]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const W=this.HG(),J=W._isInIntermediateRendering(),R=J?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,d=this._instanceDataStorage.batchCache;if(d.mustReturn=!1,d.renderSelf[G]=V||!R&&this.isEnabled()&&this.isVisible,d.visibleInstances[G]=null,this._instanceDataStorage.visibleInstances&&!V){const V=this._instanceDataStorage.visibleInstances,R=W.getRenderId(),k=J?V.intermediateDefaultRenderId:V.defaultRenderId;d.visibleInstances[G]=V[R],!d.visibleInstances[G]&&k&&(d.visibleInstances[G]=V[k])}return d.hardwareInstancedRendering[G]=!V&&this._instanceDataStorage.hardwareInstancedRendering&&null!==d.visibleInstances[G]&&void 0!==d.visibleInstances[G],this._instanceDataStorage.previousBatch=d,d}_updateInstancedBuffers(G,V,W,J,R,d){const k=V.visibleInstances[G._id],z=k?k.length:0,X=this._instanceDataStorage;let A=X.instancesBuffer,x=X.instancesPreviousBuffer,L=0,t=0;const Y=V.renderSelf[G._id],g=!A||W!==X.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!X.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||X.isFrozen&&!g)t=(Y?1:0)+z;else{const V=this.getWorldMatrix();if(Y&&(this._scene.needsPreviousWorldMatrices&&(X.masterMeshPreviousWorldMatrix?(X.masterMeshPreviousWorldMatrix.copyToArray(X.instancesPreviousData,L),X.masterMeshPreviousWorldMatrix.J(V)):(X.masterMeshPreviousWorldMatrix=V.clone(),X.masterMeshPreviousWorldMatrix.copyToArray(X.instancesPreviousData,L))),V.copyToArray(X.instancesData,L),L+=16,t++),k){var B;if(C.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(B=G.NG())&&void 0!==B&&B.needAlphaBlendingForMesh(G.getRenderingMesh())){const G=this._scene.activeCamera.globalPosition;for(let V=0;V<k.length;V++){const W=k[V];W._distanceToCamera=P.o.Distance(W.getBoundingInfo().boundingSphere.centerWorld,G)}k.sort(((G,V)=>G._distanceToCamera>V._distanceToCamera?-1:G._distanceToCamera<V._distanceToCamera?1:0))}for(let G=0;G<k.length;G++){const V=k[G],W=V.getWorldMatrix();W.copyToArray(X.instancesData,L),this._scene.needsPreviousWorldMatrices&&(V._previousWorldMatrix?(V._previousWorldMatrix.copyToArray(X.instancesPreviousData,L),V._previousWorldMatrix.J(W)):(V._previousWorldMatrix=W.clone(),V._previousWorldMatrix.copyToArray(X.instancesPreviousData,L))),L+=16,t++}}}g?(A&&A.dispose(),x&&x.dispose(),A=new q.b(J,X.instancesData,!0,16,!1,!0),X.instancesBuffer=A,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=A.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=A.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=A.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=A.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(x=new q.b(J,X.instancesPreviousData,!0,16,!1,!0),X.instancesPreviousBuffer=x,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=x.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=x.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=x.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=x.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(A.updateDirectly(X.instancesData,0,t),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||x.updateDirectly(X.instancesPreviousData,0,t)),this._processInstancedBuffers(k,Y),d&&void 0!==R&&(this.HG()._activeIndices.addCount(G.indexCount*t,!1),J._currentDrawContext&&(J._currentDrawContext.useInstancing=!0),this._bind(G,d,R),this._draw(G,R,t)),!this._scene.needsPreviousWorldMatrices||g||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||x.updateDirectly(X.instancesData,0,t)}_renderWithInstances(G,V,W,J,R){const d=W.visibleInstances[G._id],k=d?d.length:0,z=this._instanceDataStorage,X=z.instancesBufferSize,P=16*(k+1)*4;for(;z.instancesBufferSize<P;)z.instancesBufferSize*=2;return z.instancesData&&X==z.instancesBufferSize||(z.instancesData=new Float32Array(z.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!z.instancesPreviousData||X!=z.instancesBufferSize)&&(z.instancesPreviousData=new Float32Array(z.instancesBufferSize/4)),this._updateInstancedBuffers(G,W,X,R,V,J),R.unbindInstanceAttributes(),this}_renderWithThinInstances(G,V,W,J){var R;const d=(null===(R=this._thinInstanceDataStorage)||void 0===R?void 0:R.instancesCount)??0;this.HG()._activeIndices.addCount(G.indexCount*d,!1),J._currentDrawContext&&(J._currentDrawContext.useInstancing=!0),this._bind(G,W,V),this._draw(G,V,d),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,d):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),J.unbindInstanceAttributes()}_processInstancedBuffers(G,V){}_processRendering(G,V,W,J,R,d,k,z){const X=this.HG(),P=X.getEngine();if(J=this._getRenderingFillMode(J),d&&V.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(V,J,W,P),this;if(d)this._renderWithInstances(V,J,R,W,P);else{P._currentDrawContext&&(P._currentDrawContext.useInstancing=!1);let W=0;R.renderSelf[V._id]&&(k&&k(!1,G.getWorldMatrix(),z),W++,this._draw(V,J,this._instanceDataStorage.overridenInstanceCount));const d=R.visibleInstances[V._id];if(d){const G=d.length;W+=G;for(let W=0;W<G;W++){const G=d[W].getWorldMatrix();k&&k(!0,G,z),this._draw(V,J)}}X._activeIndices.addCount(V.indexCount*W,!1)}return this}_rebuild(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(G&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const V in this._userInstancedBuffersStorage.vertexBuffers){const W=this._userInstancedBuffersStorage.vertexBuffers[V];W&&(G&&W.dispose(),this._userInstancedBuffersStorage.vertexBuffers[V]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(G)}_freeze(){if(this.Ed){for(let G=0;G<this.Ed.length;G++)this._getInstancesRenderList(G);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(G,V,W,J){let R=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const d=this._scene.getEngine(),k=d.currentRenderPassId;if(void 0!==G&&(d.currentRenderPassId=G),J)(!R||R&&J.isInFrustum(this._scene._frustumPlanes))&&this.render(J,!!V,W);else for(let z=0;z<this.Ed.length;z++){const G=this.Ed[z];(!R||R&&G.isInFrustum(this._scene._frustumPlanes))&&this.render(G,!!V,W)}return void 0!==G&&(d.currentRenderPassId=k),this}directRender(){if(!this.Ed)return this;for(const G of this.Ed)this.render(G,!1);return this}render(G,V,W){var J,R,d;const k=this.HG();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const z=(null===(J=k.activeCameras)||void 0===J?void 0:J.length)??0;if((z>1&&k.activeCamera===k.activeCameras[0]||z<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const X=this._getInstancesRenderList(G._id,!!W);if(X.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const P=k.getEngine();let A=0,x=null;this.ignoreCameraMaxZ&&k.activeCamera&&!k._isInIntermediateRendering()&&(A=k.activeCamera.maxZ,x=k.activeCamera,k.activeCamera.maxZ=0,k.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const q=G.getRenderingMesh(),L=X.hardwareInstancedRendering[G._id]||q.hasThinInstances||!!this._userInstancedBuffersStorage&&!G.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,t=this._instanceDataStorage,Y=G.NG();if(!Y)return x&&(x.maxZ=A,k.updateTransformMatrix(!0)),this;if(t.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===Y){if(Y._storeEffectOnSubMeshes&&(null===(R=G._drawWrapper)||void 0===R||!R._wasPreviouslyReady)||!Y._storeEffectOnSubMeshes&&!Y._getDrawWrapper()._wasPreviouslyReady)return x&&(x.maxZ=A,k.updateTransformMatrix(!0)),this}else{if(Y._storeEffectOnSubMeshes){if(!Y.isReadyForSubMesh(this,G,L))return x&&(x.maxZ=A,k.updateTransformMatrix(!0)),this}else if(!Y.isReady(this,L))return x&&(x.maxZ=A,k.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=Y}let g;V&&P.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),g=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?G._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const S=(null===(d=g)||void 0===d?void 0:d.effect)??null;for(const B of k._beforeRenderingMeshStage)B.action(this,G,X,S);if(!g||!S)return x&&(x.maxZ=A,k.updateTransformMatrix(!0)),this;const p=W||this;let b;if(t.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.gd&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)b=t.sideOrientation;else{const G=p._getWorldMatrixDeterminant();b=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),G<0&&(b=b===B.e.ClockWiseSideOrientation?B.e.CounterClockWiseSideOrientation:B.e.ClockWiseSideOrientation),t.sideOrientation=b}const r=this._internalMeshDataInfo._effectiveMaterial._preBind(g,b);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&P.setDepthWrite(!0);const y=this._internalMeshDataInfo._effectiveMaterial,u=y.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),L||this._bind(G,S,u,!1);const H=p.getWorldMatrix();y._storeEffectOnSubMeshes?y.bindForSubMesh(H,this,G):y.bind(H,this),!y.gd&&y.separateCullingPass&&(P.setState(!0,y.zOffset,!1,!r,y.cullBackFaces,y.stencil,y.zOffsetUnits),this._processRendering(this,G,S,u,X,L,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),P.setState(!0,y.zOffset,!1,r,y.cullBackFaces,y.stencil,y.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(G)),this._processRendering(this,G,S,u,X,L,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const B of k._afterRenderingMeshStage)B.action(this,G,X,S);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),x&&(x.maxZ=A,k.updateTransformMatrix(!0)),2!==k.performancePriority||t.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(q.c.MatricesWeightsKind)&&(this.isVerticesDataPresent(q.c.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const G=this.getVerticesData(q.c.MatricesWeightsKind),V=G.length;for(let W=0;W<V;W+=4){const V=G[W]+G[W+1]+G[W+2]+G[W+3];if(0===V)G[W]=1;else{const J=1/V;G[W]*=J,G[W+1]*=J,G[W+2]*=J,G[W+3]*=J}}this.wG(q.c.MatricesWeightsKind,G)}_normalizeSkinWeightsAndExtra(){const G=this.getVerticesData(q.c.MatricesWeightsExtraKind),V=this.getVerticesData(q.c.MatricesWeightsKind),W=V.length;for(let J=0;J<W;J+=4){let W=V[J]+V[J+1]+V[J+2]+V[J+3];if(W+=G[J]+G[J+1]+G[J+2]+G[J+3],0===W)V[J]=1;else{const R=1/W;V[J]*=R,V[J+1]*=R,V[J+2]*=R,V[J+3]*=R,G[J]*=R,G[J+1]*=R,G[J+2]*=R,G[J+3]*=R}}this.wG(q.c.MatricesWeightsKind,V),this.wG(q.c.MatricesWeightsKind,G)}validateSkinning(){const G=this.getVerticesData(q.c.MatricesWeightsExtraKind),V=this.getVerticesData(q.c.MatricesWeightsKind);if(null===V||null==this.skeleton)return{skinned:!1,valid:!0,Ft:"not skinned"};const W=V.length;let J=0,R=0,d=0,k=0;const z=null===G?4:8,X=[];for(let q=0;q<=z;q++)X[q]=0;for(let q=0;q<W;q+=4){let W=V[q],P=W,A=0===P?0:1;for(let R=1;R<z;R++){const d=R<4?V[q+R]:G[q+R-4];d>W&&J++,0!==d&&A++,P+=d,W=d}if(X[A]++,A>d&&(d=A),0===P)R++;else{const W=1/P;let J=0;for(let R=0;R<z;R++)J+=R<4?Math.abs(V[q+R]-V[q+R]*W):Math.abs(G[q+R-4]-G[q+R-4]*W);J>.001&&k++}}const P=this.skeleton.bones.length,A=this.getVerticesData(q.c.MatricesIndicesKind),x=this.getVerticesData(q.c.MatricesIndicesExtraKind);let L=0;for(let q=0;q<W;q+=4)for(let G=0;G<z;G++){const V=G<4?A[q+G]:x[q+G-4];(V>=P||V<0)&&L++}return{skinned:!0,valid:0===R&&0===k&&0===L,Ft:"Number of Weights = "+W/4+"\nMaximum influences = "+d+"\nMissing Weights = "+R+"\nNot Sorted = "+J+"\nNot Normalized = "+k+"\nWeightCounts = ["+X+"]\nNumber of bones = "+P+"\nBad Bone Indices = "+L}}_checkDelayState(){const G=this.HG();return this._geometry?this._geometry.load(G):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(G)),this}_queueLoad(G){G.addPendingData(this);const V=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return R.h.LoadFile(this.delayLoadingFile,(V=>{V instanceof ArrayBuffer?this._delayLoadingFunction(V,this):this._delayLoadingFunction(JSON.parse(V),this);for(const G of this.instances)G.refreshBoundingInfo(),G._syncSubMeshes();this.delayLoadState=1,G.removePendingData(this)}),(()=>{}),G.offlineProvider,V),this}isInFrustum(G){return 2!==this.delayLoadState&&(!!super.isInFrustum(G)&&(this._checkDelayState(),!0))}setMaterialById(G){const V=this.HG().materials;let W;for(W=V.length-1;W>-1;W--)if(V[W].id===G)return this.material=V[W],this;const J=this.HG().multiMaterials;for(W=J.length-1;W>-1;W--)if(J[W].id===G)return this.material=J[W],this;return this}getAnimatables(){const G=[];return this.material&&G.push(this.material),this.skeleton&&G.push(this.skeleton),G}bakeTransformIntoVertices(G){if(!this.isVerticesDataPresent(q.c.PositionKind))return this;const V=this.Ed.splice(0);this._resetPointsArrayCache();let W=this.getVerticesData(q.c.PositionKind);const J=P.o.Zero();let R;for(R=0;R<W.length;R+=3)P.o.TransformCoordinatesFromFloatsToRef(W[R],W[R+1],W[R+2],G,J).toArray(W,R);if(this.wG(q.c.PositionKind,W,this.getVertexBuffer(q.c.PositionKind).isUpdatable()),this.isVerticesDataPresent(q.c.NormalKind)){for(W=this.getVerticesData(q.c.NormalKind),R=0;R<W.length;R+=3)P.o.TransformNormalFromFloatsToRef(W[R],W[R+1],W[R+2],G,J).normalize().toArray(W,R);this.wG(q.c.NormalKind,W,this.getVertexBuffer(q.c.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(q.c.TangentKind)){for(W=this.getVerticesData(q.c.TangentKind),R=0;R<W.length;R+=4)P.o.TransformNormalFromFloatsToRef(W[R],W[R+1],W[R+2],G,J).normalize().toArray(W,R);this.wG(q.c.TangentKind,W,this.getVertexBuffer(q.c.TangentKind).isUpdatable())}return G.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.Ed=V,this}bakeCurrentTransformIntoVertices(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&this.makeGeometryUnique(),this.bakeTransformIntoVertices(this.kd(!0)),this.resetLocalMatrix(G),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0,J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(V&&void 0===V._addToSceneRootNodes){const W=V;return v.source=this,v.doNotCloneChildren=W.doNotCloneChildren,v.clonePhysicsImpostor=W.clonePhysicsImpostor,v.cloneThinInstances=W.cloneThinInstances,new C(G,this.HG(),v)}return new C(G,this.HG(),V,this,W,J)}dispose(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const W=this._internalMeshDataInfo;if(W._onBeforeDrawObservable&&W._onBeforeDrawObservable.clear(),W._onBeforeBindObservable&&W._onBeforeBindObservable.clear(),W._onBeforeRenderObservable&&W._onBeforeRenderObservable.clear(),W._onAfterRenderObservable&&W._onAfterRenderObservable.clear(),W._onBetweenPassObservable&&W._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(W.meshMap)for(const G in W.meshMap){const V=W.meshMap[G];V&&(V._internalMeshDataInfo._source=null,W.meshMap[G]=void 0)}W._source&&W._source._internalMeshDataInfo.meshMap&&(W._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const G=this.HG().meshes;for(const V of G){const G=V;G._internalMeshDataInfo&&G._internalMeshDataInfo._source&&G._internalMeshDataInfo._source===this&&(G._internalMeshDataInfo._source=null)}}W._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(G,V)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(G,V,W,J,d,k){let z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7?arguments[7]:void 0;const P=this.HG();return R.h.LoadImage(G,(G=>{const R=G.width,X=G.height,P=this.getEngine().createCanvas(R,X).getContext("2d");P.drawImage(G,0,0);const A=P.getImageData(0,0,R,X).data;this.applyDisplacementMapFromBuffer(A,R,X,V,W,d,k,z),J&&J(this)}),X||(()=>{}),P.offlineProvider),this}applyDisplacementMapFromBuffer(G,V,W,J,R,d,k){let z=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(q.c.PositionKind)||!this.isVerticesDataPresent(q.c.NormalKind)||!this.isVerticesDataPresent(q.c.UVKind))return r.c.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const X=this.getVerticesData(q.c.PositionKind,!0,!0),A=this.getVerticesData(q.c.NormalKind),x=this.getVerticesData(q.c.UVKind);let t=P.o.Zero();const Y=P.o.Zero(),g=P.k.Zero();d=d||P.k.Zero(),k=k||new P.k(1,1);for(let q=0;q<X.length;q+=3){P.o.FromArrayToRef(X,q,t),P.o.FromArrayToRef(A,q,Y),P.k.FromArrayToRef(x,q/3*2,g);const z=4*((Math.abs(g.x*k.x+d.x%1)*(V-1)%V|0)+(Math.abs(g.y*k.y+d.y%1)*(W-1)%W|0)*V),L=.3*(G[z]/255)+.59*(G[z+1]/255)+.11*(G[z+2]/255);Y.normalize(),Y.scaleInPlace(J+(R-J)*L),t=t.add(Y),t.toArray(X,q)}return L.b.ComputeNormals(X,this.Pd(),A),z?(this.wG(q.c.PositionKind,X),this.wG(q.c.NormalKind,A),this.wG(q.c.UVKind,x)):(this.updateVerticesData(q.c.PositionKind,X),this.updateVerticesData(q.c.NormalKind,A)),this}_getFlattenedNormals(G,V){const W=new Float32Array(3*G.length);let J=0;const R=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let d=0;d<G.length;d+=3){const k=P.o.ld(V,3*G[d]),z=P.o.ld(V,3*G[d+1]),X=P.o.ld(V,3*G[d+2]),A=k.zW(z),x=X.zW(z),q=P.o.Normalize(P.o.Cross(A,x));R&&q.scaleInPlace(-1);for(let G=0;G<3;G++)W[J++]=q.x,W[J++]=q.y,W[J++]=q.z}return W}_convertToUnIndexedMesh(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const V=this.getVerticesDataKinds().filter((G=>{var V;return!(null!==(V=this.getVertexBuffer(G))&&void 0!==V&&V.getIsInstanced())})),W=this.Pd(),J={},R=(G,V)=>{const J=new Float32Array(W.length*V);let R=0;for(let d=0;d<W.length;d++)for(let k=0;k<V;k++)J[R++]=G[W[d]*V+k];return J},d=this.getBoundingInfo(),k=this.zd?this.Ed.slice(0):[];for(const z of V)J[z]=this.getVerticesData(z);for(const z of V){const V=this.getVertexBuffer(z),d=V.getSize();if(G&&z===q.c.NormalKind){const G=this._getFlattenedNormals(W,J[q.c.PositionKind]);this.wG(q.c.NormalKind,G,V.isUpdatable(),d)}else this.wG(z,R(J[z],d),V.isUpdatable(),d)}if(this.morphTargetManager){for(let V=0;V<this.morphTargetManager.numTargets;V++){const J=this.morphTargetManager.getTarget(V),d=J.getPositions();J.setPositions(R(d,3));const k=J.getNormals();k&&J.setNormals(G?this._getFlattenedNormals(W,d):R(k,3));const z=J.getTangents();z&&J.setTangents(R(z,3));const X=J.getUVs();X&&J.setUVs(R(X,2));const P=J.getColors();P&&J.setColors(R(P,4))}this.morphTargetManager.synchronize()}for(let z=0;z<W.length;z++)W[z]=z;this.setIndices(W),this._unIndexed=!0,this.releaseSubMeshes();for(const z of k){const G=z.getBoundingInfo();g.e.AddToMesh(z.materialIndex,z.indexStart,z.indexCount,z.indexStart,z.indexCount,this).setBoundingInfo(G)}return this.setBoundingInfo(d),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const V=L.b.ExtractFromMesh(this);let W;if(G&&this.isVerticesDataPresent(q.c.NormalKind)&&V.iG){for(W=0;W<V.iG.length;W++)V.iG[W]*=-1;this.wG(q.c.NormalKind,V.iG,this.isVertexBufferUpdatable(q.c.NormalKind))}if(V.indices){let G;for(W=0;W<V.indices.length;W+=3)G=V.indices[W+1],V.indices[W+1]=V.indices[W+2],V.indices[W+2]=G;this.setIndices(V.indices,null,this.isVertexBufferUpdatable(q.c.PositionKind),!0)}return this}increaseVertices(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const V=L.b.ExtractFromMesh(this),W=V.indices&&!Array.isArray(V.indices)&&Array.from?Array.from(V.indices):V.indices,J=V.DG&&!Array.isArray(V.DG)&&Array.from?Array.from(V.DG):V.DG,R=V.FG&&!Array.isArray(V.FG)&&Array.from?Array.from(V.FG):V.FG,d=V.iG&&!Array.isArray(V.iG)&&Array.from?Array.from(V.iG):V.iG;if(W&&J){V.indices=W,V.DG=J,R&&(V.FG=R),d&&(V.iG=d);const k=G+1,z=[];for(let G=0;G<k+1;G++)z[G]=[];let X,A;const x=new P.o(0,0,0),L=new P.o(0,0,0),t=new P.k(0,0),Y=[],g=[],B=[];let S,p,b,r=J.length;R&&(p=R.length),d&&(b=d.length);for(let G=0;G<W.length;G+=3){g[0]=W[G],g[1]=W[G+1],g[2]=W[G+2];for(let G=0;G<3;G++)if(X=g[G],A=g[(G+1)%3],void 0===B[X]&&void 0===B[A]?(B[X]=[],B[A]=[]):(void 0===B[X]&&(B[X]=[]),void 0===B[A]&&(B[A]=[])),void 0===B[X][A]&&void 0===B[A][X]){B[X][A]=[],x.x=(J[3*A]-J[3*X])/k,x.y=(J[3*A+1]-J[3*X+1])/k,x.z=(J[3*A+2]-J[3*X+2])/k,d&&(L.x=(d[3*A]-d[3*X])/k,L.y=(d[3*A+1]-d[3*X+1])/k,L.z=(d[3*A+2]-d[3*X+2])/k),R&&(t.x=(R[2*A]-R[2*X])/k,t.y=(R[2*A+1]-R[2*X+1])/k),B[X][A].push(X);for(let G=1;G<k;G++)B[X][A].push(J.length/3),J[r++]=J[3*X]+G*x.x,J[r++]=J[3*X+1]+G*x.y,J[r++]=J[3*X+2]+G*x.z,d&&(d[b++]=d[3*X]+G*L.x,d[b++]=d[3*X+1]+G*L.y,d[b++]=d[3*X+2]+G*L.z),R&&(R[p++]=R[2*X]+G*t.x,R[p++]=R[2*X+1]+G*t.y);B[X][A].push(A),B[A][X]=[],S=B[X][A].length;for(let G=0;G<S;G++)B[A][X][G]=B[X][A][S-1-G]}z[0][0]=W[G],z[1][0]=B[W[G]][W[G+1]][1],z[1][1]=B[W[G]][W[G+2]][1];for(let V=2;V<k;V++){z[V][0]=B[W[G]][W[G+1]][V],z[V][V]=B[W[G]][W[G+2]][V],x.x=(J[3*z[V][V]]-J[3*z[V][0]])/V,x.y=(J[3*z[V][V]+1]-J[3*z[V][0]+1])/V,x.z=(J[3*z[V][V]+2]-J[3*z[V][0]+2])/V,d&&(L.x=(d[3*z[V][V]]-d[3*z[V][0]])/V,L.y=(d[3*z[V][V]+1]-d[3*z[V][0]+1])/V,L.z=(d[3*z[V][V]+2]-d[3*z[V][0]+2])/V),R&&(t.x=(R[2*z[V][V]]-R[2*z[V][0]])/V,t.y=(R[2*z[V][V]+1]-R[2*z[V][0]+1])/V);for(let G=1;G<V;G++)z[V][G]=J.length/3,J[r++]=J[3*z[V][0]]+G*x.x,J[r++]=J[3*z[V][0]+1]+G*x.y,J[r++]=J[3*z[V][0]+2]+G*x.z,d&&(d[b++]=d[3*z[V][0]]+G*L.x,d[b++]=d[3*z[V][0]+1]+G*L.y,d[b++]=d[3*z[V][0]+2]+G*L.z),R&&(R[p++]=R[2*z[V][0]]+G*t.x,R[p++]=R[2*z[V][0]+1]+G*t.y)}z[k]=B[W[G+1]][W[G+2]],Y.push(z[0][0],z[1][0],z[1][1]);for(let G=1;G<k;G++){let V;for(V=0;V<G;V++)Y.push(z[G][V],z[G+1][V],z[G+1][V+1]),Y.push(z[G][V],z[G+1][V+1],z[G][V+1]);Y.push(z[G][V],z[G+1][V],z[G+1][V+1])}}V.indices=Y,V.vG(this,this.isVertexBufferUpdatable(q.c.PositionKind))}else r.c.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const G=L.b.ExtractFromMesh(this),V=G.FG,W=G.indices,J=G.DG,R=G.eG,d=G.matricesIndices,k=G.matricesWeights,z=G.matricesIndicesExtra,X=G.matricesWeightsExtra;if(void 0===W||void 0===J||null===W||null===J)r.c.Warn("VertexData contains empty entries");else{const P=[],A=[],x=[],t=[],Y=[],g=[],B=[],S=[];let p=[],b=0;const r={};let y,u;for(let G=0;G<W.length;G+=3){u=[W[G],W[G+1],W[G+2]],p=[];for(let G=0;G<3;G++){p[G]="";for(let V=0;V<3;V++)Math.abs(J[3*u[G]+V])<1e-8&&(J[3*u[G]+V]=0),p[G]+=J[3*u[G]+V]+"|"}if(p[0]!=p[1]&&p[0]!=p[2]&&p[1]!=p[2])for(let G=0;G<3;G++){if(y=r[p[G]],void 0===y){r[p[G]]=b,y=b++;for(let V=0;V<3;V++)P.push(J[3*u[G]+V]);if(null!==R&&void 0!==R)for(let V=0;V<4;V++)t.push(R[4*u[G]+V]);if(null!==V&&void 0!==V)for(let W=0;W<2;W++)x.push(V[2*u[G]+W]);if(null!==d&&void 0!==d)for(let V=0;V<4;V++)Y.push(d[4*u[G]+V]);if(null!==k&&void 0!==k)for(let V=0;V<4;V++)g.push(k[4*u[G]+V]);if(null!==z&&void 0!==z)for(let V=0;V<4;V++)B.push(z[4*u[G]+V]);if(null!==X&&void 0!==X)for(let V=0;V<4;V++)S.push(X[4*u[G]+V])}A.push(y)}}const H=[];L.b.ComputeNormals(P,A,H),G.DG=P,G.indices=A,G.iG=H,null!==V&&void 0!==V&&(G.FG=x),null!==R&&void 0!==R&&(G.eG=t),null!==d&&void 0!==d&&(G.matricesIndices=Y),null!==k&&void 0!==k&&(G.matricesWeights=g),null!==z&&void 0!==z&&(G.matricesIndicesExtra=B),null!==k&&void 0!==k&&(G.matricesWeightsExtra=S),G.vG(this,this.isVertexBufferUpdatable(q.c.PositionKind))}}static _instancedMeshFactory(G,V){throw(0,u.e)("InstancedMesh")}static _PhysicsImpostorParser(G,V,W){throw(0,u.e)("PhysicsImpostor")}createInstance(G){const V=C._instancedMeshFactory(G,this);return V.parent=this.parent,V}synchronizeInstances(){for(let G=0;G<this.instances.length;G++){this.instances[G]._syncSubMeshes()}return this}optimizeIndices(G){const V=this.Pd(),W=this.getVerticesData(q.c.PositionKind);if(!W||!V)return this;const J=[];for(let R=0;R<W.length;R+=3)J.push(P.o.ld(W,R));const d=[];return R.d.SyncAsyncForLoop(J.length,40,(G=>{const V=J.length-1-G,W=J[V];for(let R=0;R<V;++R){const G=J[R];if(W.equals(G)){d[V]=R;break}}}),(()=>{for(let G=0;G<V.length;++G)V[G]=d[V[G]]||V[G];const W=this.Ed.slice(0);this.setIndices(V),this.Ed=W,G&&G(this)})),this}serialize(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};G.name=this.name,G.id=this.id,G.uniqueId=this.uniqueId,G.type=this.getClassName(),k.c&&k.c.HasTags(this)&&(G.tags=k.c.GetTags(this)),G.position=this.position.Bd(),this.rotationQuaternion?G.rotationQuaternion=this.rotationQuaternion.Bd():this.rotation&&(G.rotation=this.rotation.Bd()),G.vd=this.vd.Bd(),this._postMultiplyPivotMatrix?G.pivotMatrix=this.getPivotMatrix().Bd():G.localMatrix=this.getPivotMatrix().Bd(),G.isEnabled=this.isEnabled(!1),G.isVisible=this.isVisible,G.infiniteDistance=this.infiniteDistance,G.pickable=this.bX,G.receiveShadows=this.receiveShadows,G.billboardMode=this.billboardMode,G.visibility=this.visibility,G.gz=this.gz,G.checkCollisions=this.checkCollisions,G.ellipsoid=this.ellipsoid.Bd(),G.ellipsoidOffset=this.ellipsoidOffset.Bd(),G.CG=this.CG,G.isBlocker=this.isBlocker,G.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(G),G.isUnIndexed=this.isUnIndexed;const V=this._geometry;if(V&&this.Ed){G.geometryUniqueId=V.uniqueId,G.geometryId=V.id,G.Ed=[];for(let V=0;V<this.Ed.length;V++){const W=this.Ed[V];G.Ed.push({materialIndex:W.materialIndex,verticesStart:W.verticesStart,verticesCount:W.verticesCount,indexStart:W.indexStart,indexCount:W.indexCount})}}if(this.material?this.material.doNotSerialize||(G.materialUniqueId=this.material.uniqueId,G.materialId=this.material.id):(this.material=null,G.materialUniqueId=this._scene.defaultMaterial.uniqueId,G.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(G.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(G.skeletonId=this.skeleton.id,G.numBoneInfluencers=this.numBoneInfluencers),this.HG()._getComponent(H.b.NAME_PHYSICSENGINE)){const V=this.getPhysicsImpostor();V&&(G.physicsMass=V.getParam("PJ"),G.physicsFriction=V.getParam("friction"),G.physicsRestitution=V.getParam("PJ"),G.physicsImpostor=V.type)}this.metadata&&(G.metadata=this.metadata),G.instances=[];for(let W=0;W<this.instances.length;W++){const V=this.instances[W];if(V.doNotSerialize)continue;const J={name:V.name,id:V.id,isEnabled:V.isEnabled(!1),isVisible:V.isVisible,bX:V.bX,checkCollisions:V.checkCollisions,position:V.position.Bd(),vd:V.vd.Bd()};if(V.parent&&V.parent._serializeAsParent(J),V.rotationQuaternion?J.rotationQuaternion=V.rotationQuaternion.Bd():V.rotation&&(J.rotation=V.rotation.Bd()),this.HG()._getComponent(H.b.NAME_PHYSICSENGINE)){const G=V.getPhysicsImpostor();G&&(J.physicsMass=G.getParam("PJ"),J.physicsFriction=G.getParam("friction"),J.physicsRestitution=G.getParam("PJ"),J.physicsImpostor=G.type)}V.metadata&&(J.metadata=V.metadata),V.actionManager&&(J.actions=V.actionManager.serialize(V.name)),G.instances.push(J),b.e.AppendSerializedAnimations(V,J),J.ranges=V.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(G.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const V={data:{},sizes:{},strides:{}};for(const G in this._userThinInstanceBuffersStorage.data)V.data[G]=Array.from(this._userThinInstanceBuffersStorage.data[G]),V.sizes[G]=this._userThinInstanceBuffersStorage.sizes[G],V.strides[G]=this._userThinInstanceBuffersStorage.strides[G];G.thinInstances.userThinInstance=V}return b.e.AppendSerializedAnimations(this,G),G.ranges=this.serializeAnimationRanges(),G.layerMask=this.layerMask,G.alphaIndex=this.alphaIndex,G.hasVertexAlpha=this.hasVertexAlpha,G.overlayAlpha=this.overlayAlpha,G.overlayColor=this.overlayColor.Bd(),G.renderOverlay=this.renderOverlay,G.applyFog=this.applyFog,this.actionManager&&(G.actions=this.actionManager.serialize(this.name)),G}_syncGeometryWithMorphTargetManager(){if(!this.zd)return;this._markSubMeshesAsAttributesDirty();const G=this._internalAbstractMeshDataInfo._morphTargetManager;if(G&&G.vertexCount){if(G.vertexCount!==this.getTotalVertices())return r.c.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(G.isUsingTextureForTargets)return;for(let V=0;V<G.numInfluencers;V++){const W=G.getActiveTarget(V),J=W.getPositions();if(!J)return void r.c.Error("Invalid morph target. Target must have positions.");this.zd.wG(q.c.PositionKind+V,J,!1,3);const R=W.getNormals();R&&this.zd.wG(q.c.NormalKind+V,R,!1,3);const d=W.getTangents();d&&this.zd.wG(q.c.TangentKind+V,d,!1,3);const k=W.getUVs();k&&this.zd.wG(q.c.UVKind+"_"+V,k,!1,2);const z=W.getUV2s();z&&this.zd.wG(q.c.UV2Kind+"_"+V,z,!1,2);const X=W.getColors();X&&this.zd.wG(q.c.ColorKind+V,X,!1,4)}}else{let G=0;for(;this.zd.isVerticesDataPresent(q.c.PositionKind+G);)this.zd.removeVerticesData(q.c.PositionKind+G),this.zd.isVerticesDataPresent(q.c.NormalKind+G)&&this.zd.removeVerticesData(q.c.NormalKind+G),this.zd.isVerticesDataPresent(q.c.TangentKind+G)&&this.zd.removeVerticesData(q.c.TangentKind+G),this.zd.isVerticesDataPresent(q.c.UVKind+G)&&this.zd.removeVerticesData(q.c.UVKind+"_"+G),this.zd.isVerticesDataPresent(q.c.UV2Kind+G)&&this.zd.removeVerticesData(q.c.UV2Kind+"_"+G),this.zd.isVerticesDataPresent(q.c.ColorKind+G)&&this.zd.removeVerticesData(q.c.ColorKind+G),G++}}static Parse(G,V,W){let J;if(J=G.type&&"LinesMesh"===G.type?C._LinesMeshParser(G,V):G.type&&"GroundMesh"===G.type?C._GroundMeshParser(G,V):G.type&&"GoldbergMesh"===G.type?C._GoldbergMeshParser(G,V):G.type&&"GreasedLineMesh"===G.type?C._GreasedLineMeshParser(G,V):G.type&&"TrailMesh"===G.type?C._TrailMeshParser(G,V):new C(G.name,V),J.id=G.id,J._waitingParsedUniqueId=G.uniqueId,k.c&&k.c.AddTagsTo(J,G.tags),J.position=P.o.ld(G.position),void 0!==G.metadata&&(J.metadata=G.metadata),G.rotationQuaternion?J.rotationQuaternion=P.g.ld(G.rotationQuaternion):G.rotation&&(J.rotation=P.o.ld(G.rotation)),J.vd=P.o.ld(G.vd),G.localMatrix?J.setPreTransformMatrix(P.c.ld(G.localMatrix)):G.pivotMatrix&&J.setPivotMatrix(P.c.ld(G.pivotMatrix)),J.rz(G.isEnabled),J.isVisible=G.isVisible,J.infiniteDistance=G.infiniteDistance,J.gz=!!G.gz,J.showBoundingBox=G.showBoundingBox,J.showSubMeshesBoundingBox=G.showSubMeshesBoundingBox,void 0!==G.applyFog&&(J.applyFog=G.applyFog),void 0!==G.pickable&&(J.bX=G.pickable),void 0!==G.alphaIndex&&(J.alphaIndex=G.alphaIndex),J.receiveShadows=G.receiveShadows,void 0!==G.billboardMode&&(J.billboardMode=G.billboardMode),void 0!==G.visibility&&(J.visibility=G.visibility),J.checkCollisions=G.checkCollisions,J.CG=!!G.CG,G.ellipsoid&&(J.ellipsoid=P.o.ld(G.ellipsoid)),G.ellipsoidOffset&&(J.ellipsoidOffset=P.o.ld(G.ellipsoidOffset)),null!=G.overrideMaterialSideOrientation&&(J.sideOrientation=G.overrideMaterialSideOrientation),void 0!==G.sideOrientation&&(J.sideOrientation=G.sideOrientation),void 0!==G.isBlocker&&(J.isBlocker=G.isBlocker),J._shouldGenerateFlatShading=G.useFlatShading,G.Yz&&(J._waitingData.Yz=G.Yz),void 0!==G.parentId&&(J._waitingParentId=G.parentId),void 0!==G.parentInstanceIndex&&(J._waitingParentInstanceIndex=G.parentInstanceIndex),void 0!==G.actions&&(J._waitingData.actions=G.actions),void 0!==G.overlayAlpha&&(J.overlayAlpha=G.overlayAlpha),void 0!==G.overlayColor&&(J.overlayColor=A.d.ld(G.overlayColor)),void 0!==G.renderOverlay&&(J.renderOverlay=G.renderOverlay),J.isUnIndexed=!!G.isUnIndexed,J.hasVertexAlpha=G.hasVertexAlpha,G.delayLoadingFile?(J.delayLoadState=4,J.delayLoadingFile=W+G.delayLoadingFile,J.buildBoundingInfo(P.o.ld(G.boundingBoxMinimum),P.o.ld(G.boundingBoxMaximum)),G._binaryInfo&&(J._binaryInfo=G._binaryInfo),J._delayInfo=[],G.hasUVs&&J._delayInfo.push(q.c.UVKind),G.hasUVs2&&J._delayInfo.push(q.c.UV2Kind),G.hasUVs3&&J._delayInfo.push(q.c.UV3Kind),G.hasUVs4&&J._delayInfo.push(q.c.UV4Kind),G.hasUVs5&&J._delayInfo.push(q.c.UV5Kind),G.hasUVs6&&J._delayInfo.push(q.c.UV6Kind),G.hasColors&&J._delayInfo.push(q.c.ColorKind),G.hasMatricesIndices&&J._delayInfo.push(q.c.MatricesIndicesKind),G.hasMatricesWeights&&J._delayInfo.push(q.c.MatricesWeightsKind),J._delayLoadingFunction=t.d._ImportGeometry,p.d.ForceFullSceneLoadingForIncremental&&J._checkDelayState()):t.d._ImportGeometry(G,J),G.materialUniqueId?J._waitingMaterialId=G.materialUniqueId:G.materialId&&(J._waitingMaterialId=G.materialId),G.morphTargetManagerId>-1&&(J._waitingMorphTargetManagerId=G.morphTargetManagerId),void 0!==G.skeletonId&&null!==G.skeletonId&&(J.skeleton=V.getLastSkeletonById(G.skeletonId),G.numBoneInfluencers&&(J.numBoneInfluencers=G.numBoneInfluencers)),G.animations){for(let V=0;V<G.animations.length;V++){const W=G.animations[V],R=(0,y.c)("BABYLON.Animation");R&&J.animations.push(R.Parse(W))}x.d.ParseAnimationRanges(J,G,V)}if(G.autoAnimate&&V.beginAnimation(J,G.autoAnimateFrom,G.autoAnimateTo,G.autoAnimateLoop,G.autoAnimateSpeed||1),G.layerMask&&!isNaN(G.layerMask)?J.layerMask=Math.abs(parseInt(G.layerMask)):J.layerMask=268435455,G.physicsImpostor&&(J.physicsImpostor=C._PhysicsImpostorParser(V,J,G)),G.lodMeshIds&&(J._waitingData.lods={ids:G.lodMeshIds,distances:G.lodDistances?G.lodDistances:null,coverages:G.lodCoverages?G.lodCoverages:null}),G.instances)for(let R=0;R<G.instances.length;R++){const W=G.instances[R],d=J.createInstance(W.name);if(W.id&&(d.id=W.id),k.c&&(W.tags?k.c.AddTagsTo(d,W.tags):k.c.AddTagsTo(d,G.tags)),d.position=P.o.ld(W.position),void 0!==W.metadata&&(d.metadata=W.metadata),void 0!==W.parentId&&(d._waitingParentId=W.parentId),void 0!==W.parentInstanceIndex&&(d._waitingParentInstanceIndex=W.parentInstanceIndex),void 0!==W.isEnabled&&null!==W.isEnabled&&d.rz(W.isEnabled),void 0!==W.isVisible&&null!==W.isVisible&&(d.isVisible=W.isVisible),void 0!==W.bX&&null!==W.bX&&(d.bX=W.bX),W.rotationQuaternion?d.rotationQuaternion=P.g.ld(W.rotationQuaternion):W.rotation&&(d.rotation=P.o.ld(W.rotation)),d.vd=P.o.ld(W.vd),void 0!=W.checkCollisions&&null!=W.checkCollisions&&(d.checkCollisions=W.checkCollisions),void 0!=W.pickable&&null!=W.pickable&&(d.bX=W.pickable),void 0!=W.showBoundingBox&&null!=W.showBoundingBox&&(d.showBoundingBox=W.showBoundingBox),void 0!=W.showSubMeshesBoundingBox&&null!=W.showSubMeshesBoundingBox&&(d.showSubMeshesBoundingBox=W.showSubMeshesBoundingBox),void 0!=W.alphaIndex&&null!=W.showSubMeshesBoundingBox&&(d.alphaIndex=W.alphaIndex),W.physicsImpostor&&(d.physicsImpostor=C._PhysicsImpostorParser(V,d,W)),void 0!==W.actions&&(d._waitingData.actions=W.actions),W.animations){for(let G=0;G<W.animations.length;G++){const V=W.animations[G],J=(0,y.c)("BABYLON.Animation");J&&d.animations.push(J.Parse(V))}x.d.ParseAnimationRanges(d,W,V),W.autoAnimate&&V.beginAnimation(d,W.autoAnimateFrom,W.autoAnimateTo,W.autoAnimateLoop,W.autoAnimateSpeed||1)}}if(G.thinInstances){const V=G.thinInstances;if(J.thinInstanceEnablePicking=!!V.enablePicking,V.matrixData?(J.EA("matrix",new Float32Array(V.matrixData),16,!1),J._thinInstanceDataStorage.matrixBufferSize=V.matrixBufferSize,J._thinInstanceDataStorage.instancesCount=V.instancesCount):J._thinInstanceDataStorage.matrixBufferSize=V.matrixBufferSize,G.thinInstances.userThinInstance){const V=G.thinInstances.userThinInstance;for(const G in V.data)J.EA(G,new Float32Array(V.data[G]),V.strides[G],!1),J._userThinInstanceBuffersStorage.sizes[G]=V.sizes[G]}}return J}setPositionsForCPUSkinning(){const G=this._internalMeshDataInfo;if(!G._sourcePositions){const V=this.getVerticesData(q.c.PositionKind);if(!V)return G._sourcePositions;G._sourcePositions=new Float32Array(V),this.isVertexBufferUpdatable(q.c.PositionKind)||this.wG(q.c.PositionKind,V,!0)}return G._sourcePositions}setNormalsForCPUSkinning(){const G=this._internalMeshDataInfo;if(!G._sourceNormals){const V=this.getVerticesData(q.c.NormalKind);if(!V)return G._sourceNormals;G._sourceNormals=new Float32Array(V),this.isVertexBufferUpdatable(q.c.NormalKind)||this.wG(q.c.NormalKind,V,!0)}return G._sourceNormals}applySkeleton(G){if(!this.zd)return this;if(this.zd._softwareSkinningFrameId==this.HG().getFrameId())return this;if(this.zd._softwareSkinningFrameId=this.HG().getFrameId(),!this.isVerticesDataPresent(q.c.PositionKind))return this;if(!this.isVerticesDataPresent(q.c.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(q.c.MatricesWeightsKind))return this;const V=this.isVerticesDataPresent(q.c.NormalKind),W=this._internalMeshDataInfo;if(!W._sourcePositions){const G=this.Ed.slice();this.setPositionsForCPUSkinning(),this.Ed=G}V&&!W._sourceNormals&&this.setNormalsForCPUSkinning();let J=this.getVerticesData(q.c.PositionKind);if(!J)return this;J instanceof Float32Array||(J=new Float32Array(J));let R=this.getVerticesData(q.c.NormalKind);if(V){if(!R)return this;R instanceof Float32Array||(R=new Float32Array(R))}const d=this.getVerticesData(q.c.MatricesIndicesKind),k=this.getVerticesData(q.c.MatricesWeightsKind);if(!k||!d)return this;const z=this.numBoneInfluencers>4,X=z?this.getVerticesData(q.c.MatricesIndicesExtraKind):null,A=z?this.getVerticesData(q.c.MatricesWeightsExtraKind):null,x=G.getTransformMatrices(this),L=P.o.Zero(),t=new P.c,Y=new P.c;let g,B=0;for(let q=0;q<J.length;q+=3,B+=4){let G;for(g=0;g<4;g++)G=k[B+g],G>0&&(P.c.FromFloat32ArrayToRefScaled(x,Math.floor(16*d[B+g]),G,Y),t.addToSelf(Y));if(z)for(g=0;g<4;g++)G=A[B+g],G>0&&(P.c.FromFloat32ArrayToRefScaled(x,Math.floor(16*X[B+g]),G,Y),t.addToSelf(Y));P.o.TransformCoordinatesFromFloatsToRef(W._sourcePositions[q],W._sourcePositions[q+1],W._sourcePositions[q+2],t,L),L.toArray(J,q),V&&(P.o.TransformNormalFromFloatsToRef(W._sourceNormals[q],W._sourceNormals[q+1],W._sourceNormals[q+2],t,L),L.toArray(R,q)),t.reset()}return this.updateVerticesData(q.c.PositionKind,J),V&&this.updateVerticesData(q.c.NormalKind,R),this}static MinMax(G){let V=null,W=null;for(const J of G){const G=J.getBoundingInfo().boundingBox;V&&W?(V.minimizeInPlace(G.minimumWorld),W.maximizeInPlace(G.maximumWorld)):(V=G.minimumWorld,W=G.maximumWorld)}return V&&W?{min:V,max:W}:{min:P.o.Zero(),max:P.o.Zero()}}static Center(G){const V=G instanceof Array?C.MinMax(G):G;return P.o.Center(V.min,V.max)}static MergeMeshes(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],W=arguments.length>2?arguments[2]:void 0,J=arguments.length>3?arguments[3]:void 0,R=arguments.length>4?arguments[4]:void 0,d=arguments.length>5?arguments[5]:void 0;return(0,z.f)(C._MergeMeshesCoroutine(G,V,W,J,R,d,!1))}static async MergeMeshesAsync(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],W=arguments.length>2?arguments[2]:void 0,J=arguments.length>3?arguments[3]:void 0,R=arguments.length>4?arguments[4]:void 0,d=arguments.length>5?arguments[5]:void 0;return await(0,z.e)(C._MergeMeshesCoroutine(G,V,W,J,R,d,!0),(0,z.c)())}static*_MergeMeshesCoroutine(G){let V,W=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],J=arguments.length>2?arguments[2]:void 0,R=arguments.length>3?arguments[3]:void 0,d=arguments.length>4?arguments[4]:void 0,k=arguments.length>5?arguments[5]:void 0,z=arguments.length>6?arguments[6]:void 0;if(0===(G=G.filter(Boolean)).length)return null;if(!J){let W=0;for(V=0;V<G.length;V++)if(W+=G[V].getTotalVertices(),W>=65536)return r.c.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}k&&(d=!1);const X=new Array,P=new Array,A=new Array,x=G[0].sideOrientation;for(V=0;V<G.length;V++){const W=G[V];if(W.isAnInstance)return r.c.Warn("Cannot merge instance meshes."),null;if(x!==W.sideOrientation)return r.c.Warn("Cannot merge meshes with different sideOrientation values."),null;if(d&&A.push(W.getTotalIndices()),k)if(W.material){const G=W.material;if(G instanceof S.d){for(let V=0;V<G.od.length;V++)X.indexOf(G.od[V])<0&&X.push(G.od[V]);for(let V=0;V<W.Ed.length;V++)P.push(X.indexOf(G.od[W.Ed[V].materialIndex])),A.push(W.Ed[V].indexCount)}else{X.indexOf(G)<0&&X.push(G);for(let V=0;V<W.Ed.length;V++)P.push(X.indexOf(G)),A.push(W.Ed[V].indexCount)}}else for(let G=0;G<W.Ed.length;G++)P.push(0),A.push(W.Ed[G].indexCount)}const q=G[0],t=G=>{const V=G.kd(!0);return{vertexData:L.b.ExtractFromMesh(G,!1,!1),transform:V}},{vertexData:Y,transform:B}=t(q);z&&(yield);const p=new Array(G.length-1);for(let L=1;L<G.length;L++)p[L-1]=t(G[L]),z&&(yield);const b=Y._mergeCoroutine(B,p,J,z,!W);let y=b.next();for(;!y.done;)z&&(yield),y=b.next();const u=y.value;R||(R=new C(q.name+"_merged",q.HG()));const H=u._applyToCoroutine(R,void 0,z);let n=H.next();for(;!n.done;)z&&(yield),n=H.next();if(R.checkCollisions=q.checkCollisions,R.sideOrientation=q.sideOrientation,W)for(V=0;V<G.length;V++)G[V].dispose();if(d||k){R.releaseSubMeshes(),V=0;let G=0;for(;V<A.length;)g.e.CreateFromIndices(0,G,A[V],R,void 0,!1),G+=A[V],V++;for(const V of R.Ed)V.refreshBoundingInfo();R.kd(!0)}if(k){const G=new S.d(q.name+"_merged",q.HG());G.od=X;for(let V=0;V<R.Ed.length;V++)R.Ed[V].materialIndex=P[V];R.material=G}else R.material=q.material;return R}Ox(G){G._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(G)}Ix(G){const V=G._indexInSourceMeshInstanceArray;if(-1!=V){if(V!==this.instances.length-1){const G=this.instances[this.instances.length-1];this.instances[V]=G,G._indexInSourceMeshInstanceArray=V}G._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===B.e.CounterClockWiseSideOrientation}_getRenderingFillMode(G){const V=this.HG();return V.forcePointsCloud?B.e.PointFillMode:V.forceWireframe?B.e.WireFrameFillMode:this.overrideRenderingFillMode??G}setMaterialByID(G){return this.setMaterialById(G)}static CreateRibbon(G,V,W,J,R,d,k,z,X){throw new Error("Import MeshBuilder to populate this function")}static CreateDisc(G,V,W,J,R,d){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(G,V,W,J,R){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(G,V,W,J,R,d){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(G,V,W,J){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(G,V,W,J,R,d,k,z,X){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(G,V,W,J,R,d,k){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(G,V,W,J,R,d,k,z,X,P){throw new Error("Import MeshBuilder to populate this function")}static IX(G,V,W,J,R){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(G,V,W,J,R,d,k,z){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(G,V,W,J,R,d,k){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(G,V,W,J,R,d,k,z){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(G,V,W,J,R,d,k,z,X,P){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(G,V,W,J,R,d,k,z,X,P,A,x){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(G,V,W,J,R,d,k){throw new Error("Import MeshBuilder to populate this function")}static GP(G,V,W,J,R){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(G,V,W,J,R,d){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(G,V,W,J,R,d,k,z,X){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(G,V,W,J,R,d,k,z,X,P,A){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(G,V,W,J,R,d,k,z,X,P){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(G,V,W){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(G,V,W){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(G,V,W,J,R,d){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(G,V,W){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(G){throw new Error("Import MeshBuilder to populate this function")}}C.FRONTSIDE=L.b.FRONTSIDE,C.BACKSIDE=L.b.BACKSIDE,C.DOUBLESIDE=L.b.DOUBLESIDE,C.DEFAULTSIDE=L.b.DEFAULTSIDE,C.NO_CAP=0,C.CAP_START=1,C.CAP_END=2,C.CAP_ALL=3,C.NO_FLIP=0,C.FLIP_TILE=1,C.ROTATE_TILE=2,C.FLIP_ROW=3,C.ROTATE_ROW=4,C.FLIP_N_ROTATE_TILE=5,C.FLIP_N_ROTATE_ROW=6,C.CENTER=0,C.LEFT=1,C.RIGHT=2,C.TOP=3,C.BOTTOM=4,C.INSTANCEDMESH_SORT_TRANSPARENT=!1,C._GroundMeshParser=(G,V)=>{throw(0,u.e)("GroundMesh")},C._GoldbergMeshParser=(G,V)=>{throw(0,u.e)("GoldbergMesh")},C._LinesMeshParser=(G,V)=>{throw(0,u.e)("LinesMesh")},C._GreasedLineMeshParser=(G,V)=>{throw(0,u.e)("GreasedLineMesh")},C._GreasedLineRibbonMeshParser=(G,V)=>{throw(0,u.e)("GreasedLineRibbonMesh")},C._TrailMeshParser=(G,V)=>{throw(0,u.e)("TrailMesh")},(0,y.d)("BABYLON.Mesh",C)},11482:(G,V,W)=>{W.d(V,{b:()=>t});var J=W(11317),R=W(11136),d=W(11345),k=W(11218),z=W(11424),X=W(11201),P=W(11324),A=W(11489),x=W(11234),q=W(11339);class L{}class t{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,A.d)(this._applyToCoroutine.bind(this)),this.uniqueId=t._UniqueIdGenerator,t._UniqueIdGenerator++}set(G,V){switch(G.length||X.c.Warn(`Setting vertex data kind '${V}' with an empty array`),V){case d.c.PositionKind:this.DG=G;break;case d.c.NormalKind:this.iG=G;break;case d.c.TangentKind:this.tangents=G;break;case d.c.UVKind:this.FG=G;break;case d.c.UV2Kind:this.uvs2=G;break;case d.c.UV3Kind:this.uvs3=G;break;case d.c.UV4Kind:this.uvs4=G;break;case d.c.UV5Kind:this.uvs5=G;break;case d.c.UV6Kind:this.uvs6=G;break;case d.c.ColorKind:this.eG=G;break;case d.c.MatricesIndicesKind:this.matricesIndices=G;break;case d.c.MatricesWeightsKind:this.matricesWeights=G;break;case d.c.MatricesIndicesExtraKind:this.matricesIndicesExtra=G;break;case d.c.MatricesWeightsExtraKind:this.matricesWeightsExtra=G}}vG(G,V){return this._applyTo(G,V,!1),this}applyToGeometry(G,V){return this._applyTo(G,V,!1),this}updateMesh(G){return this._update(G),this}updateGeometry(G){return this._update(G),this}*_applyToCoroutine(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2?arguments[2]:void 0;if(this.DG&&(G.wG(d.c.PositionKind,this.DG,V),W&&(yield)),this.iG&&(G.wG(d.c.NormalKind,this.iG,V),W&&(yield)),this.tangents&&(G.wG(d.c.TangentKind,this.tangents,V),W&&(yield)),this.FG&&(G.wG(d.c.UVKind,this.FG,V),W&&(yield)),this.uvs2&&(G.wG(d.c.UV2Kind,this.uvs2,V),W&&(yield)),this.uvs3&&(G.wG(d.c.UV3Kind,this.uvs3,V),W&&(yield)),this.uvs4&&(G.wG(d.c.UV4Kind,this.uvs4,V),W&&(yield)),this.uvs5&&(G.wG(d.c.UV5Kind,this.uvs5,V),W&&(yield)),this.uvs6&&(G.wG(d.c.UV6Kind,this.uvs6,V),W&&(yield)),this.eG){const J=this.DG&&this.eG.length===this.DG.length?3:4;G.wG(d.c.ColorKind,this.eG,V,J),this.hasVertexAlpha&&void 0!==G.hasVertexAlpha&&(G.hasVertexAlpha=!0),W&&(yield)}if(this.matricesIndices&&(G.wG(d.c.MatricesIndicesKind,this.matricesIndices,V),W&&(yield)),this.matricesWeights&&(G.wG(d.c.MatricesWeightsKind,this.matricesWeights,V),W&&(yield)),this.matricesIndicesExtra&&(G.wG(d.c.MatricesIndicesExtraKind,this.matricesIndicesExtra,V),W&&(yield)),this.matricesWeightsExtra&&(G.wG(d.c.MatricesWeightsExtraKind,this.matricesWeightsExtra,V),W&&(yield)),this.indices?(G.setIndices(this.indices,null,V),W&&(yield)):G.setIndices([],null),G.Ed&&this.materialInfos&&this.materialInfos.length>1){const V=G;V.Ed=[];for(const G of this.materialInfos)new q.e(G.materialIndex,G.verticesStart,G.verticesCount,G.indexStart,G.indexCount,V)}return this}_update(G,V,W){return this.DG&&G.updateVerticesData(d.c.PositionKind,this.DG,V,W),this.iG&&G.updateVerticesData(d.c.NormalKind,this.iG,V,W),this.tangents&&G.updateVerticesData(d.c.TangentKind,this.tangents,V,W),this.FG&&G.updateVerticesData(d.c.UVKind,this.FG,V,W),this.uvs2&&G.updateVerticesData(d.c.UV2Kind,this.uvs2,V,W),this.uvs3&&G.updateVerticesData(d.c.UV3Kind,this.uvs3,V,W),this.uvs4&&G.updateVerticesData(d.c.UV4Kind,this.uvs4,V,W),this.uvs5&&G.updateVerticesData(d.c.UV5Kind,this.uvs5,V,W),this.uvs6&&G.updateVerticesData(d.c.UV6Kind,this.uvs6,V,W),this.eG&&G.updateVerticesData(d.c.ColorKind,this.eG,V,W),this.matricesIndices&&G.updateVerticesData(d.c.MatricesIndicesKind,this.matricesIndices,V,W),this.matricesWeights&&G.updateVerticesData(d.c.MatricesWeightsKind,this.matricesWeights,V,W),this.matricesIndicesExtra&&G.updateVerticesData(d.c.MatricesIndicesExtraKind,this.matricesIndicesExtra,V,W),this.matricesWeightsExtra&&G.updateVerticesData(d.c.MatricesWeightsExtraKind,this.matricesWeightsExtra,V,W),this.indices&&G.setIndices(this.indices,null),this}static _TransformVector3Coordinates(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:G.length;const d=R.h.ed[0],k=R.h.ed[1];for(let z=W;z<W+J;z+=3)R.o.FromArrayToRef(G,z,d),R.o.TransformCoordinatesToRef(d,V,k),G[z]=k.x,G[z+1]=k.y,G[z+2]=k.z}static _TransformVector3Normals(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:G.length;const d=R.h.ed[0],k=R.h.ed[1];for(let z=W;z<W+J;z+=3)R.o.FromArrayToRef(G,z,d),R.o.TransformNormalToRef(d,V,k),G[z]=k.x,G[z+1]=k.y,G[z+2]=k.z}static _TransformVector4Normals(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:G.length;const d=R.h.Vector4[0],k=R.h.Vector4[1];for(let z=W;z<W+J;z+=4)R.q.FromArrayToRef(G,z,d),R.q.TransformNormalToRef(d,V,k),G[z]=k.x,G[z+1]=k.y,G[z+2]=k.z,G[z+3]=k.w}static _FlipFaces(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:G.length;for(let J=V;J<V+W;J+=3){const V=G[J+1];G[J+1]=G[J+2],G[J+2]=V}}transform(G){const V=G.determinant()<0;return this.DG&&t._TransformVector3Coordinates(this.DG,G),this.iG&&t._TransformVector3Normals(this.iG,G),this.tangents&&t._TransformVector4Normals(this.tangents,G),V&&this.indices&&t._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const G=[];for(const V of this.materialInfos){const W=new t;if(this.DG&&(W.DG=this.DG.slice(3*V.verticesStart,3*(V.verticesCount+V.verticesStart))),this.iG&&(W.iG=this.iG.slice(3*V.verticesStart,3*(V.verticesCount+V.verticesStart))),this.tangents&&(W.tangents=this.tangents.slice(4*V.verticesStart,4*(V.verticesCount+V.verticesStart))),this.eG&&(W.eG=this.eG.slice(4*V.verticesStart,4*(V.verticesCount+V.verticesStart))),this.FG&&(W.FG=this.FG.slice(2*V.verticesStart,2*(V.verticesCount+V.verticesStart))),this.uvs2&&(W.uvs2=this.uvs2.slice(2*V.verticesStart,2*(V.verticesCount+V.verticesStart))),this.uvs3&&(W.uvs3=this.uvs3.slice(2*V.verticesStart,2*(V.verticesCount+V.verticesStart))),this.uvs4&&(W.uvs4=this.uvs4.slice(2*V.verticesStart,2*(V.verticesCount+V.verticesStart))),this.uvs5&&(W.uvs5=this.uvs5.slice(2*V.verticesStart,2*(V.verticesCount+V.verticesStart))),this.uvs6&&(W.uvs6=this.uvs6.slice(2*V.verticesStart,2*(V.verticesCount+V.verticesStart))),this.matricesIndices&&(W.matricesIndices=this.matricesIndices.slice(4*V.verticesStart,4*(V.verticesCount+V.verticesStart))),this.matricesIndicesExtra&&(W.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*V.verticesStart,4*(V.verticesCount+V.verticesStart))),this.matricesWeights&&(W.matricesWeights=this.matricesWeights.slice(4*V.verticesStart,4*(V.verticesCount+V.verticesStart))),this.matricesWeightsExtra&&(W.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*V.verticesStart,4*(V.verticesCount+V.verticesStart))),this.indices){W.indices=[];for(let G=V.indexStart;G<V.indexStart+V.indexCount;G++)W.indices.push(this.indices[G]-V.verticesStart)}const J=new L;J.indexStart=0,J.indexCount=W.indices?W.indices.length:0,J.materialIndex=V.materialIndex,J.verticesStart=0,J.verticesCount=(W.DG?W.DG.length:0)/3,W.materialInfos=[J],G.push(W)}return G}merge(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],R=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const d=Array.isArray(G)?G.map((G=>({vertexData:G}))):[{vertexData:G}];return(0,A.f)(this._mergeCoroutine(void 0,d,V,!1,W,J,R))}*_mergeCoroutine(G,V){var W,J;let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3?arguments[3]:void 0,z=arguments.length>4?arguments[4]:void 0,X=arguments.length>5&&void 0!==arguments[5]&&arguments[5],P=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let A=V.map((G=>G.vertexData)),x=this;if(P)for(const d of A)d&&(d._validate(),!this.iG&&d.iG&&(this.iG=new Float32Array(this.DG.length)),!this.tangents&&d.tangents&&(this.tangents=new Float32Array(this.DG.length/3*4)),!this.FG&&d.FG&&(this.FG=new Float32Array(this.DG.length/3*2)),!this.uvs2&&d.uvs2&&(this.uvs2=new Float32Array(this.DG.length/3*2)),!this.uvs3&&d.uvs3&&(this.uvs3=new Float32Array(this.DG.length/3*2)),!this.uvs4&&d.uvs4&&(this.uvs4=new Float32Array(this.DG.length/3*2)),!this.uvs5&&d.uvs5&&(this.uvs5=new Float32Array(this.DG.length/3*2)),!this.uvs6&&d.uvs6&&(this.uvs6=new Float32Array(this.DG.length/3*2)),!this.eG&&d.eG&&(this.eG=new Float32Array(this.DG.length/3*4),this.eG.fill(1)),!this.matricesIndices&&d.matricesIndices&&(this.matricesIndices=new Float32Array(this.DG.length/3*4)),!this.matricesWeights&&d.matricesWeights&&(this.matricesWeights=new Float32Array(this.DG.length/3*4)),!this.matricesIndicesExtra&&d.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.DG.length/3*4)),!this.matricesWeightsExtra&&d.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.DG.length/3*4)));for(const d of A)if(d)if(P)this.iG&&!d.iG&&(d.iG=new Float32Array(d.DG.length)),this.tangents&&!d.tangents&&(d.tangents=new Float32Array(d.DG.length/3*4)),this.FG&&!d.FG&&(d.FG=new Float32Array(d.DG.length/3*2)),this.uvs2&&!d.uvs2&&(d.uvs2=new Float32Array(d.DG.length/3*2)),this.uvs3&&!d.uvs3&&(d.uvs3=new Float32Array(d.DG.length/3*2)),this.uvs4&&!d.uvs4&&(d.uvs4=new Float32Array(d.DG.length/3*2)),this.uvs5&&!d.uvs5&&(d.uvs5=new Float32Array(d.DG.length/3*2)),this.uvs6&&!d.uvs6&&(d.uvs6=new Float32Array(d.DG.length/3*2)),this.eG&&!d.eG&&(d.eG=new Float32Array(d.DG.length/3*4),d.eG.fill(1)),this.matricesIndices&&!d.matricesIndices&&(d.matricesIndices=new Float32Array(d.DG.length/3*4)),this.matricesWeights&&!d.matricesWeights&&(d.matricesWeights=new Float32Array(d.DG.length/3*4)),this.matricesIndicesExtra&&!d.matricesIndicesExtra&&(d.matricesIndicesExtra=new Float32Array(d.DG.length/3*4)),this.matricesWeightsExtra&&!d.matricesWeightsExtra&&(d.matricesWeightsExtra=new Float32Array(d.DG.length/3*4));else if(d._validate(),!this.iG!==!d.iG||!this.tangents!==!d.tangents||!this.FG!==!d.FG||!this.uvs2!==!d.uvs2||!this.uvs3!==!d.uvs3||!this.uvs4!==!d.uvs4||!this.uvs5!==!d.uvs5||!this.uvs6!==!d.uvs6||!this.eG!==!d.eG||!this.matricesIndices!==!d.matricesIndices||!this.matricesWeights!==!d.matricesWeights||!this.matricesIndicesExtra!==!d.matricesIndicesExtra||!this.matricesWeightsExtra!==!d.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(X){let W=0,J=0,R=0;const d=[];let k=null;const z=[];for(const V of this.splitBasedOnMaterialID())z.push({vertexData:V,transform:G});for(const G of V)if(G.vertexData)for(const V of G.vertexData.splitBasedOnMaterialID())z.push({vertexData:V,transform:G.transform});z.sort(((G,V)=>{const W=G.vertexData.materialInfos?G.vertexData.materialInfos[0].materialIndex:0,J=V.vertexData.materialInfos?V.vertexData.materialInfos[0].materialIndex:0;return W>J?1:W===J?0:-1}));for(const G of z){const V=G.vertexData;if(W=V.materialInfos?V.materialInfos[0].materialIndex:0,k&&k.materialIndex===W)k.indexCount+=V.indices.length,k.verticesCount+=V.DG.length/3;else{const G=new L;G.materialIndex=W,G.indexStart=J,G.indexCount=V.indices.length,G.verticesStart=R,G.verticesCount=V.DG.length/3,d.push(G),k=G}J+=V.indices.length,R+=V.DG.length/3}const X=z.splice(0,1)[0];x=X.vertexData,G=X.transform,A=z.map((G=>G.vertexData)),V=z,this.materialInfos=d}const q=A.reduce(((G,V)=>{var W;return G+((null===(W=V.indices)||void 0===W?void 0:W.length)??0)}),(null===(W=x.indices)||void 0===W?void 0:W.length)??0);let Y=z||A.some((G=>G.indices===x.indices))?null===(J=x.indices)||void 0===J?void 0:J.slice():x.indices;if(q>0){var g;let W=(null===(g=Y)||void 0===g?void 0:g.length)??0;if(Y||(Y=new Array(q)),Y.length!==q){if(Array.isArray(Y))Y.length=q;else{const G=R||Y instanceof Uint32Array?new Uint32Array(q):new Uint16Array(q);G.set(Y),Y=G}G&&G.determinant()<0&&t._FlipFaces(Y,0,W)}let J=x.DG?x.DG.length/3:0;for(const{vertexData:G,transform:R}of V)if(G.indices){for(let V=0;V<G.indices.length;V++)Y[W+V]=G.indices[V]+J;R&&R.determinant()<0&&t._FlipFaces(Y,W,G.indices.length),J+=G.DG.length/3,W+=G.indices.length,k&&(yield)}}return this.indices=Y,this.DG=t._MergeElement(d.c.PositionKind,x.DG,G,V.map((G=>[G.vertexData.DG,G.transform]))),k&&(yield),x.iG&&(this.iG=t._MergeElement(d.c.NormalKind,x.iG,G,V.map((G=>[G.vertexData.iG,G.transform]))),k&&(yield)),x.tangents&&(this.tangents=t._MergeElement(d.c.TangentKind,x.tangents,G,V.map((G=>[G.vertexData.tangents,G.transform]))),k&&(yield)),x.FG&&(this.FG=t._MergeElement(d.c.UVKind,x.FG,G,V.map((G=>[G.vertexData.FG,G.transform]))),k&&(yield)),x.uvs2&&(this.uvs2=t._MergeElement(d.c.UV2Kind,x.uvs2,G,V.map((G=>[G.vertexData.uvs2,G.transform]))),k&&(yield)),x.uvs3&&(this.uvs3=t._MergeElement(d.c.UV3Kind,x.uvs3,G,V.map((G=>[G.vertexData.uvs3,G.transform]))),k&&(yield)),x.uvs4&&(this.uvs4=t._MergeElement(d.c.UV4Kind,x.uvs4,G,V.map((G=>[G.vertexData.uvs4,G.transform]))),k&&(yield)),x.uvs5&&(this.uvs5=t._MergeElement(d.c.UV5Kind,x.uvs5,G,V.map((G=>[G.vertexData.uvs5,G.transform]))),k&&(yield)),x.uvs6&&(this.uvs6=t._MergeElement(d.c.UV6Kind,x.uvs6,G,V.map((G=>[G.vertexData.uvs6,G.transform]))),k&&(yield)),x.eG&&(this.eG=t._MergeElement(d.c.ColorKind,x.eG,G,V.map((G=>[G.vertexData.eG,G.transform]))),(void 0!==x.hasVertexAlpha||V.some((G=>void 0!==G.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=x.hasVertexAlpha||V.some((G=>G.vertexData.hasVertexAlpha))),k&&(yield)),x.matricesIndices&&(this.matricesIndices=t._MergeElement(d.c.MatricesIndicesKind,x.matricesIndices,G,V.map((G=>[G.vertexData.matricesIndices,G.transform]))),k&&(yield)),x.matricesWeights&&(this.matricesWeights=t._MergeElement(d.c.MatricesWeightsKind,x.matricesWeights,G,V.map((G=>[G.vertexData.matricesWeights,G.transform]))),k&&(yield)),x.matricesIndicesExtra&&(this.matricesIndicesExtra=t._MergeElement(d.c.MatricesIndicesExtraKind,x.matricesIndicesExtra,G,V.map((G=>[G.vertexData.matricesIndicesExtra,G.transform]))),k&&(yield)),x.matricesWeightsExtra&&(this.matricesWeightsExtra=t._MergeElement(d.c.MatricesWeightsExtraKind,x.matricesWeightsExtra,G,V.map((G=>[G.vertexData.matricesWeightsExtra,G.transform])))),this}static _MergeElement(G,V,W,J){const R=J.filter((G=>null!==G[0]&&void 0!==G[0]));if(!V&&0==R.length)return V;if(!V)return this._MergeElement(G,R[0][0],R[0][1],R.slice(1));const k=R.reduce(((G,V)=>G+V[0].length),V.length),z=G===d.c.PositionKind?t._TransformVector3Coordinates:G===d.c.NormalKind?t._TransformVector3Normals:G===d.c.TangentKind?t._TransformVector4Normals:()=>{};if(V instanceof Float32Array){const G=new Float32Array(k);G.set(V),W&&z(G,W,0,V.length);let J=V.length;for(const[V,W]of R)G.set(V,J),W&&z(G,W,J,V.length),J+=V.length;return G}{const G=new Array(k);for(let W=0;W<V.length;W++)G[W]=V[W];W&&z(G,W,0,V.length);let J=V.length;for(const[V,W]of R){for(let W=0;W<V.length;W++)G[J+W]=V[W];W&&z(G,W,J,V.length),J+=V.length}return G}}_validate(){if(!this.DG)throw new x.f("Positions are required",x.d.MeshInvalidPositionsError);const G=(G,V)=>{const W=d.c.DeduceStride(G);if(V.length%W!==0)throw new Error("The "+G+"s array count must be a multiple of "+W);return V.length/W},V=G(d.c.PositionKind,this.DG),W=(W,J)=>{const R=G(W,J);if(R!==V)throw new Error("The "+W+"s element count ("+R+") does not match the positions count ("+V+")")};this.iG&&W(d.c.NormalKind,this.iG),this.tangents&&W(d.c.TangentKind,this.tangents),this.FG&&W(d.c.UVKind,this.FG),this.uvs2&&W(d.c.UV2Kind,this.uvs2),this.uvs3&&W(d.c.UV3Kind,this.uvs3),this.uvs4&&W(d.c.UV4Kind,this.uvs4),this.uvs5&&W(d.c.UV5Kind,this.uvs5),this.uvs6&&W(d.c.UV6Kind,this.uvs6),this.eG&&W(d.c.ColorKind,this.eG),this.matricesIndices&&W(d.c.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&W(d.c.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&W(d.c.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&W(d.c.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const G=this.serialize();return t.Parse(G)}serialize(){const G={};if(this.DG&&(G.DG=Array.from(this.DG)),this.iG&&(G.iG=Array.from(this.iG)),this.tangents&&(G.tangents=Array.from(this.tangents)),this.FG&&(G.FG=Array.from(this.FG)),this.uvs2&&(G.uvs2=Array.from(this.uvs2)),this.uvs3&&(G.uvs3=Array.from(this.uvs3)),this.uvs4&&(G.uvs4=Array.from(this.uvs4)),this.uvs5&&(G.uvs5=Array.from(this.uvs5)),this.uvs6&&(G.uvs6=Array.from(this.uvs6)),this.eG&&(G.eG=Array.from(this.eG),G.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(G.matricesIndices=Array.from(this.matricesIndices),G.matricesIndicesExpanded=!0),this.matricesWeights&&(G.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(G.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),G.matricesIndicesExtraExpanded=!0),this.matricesWeightsExtra&&(G.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),G.indices=this.indices?Array.from(this.indices):[],this.materialInfos){G.materialInfos=[];for(const V of this.materialInfos){const W={indexStart:V.indexStart,indexCount:V.indexCount,materialIndex:V.materialIndex,verticesStart:V.verticesStart,verticesCount:V.verticesCount};G.materialInfos.push(W)}}return G}static ExtractFromMesh(G,V,W){return t._ExtractFrom(G,V,W)}static ExtractFromGeometry(G,V,W){return t._ExtractFrom(G,V,W)}static _ExtractFrom(G,V,W){const J=new t;if(G.isVerticesDataPresent(d.c.PositionKind)&&(J.DG=G.getVerticesData(d.c.PositionKind,V,W)),G.isVerticesDataPresent(d.c.NormalKind)&&(J.iG=G.getVerticesData(d.c.NormalKind,V,W)),G.isVerticesDataPresent(d.c.TangentKind)&&(J.tangents=G.getVerticesData(d.c.TangentKind,V,W)),G.isVerticesDataPresent(d.c.UVKind)&&(J.FG=G.getVerticesData(d.c.UVKind,V,W)),G.isVerticesDataPresent(d.c.UV2Kind)&&(J.uvs2=G.getVerticesData(d.c.UV2Kind,V,W)),G.isVerticesDataPresent(d.c.UV3Kind)&&(J.uvs3=G.getVerticesData(d.c.UV3Kind,V,W)),G.isVerticesDataPresent(d.c.UV4Kind)&&(J.uvs4=G.getVerticesData(d.c.UV4Kind,V,W)),G.isVerticesDataPresent(d.c.UV5Kind)&&(J.uvs5=G.getVerticesData(d.c.UV5Kind,V,W)),G.isVerticesDataPresent(d.c.UV6Kind)&&(J.uvs6=G.getVerticesData(d.c.UV6Kind,V,W)),G.isVerticesDataPresent(d.c.ColorKind)){const R=G.zd||G,k=R.getVertexBuffer(d.c.ColorKind),z=R.getVerticesData(d.c.ColorKind,V,W);if(3===k.getSize()){const G=new Float32Array(4*z.length/3);for(let V=0,W=0;V<z.length;V+=3,W+=4)G[W]=z[V],G[W+1]=z[V+1],G[W+2]=z[V+2],G[W+3]=1;J.eG=G}else{if(4!==k.getSize())throw new Error(`Unexpected number of color components: ${k.getSize()}`);J.eG=z}}return G.isVerticesDataPresent(d.c.MatricesIndicesKind)&&(J.matricesIndices=G.getVerticesData(d.c.MatricesIndicesKind,V,W)),G.isVerticesDataPresent(d.c.MatricesWeightsKind)&&(J.matricesWeights=G.getVerticesData(d.c.MatricesWeightsKind,V,W)),G.isVerticesDataPresent(d.c.MatricesIndicesExtraKind)&&(J.matricesIndicesExtra=G.getVerticesData(d.c.MatricesIndicesExtraKind,V,W)),G.isVerticesDataPresent(d.c.MatricesWeightsExtraKind)&&(J.matricesWeightsExtra=G.getVerticesData(d.c.MatricesWeightsExtraKind,V,W)),J.indices=G.Pd(V,W),J}static CreateRibbon(G){throw(0,k.e)("ribbonBuilder")}static CreateBox(G){throw(0,k.e)("boxBuilder")}static CreateTiledBox(G){throw(0,k.e)("tiledBoxBuilder")}static CreateTiledPlane(G){throw(0,k.e)("tiledPlaneBuilder")}static CreateSphere(G){throw(0,k.e)("sphereBuilder")}static CreateCylinder(G){throw(0,k.e)("cylinderBuilder")}static CreateTorus(G){throw(0,k.e)("torusBuilder")}static CreateLineSystem(G){throw(0,k.e)("linesBuilder")}static CreateDashedLines(G){throw(0,k.e)("linesBuilder")}static CreateGround(G){throw(0,k.e)("groundBuilder")}static CreateTiledGround(G){throw(0,k.e)("groundBuilder")}static CreateGroundFromHeightMap(G){throw(0,k.e)("groundBuilder")}static GP(G){throw(0,k.e)("planeBuilder")}static CreateDisc(G){throw(0,k.e)("discBuilder")}static CreatePolygon(G,V,W,J,R,d,z){throw(0,k.e)("polygonBuilder")}static CreateIcoSphere(G){throw(0,k.e)("icoSphereBuilder")}static CreatePolyhedron(G){throw(0,k.e)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||R.o.Up();throw(0,k.e)("capsuleBuilder")}static CreateTorusKnot(G){throw(0,k.e)("torusKnotBuilder")}static ComputeNormals(G,V,W,J){let d=0,k=0,z=0,X=0,P=0,A=0,x=0,q=0,L=0,t=0,Y=0,g=0,B=0,S=0,p=0,b=0,r=0,y=0,u=0,H=0,n=!1,D=!1,i=!1,e=!1,F=1,f=0,v=null;J&&(n=!!J.facetNormals,D=!!J.facetPositions,i=!!J.facetPartitioning,F=!0===J.useRightHandedSystem?-1:1,f=J.ratio||0,e=!!J.depthSort,v=J.distanceTo,e&&void 0===v&&(v=R.o.Zero()));let C=0,l=0,m=0,w=0;for(i&&J&&J.bbSize&&(C=J.subDiv.X*f/J.bbSize.x,l=J.subDiv.Y*f/J.bbSize.y,m=J.subDiv.Z*f/J.bbSize.z,w=J.subDiv.max*J.subDiv.max,J.facetPartitioning.length=0),d=0;d<G.length;d++)W[d]=0;const N=V.length/3|0;for(d=0;d<N;d++){if(g=3*V[3*d],B=g+1,S=g+2,p=3*V[3*d+1],b=p+1,r=p+2,y=3*V[3*d+2],u=y+1,H=y+2,k=G[g]-G[p],z=G[B]-G[b],X=G[S]-G[r],P=G[y]-G[p],A=G[u]-G[b],x=G[H]-G[r],q=F*(z*x-X*A),L=F*(X*P-k*x),t=F*(k*A-z*P),Y=Math.sqrt(q*q+L*L+t*t),Y=0===Y?1:Y,q/=Y,L/=Y,t/=Y,n&&J&&(J.facetNormals[d].x=q,J.facetNormals[d].y=L,J.facetNormals[d].z=t),D&&J&&(J.facetPositions[d].x=(G[g]+G[p]+G[y])/3,J.facetPositions[d].y=(G[B]+G[b]+G[u])/3,J.facetPositions[d].z=(G[S]+G[r]+G[H])/3),i&&J){const V=Math.floor((J.facetPositions[d].x-J.bInfo.minimum.x*f)*C),W=Math.floor((J.facetPositions[d].y-J.bInfo.minimum.y*f)*l),R=Math.floor((J.facetPositions[d].z-J.bInfo.minimum.z*f)*m),k=Math.floor((G[g]-J.bInfo.minimum.x*f)*C),z=Math.floor((G[B]-J.bInfo.minimum.y*f)*l),X=Math.floor((G[S]-J.bInfo.minimum.z*f)*m),P=Math.floor((G[p]-J.bInfo.minimum.x*f)*C),A=Math.floor((G[b]-J.bInfo.minimum.y*f)*l),x=Math.floor((G[r]-J.bInfo.minimum.z*f)*m),q=Math.floor((G[y]-J.bInfo.minimum.x*f)*C),L=Math.floor((G[u]-J.bInfo.minimum.y*f)*l),t=Math.floor((G[H]-J.bInfo.minimum.z*f)*m),Y=k+J.subDiv.max*z+w*X,n=P+J.subDiv.max*A+w*x,D=q+J.subDiv.max*L+w*t,i=V+J.subDiv.max*W+w*R;J.facetPartitioning[i]=J.facetPartitioning[i]?J.facetPartitioning[i]:[],J.facetPartitioning[Y]=J.facetPartitioning[Y]?J.facetPartitioning[Y]:[],J.facetPartitioning[n]=J.facetPartitioning[n]?J.facetPartitioning[n]:[],J.facetPartitioning[D]=J.facetPartitioning[D]?J.facetPartitioning[D]:[],J.facetPartitioning[Y].push(d),n!=Y&&J.facetPartitioning[n].push(d),D!=n&&D!=Y&&J.facetPartitioning[D].push(d),i!=Y&&i!=n&&i!=D&&J.facetPartitioning[i].push(d)}if(e&&J&&J.facetPositions){const G=J.depthSortedFacets[d];G.ind=3*d,G.sqDistance=R.o.DistanceSquared(J.facetPositions[d],v)}W[g]+=q,W[B]+=L,W[S]+=t,W[p]+=q,W[b]+=L,W[r]+=t,W[y]+=q,W[u]+=L,W[H]+=t}for(d=0;d<W.length/3;d++)q=W[3*d],L=W[3*d+1],t=W[3*d+2],Y=Math.sqrt(q*q+L*L+t*t),Y=0===Y?1:Y,q/=Y,L/=Y,t/=Y,W[3*d]=q,W[3*d+1]=L,W[3*d+2]=t}static _ComputeSides(G,V,W,J,d,k,z){const X=W.length,P=J.length;let A,x;switch(G=G||t.DEFAULTSIDE){case t.FRONTSIDE:break;case t.BACKSIDE:for(A=0;A<X;A+=3){const G=W[A];W[A]=W[A+2],W[A+2]=G}for(x=0;x<P;x++)J[x]=-J[x];break;case t.DOUBLESIDE:{const G=V.length,q=G/3;for(let W=0;W<G;W++)V[G+W]=V[W];for(A=0;A<X;A+=3)W[A+X]=W[A+2]+q,W[A+1+X]=W[A+1]+q,W[A+2+X]=W[A]+q;for(x=0;x<P;x++)J[P+x]=-J[x];const L=d.length;let t=0;for(t=0;t<L;t++)d[t+L]=d[t];for(k=k||new R.q(0,0,1,1),z=z||new R.q(0,0,1,1),t=0,A=0;A<L/2;A++)d[t]=k.x+(k.z-k.x)*d[t],d[t+1]=k.y+(k.w-k.y)*d[t+1],d[t+L]=z.x+(z.z-z.x)*d[t+L],d[t+L+1]=z.y+(z.w-z.y)*d[t+L+1],t+=2;break}}}static Parse(G){const V=new t,W=G.DG;W&&V.set(W,d.c.PositionKind);const J=G.iG;J&&V.set(J,d.c.NormalKind);const R=G.tangents;R&&V.set(R,d.c.TangentKind);const k=G.FG;k&&V.set(k,d.c.UVKind);const X=G.uvs2;X&&V.set(X,d.c.UV2Kind);const P=G.uvs3;P&&V.set(P,d.c.UV3Kind);const A=G.uvs4;A&&V.set(A,d.c.UV4Kind);const x=G.uvs5;x&&V.set(x,d.c.UV5Kind);const q=G.uvs6;q&&V.set(q,d.c.UV6Kind);const Y=G.eG;Y&&(V.set(z.h.CheckColors4(Y,W.length/3),d.c.ColorKind),void 0!==G.hasVertexAlpha&&(V.hasVertexAlpha=G.hasVertexAlpha));const g=G.matricesIndices;g&&V.set(g,d.c.MatricesIndicesKind);const B=G.matricesWeights;B&&V.set(B,d.c.MatricesWeightsKind);const S=G.indices;S&&(V.indices=S);const p=G.materialInfos;if(p){V.materialInfos=[];for(const G of p){const W=new L;W.indexCount=G.indexCount,W.indexStart=G.indexStart,W.verticesCount=G.verticesCount,W.verticesStart=G.verticesStart,W.materialIndex=G.materialIndex,V.materialInfos.push(W)}}return V}static ImportVertexData(G,V){const W=t.Parse(G);V.setAllVerticesData(W,G.updatable)}}t.FRONTSIDE=0,t.BACKSIDE=1,t.DOUBLESIDE=2,t.DEFAULTSIDE=0,t._UniqueIdGenerator=0,(0,J.e)([P.f.filter((function(){for(var G=arguments.length,V=new Array(G),W=0;W<G;W++)V[W]=arguments[W];let[J]=V;return!Array.isArray(J)}))],t,"_TransformVector3Coordinates",null),(0,J.e)([P.f.filter((function(){for(var G=arguments.length,V=new Array(G),W=0;W<G;W++)V[W]=arguments[W];let[J]=V;return!Array.isArray(J)}))],t,"_TransformVector3Normals",null),(0,J.e)([P.f.filter((function(){for(var G=arguments.length,V=new Array(G),W=0;W<G;W++)V[W]=arguments[W];let[J]=V;return!Array.isArray(J)}))],t,"_TransformVector4Normals",null),(0,J.e)([P.f.filter((function(){for(var G=arguments.length,V=new Array(G),W=0;W<G;W++)V[W]=arguments[W];let[J]=V;return!Array.isArray(J)}))],t,"_FlipFaces",null)},11339:(G,V,W)=>{W.d(V,{e:()=>X});var J=W(11345),R=W(11360),d=W(11368),k=W(11390),z=W(11392);class X{get materialDefines(){var G;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(G=this._getDrawWrapper())||void 0===G?void 0:G.defines}set materialDefines(G){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=G}_getDrawWrapper(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];G=G??this._engine.currentRenderPassId;let W=this._drawWrappers[G];return!W&&V&&(this._drawWrappers[G]=W=new z.c(this._mesh.HG().getEngine())),W}_removeDrawWrapper(G){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var W;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(W=this._drawWrappers[G])||void 0===W||W.dispose(V));this._drawWrappers[G]=void 0}get effect(){var G;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(G=this._getDrawWrapper())||void 0===G?void 0:G.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(G){this._mainDrawWrapperOverride=G}setEffect(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0,J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const R=this._drawWrapper;R.setEffect(G,V,J),void 0!==W&&(R.materialContext=W),G||(R.defines=null,R.materialContext=void 0)}resetDrawCache(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==G)return void this._removeDrawWrapper(G,!0,V);for(const G of this._drawWrappers)null===G||void 0===G||G.dispose(V)}this._drawWrappers=[]}static AddToMesh(G,V,W,J,R,d,k){return new X(G,V,W,J,R,d,k,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(G,V,W,J,R,d,k){let z=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],X=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=G,this.verticesStart=V,this.verticesCount=W,this.indexStart=J,this.indexCount=R,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=d,this._renderingMesh=k||d,X&&d.Ed.push(this),this._engine=this._mesh.HG().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=d.Ed.length-1,z&&(this.refreshBoundingInfo(),d.kd(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(G){return this._boundingInfo=G,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const G=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return G||this._renderingMesh}NG(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const V=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!V)return G&&this._mesh.HG()._hasDefaultMaterial?this._mesh.HG().defaultMaterial:null;if(this._isMultiMaterial(V)){const G=V.getSubMaterial(this.materialIndex);return this._currentMaterial!==G&&(this._currentMaterial=G,this.resetDrawCache()),G}return V}_isMultiMaterial(G){return void 0!==G.getSubMaterial}refreshBoundingInfo(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.zd)return this;if(G||(G=this._renderingMesh.getVerticesData(J.c.PositionKind)),!G)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const V=this._renderingMesh.Pd();let W;if(0===this.indexStart&&this.indexCount===V.length){const G=this._renderingMesh.getBoundingInfo();W={minimum:G.minimum.clone(),maximum:G.maximum.clone()}}else W=(0,k.c)(G,V,this.indexStart,this.indexCount,this._renderingMesh.zd.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(W.minimum,W.maximum):this._boundingInfo=new d.d(W.minimum,W.maximum),this}_checkCollision(G){return this.getBoundingInfo()._checkCollision(G)}updateBoundingInfo(G){let V=this.getBoundingInfo();return V||(this.refreshBoundingInfo(),V=this.getBoundingInfo()),V&&V.update(G),this}isInFrustum(G){const V=this.getBoundingInfo();return!!V&&V.isInFrustum(G,this._mesh.sA)}isCompletelyInFrustum(G){const V=this.getBoundingInfo();return!!V&&V.isCompletelyInFrustum(G)}render(G){return this._renderingMesh.render(this,G,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(G,V){if(!this._linesIndexBuffer){const W=6*Math.floor(this.indexCount/3),J=this.verticesStart+this.verticesCount>65535?new Uint32Array(W):new Uint16Array(W);let R=0;if(0===G.length)for(let G=this.indexStart;G<this.indexStart+this.indexCount;G+=3)J[R++]=G,J[R++]=G+1,J[R++]=G+1,J[R++]=G+2,J[R++]=G+2,J[R++]=G;else for(let V=this.indexStart;V<this.indexStart+this.indexCount;V+=3)J[R++]=G[V],J[R++]=G[V+1],J[R++]=G[V+1],J[R++]=G[V+2],J[R++]=G[V+2],J[R++]=G[V];this._linesIndexBuffer=V.createIndexBuffer(J),this._linesIndexCount=J.length}return this._linesIndexBuffer}canIntersects(G){const V=this.getBoundingInfo();return!!V&&G.intersectsBox(V.boundingBox)}intersects(G,V,W,J,R){const d=this.NG();if(!d)return null;let k=3,z=!1;switch(d.fillMode){case 3:case 5:case 6:case 8:return null;case 7:k=1,z=!0}return 4===d.fillMode?W.length?this._intersectLines(G,V,W,this._mesh.intersectionThreshold,J):this._intersectUnIndexedLines(G,V,W,this._mesh.intersectionThreshold,J):!W.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(G,V,W,J,R):this._intersectTriangles(G,V,W,k,z,J,R)}_intersectLines(G,V,W,J,d){let k=null;for(let z=this.indexStart;z<this.indexStart+this.indexCount;z+=2){const X=V[W[z]],P=V[W[z+1]],A=G.intersectionSegment(X,P,J);if(!(A<0)&&((d||!k||A<k.distance)&&(k=new R.e(null,null,A),k.faceId=z/2,d)))break}return k}_intersectUnIndexedLines(G,V,W,J,d){let k=null;for(let z=this.verticesStart;z<this.verticesStart+this.verticesCount;z+=2){const W=V[z],X=V[z+1],P=G.intersectionSegment(W,X,J);if(!(P<0)&&((d||!k||P<k.distance)&&(k=new R.e(null,null,P),k.faceId=z/2,d)))break}return k}_intersectTriangles(G,V,W,J,R,d,k){let z=null,X=-1;for(let P=this.indexStart;P<this.indexStart+this.indexCount-(3-J);P+=J){X++;const J=W[P],A=W[P+1],x=W[P+2];if(R&&4294967295===x){P+=2;continue}const q=V[J],L=V[A],t=V[x];if(!q||!L||!t)continue;if(k&&!k(q,L,t,G,J,A,x))continue;const Y=G.intersectsTriangle(q,L,t);if(Y){if(Y.distance<0)continue;if((d||!z||Y.distance<z.distance)&&(z=Y,z.faceId=X,d))break}}return z}_intersectUnIndexedTriangles(G,V,W,J,R){let d=null;for(let k=this.verticesStart;k<this.verticesStart+this.verticesCount;k+=3){const W=V[k],z=V[k+1],X=V[k+2];if(R&&!R(W,z,X,G,-1,-1,-1))continue;const P=G.intersectsTriangle(W,z,X);if(P){if(P.distance<0)continue;if((J||!d||P.distance<d.distance)&&(d=P,d.faceId=k/3,J))break}}return d}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(G,V){const W=new X(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,G,V,!1);if(!this.IsGlobal){const G=this.getBoundingInfo();if(!G)return W;W._boundingInfo=new d.d(G.minimum,G.maximum)}return W}dispose(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.HG().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const V=this._mesh.Ed.indexOf(this);this._mesh.Ed.splice(V,1),this.resetDrawCache(void 0,G)}getClassName(){return"SubMesh"}static CreateFromIndices(G,V,W,J,R){let d=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],k=Number.MAX_VALUE,z=-Number.MAX_VALUE;const P=(R||J).Pd();for(let X=V;X<V+W;X++){const G=P[X];G<k&&(k=G),G>z&&(z=G)}return new X(G,k,z-k+1,V,W,J,R,d)}}},11901:(G,V,W)=>{var J=W(11510),R=W(11345),d=W(11136),k=W(11201),z=W(11368);J.b.prototype.thinInstanceAdd=function(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.HG().getEngine().getCaps().instancedArrays)return k.c.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(G)?G.length:1);const W=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(G))for(let J=0;J<G.length;++J)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,G[J],J===G.length-1&&V);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,G,V);return W},J.b.prototype.thinInstanceAddSelf=function(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(d.c.IdentityReadOnly,G)},J.b.prototype.thinInstanceRegisterAttribute=function(G,V){G===R.c.ColorKind&&(G=R.c.ColorInstanceKind),this.removeVerticesData(G),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[G]=V,this._userThinInstanceBuffersStorage.sizes[G]=V*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[G]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[G]),this._userThinInstanceBuffersStorage.vertexBuffers[G]=new R.c(this.getEngine(),this._userThinInstanceBuffersStorage.data[G],G,!0,!1,V,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[G])},J.b.prototype.thinInstanceSetMatrixAt=function(G,V){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||G>=this._thinInstanceDataStorage.instancesCount)return!1;const J=this._thinInstanceDataStorage.matrixData;return V.copyToArray(J,16*G),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[G]=V),W&&(this.hA("matrix"),this.CG||this.thinInstanceRefreshBoundingInfo(!1)),!0},J.b.prototype.thinInstanceSetAttributeAt=function(G,V,W){let J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return G===R.c.ColorKind&&(G=R.c.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[G]||V>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(G,0),this._userThinInstanceBuffersStorage.data[G].set(W,V*this._userThinInstanceBuffersStorage.strides[G]),J&&this.hA(G),!0)},Object.defineProperty(J.b.prototype,"jd",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(G){var V;const W=this._thinInstanceDataStorage.matrixData??(null===(V=this.source)||void 0===V?void 0:V._thinInstanceDataStorage.matrixData);G<=(W?W.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=G)},enumerable:!0,configurable:!0}),J.b.prototype._thinInstanceCreateMatrixBuffer=function(G,V){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const J=new R.b(this.getEngine(),V,!W,16,!1,!0);for(let R=0;R<4;R++)this.setVerticesBuffer(J.createVertexBuffer(G+R,4*R,4));return J},J.b.prototype.EA=function(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var d;if(W=W||16,"matrix"===G)null===(d=this._thinInstanceDataStorage.matrixBuffer)||void 0===d||d.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=V?V.length:32*W,this._thinInstanceDataStorage.matrixData=V,this._thinInstanceDataStorage.worldMatrices=null,null!==V?(this._thinInstanceDataStorage.instancesCount=V.length/W,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",V,J),this.CG||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.CG||this.refreshBoundingInfo());else if("previousMatrix"===G){var k;null===(k=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===k||k.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=V,null!==V&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",V,J))}else{var z;if(G===R.c.ColorKind&&(G=R.c.ColorInstanceKind),null===V)null!==(z=this._userThinInstanceBuffersStorage)&&void 0!==z&&z.data[G]&&(this.removeVerticesData(G),delete this._userThinInstanceBuffersStorage.data[G],delete this._userThinInstanceBuffersStorage.strides[G],delete this._userThinInstanceBuffersStorage.sizes[G],delete this._userThinInstanceBuffersStorage.vertexBuffers[G]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[G]=V,this._userThinInstanceBuffersStorage.strides[G]=W,this._userThinInstanceBuffersStorage.sizes[G]=V.length,this._userThinInstanceBuffersStorage.vertexBuffers[G]=new R.c(this.getEngine(),V,G,!J,!1,W,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[G])}},J.b.prototype.hA=function(G){var V;if("matrix"===G)this.Rq&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(G),null===(V=this._thinInstanceDataStorage.matrixBuffer)||void 0===V||V.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===G){var W;this.Rq&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(G),null===(W=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===W||W.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var J;G===R.c.ColorKind&&(G=R.c.ColorInstanceKind),null!==(J=this._userThinInstanceBuffersStorage)&&void 0!==J&&J.vertexBuffers[G]&&(this.Rq&&!this._userThinInstanceBuffersStorage.vertexBuffers[G].isUpdatable()&&this._thinInstanceRecreateBuffer(G),this._userThinInstanceBuffersStorage.vertexBuffers[G].updateDirectly(this._userThinInstanceBuffersStorage.data[G],0))}},J.b.prototype.thinInstancePartialBufferUpdate=function(G,V,W){var J;"matrix"===G?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(V,W):(G===R.c.ColorKind&&(G=R.c.ColorInstanceKind),null!==(J=this._userThinInstanceBuffersStorage)&&void 0!==J&&J.vertexBuffers[G]&&this._userThinInstanceBuffersStorage.vertexBuffers[G].updateDirectly(V,W))},J.b.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const G=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let V=0;V<this._thinInstanceDataStorage.instancesCount;++V)this._thinInstanceDataStorage.worldMatrices[V]=d.c.ld(G,16*V)}return this._thinInstanceDataStorage.worldMatrices},J.b.prototype.thinInstanceRefreshBoundingInfo=function(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const J=this._thinInstanceDataStorage.boundingVectors;if(G||!this.rawBoundingInfo){J.length=0,this.refreshBoundingInfo(V,W);const G=this.getBoundingInfo();this.rawBoundingInfo=new z.d(G.minimum,G.maximum)}const R=this.getBoundingInfo(),k=this._thinInstanceDataStorage.matrixData;if(0===J.length)for(let d=0;d<R.boundingBox.vectors.length;++d)J.push(R.boundingBox.vectors[d].clone());d.h.ed[0].Ud(Number.POSITIVE_INFINITY),d.h.ed[1].Ud(Number.NEGATIVE_INFINITY);for(let z=0;z<this._thinInstanceDataStorage.instancesCount;++z){d.c.FromArrayToRef(k,16*z,d.h.Matrix[0]);for(let G=0;G<J.length;++G)d.o.TransformCoordinatesToRef(J[G],d.h.Matrix[0],d.h.ed[2]),d.h.ed[0].minimizeInPlace(d.h.ed[2]),d.h.ed[1].maximizeInPlace(d.h.ed[2])}R.reConstruct(d.h.ed[0],d.h.ed[1]),this.lG()},J.b.prototype._thinInstanceRecreateBuffer=function(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var W;if("matrix"===G)null===(W=this._thinInstanceDataStorage.matrixBuffer)||void 0===W||W.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,V);else if("previousMatrix"===G){var J;if(this._scene.needsPreviousWorldMatrices)null===(J=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===J||J.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,V)}else{var d;G===R.c.ColorKind&&(G=R.c.ColorInstanceKind),null===(d=this._userThinInstanceBuffersStorage.vertexBuffers[G])||void 0===d||d.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[G]=new R.c(this.getEngine(),this._userThinInstanceBuffersStorage.data[G],G,!V,!1,this._userThinInstanceBuffersStorage.strides[G],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[G])}},J.b.prototype._thinInstanceUpdateBufferSize=function(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;G===R.c.ColorKind&&(G=R.c.ColorInstanceKind);const W="matrix"===G;if(!W&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[G]))return;const J=W?16:this._userThinInstanceBuffersStorage.strides[G],d=W?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[G];let k=W?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[G];const z=(this._thinInstanceDataStorage.instancesCount+V)*J;let X=d;for(;X<z;)X*=2;if(!k||d!=X){if(k){const G=new Float32Array(X);G.set(k,0),k=G}else k=new Float32Array(X);var P,A,x;if(W){if(null===(P=this._thinInstanceDataStorage.matrixBuffer)||void 0===P||P.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",k,!1),this._thinInstanceDataStorage.matrixData=k,this._thinInstanceDataStorage.matrixBufferSize=X,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(A=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===A||A.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",k,!1)}else null===(x=this._userThinInstanceBuffersStorage.vertexBuffers[G])||void 0===x||x.dispose(),this._userThinInstanceBuffersStorage.data[G]=k,this._userThinInstanceBuffersStorage.sizes[G]=X,this._userThinInstanceBuffersStorage.vertexBuffers[G]=new R.c(this.getEngine(),k,G,!0,!1,J,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[G])}},J.b.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},J.b.prototype._disposeThinInstanceSpecificData=function(){var G;null!==(G=this._thinInstanceDataStorage)&&void 0!==G&&G.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},11457:(G,V,W)=>{W.d(V,{b:()=>A});var J=W(11317),R=W(11324),d=W(11411),k=W(11176),z=W(11136),X=W(11465),P=W(11159);class A extends X.d{get billboardMode(){return this._billboardMode}set billboardMode(G){this._billboardMode!==G&&(this._billboardMode=G,this._cache.useBillboardPosition=0!==(this._billboardMode&A.BILLBOARDMODE_USE_POSITION))}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(G){this._infiniteDistance!==G&&(this._infiniteDistance=G)}constructor(G){let V=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(G,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new z.o(0,0,1),this._up=new z.o(0,1,0),this._right=new z.o(1,0,0),this._position=z.o.Zero(),this._rotation=z.o.Zero(),this._rotationQuaternion=null,this._scaling=z.o.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=A.BILLBOARDMODE_NONE,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.zq=z.c.Zero(),this._usePivotMatrix=!1,this._absolutePosition=z.o.Zero(),this._absoluteScaling=z.o.Zero(),this._absoluteRotationQuaternion=z.g.Identity(),this._pivotMatrix=z.c.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new k.b,this._nonUniformScaling=!1,V&&this.HG().addTransformNode(this)}getClassName(){return"dX"}get position(){return this._position}set position(G){this._position=G,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(G){this._rotation=G,this._rotationQuaternion=null,this._markAsDirtyInternal()}get vd(){return this._scaling}set vd(G){this._scaling=G,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(G){this._rotationQuaternion=G,G&&this._rotation.Ud(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return z.o.TransformNormalFromFloatsToRef(0,0,this.HG().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return z.o.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return z.o.TransformNormalFromFloatsToRef(this.HG().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(G){return this._poseMatrix?(this._poseMatrix.J(G),this):(this._poseMatrix=G.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=z.c.Identity()),this._poseMatrix}_isSynchronized(){const G=this._cache;return this._billboardMode===G.billboardMode&&this._billboardMode===A.BILLBOARDMODE_NONE&&(!G.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const G=this._cache;G.localMatrixUpdated=!1,G.billboardMode=-1,G.infiniteDistance=!1,G.useBillboardPosition=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(G){return this.setPivotMatrix(G,!1)}setPivotMatrix(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.J(G),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=V,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=z.c.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,V=arguments.length>1?arguments[1]:void 0,W=arguments.length>2?arguments[2]:void 0;const J=this.clone("Clone of "+(this.name||this.id),G||this.parent,!0);J&&W&&W(this,J);for(const R of this.getChildTransformNodes(!0))R.instantiateHierarchy(J,V,W);return J}Yz(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return G?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.Ud(0),this._rotationQuaternion=this._rotationQuaternion||z.g.Identity(),G.decompose(this._scaling,this._rotationQuaternion,this._position),this.kd(!0)):(this._worldMatrix=G,this._absolutePosition.rd(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.kd(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.kd(!0),this}get lx(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.kd(),this._absolutePosition}setAbsolutePosition(G){if(!G)return this;let V,W,J;if(void 0===G.x){if(arguments.length<3)return this;V=arguments[0],W=arguments[1],J=arguments[2]}else V=G.x,W=G.y,J=G.z;if(this.parent){const G=z.h.Matrix[0];this.parent.getWorldMatrix().invertToRef(G),z.o.TransformCoordinatesFromFloatsToRef(V,W,J,G,this.position)}else this.position.x=V,this.position.y=W,this.position.z=J;return this._absolutePosition.J(G),this}setPositionWithLocalVector(G){return this.kd(),this.position=z.o.TransformNormal(G,this.zq),this}getPositionExpressedInLocalSpace(){this.kd();const G=z.h.Matrix[0];return this.zq.invertToRef(G),z.o.TransformNormal(this.position,G)}locallyTranslate(G){return this.kd(!0),this.position=z.o.TransformCoordinates(G,this.zq),this}lookAt(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const d=A._LookAtVectorCache,k=0===R?this.position:this.getAbsolutePosition();if(G.subtractToRef(k,d),this.setDirection(d,V,W,J),1===R&&this.parent)if(this.rotationQuaternion){const G=z.h.Matrix[0];this.rotationQuaternion.toRotationMatrix(G);const V=z.h.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(V),V.invert(),G.multiplyToRef(V,G),this.rotationQuaternion.fromRotationMatrix(G)}else{const G=z.h.Quaternion[0];z.g.FromEulerVectorToRef(this.rotation,G);const V=z.h.Matrix[0];G.toRotationMatrix(V);const W=z.h.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(W),W.invert(),V.multiplyToRef(W,V),G.fromRotationMatrix(V),G.toEulerAnglesToRef(this.rotation)}return this}xX(G){const V=z.o.Zero();return this.getDirectionToRef(G,V),V}getDirectionToRef(G,V){return z.o.TransformNormalToRef(G,this.getWorldMatrix(),V),this}setDirection(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const R=-Math.atan2(G.z,G.x)+Math.PI/2,d=Math.sqrt(G.x*G.x+G.z*G.z),k=-Math.atan2(G.y,d);return this.rotationQuaternion?z.g.RotationYawPitchRollToRef(R+V,k+W,J,this.rotationQuaternion):(this.rotation.x=k+W,this.rotation.y=R+V,this.rotation.z=J),this}setPivotPoint(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.HG().getRenderId()&&this.kd(!0);const W=this.getWorldMatrix();if(1==V){const V=z.h.Matrix[0];W.invertToRef(V),G=z.o.TransformCoordinates(G,V)}return this.setPivotMatrix(z.c.Translation(-G.x,-G.y,-G.z),!0)}getPivotPoint(){const G=z.o.Zero();return this.getPivotPointToRef(G),G}getPivotPointToRef(G){return G.x=-this._pivotMatrix.m[12],G.y=-this._pivotMatrix.m[13],G.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const G=z.o.Zero();return this.getAbsolutePivotPointToRef(G),G}getAbsolutePivotPointToRef(G){return this.getPivotPointToRef(G),z.o.TransformCoordinatesToRef(G,this.getWorldMatrix(),G),this}pP(G){if(this._isDirty)return this;if(this._children)for(const V of this._children)V.pP(G);return super.pP(G)}setParent(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!G&&!this.parent)return this;const J=z.h.Quaternion[0],R=z.h.ed[0],d=z.h.ed[1],k=z.h.Matrix[1];z.c.IdentityToRef(k);const X=z.h.Matrix[0];this.kd(!0);let P=this.rotationQuaternion;return P||(P=A._TmpRotation,z.g.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,P)),z.c.ComposeToRef(this.vd,P,this.position,X),this.parent&&X.multiplyToRef(this.parent.kd(!0),X),G&&(G.kd(!0).invertToRef(k),X.multiplyToRef(k,X)),X.decompose(d,J,R,V?this:void 0),this.rotationQuaternion?this.rotationQuaternion.J(J):J.toEulerAnglesToRef(this.rotation),this.vd.J(d),this.position.J(R),this.parent=G,W&&this.setPivotMatrix(z.c.Identity()),this}addChild(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return G.setParent(this,V),this}removeChild(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return G.parent!==this||G.setParent(null,V),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(G){return this._nonUniformScaling!==G&&(this._nonUniformScaling=G,!0)}attachToBone(G,V){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=V,this.parent=G,G.getSkeleton().prepare(!0),G.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=G?this._currentParentWhenAttachingToBone:null,this):(G&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(G,V,W){let J;if(G.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.Ud(0)),W&&0!==W){if(this.parent){const W=this.parent.getWorldMatrix(),J=z.h.Matrix[0];W.invertToRef(J),G=z.o.TransformNormal(G,J),W.determinant()<0&&(V*=-1)}J=z.g.RotationAxisToRef(G,V,A._RotationAxisCache),J.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else J=z.g.RotationAxisToRef(G,V,A._RotationAxisCache),this.rotationQuaternion.multiplyToRef(J,this.rotationQuaternion);return this}rotateAround(G,V,W){V.normalize(),this.rotationQuaternion||(this.rotationQuaternion=z.g.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.Ud(0));const J=z.h.ed[0],R=z.h.ed[1],d=z.h.ed[2],k=z.h.Quaternion[0],X=z.h.Matrix[0],P=z.h.Matrix[1],A=z.h.Matrix[2],x=z.h.Matrix[3];return G.subtractToRef(this.position,J),z.c.TranslationToRef(J.x,J.y,J.z,X),z.c.TranslationToRef(-J.x,-J.y,-J.z,P),z.c.RotationAxisToRef(V,W,A),P.multiplyToRef(A,x),x.multiplyToRef(X,x),x.decompose(R,k,d),this.position.addInPlace(d),k.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(G,V,W){const J=G.scale(V);if(W&&0!==W)this.setAbsolutePosition(this.getAbsolutePosition().add(J));else{const G=this.getPositionExpressedInLocalSpace().add(J);this.setPositionWithLocalVector(G)}return this}addRotation(G,V,W){let J;this.rotationQuaternion?J=this.rotationQuaternion:(J=z.h.Quaternion[1],z.g.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,J));const R=z.h.Quaternion[0];return z.g.RotationYawPitchRollToRef(V,G,W,R),J.multiplyInPlace(R),this.rotationQuaternion||J.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==A.BILLBOARDMODE_NONE}kd(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const W=this.HG().getRenderId();if(!this._isDirty&&!G&&(this._currentRenderId===W||this.isSynchronized()))return this._currentRenderId=W,this._worldMatrix;V=V||this.HG().activeCamera,this._updateCache();const J=this._cache;J.pivotMatrixUpdated=!1,J.billboardMode=this.billboardMode,J.infiniteDistance=this.infiniteDistance,J.parent=this._parentNode,this._currentRenderId=W,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const R=this._getEffectiveParent(),d=A._TmpScaling;let k,X=this._position;if(this._infiniteDistance&&!this.parent&&V){const G=V.getWorldMatrix(),W=new z.o(G.m[12],G.m[13],G.m[14]);X=A._TmpTranslation,X.rd(this._position.x+W.x,this._position.y+W.y,this._position.z+W.z)}if(d.rd(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,k=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(z.g.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.rd(0,0,0))}}else k=A._TmpRotation,z.g.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,k);if(this._usePivotMatrix){const G=z.h.Matrix[1];z.c.ScalingToRef(d.x,d.y,d.z,G);const V=z.h.Matrix[0];k.toRotationMatrix(V),this._pivotMatrix.multiplyToRef(G,z.h.Matrix[4]),z.h.Matrix[4].multiplyToRef(V,this.zq),this._postMultiplyPivotMatrix&&this.zq.multiplyToRef(this._pivotMatrixInverse,this.zq),this.zq.addTranslationFromFloats(X.x,X.y,X.z)}else z.c.ComposeToRef(d,k,X,this.zq);if(R&&R.getWorldMatrix){if(G&&R.kd(G),this.billboardMode){if(this._transformToBoneReferal){const G=this.parent;G.getSkeleton().prepare(),G.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),z.h.Matrix[7])}else z.h.Matrix[7].J(R.getWorldMatrix());const G=z.h.ed[5],V=z.h.ed[6],W=z.h.Quaternion[0];z.h.Matrix[7].decompose(V,W,G),z.c.ScalingToRef(V.x,V.y,V.z,z.h.Matrix[7]),z.h.Matrix[7].setTranslation(G),A.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(W,G),this.zq.setTranslation(G)),this.zq.multiplyToRef(z.h.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const G=this.parent;G.getSkeleton().prepare(),this.zq.multiplyToRef(G.getFinalMatrix(),z.h.Matrix[6]),z.h.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.zq.multiplyToRef(R.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.J(this.zq);if(V&&this.billboardMode)if(J.useBillboardPosition){if(J.useBillboardPosition){const G=z.h.ed[0];this._worldMatrix.getTranslationToRef(G);const W=V.globalPosition;this._worldMatrix.invertToRef(z.h.Matrix[1]);const J=z.h.ed[1];z.o.TransformCoordinatesToRef(W,z.h.Matrix[1],J),J.normalize();const R=-Math.atan2(J.z,J.x)+Math.PI/2,d=Math.sqrt(J.x*J.x+J.z*J.z),k=-Math.atan2(J.y,d);if(z.g.RotationYawPitchRollToRef(R,k,0,z.h.Quaternion[0]),(this.billboardMode&A.BILLBOARDMODE_ALL)!==A.BILLBOARDMODE_ALL){const G=z.h.ed[1];z.h.Quaternion[0].toEulerAnglesToRef(G),(this.billboardMode&A.BILLBOARDMODE_X)!==A.BILLBOARDMODE_X&&(G.x=0),(this.billboardMode&A.BILLBOARDMODE_Y)!==A.BILLBOARDMODE_Y&&(G.y=0),(this.billboardMode&A.BILLBOARDMODE_Z)!==A.BILLBOARDMODE_Z&&(G.z=0),z.c.RotationYawPitchRollToRef(G.y,G.x,G.z,z.h.Matrix[0])}else z.c.FromQuaternionToRef(z.h.Quaternion[0],z.h.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(z.h.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(z.h.ed[0])}}else{const G=z.h.ed[0];if(this._worldMatrix.getTranslationToRef(G),z.h.Matrix[1].J(V.getViewMatrix()),z.h.Matrix[1].setTranslationFromFloats(0,0,0),z.h.Matrix[1].invertToRef(z.h.Matrix[0]),(this.billboardMode&A.BILLBOARDMODE_ALL)!==A.BILLBOARDMODE_ALL){z.h.Matrix[0].decompose(void 0,z.h.Quaternion[0],void 0);const G=z.h.ed[1];z.h.Quaternion[0].toEulerAnglesToRef(G),(this.billboardMode&A.BILLBOARDMODE_X)!==A.BILLBOARDMODE_X&&(G.x=0),(this.billboardMode&A.BILLBOARDMODE_Y)!==A.BILLBOARDMODE_Y&&(G.y=0),(this.billboardMode&A.BILLBOARDMODE_Z)!==A.BILLBOARDMODE_Z&&(G.z=0),z.c.RotationYawPitchRollToRef(G.y,G.x,G.z,z.h.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(z.h.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(z.h.ed[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):R&&R._nonUniformScaling?this._updateNonUniformScalingState(R._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.rd(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=z.c.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.kd(),G){const G=this.getChildren();for(let V=0;V<G.length;++V){const W=G[V];if(W){W.kd();const G=z.h.Matrix[0];W.zq.multiplyToRef(this.zq,G);const V=z.h.Quaternion[0];G.decompose(W.vd,V,W.position),W.rotationQuaternion?W.rotationQuaternion.J(V):V.toEulerAnglesToRef(W.rotation)}}}this.vd.rd(1,1,1),this.position.rd(0,0,0),this.rotation.rd(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=z.g.Identity()),this._worldMatrix=z.c.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(G){return this.onAfterWorldMatrixUpdateObservable.add(G),this}unregisterAfterWorldMatrixUpdate(G){return this.onAfterWorldMatrixUpdateObservable.removeCallback(G),this}getPositionInCameraSpace(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return G||(G=this.HG().activeCamera),z.o.TransformCoordinates(this.getAbsolutePosition(),G.getViewMatrix())}getDistanceToCamera(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return G||(G=this.HG().activeCamera),this.getAbsolutePosition().zW(G.globalPosition).length()}clone(G,V,W){const J=d.e.Clone((()=>new A(G,this.HG())),this);if(J.name=G,J.id=G,V&&(J.parent=V),!W){const V=this.getDescendants(!0);for(let W=0;W<V.length;W++){const R=V[W];R.clone&&R.clone(G+"."+R.name,J)}}return J}serialize(G){const V=d.e.Serialize(this,G);return V.type=this.getClassName(),V.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(V),V.localMatrix=this.getPivotMatrix().Bd(),V.isEnabled=this.isEnabled(),d.e.AppendSerializedAnimations(this,V),V.ranges=this.serializeAnimationRanges(),V}static Parse(G,V,W){const J=d.e.Parse((()=>new A(G.name,V)),G,V,W);if(G.localMatrix?J.setPreTransformMatrix(z.c.ld(G.localMatrix)):G.pivotMatrix&&J.setPivotMatrix(z.c.ld(G.pivotMatrix)),J.rz(G.isEnabled),J._waitingParsedUniqueId=G.uniqueId,void 0!==G.parentId&&(J._waitingParentId=G.parentId),void 0!==G.parentInstanceIndex&&(J._waitingParentInstanceIndex=G.parentInstanceIndex),G.animations){for(let V=0;V<G.animations.length;V++){const W=G.animations[V],R=(0,P.c)("BABYLON.Animation");R&&J.animations.push(R.Parse(W))}X.d.ParseAnimationRanges(J,G,V)}return G.autoAnimate&&V.beginAnimation(J,G.autoAnimateFrom,G.autoAnimateTo,G.autoAnimateLoop,G.autoAnimateSpeed||1),J}getChildTransformNodes(G,V){const W=[];return this._getDescendants(W,G,(G=>(!V||V(G))&&G instanceof A)),W}dispose(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.HG().stopAnimation(this),this.HG().removeTransformNode(this),this._parentContainer){const G=this._parentContainer.transformNodes.indexOf(this);G>-1&&this._parentContainer.transformNodes.splice(G,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),G){const G=this.getChildTransformNodes(!0);for(const V of G)V.parent=null,V.kd(!0)}super.dispose(G,V)}normalizeToUnitCube(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2?arguments[2]:void 0,J=null,R=null;V&&(this.rotationQuaternion?(R=this.rotationQuaternion.clone(),this.rotationQuaternion.rd(0,0,0,1)):this.rotation&&(J=this.rotation.clone(),this.rotation.rd(0,0,0)));const d=this.getHierarchyBoundingVectors(G,W),k=d.max.zW(d.min),z=Math.max(k.x,k.y,k.z);if(0===z)return this;const X=1/z;return this.vd.scaleInPlace(X),V&&(this.rotationQuaternion&&R?this.rotationQuaternion.J(R):this.rotation&&J&&this.rotation.J(J)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}A.BILLBOARDMODE_NONE=0,A.BILLBOARDMODE_X=1,A.BILLBOARDMODE_Y=2,A.BILLBOARDMODE_Z=4,A.BILLBOARDMODE_ALL=7,A.BILLBOARDMODE_USE_POSITION=128,A.BillboardUseParentOrientation=!1,A._TmpRotation=z.g.Zero(),A._TmpScaling=z.o.Zero(),A._TmpTranslation=z.o.Zero(),A._LookAtVectorCache=new z.o(0,0,0),A._RotationAxisCache=new z.g,(0,J.e)([(0,R.F)("position")],A.prototype,"_position",void 0),(0,J.e)([(0,R.F)("rotation")],A.prototype,"_rotation",void 0),(0,J.e)([(0,R.w)("rotationQuaternion")],A.prototype,"_rotationQuaternion",void 0),(0,J.e)([(0,R.F)("vd")],A.prototype,"_scaling",void 0),(0,J.e)([(0,R.I)("billboardMode")],A.prototype,"_billboardMode",void 0),(0,J.e)([(0,R.I)()],A.prototype,"scalingDeterminant",void 0),(0,J.e)([(0,R.I)("infiniteDistance")],A.prototype,"_infiniteDistance",void 0),(0,J.e)([(0,R.I)()],A.prototype,"ignoreNonUniformScaling",void 0),(0,J.e)([(0,R.I)()],A.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},11827:(G,V,W)=>{W.d(V,{b:()=>P});var J=W(11136),R=W(11182),d=W(11620),k=W(11145),z=W(11424);class X{constructor(G,V,W,J){this.name=G,this.worldAxisForNormal=V,this.worldAxisForFileX=W,this.worldAxisForFileY=J}}class P{static ConvertCubeMapTextureToSphericalPolynomial(G){var V;if(!G.isCube)return null;null===(V=G.HG())||void 0===V||V.getEngine().flushFramebuffer();const W=G.getSize().width,J=G.readPixels(0,void 0,void 0,!1),R=G.readPixels(1,void 0,void 0,!1);let d,k;G.isRenderTarget?(d=G.readPixels(3,void 0,void 0,!1),k=G.readPixels(2,void 0,void 0,!1)):(d=G.readPixels(2,void 0,void 0,!1),k=G.readPixels(3,void 0,void 0,!1));const z=G.readPixels(4,void 0,void 0,!1),X=G.readPixels(5,void 0,void 0,!1),P=G.gammaSpace;let A=0;return 1!=G.textureType&&2!=G.textureType||(A=1),new Promise((G=>{Promise.all([R,J,d,k,z,X]).then((V=>{let[J,R,d,k,z,X]=V;const x={size:W,right:R,left:J,up:d,down:k,front:z,back:X,format:5,type:A,gammaSpace:P};G(this.ConvertCubeMapToSphericalPolynomial(x))}))}))}static _AreaElement(G,V){return Math.atan2(G*V,Math.sqrt(G*G+V*V+1))}static ConvertCubeMapToSphericalPolynomial(G){const V=new d.e;let W=0;const J=2/G.size,X=J,P=.5*J,A=P-1;for(let d=0;d<6;d++){const x=this._FileFaces[d],q=G[x.name];let L=A;const t=5===G.format?4:3;for(let d=0;d<G.size;d++){let Y=A;for(let X=0;X<G.size;X++){const A=x.worldAxisForFileX.scale(Y).add(x.worldAxisForFileY.scale(L)).add(x.worldAxisForNormal);A.normalize();const g=this._AreaElement(Y-P,L-P)-this._AreaElement(Y-P,L+P)-this._AreaElement(Y+P,L-P)+this._AreaElement(Y+P,L+P);let B=q[d*G.size*t+X*t+0],S=q[d*G.size*t+X*t+1],p=q[d*G.size*t+X*t+2];isNaN(B)&&(B=0),isNaN(S)&&(S=0),isNaN(p)&&(p=0),0===G.type&&(B/=255,S/=255,p/=255),G.gammaSpace&&(B=Math.pow((0,R.Clamp)(B),k.g),S=Math.pow((0,R.Clamp)(S),k.g),p=Math.pow((0,R.Clamp)(p),k.g));const b=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const G=Math.max(B,S,p);if(G>b){const V=b/G;B*=V,S*=V,p*=V}}else B=(0,R.Clamp)(B,0,b),S=(0,R.Clamp)(S,0,b),p=(0,R.Clamp)(p,0,b);const r=new z.d(B,S,p);V.addLight(A,r,g),W+=g,Y+=J}L+=X}}const x=6*(4*Math.PI)/6/W;return V.scaleInPlace(x),V.convertIncidentRadianceToIrradiance(),V.convertIrradianceToLambertianRadiance(),d.g.FromHarmonics(V)}}P._FileFaces=[new X("right",new J.o(1,0,0),new J.o(0,0,-1),new J.o(0,-1,0)),new X("left",new J.o(-1,0,0),new J.o(0,0,1),new J.o(0,-1,0)),new X("up",new J.o(0,1,0),new J.o(1,0,0),new J.o(0,0,1)),new X("down",new J.o(0,-1,0),new J.o(1,0,0),new J.o(0,0,-1)),new X("front",new J.o(0,0,1),new J.o(1,0,0),new J.o(0,-1,0)),new X("back",new J.o(0,0,-1),new J.o(-1,0,0),new J.o(0,-1,0))],P.MAX_HDRI_VALUE=4096,P.PRESERVE_CLAMPED_COLORS=!1},11152:(G,V,W)=>{function J(G,V){const W=[];for(let J=0;J<G;++J)W.push(V());return W}function R(G,V){return J(G,V)}W.d(V,{b:()=>J,e:()=>R,f:()=>k});const d=["push","splice","pop","shift","unshift"];function k(G,V){const W=d.map((W=>function(G,V,W){const J=G[V];if("function"!==typeof J)return null;const R=function(){const J=G.length,d=R.previous.apply(G,arguments);return W(V,J),d};return J.next=R,R.previous=J,G[V]=R,()=>{const W=R.previous;if(!W)return;const J=R.next;J?(W.next=J,J.previous=W):(W.next=void 0,G[V]=W),R.next=void 0,R.previous=void 0}}(G,W,V)));return()=>{for(const G of W)null===G||void 0===G||G()}}},11727:(G,V,W)=>{W.d(V,{b:()=>k});var J=W(11666),R=W(11730);let d=0;const k=G=>{if(!G.environmentBRDFTexture){const V=G.useDelayedTextureLoading;G.useDelayedTextureLoading=!1;const W=G._blockEntityCollection;G._blockEntityCollection=!1;const k=J.d.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+d++,G,!0,!1,J.d.BILINEAR_SAMPLINGMODE);G._blockEntityCollection=W;const z=G.getEngine().getLoadedTexturesCache(),X=z.indexOf(k.getInternalTexture());-1!==X&&z.splice(X,1),k.isRGBD=!0,k.wrapU=J.d.CLAMP_ADDRESSMODE,k.wrapV=J.d.CLAMP_ADDRESSMODE,G.environmentBRDFTexture=k,G.useDelayedTextureLoading=V,R.e.ExpandRGBDTexture(k);const P=G.getEngine().onContextRestoredObservable.add((()=>{k.isRGBD=!0;const V=G.onBeforeRenderObservable.add((()=>{k.isReady()&&(G.onBeforeRenderObservable.remove(V),R.e.ExpandRGBDTexture(k))}))}));G.Md.add((()=>{G.getEngine().onContextRestoredObservable.remove(P)}))}return G.environmentBRDFTexture}},11489:(G,V,W)=>{function J(G,V,W){try{const J=G.next();J.done?V(J):J.value?J.value.then((()=>{J.value=void 0,V(J)}),W):V(J)}catch(J){W(J)}}function R(){let G,V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(W,R,d)=>{const k=performance.now();void 0===G||k-G>V?(G=k,setTimeout((()=>{J(W,R,d)}),0)):J(W,R,d)}}function d(G,V,W,J,R){const d=()=>{let k;const z=G=>{G.done?W(G.value):void 0===k?k=!0:d()};do{k=void 0,R&&R.aborted?J(new Error("Aborted")):V(G,z,J),void 0===k&&(k=!1)}while(k)};d()}function k(G,V){let W;return d(G,J,(G=>W=G),(G=>{throw G}),V),W}async function z(G,V,W){return await new Promise(((J,R)=>{d(G,V,J,R,W)}))}function X(G,V){return function(){return k(G(...arguments),V)}}W.d(V,{c:()=>R,d:()=>X,e:()=>z,f:()=>k})},11333:(G,V,W)=>{W.d(V,{e:()=>d,f:()=>k});const J={},R={};function d(G){const V=G.getClassName();return R[V]||(R[V]={}),R[V]}function k(G){const V=G.getClassName();if(J[V])return J[V];J[V]={};const W=J[V];let d=G,k=V;for(;k;){const G=R[k];for(const R in G)W[R]=G[R];let V,J=!1;do{if(V=Object.getPrototypeOf(d),!V.getClassName){J=!0;break}if(V.getClassName()!==k)break;d=V}while(V);if(J)break;k=V.getClassName(),d=V}return W}},11324:(G,V,W)=>{W.d(V,{B:()=>A,F:()=>x,I:()=>k,b:()=>d,f:()=>S,i:()=>L,m:()=>X,n:()=>t,p:()=>P,q:()=>Y,u:()=>B,v:()=>q,w:()=>g,z:()=>z});var J=W(11333);function R(G,V){return(W,R)=>{const d=(0,J.e)(W);d[R]||(d[R]={type:G,sourceName:V})}}function d(G){return function(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(W,J)=>{const R=V||"_"+J;Object.defineProperty(W,J,{get:function(){return this[R]},set:function(V){var J;"function"===typeof(null===(J=this[R])||void 0===J?void 0:J.equals)&&this[R].equals(V)||this[R]!==V&&(this[R]=V,W[G].apply(this))},enumerable:!0,configurable:!0})}}(G,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)}function k(G){return R(0,G)}function z(G){return R(1,G)}function X(G){return R(2,G)}function P(G){return R(3,G)}function A(G){return R(4,G)}function x(G){return R(5,G)}function q(G){return R(6,G)}function L(G){return R(7,G)}function t(G){return R(8,G)}function Y(G){return R(9,G)}function g(G){return R(10,G)}function B(G){return R(12,G)}function S(G,V,W,J){const R=W.value;W.value=function(){let W=R;if("undefined"!==typeof _native&&_native[V]){const G=_native[V];W=J?function(){return J(...arguments)?G(...arguments):R(...arguments)}:G}return G[V]=W,W(...arguments)}}S.filter=function(G){return(V,W,J)=>S(V,W,J,G)}},11411:(G,V,W)=>{W.d(V,{e:()=>P});var J=W(11218),R=W(11416),d=W(11424),k=W(11136),z=W(11333);const X=function(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const d=G();R.c&&R.c.HasTags(V)&&R.c.AddTagsTo(d,R.c.GetTags(V,!0));const k=(0,z.f)(d),X={};for(const R in k){const G=k[R],z=V[R],A=G.type;if(void 0!==z&&null!==z&&("uniqueId"!==R||P.AllowLoadingUniqueId))switch(A){case 0:case 6:case 9:case 11:d[R]=z;break;case 1:J.cloneTexturesOnlyOnce&&X[z.uniqueId]?d[R]=X[z.uniqueId]:(d[R]=W||z.isRenderTarget?z:z.clone(),X[z.uniqueId]=d[R]);break;case 2:case 3:case 4:case 5:case 7:case 8:case 10:case 12:d[R]=W?z:z.clone()}}return d};class P{static AppendSerializedAnimations(G,V){if(G.animations){V.animations=[];for(let W=0;W<G.animations.length;W++){const J=G.animations[W];V.animations.push(J.serialize())}}}static Serialize(G,V){V||(V={}),R.c&&(V.tags=R.c.GetTags(G));const W=(0,z.f)(G);for(const J in W){const R=W[J],d=R.sourceName||J,k=R.type,z=G[J];if(void 0!==z&&null!==z&&("uniqueId"!==J||P.AllowLoadingUniqueId))switch(k){case 0:V[d]=z;break;case 1:case 3:case 7:case 9:V[d]=z.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:V[d]=z.Bd();break;case 6:case 11:V[d]=z.id}}return V}static ParseProperties(G,V,W,J){J||(J="");const R=(0,z.f)(V);for(const z in R){const X=R[z],A=G[X.sourceName||z],x=X.type;if(void 0!==A&&null!==A&&("uniqueId"!==z||P.AllowLoadingUniqueId)){const G=V;switch(x){case 0:G[z]=A;break;case 1:W&&(G[z]=P._TextureParser(A,W,J));break;case 2:G[z]=d.d.ld(A);break;case 3:G[z]=P._FresnelParametersParser(A);break;case 4:G[z]=k.k.ld(A);break;case 5:G[z]=k.o.ld(A);break;case 6:W&&(G[z]=W.getLastMeshById(A));break;case 7:G[z]=P._ColorCurvesParser(A);break;case 8:G[z]=d.h.ld(A);break;case 9:G[z]=P._ImageProcessingConfigurationParser(A);break;case 10:G[z]=k.g.ld(A);break;case 11:W&&(G[z]=W.getCameraById(A));break;case 12:G[z]=k.c.ld(A)}}}}static Parse(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const d=G();return R.c&&R.c.AddTagsTo(d,V.tags),P.ParseProperties(V,d,W,J),d}static Clone(G,V){return X(G,V,!1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}static Instanciate(G,V){return X(G,V,!0)}}P.AllowLoadingUniqueId=!1,P._ImageProcessingConfigurationParser=G=>{throw(0,J.e)("ImageProcessingConfiguration")},P._FresnelParametersParser=G=>{throw(0,J.e)("FresnelParameters")},P._ColorCurvesParser=G=>{throw(0,J.e)("ColorCurves")},P._TextureParser=(G,V,W)=>{throw(0,J.e)("Texture")}},11204:(G,V,W)=>{W.d(V,{d:()=>d});var J=W(11201);const R=(G,V,W)=>G?G.getClassName&&"Mesh"===G.getClassName()?null:!G.getClassName||"SubMesh"!==G.getClassName()&&"PhysicsBody"!==G.getClassName()?G.clone?G.clone():Array.isArray(G)?G.slice():W&&"object"===typeof G?{...G}:null:G.clone(V):null;class d{static DeepCopy(G,V,W,d){let k=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const z=function(G){const V=[];do{const W=Object.getOwnPropertyNames(G);for(const G of W)-1===V.indexOf(G)&&V.push(G)}while(G=Object.getPrototypeOf(G));return V}(G);for(const P of z){if("_"===P[0]&&(!d||-1===d.indexOf(P)))continue;if(P.endsWith("Observable"))continue;if(W&&-1!==W.indexOf(P))continue;const z=G[P],A=typeof z;if("function"!==A)try{if("object"===A)if(z instanceof Uint8Array)V[P]=Uint8Array.from(z);else if(z instanceof Array){if(V[P]=[],z.length>0)if("object"==typeof z[0])for(let G=0;G<z.length;G++){const W=R(z[G],V,k);-1===V[P].indexOf(W)&&V[P].push(W)}else V[P]=z.slice(0)}else V[P]=R(z,V,k);else V[P]=z}catch(X){J.c.Warn(X.message)}}}}},11935:(G,V,W)=>{function J(){const G=G=>!!G&&"object"===typeof G;for(var V=arguments.length,W=new Array(V),R=0;R<V;R++)W[R]=arguments[R];return W.reduce(((V,W)=>{const R=Object.keys(W);for(const d of R){const R=V[d],k=W[d];Array.isArray(R)&&Array.isArray(k)?V[d]=R.concat(...k):G(R)&&G(k)?V[d]=J(R,k):V[d]=k}return V}),{})}W.d(V,{d:()=>J})},11218:(G,V,W)=>{W.d(V,{e:()=>R});const J={};function R(G){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!J[G])return J[G]=!0,`${G} needs to be imported before as it contains a side-effect required by your code.`}},11196:(G,V,W)=>{function J(){return"undefined"!==typeof window}function R(){return"undefined"!==typeof navigator}function d(){return"undefined"!==typeof document}function k(G){let V="",W=G.firstChild;for(;W;)3===W.nodeType&&(V+=W.textContent),W=W.nextSibling;return V}W.d(V,{b:()=>k,e:()=>d,i:()=>R,m:()=>J})},11710:(G,V,W)=>{W.r(V),W.d(V,{Dispose:()=>q,DumpData:()=>x,DumpDataAsync:()=>A,DumpFramebuffer:()=>P,DumpTools:()=>L});var J=W(11691),R=W(11189),d=W(11182),k=W(11169);let z,X=null;async function P(G,V,W,J){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",d=arguments.length>5?arguments[5]:void 0,k=arguments.length>6?arguments[6]:void 0;const z=await W.readPixels(0,0,G,V);x(G,V,new Uint8Array(z.buffer),J,R,d,!0,void 0,k)}async function A(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",R=arguments.length>4?arguments[4]:void 0,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5],k=arguments.length>6&&void 0!==arguments[6]&&arguments[6],z=arguments.length>7?arguments[7]:void 0;return await new Promise((X=>{x(G,V,W,(G=>X(G)),J,R,d,k,z)}))}function x(G,V,P,A){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",L=arguments.length>5?arguments[5]:void 0,t=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Y=arguments.length>7&&void 0!==arguments[7]&&arguments[7],g=arguments.length>8?arguments[8]:void 0;(async function(){return X||(X=new Promise(((G,V)=>{let R,d=null;const X={TP:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(W.bind(W,11568)).then((P=>{let{ThinEngine:A}=P;const x=k.c.Instances.length;try{R=new OffscreenCanvas(100,100),d=new A(R,!1,X)}catch(Y){var L;x<k.c.Instances.length&&(null===(L=k.c.Instances.pop())||void 0===L||L.dispose()),R=document.createElement("canvas"),d=new A(R,!1,X)}k.c.Instances.pop(),k.c.OnEnginesDisposedObservable.add((G=>{d&&G!==d&&!d.P&&0===k.c.Instances.length&&q()})),d.getCaps().parallelShaderCompile=void 0;const t=new J.b(d);W.e(37).then(W.bind(W,13822)).then((W=>{let{passPixelShader:k}=W;if(!d)return void V("Engine is not defined");const X=new J.d({Ik:d,name:k.name,fragmentShader:k.shader,samplerNames:["textureSampler"]});z={canvas:R,Ik:d,renderer:t,wrapper:X},G(z)}))})).catch(V)}))),await X})().then((W=>{if(W.Ik.setSize(G,V,!0),P instanceof Float32Array){const G=new Uint8Array(P.length);let V=P.length;for(;V--;){const W=P[V];G[V]=Math.round(255*(0,d.Clamp)(W))}P=G}const J=W.Ik.createRawTexture(P,G,V,5,!1,!t,1);W.renderer.setViewport(),W.renderer.applyEffectWrapper(W.wrapper),W.wrapper.effect._bindTexture("textureSampler",J),W.renderer.draw(),Y?R.h.ToBlob(W.canvas,(G=>{const V=new FileReader;V.onload=G=>{const V=G.target.result;A&&A(V)},V.readAsArrayBuffer(G)}),x,g):R.h.EncodeScreenshotCanvasData(W.canvas,A,x,L,g),J.dispose()}))}function q(){var G;z?(z.wrapper.dispose(),z.renderer.dispose(),z.Ik.dispose()):null===(G=X)||void 0===G||G.then((G=>{G.wrapper.dispose(),G.renderer.dispose(),G.Ik.dispose()}));X=null,z=null}const L={DumpData:x,DumpDataAsync:A,DumpFramebuffer:P,Dispose:q};R.h.DumpData=x,R.h.DumpDataAsync=A,R.h.DumpFramebuffer=P},11234:(G,V,W)=>{W.d(V,{c:()=>J,d:()=>R,f:()=>d});class J extends Error{}J._setPrototypeOf=Object.setPrototypeOf||((G,V)=>(G.__proto__=V,G));const R={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};class d extends J{constructor(G,V,W){super(G),this.errorCode=V,this.innerError=W,this.name="RuntimeError",J._setPrototypeOf(this,d.prototype)}}},11227:(G,V,W)=>{W.d(V,{e:()=>f,f:()=>p,g:()=>D,h:()=>e,l:()=>H,j:()=>g,p:()=>y,r:()=>u,t:()=>n,x:()=>b});var J=W(11222),R=W(11196),d=W(11176);class k{}k.FilesToLoad={};var z=W(11234),X=W(11236),P=W(11245),A=W(11169),x=W(11201),q=W(11254),L=W(11250),t=W(11262);const Y=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class g extends z.f{constructor(G,V){super(G,z.d.LoadFileError),this.name="LoadFileError",z.c._setPrototypeOf(this,g.prototype),V instanceof J.b?this.request=V:this.file=V}}class B extends z.f{constructor(G,V){super(G,z.d.RequestFileError),this.request=V,this.name="RequestFileError",z.c._setPrototypeOf(this,B.prototype)}}class S extends z.f{constructor(G,V){super(G,z.d.ReadFileError),this.file=V,this.name="ReadFileError",z.c._setPrototypeOf(this,S.prototype)}}const p={DefaultRetryStrategy:class{static ExponentialBackoff(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return(W,J,R)=>0!==J.status||R>=G||-1!==W.indexOf("file:")?-1:Math.pow(2,R)*V}}.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:G=>G,ScriptBaseUrl:"",ScriptPreprocessUrl:G=>G,CleanUrl:G=>G=G.replace(/#/gm,"%23")},b=(G,V)=>{if((!G||0!==G.indexOf("data:"))&&p.CorsBehavior)if("string"===typeof p.CorsBehavior||p.CorsBehavior instanceof String)V.crossOrigin=p.CorsBehavior;else{const W=p.CorsBehavior(G);W&&(V.crossOrigin=W)}},r={getRequiredSize:null},y=function(G,V,W,R){let d,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",P=arguments.length>5?arguments[5]:void 0,x=arguments.length>6&&void 0!==arguments[6]?arguments[6]:A.c.LastCreatedEngine;if("undefined"===typeof HTMLImageElement&&(null===x||void 0===x||!x._features.forceBitmapOverHTMLImageElement))return W("LoadImage is only supported in web or BabylonNative environments."),null;let q=!1;G instanceof ArrayBuffer||ArrayBuffer.isView(G)?"undefined"!==typeof Blob&&"undefined"!==typeof URL?(d=URL.createObjectURL(new Blob([G],{type:z})),q=!0):d=`data:${z};base64,`+(0,X.k)(G):G instanceof Blob?(d=URL.createObjectURL(G),q=!0):(d=p.CleanUrl(G),d=p.PreprocessUrl(d));const L=V=>{if(W){const J=d||G.toString();W(`Error while trying to load image: ${0===J.indexOf("http")||J.length<=128?J:J.slice(0,128)+"..."}`,V)}};if(null!==x&&void 0!==x&&x._features.forceBitmapOverHTMLImageElement)return H(d,(J=>{x.createImageBitmap(new Blob([J],{type:z}),{premultiplyAlpha:"none",...P}).then((G=>{V(G),q&&URL.revokeObjectURL(d)})).catch((V=>{W&&W("Error while trying to load image: "+G,V)}))}),void 0,R||void 0,!0,((G,V)=>{L(V)})),null;const t=new Image;if(r.getRequiredSize){const V=r.getRequiredSize(G);V.width&&(t.width=V.width),V.height&&(t.height=V.height)}b(d,t);const Y=[],g=()=>{for(const G of Y)G.target.removeEventListener(G.name,G.handler);Y.length=0};Y.push({target:t,name:"load",handler:()=>{g(),V(t),q&&t.src&&URL.revokeObjectURL(t.src)}}),Y.push({target:t,name:"error",handler:G=>{g(),L(G),q&&t.src&&URL.revokeObjectURL(t.src)}}),Y.push({target:document,name:"securitypolicyviolation",handler:G=>{if(G.blockedURI!==t.src||"Ft"===G.disposition)return;g();const V=new Error(`CSP violation of policy ${G.effectiveDirective} ${G.blockedURI}. Current policy is ${G.originalPolicy}`);A.c.UseFallbackTexture=!1,L(V),q&&t.src&&URL.revokeObjectURL(t.src),t.src=""}}),(()=>{for(const G of Y)G.target.addEventListener(G.name,G.handler)})();const B="blob:"===d.substring(0,5),S="data:"===d.substring(0,5),y=()=>{B||S||!J.b.IsCustomRequestAvailable?t.src=d:H(d,((G,V,W)=>{const J=new Blob([G],{type:!z&&W?W:z}),R=URL.createObjectURL(J);q=!0,t.src=R}),void 0,R||void 0,!0,((G,V)=>{L(V)}))},u=()=>{R&&R.loadImage(d,t)};if(!B&&!S&&R&&R.enableTexturesOffline)R.open(u,y);else{if(-1!==d.indexOf("file:")){const G=decodeURIComponent(d.substring(5).toLowerCase());if(k.FilesToLoad[G]&&"undefined"!==typeof URL){try{let V;try{V=URL.createObjectURL(k.FilesToLoad[G])}catch(n){V=URL.createObjectURL(k.FilesToLoad[G])}t.src=V,q=!0}catch(D){t.src=""}return t}}y()}return t},u=(G,V,W,J,R)=>{const k=new FileReader,z={onCompleteObservable:new d.b,abort:()=>k.abort()};return k.onloadend=()=>z.onCompleteObservable.notifyObservers(z),R&&(k.onerror=()=>{R(new S(`Unable to read ${G.name}`,G))}),k.onload=G=>{V(G.target.result)},W&&(k.onprogress=W),J?k.readAsArrayBuffer(G):k.readAsText(G),z},H=(G,V,W,J,R,X,P)=>{if(G.name)return u(G,V,W,R,X?G=>{X(void 0,G)}:void 0);const A=G;if(-1!==A.indexOf("file:")){let G=decodeURIComponent(A.substring(5).toLowerCase());0===G.indexOf("./")&&(G=G.substring(2));const J=k.FilesToLoad[G];if(J)return u(J,V,W,R,X?G=>X(void 0,new g(G.message,G.file)):void 0)}const{match:L,type:t}=F(A);if(L){const G={onCompleteObservable:new d.b,abort:()=>()=>{}};try{const G=R?f(A):v(A);V(G,void 0,t)}catch(z){X?X(void 0,z):x.c.Error(z.message||"Failed to parse the Data URL")}return q.c.SetImmediate((()=>{G.onCompleteObservable.notifyObservers(G)})),G}return n(A,((G,W)=>{V(G,null===W||void 0===W?void 0:W.responseURL,null===W||void 0===W?void 0:W.getResponseHeader("content-type"))}),W,J,R,X?G=>{X(G.request,new g(G.message,G.request))}:void 0,P)},n=(G,V,W,k,z,X,P)=>{G=p.CleanUrl(G),G=p.PreprocessUrl(G);const A=p.BaseUrl+G;let q=!1;const L={onCompleteObservable:new d.b,abort:()=>q=!0},t=()=>{let G,d=new J.b,k=null;const t=()=>{d&&(W&&d.removeEventListener("progress",W),G&&d.removeEventListener("readystatechange",G),d.removeEventListener("loadend",Y))};let Y=()=>{t(),L.onCompleteObservable.notifyObservers(L),L.onCompleteObservable.clear(),W=void 0,G=null,Y=null,X=void 0,P=void 0,V=void 0};L.abort=()=>{q=!0,Y&&Y(),d&&d.readyState!==(XMLHttpRequest.DONE||4)&&d.abort(),null!==k&&(clearTimeout(k),k=null),d=null};const g=G=>{const V=G.message||"Unknown error";X&&d?X(new B(V,d)):x.c.Error(V)},S=x=>{if(d){if(d.open("GET",A),P)try{P(d)}catch(L){return void g(L)}z&&(d.responseType="arraybuffer"),W&&d.addEventListener("progress",W),Y&&d.addEventListener("loadend",Y),G=()=>{if(!q&&d&&d.readyState===(XMLHttpRequest.DONE||4)){if(G&&d.removeEventListener("readystatechange",G),d.status>=200&&d.status<300||0===d.status&&(!(0,R.m)()||i())){const G=z?d.response:d.responseText;if(null!==G){try{V&&V(G,d)}catch(L){g(L)}return}}const W=p.DefaultRetryStrategy;if(W){const G=W(A,d,x);if(-1!==G)return t(),d=new J.b,void(k=setTimeout((()=>S(x+1)),G))}const P=new B("Error status: "+d.status+" "+d.statusText+" - Unable to load "+A,d);X&&X(P)}},d.addEventListener("readystatechange",G),d.send()}};S(0)};if(k&&k.enableSceneOffline){const J=G=>{G&&G.status>400?X&&X(G):t()},R=()=>{k&&k.loadFile(p.BaseUrl+G,(G=>{!q&&V&&V(G),L.onCompleteObservable.notifyObservers(L)}),W?G=>{!q&&W&&W(G)}:void 0,J,z)};k.open(R,J)}else t();return L},D=G=>{const{match:V,type:W}=F(G);if(V)return W||void 0;const J=G.lastIndexOf(".");switch(G.substring(J+1).toLowerCase()){case"glb":return"model/gltf-binary";case"bin":return"application/octet-stream";case"sd":return"model/gltf+json";case"jpg":case"jpeg":return"image/jpeg";case"png":return"image/png";case"webp":return"image/webp";default:return}},i=()=>"undefined"!==typeof location&&"file:"===location.protocol,e=G=>Y.test(G),F=G=>{const V=Y.exec(G);if(null===V||0===V.length)return{match:!1,type:""};return{match:!0,type:V[0].replace("data:","").replace("base64,","")}};function f(G){return(0,X.d)(G.split(",")[1])}const v=G=>(0,X.g)(G.split(",")[1]);let C;t.b._FileToolsLoadImage=y,L.c.loadFile=H,P.q.loadFile=H;((G,V,W,J,R,d,k,z,X,P)=>{C={DecodeBase64UrlToBinary:G,DecodeBase64UrlToString:V,DefaultRetryStrategy:W.DefaultRetryStrategy,BaseUrl:W.BaseUrl,CorsBehavior:W.CorsBehavior,PreprocessUrl:W.PreprocessUrl,IsBase64DataUrl:J,IsFileURL:R,LoadFile:d,LoadImage:k,ReadFile:z,RequestFile:X,SetCorsBehavior:P},Object.defineProperty(C,"DefaultRetryStrategy",{get:function(){return W.DefaultRetryStrategy},set:function(G){W.DefaultRetryStrategy=G}}),Object.defineProperty(C,"BaseUrl",{get:function(){return W.BaseUrl},set:function(G){W.BaseUrl=G}}),Object.defineProperty(C,"PreprocessUrl",{get:function(){return W.PreprocessUrl},set:function(G){W.PreprocessUrl=G}}),Object.defineProperty(C,"CorsBehavior",{get:function(){return W.CorsBehavior},set:function(G){W.CorsBehavior=G}})})(f,v,p,e,i,H,y,u,n,b)},11304:(G,V,W)=>{function J(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(G=>{const V=16*Math.random()|0;return("x"===G?V:3&V|8).toString(16)}))}W.d(V,{b:()=>J})},11301:(G,V,W)=>{W.d(V,{b:()=>d});var J=W(11201),R=W(11159);class d{static Instantiate(G){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[G])return this.RegisteredExternalClasses[G];const V=(0,R.c)(G);if(V)return V;J.c.Warn(G+" not found, you may have missed an import.");const W=G.split(".");let d=window||this;for(let J=0,R=W.length;J<R;J++)d=d[W[J]];return"function"!==typeof d?null:d}}d.RegisteredExternalClasses={}},11201:(G,V,W)=>{W.d(V,{c:()=>J});class J{static _CheckLimit(G,V){let W=J._LogLimitOutputs[G];return W?W.current++:(W={limit:V,current:1},J._LogLimitOutputs[G]=W),W.current<=W.limit}static _GenerateLimitMessage(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const W=J._LogLimitOutputs[G];if(!W||!J.MessageLimitReached)return;const R=this._Levels[V];W.current===W.limit&&J[R.name](J.MessageLimitReached.replace(/%LIMIT%/g,""+W.limit).replace(/%TYPE%/g,R.name??""))}static _AddLogEntry(G){J._LogCache=G+J._LogCache,J.OnNewCacheEntry&&J.OnNewCacheEntry(G)}static _FormatMessage(G){const V=G=>G<10?"0"+G:""+G,W=new Date;return"["+V(W.getHours())+":"+V(W.getMinutes())+":"+V(W.getSeconds())+"]: "+G}static _LogDisabled(G,V){}static _LogEnabled(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,V=arguments.length>1?arguments[1]:void 0,W=arguments.length>2?arguments[2]:void 0;const R=Array.isArray(V)?V[0]:V;if(void 0!==W&&!J._CheckLimit(R,W))return;const d=J._FormatMessage(R),k=this._Levels[G],z=Array.isArray(V)?V.slice(1):[];k.logFunc&&k.logFunc("BJS - "+d,...z);const X=`<div style='color:${k.color}'>${d}</div><br>`;J._AddLogEntry(X),J._GenerateLimitMessage(R,G)}static get LogCache(){return J._LogCache}static ClearLogCache(){J._LogCache="",J._LogLimitOutputs={},J.errorsCount=0}static set LogLevels(G){J.Log=J._LogDisabled,J.Warn=J._LogDisabled,J.Error=J._LogDisabled;const V=[J.MessageLogLevel,J.WarningLogLevel,J.ErrorLogLevel];for(const W of V)if((G&W)===W){const G=this._Levels[W];J[G.name]=J._LogEnabled.bind(J,W)}}}J.NoneLogLevel=0,J.MessageLogLevel=1,J.WarningLogLevel=2,J.ErrorLogLevel=4,J.AllLogLevel=7,J.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",J._LogCache="",J._LogLimitOutputs={},J._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],J.errorsCount=0,J.Log=J._LogEnabled.bind(J,J.MessageLogLevel),J.Warn=J._LogEnabled.bind(J,J.WarningLogLevel),J.Error=J._LogEnabled.bind(J,J.ErrorLogLevel)},11176:(G,V,W)=>{W.d(V,{b:()=>k});const J="undefined"!==typeof WeakRef;class R{constructor(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2?arguments[2]:void 0,J=arguments.length>3?arguments[3]:void 0;this.initialize(G,V,W,J)}initialize(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2?arguments[2]:void 0,J=arguments.length>3?arguments[3]:void 0;return this.mask=G,this.skipNextObservers=V,this.target=W,this.currentTarget=J,this}}class d{constructor(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=G,this.mask=V,this.scope=W,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(G)}}class k{static FromPromise(G,V){const W=new k;return G.then((G=>{W.notifyObservers(G)})).catch((G=>{if(!V)throw G;V.notifyObservers(G)})),W}get observers(){return this._observers}constructor(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=V,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new R(0),G&&(this._onObserverAdded=G)}add(G){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2],W=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!G)return null;const R=new d(G,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);R.unregisterOnNextCall=W,V?this._observers.unshift(R):this._observers.push(R),this._onObserverAdded&&this._onObserverAdded(R),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(R,this._lastNotifiedValue);const k=J?new WeakRef(this):{deref:()=>this};return R._remove=function(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const V=k.deref();V&&(G?V.remove(R):V._remove(R))},R}addOnce(G){return this.add(G,void 0,void 0,void 0,!0)}remove(G){if(!G)return!1;G._remove=null;return-1!==this._observers.indexOf(G)&&(this._deferUnregister(G),!0)}removeCallback(G,V){for(let W=0;W<this._observers.length;W++){const J=this._observers[W];if(!J._willBeUnregistered&&(J.callback===G&&(!V||V===J.scope)))return this._deferUnregister(J),!0}return!1}_deferUnregister(G){G._willBeUnregistered||(this._numObserversMarkedAsDeleted++,G.unregisterOnNextCall=!1,G._willBeUnregistered=!0,setTimeout((()=>{this._remove(G)}),0))}_remove(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!G)return!1;const W=this._observers.indexOf(G);return-1!==W&&(V&&this._numObserversMarkedAsDeleted--,this._observers.splice(W,1),!0)}makeObserverTopPriority(G){this._remove(G,!1),this._observers.unshift(G)}makeObserverBottomPriority(G){this._remove(G,!1),this._observers.push(G)}notifyObservers(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,W=arguments.length>2?arguments[2]:void 0,J=arguments.length>3?arguments[3]:void 0,R=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=G),!this._observers.length)return!0;const d=this._eventState;d.mask=V,d.target=W,d.currentTarget=J,d.skipNextObservers=!1,d.lastReturnValue=G,d.userInfo=R;for(const k of this._observers)if(!k._willBeUnregistered&&(k.mask&V&&(k.unregisterOnNextCall&&this._deferUnregister(k),k.scope?d.lastReturnValue=k.callback.apply(k.scope,[G,d]):d.lastReturnValue=k.callback(G,d)),d.skipNextObservers))return!1;return!0}notifyObserver(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=V),G._willBeUnregistered)return;const J=this._eventState;J.mask=W,J.skipNextObservers=!1,G.unregisterOnNextCall&&this._deferUnregister(G),G.callback(V,J)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const G=this._observers.pop();G&&(G._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const G=new k;return G._observers=this._observers.slice(0),G}hasSpecificMask(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const V of this._observers)if(V.mask&G||V.mask===G)return!0;return!1}}},11654:(G,V,W)=>{W.d(V,{c:()=>R});var J=W(11211);class R{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(G,V){R.Enabled&&(this._current+=G,V&&this._fetchResult())}beginMonitoring(){R.Enabled&&(this._startMonitoringTime=J.e.Now)}endMonitoring(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!R.Enabled)return;G&&this.fetchNewFrame();const V=J.e.Now;this._current=V-this._startMonitoringTime,G&&this._fetchResult()}yx(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const G=J.e.Now;G-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=G,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}R.Enabled=!0},11211:(G,V,W)=>{W.d(V,{e:()=>R});var J=W(11196);class R{static get Now(){return(0,J.m)()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}},11730:(G,V,W)=>{W.d(V,{e:()=>d});var J=W(11686),R=W(11663);class d{static ExpandRGBDTexture(G){const V=G._texture;if(!V||!G.isRGBD)return;const R=V.getEngine(),d=R.getCaps(),k=V.isReady;let z=!1;d.textureHalfFloatRender&&d.textureHalfFloatLinearFiltering?(z=!0,V.type=2):d.textureFloatRender&&d.textureFloatLinearFiltering&&(z=!0,V.type=1),z&&(V.isReady=!1,V._isRGBD=!1,V.invertY=!1);const X=async()=>{const d=R.isWebGPU,k=d?1:0;V.isReady=!1,d?await W.e(21).then(W.bind(W,13878)):await W.e(14).then(W.bind(W,13882));const z=new J.c("rgbdDecode","rgbdDecode",null,null,1,null,3,R,!1,void 0,V.type,void 0,null,!1,void 0,k);z.externalTextureSamplerBinding=!0;const X=R.createRenderTargetTexture(V.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:V.samplingMode,type:V.type,format:5});z.onEffectCreatedObservable.addOnce((W=>{W.executeWhenCompiled((()=>{z.onApply=G=>{G._bindTexture("textureSampler",V),G.setFloat2("scale",1,1)},G.HG().postProcessManager.directRender([z],X,!0),R.restoreDefaultFramebuffer(),R._releaseTexture(V),z&&z.dispose(),X._swapAndDie(V),V.isReady=!0}))}))};z&&(k?X():G.onLoadObservable.addOnce(X))}static async EncodeTextureToRGBD(G,V){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return V.getEngine().isWebGPU?await W.e(22).then(W.bind(W,13894)):await W.e(15).then(W.bind(W,13889)),await(0,R.d)("rgbdEncode",G,V,J,1,5)}}},11525:(G,V,W)=>{W.d(V,{c:()=>R,f:()=>J});class J{constructor(G){this.length=0,this.data=new Array(G),this._id=J._GlobalId++}push(G){this.data[this.length++]=G,this.length>this.data.length&&(this.data.length*=2)}forEach(G){for(let V=0;V<this.length;V++)G(this.data[V])}sort(G){this.data.sort(G)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(G){if(0!==G.length){this.length+G.length>this.data.length&&(this.data.length=2*(this.length+G.length));for(let V=0;V<G.length;V++)this.data[this.length++]=(G.data||G)[V]}}indexOf(G){const V=this.data.indexOf(G);return V>=this.length?-1:V}contains(G){return-1!==this.indexOf(G)}}J._GlobalId=0;class R extends J{constructor(){super(...arguments),this._duplicateId=0}push(G){super.push(G),G.__smartArrayFlags||(G.__smartArrayFlags={}),G.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(G){return(!G.__smartArrayFlags||G.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(G),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(G){if(0!==G.length){this.length+G.length>this.data.length&&(this.data.length=2*(this.length+G.length));for(let V=0;V<G.length;V++){const W=(G.data||G)[V];this.pushNoDuplicate(W)}}}}},11236:(G,V,W)=>{W.d(V,{d:()=>k,g:()=>d,j:()=>J,k:()=>R});const J=G=>{if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(G);let V="";for(let W=0;W<G.byteLength;W++)V+=String.fromCharCode(G[W]);return V},R=G=>{const V="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let W,J,R,d,k,z,X,P="",A=0;const x=ArrayBuffer.isView(G)?new Uint8Array(G.buffer,G.byteOffset,G.byteLength):new Uint8Array(G);for(;A<x.length;)W=x[A++],J=A<x.length?x[A++]:Number.NaN,R=A<x.length?x[A++]:Number.NaN,d=W>>2,k=(3&W)<<4|J>>4,z=(15&J)<<2|R>>6,X=63&R,isNaN(J)?z=X=64:isNaN(R)&&(X=64),P+=V.charAt(d)+V.charAt(k)+V.charAt(z)+V.charAt(X);return P},d=G=>atob(G),k=G=>{const V=d(G),W=V.length,J=new Uint8Array(new ArrayBuffer(W));for(let R=0;R<W;R++)J[R]=V.charCodeAt(R);return J.buffer}},11416:(G,V,W)=>{W.d(V,{c:()=>R});class J{static Eval(G,V){return"true"===(G=G.match(/\([^()]*\)/g)?G.replace(/\([^()]*\)/g,(G=>(G=G.slice(1,G.length-1),J._HandleParenthesisContent(G,V)))):J._HandleParenthesisContent(G,V))||"false"!==G&&J.Eval(G,V)}static _HandleParenthesisContent(G,V){let W;V=V||(G=>"true"===G);const R=G.split("||");for(const d in R)if(Object.prototype.hasOwnProperty.call(R,d)){let G=J._SimplifyNegation(R[d].trim());const k=G.split("&&");if(k.length>1)for(let R=0;R<k.length;++R){const d=J._SimplifyNegation(k[R].trim());if(W="true"!==d&&"false"!==d?"!"===d[0]?!V(d.substring(1)):V(d):"true"===d,!W){G="false";break}}if(W||"true"===G){W=!0;break}W="true"!==G&&"false"!==G?"!"===G[0]?!V(G.substring(1)):V(G):"true"===G}return W?"true":"false"}static _SimplifyNegation(G){return"!true"===(G=(G=G.replace(/^[\s!]+/,(G=>(G=G.replace(/[\s]/g,(()=>""))).length%2?"!":""))).trim())?G="false":"!false"===G&&(G="true"),G}}class R{static EnableFor(G){G._tags=G._tags||{},G.hasTags=()=>R.HasTags(G),G.addTags=V=>R.AddTagsTo(G,V),G.removeTags=V=>R.RemoveTagsFrom(G,V),G.matchesTagsQuery=V=>R.MatchesQuery(G,V)}static DisableFor(G){delete G._tags,delete G.hasTags,delete G.addTags,delete G.removeTags,delete G.matchesTagsQuery}static HasTags(G){if(!G._tags)return!1;const V=G._tags;for(const W in V)if(Object.prototype.hasOwnProperty.call(V,W))return!0;return!1}static GetTags(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!G._tags)return null;if(V){const V=[];for(const W in G._tags)Object.prototype.hasOwnProperty.call(G._tags,W)&&!0===G._tags[W]&&V.push(W);return V.join(" ")}return G._tags}static AddTagsTo(G,V){if(!V)return;if("string"!==typeof V)return;const W=V.split(" ");for(const J of W)R._AddTagTo(G,J)}static _AddTagTo(G,V){""!==(V=V.trim())&&"true"!==V&&"false"!==V&&(V.match(/[\s]/)||V.match(/^([!]|([|]|[&]){2})/)||(R.EnableFor(G),G._tags[V]=!0))}static RemoveTagsFrom(G,V){if(!R.HasTags(G))return;const W=V.split(" ");for(const J in W)R._RemoveTagFrom(G,W[J])}static _RemoveTagFrom(G,V){delete G._tags[V]}static MatchesQuery(G,V){return void 0===V||(""===V?R.HasTags(G):J.Eval(V,(V=>R.HasTags(G)&&G._tags[V])))}}},11663:(G,V,W)=>{W.d(V,{d:()=>B,h:()=>r,l:()=>u,n:()=>H,o:()=>b});var J=W(11666),R=W(11670),d=W(11317),k=W(11686),z=W(11262),X=W(11159),P=W(11411),A=W(11691),x=W(11564);class q extends A.d{_gatherImports(G,V){G?(this._webGPUReady=!0,V.push(Promise.all([W.e(36).then(W.bind(W,13819))]))):V.push(Promise.all([W.e(37).then(W.bind(W,13822))])),super._gatherImports(G,V)}constructor(G){super({...arguments.length>2?arguments[2]:void 0,name:G,Ik:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||x.c.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:q.FragmentUrl})}}q.FragmentUrl="pass";class L extends A.d{_gatherImports(G,V){G?(this._webGPUReady=!0,V.push(Promise.all([W.e(43).then(W.bind(W,13863))]))):V.push(Promise.all([W.e(44).then(W.bind(W,13870))])),super._gatherImports(G,V)}constructor(G){super({...arguments.length>2?arguments[2]:void 0,name:G,Ik:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||x.c.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:L.FragmentUrl,defines:"#define POSITIVEX"}),this._face=0}get face(){return this._face}set face(G){if(!(G<0||G>5))switch(this._face=G,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ")}}}L.FragmentUrl="passCube";var t=W(11324);class Y extends k.c{getClassName(){return"PassPostProcess"}constructor(G,V){let W=arguments.length>4?arguments[4]:void 0;const J={size:"number"===typeof V?V:void 0,camera:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,samplingMode:arguments.length>3?arguments[3]:void 0,Ik:W,reusable:arguments.length>5?arguments[5]:void 0,textureType:arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,blockCompilation:arguments.length>7&&void 0!==arguments[7]&&arguments[7],...V};super(G,q.FragmentUrl,{effectWrapper:"number"!==typeof V&&V.effectWrapper?void 0:new q(G,W,J),...J})}static _Parse(G,V,W,J){return P.e.Parse((()=>new Y(G.name,G.options,V,G.renderTargetSamplingMode,G._engine,G.reusable)),G,W,J)}}(0,X.d)("BABYLON.PassPostProcess",Y);class g extends k.c{get face(){return this._effectWrapper.face}set face(G){this._effectWrapper.face=G}getClassName(){return"PassCubePostProcess"}constructor(G,V){let W=arguments.length>4?arguments[4]:void 0;const J={size:"number"===typeof V?V:void 0,camera:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,samplingMode:arguments.length>3?arguments[3]:void 0,Ik:W,reusable:arguments.length>5?arguments[5]:void 0,textureType:arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,blockCompilation:arguments.length>7&&void 0!==arguments[7]&&arguments[7],...V};super(G,q.FragmentUrl,{effectWrapper:"number"!==typeof V&&V.effectWrapper?void 0:new L(G,W,J),...J})}static _Parse(G,V,W,J){return P.e.Parse((()=>new g(G.name,G.options,V,G.renderTargetSamplingMode,G._engine,G.reusable)),G,W,J)}}function B(G,V,W,J,R,d,z,X){const P=V.getEngine();return V.isReady=!1,R=R??V.samplingMode,J=J??V.type,d=d??V.format,z=z??V.width,X=X??V.height,-1===J&&(J=0),new Promise((A=>{const x=new k.c("postprocess",G,null,null,1,null,R,P,!1,void 0,J,void 0,null,!1,d);x.externalTextureSamplerBinding=!0;const q=P.createRenderTargetTexture({width:z,height:X},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:R,type:J,format:d});x.onEffectCreatedObservable.addOnce((G=>{G.executeWhenCompiled((()=>{x.onApply=G=>{G._bindTexture("textureSampler",V),G.setFloat2("scale",1,1)},W.postProcessManager.directRender([x],q,!0),P.restoreDefaultFramebuffer(),P._releaseTexture(V),x&&x.dispose(),q._swapAndDie(V),V.type=J,V.format=5,V.isReady=!0,A(V)}))}))}))}let S,p;function b(G){S||(S=new Float32Array(1),p=new Int32Array(S.buffer)),S[0]=G;const V=p[0];let W=V>>16&32768,J=V>>12&2047;const R=V>>23&255;return R<103?W:R>142?(W|=31744,W|=(255==R?0:1)&&8388607&V,W):R<113?(J|=2048,W|=(J>>114-R)+(J>>113-R&1),W):(W|=R-112<<10|J>>1,W+=1&J,W)}function r(G){const V=(32768&G)>>15,W=(31744&G)>>10,J=1023&G;return 0===W?(V?-1:1)*Math.pow(2,-14)*(J/Math.pow(2,10)):31==W?J?NaN:1/0*(V?-1:1):(V?-1:1)*Math.pow(2,W-15)*(1+J/Math.pow(2,10))}(0,d.e)([(0,t.I)()],g.prototype,"face",null),z.b._RescalePostProcessFactory=G=>new Y("rescale",1,null,2,G,!1,0);const y=async(G,V,d,z,X)=>{const P=G.HG(),A=P.getEngine();let x;if(A.isWebGPU?G.isCube?await W.e(40).then(W.bind(W,13843)):await W.e(41).then(W.bind(W,13852)):G.isCube?await W.e(38).then(W.bind(W,13831)):await W.e(39).then(W.bind(W,13834)),G.isCube){const G=["#define POSITIVEX","#define NEGATIVEX","#define POSITIVEY","#define NEGATIVEY","#define POSITIVEZ","#define NEGATIVEZ"];x=new k.c("lodCube","lodCube",{uniforms:["lod","gamma"],samplingMode:J.d.NEAREST_NEAREST_MIPNEAREST,Ik:A,defines:G[z],shaderLanguage:A.isWebGPU?1:0})}else x=new k.c("lod","lod",{uniforms:["lod","gamma"],samplingMode:J.d.NEAREST_NEAREST_MIPNEAREST,Ik:A,shaderLanguage:A.isWebGPU?1:0});await new Promise((G=>{x.onEffectCreatedObservable.addOnce((V=>{V.executeWhenCompiled((()=>{G(0)}))}))}));const q=new R.e("temp",{width:V,height:d},P,!1);x.onApply=function(V){V.setTexture("textureSampler",G),V.setFloat("lod",X),V.setInt("gamma",G.gammaSpace?1:0)};const L=G.getInternalTexture();try{if(q.renderTarget&&L){const W=L.samplingMode;0!==X?G.updateSamplingMode(J.d.NEAREST_NEAREST_MIPNEAREST):G.updateSamplingMode(J.d.NEAREST_NEAREST),P.postProcessManager.directRender([x],q.renderTarget,!0),G.updateSamplingMode(W);const R=await A.readPixels(0,0,V,d),k=new Uint8Array(R.buffer,0,R.byteLength);return A.unBindFramebuffer(q.renderTarget),k}throw Error("Render to texture failed.")}finally{q.dispose(),x.dispose()}};async function u(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return!G.isReady()&&G._texture&&await new Promise(((V,W)=>{null!==G._texture?G._texture.onLoadedObservable.addOnce((()=>{V(0)})):W(0)})),await y(G,V,W,J,R)}const H={CreateResizedCopy:function(G,V,W){let d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const k=G.HG(),z=k.getEngine(),X=new R.e("resized"+G.name,{width:V,height:W},k,!G.noMipmap,!0,G._texture.type,!1,G.samplingMode,!1);X.wrapU=G.wrapU,X.wrapV=G.wrapV,X.uOffset=G.uOffset,X.vOffset=G.vOffset,X.uScale=G.uScale,X.vScale=G.vScale,X.uAng=G.uAng,X.vAng=G.vAng,X.wAng=G.wAng,X.coordinatesIndex=G.coordinatesIndex,X.level=G.level,X.anisotropicFilteringLevel=G.anisotropicFilteringLevel,X._texture.isReady=!1,G.wrapU=J.d.CLAMP_ADDRESSMODE,G.wrapV=J.d.CLAMP_ADDRESSMODE;const P=new Y("pass",1,null,d?J.d.BILINEAR_SAMPLINGMODE:J.d.NEAREST_SAMPLINGMODE,z,!1,0);return P.externalTextureSamplerBinding=!0,P.onEffectCreatedObservable.addOnce((V=>{V.executeWhenCompiled((()=>{P.onApply=function(V){V.setTexture("textureSampler",G)};const V=X.renderTarget;V&&(k.postProcessManager.directRender([P],V),z.unBindFramebuffer(V),X.disposeFramebufferObjects(),P.dispose(),X.getInternalTexture().isReady=!0)}))})),X},ApplyPostProcess:B,ToHalfFloat:b,FromHalfFloat:r,GetTextureDataAsync:u}},11254:(G,V,W)=>{W.d(V,{c:()=>R,f:()=>k});let J=[];class R{static SetImmediate(G){0===J.length&&setTimeout((()=>{const G=J;J=[];for(const V of G)V()}),1),J.push(G)}}function d(G,V,W){try{if(G())return V(),!0}catch(J){return null===W||void 0===W||W(J),!0}return!1}const k=function(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,k=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&d(G,V,W))return null;const z=setInterval((()=>{d(G,V,W)?clearInterval(z):(R-=J,R<0&&(clearInterval(z),null===W||void 0===W||W(new Error("Operation timed out after maximum retries. "+(k||"")),!0)))}),J);return()=>clearInterval(z)}},11307:(G,V,W)=>{function J(G){let V=1;do{V*=2}while(V<G);return V===G}function R(G,V,W){return G*(1-W)+V*W}function d(G){const V=k(G),W=z(G);return V-G>G-W?W:V}function k(G){return G--,G|=G>>1,G|=G>>2,G|=G>>4,G|=G>>8,G|=G>>16,++G}function z(G){return G|=G>>1,G|=G>>2,G|=G>>4,G|=G>>8,(G|=G>>16)-(G>>1)}function X(G,V){let W;switch(arguments.length>2&&void 0!==arguments[2]?arguments[2]:2){case 1:W=z(G);break;case 2:W=d(G);break;default:W=k(G)}return Math.min(W,V)}W.d(V,{e:()=>z,f:()=>X,j:()=>J,k:()=>R,l:()=>d})},11189:(G,V,W)=>{W.d(V,{d:()=>B,h:()=>g});var J=W(11176),R=W(11196),d=W(11201),k=W(11204),z=W(11211),X=W(11218),P=W(11222),A=W(11169),x=W(11227),q=W(11254),L=W(11301),t=W(11304),Y=W(11307);class g{static get BaseUrl(){return x.f.BaseUrl}static set BaseUrl(G){x.f.BaseUrl=G}static get CleanUrl(){return x.f.CleanUrl}static set CleanUrl(G){x.f.CleanUrl=G}static IsAbsoluteUrl(G){return 0===G.indexOf("//")||-1!==G.indexOf("://")&&(-1!==G.indexOf(".")&&(-1!==G.indexOf("/")&&(!(G.indexOf(":")>G.indexOf("/"))&&(G.indexOf("://")<G.indexOf(".")||(0===G.indexOf("data:")||0===G.indexOf("blob:"))))))}static set ScriptBaseUrl(G){x.f.ScriptBaseUrl=G}static get ScriptBaseUrl(){return x.f.ScriptBaseUrl}static set CDNBaseUrl(G){g.ScriptBaseUrl=G,g.AssetBaseUrl=G}static set ScriptPreprocessUrl(G){x.f.ScriptPreprocessUrl=G}static get ScriptPreprocessUrl(){return x.f.ScriptPreprocessUrl}static get DefaultRetryStrategy(){return x.f.DefaultRetryStrategy}static set DefaultRetryStrategy(G){x.f.DefaultRetryStrategy=G}static get CorsBehavior(){return x.f.CorsBehavior}static set CorsBehavior(G){x.f.CorsBehavior=G}static get UseFallbackTexture(){return A.c.UseFallbackTexture}static set UseFallbackTexture(G){A.c.UseFallbackTexture=G}static get RegisteredExternalClasses(){return L.b.RegisteredExternalClasses}static set RegisteredExternalClasses(G){L.b.RegisteredExternalClasses=G}static get fallbackTexture(){return A.c.FallbackTexture}static set fallbackTexture(G){A.c.FallbackTexture=G}static FetchToRef(G,V,W,J,R,d){const k=4*((Math.abs(G)*W%W|0)+(Math.abs(V)*J%J|0)*W);d.r=R[k]/255,d.g=R[k+1]/255,d.b=R[k+2]/255,d.a=R[k+3]/255}static Mix(G,V,W){return 0}static Instantiate(G){return L.b.Instantiate(G)}static SetImmediate(G){q.c.SetImmediate(G)}static IsExponentOfTwo(G){return!0}static FloatRound(G){return Math.fround(G)}static GetFilename(G){const V=G.lastIndexOf("/");return V<0?G:G.substring(V+1)}static GetFolderPath(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const W=G.lastIndexOf("/");return W<0?V?G:"":G.substring(0,W+1)}static ToDegrees(G){return 180*G/Math.PI}static ToRadians(G){return G*Math.PI/180}static SmoothAngleChange(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9;const J=this.ToRadians(G),R=this.ToRadians(V);return this.ToDegrees(Math.atan2((1-W)*Math.sin(R)+W*Math.sin(J),(1-W)*Math.cos(R)+W*Math.cos(J)))}static MakeArray(G,V){return!0===V||void 0!==G&&null!=G?Array.isArray(G)?G:[G]:null}static GetPointerPrefix(G){return(0,R.m)()&&!window.PointerEvent?"mouse":"pointer"}static SetCorsBehavior(G,V){(0,x.x)(G,V)}static SetReferrerPolicyBehavior(G,V){V.referrerPolicy=G}static get PreprocessUrl(){return x.f.PreprocessUrl}static set PreprocessUrl(G){x.f.PreprocessUrl=G}static LoadImage(G,V,W,J,R,d){return(0,x.p)(G,V,W,J,R,d)}static LoadFile(G,V,W,J,R,d){return(0,x.l)(G,V,W,J,R,d)}static async LoadFileAsync(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return await new Promise(((W,J)=>{(0,x.l)(G,(G=>{W(G)}),void 0,void 0,V,((G,V)=>{J(V)}))}))}static GetAssetUrl(G){if(!G)return"";if(g.AssetBaseUrl&&G.startsWith(g._DefaultAssetsUrl)){const V="/"===g.AssetBaseUrl[g.AssetBaseUrl.length-1]?g.AssetBaseUrl.substring(0,g.AssetBaseUrl.length-1):g.AssetBaseUrl;return G.replace(g._DefaultAssetsUrl,V)}return G}static GetBabylonScriptURL(G,V){if(!G)return"";if(g.ScriptBaseUrl&&G.startsWith(g._DefaultCdnUrl)){const V="/"===g.ScriptBaseUrl[g.ScriptBaseUrl.length-1]?g.ScriptBaseUrl.substring(0,g.ScriptBaseUrl.length-1):g.ScriptBaseUrl;G=G.replace(g._DefaultCdnUrl,V)}return G=g.ScriptPreprocessUrl(G),V&&(G=g.GetAbsoluteUrl(G)),G}static LoadBabylonScript(G,V,W,J){G=g.GetBabylonScriptURL(G),g.LoadScript(G,V,W)}static async LoadBabylonScriptAsync(G){return G=g.GetBabylonScriptURL(G),await g.LoadScriptAsync(G)}static LoadScript(G,V,W,J){let d=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("function"===typeof importScripts){try{importScripts(G),V&&V()}catch(X){null===W||void 0===W||W(`Unable to load script '${G}' in worker`,X)}return}if(!(0,R.m)())return void(null===W||void 0===W||W(`Cannot load script '${G}' outside of a window or a worker`));const k=document.getElementsByTagName("head")[0],z=document.createElement("script");d?(z.setAttribute("type","module"),z.innerText=G):(z.setAttribute("type","text/javascript"),z.setAttribute("src",G)),J&&(z.id=J),z.onload=()=>{V&&V()},z.onerror=V=>{W&&W(`Unable to load script '${G}'`,V)},k.appendChild(z)}static async LoadScriptAsync(G,V){return await new Promise(((W,J)=>{this.LoadScript(G,(()=>{W()}),((G,V)=>{J(V||new Error(G))}),V)}))}static ReadFileAsDataURL(G,V,W){const R=new FileReader,d={onCompleteObservable:new J.b,abort:()=>R.abort()};return R.onloadend=()=>{d.onCompleteObservable.notifyObservers(d)},R.onload=G=>{V(G.target.result)},R.onprogress=W,R.readAsDataURL(G),d}static ReadFile(G,V,W,J,R){return(0,x.r)(G,V,W,J,R)}static FileAsURL(G){const V=new Blob([G]);return window.URL.createObjectURL(V)}static Format(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return G.toFixed(V)}static DeepCopy(G,V,W,J){k.d.DeepCopy(G,V,W,J)}static IsEmpty(G){for(const V in G)if(Object.prototype.hasOwnProperty.call(G,V))return!1;return!0}static RegisterTopRootEvents(G,V){for(let J=0;J<V.length;J++){const R=V[J];G.addEventListener(R.name,R.handler,!1);try{window.parent&&window.parent.addEventListener(R.name,R.handler,!1)}catch(W){}}}static UnregisterTopRootEvents(G,V){for(let J=0;J<V.length;J++){const R=V[J];G.removeEventListener(R.name,R.handler);try{G.parent&&G.parent.removeEventListener(R.name,R.handler)}catch(W){}}}static async DumpFramebuffer(G,V,W,J){throw(0,X.e)("DumpTools")}static DumpData(G,V,W,J){throw(0,X.e)("DumpTools")}static async DumpDataAsync(G,V,W){throw(0,X.e)("DumpTools")}static _IsOffScreenCanvas(G){return void 0!==G.convertToBlob}static ToBlob(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",J=arguments.length>3?arguments[3]:void 0;g._IsOffScreenCanvas(G)||G.toBlob||(G.toBlob=function(G,V,W){setTimeout((()=>{const J=atob(this.toDataURL(V,W).split(",")[1]),R=J.length,d=new Uint8Array(R);for(let G=0;G<R;G++)d[G]=J.charCodeAt(G);G(new Blob([d]))}))}),g._IsOffScreenCanvas(G)?G.convertToBlob({type:W,quality:J}).then((G=>V(G))):G.toBlob((function(G){V(G)}),W,J)}static DownloadBlob(G,V){if("download"in document.createElement("a")){if(!V){const G=new Date;V="screenshot_"+((G.getFullYear()+"-"+(G.getMonth()+1)).slice(2)+"-"+G.getDate()+"_"+G.getHours()+"-"+("0"+G.getMinutes()).slice(-2))+".png"}g.Download(G,V)}else if(G&&"undefined"!==typeof URL){const V=URL.createObjectURL(G),W=window.open("");if(!W)return;const J=W.document.createElement("img");J.onload=function(){URL.revokeObjectURL(V)},J.src=V,W.document.body.appendChild(J)}}static EncodeScreenshotCanvasData(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",J=arguments.length>3?arguments[3]:void 0,R=arguments.length>4?arguments[4]:void 0;if("string"!==typeof J&&V){if(V){if(g._IsOffScreenCanvas(G))return void G.convertToBlob({type:W,quality:R}).then((G=>{const W=new FileReader;W.readAsDataURL(G),W.onloadend=()=>{const G=W.result;V(G)}}));const J=G.toDataURL(W,R);V(J)}}else this.ToBlob(G,(function(G){G&&g.DownloadBlob(G,J),V&&V("")}),W,R)}static Download(G,V){if("undefined"===typeof URL)return;const W=window.URL.createObjectURL(G),J=document.createElement("a");document.body.appendChild(J),J.style.display="none",J.href=W,J.download=V,J.addEventListener("click",(()=>{J.parentElement&&J.parentElement.removeChild(J)})),J.click(),window.URL.revokeObjectURL(W)}static BackCompatCameraNoPreventDefault(G){return"boolean"===typeof G[0]?G[0]:"boolean"===typeof G[1]&&G[1]}static CreateScreenshot(G,V,W,J){throw(0,X.e)("ScreenshotTools")}static async CreateScreenshotAsync(G,V,W){throw(0,X.e)("ScreenshotTools")}static CreateScreenshotUsingRenderTarget(G,V,W,J){throw(0,X.e)("ScreenshotTools")}static async CreateScreenshotUsingRenderTargetAsync(G,V,W){throw(0,X.e)("ScreenshotTools")}static RandomId(){return(0,t.b)()}static IsBase64(G){return(0,x.h)(G)}static DecodeBase64(G){return(0,x.e)(G)}static get errorsCount(){return d.c.errorsCount}static Log(G){d.c.Log(G)}static Warn(G){d.c.Warn(G)}static Error(G){d.c.Error(G)}static get LogCache(){return d.c.LogCache}static ClearLogCache(){d.c.ClearLogCache()}static set LogLevels(G){d.c.LogLevels=G}static set PerformanceLogLevel(G){return(G&g.PerformanceUserMarkLogLevel)===g.PerformanceUserMarkLogLevel?(g.StartPerformanceCounter=g._StartUserMark,void(g.EndPerformanceCounter=g._EndUserMark)):(G&g.PerformanceConsoleLogLevel)===g.PerformanceConsoleLogLevel?(g.StartPerformanceCounter=g._StartPerformanceConsole,void(g.EndPerformanceCounter=g._EndPerformanceConsole)):(g.StartPerformanceCounter=g._StartPerformanceCounterDisabled,void(g.EndPerformanceCounter=g._EndPerformanceCounterDisabled))}static _StartPerformanceCounterDisabled(G,V){}static _EndPerformanceCounterDisabled(G,V){}static _StartUserMark(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!g._Performance){if(!(0,R.m)())return;g._Performance=window.performance}V&&g._Performance.mark&&g._Performance.mark(G+"-Begin")}static _EndUserMark(G){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&g._Performance.mark&&(g._Performance.mark(G+"-End"),g._Performance.measure(G,G+"-Begin",G+"-End"))}static _StartPerformanceConsole(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];V&&(g._StartUserMark(G,V),console.time&&console.time(G))}static _EndPerformanceConsole(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];V&&(g._EndUserMark(G,V),console.timeEnd(G))}static get Now(){return z.e.Now}static GetClassName(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=null;if(!V&&G.getClassName)W=G.getClassName();else{if(G instanceof Object){W=(V?G:Object.getPrototypeOf(G)).constructor.__bjsclassName__}W||(W=typeof G)}return W}static First(G,V){for(const W of G)if(V(W))return W;return null}static getFullClassName(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=null,J=null;if(!V&&G.getClassName)W=G.getClassName();else{if(G instanceof Object){const R=V?G:Object.getPrototypeOf(G);W=R.constructor.__bjsclassName__,J=R.constructor.__bjsmoduleName__}W||(W=typeof G)}return W?(null!=J?J+".":"")+W:null}static async DelayAsync(G){await new Promise((V=>{setTimeout((()=>{V()}),G)}))}static IsSafari(){return!!(0,R.i)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}g.AssetBaseUrl="",g.UseCustomRequestHeaders=!1,g.CustomRequestHeaders=P.b.CustomRequestHeaders,g.GetDOMTextContent=R.b,g._DefaultCdnUrl="https://cdn.babylonjs.com",g._DefaultAssetsUrl="https://assets.babylonjs.com/core",g.GetAbsoluteUrl="object"===typeof document?G=>{const V=document.createElement("a");return V.href=G,V.href}:"function"===typeof URL&&"object"===typeof location?G=>new URL(G,location.origin).href:()=>{throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},g.NoneLogLevel=d.c.NoneLogLevel,g.MessageLogLevel=d.c.MessageLogLevel,g.WarningLogLevel=d.c.WarningLogLevel,g.ErrorLogLevel=d.c.ErrorLogLevel,g.AllLogLevel=d.c.AllLogLevel,g.IsWindowObjectExist=R.m,g.PerformanceNoneLogLevel=0,g.PerformanceUserMarkLogLevel=1,g.PerformanceConsoleLogLevel=2,g.StartPerformanceCounter=g._StartPerformanceCounterDisabled,g.EndPerformanceCounter=g._EndPerformanceCounterDisabled;class B{constructor(G,V,W){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.iterations=G,this.index=J-1,this._done=!1,this._fn=V,this._successCallback=W}executeNext(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}breakLoop(){this._done=!0,this._successCallback()}static Run(G,V,W){const J=new B(G,V,W,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return J.executeNext(),J}static SyncAsyncForLoop(G,V,W,J,R){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return B.Run(Math.ceil(G/V),(J=>{R&&R()?J.breakLoop():setTimeout((()=>{for(let d=0;d<V;++d){const k=J.index*V+d;if(k>=G)break;if(W(k),R&&R()){J.breakLoop();break}}J.executeNext()}),d)}),J)}}g.Mix=Y.k,g.IsExponentOfTwo=Y.j,A.c.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},11159:(G,V,W)=>{W.d(V,{c:()=>d,d:()=>R});const J={};function R(G,V){J[G]=V}function d(G){return J[G]}},11789:(G,V,W)=>{W.d(V,{e:()=>J});class J{static get UniqueId(){const G=this._UniqueIdCounter;return this._UniqueIdCounter++,G}}J._UniqueIdCounter=1},11222:(G,V,W)=>{W.d(V,{b:()=>J});class J{constructor(){this._xhr="undefined"!==typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(J.CustomRequestHeaders).length>0||J.CustomRequestModifiers.length>0}get requestURL(){return this._requestURL}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const G in J.CustomRequestHeaders){const V=J.CustomRequestHeaders[G];V&&this._xhr.setRequestHeader(G,V)}}_shouldSkipRequestModifications(G){return J.SkipRequestModificationForBabylonCDN&&(G.includes("preview.babylonjs.com")||G.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(G){this._xhr.onprogress=G}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(G){this._xhr.responseType=G}get timeout(){return this._xhr.timeout}set timeout(G){this._xhr.timeout=G}addEventListener(G,V,W){this._xhr.addEventListener(G,V,W)}removeEventListener(G,V,W){this._xhr.removeEventListener(G,V,W)}abort(){this._xhr.abort()}send(G){J.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(G)}open(G,V){for(const W of J.CustomRequestModifiers){if(this._shouldSkipRequestModifications(V))return;V=W(this._xhr,V)||V}V=(V=V.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=V,this._xhr.open(G,V,!0)}setRequestHeader(G,V){this._xhr.setRequestHeader(G,V)}getResponseHeader(G){return this._xhr.getResponseHeader(G)}}J.CustomRequestHeaders={},J.CustomRequestModifiers=new Array,J.SkipRequestModificationForBabylonCDN=!0},11911:(G,V,W)=>{W.d(V,{b:()=>R});class J{constructor(G){this._pendingActions=new Array,this._workerInfos=G.map((G=>({workerPromise:Promise.resolve(G),idle:!0})))}dispose(){for(const G of this._workerInfos)G.workerPromise.then((G=>{G.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(G){this._executeOnIdleWorker(G)||this._pendingActions.push(G)}_executeOnIdleWorker(G){for(const V of this._workerInfos)if(V.idle)return this._execute(V,G),!0;return!1}_execute(G,V){G.idle=!1,G.workerPromise.then((W=>{V(W,(()=>{const V=this._pendingActions.shift();V?this._execute(G,V):G.idle=!0}))}))}}class R extends J{constructor(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R.DefaultOptions;super([]),this._maxWorkers=G,this._createWorkerAsync=V,this._options=W}push(G){if(!this._executeOnIdleWorker(G))if(this._workerInfos.length<this._maxWorkers){const V={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(V),this._execute(V,G)}else this._pendingActions.push(G)}_execute(G,V){G.timeoutId&&(clearTimeout(G.timeoutId),delete G.timeoutId),super._execute(G,((W,J)=>{V(W,(()=>{J(),G.idle&&(G.timeoutId=setTimeout((()=>{G.workerPromise.then((G=>{G.terminate()}));const V=this._workerInfos.indexOf(G);-1!==V&&this._workerInfos.splice(V,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}R.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},11864:(G,V,W)=>{W.d(V,{d:()=>A});var J=W(11317),R=W(11176),d=W(11169),k=W(11345),z=W(11324),X=W(11411),P=W(11159);class A{get influence(){return this._influence}set influence(G){if(this._influence===G)return;const V=this._influence;this._influence=G,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===V||0===G)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(G){this._animationPropertiesOverride=G}constructor(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=G,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uv2s=null,this._colors=null,this._uniqueId=0,this.onInfluenceChanged=new R.b,this._onDataLayoutChanged=new R.b,this._animationPropertiesOverride=null,this.id=G,this._scene=W||d.c.LastCreatedScene,this.influence=V,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}get hasUV2s(){return!!this._uv2s}get hasColors(){return!!this._colors}get vertexCount(){return this._positions?this._positions.length/3:this._normals?this._normals.length/3:this._tangents?this._tangents.length/3:this._uvs?this._uvs.length/2:this._uv2s?this._uv2s.length/2:this._colors?this._colors.length/4:0}setPositions(G){const V=this.hasPositions;this._positions=G,V!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(G){const V=this.hasNormals;this._normals=G,V!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(G){const V=this.hasTangents;this._tangents=G,V!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(G){const V=this.hasUVs;this._uvs=G,V!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}setUV2s(G){const V=this.hasUV2s;this._uv2s=G,V!==this.hasUV2s&&this._onDataLayoutChanged.notifyObservers(void 0)}getUV2s(){return this._uv2s}setColors(G){const V=this.hasColors;this._colors=G,V!==this.hasColors&&this._onDataLayoutChanged.notifyObservers(void 0)}getColors(){return this._colors}clone(){const G=X.e.Clone((()=>new A(this.name,this.influence,this._scene)),this);return G._positions=this._positions,G._normals=this._normals,G._tangents=this._tangents,G._uvs=this._uvs,G._uv2s=this._uv2s,G._colors=this._colors,G}serialize(){const G={};return G.name=this.name,G.influence=this.influence,G.DG=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(G.id=this.id),this.hasNormals&&(G.iG=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(G.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(G.FG=Array.prototype.slice.call(this.getUVs())),this.hasUV2s&&(G.uv2s=Array.prototype.slice.call(this.getUV2s())),this.hasColors&&(G.eG=Array.prototype.slice.call(this.getColors())),X.e.AppendSerializedAnimations(this,G),G}getClassName(){return"MorphTarget"}static Parse(G,V){const W=new A(G.name,G.influence);if(W.setPositions(G.DG),null!=G.id&&(W.id=G.id),G.iG&&W.setNormals(G.iG),G.tangents&&W.setTangents(G.tangents),G.FG&&W.setUVs(G.FG),G.uv2s&&W.setUV2s(G.uv2s),G.eG&&W.setColors(G.eG),G.animations){for(let V=0;V<G.animations.length;V++){const J=G.animations[V],R=(0,P.c)("BABYLON.Animation");R&&W.animations.push(R.Parse(J))}G.autoAnimate&&V&&V.beginAnimation(W,G.autoAnimateFrom,G.autoAnimateTo,G.autoAnimateLoop,G.autoAnimateSpeed||1)}return W}static FromMesh(G,V,W){V||(V=G.name);const J=new A(V,W,G.HG());return J.setPositions(G.getVerticesData(k.c.PositionKind)),G.isVerticesDataPresent(k.c.NormalKind)&&J.setNormals(G.getVerticesData(k.c.NormalKind)),G.isVerticesDataPresent(k.c.TangentKind)&&J.setTangents(G.getVerticesData(k.c.TangentKind)),G.isVerticesDataPresent(k.c.UVKind)&&J.setUVs(G.getVerticesData(k.c.UVKind)),G.isVerticesDataPresent(k.c.UV2Kind)&&J.setUV2s(G.getVerticesData(k.c.UV2Kind)),G.isVerticesDataPresent(k.c.ColorKind)&&J.setColors(G.getVerticesData(k.c.ColorKind)),J}}(0,J.e)([(0,z.I)()],A.prototype,"id",void 0)},11686:(G,V,W)=>{W.d(V,{c:()=>t});var J=W(11317),R=W(11525),d=W(11176),k=W(11136),z=W(11268),X=W(11324),P=W(11411),A=W(11159),x=W(11262),q=W(11307),L=W(11691);x.b.prototype.setTextureFromPostProcess=function(G,V,W){var J;let R=null;V&&(V._forcedOutputTexture?R=V._forcedOutputTexture:V._textures.data[V._currentRenderTextureInd]&&(R=V._textures.data[V._currentRenderTextureInd])),this._bindTexture(G,(null===(J=R)||void 0===J?void 0:J.texture)??null,W)},x.b.prototype.setTextureFromPostProcessOutput=function(G,V,W){var J;this._bindTexture(G,(null===V||void 0===V||null===(J=V._outputTexture)||void 0===J?void 0:J.texture)??null,W)},z.b.prototype.setTextureFromPostProcess=function(G,V){this._engine.setTextureFromPostProcess(this._samplers[G],V,G)},z.b.prototype.setTextureFromPostProcessOutput=function(G,V){this._engine.setTextureFromPostProcessOutput(this._samplers[G],V,G)};class t{static get ForceGLSL(){return L.d.ForceGLSL}static set ForceGLSL(G){L.d.ForceGLSL=G}static RegisterShaderCodeProcessing(G,V){L.d.RegisterShaderCodeProcessing(G,V)}get name(){return this._effectWrapper.name}set name(G){this._effectWrapper.name=G}get alphaMode(){return this._effectWrapper.alphaMode}set alphaMode(G){this._effectWrapper.alphaMode=G}get samples(){return this._samples}set samples(G){this._samples=Math.min(G,this._engine.getCaps().maxMSAASamples),this._textures.forEach((G=>{G.setSamples(this._samples)}))}get shaderLanguage(){return this._shaderLanguage}getEffectName(){return this._fragmentUrl}set onActivate(G){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),G&&(this._onActivateObserver=this.onActivateObservable.add(G))}set onSizeChanged(G){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(G)}set onApply(G){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(G)}set onBeforeRender(G){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(G)}set onAfterRender(G){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(G)}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}set inputTexture(G){this._forcedOutputTexture=G}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}getCamera(){return this._camera}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.rd(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}constructor(G,V,W,J,z,X){var P;let A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,x=arguments.length>7?arguments[7]:void 0,q=arguments.length>8?arguments[8]:void 0,Y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,g=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,B=arguments.length>11&&void 0!==arguments[11]?arguments[11]:"postprocess",S=arguments.length>12?arguments[12]:void 0,p=arguments.length>13&&void 0!==arguments[13]&&arguments[13],b=arguments.length>14&&void 0!==arguments[14]?arguments[14]:5,r=arguments.length>15?arguments[15]:void 0,y=arguments.length>16?arguments[16]:void 0;this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.Xx=!0,this.forceAutoClearInAlphaMode=!1,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new R.f(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new k.k(1,1),this._texelSize=k.k.Zero(),this.onActivateObservable=new d.b,this.onSizeChangedObservable=new d.b,this.onApplyObservable=new d.b,this.onBeforeRenderObservable=new d.b,this.onAfterRenderObservable=new d.b,this.Md=new d.b;let u,H=1,n=null;if(W&&!Array.isArray(W)){const G=W;W=G.uniforms??null,J=G.samplers??null,H=G.size??1,X=G.camera??null,A=G.samplingMode??1,x=G.Ik,q=G.reusable,Y=Array.isArray(G.defines)?G.defines.join("\n"):G.defines??null,g=G.textureType??0,B=G.vertexUrl??"postprocess",S=G.indexParameters,p=G.blockCompilation??!1,b=G.textureFormat??5,r=G.shaderLanguage??0,n=G.uniformBuffers??null,y=G.extraInitializations,u=G.effectWrapper}else z&&(H="number"===typeof z?z:{width:z.width,height:z.height});if(this._useExistingThinPostProcess=!!u,this._effectWrapper=u??new L.d({name:G,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:V,Ik:x||(null===(P=X)||void 0===P?void 0:P.HG().getEngine()),uniforms:W,samplers:J,uniformBuffers:n,defines:Y,vertexUrl:B,indexParameters:S,blockCompilation:!0,shaderLanguage:r,extraInitializations:void 0}),this.name=G,this.onEffectCreatedObservable=this._effectWrapper.onEffectCreatedObservable,null!=X?(this._camera=X,this._scene=X.HG(),X.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):x&&(this._engine=x,this._engine.postProcesses.push(this)),this._options=H,this.renderTargetSamplingMode=A||1,this._reusable=q||!1,this._textureType=g,this._textureFormat=b,this._shaderLanguage=r||0,this._samplers=J||[],-1===this._samplers.indexOf("textureSampler")&&this._samplers.push("textureSampler"),this._fragmentUrl=V,this._vertexUrl=B,this._parameters=W||[],-1===this._parameters.indexOf("scale")&&this._parameters.push("scale"),this._uniformBuffers=n||[],this._indexParameters=S,!this._useExistingThinPostProcess){this._webGPUReady=1===this._shaderLanguage;const G=[];this._gatherImports(this._engine.isWebGPU&&!t.ForceGLSL,G),this._effectWrapper._webGPUReady=this._webGPUReady,this._effectWrapper._postConstructor(p,Y,y,G)}}_gatherImports(){let G=arguments.length>1?arguments[1]:void 0;arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this._webGPUReady?G.push(Promise.all([W.e(42).then(W.bind(W,13857))])):G.push(Promise.all([Promise.resolve().then(W.bind(W,11693))]))}getClassName(){return"PostProcess"}getEngine(){return this._engine}getEffect(){return this._effectWrapper.drawWrapper.effect}shareOutputWith(G){return this._disposeTextures(),this._shareOutputWithPostProcess=G,this}useOwnOutput(){0==this._textures.length&&(this._textures=new R.f(2)),this._shareOutputWithPostProcess=null}updateEffect(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3?arguments[3]:void 0,R=arguments.length>4?arguments[4]:void 0,d=arguments.length>5?arguments[5]:void 0,k=arguments.length>6?arguments[6]:void 0,z=arguments.length>7?arguments[7]:void 0;this._effectWrapper.updateEffect(G,V,W,J,R,d,k,z),this._postProcessDefines=Array.isArray(this._effectWrapper.options.defines)?this._effectWrapper.options.defines.join("\n"):this._effectWrapper.options.defines}isReusable(){return this._reusable}markTextureDirty(){this.width=-1}_createRenderTargetTexture(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let R=0;R<this._textureCache.length;R++)if(this._textureCache[R].texture.width===G.width&&this._textureCache[R].texture.height===G.height&&this._textureCache[R].postProcessChannel===W&&this._textureCache[R].texture._generateDepthBuffer===V.generateDepthBuffer&&this._textureCache[R].texture.samples===V.samples)return this._textureCache[R].texture;const J=this._engine.createRenderTargetTexture(G,V);return this._textureCache.push({texture:J,postProcessChannel:W,lastUsedRenderId:-1}),J}_flushTextureCache(){const G=this._renderId;for(let V=this._textureCache.length-1;V>=0;V--)if(G-this._textureCache[V].lastUsedRenderId>100){let G=!1;for(let W=0;W<this._textures.length;W++)if(this._textures.data[W]===this._textureCache[V].texture){G=!0;break}G||(this._textureCache[V].texture.dispose(),this._textureCache.splice(V,1))}}resize(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],R=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._textures.length>0&&this._textures.reset(),this.width=G,this.height=V;let d=null;if(W)for(let X=0;X<W._postProcesses.length;X++)if(null!==W._postProcesses[X]){d=W._postProcesses[X];break}const k={width:this.width,height:this.height},z={generateMipMaps:J,generateDepthBuffer:R||d===this,generateStencilBuffer:(R||d===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(k,z,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(k,z,1)),this._texelSize.rd(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}_getTarget(){let G;if(this._shareOutputWithPostProcess)G=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)G=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{let V;G=this.inputTexture;for(let W=0;W<this._textureCache.length;W++)if(this._textureCache[W].texture===G){V=this._textureCache[W];break}V&&(V.lastUsedRenderId=this._renderId)}return G}activate(G){var V,W;let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2?arguments[2]:void 0;const d=null===G||void 0!==G.cameraRigMode?G||this._camera:null,k=(null===d||void 0===d?void 0:d.HG())??G,z=k.getEngine(),X=z.getCaps().maxTextureSize,P=(J?J.width:this._engine.getRenderWidth(!0))*this._options|0,A=(J?J.height:this._engine.getRenderHeight(!0))*this._options|0;let x=this._options.width||P,L=this._options.height||A;const t=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;let Y=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){const G=z.currentViewport;G&&(x*=G.width,L*=G.height)}(t||this.alwaysForcePOT)&&(this._options.width||(x=z.needPOTTextures?(0,q.f)(x,X,this.scaleMode):x),this._options.height||(L=z.needPOTTextures?(0,q.f)(L,X,this.scaleMode):L)),this.width===x&&this.height===L&&(Y=this._getTarget())||this.resize(x,L,d,t,R),this._textures.forEach((G=>{G.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(G,this.samples)})),this._flushTextureCache(),this._renderId++}return Y||(Y=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.rd(P/x,A/L),this._engine.bindFramebuffer(Y,0,P,A,this.forceFullscreenViewport)):(this._scaleRatio.rd(1,1),this._engine.bindFramebuffer(Y,0,void 0,void 0,this.forceFullscreenViewport)),null===(V=(W=this._engine)._debugInsertMarker)||void 0===V||V.call(W,`post process ${this.name} input`),this.onActivateObservable.notifyObservers(d),this.Xx&&(0===this.alphaMode||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:k.clearColor,k._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),Y}get isSupported(){return this._effectWrapper.drawWrapper.effect.isSupported}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}isReady(){return this._effectWrapper.isReady()}apply(){if(!this._effectWrapper.isReady())return null;let G;var V;(this._engine.enableEffect(this._effectWrapper.drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),this._engine.setAlphaMode(this.alphaMode),G=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding)||this._effectWrapper.drawWrapper.effect._bindTexture("textureSampler",null===(V=G)||void 0===V?void 0:V.texture);return this._effectWrapper.drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effectWrapper.drawWrapper.effect),this._effectWrapper.bind(!0),this._effectWrapper.drawWrapper.effect}_disposeTextures(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())}_disposeTextureCache(){for(let G=this._textureCache.length-1;G>=0;G--)this._textureCache[G].texture.dispose();this._textureCache.length=0}setPrePassRenderer(G){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=G.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)}dispose(G){let V;if(G=G||this._camera,this._useExistingThinPostProcess||this._effectWrapper.dispose(),this._disposeTextures(),this._scene&&(V=this._scene.postProcesses.indexOf(this),-1!==V&&this._scene.postProcesses.splice(V,1)),this._parentContainer){const G=this._parentContainer.postProcesses.indexOf(this);G>-1&&this._parentContainer.postProcesses.splice(G,1),this._parentContainer=null}if(V=this._engine.postProcesses.indexOf(this),-1!==V&&this._engine.postProcesses.splice(V,1),this.Md.notifyObservers(),G){if(G.detachPostProcess(this),V=G._postProcesses.indexOf(this),0===V&&G._postProcesses.length>0){const G=this._camera._getFirstPostProcess();G&&G.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}}serialize(){const G=P.e.Serialize(this),V=this.getCamera()||this._scene&&this._scene.activeCamera;return G.customType="BABYLON."+this.getClassName(),G.cameraId=V?V.id:null,G.reusable=this._reusable,G.textureType=this._textureType,G.fragmentUrl=this._fragmentUrl,G.parameters=this._parameters,G.samplers=this._samplers,G.uniformBuffers=this._uniformBuffers,G.options=this._options,G.defines=this._postProcessDefines,G.textureFormat=this._textureFormat,G.vertexUrl=this._vertexUrl,G.indexParameters=this._indexParameters,G}clone(){const G=this.serialize();G._engine=this._engine,G.cameraId=null;const V=t.Parse(G,this._scene,"");return V?(V.onActivateObservable=this.onActivateObservable.clone(),V.onSizeChangedObservable=this.onSizeChangedObservable.clone(),V.onApplyObservable=this.onApplyObservable.clone(),V.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),V.onAfterRenderObservable=this.onAfterRenderObservable.clone(),V._prePassEffectConfiguration=this._prePassEffectConfiguration,V):null}static Parse(G,V,W){const J=(0,A.c)(G.customType);if(!J||!J._Parse)return null;const R=V?V.getCameraById(G.cameraId):null;return J._Parse(G,R,V,W)}static _Parse(G,V,W,J){return P.e.Parse((()=>new t(G.name,G.fragmentUrl,G.parameters,G.samplers,G.options,V,G.renderTargetSamplingMode,G._engine,G.reusable,G.defines,G.textureType,G.vertexUrl,G.indexParameters,!1,G.textureFormat)),G,W,J)}}(0,J.e)([(0,X.I)()],t.prototype,"uniqueId",void 0),(0,J.e)([(0,X.I)()],t.prototype,"name",null),(0,J.e)([(0,X.I)()],t.prototype,"width",void 0),(0,J.e)([(0,X.I)()],t.prototype,"height",void 0),(0,J.e)([(0,X.I)()],t.prototype,"renderTargetSamplingMode",void 0),(0,J.e)([(0,X.n)()],t.prototype,"clearColor",void 0),(0,J.e)([(0,X.I)()],t.prototype,"Xx",void 0),(0,J.e)([(0,X.I)()],t.prototype,"forceAutoClearInAlphaMode",void 0),(0,J.e)([(0,X.I)()],t.prototype,"alphaMode",null),(0,J.e)([(0,X.I)()],t.prototype,"alphaConstants",void 0),(0,J.e)([(0,X.I)()],t.prototype,"enablePixelPerfectMode",void 0),(0,J.e)([(0,X.I)()],t.prototype,"forceFullscreenViewport",void 0),(0,J.e)([(0,X.I)()],t.prototype,"scaleMode",void 0),(0,J.e)([(0,X.I)()],t.prototype,"alwaysForcePOT",void 0),(0,J.e)([(0,X.I)("samples")],t.prototype,"_samples",void 0),(0,J.e)([(0,X.I)()],t.prototype,"adaptScaleToCurrentViewport",void 0),(0,A.d)("BABYLON.PostProcess",t)},11676:(G,V,W)=>{W.d(V,{d:()=>d});var J=W(11345),R=W(11176);class d{constructor(G){this._vertexBuffers={},this.onBeforeRenderObservable=new R.b,this._scene=G}_prepareBuffers(){if(this._vertexBuffers[J.c.PositionKind])return;const G=[];G.push(1,1),G.push(-1,1),G.push(-1,-1),G.push(1,-1),this._vertexBuffers[J.c.PositionKind]=new J.c(this._scene.getEngine(),G,J.c.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const G=[];G.push(0),G.push(1),G.push(2),G.push(0),G.push(2),G.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(G)}_rebuild(){const G=this._vertexBuffers[J.c.PositionKind];G&&(G._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=this._scene.activeCamera;return!!W&&(V=V||W._postProcesses.filter((G=>null!=G)),!(!V||0===V.length||!this._scene.postProcessesEnabled)&&(V[0].activate(W,G,null!==V&&void 0!==V),!0))}directRender(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5],k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:G.length;const z=this._scene.getEngine();for(let P=0;P<k;P++){var X;if(P<G.length-1)G[P+1].activate(this._scene.activeCamera||this._scene,null===V||void 0===V?void 0:V.texture);else V?z.bindFramebuffer(V,J,void 0,void 0,W,R):d||z.restoreDefaultFramebuffer(),null===(X=z._debugInsertMarker)||void 0===X||X.call(z,`post process ${G[P].name} output`);const k=G[P],A=k.apply();A&&(k.onBeforeRenderObservable.notifyObservers(A),this._prepareBuffers(),z.bindBuffers(this._vertexBuffers,this._indexBuffer,A),z.drawElementsType(0,0,6),k.onAfterRenderObservable.notifyObservers(A))}z.setDepthBuffer(!0),z.setDepthWrite(!0)}_finalizeFrame(G,V,W,J){let R=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const d=this._scene.activeCamera;if(!d)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(J=J||d._postProcesses.filter((G=>null!=G))).length||!this._scene.postProcessesEnabled)return;const k=this._scene.getEngine();for(let X=0,P=J.length;X<P;X++){const A=J[X];var z;if(X<P-1)A._outputTexture=J[X+1].activate(d,null===V||void 0===V?void 0:V.texture);else V?(k.bindFramebuffer(V,W,void 0,void 0,R),A._outputTexture=V):(k.restoreDefaultFramebuffer(),A._outputTexture=null),null===(z=k._debugInsertMarker)||void 0===z||z.call(k,`post process ${J[X].name} output`);if(G)break;const x=A.apply();x&&(A.onBeforeRenderObservable.notifyObservers(x),this._prepareBuffers(),k.bindBuffers(this._vertexBuffers,this._indexBuffer,x),k.drawElementsType(0,0,6),A.onAfterRenderObservable.notifyObservers(x))}k.setDepthBuffer(!0),k.setDepthWrite(!0),k.setAlphaMode(0)}dispose(){const G=this._vertexBuffers[J.c.PositionKind];G&&(G.dispose(),this._vertexBuffers[J.c.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11683:(G,V,W)=>{W.d(V,{e:()=>z});var J=W(11525),R=W(11136);class d{set opaqueSortCompareFn(G){this._opaqueSortCompareFn=G||d.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(G){this._alphaTestSortCompareFn=G||d.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(G){this._transparentSortCompareFn=G||d.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=G,this._opaqueSubMeshes=new J.f(256),this._transparentSubMeshes=new J.f(256),this._alphaTestSubMeshes=new J.f(256),this._depthOnlySubMeshes=new J.f(256),this._particleSystems=new J.f(256),this._spriteManagers=new J.f(256),this._empty=!0,this._edgesRenderers=new J.c(16),this._scene=V,this.opaqueSortCompareFn=W,this.alphaTestSortCompareFn=R,this.transparentSortCompareFn=d}render(G,V,W,J){if(G)return void G(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const R=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(R.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),R.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const d=R.getStencilBuffer();if(R.setStencilBuffer(!1),V&&this._renderSprites(),W&&this._renderParticles(J),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(R.setStencilBuffer(d),this._scene.useOrderIndependentTransparency){const G=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);G.length&&this._renderTransparent(G)}else this._renderTransparent(this._transparentSubMeshes);R.setAlphaMode(0)}if(R.setStencilBuffer(!1),this._edgesRenderers.length){for(let G=0;G<this._edgesRenderers.length;G++)this._edgesRenderers.data[G].render();R.setAlphaMode(0)}R.setStencilBuffer(d)}_renderOpaqueSorted(G){d._RenderSorted(G,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(G){d._RenderSorted(G,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(G){d._RenderSorted(G,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(G,V,W,J){let k,z=0;const X=W?W.globalPosition:d._ZeroVector;if(J)for(;z<G.length;z++)k=G.data[z],k._alphaIndex=k.getMesh().alphaIndex,k._distanceToCamera=R.o.Distance(k.getBoundingInfo().boundingSphere.centerWorld,X);const P=G.length===G.data.length?G.data:G.data.slice(0,G.length);V&&P.sort(V);const A=P[0].getMesh().HG();for(z=0;z<P.length;z++)if(k=P[z],!A._activeMeshesFrozenButKeepClipping||k.isInFrustum(A._frustumPlanes)){if(J){const G=k.NG();if(G&&G.needDepthPrePass){const V=G.HG().getEngine();V.setColorWrite(!1),V.setAlphaMode(0),k.render(!1),V.setColorWrite(!0)}}k.render(J)}}static defaultTransparentSortCompare(G,V){return G._alphaIndex>V._alphaIndex?1:G._alphaIndex<V._alphaIndex?-1:d.backToFrontSortCompare(G,V)}static backToFrontSortCompare(G,V){return G._distanceToCamera<V._distanceToCamera?1:G._distanceToCamera>V._distanceToCamera?-1:0}static frontToBackSortCompare(G,V){return G._distanceToCamera<V._distanceToCamera?-1:G._distanceToCamera>V._distanceToCamera?1:0}static PainterSortCompare(G,V){const W=G.getMesh(),J=V.getMesh();return W.material&&J.material?W.material.uniqueId-J.material.uniqueId:W.uniqueId-J.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(G,V,W){void 0===V&&(V=G.getMesh()),void 0===W&&(W=G.NG()),null!==W&&void 0!==W&&(W.needAlphaBlendingForMesh(V)?this._transparentSubMeshes.push(G):W.needAlphaTestingForMesh(V)?(W.needDepthPrePass&&this._depthOnlySubMeshes.push(G),this._alphaTestSubMeshes.push(G)):(W.needDepthPrePass&&this._depthOnlySubMeshes.push(G),this._opaqueSubMeshes.push(G)),V._renderingGroup=this,V._edgesRenderer&&V.isEnabled()&&V.isVisible&&V._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(V._edgesRenderer),this._empty=!1)}dispatchSprites(G){this._spriteManagers.push(G),this._empty=!1}dispatchParticles(G){this._particleSystems.push(G),this._empty=!1}_renderParticles(G){if(0===this._particleSystems.length)return;const V=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let W=0;W<this._particleSystems.length;W++){const J=this._particleSystems.data[W];if(0===(V&&V.layerMask&J.layerMask))continue;const R=J.j;R.position&&G&&-1===G.indexOf(R)||this._scene._activeParticles.addCount(J.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const G=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let V=0;V<this._spriteManagers.length;V++){const W=this._spriteManagers.data[V];0!==(G&&G.layerMask&W.layerMask)&&W.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}d._ZeroVector=R.o.Zero();class k{}class z{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(G){G!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=G,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const G of this._scene.meshes)if(G.Ed)for(const V of G.Ed)V._wasDispatched=!1;if(this._scene.spriteManagers)for(const G of this._scene.spriteManagers)G._wasDispatched=!1;for(const G of this._scene.mx)G._wasDispatched=!1}constructor(G){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new k,this._maintainStateBetweenFrames=!1,this._scene=G;for(let V=z.MIN_RENDERINGGROUPS;V<z.MAX_RENDERINGGROUPS;V++)this._autoClearDepthStencil[V]={Xx:!0,depth:!0,stencil:!0}}getRenderingGroup(G){const V=G||0;return this._prepareRenderingGroup(V),this._renderingGroups[V]}_clearDepthStencilBuffer(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,G,V),this._depthStencilBufferAlreadyCleaned=!0)}render(G,V,W,J){const R=this._renderingGroupInfo;if(R.tV=this._scene,R.camera=this._scene.activeCamera,R.renderingManager=this,this._scene.spriteManagers&&J)for(let d=0;d<this._scene.spriteManagers.length;d++){const G=this._scene.spriteManagers[d];this.dispatchSprites(G)}for(let d=z.MIN_RENDERINGGROUPS;d<z.MAX_RENDERINGGROUPS;d++){this._depthStencilBufferAlreadyCleaned=d===z.MIN_RENDERINGGROUPS;const k=this._renderingGroups[d];if(!k||k._empty)continue;const X=1<<d;if(R.renderingGroupId=d,this._scene.onBeforeRenderingGroupObservable.notifyObservers(R,X),z.AUTOCLEAR){const G=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(d):this._autoClearDepthStencil[d];G&&G.Xx&&this._clearDepthStencilBuffer(G.depth,G.stencil)}for(const G of this._scene._beforeRenderingGroupDrawStage)G.action(d);k.render(G,J,W,V);for(const G of this._scene._afterRenderingGroupDrawStage)G.action(d);this._scene.onAfterRenderingGroupObservable.notifyObservers(R,X)}}reset(){if(!this.maintainStateBetweenFrames)for(let G=z.MIN_RENDERINGGROUPS;G<z.MAX_RENDERINGGROUPS;G++){const V=this._renderingGroups[G];V&&V.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let G=z.MIN_RENDERINGGROUPS;G<z.MAX_RENDERINGGROUPS;G++){const V=this._renderingGroups[G];V&&V.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let G=z.MIN_RENDERINGGROUPS;G<z.MAX_RENDERINGGROUPS;G++){const V=this._renderingGroups[G];V&&V.dispose()}}_prepareRenderingGroup(G){void 0===this._renderingGroups[G]&&(this._renderingGroups[G]=new d(G,this._scene,this._customOpaqueSortCompareFn[G],this._customAlphaTestSortCompareFn[G],this._customTransparentSortCompareFn[G]))}dispatchSprites(G){this.maintainStateBetweenFrames&&G._wasDispatched||(G._wasDispatched=!0,this.getRenderingGroup(G.renderingGroupId).dispatchSprites(G))}dispatchParticles(G){this.maintainStateBetweenFrames&&G._wasDispatched||(G._wasDispatched=!0,this.getRenderingGroup(G.renderingGroupId).dispatchParticles(G))}dispatch(G,V,W){void 0===V&&(V=G.getMesh()),this.maintainStateBetweenFrames&&G._wasDispatched||(G._wasDispatched=!0,this.getRenderingGroup(V.renderingGroupId).dispatch(G,V,W))}setRenderingOrder(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[G]=V,this._customAlphaTestSortCompareFn[G]=W,this._customTransparentSortCompareFn[G]=J,this._renderingGroups[G]){const V=this._renderingGroups[G];V.opaqueSortCompareFn=this._customOpaqueSortCompareFn[G],V.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[G],V.transparentSortCompareFn=this._customTransparentSortCompareFn[G]}}setRenderingAutoClearDepthStencil(G,V){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[G]={Xx:V,depth:W,stencil:J}}getAutoClearDepthStencilSetup(G){return this._autoClearDepthStencil[G]}}z.MAX_RENDERINGGROUPS=4,z.MIN_RENDERINGGROUPS=0,z.AUTOCLEAR=!0},11693:(G,V,W)=>{W.r(V),W.d(V,{postprocessVertexShader:()=>k});var J=W(11270);const R="postprocessVertexShader",d="attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";J.d.ShadersStore[R]||(J.d.ShadersStore[R]=d);const k={name:R,shader:d}},11781:(G,V,W)=>{W.d(V,{d:()=>J});class J{}J._IsPickingAvailable=!1},11465:(G,V,W)=>{W.d(V,{d:()=>x});var J=W(11317),R=W(11136),d=W(11324),k=W(11176),z=W(11169),X=W(11218),P=W(11411);class A{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new k.b,this._onClonedObservable=new k.b}}class x{static AddNodeConstructor(G,V){this._NodeConstructors[G]=V}static Construct(G,V,W,J){const R=this._NodeConstructors[G];return R?R(V,W,J):null}set accessibilityTag(G){this._accessibilityTag=G,this.onAccessibilityTagChangedObservable.notifyObservers(G)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(G){this._nodeDataStorage._doNotSerialize=G}P(){return this._nodeDataStorage._isDisposed}set parent(G){if(this._parentNode===G)return;const V=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const V=this._parentNode._children.indexOf(this);-1!==V&&this._parentNode._children.splice(V,1),G||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=G,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),V||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(G){G.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const G=this._scene.rootNodes,V=G.length-1;G[this._nodeDataStorage._sceneRootNodesIndex]=G[V],G[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(G){this._animationPropertiesOverride=G}getClassName(){return"Node"}set onDispose(G){this._onDisposeObserver&&this.Md.remove(this._onDisposeObserver),this._onDisposeObserver=this.Md.add(G)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new A,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new k.b,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=R.c.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.Md=new k.b,this._onDisposeObserver=null,this._behaviors=new Array,this.name=G,this.id=G,this._scene=V||z.c.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),W&&this._addToSceneRootNodes()}HG(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(G)||(G.init(),this._scene.isLoading&&!V?this._scene.onDataLoadedObservable.addOnce((()=>{G.attach(this)})):G.attach(this),this._behaviors.push(G)),this}removeBehavior(G){const V=this._behaviors.indexOf(G);return-1===V||(this._behaviors[V].detach(),this._behaviors.splice(V,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(G){for(const V of this._behaviors)if(V.name===G)return V;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.kd(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(G){!G&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(G){return this.parent?this.parent._getActionManagerForTrigger(G,!1):null}_updateCache(G){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}pP(G){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){if(this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children)for(const G of this._children)G._syncParentEnabledState()}rz(G){this._nodeDataStorage._isEnabled!==G&&(this._nodeDataStorage._isEnabled=G,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(G))}isDescendantOf(G){return!!this.parent&&(this.parent===G||this.parent.isDescendantOf(G))}_getDescendants(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2?arguments[2]:void 0;if(this._children)for(let J=0;J<this._children.length;J++){const R=this._children[J];W&&!W(R)||G.push(R),V||R._getDescendants(G,!1,W)}}getDescendants(G,V){const W=[];return this._getDescendants(W,G,V),W}getChildMeshes(G,V){const W=[];return this._getDescendants(W,G,(G=>(!V||V(G))&&void 0!==G.sA)),W}getChildren(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(V,G)}_setReady(G){G!==this._nodeDataStorage._isReady&&(G?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(G){for(let V=0;V<this.animations.length;V++){const W=this.animations[V];if(W.name===G)return W}return null}createAnimationRange(G,V,W){if(!this._ranges[G]){this._ranges[G]=x._AnimationRangeFactory(G,V,W);for(let J=0,R=this.animations.length;J<R;J++)this.animations[J]&&this.animations[J].createRange(G,V,W)}}deleteAnimationRange(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let W=0,J=this.animations.length;W<J;W++)this.animations[W]&&this.animations[W].deleteRange(G,V);this._ranges[G]=null}getAnimationRange(G){return this._ranges[G]||null}clone(G,V,W){const J=P.e.Clone((()=>new x(G,this.HG())),this);if(V&&(J.parent=V),!W){const V=this.getDescendants(!0);for(let W=0;W<V.length;W++){const R=V[W];R.clone(G+"."+R.name,J)}}return J}getAnimationRanges(){const G=[];let V;for(V in this._ranges)G.push(this._ranges[V]);return G}beginAnimation(G,V,W,J){const R=this.getAnimationRange(G);return R?this._scene.beginAnimation(this,R.from,R.to,V,W,J):null}serializeAnimationRanges(){const G=[];for(const V in this._ranges){const W=this._ranges[V];if(!W)continue;const J={};J.name=V,J.from=W.from,J.to=W.to,G.push(J)}return G}kd(G){return this._worldMatrix||(this._worldMatrix=R.c.Identity()),this._worldMatrix}dispose(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!G){const W=this.getDescendants(!0);for(const J of W)J.dispose(G,V)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.Md.notifyObservers(this),this.Md.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const W of this._behaviors)W.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(G,V,W){if(V.ranges)for(let J=0;J<V.ranges.length;J++){const W=V.ranges[J];G.createAnimationRange(W.name,W.from,W.to)}}getHierarchyBoundingVectors(){let G,V,W=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.HG().incrementRenderId(),this.kd(!0);const d=this;if(d.getBoundingInfo&&d.Ed){const W=d.getBoundingInfo();G=W.boundingBox.minimumWorld.clone(),V=W.boundingBox.maximumWorld.clone()}else G=new R.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),V=new R.o(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(W){const W=this.getDescendants(!1);for(const d of W){const W=d;if(W.kd(!0),J&&!J(W))continue;if(!W.getBoundingInfo||0===W.getTotalVertices())continue;const k=W.getBoundingInfo().boundingBox,z=k.minimumWorld,X=k.maximumWorld;R.o.CheckExtends(z,G,V),R.o.CheckExtends(X,G,V)}}return{min:G,max:V}}}x._AnimationRangeFactory=(G,V,W)=>{throw(0,X.e)("AnimationRange")},x._NodeConstructors={},(0,J.e)([(0,d.I)()],x.prototype,"name",void 0),(0,J.e)([(0,d.I)()],x.prototype,"id",void 0),(0,J.e)([(0,d.I)()],x.prototype,"uniqueId",void 0),(0,J.e)([(0,d.I)()],x.prototype,"state",void 0),(0,J.e)([(0,d.I)()],x.prototype,"metadata",void 0)},11737:(G,V,W)=>{W.d(V,{e:()=>GG});var J=W(11189),R=W(11211),d=W(11176),k=W(11525);class z{constructor(){this._count=0,this._data={}}J(G){this.clear(),G.forEach(((G,V)=>this.add(G,V)))}get(G){const V=this._data[G];if(void 0!==V)return V}getOrAddWithFactory(G,V){let W=this.get(G);return void 0!==W||(W=V(G),W&&this.add(G,W)),W}getOrAdd(G,V){const W=this.get(G);return void 0!==W?W:(this.add(G,V),V)}contains(G){return void 0!==this._data[G]}add(G,V){return void 0===this._data[G]&&(this._data[G]=V,++this._count,!0)}set(G,V){return void 0!==this._data[G]&&(this._data[G]=V,!0)}getAndRemove(G){const V=this.get(G);return void 0!==V?(delete this._data[G],--this._count,V):null}remove(G){return!!this.contains(G)&&(delete this._data[G],--this._count,!0)}clear(){this._data={},this._count=0}get count(){return this._count}forEach(G){for(const V in this._data){G(V,this._data[V])}}first(G){for(const V in this._data){const W=G(V,this._data[V]);if(W)return W}return null}}var X=W(11416),P=W(11136),A=W(11744),x=W(11400),q=W(11492);class L{constructor(G,V,W,J,R,d){this.source=G,this.pointerX=V,this.pointerY=W,this.meshUnderPointer=J,this.sourceEvent=R,this.additionalData=d}static CreateNew(G,V,W){const J=G.HG();return new L(G,J.pointerX,J.pointerY,J.meshUnderPointer||G,V,W)}static CreateNewFromSprite(G,V,W,J){return new L(G,V.pointerX,V.pointerY,V.meshUnderPointer,W,J)}static CreateNewFromScene(G,V){return new L(null,G.pointerX,G.pointerY,G.meshUnderPointer,V)}static CreateNewFromPrimitive(G,V,W,J){return new L(G,V.x,V.y,null,W,J)}}var t=W(11676),Y=W(11683),g=W(11561),B=W(11196),S=W(11169),p=W(11218),b=W(11762);class r{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasTriggers(){for(const G in r.Triggers)if(Object.prototype.hasOwnProperty.call(r.Triggers,G))return!0;return!1}static get HasPickTriggers(){for(const G in r.Triggers)if(Object.prototype.hasOwnProperty.call(r.Triggers,G)){const V=parseInt(G);if(V>=1&&V<=7)return!0}return!1}static HasSpecificTrigger(G){for(const V in r.Triggers)if(Object.prototype.hasOwnProperty.call(r.Triggers,V)){if(parseInt(V)===G)return!0}return!1}}r.Triggers={};var y,u,H,n,D,i,e,F=W(11771);!function(G){G[G.Generic=0]="Generic",G[G.Keyboard=1]="Keyboard",G[G.Mouse=2]="Mouse",G[G.Touch=3]="Touch",G[G.DualShock=4]="DualShock",G[G.Xbox=5]="Xbox",G[G.Switch=6]="Switch",G[G.DualSense=7]="DualSense"}(y||(y={})),function(G){G[G.Horizontal=0]="Horizontal",G[G.Vertical=1]="Vertical",G[G.LeftClick=2]="LeftClick",G[G.MiddleClick=3]="MiddleClick",G[G.RightClick=4]="RightClick",G[G.BrowserBack=5]="BrowserBack",G[G.BrowserForward=6]="BrowserForward",G[G.MouseWheelX=7]="MouseWheelX",G[G.MouseWheelY=8]="MouseWheelY",G[G.MouseWheelZ=9]="MouseWheelZ",G[G.Move=12]="Move"}(u||(u={})),function(G){G[G.Horizontal=0]="Horizontal",G[G.Vertical=1]="Vertical",G[G.LeftClick=2]="LeftClick",G[G.MiddleClick=3]="MiddleClick",G[G.RightClick=4]="RightClick",G[G.BrowserBack=5]="BrowserBack",G[G.BrowserForward=6]="BrowserForward",G[G.MouseWheelX=7]="MouseWheelX",G[G.MouseWheelY=8]="MouseWheelY",G[G.MouseWheelZ=9]="MouseWheelZ",G[G.DeltaHorizontal=10]="DeltaHorizontal",G[G.DeltaVertical=11]="DeltaVertical"}(H||(H={})),function(G){G[G.Cross=0]="Cross",G[G.Circle=1]="Circle",G[G.Square=2]="Square",G[G.Triangle=3]="Triangle",G[G.L1=4]="L1",G[G.R1=5]="R1",G[G.L2=6]="L2",G[G.R2=7]="R2",G[G.Share=8]="Share",G[G.Options=9]="Options",G[G.L3=10]="L3",G[G.R3=11]="R3",G[G.DPadUp=12]="DPadUp",G[G.DPadDown=13]="DPadDown",G[G.DPadLeft=14]="DPadLeft",G[G.DPadRight=15]="DPadRight",G[G.Home=16]="Home",G[G.TouchPad=17]="TouchPad",G[G.LStickXAxis=18]="LStickXAxis",G[G.LStickYAxis=19]="LStickYAxis",G[G.RStickXAxis=20]="RStickXAxis",G[G.RStickYAxis=21]="RStickYAxis"}(n||(n={})),function(G){G[G.Cross=0]="Cross",G[G.Circle=1]="Circle",G[G.Square=2]="Square",G[G.Triangle=3]="Triangle",G[G.L1=4]="L1",G[G.R1=5]="R1",G[G.L2=6]="L2",G[G.R2=7]="R2",G[G.Create=8]="Create",G[G.Options=9]="Options",G[G.L3=10]="L3",G[G.R3=11]="R3",G[G.DPadUp=12]="DPadUp",G[G.DPadDown=13]="DPadDown",G[G.DPadLeft=14]="DPadLeft",G[G.DPadRight=15]="DPadRight",G[G.Home=16]="Home",G[G.TouchPad=17]="TouchPad",G[G.LStickXAxis=18]="LStickXAxis",G[G.LStickYAxis=19]="LStickYAxis",G[G.RStickXAxis=20]="RStickXAxis",G[G.RStickYAxis=21]="RStickYAxis"}(D||(D={})),function(G){G[G.A=0]="A",G[G.B=1]="B",G[G.X=2]="X",G[G.Y=3]="Y",G[G.LB=4]="LB",G[G.RB=5]="RB",G[G.LT=6]="LT",G[G.RT=7]="RT",G[G.Back=8]="Back",G[G.Start=9]="Start",G[G.LS=10]="LS",G[G.RS=11]="RS",G[G.DPadUp=12]="DPadUp",G[G.DPadDown=13]="DPadDown",G[G.DPadLeft=14]="DPadLeft",G[G.DPadRight=15]="DPadRight",G[G.Home=16]="Home",G[G.LStickXAxis=17]="LStickXAxis",G[G.LStickYAxis=18]="LStickYAxis",G[G.RStickXAxis=19]="RStickXAxis",G[G.RStickYAxis=20]="RStickYAxis"}(i||(i={})),function(G){G[G.B=0]="B",G[G.A=1]="A",G[G.Y=2]="Y",G[G.X=3]="X",G[G.L=4]="L",G[G.R=5]="R",G[G.ZL=6]="ZL",G[G.ZR=7]="ZR",G[G.Minus=8]="Minus",G[G.Plus=9]="Plus",G[G.LS=10]="LS",G[G.RS=11]="RS",G[G.DPadUp=12]="DPadUp",G[G.DPadDown=13]="DPadDown",G[G.DPadLeft=14]="DPadLeft",G[G.DPadRight=15]="DPadRight",G[G.Home=16]="Home",G[G.Capture=17]="Capture",G[G.LStickXAxis=18]="LStickXAxis",G[G.LStickYAxis=19]="LStickYAxis",G[G.RStickXAxis=20]="RStickXAxis",G[G.RStickYAxis=21]="RStickYAxis"}(e||(e={}));var f=W(11777);class v{static CreateDeviceEvent(G,V,W,J,R,d,k){switch(G){case y.Keyboard:return this._CreateKeyboardEvent(W,J,R,d);case y.Mouse:if(W===u.MouseWheelX||W===u.MouseWheelY||W===u.MouseWheelZ)return this._CreateWheelEvent(G,V,W,J,R,d);case y.Touch:return this._CreatePointerEvent(G,V,W,J,R,d,k);default:throw`Unable to generate event for device ${y[G]}`}}static _CreatePointerEvent(G,V,W,J,R,d,k){const z=this._CreateMouseEvent(G,V,W,J,R,d);G===y.Mouse?(z.deviceType=y.Mouse,z.pointerId=1,z.pointerType="mouse"):(z.deviceType=y.Touch,z.pointerId=k??V,z.pointerType="touch");let X=0;return X+=R.pollInput(G,V,u.LeftClick),X+=2*R.pollInput(G,V,u.RightClick),X+=4*R.pollInput(G,V,u.MiddleClick),z.buttons=X,W===u.Move?z.type="pointermove":W>=u.LeftClick&&W<=u.RightClick&&(z.type=1===J?"pointerdown":"pointerup",z.button=W-2),z}static _CreateWheelEvent(G,V,W,J,R,d){const k=this._CreateMouseEvent(G,V,W,J,R,d);switch(k.pointerId=1,k.type="wheel",k.deltaMode=f.c.DOM_DELTA_PIXEL,k.deltaX=0,k.deltaY=0,k.deltaZ=0,W){case u.MouseWheelX:k.deltaX=J;break;case u.MouseWheelY:k.deltaY=J;break;case u.MouseWheelZ:k.deltaZ=J}return k}static _CreateMouseEvent(G,V,W,J,R,d){const k=this._CreateEvent(d),z=R.pollInput(G,V,u.Horizontal),X=R.pollInput(G,V,u.Vertical);return d?(k.movementX=0,k.movementY=0,k.offsetX=k.movementX-d.getBoundingClientRect().x,k.offsetY=k.movementY-d.getBoundingClientRect().y):(k.movementX=R.pollInput(G,V,10),k.movementY=R.pollInput(G,V,11),k.offsetX=0,k.offsetY=0),this._CheckNonCharacterKeys(k,R),k.clientX=z,k.clientY=X,k.x=z,k.y=X,k.deviceType=G,k.deviceSlot=V,k.inputIndex=W,k}static _CreateKeyboardEvent(G,V,W,J){const R=this._CreateEvent(J);return this._CheckNonCharacterKeys(R,W),R.deviceType=y.Keyboard,R.deviceSlot=0,R.inputIndex=G,R.type=1===V?"keydown":"keyup",R.key=String.fromCharCode(G),R.keyCode=G,R}static _CheckNonCharacterKeys(G,V){const W=V.isDeviceAvailable(y.Keyboard),J=W&&1===V.pollInput(y.Keyboard,0,18),R=W&&1===V.pollInput(y.Keyboard,0,17),d=W&&(1===V.pollInput(y.Keyboard,0,91)||1===V.pollInput(y.Keyboard,0,92)||1===V.pollInput(y.Keyboard,0,93)),k=W&&1===V.pollInput(y.Keyboard,0,16);G.altKey=J,G.ctrlKey=R,G.metaKey=d,G.shiftKey=k}static _CreateEvent(G){const V={preventDefault:()=>{}};return V.target=G,V}}class C{constructor(G,V,W){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(G,V,((G,V,J,R)=>{const d=v.CreateDeviceEvent(G,V,J,R,this);W(G,V,d)})):this._createDummyNativeInput()}pollInput(G,V,W){return this._nativeInput.pollInput(G,V,W)}isDeviceAvailable(G){return G===y.Mouse||G===y.Touch}dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}}const l=Object.keys(u).length/2;class m{constructor(G,V,W,R){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=J.h.IsSafari(),this._usingMacOs=(0,B.i)()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=G=>{},this._keyboardUpEvent=G=>{},this._keyboardBlurEvent=G=>{},this._pointerMoveEvent=G=>{},this._pointerDownEvent=G=>{},this._pointerUpEvent=G=>{},this._pointerCancelEvent=G=>{},this._pointerCancelTouch=G=>{},this._pointerLeaveEvent=G=>{},this._pointerWheelEvent=G=>{},this._pointerBlurEvent=G=>{},this._pointerMacOsChromeOutEvent=G=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=(0,B.i)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=(0,B.i)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=G=>{},this._gamepadDisconnectedEvent=G=>{},this._eventPrefix=J.h.GetPointerPrefix(G),this._engine=G,this._onDeviceConnected=V,this._onDeviceDisconnected=W,this._onInputChanged=R,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOs&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}pollInput(G,V,W){const R=this._inputs[G][V];if(!R)throw`Unable to find device ${y[G]}`;G>=y.DualShock&&G<=y.DualSense&&this._updateDevice(G,V,W);const d=R[W];if(void 0===d)throw`Unable to find input ${W} for device ${y[G]} in slot ${V}`;return W===u.Move&&J.h.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),d}isDeviceAvailable(G){return void 0!==this._inputs[G]}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_enableEvents(){const G=null===this||void 0===this?void 0:this._engine.getInputElement();if(G&&(!this._eventsAttached||this._elementToAttachTo!==G)){if(this._disableEvents(),this._inputs)for(const G of this._inputs)if(G)for(const V in G){const W=G[+V];if(W)for(let G=0;G<W.length;G++)W[G]=0}this._elementToAttachTo=G,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"leave",this._pointerLeaveEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOs&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOsChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_checkForConnectedDevices(){if(navigator.getGamepads){const G=navigator.getGamepads();for(const V of G)V&&this._addGamePad(V)}"function"===typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(y.Mouse,0,0,0)}_addGamePad(G){const V=this._getGamepadDeviceType(G.id),W=G.index;this._gamepads=this._gamepads||new Array(G.index+1),this._registerDevice(V,W,G.buttons.length+G.axes.length),this._gamepads[W]=V}_addPointerDevice(G,V,W,J){this._pointerActive||(this._pointerActive=!0),this._registerDevice(G,V,l);const R=this._inputs[G][V];R[0]=W,R[1]=J}_registerDevice(G,V,W){if(void 0===V)throw`Unable to register device ${y[G]} to undefined slot.`;if(this._inputs[G]||(this._inputs[G]={}),!this._inputs[G][V]){const J=new Array(W);J.fill(0),this._inputs[G][V]=J,this._onDeviceConnected(G,V)}}_unregisterDevice(G,V){this._inputs[G][V]&&(delete this._inputs[G][V],this._onDeviceDisconnected(G,V))}_handleKeyActions(){this._keyboardDownEvent=G=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(y.Keyboard,0,255));const V=this._inputs[y.Keyboard][0];if(V){V[G.keyCode]=1;const W=G;W.inputIndex=G.keyCode,this._usingMacOs&&G.metaKey&&"Meta"!==G.key&&(this._metaKeys.includes(G.keyCode)||this._metaKeys.push(G.keyCode)),this._onInputChanged(y.Keyboard,0,W)}},this._keyboardUpEvent=G=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(y.Keyboard,0,255));const V=this._inputs[y.Keyboard][0];if(V){V[G.keyCode]=0;const W=G;if(W.inputIndex=G.keyCode,this._usingMacOs&&"Meta"===G.key&&this._metaKeys.length>0){for(const G of this._metaKeys){const W=v.CreateDeviceEvent(y.Keyboard,0,G,0,this,this._elementToAttachTo);V[G]=0,this._onInputChanged(y.Keyboard,0,W)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(y.Keyboard,0,W)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const G=this._inputs[y.Keyboard][0];for(let V=0;V<G.length;V++)if(0!==G[V]){G[V]=0;const W=v.CreateDeviceEvent(y.Keyboard,0,V,0,this,this._elementToAttachTo);this._onInputChanged(y.Keyboard,0,W)}this._usingMacOs&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_handlePointerActions(){this._maxTouchPoints=(0,B.i)()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let J=0;J<this._maxTouchPoints;J++)this._activeTouchIds[J]=-1;this._pointerMoveEvent=G=>{const V=this._getPointerType(G);let W=V===y.Mouse?0:this._activeTouchIds.indexOf(G.pointerId);if(V===y.Touch&&-1===W){const R=this._activeTouchIds.indexOf(-1);if(!(R>=0))return void J.h.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);W=R,this._activeTouchIds[R]=G.pointerId,this._onDeviceConnected(V,W)}this._inputs[V]||(this._inputs[V]={}),this._inputs[V][W]||this._addPointerDevice(V,W,G.clientX,G.clientY);const R=this._inputs[V][W];if(R){const J=G;J.inputIndex=u.Move,R[u.Horizontal]=G.clientX,R[u.Vertical]=G.clientY,V===y.Touch&&0===R[u.LeftClick]&&(R[u.LeftClick]=1),void 0===G.pointerId&&(G.pointerId=this._mouseId),this._onInputChanged(V,W,J),this._usingSafari||-1===G.button||(J.inputIndex=G.button+2,R[G.button+2]=R[G.button+2]?0:1,this._onInputChanged(V,W,J))}},this._pointerDownEvent=G=>{const V=this._getPointerType(G);let W=V===y.Mouse?0:G.pointerId;if(V===y.Touch){let V=this._activeTouchIds.indexOf(G.pointerId);if(-1===V&&(V=this._activeTouchIds.indexOf(-1)),!(V>=0))return void J.h.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);W=V,this._activeTouchIds[V]=G.pointerId}this._inputs[V]||(this._inputs[V]={}),this._inputs[V][W]?V===y.Touch&&this._onDeviceConnected(V,W):this._addPointerDevice(V,W,G.clientX,G.clientY);const R=this._inputs[V][W];if(R){const J=R[u.Horizontal],k=R[u.Vertical];if(V===y.Mouse){if(void 0===G.pointerId&&(G.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(d){}}else if(G.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(G.pointerId)}catch(d){}R[u.Horizontal]=G.clientX,R[u.Vertical]=G.clientY,R[G.button+2]=1;const z=G;z.inputIndex=G.button+2,this._onInputChanged(V,W,z),J===G.clientX&&k===G.clientY||(z.inputIndex=u.Move,this._onInputChanged(V,W,z))}},this._pointerUpEvent=G=>{var V;const W=this._getPointerType(G),J=W===y.Mouse?0:this._activeTouchIds.indexOf(G.pointerId);if(W===y.Touch){if(-1===J)return;this._activeTouchIds[J]=-1}const R=null===(V=this._inputs[W])||void 0===V?void 0:V[J];let d=G.button,k=R&&0!==R[d+2];if(!k&&this._isUsingFirefox&&this._usingMacOs&&R&&(d=2===d?0:2,k=0!==R[d+2]),k){var z,X,P,A;const V=R[u.Horizontal],k=R[u.Vertical];R[u.Horizontal]=G.clientX,R[u.Vertical]=G.clientY,R[d+2]=0;const x=G;void 0===G.pointerId&&(G.pointerId=this._mouseId),V===G.clientX&&k===G.clientY||(x.inputIndex=u.Move,this._onInputChanged(W,J,x)),x.inputIndex=d+2,W===y.Mouse&&this._mouseId>=0&&null!==(z=(X=this._elementToAttachTo).hasPointerCapture)&&void 0!==z&&z.call(X,this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):G.pointerId&&null!==(P=(A=this._elementToAttachTo).hasPointerCapture)&&void 0!==P&&P.call(A,G.pointerId)&&this._elementToAttachTo.releasePointerCapture(G.pointerId),this._onInputChanged(W,J,x),W===y.Touch&&this._onDeviceDisconnected(W,J)}},this._pointerCancelTouch=G=>{var V,W;const J=this._activeTouchIds.indexOf(G);if(-1===J)return;null!==(V=(W=this._elementToAttachTo).hasPointerCapture)&&void 0!==V&&V.call(W,G)&&this._elementToAttachTo.releasePointerCapture(G),this._inputs[y.Touch][J][u.LeftClick]=0;const R=v.CreateDeviceEvent(y.Touch,J,u.LeftClick,0,this,this._elementToAttachTo,G);this._onInputChanged(y.Touch,J,R),this._activeTouchIds[J]=-1,this._onDeviceDisconnected(y.Touch,J)},this._pointerCancelEvent=G=>{if("mouse"===G.pointerType){var V,W;const G=this._inputs[y.Mouse][0];this._mouseId>=0&&null!==(V=(W=this._elementToAttachTo).hasPointerCapture)&&void 0!==V&&V.call(W,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let V=u.LeftClick;V<=u.BrowserForward;V++)if(1===G[V]){G[V]=0;const W=v.CreateDeviceEvent(y.Mouse,0,V,0,this,this._elementToAttachTo);this._onInputChanged(y.Mouse,0,W)}}else this._pointerCancelTouch(G.pointerId)},this._pointerLeaveEvent=G=>{"pen"===G.pointerType&&this._pointerCancelTouch(G.pointerId)},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let G=!1;const V=function(){};try{const W=Object.defineProperty({},"passive",{get:function(){G=!0}});this._elementToAttachTo.addEventListener("test",V,W),this._elementToAttachTo.removeEventListener("test",V,W)}catch(W){}this._pointerBlurEvent=()=>{if(this.isDeviceAvailable(y.Mouse)){var G,V;const W=this._inputs[y.Mouse][0];this._mouseId>=0&&null!==(G=(V=this._elementToAttachTo).hasPointerCapture)&&void 0!==G&&G.call(V,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let G=u.LeftClick;G<=u.BrowserForward;G++)if(1===W[G]){W[G]=0;const V=v.CreateDeviceEvent(y.Mouse,0,G,0,this,this._elementToAttachTo);this._onInputChanged(y.Mouse,0,V)}}if(this.isDeviceAvailable(y.Touch)){const G=this._inputs[y.Touch];for(let V=0;V<this._activeTouchIds.length;V++){var W,J,R;const d=this._activeTouchIds[V];if(null!==(W=(J=this._elementToAttachTo).hasPointerCapture)&&void 0!==W&&W.call(J,d)&&this._elementToAttachTo.releasePointerCapture(d),-1!==d&&1===(null===(R=G[V])||void 0===R?void 0:R[u.LeftClick])){G[V][u.LeftClick]=0;const W=v.CreateDeviceEvent(y.Touch,V,u.LeftClick,0,this,this._elementToAttachTo,d);this._onInputChanged(y.Touch,V,W),this._activeTouchIds[V]=-1,this._onDeviceDisconnected(y.Touch,V)}}}},this._pointerWheelEvent=G=>{const V=y.Mouse;this._inputs[V]||(this._inputs[V]=[]),this._inputs[V][0]||(this._pointerActive=!0,this._registerDevice(V,0,l));const W=this._inputs[V][0];if(W){W[u.MouseWheelX]=G.deltaX||0,W[u.MouseWheelY]=G.deltaY||G.wheelDelta||0,W[u.MouseWheelZ]=G.deltaZ||0;const J=G;void 0===G.pointerId&&(G.pointerId=this._mouseId),0!==W[u.MouseWheelX]&&(J.inputIndex=u.MouseWheelX,this._onInputChanged(V,0,J)),0!==W[u.MouseWheelY]&&(J.inputIndex=u.MouseWheelY,this._onInputChanged(V,0,J)),0!==W[u.MouseWheelZ]&&(J.inputIndex=u.MouseWheelZ,this._onInputChanged(V,0,J))}},this._usingMacOs&&this._isUsingChromium&&(this._pointerMacOsChromeOutEvent=G=>{G.buttons>1&&this._pointerCancelEvent(G)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOsChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"leave",this._pointerLeaveEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!G&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((()=>{if(this.isDeviceAvailable(y.Mouse)){const G=this._inputs[y.Mouse][0];G[u.MouseWheelX]=0,G[u.MouseWheelY]=0,G[u.MouseWheelZ]=0}}))}_handleGamepadActions(){this._gamepadConnectedEvent=G=>{this._addGamePad(G.gamepad)},this._gamepadDisconnectedEvent=G=>{if(this._gamepads){const V=this._getGamepadDeviceType(G.gamepad.id),W=G.gamepad.index;this._unregisterDevice(V,W),delete this._gamepads[W]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_updateDevice(G,V,W){const J=navigator.getGamepads()[V];if(J&&G===this._gamepads[V]){const R=this._inputs[G][V];W>=J.buttons.length?R[W]=J.axes[W-J.buttons.length].valueOf():R[W]=J.buttons[W].value}}_getGamepadDeviceType(G){return-1!==G.indexOf("054c")?-1!==G.indexOf("0ce6")?y.DualSense:y.DualShock:-1!==G.indexOf("Xbox One")||-1!==G.search("Xbox 360")||-1!==G.search("xinput")?y.Xbox:-1!==G.indexOf("057e")?y.Switch:y.Generic}_getPointerType(G){let V=y.Mouse;return("touch"===G.pointerType||"pen"===G.pointerType||G.touches)&&(V=y.Touch),V}}class w{constructor(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.deviceType=V,this.deviceSlot=W,this.onInputChangedObservable=new d.b,this._deviceInputSystem=G}getInput(G){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,G)}}class N{constructor(G){this._registeredManagers=new Array,this._refCount=0,this.registerManager=G=>{for(let V=0;V<this._devices.length;V++){const W=this._devices[V];for(const J in W){const W=+J;G._addDevice(new w(this._deviceInputSystem,V,W))}}this._registeredManagers.push(G)},this.unregisterManager=G=>{const V=this._registeredManagers.indexOf(G);V>-1&&this._registeredManagers.splice(V,1)};const V=Object.keys(y).length/2;this._devices=new Array(V);const W=(G,V)=>{this._devices[G]||(this._devices[G]=new Array),this._devices[G][V]||(this._devices[G][V]=V);for(const W of this._registeredManagers){const J=new w(this._deviceInputSystem,G,V);W._addDevice(J)}},J=(G,V)=>{var W;null!==(W=this._devices[G])&&void 0!==W&&W[V]&&delete this._devices[G][V];for(const J of this._registeredManagers)J._removeDevice(G,V)},R=(G,V,W)=>{if(W)for(const J of this._registeredManagers)J._onInputChanged(G,V,W)};"undefined"!==typeof _native?this._deviceInputSystem=new C(W,J,R):this._deviceInputSystem=new m(G,W,J,R)}dispose(){this._deviceInputSystem.dispose()}}class U{getDeviceSource(G,V){if(void 0===V){if(void 0===this._firstDevice[G])return null;V=this._firstDevice[G]}return this._devices[G]&&void 0!==this._devices[G][V]?this._devices[G][V]:null}getDeviceSources(G){return this._devices[G]?this._devices[G].filter((G=>!!G)):[]}constructor(G){const V=Object.keys(y).length/2;this._devices=new Array(V),this._firstDevice=new Array(V),this._engine=G,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new N(G)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new d.b((G=>{for(const V of this._devices)if(V)for(const W of V)W&&this.onDeviceConnectedObservable.notifyObserver(G,W)})),this.onDeviceDisconnectedObservable=new d.b,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=G.Md.add((()=>{this.dispose()}))}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.Md.remove(this._onDisposeObserver)}_addDevice(G){this._devices[G.deviceType]||(this._devices[G.deviceType]=[]),this._devices[G.deviceType][G.deviceSlot]||(this._devices[G.deviceType][G.deviceSlot]=G,this._updateFirstDevices(G.deviceType)),this.onDeviceConnectedObservable.notifyObservers(G)}_removeDevice(G,V){var W,J;const R=null===(W=this._devices[G])||void 0===W?void 0:W[V];this.onDeviceDisconnectedObservable.notifyObservers(R),null!==(J=this._devices[G])&&void 0!==J&&J[V]&&delete this._devices[G][V],this._updateFirstDevices(G)}_onInputChanged(G,V,W){var J,R;null===(J=this._devices[G])||void 0===J||null===(R=J[V])||void 0===R||R.onInputChangedObservable.notifyObservers(W)}_updateFirstDevices(G){switch(G){case y.Keyboard:case y.Mouse:this._firstDevice[G]=0;break;case y.Touch:case y.DualSense:case y.DualShock:case y.Xbox:case y.Switch:case y.Generic:{delete this._firstDevice[G];const V=this._devices[G];if(V)for(let W=0;W<V.length;W++)if(V[W]){this._firstDevice[G]=W;break}break}}}}var a=W(11781);class M{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get oW(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(G){this._singleClick=G}set oW(G){this._doubleClick=G}set hasSwiped(G){this._hasSwiped=G}set ignore(G){this._ignore=G}}class T{constructor(G){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._activePointerIds=new Array,this._activePointerIdsCount=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new P.k(0,0),this._previousStartingPointerPosition=new P.k(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=G||S.c.LastCreatedScene,this._scene}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(G){return this._meshUnderPointerId[G]||null}get unTranslatedPointer(){return new P.k(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(G){this._pointerX=G}get pointerY(){return this._pointerY}set pointerY(G){this._pointerY=G}_updatePointerPosition(G){const V=this._scene.getEngine().getInputElementClientRect();V&&(this._pointerX=G.clientX-V.left,this._pointerY=G.clientY-V.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(G,V){const W=this._scene,J=W.getEngine(),R=J.getInputElement();R&&(R.tabIndex=J.canvasTabIndex,W.doNotHandleCursors||(R.style.cursor=W.defaultCursor)),this._setCursorAndPointerOverMesh(G,V,W);for(const X of W._pointerMoveStage){var d;const W=!(null===(d=G=G||this._pickMove(V))||void 0===d||!d.pickedMesh);G=X.action(this._unTranslatedPointerX,this._unTranslatedPointerY,G,W,R)}const k=V.inputIndex>=u.MouseWheelX&&V.inputIndex<=u.MouseWheelZ?b.c.POINTERWHEEL:b.c.POINTERMOVE;let z;W.onPointerMove&&(G=G||this._pickMove(V),W.onPointerMove(V,G,k)),G?(z=new b.k(k,V,G),this._setRayOnPointerInfo(G,V)):(z=new b.k(k,V,null,this),this._movePointerInfo=z),W.onPointerObservable.hasObservers()&&W.onPointerObservable.notifyObservers(z,k)}_setRayOnPointerInfo(G,V){const W=this._scene;G&&a.d._IsPickingAvailable&&(G.ray||(G.ray=W.createPickingRay(V.offsetX,V.offsetY,P.c.Identity(),W.activeCamera)))}_addCameraPointerObserver(G,V){return this._cameraObserverCount++,this._scene.onPointerObservable.add(G,V)}_removeCameraPointerObserver(G){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(G)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(G,V,W){const J=this._scene,R=new b.g(W,V,this._unTranslatedPointerX,this._unTranslatedPointerY);return G&&(R.originalPickingInfo=G,R.ray=G.ray,"xr-near"===V.pointerType&&G.originMesh&&(R.nearInteractionPickingInfo=G)),J.onPrePointerObservable.notifyObservers(R,W),!!R.skipOnPointerObservable}_pickMove(G){const V=this._scene,W=V.kW(this._unTranslatedPointerX,this._unTranslatedPointerY,V.pointerMovePredicate,V.pointerMoveFastCheck,V.cameraToUseForPointers,V.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(W,G,V),W}_setCursorAndPointerOverMesh(G,V,W){const J=W.getEngine().getInputElement();if(null!==G&&void 0!==G&&G.pickedMesh){if(this.setPointerOverMesh(G.pickedMesh,V.pointerId,G,V),!W.doNotHandleCursors&&J&&this._pointerOverMesh){const G=this._pointerOverMesh._getActionManagerForTrigger();G&&G.hasPointerTriggers&&(J.style.cursor=G.hoverCursor||W.hoverCursor)}}else this.setPointerOverMesh(null,V.pointerId,G,V)}simulatePointerMove(G,V){const W=new PointerEvent("pointermove",V);W.inputIndex=u.Move,this._checkPrePointerObservable(G,W,b.c.POINTERMOVE)||this._processPointerMove(G,W)}simulatePointerDown(G,V){const W=new PointerEvent("pointerdown",V);W.inputIndex=W.button+2,this._checkPrePointerObservable(G,W,b.c.POINTERDOWN)||this._processPointerDown(G,W)}_processPointerDown(G,V){var W;const J=this._scene;if(null!==(W=G)&&void 0!==W&&W.pickedMesh){this._pickedDownMesh=G.pickedMesh;const W=G.pickedMesh._getActionManagerForTrigger();if(W){if(W.hasPickTriggers)switch(W.processTrigger(5,new L(G.pickedMesh,J.pointerX,J.pointerY,G.pickedMesh,V,G)),V.button){case 0:W.processTrigger(2,new L(G.pickedMesh,J.pointerX,J.pointerY,G.pickedMesh,V,G));break;case 1:W.processTrigger(4,new L(G.pickedMesh,J.pointerX,J.pointerY,G.pickedMesh,V,G));break;case 2:W.processTrigger(3,new L(G.pickedMesh,J.pointerX,J.pointerY,G.pickedMesh,V,G))}W.hasSpecificTrigger(8)&&window.setTimeout((()=>{const G=J.kW(this._unTranslatedPointerX,this._unTranslatedPointerY,(G=>G.bX&&G.isVisible&&G.isReady()&&G.actionManager&&G.actionManager.hasSpecificTrigger(8)&&G===this._pickedDownMesh),!1,J.cameraToUseForPointers);null!==G&&void 0!==G&&G.pickedMesh&&W&&0!==this._activePointerIdsCount&&Date.now()-this._startingPointerTime>T.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,W.processTrigger(8,L.CreateNew(G.pickedMesh,V)))}),T.LongPressDelay)}}else for(const k of J._pointerDownStage)G=k.action(this._unTranslatedPointerX,this._unTranslatedPointerY,G,V,!1);let R;const d=b.c.POINTERDOWN;G?(J.onPointerDown&&J.onPointerDown(V,G,d),R=new b.k(d,V,G),this._setRayOnPointerInfo(G,V)):R=new b.k(d,V,null,this),J.onPointerObservable.hasObservers()&&J.onPointerObservable.notifyObservers(R,d)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(G,V,W){const J=new PointerEvent("pointerup",V);J.inputIndex=u.Move;const R=new M;W?R.oW=!0:R.singleClick=!0,this._checkPrePointerObservable(G,J,b.c.POINTERUP)||this._processPointerUp(G,J,R)}_processPointerUp(G,V,W){var J;const R=this._scene;if(null!==(J=G)&&void 0!==J&&J.pickedMesh){if(this._pickedUpMesh=G.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(R.onPointerPick&&R.onPointerPick(V,G),W.singleClick&&!W.ignore&&R.onPointerObservable.observers.length>this._cameraObserverCount)){const W=b.c.POINTERPICK,J=new b.k(W,V,G);this._setRayOnPointerInfo(G,V),R.onPointerObservable.notifyObservers(J,W)}const J=G.pickedMesh._getActionManagerForTrigger();if(J&&!W.ignore){J.processTrigger(7,L.CreateNew(G.pickedMesh,V,G)),!W.hasSwiped&&W.singleClick&&J.processTrigger(1,L.CreateNew(G.pickedMesh,V,G));const R=G.pickedMesh._getActionManagerForTrigger(6);W.oW&&R&&R.processTrigger(6,L.CreateNew(G.pickedMesh,V,G))}}else if(!W.ignore)for(const d of R._pointerUpStage)G=d.action(this._unTranslatedPointerX,this._unTranslatedPointerY,G,V,W.oW);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const G=this._pickedDownMesh._getActionManagerForTrigger(16);G&&G.processTrigger(16,L.CreateNew(this._pickedDownMesh,V))}if(!W.ignore){const J=new b.k(b.c.POINTERUP,V,G);if(this._setRayOnPointerInfo(G,V),R.onPointerObservable.notifyObservers(J,b.c.POINTERUP),R.onPointerUp&&R.onPointerUp(V,G,b.c.POINTERUP),!W.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let J=0;if(W.singleClick?J=b.c.POINTERTAP:W.oW&&(J=b.c.POINTERDOUBLETAP),J){const W=new b.k(J,V,G);R.onPointerObservable.hasObservers()&&R.onPointerObservable.hasSpecificMask(J)&&R.onPointerObservable.notifyObservers(W,J)}}}}isPointerCaptured(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._pointerCaptures[G]}attachControl(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const R=this._scene,d=R.getEngine();J||(J=d.getInputElement()),this._alreadyAttached&&this.zx(),J&&(this._alreadyAttachedTo=J),this._deviceSourceManager=new U(d),this._initActionManager=G=>{if(!this._meshPickProceed){const V=R.skipPointerUpPicking||0===R._registeredActions&&!this._checkForPicking()&&!R.onPointerUp?null:R.kW(this._unTranslatedPointerX,this._unTranslatedPointerY,R.pointerUpPredicate,R.pointerUpFastCheck,R.cameraToUseForPointers,R.pointerUpTrianglePredicate);this._currentPickResult=V,V&&(G=V.hit&&V.pickedMesh?V.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return G},this._delayedSimpleClick=(G,V,W)=>{if((Date.now()-this._previousStartingPointerTime>T.DoubleClickDelay&&!this._doubleClickOccured||G!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,V.singleClick=!0,V.ignore=!1,this._delayedClicks[G])){const V=this._delayedClicks[G].evt,W=b.c.POINTERTAP,J=new b.k(W,V,this._currentPickResult);R.onPointerObservable.hasObservers()&&R.onPointerObservable.hasSpecificMask(W)&&R.onPointerObservable.notifyObservers(J,W),this._delayedClicks[G]=null}},this._initClickEvent=(G,V,W,J)=>{const R=new M;this._currentPickResult=null;let d=null,k=G.hasSpecificMask(b.c.POINTERPICK)||V.hasSpecificMask(b.c.POINTERPICK)||G.hasSpecificMask(b.c.POINTERTAP)||V.hasSpecificMask(b.c.POINTERTAP)||G.hasSpecificMask(b.c.POINTERDOUBLETAP)||V.hasSpecificMask(b.c.POINTERDOUBLETAP);!k&&r&&(d=this._initActionManager(d,R),d&&(k=d.hasPickTriggers));let z=!1;if(k=k&&!this._isMultiTouchGesture,k){const k=W.button;if(R.hasSwiped=this._isPointerSwiping(),!R.hasSwiped){let A=!T.ExclusiveDoubleClickMode;if(A||(A=!G.hasSpecificMask(b.c.POINTERDOUBLETAP)&&!V.hasSpecificMask(b.c.POINTERDOUBLETAP),A&&!r.HasSpecificTrigger(6)&&(d=this._initActionManager(d,R),d&&(A=!d.hasSpecificTrigger(6)))),A)(Date.now()-this._previousStartingPointerTime>T.DoubleClickDelay||k!==this._previousButtonPressed)&&(R.singleClick=!0,J(R,this._currentPickResult),z=!0);else{const G={evt:W,clickInfo:R,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,k,R,J),T.DoubleClickDelay)};this._delayedClicks[k]=G}let x=G.hasSpecificMask(b.c.POINTERDOUBLETAP)||V.hasSpecificMask(b.c.POINTERDOUBLETAP);if(!x&&r.HasSpecificTrigger(6)&&(d=this._initActionManager(d,R),d&&(x=d.hasSpecificTrigger(6))),x)if(k===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<T.DoubleClickDelay&&!this._doubleClickOccured){if(R.hasSwiped||this._isPointerSwiping())if(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=k,T.ExclusiveDoubleClickMode){var X;if(this._delayedClicks[k])clearTimeout(null===(X=this._delayedClicks[k])||void 0===X?void 0:X.timeoutId),this._delayedClicks[k]=null;J(R,this._previousPickResult)}else J(R,this._currentPickResult);else{var P;if(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,R.oW=!0,R.ignore=!1,T.ExclusiveDoubleClickMode&&this._delayedClicks[k])clearTimeout(null===(P=this._delayedClicks[k])||void 0===P?void 0:P.timeoutId),this._delayedClicks[k]=null;J(R,this._currentPickResult)}z=!0}else this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=k}}z||J(R,this._currentPickResult)},this._onPointerMove=G=>{if(this._updatePointerPosition(G),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>T.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>T.DragMovementThreshold),d.isPointerLock&&d._verifyPointerLock(),this._checkPrePointerObservable(null,G,G.inputIndex>=u.MouseWheelX&&G.inputIndex<=u.MouseWheelZ?b.c.POINTERWHEEL:b.c.POINTERMOVE))return;if(!R.cameraToUseForPointers&&!R.activeCamera)return;if(R.tx)return void this._processPointerMove(new q.d,G);R.pointerMovePredicate||(R.pointerMovePredicate=G=>G.bX&&G.isVisible&&G.isReady()&&G.isEnabled()&&(G.enablePointerMoveEvents||R.constantlyUpdateMeshUnderPointer||null!==G._getActionManagerForTrigger())&&(!R.cameraToUseForPointers||0!==(R.cameraToUseForPointers.layerMask&G.layerMask)));const V=R._registeredActions>0||R.constantlyUpdateMeshUnderPointer?this._pickMove(G):null;this._processPointerMove(V,G)},this._onPointerDown=G=>{const V=this._activePointerIds.indexOf(-1);if(-1===V?this._activePointerIds.push(G.pointerId):this._activePointerIds[V]=G.pointerId,this._activePointerIdsCount++,this._pickedDownMesh=null,this._meshPickProceed=!1,T.ExclusiveDoubleClickMode)for(let J=0;J<this._delayedClicks.length;J++)if(this._delayedClicks[J])if(G.button===J){var W;clearTimeout(null===(W=this._delayedClicks[J])||void 0===W?void 0:W.timeoutId)}else{const G=this._delayedClicks[J].clickInfo;this._doubleClickOccured=!1,G.singleClick=!0,G.ignore=!1;const V=this._delayedClicks[J].evt,W=b.c.POINTERTAP,d=new b.k(W,V,this._currentPickResult);R.onPointerObservable.hasObservers()&&R.onPointerObservable.hasSpecificMask(W)&&R.onPointerObservable.notifyObservers(d,W),this._delayedClicks[J]=null}if(this._updatePointerPosition(G),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=G.button),R.preventDefaultOnPointerDown&&J&&(G.preventDefault(),J.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,G,b.c.POINTERDOWN))return;if(!R.cameraToUseForPointers&&!R.activeCamera)return;let d;this._pointerCaptures[G.pointerId]=!0,R.pointerDownPredicate||(R.pointerDownPredicate=G=>G.bX&&G.isVisible&&G.isReady()&&G.isEnabled()&&(!R.cameraToUseForPointers||0!==(R.cameraToUseForPointers.layerMask&G.layerMask))),this._pickedDownMesh=null,d=R.skipPointerDownPicking||0===R._registeredActions&&!this._checkForPicking()&&!R.onPointerDown?new q.d:R.kW(this._unTranslatedPointerX,this._unTranslatedPointerY,R.pointerDownPredicate,R.pointerDownFastCheck,R.cameraToUseForPointers,R.pointerDownTrianglePredicate),this._processPointerDown(d,G)},this._onPointerUp=G=>{const V=this._activePointerIds.indexOf(G.pointerId);-1!==V&&(this._activePointerIds[V]=-1,this._activePointerIdsCount--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(G),R.preventDefaultOnPointerUp&&J&&(G.preventDefault(),J.focus()),this._initClickEvent(R.onPrePointerObservable,R.onPointerObservable,G,((V,W)=>{if(R.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!V.ignore)){if(this._checkPrePointerObservable(null,G,b.c.POINTERUP))return this._swipeButtonPressed===G.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),void(0===G.buttons&&(this._pointerCaptures[G.pointerId]=!1));V.hasSwiped||(V.singleClick&&R.onPrePointerObservable.hasSpecificMask(b.c.POINTERTAP)&&this._checkPrePointerObservable(null,G,b.c.POINTERTAP)&&(this._skipPointerTap=!0),V.oW&&R.onPrePointerObservable.hasSpecificMask(b.c.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,G,b.c.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}this._pointerCaptures[G.pointerId]?(0===G.buttons&&(this._pointerCaptures[G.pointerId]=!1),(R.cameraToUseForPointers||R.activeCamera)&&(R.pointerUpPredicate||(R.pointerUpPredicate=G=>G.bX&&G.isVisible&&G.isReady()&&G.isEnabled()&&(!R.cameraToUseForPointers||0!==(R.cameraToUseForPointers.layerMask&G.layerMask))),!this._meshPickProceed&&(r&&r.HasTriggers||this._checkForPicking()||R.onPointerUp)&&this._initActionManager(null,V),W||(W=this._currentPickResult),this._processPointerUp(W,G,V),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===G.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))):this._swipeButtonPressed===G.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1)})))},this._onKeyDown=G=>{const V=F.e.KEYDOWN;if(R.onPreKeyboardObservable.hasObservers()){const W=new F.i(V,G);if(R.onPreKeyboardObservable.notifyObservers(W,V),W.skipOnKeyboardObservable)return}if(R.onKeyboardObservable.hasObservers()){const W=new F.k(V,G);R.onKeyboardObservable.notifyObservers(W,V)}R.actionManager&&R.actionManager.processTrigger(14,L.CreateNewFromScene(R,G))},this._onKeyUp=G=>{const V=F.e.KEYUP;if(R.onPreKeyboardObservable.hasObservers()){const W=new F.i(V,G);if(R.onPreKeyboardObservable.notifyObservers(W,V),W.skipOnKeyboardObservable)return}if(R.onKeyboardObservable.hasObservers()){const W=new F.k(V,G);R.onKeyboardObservable.notifyObservers(W,V)}R.actionManager&&R.actionManager.processTrigger(15,L.CreateNewFromScene(R,G))},this._deviceSourceManager.onDeviceConnectedObservable.add((J=>{J.deviceType===y.Mouse?J.onInputChangedObservable.add((R=>{this._originMouseEvent=R,R.inputIndex===u.LeftClick||R.inputIndex===u.MiddleClick||R.inputIndex===u.RightClick||R.inputIndex===u.BrowserBack||R.inputIndex===u.BrowserForward?V&&1===J.getInput(R.inputIndex)?this._onPointerDown(R):G&&0===J.getInput(R.inputIndex)&&this._onPointerUp(R):W&&(R.inputIndex===u.Move?this._onPointerMove(R):R.inputIndex!==u.MouseWheelX&&R.inputIndex!==u.MouseWheelY&&R.inputIndex!==u.MouseWheelZ||this._onPointerMove(R))})):J.deviceType===y.Touch?J.onInputChangedObservable.add((R=>{R.inputIndex===u.LeftClick&&(V&&1===J.getInput(R.inputIndex)?(this._onPointerDown(R),this._activePointerIdsCount>1&&(this._isMultiTouchGesture=!0)):G&&0===J.getInput(R.inputIndex)&&(this._onPointerUp(R),0===this._activePointerIdsCount&&(this._isMultiTouchGesture=!1))),W&&R.inputIndex===u.Move&&this._onPointerMove(R)})):J.deviceType===y.Keyboard&&J.onInputChangedObservable.add((G=>{"keydown"===G.type?this._onKeyDown(G):"keyup"===G.type&&this._onKeyUp(G)}))})),this._alreadyAttached=!0}zx(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0,J=arguments.length>3?arguments[3]:void 0;if(this._meshUnderPointerId[V]===G&&(!G||!G._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const R=this._meshUnderPointerId[V];let d;R&&(d=R._getActionManagerForTrigger(10),d&&d.processTrigger(10,new L(R,this._pointerX,this._pointerY,G,J,{pointerId:V}))),G?(this._meshUnderPointerId[V]=G,this._pointerOverMesh=G,d=G._getActionManagerForTrigger(9),d&&d.processTrigger(9,new L(G,this._pointerX,this._pointerY,G,J,{pointerId:V,pickResult:W}))):(delete this._meshUnderPointerId[V],this._pointerOverMesh=null),this._scene.onMeshUnderPointerUpdatedObservable.hasObservers()&&this._scene.onMeshUnderPointerUpdatedObservable.notifyObservers({mesh:G,pointerId:V})}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(G){this._pointerOverMesh===G&&(this._pointerOverMesh=null),this._pickedDownMesh===G&&(this._pickedDownMesh=null),this._pickedUpMesh===G&&(this._pickedUpMesh=null);for(const V in this._meshUnderPointerId)this._meshUnderPointerId[V]===G&&delete this._meshUnderPointerId[V]}}T.DragMovementThreshold=10,T.LongPressDelay=500,T.DoubleClickDelay=300,T.ExclusiveDoubleClickMode=!1;var K=W(11654),s=W(11424),Q=W(11532),Z=W(11789),E=W(11227),h=W(11440),o=W(11152);class c{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.tx=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}var j,I=W(11201),O=W(11159);!function(G){G[G.BackwardCompatible=0]="BackwardCompatible",G[G.Intermediate=1]="Intermediate",G[G.Aggressive=2]="Aggressive"}(j||(j={}));class GG{static DefaultMaterialFactory(G){throw(0,p.e)("Az")}static CollisionCoordinatorFactory(){throw(0,p.e)("DefaultCollisionCoordinator")}get clearColor(){return this._clearColor}set clearColor(G){G!==this._clearColor&&(this._clearColor=G,this.onClearColorChangedObservable.notifyObservers(this._clearColor))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get performancePriority(){return this._performancePriority}set performancePriority(G){if(G!==this._performancePriority){switch(this._performancePriority=G,G){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.tx=!1,this.Xx=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.tx=!0,this.Xx=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.tx=!0,this.Xx=!1}this.onScenePerformancePriorityChangedObservable.notifyObservers(G)}}set forceWireframe(G){this._forceWireframe!==G&&(this._forceWireframe=G,this.markAllMaterialsAsDirty(16))}get forceWireframe(){return this._forceWireframe}set skipFrustumClipping(G){this._skipFrustumClipping!==G&&(this._skipFrustumClipping=G)}get skipFrustumClipping(){return this._skipFrustumClipping}set forcePointsCloud(G){this._forcePointsCloud!==G&&(this._forcePointsCloud=G,this.markAllMaterialsAsDirty(16))}get forcePointsCloud(){return this._forcePointsCloud}get environmentTexture(){return this._environmentTexture}set environmentTexture(G){this._environmentTexture!==G&&(this._environmentTexture=G,this.onEnvironmentTextureChangedObservable.notifyObservers(G),this.markAllMaterialsAsDirty(1))}getNodes(){let G=[];G=G.concat(this.meshes),G=G.concat(this.lights),G=G.concat(this.cameras),G=G.concat(this.transformNodes);for(const V of this.skeletons)G=G.concat(V.bones);return G}get animationPropertiesOverride(){return this._animationPropertiesOverride}set animationPropertiesOverride(G){this._animationPropertiesOverride=G}set onDispose(G){this._onDisposeObserver&&this.Md.remove(this._onDisposeObserver),this._onDisposeObserver=this.Md.add(G)}set beforeRender(G){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),G&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(G))}set afterRender(G){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),G&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(G))}set beforeCameraRender(G){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(G)}set afterCameraRender(G){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(G)}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}set pointerDownPredicate(G){this._pointerPickingConfiguration.pointerDownPredicate=G}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}set pointerUpPredicate(G){this._pointerPickingConfiguration.pointerUpPredicate=G}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}set pointerMovePredicate(G){this._pointerPickingConfiguration.pointerMovePredicate=G}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}set pointerDownFastCheck(G){this._pointerPickingConfiguration.pointerDownFastCheck=G}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}set pointerUpFastCheck(G){this._pointerPickingConfiguration.pointerUpFastCheck=G}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}set pointerMoveFastCheck(G){this._pointerPickingConfiguration.pointerMoveFastCheck=G}get tx(){return this._pointerPickingConfiguration.tx}set tx(G){this._pointerPickingConfiguration.tx=G}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}set skipPointerDownPicking(G){this._pointerPickingConfiguration.skipPointerDownPicking=G}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}set skipPointerUpPicking(G){this._pointerPickingConfiguration.skipPointerUpPicking=G}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}static get DragMovementThreshold(){return T.DragMovementThreshold}static set DragMovementThreshold(G){T.DragMovementThreshold=G}static get LongPressDelay(){return T.LongPressDelay}static set LongPressDelay(G){T.LongPressDelay=G}static get DoubleClickDelay(){return T.DoubleClickDelay}static set DoubleClickDelay(G){T.DoubleClickDelay=G}static get ExclusiveDoubleClickMode(){return T.ExclusiveDoubleClickMode}static set ExclusiveDoubleClickMode(G){T.ExclusiveDoubleClickMode=G}bindEyePosition(G){var V;let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vEyePosition",J=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const R=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:(null===(V=this.activeCamera)||void 0===V?void 0:V.globalPosition)??P.o.ZeroReadOnly,d=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return P.h.Vector4[0].set(R.x,R.y,R.z,d?-1:1),G&&(J?G.setFloat3(W,P.h.Vector4[0].x,P.h.Vector4[0].y,P.h.Vector4[0].z):G.setVector4(W,P.h.Vector4[0])),P.h.Vector4[0]}finalizeSceneUbo(){const G=this.getSceneUniformBuffer(),V=this.bindEyePosition(null);return G.updateFloat4("vEyePosition",V.x,V.y,V.z,V.w),G.update(),G}set useRightHandedSystem(G){this._useRightHandedSystem!==G&&(this._useRightHandedSystem=G,this.markAllMaterialsAsDirty(16))}get useRightHandedSystem(){return this._useRightHandedSystem}setStepId(G){this._currentStepId=G}getStepId(){return this._currentStepId}getInternalStep(){return this._currentInternalStep}set fogEnabled(G){this._fogEnabled!==G&&(this._fogEnabled=G,this.markAllMaterialsAsDirty(16))}get fogEnabled(){return this._fogEnabled}set fogMode(G){this._fogMode!==G&&(this._fogMode=G,this.markAllMaterialsAsDirty(16))}get fogMode(){return this._fogMode}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set shadowsEnabled(G){this._shadowsEnabled!==G&&(this._shadowsEnabled=G,this.markAllMaterialsAsDirty(2))}get shadowsEnabled(){return this._shadowsEnabled}set lightsEnabled(G){this._lightsEnabled!==G&&(this._lightsEnabled=G,this.markAllMaterialsAsDirty(2))}get lightsEnabled(){return this._lightsEnabled}get activeCameras(){return this._activeCameras}set activeCameras(G){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),G&&(this._unObserveActiveCameras=(0,o.f)(G,(()=>{this.onActiveCamerasChanged.notifyObservers(this)}))),this._activeCameras=G}get activeCamera(){return this._activeCamera}set activeCamera(G){G!==this._activeCamera&&(this._activeCamera=G,this.onActiveCameraChanged.notifyObservers(this))}get _hasDefaultMaterial(){return GG.DefaultMaterialFactory!==GG._OriginalDefaultMaterialFactory}get defaultMaterial(){return this.mA||(this.mA=GG.DefaultMaterialFactory(this)),this.mA}set defaultMaterial(G){this.mA=G}set texturesEnabled(G){this._texturesEnabled!==G&&(this._texturesEnabled=G,this.markAllMaterialsAsDirty(1))}get texturesEnabled(){return this._texturesEnabled}get frameGraph(){return this._frameGraph}set frameGraph(G){if(this._frameGraph)return this._frameGraph=G,void(G||(this.customRenderFunction=this._currentCustomRenderFunction));this._frameGraph=G,G&&(this._currentCustomRenderFunction=this.customRenderFunction,this.customRenderFunction=this._renderWithFrameGraph,this.activeCamera=null)}set skeletonsEnabled(G){this._skeletonsEnabled!==G&&(this._skeletonsEnabled=G,this.markAllMaterialsAsDirty(8))}get skeletonsEnabled(){return this._skeletonsEnabled}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=GG.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get renderingManager(){return this._renderingManager}get frustumPlanes(){return this._frustumPlanes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const G of this._transientComponents)G.register();this._transientComponents.length=0}}o(G){this._components.push(G),this._transientComponents.push(G);const V=G;V.addFromContainer&&V.serialize&&this._serializableComponents.push(V)}_getComponent(G){for(const V of this._components)if(V.name===G)return V;return null}get uniqueId(){return this._uniqueId}constructor(G,V){this._inputManager=new T(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.Xx=!0,this.autoClearDepthAndStencil=!0,this._clearColor=new s.h(.2,.2,.3,1),this.onClearColorChangedObservable=new d.b,this.ambientColor=new s.d(0,0,0),this.environmentIntensity=1,this.iblIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new d.b,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.mx=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.effectLayers=[],this.Sq=null,this.layers=[],this.lensFlareSystems=[],this.proceduralTextures=[],this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.Md=new d.b,this._onDisposeObserver=null,this.onBeforeRenderObservable=new d.b,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new d.b,this.onAfterRenderCameraObservable=new d.b,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new d.b,this.onAfterAnimationsObservable=new d.b,this.onBeforeDrawPhaseObservable=new d.b,this.onAfterDrawPhaseObservable=new d.b,this.onReadyObservable=new d.b,this.onBeforeCameraRenderObservable=new d.b,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new d.b,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new d.b,this.onAfterActiveMeshesEvaluationObservable=new d.b,this.onBeforeParticlesRenderingObservable=new d.b,this.onAfterParticlesRenderingObservable=new d.b,this.onDataLoadedObservable=new d.b,this.onNewCameraAddedObservable=new d.b,this.onCameraRemovedObservable=new d.b,this.onNewLightAddedObservable=new d.b,this.onLightRemovedObservable=new d.b,this.onNewGeometryAddedObservable=new d.b,this.onGeometryRemovedObservable=new d.b,this.onNewTransformNodeAddedObservable=new d.b,this.onTransformNodeRemovedObservable=new d.b,this.onNewMeshAddedObservable=new d.b,this.onMeshRemovedObservable=new d.b,this.onNewSkeletonAddedObservable=new d.b,this.onSkeletonRemovedObservable=new d.b,this.onNewMaterialAddedObservable=new d.b,this.onNewMultiMaterialAddedObservable=new d.b,this.onMaterialRemovedObservable=new d.b,this.onMultiMaterialRemovedObservable=new d.b,this.onNewTextureAddedObservable=new d.b,this.onTextureRemovedObservable=new d.b,this.onBeforeRenderTargetsRenderObservable=new d.b,this.onAfterRenderTargetsRenderObservable=new d.b,this.onBeforeStepObservable=new d.b,this.onAfterStepObservable=new d.b,this.onActiveCameraChanged=new d.b,this.onActiveCamerasChanged=new d.b,this.onBeforeRenderingGroupObservable=new d.b,this.onAfterRenderingGroupObservable=new d.b,this.onMeshImportedObservable=new d.b,this.onAnimationFileImportedObservable=new d.b,this.onEnvironmentTextureChangedObservable=new d.b,this.onMeshUnderPointerUpdatedObservable=new d.b,this._registeredForLateAnimationBindings=new k.c(256),this._pointerPickingConfiguration=new c,this.onPrePointerObservable=new d.b,this.onPointerObservable=new d.b,this.onPreKeyboardObservable=new d.b,this.onKeyboardObservable=new d.b,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=GG.FOGMODE_NONE,this.fogColor=new s.d(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this._frameGraph=null,this.frameGraphs=[],this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new P.o(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new k.c(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new K.c,this._activeIndices=new K.c,this._activeParticles=new K.c,this._activeBones=new K.c,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=[],this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new k.f(256),this._processedMaterials=new k.f(256),this._renderTargets=new k.c(256),this._materialsRenderTargets=new k.c(256),this._activeParticleSystems=new k.f(256),this._activeSkeletons=new k.c(32),this._softwareSkinnedMeshes=new k.c(32),this._activeAnimatables=new Array,this._transformMatrix=P.c.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=g.e.Create(),this._beforeClearStage=g.e.Create(),this._beforeRenderTargetClearStage=g.e.Create(),this._gatherRenderTargetsStage=g.e.Create(),this._gatherActiveCameraRenderTargetsStage=g.e.Create(),this._isReadyForMeshStage=g.e.Create(),this._beforeEvaluateActiveMeshStage=g.e.Create(),this._evaluateSubMeshStage=g.e.Create(),this._preActiveMeshStage=g.e.Create(),this._cameraDrawRenderTargetStage=g.e.Create(),this._beforeCameraDrawStage=g.e.Create(),this._beforeRenderTargetDrawStage=g.e.Create(),this._beforeRenderingGroupDrawStage=g.e.Create(),this._beforeRenderingMeshStage=g.e.Create(),this._afterRenderingMeshStage=g.e.Create(),this._afterRenderingGroupDrawStage=g.e.Create(),this._afterCameraDrawStage=g.e.Create(),this._afterCameraPostProcessStage=g.e.Create(),this._afterRenderTargetDrawStage=g.e.Create(),this._afterRenderTargetPostProcessStage=g.e.Create(),this._afterRenderStage=g.e.Create(),this._pointerMoveStage=g.e.Create(),this._pointerDownStage=g.e.Create(),this._pointerUpStage=g.e.Create(),this._geometriesByUniqueId=null,this._uniqueId=0,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._useCurrentFrameBuffer=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[],this._uniqueId=this.getUniqueId();const W={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...V};G=this._engine=G||S.c.LastCreatedEngine,W.virtual?G._virtualScenes.push(this):(S.c._LastCreatedScene=this,G.scenes.push(this)),this._uid=null,this._renderingManager=new Y.e(this),t.d&&(this.postProcessManager=new t.d(this)),(0,B.m)()&&this.attachControl(),this._createUbo(),A.e&&(this._imageProcessingConfiguration=new A.e),this.setDefaultCandidateProviders(),W.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=W.useMaterialMeshMap,this.useClonedMeshMap=W.useClonedMeshMap,V&&V.virtual||G.onNewSceneAddedObservable.notifyObservers(this)}getClassName(){return"Scene"}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_getDefaultSubMeshCandidates(G){return this._defaultSubMeshCandidates.data=G.Ed,this._defaultSubMeshCandidates.length=G.Ed.length,this._defaultSubMeshCandidates}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=G=>this._getDefaultSubMeshCandidates(G),this.getIntersectingSubMeshCandidates=(G,V)=>this._getDefaultSubMeshCandidates(G),this.getCollidingSubMeshCandidates=(G,V)=>this._getDefaultSubMeshCandidates(G)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}get pointerX(){return this._inputManager.pointerX}set pointerX(G){this._inputManager.pointerX=G}get pointerY(){return this._inputManager.pointerY}set pointerY(G){this._inputManager.pointerY=G}getCachedMaterial(){return this._cachedMaterial}getCachedEffect(){return this._cachedEffect}getCachedVisibility(){return this._cachedVisibility}isCachedMaterialInvalid(G,V){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this._cachedEffect!==V||this._cachedMaterial!==G||this._cachedVisibility!==W}getEngine(){return this._engine}getTotalVertices(){return this._totalVertices.current}get totalVerticesPerfCounter(){return this._totalVertices}getActiveIndices(){return this._activeIndices.current}get totalActiveIndicesPerfCounter(){return this._activeIndices}getActiveParticles(){return this._activeParticles.current}get activeParticlesPerfCounter(){return this._activeParticles}getActiveBones(){return this._activeBones.current}get activeBonesPerfCounter(){return this._activeBones}getActiveMeshes(){return this._activeMeshes}getAnimationRatio(){return void 0!==this._animationRatio?this._animationRatio:1}getRenderId(){return this._renderId}getFrameId(){return this._frameId}incrementRenderId(){this._renderId++}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}simulatePointerMove(G,V){return this._inputManager.simulatePointerMove(G,V),this}simulatePointerDown(G,V){return this._inputManager.simulatePointerDown(G,V),this}simulatePointerUp(G,V,W){return this._inputManager.simulatePointerUp(G,V,W),this}isPointerCaptured(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._inputManager.isPointerCaptured(G)}attachControl(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._inputManager.attachControl(G,V,W)}zx(){this._inputManager.zx()}isReady(){var G,V;let W,J=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._isDisposed)return!1;const R=this.getEngine(),d=R.currentRenderPassId;R.currentRenderPassId=(null===(G=this.activeCamera)||void 0===G?void 0:G.renderPassId)??d;let k=!0;for(this._pendingData.length>0&&(k=!1),null===(V=this.prePassRenderer)||void 0===V||V.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&k&&(k=this.depthPeelingRenderer.isReady()),J&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),W=0;W<this.meshes.length;W++){const G=this.meshes[W];if(!G.Ed||0===G.Ed.length)continue;if(!G.isReady(!0)){k=!1;continue}const V=G.hasThinInstances||"InstancedMesh"===G.getClassName()||"InstancedLinesMesh"===G.getClassName()||R.getCaps().instancedArrays&&G.instances.length>0;for(const W of this._isReadyForMeshStage)W.action(G,V)||(k=!1);if(!J)continue;const d=G.material||this.defaultMaterial;if(d)if(d._storeEffectOnSubMeshes)for(const W of G.Ed){const G=W.NG();G&&G.hasRenderTargetTextures&&null!=G.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(G)&&(this._processedMaterials.push(G),this._materialsRenderTargets.concatWithNoDuplicate(G.getRenderTargetTextures()))}else d.hasRenderTargetTextures&&null!=d.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(d)&&(this._processedMaterials.push(d),this._materialsRenderTargets.concatWithNoDuplicate(d.getRenderTargetTextures()))}if(J)for(W=0;W<this._materialsRenderTargets.length;++W){this._materialsRenderTargets.data[W].isReadyForRendering()||(k=!1)}for(W=0;W<this.geometries.length;W++){2===this.geometries[W].delayLoadState&&(k=!1)}if(this.activeCameras&&this.activeCameras.length>0)for(const z of this.activeCameras)z.isReady(!0)||(k=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(k=!1));for(const z of this.mx)z.isReady()||(k=!1);if(this.layers)for(const z of this.layers)z.isReady()||(k=!1);if(this.effectLayers)for(const z of this.effectLayers)z.isLayerReady()||(k=!1);return R.areAllEffectsReady()||(k=!1),R.currentRenderPassId=d,k}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}registerBeforeRender(G){this.onBeforeRenderObservable.add(G)}unregisterBeforeRender(G){this.onBeforeRenderObservable.removeCallback(G)}registerAfterRender(G){this.onAfterRenderObservable.add(G)}unregisterAfterRender(G){this.onAfterRenderObservable.removeCallback(G)}_executeOnceBeforeRender(G){const V=()=>{G(),setTimeout((()=>{this.unregisterBeforeRender(V)}))};this.registerBeforeRender(V)}executeOnceBeforeRender(G,V){void 0!==V?setTimeout((()=>{this._executeOnceBeforeRender(G)}),V):this._executeOnceBeforeRender(G)}addPendingData(G){this._pendingData.push(G)}removePendingData(G){const V=this.isLoading,W=this._pendingData.indexOf(G);-1!==W&&this._pendingData.splice(W,1),V&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}getWaitingItemsCount(){return this._pendingData.length}get isLoading(){return this._pendingData.length>0}executeWhenReady(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.onReadyObservable.addOnce(G),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(V)}async whenReadyAsync(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return await new Promise((V=>{this.executeWhenReady((()=>{V()}),G)}))}_checkIsReady(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._registerTransientComponents(),this.isReady(G)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((()=>{this.incrementRenderId(),this._checkIsReady(G)}),100))}get animatables(){return this._activeAnimatables}resetLastAnimationTimeFrame(){this._animationTimeLast=R.e.Now}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projectionMatrix}getTransformMatrix(){return this._transformMatrix}setTransformMatrix(G,V,W,J){W||J||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===G.updateFlag&&this._projectionUpdateFlag===V.updateFlag||(this._viewUpdateFlag=G.updateFlag,this._projectionUpdateFlag=V.updateFlag,this._viewMatrix=G,this._projectionMatrix=V,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?Q.c.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=Q.c.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(W,J):this._sceneUbo.useUbo&&(this._sceneUbo.Td("viewProjection",this._transformMatrix),this._sceneUbo.Td("view",this._viewMatrix),this._sceneUbo.Td("projection",this._projectionMatrix)))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}createSceneUniformBuffer(G){const V=new x.c(this._engine,void 0,!1,G??"tV");return V.addUniform("viewProjection",16),V.addUniform("view",16),V.addUniform("projection",16),V.addUniform("vEyePosition",4),V}setSceneUniformBuffer(G){this._sceneUbo=G,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}getUniqueId(){return Z.e.UniqueId}CP(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._blockEntityCollection&&(this.meshes.push(G),G._resyncLightSources(),G.parent||G._addToSceneRootNodes(),J.h.SetImmediate((()=>{this.onNewMeshAddedObservable.notifyObservers(G)})),V)){const V=G.getChildMeshes();for(const G of V)this.CP(G)}}vP(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const W=this.meshes.indexOf(G);if(-1!==W&&(this.meshes.splice(W,1),G.parent||G._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(G),this.onMeshRemovedObservable.notifyObservers(G),V){const V=G.getChildMeshes();for(const G of V)this.vP(G)}return W}addTransformNode(G){this._blockEntityCollection||G.HG()===this&&-1!==G._indexInSceneTransformNodesArray||(G._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(G),G.parent||G._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(G))}removeTransformNode(G){const V=G._indexInSceneTransformNodesArray;if(-1!==V){if(V!==this.transformNodes.length-1){const G=this.transformNodes[this.transformNodes.length-1];this.transformNodes[V]=G,G._indexInSceneTransformNodesArray=V}G._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),G.parent||G._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(G),V}removeSkeleton(G){const V=this.skeletons.indexOf(G);return-1!==V&&(this.skeletons.splice(V,1),this.onSkeletonRemovedObservable.notifyObservers(G),this._executeActiveContainerCleanup(this._activeSkeletons)),V}removeMorphTargetManager(G){const V=this.morphTargetManagers.indexOf(G);return-1!==V&&this.morphTargetManagers.splice(V,1),V}removeLight(G){const V=this.lights.indexOf(G);if(-1!==V){for(const V of this.meshes)V._removeLightSource(G,!1);this.lights.splice(V,1),this.sortLightsByPriority(),G.parent||G._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(G),V}removeCamera(G){const V=this.cameras.indexOf(G);if(-1!==V&&(this.cameras.splice(V,1),G.parent||G._removeFromSceneRootNodes()),this.activeCameras){const V=this.activeCameras.indexOf(G);-1!==V&&this.activeCameras.splice(V,1)}return this.activeCamera===G&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(G),V}removeParticleSystem(G){const V=this.mx.indexOf(G);return-1!==V&&(this.mx.splice(V,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),V}removeAnimation(G){const V=this.animations.indexOf(G);return-1!==V&&this.animations.splice(V,1),V}stopAnimation(G,V,W){}removeAnimationGroup(G){const V=this.animationGroups.indexOf(G);return-1!==V&&this.animationGroups.splice(V,1),V}removeMultiMaterial(G){const V=this.multiMaterials.indexOf(G);return-1!==V&&this.multiMaterials.splice(V,1),this.onMultiMaterialRemovedObservable.notifyObservers(G),V}removeMaterial(G){const V=G._indexInSceneMaterialArray;if(-1!==V&&V<this.materials.length){if(V!==this.materials.length-1){const G=this.materials[this.materials.length-1];this.materials[V]=G,G._indexInSceneMaterialArray=V}G._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(G),V}removeActionManager(G){const V=this.actionManagers.indexOf(G);return-1!==V&&this.actionManagers.splice(V,1),V}removeTexture(G){const V=this.textures.indexOf(G);return-1!==V&&this.textures.splice(V,1),this.onTextureRemovedObservable.notifyObservers(G),V}addLight(G){if(!this._blockEntityCollection){this.lights.push(G),this.sortLightsByPriority(),G.parent||G._addToSceneRootNodes();for(const V of this.meshes)-1===V.lightSources.indexOf(G)&&(V.lightSources.push(G),V._resyncLightSources());J.h.SetImmediate((()=>{this.onNewLightAddedObservable.notifyObservers(G)}))}}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(h.b.CompareLightsPriority)}addCamera(G){this._blockEntityCollection||(this.cameras.push(G),J.h.SetImmediate((()=>{this.onNewCameraAddedObservable.notifyObservers(G)})),G.parent||G._addToSceneRootNodes())}addSkeleton(G){this._blockEntityCollection||(this.skeletons.push(G),J.h.SetImmediate((()=>{this.onNewSkeletonAddedObservable.notifyObservers(G)})))}addParticleSystem(G){this._blockEntityCollection||this.mx.push(G)}addAnimation(G){this._blockEntityCollection||this.animations.push(G)}addAnimationGroup(G){this._blockEntityCollection||this.animationGroups.push(G)}addMultiMaterial(G){this._blockEntityCollection||(this.multiMaterials.push(G),J.h.SetImmediate((()=>{this.onNewMultiMaterialAddedObservable.notifyObservers(G)})))}addMaterial(G){this._blockEntityCollection||G.HG()===this&&-1!==G._indexInSceneMaterialArray||(G._indexInSceneMaterialArray=this.materials.length,this.materials.push(G),J.h.SetImmediate((()=>{this.onNewMaterialAddedObservable.notifyObservers(G)})))}addMorphTargetManager(G){this._blockEntityCollection||this.morphTargetManagers.push(G)}addGeometry(G){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[G.uniqueId]=this.geometries.length),this.geometries.push(G))}addActionManager(G){this.actionManagers.push(G)}addTexture(G){this._blockEntityCollection||(this.textures.push(G),this.onNewTextureAddedObservable.notifyObservers(G))}switchActiveCamera(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.zx(),this.activeCamera=G,V&&G.attachControl())}setActiveCameraById(G){const V=this.getCameraById(G);return V?(this.activeCamera=V,V):null}setActiveCameraByName(G){const V=this.getCameraByName(G);return V?(this.activeCamera=V,V):null}getAnimationGroupByName(G){for(let V=0;V<this.animationGroups.length;V++)if(this.animationGroups[V].name===G)return this.animationGroups[V];return null}_getMaterial(G,V){for(let W=0;W<this.materials.length;W++){const G=this.materials[W];if(V(G))return G}if(G)for(let W=0;W<this.multiMaterials.length;W++){const G=this.multiMaterials[W];if(V(G))return G}return null}getMaterialByUniqueID(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.getMaterialByUniqueId(G,V)}getMaterialByUniqueId(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(V,(V=>V.uniqueId===G))}getMaterialById(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(V,(V=>V.id===G))}getMaterialByName(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(V,(V=>V.name===G))}getLastMaterialById(G){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(let W=this.materials.length-1;W>=0;W--)if(this.materials[W].id===G)return this.materials[W];if(V)for(let W=this.multiMaterials.length-1;W>=0;W--)if(this.multiMaterials[W].id===G)return this.multiMaterials[W];return null}getTextureByUniqueId(G){for(let V=0;V<this.textures.length;V++)if(this.textures[V].uniqueId===G)return this.textures[V];return null}getTextureByName(G){for(let V=0;V<this.textures.length;V++)if(this.textures[V].name===G)return this.textures[V];return null}getCameraById(G){for(let V=0;V<this.cameras.length;V++)if(this.cameras[V].id===G)return this.cameras[V];return null}getCameraByUniqueId(G){for(let V=0;V<this.cameras.length;V++)if(this.cameras[V].uniqueId===G)return this.cameras[V];return null}getCameraByName(G){for(let V=0;V<this.cameras.length;V++)if(this.cameras[V].name===G)return this.cameras[V];return null}getBoneById(G){for(let V=0;V<this.skeletons.length;V++){const W=this.skeletons[V];for(let V=0;V<W.bones.length;V++)if(W.bones[V].id===G)return W.bones[V]}return null}getBoneByName(G){for(let V=0;V<this.skeletons.length;V++){const W=this.skeletons[V];for(let V=0;V<W.bones.length;V++)if(W.bones[V].name===G)return W.bones[V]}return null}getLightByName(G){for(let V=0;V<this.lights.length;V++)if(this.lights[V].name===G)return this.lights[V];return null}getLightById(G){for(let V=0;V<this.lights.length;V++)if(this.lights[V].id===G)return this.lights[V];return null}getLightByUniqueId(G){for(let V=0;V<this.lights.length;V++)if(this.lights[V].uniqueId===G)return this.lights[V];return null}getParticleSystemById(G){for(let V=0;V<this.mx.length;V++)if(this.mx[V].id===G)return this.mx[V];return null}getGeometryById(G){for(let V=0;V<this.geometries.length;V++)if(this.geometries[V].id===G)return this.geometries[V];return null}_getGeometryByUniqueId(G){if(this._geometriesByUniqueId){const V=this._geometriesByUniqueId[G];if(void 0!==V)return this.geometries[V]}else for(let V=0;V<this.geometries.length;V++)if(this.geometries[V].uniqueId===G)return this.geometries[V];return null}getFrameGraphByName(G){for(let V=0;V<this.frameGraphs.length;V++)if(this.frameGraphs[V].name===G)return this.frameGraphs[V];return null}pushGeometry(G,V){return!(!V&&this._getGeometryByUniqueId(G.uniqueId))&&(this.addGeometry(G),J.h.SetImmediate((()=>{this.onNewGeometryAddedObservable.notifyObservers(G)})),!0)}removeGeometry(G){let V;if(this._geometriesByUniqueId){if(V=this._geometriesByUniqueId[G.uniqueId],void 0===V)return!1}else if(V=this.geometries.indexOf(G),V<0)return!1;if(V!==this.geometries.length-1){const G=this.geometries[this.geometries.length-1];G&&(this.geometries[V]=G,this._geometriesByUniqueId&&(this._geometriesByUniqueId[G.uniqueId]=V))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[G.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(G),!0}getGeometries(){return this.geometries}getMeshById(G){for(let V=0;V<this.meshes.length;V++)if(this.meshes[V].id===G)return this.meshes[V];return null}getMeshesById(G){return this.meshes.filter((function(V){return V.id===G}))}getTransformNodeById(G){for(let V=0;V<this.transformNodes.length;V++)if(this.transformNodes[V].id===G)return this.transformNodes[V];return null}getTransformNodeByUniqueId(G){for(let V=0;V<this.transformNodes.length;V++)if(this.transformNodes[V].uniqueId===G)return this.transformNodes[V];return null}getTransformNodesById(G){return this.transformNodes.filter((function(V){return V.id===G}))}getMeshByUniqueId(G){for(let V=0;V<this.meshes.length;V++)if(this.meshes[V].uniqueId===G)return this.meshes[V];return null}getLastMeshById(G){for(let V=this.meshes.length-1;V>=0;V--)if(this.meshes[V].id===G)return this.meshes[V];return null}getLastTransformNodeById(G){for(let V=this.transformNodes.length-1;V>=0;V--)if(this.transformNodes[V].id===G)return this.transformNodes[V];return null}getLastEntryById(G){let V;for(V=this.meshes.length-1;V>=0;V--)if(this.meshes[V].id===G)return this.meshes[V];for(V=this.transformNodes.length-1;V>=0;V--)if(this.transformNodes[V].id===G)return this.transformNodes[V];for(V=this.cameras.length-1;V>=0;V--)if(this.cameras[V].id===G)return this.cameras[V];for(V=this.lights.length-1;V>=0;V--)if(this.lights[V].id===G)return this.lights[V];return null}getNodeById(G){const V=this.getMeshById(G);if(V)return V;const W=this.getTransformNodeById(G);if(W)return W;const J=this.getLightById(G);if(J)return J;const R=this.getCameraById(G);if(R)return R;const d=this.getBoneById(G);return d||null}getNodeByName(G){const V=this.getMeshByName(G);if(V)return V;const W=this.getTransformNodeByName(G);if(W)return W;const J=this.getLightByName(G);if(J)return J;const R=this.getCameraByName(G);if(R)return R;const d=this.getBoneByName(G);return d||null}getMeshByName(G){for(let V=0;V<this.meshes.length;V++)if(this.meshes[V].name===G)return this.meshes[V];return null}getTransformNodeByName(G){for(let V=0;V<this.transformNodes.length;V++)if(this.transformNodes[V].name===G)return this.transformNodes[V];return null}getLastSkeletonById(G){for(let V=this.skeletons.length-1;V>=0;V--)if(this.skeletons[V].id===G)return this.skeletons[V];return null}getSkeletonByUniqueId(G){for(let V=0;V<this.skeletons.length;V++)if(this.skeletons[V].uniqueId===G)return this.skeletons[V];return null}getSkeletonById(G){for(let V=0;V<this.skeletons.length;V++)if(this.skeletons[V].id===G)return this.skeletons[V];return null}getSkeletonByName(G){for(let V=0;V<this.skeletons.length;V++)if(this.skeletons[V].name===G)return this.skeletons[V];return null}getMorphTargetManagerById(G){for(let V=0;V<this.morphTargetManagers.length;V++)if(this.morphTargetManagers[V].uniqueId===G)return this.morphTargetManagers[V];return null}getMorphTargetById(G){for(let V=0;V<this.morphTargetManagers.length;++V){const W=this.morphTargetManagers[V];for(let V=0;V<W.numTargets;++V){const J=W.getTarget(V);if(J.id===G)return J}}return null}getMorphTargetByName(G){for(let V=0;V<this.morphTargetManagers.length;++V){const W=this.morphTargetManagers[V];for(let V=0;V<W.numTargets;++V){const J=W.getTarget(V);if(J.name===G)return J}}return null}getPostProcessByName(G){for(let V=0;V<this.postProcesses.length;++V){const W=this.postProcesses[V];if(W.name===G)return W}return null}isActiveMesh(G){return-1!==this._activeMeshes.indexOf(G)}get uid(){return this._uid||(this._uid=J.h.RandomId()),this._uid}addExternalData(G,V){return this._externalData||(this._externalData=new z),this._externalData.add(G,V)}getExternalData(G){return this._externalData?this._externalData.get(G):null}getOrAddExternalDataWithFactory(G,V){return this._externalData||(this._externalData=new z),this._externalData.getOrAddWithFactory(G,V)}removeExternalData(G){return this._externalData.remove(G)}_evaluateSubMesh(G,V,W,J){if(J||G.isInFrustum(this._frustumPlanes)){for(const J of this._evaluateSubMeshStage)J.action(V,G);const W=G.NG();null!==W&&void 0!==W&&(W.hasRenderTargetTextures&&null!=W.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(W)&&(this._processedMaterials.push(W),this._materialsRenderTargets.concatWithNoDuplicate(W.getRenderTargetTextures())),this._renderingManager.dispatch(G,V,W))}}freeProcessedMaterials(){this._processedMaterials.dispose()}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set blockfreeActiveMeshesAndRenderingGroups(G){this._preventFreeActiveMeshesAndRenderingGroups!==G&&(G&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=G)}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let G=0;G<this.activeCameras.length;G++){const V=this.activeCameras[G];V&&V._activeMeshes&&V._activeMeshes.dispose()}}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let G=0;G<this.textures.length;G++){const V=this.textures[G];V&&V.renderList&&V.freeRenderingGroups()}}_isInIntermediateRendering(){return this._intermediateRendering}freezeActiveMeshes(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],V=arguments.length>1?arguments[1]:void 0,W=arguments.length>2?arguments[2]:void 0,J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],R=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.executeWhenReady((()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=R,this._skipEvaluateActiveMeshesCompletely=G,J)for(let G=0;G<this._activeMeshes.length;G++)this._activeMeshes.data[G]._freeze();V&&V()}else W&&W("No active camera found")})),this}unfreezeActiveMeshes(){for(let G=0;G<this.meshes.length;G++){const V=this.meshes[G];V._internalAbstractMeshDataInfo&&(V._internalAbstractMeshDataInfo._isActive=!1)}for(let G=0;G<this._activeMeshes.length;G++)this._activeMeshes.data[G]._unFreeze();return this._activeMeshesFrozen=!1,this}_executeActiveContainerCleanup(G){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((()=>G.dispose()))}_evaluateActiveMeshes(){if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode){var G;if(this._activeMeshes.length>0)null===(G=this.activeCamera)||void 0===G||G._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();return}if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const G=this._activeMeshes.length;for(let V=0;V<G;V++){this._activeMeshes.data[V].kd()}}if(this._activeParticleSystems){const G=this._activeParticleSystems.length;for(let V=0;V<G;V++)this._activeParticleSystems.data[V].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const J of this._beforeEvaluateActiveMeshStage)J.action();const V=this.getActiveMeshCandidates(),W=V.length;for(let J=0;J<W;J++){const G=V.data[J];let W=G._internalAbstractMeshDataInfo._currentLOD.get(this.activeCamera);if(W?W[1]=-1:(W=[G,-1],G._internalAbstractMeshDataInfo._currentLOD.set(this.activeCamera,W)),G.isBlocked)continue;if(this._totalVertices.addCount(G.getTotalVertices(),!1),!G.isReady()||!G.isEnabled()||G.vd.hasAZeroComponent)continue;G.kd(),G.actionManager&&G.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(G);let R=this.customLODSelector?this.customLODSelector(G,this.activeCamera):G.getLOD(this.activeCamera);if(W[0]=R,W[1]=this._frameId,void 0!==R&&null!==R&&(R!==G&&0!==R.billboardMode&&R.kd(),G._preActivate(),G.isVisible&&G.visibility>0&&0!==(G.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||G.gz||G.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(G),this.activeCamera._activeMeshes.push(G),R!==G&&R._activate(this._renderId,!1);for(const V of this._preActiveMeshStage)V.action(G);G._activate(this._renderId,!1)&&(G.isAnInstance?G._internalAbstractMeshDataInfo._actAsRegularMesh&&(R=G):R._internalAbstractMeshDataInfo._onlyForInstances=!1,R._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(G,R)),G._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let G=0;G<this.mx.length;G++){const V=this.mx[G];if(!V.isStarted()||!V.j)continue;const W=V.j;W.position&&!W.isEnabled()||(this._activeParticleSystems.push(V),V.animate(),this._renderingManager.dispatchParticles(V))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}_prepareSkeleton(G){this._skeletonsEnabled&&G.skeleton&&(this._activeSkeletons.pushNoDuplicate(G.skeleton)&&(G.skeleton.prepare(),this._activeBones.addCount(G.skeleton.bones.length,!1)),G.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(G)&&this.frameGraph&&G.applySkeleton(G.skeleton))}_activeMesh(G,V){this._prepareSkeleton(V);let W=G.hasInstances||G.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||V.gz;if(V&&V.Ed&&V.Ed.length>0){const J=this.getActiveSubMeshCandidates(V),R=J.length;W=W||1===R;for(let d=0;d<R;d++){const R=J.data[d];this._evaluateSubMesh(R,V,G,W)}}}updateTransformMatrix(G){const V=this.activeCamera;if(V)if(V._renderingMultiview){const W=V._rigCameras[0],J=V._rigCameras[1];this.setTransformMatrix(W.getViewMatrix(),W.getProjectionMatrix(G),J.getViewMatrix(),J.getProjectionMatrix(G))}else this.setTransformMatrix(V.getViewMatrix(),V.getProjectionMatrix(G))}_bindFrameBuffer(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._useCurrentFrameBuffer||(G&&G._multiviewTexture?G._multiviewTexture._bindFrameBuffer():G&&G.outputRenderTarget?G.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer()),V&&this._clearFrameBuffer(G)}_clearFrameBuffer(G){if(G&&G._multiviewTexture);else if(G&&G.outputRenderTarget&&!G._renderingMultiview){const V=G.outputRenderTarget;V.onClearObservable.hasObservers()?V.onClearObservable.notifyObservers(this._engine):V.skipInitialClear||G.isRightCamera||(this.Xx&&this._engine.clear(V.clearColor||this._clearColor,!V._cleared,!0,!0),V._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_renderForCamera(G,V){var W;let R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(G&&G._skipRendering)return;const d=this._engine;if(this._activeCamera=G,!this.activeCamera)throw new Error("Active camera not set");if(d.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&R){let V=!0;G._renderingMultiview&&G.outputRenderTarget&&(V=G.outputRenderTarget.skipInitialClear,this.Xx&&(this._defaultFrameBufferCleared=!1,G.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),G._renderingMultiview&&G.outputRenderTarget&&(G.outputRenderTarget.skipInitialClear=V)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let J=0;J<this._softwareSkinnedMeshes.length;J++){const G=this._softwareSkinnedMeshes.data[J];G.applySkeleton(G.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),G.customRenderTargets&&G.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(G.customRenderTargets),V&&V.customRenderTargets&&V.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(V.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const J of this._gatherActiveCameraRenderTargetsStage)J.action(this._renderTargets);let k=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){J.h.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let G=0;G<this._renderTargets.length;G++){const V=this._renderTargets.data[G];if(V._shouldRender()){this._renderId++;const G=V.activeCamera&&V.activeCamera!==this.activeCamera;V.render(G,this.dumpNextRenderTargets),k=!0}}J.h.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const G of this._cameraDrawRenderTargetStage)k=G.action(this.activeCamera)||k;this._intermediateRendering=!1}this._engine.currentRenderPassId=(null===(W=G.outputRenderTarget)||void 0===W?void 0:W.renderPassId)??G.renderPassId??0,k&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||G._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const J of this._beforeCameraDrawStage)J.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),d.snapshotRendering&&1===d.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const J of this._afterCameraDrawStage)J.action(this.activeCamera);if(this.postProcessManager&&!G._multiviewTexture){const V=G.outputRenderTarget?G.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(G.isIntermediate,V)}for(const J of this._afterCameraPostProcessStage)J.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}_processSubCameras(G){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(0===G.cameraRigMode||G._renderingMultiview)return G._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(G,void 0,V),void this.onAfterRenderCameraObservable.notifyObservers(G);if(G._useMultiviewToSingleView)this._renderMultiviewToSingleView(G);else{this.onBeforeCameraRenderObservable.notifyObservers(G);for(let V=0;V<G._rigCameras.length;V++)this._renderForCamera(G._rigCameras[V],G)}this._activeCamera=G,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(G)}_checkIntersections(){for(let G=0;G<this._meshesForIntersections.length;G++){const V=this._meshesForIntersections.data[G];if(V.actionManager)for(let G=0;V.actionManager&&G<V.actionManager.actions.length;G++){const W=V.actionManager.actions[G];if(12===W.trigger||13===W.trigger){const G=W.getTriggerParameter(),J=G.mesh?G.mesh:G,R=J.intersectsMesh(V,G.usePreciseIntersection),d=V._intersectionsInProgress.indexOf(J);R&&-1===d?12===W.trigger?(W._executeCurrent(L.CreateNew(V,void 0,J)),V._intersectionsInProgress.push(J)):13===W.trigger&&V._intersectionsInProgress.push(J):!R&&d>-1&&(13===W.trigger&&W._executeCurrent(L.CreateNew(V,void 0,J)),V.actionManager.hasSpecificTrigger(13,(G=>{const V=G.mesh?G.mesh:G;return J===V}))&&13!==W.trigger||V._intersectionsInProgress.splice(d,1))}}}}_advancePhysicsEngineStep(G){}_animate(G){}animate(){if(this._engine.isDeterministicLockStep()){let G=Math.max(GG.MinDeltaTime,Math.min(this._engine.getDeltaTime(),GG.MaxDeltaTime))+this._timeAccumulator;const V=this._engine.getTimeStep(),W=1e3/V/1e3;let J=0;const R=this._engine.getLockstepMaxSteps();let d=Math.floor(G/V);for(d=Math.min(d,R);G>0&&J<d;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=V*W,this._animate(V),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(V),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,J++,G-=V;this._timeAccumulator=G<0?0:G}else{const G=this.useConstantAnimationDeltaTime?16:Math.max(GG.MinDeltaTime,Math.min(this._engine.getDeltaTime(),GG.MaxDeltaTime));this._animationRatio=.06*G,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(G)}}_clear(){(this.autoClearDepthAndStencil||this.Xx)&&this._engine.clear(this._clearColor,this.Xx||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}_checkCameraRenderTarget(G){var V;if(null===G||void 0===G||!G.outputRenderTarget||null!==G&&void 0!==G&&G.isRigCamera||(G.outputRenderTarget._cleared=!1),null!==G&&void 0!==G&&null!==(V=G.rigCameras)&&void 0!==V&&V.length)for(let W=0;W<G.rigCameras.length;++W){const V=G.rigCameras[W].outputRenderTarget;V&&(V._cleared=!1)}}resetDrawCache(G){if(this.meshes)for(const V of this.meshes)V.resetDrawCache(G)}_renderWithFrameGraph(){var G;let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.activeCamera=null,this._activeParticleSystems.reset(),this._activeSkeletons.reset(),V)for(const R of this.cameras)if(R.update(),0!==R.cameraRigMode)for(let G=0;G<R._rigCameras.length;G++)R._rigCameras[G].update();this.onBeforeRenderObservable.notifyObservers(this);for(const R of this._beforeClearStage)R.action();const W=this.getActiveMeshCandidates(),J=W.length;for(let R=0;R<J;R++){const G=W.data[R];G.isBlocked||(this._totalVertices.addCount(G.getTotalVertices(),!1),G.isReady()&&G.isEnabled()&&!G.vd.hasAZeroComponent&&(G.kd(),G.actionManager&&G.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(G)))}if(this.particlesEnabled)for(let R=0;R<this.mx.length;R++){const G=this.mx[R];if(!G.isStarted()||!G.j)continue;const V=G.j;V.position&&!V.isEnabled()||(this._activeParticleSystems.push(G),G.animate())}null===(G=this.frameGraph)||void 0===G||G.execute()}_renderRenderTarget(G,V){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._intermediateRendering=!0,G._shouldRender()){if(this._renderId++,this.activeCamera=V,!this.activeCamera)throw new Error("Active camera not set");this._engine.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),G.render(W,J)}this._intermediateRendering=!1}render(){var G;let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],W=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.P){if(this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),null!==(G=this.activeCameras)&&void 0!==G&&G.length)for(const G of this.activeCameras)this._checkCameraRenderTarget(G);this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),W||this.animate();for(const G of this._beforeCameraUpdateStage)G.action();if(V)if(this.activeCameras&&this.activeCameras.length>0)for(let G=0;G<this.activeCameras.length;G++){const V=this.activeCameras[G];if(V.update(),0!==V.cameraRigMode)for(let G=0;G<V._rigCameras.length;G++)V._rigCameras[G].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let G=0;G<this.activeCamera._rigCameras.length;G++)this.activeCamera._rigCameras[G].update();if(this.customRenderFunction)this._renderId++,this._engine.currentRenderPassId=0,this.customRenderFunction(V,W);else{var R;this.onBeforeRenderObservable.notifyObservers(this),this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const G=null!==(R=this.activeCameras)&&void 0!==R&&R.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){J.h.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0);for(let V=0;V<this.customRenderTargets.length;V++){const W=this.customRenderTargets[V],J=W.activeCamera||this.activeCamera;this._renderRenderTarget(W,J,G!==J,this.dumpNextRenderTargets)}J.h.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._renderId++}this._engine.currentRenderPassId=(null===G||void 0===G?void 0:G.renderPassId)??0,this.activeCamera=G,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const V of this._beforeClearStage)V.action();this._clearFrameBuffer(this.activeCamera);for(const V of this._gatherRenderTargetsStage)V.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let V=0;V<this.activeCameras.length;V++)this._processSubCameras(this.activeCameras[V],V>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}}this._checkIntersections();for(const G of this._afterRenderStage)G.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let G=0;G<this._toBeDisposed.length;G++){const V=this._toBeDisposed[G];V&&V.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}}freezeMaterials(){for(let G=0;G<this.materials.length;G++)this.materials[G].freeze()}unfreezeMaterials(){for(let G=0;G<this.materials.length;G++)this.materials[G].unfreeze()}dispose(){if(this.P)return;if(this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this._activeAnimatables&&this.stopAllAnimations){for(const G of this._activeAnimatables)G.onAnimationEndObservable.clear(),G.onAnimationEnd=null;this.stopAllAnimations()}this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const G=this._activeRequests.slice();for(const R of G)R.abort();this._activeRequests.length=0;try{this.Md.notifyObservers(this)}catch(J){I.c.Error("An error occurred while calling onDisposeObservable!",J)}this.zx();if(this._engine.getInputElement())for(let R=0;R<this.cameras.length;R++)this.cameras[R].zx();this._disposeList(this.animationGroups),this._disposeList(this.lights),this.mA&&this.mA.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.meshes,(G=>G.dispose(!0))),this._disposeList(this.transformNodes,(G=>G.dispose(!0)));const V=this.cameras;this._disposeList(V),this._disposeList(this.mx),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let W=this._engine.scenes.indexOf(this);if(W>-1&&this._engine.scenes.splice(W,1),S.c._LastCreatedScene===this){S.c._LastCreatedScene=null;let G=S.c.Instances.length-1;for(;G>=0;){const V=S.c.Instances[G];if(V.scenes.length>0){S.c._LastCreatedScene=V.scenes[this._engine.scenes.length-1];break}G--}}W=this._engine._virtualScenes.indexOf(this),W>-1&&this._engine._virtualScenes.splice(W,1),this._engine.wipeCaches(!0),this.Md.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this.onClearColorChangedObservable.clear(),this.onEnvironmentTextureChangedObservable.clear(),this.onMeshUnderPointerUpdatedObservable.clear(),this._isDisposed=!0}_disposeList(G,V){const W=G.slice(0);V=V??(G=>G.dispose());for(const J of W)V(J);G.length=0}get P(){return this._isDisposed}clearCachedVertexData(){for(let G=0;G<this.meshes.length;G++){const V=this.meshes[G].zd;V&&V.clearCachedData()}}cleanCachedTextureBuffer(){for(const G of this.textures){G._buffer&&(G._buffer=null)}}getWorldExtends(G){const V=new P.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),W=new P.o(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);G=G||(()=>!0);const J=this.meshes.filter(G);for(const R of J){if(R.kd(!0),!R.Ed||0===R.Ed.length||R.infiniteDistance)continue;const G=R.getBoundingInfo(),J=G.boundingBox.minimumWorld,d=G.boundingBox.maximumWorld;P.o.CheckExtends(J,V,W),P.o.CheckExtends(d,V,W)}return{min:V,max:W}}createPickingRay(G,V,W,J){throw(0,p.e)("Ray")}createPickingRayToRef(G,V,W,J,R){throw(0,p.e)("Ray")}createPickingRayInCameraSpace(G,V,W){throw(0,p.e)("Ray")}createPickingRayInCameraSpaceToRef(G,V,W,J){throw(0,p.e)("Ray")}kW(G,V,W,J,R,d){const k=(0,p.e)("Ray",!0);return k&&I.c.Warn(k),new q.d}pickWithBoundingInfo(G,V,W,J,R){const d=(0,p.e)("Ray",!0);return d&&I.c.Warn(d),new q.d}pickWithRay(G,V,W,J){throw(0,p.e)("Ray")}multiPick(G,V,W,J,R){throw(0,p.e)("Ray")}multiPickWithRay(G,V,W){throw(0,p.e)("Ray")}setPointerOverMesh(G,V,W){this._inputManager.setPointerOverMesh(G,V,W)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_rebuildGeometries(){for(const G of this.geometries)G._rebuild();for(const G of this.meshes)G._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const G of this._components)G.rebuild();for(const G of this.mx)G.rebuild();if(this.spriteManagers)for(const G of this.spriteManagers)G.rebuild()}_rebuildTextures(){for(const G of this.textures)G._rebuild(!0);this.markAllMaterialsAsDirty(1)}_getByTags(G,V,W){if(void 0===V)return G;const J=[];for(const R in G){const d=G[R];X.c&&X.c.MatchesQuery(d,V)&&(!W||W(d))&&J.push(d)}return J}getMeshesByTags(G,V){return this._getByTags(this.meshes,G,V)}getCamerasByTags(G,V){return this._getByTags(this.cameras,G,V)}getLightsByTags(G,V){return this._getByTags(this.lights,G,V)}getMaterialByTags(G,V){return this._getByTags(this.materials,G,V).concat(this._getByTags(this.multiMaterials,G,V))}getTransformNodesByTags(G,V){return this._getByTags(this.transformNodes,G,V)}setRenderingOrder(G){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(G,V,W,J)}setRenderingAutoClearDepthStencil(G,V){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(G,V,W,J)}getAutoClearDepthStencilSetup(G){return this._renderingManager.getAutoClearDepthStencilSetup(G)}_forceBlockMaterialDirtyMechanism(G){this._blockMaterialDirtyMechanism=G}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set blockMaterialDirtyMechanism(G){this._blockMaterialDirtyMechanism!==G&&(this._blockMaterialDirtyMechanism=G,G||this.markAllMaterialsAsDirty(127))}markAllMaterialsAsDirty(G,V){if(!this._blockMaterialDirtyMechanism)for(const W of this.materials)V&&!V(W)||W.pP(G)}_loadFile(G,V,W,J,R,d,k){const z=(0,E.l)(G,V,W,J?this.offlineProvider:void 0,R,d,k);return this._activeRequests.push(z),z.onCompleteObservable.add((G=>{this._activeRequests.splice(this._activeRequests.indexOf(G),1)})),z}async _loadFileAsync(G,V,W,J,R){return await new Promise(((d,k)=>{this._loadFile(G,(G=>{d(G)}),V,W,J,((G,V)=>{k(V)}),R)}))}_requestFile(G,V,W,J,R,d,k){const z=(0,E.t)(G,V,W,J?this.offlineProvider:void 0,R,d,k);return this._activeRequests.push(z),z.onCompleteObservable.add((G=>{this._activeRequests.splice(this._activeRequests.indexOf(G),1)})),z}async _requestFileAsync(G,V,W,J,R){return await new Promise(((d,k)=>{this._requestFile(G,(G=>{d(G)}),V,W,J,(G=>{k(G)}),R)}))}_readFile(G,V,W,J,R){const d=(0,E.r)(G,V,W,J,R);return this._activeRequests.push(d),d.onCompleteObservable.add((G=>{this._activeRequests.splice(this._activeRequests.indexOf(G),1)})),d}async _readFileAsync(G,V,W){return await new Promise(((J,R)=>{this._readFile(G,(G=>{J(G)}),V,W,(G=>{R(G)}))}))}getPerfCollector(){throw(0,p.e)("performanceViewerSceneExtension")}setActiveCameraByID(G){return this.setActiveCameraById(G)}getMaterialByID(G){return this.getMaterialById(G)}getLastMaterialByID(G){return this.getLastMaterialById(G)}getTextureByUniqueID(G){return this.getTextureByUniqueId(G)}getCameraByID(G){return this.getCameraById(G)}getCameraByUniqueID(G){return this.getCameraByUniqueId(G)}getBoneByID(G){return this.getBoneById(G)}getLightByID(G){return this.getLightById(G)}getLightByUniqueID(G){return this.getLightByUniqueId(G)}getParticleSystemByID(G){return this.getParticleSystemById(G)}getGeometryByID(G){return this.getGeometryById(G)}getMeshByID(G){return this.getMeshById(G)}getMeshByUniqueID(G){return this.getMeshByUniqueId(G)}getLastMeshByID(G){return this.getLastMeshById(G)}getMeshesByID(G){return this.getMeshesById(G)}getTransformNodeByID(G){return this.getTransformNodeById(G)}getTransformNodeByUniqueID(G){return this.getTransformNodeByUniqueId(G)}getTransformNodesByID(G){return this.getTransformNodesById(G)}getNodeByID(G){return this.getNodeById(G)}getLastEntryByID(G){return this.getLastEntryById(G)}getLastSkeletonByID(G){return this.getLastSkeletonById(G)}}GG.FOGMODE_NONE=0,GG.FOGMODE_EXP=1,GG.FOGMODE_EXP2=2,GG.FOGMODE_LINEAR=3,GG.MinDeltaTime=1,GG.MaxDeltaTime=1e3,GG._OriginalDefaultMaterialFactory=GG.DefaultMaterialFactory,(0,O.d)("BABYLON.Scene",GG)},11561:(G,V,W)=>{W.d(V,{b:()=>J,e:()=>R});class J{}J.NAME_EFFECTLAYER="EffectLayer",J.NAME_LAYER="Layer",J.NAME_LENSFLARESYSTEM="LensFlareSystem",J.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",J.NAME_PARTICLESYSTEM="nx",J.NAME_GAMEPAD="Gamepad",J.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",J.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",J.NAME_PREPASSRENDERER="PrePassRenderer",J.NAME_DEPTHRENDERER="DepthRenderer",J.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",J.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",J.NAME_SPRITE="Sprite",J.NAME_SUBSURFACE="SubSurface",J.NAME_OUTLINERENDERER="Outline",J.NAME_PROCEDURALTEXTURE="ProceduralTexture",J.NAME_SHADOWGENERATOR="ShadowGenerator",J.NAME_OCTREE="ft",J.NAME_PHYSICSENGINE="PhysicsEngine",J.NAME_AUDIO="Audio",J.NAME_FLUIDRENDERER="FluidRenderer",J.NAME_IBLCDFGENERATOR="iblCDFGenerator",J.STEP_ISREADYFORMESH_EFFECTLAYER=0,J.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,J.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,J.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,J.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,J.STEP_BEFORECAMERADRAW_PREPASS=0,J.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,J.STEP_BEFORECAMERADRAW_LAYER=2,J.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,J.STEP_BEFORERENDERTARGETDRAW_LAYER=1,J.STEP_BEFORERENDERINGMESH_PREPASS=0,J.STEP_BEFORERENDERINGMESH_OUTLINE=1,J.STEP_AFTERRENDERINGMESH_PREPASS=0,J.STEP_AFTERRENDERINGMESH_OUTLINE=1,J.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,J.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,J.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,J.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,J.STEP_BEFORECLEAR_PREPASS=1,J.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,J.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,J.STEP_AFTERRENDERTARGETDRAW_LAYER=1,J.STEP_AFTERCAMERADRAW_PREPASS=0,J.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,J.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,J.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,J.STEP_AFTERCAMERADRAW_LAYER=4,J.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,J.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,J.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,J.STEP_AFTERRENDER_AUDIO=0,J.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,J.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,J.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,J.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,J.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,J.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,J.STEP_POINTERMOVE_SPRITE=0,J.STEP_POINTERDOWN_SPRITE=0,J.STEP_POINTERUP_SPRITE=0;class R extends Array{constructor(G){super(...G)}static Create(){return Object.create(R.prototype)}registerStep(G,V,W){let J=0,R=Number.MAX_VALUE;for(;J<this.length;J++){if(R=this[J].index,G<R)break}this.splice(J,0,{index:G,component:V,action:W.bind(V)})}clear(){this.length=0}}},11317:(G,V,W)=>{W.d(V,{e:()=>J});function J(G,V,W,J){var R,d=arguments.length,k=d<3?V:null===J?J=Object.getOwnPropertyDescriptor(V,W):J;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)k=Reflect.decorate(G,V,W,J);else for(var z=G.length-1;z>=0;z--)(R=G[z])&&(k=(d<3?R(k):d>3?R(V,W,k):R(V,W))||k);return d>3&&k&&Object.defineProperty(V,W,k),k}Object.create;Object.create}}]);