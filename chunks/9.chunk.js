"use strict";(self.zjjkhojdx1=self.zjjkhojdx1||[]).push([[9],{11141:(k,h,o)=>{o.d(h,{c:()=>i,g:()=>b,j:()=>V,i:()=>U,n:()=>Q});class x{constructor(){this.children=[]}isValid(k){return!0}process(k,h,o){let x="";if(this.line){let o=this.line;const A=h.processor;if(A){var I,q,Y,J,G,l;A.lineProcessor&&(o=A.lineProcessor(o,h.isFragment,h.processingContext));const x=(null===(I=h.processor)||void 0===I?void 0:I.attributeKeywordName)??"attribute",K=h.isFragment&&null!==(q=h.processor)&&void 0!==q&&q.varyingFragmentKeywordName?null===(Y=h.processor)||void 0===Y?void 0:Y.varyingFragmentKeywordName:!h.isFragment&&null!==(J=h.processor)&&void 0!==J&&J.varyingVertexKeywordName?null===(G=h.processor)||void 0===G?void 0:G.varyingVertexKeywordName:"varying";if(!h.isFragment&&A.attributeProcessor&&this.line.startsWith(x))o=A.attributeProcessor(this.line,k,h.processingContext);else if(A.varyingProcessor&&(null!==(l=A.varyingCheck)&&void 0!==l&&l.call(A,this.line,h.isFragment)||!A.varyingCheck&&this.line.startsWith(K)))o=A.varyingProcessor(this.line,h.isFragment,k,h.processingContext);else if(A.uniformProcessor&&A.uniformRegexp&&A.uniformRegexp.test(this.line))h.lookForClosingBracketForUniformBuffer||(o=A.uniformProcessor(this.line,h.isFragment,k,h.processingContext));else if(A.uniformBufferProcessor&&A.uniformBufferRegexp&&A.uniformBufferRegexp.test(this.line))h.lookForClosingBracketForUniformBuffer||(o=A.uniformBufferProcessor(this.line,h.isFragment,h.processingContext),h.lookForClosingBracketForUniformBuffer=!0);else if(A.textureProcessor&&A.textureRegexp&&A.textureRegexp.test(this.line))o=A.textureProcessor(this.line,h.isFragment,k,h.processingContext);else if((A.uniformProcessor||A.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!h.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?A.uniformProcessor&&(o=A.uniformProcessor(this.line,h.isFragment,k,h.processingContext)):A.uniformBufferProcessor&&(o=A.uniformBufferProcessor(this.line,h.isFragment,h.processingContext),h.lookForClosingBracketForUniformBuffer=!0)}h.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(h.lookForClosingBracketForUniformBuffer=!1,A.endOfUniformBufferProcessor&&(o=A.endOfUniformBufferProcessor(this.line,h.isFragment,h.processingContext)))}x+=o+"\n"}for(const A of this.children)x+=A.process(k,h,o);return this.additionalDefineKey&&(k[this.additionalDefineKey]=this.additionalDefineValue||"true",o[this.additionalDefineKey]=k[this.additionalDefineKey]),x}}class I{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(k){this._lines.length=0;for(const h of k){if(!h||"\r"===h)continue;if("#"===h[0]){this._lines.push(h);continue}const k=h.trim();if(!k)continue;if(k.startsWith("//")){this._lines.push(h);continue}const o=k.indexOf(";");if(-1===o)this._lines.push(k);else if(o===k.length-1)k.length>1&&this._lines.push(k);else{const k=h.split(";");for(let h=0;h<k.length;h++){let o=k[h];o&&(o=o.trim(),o&&this._lines.push(o+(h!==k.length-1?";":"")))}}}}}class q extends x{process(k,h,o){for(let x=0;x<this.children.length;x++){const I=this.children[x];if(I.isValid(k))return I.process(k,h,o)}return""}}class Y extends x{isValid(k){return this.testExpression.isTrue(k)}}class J{isTrue(k){return!0}static postfixToInfix(k){const h=[];for(const o of k)if(void 0===J._OperatorPriority[o])h.push(o);else{const k=h[h.length-1],x=h[h.length-2];h.length-=2,h.push(`(${x}${o}${k})`)}return h[h.length-1]}static infixToPostfix(k){const h=J._InfixToPostfixCache.get(k);if(h)return h.accessTime=Date.now(),h.result;if(!k.includes("&&")&&!k.includes("||")&&!k.includes(")")&&!k.includes("("))return[k];const o=[];let x=-1;const I=()=>{A=A.trim(),""!==A&&(o.push(A),A="")},q=k=>{x<J._Stack.length-1&&(J._Stack[++x]=k)},Y=()=>J._Stack[x],G=()=>-1===x?"!!INVALID EXPRESSION!!":J._Stack[x--];let l=0,A="";for(;l<k.length;){const h=k.charAt(l),K=l<k.length-1?k.substring(l,2+l):"";if("("===h)A="",q(h);else if(")"===h){for(I();-1!==x&&"("!==Y();)o.push(G());G()}else if(J._OperatorPriority[K]>1){for(I();-1!==x&&J._OperatorPriority[Y()]>=J._OperatorPriority[K];)o.push(G());q(K),l++}else A+=h;l++}for(I();-1!==x;)"("===Y()?G():o.push(G());return J._InfixToPostfixCache.size>=J.InfixToPostfixCacheLimitSize&&J.ClearCache(),J._InfixToPostfixCache.set(k,{result:o,accessTime:Date.now()}),o}static ClearCache(){const k=Array.from(J._InfixToPostfixCache.entries()).sort(((k,h)=>k[1].accessTime-h[1].accessTime));for(let h=0;h<J.InfixToPostfixCacheCleanupSize;h++)J._InfixToPostfixCache.delete(k[h][0])}}J.InfixToPostfixCacheLimitSize=5e4,J.InfixToPostfixCacheCleanupSize=25e3,J._InfixToPostfixCache=new Map,J._OperatorPriority={")":0,"(":1,"||":2,"&&":3},J._Stack=["","","","","","","","","","","","","","","","","","","",""];class G extends J{constructor(k){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=k,this.not=h}isTrue(k){let h=void 0!==k[this.define];return this.not&&(h=!h),h}}class l extends J{isTrue(k){return this.leftOperand.isTrue(k)||this.rightOperand.isTrue(k)}}class A extends J{isTrue(k){return this.leftOperand.isTrue(k)&&this.rightOperand.isTrue(k)}}class K extends J{constructor(k,h,o){super(),this.define=k,this.operand=h,this.testValue=o}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(k){let h=!1;const o=parseInt(void 0!=k[this.define]?k[this.define]:this.define),x=parseInt(void 0!=k[this.testValue]?k[this.testValue]:this.testValue);if(isNaN(o)||isNaN(x))return!1;switch(this.operand){case">":h=o>x;break;case"<":h=o<x;break;case"<=":h=o<=x;break;case">=":h=o>=x;break;case"==":h=o===x;break;case"!=":h=o!==x}return h}}var a=o(11108),N=o(11143);const X=/defined\s*?\((.+?)\)/g,c=/defined\s*?\[(.+?)\]/g,W=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,f=/__decl__/,M=/light\{X\}.(\w*)/g,T=/\{X\}/g,j=[],d=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function b(k){k.processor&&k.processor.initializeShaders&&k.processor.initializeShaders(k.processingContext)}function V(k,h,o,x){var I;null!==(I=h.processor)&&void 0!==I&&I.preProcessShaderCode&&(k=h.processor.preProcessShaderCode(k,h.isFragment)),U(k,h,(k=>{h.processCodeAfterIncludes&&(k=h.processCodeAfterIncludes(h.isFragment?"fragment":"vertex",k,h.defines));const I=function(k,h,o){let x=function(k,h){var o;if(null!==(o=h.processor)&&void 0!==o&&o.noPrecision)return k;const x=h.shouldUseHighPrecisionShader;-1===k.indexOf("precision highp float")?k=x?"precision highp float;\n"+k:"precision mediump float;\n"+k:x||(k=k.replace("precision highp float","precision mediump float"));return k}(k,h);if(!h.processor)return x;if(0===h.processor.shaderLanguage&&-1!==x.indexOf("#version 3")&&(x=x.replace("#version 300 es",""),!h.processor.parseGLES3))return x;const I=h.defines,q=D(h,o);h.processor.preProcessor&&(x=h.processor.preProcessor(x,I,q,h.isFragment,h.processingContext));const Y={};x=w(x,q,h,Y),h.processor.postProcessor&&(x=h.processor.postProcessor(x,I,h.isFragment,h.processingContext,o?{drawBuffersExtensionDisabled:!o.getCaps().drawBuffersExtension}:{},q,Y));null!==o&&void 0!==o&&o._features.needShaderCodeInlining&&(x=o.inlineShaderCode(x));return x}(k,h,x);o(I,k)}))}function i(k,h,o){return o.processor&&o.processor.finalizeShaders?o.processor.finalizeShaders(k,h,o.processingContext):{vertexCode:k,fragmentCode:h}}function F(k){const h=/defined\((.+)\)/.exec(k);if(h&&h.length)return new G(h[1].trim(),"!"===k[0]);const o=["==","!=",">=","<=","<",">"];let x="",I=0;for(x of o)if(I=k.indexOf(x),I>-1)break;if(-1===I)return new G(k);const q=k.substring(0,I).trim(),Y=k.substring(I+x.length).trim();return new K(q,x,Y)}function R(k,h){const o=new Y,x=k.substring(0,h);let I=k.substring(h);return I=I.substring(0,(I.indexOf("//")+1||I.length+1)-1).trim(),o.testExpression="#ifdef"===x?new G(I):"#ifndef"===x?new G(I,!0):function(k){k=k.replace(X,"defined[$1]");const h=J.infixToPostfix(k),o=[];for(const I of h)if("||"!==I&&"&&"!==I)o.push(I);else if(o.length>=2){let k=o[o.length-1],h=o[o.length-2];o.length-=2;const x="&&"==I?new A:new l;"string"===typeof k&&(k=k.replace(c,"defined($1)")),"string"===typeof h&&(h=h.replace(c,"defined($1)")),x.leftOperand="string"===typeof h?F(h):h,x.rightOperand="string"===typeof k?F(k):k,o.push(x)}let x=o[o.length-1];return"string"===typeof x&&(x=x.replace(c,"defined($1)")),"string"===typeof x?F(x):x}(I),o}function s(k,h,o,I){let q=k.currentLine;for(;Z(k,o,I);){q=k.currentLine;const Y=q.substring(0,5).toLowerCase();if("#else"===Y){const o=new x;return h.children.push(o),void Z(k,o,I)}if("#elif"===Y){const k=R(q,5);h.children.push(k),o=k}}}function Z(k,h,o){for(;k.canRead;){k.lineIndex++;const I=k.currentLine;if(I.indexOf("#")>=0){const x=d.exec(I);if(x&&x.length){switch(x[0]){case"#ifdef":{const x=new q;h.children.push(x);const Y=R(I,6);x.children.push(Y),s(k,x,Y,o);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const x=new q;h.children.push(x);const Y=R(I,7);x.children.push(Y),s(k,x,Y,o);break}case"#if":{const x=new q,Y=R(I,3);h.children.push(x),x.children.push(Y),s(k,x,Y,o);break}}continue}}const Y=new x;if(Y.line=I,h.children.push(Y),"#"===I[0]&&"d"===I[1]){const k=I.replace(";","").split(" ");Y.additionalDefineKey=k[1],3===k.length&&(Y.additionalDefineValue=k[2])}}return!1}function w(k,h,o,q){const Y=new x,J=new I;return J.lineIndex=-1,J.lines=k.split("\n"),Z(J,Y,q),Y.process(h,o,q)}function D(k,h){var o;const x=k.defines,I={};for(const q of x){const k=q.replace("#define","").replace(";","").trim().split(" ");I[k[0]]=k.length>1?k[1]:""}return 0===(null===(o=k.processor)||void 0===o?void 0:o.shaderLanguage)&&(I.GL_ES="true"),I.__VERSION__=k.version,I[k.platformName]="true",(0,N.f)(I,null===h||void 0===h?void 0:h.isNDCHalfZRange,null===h||void 0===h?void 0:h.useReverseDepthBuffer,null===h||void 0===h?void 0:h.useExactSrgbConversions),I}function U(k,h,o){let x;for(j.length=0;null!==(x=W.exec(k));)j.push(x);let I=String(k),q=[k],Y=!1;for(const J of j){let k=J[1];if(-1!==k.indexOf("__decl__")&&(k=k.replace(f,""),h.supportsUniformBuffers&&(k=k.replace("Vertex","Ubo").replace("Fragment","Ubo")),k+="Declaration"),!h.includesShadersStore[k]){const x=h.shadersRepository+"ShadersInclude/"+k+".fx";return void Q.loadFile(x,(x=>{h.includesShadersStore[k]=x,U(q.join(""),h,o)}))}{let o=h.includesShadersStore[k];if(J[2]){const k=J[3].split(",");for(let h=0;h<k.length;h+=2){const x=new RegExp(k[h],"g"),I=k[h+1];o=o.replace(x,I)}}if(J[4]){const k=J[5];if(-1!==k.indexOf("..")){const x=k.split(".."),I=parseInt(x[0]);let q=parseInt(x[1]),Y=o.slice(0);o="",isNaN(q)&&(q=h.indexParameters[x[1]]);for(let k=I;k<q;k++)h.supportsUniformBuffers||(Y=Y.replace(M,((k,h)=>h+"{X}"))),o+=Y.replace(T,k.toString())+"\n"}else h.supportsUniformBuffers||(o=o.replace(M,((k,h)=>h+"{X}"))),o=o.replace(T,k)}const x=[];for(const k of q){const h=k.split(J[0]);for(let k=0;k<h.length-1;k++)x.push(h[k]),x.push(o);x.push(h[h.length-1])}q=x,Y=Y||o.indexOf("#include<")>=0||o.indexOf("#include <")>=0}}j.length=0,I=q.join(""),Y?U(I.toString(),h,o):o(I)}const Q={loadFile:(k,h,o,x,I,q)=>{throw(0,a.e)("FileTools")}}},11143:(k,h,o)=>{o.d(h,{b:()=>I,c:()=>q,f:()=>J,j:()=>Y,k:()=>G});var x=o(11108);o(11090);const I={};function q(k,h){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(h?h+"\n":"")+k}function Y(k,h,o,q,Y,J,G){const l=G||I.loadFile;if(l){return l(k,h,o,q,Y,J)}throw(0,x.e)("FileTools")}function J(k,h,o,x){if(k)return h?k.IS_NDC_HALF_ZRANGE="":delete k.IS_NDC_HALF_ZRANGE,o?k.USE_REVERSE_DEPTHBUFFER="":delete k.USE_REVERSE_DEPTHBUFFER,void(x?k.USE_EXACT_SRGB_CONVERSIONS="":delete k.USE_EXACT_SRGB_CONVERSIONS);{let k="";return h&&(k+="#define IS_NDC_HALF_ZRANGE"),o&&(k&&(k+="\n"),k+="#define USE_REVERSE_DEPTHBUFFER"),x&&(k&&(k+="\n"),k+="#define USE_EXACT_SRGB_CONVERSIONS"),k}}function G(k,h){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=arguments.length>3?arguments[3]:void 0;switch(k){case 3:{const k=(ArrayBuffer,new Int8Array(h));return x&&k.set(new Int8Array(x)),k}case 0:{const k=(ArrayBuffer,new Uint8Array(h));return x&&k.set(new Uint8Array(x)),k}case 4:{const k=h instanceof ArrayBuffer?new Int16Array(h):new Int16Array(o?h/2:h);return x&&k.set(new Int16Array(x)),k}case 5:case 8:case 9:case 10:case 2:{const k=h instanceof ArrayBuffer?new Uint16Array(h):new Uint16Array(o?h/2:h);return x&&k.set(new Uint16Array(x)),k}case 6:{const k=h instanceof ArrayBuffer?new Int32Array(h):new Int32Array(o?h/4:h);return x&&k.set(new Int32Array(x)),k}case 7:case 11:case 12:case 13:case 14:case 15:{const k=h instanceof ArrayBuffer?new Uint32Array(h):new Uint32Array(o?h/4:h);return x&&k.set(new Uint32Array(x)),k}case 1:{const k=h instanceof ArrayBuffer?new Float32Array(h):new Float32Array(o?h/4:h);return x&&k.set(new Float32Array(x)),k}}const I=(ArrayBuffer,new Uint8Array(h));return x&&I.set(new Uint8Array(x)),I}},11160:(k,h,o)=>{o.d(h,{b:()=>x});class x{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?x.ShadersRepository:x.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?x.ShadersStore:x.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?x.IncludesShadersStore:x.IncludesShadersStoreWGSL}}x.ShadersRepository="src/Shaders/",x.ShadersStore={},x.IncludesShadersStore={},x.ShadersRepositoryWGSL="src/ShadersWGSL/",x.ShadersStoreWGSL={},x.IncludesShadersStoreWGSL={}},11171:(k,h,o)=>{o.d(h,{b:()=>a,f:()=>T,j:()=>X,n:()=>N,r:()=>c,u:()=>M,y:()=>K,C:()=>l,F:()=>A,H:()=>G,I:()=>J});class x{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.bh._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(k){k&&this.program&&k(this.program)}setEngine(k){this.bh=k}_fillEffectInformation(k,h,o,x,I,q,Y,J){const G=this.bh;if(G.supportsUniformBuffers)for(const A in h)k.bindUniformBlock(A,h[A]);let l;for(this.bh.getUniforms(this,o).forEach(((k,h)=>{x[o[h]]=k})),this._uniforms=x,l=0;l<I.length;l++){null==k.getUniform(I[l])&&(I.splice(l,1),l--)}I.forEach(((k,h)=>{q[k]=h}));for(const A of G.getAttributes(this,Y))J.push(A)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(k,h){const o=this._valueCache[k],x=h.updateFlag;return(void 0===o||o!==x)&&(this._valueCache[k]=x,!0)}_cacheFloat2(k,h,o){let x=this._valueCache[k];if(!x||2!==x.length)return x=[h,o],this._valueCache[k]=x,!0;let I=!1;return x[0]!==h&&(x[0]=h,I=!0),x[1]!==o&&(x[1]=o,I=!0),I}_cacheFloat3(k,h,o,x){let I=this._valueCache[k];if(!I||3!==I.length)return I=[h,o,x],this._valueCache[k]=I,!0;let q=!1;return I[0]!==h&&(I[0]=h,q=!0),I[1]!==o&&(I[1]=o,q=!0),I[2]!==x&&(I[2]=x,q=!0),q}_cacheFloat4(k,h,o,x,I){let q=this._valueCache[k];if(!q||4!==q.length)return q=[h,o,x,I],this._valueCache[k]=q,!0;let Y=!1;return q[0]!==h&&(q[0]=h,Y=!0),q[1]!==o&&(q[1]=o,Y=!0),q[2]!==x&&(q[2]=x,Y=!0),q[3]!==I&&(q[3]=I,Y=!0),Y}setInt(k,h){const o=this._valueCache[k];void 0!==o&&o===h||this.bh.setInt(this._uniforms[k],h)&&(this._valueCache[k]=h)}setInt2(k,h,o){this._cacheFloat2(k,h,o)&&(this.bh.setInt2(this._uniforms[k],h,o)||(this._valueCache[k]=null))}setInt3(k,h,o,x){this._cacheFloat3(k,h,o,x)&&(this.bh.setInt3(this._uniforms[k],h,o,x)||(this._valueCache[k]=null))}setInt4(k,h,o,x,I){this._cacheFloat4(k,h,o,x,I)&&(this.bh.setInt4(this._uniforms[k],h,o,x,I)||(this._valueCache[k]=null))}setIntArray(k,h){this._valueCache[k]=null,this.bh.setIntArray(this._uniforms[k],h)}setIntArray2(k,h){this._valueCache[k]=null,this.bh.setIntArray2(this._uniforms[k],h)}setIntArray3(k,h){this._valueCache[k]=null,this.bh.setIntArray3(this._uniforms[k],h)}setIntArray4(k,h){this._valueCache[k]=null,this.bh.setIntArray4(this._uniforms[k],h)}setUInt(k,h){const o=this._valueCache[k];void 0!==o&&o===h||this.bh.setUInt(this._uniforms[k],h)&&(this._valueCache[k]=h)}setUInt2(k,h,o){this._cacheFloat2(k,h,o)&&(this.bh.setUInt2(this._uniforms[k],h,o)||(this._valueCache[k]=null))}setUInt3(k,h,o,x){this._cacheFloat3(k,h,o,x)&&(this.bh.setUInt3(this._uniforms[k],h,o,x)||(this._valueCache[k]=null))}setUInt4(k,h,o,x,I){this._cacheFloat4(k,h,o,x,I)&&(this.bh.setUInt4(this._uniforms[k],h,o,x,I)||(this._valueCache[k]=null))}setUIntArray(k,h){this._valueCache[k]=null,this.bh.setUIntArray(this._uniforms[k],h)}setUIntArray2(k,h){this._valueCache[k]=null,this.bh.setUIntArray2(this._uniforms[k],h)}setUIntArray3(k,h){this._valueCache[k]=null,this.bh.setUIntArray3(this._uniforms[k],h)}setUIntArray4(k,h){this._valueCache[k]=null,this.bh.setUIntArray4(this._uniforms[k],h)}setArray(k,h){this._valueCache[k]=null,this.bh.setArray(this._uniforms[k],h)}setArray2(k,h){this._valueCache[k]=null,this.bh.setArray2(this._uniforms[k],h)}setArray3(k,h){this._valueCache[k]=null,this.bh.setArray3(this._uniforms[k],h)}setArray4(k,h){this._valueCache[k]=null,this.bh.setArray4(this._uniforms[k],h)}setMatrices(k,h){h&&(this._valueCache[k]=null,this.bh.setMatrices(this._uniforms[k],h))}setMatrix(k,h){this._cacheMatrix(k,h)&&(this.bh.setMatrices(this._uniforms[k],h.rh())||(this._valueCache[k]=null))}setMatrix3x3(k,h){this._valueCache[k]=null,this.bh.setMatrix3x3(this._uniforms[k],h)}setMatrix2x2(k,h){this._valueCache[k]=null,this.bh.setMatrix2x2(this._uniforms[k],h)}setFloat(k,h){const o=this._valueCache[k];void 0!==o&&o===h||this.bh.setFloat(this._uniforms[k],h)&&(this._valueCache[k]=h)}setVector2(k,h){this._cacheFloat2(k,h.x,h.y)&&(this.bh.setFloat2(this._uniforms[k],h.x,h.y)||(this._valueCache[k]=null))}setFloat2(k,h,o){this._cacheFloat2(k,h,o)&&(this.bh.setFloat2(this._uniforms[k],h,o)||(this._valueCache[k]=null))}setVector3(k,h){this._cacheFloat3(k,h.x,h.y,h.z)&&(this.bh.setFloat3(this._uniforms[k],h.x,h.y,h.z)||(this._valueCache[k]=null))}setFloat3(k,h,o,x){this._cacheFloat3(k,h,o,x)&&(this.bh.setFloat3(this._uniforms[k],h,o,x)||(this._valueCache[k]=null))}setVector4(k,h){this._cacheFloat4(k,h.x,h.y,h.z,h.w)&&(this.bh.setFloat4(this._uniforms[k],h.x,h.y,h.z,h.w)||(this._valueCache[k]=null))}setQuaternion(k,h){this._cacheFloat4(k,h.x,h.y,h.z,h.w)&&(this.bh.setFloat4(this._uniforms[k],h.x,h.y,h.z,h.w)||(this._valueCache[k]=null))}setFloat4(k,h,o,x,I){this._cacheFloat4(k,h,o,x,I)&&(this.bh.setFloat4(this._uniforms[k],h,o,x,I)||(this._valueCache[k]=null))}setColor3(k,h){this._cacheFloat3(k,h.r,h.g,h.b)&&(this.bh.setFloat3(this._uniforms[k],h.r,h.g,h.b)||(this._valueCache[k]=null))}setColor4(k,h,o){this._cacheFloat4(k,h.r,h.g,h.b,o)&&(this.bh.setFloat4(this._uniforms[k],h.r,h.g,h.b,o)||(this._valueCache[k]=null))}setDirectColor4(k,h){this._cacheFloat4(k,h.r,h.g,h.b,h.a)&&(this.bh.setFloat4(this._uniforms[k],h.r,h.g,h.b,h.a)||(this._valueCache[k]=null))}_getVertexShaderCode(){return this.vertexShader?this.bh._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.bh._getShaderSource(this.fragmentShader):null}}var I=o(11143);const q=new WeakMap,Y={_webGLVersion:2,cachedPipelines:{}};function J(k){let h=q.get(k);if(!h){if(!k)return Y;h={_webGLVersion:k.TEXTURE_BINDING_3D?2:1,_context:k,parallelShaderCompile:k.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},q.set(k,h)}return h}function G(k){q.delete(k)}function l(k,h,o,x,I,q){const Y=J(x);q||(q=Y._createShaderProgramInjection??a);return q(k,f(h,"vertex",x,Y._contextWasLost),f(o,"fragment",x,Y._contextWasLost),x,I,Y.validateShaderPrograms)}function A(k,h,o,x,I){let q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6?arguments[6]:void 0;const G=J(I);Y||(Y=G._createShaderProgramInjection??a);const l=G._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return Y(k,W(h,"vertex",x,l,I,G._contextWasLost),W(o,"fragment",x,l,I,G._contextWasLost),I,q,G.validateShaderPrograms)}function K(k,h){const o=new x,I=J(k);return I.parallelShaderCompile&&!I.disableParallelShaderCompile&&(o.isParallelCompiled=!0),o.context=I._context,o}function a(k,h,o,x){let I=arguments.length>5?arguments[5]:void 0;const q=x.createProgram();if(k.program=q,!q)throw new Error("Unable to create program");return x.attachShader(q,h),x.attachShader(q,o),x.linkProgram(q),k.context=x,k.vertexShader=h,k.fragmentShader=o,k.isParallelCompiled||X(k,x,I),q}function N(k,h,o){const x=k;if(x._isDisposed)return!1;const I=J(h);return!!(I&&I.parallelShaderCompile&&I.parallelShaderCompile.COMPLETION_STATUS_KHR&&x.program&&h.getProgramParameter(x.program,I.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(X(x,h,o),!0)}function X(k,h,o){const x=k.context,I=k.vertexShader,q=k.fragmentShader,Y=k.program;if(!x.getProgramParameter(Y,x.LINK_STATUS)){if(!h.getShaderParameter(I,h.COMPILE_STATUS)){const o=h.getShaderInfoLog(I);if(o)throw k.vertexCompilationError=o,new Error("VERTEX SHADER "+o)}if(!h.getShaderParameter(q,h.COMPILE_STATUS)){const o=h.getShaderInfoLog(q);if(o)throw k.fragmentCompilationError=o,new Error("FRAGMENT SHADER "+o)}const o=x.getProgramInfoLog(Y);if(o)throw k.programLinkError=o,new Error(o)}if(o){x.validateProgram(Y);if(!x.getProgramParameter(Y,x.VALIDATE_STATUS)){const h=x.getProgramInfoLog(Y);if(h)throw k.programValidationError=h,new Error(h)}}x.deleteShader(I),x.deleteShader(q),k.vertexShader=void 0,k.fragmentShader=void 0,k.onCompiled&&(k.onCompiled(),k.onCompiled=void 0)}function c(k,h,o,x,I,q,Y,G,K){let a=arguments.length>10?arguments[10]:void 0,N=arguments.length>11?arguments[11]:void 0,X=arguments.length>12?arguments[12]:void 0;const c=J(k.context);N||(N=c.createRawShaderProgramInjection??l),X||(X=c.createShaderProgramInjection??A);const W=k;W.program=x?N(W,h,o,W.context,K):X(W,h,o,G,W.context,K),W.program.__SPECTOR_rebuildProgram=Y,a()}function W(k,h,o,x,q,Y){return f((0,I.c)(k,o,x),h,q,Y)}function f(k,h,o,x){const I=o.createShader("vertex"===h?o.VERTEX_SHADER:o.FRAGMENT_SHADER);if(!I){let k=o.NO_ERROR,I=o.NO_ERROR;for(;(I=o.getError())!==o.NO_ERROR;)k=I;throw new Error(`Something went wrong while creating a gl ${h} shader object. gl error=${k}, gl isContextLost=${o.isContextLost()}, _contextWasLost=${x}`)}return o.shaderSource(I,k),o.compileShader(I),I}function M(k,h){h.useProgram(k)}function T(k,h){const o=k;if(!o.isParallelCompiled)return void h(k);const x=o.onCompiled;o.onCompiled=()=>{null===x||void 0===x||x(),h(k)}}},11165:(k,h,o)=>{o.d(h,{e:()=>K,g:()=>N,h:()=>l,l:()=>A});var x=o(11090),I=o(11171),q=o(11160),Y=o(11098),J=o(11141),G=o(11143);function l(k,h){return(0,I.I)(h).cachedPipelines[k]}function A(k){const h=k._name,o=k.context;if(h&&o){const k=(0,I.I)(o),x=k.cachedPipelines[h];null===x||void 0===x||x.dispose(),delete k.cachedPipelines[h]}}function K(k,h,o,I,q,Y,G){let l,A;const K=(0,x.h)()?null===Y||void 0===Y?void 0:Y.getHostDocument():null;l="string"===typeof h?h:h.vertexSource?"source:"+h.vertexSource:h.vertexElement?(null===K||void 0===K?void 0:K.getElementById(h.vertexElement))||h.vertexElement:h.vertex||h,A="string"===typeof h?h:h.fragmentSource?"source:"+h.fragmentSource:h.fragmentElement?(null===K||void 0===K?void 0:K.getElementById(h.fragmentElement))||h.fragmentElement:h.fragment||h;const N=[void 0,void 0],X=()=>{if(N[0]&&N[1]){k.isFragment=!0;const[x,l]=N;(0,J.j)(l,k,((Y,l)=>{G&&(G._fragmentSourceCodeBeforeMigration=l),o&&(Y=o("fragment",Y));const A=(0,J.c)(x,Y,k);k=null;const K=function(k,h,o,x){if(o){return{vertexSourceCode:(1===x?"//":"")+"#define SHADER_NAME vertex:"+(o.vertexElement||o.vertex||o.spectorName||o)+"\n"+k,fragmentSourceCode:(1===x?"//":"")+"#define SHADER_NAME fragment:"+(o.fragmentElement||o.fragment||o.spectorName||o)+"\n"+h}}return{vertexSourceCode:k,fragmentSourceCode:h}}(A.vertexCode,A.fragmentCode,h,q);null===I||void 0===I||I(K.vertexSourceCode,K.fragmentSourceCode)}),Y)}};a(l,"Vertex","",(h=>{(0,J.g)(k),(0,J.j)(h,k,((k,x)=>{G&&(G._rawVertexSourceCode=h,G._vertexSourceCodeBeforeMigration=x),o&&(k=o("vertex",k)),N[0]=k,X()}),Y)}),q),a(A,"Fragment","Pixel",(k=>{G&&(G._rawFragmentSourceCode=k),N[1]=k,X()}),q)}function a(k,h,o,I,Y,J){if("undefined"!==typeof HTMLElement&&k instanceof HTMLElement){return void I((0,x.c)(k))}if("source:"===k.substring(0,7))return void I(k.substring(7));if("base64:"===k.substring(0,7)){return void I(window.atob(k.substring(7)))}const l=q.b.GetShadersStore(Y);if(l[k+h+"Shader"])return void I(l[k+h+"Shader"]);if(o&&l[k+o+"Shader"])return void I(l[k+o+"Shader"]);let A;if(A="."===k[0]||"/"===k[0]||k.indexOf("http")>-1?k:q.b.GetShadersRepository(Y)+k,!(J=J||G.j))throw new Error("loadFileInjection is not defined");J(A+"."+h.toLowerCase()+".fx",I)}const N=(k,h,o,x)=>{try{const q=k.context?(0,I.I)(k.context):null;q&&(q.disableParallelShaderCompile=k.disableParallelCompilation);const Y=k.existingPipelineContext||h(k.shaderProcessingContext);return Y._name=k.name,k.name&&q&&(q.cachedPipelines[k.name]=Y),o(Y,k.vertex,k.fragment,!!k.createAsRaw,"","",k.rebuildRebind,k.defines,k.transformFeedbackVaryings,"",(()=>{x(Y,(()=>{var h;null===(h=k.onRenderingStateCompiled)||void 0===h||h.call(k,Y)}))})),Y}catch(q){throw Y.c.Error("Error compiling effect"),q}}},11153:(k,h,o)=>{o.r(h),o.d(h,{Effect:()=>G});var x=o(11082),I=o(11098),q=o(11160),Y=o(11165),J=o(11145);class G{static get ShadersRepository(){return q.b.ShadersRepository}static set ShadersRepository(k){q.b.ShadersRepository=k}get l(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new x.d),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(k,h,o){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,q=arguments.length>4?arguments[4]:void 0,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,K=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,a=arguments.length>9?arguments[9]:void 0,N=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",X=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,c=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new x.d,this.onErrorObservable=new x.d,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=k,this._key=N;const W=this._key.replace(/\r/g,"").replace(/\n/g,"|");let f;if(h.attributes){const k=h;if(this._engine=o,this._attributesNames=k.attributes,this._uniformsNames=k.uniformsNames.concat(k.samplers),this._samplerList=k.samplers.slice(),this.defines=k.defines,this.onError=k.onError,this.onCompiled=k.onCompiled,this._fallbacks=k.fallbacks,this._indexParameters=k.indexParameters,this._transformFeedbackVaryings=k.transformFeedbackVaryings||null,this._multiTarget=!!k.multiTarget,this._shaderLanguage=k.shaderLanguage??0,this._disableParallelShaderCompilation=!!k.disableParallelShaderCompilation,k.uniformBuffersNames){this._uniformBuffersNamesList=k.uniformBuffersNames.slice();for(let h=0;h<k.uniformBuffersNames.length;h++)this._uniformBuffersNames[k.uniformBuffersNames[h]]=h}this._processFinalCode=k.processFinalCode??null,this._processCodeAfterIncludes=k.processCodeAfterIncludes??void 0,c=k.extraInitializationsAsync,f=k.existingPipelineContext}else this._engine=q,this.defines=null==J?"":J,this._uniformsNames=o.concat(I),this._samplerList=I?I.slice():[],this._attributesNames=h,this._uniformBuffersNamesList=[],this._shaderLanguage=X,this.onError=K,this.onCompiled=A,this._indexParameters=a,this._fallbacks=l;"WEBGL2"===this._engine.shaderPlatformName&&(f=(0,Y.h)(W,this._engine._gl)??f),this._attributeLocationByName={},this.uniqueId=G._UniqueIdSeed++,f?(this._pipelineContext=f,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,c),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.l||this.dispose(!0)}))}async _processShaderCodeAsync(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=arguments.length>3?arguments[3]:void 0;x&&await x(),this._processingContext=o||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const I={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:k??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:q.b.GetShadersRepository(this._shaderLanguage),includesShadersStore:q.b.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,Y.e)(I,this.name,this._processFinalCode,((k,o)=>{this._vertexSourceCode=k,this._fragmentSourceCode=o,this._prepareEffect(h)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.l||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(k){return this._attributes[k]}getAttributeLocationByName(k){return this._attributeLocationByName[k]}getAttributesCount(){return this._attributes.length}getUniformIndex(k){return this._uniformsNames.indexOf(k)}getUniform(k){return this._uniforms[k]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((k=>{this.executeWhenCompiled(k)}))}executeWhenCompiled(k){this.isReady()?k(this):(this.onCompileObservable.add((h=>{k(h)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(k){(0,J.e)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(h=>{this._processCompilationErrors(h,k)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var k;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(k=this._pipelineContext)||void 0===k?void 0:k._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var k;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(k=this._pipelineContext)||void 0===k?void 0:k._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(k,h,o,x){this._isReady=!1,this._vertexSourceCodeOverride=k,this._fragmentSourceCodeOverride=h,this.onError=(k,h)=>{x&&x(h)},this.onCompiled=()=>{var k,h;const x=this.getEngine().scenes;if(x)for(let o=0;o<x.length;o++)x[o].markAllMaterialsAsDirty(127);null===(k=(h=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===k||k.call(h,o)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(k){if(this._pipelineContext=k,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let h=0;h<this._attributesNames.length;h++){const k=this._attributesNames[h];this._attributeLocationByName[k]=this._attributes[h]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),G.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const h=this._pipelineContext;this._isReady=!1;try{const o=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),x=o?null:this.defines,I=o?this._vertexSourceCodeOverride:this._vertexSourceCode,q=o?this._fragmentSourceCodeOverride:this._fragmentSourceCode,J=this._engine;this._pipelineContext=(0,Y.g)({existingPipelineContext:k?h:null,vertex:I,fragment:q,context:"WEBGL2"===J.shaderPlatformName||"WEBGL1"===J.shaderPlatformName?J._gl:void 0,rebuildRebind:(k,h,o,x)=>this._rebuildProgram(k,h,o,x),defines:x,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:o,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:o=>{h&&!k&&this._engine._deletePipelineContext(h),o&&this._onRenderingStateCompiled(o)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(h)}catch(o){this._processCompilationErrors(o,h)}}_getShaderCodeAndErrorLine(k,h,o){const x=o?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let I=null;if(h&&k){const q=h.match(x);if(q&&2===q.length){const h=parseInt(q[1]),x=k.split("\n",-1);x.length>=h&&(I=`Offending line [${h}] in ${o?"fragment":"vertex"} code: ${x[h-1]}`)}}return[k,I]}_processCompilationErrors(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=k.message;const o=this._attributesNames,x=this._fallbacks;if(I.c.Error("Unable to compile effect:"),I.c.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),I.c.Error(`Attributes: ${o.join(" ")}`),I.c.Error("Defines:\n"+this.defines),G.LogShaderCodeOnCompilationError){var q,Y;let k=null,h=null,o=null;var J;if(null!==(q=this._pipelineContext)&&void 0!==q&&q._getVertexShaderCode()&&([o,k]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),o&&(I.c.Error("Vertex code:"),I.c.Error(o))),null!==(Y=this._pipelineContext)&&void 0!==Y&&Y._getFragmentShaderCode())[o,h]=this._getShaderCodeAndErrorLine(null===(J=this._pipelineContext)||void 0===J?void 0:J._getFragmentShaderCode(),this._compilationError,!0),o&&(I.c.Error("Fragment code:"),I.c.Error(o));k&&I.c.Error(k),h&&I.c.Error(h)}I.c.Error("Error: "+this._compilationError);const l=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};h&&(this._pipelineContext=h,this._isReady=!0,l()),x?(this._pipelineContext=null,x.hasMoreFallbacks?(this._allFallbacksProcessed=!1,I.c.Error("Trying next fallback."),this.defines=x.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,l(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,h||l())}get isSupported(){return""===this._compilationError}_bindTexture(k,h){this._engine._bindTexture(this._samplers[k],h,k)}setTexture(k,h){this._engine.setTexture(this._samplers[k],this._uniforms[k],h,k)}setTextureArray(k,h){const o=k+"Ex";if(-1===this._samplerList.indexOf(o+"0")){const x=this._samplerList.indexOf(k);for(let k=1;k<h.length;k++){const h=o+(k-1).toString();this._samplerList.splice(x+k,0,h)}let I=0;for(const k of this._samplerList)this._samplers[k]=I,I+=1}this._engine.setTextureArray(this._samplers[k],this._uniforms[k],h,k)}bindUniformBuffer(k,h){const o=this._uniformBuffersNames[h];void 0===o||G._BaseCache[o]===k&&this._engine._features.useUBOBindingCache||(G._BaseCache[o]=k,this._engine.bindUniformBufferBase(k,o,h))}bindUniformBlock(k,h){this._engine.bindUniformBlock(this._pipelineContext,k,h)}setInt(k,h){return this._pipelineContext.setInt(k,h),this}setInt2(k,h,o){return this._pipelineContext.setInt2(k,h,o),this}setInt3(k,h,o,x){return this._pipelineContext.setInt3(k,h,o,x),this}setInt4(k,h,o,x,I){return this._pipelineContext.setInt4(k,h,o,x,I),this}setIntArray(k,h){return this._pipelineContext.setIntArray(k,h),this}setIntArray2(k,h){return this._pipelineContext.setIntArray2(k,h),this}setIntArray3(k,h){return this._pipelineContext.setIntArray3(k,h),this}setIntArray4(k,h){return this._pipelineContext.setIntArray4(k,h),this}setUInt(k,h){return this._pipelineContext.setUInt(k,h),this}setUInt2(k,h,o){return this._pipelineContext.setUInt2(k,h,o),this}setUInt3(k,h,o,x){return this._pipelineContext.setUInt3(k,h,o,x),this}setUInt4(k,h,o,x,I){return this._pipelineContext.setUInt4(k,h,o,x,I),this}setUIntArray(k,h){return this._pipelineContext.setUIntArray(k,h),this}setUIntArray2(k,h){return this._pipelineContext.setUIntArray2(k,h),this}setUIntArray3(k,h){return this._pipelineContext.setUIntArray3(k,h),this}setUIntArray4(k,h){return this._pipelineContext.setUIntArray4(k,h),this}setFloatArray(k,h){return this._pipelineContext.setArray(k,h),this}setFloatArray2(k,h){return this._pipelineContext.setArray2(k,h),this}setFloatArray3(k,h){return this._pipelineContext.setArray3(k,h),this}setFloatArray4(k,h){return this._pipelineContext.setArray4(k,h),this}setArray(k,h){return this._pipelineContext.setArray(k,h),this}setArray2(k,h){return this._pipelineContext.setArray2(k,h),this}setArray3(k,h){return this._pipelineContext.setArray3(k,h),this}setArray4(k,h){return this._pipelineContext.setArray4(k,h),this}setMatrices(k,h){return this._pipelineContext.setMatrices(k,h),this}setMatrix(k,h){return this._pipelineContext.setMatrix(k,h),this}setMatrix3x3(k,h){return this._pipelineContext.setMatrix3x3(k,h),this}setMatrix2x2(k,h){return this._pipelineContext.setMatrix2x2(k,h),this}setFloat(k,h){return this._pipelineContext.setFloat(k,h),this}setBool(k,h){return this._pipelineContext.setInt(k,h?1:0),this}setVector2(k,h){return this._pipelineContext.setVector2(k,h),this}setFloat2(k,h,o){return this._pipelineContext.setFloat2(k,h,o),this}setVector3(k,h){return this._pipelineContext.setVector3(k,h),this}setFloat3(k,h,o,x){return this._pipelineContext.setFloat3(k,h,o,x),this}setVector4(k,h){return this._pipelineContext.setVector4(k,h),this}setQuaternion(k,h){return this._pipelineContext.setQuaternion(k,h),this}setFloat4(k,h,o,x,I){return this._pipelineContext.setFloat4(k,h,o,x,I),this}setColor3(k,h){return this._pipelineContext.setColor3(k,h),this}setColor4(k,h,o){return this._pipelineContext.setColor4(k,h,o),this}setDirectColor4(k,h){return this._pipelineContext.setDirectColor4(k,h),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(G.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,Y.l)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(k,h,o){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;h&&(q.b.GetShadersStore(x)[`${k}PixelShader`]=h),o&&(q.b.GetShadersStore(x)[`${k}VertexShader`]=o)}static ResetCache(){G._BaseCache={}}}G.LogShaderCodeOnCompilationError=!0,G.PersistentMode=!1,G.AutomaticallyClearCodeCache=!1,G._UniqueIdSeed=0,G._BaseCache={},G.ShadersStore=q.b.ShadersStore,G.IncludesShadersStore=q.b.IncludesShadersStore},11108:(k,h,o)=>{o.d(h,{e:()=>I});const x={};function I(k){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!x[k])return x[k]=!0,`${k} needs to be imported before as it contains a side-effect required by your code.`}},11090:(k,h,o)=>{function x(){return"undefined"!==typeof window}function I(){return"undefined"!==typeof navigator}function q(){return"undefined"!==typeof document}function Y(k){let h="",o=k.firstChild;for(;o;)3===o.nodeType&&(h+=o.textContent),o=o.nextSibling;return h}o.d(h,{c:()=>Y,e:()=>q,f:()=>I,h:()=>x})},11098:(k,h,o)=>{o.d(h,{c:()=>x});class x{static _CheckLimit(k,h){let o=x._LogLimitOutputs[k];return o?o.current++:(o={limit:h,current:1},x._LogLimitOutputs[k]=o),o.current<=o.limit}static _GenerateLimitMessage(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const o=x._LogLimitOutputs[k];if(!o||!x.MessageLimitReached)return;const I=this._Levels[h];o.current===o.limit&&x[I.name](x.MessageLimitReached.replace(/%LIMIT%/g,""+o.limit).replace(/%TYPE%/g,I.name??""))}static _AddLogEntry(k){x._LogCache=k+x._LogCache,x.OnNewCacheEntry&&x.OnNewCacheEntry(k)}static _FormatMessage(k){const h=k=>k<10?"0"+k:""+k,o=new Date;return"["+h(o.getHours())+":"+h(o.getMinutes())+":"+h(o.getSeconds())+"]: "+k}static _LogDisabled(k,h){}static _LogEnabled(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;const I=Array.isArray(h)?h[0]:h;if(void 0!==o&&!x._CheckLimit(I,o))return;const q=x._FormatMessage(I),Y=this._Levels[k],J=Array.isArray(h)?h.slice(1):[];Y.logFunc&&Y.logFunc("BJS - "+q,...J);const G=`<div style='color:${Y.color}'>${q}</div><br>`;x._AddLogEntry(G),x._GenerateLimitMessage(I,k)}static get LogCache(){return x._LogCache}static ClearLogCache(){x._LogCache="",x._LogLimitOutputs={},x.errorsCount=0}static set LogLevels(k){x.Log=x._LogDisabled,x.Warn=x._LogDisabled,x.Error=x._LogDisabled;const h=[x.MessageLogLevel,x.WarningLogLevel,x.ErrorLogLevel];for(const o of h)if((k&o)===o){const k=this._Levels[o];x[k.name]=x._LogEnabled.bind(x,o)}}}x.NoneLogLevel=0,x.MessageLogLevel=1,x.WarningLogLevel=2,x.ErrorLogLevel=4,x.AllLogLevel=7,x.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",x._LogCache="",x._LogLimitOutputs={},x._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],x.errorsCount=0,x.Log=x._LogEnabled.bind(x,x.MessageLogLevel),x.Warn=x._LogEnabled.bind(x,x.WarningLogLevel),x.Error=x._LogEnabled.bind(x,x.ErrorLogLevel)},11082:(k,h,o)=>{o.d(h,{d:()=>Y});const x="undefined"!==typeof WeakRef;class I{constructor(k){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2?arguments[2]:void 0,x=arguments.length>3?arguments[3]:void 0;this.initialize(k,h,o,x)}initialize(k){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2?arguments[2]:void 0,x=arguments.length>3?arguments[3]:void 0;return this.mask=k,this.skipNextObservers=h,this.target=o,this.currentTarget=x,this}}class q{constructor(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=k,this.mask=h,this.scope=o,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(k)}}class Y{static FromPromise(k,h){const o=new Y;return k.then((k=>{o.notifyObservers(k)})).catch((k=>{if(!h)throw k;h.notifyObservers(k)})),o}get observers(){return this._observers}constructor(k){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=h,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new I(0),k&&(this._onObserverAdded=k)}add(k){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!k)return null;const I=new q(k,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);I.unregisterOnNextCall=o,h?this._observers.unshift(I):this._observers.push(I),this._onObserverAdded&&this._onObserverAdded(I),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(I,this._lastNotifiedValue);const Y=x?new WeakRef(this):{deref:()=>this};return I._remove=function(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const h=Y.deref();h&&(k?h.remove(I):h._remove(I))},I}addOnce(k){return this.add(k,void 0,void 0,void 0,!0)}remove(k){if(!k)return!1;k._remove=null;return-1!==this._observers.indexOf(k)&&(this._deferUnregister(k),!0)}removeCallback(k,h){for(let o=0;o<this._observers.length;o++){const x=this._observers[o];if(!x._willBeUnregistered&&(x.callback===k&&(!h||h===x.scope)))return this._deferUnregister(x),!0}return!1}_deferUnregister(k){k._willBeUnregistered||(this._numObserversMarkedAsDeleted++,k.unregisterOnNextCall=!1,k._willBeUnregistered=!0,setTimeout((()=>{this._remove(k)}),0))}_remove(k){let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!k)return!1;const o=this._observers.indexOf(k);return-1!==o&&(h&&this._numObserversMarkedAsDeleted--,this._observers.splice(o,1),!0)}makeObserverTopPriority(k){this._remove(k,!1),this._observers.unshift(k)}makeObserverBottomPriority(k){this._remove(k,!1),this._observers.push(k)}notifyObservers(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,o=arguments.length>2?arguments[2]:void 0,x=arguments.length>3?arguments[3]:void 0,I=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=k),!this._observers.length)return!0;const q=this._eventState;q.mask=h,q.target=o,q.currentTarget=x,q.skipNextObservers=!1,q.lastReturnValue=k,q.userInfo=I;for(const Y of this._observers)if(!Y._willBeUnregistered&&(Y.mask&h&&(Y.unregisterOnNextCall&&this._deferUnregister(Y),Y.scope?q.lastReturnValue=Y.callback.apply(Y.scope,[k,q]):q.lastReturnValue=Y.callback(k,q)),q.skipNextObservers))return!1;return!0}notifyObserver(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=h),k._willBeUnregistered)return;const x=this._eventState;x.mask=o,x.skipNextObservers=!1,k.unregisterOnNextCall&&this._deferUnregister(k),k.callback(h,x)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const k=this._observers.pop();k&&(k._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const k=new Y;return k._observers=this._observers.slice(0),k}hasSpecificMask(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const h of this._observers)if(h.mask&k||h.mask===k)return!0;return!1}}},11145:(k,h,o)=>{o.d(h,{c:()=>I,e:()=>Y});let x=[];class I{static SetImmediate(k){0===x.length&&setTimeout((()=>{const k=x;x=[];for(const h of k)h()}),1),x.push(k)}}function q(k,h,o){try{if(k())return h(),!0}catch(x){return null===o||void 0===o||o(x),!0}return!1}const Y=function(k,h,o){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,Y=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&q(k,h,o))return null;const J=setInterval((()=>{q(k,h,o)?clearInterval(J):(I-=x,I<0&&(clearInterval(J),null===o||void 0===o||o(new Error("Operation timed out after maximum retries. "+(Y||"")),!0)))}),x);return()=>clearInterval(J)}}}]);