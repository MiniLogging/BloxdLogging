/*! For license information please see eeoa1r.9.1c1640ec.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[9],{10743:function(E,b){!function(E){"use strict";var b=function(E,h){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,b){E.__proto__=b}||function(E,b){for(var h in b)Object.prototype.hasOwnProperty.call(b,h)&&(E[h]=b[h])},b(E,h)};function h(E,h){if("function"!==typeof h&&null!==h)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");function a(){this.constructor=E}b(E,h),E.prototype=null===h?Object.create(h):(a.prototype=h.prototype,new a)}function a(E,b,h,a){var k,G=arguments.length,V=G<3?b:null===a?a=Object.getOwnPropertyDescriptor(b,h):a;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)V=Reflect.decorate(E,b,h,a);else for(var l=E.length-1;l>=0;l--)(k=E[l])&&(V=(G<3?k(V):G>3?k(b,h,V):k(b,h))||V);return G>3&&V&&Object.defineProperty(b,h,V),V}function k(E,b,h){if(h||2===arguments.length)for(var a,k=0,G=b.length;k<G;k++)!a&&k in b||(a||(a=Array.prototype.slice.call(b,0,k)),a[k]=b[k]);return E.concat(a||Array.prototype.slice.call(b))}var G,V=255,l=213;E.OPERATION=void 0,(G=E.OPERATION||(E.OPERATION={}))[G.ADD=128]="ADD",G[G.REPLACE=0]="REPLACE",G[G.DELETE=64]="DELETE",G[G.DELETE_AND_ADD=192]="DELETE_AND_ADD",G[G.TOUCH=1]="TOUCH",G[G.CLEAR=10]="CLEAR";var O=function(){function b(E,b,h){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=E,this.setParent(b,h)}return b.prototype.setParent=function(E,b,h){var a=this;if(this.indexes||(this.indexes=this.ref instanceof NE?this.ref._definition.indexes:{}),this.parent=E,this.parentIndex=h,b)if(this.root=b,this.ref instanceof NE){var k=this.ref._definition;for(var G in k.schema){var V=this.ref[G];if(V&&V.$changes){var l=k.indexes[G];V.$changes.setParent(this.ref,b,l)}}}else"object"===typeof this.ref&&this.ref.forEach((function(E,b){if(E instanceof NE){var h=E.$changes,k=a.ref.$changes.indexes[b];h.setParent(a.ref,a.root,k)}}))},b.prototype.operation=function(E){this.changes.set(--this.currentCustomOperation,E)},b.prototype.change=function(b,h){void 0===h&&(h=E.OPERATION.ADD);var a="number"===typeof b?b:this.indexes[b];this.assertValidIndex(a,b);var k=this.changes.get(a);k&&k.op!==E.OPERATION.DELETE&&k.op!==E.OPERATION.TOUCH||this.changes.set(a,{op:k&&k.op===E.OPERATION.DELETE?E.OPERATION.DELETE_AND_ADD:h,index:a}),this.allChanges.add(a),this.changed=!0,this.touchParents()},b.prototype.touch=function(b){var h="number"===typeof b?b:this.indexes[b];this.assertValidIndex(h,b),this.changes.has(h)||this.changes.set(h,{op:E.OPERATION.TOUCH,index:h}),this.allChanges.add(h),this.touchParents()},b.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},b.prototype.getType=function(E){if(this.ref._definition)return(b=this.ref._definition).schema[b.fieldsByIndex[E]];var b,h=(b=this.parent._definition).schema[b.fieldsByIndex[this.parentIndex]];return Object.values(h)[0]},b.prototype.getChildrenFilter=function(){var E=this.parent._definition.childFilters;return E&&E[this.parentIndex]},b.prototype.getValue=function(E){return this.ref.getByIndex(E)},b.prototype.delete=function(b){var h="number"===typeof b?b:this.indexes[b];if(void 0!==h){var a=this.getValue(h);this.changes.set(h,{op:E.OPERATION.DELETE,index:h}),this.allChanges.delete(h),delete this.caches[h],a&&a.$changes&&(a.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(b," (").concat(h,")"))},b.prototype.discard=function(b,h){var a=this;void 0===b&&(b=!1),void 0===h&&(h=!1),this.ref instanceof NE||this.changes.forEach((function(b){if(b.op===E.OPERATION.DELETE){var h=a.ref.getIndex(b.index);delete a.indexes[h]}})),this.changes.clear(),this.changed=b,h&&this.allChanges.clear(),this.currentCustomOperation=0},b.prototype.discardAll=function(){var E=this;this.changes.forEach((function(b){var h=E.getValue(b.index);h&&h.$changes&&h.$changes.discardAll()})),this.discard()},b.prototype.cache=function(E,b){this.caches[E]=b},b.prototype.clone=function(){return new b(this.ref,this.parent,this.root)},b.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},b.prototype.assertValidIndex=function(E,b){if(void 0===E)throw new Error('ChangeTree: missing index for field "'.concat(b,'"'))},b}();function v(E,b,h,a){return E[b]||(E[b]=[]),E[b].push(h),null===a||void 0===a||a.forEach((function(E,b){return h(E,b)})),function(){return U(E[b],E[b].indexOf(h))}}function s(b){var h=this,a="string"!==typeof this.$changes.getType();this.$items.forEach((function(k,G){b.push({refId:h.$changes.refId,op:E.OPERATION.DELETE,field:G,value:void 0,previousValue:k}),a&&h.$changes.root.removeRef(k.$changes.refId)}))}function U(E,b){if(-1===b||b>=E.length)return!1;for(var h=E.length-1,a=b;a<h;a++)E[a]=E[a+1];return E.length=h,!0}var B=function(E,b){var h=E.toString(),a=b.toString();return h<a?-1:h>a?1:0};function o(E){return E.$proxy=!0,E=new Proxy(E,{get:function(E,b){return"symbol"===typeof b||isNaN(b)?E[b]:E.at(b)},set:function(E,b,h){if("symbol"===typeof b||isNaN(b))E[b]=h;else{var a=Array.from(E.$items.keys()),k=parseInt(a[b]||b);void 0===h||null===h?E.deleteAt(k):E.setAt(k,h)}return!0},deleteProperty:function(E,b){return"number"===typeof b?E.deleteAt(b):delete E[b],!0}})}var u=function(){function b(){for(var E=[],b=0;b<arguments.length;b++)E[b]=arguments[b];this.$changes=new O(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,E)}return b.prototype.Yd=function(b,h){return void 0===h&&(h=!0),v(this.$callbacks||(this.$callbacks=[]),E.OPERATION.ADD,b,h?this.$items:void 0)},b.prototype.ab=function(b){return v(this.$callbacks||(this.$callbacks=[]),E.OPERATION.DELETE,b)},b.prototype.onChange=function(b){return v(this.$callbacks||(this.$callbacks=[]),E.OPERATION.REPLACE,b)},b.is=function(E){return Array.isArray(E)||void 0!==E.array},Object.defineProperty(b.prototype,"length",{get:function(){return this.$items.size},set:function(E){0===E?this.clear():this.splice(E,this.length-E)},enumerable:!1,configurable:!0}),b.prototype.push=function(){for(var E,b=this,h=[],a=0;a<arguments.length;a++)h[a]=arguments[a];return h.forEach((function(h){E=b.$refId++,b.setAt(E,h)})),E},b.prototype.pop=function(){var E=Array.from(this.$indexes.values()).pop();if(void 0!==E){this.$changes.delete(E),this.$indexes.delete(E);var b=this.$items.get(E);return this.$items.delete(E),b}},b.prototype.at=function(E){var b=Array.from(this.$items.keys())[E];return this.$items.get(b)},b.prototype.setAt=function(b,h){var a,k;if(void 0!==h&&null!==h){if(this.$items.get(b)!==h){void 0!==h.$changes&&h.$changes.setParent(this,this.$changes.root,b);var G=null!==(k=null===(a=this.$changes.indexes[b])||void 0===a?void 0:a.op)&&void 0!==k?k:E.OPERATION.ADD;this.$changes.indexes[b]=b,this.$indexes.set(b,b),this.$items.set(b,h),this.$changes.change(b,G)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},b.prototype.deleteAt=function(E){var b=Array.from(this.$items.keys())[E];return void 0!==b&&this.$deleteAt(b)},b.prototype.$deleteAt=function(E){return this.$changes.delete(E),this.$indexes.delete(E),this.$items.delete(E)},b.prototype.clear=function(b){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),b&&s.call(this,b),this.$items.clear(),this.$changes.operation({index:0,op:E.OPERATION.CLEAR}),this.$changes.touchParents()},b.prototype.concat=function(){for(var E,h=[],a=0;a<arguments.length;a++)h[a]=arguments[a];return new(b.bind.apply(b,k([void 0],(E=Array.from(this.$items.values())).concat.apply(E,h),!1)))},b.prototype.join=function(E){return Array.from(this.$items.values()).join(E)},b.prototype.reverse=function(){var E=this,b=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(h,a){E.setAt(b[a],h)})),this},b.prototype.shift=function(){var E=Array.from(this.$items.keys()).shift();if(void 0!==E){var b=this.$items.get(E);return this.$deleteAt(E),b}},b.prototype.slice=function(E,h){var a=new b;return a.push.apply(a,Array.from(this.$items.values()).slice(E,h)),a},b.prototype.sort=function(E){var b=this;void 0===E&&(E=B);var h=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(E).forEach((function(E,a){b.setAt(h[a],E)})),this},b.prototype.splice=function(E,b){void 0===b&&(b=this.length-E);for(var h=Array.from(this.$items.keys()),a=[],k=E;k<E+b;k++)a.push(this.$items.get(h[k])),this.$deleteAt(h[k]);return a},b.prototype.unshift=function(){for(var E=this,b=[],h=0;h<arguments.length;h++)b[h]=arguments[h];var a=this.length,k=b.length,G=Array.from(this.$items.values());return b.forEach((function(b,h){E.setAt(h,b)})),G.forEach((function(b,h){E.setAt(k+h,b)})),a+k},b.prototype.indexOf=function(E,b){return Array.from(this.$items.values()).indexOf(E,b)},b.prototype.lastIndexOf=function(E,b){return void 0===b&&(b=this.length-1),Array.from(this.$items.values()).lastIndexOf(E,b)},b.prototype.every=function(E,b){return Array.from(this.$items.values()).every(E,b)},b.prototype.some=function(E,b){return Array.from(this.$items.values()).some(E,b)},b.prototype.forEach=function(E,b){Array.from(this.$items.values()).forEach(E,b)},b.prototype.map=function(E,b){return Array.from(this.$items.values()).map(E,b)},b.prototype.filter=function(E,b){return Array.from(this.$items.values()).filter(E,b)},b.prototype.reduce=function(E,b){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},b.prototype.reduceRight=function(E,b){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},b.prototype.find=function(E,b){return Array.from(this.$items.values()).find(E,b)},b.prototype.findIndex=function(E,b){return Array.from(this.$items.values()).findIndex(E,b)},b.prototype.fill=function(E,b,h){throw new Error("ArraySchema#fill() not implemented")},b.prototype.copyWithin=function(E,b,h){throw new Error("ArraySchema#copyWithin() not implemented")},b.prototype.toString=function(){return this.$items.toString()},b.prototype.toLocaleString=function(){return this.$items.toLocaleString()},b.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(b,Symbol.species,{get:function(){return b},enumerable:!1,configurable:!0}),b.prototype.entries=function(){return this.$items.entries()},b.prototype.keys=function(){return this.$items.keys()},b.prototype.values=function(){return this.$items.values()},b.prototype.includes=function(E,b){return Array.from(this.$items.values()).includes(E,b)},b.prototype.flatMap=function(E,b){throw new Error("ArraySchema#flatMap() is not supported.")},b.prototype.flat=function(E){throw new Error("ArraySchema#flat() is not supported.")},b.prototype.findLast=function(){var E=Array.from(this.$items.values());return E.findLast.apply(E,arguments)},b.prototype.findLastIndex=function(){var E=Array.from(this.$items.values());return E.findLastIndex.apply(E,arguments)},b.prototype.setIndex=function(E,b){this.$indexes.set(E,b)},b.prototype.getIndex=function(E){return this.$indexes.get(E)},b.prototype.getByIndex=function(E){return this.$items.get(this.$indexes.get(E))},b.prototype.deleteByIndex=function(E){var b=this.$indexes.get(E);this.$items.delete(b),this.$indexes.delete(E)},b.prototype.toArray=function(){return Array.from(this.$items.values())},b.prototype.toJSON=function(){return this.toArray().map((function(E){return"function"===typeof E.toJSON?E.toJSON():E}))},b.prototype.clone=function(E){return E?new(b.bind.apply(b,k([void 0],Array.from(this.$items.values()),!1))):new(b.bind.apply(b,k([void 0],this.map((function(E){return E.$changes?E.clone():E})),!1)))},b}();function D(E){return E.$proxy=!0,E=new Proxy(E,{get:function(E,b){return"symbol"!==typeof b&&"undefined"===typeof E[b]?E.get(b):E[b]},set:function(E,b,h){return"symbol"!==typeof b&&-1===b.indexOf("$")&&"Yd"!==b&&"ab"!==b&&"onChange"!==b?E.set(b,h):E[b]=h,!0},deleteProperty:function(E,b){return E.delete(b),!0}})}var g=function(){function b(E){var h=this;if(this.$changes=new O(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,E)if(E instanceof Map||E instanceof b)E.forEach((function(E,b){return h.set(b,E)}));else for(var a in E)this.set(a,E[a])}return b.prototype.Yd=function(b,h){return void 0===h&&(h=!0),v(this.$callbacks||(this.$callbacks=[]),E.OPERATION.ADD,b,h?this.$items:void 0)},b.prototype.ab=function(b){return v(this.$callbacks||(this.$callbacks=[]),E.OPERATION.DELETE,b)},b.prototype.onChange=function(b){return v(this.$callbacks||(this.$callbacks=[]),E.OPERATION.REPLACE,b)},b.is=function(E){return void 0!==E.map},b.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(b.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(b,Symbol.species,{get:function(){return b},enumerable:!1,configurable:!0}),b.prototype.set=function(b,h){if(void 0===h||null===h)throw new Error("MapSchema#set('".concat(b,"', ").concat(h,"): trying to set ").concat(h," value on '").concat(b,"'."));b=b.toString();var a="undefined"!==typeof this.$changes.indexes[b],k=a?this.$changes.indexes[b]:this.$refId++,G=a?E.OPERATION.REPLACE:E.OPERATION.ADD,V=void 0!==h.$changes;if(V&&h.$changes.setParent(this,this.$changes.root,k),a){if(!V&&this.$items.get(b)===h)return;V&&this.$items.get(b)!==h&&(G=E.OPERATION.ADD)}else this.$changes.indexes[b]=k,this.$indexes.set(k,b);return this.$items.set(b,h),this.$changes.change(b,G),this},b.prototype.get=function(E){return this.$items.get(E)},b.prototype.delete=function(E){return this.$changes.delete(E),this.$items.delete(E)},b.prototype.clear=function(b){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),b&&s.call(this,b),this.$items.clear(),this.$changes.operation({index:0,op:E.OPERATION.CLEAR}),this.$changes.touchParents()},b.prototype.has=function(E){return this.$items.has(E)},b.prototype.forEach=function(E){this.$items.forEach(E)},b.prototype.entries=function(){return this.$items.entries()},b.prototype.keys=function(){return this.$items.keys()},b.prototype.values=function(){return this.$items.values()},Object.defineProperty(b.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),b.prototype.setIndex=function(E,b){this.$indexes.set(E,b)},b.prototype.getIndex=function(E){return this.$indexes.get(E)},b.prototype.getByIndex=function(E){return this.$items.get(this.$indexes.get(E))},b.prototype.deleteByIndex=function(E){var b=this.$indexes.get(E);this.$items.delete(b),this.$indexes.delete(E)},b.prototype.toJSON=function(){var E={};return this.forEach((function(b,h){E[h]="function"===typeof b.toJSON?b.toJSON():b})),E},b.prototype.clone=function(E){var h;return E?h=Object.assign(new b,this):(h=new b,this.forEach((function(E,b){E.$changes?h.set(b,E.clone()):h.set(b,E)}))),h},b}(),S={};function M(E,b){S[E]=b}function I(E){return S[E]}var j=function(){function E(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return E.create=function(b){var h=new E;return h.schema=Object.assign({},b&&b.schema||{}),h.indexes=Object.assign({},b&&b.indexes||{}),h.fieldsByIndex=Object.assign({},b&&b.fieldsByIndex||{}),h.descriptors=Object.assign({},b&&b.descriptors||{}),h.deprecated=Object.assign({},b&&b.deprecated||{}),h},E.prototype.addField=function(E,b){var h=this.getNextFieldIndex();this.fieldsByIndex[h]=E,this.indexes[E]=h,this.schema[E]=Array.isArray(b)?{array:b[0]}:b},E.prototype.hasField=function(E){return void 0!==this.indexes[E]},E.prototype.addFilter=function(E,b){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[E]]=b,this.indexesWithFilters.push(this.indexes[E]),!0},E.prototype.addChildrenFilter=function(E,b){var h=this.indexes[E],a=this.schema[E];if(I(Object.keys(a)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[h]=b,!0;console.warn("@filterChildren: field '".concat(E,"' can't have children. Ignoring filter."))},E.prototype.getChildrenFilter=function(E){return this.childFilters&&this.childFilters[this.indexes[E]]},E.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},E}();function P(E){return E._context&&E._context.useFilters}var A=function(){function E(){this.types={},this.schemas=new Map,this.useFilters=!1}return E.prototype.has=function(E){return this.schemas.has(E)},E.prototype.get=function(E){return this.types[E]},E.prototype.add=function(E,b){void 0===b&&(b=this.schemas.size),E._definition=j.create(E._definition),E._typeid=b,this.types[b]=E,this.schemas.set(E,b)},E.create=function(b){return void 0===b&&(b={}),function(h){return b.context||(b.context=new E),d(h,b)}},E}(),n=new A;function d(E,b){return void 0===b&&(b={}),function(h,a){var G=b.context||n,V=h.constructor;if(V._context=G,!E)throw new Error("".concat(V.name,': @type() reference provided for "').concat(a,"\" is undefined. Make sure you don't have any circular dependencies."));G.has(V)||G.add(V);var l=V._definition;if(l.addField(a,E),l.descriptors[a]){if(l.deprecated[a])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(a,"' definition on '").concat(V.name,"'.\nCheck @type() annotation"))}catch(S){var O=S.stack.split("\n")[4].trim();throw new Error("".concat(S.message," ").concat(O))}}var v=u.is(E),s=!v&&g.is(E);if("string"!==typeof E&&!NE.is(E)){var U=Object.values(E)[0];"string"===typeof U||G.has(U)||G.add(U)}if(b.manual)l.descriptors[a]={enumerable:!0,configurable:!0,writable:!0};else{var B="_".concat(a);l.descriptors[B]={enumerable:!1,configurable:!1,writable:!0},l.descriptors[a]={get:function(){return this[B]},set:function(E){E!==this[B]&&(void 0!==E&&null!==E?(!v||E instanceof u||(E=new(u.bind.apply(u,k([void 0],E,!1)))),!s||E instanceof g||(E=new g(E)),void 0===E.$proxy&&(s?E=D(E):v&&(E=o(E))),this.$changes.change(a),E.$changes&&E.$changes.setParent(this,this.$changes.root,this._definition.indexes[a])):this[B]&&this.$changes.delete(a),this[B]=E)},enumerable:!0,configurable:!0}}}}function c(E){return function(b,h){var a=b.constructor;a._definition.addFilter(h,E)&&(a._context.useFilters=!0)}}function z(E){return function(b,h){var a=b.constructor;a._definition.addChildrenFilter(h,E)&&(a._context.useFilters=!0)}}function Z(E){return void 0===E&&(E=!0),function(b,h){var a=b.constructor._definition;a.deprecated[h]=!0,E&&(a.descriptors[h]={get:function(){throw new Error("".concat(h," is deprecated."))},set:function(E){},enumerable:!1,configurable:!0})}}function Y(E,b,h){for(var a in void 0===h&&(h={}),h.context||(h.context=E._context||h.context||n),b)d(b[a],h)(E.prototype,a);return E}function r(E){for(var b=0,h=0,a=0,k=E.length;a<k;a++)(b=E.charCodeAt(a))<128?h+=1:b<2048?h+=2:b<55296||b>=57344?h+=3:(a++,h+=4);return h}function w(E,b,h){for(var a=0,k=0,G=h.length;k<G;k++)(a=h.charCodeAt(k))<128?E[b++]=a:a<2048?(E[b++]=192|a>>6,E[b++]=128|63&a):a<55296||a>=57344?(E[b++]=224|a>>12,E[b++]=128|a>>6&63,E[b++]=128|63&a):(k++,a=65536+((1023&a)<<10|1023&h.charCodeAt(k)),E[b++]=240|a>>18,E[b++]=128|a>>12&63,E[b++]=128|a>>6&63,E[b++]=128|63&a)}function N(E,b){E.push(255&b)}function H(E,b){E.push(255&b)}function f(E,b){E.push(255&b),E.push(b>>8&255)}function F(E,b){E.push(255&b),E.push(b>>8&255)}function y(E,b){E.push(255&b),E.push(b>>8&255),E.push(b>>16&255),E.push(b>>24&255)}function e(E,b){var h=b>>24,a=b>>16,k=b>>8,G=b;E.push(255&G),E.push(255&k),E.push(255&a),E.push(255&h)}function J(E,b){var h=Math.floor(b/Math.pow(2,32));e(E,b>>>0),e(E,h)}function m(E,b){var h=b/Math.pow(2,32)|0;e(E,b>>>0),e(E,h)}function K(E,b){T(E,b)}function x(E,b){X(E,b)}var W=new Int32Array(2),L=new Float32Array(W.buffer),t=new Float64Array(W.buffer);function T(E,b){L[0]=b,y(E,W[0])}function X(E,b){t[0]=b,y(E,W[0]),y(E,W[1])}function C(E,b){return H(E,b?1:0)}function q(E,b){b||(b="");var h=r(b),a=0;if(h<32)E.push(160|h),a=1;else if(h<256)E.push(217),H(E,h),a=2;else if(h<65536)E.push(218),F(E,h),a=3;else{if(!(h<4294967296))throw new Error("String too long");E.push(219),e(E,h),a=5}return w(E,E.length,b),a+h}function R(E,b){return isNaN(b)?R(E,0):isFinite(b)?b!==(0|b)?(E.push(203),X(E,b),9):b>=0?b<128?(H(E,b),1):b<256?(E.push(204),H(E,b),2):b<65536?(E.push(205),F(E,b),3):b<4294967296?(E.push(206),e(E,b),5):(E.push(207),m(E,b),9):b>=-32?(E.push(224|b+32),1):b>=-128?(E.push(208),N(E,b),2):b>=-32768?(E.push(209),f(E,b),3):b>=-2147483648?(E.push(210),y(E,b),5):(E.push(211),J(E,b),9):R(E,b>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var Q=Object.freeze({__proto__:null,utf8Write:w,int8:N,uint8:H,int16:f,uint16:F,int32:y,uint32:e,int64:J,uint64:m,float32:K,float64:x,writeFloat32:T,writeFloat64:X,boolean:C,string:q,number:R});function i(E,b,h){for(var a="",k=0,G=b,V=b+h;G<V;G++){var l=E[G];0!==(128&l)?192!==(224&l)?224!==(240&l)?240!==(248&l)?console.error("Invalid byte "+l.toString(16)):(k=(7&l)<<18|(63&E[++G])<<12|(63&E[++G])<<6|63&E[++G])>=65536?(k-=65536,a+=String.fromCharCode(55296+(k>>>10),56320+(1023&k))):a+=String.fromCharCode(k):a+=String.fromCharCode((15&l)<<12|(63&E[++G])<<6|63&E[++G]):a+=String.fromCharCode((31&l)<<6|63&E[++G]):a+=String.fromCharCode(l)}return a}function p(E,b){return EE(E,b)<<24>>24}function EE(E,b){return E[b.offset++]}function bE(E,b){return hE(E,b)<<16>>16}function hE(E,b){return E[b.offset++]|E[b.offset++]<<8}function aE(E,b){return E[b.offset++]|E[b.offset++]<<8|E[b.offset++]<<16|E[b.offset++]<<24}function kE(E,b){return aE(E,b)>>>0}function GE(E,b){return BE(E,b)}function VE(E,b){return oE(E,b)}function lE(E,b){var h=kE(E,b);return aE(E,b)*Math.pow(2,32)+h}function OE(E,b){var h=kE(E,b);return kE(E,b)*Math.pow(2,32)+h}var vE=new Int32Array(2),sE=new Float32Array(vE.buffer),UE=new Float64Array(vE.buffer);function BE(E,b){return vE[0]=aE(E,b),sE[0]}function oE(E,b){return vE[0]=aE(E,b),vE[1]=aE(E,b),UE[0]}function uE(E,b){return EE(E,b)>0}function DE(E,b){var h,a=E[b.offset++];a<192?h=31&a:217===a?h=EE(E,b):218===a?h=hE(E,b):219===a&&(h=kE(E,b));var k=i(E,b.offset,h);return b.offset+=h,k}function gE(E,b){var h=E[b.offset];return h<192&&h>160||217===h||218===h||219===h}function SE(E,b){var h=E[b.offset++];return h<128?h:202===h?BE(E,b):203===h?oE(E,b):204===h?EE(E,b):205===h?hE(E,b):206===h?kE(E,b):207===h?OE(E,b):208===h?p(E,b):209===h?bE(E,b):210===h?aE(E,b):211===h?lE(E,b):h>223?-1*(255-h+1):void 0}function ME(E,b){var h=E[b.offset];return h<128||h>=202&&h<=211}function IE(E,b){return E[b.offset]<160}function jE(E,b){return E[b.offset-1]===V&&(E[b.offset]<128||E[b.offset]>=202&&E[b.offset]<=211)}var PE=Object.freeze({__proto__:null,int8:p,uint8:EE,int16:bE,uint16:hE,int32:aE,uint32:kE,float32:GE,float64:VE,int64:lE,uint64:OE,readFloat32:BE,readFloat64:oE,boolean:uE,string:DE,stringCheck:gE,number:SE,numberCheck:ME,arrayCheck:IE,switchStructureCheck:jE}),AE=function(){function b(E){var b=this;this.$changes=new O(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,E&&E.forEach((function(E){return b.add(E)}))}return b.prototype.Yd=function(b,h){return void 0===h&&(h=!0),v(this.$callbacks||(this.$callbacks=[]),E.OPERATION.ADD,b,h?this.$items:void 0)},b.prototype.ab=function(b){return v(this.$callbacks||(this.$callbacks=[]),E.OPERATION.DELETE,b)},b.prototype.onChange=function(b){return v(this.$callbacks||(this.$callbacks=[]),E.OPERATION.REPLACE,b)},b.is=function(E){return void 0!==E.collection},b.prototype.add=function(E){var b=this.$refId++;return void 0!==E.$changes&&E.$changes.setParent(this,this.$changes.root,b),this.$changes.indexes[b]=b,this.$indexes.set(b,b),this.$items.set(b,E),this.$changes.change(b),b},b.prototype.at=function(E){var b=Array.from(this.$items.keys())[E];return this.$items.get(b)},b.prototype.entries=function(){return this.$items.entries()},b.prototype.delete=function(E){for(var b,h,a=this.$items.entries();(h=a.next())&&!h.done;)if(E===h.value[1]){b=h.value[0];break}return void 0!==b&&(this.$changes.delete(b),this.$indexes.delete(b),this.$items.delete(b))},b.prototype.clear=function(b){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),b&&s.call(this,b),this.$items.clear(),this.$changes.operation({index:0,op:E.OPERATION.CLEAR}),this.$changes.touchParents()},b.prototype.has=function(E){return Array.from(this.$items.values()).some((function(b){return b===E}))},b.prototype.forEach=function(E){var b=this;this.$items.forEach((function(h,a,k){return E(h,a,b)}))},b.prototype.values=function(){return this.$items.values()},Object.defineProperty(b.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),b.prototype.setIndex=function(E,b){this.$indexes.set(E,b)},b.prototype.getIndex=function(E){return this.$indexes.get(E)},b.prototype.getByIndex=function(E){return this.$items.get(this.$indexes.get(E))},b.prototype.deleteByIndex=function(E){var b=this.$indexes.get(E);this.$items.delete(b),this.$indexes.delete(E)},b.prototype.toArray=function(){return Array.from(this.$items.values())},b.prototype.toJSON=function(){var E=[];return this.forEach((function(b,h){E.push("function"===typeof b.toJSON?b.toJSON():b)})),E},b.prototype.clone=function(E){var h;return E?h=Object.assign(new b,this):(h=new b,this.forEach((function(E){E.$changes?h.add(E.clone()):h.add(E)}))),h},b}(),nE=function(){function b(E){var b=this;this.$changes=new O(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,E&&E.forEach((function(E){return b.add(E)}))}return b.prototype.Yd=function(b,h){return void 0===h&&(h=!0),v(this.$callbacks||(this.$callbacks=[]),E.OPERATION.ADD,b,h?this.$items:void 0)},b.prototype.ab=function(b){return v(this.$callbacks||(this.$callbacks=[]),E.OPERATION.DELETE,b)},b.prototype.onChange=function(b){return v(this.$callbacks||(this.$callbacks=[]),E.OPERATION.REPLACE,b)},b.is=function(E){return void 0!==E.set},b.prototype.add=function(b){var h,a;if(this.has(b))return!1;var k=this.$refId++;void 0!==b.$changes&&b.$changes.setParent(this,this.$changes.root,k);var G=null!==(a=null===(h=this.$changes.indexes[k])||void 0===h?void 0:h.op)&&void 0!==a?a:E.OPERATION.ADD;return this.$changes.indexes[k]=k,this.$indexes.set(k,k),this.$items.set(k,b),this.$changes.change(k,G),k},b.prototype.entries=function(){return this.$items.entries()},b.prototype.delete=function(E){for(var b,h,a=this.$items.entries();(h=a.next())&&!h.done;)if(E===h.value[1]){b=h.value[0];break}return void 0!==b&&(this.$changes.delete(b),this.$indexes.delete(b),this.$items.delete(b))},b.prototype.clear=function(b){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),b&&s.call(this,b),this.$items.clear(),this.$changes.operation({index:0,op:E.OPERATION.CLEAR}),this.$changes.touchParents()},b.prototype.has=function(E){for(var b,h=this.$items.values(),a=!1;(b=h.next())&&!b.done;)if(E===b.value){a=!0;break}return a},b.prototype.forEach=function(E){var b=this;this.$items.forEach((function(h,a,k){return E(h,a,b)}))},b.prototype.values=function(){return this.$items.values()},Object.defineProperty(b.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),b.prototype.setIndex=function(E,b){this.$indexes.set(E,b)},b.prototype.getIndex=function(E){return this.$indexes.get(E)},b.prototype.getByIndex=function(E){return this.$items.get(this.$indexes.get(E))},b.prototype.deleteByIndex=function(E){var b=this.$indexes.get(E);this.$items.delete(b),this.$indexes.delete(E)},b.prototype.toArray=function(){return Array.from(this.$items.values())},b.prototype.toJSON=function(){var E=[];return this.forEach((function(b,h){E.push("function"===typeof b.toJSON?b.toJSON():b)})),E},b.prototype.clone=function(E){var h;return E?h=Object.assign(new b,this):(h=new b,this.forEach((function(E){E.$changes?h.add(E.clone()):h.add(E)}))),h},b}(),dE=function(){function E(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return E.prototype.addRefId=function(E){this.refIds.has(E)||(this.refIds.add(E),this.containerIndexes.set(E,new Set))},E.get=function(b){return void 0===b.$filterState&&(b.$filterState=new E),b.$filterState},E}(),cE=function(){function E(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return E.prototype.getNextUniqueId=function(){return this.nextUniqueId++},E.prototype.addRef=function(E,b,h){void 0===h&&(h=!0),this.refs.set(E,b),h&&(this.refCounts[E]=(this.refCounts[E]||0)+1)},E.prototype.removeRef=function(E){this.refCounts[E]=this.refCounts[E]-1,this.deletedRefs.add(E)},E.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},E.prototype.garbageCollectDeletedRefs=function(){var E=this;this.deletedRefs.forEach((function(b){if(!(E.refCounts[b]>0)){var h=E.refs.get(b);if(h instanceof NE)for(var a in h._definition.schema)"string"!==typeof h._definition.schema[a]&&h[a]&&h[a].$changes&&E.removeRef(h[a].$changes.refId);else{var k=h.$changes.parent._definition,G=k.schema[k.fieldsByIndex[h.$changes.parentIndex]];"function"===typeof Object.values(G)[0]&&Array.from(h.values()).forEach((function(b){return E.removeRef(b.$changes.refId)}))}E.refs.delete(b),delete E.refCounts[b]}})),this.deletedRefs.clear()},E}(),zE=function(E){function b(){return null!==E&&E.apply(this,arguments)||this}return h(b,E),b}(Error);function ZE(E,b,h,a){var k,G=!1;switch(b){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":k="number",isNaN(E)&&console.log('trying to encode "NaN" in '.concat(h.constructor.name,"#").concat(a));break;case"string":k="string",G=!0;break;case"boolean":return}if(typeof E!==k&&(!G||G&&null!==E)){var V="'".concat(JSON.stringify(E),"'").concat(E&&E.constructor&&" (".concat(E.constructor.name,")")||"");throw new zE("a '".concat(k,"' was expected, but ").concat(V," was provided in ").concat(h.constructor.name,"#").concat(a))}}function YE(E,b,h,a){if(!(E instanceof b))throw new zE("a '".concat(b.name,"' was expected, but '").concat(E.constructor.name,"' was provided in ").concat(h.constructor.name,"#").concat(a))}function rE(E,b,h,a,k){ZE(h,E,a,k);var G=Q[E];if(!G)throw new zE("a '".concat(E,"' was expected, but ").concat(h," was provided in ").concat(a.constructor.name,"#").concat(k));G(b,h)}function wE(E,b,h){return PE[E](b,h)}var NE=function(){function b(){for(var E=[],b=0;b<arguments.length;b++)E[b]=arguments[b];Object.defineProperties(this,{$changes:{value:new O(this,void 0,new cE),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var h=this._definition.descriptors;h&&Object.defineProperties(this,h),E[0]&&this.assign(E[0])}return b.onError=function(E){console.error(E)},b.is=function(E){return E._definition&&void 0!==E._definition.schema},b.prototype.onChange=function(b){return v(this.$callbacks||(this.$callbacks=[]),E.OPERATION.REPLACE,b)},b.prototype.ab=function(b){return v(this.$callbacks||(this.$callbacks=[]),E.OPERATION.DELETE,b)},b.prototype.assign=function(E){return Object.assign(this,E),this},Object.defineProperty(b.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),b.prototype.setDirty=function(E,b){this.$changes.change(E,b)},b.prototype.listen=function(E,b,h){var a=this;return void 0===h&&(h=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[E]||(this.$callbacks[E]=[]),this.$callbacks[E].push(b),h&&void 0!==this[E]&&b(this[E],void 0),function(){return U(a.$callbacks[E],a.$callbacks[E].indexOf(b))}},b.prototype.decode=function(h,a,k){var G;void 0===a&&(a={offset:0}),void 0===k&&(k=this);var l=[],O=this.$changes.root,v=h.length,s=0;for(O.refs.set(s,this);a.offset<v;){var U=h[a.offset++];if(U!=V){var B=k.$changes,o=void 0!==k._definition,D=o?U>>6<<6:U;if(D!==E.OPERATION.CLEAR){var S=o?U%(D||255):SE(h,a),M=o?k._definition.fieldsByIndex[S]:"",j=B.getType(S),P=void 0,A=void 0,n=void 0;if(o?A=k["_".concat(M)]:(A=k.getByIndex(S),(D&E.OPERATION.ADD)===E.OPERATION.ADD?(n=k instanceof g?DE(h,a):S,k.setIndex(S,n)):n=k.getIndex(S)),(D&E.OPERATION.DELETE)===E.OPERATION.DELETE&&(D!==E.OPERATION.DELETE_AND_ADD&&k.deleteByIndex(S),A&&A.$changes&&O.removeRef(A.$changes.refId),P=null),void 0!==M){if(D===E.OPERATION.DELETE);else if(b.is(j)){var d=SE(h,a);if(P=O.refs.get(d),D!==E.OPERATION.REPLACE){var c=this.getSchemaType(h,a,j);P||((P=this.createTypeInstance(c)).$changes.refId=d,A&&(P.$callbacks=A.$callbacks,A.$changes.refId&&d!==A.$changes.refId&&O.removeRef(A.$changes.refId))),O.addRef(d,P,P!==A)}}else if("string"===typeof j)P=wE(j,h,a);else{var z=I(Object.keys(j)[0]),Z=SE(h,a),Y=O.refs.has(Z)?A||O.refs.get(Z):new z.constructor;if((P=Y.clone(!0)).$changes.refId=Z,A&&(P.$callbacks=A.$callbacks,A.$changes.refId&&Z!==A.$changes.refId)){O.removeRef(A.$changes.refId);for(var r=A.entries(),w=void 0;(w=r.next())&&!w.done;){var N=(G=w.value)[0],H=G[1];l.push({refId:Z,op:E.OPERATION.DELETE,field:N,value:void 0,previousValue:H})}}O.addRef(Z,P,Y!==A)}if(null!==P&&void 0!==P)if(P.$changes&&P.$changes.setParent(B.ref,B.root,S),k instanceof b)k[M]=P;else if(k instanceof g)N=n,k.$items.set(N,P),k.$changes.allChanges.add(S);else if(k instanceof u)k.setAt(S,P);else if(k instanceof AE){var f=k.add(P);k.setIndex(S,f)}else k instanceof nE&&!1!==(f=k.add(P))&&k.setIndex(S,f);A!==P&&l.push({refId:s,op:D,field:M,dynamicIndex:n,value:P,previousValue:A})}else{console.warn("@colyseus/schema: definition mismatch");for(var F={offset:a.offset};a.offset<v&&(!jE(h,a)||(F.offset=a.offset+1,!O.refs.has(SE(h,F))));)a.offset++}}else k.clear(l)}else{s=SE(h,a);var y=O.refs.get(s);if(!y)throw new Error('"refId" not found: '.concat(s));k=y}}return this._triggerChanges(l),O.garbageCollectDeletedRefs(),l},b.prototype.encode=function(h,a,k){void 0===h&&(h=!1),void 0===a&&(a=[]),void 0===k&&(k=!1);for(var G=this.$changes,l=new WeakSet,O=[G],v=1,s=0;s<v;s++){var U=O[s],B=U.ref,o=B instanceof b;U.ensureRefId(),l.add(U),U!==G&&(U.changed||h)&&(H(a,V),R(a,U.refId));for(var u=h?Array.from(U.allChanges):Array.from(U.changes.values()),D=0,S=u.length;D<S;D++){var M=h?{op:E.OPERATION.ADD,index:u[D]}:u[D],j=M.index,P=o?B._definition.fieldsByIndex&&B._definition.fieldsByIndex[j]:j,A=a.length;if(M.op!==E.OPERATION.TOUCH)if(o)H(a,j|M.op);else{if(H(a,M.op),M.op===E.OPERATION.CLEAR)continue;R(a,j)}if(o||(M.op&E.OPERATION.ADD)!=E.OPERATION.ADD||B instanceof g&&q(a,U.ref.$indexes.get(j)),M.op!==E.OPERATION.DELETE){var n=U.getType(j),d=U.getValue(j);if(d&&d.$changes&&!l.has(d.$changes)&&(O.push(d.$changes),d.$changes.ensureRefId(),v++),M.op!==E.OPERATION.TOUCH){if(b.is(n))YE(d,n,B,P),R(a,d.$changes.refId),(M.op&E.OPERATION.ADD)===E.OPERATION.ADD&&this.tryEncodeTypeId(a,n,d.constructor);else if("string"===typeof n)rE(n,a,d,B,P);else{var c=I(Object.keys(n)[0]);YE(B["_".concat(P)],c.constructor,B,P),R(a,d.$changes.refId)}k&&U.cache(j,a.slice(A))}}}h||k||U.discard()}return a},b.prototype.encodeAll=function(E){return this.encode(!0,[],E)},b.prototype.applyFilters=function(h,a){var k,G;void 0===a&&(a=!1);for(var l=this,O=new Set,v=dE.get(h),s=[this.$changes],U=1,B=[],o=function(o){var u=s[o];if(O.has(u.refId))return"continue";var D=u.ref,S=D instanceof b;H(B,V),R(B,u.refId);var M=v.refIds.has(u),I=a||!M;v.addRefId(u);var j=v.containerIndexes.get(u),P=I?Array.from(u.allChanges):Array.from(u.changes.values());!a&&S&&D._definition.indexesWithFilters&&D._definition.indexesWithFilters.forEach((function(b){!j.has(b)&&u.allChanges.has(b)&&(I?P.push(b):P.push({op:E.OPERATION.ADD,index:b}))}));for(var A=0,n=P.length;A<n;A++){var d=I?{op:E.OPERATION.ADD,index:P[A]}:P[A];if(d.op!==E.OPERATION.CLEAR){var c=d.index;if(d.op!==E.OPERATION.DELETE){var z=u.getValue(c),Z=u.getType(c);if(S){if((Y=D._definition.filters&&D._definition.filters[c])&&!Y.call(D,h,z,l)){z&&z.$changes&&O.add(z.$changes.refId);continue}}else{var Y,r=u.parent;if((Y=u.getChildrenFilter())&&!Y.call(r,h,D.$indexes.get(c),z,l)){z&&z.$changes&&O.add(z.$changes.refId);continue}}if(z.$changes&&(s.push(z.$changes),U++),d.op!==E.OPERATION.TOUCH)if(d.op===E.OPERATION.ADD||S)B.push.apply(B,null!==(k=u.caches[c])&&void 0!==k?k:[]),j.add(c);else if(j.has(c))B.push.apply(B,null!==(G=u.caches[c])&&void 0!==G?G:[]);else{if(j.add(c),H(B,E.OPERATION.ADD),R(B,c),D instanceof g){var w=u.ref.$indexes.get(c);q(B,w)}z.$changes?R(B,z.$changes.refId):Q[Z](B,z)}else z.$changes&&!S&&(H(B,E.OPERATION.ADD),R(B,c),D instanceof g&&(w=u.ref.$indexes.get(c),q(B,w)),R(B,z.$changes.refId))}else S?H(B,d.op|c):(H(B,d.op),R(B,c))}else H(B,d.op)}},u=0;u<U;u++)o(u);return B},b.prototype.clone=function(){var E,b=new this.constructor,h=this._definition.schema;for(var a in h)"object"===typeof this[a]&&"function"===typeof(null===(E=this[a])||void 0===E?void 0:E.clone)?b[a]=this[a].clone():b[a]=this[a];return b},b.prototype.toJSON=function(){var E=this._definition.schema,b=this._definition.deprecated,h={};for(var a in E)b[a]||null===this[a]||"undefined"===typeof this[a]||(h[a]="function"===typeof this[a].toJSON?this[a].toJSON():this["_".concat(a)]);return h},b.prototype.discardAllChanges=function(){this.$changes.discardAll()},b.prototype.getByIndex=function(E){return this[this._definition.fieldsByIndex[E]]},b.prototype.deleteByIndex=function(E){this[this._definition.fieldsByIndex[E]]=void 0},b.prototype.tryEncodeTypeId=function(E,b,h){b._typeid!==h._typeid&&(H(E,l),R(E,h._typeid))},b.prototype.getSchemaType=function(E,b,h){var a;return E[b.offset]===l&&(b.offset++,a=this.constructor._context.get(SE(E,b))),a||h},b.prototype.createTypeInstance=function(E){var b=new E;return b.$changes.root=this.$changes.root,b},b.prototype._triggerChanges=function(h){for(var a,k,G,V,l,O,v,s,U,B=new Set,o=this.$changes.root.refs,u=function(u){var D=h[u],g=D.refId,S=o.get(g),M=S.$callbacks;if((D.op&E.OPERATION.DELETE)===E.OPERATION.DELETE&&D.previousValue instanceof b&&(null===(k=null===(a=D.previousValue.$callbacks)||void 0===a?void 0:a[E.OPERATION.DELETE])||void 0===k||k.forEach((function(E){return E()}))),!M)return"continue";if(S instanceof b){if(!B.has(g))try{null===(G=null===M||void 0===M?void 0:M[E.OPERATION.REPLACE])||void 0===G||G.forEach((function(E){return E()}))}catch(I){b.onError(I)}try{M.hasOwnProperty(D.field)&&(null===(V=M[D.field])||void 0===V||V.forEach((function(E){return E(D.value,D.previousValue)})))}catch(I){b.onError(I)}}else D.op===E.OPERATION.ADD&&void 0===D.previousValue?null===(l=M[E.OPERATION.ADD])||void 0===l||l.forEach((function(E){var b;return E(D.value,null!==(b=D.dynamicIndex)&&void 0!==b?b:D.field)})):D.op===E.OPERATION.DELETE?void 0!==D.previousValue&&(null===(O=M[E.OPERATION.DELETE])||void 0===O||O.forEach((function(E){var b;return E(D.previousValue,null!==(b=D.dynamicIndex)&&void 0!==b?b:D.field)}))):D.op===E.OPERATION.DELETE_AND_ADD&&(void 0!==D.previousValue&&(null===(v=M[E.OPERATION.DELETE])||void 0===v||v.forEach((function(E){var b;return E(D.previousValue,null!==(b=D.dynamicIndex)&&void 0!==b?b:D.field)}))),null===(s=M[E.OPERATION.ADD])||void 0===s||s.forEach((function(E){var b;return E(D.value,null!==(b=D.dynamicIndex)&&void 0!==b?b:D.field)}))),D.value!==D.previousValue&&(null===(U=M[E.OPERATION.REPLACE])||void 0===U||U.forEach((function(E){var b;return E(D.value,null!==(b=D.dynamicIndex)&&void 0!==b?b:D.field)})));B.add(g)},D=0;D<h.length;D++)u(D)},b._definition=j.create(),b}();function HE(E){for(var b=[E.$changes],h=1,a={},k=a,G=function(E){var h=b[E];h.changes.forEach((function(E){var b=h.ref,a=E.index,G=b._definition?b._definition.fieldsByIndex[a]:b.$indexes.get(a);k[G]=h.getValue(a)}))},V=0;V<h;V++)G(V);return a}var fE={context:new A},FE=function(E){function b(){return null!==E&&E.apply(this,arguments)||this}return h(b,E),a([d("string",fE)],b.prototype,"name",void 0),a([d("string",fE)],b.prototype,"type",void 0),a([d("number",fE)],b.prototype,"referencedType",void 0),b}(NE),yE=function(E){function b(){var b=null!==E&&E.apply(this,arguments)||this;return b.fields=new u,b}return h(b,E),a([d("number",fE)],b.prototype,"id",void 0),a([d([FE],fE)],b.prototype,"fields",void 0),b}(NE),eE=function(E){function b(){var b=null!==E&&E.apply(this,arguments)||this;return b.types=new u,b}return h(b,E),b.encode=function(E){var h=E.constructor,a=new b;a.rootType=h._typeid;var k=function(E,b){for(var h in b){var k=new FE;k.name=h;var G=void 0;if("string"===typeof b[h])G=b[h];else{var V=b[h],l=void 0;NE.is(V)?(G="ref",l=b[h]):"string"===typeof V[G=Object.keys(V)[0]]?G+=":"+V[G]:l=V[G],k.referencedType=l?l._typeid:-1}k.type=G,E.fields.push(k)}a.types.push(E)},G=h._context.types;for(var V in G){var l=new yE;l.id=Number(V),k(l,G[V]._definition.schema)}return a.encodeAll()},b.decode=function(E,a){var k=new A,G=new b;G.decode(E,a);var V=G.types.reduce((function(E,b){var a=function(E){function b(){return null!==E&&E.apply(this,arguments)||this}return h(b,E),b}(NE),G=b.id;return E[G]=a,k.add(a,G),E}),{});G.types.forEach((function(E){var b=V[E.id];E.fields.forEach((function(E){var h;if(void 0!==E.referencedType){var a=E.type,G=V[E.referencedType];if(!G){var l=E.type.split(":");a=l[0],G=l[1]}"ref"===a?d(G,{context:k})(b.prototype,E.name):d(((h={})[a]=G,h),{context:k})(b.prototype,E.name)}else d(E.type,{context:k})(b.prototype,E.name)}))}));var l=V[G.rootType],O=new l;for(var v in l._definition.schema){var s=l._definition.schema[v];"string"!==typeof s&&(O[v]="function"===typeof s?new s:new(I(Object.keys(s)[0]).constructor))}return O},a([d([yE],fE)],b.prototype,"types",void 0),a([d("number",fE)],b.prototype,"rootType",void 0),b}(NE);M("map",{constructor:g}),M("array",{constructor:u}),M("set",{constructor:nE}),M("collection",{constructor:AE}),E.ArraySchema=u,E.CollectionSchema=AE,E.Context=A,E.MapSchema=g,E.Reflection=eE,E.ReflectionField=FE,E.ReflectionType=yE,E.Schema=NE,E.SchemaDefinition=j,E.SetSchema=nE,E.decode=PE,E.defineTypes=Y,E.deprecated=Z,E.dumpChanges=HE,E.encode=Q,E.filter=c,E.filterChildren=z,E.hasFilter=P,E.registerType=M,E.type=d,Object.defineProperty(E,"__esModule",{value:!0})}(b)},12403:E=>{E.exports=function(E){return null!=E&&null!=E.constructor&&"function"===typeof E.constructor.isBuffer&&E.constructor.isBuffer(E)}},12380:(E,b,h)=>{"use strict";var a=h(12389),k=h(12395),G=h(12403);h.g.__TYPEDARRAY_POOL||(h.g.__TYPEDARRAY_POOL={UINT8:k([32,0]),UINT16:k([32,0]),UINT32:k([32,0]),INT8:k([32,0]),INT16:k([32,0]),INT32:k([32,0]),FLOAT:k([32,0]),DOUBLE:k([32,0]),DATA:k([32,0]),UINT8C:k([32,0]),BUFFER:k([32,0])});var V="undefined"!==typeof Uint8ClampedArray,l=h.g.__TYPEDARRAY_POOL;l.UINT8C||(l.UINT8C=k([32,0])),l.BUFFER||(l.BUFFER=k([32,0]));var O=l.DATA,v=l.BUFFER;function s(E){if(E){var b=E.length||E.byteLength,h=a.log2(b);O[h].push(E)}}function U(E){E=a.nextPow2(E);var b=a.log2(E),h=O[b];return h.length>0?h.pop():new ArrayBuffer(E)}function B(E){return new Uint8Array(U(E),0,E)}function o(E){return new Uint16Array(U(2*E),0,E)}function u(E){return new Uint32Array(U(4*E),0,E)}function D(E){return new Int8Array(U(E),0,E)}function g(E){return new Int16Array(U(2*E),0,E)}function S(E){return new Int32Array(U(4*E),0,E)}function M(E){return new Float32Array(U(4*E),0,E)}function I(E){return new Float64Array(U(8*E),0,E)}function j(E){return V?new Uint8ClampedArray(U(E),0,E):B(E)}function P(E){return new DataView(U(E),0,E)}b.free=function(E){if(G(E))v[a.log2(E.length)].push(E);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(E)&&(E=E.buffer),!E)return;var b=E.length||E.byteLength,h=0|a.log2(b);O[h].push(E)}},b.freeUint8=b.freeUint16=b.freeUint32=b.freeInt8=b.freeInt16=b.freeInt32=b.freeFloat32=b.freeFloat=b.freeFloat64=b.freeDouble=b.freeUint8Clamped=b.freeDataView=function(E){s(E.buffer)},b.freeArrayBuffer=s,b.freeBuffer=function(E){v[a.log2(E.length)].push(E)},b.malloc=function(E,b){if(void 0===b||"arraybuffer"===b)return U(E);switch(b){case"uint8":return B(E);case"uint16":return o(E);case"uint32":return u(E);case"int8":return D(E);case"int16":return g(E);case"int32":return S(E);case"float":case"float32":return M(E);case"double":case"float64":return I(E);case"uint8_clamped":return j(E);case"buffer":throw"Buffer not supported";case"data":case"dataview":return P(E);default:return null}return null},b.mallocArrayBuffer=U,b.mallocUint8=B,b.mallocUint16=o,b.mallocUint32=u,b.mallocInt8=D,b.mallocInt16=g,b.mallocInt32=S,b.mallocFloat32=b.mallocFloat=M,b.mallocFloat64=b.mallocDouble=I,b.mallocUint8Clamped=j,b.mallocDataView=P,b.clearCache=function(){for(var E=0;E<32;++E)l.UINT8[E].length=0,l.UINT16[E].length=0,l.UINT32[E].length=0,l.INT8[E].length=0,l.INT16[E].length=0,l.INT32[E].length=0,l.FLOAT[E].length=0,l.DOUBLE[E].length=0,l.UINT8C[E].length=0,O[E].length=0,v[E].length=0}},12478:(E,b,h)=>{E.exports=k;var a=h(136);function k(E,b){if(!(this instanceof k))return new k(E,b);var h=a.create();a.add(h,E,b),this.base=a.min(a.create(),E,h),this.mh=a.clone(b),this.max=a.max(a.create(),E,h),this.mag=a.length(this.mh)}var G=k.prototype;G.width=function(){return this.mh[0]},G.height=function(){return this.mh[1]},G.depth=function(){return this.mh[2]},G.x0=function(){return this.base[0]},G.y0=function(){return this.base[1]},G.z0=function(){return this.base[2]},G.x1=function(){return this.max[0]},G.y1=function(){return this.max[1]},G.z1=function(){return this.max[2]},G.translate=function(E){return a.add(this.max,this.max,E),a.add(this.base,this.base,E),this},G.setPosition=function(E){return a.add(this.max,E,this.mh),a.i(this.base,E),this},G.expand=function(E){var b=a.create(),h=a.create();return a.max(b,E.max,this.max),a.min(h,E.base,this.base),a.Xc(b,b,h),new k(h,b)},G.intersects=function(E){return!(E.base[0]>this.max[0])&&(!(E.base[1]>this.max[1])&&(!(E.base[2]>this.max[2])&&(!(E.max[0]<this.base[0])&&(!(E.max[1]<this.base[1])&&!(E.max[2]<this.base[2])))))},G.touches=function(E){var b=this.union(E);return null!==b&&(0==b.width()||0==b.height()||0==b.depth())},G.union=function(E){if(!this.intersects(E))return null;var b=Math.max(E.base[0],this.base[0]),h=Math.max(E.base[1],this.base[1]),a=Math.max(E.base[2],this.base[2]);return new k([b,h,a],[Math.min(E.max[0],this.max[0])-b,Math.min(E.max[1],this.max[1])-h,Math.min(E.max[2],this.max[2])-a])}},12389:(E,b)=>{"use strict";function h(E){var b=32;return(E&=-E)&&b--,65535&E&&(b-=16),16711935&E&&(b-=8),252645135&E&&(b-=4),858993459&E&&(b-=2),1431655765&E&&(b-=1),b}b.INT_BITS=32,b.INT_MAX=2147483647,b.INT_MIN=-1<<31,b.sign=function(E){return(E>0)-(E<0)},b.abs=function(E){var b=E>>31;return(E^b)-b},b.min=function(E,b){return b^(E^b)&-(E<b)},b.max=function(E,b){return E^(E^b)&-(E<b)},b.isPow2=function(E){return!(E&E-1)&&!!E},b.log2=function(E){var b,h;return b=(E>65535)<<4,b|=h=((E>>>=b)>255)<<3,b|=h=((E>>>=h)>15)<<2,(b|=h=((E>>>=h)>3)<<1)|(E>>>=h)>>1},b.log10=function(E){return E>=1e9?9:E>=1e8?8:E>=1e7?7:E>=1e6?6:E>=1e5?5:E>=1e4?4:E>=1e3?3:E>=100?2:E>=10?1:0},b.popCount=function(E){return 16843009*((E=(858993459&(E-=E>>>1&1431655765))+(E>>>2&858993459))+(E>>>4)&252645135)>>>24},b.countTrailingZeros=h,b.nextPow2=function(E){return E+=0===E,--E,E|=E>>>1,E|=E>>>2,E|=E>>>4,E|=E>>>8,(E|=E>>>16)+1},b.prevPow2=function(E){return E|=E>>>1,E|=E>>>2,E|=E>>>4,E|=E>>>8,(E|=E>>>16)-(E>>>1)},b.parity=function(E){return E^=E>>>16,E^=E>>>8,E^=E>>>4,27030>>>(E&=15)&1};var a=new Array(256);!function(E){for(var b=0;b<256;++b){var h=b,a=b,k=7;for(h>>>=1;h;h>>>=1)a<<=1,a|=1&h,--k;E[b]=a<<k&255}}(a),b.reverse=function(E){return a[255&E]<<24|a[E>>>8&255]<<16|a[E>>>16&255]<<8|a[E>>>24&255]},b.interleave2=function(E,b){return(E=1431655765&((E=858993459&((E=252645135&((E=16711935&((E&=65535)|E<<8))|E<<4))|E<<2))|E<<1))|(b=1431655765&((b=858993459&((b=252645135&((b=16711935&((b&=65535)|b<<8))|b<<4))|b<<2))|b<<1))<<1},b.deinterleave2=function(E,b){return(E=65535&((E=16711935&((E=252645135&((E=858993459&((E=E>>>b&1431655765)|E>>>1))|E>>>2))|E>>>4))|E>>>16))<<16>>16},b.interleave3=function(E,b,h){return E=1227133513&((E=3272356035&((E=251719695&((E=4278190335&((E&=1023)|E<<16))|E<<8))|E<<4))|E<<2),(E|=(b=1227133513&((b=3272356035&((b=251719695&((b=4278190335&((b&=1023)|b<<16))|b<<8))|b<<4))|b<<2))<<1)|(h=1227133513&((h=3272356035&((h=251719695&((h=4278190335&((h&=1023)|h<<16))|h<<8))|h<<4))|h<<2))<<2},b.deinterleave3=function(E,b){return(E=1023&((E=4278190335&((E=251719695&((E=3272356035&((E=E>>>b&1227133513)|E>>>2))|E>>>4))|E>>>8))|E>>>16))<<22>>22},b.nextCombination=function(E){var b=E|E-1;return b+1|(~b&-~b)-1>>>h(E)+1}},12374:(E,b,h)=>{"use strict";E.exports=function(E,b,h){switch(arguments.length){case 1:return a=[],v(k=E,k,s,!0),a;case 2:return"function"===typeof b?v(E,E,b,!0):function(E,b){return a=[],v(E,b,s,!1),a}(E,b);case 3:return v(E,b,h,!1);default:throw new Error("box-intersect: Invalid arguments")}var k};var a,k=h(12380),G=h(12412),V=h(12422);function l(E,b){for(var h=0;h<E;++h)if(!(b[h]<=b[h+E]))return!0;return!1}function O(E,b,h,a){for(var k=0,G=0,V=0,O=E.length;V<O;++V){var v=E[V];if(!l(b,v)){for(var s=0;s<2*b;++s)h[k++]=v[s];a[G++]=V}}return G}function v(E,b,h,a){var l=E.length,v=b.length;if(!(l<=0||v<=0)){var s=E[0].length>>>1;if(!(s<=0)){var U,B=k.mallocDouble(2*s*l),o=k.mallocInt32(l);if((l=O(E,s,B,o))>0){if(1===s&&a)G.init(l),U=G.sweepComplete(s,h,0,l,B,o,0,l,B,o);else{var u=k.mallocDouble(2*s*v),D=k.mallocInt32(v);(v=O(b,s,u,D))>0&&(G.init(l+v),U=1===s?G.sweepBipartite(s,h,0,l,B,o,0,v,u,D):V(s,h,a,l,B,o,v,u,D),k.free(u),k.free(D))}k.free(B),k.free(o)}return U}}}function s(E,b){a.push([E,b])}},12425:(E,b)=>{"use strict";var h="d",a="ax",k="fp",G="es",V="rs",l="re",O="rb",v="bs",s="be",U="bb",B=[h,a,"vv",V,l,O,"ri",v,s,U,"bi"];function o(E){var b="bruteForce"+(E?"Full":"Partial"),a=[],V=B.slice();E||V.splice(3,0,k);var l=["function "+b+"("+V.join()+"){"];function O(b,k){var V=function(E,b,a){var k="bruteForce"+(E?"Red":"Blue")+(b?"Flip":"")+(a?"Full":""),V=["function ",k,"(",B.join(),"){","var ",G,"=2*",h,";"],l="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",O="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(a?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return E?V.push(l,"Q",":",O):V.push(O,"Q",":",l),a?V.push("if(y1<x0||x1<y0)continue;"):b?V.push("if(y0<=x0||x1<y0)continue;"):V.push("if(y0<x0||x1<y0)continue;"),V.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),b?V.push("yi,xi"):V.push("xi,yi"),V.push(");if(rv!==void 0)return rv;}}}"),{name:k,code:V.join("")}}(b,k,E);a.push(V.code),l.push("return "+V.name+"("+B.join()+");")}l.push("if(re-rs>be-bs){"),E?(O(!0,!1),l.push("}else{"),O(!1,!1)):(l.push("if(fp){"),O(!0,!0),l.push("}else{"),O(!0,!1),l.push("}}else{if(fp){"),O(!1,!0),l.push("}else{"),O(!1,!1),l.push("}")),l.push("}}return "+b);var v=a.join("")+l.join("");return new Function(v)()}b.partial=o(!1),b.full=o(!0)},12422:(E,b,h)=>{"use strict";E.exports=function(E,b,h,G,s,Z,Y,r,w){!function(E,b){var h=8*k.log2(b+1)*(E+1)|0,G=k.nextPow2(j*h);A.length<G&&(a.free(A),A=a.mallocInt32(G));var V=k.nextPow2(P*h);n.length<V&&(a.free(n),n=a.mallocDouble(V))}(E,G+Y);var N,H=0,f=2*E;d(H++,0,0,G,0,Y,h?16:0,-1/0,1/0),h||d(H++,0,0,Y,0,G,1,-1/0,1/0);for(;H>0;){var F=(H-=1)*j,y=A[F],e=A[F+1],J=A[F+2],m=A[F+3],K=A[F+4],x=A[F+5],W=H*P,L=n[W],t=n[W+1],T=1&x,X=!!(16&x),C=s,q=Z,R=r,Q=w;if(T&&(C=r,q=w,R=s,Q=Z),!(2&x&&e>=(J=g(E,y,e,J,C,q,t)))&&!(4&x&&(e=S(E,y,e,J,C,q,L))>=J)){var i=J-e,p=K-m;if(X){if(E*i*(i+p)<o){if(void 0!==(N=O.scanComplete(E,y,b,e,J,C,q,m,K,R,Q)))return N;continue}}else{if(E*Math.min(i,p)<U){if(void 0!==(N=V(E,y,b,T,e,J,C,q,m,K,R,Q)))return N;continue}if(E*i*p<B){if(void 0!==(N=O.scanBipartite(E,y,b,T,e,J,C,q,m,K,R,Q)))return N;continue}}var EE=u(E,y,e,J,C,q,L,t);if(e<EE)if(E*(EE-e)<U){if(void 0!==(N=l(E,y+1,b,e,EE,C,q,m,K,R,Q)))return N}else if(y===E-2){if(void 0!==(N=T?O.sweepBipartite(E,b,m,K,R,Q,e,EE,C,q):O.sweepBipartite(E,b,e,EE,C,q,m,K,R,Q)))return N}else d(H++,y+1,e,EE,m,K,T,-1/0,1/0),d(H++,y+1,m,K,e,EE,1^T,-1/0,1/0);if(EE<J){var bE=v(E,y,m,K,R,Q),hE=R[f*bE+y],aE=D(E,y,bE,K,R,Q,hE);if(aE<K&&d(H++,y,EE,J,aE,K,(4|T)+(X?16:0),hE,t),m<bE&&d(H++,y,EE,J,m,bE,(2|T)+(X?16:0),L,hE),bE+1===aE){if(void 0!==(N=X?z(E,y,b,EE,J,C,q,bE,R,Q[bE]):c(E,y,b,T,EE,J,C,q,bE,R,Q[bE])))return N}else if(bE<aE){var kE;if(X){if(EE<(kE=M(E,y,EE,J,C,q,hE))){var GE=D(E,y,EE,kE,C,q,hE);if(y===E-2){if(EE<GE&&void 0!==(N=O.sweepComplete(E,b,EE,GE,C,q,bE,aE,R,Q)))return N;if(GE<kE&&void 0!==(N=O.sweepBipartite(E,b,GE,kE,C,q,bE,aE,R,Q)))return N}else EE<GE&&d(H++,y+1,EE,GE,bE,aE,16,-1/0,1/0),GE<kE&&(d(H++,y+1,GE,kE,bE,aE,0,-1/0,1/0),d(H++,y+1,bE,aE,GE,kE,1,-1/0,1/0))}}else EE<(kE=T?I(E,y,EE,J,C,q,hE):M(E,y,EE,J,C,q,hE))&&(y===E-2?N=T?O.sweepBipartite(E,b,bE,aE,R,Q,EE,kE,C,q):O.sweepBipartite(E,b,EE,kE,C,q,bE,aE,R,Q):(d(H++,y+1,EE,kE,bE,aE,T,-1/0,1/0),d(H++,y+1,bE,aE,EE,kE,1^T,-1/0,1/0)))}}}}};var a=h(12380),k=h(12389),G=h(12425),V=G.partial,l=G.full,O=h(12412),v=h(12432),s=h(12440),U=128,B=1<<22,o=1<<22,u=s("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),D=s("lo===p0",["p0"]),g=s("lo<p0",["p0"]),S=s("hi<=p0",["p0"]),M=s("lo<=p0&&p0<=hi",["p0"]),I=s("lo<p0&&p0<=hi",["p0"]),j=6,P=2,A=a.mallocInt32(1024),n=a.mallocDouble(1024);function d(E,b,h,a,k,G,V,l,O){var v=j*E;A[v]=b,A[v+1]=h,A[v+2]=a,A[v+3]=k,A[v+4]=G,A[v+5]=V;var s=P*E;n[s]=l,n[s+1]=O}function c(E,b,h,a,k,G,V,l,O,v,s){var U=2*E,B=O*U,o=v[B+b];E:for(var u=k,D=k*U;u<G;++u,D+=U){var g=V[D+b],S=V[D+b+E];if(!(o<g||S<o)&&(!a||o!==g)){for(var M,I=l[u],j=b+1;j<E;++j){g=V[D+j],S=V[D+j+E];var P=v[B+j],A=v[B+j+E];if(S<P||A<g)continue E}if(void 0!==(M=a?h(s,I):h(I,s)))return M}}}function z(E,b,h,a,k,G,V,l,O,v){var s=2*E,U=l*s,B=O[U+b];E:for(var o=a,u=a*s;o<k;++o,u+=s){var D=V[o];if(D!==v){var g=G[u+b],S=G[u+b+E];if(!(B<g||S<B)){for(var M=b+1;M<E;++M){g=G[u+M],S=G[u+M+E];var I=O[U+M],j=O[U+M+E];if(S<I||j<g)continue E}var P=h(D,v);if(void 0!==P)return P}}}}},12432:(E,b,h)=>{"use strict";E.exports=function(E,b,h,V,l,O){if(V<=h+1)return h;var v=h,s=V,U=V+h>>>1,B=2*E,o=U,u=l[B*U+b];for(;v<s;){if(s-v<k){G(E,b,v,s,l,O),u=l[B*U+b];break}var D=s-v,g=Math.random()*D+v|0,S=l[B*g+b],M=Math.random()*D+v|0,I=l[B*M+b],j=Math.random()*D+v|0,P=l[B*j+b];S<=I?P>=I?(o=M,u=I):S>=P?(o=g,u=S):(o=j,u=P):I>=P?(o=M,u=I):P>=S?(o=g,u=S):(o=j,u=P);for(var A=B*(s-1),n=B*o,d=0;d<B;++d,++A,++n){var c=l[A];l[A]=l[n],l[n]=c}var z=O[s-1];O[s-1]=O[o],O[o]=z;for(A=B*(s-1),n=B*(o=a(E,b,v,s-1,l,O,u)),d=0;d<B;++d,++A,++n){c=l[A];l[A]=l[n],l[n]=c}z=O[s-1];if(O[s-1]=O[o],O[o]=z,U<o){for(s=o-1;v<s&&l[B*(s-1)+b]===u;)s-=1;s+=1}else{if(!(o<U))break;for(v=o+1;v<s&&l[B*v+b]===u;)v+=1}}return a(E,b,h,U,l,O,l[B*U+b])};var a=h(12440)("lo<p0",["p0"]),k=8;function G(E,b,h,a,k,G){for(var V=2*E,l=V*(h+1)+b,O=h+1;O<a;++O,l+=V)for(var v=k[l],s=O,U=V*(O-1);s>h&&k[U+b]>v;--s,U-=V){for(var B=U,o=U+V,u=0;u<V;++u,++B,++o){var D=k[B];k[B]=k[o],k[o]=D}var g=G[s];G[s]=G[s-1],G[s-1]=g}}},12440:E=>{"use strict";E.exports=function(E,h){var a="abcdef".split("").concat(h),k=[];E.indexOf("lo")>=0&&k.push("lo=e[k+n]");E.indexOf("hi")>=0&&k.push("hi=e[k+o]");return a.push(b.replace("_",k.join()).replace("$",E)),Function.apply(void 0,a)};var b="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},12415:E=>{"use strict";E.exports=function(E,a){a<=4*b?h(0,a-1,E):v(0,a-1,E)};var b=32;function h(E,b,h){for(var a=2*(E+1),k=E+1;k<=b;++k){for(var G=h[a++],V=h[a++],l=k,O=a-2;l-- >E;){var v=h[O-2],s=h[O-1];if(v<G)break;if(v===G&&s<V)break;h[O]=v,h[O+1]=s,O-=2}h[O]=G,h[O+1]=V}}function a(E,b,h){b*=2;var a=h[E*=2],k=h[E+1];h[E]=h[b],h[E+1]=h[b+1],h[b]=a,h[b+1]=k}function k(E,b,h){b*=2,h[E*=2]=h[b],h[E+1]=h[b+1]}function G(E,b,h,a){b*=2,h*=2;var k=a[E*=2],G=a[E+1];a[E]=a[b],a[E+1]=a[b+1],a[b]=a[h],a[b+1]=a[h+1],a[h]=k,a[h+1]=G}function V(E,b,h,a,k){b*=2,k[E*=2]=k[b],k[b]=h,k[E+1]=k[b+1],k[b+1]=a}function l(E,b,h){b*=2;var a=h[E*=2],k=h[b];return!(a<k)&&(a!==k||h[E+1]>h[b+1])}function O(E,b,h,a){var k=a[E*=2];return k<b||k===b&&a[E+1]<h}function v(E,s,U){var B=(s-E+1)/6|0,o=E+B,u=s-B,D=E+s>>1,g=D-B,S=D+B,M=o,I=g,j=D,P=S,A=u,n=E+1,d=s-1,c=0;l(M,I,U)&&(c=M,M=I,I=c),l(P,A,U)&&(c=P,P=A,A=c),l(M,j,U)&&(c=M,M=j,j=c),l(I,j,U)&&(c=I,I=j,j=c),l(M,P,U)&&(c=M,M=P,P=c),l(j,P,U)&&(c=j,j=P,P=c),l(I,A,U)&&(c=I,I=A,A=c),l(I,j,U)&&(c=I,I=j,j=c),l(P,A,U)&&(c=P,P=A,A=c);for(var z=U[2*I],Z=U[2*I+1],Y=U[2*P],r=U[2*P+1],w=2*M,N=2*j,H=2*A,f=2*o,F=2*D,y=2*u,e=0;e<2;++e){var J=U[w+e],m=U[N+e],K=U[H+e];U[f+e]=J,U[F+e]=m,U[y+e]=K}k(g,E,U),k(S,s,U);for(var x=n;x<=d;++x)if(O(x,z,Z,U))x!==n&&a(x,n,U),++n;else if(!O(x,Y,r,U))for(;;){if(O(d,Y,r,U)){O(d,z,Z,U)?(G(x,n,d,U),++n,--d):(a(x,d,U),--d);break}if(--d<x)break}V(E,n-1,z,Z,U),V(s,d+1,Y,r,U),n-2-E<=b?h(E,n-2,U):v(E,n-2,U),s-(d+2)<=b?h(d+2,s,U):v(d+2,s,U),d-n<=b?h(n,d,U):v(n,d,U)}},12412:(E,b,h)=>{"use strict";E.exports={init:function(E){var b=k.nextPow2(E);O.length<b&&(a.free(O),O=a.mallocInt32(b));v.length<b&&(a.free(v),v=a.mallocInt32(b));s.length<b&&(a.free(s),s=a.mallocInt32(b));U.length<b&&(a.free(U),U=a.mallocInt32(b));B.length<b&&(a.free(B),B=a.mallocInt32(b));o.length<b&&(a.free(o),o=a.mallocInt32(b));var h=8*b;u.length<h&&(a.free(u),u=a.mallocDouble(h))},sweepBipartite:function(E,b,h,a,k,l,B,o,S,M){for(var I=0,j=2*E,P=E-1,A=j-1,n=h;n<a;++n){var d=l[n],c=j*n;u[I++]=k[c+P],u[I++]=-(d+1),u[I++]=k[c+A],u[I++]=d}for(n=B;n<o;++n){d=M[n]+V;var z=j*n;u[I++]=S[z+P],u[I++]=-d,u[I++]=S[z+A],u[I++]=d}var Z=I>>>1;G(u,Z);var Y=0,r=0;for(n=0;n<Z;++n){var w=0|u[2*n+1];if(w>=V)D(s,U,r--,w=w-V|0);else if(w>=0)D(O,v,Y--,w);else if(w<=-V){w=-w-V|0;for(var N=0;N<Y;++N){if(void 0!==(H=b(O[N],w)))return H}g(s,U,r++,w)}else{w=-w-1|0;for(N=0;N<r;++N){var H;if(void 0!==(H=b(w,s[N])))return H}g(O,v,Y++,w)}}},sweepComplete:function(E,b,h,a,k,V,l,S,M,I){for(var j=0,P=2*E,A=E-1,n=P-1,d=h;d<a;++d){var c=V[d]+1<<1,z=P*d;u[j++]=k[z+A],u[j++]=-c,u[j++]=k[z+n],u[j++]=c}for(d=l;d<S;++d){c=I[d]+1<<1;var Z=P*d;u[j++]=M[Z+A],u[j++]=1|-c,u[j++]=M[Z+n],u[j++]=1|c}var Y=j>>>1;G(u,Y);var r=0,w=0,N=0;for(d=0;d<Y;++d){var H=0|u[2*d+1],f=1&H;if(d<Y-1&&H>>1===u[2*d+3]>>1&&(f=2,d+=1),H<0){for(var F=-(H>>1)-1,y=0;y<N;++y){if(void 0!==(e=b(B[y],F)))return e}if(0!==f)for(y=0;y<r;++y){if(void 0!==(e=b(O[y],F)))return e}if(1!==f)for(y=0;y<w;++y){var e;if(void 0!==(e=b(s[y],F)))return e}0===f?g(O,v,r++,F):1===f?g(s,U,w++,F):2===f&&g(B,o,N++,F)}else{F=(H>>1)-1;0===f?D(O,v,r--,F):1===f?D(s,U,w--,F):2===f&&D(B,o,N--,F)}}},scanBipartite:function(E,b,h,a,k,l,s,U,B,o,S,M){var I=0,j=2*E,P=b,A=b+E,n=1,d=1;a?d=V:n=V;for(var c=k;c<l;++c){var z=c+n,Z=j*c;u[I++]=s[Z+P],u[I++]=-z,u[I++]=s[Z+A],u[I++]=z}for(c=B;c<o;++c){z=c+d;var Y=j*c;u[I++]=S[Y+P],u[I++]=-z}var r=I>>>1;G(u,r);var w=0;for(c=0;c<r;++c){var N=0|u[2*c+1];if(N<0){var H=!1;if((z=-N)>=V?(H=!a,z-=V):(H=!!a,z-=1),H)g(O,v,w++,z);else{var f=M[z],F=j*z,y=S[F+b+1],e=S[F+b+1+E];E:for(var J=0;J<w;++J){var m=O[J],K=j*m;if(!(e<s[K+b+1]||s[K+b+1+E]<y)){for(var x=b+2;x<E;++x)if(S[F+x+E]<s[K+x]||s[K+x+E]<S[F+x])continue E;var W,L=U[m];if(void 0!==(W=a?h(f,L):h(L,f)))return W}}}}else D(O,v,w--,N-n)}},scanComplete:function(E,b,h,a,k,l,v,s,U,B,o){for(var D=0,g=2*E,S=b,M=b+E,I=a;I<k;++I){var j=I+V,P=g*I;u[D++]=l[P+S],u[D++]=-j,u[D++]=l[P+M],u[D++]=j}for(I=s;I<U;++I){j=I+1;var A=g*I;u[D++]=B[A+S],u[D++]=-j}var n=D>>>1;G(u,n);var d=0;for(I=0;I<n;++I){var c=0|u[2*I+1];if(c<0){if((j=-c)>=V)O[d++]=j-V;else{var z=o[j-=1],Z=g*j,Y=B[Z+b+1],r=B[Z+b+1+E];E:for(var w=0;w<d;++w){var N=O[w],H=v[N];if(H===z)break;var f=g*N;if(!(r<l[f+b+1]||l[f+b+1+E]<Y)){for(var F=b+2;F<E;++F)if(B[Z+F+E]<l[f+F]||l[f+F+E]<B[Z+F])continue E;var y=h(H,z);if(void 0!==y)return y}}}}else{for(j=c-V,w=d-1;w>=0;--w)if(O[w]===j){for(F=w+1;F<d;++F)O[F-1]=O[F];break}--d}}}};var a=h(12380),k=h(12389),G=h(12415),V=1<<28,l=1024,O=a.mallocInt32(l),v=a.mallocInt32(l),s=a.mallocInt32(l),U=a.mallocInt32(l),B=a.mallocInt32(l),o=a.mallocInt32(l),u=a.mallocDouble(8192);function D(E,b,h,a){var k=b[a],G=E[h-1];E[k]=G,b[G]=k}function g(E,b,h,a){E[h]=a,b[a]=h}},12522:E=>{"use strict";E.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12518:(E,b,h)=>{var a=h(12522),k=h(12529),G=Object.hasOwnProperty,V=Object.create(null);for(var l in a)G.call(a,l)&&(V[a[l]]=l);var O=E.exports={to:{},get:{}};function v(E,b,h){return Math.min(Math.max(b,E),h)}function s(E){var b=Math.round(E).toString(16).toUpperCase();return b.length<2?"0"+b:b}O.get=function(E){var b,h;switch(E.substring(0,3).toLowerCase()){case"hsl":b=O.get.hsl(E),h="hsl";break;case"hwb":b=O.get.hwb(E),h="hwb";break;default:b=O.get.rgb(E),h="rgb"}return b?{model:h,value:b}:null},O.get.rgb=function(E){if(!E)return null;var b,h,k,V=[0,0,0,1];if(b=E.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(k=b[2],b=b[1],h=0;h<3;h++){var l=2*h;V[h]=parseInt(b.slice(l,l+2),16)}k&&(V[3]=parseInt(k,16)/255)}else if(b=E.match(/^#([a-f0-9]{3,4})$/i)){for(k=(b=b[1])[3],h=0;h<3;h++)V[h]=parseInt(b[h]+b[h],16);k&&(V[3]=parseInt(k+k,16)/255)}else if(b=E.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(h=0;h<3;h++)V[h]=parseInt(b[h+1],0);b[4]&&(b[5]?V[3]=.01*parseFloat(b[4]):V[3]=parseFloat(b[4]))}else{if(!(b=E.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(b=E.match(/^(\w+)$/))?"transparent"===b[1]?[0,0,0,0]:G.call(a,b[1])?((V=a[b[1]])[3]=1,V):null:null;for(h=0;h<3;h++)V[h]=Math.round(2.55*parseFloat(b[h+1]));b[4]&&(b[5]?V[3]=.01*parseFloat(b[4]):V[3]=parseFloat(b[4]))}for(h=0;h<3;h++)V[h]=v(V[h],0,255);return V[3]=v(V[3],0,1),V},O.get.hsl=function(E){if(!E)return null;var b=E.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(b){var h=parseFloat(b[4]);return[(parseFloat(b[1])%360+360)%360,v(parseFloat(b[2]),0,100),v(parseFloat(b[3]),0,100),v(isNaN(h)?1:h,0,1)]}return null},O.get.hwb=function(E){if(!E)return null;var b=E.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(b){var h=parseFloat(b[4]);return[(parseFloat(b[1])%360+360)%360,v(parseFloat(b[2]),0,100),v(parseFloat(b[3]),0,100),v(isNaN(h)?1:h,0,1)]}return null},O.to.hex=function(){var E=k(arguments);return"#"+s(E[0])+s(E[1])+s(E[2])+(E[3]<1?s(Math.round(255*E[3])):"")},O.to.rgb=function(){var E=k(arguments);return E.length<4||1===E[3]?"rgb("+Math.round(E[0])+", "+Math.round(E[1])+", "+Math.round(E[2])+")":"rgba("+Math.round(E[0])+", "+Math.round(E[1])+", "+Math.round(E[2])+", "+E[3]+")"},O.to.rgb.percent=function(){var E=k(arguments),b=Math.round(E[0]/255*100),h=Math.round(E[1]/255*100),a=Math.round(E[2]/255*100);return E.length<4||1===E[3]?"rgb("+b+"%, "+h+"%, "+a+"%)":"rgba("+b+"%, "+h+"%, "+a+"%, "+E[3]+")"},O.to.hsl=function(){var E=k(arguments);return E.length<4||1===E[3]?"hsl("+E[0]+", "+E[1]+"%, "+E[2]+"%)":"hsla("+E[0]+", "+E[1]+"%, "+E[2]+"%, "+E[3]+")"},O.to.hwb=function(){var E=k(arguments),b="";return E.length>=4&&1!==E[3]&&(b=", "+E[3]),"hwb("+E[0]+", "+E[1]+"%, "+E[2]+"%"+b+")"},O.to.keyword=function(E){return V[E.slice(0,3)]}},12515:(E,b,h)=>{const a=h(12518),k=h(12534),G=["keyword","gray","hex"],V={};for(const o of Object.keys(k))V[[...k[o].labels].sort().join("")]=o;const l={};function O(E,b){if(!(this instanceof O))return new O(E,b);if(b&&b in G&&(b=null),b&&!(b in k))throw new Error("Unknown model: "+b);let h,v;if(null==E)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(E instanceof O)this.model=E.model,this.color=[...E.color],this.valpha=E.valpha;else if("string"===typeof E){const b=a.get(E);if(null===b)throw new Error("Unable to parse color from string: "+E);this.model=b.model,v=k[this.model].channels,this.color=b.value.slice(0,v),this.valpha="number"===typeof b.value[v]?b.value[v]:1}else if(E.length>0){this.model=b||"rgb",v=k[this.model].channels;const h=Array.prototype.slice.call(E,0,v);this.color=B(h,v),this.valpha="number"===typeof E[v]?E[v]:1}else if("number"===typeof E)this.model="rgb",this.color=[E>>16&255,E>>8&255,255&E],this.valpha=1;else{this.valpha=1;const b=Object.keys(E);"alpha"in E&&(b.splice(b.indexOf("alpha"),1),this.valpha="number"===typeof E.alpha?E.alpha:0);const a=b.sort().join("");if(!(a in V))throw new Error("Unable to parse color from object: "+JSON.stringify(E));this.model=V[a];const{labels:G}=k[this.model],l=[];for(h=0;h<G.length;h++)l.push(E[G[h]]);this.color=B(l)}if(l[this.model])for(v=k[this.model].channels,h=0;h<v;h++){const E=l[this.model][h];E&&(this.color[h]=E(this.color[h]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}O.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(E){let b=this.model in a.to?this:this.rgb();b=b.round("number"===typeof E?E:1);const h=1===b.valpha?b.color:[...b.color,this.valpha];return a.to[b.model](h)},percentString(E){const b=this.rgb().round("number"===typeof E?E:1),h=1===b.valpha?b.color:[...b.color,this.valpha];return a.to.rgb.percent(h)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const E={},{channels:b}=k[this.model],{labels:h}=k[this.model];for(let a=0;a<b;a++)E[h[a]]=this.color[a];return 1!==this.valpha&&(E.alpha=this.valpha),E},unitArray(){const E=this.rgb().color;return E[0]/=255,E[1]/=255,E[2]/=255,1!==this.valpha&&E.push(this.valpha),E},unitObject(){const E=this.rgb().object();return E.r/=255,E.g/=255,E.b/=255,1!==this.valpha&&(E.alpha=this.valpha),E},round(E){return E=Math.max(E||0,0),new O([...this.color.map(v(E)),this.valpha],this.model)},alpha(E){return void 0!==E?new O([...this.color,Math.max(0,Math.min(1,E))],this.model):this.valpha},red:s("rgb",0,U(255)),green:s("rgb",1,U(255)),blue:s("rgb",2,U(255)),hue:s(["hsl","hsv","hsl","hwb","hcg"],0,(E=>(E%360+360)%360)),saturationl:s("hsl",1,U(100)),lightness:s("hsl",2,U(100)),saturationv:s("hsv",1,U(100)),value:s("hsv",2,U(100)),chroma:s("hcg",1,U(100)),gray:s("hcg",2,U(100)),white:s("hwb",1,U(100)),wblack:s("hwb",2,U(100)),cyan:s("cmyk",0,U(100)),magenta:s("cmyk",1,U(100)),yellow:s("cmyk",2,U(100)),black:s("cmyk",3,U(100)),x:s("xyz",0,U(95.047)),y:s("xyz",1,U(100)),z:s("xyz",2,U(108.833)),l:s("lab",0,U(100)),a:s("lab",1),b:s("lab",2),keyword(E){return void 0!==E?new O(E):k[this.model].keyword(this.color)},hex(E){return void 0!==E?new O(E):a.to.hex(this.rgb().round().color)},hexa(E){if(void 0!==E)return new O(E);const b=this.rgb().round().color;let h=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===h.length&&(h="0"+h),a.to.hex(b)+h},rgbNumber(){const E=this.rgb().color;return(255&E[0])<<16|(255&E[1])<<8|255&E[2]},luminosity(){const E=this.rgb().color,b=[];for(const[h,a]of E.entries()){const E=a/255;b[h]=E<=.04045?E/12.92:((E+.055)/1.055)**2.4}return.2126*b[0]+.7152*b[1]+.0722*b[2]},contrast(E){const b=this.luminosity(),h=E.luminosity();return b>h?(b+.05)/(h+.05):(h+.05)/(b+.05)},level(E){const b=this.contrast(E);return b>=7?"AAA":b>=4.5?"AA":""},isDark(){const E=this.rgb().color;return(2126*E[0]+7152*E[1]+722*E[2])/1e4<128},isLight(){return!this.isDark()},negate(){const E=this.rgb();for(let b=0;b<3;b++)E.color[b]=255-E.color[b];return E},lighten(E){const b=this.hsl();return b.color[2]+=b.color[2]*E,b},darken(E){const b=this.hsl();return b.color[2]-=b.color[2]*E,b},saturate(E){const b=this.hsl();return b.color[1]+=b.color[1]*E,b},desaturate(E){const b=this.hsl();return b.color[1]-=b.color[1]*E,b},whiten(E){const b=this.hwb();return b.color[1]+=b.color[1]*E,b},blacken(E){const b=this.hwb();return b.color[2]+=b.color[2]*E,b},grayscale(){const E=this.rgb().color,b=.3*E[0]+.59*E[1]+.11*E[2];return O.rgb(b,b,b)},fade(E){return this.alpha(this.valpha-this.valpha*E)},opaquer(E){return this.alpha(this.valpha+this.valpha*E)},rotate(E){const b=this.hsl();let h=b.color[0];return h=(h+E)%360,h=h<0?360+h:h,b.color[0]=h,b},mix(E,b){if(!E||!E.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof E);const h=E.rgb(),a=this.rgb(),k=void 0===b?.5:b,G=2*k-1,V=h.alpha()-a.alpha(),l=((G*V===-1?G:(G+V)/(1+G*V))+1)/2,v=1-l;return O.rgb(l*h.red()+v*a.red(),l*h.green()+v*a.green(),l*h.blue()+v*a.blue(),h.alpha()*k+a.alpha()*(1-k))}};for(const o of Object.keys(k)){if(G.includes(o))continue;const{channels:E}=k[o];O.prototype[o]=function(){if(this.model===o)return new O(this);for(var E=arguments.length,b=new Array(E),h=0;h<E;h++)b[h]=arguments[h];return b.length>0?new O(b,o):new O([...(a=k[this.model][o].raw(this.color),Array.isArray(a)?a:[a]),this.valpha],o);var a},O[o]=function(){for(var b=arguments.length,h=new Array(b),a=0;a<b;a++)h[a]=arguments[a];let k=h[0];return"number"===typeof k&&(k=B(h,E)),new O(k,o)}}function v(E){return function(b){return function(E,b){return Number(E.toFixed(b))}(b,E)}}function s(E,b,h){E=Array.isArray(E)?E:[E];for(const a of E)(l[a]||(l[a]=[]))[b]=h;return E=E[0],function(a){let k;return void 0!==a?(h&&(a=h(a)),k=this[E](),k.color[b]=a,k):(k=this[E]().color[b],h&&(k=h(k)),k)}}function U(E){return function(b){return Math.max(0,Math.min(E,b))}}function B(E,b){for(let h=0;h<b;h++)"number"!==typeof E[h]&&(E[h]=0);return E}E.exports=O},12542:(E,b,h)=>{const a=h(12544),k={};for(const V of Object.keys(a))k[a[V]]=V;const G={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};E.exports=G;for(const V of Object.keys(G)){if(!("channels"in G[V]))throw new Error("missing channels property: "+V);if(!("labels"in G[V]))throw new Error("missing channel labels property: "+V);if(G[V].labels.length!==G[V].channels)throw new Error("channel and label counts mismatch: "+V);const{channels:E,labels:b}=G[V];delete G[V].channels,delete G[V].labels,Object.defineProperty(G[V],"channels",{value:E}),Object.defineProperty(G[V],"labels",{value:b})}G.rgb.hsl=function(E){const b=E[0]/255,h=E[1]/255,a=E[2]/255,k=Math.min(b,h,a),G=Math.max(b,h,a),V=G-k;let l,O;G===k?l=0:b===G?l=(h-a)/V:h===G?l=2+(a-b)/V:a===G&&(l=4+(b-h)/V),l=Math.min(60*l,360),l<0&&(l+=360);const v=(k+G)/2;return O=G===k?0:v<=.5?V/(G+k):V/(2-G-k),[l,100*O,100*v]},G.rgb.hsv=function(E){let b,h,a,k,G;const V=E[0]/255,l=E[1]/255,O=E[2]/255,v=Math.max(V,l,O),s=v-Math.min(V,l,O),U=function(E){return(v-E)/6/s+.5};return 0===s?(k=0,G=0):(G=s/v,b=U(V),h=U(l),a=U(O),V===v?k=a-h:l===v?k=1/3+b-a:O===v&&(k=2/3+h-b),k<0?k+=1:k>1&&(k-=1)),[360*k,100*G,100*v]},G.rgb.hwb=function(E){const b=E[0],h=E[1];let a=E[2];const k=G.rgb.hsl(E)[0],V=1/255*Math.min(b,Math.min(h,a));return a=1-1/255*Math.max(b,Math.max(h,a)),[k,100*V,100*a]},G.rgb.cmyk=function(E){const b=E[0]/255,h=E[1]/255,a=E[2]/255,k=Math.min(1-b,1-h,1-a);return[100*((1-b-k)/(1-k)||0),100*((1-h-k)/(1-k)||0),100*((1-a-k)/(1-k)||0),100*k]},G.rgb.keyword=function(E){const b=k[E];if(b)return b;let h,G=1/0;for(const k of Object.keys(a)){const b=a[k],O=(l=b,((V=E)[0]-l[0])**2+(V[1]-l[1])**2+(V[2]-l[2])**2);O<G&&(G=O,h=k)}var V,l;return h},G.keyword.rgb=function(E){return a[E]},G.rgb.xyz=function(E){let b=E[0]/255,h=E[1]/255,a=E[2]/255;b=b>.04045?((b+.055)/1.055)**2.4:b/12.92,h=h>.04045?((h+.055)/1.055)**2.4:h/12.92,a=a>.04045?((a+.055)/1.055)**2.4:a/12.92;return[100*(.4124*b+.3576*h+.1805*a),100*(.2126*b+.7152*h+.0722*a),100*(.0193*b+.1192*h+.9505*a)]},G.rgb.lab=function(E){const b=G.rgb.xyz(E);let h=b[0],a=b[1],k=b[2];h/=95.047,a/=100,k/=108.883,h=h>.008856?h**(1/3):7.787*h+16/116,a=a>.008856?a**(1/3):7.787*a+16/116,k=k>.008856?k**(1/3):7.787*k+16/116;return[116*a-16,500*(h-a),200*(a-k)]},G.hsl.rgb=function(E){const b=E[0]/360,h=E[1]/100,a=E[2]/100;let k,G,V;if(0===h)return V=255*a,[V,V,V];k=a<.5?a*(1+h):a+h-a*h;const l=2*a-k,O=[0,0,0];for(let v=0;v<3;v++)G=b+1/3*-(v-1),G<0&&G++,G>1&&G--,V=6*G<1?l+6*(k-l)*G:2*G<1?k:3*G<2?l+(k-l)*(2/3-G)*6:l,O[v]=255*V;return O},G.hsl.hsv=function(E){const b=E[0];let h=E[1]/100,a=E[2]/100,k=h;const G=Math.max(a,.01);a*=2,h*=a<=1?a:2-a,k*=G<=1?G:2-G;return[b,100*(0===a?2*k/(G+k):2*h/(a+h)),100*((a+h)/2)]},G.hsv.rgb=function(E){const b=E[0]/60,h=E[1]/100;let a=E[2]/100;const k=Math.floor(b)%6,G=b-Math.floor(b),V=255*a*(1-h),l=255*a*(1-h*G),O=255*a*(1-h*(1-G));switch(a*=255,k){case 0:return[a,O,V];case 1:return[l,a,V];case 2:return[V,a,O];case 3:return[V,l,a];case 4:return[O,V,a];case 5:return[a,V,l]}},G.hsv.hsl=function(E){const b=E[0],h=E[1]/100,a=E[2]/100,k=Math.max(a,.01);let G,V;V=(2-h)*a;const l=(2-h)*k;return G=h*k,G/=l<=1?l:2-l,G=G||0,V/=2,[b,100*G,100*V]},G.hwb.rgb=function(E){const b=E[0]/360;let h=E[1]/100,a=E[2]/100;const k=h+a;let G;k>1&&(h/=k,a/=k);const V=Math.floor(6*b),l=1-a;G=6*b-V,0!==(1&V)&&(G=1-G);const O=h+G*(l-h);let v,s,U;switch(V){default:case 6:case 0:v=l,s=O,U=h;break;case 1:v=O,s=l,U=h;break;case 2:v=h,s=l,U=O;break;case 3:v=h,s=O,U=l;break;case 4:v=O,s=h,U=l;break;case 5:v=l,s=h,U=O}return[255*v,255*s,255*U]},G.cmyk.rgb=function(E){const b=E[0]/100,h=E[1]/100,a=E[2]/100,k=E[3]/100;return[255*(1-Math.min(1,b*(1-k)+k)),255*(1-Math.min(1,h*(1-k)+k)),255*(1-Math.min(1,a*(1-k)+k))]},G.xyz.rgb=function(E){const b=E[0]/100,h=E[1]/100,a=E[2]/100;let k,G,V;return k=3.2406*b+-1.5372*h+-.4986*a,G=-.9689*b+1.8758*h+.0415*a,V=.0557*b+-.204*h+1.057*a,k=k>.0031308?1.055*k**(1/2.4)-.055:12.92*k,G=G>.0031308?1.055*G**(1/2.4)-.055:12.92*G,V=V>.0031308?1.055*V**(1/2.4)-.055:12.92*V,k=Math.min(Math.max(0,k),1),G=Math.min(Math.max(0,G),1),V=Math.min(Math.max(0,V),1),[255*k,255*G,255*V]},G.xyz.lab=function(E){let b=E[0],h=E[1],a=E[2];b/=95.047,h/=100,a/=108.883,b=b>.008856?b**(1/3):7.787*b+16/116,h=h>.008856?h**(1/3):7.787*h+16/116,a=a>.008856?a**(1/3):7.787*a+16/116;return[116*h-16,500*(b-h),200*(h-a)]},G.lab.xyz=function(E){let b,h,a;h=(E[0]+16)/116,b=E[1]/500+h,a=h-E[2]/200;const k=h**3,G=b**3,V=a**3;return h=k>.008856?k:(h-16/116)/7.787,b=G>.008856?G:(b-16/116)/7.787,a=V>.008856?V:(a-16/116)/7.787,b*=95.047,h*=100,a*=108.883,[b,h,a]},G.lab.lch=function(E){const b=E[0],h=E[1],a=E[2];let k;k=360*Math.atan2(a,h)/2/Math.PI,k<0&&(k+=360);return[b,Math.sqrt(h*h+a*a),k]},G.lch.lab=function(E){const b=E[0],h=E[1],a=E[2]/360*2*Math.PI;return[b,h*Math.cos(a),h*Math.sin(a)]},G.rgb.ansi16=function(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[h,a,k]=E;let V=null===b?G.rgb.hsv(E)[2]:b;if(V=Math.round(V/50),0===V)return 30;let l=30+(Math.round(k/255)<<2|Math.round(a/255)<<1|Math.round(h/255));return 2===V&&(l+=60),l},G.hsv.ansi16=function(E){return G.rgb.ansi16(G.hsv.rgb(E),E[2])},G.rgb.ansi256=function(E){const b=E[0],h=E[1],a=E[2];if(b===h&&h===a)return b<8?16:b>248?231:Math.round((b-8)/247*24)+232;return 16+36*Math.round(b/255*5)+6*Math.round(h/255*5)+Math.round(a/255*5)},G.ansi16.rgb=function(E){let b=E%10;if(0===b||7===b)return E>50&&(b+=3.5),b=b/10.5*255,[b,b,b];const h=.5*(1+~~(E>50));return[(1&b)*h*255,(b>>1&1)*h*255,(b>>2&1)*h*255]},G.ansi256.rgb=function(E){if(E>=232){const b=10*(E-232)+8;return[b,b,b]}let b;E-=16;return[Math.floor(E/36)/5*255,Math.floor((b=E%36)/6)/5*255,b%6/5*255]},G.rgb.hex=function(E){const b=(((255&Math.round(E[0]))<<16)+((255&Math.round(E[1]))<<8)+(255&Math.round(E[2]))).toString(16).toUpperCase();return"000000".substring(b.length)+b},G.hex.rgb=function(E){const b=E.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!b)return[0,0,0];let h=b[0];3===b[0].length&&(h=h.split("").map((E=>E+E)).join(""));const a=parseInt(h,16);return[a>>16&255,a>>8&255,255&a]},G.rgb.hcg=function(E){const b=E[0]/255,h=E[1]/255,a=E[2]/255,k=Math.max(Math.max(b,h),a),G=Math.min(Math.min(b,h),a),V=k-G;let l,O;return l=V<1?G/(1-V):0,O=V<=0?0:k===b?(h-a)/V%6:k===h?2+(a-b)/V:4+(b-h)/V,O/=6,O%=1,[360*O,100*V,100*l]},G.hsl.hcg=function(E){const b=E[1]/100,h=E[2]/100,a=h<.5?2*b*h:2*b*(1-h);let k=0;return a<1&&(k=(h-.5*a)/(1-a)),[E[0],100*a,100*k]},G.hsv.hcg=function(E){const b=E[1]/100,h=E[2]/100,a=b*h;let k=0;return a<1&&(k=(h-a)/(1-a)),[E[0],100*a,100*k]},G.hcg.rgb=function(E){const b=E[0]/360,h=E[1]/100,a=E[2]/100;if(0===h)return[255*a,255*a,255*a];const k=[0,0,0],G=b%1*6,V=G%1,l=1-V;let O=0;switch(Math.floor(G)){case 0:k[0]=1,k[1]=V,k[2]=0;break;case 1:k[0]=l,k[1]=1,k[2]=0;break;case 2:k[0]=0,k[1]=1,k[2]=V;break;case 3:k[0]=0,k[1]=l,k[2]=1;break;case 4:k[0]=V,k[1]=0,k[2]=1;break;default:k[0]=1,k[1]=0,k[2]=l}return O=(1-h)*a,[255*(h*k[0]+O),255*(h*k[1]+O),255*(h*k[2]+O)]},G.hcg.hsv=function(E){const b=E[1]/100,h=b+E[2]/100*(1-b);let a=0;return h>0&&(a=b/h),[E[0],100*a,100*h]},G.hcg.hsl=function(E){const b=E[1]/100,h=E[2]/100*(1-b)+.5*b;let a=0;return h>0&&h<.5?a=b/(2*h):h>=.5&&h<1&&(a=b/(2*(1-h))),[E[0],100*a,100*h]},G.hcg.hwb=function(E){const b=E[1]/100,h=b+E[2]/100*(1-b);return[E[0],100*(h-b),100*(1-h)]},G.hwb.hcg=function(E){const b=E[1]/100,h=1-E[2]/100,a=h-b;let k=0;return a<1&&(k=(h-a)/(1-a)),[E[0],100*a,100*k]},G.apple.rgb=function(E){return[E[0]/65535*255,E[1]/65535*255,E[2]/65535*255]},G.rgb.apple=function(E){return[E[0]/255*65535,E[1]/255*65535,E[2]/255*65535]},G.gray.rgb=function(E){return[E[0]/100*255,E[0]/100*255,E[0]/100*255]},G.gray.hsl=function(E){return[0,0,E[0]]},G.gray.hsv=G.gray.hsl,G.gray.hwb=function(E){return[0,100,E[0]]},G.gray.cmyk=function(E){return[0,0,0,E[0]]},G.gray.lab=function(E){return[E[0],0,0]},G.gray.hex=function(E){const b=255&Math.round(E[0]/100*255),h=((b<<16)+(b<<8)+b).toString(16).toUpperCase();return"000000".substring(h.length)+h},G.rgb.gray=function(E){return[(E[0]+E[1]+E[2])/3/255*100]}},12534:(E,b,h)=>{const a=h(12542),k=h(12553),G={};Object.keys(a).forEach((E=>{G[E]={},Object.defineProperty(G[E],"channels",{value:a[E].channels}),Object.defineProperty(G[E],"labels",{value:a[E].labels});const b=k(E);Object.keys(b).forEach((h=>{const a=b[h];G[E][h]=function(E){const b=function(){for(var b=arguments.length,h=new Array(b),a=0;a<b;a++)h[a]=arguments[a];const k=h[0];if(void 0===k||null===k)return k;k.length>1&&(h=k);const G=E(h);if("object"===typeof G)for(let E=G.length,V=0;V<E;V++)G[V]=Math.round(G[V]);return G};return"conversion"in E&&(b.conversion=E.conversion),b}(a),G[E][h].raw=function(E){const b=function(){for(var b=arguments.length,h=new Array(b),a=0;a<b;a++)h[a]=arguments[a];const k=h[0];return void 0===k||null===k?k:(k.length>1&&(h=k),E(h))};return"conversion"in E&&(b.conversion=E.conversion),b}(a)}))})),E.exports=G},12553:(E,b,h)=>{const a=h(12542);function k(E){const b=function(){const E={},b=Object.keys(a);for(let h=b.length,a=0;a<h;a++)E[b[a]]={distance:-1,parent:null};return E}(),h=[E];for(b[E].distance=0;h.length;){const E=h.pop(),k=Object.keys(a[E]);for(let a=k.length,G=0;G<a;G++){const a=k[G],V=b[a];-1===V.distance&&(V.distance=b[E].distance+1,V.parent=E,h.unshift(a))}}return b}function G(E,b){return function(h){return b(E(h))}}function V(E,b){const h=[b[E].parent,E];let k=a[b[E].parent][E],V=b[E].parent;for(;b[V].parent;)h.unshift(b[V].parent),k=G(a[b[V].parent][V],k),V=b[V].parent;return k.conversion=h,k}E.exports=function(E){const b=k(E),h={},a=Object.keys(b);for(let k=a.length,G=0;G<k;G++){const E=a[G];null!==b[E].parent&&(h[E]=V(E,b))}return h}},12544:E=>{"use strict";E.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},10749:function(E,b,h){"use strict";var a=this&&this.__createBinding||(Object.create?function(E,b,h,a){void 0===a&&(a=h);var k=Object.getOwnPropertyDescriptor(b,h);k&&!("get"in k?!b.__esModule:k.writable||k.configurable)||(k={enumerable:!0,get:function(){return b[h]}}),Object.defineProperty(E,a,k)}:function(E,b,h,a){void 0===a&&(a=h),E[a]=b[h]}),k=this&&this.__setModuleDefault||(Object.create?function(E,b){Object.defineProperty(E,"default",{enumerable:!0,value:b})}:function(E,b){E.default=b}),G=this&&this.__importStar||function(E){if(E&&E.__esModule)return E;var b={};if(null!=E)for(var h in E)"default"!==h&&Object.prototype.hasOwnProperty.call(E,h)&&a(b,E,h);return k(b,E),b},V=this&&this.__awaiter||function(E,b,h,a){return new(h||(h=Promise))((function(k,G){function V(E){try{O(a.next(E))}catch(b){G(b)}}function l(E){try{O(a.throw(E))}catch(b){G(b)}}function O(E){var b;E.done?k(E.value):(b=E.value,b instanceof h?b:new h((function(E){E(b)}))).then(V,l)}O((a=a.apply(E,b||[])).next())}))};Object.defineProperty(b,"__esModule",{value:!0}),b.Auth=b.Platform=void 0;const l=G(h(10678)),O=h(10752),v="colyseus-auth-token";!function(E){E.ios="ios",E.android="android"}(b.Platform||(b.Platform={}));b.Auth=class{constructor(E){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=E.replace("ws","http"),(0,O.getItem)(v,(E=>this.token=E))}get hasToken(){return!!this.token}login(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return V(this,void 0,void 0,(function*(){const b=Object.assign({},E);this.hasToken&&(b.token=this.token);const h=yield this.request("post","/auth",b);this.token=h.token,(0,O.setItem)(v,this.token);for(let E in h)this.hasOwnProperty(E)&&(this[E]=h[E]);return this.registerPingService(),this}))}save(){return V(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return V(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return V(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return V(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(E){return V(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:E})}))}acceptFriendRequest(E){return V(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:E})}))}declineFriendRequest(E){return V(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:E})}))}blockUser(E){return V(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:E})}))}unblockUser(E){return V(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:E})}))}request(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return V(this,void 0,void 0,(function*(){k.Accept="application/json",this.hasToken&&(k.Authorization="Bearer "+this.token);const G=[];for(const E in h)G.push(`${E}=${h[E]}`);const V=G.length>0?`?${G.join("&")}`:"",O={headers:k};return a&&(O.body=a),(yield l[E](`${this.endpoint}${b}${V}`,O)).data}))}logout(){this.token=void 0,(0,O.removeItem)(v),this.unregisterPingService()}registerPingService(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),E)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},10672:function(E,b,h){"use strict";var a,k=this&&this.__awaiter||function(E,b,h,a){return new(h||(h=Promise))((function(k,G){function V(E){try{O(a.next(E))}catch(b){G(b)}}function l(E){try{O(a.throw(E))}catch(b){G(b)}}function O(E){var b;E.done?k(E.value):(b=E.value,b instanceof h?b:new h((function(E){E(b)}))).then(V,l)}O((a=a.apply(E,b||[])).next())}))};Object.defineProperty(b,"__esModule",{value:!0}),b.Client=b.MatchMakeError=void 0;const G=h(10678),V=h(10687),l=h(10694);class O extends Error{constructor(E,b){super(E),this.code=b,Object.setPrototypeOf(this,O.prototype)}}b.MatchMakeError=O;const v="undefined"!==typeof window&&"undefined"!==typeof(null===(a=null===window||void 0===window?void 0:window.location)||void 0===a?void 0:a.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";b.Client=class{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v;if("string"===typeof E){const b=new URL(E),h="https:"===b.protocol||"wss:"===b.protocol,a=Number(b.port||(h?443:80));this.settings={hostname:b.hostname,pathname:"/"!==b.pathname?b.pathname:"",port:a,secure:h}}else void 0===E.port&&(E.port=E.secure?443:80),void 0===E.pathname&&(E.pathname=""),this.settings=E}joinOrCreate(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;return k(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",E,b,h)}))}create(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;return k(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",E,b,h)}))}join(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;return k(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",E,b,h)}))}joinById(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;return k(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",E,b,h)}))}reconnect(E,b){return k(this,void 0,void 0,(function*(){if("string"===typeof E&&"string"===typeof b)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[h,a]=E.split(":");return yield this.createMatchMakeRequest("reconnect",h,{reconnectionToken:a},b)}))}getAvailableRooms(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return k(this,void 0,void 0,(function*(){return(yield(0,G.get)(this.getHttpEndpoint(`${E}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(E,b,h){return k(this,void 0,void 0,(function*(){const a=this.createRoom(E.room.name,b);a.roomId=E.room.roomId,a.sessionId=E.sessionId;const G={sessionId:a.sessionId};E.reconnectionToken&&(G.reconnectionToken=E.reconnectionToken);const l=h||a;return a.connect(this.buildEndpoint(E.room,G),E.devMode&&(()=>k(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${a.roomId}'...`);let h=0;const G=()=>k(this,void 0,void 0,(function*(){h++;try{yield this.consumeSeatReservation(E,b,l),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${a.roomId}'`)}catch(k){h<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${h} out of 8)`),setTimeout(G,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(G,2e3)}))),l),new Promise(((E,b)=>{const h=(E,h)=>b(new V.ServerError(E,h));l.onError.once(h),l.onJoin.once((()=>{l.onError.remove(h),E(l)}))}))}))}createMatchMakeRequest(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0,V=arguments.length>4?arguments[4]:void 0;return k(this,void 0,void 0,(function*(){const k=(yield(0,G.post)(this.getHttpEndpoint(`${E}/${b}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(h)})).data;if(k.error)throw new O(k.error,k.code);return"reconnect"===E&&(k.reconnectionToken=h.reconnectionToken),yield this.consumeSeatReservation(k,a,V)}))}createRoom(E,b){return new l.Room(E,b)}buildEndpoint(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const h=[];for(const k in b)b.hasOwnProperty(k)&&h.push(`${k}=${b[k]}`);let a=this.settings.secure?"wss://":"ws://";return E.publicAddress?a+=`${E.publicAddress}`:a+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${a}/${E.processId}/${E.roomId}?${h.join("&")}`}getHttpEndpoint(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${E}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},10711:(E,b,h)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.Connection=void 0;const a=h(10716);b.Connection=class{constructor(){this.events={},this.transport=new a.WebSocketTransport(this.events)}send(E){this.transport.send(E)}connect(E){this.transport.connect(E)}close(E,b){this.transport.close(E,b)}get isOpen(){return this.transport.isOpen}}},10724:(E,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.utf8Length=b.utf8Read=b.ErrorCode=b.Protocol=void 0,function(E){E[E.HANDSHAKE=9]="HANDSHAKE",E[E.JOIN_ROOM=10]="JOIN_ROOM",E[E.ERROR=11]="ERROR",E[E.LEAVE_ROOM=12]="LEAVE_ROOM",E[E.ROOM_DATA=13]="ROOM_DATA",E[E.ROOM_STATE=14]="ROOM_STATE",E[E.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",E[E.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",E[E.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(b.Protocol||(b.Protocol={})),function(E){E[E.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",E[E.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",E[E.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",E[E.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",E[E.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",E[E.AUTH_FAILED=4215]="AUTH_FAILED",E[E.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(b.ErrorCode||(b.ErrorCode={})),b.utf8Read=function(E,b){const h=E[b++];for(var a="",k=0,G=b,V=b+h;G<V;G++){var l=E[G];if(0!==(128&l))if(192!==(224&l))if(224!==(240&l)){if(240!==(248&l))throw new Error("Invalid byte "+l.toString(16));(k=(7&l)<<18|(63&E[++G])<<12|(63&E[++G])<<6|63&E[++G])>=65536?(k-=65536,a+=String.fromCharCode(55296+(k>>>10),56320+(1023&k))):a+=String.fromCharCode(k)}else a+=String.fromCharCode((15&l)<<12|(63&E[++G])<<6|63&E[++G]);else a+=String.fromCharCode((31&l)<<6|63&E[++G]);else a+=String.fromCharCode(l)}return a},b.utf8Length=function(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",b=0,h=0;for(let a=0,k=E.length;a<k;a++)b=E.charCodeAt(a),b<128?h+=1:b<2048?h+=2:b<55296||b>=57344?h+=3:(a++,h+=4);return h+1}},10694:function(E,b,h){"use strict";var a=this&&this.__createBinding||(Object.create?function(E,b,h,a){void 0===a&&(a=h);var k=Object.getOwnPropertyDescriptor(b,h);k&&!("get"in k?!b.__esModule:k.writable||k.configurable)||(k={enumerable:!0,get:function(){return b[h]}}),Object.defineProperty(E,a,k)}:function(E,b,h,a){void 0===a&&(a=h),E[a]=b[h]}),k=this&&this.__setModuleDefault||(Object.create?function(E,b){Object.defineProperty(E,"default",{enumerable:!0,value:b})}:function(E,b){E.default=b}),G=this&&this.__importStar||function(E){if(E&&E.__esModule)return E;var b={};if(null!=E)for(var h in E)"default"!==h&&Object.prototype.hasOwnProperty.call(E,h)&&a(b,E,h);return k(b,E),b};Object.defineProperty(b,"__esModule",{value:!0}),b.Room=void 0;const V=G(h(10703)),l=h(10711),O=h(10724),v=h(10729),s=h(10732),U=h(10734),B=h(10743),o=h(10687);class u{constructor(E,b){this.onStateChange=(0,U.createSignal)(),this.onError=(0,U.createSignal)(),this.onLeave=(0,U.createSignal)(),this.onJoin=(0,U.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,s.createNanoEvents)(),this.roomId=null,this.name=E,b&&(this.serializer=new((0,v.getSerializer)("schema")),this.rootSchema=b,this.serializer.state=new b),this.onError(((E,b)=>{var h;return null===(h=console.warn)||void 0===h?void 0:h.call(console,`colyseus.js - onError => (${E}) ${b}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const a=new l.Connection;h.connection=a,a.events.onmessage=u.prototype.onMessageCallback.bind(h),a.events.onclose=function(E){var a;if(!h.hasJoined)return null===(a=console.warn)||void 0===a||a.call(console,`Room connection was closed unexpectedly (${E.code}): ${E.reason}`),void h.onError.invoke(E.code,E.reason);E.code===o.CloseCode.DEVMODE_RESTART&&b?b():(h.onLeave.invoke(E.code),h.destroy())},a.events.onerror=function(E){var b;null===(b=console.warn)||void 0===b||b.call(console,`Room, onError (${E.code}): ${E.reason}`),h.onError.invoke(E.code,E.reason)},a.connect(E)}leave(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((b=>{this.onLeave((E=>b(E))),this.connection?E?this.connection.send([O.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(o.CloseCode.CONSENTED)}))}onMessage(E,b){return this.onMessageHandlers.on(this.getMessageHandlerKey(E),b)}send(E,b){const h=[O.Protocol.ROOM_DATA];let a;if("string"===typeof E?B.encode.string(h,E):B.encode.number(h,E),void 0!==b){const E=V.encode(b);a=new Uint8Array(h.length+E.byteLength),a.set(new Uint8Array(h),0),a.set(new Uint8Array(E),h.length)}else a=new Uint8Array(h);this.connection.send(a.buffer)}sendBytes(E,b){const h=[O.Protocol.ROOM_DATA_BYTES];let a;"string"===typeof E?B.encode.string(h,E):B.encode.number(h,E),a=new Uint8Array(h.length+(b.byteLength||b.length)),a.set(new Uint8Array(h),0),a.set(new Uint8Array(b),h.length),this.connection.send(a.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(E){const b=Array.from(new Uint8Array(E.data)),h=b[0];if(h===O.Protocol.JOIN_ROOM){let E=1;const h=(0,O.utf8Read)(b,E);if(E+=(0,O.utf8Length)(h),this.serializerId=(0,O.utf8Read)(b,E),E+=(0,O.utf8Length)(this.serializerId),!this.serializer){const E=(0,v.getSerializer)(this.serializerId);this.serializer=new E}b.length>E&&this.serializer.handshake&&this.serializer.handshake(b,{offset:E}),this.reconnectionToken=`${this.roomId}:${h}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([O.Protocol.JOIN_ROOM])}else if(h===O.Protocol.ERROR){const E={offset:1},h=B.decode.number(b,E),a=B.decode.string(b,E);this.onError.invoke(h,a)}else if(h===O.Protocol.LEAVE_ROOM)this.leave();else if(h===O.Protocol.ROOM_DATA_SCHEMA){const E={offset:1},h=this.serializer.getState().constructor._context.get(B.decode.number(b,E)),a=new h;a.decode(b,E),this.dispatchMessage(h,a)}else if(h===O.Protocol.ROOM_STATE)b.shift(),this.setState(b);else if(h===O.Protocol.ROOM_STATE_PATCH)b.shift(),this.patch(b);else if(h===O.Protocol.ROOM_DATA){const h={offset:1},a=B.decode.stringCheck(b,h)?B.decode.string(b,h):B.decode.number(b,h),k=b.length>h.offset?V.decode(E.data,h.offset):void 0;this.dispatchMessage(a,k)}else if(h===O.Protocol.ROOM_DATA_BYTES){const E={offset:1},h=B.decode.stringCheck(b,E)?B.decode.string(b,E):B.decode.number(b,E);this.dispatchMessage(h,new Uint8Array(b.slice(E.offset)))}}setState(E){this.serializer.setState(E),this.onStateChange.invoke(this.serializer.getState())}patch(E){this.serializer.patch(E),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(E,b){var h;const a=this.getMessageHandlerKey(E);this.onMessageHandlers.events[a]?this.onMessageHandlers.emit(a,b):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",E,b):null===(h=console.warn)||void 0===h||h.call(console,`colyseus.js: onMessage() not registered for type '${E}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(E){switch(typeof E){case"function":return`$${E._typeid}`;case"string":return E;case"number":return`i${E}`;default:throw new Error("invalid message type.")}}}b.Room=u},10752:(E,b)=>{"use strict";let h;function a(){return h||(h="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(E,b){this.cache[E]=b},getItem:function(E){this.cache[E]},removeItem:function(E){delete this.cache[E]}}),h}Object.defineProperty(b,"__esModule",{value:!0}),b.getItem=b.removeItem=b.setItem=void 0,b.setItem=function(E,b){a().setItem(E,b)},b.removeItem=function(E){a().removeItem(E)},b.getItem=function(E,b){const h=a().getItem(E);"undefined"!==typeof Promise&&h instanceof Promise?h.then((E=>b(E))):b(h)}},10732:(E,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.createNanoEvents=void 0;b.createNanoEvents=()=>({emit(E){let b=this.events[E]||[];for(var h=arguments.length,a=new Array(h>1?h-1:0),k=1;k<h;k++)a[k-1]=arguments[k];for(let G=0,V=b.length;G<V;G++)b[G](...a)},events:{},on(E,b){var h;return(null===(h=this.events[E])||void 0===h?void 0:h.push(b))||(this.events[E]=[b]),()=>{var h;this.events[E]=null===(h=this.events[E])||void 0===h?void 0:h.filter((E=>b!==E))}}})},10734:(E,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.createSignal=b.EventEmitter=void 0;class h{constructor(){this.handlers=[]}register(E){return this.handlers.push(E),this}invoke(){for(var E=arguments.length,b=new Array(E),h=0;h<E;h++)b[h]=arguments[h];this.handlers.forEach((E=>E.apply(this,b)))}invokeAsync(){for(var E=arguments.length,b=new Array(E),h=0;h<E;h++)b[h]=arguments[h];return Promise.all(this.handlers.map((E=>E.apply(this,b))))}remove(E){const b=this.handlers.indexOf(E);this.handlers[b]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}b.EventEmitter=h,b.createSignal=function(){const E=new h;function b(b){return E.register(b,null===this)}return b.once=b=>{const h=function(){for(var a=arguments.length,k=new Array(a),G=0;G<a;G++)k[G]=arguments[G];b.apply(this,k),E.remove(h)};E.register(h)},b.remove=b=>E.remove(b),b.invoke=function(){return E.invoke(...arguments)},b.invokeAsync=function(){return E.invokeAsync(...arguments)},b.clear=()=>E.clear(),b}},10687:(E,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.ServerError=b.CloseCode=void 0,function(E){E[E.CONSENTED=4e3]="CONSENTED",E[E.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(b.CloseCode||(b.CloseCode={}));class h extends Error{constructor(E,b){super(b),this.name="ServerError",this.code=E}}b.ServerError=h},10663:(E,b,h)=>{"use strict";b.b=void 0,h(10669);var a=h(10672);Object.defineProperty(b,"b",{enumerable:!0,get:function(){return a.Client}});var k=h(10724);var G=h(10694);var V=h(10749);const l=h(10755);const O=h(10761),v=h(10729);(0,v.registerSerializer)("schema",l.SchemaSerializer),(0,v.registerSerializer)("none",O.NoneSerializer)},10669:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=E=>null!==E&&"object"===typeof E&&E.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},10703:(E,b)=>{"use strict";function h(E,b){if(this._offset=b,E instanceof ArrayBuffer)this._buffer=E,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(E))throw new Error("Invalid argument");this._buffer=E.buffer,this._view=new DataView(this._buffer,E.byteOffset,E.byteLength)}}Object.defineProperty(b,"__esModule",{value:!0}),b.decode=b.encode=void 0,h.prototype._array=function(E){for(var b=new Array(E),h=0;h<E;h++)b[h]=this._parse();return b},h.prototype._map=function(E){for(var b={},h=0;h<E;h++)b[this._parse()]=this._parse();return b},h.prototype._str=function(E){var b=function(E,b,h){for(var a="",k=0,G=b,V=b+h;G<V;G++){var l=E.getUint8(G);if(0!==(128&l))if(192!==(224&l))if(224!==(240&l)){if(240!==(248&l))throw new Error("Invalid byte "+l.toString(16));(k=(7&l)<<18|(63&E.getUint8(++G))<<12|(63&E.getUint8(++G))<<6|63&E.getUint8(++G))>=65536?(k-=65536,a+=String.fromCharCode(55296+(k>>>10),56320+(1023&k))):a+=String.fromCharCode(k)}else a+=String.fromCharCode((15&l)<<12|(63&E.getUint8(++G))<<6|63&E.getUint8(++G));else a+=String.fromCharCode((31&l)<<6|63&E.getUint8(++G));else a+=String.fromCharCode(l)}return a}(this._view,this._offset,E);return this._offset+=E,b},h.prototype._bin=function(E){var b=this._buffer.slice(this._offset,this._offset+E);return this._offset+=E,b},h.prototype._parse=function(){var E,b=this._view.getUint8(this._offset++),h=0,a=0,k=0,G=0;if(b<192)return b<128?b:b<144?this._map(15&b):b<160?this._array(15&b):this._str(31&b);if(b>223)return-1*(255-b+1);switch(b){case 192:return null;case 194:return!1;case 195:return!0;case 196:return h=this._view.getUint8(this._offset),this._offset+=1,this._bin(h);case 197:return h=this._view.getUint16(this._offset),this._offset+=2,this._bin(h);case 198:return h=this._view.getUint32(this._offset),this._offset+=4,this._bin(h);case 199:if(h=this._view.getUint8(this._offset),a=this._view.getInt8(this._offset+1),this._offset+=2,-1===a){var V=this._view.getUint32(this._offset);return k=this._view.getInt32(this._offset+4),G=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*k+G)+V/1e6)}return[a,this._bin(h)];case 200:return h=this._view.getUint16(this._offset),a=this._view.getInt8(this._offset+2),this._offset+=3,[a,this._bin(h)];case 201:return h=this._view.getUint32(this._offset),a=this._view.getInt8(this._offset+4),this._offset+=5,[a,this._bin(h)];case 202:return E=this._view.getFloat32(this._offset),this._offset+=4,E;case 203:return E=this._view.getFloat64(this._offset),this._offset+=8,E;case 204:return E=this._view.getUint8(this._offset),this._offset+=1,E;case 205:return E=this._view.getUint16(this._offset),this._offset+=2,E;case 206:return E=this._view.getUint32(this._offset),this._offset+=4,E;case 207:return k=this._view.getUint32(this._offset)*Math.pow(2,32),G=this._view.getUint32(this._offset+4),this._offset+=8,k+G;case 208:return E=this._view.getInt8(this._offset),this._offset+=1,E;case 209:return E=this._view.getInt16(this._offset),this._offset+=2,E;case 210:return E=this._view.getInt32(this._offset),this._offset+=4,E;case 211:return k=this._view.getInt32(this._offset)*Math.pow(2,32),G=this._view.getUint32(this._offset+4),this._offset+=8,k+G;case 212:return a=this._view.getInt8(this._offset),this._offset+=1,0===a?void(this._offset+=1):[a,this._bin(1)];case 213:return a=this._view.getInt8(this._offset),this._offset+=1,[a,this._bin(2)];case 214:return a=this._view.getInt8(this._offset),this._offset+=1,-1===a?(E=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*E)):[a,this._bin(4)];case 215:return a=this._view.getInt8(this._offset),this._offset+=1,0===a?(k=this._view.getInt32(this._offset)*Math.pow(2,32),G=this._view.getUint32(this._offset+4),this._offset+=8,new Date(k+G)):-1===a?(k=this._view.getUint32(this._offset),G=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&k)+G)+(k>>>2)/1e6)):[a,this._bin(8)];case 216:return a=this._view.getInt8(this._offset),this._offset+=1,[a,this._bin(16)];case 217:return h=this._view.getUint8(this._offset),this._offset+=1,this._str(h);case 218:return h=this._view.getUint16(this._offset),this._offset+=2,this._str(h);case 219:return h=this._view.getUint32(this._offset),this._offset+=4,this._str(h);case 220:return h=this._view.getUint16(this._offset),this._offset+=2,this._array(h);case 221:return h=this._view.getUint32(this._offset),this._offset+=4,this._array(h);case 222:return h=this._view.getUint16(this._offset),this._offset+=2,this._map(h);case 223:return h=this._view.getUint32(this._offset),this._offset+=4,this._map(h)}throw new Error("Could not parse")},b.decode=function(E){var b=new h(E,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),a=b._parse();if(b._offset!==E.byteLength)throw new Error(E.byteLength-b._offset+" trailing bytes");return a};function a(E,b,h){for(var a=0,k=0,G=h.length;k<G;k++)(a=h.charCodeAt(k))<128?E.setUint8(b++,a):a<2048?(E.setUint8(b++,192|a>>6),E.setUint8(b++,128|63&a)):a<55296||a>=57344?(E.setUint8(b++,224|a>>12),E.setUint8(b++,128|a>>6&63),E.setUint8(b++,128|63&a)):(k++,a=65536+((1023&a)<<10|1023&h.charCodeAt(k)),E.setUint8(b++,240|a>>18),E.setUint8(b++,128|a>>12&63),E.setUint8(b++,128|a>>6&63),E.setUint8(b++,128|63&a))}function k(E,b,h){var a=typeof h,G=0,V=0,l=0,O=0,v=0,s=0;if("string"===a){if(v=function(E){for(var b=0,h=0,a=0,k=E.length;a<k;a++)(b=E.charCodeAt(a))<128?h+=1:b<2048?h+=2:b<55296||b>=57344?h+=3:(a++,h+=4);return h}(h),v<32)E.push(160|v),s=1;else if(v<256)E.push(217,v),s=2;else if(v<65536)E.push(218,v>>8,v),s=3;else{if(!(v<4294967296))throw new Error("String too long");E.push(219,v>>24,v>>16,v>>8,v),s=5}return b.push({_str:h,_length:v,_offset:E.length}),s+v}if("number"===a)return Math.floor(h)===h&&isFinite(h)?h>=0?h<128?(E.push(h),1):h<256?(E.push(204,h),2):h<65536?(E.push(205,h>>8,h),3):h<4294967296?(E.push(206,h>>24,h>>16,h>>8,h),5):(l=h/Math.pow(2,32)|0,O=h>>>0,E.push(207,l>>24,l>>16,l>>8,l,O>>24,O>>16,O>>8,O),9):h>=-32?(E.push(h),1):h>=-128?(E.push(208,h),2):h>=-32768?(E.push(209,h>>8,h),3):h>=-2147483648?(E.push(210,h>>24,h>>16,h>>8,h),5):(l=Math.floor(h/Math.pow(2,32)),O=h>>>0,E.push(211,l>>24,l>>16,l>>8,l,O>>24,O>>16,O>>8,O),9):(E.push(203),b.push({_float:h,_length:8,_offset:E.length}),9);if("object"===a){if(null===h)return E.push(192),1;if(Array.isArray(h)){if((v=h.length)<16)E.push(144|v),s=1;else if(v<65536)E.push(220,v>>8,v),s=3;else{if(!(v<4294967296))throw new Error("Array too large");E.push(221,v>>24,v>>16,v>>8,v),s=5}for(G=0;G<v;G++)s+=k(E,b,h[G]);return s}if(h instanceof Date){var U=h.getTime(),B=Math.floor(U/1e3),o=1e6*(U-1e3*B);return B>=0&&o>=0&&B<=17179869183?0===o&&B<=4294967295?(E.push(214,255,B>>24,B>>16,B>>8,B),6):(l=B/4294967296,O=4294967295&B,E.push(215,255,o>>22,o>>14,o>>6,l,O>>24,O>>16,O>>8,O),10):(l=Math.floor(B/4294967296),O=B>>>0,E.push(199,12,255,o>>24,o>>16,o>>8,o,l>>24,l>>16,l>>8,l,O>>24,O>>16,O>>8,O),15)}if(h instanceof ArrayBuffer){if((v=h.byteLength)<256)E.push(196,v),s=2;else if(v<65536)E.push(197,v>>8,v),s=3;else{if(!(v<4294967296))throw new Error("Buffer too large");E.push(198,v>>24,v>>16,v>>8,v),s=5}return b.push({_bin:h,_length:v,_offset:E.length}),s+v}if("function"===typeof h.toJSON)return k(E,b,h.toJSON());var u=[],D="",g=Object.keys(h);for(G=0,V=g.length;G<V;G++)void 0!==h[D=g[G]]&&"function"!==typeof h[D]&&u.push(D);if((v=u.length)<16)E.push(128|v),s=1;else if(v<65536)E.push(222,v>>8,v),s=3;else{if(!(v<4294967296))throw new Error("Object too large");E.push(223,v>>24,v>>16,v>>8,v),s=5}for(G=0;G<v;G++)s+=k(E,b,D=u[G]),s+=k(E,b,h[D]);return s}if("boolean"===a)return E.push(h?195:194),1;if("undefined"===a)return E.push(192),1;if("function"===typeof h.toJSON)return k(E,b,h.toJSON());throw new Error("Could not encode")}b.encode=function(E){var b=[],h=[],G=k(b,h,E),V=new ArrayBuffer(G),l=new DataView(V),O=0,v=0,s=-1;h.length>0&&(s=h[0]._offset);for(var U,B=0,o=0,u=0,D=b.length;u<D;u++)if(l.setUint8(v+u,b[u]),u+1===s){if(B=(U=h[O])._length,o=v+s,U._bin)for(var g=new Uint8Array(U._bin),S=0;S<B;S++)l.setUint8(o+S,g[S]);else U._str?a(l,o,U._str):void 0!==U._float&&l.setFloat64(o,U._float);v+=B,h[++O]&&(s=h[O]._offset)}return V}},10761:(E,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.NoneSerializer=void 0;b.NoneSerializer=class{setState(E){}getState(){return null}patch(E){}teardown(){}handshake(E){}}},10755:(E,b,h)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.SchemaSerializer=void 0;const a=h(10743);b.SchemaSerializer=class{setState(E){return this.state.decode(E)}getState(){return this.state}patch(E){return this.state.decode(E)}teardown(){var E,b;null===(b=null===(E=this.state)||void 0===E?void 0:E.$changes)||void 0===b||b.root.clearRefs()}handshake(E,b){if(this.state){(new a.Reflection).decode(E,b)}else this.state=a.Reflection.decode(E,b)}}},10729:(E,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.getSerializer=b.registerSerializer=void 0;const h={};b.registerSerializer=function(E,b){h[E]=b},b.getSerializer=function(E){const b=h[E];if(!b)throw new Error("missing serializer: "+E);return b}},10716:function(E,b,h){"use strict";var a=this&&this.__importDefault||function(E){return E&&E.__esModule?E:{default:E}};Object.defineProperty(b,"__esModule",{value:!0}),b.WebSocketTransport=void 0;const k=a(h(10718)),G=globalThis.WebSocket||k.default;b.WebSocketTransport=class{constructor(E){this.events=E}send(E){E instanceof ArrayBuffer?this.ws.send(E):Array.isArray(E)&&this.ws.send(new Uint8Array(E).buffer)}connect(E){this.ws=new G(E,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(E,b){this.ws.close(E,b)}get isOpen(){return this.ws.readyState===G.OPEN}}},10718:E=>{"use strict";E.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12395:E=>{"use strict";function b(E,h,a){var k=0|E[a];if(k<=0)return[];var G,V=new Array(k);if(a===E.length-1)for(G=0;G<k;++G)V[G]=h;else for(G=0;G<k;++G)V[G]=b(E,h,a+1);return V}E.exports=function(E,h){switch("undefined"===typeof h&&(h=0),typeof E){case"number":if(E>0)return function(E,b){var h,a;for(h=new Array(E),a=0;a<E;++a)h[a]=b;return h}(0|E,h);break;case"object":if("number"===typeof E.length)return b(E,h,0)}return[]}},12345:(E,b,h)=>{E.exports=function(){var E=this;this.components={},this.comps=this.components;var b=this.components,h=1,k={},G=[],V=[],l={timeout:!1,removals:[],multiComps:[]};function O(E,h){var a=b[h],G=k[h],V=G.hash[E];V&&(G.remove(E),a.ab&&(a.multi?(V.forEach((b=>{b&&a.ab(E,b)})),V.length=0):a.ab(E,V)),l.removals.push(G),v())}function v(){l.timeout||(l.timeout=!0,setTimeout(s,1))}function s(){l.timeout=!1,U()}function U(){l.multiComps.length&&function(E){for(var b=0;b<E.length;b++){var{entID:h,data:a}=E[b],k=a.hash[h];if(k){for(var G=0;G<k.length;G++)k[G]||(k.splice(G,1),G--);0===k.length&&(a.remove(h),l.removals.push(a))}}E.length=0}(l.multiComps),l.removals.length&&function(E){for(var b=0;b<E.length;b++){E[b].flush()}E.length=0}(l.removals)}this.Ki=k,this._systems=G,this._renderSystems=V,this.uh=function(b){var a=h++;return Array.isArray(b)&&b.forEach((b=>E.vf(a,b))),a},this.deleteEntity=function(b){return Object.keys(k).forEach((E=>{k[E].hash[b]&&O(b,E)})),E},this.Ph=function(E){if(!E)throw new Error("Missing component definition");var h=E.name;if(!h)throw new Error("Component definition must have a name property.");if("string"!==typeof h)throw new Error("Component name must be a string.");if(""===h)throw new Error("Component name must be a non-empty string.");if(k[h])throw new Error(`Component ${h} already exists.`);var l={};return l.name=h,l.multi=!!E.multi,l.order=isNaN(E.order)?99:E.order,l.stateConstructor=E.stateConstructor||null,l.state=E.state||{},l.Yd=E.Yd||null,l.ab=E.ab||null,l.system=E.system||null,l.je=E.je||null,b[h]=l,k[h]=new a,k[h]._pendingMultiCleanup=!1,k[h]._multiCleanupIDs=l.multi?[]:null,l.system&&(G.push(h),G.sort(((E,h)=>b[E].order-b[h].order))),l.je&&(V.push(h),V.sort(((E,h)=>b[E].order-b[h].order))),h},this.overwriteComponent=function(E,h){var a=b[E];if(!a)throw new Error(`Unknown component: ${E}`);if(!h)throw new Error("Missing component definition");if(a.name!==h.name)throw new Error("Overwriting component must use the same name property.");var l={};l.name=E,l.multi=!!h.multi,l.order=isNaN(h.order)?99:h.order,l.state=h.state||{},l.Yd=h.Yd||null,l.ab=h.ab||null,l.system=h.system||null,l.je=h.je||null,b[E]=l,k[E]._pendingMultiCleanup=!1,k[E]._multiCleanupIDs=l.multi?[]:null;var O=G.indexOf(E);l.system&&O<0&&G.push(E),!l.system&&O>=0&&G.splice(O,1),G.sort(((E,h)=>b[E].order-b[h].order));var v=V.indexOf(E);l.je&&v<0&&V.push(E),!l.je&&v>=0&&V.splice(v,1),V.sort(((E,h)=>b[E].order-b[h].order));var s=l.state;return this.Ug(E).forEach((E=>{for(var b in s)b in E||(E[b]=s[b]);l.Yd&&l.Yd(E.ge,E)})),E},this.deleteComponent=function(h){var a=k[h];if(!a)throw new Error(`Unknown component: ${h}`);a.flush(),a.list.forEach((E=>{E&&O(E.ge||E[0].ge,h)}));var l=G.indexOf(h),v=V.indexOf(h);return l>-1&&G.splice(l,1),v>-1&&V.splice(v,1),k[h].dispose(),delete k[h],delete b[h],E},this.vf=function(E,h,a){var G,V=b[h],l=k[h];if(!l)throw new Error(`Unknown component: ${h}.`);if(l.hash[E]&&!V.multi)throw new Error(`Entity ${E} already has component: ${h}.`);if(V.stateConstructor){if(!(G=new V.stateConstructor).hasOwnProperty("ge"))throw new Error(`Component ${V.name} stateConstructor type does not have property __id`)}else G=Object.assign({},{ge:E},V.state,a);if(G.ge=E,V.multi){var O=l.hash[E];O||(O=[],l.add(E,O)),O.push(G)}else l.add(E,G);return V.Yd&&V.Yd(E,G),this},this.If=function(E,b){var h=k[b];if(!h)throw new Error(`Unknown component: ${b}.`);return!!h.hash[E]},this.zf=function(b,h){if(!k[h])throw new Error(`Unknown component: ${h}.`);return O(b,h),E},this.getState=function(E,b){var h=k[b];if(!h)throw new Error(`Unknown component: ${b}.`);return h.hash[E]},this.Ug=function(E){var b=k[E];if(!b)throw new Error(`Unknown component: ${E}.`);return U(),b.list},this.Fk=function(E){if(!k[E])throw new Error(`Unknown component: ${E}.`);var b=k[E].hash;return E=>b[E]},this.Ik=function(E){if(!k[E])throw new Error(`Unknown component: ${E}.`);var b=k[E].hash;return E=>!!b[E]},this.Rd=function(h){U();for(var a=0;a<G.length;a++){var V=G[a],l=b[V],O=k[V];l.system(h,O.list),U()}return E},this.render=function(h){U();for(var a=0;a<V.length;a++){var G=V[a],l=b[G],O=k[G];l.je(h,O.list),U()}return E},this.removeMultiComponent=function(h,a,G){var V=b[a],O=k[a];if(!O)throw new Error(`Unknown component: ${a}.`);if(!V.multi)throw new Error("removeMultiComponent called on non-multi component");return function(E,b,h,a){var k=h.hash[E];if(k){var G=k[a];G&&(k[a]=null,b.ab&&b.ab(E,G),l.multiComps.push({entID:E,data:h}),v())}}(h,V,O,G),E}};var a=h(12353)},12353:E=>{function b(E,b){var h=E._map[b];if(delete E.hash[b],delete E._map[b],h===E.list.length-1)E.list.pop();else{var a=E.list.pop();if(E.list[h]=a,null===a||null===a[0]){var k=E.list.length;for(var G in E._map)if(E._map[G]===k)return void(E._map[G]=h)}else{var V=a.ge||a[0].ge;E._map[V]=h}}}E.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(E,b){if("number"===typeof this._map[E]){var h=this._map[E];this.hash[E]=b,this.list[h]=b}else this._map[E]=this.list.length,this.hash[E]=b,this.list.push(b)}remove(E){var b=this._map[E];this.hash[E]=null,this.list[b]=null,this._pendingRemovals.push(E)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var E=0;E<this._pendingRemovals.length;E++){var h=this._pendingRemovals[E];null===this.hash[h]&&b(this,h)}this._pendingRemovals.length=0}}},12611:E=>{"use strict";E.exports=function(E,b,h,a,k,G){var V=+b[0],l=+b[1],O=+b[2],v=+h[0],s=+h[1],U=+h[2],B=Math.sqrt(v*v+s*s+U*U);if(0===B)throw new Error("Can't raycast along a zero vector");return function(E,b,h,a,k,G,V,l,O,v){for(var s=0,U=Math.floor,B=0|U(b),o=0|U(h),u=0|U(a),D=k>0?1:-1,g=G>0?1:-1,S=V>0?1:-1,M=Math.abs(1/k),I=Math.abs(1/G),j=Math.abs(1/V),P=M<1/0?M*(D>0?B+1-b:b-B):1/0,A=I<1/0?I*(g>0?o+1-h:h-o):1/0,n=j<1/0?j*(S>0?u+1-a:a-u):1/0,d=-1;s<=l;){var c=E(B,o,u);if(c)return O&&(O[0]=b+s*k,O[1]=h+s*G,O[2]=a+s*V),v&&(v[0]=v[1]=v[2]=0,0===d&&(v[0]=-D),1===d&&(v[1]=-g),2===d&&(v[2]=-S)),c;P<A?P<n?(B+=D,s=P,P+=M,d=0):(u+=S,s=n,n+=j,d=2):A<n?(o+=g,s=A,A+=I,d=1):(u+=S,s=n,n+=j,d=2)}return O&&(O[0]=b+s*k,O[1]=h+s*G,O[2]=a+s*V),v&&(v[0]=v[1]=v[2]=0),0}(E,V,l,O,v/=B,s/=B,U/=B,a="undefined"===typeof a?64:+a,k,G)}},12647:(E,b,h)=>{"use strict";h.d(b,{e:()=>G});var a=h(729);function k(){this.Dj=!1,this.stopPropagation=!1,this.Ej=!1,this.disabled=!1}class G{constructor(E,b){this.version="0.7.0";var h=Object.assign({},new k,b||{});this.element=E||document,this.Dj=!!h.Dj,this.stopPropagation=!!h.stopPropagation,this.Ej=!!h.Ej,this.disabled=!!h.disabled,this.filterEvents=(E,b)=>!0,this.down=new a.EventEmitter,this.up=new a.EventEmitter,this.state={},this.Lg={dx:0,dy:0,wk:0,Kg:0,xk:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?l(this):document.addEventListener("DOMContentLoaded",(E=>{l(this)}),{once:!0})}bind(E){for(var b=arguments.length,h=new Array(b>1?b-1:0),a=1;a<b;a++)h[a-1]=arguments[a];h.forEach((b=>{var h=this._keyBindmap[b]||[];h.includes(E)||(h.push(E),this._keyBindmap[b]=h)})),this.state[E]=!!this.state[E],this.pressCount[E]=this.pressCount[E]||0,this.releaseCount[E]=this.releaseCount[E]||0}unbind(E){for(var b in this._keyBindmap){var h=this._keyBindmap[b],a=h.indexOf(E);a>-1&&h.splice(a,1)}}getBindings(){var E={};for(var b in this._keyBindmap){this._keyBindmap[b].forEach((h=>{E[h]=E[h]||[],E[h].push(b)}))}return E}Rd(){V(this.Lg),V(this.pressCount),V(this.releaseCount)}}function V(E){for(var b in E)E[b]=0}function l(E){window.addEventListener("keydown",u.bind(null,E,!0),!1),window.addEventListener("keyup",u.bind(null,E,!1),!1);var b={passive:!0};E.element.addEventListener("touchstart",U.bind(void 0,E),{passive:!1}),E.element.addEventListener("touchend",o.bind(void 0,E),b),E.element.addEventListener("mousedown",D.bind(null,E,!0),b),window.document.addEventListener("mouseup",D.bind(null,E,!1),b),E.element.addEventListener("touchmove",g.bind(null,E),b),E.element.addEventListener("mousemove",g.bind(null,E),b),window.PointerEvent,E.element.addEventListener("wheel",S.bind(null,E),b),E.element.addEventListener("contextmenu",M.bind(null,E),!1),window.addEventListener("blur",I.bind(null,E),!1)}var O=0,v=0,s=null;function U(E,b){b.preventDefault(),B(b)}function B(E){let b=!1;for(let h=0;h<E.touches.length;++h)if(E.touches[h].identifier===s){b=!0;break}if(!b){const b=E.changedTouches[0];O=b.clientX,v=b.clientY,s=b.identifier}}function o(E,b){for(var h=b.changedTouches,a=0;a<h.length;++a)h[a].identifier===s&&(s=null)}function u(E,b,h){j(h.code,b,E,h)}function D(E,b,h){if("pointerId"in h)if(b){if(null!==E._touches.currID)return;E._touches.currID=h.pointerId}else{if(E._touches.currID!==h.pointerId)return;E._touches.currID=null}return j("Mouse"+("button"in h?h.button+1:1),b,E,h),!1}function g(E,b){var h=b.movementX||b.mozMovementX||0,a=b.movementY||b.mozMovementY||0;if(b.touches&&0===(h|a)){var k=function(E){B(E);for(let b=0;b<E.changedTouches.length;++b)if(E.changedTouches[b].identifier==s){const h=E.changedTouches[b],a=[h.clientX-O,h.clientY-v];return O=h.clientX,v=h.clientY,a}return console.error(`Did not find touch id ${s}`),[0,0]}(b);h=k[0],a=k[1]}E.Lg.dx+=h,E.Lg.dy+=a}function S(E,b){var h=1;switch(b.deltaMode){case 0:h=1;break;case 1:h=12;break;case 2:h=E.element.clientHeight||window.innerHeight}E.Lg.wk+=(b.deltaX||0)*h,E.Lg.Kg+=(b.deltaY||0)*h,E.Lg.xk+=(b.deltaZ||0)*h}function M(E,b){if(!E.Ej)return b.preventDefault(),!1}function I(E){for(var b in E._keyStates)E._keyStates[b]&&(/^Mouse\d/.test(b)||j(b,!1,E,{code:b,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function j(E,b,h,a){var k=h._keyBindmap[E];k&&(P(h._keyStates[E],b)&&(h._keyStates[E]=b,k.forEach((E=>{(!h.filterEvents||h.filterEvents(a,E))&&function(E,b,h,a){var k=b?h.pressCount:h.releaseCount;k[E]=(k[E]||0)+1;var G=h._bindPressCount[E]||0;(G+=b?1:-1)<0&&(G=0);h._bindPressCount[E]=G;var V=h.state[E];if(P(V,G)){h.state[E]=G>0;var l=b?h.down:h.up;h.disabled||l.emit(E,a)}}(E,b,h,a)}))),"button"in a||(h.Dj&&!a.defaultPrevented&&a.preventDefault(),h.stopPropagation&&a.stopPropagation()))}function P(E,b){return E?!b:b}},10808:E=>{"use strict";E.exports=function(E){for(var b=new Array(E),h=0;h<E;++h)b[h]=h;return b}},10816:E=>{function b(E){return!!E.constructor&&"function"===typeof E.constructor.isBuffer&&E.constructor.isBuffer(E)}E.exports=function(E){return null!=E&&(b(E)||function(E){return"function"===typeof E.readFloatLE&&"function"===typeof E.slice&&b(E.slice(0,0))}(E)||!!E._isBuffer)}},12619:(E,b,h)=>{"use strict";h.d(b,{c:()=>a});class a{constructor(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.hi=!1,this.ii=!1,this.fi=30,this.gi=0,this.qi=!1,this.fullscreen=!1,this.ki=function(E){},this.li=function(){},this.oi=function(){},this.bb=function(){},this.mi=function(E){},this.onFullscreenChanged=function(E){},v((()=>{!function(E,b){E._nowObject=performance||Date,E._lastTick=0,E._renderAccum=0,E._rt=0,E._frameCB=l.bind(null,E),requestAnimationFrame(E._frameCB),b>0&&(E._intervalCB=V.bind(null,E),E._interval=setInterval(E._intervalCB,Math.max(b,1e3/E.fi/2)))}(this,b),function(E,b){if(!b)return;var h=!1,a=!1;document.addEventListener("pointerlockchange",(a=>{h=document.pointerLockElement===b,E.mi(h)})),document.addEventListener("fullscreenchange",(h=>{a=document.fullscreenElement===b,E.onFullscreenChanged(a)})),Object.defineProperty(E,"qi",{get:()=>h,set:E=>{E&&!h?O(b):h&&!E&&function(E){E.exitPointerLock&&E.exitPointerLock()}(document)}}),Object.defineProperty(E,"fullscreen",{get:()=>a,set:E=>{E&&!a?b.requestFullscreen():a&&!E&&document.exitFullscreen()}}),b.addEventListener("click",(k=>{E.hi&&!h&&O(b),E.ii&&!a&&b.requestFullscreen()}));var k=()=>E.bb();if(window.ResizeObserver){new ResizeObserver(k).observe(b)}else window.addEventListener("resize",k)}(this,E),this.oi()}))}}var k=3,G=20;function V(E){for(var b=1e3/E.fi,h=E._nowObject.now()+G,a=0;E._nowObject.now()>=E._lastTick+b&&E._nowObject.now()<h&&++a<=k;)E.ki(b),E._lastTick+=b;var V=5*(b+5),l=E._nowObject.now();if(l-E._lastTick>V)for(;l>=E._lastTick+b;)E._lastTick+=b}function l(E){requestAnimationFrame(E._frameCB),V(E);var b=E._nowObject.now(),h=b-E._rt;if(E._rt=b,E.gi>0){E._renderAccum+=h;var a=1e3/E.gi;if(E._renderAccum<a)return;E._renderAccum=Math.min(E._renderAccum-a,a)}var k=1e3/E.fi,G=(b-E._lastTick)/k;E.li(h,G,k)}function O(E){E.requestPointerLock&&E.requestPointerLock()}var v=E=>{if("loading"===document.readyState){var b=()=>{document.removeEventListener("readystatechange",b),E()};document.addEventListener("readystatechange",b)}else setTimeout(E,1)}},10800:(E,b,h)=>{var a=h(10808),k=h(10816),G="undefined"!==typeof Float64Array;function V(E,b){return E[0]-b[0]}function l(){var E,b=this.stride,h=new Array(b.length);for(E=0;E<h.length;++E)h[E]=[Math.abs(b[E]),E];h.sort(V);var a=new Array(h.length);for(E=0;E<a.length;++E)a[E]=h[E][1];return a}function O(E,b){var h=["View",b,"d",E].join("");b<0&&(h="View_Nil"+E);var k="generic"===E;if(-1===b){var G="function "+h+"(a){this.data=a;};var proto="+h+".prototype;proto.dtype='"+E+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+h+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+h+"(a){return new "+h+"(a);}";return new Function(G)()}if(0===b){G="function "+h+"(a,d) {this.data = a;this.offset = d};var proto="+h+".prototype;proto.dtype='"+E+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+h+"_copy() {return new "+h+"(this.data,this.offset)};proto.pick=function "+h+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+h+"_get(){return "+(k?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+h+"_set(v){return "+(k?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+h+"(a,b,c,d){return new "+h+"(a,d)}";return new Function("TrivialArray",G)(v[E][0])}G=["'use strict'"];var V=a(b),O=V.map((function(E){return"i"+E})),s="this.offset+"+V.map((function(E){return"this.stride["+E+"]*i"+E})).join("+"),U=V.map((function(E){return"b"+E})).join(","),B=V.map((function(E){return"c"+E})).join(",");G.push("function "+h+"(a,"+U+","+B+",d){this.data=a","this.shape=["+U+"]","this.stride=["+B+"]","this.offset=d|0}","var proto="+h+".prototype","proto.dtype='"+E+"'","proto.dimension="+b),G.push("Object.defineProperty(proto,'size',{get:function "+h+"_size(){return "+V.map((function(E){return"this.shape["+E+"]"})).join("*"),"}})"),1===b?G.push("proto.order=[0]"):(G.push("Object.defineProperty(proto,'order',{get:"),b<4?(G.push("function "+h+"_order(){"),2===b?G.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===b&&G.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):G.push("ORDER})")),G.push("proto.set=function "+h+"_set("+O.join(",")+",v){"),k?G.push("return this.data.set("+s+",v)}"):G.push("return this.data["+s+"]=v}"),G.push("proto.get=function "+h+"_get("+O.join(",")+"){"),k?G.push("return this.data.get("+s+")}"):G.push("return this.data["+s+"]}"),G.push("proto.index=function "+h+"_index(",O.join(),"){return "+s+"}"),G.push("proto.hi=function "+h+"_hi("+O.join(",")+"){return new "+h+"(this.data,"+V.map((function(E){return["(typeof i",E,"!=='number'||i",E,"<0)?this.shape[",E,"]:i",E,"|0"].join("")})).join(",")+","+V.map((function(E){return"this.stride["+E+"]"})).join(",")+",this.offset)}");var o=V.map((function(E){return"a"+E+"=this.shape["+E+"]"})),u=V.map((function(E){return"c"+E+"=this.stride["+E+"]"}));G.push("proto.lo=function "+h+"_lo("+O.join(",")+"){var b=this.offset,d=0,"+o.join(",")+","+u.join(","));for(var D=0;D<b;++D)G.push("if(typeof i"+D+"==='number'&&i"+D+">=0){d=i"+D+"|0;b+=c"+D+"*d;a"+D+"-=d}");G.push("return new "+h+"(this.data,"+V.map((function(E){return"a"+E})).join(",")+","+V.map((function(E){return"c"+E})).join(",")+",b)}"),G.push("proto.step=function "+h+"_step("+O.join(",")+"){var "+V.map((function(E){return"a"+E+"=this.shape["+E+"]"})).join(",")+","+V.map((function(E){return"b"+E+"=this.stride["+E+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(D=0;D<b;++D)G.push("if(typeof i"+D+"==='number'){d=i"+D+"|0;if(d<0){c+=b"+D+"*(a"+D+"-1);a"+D+"=ceil(-a"+D+"/d)}else{a"+D+"=ceil(a"+D+"/d)}b"+D+"*=d}");G.push("return new "+h+"(this.data,"+V.map((function(E){return"a"+E})).join(",")+","+V.map((function(E){return"b"+E})).join(",")+",c)}");var g=new Array(b),S=new Array(b);for(D=0;D<b;++D)g[D]="a[i"+D+"]",S[D]="b[i"+D+"]";G.push("proto.transpose=function "+h+"_transpose("+O+"){"+O.map((function(E,b){return E+"=("+E+"===undefined?"+b+":"+E+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+h+"(this.data,"+g.join(",")+","+S.join(",")+",this.offset)}"),G.push("proto.pick=function "+h+"_pick("+O+"){var a=[],b=[],c=this.offset");for(D=0;D<b;++D)G.push("if(typeof i"+D+"==='number'&&i"+D+">=0){c=(c+this.stride["+D+"]*i"+D+")|0}else{a.push(this.shape["+D+"]);b.push(this.stride["+D+"])}");return G.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),G.push("return function construct_"+h+"(data,shape,stride,offset){return new "+h+"(data,"+V.map((function(E){return"shape["+E+"]"})).join(",")+","+V.map((function(E){return"stride["+E+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",G.join("\n"))(v[E],l)}var v={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};E.exports=function(E,b,h,a){if(void 0===E)return(0,v.array[0])([]);"number"===typeof E&&(E=[E]),void 0===b&&(b=[E.length]);var V=b.length;if(void 0===h){h=new Array(V);for(var l=V-1,s=1;l>=0;--l)h[l]=s,s*=b[l]}if(void 0===a){a=0;for(l=0;l<V;++l)h[l]<0&&(a-=(b[l]-1)*h[l])}for(var U=function(E){if(k(E))return"buffer";if(G)switch(Object.prototype.toString.call(E)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(E)?"array":"generic"}(E),B=v[U];B.length<=V+1;)B.push(O(U,B.length-1));return(0,B[V+1])(E,b,h,a)}},10774:E=>{var b;self,b=()=>(()=>{"use strict";var E={d:(b,h)=>{for(var a in h)E.o(h,a)&&!E.o(b,a)&&Object.defineProperty(b,a,{enumerable:!0,get:h[a]})},o:(E,b)=>Object.prototype.hasOwnProperty.call(E,b)},b={};E.d(b,{default:()=>H});var h,a=function(E,b){var h=b.x-E.x,a=b.y-E.y;return Math.sqrt(h*h+a*a)},k=function(E){return E*(Math.PI/180)},G=new Map,V=function(E){G.has(E)&&clearTimeout(G.get(E)),G.set(E,setTimeout(E,100))},l=function(E,b,h){for(var a,k=b.split(/[ ,]+/g),G=0;G<k.length;G+=1)a=k[G],E.addEventListener?E.addEventListener(a,h,!1):E.attachEvent&&E.attachEvent(a,h)},O=function(E,b,h){for(var a,k=b.split(/[ ,]+/g),G=0;G<k.length;G+=1)a=k[G],E.removeEventListener?E.removeEventListener(a,h):E.detachEvent&&E.detachEvent(a,h)},v=function(E){return E.preventDefault(),E.type.match(/^touch/)?E.changedTouches:E},s=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},U=function(E,b){b.top||b.right||b.bottom||b.left?(E.style.top=b.top,E.style.right=b.right,E.style.bottom=b.bottom,E.style.left=b.left):(E.style.left=b.x+"px",E.style.top=b.y+"px")},B=function(E,b,h){var a=o(E);for(var k in a)if(a.hasOwnProperty(k))if("string"==typeof b)a[k]=b+" "+h;else{for(var G="",V=0,l=b.length;V<l;V+=1)G+=b[V]+" "+h+", ";a[k]=G.slice(0,-2)}return a},o=function(E){var b={};return b[E]="",["webkit","Moz","o"].forEach((function(h){b[h+E.charAt(0).toUpperCase()+E.slice(1)]=""})),b},u=function(E,b){for(var h in b)b.hasOwnProperty(h)&&(E[h]=b[h]);return E},D=function(E,b){if(E.length)for(var h=0,a=E.length;h<a;h+=1)b(E[h]);else b(E)},g="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,S=window.matchMedia("(any-hover: none)").matches,M=!!("ontouchstart"in window),I=!!window.PointerEvent,j=!!window.MSPointerEvent,P={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},A={start:"mousedown",move:"mousemove",end:"mouseup"},n={};function d(){}g&&!S?h=P:I?h={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:j?h={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:M?(h=P,n=A):h=A,d.prototype.on=function(E,b){var h,a=this,k=E.split(/[ ,]+/g);a._handlers_=a._handlers_||{};for(var G=0;G<k.length;G+=1)h=k[G],a._handlers_[h]=a._handlers_[h]||[],a._handlers_[h].push(b);return a},d.prototype.off=function(E,b){var h=this;return h._handlers_=h._handlers_||{},void 0===E?h._handlers_={}:void 0===b?h._handlers_[E]=null:h._handlers_[E]&&h._handlers_[E].indexOf(b)>=0&&h._handlers_[E].splice(h._handlers_[E].indexOf(b),1),h},d.prototype.trigger=function(E,b){var h,a=this,k=E.split(/[ ,]+/g);a._handlers_=a._handlers_||{};for(var G=0;G<k.length;G+=1)h=k[G],a._handlers_[h]&&a._handlers_[h].length&&a._handlers_[h].forEach((function(E){E.call(a,{type:h,target:a},b)}))},d.prototype.config=function(E){var b=this;b.options=b.defaults||{},E&&(b.options=function(E,b){var h={};for(var a in E)E.hasOwnProperty(a)&&b.hasOwnProperty(a)?h[a]=b[a]:E.hasOwnProperty(a)&&(h[a]=E[a]);return h}(b.options,E))},d.prototype.bindEvt=function(E,b){var a=this;return a._domHandlers_=a._domHandlers_||{},a._domHandlers_[b]=function(){"function"==typeof a["on"+b]?a["on"+b].apply(a,arguments):console.warn('[WARNING] : Missing "on'+b+'" handler.')},l(E,h[b],a._domHandlers_[b]),n[b]&&l(E,n[b],a._domHandlers_[b]),a},d.prototype.unbindEvt=function(E,b){var a=this;return a._domHandlers_=a._domHandlers_||{},O(E,h[b],a._domHandlers_[b]),n[b]&&O(E,n[b],a._domHandlers_[b]),delete a._domHandlers_[b],this};const c=d;function z(E,b){return this.identifier=b.identifier,this.position=b.position,this.frontPosition=b.frontPosition,this.collection=E,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(b),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=z.id,z.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}z.prototype=new c,z.constructor=z,z.id=0,z.prototype.buildEl=function(E){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},z.prototype.stylize=function(){if(this.options.dataOnly)return this;var E=this.options.fadeTime+"ms",b=function(){var E=o("borderRadius");for(var b in E)E.hasOwnProperty(b)&&(E[b]="50%");return E}(),h=B("transition","opacity",E),a={};return a.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},a.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},a.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},u(a.el,h),"circle"===this.options.shape&&u(a.back,b),u(a.front,b),this.applyStyles(a),this},z.prototype.applyStyles=function(E){for(var b in this.ui)if(this.ui.hasOwnProperty(b))for(var h in E[b])this.ui[b].style[h]=E[b][h];return this},z.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},z.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},z.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},z.prototype.show=function(E){var b=this;return b.options.dataOnly||(clearTimeout(b.removeTimeout),clearTimeout(b.showTimeout),clearTimeout(b.restTimeout),b.addToDom(),b.restCallback(),setTimeout((function(){b.ui.el.style.opacity=1}),0),b.showTimeout=setTimeout((function(){b.trigger("shown",b.instance),"function"==typeof E&&E.call(this)}),b.options.fadeTime)),b},z.prototype.hide=function(E){var b=this;if(b.options.dataOnly)return b;if(b.ui.el.style.opacity=b.options.restOpacity,clearTimeout(b.removeTimeout),clearTimeout(b.showTimeout),clearTimeout(b.restTimeout),b.removeTimeout=setTimeout((function(){var h="dynamic"===b.options.mode?"none":"block";b.ui.el.style.display=h,"function"==typeof E&&E.call(b),b.trigger("hidden",b.instance)}),b.options.fadeTime),b.options.restJoystick){var h=b.options.restJoystick,a={};a.x=!0===h||!1!==h.x?0:b.instance.frontPosition.x,a.y=!0===h||!1!==h.y?0:b.instance.frontPosition.y,b.setPosition(E,a)}return b},z.prototype.setPosition=function(E,b){var h=this;h.frontPosition={x:b.x,y:b.y};var a=h.options.fadeTime+"ms",k={};k.front=B("transition",["transform"],a);var G={front:{}};G.front={transform:"translate("+h.frontPosition.x+"px,"+h.frontPosition.y+"px)"},h.applyStyles(k),h.applyStyles(G),h.restTimeout=setTimeout((function(){"function"==typeof E&&E.call(h),h.restCallback()}),h.options.fadeTime)},z.prototype.restCallback=function(){var E=this,b={};b.front=B("transition","none",""),E.applyStyles(b),E.trigger("rested",E.instance)},z.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},z.prototype.computeDirection=function(E){var b,h,a,k=E.angle.radian,G=Math.PI/4,V=Math.PI/2;if(k>G&&k<3*G&&!E.lockX?b="up":k>-G&&k<=G&&!E.lockY?b="left":k>3*-G&&k<=-G&&!E.lockX?b="down":E.lockY||(b="right"),E.lockY||(h=k>-V&&k<V?"left":"right"),E.lockX||(a=k>0?"up":"down"),E.force>this.options.threshold){var l,O={};for(l in this.direction)this.direction.hasOwnProperty(l)&&(O[l]=this.direction[l]);var v={};for(l in this.direction={x:h,y:a,angle:b},E.direction=this.direction,O)O[l]===this.direction[l]&&(v[l]=!0);if(v.x&&v.y&&v.angle)return E;v.x&&v.y||this.trigger("plain",E),v.x||this.trigger("plain:"+h,E),v.y||this.trigger("plain:"+a,E),v.angle||this.trigger("dir dir:"+b,E)}else this.resetDirection();return E};const Z=z;function Y(E,b){var h=this;h.nipples=[],h.idles=[],h.actives=[],h.ids=[],h.pressureIntervals={},h.manager=E,h.id=Y.id,Y.id+=1,h.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},h.config(b),"static"!==h.options.mode&&"semi"!==h.options.mode||(h.options.multitouch=!1),h.options.multitouch||(h.options.maxNumberOfNipples=1);var a=getComputedStyle(h.options.zone.parentElement);return a&&"flex"===a.display&&(h.parentIsFlex=!0),h.updateBox(),h.prepareNipples(),h.Fj(),h.begin(),h.nipples}Y.prototype=new c,Y.constructor=Y,Y.id=0,Y.prototype.prepareNipples=function(){var E=this,b=E.nipples;b.on=E.on.bind(E),b.off=E.off.bind(E),b.options=E.options,b.destroy=E.destroy.bind(E),b.ids=E.ids,b.id=E.id,b.processOnMove=E.processOnMove.bind(E),b.processOnEnd=E.processOnEnd.bind(E),b.get=function(E){if(void 0===E)return b[0];for(var h=0,a=b.length;h<a;h+=1)if(b[h].identifier===E)return b[h];return!1}},Y.prototype.Fj=function(){var E=this;E.bindEvt(E.options.zone,"start"),E.options.zone.style.touchAction="none",E.options.zone.style.msTouchAction="none"},Y.prototype.begin=function(){var E=this,b=E.options;if("static"===b.mode){var h=E.createNipple(b.position,E.manager.getIdentifier());h.add(),E.idles.push(h)}},Y.prototype.createNipple=function(E,b){var h=this,a=h.manager.scroll,k={},G=h.options,V=h.parentIsFlex?a.x:a.x+h.box.left,l=h.parentIsFlex?a.y:a.y+h.box.top;if(E.x&&E.y)k={x:E.x-V,y:E.y-l};else if(E.top||E.right||E.bottom||E.left){var O=document.createElement("DIV");O.style.display="hidden",O.style.top=E.top,O.style.right=E.right,O.style.bottom=E.bottom,O.style.left=E.left,O.style.position="absolute",G.zone.appendChild(O);var v=O.getBoundingClientRect();G.zone.removeChild(O),k=E,E={x:v.left+a.x,y:v.top+a.y}}var s=new Z(h,{color:G.color,size:G.size,threshold:G.threshold,fadeTime:G.fadeTime,dataOnly:G.dataOnly,restJoystick:G.restJoystick,restOpacity:G.restOpacity,mode:G.mode,identifier:b,position:E,zone:G.zone,frontPosition:{x:0,y:0},shape:G.shape});return G.dataOnly||(U(s.ui.el,k),U(s.ui.front,s.frontPosition)),h.nipples.push(s),h.trigger("added "+s.identifier+":added",s),h.manager.trigger("added "+s.identifier+":added",s),h.bindNipple(s),s},Y.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},Y.prototype.bindNipple=function(E){var b,h=this,a=function(E,a){b=E.type+" "+a.id+":"+E.type,h.trigger(b,a)};E.on("destroyed",h.onDestroyed.bind(h)),E.on("shown hidden rested dir plain",a),E.on("dir:up dir:right dir:down dir:left",a),E.on("plain:up plain:right plain:down plain:left",a)},Y.prototype.pressureFn=function(E,b,h){var a=this,k=0;clearInterval(a.pressureIntervals[h]),a.pressureIntervals[h]=setInterval(function(){var h=E.force||E.pressure||E.webkitForce||0;h!==k&&(b.trigger("pressure",h),a.trigger("pressure "+b.identifier+":pressure",h),k=h)}.bind(a),100)},Y.prototype.onstart=function(E){var b=this,h=b.options,a=E;return E=v(E),b.updateBox(),D(E,(function(k){b.actives.length<h.maxNumberOfNipples?b.processOnStart(k):a.type.match(/^touch/)&&(Object.keys(b.manager.ids).forEach((function(h){if(Object.values(a.touches).findIndex((function(E){return E.identifier===h}))<0){var k=[E[0]];k.identifier=h,b.processOnEnd(k)}})),b.actives.length<h.maxNumberOfNipples&&b.processOnStart(k))})),b.manager.bindDocument(),!1},Y.prototype.processOnStart=function(E){var b,h=this,k=h.options,G=h.manager.getIdentifier(E),V=E.force||E.pressure||E.webkitForce||0,l={x:E.pageX,y:E.pageY},O=h.getOrCreate(G,l);O.identifier!==G&&h.manager.removeIdentifier(O.identifier),O.identifier=G;var v=function(b){b.trigger("start",b),h.trigger("start "+b.id+":start",b),b.show(),V>0&&h.pressureFn(E,b,b.identifier),h.processOnMove(E)};if((b=h.idles.indexOf(O))>=0&&h.idles.splice(b,1),h.actives.push(O),h.ids.push(O.identifier),"semi"!==k.mode)v(O);else{if(!(a(l,O.position)<=k.catchDistance))return O.destroy(),void h.processOnStart(E);v(O)}return O},Y.prototype.getOrCreate=function(E,b){var h,a=this,k=a.options;return/(semi|static)/.test(k.mode)?(h=a.idles[0])?(a.idles.splice(0,1),h):"semi"===k.mode?a.createNipple(b,E):(console.warn("Coudln't find the needed nipple."),!1):h=a.createNipple(b,E)},Y.prototype.processOnMove=function(E){var b=this,h=b.options,G=b.manager.getIdentifier(E),V=b.nipples.get(G),l=b.manager.scroll;if(function(E){return isNaN(E.buttons)?0!==E.pressure:0!==E.buttons}(E)){if(!V)return console.error("Found zombie joystick with ID "+G),void b.manager.removeIdentifier(G);if(h.dynamicPage){var O=V.el.getBoundingClientRect();V.position={x:l.x+O.left,y:l.y+O.top}}V.identifier=G;var v=V.options.size/2,s={x:E.pageX,y:E.pageY};h.lockX&&(s.y=V.position.y),h.lockY&&(s.x=V.position.x);var U,B,o,u,D,g,S,M,I,j,P=a(s,V.position),A=(U=s,o=(B=V.position).x-U.x,u=B.y-U.y,function(E){return E*(180/Math.PI)}(Math.atan2(u,o))),n=k(A),d=P/v,c={distance:P,position:s};if("circle"===V.options.shape?(D=Math.min(P,v),S=V.position,M=D,j={x:0,y:0},I=k(I=A),j.x=S.x-M*Math.cos(I),j.y=S.y-M*Math.sin(I),g=j):(g=function(E,b,h){return{x:Math.min(Math.max(E.x,b.x-h),b.x+h),y:Math.min(Math.max(E.y,b.y-h),b.y+h)}}(s,V.position,v),D=a(g,V.position)),h.follow){if(P>v){var z=s.x-g.x,Z=s.y-g.y;V.position.x+=z,V.position.y+=Z,V.el.style.top=V.position.y-(b.box.top+l.y)+"px",V.el.style.left=V.position.x-(b.box.left+l.x)+"px",P=a(s,V.position)}}else s=g,P=D;var Y=s.x-V.position.x,r=s.y-V.position.y;V.frontPosition={x:Y,y:r},h.dataOnly||(V.ui.front.style.transform="translate("+Y+"px,"+r+"px)");var w={identifier:V.identifier,position:s,force:d,pressure:E.force||E.pressure||E.webkitForce||0,distance:P,angle:{radian:n,degree:A},vector:{x:Y/v,y:-r/v},raw:c,instance:V,lockX:h.lockX,lockY:h.lockY};(w=V.computeDirection(w)).angle={radian:k(180-A),degree:180-A},V.trigger("move",w),b.trigger("move "+V.id+":move",w)}else this.processOnEnd(E)},Y.prototype.processOnEnd=function(E){var b=this,h=b.options,a=b.manager.getIdentifier(E),k=b.nipples.get(a),G=b.manager.removeIdentifier(k.identifier);k&&(h.dataOnly||k.hide((function(){"dynamic"===h.mode&&(k.trigger("removed",k),b.trigger("removed "+k.id+":removed",k),b.manager.trigger("removed "+k.id+":removed",k),k.destroy())})),clearInterval(b.pressureIntervals[k.identifier]),k.resetDirection(),k.trigger("end",k),b.trigger("end "+k.id+":end",k),b.ids.indexOf(k.identifier)>=0&&b.ids.splice(b.ids.indexOf(k.identifier),1),b.actives.indexOf(k)>=0&&b.actives.splice(b.actives.indexOf(k),1),/(semi|static)/.test(h.mode)?b.idles.push(k):b.nipples.indexOf(k)>=0&&b.nipples.splice(b.nipples.indexOf(k),1),b.manager.unbindDocument(),/(semi|static)/.test(h.mode)&&(b.manager.ids[G.id]=G.identifier))},Y.prototype.onDestroyed=function(E,b){var h=this;h.nipples.indexOf(b)>=0&&h.nipples.splice(h.nipples.indexOf(b),1),h.actives.indexOf(b)>=0&&h.actives.splice(h.actives.indexOf(b),1),h.idles.indexOf(b)>=0&&h.idles.splice(h.idles.indexOf(b),1),h.ids.indexOf(b.identifier)>=0&&h.ids.splice(h.ids.indexOf(b.identifier),1),h.manager.removeIdentifier(b.identifier),h.manager.unbindDocument()},Y.prototype.destroy=function(){var E=this;for(var b in E.unbindEvt(E.options.zone,"start"),E.nipples.forEach((function(E){E.destroy()})),E.pressureIntervals)E.pressureIntervals.hasOwnProperty(b)&&clearInterval(E.pressureIntervals[b]);E.trigger("destroyed",E.nipples),E.manager.unbindDocument(),E.off()};const r=Y;function w(E){var b=this;b.ids={},b.index=0,b.collections=[],b.scroll=s(),b.config(E),b.prepareCollections();var h=function(){var E;b.collections.forEach((function(h){h.forEach((function(h){E=h.el.getBoundingClientRect(),h.position={x:b.scroll.x+E.left,y:b.scroll.y+E.top}}))}))};l(window,"resize",(function(){V(h)}));var a=function(){b.scroll=s()};return l(window,"scroll",(function(){V(a)})),b.collections}w.prototype=new c,w.constructor=w,w.prototype.prepareCollections=function(){var E=this;E.collections.create=E.create.bind(E),E.collections.on=E.on.bind(E),E.collections.off=E.off.bind(E),E.collections.destroy=E.destroy.bind(E),E.collections.get=function(b){var h;return E.collections.every((function(E){return!(h=E.get(b))})),h}},w.prototype.create=function(E){return this.createCollection(E)},w.prototype.createCollection=function(E){var b=this,h=new r(b,E);return b.bindCollection(h),b.collections.push(h),h},w.prototype.bindCollection=function(E){var b,h=this,a=function(E,a){b=E.type+" "+a.id+":"+E.type,h.trigger(b,a)};E.on("destroyed",h.onDestroyed.bind(h)),E.on("shown hidden rested dir plain",a),E.on("dir:up dir:right dir:down dir:left",a),E.on("plain:up plain:right plain:down plain:left",a)},w.prototype.bindDocument=function(){var E=this;E.binded||(E.bindEvt(document,"move").bindEvt(document,"end"),E.binded=!0)},w.prototype.unbindDocument=function(E){var b=this;Object.keys(b.ids).length&&!0!==E||(b.unbindEvt(document,"move").unbindEvt(document,"end"),b.binded=!1)},w.prototype.getIdentifier=function(E){var b;return E?void 0===(b=void 0===E.identifier?E.pointerId:E.identifier)&&(b=this.latest||0):b=this.index,void 0===this.ids[b]&&(this.ids[b]=this.index,this.index+=1),this.latest=b,this.ids[b]},w.prototype.removeIdentifier=function(E){var b={};for(var h in this.ids)if(this.ids[h]===E){b.id=h,b.identifier=this.ids[h],delete this.ids[h];break}return b},w.prototype.onmove=function(E){return this.onAny("move",E),!1},w.prototype.onend=function(E){return this.onAny("end",E),!1},w.prototype.oncancel=function(E){return this.onAny("end",E),!1},w.prototype.onAny=function(E,b){var h,a=this,k="processOn"+E.charAt(0).toUpperCase()+E.slice(1);b=v(b);var G=function(E,b,h){h.ids.indexOf(b)>=0&&(h[k](E),E._found_=!0)};return D(b,(function(E){h=a.getIdentifier(E),D(a.collections,G.bind(null,E,h)),E._found_||a.removeIdentifier(h)})),!1},w.prototype.destroy=function(){var E=this;E.unbindDocument(!0),E.ids={},E.index=0,E.collections.forEach((function(E){E.destroy()})),E.off()},w.prototype.onDestroyed=function(E,b){var h=this;if(h.collections.indexOf(b)<0)return!1;h.collections.splice(h.collections.indexOf(b),1)};var N=new w;const H={create:function(E){return N.create(E)},factory:N};return b.default})(),E.exports=b()},10989:(E,b,h)=>{"use strict";const{Deflate:a,deflate:k,deflateRaw:G,gzip:V}=h(10992),{Inflate:l,inflate:O,inflateRaw:v,ungzip:s}=h(11060),U=h(11030);E.exports.Deflate=a,E.exports.deflate=k,E.exports.deflateRaw=G,E.exports.gzip=V,E.exports.Inflate=l,E.exports.inflate=O,E.exports.inflateRaw=v,E.exports.ungzip=s,E.exports.constants=U},10992:(E,b,h)=>{"use strict";const a=h(10999),k=h(11039),G=h(11047),V=h(11023),l=h(11055),O=Object.prototype.toString,{Z_NO_FLUSH:v,Z_SYNC_FLUSH:s,Z_FULL_FLUSH:U,Z_FINISH:B,Z_OK:o,Z_STREAM_END:u,Z_DEFAULT_COMPRESSION:D,Z_DEFAULT_STRATEGY:g,Z_DEFLATED:S}=h(11030);function M(E){this.options=k.assign({level:D,method:S,Ja:16384,windowBits:15,memLevel:8,strategy:g},E||{});let b=this.options;b.raw&&b.windowBits>0?b.windowBits=-b.windowBits:b.gzip&&b.windowBits>0&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;let h=a.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(h!==o)throw new Error(V[h]);if(b.header&&a.deflateSetHeader(this.strm,b.header),b.dictionary){let E;if(E="string"===typeof b.dictionary?G.string2buf(b.dictionary):"[object ArrayBuffer]"===O.call(b.dictionary)?new Uint8Array(b.dictionary):b.dictionary,h=a.deflateSetDictionary(this.strm,E),h!==o)throw new Error(V[h]);this._dict_set=!0}}function I(E,b){const h=new M(b);if(h.push(E,!0),h.err)throw h.msg||V[h.err];return h.result}M.prototype.push=function(E,b){const h=this.strm,k=this.options.Ja;let V,l;if(this.ended)return!1;for(l=b===~~b?b:!0===b?B:v,"string"===typeof E?h.input=G.string2buf(E):"[object ArrayBuffer]"===O.call(E)?h.input=new Uint8Array(E):h.input=E,h.next_in=0,h.avail_in=h.input.length;;)if(0===h.avail_out&&(h.output=new Uint8Array(k),h.next_out=0,h.avail_out=k),(l===s||l===U)&&h.avail_out<=6)this.onData(h.output.subarray(0,h.next_out)),h.avail_out=0;else{if(V=a.deflate(h,l),V===u)return h.next_out>0&&this.onData(h.output.subarray(0,h.next_out)),V=a.deflateEnd(this.strm),this.onEnd(V),this.ended=!0,V===o;if(0!==h.avail_out){if(l>0&&h.next_out>0)this.onData(h.output.subarray(0,h.next_out)),h.avail_out=0;else if(0===h.avail_in)break}else this.onData(h.output)}return!0},M.prototype.onData=function(E){this.chunks.push(E)},M.prototype.onEnd=function(E){E===o&&(this.result=k.flattenChunks(this.chunks)),this.chunks=[],this.err=E,this.msg=this.strm.msg},E.exports.Deflate=M,E.exports.deflate=I,E.exports.deflateRaw=function(E,b){return(b=b||{}).raw=!0,I(E,b)},E.exports.gzip=function(E,b){return(b=b||{}).gzip=!0,I(E,b)},E.exports.constants=h(11030)},11060:(E,b,h)=>{"use strict";const a=h(11067),k=h(11039),G=h(11047),V=h(11023),l=h(11055),O=h(11087),v=Object.prototype.toString,{Z_NO_FLUSH:s,Z_FINISH:U,Z_OK:B,Z_STREAM_END:o,Z_NEED_DICT:u,Z_STREAM_ERROR:D,Z_DATA_ERROR:g,Z_MEM_ERROR:S}=h(11030);function M(E){this.options=k.assign({Ja:65536,windowBits:15,to:""},E||{});const b=this.options;b.raw&&b.windowBits>=0&&b.windowBits<16&&(b.windowBits=-b.windowBits,0===b.windowBits&&(b.windowBits=-15)),!(b.windowBits>=0&&b.windowBits<16)||E&&E.windowBits||(b.windowBits+=32),b.windowBits>15&&b.windowBits<48&&0===(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;let h=a.inflateInit2(this.strm,b.windowBits);if(h!==B)throw new Error(V[h]);if(this.header=new O,a.inflateGetHeader(this.strm,this.header),b.dictionary&&("string"===typeof b.dictionary?b.dictionary=G.string2buf(b.dictionary):"[object ArrayBuffer]"===v.call(b.dictionary)&&(b.dictionary=new Uint8Array(b.dictionary)),b.raw&&(h=a.inflateSetDictionary(this.strm,b.dictionary),h!==B)))throw new Error(V[h])}function I(E,b){const h=new M(b);if(h.push(E),h.err)throw h.msg||V[h.err];return h.result}M.prototype.push=function(E,b){const h=this.strm,k=this.options.Ja,V=this.options.dictionary;let l,O,M;if(this.ended)return!1;for(O=b===~~b?b:!0===b?U:s,"[object ArrayBuffer]"===v.call(E)?h.input=new Uint8Array(E):h.input=E,h.next_in=0,h.avail_in=h.input.length;;){for(0===h.avail_out&&(h.output=new Uint8Array(k),h.next_out=0,h.avail_out=k),l=a.inflate(h,O),l===u&&V&&(l=a.inflateSetDictionary(h,V),l===B?l=a.inflate(h,O):l===g&&(l=u));h.avail_in>0&&l===o&&h.state.wrap>0&&0!==E[h.next_in];)a.inflateReset(h),l=a.inflate(h,O);switch(l){case D:case g:case u:case S:return this.onEnd(l),this.ended=!0,!1}if(M=h.avail_out,h.next_out&&(0===h.avail_out||l===o))if("string"===this.options.to){let E=G.utf8border(h.output,h.next_out),b=h.next_out-E,a=G.buf2string(h.output,E);h.next_out=b,h.avail_out=k-b,b&&h.output.set(h.output.subarray(E,E+b),0),this.onData(a)}else this.onData(h.output.length===h.next_out?h.output:h.output.subarray(0,h.next_out));if(l!==B||0!==M){if(l===o)return l=a.inflateEnd(this.strm),this.onEnd(l),this.ended=!0,!0;if(0===h.avail_in)break}}return!0},M.prototype.onData=function(E){this.chunks.push(E)},M.prototype.onEnd=function(E){E===B&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=k.flattenChunks(this.chunks)),this.chunks=[],this.err=E,this.msg=this.strm.msg},E.exports.Inflate=M,E.exports.inflate=I,E.exports.inflateRaw=function(E,b){return(b=b||{}).raw=!0,I(E,b)},E.exports.ungzip=I,E.exports.constants=h(11030)},11039:E=>{"use strict";const b=(E,b)=>Object.prototype.hasOwnProperty.call(E,b);E.exports.assign=function(E){const h=Array.prototype.slice.call(arguments,1);for(;h.length;){const a=h.shift();if(a){if("object"!==typeof a)throw new TypeError(a+"must be non-object");for(const h in a)b(a,h)&&(E[h]=a[h])}}return E},E.exports.flattenChunks=E=>{let b=0;for(let a=0,k=E.length;a<k;a++)b+=E[a].length;const h=new Uint8Array(b);for(let a=0,k=0,G=E.length;a<G;a++){let b=E[a];h.set(b,k),k+=b.length}return h}},11047:E=>{"use strict";let b=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(a){b=!1}const h=new Uint8Array(256);for(let k=0;k<256;k++)h[k]=k>=252?6:k>=248?5:k>=240?4:k>=224?3:k>=192?2:1;h[254]=h[254]=1,E.exports.string2buf=E=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(E);let b,h,a,k,G,V=E.length,l=0;for(k=0;k<V;k++)h=E.charCodeAt(k),55296===(64512&h)&&k+1<V&&(a=E.charCodeAt(k+1),56320===(64512&a)&&(h=65536+(h-55296<<10)+(a-56320),k++)),l+=h<128?1:h<2048?2:h<65536?3:4;for(b=new Uint8Array(l),G=0,k=0;G<l;k++)h=E.charCodeAt(k),55296===(64512&h)&&k+1<V&&(a=E.charCodeAt(k+1),56320===(64512&a)&&(h=65536+(h-55296<<10)+(a-56320),k++)),h<128?b[G++]=h:h<2048?(b[G++]=192|h>>>6,b[G++]=128|63&h):h<65536?(b[G++]=224|h>>>12,b[G++]=128|h>>>6&63,b[G++]=128|63&h):(b[G++]=240|h>>>18,b[G++]=128|h>>>12&63,b[G++]=128|h>>>6&63,b[G++]=128|63&h);return b};E.exports.buf2string=(E,a)=>{const k=a||E.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(E.subarray(0,a));let G,V;const l=new Array(2*k);for(V=0,G=0;G<k;){let b=E[G++];if(b<128){l[V++]=b;continue}let a=h[b];if(a>4)l[V++]=65533,G+=a-1;else{for(b&=2===a?31:3===a?15:7;a>1&&G<k;)b=b<<6|63&E[G++],a--;a>1?l[V++]=65533:b<65536?l[V++]=b:(b-=65536,l[V++]=55296|b>>10&1023,l[V++]=56320|1023&b)}}return((E,h)=>{if(h<65534&&E.subarray&&b)return String.fromCharCode.apply(null,E.length===h?E:E.subarray(0,h));let a="";for(let b=0;b<h;b++)a+=String.fromCharCode(E[b]);return a})(l,V)},E.exports.utf8border=(E,b)=>{(b=b||E.length)>E.length&&(b=E.length);let a=b-1;for(;a>=0&&128===(192&E[a]);)a--;return a<0||0===a?b:a+h[E[a]]>b?a:b}},11010:E=>{"use strict";E.exports=(E,b,h,a)=>{let k=65535&E,G=E>>>16&65535,V=0;for(;0!==h;){V=h>2e3?2e3:h,h-=V;do{k=k+b[a++]|0,G=G+k|0}while(--V);k%=65521,G%=65521}return k|G<<16}},11030:E=>{"use strict";E.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},11014:E=>{"use strict";const b=new Uint32Array((()=>{let E,b=[];for(var h=0;h<256;h++){E=h;for(var a=0;a<8;a++)E=1&E?3988292384^E>>>1:E>>>1;b[h]=E}return b})());E.exports=(E,h,a,k)=>{const G=b,V=k+a;E^=-1;for(let b=k;b<V;b++)E=E>>>8^G[255&(E^h[b])];return~E}},10999:(E,b,h)=>{"use strict";const{_tr_init:a,_tr_stored_block:k,_tr_flush_block:G,_tr_tally:V,_tr_align:l}=h(11002),O=h(11010),v=h(11014),s=h(11023),{Z_NO_FLUSH:U,Z_PARTIAL_FLUSH:B,Z_FULL_FLUSH:o,Z_FINISH:u,Z_BLOCK:D,Z_OK:g,Z_STREAM_END:S,Z_STREAM_ERROR:M,Z_DATA_ERROR:I,Z_BUF_ERROR:j,Z_DEFAULT_COMPRESSION:P,Z_FILTERED:A,Z_HUFFMAN_ONLY:n,Z_RLE:d,Z_FIXED:c,Z_DEFAULT_STRATEGY:z,Z_UNKNOWN:Z,Z_DEFLATED:Y}=h(11030),r=258,w=262,N=103,H=113,f=666,F=(E,b)=>(E.msg=s[b],b),y=E=>(E<<1)-(E>4?9:0),e=E=>{let b=E.length;for(;--b>=0;)E[b]=0};let J=(E,b,h)=>(b<<E.hash_shift^h)&E.hash_mask;const m=E=>{const b=E.state;let h=b.pending;h>E.avail_out&&(h=E.avail_out),0!==h&&(E.output.set(b.pending_buf.subarray(b.pending_out,b.pending_out+h),E.next_out),E.next_out+=h,b.pending_out+=h,E.total_out+=h,E.avail_out-=h,b.pending-=h,0===b.pending&&(b.pending_out=0))},K=(E,b)=>{G(E,E.block_start>=0?E.block_start:-1,E.strstart-E.block_start,b),E.block_start=E.strstart,m(E.strm)},x=(E,b)=>{E.pending_buf[E.pending++]=b},W=(E,b)=>{E.pending_buf[E.pending++]=b>>>8&255,E.pending_buf[E.pending++]=255&b},L=(E,b,h,a)=>{let k=E.avail_in;return k>a&&(k=a),0===k?0:(E.avail_in-=k,b.set(E.input.subarray(E.next_in,E.next_in+k),h),1===E.state.wrap?E.adler=O(E.adler,b,k,h):2===E.state.wrap&&(E.adler=v(E.adler,b,k,h)),E.next_in+=k,E.total_in+=k,k)},t=(E,b)=>{let h,a,k=E.max_chain_length,G=E.strstart,V=E.prev_length,l=E.nice_match;const O=E.strstart>E.w_size-w?E.strstart-(E.w_size-w):0,v=E.window,s=E.w_mask,U=E.prev,B=E.strstart+r;let o=v[G+V-1],u=v[G+V];E.prev_length>=E.good_match&&(k>>=2),l>E.lookahead&&(l=E.lookahead);do{if(h=b,v[h+V]===u&&v[h+V-1]===o&&v[h]===v[G]&&v[++h]===v[G+1]){G+=2,h++;do{}while(v[++G]===v[++h]&&v[++G]===v[++h]&&v[++G]===v[++h]&&v[++G]===v[++h]&&v[++G]===v[++h]&&v[++G]===v[++h]&&v[++G]===v[++h]&&v[++G]===v[++h]&&G<B);if(a=r-(B-G),G=B-r,a>V){if(E.match_start=b,V=a,a>=l)break;o=v[G+V-1],u=v[G+V]}}}while((b=U[b&s])>O&&0!==--k);return V<=E.lookahead?V:E.lookahead},T=E=>{const b=E.w_size;let h,a,k,G,V;do{if(G=E.window_size-E.lookahead-E.strstart,E.strstart>=b+(b-w)){E.window.set(E.window.subarray(b,b+b),0),E.match_start-=b,E.strstart-=b,E.block_start-=b,a=E.hash_size,h=a;do{k=E.head[--h],E.head[h]=k>=b?k-b:0}while(--a);a=b,h=a;do{k=E.prev[--h],E.prev[h]=k>=b?k-b:0}while(--a);G+=b}if(0===E.strm.avail_in)break;if(a=L(E.strm,E.window,E.strstart+E.lookahead,G),E.lookahead+=a,E.lookahead+E.insert>=3)for(V=E.strstart-E.insert,E.ins_h=E.window[V],E.ins_h=J(E,E.ins_h,E.window[V+1]);E.insert&&(E.ins_h=J(E,E.ins_h,E.window[V+3-1]),E.prev[V&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=V,V++,E.insert--,!(E.lookahead+E.insert<3)););}while(E.lookahead<w&&0!==E.strm.avail_in)},X=(E,b)=>{let h,a;for(;;){if(E.lookahead<w){if(T(E),E.lookahead<w&&b===U)return 1;if(0===E.lookahead)break}if(h=0,E.lookahead>=3&&(E.ins_h=J(E,E.ins_h,E.window[E.strstart+3-1]),h=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),0!==h&&E.strstart-h<=E.w_size-w&&(E.match_length=t(E,h)),E.match_length>=3)if(a=V(E,E.strstart-E.match_start,E.match_length-3),E.lookahead-=E.match_length,E.match_length<=E.max_lazy_match&&E.lookahead>=3){E.match_length--;do{E.strstart++,E.ins_h=J(E,E.ins_h,E.window[E.strstart+3-1]),h=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart}while(0!==--E.match_length);E.strstart++}else E.strstart+=E.match_length,E.match_length=0,E.ins_h=E.window[E.strstart],E.ins_h=J(E,E.ins_h,E.window[E.strstart+1]);else a=V(E,0,E.window[E.strstart]),E.lookahead--,E.strstart++;if(a&&(K(E,!1),0===E.strm.avail_out))return 1}return E.insert=E.strstart<2?E.strstart:2,b===u?(K(E,!0),0===E.strm.avail_out?3:4):E.last_lit&&(K(E,!1),0===E.strm.avail_out)?1:2},C=(E,b)=>{let h,a,k;for(;;){if(E.lookahead<w){if(T(E),E.lookahead<w&&b===U)return 1;if(0===E.lookahead)break}if(h=0,E.lookahead>=3&&(E.ins_h=J(E,E.ins_h,E.window[E.strstart+3-1]),h=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),E.prev_length=E.match_length,E.prev_match=E.match_start,E.match_length=2,0!==h&&E.prev_length<E.max_lazy_match&&E.strstart-h<=E.w_size-w&&(E.match_length=t(E,h),E.match_length<=5&&(E.strategy===A||3===E.match_length&&E.strstart-E.match_start>4096)&&(E.match_length=2)),E.prev_length>=3&&E.match_length<=E.prev_length){k=E.strstart+E.lookahead-3,a=V(E,E.strstart-1-E.prev_match,E.prev_length-3),E.lookahead-=E.prev_length-1,E.prev_length-=2;do{++E.strstart<=k&&(E.ins_h=J(E,E.ins_h,E.window[E.strstart+3-1]),h=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart)}while(0!==--E.prev_length);if(E.match_available=0,E.match_length=2,E.strstart++,a&&(K(E,!1),0===E.strm.avail_out))return 1}else if(E.match_available){if(a=V(E,0,E.window[E.strstart-1]),a&&K(E,!1),E.strstart++,E.lookahead--,0===E.strm.avail_out)return 1}else E.match_available=1,E.strstart++,E.lookahead--}return E.match_available&&(a=V(E,0,E.window[E.strstart-1]),E.match_available=0),E.insert=E.strstart<2?E.strstart:2,b===u?(K(E,!0),0===E.strm.avail_out?3:4):E.last_lit&&(K(E,!1),0===E.strm.avail_out)?1:2};function q(E,b,h,a,k){this.good_length=E,this.max_lazy=b,this.nice_length=h,this.max_chain=a,this.func=k}const R=[new q(0,0,0,0,((E,b)=>{let h=65535;for(h>E.pending_buf_size-5&&(h=E.pending_buf_size-5);;){if(E.lookahead<=1){if(T(E),0===E.lookahead&&b===U)return 1;if(0===E.lookahead)break}E.strstart+=E.lookahead,E.lookahead=0;const a=E.block_start+h;if((0===E.strstart||E.strstart>=a)&&(E.lookahead=E.strstart-a,E.strstart=a,K(E,!1),0===E.strm.avail_out))return 1;if(E.strstart-E.block_start>=E.w_size-w&&(K(E,!1),0===E.strm.avail_out))return 1}return E.insert=0,b===u?(K(E,!0),0===E.strm.avail_out?3:4):(E.strstart>E.block_start&&(K(E,!1),E.strm.avail_out),1)})),new q(4,4,8,4,X),new q(4,5,16,8,X),new q(4,6,32,32,X),new q(4,4,16,16,C),new q(8,16,32,32,C),new q(8,16,128,128,C),new q(8,32,128,256,C),new q(32,128,258,1024,C),new q(32,258,258,4096,C)];function Q(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Y,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),e(this.dyn_ltree),e(this.dyn_dtree),e(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),e(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),e(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const i=E=>{if(!E||!E.state)return F(E,M);E.total_in=E.total_out=0,E.data_type=Z;const b=E.state;return b.pending=0,b.pending_out=0,b.wrap<0&&(b.wrap=-b.wrap),b.status=b.wrap?42:H,E.adler=2===b.wrap?0:1,b.last_flush=U,a(b),g},p=E=>{const b=i(E);var h;return b===g&&((h=E.state).window_size=2*h.w_size,e(h.head),h.max_lazy_match=R[h.level].max_lazy,h.good_match=R[h.level].good_length,h.nice_match=R[h.level].nice_length,h.max_chain_length=R[h.level].max_chain,h.strstart=0,h.block_start=0,h.lookahead=0,h.insert=0,h.match_length=h.prev_length=2,h.match_available=0,h.ins_h=0),b},EE=(E,b,h,a,k,G)=>{if(!E)return M;let V=1;if(b===P&&(b=6),a<0?(V=0,a=-a):a>15&&(V=2,a-=16),k<1||k>9||h!==Y||a<8||a>15||b<0||b>9||G<0||G>c)return F(E,M);8===a&&(a=9);const l=new Q;return E.state=l,l.strm=E,l.wrap=V,l.gzhead=null,l.w_bits=a,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=k+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new Uint8Array(2*l.w_size),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<k+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new Uint8Array(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=b,l.strategy=G,l.method=h,p(E)};E.exports.deflateInit=(E,b)=>EE(E,b,Y,15,8,z),E.exports.deflateInit2=EE,E.exports.deflateReset=p,E.exports.deflateResetKeep=i,E.exports.deflateSetHeader=(E,b)=>E&&E.state?2!==E.state.wrap?M:(E.state.gzhead=b,g):M,E.exports.deflate=(E,b)=>{let h,a;if(!E||!E.state||b>D||b<0)return E?F(E,M):M;const G=E.state;if(!E.output||!E.input&&0!==E.avail_in||G.status===f&&b!==u)return F(E,0===E.avail_out?j:M);G.strm=E;const O=G.last_flush;if(G.last_flush=b,42===G.status)if(2===G.wrap)E.adler=0,x(G,31),x(G,139),x(G,8),G.gzhead?(x(G,(G.gzhead.text?1:0)+(G.gzhead.hcrc?2:0)+(G.gzhead.extra?4:0)+(G.gzhead.name?8:0)+(G.gzhead.comment?16:0)),x(G,255&G.gzhead.time),x(G,G.gzhead.time>>8&255),x(G,G.gzhead.time>>16&255),x(G,G.gzhead.time>>24&255),x(G,9===G.level?2:G.strategy>=n||G.level<2?4:0),x(G,255&G.gzhead.os),G.gzhead.extra&&G.gzhead.extra.length&&(x(G,255&G.gzhead.extra.length),x(G,G.gzhead.extra.length>>8&255)),G.gzhead.hcrc&&(E.adler=v(E.adler,G.pending_buf,G.pending,0)),G.gzindex=0,G.status=69):(x(G,0),x(G,0),x(G,0),x(G,0),x(G,0),x(G,9===G.level?2:G.strategy>=n||G.level<2?4:0),x(G,3),G.status=H);else{let b=Y+(G.w_bits-8<<4)<<8,h=-1;h=G.strategy>=n||G.level<2?0:G.level<6?1:6===G.level?2:3,b|=h<<6,0!==G.strstart&&(b|=32),b+=31-b%31,G.status=H,W(G,b),0!==G.strstart&&(W(G,E.adler>>>16),W(G,65535&E.adler)),E.adler=1}if(69===G.status)if(G.gzhead.extra){for(h=G.pending;G.gzindex<(65535&G.gzhead.extra.length)&&(G.pending!==G.pending_buf_size||(G.gzhead.hcrc&&G.pending>h&&(E.adler=v(E.adler,G.pending_buf,G.pending-h,h)),m(E),h=G.pending,G.pending!==G.pending_buf_size));)x(G,255&G.gzhead.extra[G.gzindex]),G.gzindex++;G.gzhead.hcrc&&G.pending>h&&(E.adler=v(E.adler,G.pending_buf,G.pending-h,h)),G.gzindex===G.gzhead.extra.length&&(G.gzindex=0,G.status=73)}else G.status=73;if(73===G.status)if(G.gzhead.name){h=G.pending;do{if(G.pending===G.pending_buf_size&&(G.gzhead.hcrc&&G.pending>h&&(E.adler=v(E.adler,G.pending_buf,G.pending-h,h)),m(E),h=G.pending,G.pending===G.pending_buf_size)){a=1;break}a=G.gzindex<G.gzhead.name.length?255&G.gzhead.name.charCodeAt(G.gzindex++):0,x(G,a)}while(0!==a);G.gzhead.hcrc&&G.pending>h&&(E.adler=v(E.adler,G.pending_buf,G.pending-h,h)),0===a&&(G.gzindex=0,G.status=91)}else G.status=91;if(91===G.status)if(G.gzhead.comment){h=G.pending;do{if(G.pending===G.pending_buf_size&&(G.gzhead.hcrc&&G.pending>h&&(E.adler=v(E.adler,G.pending_buf,G.pending-h,h)),m(E),h=G.pending,G.pending===G.pending_buf_size)){a=1;break}a=G.gzindex<G.gzhead.comment.length?255&G.gzhead.comment.charCodeAt(G.gzindex++):0,x(G,a)}while(0!==a);G.gzhead.hcrc&&G.pending>h&&(E.adler=v(E.adler,G.pending_buf,G.pending-h,h)),0===a&&(G.status=N)}else G.status=N;if(G.status===N&&(G.gzhead.hcrc?(G.pending+2>G.pending_buf_size&&m(E),G.pending+2<=G.pending_buf_size&&(x(G,255&E.adler),x(G,E.adler>>8&255),E.adler=0,G.status=H)):G.status=H),0!==G.pending){if(m(E),0===E.avail_out)return G.last_flush=-1,g}else if(0===E.avail_in&&y(b)<=y(O)&&b!==u)return F(E,j);if(G.status===f&&0!==E.avail_in)return F(E,j);if(0!==E.avail_in||0!==G.lookahead||b!==U&&G.status!==f){let h=G.strategy===n?((E,b)=>{let h;for(;;){if(0===E.lookahead&&(T(E),0===E.lookahead)){if(b===U)return 1;break}if(E.match_length=0,h=V(E,0,E.window[E.strstart]),E.lookahead--,E.strstart++,h&&(K(E,!1),0===E.strm.avail_out))return 1}return E.insert=0,b===u?(K(E,!0),0===E.strm.avail_out?3:4):E.last_lit&&(K(E,!1),0===E.strm.avail_out)?1:2})(G,b):G.strategy===d?((E,b)=>{let h,a,k,G;const l=E.window;for(;;){if(E.lookahead<=r){if(T(E),E.lookahead<=r&&b===U)return 1;if(0===E.lookahead)break}if(E.match_length=0,E.lookahead>=3&&E.strstart>0&&(k=E.strstart-1,a=l[k],a===l[++k]&&a===l[++k]&&a===l[++k])){G=E.strstart+r;do{}while(a===l[++k]&&a===l[++k]&&a===l[++k]&&a===l[++k]&&a===l[++k]&&a===l[++k]&&a===l[++k]&&a===l[++k]&&k<G);E.match_length=r-(G-k),E.match_length>E.lookahead&&(E.match_length=E.lookahead)}if(E.match_length>=3?(h=V(E,1,E.match_length-3),E.lookahead-=E.match_length,E.strstart+=E.match_length,E.match_length=0):(h=V(E,0,E.window[E.strstart]),E.lookahead--,E.strstart++),h&&(K(E,!1),0===E.strm.avail_out))return 1}return E.insert=0,b===u?(K(E,!0),0===E.strm.avail_out?3:4):E.last_lit&&(K(E,!1),0===E.strm.avail_out)?1:2})(G,b):R[G.level].func(G,b);if(3!==h&&4!==h||(G.status=f),1===h||3===h)return 0===E.avail_out&&(G.last_flush=-1),g;if(2===h&&(b===B?l(G):b!==D&&(k(G,0,0,!1),b===o&&(e(G.head),0===G.lookahead&&(G.strstart=0,G.block_start=0,G.insert=0))),m(E),0===E.avail_out))return G.last_flush=-1,g}return b!==u?g:G.wrap<=0?S:(2===G.wrap?(x(G,255&E.adler),x(G,E.adler>>8&255),x(G,E.adler>>16&255),x(G,E.adler>>24&255),x(G,255&E.total_in),x(G,E.total_in>>8&255),x(G,E.total_in>>16&255),x(G,E.total_in>>24&255)):(W(G,E.adler>>>16),W(G,65535&E.adler)),m(E),G.wrap>0&&(G.wrap=-G.wrap),0!==G.pending?g:S)},E.exports.deflateEnd=E=>{if(!E||!E.state)return M;const b=E.state.status;return 42!==b&&69!==b&&73!==b&&91!==b&&b!==N&&b!==H&&b!==f?F(E,M):(E.state=null,b===H?F(E,I):g)},E.exports.deflateSetDictionary=(E,b)=>{let h=b.length;if(!E||!E.state)return M;const a=E.state,k=a.wrap;if(2===k||1===k&&42!==a.status||a.lookahead)return M;if(1===k&&(E.adler=O(E.adler,b,h,0)),a.wrap=0,h>=a.w_size){0===k&&(e(a.head),a.strstart=0,a.block_start=0,a.insert=0);let E=new Uint8Array(a.w_size);E.set(b.subarray(h-a.w_size,h),0),b=E,h=a.w_size}const G=E.avail_in,V=E.next_in,l=E.input;for(E.avail_in=h,E.next_in=0,E.input=b,T(a);a.lookahead>=3;){let E=a.strstart,b=a.lookahead-2;do{a.ins_h=J(a,a.ins_h,a.window[E+3-1]),a.prev[E&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=E,E++}while(--b);a.strstart=E,a.lookahead=2,T(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,E.next_in=V,E.input=l,E.avail_in=G,a.wrap=k,g},E.exports.deflateInfo="pako deflate (from Nodeca project)"},11087:E=>{"use strict";E.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},11069:E=>{"use strict";E.exports=function(E,b){let h,a,k,G,V,l,O,v,s,U,B,o,u,D,g,S,M,I,j,P,A,n,d,c;const z=E.state;h=E.next_in,d=E.input,a=h+(E.avail_in-5),k=E.next_out,c=E.output,G=k-(b-E.avail_out),V=k+(E.avail_out-257),l=z.dmax,O=z.wsize,v=z.whave,s=z.wnext,U=z.window,B=z.hold,o=z.bits,u=z.lencode,D=z.distcode,g=(1<<z.lenbits)-1,S=(1<<z.distbits)-1;E:do{o<15&&(B+=d[h++]<<o,o+=8,B+=d[h++]<<o,o+=8),M=u[B&g];b:for(;;){if(I=M>>>24,B>>>=I,o-=I,I=M>>>16&255,0===I)c[k++]=65535&M;else{if(!(16&I)){if(0===(64&I)){M=u[(65535&M)+(B&(1<<I)-1)];continue b}if(32&I){z.mode=12;break E}E.msg="invalid literal/length code",z.mode=30;break E}j=65535&M,I&=15,I&&(o<I&&(B+=d[h++]<<o,o+=8),j+=B&(1<<I)-1,B>>>=I,o-=I),o<15&&(B+=d[h++]<<o,o+=8,B+=d[h++]<<o,o+=8),M=D[B&S];h:for(;;){if(I=M>>>24,B>>>=I,o-=I,I=M>>>16&255,!(16&I)){if(0===(64&I)){M=D[(65535&M)+(B&(1<<I)-1)];continue h}E.msg="invalid distance code",z.mode=30;break E}if(P=65535&M,I&=15,o<I&&(B+=d[h++]<<o,o+=8,o<I&&(B+=d[h++]<<o,o+=8)),P+=B&(1<<I)-1,P>l){E.msg="invalid distance too far back",z.mode=30;break E}if(B>>>=I,o-=I,I=k-G,P>I){if(I=P-I,I>v&&z.sane){E.msg="invalid distance too far back",z.mode=30;break E}if(A=0,n=U,0===s){if(A+=O-I,I<j){j-=I;do{c[k++]=U[A++]}while(--I);A=k-P,n=c}}else if(s<I){if(A+=O+s-I,I-=s,I<j){j-=I;do{c[k++]=U[A++]}while(--I);if(A=0,s<j){I=s,j-=I;do{c[k++]=U[A++]}while(--I);A=k-P,n=c}}}else if(A+=s-I,I<j){j-=I;do{c[k++]=U[A++]}while(--I);A=k-P,n=c}for(;j>2;)c[k++]=n[A++],c[k++]=n[A++],c[k++]=n[A++],j-=3;j&&(c[k++]=n[A++],j>1&&(c[k++]=n[A++]))}else{A=k-P;do{c[k++]=c[A++],c[k++]=c[A++],c[k++]=c[A++],j-=3}while(j>2);j&&(c[k++]=c[A++],j>1&&(c[k++]=c[A++]))}break}}break}}while(h<a&&k<V);j=o>>3,h-=j,o-=j<<3,B&=(1<<o)-1,E.next_in=h,E.next_out=k,E.avail_in=h<a?a-h+5:5-(h-a),E.avail_out=k<V?V-k+257:257-(k-V),z.hold=B,z.bits=o}},11067:(E,b,h)=>{"use strict";const a=h(11010),k=h(11014),G=h(11069),V=h(11078),{Z_FINISH:l,Z_BLOCK:O,Z_TREES:v,Z_OK:s,Z_STREAM_END:U,Z_NEED_DICT:B,Z_STREAM_ERROR:o,Z_DATA_ERROR:u,Z_MEM_ERROR:D,Z_BUF_ERROR:g,Z_DEFLATED:S}=h(11030),M=12,I=30,j=E=>(E>>>24&255)+(E>>>8&65280)+((65280&E)<<8)+((255&E)<<24);function P(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const A=E=>{if(!E||!E.state)return o;const b=E.state;return E.total_in=E.total_out=b.total=0,E.msg="",b.wrap&&(E.adler=1&b.wrap),b.mode=1,b.last=0,b.havedict=0,b.dmax=32768,b.head=null,b.hold=0,b.bits=0,b.lencode=b.lendyn=new Int32Array(852),b.distcode=b.distdyn=new Int32Array(592),b.sane=1,b.back=-1,s},n=E=>{if(!E||!E.state)return o;const b=E.state;return b.wsize=0,b.whave=0,b.wnext=0,A(E)},d=(E,b)=>{let h;if(!E||!E.state)return o;const a=E.state;return b<0?(h=0,b=-b):(h=1+(b>>4),b<48&&(b&=15)),b&&(b<8||b>15)?o:(null!==a.window&&a.wbits!==b&&(a.window=null),a.wrap=h,a.wbits=b,n(E))},c=(E,b)=>{if(!E)return o;const h=new P;E.state=h,h.window=null;const a=d(E,b);return a!==s&&(E.state=null),a};let z,Z,Y=!0;const r=E=>{if(Y){z=new Int32Array(512),Z=new Int32Array(32);let b=0;for(;b<144;)E.lens[b++]=8;for(;b<256;)E.lens[b++]=9;for(;b<280;)E.lens[b++]=7;for(;b<288;)E.lens[b++]=8;for(V(1,E.lens,0,288,z,0,E.work,{bits:9}),b=0;b<32;)E.lens[b++]=5;V(2,E.lens,0,32,Z,0,E.work,{bits:5}),Y=!1}E.lencode=z,E.lenbits=9,E.distcode=Z,E.distbits=5},w=(E,b,h,a)=>{let k;const G=E.state;return null===G.window&&(G.wsize=1<<G.wbits,G.wnext=0,G.whave=0,G.window=new Uint8Array(G.wsize)),a>=G.wsize?(G.window.set(b.subarray(h-G.wsize,h),0),G.wnext=0,G.whave=G.wsize):(k=G.wsize-G.wnext,k>a&&(k=a),G.window.set(b.subarray(h-a,h-a+k),G.wnext),(a-=k)?(G.window.set(b.subarray(h-a,h),0),G.wnext=a,G.whave=G.wsize):(G.wnext+=k,G.wnext===G.wsize&&(G.wnext=0),G.whave<G.wsize&&(G.whave+=k))),0};E.exports.inflateReset=n,E.exports.inflateReset2=d,E.exports.inflateResetKeep=A,E.exports.inflateInit=E=>c(E,15),E.exports.inflateInit2=c,E.exports.inflate=(E,b)=>{let h,P,A,n,d,c,z,Z,Y,N,H,f,F,y,e,J,m,K,x,W,L,t,T=0;const X=new Uint8Array(4);let C,q;const R=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!E||!E.state||!E.output||!E.input&&0!==E.avail_in)return o;h=E.state,h.mode===M&&(h.mode=13),d=E.next_out,A=E.output,z=E.avail_out,n=E.next_in,P=E.input,c=E.avail_in,Z=h.hold,Y=h.bits,N=c,H=z,t=s;E:for(;;)switch(h.mode){case 1:if(0===h.wrap){h.mode=13;break}for(;Y<16;){if(0===c)break E;c--,Z+=P[n++]<<Y,Y+=8}if(2&h.wrap&&35615===Z){h.check=0,X[0]=255&Z,X[1]=Z>>>8&255,h.check=k(h.check,X,2,0),Z=0,Y=0,h.mode=2;break}if(h.flags=0,h.head&&(h.head.done=!1),!(1&h.wrap)||(((255&Z)<<8)+(Z>>8))%31){E.msg="incorrect header check",h.mode=I;break}if((15&Z)!==S){E.msg="unknown compression method",h.mode=I;break}if(Z>>>=4,Y-=4,L=8+(15&Z),0===h.wbits)h.wbits=L;else if(L>h.wbits){E.msg="invalid window size",h.mode=I;break}h.dmax=1<<h.wbits,E.adler=h.check=1,h.mode=512&Z?10:M,Z=0,Y=0;break;case 2:for(;Y<16;){if(0===c)break E;c--,Z+=P[n++]<<Y,Y+=8}if(h.flags=Z,(255&h.flags)!==S){E.msg="unknown compression method",h.mode=I;break}if(57344&h.flags){E.msg="unknown header flags set",h.mode=I;break}h.head&&(h.head.text=Z>>8&1),512&h.flags&&(X[0]=255&Z,X[1]=Z>>>8&255,h.check=k(h.check,X,2,0)),Z=0,Y=0,h.mode=3;case 3:for(;Y<32;){if(0===c)break E;c--,Z+=P[n++]<<Y,Y+=8}h.head&&(h.head.time=Z),512&h.flags&&(X[0]=255&Z,X[1]=Z>>>8&255,X[2]=Z>>>16&255,X[3]=Z>>>24&255,h.check=k(h.check,X,4,0)),Z=0,Y=0,h.mode=4;case 4:for(;Y<16;){if(0===c)break E;c--,Z+=P[n++]<<Y,Y+=8}h.head&&(h.head.xflags=255&Z,h.head.os=Z>>8),512&h.flags&&(X[0]=255&Z,X[1]=Z>>>8&255,h.check=k(h.check,X,2,0)),Z=0,Y=0,h.mode=5;case 5:if(1024&h.flags){for(;Y<16;){if(0===c)break E;c--,Z+=P[n++]<<Y,Y+=8}h.length=Z,h.head&&(h.head.extra_len=Z),512&h.flags&&(X[0]=255&Z,X[1]=Z>>>8&255,h.check=k(h.check,X,2,0)),Z=0,Y=0}else h.head&&(h.head.extra=null);h.mode=6;case 6:if(1024&h.flags&&(f=h.length,f>c&&(f=c),f&&(h.head&&(L=h.head.extra_len-h.length,h.head.extra||(h.head.extra=new Uint8Array(h.head.extra_len)),h.head.extra.set(P.subarray(n,n+f),L)),512&h.flags&&(h.check=k(h.check,P,f,n)),c-=f,n+=f,h.length-=f),h.length))break E;h.length=0,h.mode=7;case 7:if(2048&h.flags){if(0===c)break E;f=0;do{L=P[n+f++],h.head&&L&&h.length<65536&&(h.head.name+=String.fromCharCode(L))}while(L&&f<c);if(512&h.flags&&(h.check=k(h.check,P,f,n)),c-=f,n+=f,L)break E}else h.head&&(h.head.name=null);h.length=0,h.mode=8;case 8:if(4096&h.flags){if(0===c)break E;f=0;do{L=P[n+f++],h.head&&L&&h.length<65536&&(h.head.comment+=String.fromCharCode(L))}while(L&&f<c);if(512&h.flags&&(h.check=k(h.check,P,f,n)),c-=f,n+=f,L)break E}else h.head&&(h.head.comment=null);h.mode=9;case 9:if(512&h.flags){for(;Y<16;){if(0===c)break E;c--,Z+=P[n++]<<Y,Y+=8}if(Z!==(65535&h.check)){E.msg="header crc mismatch",h.mode=I;break}Z=0,Y=0}h.head&&(h.head.hcrc=h.flags>>9&1,h.head.done=!0),E.adler=h.check=0,h.mode=M;break;case 10:for(;Y<32;){if(0===c)break E;c--,Z+=P[n++]<<Y,Y+=8}E.adler=h.check=j(Z),Z=0,Y=0,h.mode=11;case 11:if(0===h.havedict)return E.next_out=d,E.avail_out=z,E.next_in=n,E.avail_in=c,h.hold=Z,h.bits=Y,B;E.adler=h.check=1,h.mode=M;case M:if(b===O||b===v)break E;case 13:if(h.last){Z>>>=7&Y,Y-=7&Y,h.mode=27;break}for(;Y<3;){if(0===c)break E;c--,Z+=P[n++]<<Y,Y+=8}switch(h.last=1&Z,Z>>>=1,Y-=1,3&Z){case 0:h.mode=14;break;case 1:if(r(h),h.mode=20,b===v){Z>>>=2,Y-=2;break E}break;case 2:h.mode=17;break;case 3:E.msg="invalid block type",h.mode=I}Z>>>=2,Y-=2;break;case 14:for(Z>>>=7&Y,Y-=7&Y;Y<32;){if(0===c)break E;c--,Z+=P[n++]<<Y,Y+=8}if((65535&Z)!==(Z>>>16^65535)){E.msg="invalid stored block lengths",h.mode=I;break}if(h.length=65535&Z,Z=0,Y=0,h.mode=15,b===v)break E;case 15:h.mode=16;case 16:if(f=h.length,f){if(f>c&&(f=c),f>z&&(f=z),0===f)break E;A.set(P.subarray(n,n+f),d),c-=f,n+=f,z-=f,d+=f,h.length-=f;break}h.mode=M;break;case 17:for(;Y<14;){if(0===c)break E;c--,Z+=P[n++]<<Y,Y+=8}if(h.nlen=257+(31&Z),Z>>>=5,Y-=5,h.ndist=1+(31&Z),Z>>>=5,Y-=5,h.ncode=4+(15&Z),Z>>>=4,Y-=4,h.nlen>286||h.ndist>30){E.msg="too many length or distance symbols",h.mode=I;break}h.have=0,h.mode=18;case 18:for(;h.have<h.ncode;){for(;Y<3;){if(0===c)break E;c--,Z+=P[n++]<<Y,Y+=8}h.lens[R[h.have++]]=7&Z,Z>>>=3,Y-=3}for(;h.have<19;)h.lens[R[h.have++]]=0;if(h.lencode=h.lendyn,h.lenbits=7,C={bits:h.lenbits},t=V(0,h.lens,0,19,h.lencode,0,h.work,C),h.lenbits=C.bits,t){E.msg="invalid code lengths set",h.mode=I;break}h.have=0,h.mode=19;case 19:for(;h.have<h.nlen+h.ndist;){for(;T=h.lencode[Z&(1<<h.lenbits)-1],e=T>>>24,J=T>>>16&255,m=65535&T,!(e<=Y);){if(0===c)break E;c--,Z+=P[n++]<<Y,Y+=8}if(m<16)Z>>>=e,Y-=e,h.lens[h.have++]=m;else{if(16===m){for(q=e+2;Y<q;){if(0===c)break E;c--,Z+=P[n++]<<Y,Y+=8}if(Z>>>=e,Y-=e,0===h.have){E.msg="invalid bit length repeat",h.mode=I;break}L=h.lens[h.have-1],f=3+(3&Z),Z>>>=2,Y-=2}else if(17===m){for(q=e+3;Y<q;){if(0===c)break E;c--,Z+=P[n++]<<Y,Y+=8}Z>>>=e,Y-=e,L=0,f=3+(7&Z),Z>>>=3,Y-=3}else{for(q=e+7;Y<q;){if(0===c)break E;c--,Z+=P[n++]<<Y,Y+=8}Z>>>=e,Y-=e,L=0,f=11+(127&Z),Z>>>=7,Y-=7}if(h.have+f>h.nlen+h.ndist){E.msg="invalid bit length repeat",h.mode=I;break}for(;f--;)h.lens[h.have++]=L}}if(h.mode===I)break;if(0===h.lens[256]){E.msg="invalid code -- missing end-of-block",h.mode=I;break}if(h.lenbits=9,C={bits:h.lenbits},t=V(1,h.lens,0,h.nlen,h.lencode,0,h.work,C),h.lenbits=C.bits,t){E.msg="invalid literal/lengths set",h.mode=I;break}if(h.distbits=6,h.distcode=h.distdyn,C={bits:h.distbits},t=V(2,h.lens,h.nlen,h.ndist,h.distcode,0,h.work,C),h.distbits=C.bits,t){E.msg="invalid distances set",h.mode=I;break}if(h.mode=20,b===v)break E;case 20:h.mode=21;case 21:if(c>=6&&z>=258){E.next_out=d,E.avail_out=z,E.next_in=n,E.avail_in=c,h.hold=Z,h.bits=Y,G(E,H),d=E.next_out,A=E.output,z=E.avail_out,n=E.next_in,P=E.input,c=E.avail_in,Z=h.hold,Y=h.bits,h.mode===M&&(h.back=-1);break}for(h.back=0;T=h.lencode[Z&(1<<h.lenbits)-1],e=T>>>24,J=T>>>16&255,m=65535&T,!(e<=Y);){if(0===c)break E;c--,Z+=P[n++]<<Y,Y+=8}if(J&&0===(240&J)){for(K=e,x=J,W=m;T=h.lencode[W+((Z&(1<<K+x)-1)>>K)],e=T>>>24,J=T>>>16&255,m=65535&T,!(K+e<=Y);){if(0===c)break E;c--,Z+=P[n++]<<Y,Y+=8}Z>>>=K,Y-=K,h.back+=K}if(Z>>>=e,Y-=e,h.back+=e,h.length=m,0===J){h.mode=26;break}if(32&J){h.back=-1,h.mode=M;break}if(64&J){E.msg="invalid literal/length code",h.mode=I;break}h.extra=15&J,h.mode=22;case 22:if(h.extra){for(q=h.extra;Y<q;){if(0===c)break E;c--,Z+=P[n++]<<Y,Y+=8}h.length+=Z&(1<<h.extra)-1,Z>>>=h.extra,Y-=h.extra,h.back+=h.extra}h.was=h.length,h.mode=23;case 23:for(;T=h.distcode[Z&(1<<h.distbits)-1],e=T>>>24,J=T>>>16&255,m=65535&T,!(e<=Y);){if(0===c)break E;c--,Z+=P[n++]<<Y,Y+=8}if(0===(240&J)){for(K=e,x=J,W=m;T=h.distcode[W+((Z&(1<<K+x)-1)>>K)],e=T>>>24,J=T>>>16&255,m=65535&T,!(K+e<=Y);){if(0===c)break E;c--,Z+=P[n++]<<Y,Y+=8}Z>>>=K,Y-=K,h.back+=K}if(Z>>>=e,Y-=e,h.back+=e,64&J){E.msg="invalid distance code",h.mode=I;break}h.offset=m,h.extra=15&J,h.mode=24;case 24:if(h.extra){for(q=h.extra;Y<q;){if(0===c)break E;c--,Z+=P[n++]<<Y,Y+=8}h.offset+=Z&(1<<h.extra)-1,Z>>>=h.extra,Y-=h.extra,h.back+=h.extra}if(h.offset>h.dmax){E.msg="invalid distance too far back",h.mode=I;break}h.mode=25;case 25:if(0===z)break E;if(f=H-z,h.offset>f){if(f=h.offset-f,f>h.whave&&h.sane){E.msg="invalid distance too far back",h.mode=I;break}f>h.wnext?(f-=h.wnext,F=h.wsize-f):F=h.wnext-f,f>h.length&&(f=h.length),y=h.window}else y=A,F=d-h.offset,f=h.length;f>z&&(f=z),z-=f,h.length-=f;do{A[d++]=y[F++]}while(--f);0===h.length&&(h.mode=21);break;case 26:if(0===z)break E;A[d++]=h.length,z--,h.mode=21;break;case 27:if(h.wrap){for(;Y<32;){if(0===c)break E;c--,Z|=P[n++]<<Y,Y+=8}if(H-=z,E.total_out+=H,h.total+=H,H&&(E.adler=h.check=h.flags?k(h.check,A,H,d-H):a(h.check,A,H,d-H)),H=z,(h.flags?Z:j(Z))!==h.check){E.msg="incorrect data check",h.mode=I;break}Z=0,Y=0}h.mode=28;case 28:if(h.wrap&&h.flags){for(;Y<32;){if(0===c)break E;c--,Z+=P[n++]<<Y,Y+=8}if(Z!==(4294967295&h.total)){E.msg="incorrect length check",h.mode=I;break}Z=0,Y=0}h.mode=29;case 29:t=U;break E;case I:t=u;break E;case 31:return D;default:return o}return E.next_out=d,E.avail_out=z,E.next_in=n,E.avail_in=c,h.hold=Z,h.bits=Y,(h.wsize||H!==E.avail_out&&h.mode<I&&(h.mode<27||b!==l))&&w(E,E.output,E.next_out,H-E.avail_out)?(h.mode=31,D):(N-=E.avail_in,H-=E.avail_out,E.total_in+=N,E.total_out+=H,h.total+=H,h.wrap&&H&&(E.adler=h.check=h.flags?k(h.check,A,H,E.next_out-H):a(h.check,A,H,E.next_out-H)),E.data_type=h.bits+(h.last?64:0)+(h.mode===M?128:0)+(20===h.mode||15===h.mode?256:0),(0===N&&0===H||b===l)&&t===s&&(t=g),t)},E.exports.inflateEnd=E=>{if(!E||!E.state)return o;let b=E.state;return b.window&&(b.window=null),E.state=null,s},E.exports.inflateGetHeader=(E,b)=>{if(!E||!E.state)return o;const h=E.state;return 0===(2&h.wrap)?o:(h.head=b,b.done=!1,s)},E.exports.inflateSetDictionary=(E,b)=>{const h=b.length;let k,G,V;return E&&E.state?(k=E.state,0!==k.wrap&&11!==k.mode?o:11===k.mode&&(G=1,G=a(G,b,h,0),G!==k.check)?u:(V=w(E,b,h,h),V?(k.mode=31,D):(k.havedict=1,s))):o},E.exports.inflateInfo="pako inflate (from Nodeca project)"},11078:E=>{"use strict";const b=15,h=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),a=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),k=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),G=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);E.exports=(E,V,l,O,v,s,U,B)=>{const o=B.bits;let u,D,g,S,M,I,j=0,P=0,A=0,n=0,d=0,c=0,z=0,Z=0,Y=0,r=0,w=null,N=0;const H=new Uint16Array(16),f=new Uint16Array(16);let F,y,e,J=null,m=0;for(j=0;j<=b;j++)H[j]=0;for(P=0;P<O;P++)H[V[l+P]]++;for(d=o,n=b;n>=1&&0===H[n];n--);if(d>n&&(d=n),0===n)return v[s++]=20971520,v[s++]=20971520,B.bits=1,0;for(A=1;A<n&&0===H[A];A++);for(d<A&&(d=A),Z=1,j=1;j<=b;j++)if(Z<<=1,Z-=H[j],Z<0)return-1;if(Z>0&&(0===E||1!==n))return-1;for(f[1]=0,j=1;j<b;j++)f[j+1]=f[j]+H[j];for(P=0;P<O;P++)0!==V[l+P]&&(U[f[V[l+P]]++]=P);if(0===E?(w=J=U,I=19):1===E?(w=h,N-=257,J=a,m-=257,I=256):(w=k,J=G,I=-1),r=0,P=0,j=A,M=s,c=d,z=0,g=-1,Y=1<<d,S=Y-1,1===E&&Y>852||2===E&&Y>592)return 1;for(;;){F=j-z,U[P]<I?(y=0,e=U[P]):U[P]>I?(y=J[m+U[P]],e=w[N+U[P]]):(y=96,e=0),u=1<<j-z,D=1<<c,A=D;do{D-=u,v[M+(r>>z)+D]=F<<24|y<<16|e}while(0!==D);for(u=1<<j-1;r&u;)u>>=1;if(0!==u?(r&=u-1,r+=u):r=0,P++,0===--H[j]){if(j===n)break;j=V[l+U[P]]}if(j>d&&(r&S)!==g){for(0===z&&(z=d),M+=A,c=j-z,Z=1<<c;c+z<n&&(Z-=H[c+z],!(Z<=0));)c++,Z<<=1;if(Y+=1<<c,1===E&&Y>852||2===E&&Y>592)return 1;g=r&S,v[g]=d<<24|c<<16|M-s}}return 0!==r&&(v[M+r]=j-z<<24|64<<16),B.bits=d,0}},11023:E=>{"use strict";E.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},11002:E=>{"use strict";function b(E){let b=E.length;for(;--b>=0;)E[b]=0}const h=256,a=286,k=30,G=15,V=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),l=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),O=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),v=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),s=new Array(576);b(s);const U=new Array(60);b(U);const B=new Array(512);b(B);const o=new Array(256);b(o);const u=new Array(29);b(u);const D=new Array(k);function g(E,b,h,a,k){this.static_tree=E,this.extra_bits=b,this.extra_base=h,this.elems=a,this.max_length=k,this.has_stree=E&&E.length}let S,M,I;function j(E,b){this.dyn_tree=E,this.max_code=0,this.stat_desc=b}b(D);const P=E=>E<256?B[E]:B[256+(E>>>7)],A=(E,b)=>{E.pending_buf[E.pending++]=255&b,E.pending_buf[E.pending++]=b>>>8&255},n=(E,b,h)=>{E.bi_valid>16-h?(E.bi_buf|=b<<E.bi_valid&65535,A(E,E.bi_buf),E.bi_buf=b>>16-E.bi_valid,E.bi_valid+=h-16):(E.bi_buf|=b<<E.bi_valid&65535,E.bi_valid+=h)},d=(E,b,h)=>{n(E,h[2*b],h[2*b+1])},c=(E,b)=>{let h=0;do{h|=1&E,E>>>=1,h<<=1}while(--b>0);return h>>>1},z=(E,b,h)=>{const a=new Array(16);let k,V,l=0;for(k=1;k<=G;k++)a[k]=l=l+h[k-1]<<1;for(V=0;V<=b;V++){let b=E[2*V+1];0!==b&&(E[2*V]=c(a[b]++,b))}},Z=E=>{let b;for(b=0;b<a;b++)E.dyn_ltree[2*b]=0;for(b=0;b<k;b++)E.dyn_dtree[2*b]=0;for(b=0;b<19;b++)E.bl_tree[2*b]=0;E.dyn_ltree[512]=1,E.opt_len=E.static_len=0,E.last_lit=E.matches=0},Y=E=>{E.bi_valid>8?A(E,E.bi_buf):E.bi_valid>0&&(E.pending_buf[E.pending++]=E.bi_buf),E.bi_buf=0,E.bi_valid=0},r=(E,b,h,a)=>{const k=2*b,G=2*h;return E[k]<E[G]||E[k]===E[G]&&a[b]<=a[h]},w=(E,b,h)=>{const a=E.heap[h];let k=h<<1;for(;k<=E.heap_len&&(k<E.heap_len&&r(b,E.heap[k+1],E.heap[k],E.depth)&&k++,!r(b,a,E.heap[k],E.depth));)E.heap[h]=E.heap[k],h=k,k<<=1;E.heap[h]=a},N=(E,b,a)=>{let k,G,O,v,s=0;if(0!==E.last_lit)do{k=E.pending_buf[E.d_buf+2*s]<<8|E.pending_buf[E.d_buf+2*s+1],G=E.pending_buf[E.l_buf+s],s++,0===k?d(E,G,b):(O=o[G],d(E,O+h+1,b),v=V[O],0!==v&&(G-=u[O],n(E,G,v)),k--,O=P(k),d(E,O,a),v=l[O],0!==v&&(k-=D[O],n(E,k,v)))}while(s<E.last_lit);d(E,256,b)},H=(E,b)=>{const h=b.dyn_tree,a=b.stat_desc.static_tree,k=b.stat_desc.has_stree,V=b.stat_desc.elems;let l,O,v,s=-1;for(E.heap_len=0,E.heap_max=573,l=0;l<V;l++)0!==h[2*l]?(E.heap[++E.heap_len]=s=l,E.depth[l]=0):h[2*l+1]=0;for(;E.heap_len<2;)v=E.heap[++E.heap_len]=s<2?++s:0,h[2*v]=1,E.depth[v]=0,E.opt_len--,k&&(E.static_len-=a[2*v+1]);for(b.max_code=s,l=E.heap_len>>1;l>=1;l--)w(E,h,l);v=V;do{l=E.heap[1],E.heap[1]=E.heap[E.heap_len--],w(E,h,1),O=E.heap[1],E.heap[--E.heap_max]=l,E.heap[--E.heap_max]=O,h[2*v]=h[2*l]+h[2*O],E.depth[v]=(E.depth[l]>=E.depth[O]?E.depth[l]:E.depth[O])+1,h[2*l+1]=h[2*O+1]=v,E.heap[1]=v++,w(E,h,1)}while(E.heap_len>=2);E.heap[--E.heap_max]=E.heap[1],((E,b)=>{const h=b.dyn_tree,a=b.max_code,k=b.stat_desc.static_tree,V=b.stat_desc.has_stree,l=b.stat_desc.extra_bits,O=b.stat_desc.extra_base,v=b.stat_desc.max_length;let s,U,B,o,u,D,g=0;for(o=0;o<=G;o++)E.bl_count[o]=0;for(h[2*E.heap[E.heap_max]+1]=0,s=E.heap_max+1;s<573;s++)U=E.heap[s],o=h[2*h[2*U+1]+1]+1,o>v&&(o=v,g++),h[2*U+1]=o,U>a||(E.bl_count[o]++,u=0,U>=O&&(u=l[U-O]),D=h[2*U],E.opt_len+=D*(o+u),V&&(E.static_len+=D*(k[2*U+1]+u)));if(0!==g){do{for(o=v-1;0===E.bl_count[o];)o--;E.bl_count[o]--,E.bl_count[o+1]+=2,E.bl_count[v]--,g-=2}while(g>0);for(o=v;0!==o;o--)for(U=E.bl_count[o];0!==U;)B=E.heap[--s],B>a||(h[2*B+1]!==o&&(E.opt_len+=(o-h[2*B+1])*h[2*B],h[2*B+1]=o),U--)}})(E,b),z(h,s,E.bl_count)},f=(E,b,h)=>{let a,k,G=-1,V=b[1],l=0,O=7,v=4;for(0===V&&(O=138,v=3),b[2*(h+1)+1]=65535,a=0;a<=h;a++)k=V,V=b[2*(a+1)+1],++l<O&&k===V||(l<v?E.bl_tree[2*k]+=l:0!==k?(k!==G&&E.bl_tree[2*k]++,E.bl_tree[32]++):l<=10?E.bl_tree[34]++:E.bl_tree[36]++,l=0,G=k,0===V?(O=138,v=3):k===V?(O=6,v=3):(O=7,v=4))},F=(E,b,h)=>{let a,k,G=-1,V=b[1],l=0,O=7,v=4;for(0===V&&(O=138,v=3),a=0;a<=h;a++)if(k=V,V=b[2*(a+1)+1],!(++l<O&&k===V)){if(l<v)do{d(E,k,E.bl_tree)}while(0!==--l);else 0!==k?(k!==G&&(d(E,k,E.bl_tree),l--),d(E,16,E.bl_tree),n(E,l-3,2)):l<=10?(d(E,17,E.bl_tree),n(E,l-3,3)):(d(E,18,E.bl_tree),n(E,l-11,7));l=0,G=k,0===V?(O=138,v=3):k===V?(O=6,v=3):(O=7,v=4)}};let y=!1;const e=(E,b,h,a)=>{n(E,0+(a?1:0),3),((E,b,h,a)=>{Y(E),a&&(A(E,h),A(E,~h)),E.pending_buf.set(E.window.subarray(b,b+h),E.pending),E.pending+=h})(E,b,h,!0)};E.exports._tr_init=E=>{y||((()=>{let E,b,h,v,j;const P=new Array(16);for(h=0,v=0;v<28;v++)for(u[v]=h,E=0;E<1<<V[v];E++)o[h++]=v;for(o[h-1]=v,j=0,v=0;v<16;v++)for(D[v]=j,E=0;E<1<<l[v];E++)B[j++]=v;for(j>>=7;v<k;v++)for(D[v]=j<<7,E=0;E<1<<l[v]-7;E++)B[256+j++]=v;for(b=0;b<=G;b++)P[b]=0;for(E=0;E<=143;)s[2*E+1]=8,E++,P[8]++;for(;E<=255;)s[2*E+1]=9,E++,P[9]++;for(;E<=279;)s[2*E+1]=7,E++,P[7]++;for(;E<=287;)s[2*E+1]=8,E++,P[8]++;for(z(s,287,P),E=0;E<k;E++)U[2*E+1]=5,U[2*E]=c(E,5);S=new g(s,V,257,a,G),M=new g(U,l,0,k,G),I=new g(new Array(0),O,0,19,7)})(),y=!0),E.l_desc=new j(E.dyn_ltree,S),E.d_desc=new j(E.dyn_dtree,M),E.bl_desc=new j(E.bl_tree,I),E.bi_buf=0,E.bi_valid=0,Z(E)},E.exports._tr_stored_block=e,E.exports._tr_flush_block=(E,b,a,k)=>{let G,V,l=0;E.level>0?(2===E.strm.data_type&&(E.strm.data_type=(E=>{let b,a=4093624447;for(b=0;b<=31;b++,a>>>=1)if(1&a&&0!==E.dyn_ltree[2*b])return 0;if(0!==E.dyn_ltree[18]||0!==E.dyn_ltree[20]||0!==E.dyn_ltree[26])return 1;for(b=32;b<h;b++)if(0!==E.dyn_ltree[2*b])return 1;return 0})(E)),H(E,E.l_desc),H(E,E.d_desc),l=(E=>{let b;for(f(E,E.dyn_ltree,E.l_desc.max_code),f(E,E.dyn_dtree,E.d_desc.max_code),H(E,E.bl_desc),b=18;b>=3&&0===E.bl_tree[2*v[b]+1];b--);return E.opt_len+=3*(b+1)+5+5+4,b})(E),G=E.opt_len+3+7>>>3,V=E.static_len+3+7>>>3,V<=G&&(G=V)):G=V=a+5,a+4<=G&&-1!==b?e(E,b,a,k):4===E.strategy||V===G?(n(E,2+(k?1:0),3),N(E,s,U)):(n(E,4+(k?1:0),3),((E,b,h,a)=>{let k;for(n(E,b-257,5),n(E,h-1,5),n(E,a-4,4),k=0;k<a;k++)n(E,E.bl_tree[2*v[k]+1],3);F(E,E.dyn_ltree,b-1),F(E,E.dyn_dtree,h-1)})(E,E.l_desc.max_code+1,E.d_desc.max_code+1,l+1),N(E,E.dyn_ltree,E.dyn_dtree)),Z(E),k&&Y(E)},E.exports._tr_tally=(E,b,a)=>(E.pending_buf[E.d_buf+2*E.last_lit]=b>>>8&255,E.pending_buf[E.d_buf+2*E.last_lit+1]=255&b,E.pending_buf[E.l_buf+E.last_lit]=255&a,E.last_lit++,0===b?E.dyn_ltree[2*a]++:(E.matches++,b--,E.dyn_ltree[2*(o[a]+h+1)]++,E.dyn_dtree[2*P(b)]++),E.last_lit===E.lit_bufsize-1),E.exports._tr_align=E=>{n(E,2,3),d(E,256,s),(E=>{16===E.bi_valid?(A(E,E.bi_buf),E.bi_buf=0,E.bi_valid=0):E.bi_valid>=8&&(E.pending_buf[E.pending++]=255&E.bi_buf,E.bi_buf>>=8,E.bi_valid-=8)})(E)}},11055:E=>{"use strict";E.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},12108:E=>{function b(E,b,h){for(var a=E.length,k=-1/0,G=1/0,V=0;V<a;V++){var l=(h[0][V]-E[V])/b[V],O=(h[1][V]-E[V])/b[V];if(l>O){var v=l;l=O,O=v}if(O<k||l>G)return 1/0;l>k&&(k=l),O<G&&(G=O)}return k>G?1/0:k}E.exports=function(E,h,a,k){var G=b(h,a,k);if(G===1/0)E=null;else{E=E||[];for(var V=0;V<h.length;V++)E[V]=h[V]+a[V]*G}return E},E.exports.distance=b},12571:(E,b,h)=>{"use strict";h.d(b,{b:()=>V});var a=h(34);const k=a.useLayoutEffect;const G=function(E){var b=(0,a.useRef)(E);return k((function(){b.current=E})),b};var V=function(E){var b=G(E);(0,a.hb)((function(){var E=function(E){var h;if(null!=b.current&&(h=b.current(E)),E.defaultPrevented&&(E.returnValue=""),"string"===typeof h)return E.returnValue=h,h};return window.addEventListener("beforeunload",E),function(){window.removeEventListener("beforeunload",E)}}),[])}},12529:(E,b,h)=>{"use strict";var a=h(12532),k=Array.prototype.concat,G=Array.prototype.slice,V=E.exports=function(E){for(var b=[],h=0,V=E.length;h<V;h++){var l=E[h];a(l)?b=k.call(b,G.call(l)):b.push(l)}return b};V.wrap=function(E){return function(){return E(V(arguments))}}},12532:E=>{E.exports=function(E){return!(!E||"string"===typeof E)&&(E instanceof Array||Array.isArray(E)||E.length>=0&&(E.splice instanceof Function||Object.getOwnPropertyDescriptor(E,E.length-1)&&"String"!==E.constructor.name))}},12486:E=>{"use strict";var b=[],h=[],a=[],k=[],G=[],V=[],l=[],O=[],v=[],s=[],U=[],B=[];E.exports=function(E,o,u,D,g,S){for(var M=l,I=v,j=s,P=B,A=0;A<3;A++)M[A]=+u[A],j[A]=+o.max[A],I[A]=+o.base[A];S||(S=1e-10);var n=function(E,l,v,s,B,o){var u=b,D=h,g=a,S=k,M=G,I=V,j=O,P=Math.floor,A=0,n=0,d=0,c=0,z=0;if(Z(),0===d)return 0;for(c=w();n<=d;){if(Y(c)&&r())return A;c=w()}for(A+=d,z=0;z<3;z++)s[z]+=v[z],B[z]+=v[z];return A;function Z(){if(n=0,0!==(d=Math.sqrt(v[0]*v[0]+v[1]*v[1]+v[2]*v[2])))for(var E=0;E<3;E++){var b=v[E]>=0;S[E]=b?1:-1;var h=b?B[E]:s[E];u[E]=b?s[E]:B[E],D[E]=N(h,S[E]),g[E]=H(u[E],S[E]),j[E]=v[E]/d,M[E]=Math.abs(1/j[E]);var a=b?D[E]+1-h:h-D[E];I[E]=M[E]<1/0?M[E]*a:1/0}}function Y(b){for(var h=S[0],a=0===b?D[0]:g[0],k=D[0]+h,G=S[1],V=1===b?D[1]:g[1],l=D[1]+G,O=S[2],v=2===b?D[2]:g[2],s=D[2]+O,U=a;U!=k;U+=h)for(var B=V;B!=l;B+=G)for(var o=v;o!=s;o+=O)if(E(U,B,o))return!0;return!1}function r(){A+=n;var E=S[c],b=n/d,h=U;for(z=0;z<3;z++){var a=v[z]*b;s[z]+=a,B[z]+=a,h[z]=v[z]-a}if(E>0?B[c]=Math.round(B[c]):s[c]=Math.round(s[c]),l(A,c,E,h))return!0;for(z=0;z<3;z++)v[z]=h[z];return Z(),0===d}function w(){var E=I[0]<I[1]?I[0]<I[2]?0:2:I[1]<I[2]?1:2,b=I[E]-n;for(n=I[E],D[E]+=S[E],I[E]+=M[E],z=0;z<3;z++)u[z]+=b*j[z],g[z]=H(u[z],S[z]);return E}function N(E,b){return P(E-b*o)}function H(E,b){return P(E+b*o)}}(E,D,M,I,j,S);if(!g){for(A=0;A<3;A++)P[A]=u[A]>0?j[A]-o.max[A]:I[A]-o.base[A];o.translate(P)}return n}},10789:(E,b,h)=>{var a=h(10794);function k(E){for(var b,h,k=0,G=E.length,V=0;V<E.length;){for(b=E[V],h=0;V<G&&E[V]===b;)++V,++h;k+=a.log2(h)/7|0,k+=a.log2(b>>>0)/7|0,k+=2}return k}b.size=k,b.encode=function(E,b){b||(b=new Uint8Array(k(E)));for(var h,a,G=0,V=b.length,l=0;l<E.length;){for(h=E[l],a=0;l<E.length&&E[l]===h;)++l,++a;for(;G<V&&a>=128;)b[G++]=128+(127&a),a>>>=7;if(G>=V)throw new Error("RLE buffer overflow");for(b[G++]=a,h>>>=0;G<V&&h>=128;)b[G++]=128+(127&h),h>>>=7;if(G>=V)throw new Error("RLE buffer overflow");b[G++]=h}return b},b.decode=function(E,b){for(var h,a,k,G,V=b.length,l=E.length,O=0,v=0;v<l;){for(h=0,a=0;v<l&&E[v]>=128;)h+=(127&E[v++])<<a,a+=7;if(h+=E[v++]<<a,v>=l)throw new Error("RLE buffer underrun");if(O+h>V)throw new Error("Chunk buffer overflow");for(k=0,a=0;v<l&&E[v]>=128;)k+=(127&E[v++])<<a,a+=7;if(v>=l)throw new Error("RLE buffer underrun");for(k+=E[v++]<<a,G=0;G<h;++G)b[O++]=k}return b}},10794:(E,b)=>{"use strict";function h(E){var b=32;return(E&=-E)&&b--,65535&E&&(b-=16),16711935&E&&(b-=8),252645135&E&&(b-=4),858993459&E&&(b-=2),1431655765&E&&(b-=1),b}b.INT_BITS=32,b.INT_MAX=2147483647,b.INT_MIN=-1<<31,b.sign=function(E){return(E>0)-(E<0)},b.abs=function(E){var b=E>>31;return(E^b)-b},b.min=function(E,b){return b^(E^b)&-(E<b)},b.max=function(E,b){return E^(E^b)&-(E<b)},b.isPow2=function(E){return!(E&E-1)&&!!E},b.log2=function(E){var b,h;return b=(E>65535)<<4,b|=h=((E>>>=b)>255)<<3,b|=h=((E>>>=h)>15)<<2,(b|=h=((E>>>=h)>3)<<1)|(E>>>=h)>>1},b.log10=function(E){return E>=1e9?9:E>=1e8?8:E>=1e7?7:E>=1e6?6:E>=1e5?5:E>=1e4?4:E>=1e3?3:E>=100?2:E>=10?1:0},b.popCount=function(E){return 16843009*((E=(858993459&(E-=E>>>1&1431655765))+(E>>>2&858993459))+(E>>>4)&252645135)>>>24},b.countTrailingZeros=h,b.nextPow2=function(E){return E+=0===E,--E,E|=E>>>1,E|=E>>>2,E|=E>>>4,E|=E>>>8,(E|=E>>>16)+1},b.prevPow2=function(E){return E|=E>>>1,E|=E>>>2,E|=E>>>4,E|=E>>>8,(E|=E>>>16)-(E>>>1)},b.parity=function(E){return E^=E>>>16,E^=E>>>8,E^=E>>>4,27030>>>(E&=15)&1};var a=new Array(256);!function(E){for(var b=0;b<256;++b){var h=b,a=b,k=7;for(h>>>=1;h;h>>>=1)a<<=1,a|=1&h,--k;E[b]=a<<k&255}}(a),b.reverse=function(E){return a[255&E]<<24|a[E>>>8&255]<<16|a[E>>>16&255]<<8|a[E>>>24&255]},b.interleave2=function(E,b){return(E=1431655765&((E=858993459&((E=252645135&((E=16711935&((E&=65535)|E<<8))|E<<4))|E<<2))|E<<1))|(b=1431655765&((b=858993459&((b=252645135&((b=16711935&((b&=65535)|b<<8))|b<<4))|b<<2))|b<<1))<<1},b.deinterleave2=function(E,b){return(E=65535&((E=16711935&((E=252645135&((E=858993459&((E=E>>>b&1431655765)|E>>>1))|E>>>2))|E>>>4))|E>>>16))<<16>>16},b.interleave3=function(E,b,h){return E=1227133513&((E=3272356035&((E=251719695&((E=4278190335&((E&=1023)|E<<16))|E<<8))|E<<4))|E<<2),(E|=(b=1227133513&((b=3272356035&((b=251719695&((b=4278190335&((b&=1023)|b<<16))|b<<8))|b<<4))|b<<2))<<1)|(h=1227133513&((h=3272356035&((h=251719695&((h=4278190335&((h&=1023)|h<<16))|h<<8))|h<<4))|h<<2))<<2},b.deinterleave3=function(E,b){return(E=1023&((E=4278190335&((E=251719695&((E=3272356035&((E=E>>>b&1227133513)|E>>>2))|E>>>4))|E>>>8))|E>>>16))<<22>>22},b.nextCombination=function(E){var b=E|E-1;return b+1|(~b&-~b)-1>>>h(E)+1}},12656:(E,b,h)=>{"use strict";h.d(b,{d:()=>U});var a=h(12478),k=h(136);class G{constructor(E,b,h,G,V,l,O){this.Tg=new a(E.base,E.mh),this.mass=b,this.friction=h,this.restitution=G,this.bd=V,this.Qk=l,this.gd=!!O,this.kh=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.Cl=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.jg=k.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=k.create(),this._impulses=k.create(),this._sleepFrameCount=10}loadFromCopy(E){k.i(this.Tg.base,E.Tg.base),k.i(this.Tg.mh,E.Tg.mh),k.i(this.Tg.max,E.Tg.max),this.Tg.mag=E.Tg.mag,this.mass=E.mass,this.friction=E.friction,this.restitution=E.restitution,this.bd=E.bd,this.Qk=E.Qk,this.gd=E.gd,this.kh=E.kh,this.fluidDrag=E.fluidDrag,this.Cl=E.Cl,this.preventFallOffEdge=E.preventFallOffEdge,this.rolledBackLastTick=E.rolledBackLastTick,k.i(this.jg,E.jg),k.i(this.resting,E.resting),this.inFluid=E.inFluid,this._ratioInFluid=E._ratioInFluid,k.i(this._forces,E._forces),k.i(this._impulses,E._impulses),this._sleepFrameCount=E._sleepFrameCount}setPosition(E){V(E),k.Xc(E,E,this.Tg.base),this.Tg.translate(E),this.ng()}cb(){return k.clone(this.Tg.base)}applyForce(E){V(E),k.add(this._forces,this._forces,E),this.ng()}applyImpulse(E){V(E),k.add(this._impulses,this._impulses,E),this.ng()}ng(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var V=E=>{};var l=h(12478),O=h(136),v=h(12486);function s(){this.kh=.1,this.fluidDrag=.4,this.qd=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function U(E,b,h){E=Object.assign(new s,E),this.gravity=E.gravity||[0,-10,0],this.kh=E.kh||.1,this.qd=E.qd||2,this.fluidDrag=E.fluidDrag||.4,this.minBounceImpulse=E.minBounceImpulse,this.bodies=[],this.lk=E.lk,this.testSolid=b,this.testFluid=h}U.prototype.Xk=function(E,b,h,a,k,V){E=E||new l([0,0,0],[1,1,1]),"undefined"==typeof b&&(b=1),"undefined"==typeof h&&(h=1),"undefined"==typeof a&&(a=0),"undefined"==typeof k&&(k=1);var O=new G(E,b,h,a,k,V);return this.bodies.push(O),O},U.prototype.Yk=function(E){var b=this.bodies.indexOf(E);b<0||(this.bodies.splice(b,1),E.Tg=E.Qk=null)};var B=O.create(),o=O.create(),u=O.create(),D=O.create(),g=O.create(),S=O.create(),M=O.create(),I=new l([0,0,0],[1,1,1]),j=new G(I,1,1,0,1,(()=>{}),!1);function P(E,b,h){return b=h,b*=1-(1-E.ratioInFluid)**2}U.prototype.Rd=function(E){E/=1e3;var b=J(0,O.squaredLength(this.gravity));this.bodies.forEach((h=>function(E,b,h,a){O.i(g,b.resting),E.lk&&j.loadFromCopy(b);if(b.mass<=0)return O.set(b.jg,0,0,0),O.set(b._forces,0,0,0),void O.set(b._impulses,0,0,0);var k=a||0===b.bd;if(function(E,b,h,a){if(b._sleepFrameCount>0)return!1;if(a)return!0;var k=!1,G=.5*h*h*b.bd;return O.scale(e,E.gravity,G),v(E.testSolid,b.Tg,e,(function(){return k=!0,!0}),!0),k}(E,b,h,k))return;b._sleepFrameCount--,function(E,b){var h=b.Tg,a=Math.floor(h.base[0]),k=Math.floor(h.base[2]),G=Math.floor(h.base[1]),V=Math.floor(h.max[1]);if(!E.testFluid(a,G,k))return b.inFluid=!1,void(b.ratioInFluid=0);var l=1,v=G+1;for(;v<=V&&E.testFluid(a,v,k);)l++,v++;var s=(G+l-h.base[1])/h.mh[1];s>1&&(s=1);var U=h.mh[0]*h.mh[1]*h.mh[2]*s,B=n;O.scale(B,E.gravity,-E.qd*U*b.bd),b.applyForce(B),b.inFluid=!0,b.ratioInFluid=s}(E,b),K(b._forces),K(b._impulses),K(b.jg),K(b.resting),O.scale(B,b._forces,1/b.mass),O.Cd(B,B,E.gravity,b.bd),O.scale(o,b._impulses,1/b.mass),O.Cd(o,o,B,h),O.add(b.jg,b.jg,o),b.friction&&(d(E,0,b,o,h),d(E,1,b,o,h),d(E,2,b,o,h));var G=b.fluidDrag>=0?b.fluidDrag:E.fluidDrag,V=b.kh>=0?b.kh:E.kh,l=V,s=V;b.inFluid&&(l=P(b,l,b.fluidDragHoriz>=0?b.fluidDragHoriz:G),s=P(b,s,b.fluidDragVert>=0?b.fluidDragVert:G));l=Math.max(1-l*h/b.mass,0),s=Math.max(1-s*h/b.mass,0),O.set(A,l,s,l),O.multiply(b.jg,b.jg,A),O.scale(u,b.jg,h),O.set(b._forces,0,0,0),O.set(b._impulses,0,0,0),b.gd&&m(Z,b.Tg);O.i(S,u),O.set(M,0,0,0),b.preventFallOffEdge&&function(E,b,h,a){if(!b.resting[1]||h[1]>0)return;var k=f;m(k,b.Tg);for(var G=0;G<3;G+=2){O.set(H,0,0,0),H[G]=h[G];var V=!0;(V=(V=(V=(V=V&&!y(E,k.base[0]+H[0]+1e-5,k.base[1],k.base[2]+H[2]+1e-5))&&!y(E,k.max[0]+H[0]-1e-5,k.base[1],k.base[2]+H[2]+1e-5))&&!y(E,k.base[0]+H[0]+1e-5,k.base[1],k.max[2]+H[2]-1e-5))&&!y(E,k.max[0]+H[0]-1e-5,k.base[1],k.max[2]+H[2]-1e-5))?(a[G]=h[G]>0?1:-1,h[G]=0):0===G&&(O.set(F,h[0],0,0),z(E,k,F,a,b.slideOnCollision))}}(E,b,u,M);z(E,b.Tg,u,b.resting,b.slideOnCollision),b.gd&&function(E,b,h,a){if(b.resting[1]>=0&&!b.inFluid)return;var k=0!==b.resting[0],G=0!==b.resting[2];if(!k&&!G)return;var V=Math.abs(a[0]/a[2]),l=4;if(!k&&V>l)return;if(!G&&V<1/l)return;O.add(r,h.base,a);var s=E.testSolid;v(s,h,a,(function(E,b,h,a){if(1!==b)return!0;a[b]=0}));var U=h.base[1],B=b.inFluid?1.951:1.001,o=Math.floor(U+B)-U;O.set(w,0,o,0);var u=!1;if(v(s,h,w,(function(E,b,h,a){return u=!0,!0})),u)return;O.Xc(N,r,h.base),N[1]=0,z(E,h,N,Y,!0);var D=J(h.base[0],r[0]),g=J(h.base[2],r[2]);if(k&&!D&&(!g||!G))return;if(G&&(!D||!k)&&!g)return;var S=!0;if(S=S&&!y(E,h.base[0]+1e-5,h.base[1],h.base[2]+1e-5),S=S&&!y(E,h.max[0]-1e-5,h.base[1],h.base[2]+1e-5),S=S&&!y(E,h.base[0]+1e-5,h.base[1],h.max[2]-1e-5),S=S&&!y(E,h.max[0]-1e-5,h.base[1],h.max[2]-1e-5),S)return;m(b.Tg,h),b.resting[0]=Y[0],b.resting[2]=Y[2],b.Cl&&b.Cl()}(E,b,Z,S);for(var U=0;U<3;++U)b.resting[U]=b.resting[U]||M[U],D[U]=0,b.resting[U]&&(g[U]||(D[U]=-b.jg[U]),b.jg[U]=0);var I=O.length(D);I>.001&&(O.scale(D,D,b.mass),b.Qk&&b.Qk(D),b.restitution>0&&I>E.minBounceImpulse&&(O.scale(D,D,b.restitution),b.applyImpulse(D)));var c=O.squaredLength(b.jg);c>1e-5&&b.ng();E.lk&&E.lk(b)?(b.loadFromCopy(j),b.rolledBackLastTick=!0):b.rolledBackLastTick=!1}(this,h,E,b)))};var A=O.create([0,0,0]);var n=O.create();function d(E,b,h,a,k){var G=h.resting[b],V=a[b];if(!h.alwaysApplyHorizFriction||1!==b){if(0===G)return;if(G*V<=0)return}O.i(c,h.jg),c[b]=0;var l=O.length(c);if(!J(l,0)){var v=Math.abs(h.friction*E.gravity[b]*k),s=l>v?(l-v)/l:0;h.jg[(b+1)%3]*=s,h.jg[(b+2)%3]*=s}}var c=O.create();function z(E,b,h,a,k){return O.set(a,0,0,0),v(E.testSolid,b,h,(function(E,b,h,G){a[b]=h,G[b]=0,k||(G[0]=0,G[1]=0,G[2]=0)}))}var Z=new l([],[]),Y=O.create(),r=O.create(),w=O.create(),N=O.create();var H=O.create(),f=new l([],[]),F=O.create();function y(E,b,h,a){return E.testSolid(Math.floor(b),Math.floor(h-1),Math.floor(a))}var e=O.create();function J(E,b){return Math.abs(E-b)<1e-5}function m(E,b){for(var h=0;h<3;h++)E.base[h]=b.base[h],E.max[h]=b.max[h],E.mh[h]=b.mh[h]}var K=function(E){}},10980:E=>{"use strict";E.exports=function(E,b,h,a){var k=self||window;try{try{var G;try{G=new k.Blob([E])}catch(v){(G=new(k.BlobBuilder||k.WebKitBlobBuilder||k.MozBlobBuilder||k.MSBlobBuilder)).append(E),G=G.getBlob()}var V=k.URL||k.webkitURL,l=V.createObjectURL(G),O=new k[b](l,h);return V.revokeObjectURL(l),O}catch(v){return new k[b]("data:application/javascript,".concat(encodeURIComponent(E)),h)}}catch(v){if(!a)throw Error("Inline worker is not supported");return new k[b](a,h)}}},12092:(E,b,h)=>{"use strict";function a(E,b,h,a,k){var G={};return Object.keys(a).forEach((function(E){G[E]=a[E]})),G.enumerable=!!G.enumerable,G.configurable=!!G.configurable,("value"in G||G.initializer)&&(G.writable=!0),G=h.slice().reverse().reduce((function(h,a){return a(E,b,h)||h}),G),k&&void 0!==G.initializer&&(G.value=G.initializer?G.initializer.call(k):void 0,G.initializer=void 0),void 0===G.initializer&&(Object.defineProperty(E,b,G),G=null),G}h.d(b,{c:()=>a})},12090:(E,b,h)=>{"use strict";function a(E,b,h,a){h&&Object.defineProperty(E,b,{enumerable:h.enumerable,configurable:h.configurable,writable:h.writable,value:h.initializer?h.initializer.call(a):void 0})}h.d(b,{b:()=>a})},12145:(E,b,h)=>{"use strict";h.d(b,{c:()=>I,d:()=>g,e:()=>S,i:()=>B,m:()=>D,p:()=>u,t:()=>o});var a=h(11175),k=h(11201),G=h(11186),V=h(10958),l=h(12148),O=h(11429),v=h(11383),s=h(10861),U=h(11206);const B=Object.freeze(new a.g(0,0,0,0)),o=Object.freeze(a.k.Zero()),u=Object.freeze(a.j.Zero()),D=Object.freeze(v.c.Zero()),g=Object.freeze(k.b.Black()),S=Object.freeze(new k.f(0,0,0,0)),M={key:0,repeatCount:0,loopMode:2};class I{static _PrepareAnimation(E,b,h,G,V,l,O,s){let U;if(!isNaN(parseFloat(V))&&isFinite(V)?U=I.ANIMATIONTYPE_FLOAT:V instanceof a.g?U=I.ANIMATIONTYPE_QUATERNION:V instanceof a.k?U=I.ANIMATIONTYPE_VECTOR3:V instanceof a.j?U=I.ANIMATIONTYPE_VECTOR2:V instanceof k.b?U=I.ANIMATIONTYPE_COLOR3:V instanceof k.f?U=I.ANIMATIONTYPE_COLOR4:V instanceof v.c&&(U=I.ANIMATIONTYPE_SIZE),void 0==U)return null;const B=new I(E,b,h,U,O),o=[{frame:0,value:V},{frame:G,value:l}];return B.setKeys(o),void 0!==s&&B.setEasingFunction(s),B}static CreateAnimation(E,b,h,a){const k=new I(E+"Animation",E,h,b,I.ANIMATIONLOOPMODE_CONSTANT);return k.setEasingFunction(a),k}static CreateAndStartAnimation(E,b,h,a,k,G,V,l,O,v,s){const U=I._PrepareAnimation(E,h,a,k,G,V,l,O);return U?(b.va&&(s=b.va()),s?s.beginDirectAnimation(b,[U],0,k,1===U.loopMode,1,v):null):null}static CreateAndStartHierarchyAnimation(E,b,h,a,k,G,V,l,O,v,s){const U=I._PrepareAnimation(E,a,k,G,V,l,O,v);if(!U)return null;return b.va().beginDirectHierarchyAnimation(b,h,[U],0,G,1===U.loopMode,1,s)}static CreateMergeAndStartAnimation(E,b,h,a,k,G,V,l,O,v){const s=I._PrepareAnimation(E,h,a,k,G,V,l,O);return s?(b.animations.push(s),b.va().beginAnimation(b,0,k,1===s.loopMode,1,v)):null}static MakeAnimationAdditive(E,b,h){let k;k="object"===typeof b?b:{referenceFrame:b??0,range:h,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let G=E;if(k.cloneOriginalAnimation&&(G=E.clone(),G.name=k.clonedAnimationName||G.name),!G._keys.length)return G;const V=k.referenceFrame&&k.referenceFrame>=0?k.referenceFrame:0;let l=0;const O=G._keys[0];let v=G._keys.length-1;const s=G._keys[v],U={referenceValue:O.value,referencePosition:a.h.o[0],referenceQuaternion:a.h.Quaternion[0],referenceScaling:a.h.o[1],keyPosition:a.h.o[2],keyQuaternion:a.h.Quaternion[1],keyScaling:a.h.o[3]};let B=O.frame,o=s.frame;if(k.range){const E=G.getRange(k.range);E&&(B=E.from,o=E.to)}else B=k.fromFrame??B,o=k.toFrame??o;if(B!==O.frame&&(l=G.createKeyForFrame(B)),o!==s.frame&&(v=G.createKeyForFrame(o)),1===G._keys.length){const E=G._getKeyValue(G._keys[0]);U.referenceValue=E.clone?E.clone():E}else if(V<=O.frame){const E=G._getKeyValue(O.value);U.referenceValue=E.clone?E.clone():E}else if(V>=s.frame){const E=G._getKeyValue(s.value);U.referenceValue=E.clone?E.clone():E}else{M.key=0;const E=G._interpolate(V,M);U.referenceValue=E.clone?E.clone():E}G.dataType===I.ANIMATIONTYPE_QUATERNION?U.referenceValue.normalize().conjugateInPlace():G.dataType===I.ANIMATIONTYPE_MATRIX&&(U.referenceValue.decompose(U.referenceScaling,U.referenceQuaternion,U.referencePosition),U.referenceQuaternion.normalize().conjugateInPlace());let u=Number.MAX_VALUE;const D=k.clipKeys?[]:null;for(let g=l;g<=v;g++){let E=G._keys[g];if((D||k.cloneOriginalAnimation)&&(E={frame:E.frame,value:E.value.clone?E.value.clone():E.value,inTangent:E.inTangent,outTangent:E.outTangent,interpolation:E.interpolation,lockedTangent:E.lockedTangent},D&&(u===Number.MAX_VALUE&&(u=E.frame),E.frame-=u,D.push(E))),!g||G.dataType===I.ANIMATIONTYPE_FLOAT||E.value!==O.value)switch(G.dataType){case I.ANIMATIONTYPE_MATRIX:E.value.decompose(U.keyScaling,U.keyQuaternion,U.keyPosition),U.keyPosition.yi(U.referencePosition),U.keyScaling.divideInPlace(U.referenceScaling),U.referenceQuaternion.multiplyToRef(U.keyQuaternion,U.keyQuaternion),a.d.ComposeToRef(U.keyScaling,U.keyQuaternion,U.keyPosition,E.value);break;case I.ANIMATIONTYPE_QUATERNION:U.referenceValue.multiplyToRef(E.value,E.value);break;case I.ANIMATIONTYPE_VECTOR2:case I.ANIMATIONTYPE_VECTOR3:case I.ANIMATIONTYPE_COLOR3:case I.ANIMATIONTYPE_COLOR4:E.value.subtractToRef(U.referenceValue,E.value);break;case I.ANIMATIONTYPE_SIZE:E.value.width-=U.referenceValue.width,E.value.height-=U.referenceValue.height;break;default:E.value-=U.referenceValue}}return D&&G.setKeys(D,!0),G}static TransitionTo(E,b,h,a,k,G,V){let l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(V<=0)return h[E]=b,l&&l(),null;const O=k*(V/1e3);G.setKeys([{frame:0,value:h[E].clone?h[E].clone():h[E]},{frame:O,value:b}]),h.animations||(h.animations=[]),h.animations.push(G);const v=a.beginAnimation(h,0,O,!1);return v.onAnimationEnd=l,v}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const E of this._runtimeAnimations)if(!E.isStopped())return!0;return!1}constructor(E,b,h,a,k,G){this.name=E,this.targetProperty=b,this.framePerSecond=h,this.dataType=a,this.loopMode=k,this.enableBlending=G,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=b.split("."),this.dataType=a,this.loopMode=void 0===k?I.ANIMATIONLOOPMODE_CYCLE:k,this.uniqueId=I._UniqueIdGenerator++}toString(E){let b="Name: "+this.name+", property: "+this.targetProperty;if(b+=", datatype: "+["Float","o","Quaternion","Matrix","gb","Vector2"][this.dataType],b+=", nKeys: "+(this._keys?this._keys.length:"none"),b+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),E){b+=", Ranges: {";let E=!0;for(const h in this._ranges)E&&(b+=", ",E=!1),b+=h;b+="}"}return b}addEvent(E){this._events.push(E),this._events.sort(((E,b)=>E.frame-b.frame))}removeEvents(E){for(let b=0;b<this._events.length;b++)this._events[b].frame===E&&(this._events.splice(b,1),b--)}getEvents(){return this._events}createRange(E,b,h){this._ranges[E]||(this._ranges[E]=new l.b(E,b,h))}deleteRange(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const h=this._ranges[E];if(h){if(b){const E=h.from,b=h.to;for(let h=this._keys.length-1;h>=0;h--)this._keys[h].frame>=E&&this._keys[h].frame<=b&&this._keys.splice(h,1)}this._ranges[E]=null}}getRange(E){return this._ranges[E]}getKeys(){return this._keys}getHighestFrame(){let E=0;for(let b=0,h=this._keys.length;b<h;b++)E<this._keys[b].frame&&(E=this._keys[b].frame);return E}getEasingFunction(){return this._easingFunction}setEasingFunction(E){this._easingFunction=E}floatInterpolateFunction(E,b,h){return(0,G.o)(E,b,h)}floatInterpolateFunctionWithTangents(E,b,h,a,k){return(0,G.d)(E,b,h,a,k)}quaternionInterpolateFunction(E,b,h){return a.g.Slerp(E,b,h)}quaternionInterpolateFunctionWithTangents(E,b,h,k,G){return a.g.Hermite(E,b,h,k,G).normalize()}vector3InterpolateFunction(E,b,h){return a.k.Lerp(E,b,h)}vector3InterpolateFunctionWithTangents(E,b,h,k,G){return a.k.Hermite(E,b,h,k,G)}vector2InterpolateFunction(E,b,h){return a.j.Lerp(E,b,h)}vector2InterpolateFunctionWithTangents(E,b,h,k,G){return a.j.Hermite(E,b,h,k,G)}sizeInterpolateFunction(E,b,h){return v.c.Lerp(E,b,h)}color3InterpolateFunction(E,b,h){return k.b.Lerp(E,b,h)}color3InterpolateFunctionWithTangents(E,b,h,a,G){return k.b.Hermite(E,b,h,a,G)}color4InterpolateFunction(E,b,h){return k.f.Lerp(E,b,h)}color4InterpolateFunctionWithTangents(E,b,h,a,G){return k.f.Hermite(E,b,h,a,G)}_getKeyValue(E){return"function"===typeof E?E():E}evaluate(E){return M.key=0,this._interpolate(E,M)}_interpolate(E,b){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(b.loopMode===I.ANIMATIONLOOPMODE_CONSTANT&&b.repeatCount>0)return b.highLimitValue.clone?b.highLimitValue.clone():b.highLimitValue;const a=this._keys,k=a.length;let G=b.key;for(;G>=0&&E<a[G].frame;)--G;for(;G+1<=k-1&&E>=a[G+1].frame;)++G;if(b.key=G,G<0)return h?void 0:this._getKeyValue(a[0].value);if(G+1>k-1)return h?void 0:this._getKeyValue(a[k-1].value);const V=a[G],l=a[G+1];if(h&&(E===V.frame||E===l.frame))return;const O=this._getKeyValue(V.value),v=this._getKeyValue(l.value);if(1===V.interpolation)return l.frame>E?O:v;const s=void 0!==V.outTangent&&void 0!==l.inTangent,U=l.frame-V.frame;let M=(E-V.frame)/U;const j=V.easingFunction||this.getEasingFunction();switch(null!==j&&(M=j.ease(M)),this.dataType){case I.ANIMATIONTYPE_FLOAT:{const E=s?this.floatInterpolateFunctionWithTangents(O,V.outTangent*U,v,l.inTangent*U,M):this.floatInterpolateFunction(O,v,M);switch(b.loopMode){case I.ANIMATIONLOOPMODE_CYCLE:case I.ANIMATIONLOOPMODE_CONSTANT:case I.ANIMATIONLOOPMODE_YOYO:return E;case I.ANIMATIONLOOPMODE_RELATIVE:case I.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(b.offsetValue??0)*b.repeatCount+E}break}case I.ANIMATIONTYPE_QUATERNION:{const E=s?this.quaternionInterpolateFunctionWithTangents(O,V.outTangent.scale(U),v,l.inTangent.scale(U),M):this.quaternionInterpolateFunction(O,v,M);switch(b.loopMode){case I.ANIMATIONLOOPMODE_CYCLE:case I.ANIMATIONLOOPMODE_CONSTANT:case I.ANIMATIONLOOPMODE_YOYO:return E;case I.ANIMATIONLOOPMODE_RELATIVE:case I.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return E.addInPlace((b.offsetValue||B).scale(b.repeatCount))}return E}case I.ANIMATIONTYPE_VECTOR3:{const E=s?this.vector3InterpolateFunctionWithTangents(O,V.outTangent.scale(U),v,l.inTangent.scale(U),M):this.vector3InterpolateFunction(O,v,M);switch(b.loopMode){case I.ANIMATIONLOOPMODE_CYCLE:case I.ANIMATIONLOOPMODE_CONSTANT:case I.ANIMATIONLOOPMODE_YOYO:return E;case I.ANIMATIONLOOPMODE_RELATIVE:case I.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return E.add((b.offsetValue||o).scale(b.repeatCount))}break}case I.ANIMATIONTYPE_VECTOR2:{const E=s?this.vector2InterpolateFunctionWithTangents(O,V.outTangent.scale(U),v,l.inTangent.scale(U),M):this.vector2InterpolateFunction(O,v,M);switch(b.loopMode){case I.ANIMATIONLOOPMODE_CYCLE:case I.ANIMATIONLOOPMODE_CONSTANT:case I.ANIMATIONLOOPMODE_YOYO:return E;case I.ANIMATIONLOOPMODE_RELATIVE:case I.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return E.add((b.offsetValue||u).scale(b.repeatCount))}break}case I.ANIMATIONTYPE_SIZE:switch(b.loopMode){case I.ANIMATIONLOOPMODE_CYCLE:case I.ANIMATIONLOOPMODE_CONSTANT:case I.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(O,v,M);case I.ANIMATIONLOOPMODE_RELATIVE:case I.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(O,v,M).add((b.offsetValue||D).scale(b.repeatCount))}break;case I.ANIMATIONTYPE_COLOR3:{const E=s?this.color3InterpolateFunctionWithTangents(O,V.outTangent.scale(U),v,l.inTangent.scale(U),M):this.color3InterpolateFunction(O,v,M);switch(b.loopMode){case I.ANIMATIONLOOPMODE_CYCLE:case I.ANIMATIONLOOPMODE_CONSTANT:case I.ANIMATIONLOOPMODE_YOYO:return E;case I.ANIMATIONLOOPMODE_RELATIVE:case I.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return E.add((b.offsetValue||g).scale(b.repeatCount))}break}case I.ANIMATIONTYPE_COLOR4:{const E=s?this.color4InterpolateFunctionWithTangents(O,V.outTangent.scale(U),v,l.inTangent.scale(U),M):this.color4InterpolateFunction(O,v,M);switch(b.loopMode){case I.ANIMATIONLOOPMODE_CYCLE:case I.ANIMATIONLOOPMODE_CONSTANT:case I.ANIMATIONLOOPMODE_YOYO:return E;case I.ANIMATIONLOOPMODE_RELATIVE:case I.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return E.add((b.offsetValue||S).scale(b.repeatCount))}break}case I.ANIMATIONTYPE_MATRIX:switch(b.loopMode){case I.ANIMATIONLOOPMODE_CYCLE:case I.ANIMATIONLOOPMODE_CONSTANT:case I.ANIMATIONLOOPMODE_YOYO:return I.AllowMatricesInterpolation?this.matrixInterpolateFunction(O,v,M,b.workValue):O;case I.ANIMATIONLOOPMODE_RELATIVE:case I.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return O}}return 0}matrixInterpolateFunction(E,b,h,k){return I.AllowMatrixDecomposeForInterpolation?k?(a.d.DecomposeLerpToRef(E,b,h,k),k):a.d.DecomposeLerp(E,b,h):k?(a.d.LerpToRef(E,b,h,k),k):a.d.Lerp(E,b,h)}clone(){const E=new I(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(E.enableBlending=this.enableBlending,E.blendingSpeed=this.blendingSpeed,this._keys&&E.setKeys(this._keys),this._ranges){E._ranges={};for(const b in this._ranges){const h=this._ranges[b];h&&(E._ranges[b]=h.clone())}}return E}setKeys(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=b?E:E.slice(0)}createKeyForFrame(E){M.key=0;const b=this._interpolate(E,M,!0);if(!b)return this._keys[M.key].frame===E?M.key:M.key+1;const h={frame:E,value:b.clone?b.clone():b};return this._keys.splice(M.key+1,0,h),M.key+1}serialize(){const E={};E.name=this.name,E.property=this.targetProperty,E.framePerSecond=this.framePerSecond,E.dataType=this.dataType,E.loopBehavior=this.loopMode,E.enableBlending=this.enableBlending,E.blendingSpeed=this.blendingSpeed;const b=this.dataType;E.keys=[];const h=this.getKeys();for(let a=0;a<h.length;a++){const k=h[a],G={};switch(G.frame=k.frame,b){case I.ANIMATIONTYPE_FLOAT:G.values=[k.value],void 0!==k.inTangent&&G.values.push(k.inTangent),void 0!==k.outTangent&&(void 0===k.inTangent&&G.values.push(void 0),G.values.push(k.outTangent)),void 0!==k.interpolation&&(void 0===k.inTangent&&G.values.push(void 0),void 0===k.outTangent&&G.values.push(void 0),G.values.push(k.interpolation));break;case I.ANIMATIONTYPE_QUATERNION:case I.ANIMATIONTYPE_MATRIX:case I.ANIMATIONTYPE_VECTOR3:case I.ANIMATIONTYPE_COLOR3:case I.ANIMATIONTYPE_COLOR4:G.values=k.value.qj(),void 0!=k.inTangent&&G.values.push(k.inTangent.qj()),void 0!=k.outTangent&&(void 0===k.inTangent&&G.values.push(void 0),G.values.push(k.outTangent.qj())),void 0!==k.interpolation&&(void 0===k.inTangent&&G.values.push(void 0),void 0===k.outTangent&&G.values.push(void 0),G.values.push(k.interpolation))}E.keys.push(G)}E.ranges=[];for(const a in this._ranges){const b=this._ranges[a];if(!b)continue;const h={};h.name=a,h.from=b.from,h.to=b.to,E.ranges.push(h)}return E}static _UniversalLerp(E,b,h){const a=E.constructor;return a.Lerp?a.Lerp(E,b,h):a.Slerp?a.Slerp(E,b,h):E.toFixed?E*(1-h)+h*b:b}static Parse(E){const b=new I(E.name,E.property,E.framePerSecond,E.dataType,E.loopBehavior),h=E.dataType,G=[];let V,l;for(E.enableBlending&&(b.enableBlending=E.enableBlending),E.blendingSpeed&&(b.blendingSpeed=E.blendingSpeed),l=0;l<E.keys.length;l++){const b=E.keys[l];let O,v,s;switch(h){case I.ANIMATIONTYPE_FLOAT:V=b.values[0],b.values.length>=2&&(O=b.values[1]),b.values.length>=3&&(v=b.values[2]),b.values.length>=4&&(s=b.values[3]);break;case I.ANIMATIONTYPE_QUATERNION:if(V=a.g.jh(b.values),b.values.length>=8){const E=a.g.jh(b.values.slice(4,8));E.equals(a.g.Zero())||(O=E)}if(b.values.length>=12){const E=a.g.jh(b.values.slice(8,12));E.equals(a.g.Zero())||(v=E)}b.values.length>=13&&(s=b.values[12]);break;case I.ANIMATIONTYPE_MATRIX:V=a.d.jh(b.values),b.values.length>=17&&(s=b.values[16]);break;case I.ANIMATIONTYPE_COLOR3:V=k.b.jh(b.values),b.values[3]&&(O=k.b.jh(b.values[3])),b.values[4]&&(v=k.b.jh(b.values[4])),b.values[5]&&(s=b.values[5]);break;case I.ANIMATIONTYPE_COLOR4:V=k.f.jh(b.values),b.values[4]&&(O=k.f.jh(b.values[4])),b.values[5]&&(v=k.f.jh(b.values[5])),b.values[6]&&(s=k.f.jh(b.values[6]));break;case I.ANIMATIONTYPE_VECTOR3:default:V=a.k.jh(b.values),b.values[3]&&(O=a.k.jh(b.values[3])),b.values[4]&&(v=a.k.jh(b.values[4])),b.values[5]&&(s=b.values[5])}const U={};U.frame=b.frame,U.value=V,void 0!=O&&(U.inTangent=O),void 0!=v&&(U.outTangent=v),void 0!=s&&(U.interpolation=s),G.push(U)}if(b.setKeys(G),E.ranges)for(l=0;l<E.ranges.length;l++)V=E.ranges[l],b.createRange(V.name,V.from,V.to);return b}static AppendSerializedAnimations(E,b){U.e.AppendSerializedAnimations(E,b)}static ParseFromFileAsync(E,b){return new Promise(((h,a)=>{const k=new s.c;k.addEventListener("readystatechange",(()=>{if(4==k.readyState)if(200==k.status){let b=JSON.parse(k.responseText);if(b.animations&&(b=b.animations),b.length){const E=[];for(const h of b)E.push(this.Parse(h));h(E)}else{const a=this.Parse(b);E&&(a.name=E),h(a)}}else a("Unable to load the animation")})),k.open("GET",b),k.send()}))}static ParseFromSnippetAsync(E){return new Promise(((b,h)=>{const a=new s.c;a.addEventListener("readystatechange",(()=>{if(4==a.readyState)if(200==a.status){const h=JSON.parse(JSON.parse(a.responseText).jsonPayload);if(h.animations){const a=JSON.parse(h.animations),k=[];for(const b of a.animations){const h=this.Parse(b);h.snippetId=E,k.push(h)}b(k)}else{const a=JSON.parse(h.animation),k=this.Parse(a);k.snippetId=E,b(k)}}else h("Unable to load the snippet "+E)})),a.open("GET",this.SnippetUrl+"/"+E.replace(/#/g,"/")),a.send()}))}}I._UniqueIdGenerator=0,I.AllowMatricesInterpolation=!1,I.AllowMatrixDecomposeForInterpolation=!0,I.SnippetUrl="https://snippet.babylonjs.com",I.ANIMATIONTYPE_FLOAT=0,I.ANIMATIONTYPE_VECTOR3=1,I.ANIMATIONTYPE_QUATERNION=2,I.ANIMATIONTYPE_MATRIX=3,I.ANIMATIONTYPE_COLOR3=4,I.ANIMATIONTYPE_COLOR4=7,I.ANIMATIONTYPE_VECTOR2=5,I.ANIMATIONTYPE_SIZE=6,I.ANIMATIONLOOPMODE_RELATIVE=0,I.ANIMATIONLOOPMODE_CYCLE=1,I.ANIMATIONLOOPMODE_CONSTANT=2,I.ANIMATIONLOOPMODE_YOYO=4,I.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,I.CreateFromSnippetAsync=I.ParseFromSnippetAsync,(0,V.f)("BABYLON.Animation",I),O.d._AnimationRangeFactory=(E,b,h)=>new l.b(E,b,h)},12148:(E,b,h)=>{"use strict";h.d(b,{b:()=>a});class a{constructor(E,b,h){this.name=E,this.from=b,this.to=h}clone(){return new a(this.name,this.from,this.to)}}},11722:(E,b,h)=>{"use strict";var a=h(10824),k=h(10834),G=h(10902),V=h(10832);G.d.AudioEngineFactory=(E,b,h)=>new l(E,b,h);class l{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new a.e,this.onAudioLockedObservable=new a.e,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,V.i)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const k=document.createElement("audio");this._hostElement=E,this._audioContext=b,this._audioDestination=h;try{k&&k.canPlayType&&(k.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||k.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(G){}try{k&&k.canPlayType&&k.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(G){}}lock(){this._triggerSuspendedState()}unlock(){var E,b;if("running"===(null===(E=this._audioContext)||void 0===E?void 0:E.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(b=this._audioContext)||void 0===b||b.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningState()})):this._triggerRunningState()}_resumeAudioContextOnStateChange(){var E;null===(E=this._audioContext)||void 0===E||E.addEventListener("statechange",(()=>{var E;this.unlocked&&"running"!==(null===(E=this._audioContext)||void 0===E?void 0:E.state)&&this._resumeAudioContext()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContext(){var E;return null!==(E=this._audioContext)&&void 0!==E&&E.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningState())}catch(E){this.canUseWebAudio=!1,k.c.Error("Web Audio: "+E.message)}}_triggerRunningState(){this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then((()=>{this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)})).catch((()=>{this._tryToRun=!1,this.unlocked=!1})))}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const E=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",b=document.createElement("style");b.appendChild(document.createTextNode(E)),document.getElementsByTagName("head")[0].appendChild(b),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningState()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(E){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=E)}connectToAnalyser(E){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=E,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}},12141:(E,b,h)=>{"use strict";h.d(b,{e:()=>V});var a=h(11175),k=h(11183),G=h(11429);class V extends G.d{get _matrix(){return this._compose(),this.Yj}set _matrix(E){(E.updateFlag!==this.Yj.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Yj.p(E),this._markAsDirtyAndDecompose())}constructor(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,V=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(E,b.va(),!1),this.name=E,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=b,this.Yj=(null===k||void 0===k?void 0:k.clone())??a.d.Identity(),this._restMatrix=G??this.Yj.clone(),this._bindMatrix=V??this.Yj.clone(),this._index=l,this._absoluteMatrix=new a.d,this._absoluteBindMatrix=new a.d,this._absoluteInverseBindMatrix=new a.d,this._finalMatrix=new a.d,b.bones.push(this),this.setParent(h,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(E){this.setParent(E)}setParent(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==E){if(this.parent){const E=this.parent.children.indexOf(this);-1!==E&&this.parent.children.splice(E,1)}this._parentNode=E,this.parent&&this.parent.children.push(this),b&&this._updateAbsoluteBindMatrices(),this.ah()}}getLocalMatrix(){return this._compose(),this.Yj}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(E){this._restMatrix.p(E)}setRestPose(E){this.setRestMatrix(E)}getBindPose(){return this.getBindMatrix()}setBindMatrix(E){this.Pj(E)}setBindPose(E){this.setBindMatrix(E)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const E=a.h.o[0],b=a.h.Quaternion[0],h=a.h.o[1];this.getRestMatrix().decompose(E,b,h),this._linkedTransformNode.position.p(h),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??a.g.Identity(),this._linkedTransformNode.rotationQuaternion.p(b),this._linkedTransformNode.ve.p(E)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(E){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=E,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.re}set position(E){this._decompose(),this.re.p(E),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(E){this.setRotation(E)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(E){this.setRotationQuaternion(E)}get ve(){return this.getScale()}set ve(E){this.setScale(E)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=a.k.Zero(),this._localRotation=a.g.Zero(),this.re=a.k.Zero()),this.Yj.decompose(this._localScaling,this._localRotation,this.re))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,a.d.ComposeToRef(this._localScaling,this._localRotation,this.re,this.Yj)):this._needToCompose=!1)}Pj(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(E),b&&this._updateAbsoluteBindMatrices(),h?this._matrix=E:this.ah()}_updateAbsoluteBindMatrices(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(E||(E=this._bindMatrix),this.parent?E.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(E),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),b)for(let h=0;h<this.children.length;h++)this.children[h]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}ah(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.ah(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.ah(),this._needToDecompose=!0}_updatePosition(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0,k=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const G=this.getLocalMatrix();if(0==b)k?(G.addAtIndex(12,E.x),G.addAtIndex(13,E.y),G.addAtIndex(14,E.z)):G.setTranslationFromFloats(E.x,E.y,E.z);else{let b=null;h&&(b=h.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const l=V._TmpMats[0],O=V._TmpVecs[0];this.parent?h&&b?(l.p(this.parent.getAbsoluteMatrix()),l.multiplyToRef(b,l)):l.p(this.parent.getAbsoluteMatrix()):a.d.IdentityToRef(l),k&&l.setTranslationFromFloats(0,0,0),l.invert(),a.k.TransformCoordinatesToRef(E,l,O),k?(G.addAtIndex(12,O.x),G.addAtIndex(13,O.y),G.addAtIndex(14,O.z)):G.setTranslationFromFloats(O.x,O.y,O.z)}this._markAsDirtyAndDecompose()}translate(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0;this._updatePosition(E,b,h,!0)}setPosition(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0;this._updatePosition(E,b,h,!1)}setAbsolutePosition(E,b){this.setPosition(E,1,b)}scale(E,b,h){let k=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const G=this.getLocalMatrix(),l=V._TmpMats[0];a.d.ScalingToRef(E,b,h,l),l.multiplyToRef(G,G),l.invert();for(const a of this.children){const k=a.getLocalMatrix();k.multiplyToRef(l,k),k.multiplyAtIndex(12,E),k.multiplyAtIndex(13,b),k.multiplyAtIndex(14,h),a._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),k)for(const a of this.children)a.scale(E,b,h,k)}setScale(E){this._decompose(),this._localScaling.p(E),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(E){this._decompose(),E.p(this._localScaling)}setYawPitchRoll(E,b,h){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,G=arguments.length>4?arguments[4]:void 0;if(0===k){const l=V._TmpQuat;return a.g.RotationYawPitchRollToRef(E,b,h,l),void this.setRotationQuaternion(l,k,G)}const l=V._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(l,G))return;const O=V._TmpMats[1];a.d.RotationYawPitchRollToRef(E,b,h,O),l.multiplyToRef(O,O),this._rotateWithMatrix(O,k,G)}rotate(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,k=arguments.length>3?arguments[3]:void 0;const G=V._TmpMats[0];G.setTranslationFromFloats(0,0,0),a.d.RotationAxisToRef(E,b,G),this._rotateWithMatrix(G,h,k)}setAxisAngle(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,k=arguments.length>3?arguments[3]:void 0;if(0===h){const G=V._TmpQuat;return a.g.RotationAxisToRef(E,b,G),void this.setRotationQuaternion(G,h,k)}const G=V._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(G,k))return;const l=V._TmpMats[1];a.d.RotationAxisToRef(E,b,l),G.multiplyToRef(l,l),this._rotateWithMatrix(l,h,k)}setRotation(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(E.y,E.x,E.z,b,h)}setRotationQuaternion(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0;if(0===b)return this._decompose(),this._localRotation.p(E),void this._markAsDirtyAndCompose();const k=V._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(k,h))return;const G=V._TmpMats[1];a.d.FromQuaternionToRef(E,G),k.multiplyToRef(G,G),this._rotateWithMatrix(G,b,h)}setRotationMatrix(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0;if(0===b){const k=V._TmpQuat;return a.g.FromRotationMatrixToRef(E,k),void this.setRotationQuaternion(k,b,h)}const k=V._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(k,h))return;const G=V._TmpMats[1];G.p(E),k.multiplyToRef(E,G),this._rotateWithMatrix(G,b,h)}_rotateWithMatrix(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0;const a=this.getLocalMatrix(),k=a.m[12],G=a.m[13],l=a.m[14],O=this.getParent(),v=V._TmpMats[3],s=V._TmpMats[4];O&&1==b?(h?(v.p(h.getWorldMatrix()),O.getAbsoluteMatrix().multiplyToRef(v,v)):v.p(O.getAbsoluteMatrix()),s.p(v),s.invert(),a.multiplyToRef(v,a),a.multiplyToRef(E,a),a.multiplyToRef(s,a)):1==b&&h?(v.p(h.getWorldMatrix()),s.p(v),s.invert(),a.multiplyToRef(v,a),a.multiplyToRef(E,a),a.multiplyToRef(s,a)):a.multiplyToRef(E,a),a.setTranslationFromFloats(k,G,l),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(E,b){const h=V._TmpMats[2];return E.p(this.getAbsoluteMatrix()),b?(E.multiplyToRef(b.getWorldMatrix(),E),a.d.ScalingToRef(b.ve.x,b.ve.y,b.ve.z,h)):a.d.IdentityToRef(h),E.invert(),!isNaN(E.m[0])&&(h.multiplyAtIndex(0,this._scalingDeterminant),E.multiplyToRef(h,E),!0)}cb(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=a.k.Zero();return this.getPositionToRef(E,b,h),h}getPositionToRef(){let E=arguments.length>1?arguments[1]:void 0,b=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const E=this.getLocalMatrix();b.x=E.m[12],b.y=E.m[13],b.z=E.m[14]}else{let h=null;E&&(h=E.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let a=V._TmpMats[0];E&&h?(a.p(this.getAbsoluteMatrix()),a.multiplyToRef(h,a)):a=this.getAbsoluteMatrix(),b.x=a.m[12],b.y=a.m[13],b.z=a.m[14]}}getAbsolutePosition(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const b=a.k.Zero();return this.getPositionToRef(1,E,b),b}getAbsolutePositionToRef(E,b){this.getPositionToRef(1,E,b)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Yj.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.Yj);const E=this._skeleton.getPoseMatrix();E&&this._absoluteMatrix.multiplyToRef(E,this._absoluteMatrix)}const E=this.children,b=E.length;for(let h=0;h<b;h++)E[h].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}hf(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=a.k.Zero();return this.getDirectionToRef(E,b,h),h}getDirectionToRef(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2?arguments[2]:void 0,k=null;b&&(k=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const G=V._TmpMats[0];G.p(this.getAbsoluteMatrix()),b&&k&&G.multiplyToRef(k,G),a.k.TransformNormalToRef(E,G,h),h.normalize()}getRotation(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=a.k.Zero();return this.getRotationToRef(E,b,h),h}getRotationToRef(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2?arguments[2]:void 0;const a=V._TmpQuat;this.getRotationQuaternionToRef(E,b,a),a.toEulerAnglesToRef(h)}getRotationQuaternion(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=a.g.Identity();return this.getRotationQuaternionToRef(E,b,h),h}getRotationQuaternionToRef(){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),b.p(this._localRotation);else{const h=V._TmpMats[0],a=this.getAbsoluteMatrix();E?a.multiplyToRef(E.getWorldMatrix(),h):h.p(a),h.multiplyAtIndex(0,this._scalingDeterminant),h.multiplyAtIndex(1,this._scalingDeterminant),h.multiplyAtIndex(2,this._scalingDeterminant),h.decompose(void 0,b,void 0)}}getRotationMatrix(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1?arguments[1]:void 0;const h=a.d.Identity();return this.getRotationMatrixToRef(E,b,h),h}getRotationMatrixToRef(){let E=arguments.length>1?arguments[1]:void 0,b=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(b);else{const h=V._TmpMats[0],a=this.getAbsoluteMatrix();E?a.multiplyToRef(E.getWorldMatrix(),h):h.p(a),h.multiplyAtIndex(0,this._scalingDeterminant),h.multiplyAtIndex(1,this._scalingDeterminant),h.multiplyAtIndex(2,this._scalingDeterminant),h.getRotationMatrixToRef(b)}}getAbsolutePositionFromLocal(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=a.k.Zero();return this.getAbsolutePositionFromLocalToRef(E,b,h),h}getAbsolutePositionFromLocalToRef(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2?arguments[2]:void 0,k=null;b&&(k=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const G=V._TmpMats[0];G.p(this.getAbsoluteMatrix()),b&&k&&G.multiplyToRef(k,G),a.k.TransformCoordinatesToRef(E,G,h)}getLocalPositionFromAbsolute(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=a.k.Zero();return this.getLocalPositionFromAbsoluteToRef(E,b,h),h}getLocalPositionFromAbsoluteToRef(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2?arguments[2]:void 0,k=null;b&&(k=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const G=V._TmpMats[0];G.p(this.getAbsoluteMatrix()),b&&k&&G.multiplyToRef(k,G),G.invert(),a.k.TransformCoordinatesToRef(E,G,h)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}}V._TmpVecs=(0,k.b)(2,a.k.Zero),V._TmpQuat=a.g.Identity(),V._TmpMats=(0,k.b)(5,a.d.Identity)},11233:(E,b,h)=>{"use strict";h.d(b,{d:()=>G,g:()=>V});var a=h(11240),k=h(10834);class G{get u(){return this._isDisposed}constructor(E,b,h){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,G=arguments.length>4&&void 0!==arguments[4]&&arguments[4],V=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],O=arguments.length>7?arguments[7]:void 0,v=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,E&&E.va?this._engine=E.va().getEngine():this._engine=E,this._updatable=h,this._instanced=V,this._divisor=O||1,this._label=v,b instanceof a.d?(this._data=null,this._buffer=b):(this._data=b,this._buffer=null),this.byteStride=l?k:k*Float32Array.BYTES_PER_ELEMENT,G||this.create()}createVertexBuffer(E,b,h,a,k){let G=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6?arguments[6]:void 0;const O=G?b:b*Float32Array.BYTES_PER_ELEMENT,v=a?G?a:a*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new V(this._engine,this,E,this._updatable,!0,v,void 0===k?this._instanced:k,O,h,void 0,void 0,!0,this._divisor||l)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!E&&this._buffer||(E=E||this._data,E&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,E),this._data=E):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(E,this._label),this._data=E):this._buffer=this._engine.createVertexBuffer(E,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.mb>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.mb,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.mb,void 0,this._label));k.c.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(E){this.create(E)}updateDirectly(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,E,a?b:b*Float32Array.BYTES_PER_ELEMENT,h?h*this.byteStride:void 0),this._data=0===b&&void 0===h?E:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class V{get u(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(E){const b=0!=E;this._instanceDivisor=E,b!==this._instanced&&(this._instanced=b,this._computeHashCode())}get _maxVerticesCount(){const E=this.getData();return E?Array.isArray(E)?E.length/(this.byteStride/4)-this.byteOffset/4:(E.byteLength-this.byteOffset)/this.byteStride:0}constructor(E,b,h,a,k,l,O,v,s,U){let B=arguments.length>10&&void 0!==arguments[10]&&arguments[10],o=arguments.length>11&&void 0!==arguments[11]&&arguments[11],u=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,D=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let g=!1;if(this.xd=E,"object"===typeof a&&null!==a?(g=a.updatable??!1,k=a.postponeInternalCreation,l=a.stride,O=a.instanced,v=a.offset,s=a.size,U=a.type,B=a.normalized??!1,o=a.useBytes??!1,u=a.divisor??1,D=a.takeBufferOwnership??!1,this._label=a.label):g=!!a,b instanceof G?(this._buffer=b,this._ownsBuffer=D):(this._buffer=new G(E,b,g,l,k,O,o,u,this._label),this._ownsBuffer=!0),this.uniqueId=V._Counter++,this._kind=h,void 0===U){const E=this.getData();this.type=E?V.GetDataType(E):V.FLOAT}else this.type=U;const S=V.GetTypeByteLength(this.type);o?(this._size=s||(l?l/S:V.DeduceStride(h)),this.byteStride=l||this._buffer.byteStride||this._size*S,this.byteOffset=v||0):(this._size=s||l||V.DeduceStride(h),this.byteStride=l?l*S:this._buffer.byteStride||this._size*S,this.byteOffset=(v||0)*S),this.normalized=B,this._instanced=void 0!==O&&O,this._instanceDivisor=O?u:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var E;null===(E=this._buffer)||void 0===E||E._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(E,b){const h=this.getData();return h?V.GetFloatData(h,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,E,b):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/V.GetTypeByteLength(this.type)}getOffset(){return this.byteOffset/V.GetTypeByteLength(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*V.GetTypeByteLength(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(E){this._buffer.create(E),this._alignBuffer()}update(E){this._buffer.update(E),this._alignBuffer()}updateDirectly(E,b){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(E,b,void 0,h),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(E,b){V.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,E,this.normalized,b)}_alignBuffer(){}static DeduceStride(E){switch(E){case V.UVKind:case V.UV2Kind:case V.UV3Kind:case V.UV4Kind:case V.UV5Kind:case V.UV6Kind:return 2;case V.NormalKind:case V.PositionKind:return 3;case V.ColorKind:case V.ColorInstanceKind:case V.MatricesIndicesKind:case V.MatricesIndicesExtraKind:case V.MatricesWeightsKind:case V.MatricesWeightsExtraKind:case V.TangentKind:return 4;default:throw new Error("Invalid kind '"+E+"'")}}static GetDataType(E){return E instanceof Int8Array?V.BYTE:E instanceof Uint8Array?V.UNSIGNED_BYTE:E instanceof Int16Array?V.SHORT:E instanceof Uint16Array?V.UNSIGNED_SHORT:E instanceof Int32Array?V.INT:E instanceof Uint32Array?V.UNSIGNED_INT:V.FLOAT}static GetTypeByteLength(E){switch(E){case V.BYTE:case V.UNSIGNED_BYTE:return 1;case V.SHORT:case V.UNSIGNED_SHORT:return 2;case V.INT:case V.UNSIGNED_INT:case V.FLOAT:return 4;default:throw new Error(`Invalid type '${E}'`)}}static ForEach(E,b,h,a,k,G,l,O){if(E instanceof Array){let k=b/4;const V=h/4;for(let b=0;b<G;b+=a){for(let h=0;h<a;h++)O(E[k+h],b+h);k+=V}}else{const v=E instanceof ArrayBuffer?new DataView(E):new DataView(E.buffer,E.byteOffset,E.byteLength),s=V.GetTypeByteLength(k);for(let E=0;E<G;E+=a){let G=b;for(let b=0;b<a;b++){O(V._GetFloatValue(v,k,G,l),E+b),G+=s}b+=h}}}static _GetFloatValue(E,b,h,a){switch(b){case V.BYTE:{let b=E.getInt8(h);return a&&(b=Math.max(b/127,-1)),b}case V.UNSIGNED_BYTE:{let b=E.getUint8(h);return a&&(b/=255),b}case V.SHORT:{let b=E.getInt16(h,!0);return a&&(b=Math.max(b/32767,-1)),b}case V.UNSIGNED_SHORT:{let b=E.getUint16(h,!0);return a&&(b/=65535),b}case V.INT:return E.getInt32(h,!0);case V.UNSIGNED_INT:return E.getUint32(h,!0);case V.FLOAT:return E.getFloat32(h,!0);default:throw new Error(`Invalid component type ${b}`)}}static GetFloatData(E,b,h,a,G,l,O,v){const s=b*V.GetTypeByteLength(h),U=O*b;if(h!==V.FLOAT||G!==s){const k=new Float32Array(U);return V.ForEach(E,a,G,b,h,U,l,((E,b)=>k[b]=E)),k}if(!(E instanceof Array||E instanceof Float32Array)||0!==a||E.length!==U){if(E instanceof Array){const b=a/4;return E.slice(b,b+U)}if(E instanceof ArrayBuffer)return new Float32Array(E,a,U);{const b=E.byteOffset+a;if(0!==(3&b)&&(k.c.Warn("Float array must be aligned to 4-bytes border"),v=!0),v){const h=new Uint8Array(U*Float32Array.BYTES_PER_ELEMENT),a=new Uint8Array(E.buffer,b,h.length);return h.set(a),new Float32Array(h.buffer)}return new Float32Array(E.buffer,b,U)}}return v?E.slice():E}}V._Counter=0,V.BYTE=5120,V.UNSIGNED_BYTE=5121,V.SHORT=5122,V.UNSIGNED_SHORT=5123,V.INT=5124,V.UNSIGNED_INT=5125,V.FLOAT=5126,V.PositionKind="position",V.NormalKind="normal",V.TangentKind="tangent",V.UVKind="uv",V.UV2Kind="uv2",V.UV3Kind="uv3",V.UV4Kind="uv4",V.UV5Kind="uv5",V.UV6Kind="uv6",V.ColorKind="color",V.ColorInstanceKind="instanceColor",V.MatricesIndicesKind="matricesIndices",V.MatricesWeightsKind="matricesWeights",V.MatricesIndicesExtraKind="matricesIndicesExtra",V.MatricesWeightsExtraKind="matricesWeightsExtra"},11240:(E,b,h)=>{"use strict";h.d(b,{d:()=>a});class a{get underlyingResource(){return null}constructor(){this.references=0,this.mb=0,this.is32Bits=!1,this.uniqueId=a._Counter++}}a._Counter=0},12561:(E,b,h)=>{"use strict";h.d(b,{c:()=>N});var a=h(11130),k=h(11139),G=h(10824),V=h(11175),l=h(11429),O=h(11419),v=h(11261),s=h(10846),U=h(11177);class B{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(E){this._zoomStopsAnimation=E}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(E){this._idleRotationSpeed=E}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(E){this._idleRotationWaitTime=E}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(E){this._idleRotationSpinupTime=E}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(E){this._attachedCamera=E;const b=this._attachedCamera.va();this._onPrePointerObservableObserver=b.onPrePointerObservable.add((E=>{E.type!==v.d.POINTERDOWN?E.type===v.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=E.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const E=s.c.Now;let b=0;null!=this._lastFrameTime&&(b=E-this._lastFrameTime),this._lastFrameTime=E,this._applyUserInteraction();const h=E-this._lastInteractionTime-this._idleRotationWaitTime,a=Math.max(Math.min(h/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*a,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(b/1e3))}))}detach(){if(!this._attachedCamera)return;const E=this._attachedCamera.va();this._onPrePointerObservableObserver&&E.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(E){this._lastInteractionTime=E??s.c.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<U.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let E=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(E=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?E:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=s.c.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}h(11673);class o{constructor(){this._easingMode=o.EASINGMODE_EASEIN}setEasingMode(E){const b=Math.min(Math.max(E,0),2);this._easingMode=b}getEasingMode(){return this._easingMode}easeInCore(E){throw new Error("You must implement this method")}ease(E){switch(this._easingMode){case o.EASINGMODE_EASEIN:return this.easeInCore(E);case o.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-E)}return E>=.5?.5*(1-this.easeInCore(2*(1-E)))+.5:.5*this.easeInCore(2*E)}}o.EASINGMODE_EASEIN=0,o.EASINGMODE_EASEOUT=1,o.EASINGMODE_EASEINOUT=2;var u=h(12145);class D{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(E){if(this._autoTransitionRange===E)return;this._autoTransitionRange=E;const b=this._attachedCamera;b&&(E?this._onMeshTargetChangedObserver=b.onMeshTargetChangedObservable.add((E=>{if(E&&(E.Wj(!0),E.getBoundingInfo)){const b=E.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*b,this.upperRadiusTransitionRange=.05*b}})):this._onMeshTargetChangedObserver&&b.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(E){this._attachedCamera=E,this._onAfterCheckInputsObserver=E.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(E){return!!this._attachedCamera&&(this._attachedCamera.radius===E&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(E){if(!this._attachedCamera)return;this._radiusBounceTransition||(D.EasingFunction.setEasingMode(D.EasingMode),this._radiusBounceTransition=u.c.CreateAnimation("radius",u.c.ANIMATIONTYPE_FLOAT,60,D.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const b=u.c.TransitionTo("radius",this._attachedCamera.radius+E,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));b&&this._animatables.push(b)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}D.EasingFunction=new class extends o{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=E}easeInCore(E){const b=Math.max(0,this.amplitude);return Math.pow(E,3)-E*b*Math.sin(3.141592653589793*E)}}(.3),D.EasingMode=o.EASINGMODE_EASEOUT;class g{constructor(){this.onTargetFramingAnimationEndObservable=new G.e,this._mode=g.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(E){this._mode=E}get mode(){return this._mode}set radiusScale(E){this._radiusScale=E}get radiusScale(){return this._radiusScale}set positionScale(E){this._positionScale=E}get positionScale(){return this._positionScale}set defaultElevation(E){this._defaultElevation=E}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(E){this._elevationReturnTime=E}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(E){this._elevationReturnWaitTime=E}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(E){this._zoomStopsAnimation=E}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(E){this._framingTime=E}get framingTime(){return this._framingTime}init(){}attach(E){this._attachedCamera=E;const b=this._attachedCamera.va();g.EasingFunction.setEasingMode(g.EasingMode),this._onPrePointerObservableObserver=b.onPrePointerObservable.add((E=>{E.type!==v.d.POINTERDOWN?E.type===v.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=E.onMeshTargetChangedObservable.add((E=>{E&&E.getBoundingInfo&&this.zoomOnMesh(E,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=E.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const E=this._attachedCamera.va();this._onPrePointerObservableObserver&&E.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;E.Wj(!0);const a=E.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(a.minimumWorld,a.maximumWorld,b,h)}zoomOnMeshHierarchy(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;E.Wj(!0);const a=E.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(a.min,a.max,b,h)}zoomOnMeshesHierarchy(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=new V.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),k=new V.k(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let G=0;G<E.length;G++){const b=E[G].getHierarchyBoundingVectors(!0);V.k.CheckExtends(b.min,a,k),V.k.CheckExtends(b.max,a,k)}this.zoomOnBoundingInfo(a,k,b,h)}zoomOnBoundingInfo(E,b){let h,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const G=E.y,l=G+(b.y-G)*this._positionScale,O=b.Xc(E).scale(.5);if(a)h=new V.k(0,l,0);else{const b=E.add(O);h=new V.k(b.x,l,b.z)}this._vectorTransition||(this._vectorTransition=u.c.CreateAnimation("target",u.c.ANIMATIONTYPE_VECTOR3,60,g.EasingFunction)),this._betaIsAnimating=!0;let v=u.c.TransitionTo("target",h,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);v&&this._animatables.push(v);let s=0;if(this._mode===g.FitFrustumSidesMode){const h=this._calculateLowerRadiusFromModelBoundingSphere(E,b);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=O.length()+this._attachedCamera.cj),s=h}else this._mode===g.IgnoreBoundsSizeMode&&(s=this._calculateLowerRadiusFromModelBoundingSphere(E,b),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.cj));if(this.autoCorrectCameraLimitsAndSensibility){const h=b.Xc(E).length();this._attachedCamera.panningSensibility=5e3/h,this._attachedCamera.wheelPrecision=100/s}return this._radiusTransition||(this._radiusTransition=u.c.CreateAnimation("radius",u.c.ANIMATIONTYPE_FLOAT,60,g.EasingFunction)),v=u.c.TransitionTo("radius",s,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),k&&k(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),v&&this._animatables.push(v),!0}_calculateLowerRadiusFromModelBoundingSphere(E,b){const h=this._attachedCamera;if(!h)return 0;let a=h._calculateLowerRadiusFromModelBoundingSphere(E,b,this._radiusScale);return h.lowerRadiusLimit&&this._mode===g.IgnoreBoundsSizeMode&&(a=a<h.lowerRadiusLimit?h.lowerRadiusLimit:a),h.upperRadiusLimit&&(a=a>h.upperRadiusLimit?h.upperRadiusLimit:a),a}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const E=s.c.Now-this._lastInteractionTime,b=.5*Math.PI-this._defaultElevation,h=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>h&&E>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=u.c.CreateAnimation("beta",u.c.ANIMATIONTYPE_FLOAT,60,g.EasingFunction));const E=u.c.TransitionTo("beta",b,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));E&&this._animatables.push(E)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=s.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}g.EasingFunction=new class extends o{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=E}easeInCore(E){return this.exponent<=0?E:(Math.exp(this.exponent*E)-1)/(Math.exp(this.exponent)-1)}},g.EasingMode=o.EASINGMODE_EASEINOUT,g.IgnoreBoundsSizeMode=0,g.FitFrustumSidesMode=1;var S=h(11426),M=h(12127),I=h(12134),j=h(10821);class P{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(E){E=j.g.BackCompatCameraNoPreventDefault(arguments);const b=this.camera.getEngine(),h=b.getInputElement();let a=0,k=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=G=>{var V,l;const O=G.event,s="touch"===O.pointerType;if(G.type!==v.d.POINTERMOVE&&-1===this.buttons.indexOf(O.button))return;const U=O.target;if(this._altKey=O.altKey,this._ctrlKey=O.ctrlKey,this._metaKey=O.metaKey,this._shiftKey=O.shiftKey,this._buttonsPressed=O.buttons,b.isPointerLock){const E=O.movementX,b=O.movementY;this.onTouch(null,E,b),this._pointA=null,this._pointB=null}else{if(G.type!==v.d.POINTERDOWN&&G.type!==v.d.POINTERDOUBLETAP&&s&&(null===(V=this._pointA)||void 0===V?void 0:V.pointerId)!==O.pointerId&&(null===(l=this._pointB)||void 0===l?void 0:l.pointerId)!==O.pointerId)return;if(G.type!==v.d.POINTERDOWN||-1!==this._currentActiveButton&&!s)if(G.type===v.d.POINTERDOUBLETAP)this.onDoubleTap(O.pointerType);else if(G.type!==v.d.POINTERUP||this._currentActiveButton!==O.button&&!s){if(G.type===v.d.POINTERMOVE)if(E||O.preventDefault(),this._pointA&&null===this._pointB){const E=O.clientX-this._pointA.x,b=O.clientY-this._pointA.y;this._pointA.x=O.clientX,this._pointA.y=O.clientY,this.onTouch(this._pointA,E,b)}else if(this._pointA&&this._pointB){const E=this._pointA.pointerId===O.pointerId?this._pointA:this._pointB;E.x=O.clientX,E.y=O.clientY;const b=this._pointA.x-this._pointB.x,h=this._pointA.y-this._pointB.y,V=b*b+h*h,l={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:O.pointerId,type:G.type};this.onMultiTouch(this._pointA,this._pointB,a,V,k,l),k=l,a=V}}else{try{null===U||void 0===U||U.releasePointerCapture(O.pointerId)}catch(B){}s||(this._pointB=null),b._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==O.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==O.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==a||k)&&(this.onMultiTouch(this._pointA,this._pointB,a,0,k,null),a=0,k=null),this._currentActiveButton=-1,this.onButtonUp(O),E||O.preventDefault()}else{try{null===U||void 0===U||U.setPointerCapture(O.pointerId)}catch(B){}if(null===this._pointA)this._pointA={x:O.clientX,y:O.clientY,pointerId:O.pointerId,type:O.pointerType};else{if(null!==this._pointB)return;this._pointB={x:O.clientX,y:O.clientY,pointerId:O.pointerId,type:O.pointerType}}-1!==this._currentActiveButton||s||(this._currentActiveButton=O.button),this.onButtonDown(O),E||(O.preventDefault(),h&&h.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,v.d.POINTERDOWN|v.d.POINTERUP|v.d.POINTERMOVE|v.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,a=0,k=null,this.onLostFocus()},this._contextMenuBind=E=>this.onContextMenu(E),h&&h.addEventListener("contextmenu",this._contextMenuBind,!1);const G=this.camera.va().getEngine().getHostWindow();G&&j.g.RegisterTopRootEvents(G,[{name:"blur",handler:this._onLostFocus}])}$i(){if(this._onLostFocus){const E=this.camera.va().getEngine().getHostWindow();E&&j.g.UnregisterTopRootEvents(E,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const E=this.camera.va().getEngine().getInputElement();E&&E.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(E){}onTouch(E,b,h){}onMultiTouch(E,b,h,a,k,G){}onContextMenu(E){E.preventDefault()}onButtonDown(E){}onButtonUp(E){}onLostFocus(){}}(0,a.d)([(0,k.H)()],P.prototype,"buttons",void 0);class A extends P{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(E,b){if(0!==this.panningSensibility&&E&&b){const h=b.x-E.x,a=b.y-E.y;this.camera.inertialPanningX+=-h/this.panningSensibility,this.camera.inertialPanningY+=a/this.panningSensibility}}_computePinchZoom(E,b){const h=this.camera.radius||A.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=h*Math.sqrt(E)/Math.sqrt(b):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(b-E)*h*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(b-E)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(E,b,h){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-b/this.panningSensibility,this.camera.inertialPanningY+=h/this.panningSensibility):(this.camera.inertialAlphaOffset-=b/this.angularSensibilityX,this.camera.inertialBetaOffset-=h/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(E,b,h,a,k,G){0===h&&null===k||0===a&&null===G||(this.multiTouchPanAndZoom?(this._computePinchZoom(h,a),this._computeMultiTouchPanning(k,G)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(a)-Math.sqrt(h))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(h,a),this._isPinching=!0):this._computeMultiTouchPanning(k,G)):this.multiTouchPanning?this._computeMultiTouchPanning(k,G):this.pinchZoom&&this._computePinchZoom(h,a))}onButtonDown(E){this._isPanClick=E.button===this.camera._panningMouseButton}onButtonUp(E){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}A.MinimumRadiusForPinch=.001,(0,a.d)([(0,k.H)()],A.prototype,"buttons",void 0),(0,a.d)([(0,k.H)()],A.prototype,"angularSensibilityX",void 0),(0,a.d)([(0,k.H)()],A.prototype,"angularSensibilityY",void 0),(0,a.d)([(0,k.H)()],A.prototype,"pinchPrecision",void 0),(0,a.d)([(0,k.H)()],A.prototype,"pinchDeltaPercentage",void 0),(0,a.d)([(0,k.H)()],A.prototype,"useNaturalPinchZoom",void 0),(0,a.d)([(0,k.H)()],A.prototype,"pinchZoom",void 0),(0,a.d)([(0,k.H)()],A.prototype,"panningSensibility",void 0),(0,a.d)([(0,k.H)()],A.prototype,"multiTouchPanning",void 0),(0,a.d)([(0,k.H)()],A.prototype,"multiTouchPanAndZoom",void 0),I.d.ArcRotateCameraPointersInput=A;var n=h(11268);class d{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(E){E=j.g.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((b=>{const h=b.event;if(!h.metaKey)if(b.type===n.d.KEYDOWN){if(this._ctrlPressed=h.ctrlKey,this._altPressed=h.altKey,-1!==this.keysUp.indexOf(h.keyCode)||-1!==this.keysDown.indexOf(h.keyCode)||-1!==this.keysLeft.indexOf(h.keyCode)||-1!==this.keysRight.indexOf(h.keyCode)||-1!==this.keysReset.indexOf(h.keyCode)){-1===this._keys.indexOf(h.keyCode)&&this._keys.push(h.keyCode),h.preventDefault&&(E||h.preventDefault())}}else if(-1!==this.keysUp.indexOf(h.keyCode)||-1!==this.keysDown.indexOf(h.keyCode)||-1!==this.keysLeft.indexOf(h.keyCode)||-1!==this.keysRight.indexOf(h.keyCode)||-1!==this.keysReset.indexOf(h.keyCode)){const b=this._keys.indexOf(h.keyCode);b>=0&&this._keys.splice(b,1),h.preventDefault&&(E||h.preventDefault())}})))}$i(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const E=this.camera;for(let b=0;b<this._keys.length;b++){const h=this._keys[b];-1!==this.keysLeft.indexOf(h)?this._ctrlPressed&&this.camera._useCtrlForPanning?E.inertialPanningX-=1/this.panningSensibility:E.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(h)?this._ctrlPressed&&this.camera._useCtrlForPanning?E.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?E.inertialRadiusOffset+=1/this.zoomingSensibility:E.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(h)?this._ctrlPressed&&this.camera._useCtrlForPanning?E.inertialPanningX+=1/this.panningSensibility:E.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(h)?this._ctrlPressed&&this.camera._useCtrlForPanning?E.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?E.inertialRadiusOffset-=1/this.zoomingSensibility:E.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(h)&&E.useInputToRestoreState&&E.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,a.d)([(0,k.H)()],d.prototype,"keysUp",void 0),(0,a.d)([(0,k.H)()],d.prototype,"keysDown",void 0),(0,a.d)([(0,k.H)()],d.prototype,"keysLeft",void 0),(0,a.d)([(0,k.H)()],d.prototype,"keysRight",void 0),(0,a.d)([(0,k.H)()],d.prototype,"keysReset",void 0),(0,a.d)([(0,k.H)()],d.prototype,"panningSensibility",void 0),(0,a.d)([(0,k.H)()],d.prototype,"zoomingSensibility",void 0),(0,a.d)([(0,k.H)()],d.prototype,"useAltToZoom",void 0),(0,a.d)([(0,k.H)()],d.prototype,"angularSpeed",void 0),I.d.ArcRotateCameraKeyboardMoveInput=d;var c=h(11284),z=h(11270),Z=h(11186);class Y{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new V.k(0,0,0),this._globalOffset=new V.k(0,0,0),this._inertialPanning=V.k.Zero()}_computeDeltaFromMouseWheelLegacyEvent(E,b){let h=0;const a=.01*E*this.wheelDeltaPercentage*b;return h=E>0?a/(1+this.wheelDeltaPercentage):a*(1+this.wheelDeltaPercentage),h}attachControl(E){E=j.g.BackCompatCameraNoPreventDefault(arguments),this._wheel=b=>{if(b.type!==v.d.POINTERWHEEL)return;const h=b.event;let a=0;const k=h.deltaMode===z.e.DOM_DELTA_LINE?40:1,G=-h.deltaY*k;if(this.customComputeDeltaFromMouseWheel)a=this.customComputeDeltaFromMouseWheel(G,this,h);else if(this.wheelDeltaPercentage){if(a=this._computeDeltaFromMouseWheelLegacyEvent(G,this.camera.radius),a>0){let E=this.camera.radius,b=this.camera.inertialRadiusOffset+a;for(let h=0;h<20&&Math.abs(b)>.001;h++)E-=b,b*=this.camera.inertia;E=(0,Z.b)(E,0,Number.MAX_VALUE),a=this._computeDeltaFromMouseWheelLegacyEvent(G,E)}}else a=G/(40*this.wheelPrecision);a&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(a)):this.camera.inertialRadiusOffset+=a),h.preventDefault&&(E||h.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,v.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.te(0)}$i(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const E=this.camera;0+E.inertialAlphaOffset+E.inertialBetaOffset+E.inertialRadiusOffset&&(this._updateHitPlane(),E.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(E.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const E=this.camera,b=E.target.Xc(E.position);this._hitPlane=c.c.FromPositionAndNormal(E.target,b)}_getPosition(){const E=this.camera,b=E.va(),h=b.createPickingRay(b.pointerX,b.pointerY,V.d.Identity(),E,!1);0===E.targetScreenOffset.x&&0===E.targetScreenOffset.y||(this._viewOffset.set(E.targetScreenOffset.x,E.targetScreenOffset.y,0),E.getViewMatrix().invertToRef(E._cameraTransformMatrix),this._globalOffset=V.k.TransformNormal(this._viewOffset,E._cameraTransformMatrix),h.origin.addInPlace(this._globalOffset));let a=0;return this._hitPlane&&(a=h.intersectsPlane(this._hitPlane)??0),h.origin.addInPlace(h.direction.scaleInPlace(a))}_zoomToMouse(E){const b=this.camera,h=1-b.inertia;if(b.lowerRadiusLimit){const a=b.lowerRadiusLimit??0;b.radius-(b.inertialRadiusOffset+E)/h<a&&(E=(b.radius-a)*h-b.inertialRadiusOffset)}if(b.upperRadiusLimit){const a=b.upperRadiusLimit??0;b.radius-(b.inertialRadiusOffset+E)/h>a&&(E=(b.radius-a)*h-b.inertialRadiusOffset)}const a=E/h/b.radius,k=this._getPosition(),G=V.h.o[6];k.subtractToRef(b.target,G),G.scaleInPlace(a),G.scaleInPlace(h),this._inertialPanning.addInPlace(G),b.inertialRadiusOffset+=E}_zeroIfClose(E){Math.abs(E.x)<U.d&&(E.x=0),Math.abs(E.y)<U.d&&(E.y=0),Math.abs(E.z)<U.d&&(E.z=0)}}(0,a.d)([(0,k.H)()],Y.prototype,"wheelPrecision",void 0),(0,a.d)([(0,k.H)()],Y.prototype,"zoomToMouseLocation",void 0),(0,a.d)([(0,k.H)()],Y.prototype,"wheelDeltaPercentage",void 0),I.d.ArcRotateCameraMouseWheelInput=Y;class r extends I.f{constructor(E){super(E)}addMouseWheel(){return this.add(new Y),this}addPointers(){return this.add(new A),this}addKeyboard(){return this.add(new d),this}}var w=h(10958);l.d.AddNodeConstructor("ArcRotateCamera",((E,b)=>()=>new N(E,0,0,1,V.k.Zero(),b)));class N extends M.d{get target(){return this._target}set target(E){this.setTarget(E)}get targetHost(){return this._targetHost}set targetHost(E){E&&this.setTarget(E)}getTarget(){return this.target}get position(){return this._position}set position(E){this.setPosition(E)}set upVector(E){this._upToYMatrix||(this._yToUpMatrix=new V.d,this._upToYMatrix=new V.d,this._upVector=V.k.Zero()),E.normalize(),this._upVector.p(E),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){V.d.RotationAlignToRef(V.k.UpReadOnly,this._upVector,this._yToUpMatrix),V.d.RotationAlignToRef(this._upVector,V.k.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const E=this.inputs.attached.pointers;return E?E.angularSensibilityX:0}set angularSensibilityX(E){const b=this.inputs.attached.pointers;b&&(b.angularSensibilityX=E)}get angularSensibilityY(){const E=this.inputs.attached.pointers;return E?E.angularSensibilityY:0}set angularSensibilityY(E){const b=this.inputs.attached.pointers;b&&(b.angularSensibilityY=E)}get pinchPrecision(){const E=this.inputs.attached.pointers;return E?E.pinchPrecision:0}set pinchPrecision(E){const b=this.inputs.attached.pointers;b&&(b.pinchPrecision=E)}get pinchDeltaPercentage(){const E=this.inputs.attached.pointers;return E?E.pinchDeltaPercentage:0}set pinchDeltaPercentage(E){const b=this.inputs.attached.pointers;b&&(b.pinchDeltaPercentage=E)}get useNaturalPinchZoom(){const E=this.inputs.attached.pointers;return!!E&&E.useNaturalPinchZoom}set useNaturalPinchZoom(E){const b=this.inputs.attached.pointers;b&&(b.useNaturalPinchZoom=E)}get panningSensibility(){const E=this.inputs.attached.pointers;return E?E.panningSensibility:0}set panningSensibility(E){const b=this.inputs.attached.pointers;b&&(b.panningSensibility=E)}get keysUp(){const E=this.inputs.attached.keyboard;return E?E.keysUp:[]}set keysUp(E){const b=this.inputs.attached.keyboard;b&&(b.keysUp=E)}get keysDown(){const E=this.inputs.attached.keyboard;return E?E.keysDown:[]}set keysDown(E){const b=this.inputs.attached.keyboard;b&&(b.keysDown=E)}get keysLeft(){const E=this.inputs.attached.keyboard;return E?E.keysLeft:[]}set keysLeft(E){const b=this.inputs.attached.keyboard;b&&(b.keysLeft=E)}get keysRight(){const E=this.inputs.attached.keyboard;return E?E.keysRight:[]}set keysRight(E){const b=this.inputs.attached.keyboard;b&&(b.keysRight=E)}get wheelPrecision(){const E=this.inputs.attached.mousewheel;return E?E.wheelPrecision:0}set wheelPrecision(E){const b=this.inputs.attached.mousewheel;b&&(b.wheelPrecision=E)}get zoomToMouseLocation(){const E=this.inputs.attached.mousewheel;return!!E&&E.zoomToMouseLocation}set zoomToMouseLocation(E){const b=this.inputs.attached.mousewheel;b&&(b.zoomToMouseLocation=E)}get wheelDeltaPercentage(){const E=this.inputs.attached.mousewheel;return E?E.wheelDeltaPercentage:0}set wheelDeltaPercentage(E){const b=this.inputs.attached.mousewheel;b&&(b.wheelDeltaPercentage=E)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(E){E!==this.useBouncingBehavior&&(E?(this._bouncingBehavior=new D,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(E){E!==this.useFramingBehavior&&(E?(this._framingBehavior=new g,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(E){E!==this.useAutoRotationBehavior&&(E?(this._autoRotationBehavior=new B,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(E,b,h,a,k,l){var O;let v=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(E,V.k.Zero(),l,v),O=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=V.k.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=V.j.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._viewMatrix=new V.d,this.panningAxis=new V.k(1,1,0),this._transformedDirection=new V.k,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new G.e,this.checkCollisions=!1,this.collisionRadius=new V.k(.5,.5,.5),this._previousPosition=V.k.Zero(),this._collisionVelocity=V.k.Zero(),this._newPosition=V.k.Zero(),this._computationVector=V.k.Zero(),this._onCollisionPositionChange=function(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;h?(O.setPosition(b),O.Qk&&O.Qk(h)):O._previousPosition.p(O._position);const a=Math.cos(O.alpha),k=Math.sin(O.alpha),G=Math.cos(O.beta);let V=Math.sin(O.beta);0===V&&(V=1e-4);const l=O._getTargetPosition();O._computationVector.ue(O.radius*a*V,O.radius*G,O.radius*k*V),l.addToRef(O._computationVector,O._newPosition),O._position.p(O._newPosition);let v=O.upVector;O.allowUpsideDown&&O.beta<0&&(v=v.clone(),v=v.negate()),O._computeViewMatrix(O._position,l,v),O._viewMatrix.addAtIndex(12,O.targetScreenOffset.x),O._viewMatrix.addAtIndex(13,O.targetScreenOffset.y),O._collisionTriggered=!1},this._target=V.k.Zero(),k&&this.setTarget(k),this.alpha=b,this.beta=h,this.radius=a,this.getViewMatrix(),this.inputs=new r(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new V.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=V.j.Zero()}_updateCache(E){E||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const E=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?E.addToRef(this._targetBoundingCenter,this._target):this._target.p(E)}const E=this._getLockedTargetPosition();return E||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>U.d&&this.restoreStateInterpolationFactor<1?(this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(E,b){let h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const k=arguments;b=j.g.BackCompatCameraNoPreventDefault(k),this._useCtrlForPanning=h,this._panningMouseButton=a,"boolean"===typeof k[0]&&(k.length>1&&(this._useCtrlForPanning=k[1]),k.length>2&&(this._panningMouseButton=k[2])),this.inputs.attachElement(b),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}$i(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const E=this._scene.getEngine().getDeltaTime()/1e3,b=1-Math.pow(2,-E/this.restoreStateInterpolationFactor);this.setTarget(V.k.Lerp(this.getTarget(),this._storedTarget,b)),V.g.RotationAlphaBetaGammaToRef(this._storedAlpha,this._storedBeta,0,V.h.Quaternion[0]),V.g.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,V.h.Quaternion[1]),V.g.SlerpToRef(V.h.Quaternion[1],V.h.Quaternion[0],b,V.h.Quaternion[2]),V.h.Quaternion[2].normalize(),V.h.Quaternion[2].toAlphaBetaGammaToRef(V.h.o[0]),this.alpha=V.h.o[0].x,this.beta=V.h.o[0].y,this.radius+=(this._storedRadius-this.radius)*b,V.j.LerpToRef(this.targetScreenOffset,this._storedTargetScreenOffset,b,this.targetScreenOffset),(V.k.DistanceSquared(this.getTarget(),this._storedTarget)<U.d&&V.h.Quaternion[2].equalsWithEpsilon(V.h.Quaternion[0])&&Math.pow(this._storedRadius-this.radius,2)<U.d&&V.j.Distance(this.targetScreenOffset,this._storedTargetScreenOffset)<U.d||0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset||0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._progressiveRestore=!1)}if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const E=this.invertRotation?-1:1,b=this._calculateHandednessMultiplier();let h=this.inertialAlphaOffset*b;this.beta<0&&(h*=-1),this.alpha+=h*E,this.beta+=this.inertialBetaOffset*E,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<U.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<U.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*U.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const E=new V.k(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),E.multiplyInPlace(this.panningAxis),V.k.TransformNormalToRef(E,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const E=this.upVector,b=V.k.CrossToRef(this._transformedDirection,E,this._transformedDirection);V.k.CrossToRef(E,b,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);V.k.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const E=V.h.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(E),E.transposeToRef(E),V.k.TransformCoordinatesToRef(this._transformedDirection,E,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*U.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*U.d&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||V.k.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const E=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const b=Math.round((E-this.alpha)/(2*Math.PI));this.alpha+=2*b*Math.PI,this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()}setPosition(E){this._position.equals(E)||(this._position.p(E),this.rebuildAnglesAndRadius())}setTarget(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(a=this.overrideCloneAlphaBetaRadius??a,E.Wj)b&&E.getBoundingInfo?this._targetBoundingCenter=E.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,E.Wj(),this._targetHost=E,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const b=E,a=this._getTargetPosition();if(a&&!h&&a.equals(b))return;this._targetHost=null,this._target=b,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}a||this.rebuildAnglesAndRadius()}_getViewMatrix(){const E=Math.cos(this.alpha),b=Math.sin(this.alpha),h=Math.cos(this.beta);let a=Math.sin(this.beta);0===a&&(a=1e-4),0===this.radius&&(this.radius=1e-4);const k=this._getTargetPosition();if(this._computationVector.ue(this.radius*E*a,this.radius*h,this.radius*b*a),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||V.k.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),k.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const E=this.va().collisionCoordinator;this._collider||(this._collider=E.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,E.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let E=this.upVector;this.allowUpsideDown&&a<0&&(E=E.negate()),this._computeViewMatrix(this._position,k,E),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=k,this._viewMatrix}zoomOn(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];E=E||this.va().meshes;const h=O.b.MinMax(E);let a=this._calculateLowerRadiusFromModelBoundingSphere(h.min,h.max);a=Math.max(Math.min(a,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=a*this.zoomOnFactor,this.focusOn({min:h.min,max:h.max,distance:a},b)}focusOn(E){let b,h,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===E.min){const a=E||this.va().meshes;b=O.b.MinMax(a),h=V.k.Distance(b.min,b.max)}else{b=E,h=E.distance}this._target=O.b.Center(b),a||(this.maxZ=2*h)}createRigCamera(E,b){let h=0;switch(this.cameraRigMode){case S.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case S.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case S.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case S.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case S.b.RIG_MODE_VR:h=this._cameraRigParams.stereoHalfAngle*(0===b?1:-1);break;case S.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:h=this._cameraRigParams.stereoHalfAngle*(0===b?-1:1)}const a=new N(E,this.alpha+h,this.beta,this.radius,this._target,this.va());return a._cameraRigParams={},a.isRigCamera=!0,a.rigParent=this,a.upVector=this.upVector,a.mode=this.mode,a.orthoLeft=this.orthoLeft,a.orthoRight=this.orthoRight,a.orthoBottom=this.orthoBottom,a.orthoTop=this.orthoTop,a}_updateRigCameras(){const E=this._rigCameras[0],b=this._rigCameras[1];switch(E.beta=b.beta=this.beta,this.cameraRigMode){case S.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case S.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case S.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case S.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case S.b.RIG_MODE_VR:E.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,b.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case S.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:E.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,b.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const a=V.k.Distance(E,b),k=this.va().getEngine().getAspectRatio(this),G=Math.tan(this.fov/2),l=G*k,O=.5*a*h,v=O*Math.sqrt(1+1/(l*l)),s=O*Math.sqrt(1+1/(G*G));return Math.max(v,s)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,a.d)([(0,k.H)()],N.prototype,"alpha",void 0),(0,a.d)([(0,k.H)()],N.prototype,"beta",void 0),(0,a.d)([(0,k.H)()],N.prototype,"radius",void 0),(0,a.d)([(0,k.H)()],N.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,a.d)([(0,k.G)("target")],N.prototype,"_target",void 0),(0,a.d)([(0,k.v)("targetHost")],N.prototype,"_targetHost",void 0),(0,a.d)([(0,k.H)()],N.prototype,"inertialAlphaOffset",void 0),(0,a.d)([(0,k.H)()],N.prototype,"inertialBetaOffset",void 0),(0,a.d)([(0,k.H)()],N.prototype,"inertialRadiusOffset",void 0),(0,a.d)([(0,k.H)()],N.prototype,"lowerAlphaLimit",void 0),(0,a.d)([(0,k.H)()],N.prototype,"upperAlphaLimit",void 0),(0,a.d)([(0,k.H)()],N.prototype,"lowerBetaLimit",void 0),(0,a.d)([(0,k.H)()],N.prototype,"upperBetaLimit",void 0),(0,a.d)([(0,k.H)()],N.prototype,"lowerRadiusLimit",void 0),(0,a.d)([(0,k.H)()],N.prototype,"upperRadiusLimit",void 0),(0,a.d)([(0,k.H)()],N.prototype,"inertialPanningX",void 0),(0,a.d)([(0,k.H)()],N.prototype,"inertialPanningY",void 0),(0,a.d)([(0,k.H)()],N.prototype,"pinchToPanMaxDistance",void 0),(0,a.d)([(0,k.H)()],N.prototype,"panningDistanceLimit",void 0),(0,a.d)([(0,k.G)()],N.prototype,"panningOriginTarget",void 0),(0,a.d)([(0,k.H)()],N.prototype,"panningInertia",void 0),(0,a.d)([(0,k.H)()],N.prototype,"zoomToMouseLocation",null),(0,a.d)([(0,k.H)()],N.prototype,"zoomOnFactor",void 0),(0,a.d)([(0,k.F)()],N.prototype,"targetScreenOffset",void 0),(0,a.d)([(0,k.H)()],N.prototype,"allowUpsideDown",void 0),(0,a.d)([(0,k.H)()],N.prototype,"useInputToRestoreState",void 0),(0,a.d)([(0,k.H)()],N.prototype,"restoreStateInterpolationFactor",void 0),(0,w.f)("BABYLON.ArcRotateCamera",N)},11426:(E,b,h)=>{"use strict";h.d(b,{b:()=>g});var a=h(11130),k=h(11139),G=h(11155),V=h(10821),l=h(10824),O=h(11175),v=h(11429),s=h(10834),U=h(10958),B=h(10855),o=h(11432),u=h(11282),D=h(11206);class g extends v.d{get position(){return this._position}set position(E){this._position=E}set upVector(E){this._upVector=E}get upVector(){return this._upVector}get screenArea(){let E=0,b=0;if(this.mode===g.PERSPECTIVE_CAMERA)this.fovMode===g.FOVMODE_VERTICAL_FIXED?(b=2*this.cj*Math.tan(this.fov/2),E=this.getEngine().getAspectRatio(this)*b):(E=2*this.cj*Math.tan(this.fov/2),b=E/this.getEngine().getAspectRatio(this));else{const h=this.getEngine().getRenderWidth()/2,a=this.getEngine().getRenderHeight()/2;E=(this.orthoRight??h)-(this.orthoLeft??-h),b=(this.orthoTop??a)-(this.orthoBottom??-a)}return E*b}set orthoLeft(E){this._orthoLeft=E;for(const b of this._rigCameras)b.orthoLeft=E}get orthoLeft(){return this._orthoLeft}set orthoRight(E){this._orthoRight=E;for(const b of this._rigCameras)b.orthoRight=E}get orthoRight(){return this._orthoRight}set orthoBottom(E){this._orthoBottom=E;for(const b of this._rigCameras)b.orthoBottom=E}get orthoBottom(){return this._orthoBottom}set orthoTop(E){this._orthoTop=E;for(const b of this._rigCameras)b.orthoTop=E}get orthoTop(){return this._orthoTop}set mode(E){this._mode=E;for(const b of this._rigCameras)b.mode=E}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(E,b,h){let a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(E,h,!1),this._position=O.k.Zero(),this._upVector=O.k.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.cj=1,this.maxZ=1e4,this.inertia=.9,this._mode=g.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new o.b(0,0,1,1),this.layerMask=268435455,this.fovMode=g.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=g.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new l.e,this.onProjectionMatrixChangedObservable=new l.e,this.onAfterCheckInputsObservable=new l.e,this.onRestoreStateObservable=new l.e,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new O.d,this._postProcesses=new Array,this._activeMeshes=new G.e(256),this._globalPosition=O.k.Zero(),this._computedViewMatrix=O.d.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=O.d.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=O.g.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.va().addCamera(this),a&&!this.va().activeCamera&&(this.va().activeCamera=this),this.position=b,this.renderPassId=this.va().getEngine().createRenderPassId(`Camera ${E}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"Jh"}toString(E){let b="Name: "+this.name;if(b+=", type: "+this.getClassName(),this.animations)for(let h=0;h<this.animations.length;h++)b+=", animation[0]: "+this.animations[h].toString(E);return b}applyVerticalCorrection(){const E=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-E.x:E.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(E){return-1!==this._activeMeshes.indexOf(E)}isReady(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(E)for(const b of this._postProcesses)if(b&&!b.isReady())return!1;return super.isReady(E)}_initCache(){super._initCache(),this._cache.position=new O.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new O.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.cj=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(E){E||super._updateCache(),this._cache.position.p(this.position),this._cache.upVector.p(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let E=this._cache.mode===this.mode&&this._cache.cj===this.cj&&this._cache.maxZ===this.maxZ;if(!E)return!1;const b=this.getEngine();return this.mode===g.PERSPECTIVE_CAMERA?E=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===b.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(E=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===b.getRenderWidth()&&this._cache.renderHeight===b.getRenderHeight(),this.oblique&&(E=E&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),E}attachControl(E,b){}$i(E){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==g.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let E=0;E<this._postProcesses.length;E++)if(null!==this._postProcesses[E])return this._postProcesses[E];return null}_cascadePostProcessesToRigCams(){const E=this._getFirstPostProcess();E&&E.markTextureDirty();for(let b=0,h=this._rigCameras.length;b<h;b++){const E=this._rigCameras[b],h=E._rigPostProcess;if(h){"pass"===h.getEffectName()&&(E.isIntermediate=0===this._postProcesses.length),E._postProcesses=this._postProcesses.slice(0).concat(h),h.markTextureDirty()}else E._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!E.isReusable()&&this._postProcesses.indexOf(E)>-1?(s.c.Error("You're trying to reuse a post process not defined as reusable."),0):(null==b||b<0?this._postProcesses.push(E):null===this._postProcesses[b]?this._postProcesses[b]=E:this._postProcesses.splice(b,0,E),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.ah(),this._postProcesses.indexOf(E))}detachPostProcess(E){const b=this._postProcesses.indexOf(E);-1!==b&&(this._postProcesses[b]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.ah(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return O.d.Identity()}getViewMatrix(E){return!E&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.va().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(E){this._doNotComputeProjectionMatrix=!0,void 0!==E&&(this._projectionMatrix=E)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(E){if(this._doNotComputeProjectionMatrix||!E&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.cj=this.cj,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const b=this.getEngine(),h=this.va(),a=b.useReverseDepthBuffer;if(this.mode===g.PERSPECTIVE_CAMERA){let E;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=b.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.cj<=0&&(this.cj=.1),E=h.useRightHandedSystem?O.d.PerspectiveFovRHToRef:O.d.PerspectiveFovLHToRef,E(this.fov,b.getAspectRatio(this),a?this.maxZ:this.cj,a?this.cj:this.maxZ,this._projectionMatrix,this.fovMode===g.FOVMODE_VERTICAL_FIXED,b.isNDCHalfZRange,this.projectionPlaneTilt,a)}else{var k,G,V;const E=b.getRenderWidth()/2,l=b.getRenderHeight()/2;h.useRightHandedSystem?this.oblique?O.d.ObliqueOffCenterRHToRef(this.orthoLeft??-E,this.orthoRight??E,this.orthoBottom??-l,this.orthoTop??l,a?this.maxZ:this.cj,a?this.cj:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,b.isNDCHalfZRange):O.d.OrthoOffCenterRHToRef(this.orthoLeft??-E,this.orthoRight??E,this.orthoBottom??-l,this.orthoTop??l,a?this.maxZ:this.cj,a?this.cj:this.maxZ,this._projectionMatrix,b.isNDCHalfZRange):this.oblique?O.d.ObliqueOffCenterLHToRef(this.orthoLeft??-E,this.orthoRight??E,this.orthoBottom??-l,this.orthoTop??l,a?this.maxZ:this.cj,a?this.cj:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,b.isNDCHalfZRange):O.d.OrthoOffCenterLHToRef(this.orthoLeft??-E,this.orthoRight??E,this.orthoBottom??-l,this.orthoTop??l,a?this.maxZ:this.cj,a?this.cj:this.maxZ,this._projectionMatrix,b.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(k=this.oblique)||void 0===k?void 0:k.angle,this._cache.obliqueLength=null===(G=this.oblique)||void 0===G?void 0:G.length,this._cache.obliqueOffset=null===(V=this.oblique)||void 0===V?void 0:V.offset,this._cache.renderWidth=b.getRenderWidth(),this._cache.renderHeight=b.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(E){return(this.radius||(this.target?O.k.Distance(this.position,this.target):this.position.length()))+E}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?u.c.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=u.c.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),b&&this.rigCameras.length>0){let b=!1;return this.rigCameras.forEach((h=>{h._updateFrustumPlanes(),b=b||E.isInFrustum(h._frustumPlanes)})),b}return E.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(E){return this._updateFrustumPlanes(),E.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,B.c)("Ray")}getForwardRayToRef(E){throw(0,B.c)("Ray")}dispose(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.va().stopAnimation(this),this.va().removeCamera(this);this._rigCameras.length>0;){const E=this._rigCameras.pop();E&&E.dispose()}if(this._parentContainer){const E=this._parentContainer.cameras.indexOf(this);E>-1&&this._parentContainer.cameras.splice(E,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==g.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let E=this._postProcesses.length;for(;--E>=0;){const b=this._postProcesses[E];b&&b.dispose(this)}}let h=this.customRenderTargets.length;for(;--h>=0;)this.customRenderTargets[h].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.va().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(E,b)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(E,b){if(this.cameraRigMode!==E){for(;this._rigCameras.length>0;){const E=this._rigCameras.pop();E&&E.dispose()}if(this.cameraRigMode=E,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=b.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=V.g.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==g.RIG_MODE_NONE){const E=this.createRigCamera(this.name+"_L",0);E&&(E._isLeftCamera=!0);const b=this.createRigCamera(this.name+"_R",1);b&&(b._isRightCamera=!0),E&&b&&(this._rigCameras.push(E),this._rigCameras.push(b))}this._setRigMode(b),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(E){}_getVRProjectionMatrix(){return O.d.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.cj,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(E,b){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[E]=b,"interaxialDistance"===E&&(this._cameraRigParams.stereoHalfAngle=V.g.ToRadians(b/.0637))}createRigCamera(E,b){return null}_updateRigCameras(){for(let E=0;E<this._rigCameras.length;E++)this._rigCameras[E].cj=this.cj,this._rigCameras[E].maxZ=this.maxZ,this._rigCameras[E].fov=this.fov,this._rigCameras[E].upVector.p(this.upVector);this.cameraRigMode===g.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const E=D.e.Serialize(this);return E.uniqueId=this.uniqueId,E.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(E),this.inputs&&this.inputs.serialize(E),D.e.AppendSerializedAnimations(this,E),E.ranges=this.serializeAnimationRanges(),E.isEnabled=this.isEnabled(),E}clone(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=D.e.Clone(g.GetConstructorFromName(this.getClassName(),E,this.va(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return h.name=E,h.parent=b,this.onClonedObservable.notifyObservers(h),h}hf(E){const b=O.k.Zero();return this.getDirectionToRef(E,b),b}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(E,b){O.k.TransformNormalToRef(E,this.getWorldMatrix(),b)}static GetConstructorFromName(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,k=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const G=v.d.Construct(E,b,h,{interaxial_distance:a,isStereoscopicSideBySide:k});return G||(()=>g._CreateDefaultParsedCamera(b,h))}Wj(){return this.getWorldMatrix()}static Parse(E,b){const h=E.type,a=g.GetConstructorFromName(h,E.name,b,E.interaxial_distance,E.isStereoscopicSideBySide),k=D.e.Parse(a,E,b);if(void 0!==E.parentId&&(k._waitingParentId=E.parentId),void 0!==E.parentInstanceIndex&&(k._waitingParentInstanceIndex=E.parentInstanceIndex),k.inputs&&(k.inputs.parse(E),k._setupInputs()),E.upVector&&(k.upVector=O.k.jh(E.upVector)),k.setPosition&&(k.position.ue(0,0,0),k.setPosition(O.k.jh(E.position))),E.target&&k.setTarget&&k.setTarget(O.k.jh(E.target)),E.cameraRigMode){const b=E.interaxial_distance?{interaxialDistance:E.interaxial_distance}:{};k.setCameraRigMode(E.cameraRigMode,b)}if(E.animations){for(let b=0;b<E.animations.length;b++){const h=E.animations[b],a=(0,U.d)("BABYLON.Animation");a&&k.animations.push(a.Parse(h))}v.d.ParseAnimationRanges(k,E,b)}return E.autoAnimate&&b.beginAnimation(k,E.autoAnimateFrom,E.autoAnimateTo,E.autoAnimateLoop,E.autoAnimateSpeed||1),void 0!==E.isEnabled&&k.Gb(E.isEnabled),k}_calculateHandednessMultiplier(){let E=this.va().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(E*=-1),E}}g._CreateDefaultParsedCamera=(E,b)=>{throw(0,B.c)("UniversalCamera")},g.PERSPECTIVE_CAMERA=0,g.ORTHOGRAPHIC_CAMERA=1,g.FOVMODE_VERTICAL_FIXED=0,g.FOVMODE_HORIZONTAL_FIXED=1,g.RIG_MODE_NONE=0,g.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,g.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,g.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,g.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,g.RIG_MODE_STEREOSCOPIC_INTERLACED=14,g.RIG_MODE_VR=20,g.RIG_MODE_CUSTOM=22,g.ForceAttachControlToAlwaysPreventDefault=!1,(0,a.d)([(0,k.G)("position")],g.prototype,"_position",void 0),(0,a.d)([(0,k.G)("upVector")],g.prototype,"_upVector",void 0),(0,a.d)([(0,k.H)()],g.prototype,"orthoLeft",null),(0,a.d)([(0,k.H)()],g.prototype,"orthoRight",null),(0,a.d)([(0,k.H)()],g.prototype,"orthoBottom",null),(0,a.d)([(0,k.H)()],g.prototype,"orthoTop",null),(0,a.d)([(0,k.H)()],g.prototype,"fov",void 0),(0,a.d)([(0,k.H)()],g.prototype,"projectionPlaneTilt",void 0),(0,a.d)([(0,k.H)()],g.prototype,"cj",void 0),(0,a.d)([(0,k.H)()],g.prototype,"maxZ",void 0),(0,a.d)([(0,k.H)()],g.prototype,"inertia",void 0),(0,a.d)([(0,k.H)()],g.prototype,"mode",null),(0,a.d)([(0,k.H)()],g.prototype,"layerMask",void 0),(0,a.d)([(0,k.H)()],g.prototype,"fovMode",void 0),(0,a.d)([(0,k.H)()],g.prototype,"cameraRigMode",void 0),(0,a.d)([(0,k.H)()],g.prototype,"interaxialDistance",void 0),(0,a.d)([(0,k.H)()],g.prototype,"isStereoscopicSideBySide",void 0)},12134:(E,b,h)=>{"use strict";h.d(b,{d:()=>V,f:()=>l});var a=h(10834),k=h(11206),G=h(11426),V={};class l{constructor(E){this.attachedToElement=!1,this.attached={},this.camera=E,this.checkInputs=()=>{}}add(E){const b=E.getSimpleName();this.attached[b]?a.c.Warn("camera input of type "+b+" already exists on camera"):(this.attached[b]=E,E.camera=this.camera,E.checkInputs&&(this.checkInputs=this._addCheckInputs(E.checkInputs.bind(E))),this.attachedToElement&&E.attachControl(this.noPreventDefault))}remove(E){for(const b in this.attached){const h=this.attached[b];if(h===E)return h.$i(),h.camera=null,delete this.attached[b],void this.rebuildInputCheck()}}removeByType(E){for(const b in this.attached){const h=this.attached[b];h.getClassName()===E&&(h.$i(),h.camera=null,delete this.attached[b],this.rebuildInputCheck())}}_addCheckInputs(E){const b=this.checkInputs;return()=>{b(),E()}}attachInput(E){this.attachedToElement&&E.attachControl(this.noPreventDefault)}attachElement(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){E=!G.b.ForceAttachControlToAlwaysPreventDefault&&E,this.attachedToElement=!0,this.noPreventDefault=E;for(const b in this.attached)this.attached[b].attachControl(E)}}detachElement(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const b in this.attached)this.attached[b].$i(),E&&(this.attached[b].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const E in this.attached){const b=this.attached[E];b.checkInputs&&(this.checkInputs=this._addCheckInputs(b.checkInputs.bind(b)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(E){const b={};for(const h in this.attached){const E=this.attached[h],a=k.e.Serialize(E);b[E.getClassName()]=a}E.inputsmgr=b}parse(E){const b=E.inputsmgr;if(b){this.clear();for(const E in b){const h=V[E];if(h){const a=b[E],G=k.e.Parse((()=>new h),a,null);this.add(G)}}}else for(const h in this.attached){const b=V[this.attached[h].getClassName()];if(b){const a=k.e.Parse((()=>new b),E,null);this.remove(this.attached[h]),this.add(a)}}}}},12123:(E,b,h)=>{"use strict";h.d(b,{d:()=>A});var a=h(11130),k=h(11139),G=h(11175),V=h(12127),l=h(12134),O=h(11268),v=h(10821);class s{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(E){E=v.g.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((b=>{const h=b.event;if(!h.metaKey)if(b.type===O.d.KEYDOWN){if(-1!==this.keysUp.indexOf(h.keyCode)||-1!==this.keysDown.indexOf(h.keyCode)||-1!==this.keysLeft.indexOf(h.keyCode)||-1!==this.keysRight.indexOf(h.keyCode)||-1!==this.keysUpward.indexOf(h.keyCode)||-1!==this.keysDownward.indexOf(h.keyCode)||-1!==this.keysRotateLeft.indexOf(h.keyCode)||-1!==this.keysRotateRight.indexOf(h.keyCode)||-1!==this.keysRotateUp.indexOf(h.keyCode)||-1!==this.keysRotateDown.indexOf(h.keyCode)){-1===this._keys.indexOf(h.keyCode)&&this._keys.push(h.keyCode),E||h.preventDefault()}}else if(-1!==this.keysUp.indexOf(h.keyCode)||-1!==this.keysDown.indexOf(h.keyCode)||-1!==this.keysLeft.indexOf(h.keyCode)||-1!==this.keysRight.indexOf(h.keyCode)||-1!==this.keysUpward.indexOf(h.keyCode)||-1!==this.keysDownward.indexOf(h.keyCode)||-1!==this.keysRotateLeft.indexOf(h.keyCode)||-1!==this.keysRotateRight.indexOf(h.keyCode)||-1!==this.keysRotateUp.indexOf(h.keyCode)||-1!==this.keysRotateDown.indexOf(h.keyCode)){const b=this._keys.indexOf(h.keyCode);b>=0&&this._keys.splice(b,1),E||h.preventDefault()}})))}$i(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const E=this.camera;for(let b=0;b<this._keys.length;b++){const h=this._keys[b],a=E._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(h)?E._localDirection.ue(-a,0,0):-1!==this.keysUp.indexOf(h)?E._localDirection.ue(0,0,a):-1!==this.keysRight.indexOf(h)?E._localDirection.ue(a,0,0):-1!==this.keysDown.indexOf(h)?E._localDirection.ue(0,0,-a):-1!==this.keysUpward.indexOf(h)?E._localDirection.ue(0,a,0):-1!==this.keysDownward.indexOf(h)?E._localDirection.ue(0,-a,0):-1!==this.keysRotateLeft.indexOf(h)?(E._localDirection.ue(0,0,0),E.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(h)?(E._localDirection.ue(0,0,0),E.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(h)?(E._localDirection.ue(0,0,0),E.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(h)&&(E._localDirection.ue(0,0,0),E.cameraRotation.x+=this._getLocalRotation()),E.va().useRightHandedSystem&&(E._localDirection.z*=-1),E.getViewMatrix().invertToRef(E._cameraTransformMatrix),G.k.TransformNormalToRef(E._localDirection,E._cameraTransformMatrix,E._transformedDirection),E.cameraDirection.addInPlace(E._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const E=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*E}}(0,a.d)([(0,k.H)()],s.prototype,"keysUp",void 0),(0,a.d)([(0,k.H)()],s.prototype,"keysUpward",void 0),(0,a.d)([(0,k.H)()],s.prototype,"keysDown",void 0),(0,a.d)([(0,k.H)()],s.prototype,"keysDownward",void 0),(0,a.d)([(0,k.H)()],s.prototype,"keysLeft",void 0),(0,a.d)([(0,k.H)()],s.prototype,"keysRight",void 0),(0,a.d)([(0,k.H)()],s.prototype,"rotationSpeed",void 0),(0,a.d)([(0,k.H)()],s.prototype,"keysRotateLeft",void 0),(0,a.d)([(0,k.H)()],s.prototype,"keysRotateRight",void 0),(0,a.d)([(0,k.H)()],s.prototype,"keysRotateUp",void 0),(0,a.d)([(0,k.H)()],s.prototype,"keysRotateDown",void 0),l.d.FreeCameraKeyboardMoveInput=s;var U=h(10824),B=h(11261);class o{constructor(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=E,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new U.e,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(E){E=v.g.BackCompatCameraNoPreventDefault(arguments);const b=this.camera.getEngine(),h=b.getInputElement();this._pointerInput||(this._pointerInput=a=>{const k=a.event,G="touch"===k.pointerType;if(!this.touchEnabled&&G)return;if(a.type!==B.d.POINTERMOVE&&-1===this.buttons.indexOf(k.button))return;const V=k.target;if(a.type===B.d.POINTERDOWN){if(G&&-1!==this._activePointerId||!G&&-1!==this._currentActiveButton)return;this._activePointerId=k.pointerId;try{null===V||void 0===V||V.setPointerCapture(k.pointerId)}catch(l){}-1===this._currentActiveButton&&(this._currentActiveButton=k.button),this._previousPosition={x:k.clientX,y:k.clientY},E||(k.preventDefault(),h&&h.focus()),b.isPointerLock&&this._onMouseMove&&this._onMouseMove(a.event)}else if(a.type===B.d.POINTERUP){if(G&&this._activePointerId!==k.pointerId||!G&&this._currentActiveButton!==k.button)return;try{null===V||void 0===V||V.releasePointerCapture(k.pointerId)}catch(l){}this._currentActiveButton=-1,this._previousPosition=null,E||k.preventDefault(),this._activePointerId=-1}else if(a.type===B.d.POINTERMOVE&&(this._activePointerId===k.pointerId||!G))if(b.isPointerLock&&this._onMouseMove)this._onMouseMove(a.event);else if(this._previousPosition){const b=this.camera._calculateHandednessMultiplier(),h=(k.clientX-this._previousPosition.x)*b,a=k.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=h/this.angularSensibility,this.camera.cameraRotation.x+=a/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:h,offsetY:a}),this._previousPosition={x:k.clientX,y:k.clientY},E||k.preventDefault()}}),this._onMouseMove=h=>{if(!b.isPointerLock)return;const a=this.camera._calculateHandednessMultiplier(),k=h.movementX*a;this.camera.cameraRotation.y+=k/this.angularSensibility;const G=h.movementY;this.camera.cameraRotation.x+=G/this.angularSensibility,this._previousPosition=null,E||h.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,B.d.POINTERDOWN|B.d.POINTERUP|B.d.POINTERMOVE),h&&(this._contextMenuBind=E=>this.onContextMenu(E),h.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(E){E.preventDefault()}$i(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const E=this.camera.getEngine().getInputElement();E&&E.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,a.d)([(0,k.H)()],o.prototype,"buttons",void 0),(0,a.d)([(0,k.H)()],o.prototype,"angularSensibility",void 0),l.d.FreeCameraMouseInput=o;var u,D=h(11270);class g{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new U.e,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(E){E=v.g.BackCompatCameraNoPreventDefault(arguments),this._wheel=b=>{if(b.type!==B.d.POINTERWHEEL)return;const h=b.event,a=h.deltaMode===D.e.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*a*h.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*a*h.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*a*h.deltaZ/this._normalize,h.preventDefault&&(E||h.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,B.d.POINTERWHEEL)}$i(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,a.d)([(0,k.H)()],g.prototype,"wheelPrecisionX",void 0),(0,a.d)([(0,k.H)()],g.prototype,"wheelPrecisionY",void 0),(0,a.d)([(0,k.H)()],g.prototype,"wheelPrecisionZ",void 0),function(E){E[E.MoveRelative=0]="MoveRelative",E[E.RotateRelative=1]="RotateRelative",E[E.MoveScene=2]="MoveScene"}(u||(u={}));class S extends g{constructor(){super(...arguments),this._moveRelative=G.k.Zero(),this._rotateRelative=G.k.Zero(),this._moveScene=G.k.Zero(),this._wheelXAction=u.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=u.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(E){null===E&&this._wheelXAction!==u.MoveRelative||(this._wheelXAction=u.MoveRelative,this._wheelXActionCoordinate=E)}get wheelXMoveRelative(){return this._wheelXAction!==u.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(E){null===E&&this._wheelYAction!==u.MoveRelative||(this._wheelYAction=u.MoveRelative,this._wheelYActionCoordinate=E)}get wheelYMoveRelative(){return this._wheelYAction!==u.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(E){null===E&&this._wheelZAction!==u.MoveRelative||(this._wheelZAction=u.MoveRelative,this._wheelZActionCoordinate=E)}get wheelZMoveRelative(){return this._wheelZAction!==u.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(E){null===E&&this._wheelXAction!==u.RotateRelative||(this._wheelXAction=u.RotateRelative,this._wheelXActionCoordinate=E)}get wheelXRotateRelative(){return this._wheelXAction!==u.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(E){null===E&&this._wheelYAction!==u.RotateRelative||(this._wheelYAction=u.RotateRelative,this._wheelYActionCoordinate=E)}get wheelYRotateRelative(){return this._wheelYAction!==u.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(E){null===E&&this._wheelZAction!==u.RotateRelative||(this._wheelZAction=u.RotateRelative,this._wheelZActionCoordinate=E)}get wheelZRotateRelative(){return this._wheelZAction!==u.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(E){null===E&&this._wheelXAction!==u.MoveScene||(this._wheelXAction=u.MoveScene,this._wheelXActionCoordinate=E)}get wheelXMoveScene(){return this._wheelXAction!==u.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(E){null===E&&this._wheelYAction!==u.MoveScene||(this._wheelYAction=u.MoveScene,this._wheelYActionCoordinate=E)}get wheelYMoveScene(){return this._wheelYAction!==u.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(E){null===E&&this._wheelZAction!==u.MoveScene||(this._wheelZAction=u.MoveScene,this._wheelZActionCoordinate=E)}get wheelZMoveScene(){return this._wheelZAction!==u.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.te(0),this._rotateRelative.te(0),this._moveScene.te(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const E=G.d.Zero();this.camera.getViewMatrix().invertToRef(E);const b=G.k.Zero();G.k.TransformNormalToRef(this._moveRelative,E,b),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(b),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(E,b,h){if(0===E)return;if(null===b||null===h)return;let a=null;switch(b){case u.MoveRelative:a=this._moveRelative;break;case u.RotateRelative:a=this._rotateRelative;break;case u.MoveScene:a=this._moveScene}switch(h){case 0:a.set(E,0,0);break;case 1:a.set(0,E,0);break;case 2:a.set(0,0,E)}}}(0,a.d)([(0,k.H)()],S.prototype,"wheelXMoveRelative",null),(0,a.d)([(0,k.H)()],S.prototype,"wheelYMoveRelative",null),(0,a.d)([(0,k.H)()],S.prototype,"wheelZMoveRelative",null),(0,a.d)([(0,k.H)()],S.prototype,"wheelXRotateRelative",null),(0,a.d)([(0,k.H)()],S.prototype,"wheelYRotateRelative",null),(0,a.d)([(0,k.H)()],S.prototype,"wheelZRotateRelative",null),(0,a.d)([(0,k.H)()],S.prototype,"wheelXMoveScene",null),(0,a.d)([(0,k.H)()],S.prototype,"wheelYMoveScene",null),(0,a.d)([(0,k.H)()],S.prototype,"wheelZMoveScene",null),l.d.FreeCameraMouseWheelInput=S;class M{constructor(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=E,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=v.g.IsSafari()}attachControl(E){E=v.g.BackCompatCameraNoPreventDefault(arguments);let b=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=h=>{const a=h.event,k="mouse"===a.pointerType||this._isSafari&&"undefined"===typeof a.pointerType;if(this.allowMouse||!k)if(h.type===B.d.POINTERDOWN){if(E||a.preventDefault(),this._pointerPressed.push(a.pointerId),1!==this._pointerPressed.length)return;b={x:a.clientX,y:a.clientY}}else if(h.type===B.d.POINTERUP){E||a.preventDefault();const h=this._pointerPressed.indexOf(a.pointerId);if(-1===h)return;if(this._pointerPressed.splice(h,1),0!=h)return;b=null,this._offsetX=null,this._offsetY=null}else if(h.type===B.d.POINTERMOVE){if(E||a.preventDefault(),!b)return;if(0!=this._pointerPressed.indexOf(a.pointerId))return;this._offsetX=a.clientX-b.x,this._offsetY=-(a.clientY-b.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,B.d.POINTERDOWN|B.d.POINTERUP|B.d.POINTERMOVE),this._onLostFocus){const E=this.camera.getEngine().getInputElement();E&&E.addEventListener("blur",this._onLostFocus)}}$i(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const E=this.camera.getEngine().getInputElement();E&&E.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const E=this.camera,b=E._calculateHandednessMultiplier();E.cameraRotation.y=b*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)E.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const b=E._computeLocalCameraSpeed(),h=new G.k(0,0,0!==this.touchMoveSensibility?b*this._offsetY/this.touchMoveSensibility:0);G.d.RotationYawPitchRollToRef(E.rotation.y,E.rotation.x,0,E._cameraRotationMatrix),E.cameraDirection.addInPlace(G.k.TransformCoordinates(h,E._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,a.d)([(0,k.H)()],M.prototype,"touchAngularSensibility",void 0),(0,a.d)([(0,k.H)()],M.prototype,"touchMoveSensibility",void 0),l.d.FreeCameraTouchInput=M;class I extends l.f{constructor(E){super(E),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new s),this}addMouse(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new o(E),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new S,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new M),this}clear(){super.clear(),this._mouseInput=null}}var j=h(10958),P=h(10902);class A extends V.d{get angularSensibility(){const E=this.inputs.attached.mouse;return E?E.angularSensibility:0}set angularSensibility(E){const b=this.inputs.attached.mouse;b&&(b.angularSensibility=E)}get keysUp(){const E=this.inputs.attached.keyboard;return E?E.keysUp:[]}set keysUp(E){const b=this.inputs.attached.keyboard;b&&(b.keysUp=E)}get keysUpward(){const E=this.inputs.attached.keyboard;return E?E.keysUpward:[]}set keysUpward(E){const b=this.inputs.attached.keyboard;b&&(b.keysUpward=E)}get keysDown(){const E=this.inputs.attached.keyboard;return E?E.keysDown:[]}set keysDown(E){const b=this.inputs.attached.keyboard;b&&(b.keysDown=E)}get keysDownward(){const E=this.inputs.attached.keyboard;return E?E.keysDownward:[]}set keysDownward(E){const b=this.inputs.attached.keyboard;b&&(b.keysDownward=E)}get keysLeft(){const E=this.inputs.attached.keyboard;return E?E.keysLeft:[]}set keysLeft(E){const b=this.inputs.attached.keyboard;b&&(b.keysLeft=E)}get keysRight(){const E=this.inputs.attached.keyboard;return E?E.keysRight:[]}set keysRight(E){const b=this.inputs.attached.keyboard;b&&(b.keysRight=E)}get keysRotateLeft(){const E=this.inputs.attached.keyboard;return E?E.keysRotateLeft:[]}set keysRotateLeft(E){const b=this.inputs.attached.keyboard;b&&(b.keysRotateLeft=E)}get keysRotateRight(){const E=this.inputs.attached.keyboard;return E?E.keysRotateRight:[]}set keysRotateRight(E){const b=this.inputs.attached.keyboard;b&&(b.keysRotateRight=E)}get keysRotateUp(){const E=this.inputs.attached.keyboard;return E?E.keysRotateUp:[]}set keysRotateUp(E){const b=this.inputs.attached.keyboard;b&&(b.keysRotateUp=E)}get keysRotateDown(){const E=this.inputs.attached.keyboard;return E?E.keysRotateDown:[]}set keysRotateDown(E){const b=this.inputs.attached.keyboard;b&&(b.keysRotateDown=E)}constructor(E,b,h){var a;super(E,b,h,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),a=this,this.ellipsoid=new G.k(.5,1,.5),this.ellipsoidOffset=new G.k(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=G.k.Zero(),this._diffPosition=G.k.Zero(),this._newPosition=G.k.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;a._newPosition.p(b),a._newPosition.subtractToRef(a._oldPosition,a._diffPosition),a._diffPosition.length()>P.d.CollisionsEpsilon&&(a.position.addToRef(a._diffPosition,a._deferredPositionUpdate),a._deferOnly?a._deferredUpdated=!0:a.position.p(a._deferredPositionUpdate),a.Qk&&h&&a.Qk(h))},this.inputs=new I(this),this.inputs.addKeyboard().addMouse()}attachControl(E,b){b=v.g.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(b)}$i(){this.inputs.detachElement(),this.cameraDirection=new G.k(0,0,0),this.cameraRotation=new G.j(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(E){this._collisionMask=isNaN(E)?-1:E}_collideWithWorld(E){let b;b=this.parent?G.k.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,b.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const h=this.va().collisionCoordinator;this._collider||(this._collider=h.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let a=E;this.applyGravity&&(a=E.add(this.va().gravity)),h.getNewPosition(this._oldPosition,a,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=G.k.Zero(),this._transformedDirection=G.k.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(E){this._needMoveForGravity=E}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ib"}}(0,a.d)([(0,k.G)()],A.prototype,"ellipsoid",void 0),(0,a.d)([(0,k.G)()],A.prototype,"ellipsoidOffset",void 0),(0,a.d)([(0,k.H)()],A.prototype,"checkCollisions",void 0),(0,a.d)([(0,k.H)()],A.prototype,"applyGravity",void 0),(0,j.f)("BABYLON.FreeCamera",A)},12127:(E,b,h)=>{"use strict";h.d(b,{d:()=>v});var a=h(11130),k=h(11139),G=h(11426),V=h(11175),l=h(11177),O=h(11466);h(11429).d.AddNodeConstructor("TargetCamera",((E,b)=>()=>new v(E,V.k.Zero(),b)));class v extends G.b{constructor(E,b,h){super(E,b,h,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this._tmpUpVector=V.k.Zero(),this._tmpTargetVector=V.k.Zero(),this.cameraDirection=new V.k(0,0,0),this.cameraRotation=new V.j(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new V.g,this.rotation=new V.k(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=V.k.Zero(),this._initialFocalDistance=1,this._viewMatrix=V.d.Zero(),this._camMatrix=V.d.Zero(),this._cameraTransformMatrix=V.d.Zero(),this._cameraRotationMatrix=V.d.Zero(),this._referencePoint=new V.k(0,0,1),this._transformedReferencePoint=V.k.Zero(),this._deferredPositionUpdate=new V.k,this._deferredRotationQuaternionUpdate=new V.g,this._deferredRotationUpdate=new V.k,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=V.k.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(E){this.getWorldMatrix();const b=this.getTarget().Xc(this.position);return b.normalize(),b.scaleInPlace(E),this.globalPosition.add(b)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const E=this.lockedTarget;E.Wj().getTranslationToRef(E.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.ue(0,0,0),this.cameraRotation.ue(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new V.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new V.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new V.g(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(E){E||super._updateCache();const b=this._getLockedTargetPosition();b?this._cache.lockedTarget?this._cache.lockedTarget.p(b):this._cache.lockedTarget=b.clone():this._cache.lockedTarget=null,this._cache.rotation.p(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.p(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const E=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(E):!E)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const E=this.getEngine();return this.speed*Math.sqrt(E.getDeltaTime()/(100*E.getFps()))}setTarget(E){this.upVector.normalize(),this._initialFocalDistance=E.Xc(this.position).length(),this.position.z===E.z&&(this.position.z+=l.d),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),V.d.LookAtLHToRef(this.position,E,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const b=E.Xc(this.position);b.x>=0?this.rotation.y=-Math.atan(b.z/b.x)+Math.PI/2:this.rotation.y=-Math.atan(b.z/b.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&V.g.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(E){this.setTarget(E)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(V.h.Matrix[0]),V.k.TransformNormalToRef(this.cameraDirection,V.h.Matrix[0],V.h.o[0]),this._deferredPositionUpdate.addInPlace(V.h.o[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate)}_checkInputs(){const E=this.invertRotation?-this.inverseRotationSpeed:1,b=this._decideIfNeedsToMove(),h=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.p(this.rotation),this._deferredPositionUpdate.p(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.p(this.rotationQuaternion),b&&this._updatePosition(),h){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*E,this._deferredRotationUpdate.y+=this.cameraRotation.y*E,!this.noRotationConstraint){const E=1.570796;this._deferredRotationUpdate.x>E&&(this._deferredRotationUpdate.x=E),this._deferredRotationUpdate.x<-E&&(this._deferredRotationUpdate.x=-E)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.p(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(V.g.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.p(this._deferredRotationQuaternionUpdate))}}b&&(Math.abs(this.cameraDirection.x)<this.speed*l.d&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*l.d&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*l.d&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),h&&(Math.abs(this.cameraRotation.x)<this.speed*l.d&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*l.d&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):V.d.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return V.k.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),V.k.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?O.b.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(V.g.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),O.b.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(E,b,h){if(this.ignoreParentScaling){if(this.parent){const a=this.parent.getWorldMatrix();V.k.TransformCoordinatesToRef(E,a,this._globalPosition),V.k.TransformCoordinatesToRef(b,a,this._tmpTargetVector),V.k.TransformNormalToRef(h,a,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.p(E),this._tmpTargetVector.p(b),this._tmpUpVector.p(h);this.va().useRightHandedSystem?V.d.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):V.d.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.va().useRightHandedSystem?V.d.LookAtRHToRef(E,b,h,this._viewMatrix):V.d.LookAtLHToRef(E,b,h,this._viewMatrix),this.parent){const E=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(E,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.p(E)}createRigCamera(E,b){if(this.cameraRigMode!==G.b.RIG_MODE_NONE){const b=new v(E,this.position.clone(),this.va());return b.isRigCamera=!0,b.rigParent=this,this.cameraRigMode===G.b.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new V.g),b._cameraRigParams={},b.rotationQuaternion=new V.g),b.mode=this.mode,b.orthoLeft=this.orthoLeft,b.orthoRight=this.orthoRight,b.orthoTop=this.orthoTop,b.orthoBottom=this.orthoBottom,b}return null}_updateRigCameras(){const E=this._rigCameras[0],b=this._rigCameras[1];switch(this.Wj(),this.cameraRigMode){case G.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case G.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case G.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case G.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case G.b.RIG_MODE_STEREOSCOPIC_INTERLACED:{const h=this.cameraRigMode===G.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,a=this.cameraRigMode===G.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*h,E),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*a,b);break}case G.b.RIG_MODE_VR:E.rotationQuaternion?(E.rotationQuaternion.p(this.rotationQuaternion),b.rotationQuaternion.p(this.rotationQuaternion)):(E.rotation.p(this.rotation),b.rotation.p(this.rotation)),E.position.p(this.position),b.position.p(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(E,b){this.getTarget().subtractToRef(this.position,v._TargetFocalPoint),v._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const h=v._TargetFocalPoint.addInPlace(this.position);V.d.TranslationToRef(-h.x,-h.y,-h.z,v._TargetTransformMatrix),v._TargetTransformMatrix.multiplyToRef(V.d.RotationAxis(b.upVector,E),v._RigCamTransformMatrix),V.d.TranslationToRef(h.x,h.y,h.z,v._TargetTransformMatrix),v._RigCamTransformMatrix.multiplyToRef(v._TargetTransformMatrix,v._RigCamTransformMatrix),V.k.TransformCoordinatesToRef(this.position,v._RigCamTransformMatrix,b.position),b.setTarget(h)}getClassName(){return"TargetCamera"}}v._RigCamTransformMatrix=new V.d,v._TargetTransformMatrix=new V.d,v._TargetFocalPoint=new V.k,(0,a.d)([(0,k.G)()],v.prototype,"rotation",void 0),(0,a.d)([(0,k.H)()],v.prototype,"speed",void 0),(0,a.d)([(0,k.v)("lockedTargetId")],v.prototype,"lockedTarget",void 0)},11322:(E,b,h)=>{"use strict";h.d(b,{d:()=>a});class a{constructor(E,b,h){this.bu=E,this.bv=b,this.distance=h,this.faceId=0,this.subMeshId=0}}},11231:(E,b,h)=>{"use strict";h.d(b,{d:()=>G});var a=h(11175),k=h(11233);class G{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(){var E;let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0],h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.pickedMesh||h&&!this.pickedMesh.isVerticesDataPresent(k.g.NormalKind))return null;let G,V=this.pickedMesh.rg();0===(null===(E=V)||void 0===E?void 0:E.length)&&(V=null);const l=a.h.o[0],O=a.h.o[1],v=a.h.o[2];if(h){const E=this.pickedMesh.getVerticesData(k.g.NormalKind);let b=V?a.k.FromArrayToRef(E,3*V[3*this.faceId],l):l.ue(E[3*this.faceId*3],E[3*this.faceId*3+1],E[3*this.faceId*3+2]),h=V?a.k.FromArrayToRef(E,3*V[3*this.faceId+1],O):O.ue(E[3*(3*this.faceId+1)],E[3*(3*this.faceId+1)+1],E[3*(3*this.faceId+1)+2]),s=V?a.k.FromArrayToRef(E,3*V[3*this.faceId+2],v):v.ue(E[3*(3*this.faceId+2)],E[3*(3*this.faceId+2)+1],E[3*(3*this.faceId+2)+2]);b=b.scale(this.bu),h=h.scale(this.bv),s=s.scale(1-this.bu-this.bv),G=new a.k(b.x+h.x+s.x,b.y+h.y+s.y,b.z+h.z+s.z)}else{const E=this.pickedMesh.getVerticesData(k.g.PositionKind),b=V?a.k.FromArrayToRef(E,3*V[3*this.faceId],l):l.ue(E[3*this.faceId*3],E[3*this.faceId*3+1],E[3*this.faceId*3+2]),h=V?a.k.FromArrayToRef(E,3*V[3*this.faceId+1],O):O.ue(E[3*(3*this.faceId+1)],E[3*(3*this.faceId+1)+1],E[3*(3*this.faceId+1)+2]),s=V?a.k.FromArrayToRef(E,3*V[3*this.faceId+2],v):v.ue(E[3*(3*this.faceId+2)],E[3*(3*this.faceId+2)+1],E[3*(3*this.faceId+2)+2]),U=b.Xc(h),B=s.Xc(h);G=a.k.Cross(U,B)}const s=(E,b)=>{let h=E.getWorldMatrix();E.nonUniformScaling&&(a.h.Matrix[0].p(h),h=a.h.Matrix[0],h.setTranslationFromFloats(0,0,0),h.invert(),h.transposeToRef(a.h.Matrix[1]),h=a.h.Matrix[1]),a.k.TransformNormalToRef(b,h,b)};if(b&&s(this.pickedMesh,G),this.ray){const E=a.h.o[0].p(G);b||s(this.pickedMesh,E),a.k.Dot(E,this.ray.direction)>0&&G.negateInPlace()}return G.normalize(),G}getTextureCoordinates(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k.g.UVKind;if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(E))return null;const b=this.pickedMesh.rg();if(!b)return null;const h=this.pickedMesh.getVerticesData(E);if(!h)return null;let G=a.j.jh(h,2*b[3*this.faceId]),V=a.j.jh(h,2*b[3*this.faceId+1]),l=a.j.jh(h,2*b[3*this.faceId+2]);return G=G.scale(this.bu),V=V.scale(this.bv),l=l.scale(1-this.bu-this.bv),new a.j(G.x+V.x+l.x,G.y+V.y+l.y)}}},11389:(E,b,h)=>{"use strict";h.d(b,{c:()=>a});let a=!1},12624:(E,b,h)=>{"use strict";h.d(b,{c:()=>G});var a=h(11155),k=h(12631);class G{constructor(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=h,this.ui=[],this._maxBlockCapacity=b||64,this._selectionContent=new a.d(1024),this._creationFunc=E}update(E,b,h){k.c._CreateBlocks(E,b,h,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}ti(E){for(let b=0;b<this.Oh.length;b++){this.Oh[b].addEntry(E)}}Wd(E){for(let b=0;b<this.Oh.length;b++){this.Oh[b].removeEntry(E)}}select(E,b){this._selectionContent.reset();for(let h=0;h<this.Oh.length;h++){this.Oh[h].select(E,this._selectionContent,b)}return b?this._selectionContent.concat(this.ui):this._selectionContent.concatWithNoDuplicate(this.ui),this._selectionContent}intersects(E,b,h){this._selectionContent.reset();for(let a=0;a<this.Oh.length;a++){this.Oh[a].intersects(E,b,this._selectionContent,h)}return h?this._selectionContent.concat(this.ui):this._selectionContent.concatWithNoDuplicate(this.ui),this._selectionContent}intersectsRay(E){this._selectionContent.reset();for(let b=0;b<this.Oh.length;b++){this.Oh[b].intersectsRay(E,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.ui),this._selectionContent}}G.CreationFuncForMeshes=(E,b)=>{const h=E.getBoundingInfo();!E.isBlocked&&h.boundingBox.intersectsMinMax(b.zi,b.Ai)&&b.entries.push(E)},G.CreationFuncForSubMeshes=(E,b)=>{E.getBoundingInfo().boundingBox.intersectsMinMax(b.zi,b.Ai)&&b.entries.push(E)}},12631:(E,b,h)=>{"use strict";h.d(b,{c:()=>G});var a=h(11175),k=h(11331);class G{constructor(E,b,h,a,k,G){this.entries=[],this.Bi=new Array,this._capacity=h,this._depth=a,this._maxDepth=k,this._creationFunc=G,this._minPoint=E,this._maxPoint=b,this.Bi.push(E.clone()),this.Bi.push(b.clone()),this.Bi.push(E.clone()),this.Bi[2].x=b.x,this.Bi.push(E.clone()),this.Bi[3].y=b.y,this.Bi.push(E.clone()),this.Bi[4].z=b.z,this.Bi.push(b.clone()),this.Bi[5].z=E.z,this.Bi.push(b.clone()),this.Bi[6].x=E.x,this.Bi.push(b.clone()),this.Bi[7].y=E.y}get mb(){return this._capacity}get zi(){return this._minPoint}get Ai(){return this._maxPoint}addEntry(E){if(this.Oh)for(let b=0;b<this.Oh.length;b++){this.Oh[b].addEntry(E)}else this._creationFunc(E,this),this.entries.length>this.mb&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(E){if(this.Oh){for(let b=0;b<this.Oh.length;b++){this.Oh[b].removeEntry(E)}return}const b=this.entries.indexOf(E);b>-1&&this.entries.splice(b,1)}addEntries(E){for(let b=0;b<E.length;b++){const h=E[b];this.addEntry(h)}}select(E,b,h){if(k.e.IsInFrustum(this.Bi,E)){if(this.Oh){for(let a=0;a<this.Oh.length;a++){this.Oh[a].select(E,b,h)}return}h?b.concat(this.entries):b.concatWithNoDuplicate(this.entries)}}intersects(E,b,h,a){if(k.e.IntersectsSphere(this._minPoint,this._maxPoint,E,b)){if(this.Oh){for(let k=0;k<this.Oh.length;k++){this.Oh[k].intersects(E,b,h,a)}return}a?h.concat(this.entries):h.concatWithNoDuplicate(this.entries)}}intersectsRay(E,b){if(E.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Oh){for(let h=0;h<this.Oh.length;h++){this.Oh[h].intersectsRay(E,b)}return}b.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){G._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(E,b,h,k,V,l,O,v){O.Oh=new Array;const s=new a.k((b.x-E.x)/2,(b.y-E.y)/2,(b.z-E.z)/2);for(let a=0;a<2;a++)for(let b=0;b<2;b++)for(let U=0;U<2;U++){const B=E.add(s.multiplyByFloats(a,b,U)),o=E.add(s.multiplyByFloats(a+1,b+1,U+1)),u=new G(B,o,k,V+1,l,v);u.addEntries(h),O.Oh.push(u)}}}},12636:(E,b,h)=>{"use strict";h.d(b,{b:()=>s});var a=h(11163),k=h(11175),G=h(11456),V=h(11828),l=h(11257),O=h(12624),v=h(10869);a.e.prototype.createOrUpdateSelectionOctree=function(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,h=this._getComponent(l.e.NAME_OCTREE);h||(h=new s(this),this.fb(h)),this.ri||(this.ri=new O.c(O.c.CreationFuncForMeshes,E,b));const a=this.getWorldExtends();return this.ri.update(a.min,a.max,this.meshes),this.ri},Object.defineProperty(a.e.prototype,"selectionOctree",{get:function(){return this.ri},enumerable:!0,configurable:!0}),G.b.prototype.createOrUpdateSubmeshesOctree=function(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const h=this.va();let a=h._getComponent(l.e.NAME_OCTREE);a||(a=new s(h),h.fb(a)),this._submeshesOctree||(this._submeshesOctree=new O.c(O.c.CreationFuncForSubMeshes,E,b)),this.Wj(!0);const k=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(k.minimumWorld,k.maximumWorld,this.wg),this._submeshesOctree};class s{constructor(E){this.name=l.e.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new V.d(k.k.Zero(),new k.k(1,1,1)),(E=E||v.b.LastCreatedScene)&&(this.Xd=E,this.Xd.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Xd.getActiveSubMeshCandidates=E=>this.getActiveSubMeshCandidates(E),this.Xd.getCollidingSubMeshCandidates=(E,b)=>this.getCollidingSubMeshCandidates(E,b),this.Xd.getIntersectingSubMeshCandidates=(E,b)=>this.getIntersectingSubMeshCandidates(E,b))}register(){this.Xd.onMeshRemovedObservable.add((E=>{const b=this.Xd.selectionOctree;if(void 0!==b&&null!==b){const h=b.ui.indexOf(E);-1!==h&&b.ui.splice(h,1)}})),this.Xd.onMeshImportedObservable.add((E=>{const b=this.Xd.selectionOctree;void 0!==b&&null!==b&&b.ti(E)}))}getActiveMeshCandidates(){var E;return(null===(E=this.Xd.ri)||void 0===E?void 0:E.select(this.Xd.frustumPlanes))||this.Xd._getDefaultMeshCandidates()}getActiveSubMeshCandidates(E){if(E._submeshesOctree&&E.useOctreeForRenderingSelection){return E._submeshesOctree.select(this.Xd.frustumPlanes)}return this.Xd._getDefaultSubMeshCandidates(E)}getIntersectingSubMeshCandidates(E,b){if(E._submeshesOctree&&E.useOctreeForPicking){V.d.TransformToRef(b,E.getWorldMatrix(),this._tempRay);return E._submeshesOctree.intersectsRay(this._tempRay)}return this.Xd._getDefaultSubMeshCandidates(E)}getCollidingSubMeshCandidates(E,b){if(E._submeshesOctree&&E.useOctreeForCollisions){const h=b._velocityWorldLength+Math.max(b._radius.x,b._radius.y,b._radius.z);return E._submeshesOctree.intersects(b._basePointWorld,h)}return this.Xd._getDefaultSubMeshCandidates(E)}rebuild(){}dispose(){}}},11331:(E,b,h)=>{"use strict";h.d(b,{e:()=>V});var a=h(11183),k=h(11175),G=h(11177);class V{constructor(E,b,h){this.vectors=(0,a.b)(8,k.k.Zero),this.center=k.k.Zero(),this.centerWorld=k.k.Zero(),this.extendSize=k.k.Zero(),this.extendSizeWorld=k.k.Zero(),this.directions=(0,a.b)(3,k.k.Zero),this.vectorsWorld=(0,a.b)(8,k.k.Zero),this.minimumWorld=k.k.Zero(),this.maximumWorld=k.k.Zero(),this.minimum=k.k.Zero(),this.maximum=k.k.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(E,b,h)}reConstruct(E,b,h){const a=E.x,G=E.y,V=E.z,l=b.x,O=b.y,v=b.z,s=this.vectors;this.minimum.ue(a,G,V),this.maximum.ue(l,O,v),s[0].ue(a,G,V),s[1].ue(l,O,v),s[2].ue(l,G,V),s[3].ue(a,O,V),s[4].ue(a,G,v),s[5].ue(l,O,V),s[6].ue(a,O,v),s[7].ue(l,G,v),b.addToRef(E,this.center).scaleInPlace(.5),b.subtractToRef(E,this.extendSize).scaleInPlace(.5),this._worldMatrix=h||k.d.IdentityReadOnly,this._update(this._worldMatrix)}scale(E){const b=V._TmpVector3,h=this.maximum.subtractToRef(this.minimum,b[0]),a=h.length();h.normalizeFromLength(a);const k=a*E,G=h.scaleInPlace(.5*k),l=this.center.subtractToRef(G,b[1]),O=this.center.addToRef(G,b[2]);return this.reConstruct(l,O,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(E){const b=this.minimumWorld,h=this.maximumWorld,a=this.directions,G=this.vectorsWorld,V=this.vectors;if(E.isIdentity()){b.p(this.minimum),h.p(this.maximum);for(let E=0;E<8;++E)G[E].p(V[E]);this.extendSizeWorld.p(this.extendSize),this.centerWorld.p(this.center)}else{b.te(Number.MAX_VALUE),h.te(-Number.MAX_VALUE);for(let a=0;a<8;++a){const l=G[a];k.k.TransformCoordinatesToRef(V[a],E,l),b.minimizeInPlace(l),h.maximizeInPlace(l)}h.subtractToRef(b,this.extendSizeWorld).scaleInPlace(.5),h.addToRef(b,this.centerWorld).scaleInPlace(.5)}k.k.FromArrayToRef(E.m,0,a[0]),k.k.FromArrayToRef(E.m,4,a[1]),k.k.FromArrayToRef(E.m,8,a[2]),this._worldMatrix=E}isInFrustum(E){return V.IsInFrustum(this.vectorsWorld,E)}isCompletelyInFrustum(E){return V.IsCompletelyInFrustum(this.vectorsWorld,E)}intersectsPoint(E){const b=this.minimumWorld,h=this.maximumWorld,a=b.x,k=b.y,V=b.z,l=h.x,O=h.y,v=h.z,s=E.x,U=E.y,B=E.z,o=-G.d;return!(l-s<o||o>s-a)&&(!(O-U<o||o>U-k)&&!(v-B<o||o>B-V))}intersectsSphere(E){return V.IntersectsSphere(this.minimumWorld,this.maximumWorld,E.centerWorld,E.radiusWorld)}intersectsMinMax(E,b){const h=this.minimumWorld,a=this.maximumWorld,k=h.x,G=h.y,V=h.z,l=a.x,O=a.y,v=a.z,s=E.x,U=E.y,B=E.z,o=b.x,u=b.y,D=b.z;return!(l<s||k>o)&&(!(O<U||G>u)&&!(v<B||V>D))}dispose(){var E,b;null===(E=this._drawWrapperFront)||void 0===E||E.dispose(),null===(b=this._drawWrapperBack)||void 0===b||b.dispose()}static Intersects(E,b){return E.intersectsMinMax(b.minimumWorld,b.maximumWorld)}static IntersectsSphere(E,b,h,a){const G=V._TmpVector3[0];k.k.ClampToRef(h,E,b,G);return k.k.DistanceSquared(h,G)<=a*a}static IsCompletelyInFrustum(E,b){for(let h=0;h<6;++h){const a=b[h];for(let b=0;b<8;++b)if(a.dotCoordinate(E[b])<0)return!1}return!0}static IsInFrustum(E,b){for(let h=0;h<6;++h){let a=!0;const k=b[h];for(let b=0;b<8;++b)if(k.dotCoordinate(E[b])>=0){a=!1;break}if(a)return!1}return!0}}V._TmpVector3=(0,a.b)(3,k.k.Zero)},11325:(E,b,h)=>{"use strict";h.d(b,{b:()=>U});var a=h(11183),k=h(11175),G=h(11331),V=h(11335);const l={min:0,max:0},O={min:0,max:0},v=(E,b,h)=>{const a=k.k.Dot(b.centerWorld,E),G=Math.abs(k.k.Dot(b.directions[0],E))*b.extendSize.x+Math.abs(k.k.Dot(b.directions[1],E))*b.extendSize.y+Math.abs(k.k.Dot(b.directions[2],E))*b.extendSize.z;h.min=a-G,h.max=a+G},s=(E,b,h)=>(v(E,b,l),v(E,h,O),!(l.min>O.max||O.min>l.max));class U{constructor(E,b,h){this._isLocked=!1,this.boundingBox=new G.e(E,b,h),this.boundingSphere=new V.d(E,b,h)}reConstruct(E,b,h){this.boundingBox.reConstruct(E,b,h),this.boundingSphere.reConstruct(E,b,h)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(E){this._isLocked=E}update(E){this._isLocked||(this.boundingBox._update(E),this.boundingSphere._update(E))}centerOn(E,b){const h=U._TmpVector3[0].p(E).yi(b),a=U._TmpVector3[1].p(E).addInPlace(b);return this.boundingBox.reConstruct(h,a,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(h,a,this.boundingBox.getWorldMatrix()),this}encapsulate(E){const b=k.k.Minimize(this.minimum,E),h=k.k.Maximize(this.maximum,E);return this.reConstruct(b,h,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(E){const b=k.h.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(b);const h=k.h.o[0];return k.k.TransformCoordinatesToRef(E.boundingBox.minimumWorld,b,h),this.encapsulate(h),k.k.TransformCoordinatesToRef(E.boundingBox.maximumWorld,b,h),this.encapsulate(h),this}scale(E){return this.boundingBox.scale(E),this.boundingSphere.scale(E),this}isInFrustum(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===b||3===b)&&this.boundingSphere.isCenterInFrustum(E))return!0;if(!this.boundingSphere.isInFrustum(E))return!1;return!(1!==b&&3!==b)||this.boundingBox.isInFrustum(E)}get diagonalLength(){const E=this.boundingBox;return E.maximumWorld.subtractToRef(E.minimumWorld,U._TmpVector3[0]).length()}isCompletelyInFrustum(E){return this.boundingBox.isCompletelyInFrustum(E)}_checkCollision(E){return E._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(E){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(E)&&!!this.boundingBox.intersectsPoint(E))}intersects(E,b){if(!V.d.Intersects(this.boundingSphere,E.boundingSphere))return!1;if(!G.e.Intersects(this.boundingBox,E.boundingBox))return!1;if(!b)return!0;const h=this.boundingBox,a=E.boundingBox;return!!s(h.directions[0],h,a)&&(!!s(h.directions[1],h,a)&&(!!s(h.directions[2],h,a)&&(!!s(a.directions[0],h,a)&&(!!s(a.directions[1],h,a)&&(!!s(a.directions[2],h,a)&&(!!s(k.k.Cross(h.directions[0],a.directions[0]),h,a)&&(!!s(k.k.Cross(h.directions[0],a.directions[1]),h,a)&&(!!s(k.k.Cross(h.directions[0],a.directions[2]),h,a)&&(!!s(k.k.Cross(h.directions[1],a.directions[0]),h,a)&&(!!s(k.k.Cross(h.directions[1],a.directions[1]),h,a)&&(!!s(k.k.Cross(h.directions[1],a.directions[2]),h,a)&&(!!s(k.k.Cross(h.directions[2],a.directions[0]),h,a)&&(!!s(k.k.Cross(h.directions[2],a.directions[1]),h,a)&&!!s(k.k.Cross(h.directions[2],a.directions[2]),h,a))))))))))))))}}U._TmpVector3=(0,a.b)(2,k.k.Zero)},11335:(E,b,h)=>{"use strict";h.d(b,{d:()=>G});var a=h(11183),k=h(11175);class G{constructor(E,b,h){this.center=k.k.Zero(),this.centerWorld=k.k.Zero(),this.minimum=k.k.Zero(),this.maximum=k.k.Zero(),this.reConstruct(E,b,h)}reConstruct(E,b,h){this.minimum.p(E),this.maximum.p(b);const a=k.k.Distance(E,b);b.addToRef(E,this.center).scaleInPlace(.5),this.radius=.5*a,this._update(h||k.d.IdentityReadOnly)}scale(E){const b=this.radius*E,h=G._TmpVector3,a=h[0].te(b),k=this.center.subtractToRef(a,h[1]),V=this.center.addToRef(a,h[2]);return this.reConstruct(k,V,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(E){if(E.isIdentity())this.centerWorld.p(this.center),this.radiusWorld=this.radius;else{k.k.TransformCoordinatesToRef(this.center,E,this.centerWorld);const b=G._TmpVector3[0];k.k.TransformNormalFromFloatsToRef(1,1,1,E,b),this.radiusWorld=Math.max(Math.abs(b.x),Math.abs(b.y),Math.abs(b.z))*this.radius}}isInFrustum(E){const b=this.centerWorld,h=this.radiusWorld;for(let a=0;a<6;a++)if(E[a].dotCoordinate(b)<=-h)return!1;return!0}isCenterInFrustum(E){const b=this.centerWorld;for(let h=0;h<6;h++)if(E[h].dotCoordinate(b)<0)return!1;return!0}intersectsPoint(E){const b=k.k.DistanceSquared(this.centerWorld,E);return!(this.radiusWorld*this.radiusWorld<b)}static Intersects(E,b){const h=k.k.DistanceSquared(E.centerWorld,b.centerWorld),a=E.radiusWorld+b.radiusWorld;return!(a*a<h)}static CreateFromCenterAndRadius(E,b,h){this._TmpVector3[0].p(E),this._TmpVector3[1].ue(0,0,b),this._TmpVector3[2].p(E),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].yi(this._TmpVector3[1]);const a=new G(this._TmpVector3[0],this._TmpVector3[2]);return a._worldMatrix=h||k.d.Identity(),a}}G._TmpVector3=(0,a.b)(3,k.k.Zero)},11828:(E,b,h)=>{"use strict";h.d(b,{d:()=>o});var a=h(11163),k=h(11426),G=h(11177),V=h(11175),l=h(11183),O=h(11322),v=h(11231),s=h(10869),U=h(11273);const B={internalPickerForMesh:void 0};class o{constructor(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:G.d;this.origin=E,this.direction=b,this.length=h,this.epsilon=a}clone(){return new o(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const a=o._TmpVector3[0].ue(E.x-h,E.y-h,E.z-h),k=o._TmpVector3[1].ue(b.x+h,b.y+h,b.z+h);let G,V,l,O,v=0,s=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<a.x||this.origin.x>k.x)return!1}else if(G=1/this.direction.x,V=(a.x-this.origin.x)*G,l=(k.x-this.origin.x)*G,l===-1/0&&(l=1/0),V>l&&(O=V,V=l,l=O),v=Math.max(V,v),s=Math.min(l,s),v>s)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<a.y||this.origin.y>k.y)return!1}else if(G=1/this.direction.y,V=(a.y-this.origin.y)*G,l=(k.y-this.origin.y)*G,l===-1/0&&(l=1/0),V>l&&(O=V,V=l,l=O),v=Math.max(V,v),s=Math.min(l,s),v>s)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<a.z||this.origin.z>k.z)return!1}else if(G=1/this.direction.z,V=(a.z-this.origin.z)*G,l=(k.z-this.origin.z)*G,l===-1/0&&(l=1/0),V>l&&(O=V,V=l,l=O),v=Math.max(V,v),s=Math.min(l,s),v>s)return!1;return!0}intersectsBox(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(E.minimum,E.maximum,b)}intersectsSphere(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const h=E.center.x-this.origin.x,a=E.center.y-this.origin.y,k=E.center.z-this.origin.z,G=h*h+a*a+k*k,V=E.radius+b,l=V*V;if(G<=l)return!0;const O=h*this.direction.x+a*this.direction.y+k*this.direction.z;if(O<0)return!1;return G-O*O<=l}intersectsTriangle(E,b,h){const a=o._TmpVector3[0],k=o._TmpVector3[1],G=o._TmpVector3[2],l=o._TmpVector3[3],v=o._TmpVector3[4];b.subtractToRef(E,a),h.subtractToRef(E,k),V.k.CrossToRef(this.direction,k,G);const s=V.k.Dot(a,G);if(0===s)return null;const U=1/s;this.origin.subtractToRef(E,l);const B=V.k.Dot(l,G)*U;if(B<-this.epsilon||B>1+this.epsilon)return null;V.k.CrossToRef(l,a,v);const u=V.k.Dot(this.direction,v)*U;if(u<-this.epsilon||B+u>1+this.epsilon)return null;const D=V.k.Dot(k,v)*U;return D>this.length?null:new O.d(1-B-u,B,D)}intersectsPlane(E){let b;const h=V.k.Dot(E.k,this.direction);if(Math.abs(h)<9.99999997475243e-7)return null;{const a=V.k.Dot(E.k,this.origin);return b=(-E.d-a)/h,b<0?b<-9.99999997475243e-7?null:0:b}}intersectsAxis(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(E){case"y":{const E=(this.origin.y-b)/this.direction.y;return E>0?null:new V.k(this.origin.x+this.direction.x*-E,b,this.origin.z+this.direction.z*-E)}case"x":{const E=(this.origin.x-b)/this.direction.x;return E>0?null:new V.k(b,this.origin.y+this.direction.y*-E,this.origin.z+this.direction.z*-E)}case"z":{const E=(this.origin.z-b)/this.direction.z;return E>0?null:new V.k(this.origin.x+this.direction.x*-E,this.origin.y+this.direction.y*-E,b)}default:return null}}intersectsMesh(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4?arguments[4]:void 0,G=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const l=V.h.Matrix[0];return E.getWorldMatrix().invertToRef(l),this._tmpRay?o.TransformToRef(this,l,this._tmpRay):this._tmpRay=o.Transform(this,l),E.intersects(this._tmpRay,b,h,a,k,G)}intersectsMeshes(E,b,h){h?h.length=0:h=[];for(let a=0;a<E.length;a++){const k=this.intersectsMesh(E[a],b);k.hit&&h.push(k)}return h.sort(this._comparePickingInfo),h}_comparePickingInfo(E,b){return E.distance<b.distance?-1:E.distance>b.distance?1:0}intersectionSegment(E,b,h){const a=this.origin,k=V.h.o[0],G=V.h.o[1],l=V.h.o[2],O=V.h.o[3];b.subtractToRef(E,k),this.direction.scaleToRef(o._Rayl,l),a.addToRef(l,G),E.subtractToRef(a,O);const v=V.k.Dot(k,k),s=V.k.Dot(k,l),U=V.k.Dot(l,l),B=V.k.Dot(k,O),u=V.k.Dot(l,O),D=v*U-s*s;let g,S,M=D,I=D;D<o._Smallnum?(g=0,M=1,S=u,I=U):(g=s*u-U*B,S=v*u-s*B,g<0?(g=0,S=u,I=U):g>M&&(g=M,S=u+s,I=U)),S<0?(S=0,-B<0?g=0:-B>v?g=M:(g=-B,M=v)):S>I&&(S=I,-B+s<0?g=0:-B+s>v?g=M:(g=-B+s,M=v));const j=Math.abs(g)<o._Smallnum?0:g/M,P=Math.abs(S)<o._Smallnum?0:S/I,A=V.h.o[4];l.scaleToRef(P,A);const n=V.h.o[5];k.scaleToRef(j,n),n.addInPlace(O);const d=V.h.o[6];n.subtractToRef(A,d);return P>0&&P<=this.length&&d.lengthSquared()<h*h?n.length():-1}update(E,b,h,a,k,G,l){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){o._RayDistant||(o._RayDistant=o.Zero()),o._RayDistant.unprojectRayToRef(E,b,h,a,V.d.IdentityReadOnly,G,l);const O=V.h.Matrix[0];k.invertToRef(O),o.TransformToRef(o._RayDistant,O,this)}else this.unprojectRayToRef(E,b,h,a,k,G,l);return this}static Zero(){return new o(V.k.Zero(),V.k.Zero())}static CreateNew(E,b,h,a,k,G,V){return o.Zero().update(E,b,h,a,k,G,V)}static CreateNewFromTo(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:V.d.IdentityReadOnly;const a=new o(new V.k(0,0,0),new V.k(0,0,0));return o.CreateFromToToRef(E,b,a,h)}static CreateFromToToRef(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:V.d.IdentityReadOnly;h.origin.p(E);const k=b.subtractToRef(E,h.direction),G=Math.sqrt(k.x*k.x+k.y*k.y+k.z*k.z);return h.length=G,h.direction.normalize(),o.TransformToRef(h,a,h)}static Transform(E,b){const h=new o(new V.k(0,0,0),new V.k(0,0,0));return o.TransformToRef(E,b,h),h}static TransformToRef(E,b,h){V.k.TransformCoordinatesToRef(E.origin,b,h.origin),V.k.TransformNormalToRef(E.direction,b,h.direction),h.length=E.length,h.epsilon=E.epsilon;const a=h.direction,k=a.length();if(0!==k&&1!==k){const E=1/k;a.x*=E,a.y*=E,a.z*=E,h.length*=k}return h}unprojectRayToRef(E,b,h,a,k,G,l){const O=V.h.Matrix[0];k.multiplyToRef(G,O),O.multiplyToRef(l,O),O.invert();const v=s.b.LastCreatedEngine,U=V.h.o[0];U.x=E/h*2-1,U.y=-(b/a*2-1),U.z=null!==v&&void 0!==v&&v.useReverseDepthBuffer?1:null!==v&&void 0!==v&&v.isNDCHalfZRange?0:-1;const B=V.h.o[1].ue(U.x,U.y,1-1e-8),o=V.h.o[2],u=V.h.o[3];V.k._UnprojectFromInvertedMatrixToRef(U,O,o),V.k._UnprojectFromInvertedMatrixToRef(B,O,u),this.origin.p(o),u.subtractToRef(o,this.direction),this.direction.normalize()}}function u(E,b,h,a,k){let G=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const V=o.Zero();return D(E,b,h,a,V,k,G),V}function D(E,b,h,a,k,G){let l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],O=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const v=E.getEngine();if(!G&&!(G=E.activeCamera))return E;const s=G.viewport,U=v.getRenderHeight(),{x:B,y:o,width:u,height:D}=s.toGlobal(v.getRenderWidth(),U),g=1/v.getHardwareScalingLevel();return b=b*g-B,h=h*g-(U-o-D),k.update(b,h,u,D,a||V.d.IdentityReadOnly,l?V.d.IdentityReadOnly:G.getViewMatrix(),G.getProjectionMatrix(),O),E}function g(E,b,h,a,k){if(!v.d)return E;const G=E.getEngine();if(!k&&!(k=E.activeCamera))throw new Error("Active camera not set");const l=k.viewport,O=G.getRenderHeight(),{x:s,y:U,width:B,height:o}=l.toGlobal(G.getRenderWidth(),O),u=V.d.Identity(),D=1/G.getHardwareScalingLevel();return b=b*D-s,h=h*D-(O-U-o),a.update(b,h,B,o,u,u,k.getProjectionMatrix()),E}function S(E,b,h,a,k,G,V,l){const O=b(a,h.enableDistantPicking),v=h.intersects(O,k,V,G,a,l);return v&&v.hit?!k&&null!=E&&v.distance>=E.distance?null:v:null}function M(E,b,h,a,k,G){let l=null;const O=!!(E.activeCameras&&E.activeCameras.length>1&&E.cameraToUseForPointers!==E.activeCamera),s=E.cameraToUseForPointers||E.activeCamera,U=B.internalPickerForMesh||S;for(let v=0;v<E.meshes.length;v++){const B=E.meshes[v];if(h){if(!h(B,-1))continue}else if(!B.isEnabled()||!B.isVisible||!B.zb)continue;const o=O&&B.isWorldMatrixCameraDependent(),u=B.Wj(o,s);if(B.hasThinInstances&&B.thinInstanceEnablePicking){const E=U(l,b,B,u,!0,!0,G);if(E){if(k)return E;const O=V.h.Matrix[1],v=B.thinInstanceGetWorldMatrices();for(let E=0;E<v.length;E++){if(h&&!h(B,E))continue;v[E].multiplyToRef(u,O);const V=U(l,b,B,O,a,k,G,!0);if(V&&(l=V,l.thinInstanceIndex=E,a))return l}}}else{const E=U(l,b,B,u,a,k,G);if(E&&(l=E,a))return l}}return l||new v.d}function I(E,b,h,a){if(!v.d)return null;const k=[],G=!!(E.activeCameras&&E.activeCameras.length>1&&E.cameraToUseForPointers!==E.activeCamera),l=E.cameraToUseForPointers||E.activeCamera,O=B.internalPickerForMesh||S;for(let v=0;v<E.meshes.length;v++){const s=E.meshes[v];if(h){if(!h(s,-1))continue}else if(!s.isEnabled()||!s.isVisible||!s.zb)continue;const U=G&&s.isWorldMatrixCameraDependent(),B=s.Wj(U,l);if(s.hasThinInstances&&s.thinInstanceEnablePicking){if(O(null,b,s,B,!0,!0,a)){const E=V.h.Matrix[1],G=s.thinInstanceGetWorldMatrices();for(let V=0;V<G.length;V++){if(h&&!h(s,V))continue;G[V].multiplyToRef(B,E);const l=O(null,b,s,E,!1,!1,a,!0);l&&(l.thinInstanceIndex=V,k.push(l))}}}else{const E=O(null,b,s,B,!1,!1,a);E&&k.push(E)}}return k}function j(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,a=arguments.length>3?arguments[3]:void 0,k=arguments.length>4?arguments[4]:void 0;a||(a=E.getWorldMatrix()),b.length=h,k?b.origin.p(k):b.origin.p(E.position);const G=V.h.o[2];G.set(0,0,E._scene.useRightHandedSystem?-1:1);const l=V.h.o[3];return V.k.TransformNormalToRef(G,a,l),V.k.NormalizeToRef(l,b.direction),b}var P,A;o._TmpVector3=(0,l.b)(6,V.k.Zero),o._RayDistant=o.Zero(),o._Smallnum=1e-8,o._Rayl=1e9,P=a.e,(A=k.b)&&(A.prototype.getForwardRay=function(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,b=arguments.length>1?arguments[1]:void 0,h=arguments.length>2?arguments[2]:void 0;return j(this,new o(V.k.Zero(),V.k.Zero(),E),E,b,h)},A.prototype.getForwardRayToRef=function(E){return j(this,E,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),P&&(U.d._IsPickingAvailable=!0,P.prototype.createPickingRay=function(E,b,h,a){return u(this,E,b,h,a,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),a.e.prototype.createPickingRayToRef=function(E,b,h,a,k){return D(this,E,b,h,a,k,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},a.e.prototype.createPickingRayInCameraSpace=function(E,b,h){return function(E,b,h,a){const k=o.Zero();return g(E,b,h,k,a),k}(this,E,b,h)},a.e.prototype.createPickingRayInCameraSpaceToRef=function(E,b,h,a){return g(this,E,b,h,a)},a.e.prototype.pickWithBoundingInfo=function(E,b,h,a,k){return function(E,b,h,a,k,G){if(!v.d)return null;const l=M(E,(a=>(E._tempPickingRay||(E._tempPickingRay=o.Zero()),D(E,b,h,a,E._tempPickingRay,G||null),E._tempPickingRay)),a,k,!0);return l&&(l.ray=u(E,b,h,V.d.Identity(),G||null)),l}(this,E,b,h,a,k)},a.e.prototype.Uc=function(E,b,h,a,k,G){return function(E,b,h,a,k,G,l){const O=M(E,((a,k)=>(E._tempPickingRay||(E._tempPickingRay=o.Zero()),D(E,b,h,a,E._tempPickingRay,G||null,!1,k),E._tempPickingRay)),a,k,!1,l);return O&&(O.ray=u(E,b,h,V.d.Identity(),G||null)),O}(this,E,b,h,a,k,G)},a.e.prototype.pickWithRay=function(E,b,h,a){return function(E,b,h,a,k){const G=M(E,(h=>(E._pickWithRayInverseMatrix||(E._pickWithRayInverseMatrix=V.d.Identity()),h.invertToRef(E._pickWithRayInverseMatrix),E._cachedRayForTransform||(E._cachedRayForTransform=o.Zero()),o.TransformToRef(b,E._pickWithRayInverseMatrix,E._cachedRayForTransform),E._cachedRayForTransform)),h,a,!1,k);return G&&(G.ray=b),G}(this,E,b,h,a)},a.e.prototype.multiPick=function(E,b,h,a,k){return function(E,b,h,a,k,G){return I(E,(a=>u(E,b,h,a,k||null)),a,G)}(this,E,b,h,a,k)},a.e.prototype.multiPickWithRay=function(E,b,h){return function(E,b,h,a){return I(E,(h=>(E._pickWithRayInverseMatrix||(E._pickWithRayInverseMatrix=V.d.Identity()),h.invertToRef(E._pickWithRayInverseMatrix),E._cachedRayForTransform||(E._cachedRayForTransform=o.Zero()),o.TransformToRef(b,E._pickWithRayInverseMatrix,E._cachedRayForTransform),E._cachedRayForTransform)),h,a)}(this,E,b,h)}},11719:(E,b,h)=>{"use strict";var a=h(10939),k=h(10834),G=h(10878),V=h(10966),l=h(10902),O=h(10947);l.d.prototype._partialLoadFile=function(E,b,h,a){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(E,(E=>{h[b]=E,h._internalCount++,6===h._internalCount&&a(h)}),void 0,void 0,!0,((E,b)=>{k&&E&&k(E.status+" "+E.statusText,b)}))},l.d.prototype._cascadeLoadFiles=function(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const k=[];k._internalCount=0;for(let G=0;G<6;G++)this._partialLoadFile(h[G],G,k,b,a)},l.d.prototype._cascadeLoadImgs=function(E,b,h,a){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5?arguments[5]:void 0;const V=[];V._internalCount=0;for(let l=0;l<6;l++)this._partialLoadImg(a[l],l,V,E,b,h,k,G)},l.d.prototype._partialLoadImg=function(E,b,h,a,k,l){let O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,v=arguments.length>7?arguments[7]:void 0;const s=(0,V.e)();(0,G.r)(E,(E=>{h[b]=E,h._internalCount++,a&&a.removePendingData(s),6===h._internalCount&&l&&l(k,h)}),((E,b)=>{a&&a.removePendingData(s),O&&O(E,b)}),a?a.offlineProvider:null,v),a&&a.addPendingData(s)},l.d.prototype.createCubeTextureBase=function(E,b,h,G){let V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6?arguments[6]:void 0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,U=arguments.length>8&&void 0!==arguments[8]&&arguments[8],B=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,o=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,u=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,D=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,g=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,S=arguments.length>14&&void 0!==arguments[14]&&arguments[14],M=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const I=u||new a.b(this,7);I.isCube=!0,I.url=E,I.generateMipMaps=!G,I._lodGenerationScale=B,I._lodGenerationOffset=o,I._useSRGBBuffer=!!S&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!G),I!==u&&(I.label=E.substring(0,60)),this._doNotHandleContextLost||(I._extension=s,I._files=h,I._buffer=M);const j=E;this._transformTextureUrl&&!u&&(E=this._transformTextureUrl(E));const P=E.split("?")[0],A=P.lastIndexOf("."),n=s||(A>-1?P.substring(A).toLowerCase():""),d=(0,O.d)(n),c=(a,O)=>{E===j?l&&a&&l(a.status+" "+a.statusText,O):(k.c.Warn(`Failed to load ${E}, falling back to the ${j}`),this.createCubeTextureBase(j,b,h,!!G,V,l,v,s,U,B,o,I,D,g,S,M))};if(d)d.then((a=>{const G=E=>{D&&D(I,E),a.loadCubeData(E,I,U,V,l)};M?G(M):h&&6===h.length?a.supportCascades?this._cascadeLoadFiles(b,(E=>G(E.map((E=>new Uint8Array(E))))),h,l):l?l("Textures type does not support cascades."):k.c.Warn("Texture loader does not support cascades."):this._loadFile(E,(E=>G(new Uint8Array(E))),void 0,void 0,!0,c)}));else{if(!h||0===h.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(b,I,((E,b)=>{g&&g(E,b)}),h,l)}return this._internalTexturesCache.push(I),I}},11653:(E,b,h)=>{"use strict";h(10902).d.prototype.createDepthStencilTexture=function(E,b,h){if(b.isCube){const h=E.width||E;return this._createDepthStencilCubeTexture(h,b)}return this._createDepthStencilTexture(E,b,h)}},11631:(E,b,h)=>{"use strict";h(11594).ThinEngine.prototype.setAlphaMode=function(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._alphaMode!==E){switch(E){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}b||(this.depthCullingState.depthMask=0===E),this._alphaMode=E}else if(!b){const b=0===E;this.depthCullingState.depthMask!==b&&(this.depthCullingState.depthMask=b)}}},11588:(E,b,h)=>{"use strict";var a=h(11594);a.ThinEngine.prototype.updateDynamicIndexBuffer=function(E,b){let h;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(E),h=E.is32Bits?b instanceof Uint32Array?b:new Uint32Array(b):b instanceof Uint16Array?b:new Uint16Array(b),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,h,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},a.ThinEngine.prototype.updateDynamicVertexBuffer=function(E,b,h,a){this.bindArrayBuffer(E),void 0===h&&(h=0);const k=b.byteLength||b.length;void 0===a||a>=k&&0===h?b instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,h,new Float32Array(b)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,h,b):b instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(b).subarray(h,h+a)):(b=b instanceof ArrayBuffer?new Uint8Array(b,h,a):new Uint8Array(b.buffer,b.byteOffset+h,a),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,b)),this._resetVertexBufferBinding()}},11644:(E,b,h)=>{"use strict";var a=h(10939),k=h(10834),G=h(11594),V=h(11647);class l extends V.d{constructor(E,b,h,a,k){super(E,b,h,a),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=k}_cloneRenderTargetWrapper(){let E=null;return this._colorTextureArray&&this._depthStencilTextureArray?(E=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),E.texture.isReady=!0):E=super._cloneRenderTargetWrapper(),E}_swapRenderTargetWrapper(E){super._swapRenderTargetWrapper(E),E._framebuffer=this._framebuffer,E._depthStencilBuffer=this._depthStencilBuffer,E._MSAAFramebuffer=this._MSAAFramebuffer,E._colorTextureArray=this._colorTextureArray,E._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,G=arguments.length>5?arguments[5]:void 0;if(this._depthStencilBuffer){const E=this._engine,b=E._currentFramebuffer,h=this._context;E._bindUnboundFramebuffer(this._framebuffer),h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,null),h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,null),h.framebufferRenderbuffer(h.FRAMEBUFFER,h.STENCIL_ATTACHMENT,h.RENDERBUFFER,null),E._bindUnboundFramebuffer(b),h.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(E,b,h,a,k,G)}shareDepth(E){super.shareDepth(E);const b=this._context,h=this._depthStencilBuffer,a=E._MSAAFramebuffer||E._framebuffer,k=this._engine;E._depthStencilBuffer&&E._depthStencilBuffer!==h&&b.deleteRenderbuffer(E._depthStencilBuffer),E._depthStencilBuffer=h;const G=E._generateStencilBuffer?b.DEPTH_STENCIL_ATTACHMENT:b.DEPTH_ATTACHMENT;k._bindUnboundFramebuffer(a),b.framebufferRenderbuffer(b.FRAMEBUFFER,G,b.RENDERBUFFER,h),k._bindUnboundFramebuffer(null)}_bindTextureRenderTarget(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!E._hardwareTexture)return;const k=this._framebuffer,G=this._engine,V=G._currentFramebuffer;if(G._bindUnboundFramebuffer(k),G.webGLVersion>1){const k=this._context,G=k["COLOR_ATTACHMENT"+b];var l;if(E.is2DArray||E.is3D)h=h??(null===(l=this.layerIndices)||void 0===l?void 0:l[b])??0,k.framebufferTextureLayer(k.FRAMEBUFFER,G,E._hardwareTexture.underlyingResource,a,h);else if(E.isCube){var O;h=h??(null===(O=this.faceIndices)||void 0===O?void 0:O[b])??0,k.framebufferTexture2D(k.FRAMEBUFFER,G,k.TEXTURE_CUBE_MAP_POSITIVE_X+h,E._hardwareTexture.underlyingResource,a)}else k.framebufferTexture2D(k.FRAMEBUFFER,G,k.TEXTURE_2D,E._hardwareTexture.underlyingResource,a)}else{const k=this._context,G=k["COLOR_ATTACHMENT"+b+"_WEBGL"],V=void 0!==h?k.TEXTURE_CUBE_MAP_POSITIVE_X+h:k.TEXTURE_2D;k.framebufferTexture2D(k.FRAMEBUFFER,G,V,E._hardwareTexture.underlyingResource,a)}G._bindUnboundFramebuffer(V)}setTexture(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super.setTexture(E,b,h),this._bindTextureRenderTarget(E,b)}setLayerAndFaceIndices(E,b){var h;if(super.setLayerAndFaceIndices(E,b),!this.textures||!this.layerIndices||!this.faceIndices)return;const a=(null===(h=this._attachments)||void 0===h?void 0:h.length)??this.textures.length;for(let k=0;k<a;k++){const E=this.textures[k];E&&(E.is2DArray||E.is3D?this._bindTextureRenderTarget(E,k,this.layerIndices[k]):E.isCube?this._bindTextureRenderTarget(E,k,this.faceIndices[k]):this._bindTextureRenderTarget(E,k))}}setLayerAndFaceIndex(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1?arguments[1]:void 0,h=arguments.length>2?arguments[2]:void 0;if(super.setLayerAndFaceIndex(E,b,h),!this.textures||!this.layerIndices||!this.faceIndices)return;const a=this.textures[E];a.is2DArray||a.is3D?this._bindTextureRenderTarget(this.textures[E],E,this.layerIndices[E]):a.isCube&&this._bindTextureRenderTarget(this.textures[E],E,this.faceIndices[E])}dispose(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._disposeOnlyFramebuffers;const b=this._context;E||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(b.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(b.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(b.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(E)}}h(11653);G.ThinEngine.prototype._createHardwareRenderTargetWrapper=function(E,b,h){const a=new l(E,b,h,this,this._gl);return this._renderTargetWrapperCache.push(a),a},G.ThinEngine.prototype.createRenderTargetTexture=function(E,b){const h=this._createHardwareRenderTargetWrapper(!1,!1,E);let a,k,G=!0,V=!1,l=!1,O=1;void 0!==b&&"object"===typeof b&&(G=b.generateDepthBuffer??!0,V=!!b.generateStencilBuffer,l=!!b.noColorAttachment,a=b.colorAttachment,O=b.samples??1,k=b.label);const v=a||(l?null:this._createInternalTexture(E,b,!0,5)),s=E.width||E,U=E.height||E,B=this._currentFramebuffer,o=this._gl,u=o.createFramebuffer();if(this._bindUnboundFramebuffer(u),h._depthStencilBuffer=this._setupFramebufferDepthAttachments(V,G,s,U),!v||v.is2DArray||v.is3D||o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,v._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(B),h.label=k??"RenderTargetWrapper",h._framebuffer=u,h._generateDepthBuffer=G,h._generateStencilBuffer=V,h.setTextures(v),a){if(h._samples=a.samples,a.samples>1){const E=a._hardwareTexture.getMSAARenderBuffer(0);h._MSAAFramebuffer=o.createFramebuffer(),this._bindUnboundFramebuffer(h._MSAAFramebuffer),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.RENDERBUFFER,E),this._bindUnboundFramebuffer(null)}}else this.updateRenderTargetTextureSampleCount(h,O);return h},G.ThinEngine.prototype._createDepthStencilTexture=function(E,b,h){const G=this._gl,V=E.layers||0,l=E.depth||0;let O=G.TEXTURE_2D;0!==V?O=G.TEXTURE_2D_ARRAY:0!==l&&(O=G.TEXTURE_3D);const v=new a.b(this,12);if(v.label=b.label,!this._caps.depthTextureExtension)return k.c.Error("Depth texture is not supported by your browser or hardware."),v;const s={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...b};if(this._bindTextureDirectly(O,v,!0),this._setupDepthStencilTexture(v,E,0!==s.comparisonFunction&&s.bilinearFiltering,s.comparisonFunction,s.samples),void 0!==s.depthTextureFormat){if(15!==s.depthTextureFormat&&16!==s.depthTextureFormat&&17!==s.depthTextureFormat&&13!==s.depthTextureFormat&&14!==s.depthTextureFormat&&18!==s.depthTextureFormat)return k.c.Error(`Depth texture ${s.depthTextureFormat} format is not supported.`),v;v.format=s.depthTextureFormat}else v.format=s.generateStencil?13:16;const U=17===v.format||13===v.format||18===v.format;let B=G.UNSIGNED_INT;15===v.format?B=G.UNSIGNED_SHORT:17===v.format||13===v.format?B=G.UNSIGNED_INT_24_8:14===v.format?B=G.FLOAT:18===v.format&&(B=G.FLOAT_32_UNSIGNED_INT_24_8_REV);const o=U?G.DEPTH_STENCIL:G.DEPTH_COMPONENT,u=this._getInternalFormatFromDepthTextureFormat(v.format,!0,U);return v.is2DArray?G.texImage3D(O,0,u,v.width,v.height,V,0,o,B,null):v.is3D?G.texImage3D(O,0,u,v.width,v.height,l,0,o,B,null):G.texImage2D(O,0,u,v.width,v.height,0,o,B,null),this._bindTextureDirectly(O,null),this._internalTexturesCache.push(v),h._depthStencilBuffer&&(G.deleteRenderbuffer(h._depthStencilBuffer),h._depthStencilBuffer=null),this._bindUnboundFramebuffer(h._MSAAFramebuffer??h._framebuffer),h._generateStencilBuffer=U,h._depthStencilTextureWithStencil=U,h._depthStencilBuffer=this._setupFramebufferDepthAttachments(h._generateStencilBuffer,h._generateDepthBuffer,h.width,h.height,h.samples,v.format),this._bindUnboundFramebuffer(null),v},G.ThinEngine.prototype.updateRenderTargetTextureSampleCount=function(E,b){var h;if(this.webGLVersion<2||!E)return 1;if(E.samples===b)return b;const a=this._gl;b=Math.min(b,this.getCaps().maxMSAASamples),E._depthStencilBuffer&&(a.deleteRenderbuffer(E._depthStencilBuffer),E._depthStencilBuffer=null),E._MSAAFramebuffer&&(a.deleteFramebuffer(E._MSAAFramebuffer),E._MSAAFramebuffer=null);const k=null===(h=E.texture)||void 0===h?void 0:h._hardwareTexture;if(null===k||void 0===k||k.releaseMSAARenderBuffers(),E.texture&&b>1&&"function"===typeof a.renderbufferStorageMultisample){const h=a.createFramebuffer();if(!h)throw new Error("Unable to create multi sampled framebuffer");E._MSAAFramebuffer=h,this._bindUnboundFramebuffer(E._MSAAFramebuffer);const G=this._createRenderBuffer(E.texture.width,E.texture.height,b,-1,this._getRGBABufferInternalSizedFormat(E.texture.type,E.texture.format,E.texture._useSRGBBuffer),a.COLOR_ATTACHMENT0,!1);if(!G)throw new Error("Unable to create multi sampled framebuffer");null===k||void 0===k||k.addMSAARenderBuffer(G)}this._bindUnboundFramebuffer(E._MSAAFramebuffer??E._framebuffer),E.texture&&(E.texture.samples=b),E._samples=b;const G=E._depthStencilTexture?E._depthStencilTexture.format:void 0;return E._depthStencilBuffer=this._setupFramebufferDepthAttachments(E._generateStencilBuffer,E._generateDepthBuffer,E.width,E.height,b,G),this._bindUnboundFramebuffer(null),b},G.ThinEngine.prototype._setupDepthStencilTexture=function(E,b,h,a){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const G=b.width??b,V=b.height??b,l=b.layers||0,O=b.depth||0;E.baseWidth=G,E.baseHeight=V,E.width=G,E.height=V,E.is2DArray=l>0,E.depth=l||O,E.isReady=!0,E.samples=k,E.generateMipMaps=!1,E.samplingMode=h?2:1,E.type=0,E._comparisonFunction=a;const v=this._gl,s=this._getTextureTarget(E),U=this._getSamplingParameters(E.samplingMode,!1);v.texParameteri(s,v.TEXTURE_MAG_FILTER,U.mag),v.texParameteri(s,v.TEXTURE_MIN_FILTER,U.min),v.texParameteri(s,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(s,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===a?(v.texParameteri(s,v.TEXTURE_COMPARE_FUNC,515),v.texParameteri(s,v.TEXTURE_COMPARE_MODE,v.NONE)):(v.texParameteri(s,v.TEXTURE_COMPARE_FUNC,a),v.texParameteri(s,v.TEXTURE_COMPARE_MODE,v.COMPARE_REF_TO_TEXTURE)))}},10889:(E,b,h)=>{"use strict";h.d(b,{c:()=>d,g:()=>A,i:()=>n,m:()=>N,o:()=>H});class a{constructor(){this.children=[]}isValid(E){return!0}process(E,b){let h="";if(this.line){let v=this.line;const s=b.processor;if(s){var a,k,G,V,l,O;s.lineProcessor&&(v=s.lineProcessor(v,b.isFragment,b.processingContext));const h=(null===(a=b.processor)||void 0===a?void 0:a.attributeKeywordName)??"attribute",U=b.isFragment&&null!==(k=b.processor)&&void 0!==k&&k.varyingFragmentKeywordName?null===(G=b.processor)||void 0===G?void 0:G.varyingFragmentKeywordName:!b.isFragment&&null!==(V=b.processor)&&void 0!==V&&V.varyingVertexKeywordName?null===(l=b.processor)||void 0===l?void 0:l.varyingVertexKeywordName:"varying";if(!b.isFragment&&s.attributeProcessor&&this.line.startsWith(h))v=s.attributeProcessor(this.line,E,b.processingContext);else if(s.varyingProcessor&&(null!==(O=s.varyingCheck)&&void 0!==O&&O.call(s,this.line,b.isFragment)||!s.varyingCheck&&this.line.startsWith(U)))v=s.varyingProcessor(this.line,b.isFragment,E,b.processingContext);else if(s.uniformProcessor&&s.uniformRegexp&&s.uniformRegexp.test(this.line))b.lookForClosingBracketForUniformBuffer||(v=s.uniformProcessor(this.line,b.isFragment,E,b.processingContext));else if(s.uniformBufferProcessor&&s.uniformBufferRegexp&&s.uniformBufferRegexp.test(this.line))b.lookForClosingBracketForUniformBuffer||(v=s.uniformBufferProcessor(this.line,b.isFragment,b.processingContext),b.lookForClosingBracketForUniformBuffer=!0);else if(s.textureProcessor&&s.textureRegexp&&s.textureRegexp.test(this.line))v=s.textureProcessor(this.line,b.isFragment,E,b.processingContext);else if((s.uniformProcessor||s.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!b.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?s.uniformProcessor&&(v=s.uniformProcessor(this.line,b.isFragment,E,b.processingContext)):s.uniformBufferProcessor&&(v=s.uniformBufferProcessor(this.line,b.isFragment,b.processingContext),b.lookForClosingBracketForUniformBuffer=!0)}b.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(b.lookForClosingBracketForUniformBuffer=!1,s.endOfUniformBufferProcessor&&(v=s.endOfUniformBufferProcessor(this.line,b.isFragment,b.processingContext)))}h+=v+"\n"}return this.children.forEach((a=>{h+=a.process(E,b)})),this.additionalDefineKey&&(E[this.additionalDefineKey]=this.additionalDefineValue||"true"),h}}class k{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(E){this._lines.length=0;for(const b of E){if(!b||"\r"===b)continue;if("#"===b[0]){this._lines.push(b);continue}const E=b.trim();if(!E)continue;if(E.startsWith("//")){this._lines.push(b);continue}const h=E.indexOf(";");if(-1===h)this._lines.push(E);else if(h===E.length-1)E.length>1&&this._lines.push(E);else{const E=b.split(";");for(let b=0;b<E.length;b++){let h=E[b];h&&(h=h.trim(),h&&this._lines.push(h+(b!==E.length-1?";":"")))}}}}}class G extends a{process(E,b){for(let h=0;h<this.children.length;h++){const a=this.children[h];if(a.isValid(E))return a.process(E,b)}return""}}class V extends a{isValid(E){return this.testExpression.isTrue(E)}}class l{isTrue(E){return!0}static postfixToInfix(E){const b=[];for(const h of E)if(void 0===l._OperatorPriority[h])b.push(h);else{const E=b[b.length-1],a=b[b.length-2];b.length-=2,b.push(`(${a}${h}${E})`)}return b[b.length-1]}static infixToPostfix(E){const b=l._InfixToPostfixCache.get(E);if(b)return b.accessTime=Date.now(),b.result;if(!E.includes("&&")&&!E.includes("||")&&!E.includes(")")&&!E.includes("("))return[E];const h=[];let a=-1;const k=()=>{s=s.trim(),""!==s&&(h.push(s),s="")},G=E=>{a<l._Stack.length-1&&(l._Stack[++a]=E)},V=()=>l._Stack[a],O=()=>-1===a?"!!INVALID EXPRESSION!!":l._Stack[a--];let v=0,s="";for(;v<E.length;){const b=E.charAt(v),U=v<E.length-1?E.substring(v,2+v):"";if("("===b)s="",G(b);else if(")"===b){for(k();-1!==a&&"("!==V();)h.push(O());O()}else if(l._OperatorPriority[U]>1){for(k();-1!==a&&l._OperatorPriority[V()]>=l._OperatorPriority[U];)h.push(O());G(U),v++}else s+=b;v++}for(k();-1!==a;)"("===V()?O():h.push(O());return l._InfixToPostfixCache.size>=l.InfixToPostfixCacheLimitSize&&l.ClearCache(),l._InfixToPostfixCache.set(E,{result:h,accessTime:Date.now()}),h}static ClearCache(){const E=Array.from(l._InfixToPostfixCache.entries()).sort(((E,b)=>E[1].accessTime-b[1].accessTime));for(let b=0;b<l.InfixToPostfixCacheCleanupSize;b++)l._InfixToPostfixCache.delete(E[b][0])}}l.InfixToPostfixCacheLimitSize=5e4,l.InfixToPostfixCacheCleanupSize=25e3,l._InfixToPostfixCache=new Map,l._OperatorPriority={")":0,"(":1,"||":2,"&&":3},l._Stack=["","","","","","","","","","","","","","","","","","","",""];class O extends l{constructor(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=E,this.not=b}isTrue(E){let b=void 0!==E[this.define];return this.not&&(b=!b),b}}class v extends l{isTrue(E){return this.leftOperand.isTrue(E)||this.rightOperand.isTrue(E)}}class s extends l{isTrue(E){return this.leftOperand.isTrue(E)&&this.rightOperand.isTrue(E)}}class U extends l{constructor(E,b,h){super(),this.define=E,this.operand=b,this.testValue=h}isTrue(E){let b=E[this.define];void 0===b&&(b=this.define);let h=!1;const a=parseInt(b),k=parseInt(this.testValue);switch(this.operand){case">":h=a>k;break;case"<":h=a<k;break;case"<=":h=a<=k;break;case">=":h=a>=k;break;case"==":h=a===k;break;case"!=":h=a!==k}return h}}var B=h(10855),o=h(10893);const u=/defined\s*?\((.+?)\)/g,D=/defined\s*?\[(.+?)\]/g,g=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,S=/__decl__/,M=/light\{X\}.(\w*)/g,I=/\{X\}/g,j=[],P=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function A(E){E.processor&&E.processor.initializeShaders&&E.processor.initializeShaders(E.processingContext)}function n(E,b,h,a){var k;null!==(k=b.processor)&&void 0!==k&&k.preProcessShaderCode&&(E=b.processor.preProcessShaderCode(E,b.isFragment)),N(E,b,(E=>{b.processCodeAfterIncludes&&(E=b.processCodeAfterIncludes(b.isFragment?"fragment":"vertex",E,b.defines));const k=function(E,b,h){let a=function(E,b){var h;if(null!==(h=b.processor)&&void 0!==h&&h.noPrecision)return E;const a=b.shouldUseHighPrecisionShader;-1===E.indexOf("precision highp float")?E=a?"precision highp float;\n"+E:"precision mediump float;\n"+E:a||(E=E.replace("precision highp float","precision mediump float"));return E}(E,b);if(!b.processor)return a;if(0===b.processor.shaderLanguage&&-1!==a.indexOf("#version 3")&&(a=a.replace("#version 300 es",""),!b.processor.parseGLES3))return a;const k=b.defines,G=w(b,h);b.processor.preProcessor&&(a=b.processor.preProcessor(a,k,G,b.isFragment,b.processingContext));a=r(a,G,b),b.processor.postProcessor&&(a=b.processor.postProcessor(a,k,b.isFragment,b.processingContext,h?{drawBuffersExtensionDisabled:!h.getCaps().drawBuffersExtension}:{}));null!==h&&void 0!==h&&h._features.needShaderCodeInlining&&(a=h.inlineShaderCode(a));return a}(E,b,a);h(k,E)}))}function d(E,b,h){return h.processor&&h.processor.finalizeShaders?h.processor.finalizeShaders(E,b,h.processingContext):{vertexCode:E,fragmentCode:b}}function c(E){const b=/defined\((.+)\)/.exec(E);if(b&&b.length)return new O(b[1].trim(),"!"===E[0]);const h=["==","!=",">=","<=","<",">"];let a="",k=0;for(a of h)if(k=E.indexOf(a),k>-1)break;if(-1===k)return new O(E);const G=E.substring(0,k).trim(),V=E.substring(k+a.length).trim();return new U(G,a,V)}function z(E,b){const h=new V,a=E.substring(0,b);let k=E.substring(b);return k=k.substring(0,(k.indexOf("//")+1||k.length+1)-1).trim(),h.testExpression="#ifdef"===a?new O(k):"#ifndef"===a?new O(k,!0):function(E){E=E.replace(u,"defined[$1]");const b=l.infixToPostfix(E),h=[];for(const k of b)if("||"!==k&&"&&"!==k)h.push(k);else if(h.length>=2){let E=h[h.length-1],b=h[h.length-2];h.length-=2;const a="&&"==k?new s:new v;"string"===typeof E&&(E=E.replace(D,"defined($1)")),"string"===typeof b&&(b=b.replace(D,"defined($1)")),a.leftOperand="string"===typeof b?c(b):b,a.rightOperand="string"===typeof E?c(E):E,h.push(a)}let a=h[h.length-1];return"string"===typeof a&&(a=a.replace(D,"defined($1)")),"string"===typeof a?c(a):a}(k),h}function Z(E,b,h){let k=E.currentLine;for(;Y(E,h);){k=E.currentLine;const G=k.substring(0,5).toLowerCase();if("#else"===G){const h=new a;return b.children.push(h),void Y(E,h)}if("#elif"===G){const E=z(k,5);b.children.push(E),h=E}}}function Y(E,b){for(;E.canRead;){E.lineIndex++;const h=E.currentLine;if(h.indexOf("#")>=0){const a=P.exec(h);if(a&&a.length){switch(a[0]){case"#ifdef":{const a=new G;b.children.push(a);const k=z(h,6);a.children.push(k),Z(E,a,k);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const a=new G;b.children.push(a);const k=z(h,7);a.children.push(k),Z(E,a,k);break}case"#if":{const a=new G,k=z(h,3);b.children.push(a),a.children.push(k),Z(E,a,k);break}}continue}}const k=new a;if(k.line=h,b.children.push(k),"#"===h[0]&&"d"===h[1]){const E=h.replace(";","").split(" ");k.additionalDefineKey=E[1],3===E.length&&(k.additionalDefineValue=E[2])}}return!1}function r(E,b,h){const G=new a,V=new k;return V.lineIndex=-1,V.lines=E.split("\n"),Y(V,G),G.process(b,h)}function w(E,b){var h;const a=E.defines,k={};for(const G of a){const E=G.replace("#define","").replace(";","").trim().split(" ");k[E[0]]=E.length>1?E[1]:""}return 0===(null===(h=E.processor)||void 0===h?void 0:h.shaderLanguage)&&(k.GL_ES="true"),k.__VERSION__=E.version,k[E.platformName]="true",(0,o.e)(k,null===b||void 0===b?void 0:b.isNDCHalfZRange,null===b||void 0===b?void 0:b.useReverseDepthBuffer,null===b||void 0===b?void 0:b.useExactSrgbConversions),k}function N(E,b,h){let a;for(j.length=0;null!==(a=g.exec(E));)j.push(a);let k=String(E),G=[E],V=!1;for(const l of j){let E=l[1];if(-1!==E.indexOf("__decl__")&&(E=E.replace(S,""),b.supportsUniformBuffers&&(E=E.replace("Vertex","Ubo").replace("Fragment","Ubo")),E+="Declaration"),!b.includesShadersStore[E]){const a=b.shadersRepository+"ShadersInclude/"+E+".fx";return void H.loadFile(a,(a=>{b.includesShadersStore[E]=a,N(G.join(""),b,h)}))}{let h=b.includesShadersStore[E];if(l[2]){const E=l[3].split(",");for(let b=0;b<E.length;b+=2){const a=new RegExp(E[b],"g"),k=E[b+1];h=h.replace(a,k)}}if(l[4]){const E=l[5];if(-1!==E.indexOf("..")){const a=E.split(".."),k=parseInt(a[0]);let G=parseInt(a[1]),V=h.slice(0);h="",isNaN(G)&&(G=b.indexParameters[a[1]]);for(let E=k;E<G;E++)b.supportsUniformBuffers||(V=V.replace(M,((E,b)=>b+"{X}"))),h+=V.replace(I,E.toString())+"\n"}else b.supportsUniformBuffers||(h=h.replace(M,((E,b)=>b+"{X}"))),h=h.replace(I,E)}const a=[];for(const E of G){const b=E.split(l[0]);for(let E=0;E<b.length-1;E++)a.push(b[E]),a.push(h);a.push(b[b.length-1])}G=a,V=V||h.indexOf("#include<")>=0||h.indexOf("#include <")>=0}}j.length=0,k=G.join(""),V?N(k.toString(),b,h):h(k)}const H={loadFile:(E,b,h,a,k,G)=>{throw(0,B.c)("FileTools")}}},11617:(E,b,h)=>{"use strict";h.d(b,{e:()=>a});class a{get underlyingResource(){return this._webGLTexture}constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1?arguments[1]:void 0;if(this._MSAARenderBuffers=null,this._context=b,!E&&(E=b.createTexture(),!E))throw new Error("Unable to create webGL texture");this.set(E)}setUsage(){}set(E){this._webGLTexture=E}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(E){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(E)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const E of this._MSAARenderBuffers)this._context.deleteRenderbuffer(E);this._MSAARenderBuffers=null}}getMSAARenderBuffer(){var E;let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(E=this._MSAARenderBuffers)||void 0===E?void 0:E[b])??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},10893:(E,b,h)=>{"use strict";h.d(b,{b:()=>k,d:()=>G,e:()=>l,i:()=>V,j:()=>O});var a=h(10855);h(10832);const k={};function G(E,b){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(b?b+"\n":"")+E}function V(E,b,h,G,V,l,O){const v=O||k.loadFile;if(v){return v(E,b,h,G,V,l)}throw(0,a.c)("FileTools")}function l(E,b,h,a){if(E)return b?E.IS_NDC_HALF_ZRANGE="":delete E.IS_NDC_HALF_ZRANGE,h?E.USE_REVERSE_DEPTHBUFFER="":delete E.USE_REVERSE_DEPTHBUFFER,void(a?E.USE_EXACT_SRGB_CONVERSIONS="":delete E.USE_EXACT_SRGB_CONVERSIONS);{let E="";return b&&(E+="#define IS_NDC_HALF_ZRANGE"),h&&(E&&(E+="\n"),E+="#define USE_REVERSE_DEPTHBUFFER"),a&&(E&&(E+="\n"),E+="#define USE_EXACT_SRGB_CONVERSIONS"),E}}function O(E,b){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0;switch(E){case 3:{const E=(ArrayBuffer,new Int8Array(b));return a&&E.set(new Int8Array(a)),E}case 0:{const E=(ArrayBuffer,new Uint8Array(b));return a&&E.set(new Uint8Array(a)),E}case 4:{const E=b instanceof ArrayBuffer?new Int16Array(b):new Int16Array(h?b/2:b);return a&&E.set(new Int16Array(a)),E}case 5:case 8:case 9:case 10:case 2:{const E=b instanceof ArrayBuffer?new Uint16Array(b):new Uint16Array(h?b/2:b);return a&&E.set(new Uint16Array(a)),E}case 6:{const E=b instanceof ArrayBuffer?new Int32Array(b):new Int32Array(h?b/4:b);return a&&E.set(new Int32Array(a)),E}case 7:case 11:case 12:case 13:case 14:case 15:{const E=b instanceof ArrayBuffer?new Uint32Array(b):new Uint32Array(h?b/4:b);return a&&E.set(new Uint32Array(a)),E}case 1:{const E=b instanceof ArrayBuffer?new Float32Array(b):new Float32Array(h?b/4:b);return a&&E.set(new Float32Array(a)),E}}const k=(ArrayBuffer,new Uint8Array(b));return a&&k.set(new Uint8Array(a)),k}},10902:(E,b,h)=>{"use strict";h.d(b,{d:()=>I});var a=h(10869),k=h(10834),G=h(10905),V=h(10931),l=h(10846);class O{constructor(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,E&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(E){this._zOffset!==E&&(this._zOffset=E,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(E){this._zOffsetUnits!==E&&(this._zOffsetUnits=E,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(E){this._cullFace!==E&&(this._cullFace=E,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(E){this._cull!==E&&(this._cull=E,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(E){this._depthFunc!==E&&(this._depthFunc=E,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(E){this._depthMask!==E&&(this._depthMask=E,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(E){this._depthTest!==E&&(this._depthTest=E,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(E){this._frontFace!==E&&(this._frontFace=E,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(E){this.isDirty&&(this._isCullDirty&&(this.cull?E.enable(E.CULL_FACE):E.disable(E.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(E.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(E.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?E.enable(E.DEPTH_TEST):E.disable(E.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(E.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(E.enable(E.POLYGON_OFFSET_FILL),E.polygonOffset(this.zOffset,this.zOffsetUnits)):E.disable(E.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(E.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}class v{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(E){this._func!==E&&(this._func=E,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(E){this._funcRef!==E&&(this._funcRef=E,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(E){this._funcMask!==E&&(this._funcMask=E,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(E){this._opStencilFail!==E&&(this._opStencilFail=E,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(E){this._opDepthFail!==E&&(this._opDepthFail=E,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(E){this._opStencilDepthPass!==E&&(this._opStencilDepthPass=E,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(E){this._mask!==E&&(this._mask=E,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(E){this._enabled!==E&&(this._enabled=E,this._isStencilTestDirty=!0)}constructor(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,E&&this.reset()}reset(){var E;this.stencilMaterial=void 0,null===(E=this.stencilGlobal)||void 0===E||E.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(E){var b;if(!E)return;const h=!this.useStencilGlobalOnly&&!(null===(b=this.stencilMaterial)||void 0===b||!b.enabled);this.enabled=h?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=h?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=h?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=h?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=h?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=h?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=h?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=h?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?E.enable(E.STENCIL_TEST):E.disable(E.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(E.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(E.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(E.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}class s{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=s.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=s.KEEP,this.opDepthFail=s.KEEP,this.opStencilDepthPass=s.REPLACE}get stencilFunc(){return this.func}set stencilFunc(E){this.func=E}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(E){this.funcRef=E}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(E){this.funcMask=E}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(E){this.opStencilFail=E}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(E){this.opDepthFail=E}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(E){this.opStencilDepthPass=E}get stencilMask(){return this.mask}set stencilMask(E){this.mask=E}get stencilTest(){return this.enabled}set stencilTest(E){this.enabled=E}}s.ALWAYS=519,s.KEEP=7680,s.REPLACE=7681;class U{constructor(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._alphaBlend}set alphaBlend(E){this._alphaBlend!==E&&(this._alphaBlend=E,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(E,b,h,a){this._blendConstants[0]===E&&this._blendConstants[1]===b&&this._blendConstants[2]===h&&this._blendConstants[3]===a||(this._blendConstants[0]=E,this._blendConstants[1]=b,this._blendConstants[2]=h,this._blendConstants[3]=a,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(E,b,h,a){this._blendFunctionParameters[0]===E&&this._blendFunctionParameters[1]===b&&this._blendFunctionParameters[2]===h&&this._blendFunctionParameters[3]===a||(this._blendFunctionParameters[0]=E,this._blendFunctionParameters[1]=b,this._blendFunctionParameters[2]=h,this._blendFunctionParameters[3]=a,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(E,b){this._blendEquationParameters[0]===E&&this._blendEquationParameters[1]===b||(this._blendEquationParameters[0]=E,this._blendEquationParameters[1]=b,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(E){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?E.enable(E.BLEND):E.disable(E.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(E.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(E.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(E.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}var B=h(10855),o=h(10939),u=h(10832),D=h(10824),g=h(10893),S=h(10947);function M(E,b){if((0,u.i)()){const{requestAnimationFrame:h}=b||window;if("function"===typeof h)return h(E)}else if("function"===typeof requestAnimationFrame)return requestAnimationFrame(E);return setTimeout(E,16)}class I{get frameId(){return this._frameId}get isWebGPU(){return this._isWebGPU}_getShaderProcessor(E){return this._shaderProcessor}get shaderPlatformName(){return this._shaderPlatformName}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}set useReverseDepthBuffer(E){E!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=E,this._depthCullingState.depthFunc=E?518:515)}setColorWrite(E){E!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=E)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}_getGlobalDefines(E){if(E)return this.isNDCHalfZRange?E.IS_NDC_HALF_ZRANGE="":delete E.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?E.USE_REVERSE_DEPTHBUFFER="":delete E.USE_REVERSE_DEPTHBUFFER,void(this.useExactSrgbConversions?E.USE_EXACT_SRGB_CONVERSIONS="":delete E.USE_EXACT_SRGB_CONVERSIONS);{let E="";return this.isNDCHalfZRange&&(E+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(E&&(E+="\n"),E+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(E&&(E+="\n"),E+="#define USE_EXACT_SRGB_CONVERSIONS"),E}}_rebuildInternalTextures(){const E=this._internalTexturesCache.slice();for(const b of E)b._rebuild()}_rebuildRenderTargetWrappers(){const E=this._renderTargetWrapperCache.slice();for(const b of E)b._rebuild()}_rebuildEffects(){for(const E in this._compiledEffects){const b=this._compiledEffects[E];b._pipelineContext=null,b._prepareEffect()}G.b.ResetCache()}_rebuildGraphicsResources(){var E;this.wipeCaches(!0),this._rebuildEffects(),null===(E=this._rebuildComputeEffects)||void 0===E||E.call(this),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_flagContextRestored(){k.c.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}_restoreEngineAfterContextLost(E){setTimeout((async()=>{this._clearEmptyResources();const b=this._depthCullingState.depthTest,h=this._depthCullingState.depthFunc,a=this._depthCullingState.depthMask,k=this._stencilState.stencilTest;await E(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=b,this._depthCullingState.depthFunc=h,this._depthCullingState.depthMask=a,this._stencilState.stencilTest=k,this._flagContextRestored()}),0)}get u(){return this._isDisposed}get snapshotRendering(){return!1}set snapshotRendering(E){}get snapshotRenderingMode(){return 0}set snapshotRenderingMode(E){}getClassName(){return"AbstractEngine"}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){const E=new Uint8Array(4),b=[E,E,E,E,E,E];this._emptyCubeTexture=this.createRawCubeTexture(b,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get activeRenderLoops(){return this._activeRenderLoops}stopRenderLoop(E){if(!E)return this._activeRenderLoops.length=0,void this._cancelFrame();const b=this._activeRenderLoops.indexOf(E);b>=0&&(this._activeRenderLoops.splice(b,1),0==this._activeRenderLoops.length&&this._cancelFrame())}_cancelFrame(){if(0!==this._frameHandler){const E=this._frameHandler;if(this._frameHandler=0,(0,u.i)()){const{cancelAnimationFrame:b}=this.getHostWindow()||window;if("function"===typeof b)return b(E)}else if("function"===typeof cancelAnimationFrame)return cancelAnimationFrame(E);return clearTimeout(E)}}mj(){this.onBeginFrameObservable.notifyObservers(this)}nj(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let E=!0;(this._isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(E=!1),E&&(this.mj(),this._renderViews()||this._renderFrame(),this.nj())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_renderFrame(){for(let E=0;E<this._activeRenderLoops.length;E++){(0,this._activeRenderLoops[E])()}}_renderViews(){return!1}_queueNewFrame(E,b){return M(E,b)}runRenderLoop(E){-1===this._activeRenderLoops.indexOf(E)&&(this._activeRenderLoops.push(E),1===this._activeRenderLoops.length&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(E){this._depthCullingState.depthTest=E}setZOffset(E){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-E:E}getZOffset(){const E=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-E:E}setZOffsetUnits(E){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-E:E}getZOffsetUnits(){const E=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-E:E}getHostWindow(){return(0,u.i)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(E){this._compatibilityMode=!0}_rebuildTextures(){for(const E of this.scenes)E._rebuildTextures();for(const E of this._virtualScenes)E._rebuildTextures()}_releaseRenderTargetWrapper(E){const b=this._renderTargetWrapperCache.indexOf(E);-1!==b&&this._renderTargetWrapperCache.splice(b,1)}get currentViewport(){return this._cachedViewport}setViewport(E,b,h){const a=b||this.getRenderWidth(),k=h||this.getRenderHeight(),G=E.x||0,V=E.y||0;this._cachedViewport=E,this._viewport(G*a,V*k,a*E.width,k*E.height)}createCanvasImage(){return document.createElement("img")}get description(){let E=this.name+this.version;return this._caps.parallelShaderCompile&&(E+=" - Parallel shader compilation"),E}_createTextureBase(E,b,h,G){let V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,v=arguments.length>7?arguments[7]:void 0,s=arguments.length>8?arguments[8]:void 0,U=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,B=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,u=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,D=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,g=arguments.length>13?arguments[13]:void 0,M=arguments.length>14?arguments[14]:void 0,j=arguments.length>15?arguments[15]:void 0;const P="data:"===(E=E||"").substr(0,5),A="blob:"===E.substr(0,5),n=P&&-1!==E.indexOf(";base64,"),d=B||new o.b(this,1);d!==B&&(d.label=E.substring(0,60));const c=E;!this._transformTextureUrl||n||B||U||(E=this._transformTextureUrl(E)),c!==E&&(d._originalUrl=c);const z=E.lastIndexOf(".");let Z=D||(z>-1?E.substring(z).toLowerCase():"");Z.indexOf("?")>-1&&(Z=Z.split("?")[0]);const Y=(0,S.d)(Z,g);G&&G.addPendingData(d),d.url=E,d.generateMipMaps=!b,d.samplingMode=V,d.invertY=h,d._useSRGBBuffer=this._getUseSRGBBuffer(!!j,b),this._doNotHandleContextLost||(d._buffer=U);let r=null;l&&!B&&(r=d.onLoadedObservable.add(l)),B||this._internalTexturesCache.push(d);const w=(h,B)=>{G&&G.removePendingData(d),E===c?(r&&d.onLoadedObservable.remove(r),a.b.UseFallbackTexture&&E!==a.b.FallbackTexture&&this._createTextureBase(a.b.FallbackTexture,b,d.invertY,G,V,null,O,v,s,U,d),h=(h||"Unknown error")+(a.b.UseFallbackTexture?" - Fallback texture was used":""),d.onErrorObservable.notifyObservers({message:h,exception:B}),O&&O(h,B)):(k.c.Warn(`Failed to load ${E}, falling back to ${c}`),this._createTextureBase(c,b,d.invertY,G,V,l,O,v,s,U,d,u,D,g,M,j))};if(Y){const b=async E=>{(await Y).loadData(E,d,((E,b,h,a,k,l)=>{l?w("TextureLoader failed to load data"):v(d,Z,G,{width:E,height:b},d.invertY,!h,a,(()=>(k(),!1)),V)}),M)};U?U instanceof ArrayBuffer?b(new Uint8Array(U)):ArrayBuffer.isView(U)?b(U):O&&O("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(E,(E=>b(new Uint8Array(E))),void 0,G?G.offlineProvider:void 0,!0,((E,b)=>{w("Unable to load "+(E&&E.responseURL,b))}))}else{const h=E=>{A&&!this._doNotHandleContextLost&&(d._buffer=E),v(d,Z,G,E,d.invertY,b,!1,s,V)};!P||n?U&&("string"===typeof U.decoding||U.close)?h(U):I._FileToolsLoadImage(E||"",h,w,G?G.offlineProvider:null,g,d.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):"string"===typeof U||U instanceof ArrayBuffer||ArrayBuffer.isView(U)||U instanceof Blob?I._FileToolsLoadImage(U,h,w,G?G.offlineProvider:null,g,d.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):U&&h(U)}return d}_rebuildBuffers(){for(const E of this._uniformBuffers)E._rebuildAfterContextLost()}get _shouldUseHighPrecisionShader(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,u.e)()?document:null}getLoadedTexturesCache(){return this._internalTexturesCache}clearInternalTexturesCache(){this._internalTexturesCache.length=0}getCaps(){return this._caps}resetTextureCache(){for(const E in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,E)&&(this._boundTexturesCache[E]=null);this._currentTextureChannel=-1}get name(){return this._name}set name(E){this._name=E}static get NpmPackage(){return"babylonjs@7.33.0"}static get Version(){return"7.33.0"}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}setHardwareScalingLevel(E){this._hardwareScalingLevel=E,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(E){this._doNotHandleContextLost=E}get isStencilEnable(){return this._isStencilEnable}getCreationOptions(){return this._creationOptions}constructor(E,b,h){var k,G;this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new O,this._stencilStateComposer=new v,this._stencilState=new s,this._alphaState=new U,this._alphaMode=1,this._alphaEquation=0,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new D.e,this.onCanvasFocusObservable=new D.e,this.onNewSceneAddedObservable=new D.e,this.onResizeObservable=new D.e,this.onCanvasPointerOutObservable=new D.e,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new D.e,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=()=>this._renderLoop(),this.onBeforeShaderCompilationObservable=new D.e,this.onAfterShaderCompilationObservable=new D.e,this.onBeginFrameObservable=new D.e,this.onEndFrameObservable=new D.e,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new D.e,this.onContextRestoredObservable=new D.e,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.rj=new D.e,a.b.Instances.push(this),this.startTime=l.c.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,V.c.SetMatrixPrecision(!!b.useHighPrecisionMatrix),(0,u.g)()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=h??!1,b.antialias=E??b.antialias,b.deterministicLockstep=b.deterministicLockstep??!1,b.lockstepMaxSteps=b.lockstepMaxSteps??4,b.timeStep=b.timeStep??1/60,b.audioEngine=b.audioEngine??!0,b.stencil=b.stencil??!0,this._audioContext=(null===(k=b.audioEngineOptions)||void 0===k?void 0:k.audioContext)??null,this._audioDestination=(null===(G=b.audioEngineOptions)||void 0===G?void 0:G.audioDestination)??null,this.premultipliedAlpha=b.premultipliedAlpha??!0,this._doNotHandleContextLost=!!b.doNotHandleContextLost,this._isStencilEnable=!!b.stencil,this.useExactSrgbConversions=b.useExactSrgbConversions??!1;const B=(0,u.i)()&&window.devicePixelRatio||1,o=b.limitDeviceRatio||B;h=h||b.adaptToDeviceRatio||!1,this._hardwareScalingLevel=h?1/Math.min(o,B):1,this._lastDevicePixelRatio=B,this._creationOptions=b}resize(){let E,b,h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.adaptToDeviceRatio){const E=(0,u.i)()&&window.devicePixelRatio||1,b=this._lastDevicePixelRatio/E;this._lastDevicePixelRatio=E,this._hardwareScalingLevel*=b}if((0,u.i)()&&(0,u.e)())if(this._renderingCanvas){const h=this._renderingCanvas.getBoundingClientRect?this._renderingCanvas.getBoundingClientRect():{width:this._renderingCanvas.width*this._hardwareScalingLevel,height:this._renderingCanvas.height*this._hardwareScalingLevel};E=this._renderingCanvas.clientWidth||h.width||this._renderingCanvas.width||100,b=this._renderingCanvas.clientHeight||h.height||this._renderingCanvas.height||100}else E=window.innerWidth,b=window.innerHeight;else E=this._renderingCanvas?this._renderingCanvas.width:100,b=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(E/this._hardwareScalingLevel,b/this._hardwareScalingLevel,h)}setSize(E,b){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._renderingCanvas)return!1;if(E|=0,b|=0,!h&&this._renderingCanvas.width===E&&this._renderingCanvas.height===b)return!1;if(this._renderingCanvas.width=E,this._renderingCanvas.height=b,this.scenes){for(let E=0;E<this.scenes.length;E++){const b=this.scenes[E];for(let E=0;E<b.cameras.length;E++){b.cameras[E]._currentRenderId=0}}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}createRawTexture(E,b,h,a,k,G,V,l,O,v,s){throw(0,B.c)("engine.rawTexture")}createRawCubeTexture(E,b,h,a,k,G,V,l){throw(0,B.c)("engine.rawTexture")}createRawTexture3D(E,b,h,a,k,G,V,l,O,v,s){throw(0,B.c)("engine.rawTexture")}createRawTexture2DArray(E,b,h,a,k,G,V,l,O,v,s){throw(0,B.c)("engine.rawTexture")}_sharedInit(E){this._renderingCanvas=E}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const E=navigator.userAgent;this.hostInformation.isMobile=-1!==E.indexOf("Mobile")||-1!==E.indexOf("Mac")&&(0,u.e)()&&"ontouchend"in document},this._checkForMobile(),(0,u.i)()&&window.addEventListener("resize",this._checkForMobile))}createVideoElement(E){return document.createElement("video")}_reportDrawCall(){var E;let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;null===(E=this._drawCalls)||void 0===E||E.addCount(b,!1)}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return 1e3*this._timeStep}_createImageBitmapFromSource(E,b){throw new Error("createImageBitmapFromSource is not implemented")}createImageBitmap(E,b){return createImageBitmap(E,b)}resizeImageBitmap(E,b,h){throw new Error("resizeImageBitmap is not implemented")}getFontOffset(E){throw new Error("getFontOffset is not implemented")}static _CreateCanvas(E,b){if("undefined"===typeof document)return new OffscreenCanvas(E,b);const h=document.createElement("canvas");return h.width=E,h.height=b,h}createCanvas(E,b){return I._CreateCanvas(E,b)}static _FileToolsLoadImage(E,b,h,a,k,G){throw(0,B.c)("FileTools")}_loadFile(E,b,h,a,k,G){const V=(0,g.i)(E,b,h,a,k,G);return this._activeRequests.push(V),V.onCompleteObservable.add((()=>{const E=this._activeRequests.indexOf(V);-1!==E&&this._activeRequests.splice(E,1)})),V}static _FileToolsLoadFile(E,b,h,a,k,G){if(g.b.loadFile)return g.b.loadFile(E,b,h,a,k,G);throw(0,B.c)("FileTools")}dispose(){var E;for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();null===(E=this.releaseComputeEffects)||void 0===E||E.call(this),G.b.ResetCache();for(const h of this._activeRequests)h.abort();this._boundRenderFunction=null,this.rj.notifyObservers(this),this.rj.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),(0,u.i)()&&window.removeEventListener("resize",this._checkForMobile);const b=a.b.Instances.indexOf(this);b>=0&&a.b.Instances.splice(b,1),a.b.Instances.length||(a.b.OnEnginesDisposedObservable.notifyObservers(this),a.b.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}static DefaultLoadingScreenFactory(E){throw(0,B.c)("LoadingScreen")}static MarkAllMaterialsAsDirty(E,b){for(let h=0;h<a.b.Instances.length;h++){const k=a.b.Instances[h];for(let h=0;h<k.scenes.length;h++)k.scenes[h].markAllMaterialsAsDirty(E,b)}}}I._RenderPassIdCounter=0,I._RescalePostProcessFactory=null,I.CollisionsEpsilon=.001,I.QueueNewFrame=M},11640:(E,b,h)=>{"use strict";h.d(b,{b:()=>d});var a=h(10939),k=h(10869),G=h(11594),V=h(10846);class l{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;this._enabled=!0,this._rollingFrameTime=new O(E)}sampleFrame(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V.c.Now;if(this._enabled){if(null!=this._lastFrameTimeMs){const b=E-this._lastFrameTimeMs;this._rollingFrameTime.add(b)}this._lastFrameTimeMs=E}}get averageFrameTime(){return this._rollingFrameTime.average}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFPS(){return 1e3/this._rollingFrameTime.average}get instantaneousFPS(){const E=this._rollingFrameTime.history(0);return 0===E?0:1e3/E}get isSaturated(){return this._rollingFrameTime.isSaturated()}enable(){this._enabled=!0}disable(){this._enabled=!1,this._lastFrameTimeMs=null}get isEnabled(){return this._enabled}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class O{constructor(E){this._samples=new Array(E),this.reset()}add(E){let b;if(this.isSaturated()){const E=this._samples[this._pos];b=E-this.average,this.average-=b/(this._sampleCount-1),this._m2-=b*(E-this.average)}else this._sampleCount++;b=E-this.average,this.average+=b/this._sampleCount,this._m2+=b*(E-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=E,this._pos++,this._pos%=this._samples.length}history(E){if(E>=this._sampleCount||E>=this._samples.length)return 0;const b=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(b-E)]}isSaturated(){return this._sampleCount>=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(E){const b=this._samples.length;return(E%b+b)%b}}var v=h(11612),s=h(10834),U=h(11617),B=(h(11631),h(10968));function o(E,b,h,a){let k,G=1;1===a?k=new Float32Array(b*h*4):2===a?(k=new Uint16Array(b*h*4),G=15360):k=7===a?new Uint32Array(b*h*4):new Uint8Array(b*h*4);for(let V=0;V<b;V++)for(let a=0;a<h;a++){const h=3*(a*b+V),l=4*(a*b+V);k[l+0]=E[h+0],k[l+1]=E[h+1],k[l+2]=E[h+2],k[l+3]=G}return k}function u(E){return function(b,h,k,G,V,l,O,v){let s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,U=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const B=E?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,o=E?10:11,u=new a.b(this,o);u.baseWidth=h,u.baseHeight=k,u.baseDepth=G,u.width=h,u.height=k,u.depth=G,u.format=V,u.type=U,u.generateMipMaps=l,u.samplingMode=v,E?u.is3D=!0:u.is2DArray=!0,this._doNotHandleContextLost||(u._bufferView=b),E?this.updateRawTexture3D(u,b,V,O,s,U):this.updateRawTexture2DArray(u,b,V,O,s,U),this._bindTextureDirectly(B,u,!0);const D=this._getSamplingParameters(v,l);return this._gl.texParameteri(B,this._gl.TEXTURE_MAG_FILTER,D.mag),this._gl.texParameteri(B,this._gl.TEXTURE_MIN_FILTER,D.min),l&&this._gl.generateMipmap(B),this._bindTextureDirectly(B,null),this._internalTexturesCache.push(u),u}}function D(E){return function(b,h,a,k){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,V=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const l=E?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,O=this._getWebGLTextureType(V),v=this._getInternalFormat(a),s=this._getRGBABufferInternalSizedFormat(V,a);this._bindTextureDirectly(l,b,!0),this._unpackFlipY(void 0===k||!!k),this._doNotHandleContextLost||(b._bufferView=h,b.format=a,b.invertY=k,b._compression=G),b.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),G&&h?this._gl.compressedTexImage3D(l,0,this.getCaps().s3tc[G],b.width,b.height,b.depth,0,h):this._gl.texImage3D(l,0,s,b.width,b.height,b.depth,0,v,O,h),b.generateMipMaps&&this._gl.generateMipmap(l),this._bindTextureDirectly(l,null),b.isReady=!0}}G.ThinEngine.prototype.updateRawTexture=function(E,b,h,a){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,V=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!E)return;const l=this._getRGBABufferInternalSizedFormat(G,h,V),O=this._getInternalFormat(h),v=this._getWebGLTextureType(G);this._bindTextureDirectly(this._gl.TEXTURE_2D,E,!0),this._unpackFlipY(void 0===a||!!a),this._doNotHandleContextLost||(E._bufferView=b,E.format=h,E.type=G,E.invertY=a,E._compression=k),E.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),k&&b?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[k],E.width,E.height,0,b):this._gl.texImage2D(this._gl.TEXTURE_2D,0,l,E.width,E.height,0,O,v,b),E.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),E.isReady=!0},G.ThinEngine.prototype.createRawTexture=function(E,b,h,k,G,V,l){let O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,v=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,s=arguments.length>10&&void 0!==arguments[10]&&arguments[10];const U=new a.b(this,3);U.baseWidth=b,U.baseHeight=h,U.width=b,U.height=h,U.format=k,U.generateMipMaps=G,U.samplingMode=l,U.invertY=V,U._compression=O,U.type=v,U._useSRGBBuffer=this._getUseSRGBBuffer(s,!G),this._doNotHandleContextLost||(U._bufferView=E),this.updateRawTexture(U,E,k,V,O,v,U._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,U,!0);const B=this._getSamplingParameters(l,G);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,B.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,B.min),G&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(U),U},G.ThinEngine.prototype.createRawCubeTexture=function(E,b,h,k,G,V,l){let O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;const v=this._gl,U=new a.b(this,8);U.isCube=!0,U.format=h,U.type=k,this._doNotHandleContextLost||(U._bufferViewArray=E);const o=this._getWebGLTextureType(k);let u=this._getInternalFormat(h);u===v.RGB&&(u=v.RGBA),o!==v.FLOAT||this._caps.textureFloatLinearFiltering?o!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?o!==v.FLOAT||this._caps.textureFloatRender?o!==v.HALF_FLOAT||this._caps.colorBufferFloat||(G=!1,s.c.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(G=!1,s.c.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(G=!1,l=1,s.c.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(G=!1,l=1,s.c.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));const D=b,g=D;U.width=D,U.height=g,U.invertY=V,U._compression=O;if(!this.needPOTTextures||(0,B.h)(U.width)&&(0,B.h)(U.height)||(G=!1),E)this.updateRawCubeTexture(U,E,h,k,V,O);else{const E=this._getRGBABufferInternalSizedFormat(k),b=0;this._bindTextureDirectly(v.TEXTURE_CUBE_MAP,U,!0);for(let h=0;h<6;h++)O?v.compressedTexImage2D(v.TEXTURE_CUBE_MAP_POSITIVE_X+h,b,this.getCaps().s3tc[O],U.width,U.height,0,void 0):v.texImage2D(v.TEXTURE_CUBE_MAP_POSITIVE_X+h,b,E,U.width,U.height,0,u,o,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,U,!0),E&&G&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);const S=this._getSamplingParameters(l,G);return v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_MAG_FILTER,S.mag),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_MIN_FILTER,S.min),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),this._bindTextureDirectly(v.TEXTURE_CUBE_MAP,null),U.generateMipMaps=G,U.samplingMode=l,U.isReady=!0,U},G.ThinEngine.prototype.updateRawCubeTexture=function(E,b,h,a,k){let G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;E._bufferViewArray=b,E.format=h,E.type=a,E.invertY=k,E._compression=G;const l=this._gl,O=this._getWebGLTextureType(a);let v=this._getInternalFormat(h);const s=this._getRGBABufferInternalSizedFormat(a);let U=!1;v===l.RGB&&(v=l.RGBA,U=!0),this._bindTextureDirectly(l.TEXTURE_CUBE_MAP,E,!0),this._unpackFlipY(void 0===k||!!k),E.width%4!==0&&l.pixelStorei(l.UNPACK_ALIGNMENT,1);for(let B=0;B<6;B++){let h=b[B];G?l.compressedTexImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+B,V,this.getCaps().s3tc[G],E.width,E.height,0,h):(U&&(h=o(h,E.width,E.height,a)),l.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+B,V,s,E.width,E.height,0,v,O,h))}(!this.needPOTTextures||(0,B.h)(E.width)&&(0,B.h)(E.height))&&E.generateMipMaps&&0===V&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),E.isReady=!0},G.ThinEngine.prototype.createRawCubeTextureFromUrl=function(E,b,h,a,k,G,V,l){let O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,v=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,s=arguments.length>10&&void 0!==arguments[10]?arguments[10]:3,U=arguments.length>11&&void 0!==arguments[11]&&arguments[11];const B=this._gl,u=this.createRawCubeTexture(null,h,a,k,!G,U,s,null);null===b||void 0===b||b.addPendingData(u),u.url=E,u.isReady=!1,this._internalTexturesCache.push(u);const D=E=>{const h=u.width,G=V(E);if(G){if(l){const E=this._getWebGLTextureType(k);let b=this._getInternalFormat(a);const V=this._getRGBABufferInternalSizedFormat(k);let O=!1;b===B.RGB&&(b=B.RGBA,O=!0),this._bindTextureDirectly(B.TEXTURE_CUBE_MAP,u,!0),this._unpackFlipY(!1);const v=l(G);for(let a=0;a<v.length;a++){const G=h>>a;for(let h=0;h<6;h++){let l=v[a][h];O&&(l=o(l,G,G,k)),B.texImage2D(h,a,V,G,G,0,b,E,l)}}this._bindTextureDirectly(B.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(u,G,a,k,U);u.isReady=!0,null===b||void 0===b||b.removePendingData(u),u.onLoadedObservable.notifyObservers(u),u.onLoadedObservable.clear(),O&&O()}};return this._loadFile(E,(E=>{D(E)}),void 0,null===b||void 0===b?void 0:b.offlineProvider,!0,((E,h)=>{null===b||void 0===b||b.removePendingData(u),v&&E&&v(E.status+" "+E.statusText,h)})),u},G.ThinEngine.prototype.createRawTexture2DArray=u(!1),G.ThinEngine.prototype.createRawTexture3D=u(!0),G.ThinEngine.prototype.updateRawTexture2DArray=D(!1),G.ThinEngine.prototype.updateRawTexture3D=D(!0);var g=h(10893);G.ThinEngine.prototype._readTexturePixelsSync=function(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],l=arguments.length>7&&void 0!==arguments[7]&&arguments[7],O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,v=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const s=this._gl;if(!s)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const E=s.createFramebuffer();if(!E)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=E}var U,B;(s.bindFramebuffer(s.FRAMEBUFFER,this._dummyFramebuffer),a>-1)?s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+a,null===(U=E._hardwareTexture)||void 0===U?void 0:U.underlyingResource,k):s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,null===(B=E._hardwareTexture)||void 0===B?void 0:B.underlyingResource,k);let o=void 0!==E.type?this._getWebGLTextureType(E.type):s.UNSIGNED_BYTE;if(l)G||(G=(0,g.j)(E.type,4*b*h));else if(o===s.UNSIGNED_BYTE)G||(G=new Uint8Array(4*b*h)),o=s.UNSIGNED_BYTE;else G||(G=new Float32Array(4*b*h)),o=s.FLOAT;return V&&this.flushFramebuffer(),s.readPixels(O,v,b,h,s.RGBA,o,G),s.bindFramebuffer(s.FRAMEBUFFER,this._currentFramebuffer),G},G.ThinEngine.prototype._readTexturePixels=function(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],l=arguments.length>7&&void 0!==arguments[7]&&arguments[7],O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,v=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;return Promise.resolve(this._readTexturePixelsSync(E,b,h,a,k,G,V,l,O,v))};h(11588);G.ThinEngine.prototype._createDepthStencilCubeTexture=function(E,b){const h=new a.b(this,12);if(h.isCube=!0,1===this.webGLVersion)return s.c.Error("Depth cube texture is not supported by WebGL 1."),h;const k={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...b},G=this._gl;this._bindTextureDirectly(G.TEXTURE_CUBE_MAP,h,!0),this._setupDepthStencilTexture(h,E,k.bilinearFiltering,k.comparisonFunction);for(let a=0;a<6;a++)k.generateStencil?G.texImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,G.DEPTH24_STENCIL8,E,E,0,G.DEPTH_STENCIL,G.UNSIGNED_INT_24_8,null):G.texImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,G.DEPTH_COMPONENT24,E,E,0,G.DEPTH_COMPONENT,G.UNSIGNED_INT,null);return this._bindTextureDirectly(G.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(h),h},G.ThinEngine.prototype._setCubeMapTextureParams=function(E,b,h){const a=this._gl;a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,b?a.LINEAR_MIPMAP_LINEAR:a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),E.samplingMode=b?3:2,b&&this.getCaps().textureMaxLevel&&void 0!==h&&h>0&&(a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAX_LEVEL,h),E._maxLodLevel=h),this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,null)},G.ThinEngine.prototype.createCubeTexture=function(E,b,h,a){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6?arguments[6]:void 0,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,O=arguments.length>8&&void 0!==arguments[8]&&arguments[8],v=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,U=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,o=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,u=arguments.length>13&&void 0!==arguments[13]&&arguments[13],D=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null;const g=this._gl;return this.createCubeTextureBase(E,b,h,!!a,k,G,V,l,O,v,U,o,(E=>this._bindTextureDirectly(g.TEXTURE_CUBE_MAP,E,!0)),((E,b)=>{const h=this.needPOTTextures?(0,B.f)(b[0].width,this._caps.maxCubemapTextureSize):b[0].width,G=h,l=[g.TEXTURE_CUBE_MAP_POSITIVE_X,g.TEXTURE_CUBE_MAP_POSITIVE_Y,g.TEXTURE_CUBE_MAP_POSITIVE_Z,g.TEXTURE_CUBE_MAP_NEGATIVE_X,g.TEXTURE_CUBE_MAP_NEGATIVE_Y,g.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(g.TEXTURE_CUBE_MAP,E,!0),this._unpackFlipY(!1);const O=V?this._getInternalFormat(V,E._useSRGBBuffer):E._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:g.RGBA;let v=V?this._getInternalFormat(V):g.RGBA;E._useSRGBBuffer&&1===this.webGLVersion&&(v=O);for(let a=0;a<l.length;a++)if(b[a].width!==h||b[a].height!==G){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void s.c.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=h,this._workingCanvas.height=G,this._workingContext.drawImage(b[a],0,0,b[a].width,b[a].height,0,0,h,G),g.texImage2D(l[a],0,O,v,g.UNSIGNED_BYTE,this._workingCanvas)}else g.texImage2D(l[a],0,O,v,g.UNSIGNED_BYTE,b[a]);a||g.generateMipmap(g.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(E,!a),E.width=h,E.height=G,E.isReady=!0,V&&(E.format=V),E.onLoadedObservable.notifyObservers(E),E.onLoadedObservable.clear(),k&&k()}),!!u,D)},G.ThinEngine.prototype.generateMipMapsForCubemap=function(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(E.generateMipMaps){const h=this._gl;this._bindTextureDirectly(h.TEXTURE_CUBE_MAP,E,!0),h.generateMipmap(h.TEXTURE_CUBE_MAP),b&&this._bindTextureDirectly(h.TEXTURE_CUBE_MAP,null)}};h(11644);G.ThinEngine.prototype.setDepthStencilTexture=function(E,b,h,a){void 0!==E&&(b&&(this._boundUniforms[E]=b),h&&h.depthStencilTexture?this._setTexture(E,h,!1,!0,a):this._setTexture(E,null,void 0,void 0,a))},G.ThinEngine.prototype.createRenderTargetCubeTexture=function(E,b){const h=this._createHardwareRenderTargetWrapper(!1,!0,E),k={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...b};k.generateStencilBuffer=k.generateDepthBuffer&&k.generateStencilBuffer,(1!==k.type||this._caps.textureFloatLinearFiltering)&&(2!==k.type||this._caps.textureHalfFloatLinearFiltering)||(k.samplingMode=1);const G=this._gl,V=new a.b(this,5);this._bindTextureDirectly(G.TEXTURE_CUBE_MAP,V,!0);const l=this._getSamplingParameters(k.samplingMode,k.generateMipMaps);1!==k.type||this._caps.textureFloat||(k.type=0,s.c.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MAG_FILTER,l.mag),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MIN_FILTER,l.min),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE);for(let a=0;a<6;a++)G.texImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,this._getRGBABufferInternalSizedFormat(k.type,k.format),E,E,0,this._getInternalFormat(k.format),this._getWebGLTextureType(k.type),null);const O=G.createFramebuffer();return this._bindUnboundFramebuffer(O),h._depthStencilBuffer=this._setupFramebufferDepthAttachments(k.generateStencilBuffer,k.generateDepthBuffer,E,E),k.generateMipMaps&&G.generateMipmap(G.TEXTURE_CUBE_MAP),this._bindTextureDirectly(G.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),h._framebuffer=O,h._generateDepthBuffer=k.generateDepthBuffer,h._generateStencilBuffer=k.generateStencilBuffer,V.width=E,V.height=E,V.isReady=!0,V.isCube=!0,V.samples=1,V.generateMipMaps=k.generateMipMaps,V.samplingMode=k.samplingMode,V.type=k.type,V.format=k.format,this._internalTexturesCache.push(V),h.setTextures(V),h};var S=h(11659),M=h(11381),I=h(11677);G.ThinEngine.prototype.createPrefilteredCubeTexture=function(E,b,h,k){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,V=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6?arguments[6]:void 0,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,v=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];return this.createCubeTexture(E,b,null,!1,(E=>{if(!E)return void(G&&G(null));const V=E.texture;if(v?E.info.sphericalPolynomial&&(V._sphericalPolynomial=E.info.sphericalPolynomial):V._sphericalPolynomial=new S.h,V._source=9,this.getCaps().textureLOD)return void(G&&G(V));const l=this._gl,O=E.width;if(!O)return;const U=[];for(let G=0;G<3;G++){const v=1-G/2,B=k,o=Math.log2(O)*h+k,u=B+(o-B)*v,D=Math.round(Math.min(Math.max(u,0),o)),g=new a.b(this,2);if(g.type=V.type,g.format=V.format,g.width=Math.pow(2,Math.max(Math.log2(O)-D,0)),g.height=g.width,g.isCube=!0,g._cachedWrapU=0,g._cachedWrapV=0,this._bindTextureDirectly(l.TEXTURE_CUBE_MAP,g,!0),g.samplingMode=2,l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MAG_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MIN_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),E.isDDS){const b=E.info,h=E.data;this._unpackFlipY(b.isCompressed),I.c.UploadDDSLevels(this,g,h,b,!0,6,D)}else s.c.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(l.TEXTURE_CUBE_MAP,null);const S=new M.e(b);S._isCube=!0,S._texture=g,g.isReady=!0,U.push(S)}V._lodTextureHigh=U[2],V._lodTextureMid=U[1],V._lodTextureLow=U[0],G&&G(V)}),V,l,O,v,h,k)},G.ThinEngine.prototype.createUniformBuffer=function(E,b){const h=this._gl.createBuffer();if(!h)throw new Error("Unable to create uniform buffer");const a=new v.c(h);return this.bindUniformBuffer(a),E instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,E,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(E),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),a.references=1,a},G.ThinEngine.prototype.createDynamicUniformBuffer=function(E,b){const h=this._gl.createBuffer();if(!h)throw new Error("Unable to create dynamic uniform buffer");const a=new v.c(h);return this.bindUniformBuffer(a),E instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,E,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(E),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),a.references=1,a},G.ThinEngine.prototype.updateUniformBuffer=function(E,b,h,a){this.bindUniformBuffer(E),void 0===h&&(h=0),void 0===a?b instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,h,b):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,h,new Float32Array(b)):b instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,b.subarray(h,h+a)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(b).subarray(h,h+a)),this.bindUniformBuffer(null)},G.ThinEngine.prototype.bindUniformBuffer=function(E){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,E?E.underlyingResource:null)},G.ThinEngine.prototype.bindUniformBufferBase=function(E,b,h){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,b,E?E.underlyingResource:null)},G.ThinEngine.prototype.bindUniformBlock=function(E,b,h){const a=E.program,k=this._gl.getUniformBlockIndex(a,b);4294967295!==k&&this._gl.uniformBlockBinding(a,k,h)};var j=h(10832),P=h(10902);P.d.prototype.displayLoadingUI=function(){if(!(0,j.i)())return;const E=this.loadingScreen;E&&E.displayLoadingUI()},P.d.prototype.hideLoadingUI=function(){if(!(0,j.i)())return;const E=this._loadingScreen;E&&E.hideLoadingUI()},Object.defineProperty(P.d.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=P.d.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(E){this._loadingScreen=E},enumerable:!0,configurable:!0}),Object.defineProperty(P.d.prototype,"loadingUIText",{set:function(E){this.loadingScreen.loadingUIText=E},enumerable:!0,configurable:!0}),Object.defineProperty(P.d.prototype,"loadingUIBackgroundColor",{set:function(E){this.loadingScreen.loadingUIBackgroundColor=E},enumerable:!0,configurable:!0}),P.d.prototype.getInputElement=function(){return this._renderingCanvas},P.d.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},P.d.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},P.d.prototype.getAspectRatio=function(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const h=E.viewport;return this.getRenderWidth(b)*h.width/(this.getRenderHeight(b)*h.height)},P.d.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},P.d.prototype._verifyPointerLock=function(){var E;null===(E=this._onPointerLockChange)||void 0===E||E.call(this)},P.d.prototype.setAlphaEquation=function(E){if(this._alphaEquation!==E){switch(E){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=E}},P.d.prototype.getInputElement=function(){return this._renderingCanvas},P.d.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},P.d.prototype.setDepthFunction=function(E){this._depthCullingState.depthFunc=E},P.d.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},P.d.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},P.d.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},P.d.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},P.d.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},P.d.prototype.setDepthWrite=function(E){this._depthCullingState.depthMask=E},P.d.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},P.d.prototype.setStencilBuffer=function(E){this._stencilState.stencilTest=E},P.d.prototype.getStencilMask=function(){return this._stencilState.stencilMask},P.d.prototype.setStencilMask=function(E){this._stencilState.stencilMask=E},P.d.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},P.d.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},P.d.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},P.d.prototype.setStencilFunction=function(E){this._stencilState.stencilFunc=E},P.d.prototype.setStencilFunctionReference=function(E){this._stencilState.stencilFuncRef=E},P.d.prototype.setStencilFunctionMask=function(E){this._stencilState.stencilFuncMask=E},P.d.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},P.d.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},P.d.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},P.d.prototype.setStencilOperationFail=function(E){this._stencilState.stencilOpStencilFail=E},P.d.prototype.setStencilOperationDepthFail=function(E){this._stencilState.stencilOpDepthFail=E},P.d.prototype.setStencilOperationPass=function(E){this._stencilState.stencilOpStencilDepthPass=E},P.d.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},P.d.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},P.d.prototype.setAlphaConstants=function(E,b,h,a){this._alphaState.setAlphaBlendConstants(E,b,h,a)},P.d.prototype.getAlphaMode=function(){return this._alphaMode},P.d.prototype.getAlphaEquation=function(){return this._alphaEquation},P.d.prototype.getRenderPassNames=function(){return this._renderPassNames},P.d.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},P.d.prototype.createRenderPassId=function(E){const b=++P.d._RenderPassIdCounter;return this._renderPassNames[b]=E??"NONAME",b},P.d.prototype.releaseRenderPassId=function(E){this._renderPassNames[E]=void 0;for(let b=0;b<this.scenes.length;++b){const h=this.scenes[b];for(let b=0;b<h.meshes.length;++b){const a=h.meshes[b];if(a.wg)for(let b=0;b<a.wg.length;++b){a.wg[b]._removeDrawWrapper(E)}}}};h(11653);function A(E){if(E.requestPointerLock){const b=E.requestPointerLock();b instanceof Promise?b.then((()=>{E.focus()})).catch((()=>{})):E.focus()}}var n=h(10972);h(11722);class d extends G.ThinEngine{static get NpmPackage(){return P.d.NpmPackage}static get Version(){return P.d.Version}static get Instances(){return k.b.Instances}static get LastCreatedEngine(){return k.b.LastCreatedEngine}static get LastCreatedScene(){return k.b.LastCreatedScene}static DefaultLoadingScreenFactory(E){return P.d.DefaultLoadingScreenFactory(E)}get _supportsHardwareTextureRescaling(){return!!d._RescalePostProcessFactory}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}get performanceMonitor(){return this._performanceMonitor}constructor(E,b,h){if(super(E,b,h,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this.customAnimationFrameRequester=null,this._performanceMonitor=new l,this._drawCalls=new n.d,E&&(this._features.supportRenderPasses=!0,h=this._creationOptions,E.getContext)){const b=E;this._sharedInit(b)}}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_sharedInit(E){super._sharedInit(E),function(E,b,h){E._onCanvasFocus=()=>{E.onCanvasFocusObservable.notifyObservers(E)},E._onCanvasBlur=()=>{E.onCanvasBlurObservable.notifyObservers(E)},E._onCanvasContextMenu=b=>{E.disableContextMenu&&b.preventDefault()},b.addEventListener("focus",E._onCanvasFocus),b.addEventListener("blur",E._onCanvasBlur),b.addEventListener("contextmenu",E._onCanvasContextMenu),E._onBlur=()=>{E.disablePerformanceMonitorInBackground&&E.performanceMonitor.disable(),E._windowIsBackground=!0},E._onFocus=()=>{E.disablePerformanceMonitorInBackground&&E.performanceMonitor.enable(),E._windowIsBackground=!1},E._onCanvasPointerOut=h=>{document.elementFromPoint(h.clientX,h.clientY)!==b&&E.onCanvasPointerOutObservable.notifyObservers(h)};const a=E.getHostWindow();a&&"function"===typeof a.addEventListener&&(a.addEventListener("blur",E._onBlur),a.addEventListener("focus",E._onFocus)),b.addEventListener("pointerout",E._onCanvasPointerOut),h.doNotHandleTouchAction||function(E){E&&E.setAttribute&&(E.setAttribute("touch-action","none"),E.style.touchAction="none",E.style.webkitTapHighlightColor="transparent")}(b),!P.d.audioEngine&&h.audioEngine&&P.d.AudioEngineFactory&&(P.d.audioEngine=P.d.AudioEngineFactory(E.getRenderingCanvas(),E.getAudioContext(),E.getAudioDestination())),(0,j.e)()&&(E._onFullscreenChange=()=>{E.isFullscreen=!!document.fullscreenElement,E.isFullscreen&&E._pointerLockRequested&&b&&A(b)},document.addEventListener("fullscreenchange",E._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",E._onFullscreenChange,!1),E._onPointerLockChange=()=>{E.isPointerLock=document.pointerLockElement===b},document.addEventListener("pointerlockchange",E._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",E._onPointerLockChange,!1)),E.enableOfflineSupport=void 0!==P.d.OfflineProviderFactory,E._deterministicLockstep=!!h.deterministicLockstep,E._lockstepMaxSteps=h.lockstepMaxSteps||0,E._timeStep=h.timeStep||1/60}(this,E,this._creationOptions)}resizeImageBitmap(E,b,h){return function(E,b,h,a){const k=E.createCanvas(h,a).getContext("2d");if(!k)throw new Error("Unable to get 2d context for resizeImageBitmap");return k.drawImage(b,0,0),k.getImageData(0,0,h,a).data}(this,E,b,h)}_createImageBitmapFromSource(E,b){return function(E,b,h){return new Promise(((a,k)=>{const G=new Image;G.onload=()=>{G.decode().then((()=>{E.createImageBitmap(G,h).then((E=>{a(E)}))}))},G.onerror=()=>{k(`Error loading image ${G.src}`)},G.src=b}))}(this,E,b)}switchFullscreen(E){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(E)}enterFullscreen(E){this.isFullscreen||(this._pointerLockRequested=E,this._renderingCanvas&&function(E){const b=E.requestFullscreen||E.webkitRequestFullscreen;b&&b.call(E)}(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&function(){const E=document;document.exitFullscreen?document.exitFullscreen():E.webkitCancelFullScreen&&E.webkitCancelFullScreen()}()}setDitheringState(E){E?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(E){E?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}setDirectViewport(E,b,h,a){const k=this._cachedViewport;return this._cachedViewport=null,this._viewport(E,b,h,a),k}scissorClear(E,b,h,a,k){this.enableScissor(E,b,h,a),this.clear(k,!0,!0,!0),this.disableScissor()}enableScissor(E,b,h,a){const k=this._gl;k.enable(k.SCISSOR_TEST),k.scissor(E,b,h,a)}disableScissor(){const E=this._gl;E.disable(E.SCISSOR_TEST)}_loadFileAsync(E,b,h){return new Promise(((a,k)=>{this._loadFile(E,(E=>{a(E)}),void 0,b,h,((E,b)=>{k(b)}))}))}getVertexShaderSource(E){const b=this._gl.getAttachedShaders(E);return b?this._gl.getShaderSource(b[0]):null}getFragmentShaderSource(E){const b=this._gl.getAttachedShaders(E);return b?this._gl.getShaderSource(b[1]):null}set framebufferDimensionsObject(E){this._framebufferDimensionsObject=E,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}_rebuildBuffers(){for(const E of this.scenes)E.resetCachedMaterial(),E._rebuildGeometries();for(const E of this._virtualScenes)E.resetCachedMaterial(),E._rebuildGeometries();super._rebuildBuffers()}getFontOffset(E){return function(E){const b=document.createElement("span");b.textContent="Hg",b.style.font=E;const h=document.createElement("div");h.style.display="inline-block",h.style.width="1px",h.style.height="0px",h.style.verticalAlign="bottom";const a=document.createElement("div");a.style.whiteSpace="nowrap",a.appendChild(b),a.appendChild(h),document.body.appendChild(a);let k=0,G=0;try{G=h.getBoundingClientRect().top-b.getBoundingClientRect().top,h.style.verticalAlign="baseline",k=h.getBoundingClientRect().top-b.getBoundingClientRect().top}finally{document.body.removeChild(a)}return{ascent:k,height:G,descent:G-k}}(E)}_cancelFrame(){if(this.customAnimationFrameRequester){if(0!==this._frameHandler){this._frameHandler=0;const{cancelAnimationFrame:E}=this.customAnimationFrameRequester;E&&E(this.customAnimationFrameRequester.v)}}else super._cancelFrame()}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let E=!0;(this.u||!this.renderEvenInBackground&&this._windowIsBackground)&&(E=!1),E&&(this.mj(),this._renderViews()||this._renderFrame(),this.nj())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.v=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.v):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}enterPointerlock(){this._renderingCanvas&&A(this._renderingCanvas)}exitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}mj(){this._measureFps(),super.mj()}_deletePipelineContext(E){const b=E;b&&b.program&&b.transformFeedback&&(this.deleteTransformFeedback(b.transformFeedback),b.transformFeedback=null),super._deletePipelineContext(E)}createShaderProgram(E,b,h,a,k){let G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;k=k||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const V=super.createShaderProgram(E,b,h,a,k,G);return this.onAfterShaderCompilationObservable.notifyObservers(this),V}_createShaderProgram(E,b,h,a){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const G=a.createProgram();if(E.program=G,!G)throw new Error("Unable to create program");if(a.attachShader(G,b),a.attachShader(G,h),this.webGLVersion>1&&k){const b=this.createTransformFeedback();this.bindTransformFeedback(b),this.setTranformFeedbackVaryings(G,k),E.transformFeedback=b}return a.linkProgram(G),this.webGLVersion>1&&k&&this.bindTransformFeedback(null),E.context=a,E.vertexShader=b,E.fragmentShader=h,E.isParallelCompiled||this._finalizePipelineContext(E),G}_releaseTexture(E){super._releaseTexture(E)}_releaseRenderTargetWrapper(E){super._releaseRenderTargetWrapper(E),this.scenes.forEach((b=>{b.postProcesses.forEach((b=>{b._outputTexture===E&&(b._outputTexture=null)})),b.cameras.forEach((b=>{b._postProcesses.forEach((b=>{b&&b._outputTexture===E&&(b._outputTexture=null)}))}))}))}_rescaleTexture(E,b,h,a,k){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const G=this.createRenderTargetTexture({width:b.width,height:b.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});if(!this._rescalePostProcess&&d._RescalePostProcessFactory&&(this._rescalePostProcess=d._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;const V=()=>{this._rescalePostProcess.onApply=function(b){b._bindTexture("textureSampler",E)};let V=h;V||(V=this.scenes[this.scenes.length-1]),V.postProcessManager.directRender([this._rescalePostProcess],G,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,b,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,a,0,0,b.width,b.height,0),this.unBindFramebuffer(G),G.dispose(),k&&k()},l=this._rescalePostProcess.getEffect();l?l.executeWhenCompiled(V):this._rescalePostProcess.onEffectCreatedObservable.addOnce((E=>{E.executeWhenCompiled(V)}))}}wrapWebGLTexture(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const V=new U.e(E,this._gl),l=new a.b(this,0,!0);return l._hardwareTexture=V,l.baseWidth=k,l.baseHeight=G,l.width=k,l.height=G,l.isReady=!0,l.useMipMaps=b,this.updateTextureSamplingMode(h,l),l}_uploadImageToTexture(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const k=this._gl,G=this._getWebGLTextureType(E.type),V=this._getInternalFormat(E.format),l=this._getRGBABufferInternalSizedFormat(E.type,V),O=E.isCube?k.TEXTURE_CUBE_MAP:k.TEXTURE_2D;this._bindTextureDirectly(O,E,!0),this._unpackFlipY(E.invertY);let v=k.TEXTURE_2D;E.isCube&&(v=k.TEXTURE_CUBE_MAP_POSITIVE_X+h),k.texImage2D(v,a,l,V,G,b),this._bindTextureDirectly(O,null,!0)}updateTextureComparisonFunction(E,b){if(1===this.webGLVersion)return void s.c.Error("WebGL 1 does not support texture comparison.");const h=this._gl;E.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,E,!0),0===b?(h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_COMPARE_FUNC,515),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_COMPARE_MODE,h.NONE)):(h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_COMPARE_FUNC,b),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_COMPARE_MODE,h.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,E,!0),0===b?(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_COMPARE_FUNC,515),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_COMPARE_MODE,h.NONE)):(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_COMPARE_FUNC,b),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_COMPARE_MODE,h.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),E._comparisonFunction=b}createInstancesBuffer(E){const b=this._gl.createBuffer();if(!b)throw new Error("Unable to create instance buffer");const h=new v.c(b);return h.mb=E,this.bindArrayBuffer(h),this._gl.bufferData(this._gl.ARRAY_BUFFER,E,this._gl.DYNAMIC_DRAW),h.references=1,h}deleteInstancesBuffer(E){this._gl.deleteBuffer(E)}_clientWaitAsync(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;const a=this._gl;return new Promise(((k,G)=>{const V=()=>{const l=a.clientWaitSync(E,b,0);l!=a.WAIT_FAILED?l!=a.TIMEOUT_EXPIRED?k():setTimeout(V,h):G()};V()}))}_readPixelsAsync(E,b,h,a,k,G,V){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const l=this._gl,O=l.createBuffer();l.bindBuffer(l.PIXEL_PACK_BUFFER,O),l.bufferData(l.PIXEL_PACK_BUFFER,V.byteLength,l.STREAM_READ),l.readPixels(E,b,h,a,k,G,0),l.bindBuffer(l.PIXEL_PACK_BUFFER,null);const v=l.fenceSync(l.SYNC_GPU_COMMANDS_COMPLETE,0);return v?(l.flush(),this._clientWaitAsync(v,0,10).then((()=>(l.deleteSync(v),l.bindBuffer(l.PIXEL_PACK_BUFFER,O),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,V),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),l.deleteBuffer(O),V)))):null}dispose(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),function(E,b){1===k.b.Instances.length&&P.d.audioEngine&&(P.d.audioEngine.dispose(),P.d.audioEngine=null);const h=E.getHostWindow();h&&"function"===typeof h.removeEventListener&&(h.removeEventListener("blur",E._onBlur),h.removeEventListener("focus",E._onFocus)),b&&(b.removeEventListener("focus",E._onCanvasFocus),b.removeEventListener("blur",E._onCanvasBlur),b.removeEventListener("pointerout",E._onCanvasPointerOut),b.removeEventListener("contextmenu",E._onCanvasContextMenu)),(0,j.e)()&&(document.removeEventListener("fullscreenchange",E._onFullscreenChange),document.removeEventListener("mozfullscreenchange",E._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",E._onFullscreenChange),document.removeEventListener("msfullscreenchange",E._onFullscreenChange),document.removeEventListener("pointerlockchange",E._onPointerLockChange),document.removeEventListener("mspointerlockchange",E._onPointerLockChange),document.removeEventListener("mozpointerlockchange",E._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",E._onPointerLockChange))}(this,this._renderingCanvas),super.dispose()}}d.ALPHA_DISABLE=0,d.ALPHA_ADD=1,d.ALPHA_COMBINE=2,d.ALPHA_SUBTRACT=3,d.ALPHA_MULTIPLY=4,d.ALPHA_MAXIMIZED=5,d.ALPHA_ONEONE=6,d.ALPHA_PREMULTIPLIED=7,d.ALPHA_PREMULTIPLIED_PORTERDUFF=8,d.ALPHA_INTERPOLATE=9,d.ALPHA_SCREENMODE=10,d.DELAYLOADSTATE_NONE=0,d.DELAYLOADSTATE_LOADED=1,d.DELAYLOADSTATE_LOADING=2,d.DELAYLOADSTATE_NOTLOADED=4,d.NEVER=512,d.ALWAYS=519,d.LESS=513,d.EQUAL=514,d.LEQUAL=515,d.GREATER=516,d.GEQUAL=518,d.NOTEQUAL=517,d.KEEP=7680,d.REPLACE=7681,d.INCR=7682,d.DECR=7683,d.INVERT=5386,d.INCR_WRAP=34055,d.DECR_WRAP=34056,d.TEXTURE_CLAMP_ADDRESSMODE=0,d.TEXTURE_WRAP_ADDRESSMODE=1,d.TEXTURE_MIRROR_ADDRESSMODE=2,d.TEXTUREFORMAT_ALPHA=0,d.TEXTUREFORMAT_LUMINANCE=1,d.TEXTUREFORMAT_LUMINANCE_ALPHA=2,d.TEXTUREFORMAT_RGB=4,d.TEXTUREFORMAT_RGBA=5,d.TEXTUREFORMAT_RED=6,d.TEXTUREFORMAT_R=6,d.TEXTUREFORMAT_RG=7,d.TEXTUREFORMAT_RED_INTEGER=8,d.TEXTUREFORMAT_R_INTEGER=8,d.TEXTUREFORMAT_RG_INTEGER=9,d.TEXTUREFORMAT_RGB_INTEGER=10,d.TEXTUREFORMAT_RGBA_INTEGER=11,d.TEXTURETYPE_UNSIGNED_BYTE=0,d.TEXTURETYPE_UNSIGNED_INT=0,d.TEXTURETYPE_FLOAT=1,d.TEXTURETYPE_HALF_FLOAT=2,d.TEXTURETYPE_BYTE=3,d.TEXTURETYPE_SHORT=4,d.TEXTURETYPE_UNSIGNED_SHORT=5,d.TEXTURETYPE_INT=6,d.TEXTURETYPE_UNSIGNED_INTEGER=7,d.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,d.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,d.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,d.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,d.TEXTURETYPE_UNSIGNED_INT_24_8=12,d.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,d.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,d.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,d.TEXTURE_NEAREST_SAMPLINGMODE=1,d.TEXTURE_BILINEAR_SAMPLINGMODE=2,d.TEXTURE_TRILINEAR_SAMPLINGMODE=3,d.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,d.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,d.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,d.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,d.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,d.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,d.TEXTURE_NEAREST_LINEAR=7,d.TEXTURE_NEAREST_NEAREST=1,d.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,d.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,d.TEXTURE_LINEAR_LINEAR=2,d.TEXTURE_LINEAR_NEAREST=12,d.TEXTURE_EXPLICIT_MODE=0,d.TEXTURE_SPHERICAL_MODE=1,d.TEXTURE_PLANAR_MODE=2,d.TEXTURE_CUBIC_MODE=3,d.TEXTURE_PROJECTION_MODE=4,d.TEXTURE_SKYBOX_MODE=5,d.TEXTURE_INVCUBIC_MODE=6,d.TEXTURE_EQUIRECTANGULAR_MODE=7,d.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,d.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,d.SCALEMODE_FLOOR=1,d.SCALEMODE_NEAREST=2,d.SCALEMODE_CEILING=3},10869:(E,b,h)=>{"use strict";h.d(b,{b:()=>k});var a=h(10824);class k{static get LastCreatedEngine(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}static get LastCreatedScene(){return this._LastCreatedScene}}k.Instances=[],k.OnEnginesDisposedObservable=new a.e,k._LastCreatedScene=null,k.UseFallbackTexture=!0,k.FallbackTexture=""},12641:(E,b,h)=>{"use strict";h(10834);var a=h(11640);h(10939),h(11240),h(10931),h(11647),h(11603);a.b},10931:(E,b,h)=>{"use strict";h.d(b,{c:()=>a});class a{static SetMatrixPrecision(E){if(a.MatrixTrackPrecisionChange=!1,E&&!a.MatrixUse64Bits&&a.MatrixTrackedMatrices)for(let b=0;b<a.MatrixTrackedMatrices.length;++b){const E=a.MatrixTrackedMatrices[b],h=E.Xj;E.Xj=new Array(16);for(let b=0;b<16;++b)E.Xj[b]=h[b]}a.MatrixUse64Bits=E,a.MatrixCurrentType=a.MatrixUse64Bits?Array:Float32Array,a.MatrixTrackedMatrices=null}}a.MatrixUse64Bits=!1,a.MatrixTrackPrecisionChange=!0,a.MatrixCurrentType=Float32Array,a.MatrixTrackedMatrices=[]},11647:(E,b,h)=>{"use strict";h.d(b,{d:()=>a});class a{get depthStencilTexture(){return this._depthStencilTexture}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}get isCube(){return this._isCube}get isMulti(){return this._isMulti}get is2DArray(){return this.layers>0}get is3D(){return this.depth>0}get size(){return this.width}get width(){return this._size.width||this._size}get height(){return this._size.height||this._size}get layers(){return this._size.layers||0}get depth(){return this._size.depth||0}get texture(){var E;return(null===(E=this._textures)||void 0===E?void 0:E[0])??null}get textures(){return this._textures}get faceIndices(){return this._faceIndices}get layerIndices(){return this._layerIndices}getBaseArrayLayer(E){var b,h;if(!this._textures)return-1;const a=this._textures[E],k=(null===(b=this._layerIndices)||void 0===b?void 0:b[E])??0,G=(null===(h=this._faceIndices)||void 0===h?void 0:h[E])??0;return a.isCube?6*k+G:a.is3D?0:k}get samples(){return this._samples}setSamples(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.samples===E&&!h)return E;const a=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,E,b):this._engine.updateRenderTargetTextureSampleCount(this,E);return this._samples=E,a}constructor(E,b,h,a,k){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this._isMulti=E,this._isCube=b,this._size=h,this._engine=a,this._depthStencilTexture=null,this.label=k}setTextures(E){Array.isArray(E)?this._textures=E:this._textures=E?[E]:null}setTexture(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._textures||(this._textures=[]),this._textures[b]!==E&&(this._textures[b]&&h&&this._textures[b].dispose(),this._textures[b]=E)}setLayerAndFaceIndices(E,b){this._layerIndices=E,this._faceIndices=b}setLayerAndFaceIndex(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1?arguments[1]:void 0,h=arguments.length>2?arguments[2]:void 0;this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),void 0!==b&&b>=0&&(this._layerIndices[E]=b),void 0!==h&&h>=0&&(this._faceIndices[E]=h)}createDepthStencilTexture(){var E;let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,V=arguments.length>5?arguments[5]:void 0;return null===(E=this._depthStencilTexture)||void 0===E||E.dispose(),this._depthStencilTextureWithStencil=a,this._depthStencilTextureLabel=V,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:h,comparisonFunction:b,generateStencil:a,isCube:this._isCube,samples:k,depthTextureFormat:G,label:V},this),this._depthStencilTexture}_shareDepth(E){this.shareDepth(E)}shareDepth(E){this._depthStencilTexture&&(E._depthStencilTexture&&E._depthStencilTexture.dispose(),E._depthStencilTexture=this._depthStencilTexture,E._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}_swapAndDie(E){this.texture&&this.texture._swapAndDie(E),this._textures=null,this.dispose(!0)}_cloneRenderTargetWrapper(){let E=null;if(this._isMulti){const b=this.textures;if(b&&b.length>0){let h=!1,a=b.length,k=-1;const G=b[b.length-1]._source;14!==G&&12!==G||(h=!0,k=b[b.length-1].format,a--);const V=[],l=[],O=[],v=[],s=[],U=[],B=[],o={};for(let E=0;E<a;++E){const h=b[E];V.push(h.samplingMode),l.push(h.type),O.push(h.format);void 0!==o[h.uniqueId]?(v.push(-1),B.push(0)):(o[h.uniqueId]=E,h.is2DArray?(v.push(35866),B.push(h.depth)):h.isCube?(v.push(34067),B.push(0)):h.is3D?(v.push(32879),B.push(h.depth)):(v.push(3553),B.push(0))),this._faceIndices&&s.push(this._faceIndices[E]??0),this._layerIndices&&U.push(this._layerIndices[E]??0)}const u={samplingModes:V,generateMipMaps:b[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:h,depthTextureFormat:k,types:l,formats:O,textureCount:a,targetTypes:v,faceIndex:s,layerIndex:U,layerCounts:B,label:this.label},D={width:this.width,height:this.height,depth:this.depth};E=this._engine.createMultipleRenderTarget(D,u);for(let g=0;g<a;++g){if(-1!==v[g])continue;const h=o[b[g].uniqueId];E.setTexture(E.textures[h],g)}}}else{var b,h,a,k;const V={};if(V.generateDepthBuffer=this._generateDepthBuffer,V.generateMipMaps=(null===(b=this.texture)||void 0===b?void 0:b.generateMipMaps)??!1,V.generateStencilBuffer=this._generateStencilBuffer,V.samplingMode=null===(h=this.texture)||void 0===h?void 0:h.samplingMode,V.type=null===(a=this.texture)||void 0===a?void 0:a.type,V.format=null===(k=this.texture)||void 0===k?void 0:k.format,V.noColorAttachment=!this._textures,V.label=this.label,this.isCube)E=this._engine.createRenderTargetCubeTexture(this.width,V);else{var G;const b={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?null===(G=this.texture)||void 0===G?void 0:G.depth:void 0};E=this._engine.createRenderTargetTexture(b,V)}E.texture&&(E.texture.isReady=!0)}return E}_swapRenderTargetWrapper(E){if(this._textures&&E._textures)for(let b=0;b<this._textures.length;++b)this._textures[b]._swapAndDie(E._textures[b],!1),E._textures[b].isReady=!0;this._depthStencilTexture&&E._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(E._depthStencilTexture),E._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}_rebuild(){const E=this._cloneRenderTargetWrapper();if(E){if(this._depthStencilTexture){const b=this._depthStencilTexture.samplingMode,h=this._depthStencilTexture.format,a=2===b||3===b||11===b;E.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,a,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,h,this._depthStencilTextureLabel)}this.samples>1&&E.setSamples(this.samples),E._swapRenderTargetWrapper(this),E.dispose()}}releaseTextures(){if(this._textures)for(let b=0;b<(null===(E=this._textures)||void 0===E?void 0:E.length);++b){var E;this._textures[b].dispose()}this._textures=null}dispose(){var E;arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(null===(E=this._depthStencilTexture)||void 0===E||E.dispose(),this._depthStencilTexture=null,this.releaseTextures());this._engine._releaseRenderTargetWrapper(this)}}},10912:(E,b,h)=>{"use strict";h.d(b,{d:()=>a});class a{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?a.ShadersRepository:a.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?a.ShadersStore:a.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?a.IncludesShadersStore:a.IncludesShadersStoreWGSL}}a.ShadersRepository="src/Shaders/",a.ShadersStore={},a.IncludesShadersStore={},a.ShadersRepositoryWGSL="src/ShadersWGSL/",a.ShadersStoreWGSL={},a.IncludesShadersStoreWGSL={}},10926:(E,b,h)=>{"use strict";h.d(b,{b:()=>B,d:()=>M,h:()=>o,i:()=>u,j:()=>S,n:()=>U,o:()=>v,r:()=>s,t:()=>O,w:()=>l});class a{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.xd._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(E){E&&this.program&&E(this.program)}setEngine(E){this.xd=E}_fillEffectInformation(E,b,h,a,k,G,V,l){const O=this.xd;if(O.supportsUniformBuffers)for(const s in b)E.bindUniformBlock(s,b[s]);let v;for(this.xd.getUniforms(this,h).forEach(((E,b)=>{a[h[b]]=E})),this._uniforms=a,v=0;v<k.length;v++){null==E.getUniform(k[v])&&(k.splice(v,1),v--)}k.forEach(((E,b)=>{G[E]=b}));for(const s of O.getAttributes(this,V))l.push(s)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(E,b){const h=this._valueCache[E],a=b.updateFlag;return(void 0===h||h!==a)&&(this._valueCache[E]=a,!0)}_cacheFloat2(E,b,h){let a=this._valueCache[E];if(!a||2!==a.length)return a=[b,h],this._valueCache[E]=a,!0;let k=!1;return a[0]!==b&&(a[0]=b,k=!0),a[1]!==h&&(a[1]=h,k=!0),k}_cacheFloat3(E,b,h,a){let k=this._valueCache[E];if(!k||3!==k.length)return k=[b,h,a],this._valueCache[E]=k,!0;let G=!1;return k[0]!==b&&(k[0]=b,G=!0),k[1]!==h&&(k[1]=h,G=!0),k[2]!==a&&(k[2]=a,G=!0),G}_cacheFloat4(E,b,h,a,k){let G=this._valueCache[E];if(!G||4!==G.length)return G=[b,h,a,k],this._valueCache[E]=G,!0;let V=!1;return G[0]!==b&&(G[0]=b,V=!0),G[1]!==h&&(G[1]=h,V=!0),G[2]!==a&&(G[2]=a,V=!0),G[3]!==k&&(G[3]=k,V=!0),V}setInt(E,b){const h=this._valueCache[E];void 0!==h&&h===b||this.xd.setInt(this._uniforms[E],b)&&(this._valueCache[E]=b)}setInt2(E,b,h){this._cacheFloat2(E,b,h)&&(this.xd.setInt2(this._uniforms[E],b,h)||(this._valueCache[E]=null))}setInt3(E,b,h,a){this._cacheFloat3(E,b,h,a)&&(this.xd.setInt3(this._uniforms[E],b,h,a)||(this._valueCache[E]=null))}setInt4(E,b,h,a,k){this._cacheFloat4(E,b,h,a,k)&&(this.xd.setInt4(this._uniforms[E],b,h,a,k)||(this._valueCache[E]=null))}setIntArray(E,b){this._valueCache[E]=null,this.xd.setIntArray(this._uniforms[E],b)}setIntArray2(E,b){this._valueCache[E]=null,this.xd.setIntArray2(this._uniforms[E],b)}setIntArray3(E,b){this._valueCache[E]=null,this.xd.setIntArray3(this._uniforms[E],b)}setIntArray4(E,b){this._valueCache[E]=null,this.xd.setIntArray4(this._uniforms[E],b)}setUInt(E,b){const h=this._valueCache[E];void 0!==h&&h===b||this.xd.setUInt(this._uniforms[E],b)&&(this._valueCache[E]=b)}setUInt2(E,b,h){this._cacheFloat2(E,b,h)&&(this.xd.setUInt2(this._uniforms[E],b,h)||(this._valueCache[E]=null))}setUInt3(E,b,h,a){this._cacheFloat3(E,b,h,a)&&(this.xd.setUInt3(this._uniforms[E],b,h,a)||(this._valueCache[E]=null))}setUInt4(E,b,h,a,k){this._cacheFloat4(E,b,h,a,k)&&(this.xd.setUInt4(this._uniforms[E],b,h,a,k)||(this._valueCache[E]=null))}setUIntArray(E,b){this._valueCache[E]=null,this.xd.setUIntArray(this._uniforms[E],b)}setUIntArray2(E,b){this._valueCache[E]=null,this.xd.setUIntArray2(this._uniforms[E],b)}setUIntArray3(E,b){this._valueCache[E]=null,this.xd.setUIntArray3(this._uniforms[E],b)}setUIntArray4(E,b){this._valueCache[E]=null,this.xd.setUIntArray4(this._uniforms[E],b)}setArray(E,b){this._valueCache[E]=null,this.xd.setArray(this._uniforms[E],b)}setArray2(E,b){this._valueCache[E]=null,this.xd.setArray2(this._uniforms[E],b)}setArray3(E,b){this._valueCache[E]=null,this.xd.setArray3(this._uniforms[E],b)}setArray4(E,b){this._valueCache[E]=null,this.xd.setArray4(this._uniforms[E],b)}setMatrices(E,b){b&&(this._valueCache[E]=null,this.xd.setMatrices(this._uniforms[E],b))}setMatrix(E,b){this._cacheMatrix(E,b)&&(this.xd.setMatrices(this._uniforms[E],b.qj())||(this._valueCache[E]=null))}setMatrix3x3(E,b){this._valueCache[E]=null,this.xd.setMatrix3x3(this._uniforms[E],b)}setMatrix2x2(E,b){this._valueCache[E]=null,this.xd.setMatrix2x2(this._uniforms[E],b)}setFloat(E,b){const h=this._valueCache[E];void 0!==h&&h===b||this.xd.setFloat(this._uniforms[E],b)&&(this._valueCache[E]=b)}setVector2(E,b){this._cacheFloat2(E,b.x,b.y)&&(this.xd.setFloat2(this._uniforms[E],b.x,b.y)||(this._valueCache[E]=null))}setFloat2(E,b,h){this._cacheFloat2(E,b,h)&&(this.xd.setFloat2(this._uniforms[E],b,h)||(this._valueCache[E]=null))}setVector3(E,b){this._cacheFloat3(E,b.x,b.y,b.z)&&(this.xd.setFloat3(this._uniforms[E],b.x,b.y,b.z)||(this._valueCache[E]=null))}setFloat3(E,b,h,a){this._cacheFloat3(E,b,h,a)&&(this.xd.setFloat3(this._uniforms[E],b,h,a)||(this._valueCache[E]=null))}setVector4(E,b){this._cacheFloat4(E,b.x,b.y,b.z,b.w)&&(this.xd.setFloat4(this._uniforms[E],b.x,b.y,b.z,b.w)||(this._valueCache[E]=null))}setQuaternion(E,b){this._cacheFloat4(E,b.x,b.y,b.z,b.w)&&(this.xd.setFloat4(this._uniforms[E],b.x,b.y,b.z,b.w)||(this._valueCache[E]=null))}setFloat4(E,b,h,a,k){this._cacheFloat4(E,b,h,a,k)&&(this.xd.setFloat4(this._uniforms[E],b,h,a,k)||(this._valueCache[E]=null))}setColor3(E,b){this._cacheFloat3(E,b.r,b.g,b.b)&&(this.xd.setFloat3(this._uniforms[E],b.r,b.g,b.b)||(this._valueCache[E]=null))}setColor4(E,b,h){this._cacheFloat4(E,b.r,b.g,b.b,h)&&(this.xd.setFloat4(this._uniforms[E],b.r,b.g,b.b,h)||(this._valueCache[E]=null))}setDirectColor4(E,b){this._cacheFloat4(E,b.r,b.g,b.b,b.a)&&(this.xd.setFloat4(this._uniforms[E],b.r,b.g,b.b,b.a)||(this._valueCache[E]=null))}_getVertexShaderCode(){return this.vertexShader?this.xd._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.xd._getShaderSource(this.fragmentShader):null}}var k=h(10893);const G=new WeakMap,V={_webGLVersion:2,cachedPipelines:{}};function l(E){let b=G.get(E);if(!b){if(!E)return V;b={_webGLVersion:E.TEXTURE_BINDING_3D?2:1,_context:E,cachedPipelines:{}},G.set(E,b)}return b}function O(E){G.delete(E)}function v(E,b,h,a,k,G){const V=l(a);G||(G=V._createShaderProgramInjection??B);return G(E,g(b,"vertex",a,V._contextWasLost),g(h,"fragment",a,V._contextWasLost),a,k,V.validateShaderPrograms)}function s(E,b,h,a,k){let G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6?arguments[6]:void 0;const O=l(k);V||(V=O._createShaderProgramInjection??B);const v=O._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return V(E,D(b,"vertex",a,v,k,O._contextWasLost),D(h,"fragment",a,v,k,O._contextWasLost),k,G,O.validateShaderPrograms)}function U(E,b){const h=new a,k=l(E);return k.parallelShaderCompile&&(h.isParallelCompiled=!0),h.context=k._context,h}function B(E,b,h,a){let k=arguments.length>5?arguments[5]:void 0;const G=a.createProgram();if(E.program=G,!G)throw new Error("Unable to create program");return a.attachShader(G,b),a.attachShader(G,h),a.linkProgram(G),E.context=a,E.vertexShader=b,E.fragmentShader=h,E.isParallelCompiled||o(E,a,k),G}function o(E,b,h){const a=E.context,k=E.vertexShader,G=E.fragmentShader,V=E.program;if(!a.getProgramParameter(V,a.LINK_STATUS)){if(!b.getShaderParameter(k,b.COMPILE_STATUS)){const h=b.getShaderInfoLog(k);if(h)throw E.vertexCompilationError=h,new Error("VERTEX SHADER "+h)}if(!b.getShaderParameter(G,b.COMPILE_STATUS)){const h=b.getShaderInfoLog(G);if(h)throw E.fragmentCompilationError=h,new Error("FRAGMENT SHADER "+h)}const h=a.getProgramInfoLog(V);if(h)throw E.programLinkError=h,new Error(h)}if(h){a.validateProgram(V);if(!a.getProgramParameter(V,a.VALIDATE_STATUS)){const b=a.getProgramInfoLog(V);if(b)throw E.programValidationError=b,new Error(b)}}a.deleteShader(k),a.deleteShader(G),E.vertexShader=void 0,E.fragmentShader=void 0,E.onCompiled&&(E.onCompiled(),E.onCompiled=void 0)}function u(E,b,h,a,k,G,V,O,U){let B=arguments.length>10?arguments[10]:void 0,o=arguments.length>11?arguments[11]:void 0,u=arguments.length>12?arguments[12]:void 0;const D=l(E.context);o||(o=D.createRawShaderProgramInjection??v),u||(u=D.createShaderProgramInjection??s);const g=E;g.program=a?o(g,b,h,g.context,U):u(g,b,h,O,g.context,U),g.program.__SPECTOR_rebuildProgram=V,B()}function D(E,b,h,a,G,V){return g((0,k.d)(E,h,a),b,G,V)}function g(E,b,h,a){const k=h.createShader("vertex"===b?h.VERTEX_SHADER:h.FRAGMENT_SHADER);if(!k){let E=h.NO_ERROR,k=h.NO_ERROR;for(;(k=h.getError())!==h.NO_ERROR;)E=k;throw new Error(`Something went wrong while creating a gl ${b} shader object. gl error=${E}, gl isContextLost=${h.isContextLost()}, _contextWasLost=${a}`)}return h.shaderSource(k,E),h.compileShader(k),k}function S(E,b){b.useProgram(E)}function M(E,b){const h=E;if(!h.isParallelCompiled)return void b(E);const a=h.onCompiled;h.onCompiled=()=>{null===a||void 0===a||a(),b(E)}}},11594:(E,b,h)=>{"use strict";h.r(b),h.d(b,{ThinEngine:()=>I});var a=h(10926),k=h(11603),G=h(10834),V=h(10832);class l{constructor(){this.shaderLanguage=0}postProcessor(E,b,h,a,k){if(k.drawBuffersExtensionDisabled){const b=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;E=E.replace(b,"")}return E}}const O=/(flat\s)?\s*varying\s*.*/;class v{constructor(){this.shaderLanguage=0}attributeProcessor(E){return E.replace("attribute","in")}varyingCheck(E,b){return O.test(E)}varyingProcessor(E,b){return E.replace("varying",b?"in":"out")}postProcessor(E,b,h){const a=-1!==E.search(/#extension.+GL_EXT_draw_buffers.+require/);if(E=(E=E.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),h){const b=-1!==E.search(/layout *\(location *= *0\) *out/g);E=(E=(E=(E=(E=(E=(E=E.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(a||b?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==b.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+E}return E}}var s=h(11612),U=h(10968),B=h(10902),o=h(11617),u=h(10939),D=h(10905),g=h(10893),S=h(10918);class M{}class I extends B.d{get name(){return this._name}set name(E){this._name=E}get version(){return this._webGLVersion}static get ShadersRepository(){return D.b.ShadersRepository}static set ShadersRepository(E){D.b.ShadersRepository=E}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(E){this._framebufferDimensionsObject=E}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(E,b,h,k){if(h=h||{},super(b??h.antialias,h,k),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!E)return;let V=null;if(E.getContext){if(V=E,this._renderingCanvas=V,void 0===h.Ih&&(h.Ih=!1),void 0===h.xrCompatible&&(h.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const E=navigator.userAgent;for(const b of I.ExceptionList){const a=b.key,k=b.targets;if(new RegExp(a).test(E)){if(b.capture&&b.captureConstraint){const h=b.capture,a=b.captureConstraint,k=new RegExp(h).exec(E);if(k&&k.length>0){if(parseInt(k[k.length-1])>=a)continue}}for(const E of k)switch(E){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":h.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost||(this._onContextLost=E=>{E.preventDefault(),this._contextWasLost=!0,G.c.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},V.addEventListener("webglcontextlost",this._onContextLost,!1),V.addEventListener("webglcontextrestored",this._onContextRestored,!1),h.powerPreference=h.powerPreference||"high-performance"),this._badDesktopOS&&(h.xrCompatible=!1),!h.disableWebGL2Support)try{this._gl=V.getContext("webgl2",h)||V.getContext("experimental-webgl2",h),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(U){}if(!this._gl){if(!V)throw new Error("The provided canvas is null or undefined.");try{this._gl=V.getContext("webgl",h)||V.getContext("experimental-webgl",h)}catch(U){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=E,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const b=this._gl.getContextAttributes();b&&(h.stencil=b.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==h.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=h.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let a=0;a<this._caps.maxVertexAttribs;a++)this._currentBufferPointers[a]=new M;this._shaderProcessor=this.webGLVersion>1?new v:new l;const O=`Babylon.js v${I.Version}`;G.c.Log(O+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",O);const s=(0,a.w)(this._gl);s.validateShaderPrograms=this.validateShaderPrograms,s.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(E){return null}areAllEffectsReady(){for(const E in this._compiledEffects){if(!this._compiledEffects[E].isReady())return!1}return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const E=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=E&&(this._glRenderer=this._gl.getParameter(E.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(E.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{const E=this._gl.getExtension("WEBGL_draw_buffers");if(null!==E){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=E.drawBuffersWEBGL.bind(E),this._caps.maxDrawBuffers=this._gl.getParameter(E.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let b=0;b<16;b++)this._gl["COLOR_ATTACHMENT"+b+"_WEBGL"]=E["COLOR_ATTACHMENT"+b+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const E=this._gl.getExtension("WEBGL_depth_texture");null!=E&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=E.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const E=this._gl.getExtension("OES_vertex_array_object");null!=E&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=E.createVertexArrayOES.bind(E),this._gl.bindVertexArray=E.bindVertexArrayOES.bind(E),this._gl.deleteVertexArray=E.deleteVertexArrayOES.bind(E))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const E=this._gl.getExtension("ANGLE_instanced_arrays");null!=E?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=E.drawArraysInstancedANGLE.bind(E),this._gl.drawElementsInstanced=E.drawElementsInstancedANGLE.bind(E),this._gl.vertexAttribDivisor=E.vertexAttribDivisorANGLE.bind(E)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const E=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),b=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);E&&b&&(this._caps.highPrecisionShaderSupported=0!==E.precision&&0!==b.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const E=this._gl.getExtension("EXT_blend_minmax");null!=E&&(this._caps.blendMinMax=!0,this._gl.MAX=E.MAX_EXT,this._gl.MIN=E.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const E=this._gl.getExtension("EXT_sRGB");null!=E&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:E.SRGB_EXT,SRGB8:E.SRGB_ALPHA_EXT,SRGB8_ALPHA8:E.SRGB_ALPHA_EXT})}if(this._creationOptions){const E=this._creationOptions.forceSRGBBufferSupportState;void 0!==E&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&E)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let b=0;b<this._maxSimultaneousTextures;b++)this._nextFreeTextureSlots.push(b);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"===typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const E=this._workingCanvas.getContext("2d");E&&(this._workingContext=E)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const E=this.getGlInfo();return E&&E.renderer?E.renderer:""}getRenderWidth(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const k=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=k;let G=0;if(b&&E){let b=!0;if(this._currentRenderTarget){var V;const h=null===(V=this._currentRenderTarget.texture)||void 0===V?void 0:V.format;if(8===h||9===h||10===h||11===h){var l;const h=null===(l=this._currentRenderTarget.texture)||void 0===l?void 0:l.type;7===h||5===h?(I._TempClearColorUint32[0]=255*E.r,I._TempClearColorUint32[1]=255*E.g,I._TempClearColorUint32[2]=255*E.b,I._TempClearColorUint32[3]=255*E.a,this._gl.clearBufferuiv(this._gl.COLOR,0,I._TempClearColorUint32),b=!1):(I._TempClearColorInt32[0]=255*E.r,I._TempClearColorInt32[1]=255*E.g,I._TempClearColorInt32[2]=255*E.b,I._TempClearColorInt32[3]=255*E.a,this._gl.clearBufferiv(this._gl.COLOR,0,I._TempClearColorInt32),b=!1)}}b&&(this._gl.clearColor(E.r,E.g,E.b,void 0!==E.a?E.a:1),G|=this._gl.COLOR_BUFFER_BIT)}h&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),G|=this._gl.DEPTH_BUFFER_BIT),a&&(this._gl.clearStencil(0),G|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(G)}_viewport(E,b,h,a){E===this._viewportCached.x&&b===this._viewportCached.y&&h===this._viewportCached.z&&a===this._viewportCached.w||(this._viewportCached.x=E,this._viewportCached.y=b,this._viewportCached.z=h,this._viewportCached.w=a,this._gl.viewport(E,b,h,a))}nj(){super.nj(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,k=arguments.length>4?arguments[4]:void 0,V=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const O=E;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=E,this._bindUnboundFramebuffer(O._framebuffer);const v=this._gl;var s;if(!E.isMulti)if(E.is2DArray||E.is3D)v.framebufferTextureLayer(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,null===(s=E.texture._hardwareTexture)||void 0===s?void 0:s.underlyingResource,V,l),O._currentLOD=V;else if(E.isCube){var U;v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_CUBE_MAP_POSITIVE_X+b,null===(U=E.texture._hardwareTexture)||void 0===U?void 0:U.underlyingResource,V)}else if(O._currentLOD!==V){var B;v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_2D,null===(B=E.texture._hardwareTexture)||void 0===B?void 0:B.underlyingResource,V),O._currentLOD=V}const o=E._depthStencilTexture;if(o){E.is3D&&(E.texture.width===o.width&&E.texture.height===o.height&&E.texture.depth===o.depth||G.c.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const h=E._depthStencilTextureWithStencil?v.DEPTH_STENCIL_ATTACHMENT:v.DEPTH_ATTACHMENT;var u;if(E.is2DArray||E.is3D)v.framebufferTextureLayer(v.FRAMEBUFFER,h,null===(u=o._hardwareTexture)||void 0===u?void 0:u.underlyingResource,V,l);else if(E.isCube){var D;v.framebufferTexture2D(v.FRAMEBUFFER,h,v.TEXTURE_CUBE_MAP_POSITIVE_X+b,null===(D=o._hardwareTexture)||void 0===D?void 0:D.underlyingResource,V)}else{var g;v.framebufferTexture2D(v.FRAMEBUFFER,h,v.TEXTURE_2D,null===(g=o._hardwareTexture)||void 0===g?void 0:g.underlyingResource,V)}}O._MSAAFramebuffer&&this._bindUnboundFramebuffer(O._MSAAFramebuffer),this._cachedViewport&&!k?this.setViewport(this._cachedViewport,h,a):(h||(h=E.width,V&&(h/=Math.pow(2,V))),a||(a=E.height,V&&(a/=Math.pow(2,V))),this._viewport(0,0,h,a)),this.wipeCaches()}setState(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4?arguments[4]:void 0,G=arguments.length>5?arguments[5]:void 0,V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(this._depthCullingState.cull!==E||h)&&(this._depthCullingState.cull=E);const l=this.cullBackFaces??k??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==l||h)&&(this._depthCullingState.cullFace=l),this.setZOffset(b),this.setZOffsetUnits(V);const O=a?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==O||h)&&(this._depthCullingState.frontFace=O),this._stencilStateComposer.stencilMaterial=G}_bindUnboundFramebuffer(E){this._currentFramebuffer!==E&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,E),this._currentFramebuffer=E)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(E){const b=this._getTextureTarget(E);this._bindTextureDirectly(b,E,!0),this._gl.generateMipmap(b),this._bindTextureDirectly(b,null)}unBindFramebuffer(E){var b;let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2?arguments[2]:void 0;const k=E;this._currentRenderTarget=null;const G=this._gl;if(k._MSAAFramebuffer){if(E.isMulti)return void this.unBindMultiColorAttachmentFramebuffer(E,h,a);G.bindFramebuffer(G.READ_FRAMEBUFFER,k._MSAAFramebuffer),G.bindFramebuffer(G.DRAW_FRAMEBUFFER,k._framebuffer),G.blitFramebuffer(0,0,E.width,E.height,0,0,E.width,E.height,G.COLOR_BUFFER_BIT,G.NEAREST)}null===(b=E.texture)||void 0===b||!b.generateMipMaps||h||E.isCube||this.generateMipmaps(E.texture),a&&(k._MSAAFramebuffer&&this._bindUnboundFramebuffer(k._framebuffer),a()),this._bindUnboundFramebuffer(null)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(E,b,h){return this._createVertexBuffer(E,this._gl.STATIC_DRAW)}_createVertexBuffer(E,b){const h=this._gl.createBuffer();if(!h)throw new Error("Unable to create vertex buffer");const a=new s.c(h);return this.bindArrayBuffer(a),"number"!==typeof E?E instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(E),b),a.mb=4*E.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,E,b),a.mb=E.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(E),b),a.mb=E),this._resetVertexBufferBinding(),a.references=1,a}createDynamicVertexBuffer(E,b){return this._createVertexBuffer(E,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(E,b,h){const a=this._gl.createBuffer(),k=new s.c(a);if(!a)throw new Error("Unable to create index buffer");this.bindIndexBuffer(k);const G=this._normalizeIndexData(E);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,G,b?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),k.references=1,k.is32Bits=4===G.BYTES_PER_ELEMENT,k}_normalizeIndexData(E){if(2===E.BYTES_PER_ELEMENT)return E;if(this._caps.uintIndices){if(E instanceof Uint32Array)return E;for(let b=0;b<E.length;b++)if(E[b]>=65535)return new Uint32Array(E);return new Uint16Array(E)}return new Uint16Array(E)}bindArrayBuffer(E){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(E,this._gl.ARRAY_BUFFER)}bindUniformBlock(E,b,h){const a=E.program,k=this._gl.getUniformBlockIndex(a,b);this._gl.uniformBlockBinding(a,k,h)}bindIndexBuffer(E){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(E,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(E,b){(this._vaoRecordInProgress||this._currentBoundBuffer[b]!==E)&&(this._gl.bindBuffer(b,E?E.underlyingResource:null),this._currentBoundBuffer[b]=E)}updateArrayBuffer(E){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,E)}_vertexAttribPointer(E,b,h,a,k,G,V){const l=this._currentBufferPointers[b];if(!l)return;let O=!1;l.active?(l.buffer!==E&&(l.buffer=E,O=!0),l.size!==h&&(l.size=h,O=!0),l.type!==a&&(l.type=a,O=!0),l.normalized!==k&&(l.normalized=k,O=!0),l.stride!==G&&(l.stride=G,O=!0),l.offset!==V&&(l.offset=V,O=!0)):(O=!0,l.active=!0,l.index=b,l.size=h,l.type=a,l.normalized=k,l.stride=G,l.offset=V,l.buffer=E),(O||this._vaoRecordInProgress)&&(this.bindArrayBuffer(E),a===this._gl.UNSIGNED_INT||a===this._gl.INT?this._gl.vertexAttribIPointer(b,h,a,G,V):this._gl.vertexAttribPointer(b,h,a,k,G,V))}_bindIndexBufferWithCache(E){null!=E&&this._cachedIndexBuffer!==E&&(this._cachedIndexBuffer=E,this.bindIndexBuffer(E),this._uintIndicesCurrentlySet=E.is32Bits)}_bindVertexBuffersAttributes(E,b,h){const a=b.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let k=0;k<a.length;k++){const G=b.getAttributeLocation(k);if(G>=0){const b=a[k];let V=null;if(h&&(V=h[b]),V||(V=E[b]),!V)continue;this._gl.enableVertexAttribArray(G),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[G]=!0);const l=V.getBuffer();l&&(this._vertexAttribPointer(l,G,V.getSize(),V.type,V.normalized,V.byteStride,V.byteOffset),V.getIsInstanced()&&(this._gl.vertexAttribDivisor(G,V.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(G),this._currentInstanceBuffers.push(l))))}}}recordVertexArrayObject(E,b,h,a){const k=this._gl.createVertexArray();if(!k)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(k),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(E,h,a),this.bindIndexBuffer(b),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),k}bindVertexArrayObject(E,b){this._cachedVertexArrayObject!==E&&(this._cachedVertexArrayObject=E,this._gl.bindVertexArray(E),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=b&&b.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(E,b,h,a,k){if(this._cachedVertexBuffers!==E||this._cachedEffectForVertexBuffers!==k){this._cachedVertexBuffers=E,this._cachedEffectForVertexBuffers=k;const b=k.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let G=0;for(let V=0;V<b;V++)if(V<h.length){const b=k.getAttributeLocation(V);b>=0&&(this._gl.enableVertexAttribArray(b),this._vertexAttribArraysEnabled[b]=!0,this._vertexAttribPointer(E,b,h[V],this._gl.FLOAT,!1,a,G)),G+=4*h[V]}}this._bindIndexBufferWithCache(b)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(E,b,h,a){this._cachedVertexBuffers===E&&this._cachedEffectForVertexBuffers===h||(this._cachedVertexBuffers=E,this._cachedEffectForVertexBuffers=h,this._bindVertexBuffersAttributes(E,h,a)),this._bindIndexBufferWithCache(b)}unbindInstanceAttributes(){let E;for(let b=0,h=this._currentInstanceLocations.length;b<h;b++){const h=this._currentInstanceBuffers[b];E!=h&&h.references&&(E=h,this.bindArrayBuffer(h));const a=this._currentInstanceLocations[b];this._gl.vertexAttribDivisor(a,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(E){this._gl.deleteVertexArray(E)}_releaseBuffer(E){return E.references--,0===E.references&&(this._deleteBuffer(E),!0)}_deleteBuffer(E){this._gl.deleteBuffer(E.underlyingResource)}updateAndBindInstancesBuffer(E,b,h){if(this.bindArrayBuffer(E),b&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,b),void 0!==h[0].index)this.bindInstancesBuffer(E,h,!0);else for(let a=0;a<4;a++){const b=h[a];this._vertexAttribArraysEnabled[b]||(this._gl.enableVertexAttribArray(b),this._vertexAttribArraysEnabled[b]=!0),this._vertexAttribPointer(E,b,4,this._gl.FLOAT,!1,64,16*a),this._gl.vertexAttribDivisor(b,1),this._currentInstanceLocations.push(b),this._currentInstanceBuffers.push(E)}}bindInstancesBuffer(E,b){let h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.bindArrayBuffer(E);let a=0;if(h)for(let k=0;k<b.length;k++){a+=4*b[k].attributeSize}for(let k=0;k<b.length;k++){const h=b[k];void 0===h.index&&(h.index=this._currentEffect.getAttributeLocationByName(h.attributeName)),h.index<0||(this._vertexAttribArraysEnabled[h.index]||(this._gl.enableVertexAttribArray(h.index),this._vertexAttribArraysEnabled[h.index]=!0),this._vertexAttribPointer(E,h.index,h.attributeSize,h.attributeType||this._gl.FLOAT,h.normalized||!1,a,h.offset),this._gl.vertexAttribDivisor(h.index,void 0===h.divisor?1:h.divisor),this._currentInstanceLocations.push(h.index),this._currentInstanceBuffers.push(E))}}disableInstanceAttributeByName(E){if(!this._currentEffect)return;const b=this._currentEffect.getAttributeLocationByName(E);this.disableInstanceAttribute(b)}disableInstanceAttribute(E){let b,h=!1;for(;-1!==(b=this._currentInstanceLocations.indexOf(E));)this._currentInstanceLocations.splice(b,1),this._currentInstanceBuffers.splice(b,1),h=!0,b=this._currentInstanceLocations.indexOf(E);h&&(this._gl.vertexAttribDivisor(E,0),this.disableAttributeByIndex(E))}disableAttributeByIndex(E){this._gl.disableVertexAttribArray(E),this._vertexAttribArraysEnabled[E]=!1,this._currentBufferPointers[E].active=!1}draw(E,b,h,a){this.drawElementsType(E?0:1,b,h,a)}drawPointClouds(E,b,h){this.drawArraysType(2,E,b,h)}drawUnIndexed(E,b,h,a){this.drawArraysType(E?0:1,b,h,a)}drawElementsType(E,b,h,a){this.applyStates(),this._reportDrawCall();const k=this._drawMode(E),G=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,V=this._uintIndicesCurrentlySet?4:2;a?this._gl.drawElementsInstanced(k,h,G,b*V,a):this._gl.drawElements(k,h,G,b*V)}drawArraysType(E,b,h,a){this.applyStates(),this._reportDrawCall();const k=this._drawMode(E);a?this._gl.drawArraysInstanced(k,b,h,a):this._gl.drawArrays(k,b,h)}_drawMode(E){switch(E){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(E){this._compiledEffects[E._key]&&delete this._compiledEffects[E._key];const b=E.getPipelineContext();b&&this._deletePipelineContext(b)}_deletePipelineContext(E){const b=E;b&&b.program&&(b.program.__SPECTOR_rebuildProgram=null,(0,S.h)(b),this._gl.deleteProgram(b.program))}_getGlobalDefines(E){return(0,g.e)(E,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(E,b,h,k,G,V,l,O,v){let s=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,U=arguments.length>10?arguments[10]:void 0;const B="string"===typeof E?E:E.vertexToken||E.vertexSource||E.vertexElement||E.vertex,o="string"===typeof E?E:E.fragmentToken||E.fragmentSource||E.fragmentElement||E.fragment,u=this._getGlobalDefines();let g=G??b.defines??"";u&&(g+=u);const S=B+"+"+o+"@"+g;if(this._compiledEffects[S]){const E=this._compiledEffects[S];return l&&E.isReady()&&l(E),E._refCount++,E}this._gl&&(0,a.w)(this._gl);const M=new D.b(E,b,h,k,this,G,V,l,O,v,S,b.shaderLanguage??s,b.extraInitializationsAsync??U);return this._compiledEffects[S]=M,M}_getShaderSource(E){return this._gl.getShaderSource(E)}createRawShaderProgram(E,b,h,k){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const V=(0,a.w)(this._gl);return V._contextWasLost=this._contextWasLost,V.validateShaderPrograms=this.validateShaderPrograms,(0,a.o)(E,b,h,k||this._gl,G)}createShaderProgram(E,b,h,k,G){let V=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const l=(0,a.w)(this._gl);return l._contextWasLost=this._contextWasLost,l.validateShaderPrograms=this.validateShaderPrograms,(0,a.r)(E,b,h,k,G||this._gl,V)}inlineShaderCode(E){return E}createPipelineContext(E){if(this._gl){(0,a.w)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const b=(0,a.n)(this._gl,E);return b.xd=this,b}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(E){return(0,a.h)(E,this._gl,this.validateShaderPrograms)}_preparePipelineContext(E,b,h,k,G,V,l,O,v,s,U){const B=(0,a.w)(this._gl);return B._contextWasLost=this._contextWasLost,B.validateShaderPrograms=this.validateShaderPrograms,B._createShaderProgramInjection=this._createShaderProgram.bind(this),B.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),B.createShaderProgramInjection=this.createShaderProgram.bind(this),B.loadFileInjection=this._loadFile.bind(this),(0,a.i)(E,b,h,k,G,V,l,O,v,s,U)}_createShaderProgram(E,b,h,k){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,a.b)(E,b,h,k,G)}_isRenderingStateCompiled(E){const b=E;return!this._isDisposed&&!b._isDisposed&&(!!this._gl.getProgramParameter(b.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(b),!0))}_executeWhenRenderingStateIsCompiled(E,b){(0,a.d)(E,b)}getUniforms(E,b){const h=new Array,a=E;for(let k=0;k<b.length;k++)h.push(this._gl.getUniformLocation(a.program,b[k]));return h}getAttributes(E,b){const h=[],a=E;for(let G=0;G<b.length;G++)try{h.push(this._gl.getAttribLocation(a.program,b[G]))}catch(k){h.push(-1)}return h}enableEffect(E){(E=null!==E&&(0,k.d)(E)?E.effect:E)&&E!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(E),this._currentEffect=E,E.onBind&&E.onBind(E),E._onBindObservable&&E._onBindObservable.notifyObservers(E))}setInt(E,b){return!!E&&(this._gl.uniform1i(E,b),!0)}setInt2(E,b,h){return!!E&&(this._gl.uniform2i(E,b,h),!0)}setInt3(E,b,h,a){return!!E&&(this._gl.uniform3i(E,b,h,a),!0)}setInt4(E,b,h,a,k){return!!E&&(this._gl.uniform4i(E,b,h,a,k),!0)}setIntArray(E,b){return!!E&&(this._gl.uniform1iv(E,b),!0)}setIntArray2(E,b){return!(!E||b.length%2!==0)&&(this._gl.uniform2iv(E,b),!0)}setIntArray3(E,b){return!(!E||b.length%3!==0)&&(this._gl.uniform3iv(E,b),!0)}setIntArray4(E,b){return!(!E||b.length%4!==0)&&(this._gl.uniform4iv(E,b),!0)}setUInt(E,b){return!!E&&(this._gl.uniform1ui(E,b),!0)}setUInt2(E,b,h){return!!E&&(this._gl.uniform2ui(E,b,h),!0)}setUInt3(E,b,h,a){return!!E&&(this._gl.uniform3ui(E,b,h,a),!0)}setUInt4(E,b,h,a,k){return!!E&&(this._gl.uniform4ui(E,b,h,a,k),!0)}setUIntArray(E,b){return!!E&&(this._gl.uniform1uiv(E,b),!0)}setUIntArray2(E,b){return!(!E||b.length%2!==0)&&(this._gl.uniform2uiv(E,b),!0)}setUIntArray3(E,b){return!(!E||b.length%3!==0)&&(this._gl.uniform3uiv(E,b),!0)}setUIntArray4(E,b){return!(!E||b.length%4!==0)&&(this._gl.uniform4uiv(E,b),!0)}setArray(E,b){return!!E&&(!(b.length<1)&&(this._gl.uniform1fv(E,b),!0))}setArray2(E,b){return!(!E||b.length%2!==0)&&(this._gl.uniform2fv(E,b),!0)}setArray3(E,b){return!(!E||b.length%3!==0)&&(this._gl.uniform3fv(E,b),!0)}setArray4(E,b){return!(!E||b.length%4!==0)&&(this._gl.uniform4fv(E,b),!0)}setMatrices(E,b){return!!E&&(this._gl.uniformMatrix4fv(E,!1,b),!0)}setMatrix3x3(E,b){return!!E&&(this._gl.uniformMatrix3fv(E,!1,b),!0)}setMatrix2x2(E,b){return!!E&&(this._gl.uniformMatrix2fv(E,!1,b),!0)}setFloat(E,b){return!!E&&(this._gl.uniform1f(E,b),!0)}setFloat2(E,b,h){return!!E&&(this._gl.uniform2f(E,b,h),!0)}setFloat3(E,b,h,a){return!!E&&(this._gl.uniform3f(E,b,h,a),!0)}setFloat4(E,b,h,a,k){return!!E&&(this._gl.uniform4f(E,b,h,a,k),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const E=this._colorWrite;this._gl.colorMask(E,E,E,E)}}wipeCaches(E){this.preventCacheWipeBetweenFrames&&!E||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),E&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(E,b){const h=this._gl;let a=h.NEAREST,k=h.NEAREST;switch(E){case 11:a=h.LINEAR,k=b?h.LINEAR_MIPMAP_NEAREST:h.LINEAR;break;case 3:a=h.LINEAR,k=b?h.LINEAR_MIPMAP_LINEAR:h.LINEAR;break;case 8:a=h.NEAREST,k=b?h.NEAREST_MIPMAP_LINEAR:h.NEAREST;break;case 4:a=h.NEAREST,k=b?h.NEAREST_MIPMAP_NEAREST:h.NEAREST;break;case 5:a=h.NEAREST,k=b?h.LINEAR_MIPMAP_NEAREST:h.LINEAR;break;case 6:a=h.NEAREST,k=b?h.LINEAR_MIPMAP_LINEAR:h.LINEAR;break;case 7:a=h.NEAREST,k=h.LINEAR;break;case 1:a=h.NEAREST,k=h.NEAREST;break;case 9:a=h.LINEAR,k=b?h.NEAREST_MIPMAP_NEAREST:h.NEAREST;break;case 10:a=h.LINEAR,k=b?h.NEAREST_MIPMAP_LINEAR:h.NEAREST;break;case 2:a=h.LINEAR,k=h.LINEAR;break;case 12:a=h.LINEAR,k=h.NEAREST}return{min:k,mag:a}}_createTexture(){const E=this._gl.createTexture();if(!E)throw new Error("Unable to create texture");return E}_createHardwareTexture(){return new o.e(this._createTexture(),this._gl)}_createInternalTexture(E,b){let h,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,k=!1,V=0,l=3,O=5,v=!1,s=1;void 0!==b&&"object"===typeof b?(k=!!b.generateMipMaps,V=void 0===b.type?0:b.type,l=void 0===b.samplingMode?3:b.samplingMode,O=void 0===b.format?5:b.format,v=void 0!==b.useSRGBBuffer&&b.useSRGBBuffer,s=b.samples??1,h=b.label):k=!!b,v&&(v=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==V||this._caps.textureFloatLinearFiltering)&&(2!==V||this._caps.textureHalfFloatLinearFiltering)||(l=1),1!==V||this._caps.textureFloat||(V=0,G.c.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const U=this._gl,B=new u.b(this,a),o=E.width||E,D=E.height||E,g=E.depth||0,S=E.layers||0,M=this._getSamplingParameters(l,k),I=0!==S?U.TEXTURE_2D_ARRAY:0!==g?U.TEXTURE_3D:U.TEXTURE_2D,j=this._getRGBABufferInternalSizedFormat(V,O,v),P=this._getInternalFormat(O),A=this._getWebGLTextureType(V);return this._bindTextureDirectly(I,B),0!==S?(B.is2DArray=!0,U.texImage3D(I,0,j,o,D,S,0,P,A,null)):0!==g?(B.is3D=!0,U.texImage3D(I,0,j,o,D,g,0,P,A,null)):U.texImage2D(I,0,j,o,D,0,P,A,null),U.texParameteri(I,U.TEXTURE_MAG_FILTER,M.mag),U.texParameteri(I,U.TEXTURE_MIN_FILTER,M.min),U.texParameteri(I,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(I,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),k&&this._gl.generateMipmap(I),this._bindTextureDirectly(I,null),B._useSRGBBuffer=v,B.baseWidth=o,B.baseHeight=D,B.width=o,B.height=D,B.depth=S,B.isReady=!0,B.samples=s,B.generateMipMaps=k,B.samplingMode=l,B.type=V,B.format=O,B.label=h,this._internalTexturesCache.push(B),B}_getUseSRGBBuffer(E,b){return E&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||b)}createTexture(E,b,h,a){var k=this;let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,V=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,v=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,s=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,U=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,B=arguments.length>11?arguments[11]:void 0,o=arguments.length>12?arguments[12]:void 0,D=arguments.length>13?arguments[13]:void 0,g=arguments.length>14?arguments[14]:void 0;return this._createTextureBase(E,b,h,a,G,V,l,(function(){for(var E=arguments.length,b=new Array(E),h=0;h<E;h++)b[h]=arguments[h];return k._prepareWebGLTexture(...b,s)}),((E,b,h,k,G,V)=>{const l=this._gl,O=h.width===E&&h.height===b;G._creationFlags=D??0;const v=this._getTexImageParametersForCreateTexture(G.format,G._useSRGBBuffer);if(O)return l.texImage2D(l.TEXTURE_2D,0,v.internalFormat,v.format,v.type,h),!1;const s=this._caps.maxTextureSize;if(h.width>s||h.height>s||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=E,this._workingCanvas.height=b,this._workingContext.drawImage(h,0,0,h.width,h.height,0,0,E,b),l.texImage2D(l.TEXTURE_2D,0,v.internalFormat,v.format,v.type,this._workingCanvas),G.width=E,G.height=b,!1);{const E=new u.b(this,2);this._bindTextureDirectly(l.TEXTURE_2D,E,!0),l.texImage2D(l.TEXTURE_2D,0,v.internalFormat,v.format,v.type,h),this._rescaleTexture(E,G,a,v.format,(()=>{this._releaseTexture(E),this._bindTextureDirectly(l.TEXTURE_2D,G,!0),V()}))}return!0}),O,v,s,U,B,o,g)}_getTexImageParametersForCreateTexture(E,b){let h,a;return 1===this.webGLVersion?(h=this._getInternalFormat(E,b),a=h):(h=this._getInternalFormat(E,!1),a=this._getRGBABufferInternalSizedFormat(0,E,b)),{internalFormat:a,format:h,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(E,b,h,a,k){}_unpackFlipY(E){this._unpackFlipYCached!==E&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,E?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=E))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(E){return E.isCube?this._gl.TEXTURE_CUBE_MAP:E.is3D?this._gl.TEXTURE_3D:E.is2DArray||E.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(E,b){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a=this._getTextureTarget(b),k=this._getSamplingParameters(E,b.useMipMaps||h);this._setTextureParameterInteger(a,this._gl.TEXTURE_MAG_FILTER,k.mag,b),this._setTextureParameterInteger(a,this._gl.TEXTURE_MIN_FILTER,k.min),h&&(b.generateMipMaps=!0,this._gl.generateMipmap(a)),this._bindTextureDirectly(a,null),b.samplingMode=E}updateTextureDimensions(E,b,h){}updateTextureWrappingMode(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const k=this._getTextureTarget(E);null!==b&&(this._setTextureParameterInteger(k,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(b),E),E._cachedWrapU=b),null!==h&&(this._setTextureParameterInteger(k,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(h),E),E._cachedWrapV=h),(E.is2DArray||E.is3D)&&null!==a&&(this._setTextureParameterInteger(k,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(a),E),E._cachedWrapR=a),this._bindTextureDirectly(k,null)}_uploadCompressedDataToTextureDirectly(E,b,h,a,k){let G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const l=this._gl;let O=l.TEXTURE_2D;if(E.isCube&&(O=l.TEXTURE_CUBE_MAP_POSITIVE_X+G),E._useSRGBBuffer)switch(b){case 37492:case 36196:this._caps.etc2?b=l.COMPRESSED_SRGB8_ETC2:E._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?b=l.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:E._useSRGBBuffer=!1;break;case 36492:b=l.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:b=l.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?b=l.COMPRESSED_SRGB_S3TC_DXT1_EXT:E._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?b=l.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:E._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?b=l.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:E._useSRGBBuffer=!1;break;default:E._useSRGBBuffer=!1}this._gl.compressedTexImage2D(O,V,b,h,a,0,k)}_uploadDataToTextureDirectly(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,k=arguments.length>4?arguments[4]:void 0,G=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const V=this._gl,l=this._getWebGLTextureType(E.type),O=this._getInternalFormat(E.format),v=void 0===k?this._getRGBABufferInternalSizedFormat(E.type,E.format,E._useSRGBBuffer):this._getInternalFormat(k,E._useSRGBBuffer);this._unpackFlipY(E.invertY);let s=V.TEXTURE_2D;E.isCube&&(s=V.TEXTURE_CUBE_MAP_POSITIVE_X+h);const U=Math.round(Math.log(E.width)*Math.LOG2E),B=Math.round(Math.log(E.height)*Math.LOG2E),o=G?E.width:Math.pow(2,Math.max(U-a,0)),u=G?E.height:Math.pow(2,Math.max(B-a,0));V.texImage2D(s,a,v,o,u,0,O,l,b)}updateTextureData(E,b,h,a,k,G){let V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,O=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const v=this._gl,s=this._getWebGLTextureType(E.type),U=this._getInternalFormat(E.format);this._unpackFlipY(E.invertY);let B=v.TEXTURE_2D,o=v.TEXTURE_2D;E.isCube&&(o=v.TEXTURE_CUBE_MAP_POSITIVE_X+V,B=v.TEXTURE_CUBE_MAP),this._bindTextureDirectly(B,E,!0),v.texSubImage2D(o,l,h,a,k,G,U,s,b),O&&this._gl.generateMipmap(o),this._bindTextureDirectly(B,null)}_uploadArrayBufferViewToTexture(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const k=this._gl,G=E.isCube?k.TEXTURE_CUBE_MAP:k.TEXTURE_2D;this._bindTextureDirectly(G,E,!0),this._uploadDataToTextureDirectly(E,b,h,a),this._bindTextureDirectly(G,null,!0)}_prepareWebGLTextureContinuation(E,b,h,a,k){const G=this._gl;if(!G)return;const V=this._getSamplingParameters(k,!h);G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MAG_FILTER,V.mag),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MIN_FILTER,V.min),h||a||G.generateMipmap(G.TEXTURE_2D),this._bindTextureDirectly(G.TEXTURE_2D,null),b&&b.removePendingData(E),E.onLoadedObservable.notifyObservers(E),E.onLoadedObservable.clear()}_prepareWebGLTexture(E,b,h,a,k,G,V,l,O,v){const s=this.getCaps().maxTextureSize,B=Math.min(s,this.needPOTTextures?(0,U.f)(a.width,s):a.width),o=Math.min(s,this.needPOTTextures?(0,U.f)(a.height,s):a.height),u=this._gl;u&&(E._hardwareTexture?(this._bindTextureDirectly(u.TEXTURE_2D,E,!0),this._unpackFlipY(void 0===k||!!k),E.baseWidth=a.width,E.baseHeight=a.height,E.width=B,E.height=o,E.isReady=!0,E.type=-1!==E.type?E.type:0,E.format=-1!==E.format?E.format:v??(".jpg"!==b||E._useSRGBBuffer?5:4),l(B,o,a,b,E,(()=>{this._prepareWebGLTextureContinuation(E,h,G,V,O)}))||this._prepareWebGLTextureContinuation(E,h,G,V,O)):h&&h.removePendingData(E))}_getInternalFormatFromDepthTextureFormat(E,b,h){const a=this._gl;if(!b)return a.STENCIL_INDEX8;let k=h?a.DEPTH_STENCIL:a.DEPTH_COMPONENT;return this.webGLVersion>1?15===E?k=a.DEPTH_COMPONENT16:16===E?k=a.DEPTH_COMPONENT24:17===E||13===E?k=h?a.DEPTH24_STENCIL8:a.DEPTH_COMPONENT24:14===E?k=a.DEPTH_COMPONENT32F:18===E&&(k=h?a.DEPTH32F_STENCIL8:a.DEPTH_COMPONENT32F):k=a.DEPTH_COMPONENT16,k}_setupFramebufferDepthAttachments(E,b,h,a){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,G=arguments.length>5?arguments[5]:void 0;const V=this._gl;G=G??(E?13:14);const l=this._getInternalFormatFromDepthTextureFormat(G,b,E);return E&&b?this._createRenderBuffer(h,a,k,V.DEPTH_STENCIL,l,V.DEPTH_STENCIL_ATTACHMENT):b?this._createRenderBuffer(h,a,k,l,l,V.DEPTH_ATTACHMENT):E?this._createRenderBuffer(h,a,k,l,l,V.STENCIL_ATTACHMENT):null}_createRenderBuffer(E,b,h,a,k,G){let V=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const l=this._gl.createRenderbuffer();return this._updateRenderBuffer(l,E,b,h,a,k,G,V)}_updateRenderBuffer(E,b,h,a,k,G,V){let l=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const O=this._gl;return O.bindRenderbuffer(O.RENDERBUFFER,E),a>1&&O.renderbufferStorageMultisample?O.renderbufferStorageMultisample(O.RENDERBUFFER,a,G,b,h):O.renderbufferStorage(O.RENDERBUFFER,k,b,h),O.framebufferRenderbuffer(O.FRAMEBUFFER,V,O.RENDERBUFFER,E),l&&O.bindRenderbuffer(O.RENDERBUFFER,null),E}_releaseTexture(E){this._deleteTexture(E._hardwareTexture),this.unbindAllTextures();const b=this._internalTexturesCache.indexOf(E);-1!==b&&this._internalTexturesCache.splice(b,1),E._lodTextureHigh&&E._lodTextureHigh.dispose(),E._lodTextureMid&&E._lodTextureMid.dispose(),E._lodTextureLow&&E._lodTextureLow.dispose(),E._irradianceTexture&&E._irradianceTexture.dispose()}_deleteTexture(E){null===E||void 0===E||E.release()}_setProgram(E){this._currentProgram!==E&&((0,a.j)(E,this._gl),this._currentProgram=E)}bindSamplers(E){const b=E.getPipelineContext();this._setProgram(b.program);const h=E.getSamplers();for(let a=0;a<h.length;a++){const b=E.getUniform(h[a]);b&&(this._boundUniforms[a]=b)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(E,b){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=!1;const V=b&&b._associatedChannel>-1;h&&V&&(this._activeChannel=b._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==b||a){if(this._activateCurrentTexture(),b&&b.isMultiview)throw G.c.Error(["_bindTextureDirectly called with a multiview texture!",E,b]),"_bindTextureDirectly called with a multiview texture!";var l;this._gl.bindTexture(E,(null===b||void 0===b||null===(l=b._hardwareTexture)||void 0===l?void 0:l.underlyingResource)??null),this._boundTexturesCache[this._activeChannel]=b,b&&(b._associatedChannel=this._activeChannel)}else h&&(k=!0,this._activateCurrentTexture());return V&&!h&&this._bindSamplerUniformToChannel(b._associatedChannel,this._activeChannel),k}_bindTexture(E,b,h){if(void 0===E)return;b&&(b._associatedChannel=E),this._activeChannel=E;const a=b?this._getTextureTarget(b):this._gl.TEXTURE_2D;this._bindTextureDirectly(a,b)}unbindAllTextures(){for(let E=0;E<this._maxSimultaneousTextures;E++)this._activeChannel=E,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(E,b,h,a){void 0!==E&&(b&&(this._boundUniforms[E]=b),this._setTexture(E,h))}_bindSamplerUniformToChannel(E,b){const h=this._boundUniforms[E];h&&h._currentState!==b&&(this._gl.uniform1i(h,b),h._currentState=b)}_getTextureWrapMode(E){switch(E){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(E,b){let h,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!b)return null!=this._boundTexturesCache[E]&&(this._activeChannel=E,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(b.video){this._activeChannel=E;const h=b.getInternalTexture();h&&(h._associatedChannel=E),b.update()}else if(4===b.delayLoadState)return b.delayLoad(),!1;h=k?b.depthStencilTexture:b.isReady()?b.getInternalTexture():b.isCube?this.emptyCubeTexture:b.is3D?this.emptyTexture3D:b.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!a&&h&&(h._associatedChannel=E);let G=!0;this._boundTexturesCache[E]===h&&(a||this._bindSamplerUniformToChannel(h._associatedChannel,E),G=!1),this._activeChannel=E;const V=this._getTextureTarget(h);if(G&&this._bindTextureDirectly(V,h,a),h&&!h.isMultiview){if(h.isCube&&h._cachedCoordinatesMode!==b.coordinatesMode){h._cachedCoordinatesMode=b.coordinatesMode;const E=3!==b.coordinatesMode&&5!==b.coordinatesMode?1:0;b.wrapU=E,b.wrapV=E}h._cachedWrapU!==b.wrapU&&(h._cachedWrapU=b.wrapU,this._setTextureParameterInteger(V,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(b.wrapU),h)),h._cachedWrapV!==b.wrapV&&(h._cachedWrapV=b.wrapV,this._setTextureParameterInteger(V,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(b.wrapV),h)),h.is3D&&h._cachedWrapR!==b.wrapR&&(h._cachedWrapR=b.wrapR,this._setTextureParameterInteger(V,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(b.wrapR),h)),this._setAnisotropicLevel(V,h,b.anisotropicFilteringLevel)}return!0}setTextureArray(E,b,h,a){if(void 0!==E&&b){this._textureUnits&&this._textureUnits.length===h.length||(this._textureUnits=new Int32Array(h.length));for(let b=0;b<h.length;b++){const a=h[b].getInternalTexture();a?(this._textureUnits[b]=E+b,a._associatedChannel=E+b):this._textureUnits[b]=-1}this._gl.uniform1iv(b,this._textureUnits);for(let E=0;E<h.length;E++)this._setTexture(this._textureUnits[E],h[E],!0)}}_setAnisotropicLevel(E,b,h){const a=this._caps.textureAnisotropicFilterExtension;11!==b.samplingMode&&3!==b.samplingMode&&2!==b.samplingMode&&(h=1),a&&b._cachedAnisotropicFilteringLevel!==h&&(this._setTextureParameterFloat(E,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(h,this._caps.maxAnisotropy),b),b._cachedAnisotropicFilteringLevel=h)}_setTextureParameterFloat(E,b,h,a){this._bindTextureDirectly(E,a,!0,!0),this._gl.texParameterf(E,b,h)}_setTextureParameterInteger(E,b,h,a){a&&this._bindTextureDirectly(E,a,!0,!0),this._gl.texParameteri(E,b,h)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let E=0;E<this._caps.maxVertexAttribs;E++)this.disableAttributeByIndex(E)}else for(let E=0,b=this._vertexAttribArraysEnabled.length;E<b;E++)E>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[E]||this.disableAttributeByIndex(E)}releaseEffects(){const E=Object.keys(this._compiledEffects);for(const b of E){this._compiledEffects[b].dispose()}this._compiledEffects={}}dispose(){var E;((0,V.i)()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose)&&(null===(E=this._gl.getExtension("WEBGL_lose_context"))||void 0===E||E.loseContext());(0,a.t)(this._gl)}attachContextLostEvent(E){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",E,!1)}attachContextRestoredEvent(E){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",E,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(E){const b=this._gl;for(;b.getError()!==b.NO_ERROR;);let h=!0;const a=b.createTexture();b.bindTexture(b.TEXTURE_2D,a),b.texImage2D(b.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(E),1,1,0,b.RGBA,this._getWebGLTextureType(E),null),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST);const k=b.createFramebuffer();b.bindFramebuffer(b.FRAMEBUFFER,k),b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,a,0);const G=b.checkFramebufferStatus(b.FRAMEBUFFER);if(h=h&&G===b.FRAMEBUFFER_COMPLETE,h=h&&b.getError()===b.NO_ERROR,h&&(b.clear(b.COLOR_BUFFER_BIT),h=h&&b.getError()===b.NO_ERROR),h){b.bindFramebuffer(b.FRAMEBUFFER,null);const E=b.RGBA,a=b.UNSIGNED_BYTE,k=new Uint8Array(4);b.readPixels(0,0,1,1,E,a,k),h=h&&b.getError()===b.NO_ERROR}for(b.deleteTexture(a),b.deleteFramebuffer(k),b.bindFramebuffer(b.FRAMEBUFFER,null);!h&&b.getError()!==b.NO_ERROR;);return h}_getWebGLTextureType(E){if(1===this._webGLVersion){switch(E){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(E){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=b?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(E){case 0:h=this._gl.ALPHA;break;case 1:h=this._gl.LUMINANCE;break;case 2:h=this._gl.LUMINANCE_ALPHA;break;case 6:h=this._gl.RED;break;case 7:h=this._gl.RG;break;case 4:h=b?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:h=b?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(E){case 8:h=this._gl.RED_INTEGER;break;case 9:h=this._gl.RG_INTEGER;break;case 10:h=this._gl.RGB_INTEGER;break;case 11:h=this._gl.RGBA_INTEGER}return h}_getRGBABufferInternalSizedFormat(E,b){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(1===this._webGLVersion){if(void 0!==b)switch(b){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return h?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(E){case 3:switch(b){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(b){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return h?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return h?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(b){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(b){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(b){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(b){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(b){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(b){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(b){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return h?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(E,b,h,a){let k=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],G=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const V=k?4:3,l=k?this._gl.RGBA:this._gl.RGB,O=new Uint8Array(a*h*V);return G&&this.flushFramebuffer(),this._gl.readPixels(E,b,h,a,l,this._gl.UNSIGNED_BYTE,O),Promise.resolve(O)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const E=B.d._CreateCanvas(1,1),b=E.getContext("webgl")||E.getContext("experimental-webgl");this._IsSupported=null!=b&&!!window.WebGLRenderingContext}catch(E){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const E=B.d._CreateCanvas(1,1),b=E.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||E.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!b}catch(E){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}I._TempClearColorUint32=new Uint32Array(4),I._TempClearColorInt32=new Int32Array(4),I.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],I._ConcatenateShader=g.d,I._IsSupported=null,I._HasMajorPerformanceCaveat=null},11270:(E,b,h)=>{"use strict";var a;h.d(b,{e:()=>k}),function(E){E[E.PointerMove=0]="PointerMove",E[E.PointerDown=1]="PointerDown",E[E.PointerUp=2]="PointerUp"}(a||(a={}));class k{}k.DOM_DELTA_PIXEL=0,k.DOM_DELTA_LINE=1,k.DOM_DELTA_PAGE=2},11268:(E,b,h)=>{"use strict";h.d(b,{d:()=>a,e:()=>G,f:()=>k});class a{}a.KEYDOWN=1,a.KEYUP=2;class k{constructor(E,b){this.type=E,this.event=b}}class G extends k{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(E){this.skipOnKeyboardObservable=E}constructor(E,b){super(E,b),this.type=E,this.event=b,this.skipOnKeyboardObservable=!1}}},11261:(E,b,h)=>{"use strict";h.d(b,{d:()=>k,f:()=>V,i:()=>l});var a=h(11175);class k{}k.POINTERDOWN=1,k.POINTERUP=2,k.POINTERMOVE=4,k.POINTERWHEEL=8,k.POINTERPICK=16,k.POINTERTAP=32,k.POINTERDOUBLETAP=64;class G{constructor(E,b){this.type=E,this.event=b}}class V extends G{constructor(E,b,h,k){super(E,b),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new a.j(h,k)}}class l extends G{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}constructor(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(E,b),this._pickInfo=h,this._inputManager=a}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}},10819:(E,b,h)=>{"use strict";h.r(b),h.d(b,{SceneInstrumentation:()=>G});var a=h(10821),k=h(10972);class G{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(E){E!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=E,E?(this._onBeforeActiveMeshesEvaluationObserver=this.Xd.onBeforeActiveMeshesEvaluationObservable.add((()=>{a.g.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Xd.onAfterActiveMeshesEvaluationObservable.add((()=>{a.g.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Xd.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Xd.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(E){E!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=E,E?(this._onBeforeRenderTargetsRenderObserver=this.Xd.onBeforeRenderTargetsRenderObservable.add((()=>{a.g.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Xd.onAfterRenderTargetsRenderObservable.add((()=>{a.g.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Xd.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Xd.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(E){E!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=E,E?(this._onBeforeParticlesRenderingObserver=this.Xd.onBeforeParticlesRenderingObservable.add((()=>{a.g.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Xd.onAfterParticlesRenderingObservable.add((()=>{a.g.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Xd.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Xd.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(E){E!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=E,this.Xd.spriteManagers&&(E?(this._onBeforeSpritesRenderingObserver=this.Xd.onBeforeSpritesRenderingObservable.add((()=>{a.g.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Xd.onAfterSpritesRenderingObservable.add((()=>{a.g.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Xd.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Xd.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(E){E!==this._capturePhysicsTime&&this.Xd.onBeforePhysicsObservable&&(this._capturePhysicsTime=E,E?(this._onBeforePhysicsObserver=this.Xd.onBeforePhysicsObservable.add((()=>{a.g.StartPerformanceCounter("jb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Xd.onAfterPhysicsObservable.add((()=>{a.g.EndPerformanceCounter("jb"),this._physicsTime.endMonitoring()}))):(this.Xd.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Xd.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(E){E!==this._captureAnimationsTime&&(this._captureAnimationsTime=E,E?this._onAfterAnimationsObserver=this.Xd.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Xd.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(E){this._captureFrameTime=E}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(E){this._captureInterFrameTime=E}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(E){E!==this._captureRenderTime&&(this._captureRenderTime=E,E?(this._onBeforeDrawPhaseObserver=this.Xd.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),a.g.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Xd.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),a.g.EndPerformanceCounter("Main render")}))):(this.Xd.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Xd.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(E){E!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=E,E?(this._onBeforeCameraRenderObserver=this.Xd.onBeforeCameraRenderObservable.add((E=>{this._cameraRenderTime.beginMonitoring(),a.g.StartPerformanceCounter(`Rendering camera ${E.name}`)})),this._onAfterCameraRenderObserver=this.Xd.onAfterCameraRenderObservable.add((E=>{this._cameraRenderTime.endMonitoring(!1),a.g.EndPerformanceCounter(`Rendering camera ${E.name}`)}))):(this.Xd.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Xd.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Xd.getEngine()._drawCalls}constructor(E){this.Xd=E,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new k.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new k.d,this._captureFrameTime=!1,this._frameTime=new k.d,this._captureRenderTime=!1,this._renderTime=new k.d,this._captureInterFrameTime=!1,this._interFrameTime=new k.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new k.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new k.d,this._capturePhysicsTime=!1,this._physicsTime=new k.d,this._captureAnimationsTime=!1,this._animationsTime=new k.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new k.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=E.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(a.g.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Xd.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=E.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(a.g.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.nj(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.nj(),this._captureParticlesRenderTime&&this._particlesRenderTime.nj(),this._captureSpritesRenderTime&&this._spritesRenderTime.nj(),this._captureRenderTime&&this._renderTime.nj(),this._captureCameraRenderTime&&this._cameraRenderTime.nj()}))}dispose(){this.Xd.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Xd.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Xd.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Xd.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Xd.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Xd.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Xd.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Xd.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Xd.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Xd.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Xd.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Xd.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Xd.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Xd.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Xd.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Xd.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Xd.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Xd=null}}},12229:(E,b,h)=>{"use strict";h.d(b,{d:()=>s});var a=h(11130),k=h(11139),G=h(11175),V=h(11429),l=h(12185),O=h(12234),v=h(10958);V.d.AddNodeConstructor("Light_Type_1",((E,b)=>()=>new s(E,G.k.Zero(),b)));class s extends O.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(E){this._shadowFrustumSize=E,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(E){this._shadowOrthoScale=E,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(E){this._orthoLeft=E}get orthoRight(){return this._orthoRight}set orthoRight(E){this._orthoRight=E}get orthoTop(){return this._orthoTop}set orthoTop(E){this._orthoTop=E}get orthoBottom(){return this._orthoBottom}set orthoBottom(E){this._orthoBottom=E}constructor(E,b,h){super(E,h),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=b.scale(-1),this.direction=b}getClassName(){return"kb"}getTypeID(){return l.d.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(E,b,h){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(E):this._setDefaultAutoExtendShadowProjectionMatrix(E,b,h)}_setDefaultFixedFrustumShadowProjectionMatrix(E){const b=this.va().activeCamera;b&&G.d.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:b.cj,void 0!==this.shadowMaxZ?this.shadowMaxZ:b.maxZ,E,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(E,b,h){const a=this.va().activeCamera;if(!a)return;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const E=G.k.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let a=Number.MAX_VALUE,k=-Number.MAX_VALUE;for(let V=0;V<h.length;V++){const l=h[V];if(!l)continue;const O=l.getBoundingInfo().boundingBox;for(let h=0;h<O.vectorsWorld.length;h++)G.k.TransformCoordinatesToRef(O.vectorsWorld[h],b,E),E.x<this._orthoLeft&&(this._orthoLeft=E.x),E.y<this._orthoBottom&&(this._orthoBottom=E.y),E.x>this._orthoRight&&(this._orthoRight=E.x),E.y>this._orthoTop&&(this._orthoTop=E.y),this.autoCalcShadowZBounds&&(E.z<a&&(a=E.z),E.z>k&&(k=E.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=a,this._shadowMaxZ=k)}const k=this._orthoRight-this._orthoLeft,V=this._orthoTop-this._orthoBottom,l=void 0!==this.shadowMinZ?this.shadowMinZ:a.cj,O=void 0!==this.shadowMaxZ?this.shadowMaxZ:a.maxZ,v=this.va().getEngine().useReverseDepthBuffer;G.d.OrthoOffCenterLHToRef(this._orthoLeft-k*this.shadowOrthoScale,this._orthoRight+k*this.shadowOrthoScale,this._orthoBottom-V*this.shadowOrthoScale,this._orthoTop+V*this.shadowOrthoScale,v?O:l,v?l:O,E,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(E,b){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,b),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,b),this)}transferToNodeMaterialEffect(E,b){return this.computeTransformedInformation()?(E.setFloat3(b,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(E.setFloat3(b,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(E){const b=this._scene.getEngine();return!b.useReverseDepthBuffer&&b.isNDCHalfZRange?0:1}getDepthMaxZ(E){const b=this._scene.getEngine();return b.useReverseDepthBuffer&&b.isNDCHalfZRange?0:1}prepareLightSpecificDefines(E,b){E["DIRLIGHT"+b]=!0}}(0,a.d)([(0,k.H)()],s.prototype,"shadowFrustumSize",null),(0,a.d)([(0,k.H)()],s.prototype,"shadowOrthoScale",null),(0,a.d)([(0,k.H)()],s.prototype,"autoUpdateExtends",void 0),(0,a.d)([(0,k.H)()],s.prototype,"autoCalcShadowZBounds",void 0),(0,a.d)([(0,k.H)("orthoLeft")],s.prototype,"_orthoLeft",void 0),(0,a.d)([(0,k.H)("orthoRight")],s.prototype,"_orthoRight",void 0),(0,a.d)([(0,k.H)("orthoTop")],s.prototype,"_orthoTop",void 0),(0,a.d)([(0,k.H)("orthoBottom")],s.prototype,"_orthoBottom",void 0),(0,v.f)("BABYLON.DirectionalLight",s)},12564:(E,b,h)=>{"use strict";h.d(b,{c:()=>s});var a=h(11130),k=h(11139),G=h(11175),V=h(11201),l=h(11429),O=h(12185),v=h(10958);l.d.AddNodeConstructor("Light_Type_3",((E,b)=>()=>new s(E,G.k.Zero(),b)));class s extends O.d{constructor(E,b,h){super(E,h),this.groundColor=new V.b(0,0,0),this.direction=b||G.k.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"lb"}setDirectionToTarget(E){return this.direction=G.k.Normalize(E.Xc(G.k.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(E,b){const h=G.k.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",h.x,h.y,h.z,0,b),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.gj),b),this}transferToNodeMaterialEffect(E,b){const h=G.k.Normalize(this.direction);return E.setFloat3(b,h.x,h.y,h.z),this}Wj(){return this._worldMatrix||(this._worldMatrix=G.d.Identity()),this._worldMatrix}getTypeID(){return O.d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(E,b){E["HEMILIGHT"+b]=!0}}(0,a.d)([(0,k.g)()],s.prototype,"groundColor",void 0),(0,a.d)([(0,k.G)()],s.prototype,"direction",void 0),(0,v.f)("BABYLON.HemisphericLight",s)},12185:(E,b,h)=>{"use strict";h.d(b,{d:()=>B});var a=h(11130),k=h(11139),G=h(11175),V=h(11201),l=h(11429),O=h(11224),v=h(10958),s=h(11302),U=h(11206);class B extends l.d{get range(){return this._range}set range(E){this._range=E,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(E){this._intensityMode=E,this._computePhotometricScale()}get radius(){return this._radius}set radius(E){this._radius=E,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(E){this._shadowEnabled!==E&&(this._shadowEnabled=E,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(E){this._includedOnlyMeshes=E,this._hookArrayForIncludedOnly(E)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(E){this._excludedMeshes=E,this._hookArrayForExcluded(E)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(E){this._excludeWithLayerMask=E,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(E){this._includeOnlyWithLayerMask=E,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(E){this._lightmapMode!==E&&(this._lightmapMode=E,this._markMeshesAsLightDirty())}getViewMatrix(E){return null}getProjectionMatrix(E,b){return null}constructor(E,b){super(E,b,!1),this.Kh=new V.b(1,1,1),this.Lh=new V.b(1,1,1),this.falloffType=B.FALLOFF_DEFAULT,this.gj=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=B.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.va().addLight(this),this._uniformBuffer=new O.d(this.va().getEngine(),void 0,void 0,E),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(E,b){return this}_bindLight(E,b,h,a){let k=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const G=E.toString();let l=!1;if(this._uniformBuffer.bindToEffect(h,"Light"+G),this._renderId!==b.getRenderId()||this._lastUseSpecular!==a||!this._uniformBuffer.useUbo){this._renderId=b.getRenderId(),this._lastUseSpecular=a;const E=this.getScaledIntensity();this.transferToEffect(h,G),this.Kh.scaleToRef(E,V.j.gb[0]),this._uniformBuffer.updateColor4("vLightDiffuse",V.j.gb[0],this.range,G),a&&(this.Lh.scaleToRef(E,V.j.gb[1]),this._uniformBuffer.updateColor4("vLightSpecular",V.j.gb[1],this.radius,G)),l=!0}if(this.transferTexturesToEffect(h,G),b.shadowsEnabled&&this.shadowEnabled&&k){const E=this.getShadowGenerator(b.activeCamera)??this.getShadowGenerator();E&&(E.bindShadowLight(G,h),l=!0)}l?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(E){let b="Name: "+this.name;if(b+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let h=0;h<this.animations.length;h++)b+=", animation[0]: "+this.animations[h].toString(E);return b}_syncParentEnabledState(){super._syncParentEnabledState(),this.u()||this._resyncMeshes()}Gb(E){super.Gb(E),this._resyncMeshes()}getShadowGenerator(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(E)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return G.k.Zero()}canAffectMesh(E){return!E||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(E))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(E))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&E.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&E.layerMask)))}dispose(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const E=this._shadowGenerators.values();for(let b=E.next();!0!==b.done;b=E.next()){b.value.dispose()}this._shadowGenerators=null}if(this.va().stopAnimation(this),this._parentContainer){const E=this._parentContainer.lights.indexOf(this);E>-1&&this._parentContainer.lights.splice(E,1),this._parentContainer=null}for(const h of this.va().meshes)h._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.va().removeLight(this),super.dispose(E,b)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.gj}clone(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=B.GetConstructorFromName(this.getTypeID(),E,this.va());if(!h)return null;const a=U.e.Clone(h,this);return E&&(a.name=E),b&&(a.parent=b),a.Gb(this.isEnabled()),this.onClonedObservable.notifyObservers(a),a}serialize(){const E=U.e.Serialize(this);return E.uniqueId=this.uniqueId,E.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(E),this.excludedMeshes.length>0&&(E.excludedMeshesIds=[],this.excludedMeshes.forEach((b=>{E.excludedMeshesIds.push(b.id)}))),this.includedOnlyMeshes.length>0&&(E.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((b=>{E.includedOnlyMeshesIds.push(b.id)}))),U.e.AppendSerializedAnimations(this,E),E.ranges=this.serializeAnimationRanges(),E.isEnabled=this.isEnabled(),E}static GetConstructorFromName(E,b,h){const a=l.d.Construct("Light_Type_"+E,b,h);return a||null}static Parse(E,b){const h=B.GetConstructorFromName(E.type,E.name,b);if(!h)return null;const a=U.e.Parse(h,E,b);if(E.excludedMeshesIds&&(a._excludedMeshesIds=E.excludedMeshesIds),E.includedOnlyMeshesIds&&(a._includedOnlyMeshesIds=E.includedOnlyMeshesIds),void 0!==E.parentId&&(a._waitingParentId=E.parentId),void 0!==E.parentInstanceIndex&&(a._waitingParentInstanceIndex=E.parentInstanceIndex),void 0!==E.falloffType&&(a.falloffType=E.falloffType),void 0!==E.lightmapMode&&(a.lightmapMode=E.lightmapMode),E.animations){for(let b=0;b<E.animations.length;b++){const h=E.animations[b],k=(0,v.d)("BABYLON.Animation");k&&a.animations.push(k.Parse(h))}l.d.ParseAnimationRanges(a,E,b)}return E.autoAnimate&&b.beginAnimation(a,E.autoAnimateFrom,E.autoAnimateTo,E.autoAnimateLoop,E.autoAnimateSpeed||1),void 0!==E.isEnabled&&a.Gb(E.isEnabled),a}_hookArrayForExcluded(E){var b=this;const h=E.push;E.push=function(){for(var a=arguments.length,k=new Array(a),G=0;G<a;G++)k[G]=arguments[G];const V=h.apply(E,k);for(const E of k)E._resyncLightSource(b);return V};const a=E.splice;E.splice=(b,h)=>{const k=a.apply(E,[b,h]);for(const E of k)E._resyncLightSource(this);return k};for(const k of E)k._resyncLightSource(this)}_hookArrayForIncludedOnly(E){var b=this;const h=E.push;E.push=function(){for(var a=arguments.length,k=new Array(a),G=0;G<a;G++)k[G]=arguments[G];const V=h.apply(E,k);return b._resyncMeshes(),V};const a=E.splice;E.splice=(b,h)=>{const k=a.apply(E,[b,h]);return this._resyncMeshes(),k},this._resyncMeshes()}_resyncMeshes(){for(const E of this.va().meshes)E._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const E of this.va().meshes)-1!==E.lightSources.indexOf(this)&&E._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.va().resetCachedMaterial()}_getPhotometricScale(){let E=0;const b=this.getTypeID();let h=this.intensityMode;switch(h===B.INTENSITYMODE_AUTOMATIC&&(h=b===B.LIGHTTYPEID_DIRECTIONALLIGHT?B.INTENSITYMODE_ILLUMINANCE:B.INTENSITYMODE_LUMINOUSINTENSITY),b){case B.LIGHTTYPEID_POINTLIGHT:case B.LIGHTTYPEID_SPOTLIGHT:switch(h){case B.INTENSITYMODE_LUMINOUSPOWER:E=1/(4*Math.PI);break;case B.INTENSITYMODE_LUMINOUSINTENSITY:E=1;break;case B.INTENSITYMODE_LUMINANCE:E=this.radius*this.radius}break;case B.LIGHTTYPEID_DIRECTIONALLIGHT:switch(h){case B.INTENSITYMODE_ILLUMINANCE:E=1;break;case B.INTENSITYMODE_LUMINANCE:{let b=this.radius;b=Math.max(b,.001);E=2*Math.PI*(1-Math.cos(b));break}}break;case B.LIGHTTYPEID_HEMISPHERICLIGHT:E=1}return E}_reorderLightsInScene(){const E=this.va();0!=this._renderPriority&&(E.requireLightSorting=!0),this.va().sortLightsByPriority()}}B.FALLOFF_DEFAULT=s.c.FALLOFF_DEFAULT,B.FALLOFF_PHYSICAL=s.c.FALLOFF_PHYSICAL,B.FALLOFF_GLTF=s.c.FALLOFF_GLTF,B.FALLOFF_STANDARD=s.c.FALLOFF_STANDARD,B.LIGHTMAP_DEFAULT=s.c.LIGHTMAP_DEFAULT,B.LIGHTMAP_SPECULAR=s.c.LIGHTMAP_SPECULAR,B.LIGHTMAP_SHADOWSONLY=s.c.LIGHTMAP_SHADOWSONLY,B.INTENSITYMODE_AUTOMATIC=s.c.INTENSITYMODE_AUTOMATIC,B.INTENSITYMODE_LUMINOUSPOWER=s.c.INTENSITYMODE_LUMINOUSPOWER,B.INTENSITYMODE_LUMINOUSINTENSITY=s.c.INTENSITYMODE_LUMINOUSINTENSITY,B.INTENSITYMODE_ILLUMINANCE=s.c.INTENSITYMODE_ILLUMINANCE,B.INTENSITYMODE_LUMINANCE=s.c.INTENSITYMODE_LUMINANCE,B.LIGHTTYPEID_POINTLIGHT=s.c.LIGHTTYPEID_POINTLIGHT,B.LIGHTTYPEID_DIRECTIONALLIGHT=s.c.LIGHTTYPEID_DIRECTIONALLIGHT,B.LIGHTTYPEID_SPOTLIGHT=s.c.LIGHTTYPEID_SPOTLIGHT,B.LIGHTTYPEID_HEMISPHERICLIGHT=s.c.LIGHTTYPEID_HEMISPHERICLIGHT,(0,a.d)([(0,k.g)()],B.prototype,"diffuse",void 0),(0,a.d)([(0,k.g)()],B.prototype,"specular",void 0),(0,a.d)([(0,k.H)()],B.prototype,"falloffType",void 0),(0,a.d)([(0,k.H)()],B.prototype,"intensity",void 0),(0,a.d)([(0,k.H)()],B.prototype,"range",null),(0,a.d)([(0,k.H)()],B.prototype,"intensityMode",null),(0,a.d)([(0,k.H)()],B.prototype,"radius",null),(0,a.d)([(0,k.H)()],B.prototype,"_renderPriority",void 0),(0,a.d)([(0,k.b)("_reorderLightsInScene")],B.prototype,"renderPriority",void 0),(0,a.d)([(0,k.H)("shadowEnabled")],B.prototype,"_shadowEnabled",void 0),(0,a.d)([(0,k.H)("excludeWithLayerMask")],B.prototype,"_excludeWithLayerMask",void 0),(0,a.d)([(0,k.H)("includeOnlyWithLayerMask")],B.prototype,"_includeOnlyWithLayerMask",void 0),(0,a.d)([(0,k.H)("lightmapMode")],B.prototype,"_lightmapMode",void 0)},11302:(E,b,h)=>{"use strict";h.d(b,{c:()=>a});class a{static CompareLightsPriority(E,b){return E.shadowEnabled!==b.shadowEnabled?(b.shadowEnabled?1:0)-(E.shadowEnabled?1:0):b.renderPriority-E.renderPriority}}a.FALLOFF_DEFAULT=0,a.FALLOFF_PHYSICAL=1,a.FALLOFF_GLTF=2,a.FALLOFF_STANDARD=3,a.LIGHTMAP_DEFAULT=0,a.LIGHTMAP_SPECULAR=1,a.LIGHTMAP_SHADOWSONLY=2,a.INTENSITYMODE_AUTOMATIC=0,a.INTENSITYMODE_LUMINOUSPOWER=1,a.INTENSITYMODE_LUMINOUSINTENSITY=2,a.INTENSITYMODE_ILLUMINANCE=3,a.INTENSITYMODE_LUMINANCE=4,a.LIGHTTYPEID_POINTLIGHT=0,a.LIGHTTYPEID_DIRECTIONALLIGHT=1,a.LIGHTTYPEID_SPOTLIGHT=2,a.LIGHTTYPEID_HEMISPHERICLIGHT=3},12234:(E,b,h)=>{"use strict";h.d(b,{b:()=>O});var a=h(11130),k=h(11139),G=h(11175),V=h(12185),l=h(11466);class O extends V.d{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=G.d.Identity(),this._projectionMatrix=G.d.Identity()}_setPosition(E){this._position=E}get position(){return this._position}set position(E){this._setPosition(E)}_setDirection(E){this._direction=E}get direction(){return this._direction}set direction(E){this._setDirection(E)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(E){this._shadowMinZ=E,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(E){this._shadowMaxZ=E,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=G.k.Zero()),G.k.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=G.k.Zero()),G.k.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(E){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(E){return this.direction=G.k.Normalize(E.Xc(this.position)),this.direction}getRotation(){this.direction.normalize();const E=G.k.Cross(this.direction,l.b.Y),b=G.k.Cross(E,this.direction);return G.k.RotationFromAxis(E,b,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=G.k.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}Wj(E){return!E&&this.isSynchronized()?(this._currentRenderId=this.va().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.p(this.position),this._worldMatrix||(this._worldMatrix=G.d.Identity()),G.d.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(E){return void 0!==this.shadowMinZ?this.shadowMinZ:E.cj}getDepthMaxZ(E){return void 0!==this.shadowMaxZ?this.shadowMaxZ:E.maxZ}setShadowProjectionMatrix(E,b,h){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(b,h,E):this._setDefaultShadowProjectionMatrix(E,b,h),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(E){const b=G.h.o[0];let h=this.position;this.computeTransformedInformation()&&(h=this.transformedPosition),G.k.NormalizeToRef(this.getShadowDirection(E),b),1===Math.abs(G.k.Dot(b,G.k.Up()))&&(b.z=1e-13);const a=G.h.o[1];return h.addToRef(b,a),G.d.LookAtLHToRef(h,a,G.k.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(E,b){return this.setShadowProjectionMatrix(this._projectionMatrix,E??this._viewMatrix,b??[]),this._projectionMatrix}}(0,a.d)([(0,k.G)()],O.prototype,"position",null),(0,a.d)([(0,k.G)()],O.prototype,"direction",null),(0,a.d)([(0,k.H)()],O.prototype,"shadowMinZ",null),(0,a.d)([(0,k.H)()],O.prototype,"shadowMaxZ",null)},11814:(E,b,h)=>{"use strict";h.d(b,{e:()=>V,h:()=>G,k:()=>l});const a={},k={};function G(E,b){a[E]=b}function V(E,b){k[E]=b}function l(E){return k[E]?k[E]:null}},11535:(E,b,h)=>{"use strict";h.d(b,{c:()=>H,d:()=>A});var a,k=h(10821),G=h(10824),V=h(11163),l=h(10869),O=h(10834),v=h(11450),s=h(10878),U=h(10883),B=h(10966),o=h(10902);!function(E){E[E.Clean=0]="Clean",E[E.Stop=1]="Stop",E[E.Sync=2]="Sync",E[E.NoSync=3]="NoSync"}(a||(a={}));const u=new G.e,D={};let g=!1;function S(){return D[".babylon"]}function M(E){const b=D[E];return b||(O.c.Warn("Unable to find a plugin to load "+E+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),S())}function I(E,b,h){let a="Unable to load from "+(E.rawData?"binary data":E.url);return b?a+=`: ${b}`:h&&(a+=`: ${h}`),a}function j(E,b,h,a,k,G,V,l,O){var v;const U="data:"===(B=E.url).substring(0,5)?B.substring(5):null;var B;if(E.rawData&&!V)throw"When using ArrayBufferView to load data the file extension must be provided.";const g=V?M(V):U?function(E){for(const b in D){const h=D[b].plugin;if(h.canDirectLoad&&h.canDirectLoad(E))return D[b]}return S()}(E.url):function(E){const b=E.indexOf("?");-1!==b&&(E=E.substring(0,b));const h=E.lastIndexOf(".");return M(E.substring(h,E.length).toLowerCase())}(E.url);if(!g)throw new Error(`No plugin or fallback for ${V??E.url}`);if(!1===(null===O||void 0===O||null===(v=O[g.plugin.name])||void 0===v?void 0:v.enabled))throw new Error(`The '${g.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(E.rawData&&!g.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(E=>{if(g.plugin.createPlugin){const b=g.plugin.createPlugin(O??{});return b instanceof Promise?(b.then(E).catch((E=>{k("Error instantiating plugin.",E)})),null):(E(b),b)}return E(g.plugin),g.plugin})((O=>{var v;if(!O)throw`The loader plugin corresponding to the '${V}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(u.notifyObservers(O),U&&(O.canDirectLoad&&O.canDirectLoad(E.url)||!(0,s.j)(E.url))){if(O.directLoad){const E=O.directLoad(b,U);E instanceof Promise?E.then((E=>{h(O,E)})).catch((E=>{k("Error in directLoad of _loadData: "+E,E)})):h(O,E)}else h(O,U);return}const B=g.isBinary,D=(E,a)=>{b.u?k("Scene has been disposed"):h(O,E,a)};let S=null,M=!1;null===(v=O.rj)||void 0===v||v.add((()=>{M=!0,S&&(S.abort(),S=null),G()}));const I=()=>{if(M)return;const h=(E,b)=>{k(null===E||void 0===E?void 0:E.statusText,b)};if(!O.loadFile&&E.rawData)throw"Plugin does not support loading ArrayBufferView.";S=O.loadFile?O.loadFile(b,E.rawData||E.file||E.url,E.rootUrl,D,a,B,h,l):b._loadFile(E.file||E.url,D,a,!0,B,h)},j=b.getEngine();let P=j.enableOfflineSupport;if(P){let h=!1;for(const a of b.disableOfflineSupportExceptionRules)if(a.test(E.url)){h=!0;break}P=!h}P&&o.d.OfflineProviderFactory?b.offlineProvider=o.d.OfflineProviderFactory(E.url,I,j.disableManifestCheck):I()}))}function P(E,b){let h,a,G=null,V=null;if(b)if(b.name)h=`file:${b.name}`,a=b.name,G=b;else if(ArrayBuffer.isView(b))h="",a=(0,B.e)(),V=b;else if(b.startsWith("data:"))h=b,a="";else if(E){const G=b;if("/"===G.substring(0,1))return k.g.Error("Wrong sceneFilename parameter"),null;h=E+G,a=G}else h=b,a=k.g.GetFilename(b),E=k.g.GetFolderPath(b);else h=E,a=k.g.GetFilename(E),E=k.g.GetFolderPath(E);return{url:h,rootUrl:E,name:a,file:G,rawData:V}}function A(E){if("string"===typeof E.extensions){const b=E.extensions;D[b.toLowerCase()]={plugin:E,isBinary:!1}}else{const b=E.extensions;Object.keys(b).forEach((h=>{D[h.toLowerCase()]={plugin:E,isBinary:b[h].isBinary}}))}}function n(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:l.b.LastCreatedScene,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,v=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",B=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!a)return O.c.Error("No scene available to import mesh to"),null;const o=P(b,h);if(!o)return null;const u={};a.addPendingData(u);const D=()=>{a.removePendingData(u)},g=(E,b)=>{const h=I(o,E,b);V?V(a,h,new U.g(h,U.e.SceneLoaderError,b)):O.c.Error(h),D()},S=G?E=>{try{G(E)}catch(b){g("Error in onProgress callback: "+b,b)}}:void 0,M=(E,b,h,G,V,l,O,v)=>{if(a.importedMeshesFiles.push(o.url),k)try{k(E,b,h,G,V,l,O,v)}catch(s){g("Error in onSuccess callback: "+s,s)}a.removePendingData(u)};return j(o,a,((b,h,k)=>{if(b.rewriteRootURL&&(o.rootUrl=b.rewriteRootURL(o.rootUrl,k)),b.importMesh){const k=[],G=[],V=[];if(!b.importMesh(E,a,h,o.rootUrl,k,G,V,g))return;a.loadingPluginName=b.name,M(k,G,V,[],[],[],[],[])}else{b.importMeshAsync(E,a,h,o.rootUrl,S,o.name).then((E=>{a.loadingPluginName=b.name,M(E.meshes,E.yj,E.skeletons,E.animationGroups,E.transformNodes,E.geometries,E.lights,E.spriteManagers)})).catch((E=>{g(E.message,E)}))}}),S,g,D,v,s,B)}function d(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.b.LastCreatedEngine,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};return h?z(E,b,new V.e(h),a,G,O,v,s,U):(k.g.Error("No engine available"),null)}function c(E,b,h,a,k,G,V){return new Promise(((l,O)=>{d(E,b,h,(E=>{l(E)}),a,((E,b,h)=>{O(h||new Error(b))}),k,G,V)}))}function z(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.b.LastCreatedScene,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",B=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!h)return O.c.Error("No scene available to append to"),null;const o=P(E,b);if(!o)return null;const u={};h.addPendingData(u);const D=()=>{h.removePendingData(u)};v.c.ShowLoadingScreen&&!g&&(g=!0,h.getEngine().displayLoadingUI(),h.executeWhenReady((()=>{h.getEngine().hideLoadingUI(),g=!1})));const S=(E,b)=>{const a=I(o,E,b);G?G(h,a,new U.g(a,U.e.SceneLoaderError,b)):O.c.Error(a),D()},M=k?E=>{try{k(E)}catch(b){S("Error in onProgress callback",b)}}:void 0,A=()=>{if(a)try{a(h)}catch(E){S("Error in onSuccess callback",E)}h.removePendingData(u)};return j(o,h,((E,b)=>{if(E.load){if(!E.load(h,b,o.rootUrl,S))return;h.loadingPluginName=E.name,A()}else{E.loadAsync(h,b,o.rootUrl,M,o.name).then((()=>{h.loadingPluginName=E.name,A()})).catch((E=>{S(E.message,E)}))}}),M,S,D,V,s,B)}function Z(E,b,h,a,k,G,V){return new Promise(((l,O)=>{z(E,b,h,(E=>{l(E)}),a,((E,b,h)=>{O(h||new Error(b))}),k,G,V)}))}function Y(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.b.LastCreatedScene,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,v=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!h)return O.c.Error("No scene available to load asset container to"),null;const B=P(E,b);if(!B)return null;const o={};h.addPendingData(o);const u=()=>{h.removePendingData(o)},D=(E,b)=>{const a=I(B,E,b);G?G(h,a,new U.g(a,U.e.SceneLoaderError,b)):O.c.Error(a),u()},g=k?E=>{try{k(E)}catch(b){D("Error in onProgress callback",b)}}:void 0,S=E=>{if(a)try{a(E)}catch(b){D("Error in onSuccess callback",b)}h.removePendingData(o)};return j(B,h,((E,b)=>{if(E.loadAssetContainer){const a=E.loadAssetContainer(h,b,B.rootUrl,D);if(!a)return;a.populateRootNodes(),h.loadingPluginName=E.name,S(a)}else if(E.loadAssetContainerAsync){E.loadAssetContainerAsync(h,b,B.rootUrl,g,B.name).then((b=>{b.populateRootNodes(),h.loadingPluginName=E.name,S(b)})).catch((E=>{D(E.message,E)}))}else D("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),g,D,u,V,v,s)}function r(E,b,h,a,k,G,V){return new Promise(((l,O)=>{Y(E,b,h,(E=>{l(E)}),a,((E,b,h)=>{O(h||new Error(b))}),k,G,V)}))}function w(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.b.LastCreatedScene,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,v=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,U=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,B=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",o=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!h)return void O.c.Error("No scene available to load animations to");if(a){for(const E of h.animatables)E.reset();h.stopAllAnimations(),h.animationGroups.slice().forEach((E=>{E.dispose()}));h.getNodes().forEach((E=>{E.animations&&(E.animations=[])}))}else switch(k){case 0:h.animationGroups.slice().forEach((E=>{E.dispose()}));break;case 1:h.animationGroups.forEach((E=>{E.stop()}));break;case 2:h.animationGroups.forEach((E=>{E.reset(),E.restart()}));break;case 3:break;default:return void O.c.Error("Unknown animation group loading mode value '"+k+"'")}const u=h.animatables.length;Y(E,b,h,(E=>{E.mergeAnimationsTo(h,h.animatables.slice(u),G),E.dispose(),h.onAnimationFileImportedObservable.notifyObservers(h),V&&V(h)}),v,s,U,B,o)}function N(E,b,h,a,k,G,V,l,O,v){return new Promise(((s,U)=>{w(E,b,h,a,k,G,(E=>{s(E)}),V,((E,b,h)=>{U(h||new Error(b))}),l,O,v)}))}class H{static get ForceFullSceneLoadingForIncremental(){return v.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(E){v.c.ForceFullSceneLoadingForIncremental=E}static get ShowLoadingScreen(){return v.c.ShowLoadingScreen}static set ShowLoadingScreen(E){v.c.ShowLoadingScreen=E}static get loggingLevel(){return v.c.loggingLevel}static set loggingLevel(E){v.c.loggingLevel=E}static get CleanBoneMatrixWeights(){return v.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(E){v.c.CleanBoneMatrixWeights=E}static GetDefaultPlugin(){return S()}static GetPluginForExtension(E){var b;return null===(b=M(E))||void 0===b?void 0:b.plugin}static IsPluginForExtensionAvailable(E){return function(E){return!!D[E]}(E)}static RegisterPlugin(E){A(E)}static ImportMesh(E,b,h,a,k,G,V,l,O){return n(E,b,h,a,k,G,V,l,O)}static ImportMeshAsync(E,b,h,a,k,G,V){return function(E,b,h,a,k,G,V,l){return new Promise(((O,v)=>{n(E,b,h,a,((E,b,h,a,k,G,V,l)=>{O({meshes:E,yj:b,skeletons:h,animationGroups:a,transformNodes:k,geometries:G,lights:V,spriteManagers:l})}),k,((E,b,h)=>{v(h||new Error(b))}),G,V,l)}))}(E,b,h,a,k,G,V)}static Load(E,b,h,a,k,G,V,l){return d(E,b,h,a,k,G,V,l)}static LoadAsync(E,b,h,a,k,G){return c(E,b,h,a,k,G)}static Append(E,b,h,a,k,G,V,l){return z(E,b,h,a,k,G,V,l)}static AppendAsync(E,b,h,a,k,G){return Z(E,b,h,a,k,G)}static LoadAssetContainer(E,b,h,a,k,G,V,l){return Y(E,b,h,a,k,G,V,l)}static LoadAssetContainerAsync(E,b,h,a,k,G){return r(E,b,h,a,k,G)}static ImportAnimations(E,b,h,a,k,G,V,l,O,v,s){w(E,b,h,a,k,G,V,l,O,v,s)}static ImportAnimationsAsync(E,b,h,a,k,G,V,l,O,v,s){return N(E,b,h,a,k,G,l,v,s)}}H.NO_LOGGING=0,H.MINIMAL_LOGGING=1,H.SUMMARY_LOGGING=2,H.DETAILED_LOGGING=3,H.OnPluginActivatedObservable=u},11450:(E,b,h)=>{"use strict";h.d(b,{c:()=>a});class a{static get ForceFullSceneLoadingForIncremental(){return a._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(E){a._ForceFullSceneLoadingForIncremental=E}static get ShowLoadingScreen(){return a._ShowLoadingScreen}static set ShowLoadingScreen(E){a._ShowLoadingScreen=E}static get loggingLevel(){return a._LoggingLevel}static set loggingLevel(E){a._LoggingLevel=E}static get CleanBoneMatrixWeights(){return a._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(E){a._CleanBoneMatrixWeights=E}}a._ForceFullSceneLoadingForIncremental=!1,a._ShowLoadingScreen=!0,a._CleanBoneMatrixWeights=!1,a._LoggingLevel=0},12159:(E,b,h)=>{"use strict";h.d(b,{b:()=>K});var a=h(11130),k=h(11139),G=h(10834),V=h(11155),l=h(12150),O=h(11163),v=h(11175),s=h(11233),U=h(11366),B=h(11405);class o extends U.c{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1}}class u extends B.d{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(E,"PBRBRDF",90,new o,b),this._useEnergyConservation=u.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=u.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=u.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=u.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=u.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=u.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=u.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=u.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=E._dirtyCallbacks[16],this._enable(!0)}prepareDefines(E){E.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,E.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,E.SPHERICAL_HARMONICS=this._useSphericalHarmonics,E.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation}getClassName(){return"PBRBRDFConfiguration"}}u.DEFAULT_USE_ENERGY_CONSERVATION=!0,u.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,u.DEFAULT_USE_SPHERICAL_HARMONICS=!0,u.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,(0,a.d)([(0,k.H)(),(0,k.b)("_markAllSubMeshesAsMiscDirty")],u.prototype,"useEnergyConservation",void 0),(0,a.d)([(0,k.H)(),(0,k.b)("_markAllSubMeshesAsMiscDirty")],u.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,a.d)([(0,k.H)(),(0,k.b)("_markAllSubMeshesAsMiscDirty")],u.prototype,"useSphericalHarmonics",void 0),(0,a.d)([(0,k.H)(),(0,k.b)("_markAllSubMeshesAsMiscDirty")],u.prototype,"useSpecularGlossinessInputEnergyConservation",void 0);var D=h(11304),g=h(11201),S=h(11195),M=h(11311),I=h(11368),j=h(11376),P=h(11393),A=(h(12166),h(11396)),n=h(11351);class d extends U.c{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class c extends B.d{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(E,"PBRClearCoat",100,new d,b),this._isEnabled=!1,this.isEnabled=!1,this.gj=1,this.roughness=0,this._indexOfRefraction=c._DefaultIndexOfRefraction,this.indexOfRefraction=c._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=g.b.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=E._dirtyCallbacks[1]}isReadyForSubMesh(E,b,h){if(!this._isEnabled)return!0;const a=this._material._disableBumpMap;if(E._areTexturesDirty&&b.texturesEnabled){if(this._texture&&P.c.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&P.c.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(h.getCaps().standardDerivatives&&this._bumpTexture&&P.c.ClearCoatBumpTextureEnabled&&!a&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&P.c.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(E,b){this._isEnabled?(E.CLEARCOAT=!0,E.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,E.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,E._areTexturesDirty&&b.texturesEnabled&&(this._texture&&P.c.ClearCoatTextureEnabled?(0,n.N)(this._texture,E,"CLEARCOAT_TEXTURE"):E.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&P.c.ClearCoatTextureEnabled?(0,n.N)(this._textureRoughness,E,"CLEARCOAT_TEXTURE_ROUGHNESS"):E.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&P.c.ClearCoatBumpTextureEnabled?(0,n.N)(this._bumpTexture,E,"CLEARCOAT_BUMP"):E.CLEARCOAT_BUMP=!1,E.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===c._DefaultIndexOfRefraction,this._isTintEnabled?(E.CLEARCOAT_TINT=!0,this._tintTexture&&P.c.ClearCoatTintTextureEnabled?((0,n.N)(this._tintTexture,E,"CLEARCOAT_TINT_TEXTURE"),E.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):E.CLEARCOAT_TINT_TEXTURE=!1):(E.CLEARCOAT_TINT=!1,E.CLEARCOAT_TINT_TEXTURE=!1))):(E.CLEARCOAT=!1,E.CLEARCOAT_TEXTURE=!1,E.CLEARCOAT_TEXTURE_ROUGHNESS=!1,E.CLEARCOAT_BUMP=!1,E.CLEARCOAT_TINT=!1,E.CLEARCOAT_TINT_TEXTURE=!1,E.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,E.CLEARCOAT_DEFAULTIOR=!1,E.CLEARCOAT_TEXTUREDIRECTUV=0,E.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,E.CLEARCOAT_BUMPDIRECTUV=0,E.CLEARCOAT_REMAP_F0=!1,E.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,E.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(E,b,h,a){if(!this._isEnabled)return;const k=a.materialDefines,G=this._material.isFrozen,V=this._material._disableBumpMap,l=this._material._invertNormalMapX,O=this._material._invertNormalMapY;if(!E.useUbo||!G||!E.isSync){var v,s,U,B;if((this._texture||this._textureRoughness)&&P.c.ClearCoatTextureEnabled)E.updateFloat4("vClearCoatInfos",(null===(v=this._texture)||void 0===v?void 0:v.coordinatesIndex)??0,(null===(s=this._texture)||void 0===s?void 0:s.level)??0,(null===(U=this._textureRoughness)||void 0===U?void 0:U.coordinatesIndex)??0,(null===(B=this._textureRoughness)||void 0===B?void 0:B.level)??0),this._texture&&(0,n.t)(this._texture,E,"clearCoat"),this._textureRoughness&&!k.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,n.t)(this._textureRoughness,E,"clearCoatRoughness");this._bumpTexture&&h.getCaps().standardDerivatives&&P.c.ClearCoatTextureEnabled&&!V&&(E.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,n.t)(this._bumpTexture,E,"clearCoatBump"),b._mirroredCameraPosition?E.updateFloat2("vClearCoatTangentSpaceParams",l?1:-1,O?1:-1):E.updateFloat2("vClearCoatTangentSpaceParams",l?-1:1,O?-1:1)),this._tintTexture&&P.c.ClearCoatTintTextureEnabled&&(E.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,n.t)(this._tintTexture,E,"clearCoatTint")),E.updateFloat2("vClearCoatParams",this.gj,this.roughness);const a=1-this._indexOfRefraction,G=1+this._indexOfRefraction,o=Math.pow(-a/G,2),u=1/this._indexOfRefraction;E.updateFloat4("vClearCoatRefractionParams",o,u,a,G),this._isTintEnabled&&(E.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),E.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}b.texturesEnabled&&(this._texture&&P.c.ClearCoatTextureEnabled&&E.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!k.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&P.c.ClearCoatTextureEnabled&&E.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&h.getCaps().standardDerivatives&&P.c.ClearCoatBumpTextureEnabled&&!V&&E.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&P.c.ClearCoatTintTextureEnabled&&E.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(E){return this._texture===E||(this._textureRoughness===E||(this._bumpTexture===E||this._tintTexture===E))}getActiveTextures(E){this._texture&&E.push(this._texture),this._textureRoughness&&E.push(this._textureRoughness),this._bumpTexture&&E.push(this._bumpTexture),this._tintTexture&&E.push(this._tintTexture)}getAnimatables(E){this._texture&&this._texture.animations&&this._texture.animations.length>0&&E.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&E.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&E.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&E.push(this._tintTexture)}dispose(E){var b,h,a,k;E&&(null===(b=this._texture)||void 0===b||b.dispose(),null===(h=this._textureRoughness)||void 0===h||h.dispose(),null===(a=this._bumpTexture)||void 0===a||a.dispose(),null===(k=this._tintTexture)||void 0===k||k.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(E,b,h){return E.CLEARCOAT_BUMP&&b.addFallback(h++,"CLEARCOAT_BUMP"),E.CLEARCOAT_TINT&&b.addFallback(h++,"CLEARCOAT_TINT"),E.CLEARCOAT&&b.addFallback(h++,"CLEARCOAT"),h}getSamplers(E){E.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}c._DefaultIndexOfRefraction=1.5,(0,a.d)([(0,k.H)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"isEnabled",void 0),(0,a.d)([(0,k.H)()],c.prototype,"intensity",void 0),(0,a.d)([(0,k.H)()],c.prototype,"roughness",void 0),(0,a.d)([(0,k.H)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"indexOfRefraction",void 0),(0,a.d)([(0,k.C)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"texture",void 0),(0,a.d)([(0,k.H)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"useRoughnessFromMainTexture",void 0),(0,a.d)([(0,k.C)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"textureRoughness",void 0),(0,a.d)([(0,k.H)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"remapF0OnInterfaceChange",void 0),(0,a.d)([(0,k.C)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"bumpTexture",void 0),(0,a.d)([(0,k.H)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"isTintEnabled",void 0),(0,a.d)([(0,k.g)()],c.prototype,"tintColor",void 0),(0,a.d)([(0,k.H)()],c.prototype,"tintColorAtDistance",void 0),(0,a.d)([(0,k.H)()],c.prototype,"tintThickness",void 0),(0,a.d)([(0,k.C)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"tintTexture",void 0);class z extends U.c{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class Z extends B.d{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(E,"PBRIridescence",110,new z,b),this._isEnabled=!1,this.isEnabled=!1,this.gj=1,this.minimumThickness=Z._DefaultMinimumThickness,this.maximumThickness=Z._DefaultMaximumThickness,this.indexOfRefraction=Z._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=E._dirtyCallbacks[1]}isReadyForSubMesh(E,b){if(!this._isEnabled)return!0;if(E._areTexturesDirty&&b.texturesEnabled){if(this._texture&&P.c.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&P.c.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(E,b){this._isEnabled?(E.IRIDESCENCE=!0,E._areTexturesDirty&&b.texturesEnabled&&(this._texture&&P.c.IridescenceTextureEnabled?(0,n.N)(this._texture,E,"IRIDESCENCE_TEXTURE"):E.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&P.c.IridescenceTextureEnabled?(0,n.N)(this._thicknessTexture,E,"IRIDESCENCE_THICKNESS_TEXTURE"):E.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(E.IRIDESCENCE=!1,E.IRIDESCENCE_TEXTURE=!1,E.IRIDESCENCE_THICKNESS_TEXTURE=!1,E.IRIDESCENCE_TEXTUREDIRECTUV=0,E.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(E,b){if(!this._isEnabled)return;const h=this._material.isFrozen;if(!E.useUbo||!h||!E.isSync){var a,k,G,V;if((this._texture||this._thicknessTexture)&&P.c.IridescenceTextureEnabled)E.updateFloat4("vIridescenceInfos",(null===(a=this._texture)||void 0===a?void 0:a.coordinatesIndex)??0,(null===(k=this._texture)||void 0===k?void 0:k.level)??0,(null===(G=this._thicknessTexture)||void 0===G?void 0:G.coordinatesIndex)??0,(null===(V=this._thicknessTexture)||void 0===V?void 0:V.level)??0),this._texture&&(0,n.t)(this._texture,E,"iridescence"),this._thicknessTexture&&(0,n.t)(this._thicknessTexture,E,"iridescenceThickness");E.updateFloat4("vIridescenceParams",this.gj,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}b.texturesEnabled&&(this._texture&&P.c.IridescenceTextureEnabled&&E.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&P.c.IridescenceTextureEnabled&&E.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(E){return this._texture===E||this._thicknessTexture===E}getActiveTextures(E){this._texture&&E.push(this._texture),this._thicknessTexture&&E.push(this._thicknessTexture)}getAnimatables(E){this._texture&&this._texture.animations&&this._texture.animations.length>0&&E.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&E.push(this._thicknessTexture)}dispose(E){var b,h;E&&(null===(b=this._texture)||void 0===b||b.dispose(),null===(h=this._thicknessTexture)||void 0===h||h.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(E,b,h){return E.IRIDESCENCE&&b.addFallback(h++,"IRIDESCENCE"),h}getSamplers(E){E.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}Z._DefaultMinimumThickness=100,Z._DefaultMaximumThickness=400,Z._DefaultIndexOfRefraction=1.3,(0,a.d)([(0,k.H)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"isEnabled",void 0),(0,a.d)([(0,k.H)()],Z.prototype,"intensity",void 0),(0,a.d)([(0,k.H)()],Z.prototype,"minimumThickness",void 0),(0,a.d)([(0,k.H)()],Z.prototype,"maximumThickness",void 0),(0,a.d)([(0,k.H)()],Z.prototype,"indexOfRefraction",void 0),(0,a.d)([(0,k.C)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"texture",void 0),(0,a.d)([(0,k.C)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"thicknessTexture",void 0);class Y extends U.c{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class r extends B.d{set angle(E){this.direction.x=Math.cos(E),this.direction.y=Math.sin(E)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(E,"PBRAnisotropic",110,new Y,b),this._isEnabled=!1,this.isEnabled=!1,this.gj=1,this.direction=new v.j(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=E._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=E._dirtyCallbacks[16]}isReadyForSubMesh(E,b){return!this._isEnabled||!(E._areTexturesDirty&&b.texturesEnabled&&this._texture&&P.c.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(E,b,h){this._isEnabled?(E.ANISOTROPIC=this._isEnabled,this._isEnabled&&!h.isVerticesDataPresent(s.g.TangentKind)&&(E._needUVs=!0,E.MAINUV1=!0),E._areTexturesDirty&&b.texturesEnabled&&(this._texture&&P.c.AnisotropicTextureEnabled?(0,n.N)(this._texture,E,"ANISOTROPIC_TEXTURE"):E.ANISOTROPIC_TEXTURE=!1),E._areMiscDirty&&(E.ANISOTROPIC_LEGACY=this._legacy)):(E.ANISOTROPIC=!1,E.ANISOTROPIC_TEXTURE=!1,E.ANISOTROPIC_TEXTUREDIRECTUV=0,E.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(E,b){if(!this._isEnabled)return;const h=this._material.isFrozen;E.useUbo&&h&&E.isSync||(this._texture&&P.c.AnisotropicTextureEnabled&&(E.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,n.t)(this._texture,E,"anisotropy")),E.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.gj)),b.texturesEnabled&&this._texture&&P.c.AnisotropicTextureEnabled&&E.setTexture("anisotropySampler",this._texture)}hasTexture(E){return this._texture===E}getActiveTextures(E){this._texture&&E.push(this._texture)}getAnimatables(E){this._texture&&this._texture.animations&&this._texture.animations.length>0&&E.push(this._texture)}dispose(E){E&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(E,b,h){return E.ANISOTROPIC&&b.addFallback(h++,"ANISOTROPIC"),h}getSamplers(E){E.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(E,b,h){super.parse(E,b,h),void 0===E.legacy&&(this.legacy=!0)}}(0,a.d)([(0,k.H)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"isEnabled",void 0),(0,a.d)([(0,k.H)()],r.prototype,"intensity",void 0),(0,a.d)([(0,k.F)()],r.prototype,"direction",void 0),(0,a.d)([(0,k.C)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"texture",void 0),(0,a.d)([(0,k.H)(),(0,k.b)("_markAllSubMeshesAsMiscDirty")],r.prototype,"legacy",void 0);class w extends U.c{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class N extends B.d{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(E,"Sheen",120,new w,b),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.gj=1,this.color=g.b.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=E._dirtyCallbacks[1]}isReadyForSubMesh(E,b){if(!this._isEnabled)return!0;if(E._areTexturesDirty&&b.texturesEnabled){if(this._texture&&P.c.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&P.c.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(E,b){this._isEnabled?(E.SHEEN=!0,E.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,E.SHEEN_ROUGHNESS=null!==this._roughness,E.SHEEN_ALBEDOSCALING=this._albedoScaling,E.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,E._areTexturesDirty&&b.texturesEnabled&&(this._texture&&P.c.SheenTextureEnabled?((0,n.N)(this._texture,E,"SHEEN_TEXTURE"),E.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):E.SHEEN_TEXTURE=!1,this._textureRoughness&&P.c.SheenTextureEnabled?(0,n.N)(this._textureRoughness,E,"SHEEN_TEXTURE_ROUGHNESS"):E.SHEEN_TEXTURE_ROUGHNESS=!1)):(E.SHEEN=!1,E.SHEEN_TEXTURE=!1,E.SHEEN_TEXTURE_ROUGHNESS=!1,E.SHEEN_LINKWITHALBEDO=!1,E.SHEEN_ROUGHNESS=!1,E.SHEEN_ALBEDOSCALING=!1,E.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,E.SHEEN_GAMMATEXTURE=!1,E.SHEEN_TEXTUREDIRECTUV=0,E.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(E,b,h,a){if(!this._isEnabled)return;const k=a.materialDefines,G=this._material.isFrozen;if(!E.useUbo||!G||!E.isSync){var V,l,O,v;if((this._texture||this._textureRoughness)&&P.c.SheenTextureEnabled)E.updateFloat4("vSheenInfos",(null===(V=this._texture)||void 0===V?void 0:V.coordinatesIndex)??0,(null===(l=this._texture)||void 0===l?void 0:l.level)??0,(null===(O=this._textureRoughness)||void 0===O?void 0:O.coordinatesIndex)??0,(null===(v=this._textureRoughness)||void 0===v?void 0:v.level)??0),this._texture&&(0,n.t)(this._texture,E,"sheen"),this._textureRoughness&&!k.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,n.t)(this._textureRoughness,E,"sheenRoughness");E.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.gj),null!==this._roughness&&E.updateFloat("vSheenRoughness",this._roughness)}b.texturesEnabled&&(this._texture&&P.c.SheenTextureEnabled&&E.setTexture("sheenSampler",this._texture),this._textureRoughness&&!k.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&P.c.SheenTextureEnabled&&E.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(E){return this._texture===E||this._textureRoughness===E}getActiveTextures(E){this._texture&&E.push(this._texture),this._textureRoughness&&E.push(this._textureRoughness)}getAnimatables(E){this._texture&&this._texture.animations&&this._texture.animations.length>0&&E.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&E.push(this._textureRoughness)}dispose(E){var b,h;E&&(null===(b=this._texture)||void 0===b||b.dispose(),null===(h=this._textureRoughness)||void 0===h||h.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(E,b,h){return E.SHEEN&&b.addFallback(h++,"SHEEN"),h}getSamplers(E){E.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,a.d)([(0,k.H)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"isEnabled",void 0),(0,a.d)([(0,k.H)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"linkSheenWithAlbedo",void 0),(0,a.d)([(0,k.H)()],N.prototype,"intensity",void 0),(0,a.d)([(0,k.g)()],N.prototype,"color",void 0),(0,a.d)([(0,k.C)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"texture",void 0),(0,a.d)([(0,k.H)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"useRoughnessFromMainTexture",void 0),(0,a.d)([(0,k.H)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"roughness",void 0),(0,a.d)([(0,k.C)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"textureRoughness",void 0),(0,a.d)([(0,k.H)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"albedoScaling",void 0);class H extends U.c{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1}}class f extends B.d{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(E){this._scene.enableSubSurfaceForPrePass()&&E&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(E))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(E){this._volumeIndexOfRefraction=E>=1?E:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(E,"PBRSubSurface",130,new H,b),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=g.b.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=g.b.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this._scene=E.va(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=E._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=E._dirtyCallbacks[32]}isReadyForSubMesh(E,b){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(E._areTexturesDirty&&b.texturesEnabled){if(this._thicknessTexture&&P.c.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&P.c.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&P.c.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const E=this._getRefractionTexture(b);if(E&&P.c.RefractionTextureEnabled&&!E.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(E,b){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return E.SUBSURFACE=!1,E.SS_DISPERSION=!1,E.SS_TRANSLUCENCY=!1,E.SS_SCATTERING=!1,E.SS_REFRACTION=!1,E.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,E.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,E.SS_THICKNESSANDMASK_TEXTURE=!1,E.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,E.SS_HAS_THICKNESS=!1,E.SS_REFRACTIONINTENSITY_TEXTURE=!1,E.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,E.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,E.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,E.SS_REFRACTIONMAP_3D=!1,E.SS_REFRACTIONMAP_OPPOSITEZ=!1,E.SS_LODINREFRACTIONALPHA=!1,E.SS_GAMMAREFRACTION=!1,E.SS_RGBDREFRACTION=!1,E.SS_LINEARSPECULARREFRACTION=!1,E.SS_LINKREFRACTIONTOTRANSPARENCY=!1,E.SS_ALBEDOFORREFRACTIONTINT=!1,E.SS_ALBEDOFORTRANSLUCENCYTINT=!1,E.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,E.SS_USE_THICKNESS_AS_DEPTH=!1,E.SS_USE_GLTF_TEXTURES=!1,E.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,void(E.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0);if(E._areTexturesDirty){if(E.SUBSURFACE=!0,E.SS_DISPERSION=this._isDispersionEnabled,E.SS_TRANSLUCENCY=this._isTranslucencyEnabled,E.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,E.SS_SCATTERING=this._isScatteringEnabled,E.SS_THICKNESSANDMASK_TEXTURE=!1,E.SS_REFRACTIONINTENSITY_TEXTURE=!1,E.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,E.SS_HAS_THICKNESS=!1,E.SS_USE_GLTF_TEXTURES=!1,E.SS_REFRACTION=!1,E.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,E.SS_REFRACTIONMAP_3D=!1,E.SS_GAMMAREFRACTION=!1,E.SS_RGBDREFRACTION=!1,E.SS_LINEARSPECULARREFRACTION=!1,E.SS_REFRACTIONMAP_OPPOSITEZ=!1,E.SS_LODINREFRACTIONALPHA=!1,E.SS_LINKREFRACTIONTOTRANSPARENCY=!1,E.SS_ALBEDOFORREFRACTIONTINT=!1,E.SS_ALBEDOFORTRANSLUCENCYTINT=!1,E.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,E.SS_USE_THICKNESS_AS_DEPTH=!1,E.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,E._areTexturesDirty&&b.texturesEnabled&&(this._thicknessTexture&&P.c.ThicknessTextureEnabled&&(0,n.N)(this._thicknessTexture,E,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&P.c.RefractionIntensityTextureEnabled&&(0,n.N)(this._refractionIntensityTexture,E,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&P.c.TranslucencyIntensityTextureEnabled&&(0,n.N)(this._translucencyIntensityTexture,E,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&P.c.TranslucencyColorTextureEnabled&&(0,n.N)(this._translucencyColorTexture,E,"SS_TRANSLUCENCYCOLOR_TEXTURE")),E.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,E.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,E.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,E.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&b.texturesEnabled){const h=this._getRefractionTexture(b);h&&P.c.RefractionTextureEnabled&&(E.SS_REFRACTION=!0,E.SS_REFRACTIONMAP_3D=h.isCube,E.SS_GAMMAREFRACTION=h.gammaSpace,E.SS_RGBDREFRACTION=h.isRGBD,E.SS_LINEARSPECULARREFRACTION=h.linearSpecularLOD,E.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&h.isCube?!h.invertZ:h.invertZ,E.SS_LODINREFRACTIONALPHA=h.lodLevelInAlpha,E.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,E.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,E.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=h.isCube&&h.boundingBoxSize,E.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(E.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(E,b,h,a){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)E.updateFloat2("vThicknessParam",0,0);else{a.getRenderingMesh().getWorldMatrix().decompose(v.h.o[0]);const b=Math.max(Math.abs(v.h.o[0].x),Math.abs(v.h.o[0].y),Math.abs(v.h.o[0].z));E.updateFloat2("vThicknessParam",this.minimumThickness*b,(this.maximumThickness-this.minimumThickness)*b)}}bindForSubMesh(E,b,h,a){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const k=a.materialDefines,G=this._material.isFrozen,V=this._material.realTimeFiltering,l=k.LODBASEDMICROSFURACE,O=this._getRefractionTexture(b);if(!E.useUbo||!G||!E.isSync){if(this._thicknessTexture&&P.c.ThicknessTextureEnabled&&(E.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,n.t)(this._thicknessTexture,E,"thickness")),this._refractionIntensityTexture&&P.c.RefractionIntensityTextureEnabled&&k.SS_REFRACTIONINTENSITY_TEXTURE&&(E.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,n.t)(this._refractionIntensityTexture,E,"refractionIntensity")),this._translucencyColorTexture&&P.c.TranslucencyColorTextureEnabled&&k.SS_TRANSLUCENCYCOLOR_TEXTURE&&(E.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,n.t)(this._translucencyColorTexture,E,"translucencyColor")),this._translucencyIntensityTexture&&P.c.TranslucencyIntensityTextureEnabled&&k.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(E.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,n.t)(this._translucencyIntensityTexture,E,"translucencyIntensity")),O&&P.c.RefractionTextureEnabled){E.Pj("refractionMatrix",O.getRefractionTextureMatrix());let b=1;O.isCube||O.depth&&(b=O.depth);const h=O.getSize().width,a=this.volumeIndexOfRefraction;if(E.updateFloat4("vRefractionInfos",O.level,1/a,b,this._invertRefractionY?-1:1),E.updateFloat4("vRefractionMicrosurfaceInfos",h,O.lodGenerationScale,O.lodGenerationOffset,1/this.indexOfRefraction),V&&E.updateFloat2("vRefractionFilteringInfo",h,Math.log2(h)),O.boundingBoxSize){const b=O;E.updateVector3("vRefractionPosition",b.boundingBoxPosition),E.updateVector3("vRefractionSize",b.boundingBoxSize)}}this._isScatteringEnabled&&E.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),E.updateColor3("vDiffusionDistance",this.diffusionDistance),E.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),E.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),E.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),E.updateFloat("dispersion",this.dispersion)}b.texturesEnabled&&(this._thicknessTexture&&P.c.ThicknessTextureEnabled&&E.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&P.c.RefractionIntensityTextureEnabled&&k.SS_REFRACTIONINTENSITY_TEXTURE&&E.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&P.c.TranslucencyIntensityTextureEnabled&&k.SS_TRANSLUCENCYINTENSITY_TEXTURE&&E.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&P.c.TranslucencyColorTextureEnabled&&k.SS_TRANSLUCENCYCOLOR_TEXTURE&&E.setTexture("translucencyColorSampler",this._translucencyColorTexture),O&&P.c.RefractionTextureEnabled&&(l?E.setTexture("refractionSampler",O):(E.setTexture("refractionSampler",O._lodTextureMid||O),E.setTexture("refractionSamplerLow",O._lodTextureLow||O),E.setTexture("refractionSamplerHigh",O._lodTextureHigh||O))))}_getRefractionTexture(E){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?E.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(E){P.c.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&E.push(this._refractionTexture)}hasTexture(E){return this._thicknessTexture===E||(this._refractionTexture===E||(this._refractionIntensityTexture===E||(this._translucencyIntensityTexture===E||this._translucencyColorTexture===E)))}hasRenderTargetTextures(){return!!(P.c.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(E){this._thicknessTexture&&E.push(this._thicknessTexture),this._refractionTexture&&E.push(this._refractionTexture),this._translucencyColorTexture&&E.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&E.push(this._translucencyIntensityTexture)}getAnimatables(E){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&E.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&E.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&E.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&E.push(this._translucencyIntensityTexture)}dispose(E){E&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(E,b,h){return E.SS_SCATTERING&&b.addFallback(h++,"SS_SCATTERING"),E.SS_TRANSLUCENCY&&b.addFallback(h++,"SS_TRANSLUCENCY"),h}getSamplers(E){E.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}(0,a.d)([(0,k.H)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],f.prototype,"isRefractionEnabled",void 0),(0,a.d)([(0,k.H)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],f.prototype,"isTranslucencyEnabled",void 0),(0,a.d)([(0,k.H)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],f.prototype,"isDispersionEnabled",void 0),(0,a.d)([(0,k.H)(),(0,k.b)("_markScenePrePassDirty")],f.prototype,"isScatteringEnabled",void 0),(0,a.d)([(0,k.H)()],f.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,a.d)([(0,k.H)()],f.prototype,"refractionIntensity",void 0),(0,a.d)([(0,k.H)()],f.prototype,"translucencyIntensity",void 0),(0,a.d)([(0,k.H)()],f.prototype,"useAlbedoToTintRefraction",void 0),(0,a.d)([(0,k.H)()],f.prototype,"useAlbedoToTintTranslucency",void 0),(0,a.d)([(0,k.C)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],f.prototype,"thicknessTexture",void 0),(0,a.d)([(0,k.C)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],f.prototype,"refractionTexture",void 0),(0,a.d)([(0,k.H)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],f.prototype,"indexOfRefraction",void 0),(0,a.d)([(0,k.H)()],f.prototype,"_volumeIndexOfRefraction",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],f.prototype,"volumeIndexOfRefraction",null),(0,a.d)([(0,k.H)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],f.prototype,"invertRefractionY",void 0),(0,a.d)([(0,k.H)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],f.prototype,"linkRefractionWithTransparency",void 0),(0,a.d)([(0,k.H)()],f.prototype,"minimumThickness",void 0),(0,a.d)([(0,k.H)()],f.prototype,"maximumThickness",void 0),(0,a.d)([(0,k.H)()],f.prototype,"useThicknessAsDepth",void 0),(0,a.d)([(0,k.g)()],f.prototype,"tintColor",void 0),(0,a.d)([(0,k.H)()],f.prototype,"tintColorAtDistance",void 0),(0,a.d)([(0,k.H)()],f.prototype,"dispersion",void 0),(0,a.d)([(0,k.g)()],f.prototype,"diffusionDistance",void 0),(0,a.d)([(0,k.H)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],f.prototype,"useMaskFromThicknessTexture",void 0),(0,a.d)([(0,k.C)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],f.prototype,"refractionIntensityTexture",void 0),(0,a.d)([(0,k.C)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],f.prototype,"translucencyIntensityTexture",void 0),(0,a.d)([(0,k.g)()],f.prototype,"translucencyColor",void 0),(0,a.d)([(0,k.C)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],f.prototype,"translucencyColorTexture",void 0),(0,a.d)([(0,k.H)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],f.prototype,"useGltfStyleTextures",void 0);var F=h(11403),y=h(11357),e=h(11413);const J={effect:null,subMesh:null};class m extends U.c{constructor(E){super(E),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class K extends I.d{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(E){this._realTimeFiltering=E,this.ah(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(E){this._realTimeFilteringQuality=E,this.ah(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(E){E!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=E||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(E,b){super(E,b,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||K.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new v.n(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=K.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=g.b.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new g.b(0,0,0),this._albedoColor=new g.b(1,1,1),this._reflectivityColor=new g.b(1,1,1),this._reflectionColor=new g.b(1,1,1),this._emissiveColor=new g.b(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=K.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._forceAlphaTest=!1,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new V.e(16),this._globalAmbientColor=new g.b(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new u(this),this.clearCoat=new c(this),this.iridescence=new Z(this),this.anisotropy=new r(this),this.sheen=new N(this),this.subSurface=new f(this),this.detailMap=new F.b(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),P.c.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,l.e)(this.va()),this.prePassConfiguration=new D.b}get hasRenderTargetTextures(){return!!(P.c.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var E;return this._transparencyMode===K.PBRMATERIAL_OPAQUE||this._transparencyMode===K.PBRMATERIAL_ALPHATEST||(null===(E=this.subSurface)||void 0===E?void 0:E.disableAlphaBlending)}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var E;return!!this._forceAlphaTest||(null===(E=this.subSurface)||void 0===E||!E.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===K.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.Ie&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==K.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.Ie||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(E,b,h){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const a=b._drawWrapper;if(a.effect&&this.isFrozen&&a._wasPreviouslyReady&&a._wasPreviouslyUsingInstances===h)return!0;b.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),b.materialDefines=new m(this._eventInfo.defineNames));const k=b.materialDefines;if(this._isReadyForSubMesh(b))return!0;const V=this.va(),l=V.getEngine();if(k._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,V.texturesEnabled)){if(this._albedoTexture&&P.c.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&P.c.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&P.c.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const E=this._getReflectionTexture();if(E&&P.c.ReflectionTextureEnabled){if(!E.isReadyOrNotBlocking())return!1;var O;if(E.irradianceTexture){if(!E.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!E.sphericalPolynomial&&null!==(O=E.getInternalTexture())&&void 0!==O&&O._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&P.c.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&P.c.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(P.c.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(l.getCaps().standardDerivatives&&this._bumpTexture&&P.c.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&P.c.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=k,this._eventInfo.subMesh=b,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(k._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;l.getCaps().standardDerivatives||E.isVerticesDataPresent(s.g.NormalKind)||(E.createNormals(!0),G.c.Warn("PBRMaterial: Normals have been created for the mesh: "+E.name));const v=b.effect,U=k._areLightsDisposed;let B=this._prepareEffect(E,k,this.onCompiled,this.onError,h,null,b.getRenderingMesh().hasThinInstances),o=!1;if(B)if(this._onEffectCreatedObservable&&(J.effect=B,J.subMesh=b,this._onEffectCreatedObservable.notifyObservers(J)),this.allowShaderHotSwapping&&v&&!B.isReady()){if(B=v,k.markAsUnprocessed(),o=this.isFrozen,U)return k._areLightsDisposed=!0,!1}else V.resetCachedMaterial(),b.setEffect(B,k,this._materialContext);return!(!b.effect||!b.effect.isReady())&&(k._renderId=V.getRenderId(),a._wasPreviouslyReady=!o,a._wasPreviouslyUsingInstances=!!h,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(E,b){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,V=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(E,b,G,V,l),!b.isDirty)return null;b.markAsProcessed();const O=this.va().getEngine(),v=new A.b;let U=0;b.USESPHERICALINVERTEX&&v.addFallback(U++,"USESPHERICALINVERTEX"),b.FOG&&v.addFallback(U,"FOG"),b.SPECULARAA&&v.addFallback(U,"SPECULARAA"),b.POINTSIZE&&v.addFallback(U,"POINTSIZE"),b.LOGARITHMICDEPTH&&v.addFallback(U,"LOGARITHMICDEPTH"),b.PARALLAX&&v.addFallback(U,"PARALLAX"),b.PARALLAX_RHS&&v.addFallback(U,"PARALLAX_RHS"),b.PARALLAXOCCLUSION&&v.addFallback(U++,"PARALLAXOCCLUSION"),b.ENVIRONMENTBRDF&&v.addFallback(U++,"ENVIRONMENTBRDF"),b.TANGENT&&v.addFallback(U++,"TANGENT"),b.BUMP&&v.addFallback(U++,"BUMP"),U=(0,n.w)(b,v,this._maxSimultaneousLights,U++),b.SPECULARTERM&&v.addFallback(U++,"SPECULARTERM"),b.USESPHERICALFROMREFLECTIONMAP&&v.addFallback(U++,"USESPHERICALFROMREFLECTIONMAP"),b.USEIRRADIANCEMAP&&v.addFallback(U++,"USEIRRADIANCEMAP"),b.LIGHTMAP&&v.addFallback(U++,"LIGHTMAP"),b.NORMAL&&v.addFallback(U++,"NORMAL"),b.AMBIENT&&v.addFallback(U++,"AMBIENT"),b.EMISSIVE&&v.addFallback(U++,"EMISSIVE"),b.VERTEXCOLOR&&v.addFallback(U++,"VERTEXCOLOR"),b.MORPHTARGETS&&v.addFallback(U++,"MORPHTARGETS"),b.MULTIVIEW&&v.addFallback(0,"MULTIVIEW");const B=[s.g.PositionKind];b.NORMAL&&B.push(s.g.NormalKind),b.TANGENT&&B.push(s.g.TangentKind);for(let h=1;h<=6;++h)b["UV"+h]&&B.push(`uv${1===h?"":h}`);b.VERTEXCOLOR&&B.push(s.g.ColorKind),(0,n.A)(B,E,b,v),(0,n.D)(B,b),(0,n.E)(B,E,b),(0,n.z)(B,E,b);let o="pbr";const u=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],g=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],M=["Material","Scene","Mesh"],I={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:b.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=v,this._eventInfo.fallbackRank=U,this._eventInfo.defines=b,this._eventInfo.uniforms=u,this._eventInfo.attributes=B,this._eventInfo.samplers=g,this._eventInfo.uniformBuffersNames=M,this._eventInfo.customCode=void 0,this._eventInfo.mesh=E,this._eventInfo.indexParameters=I,this._callbackPluginEventGeneric(128,this._eventInfo),e.d.AddUniformsAndSamplers(u,g),D.b.AddUniforms(u),D.b.AddSamplers(g),(0,y.b)(u),S.d&&(S.d.PrepareUniforms(u,b),S.d.PrepareSamplers(g,b)),(0,n.Z)({uniformsNames:u,uniformBuffersNames:M,samplers:g,defines:b,maxSimultaneousLights:this._maxSimultaneousLights});const j={};this.customShaderNameResolve&&(o=this.customShaderNameResolve(o,u,M,g,b,B,j));const P=b.toString(),d=O.createEffect(o,{attributes:B,uniformsNames:u,uniformBuffersNames:M,samplers:g,defines:P,fallbacks:v,onCompiled:a,onError:k,indexParameters:I,processFinalCode:j.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:b.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([h.e(21),h.e(43)]).then(h.bind(h,13414)),Promise.all([h.e(22),h.e(44)]).then(h.bind(h,13431))]):await Promise.all([Promise.all([h.e(25),h.e(45)]).then(h.bind(h,13438)),Promise.all([h.e(27),h.e(46)]).then(h.bind(h,13449))]),this._shadersLoaded=!0}},O);return this._eventInfo.customCode=void 0,d}_prepareDefines(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,k=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const G=this.va(),V=G.getEngine();(0,n.L)(G,E,b,!0,this._maxSimultaneousLights,this._disableLighting),b._needNormals=!0,(0,n.S)(G,b);const l=this.needAlphaBlendingForMesh(E)&&this.va().useOrderIndependentTransparency;if((0,n.Y)(G,b,this.canRenderToMRT&&!l),(0,n.V)(G,b,l),e.d.PrepareDefines(V.currentRenderPassId,E,b),b.METALLICWORKFLOW=this.isMetallicWorkflow(),b._areTexturesDirty){b._needUVs=!1;for(let E=1;E<=6;++E)b["MAINUV"+E]=!1;if(G.texturesEnabled){b.ALBEDODIRECTUV=0,b.AMBIENTDIRECTUV=0,b.OPACITYDIRECTUV=0,b.EMISSIVEDIRECTUV=0,b.REFLECTIVITYDIRECTUV=0,b.MICROSURFACEMAPDIRECTUV=0,b.METALLIC_REFLECTANCEDIRECTUV=0,b.REFLECTANCEDIRECTUV=0,b.BUMPDIRECTUV=0,b.LIGHTMAPDIRECTUV=0,V.getCaps().textureLOD&&(b.LODBASEDMICROSFURACE=!0),this._albedoTexture&&P.c.DiffuseTextureEnabled?((0,n.N)(this._albedoTexture,b,"ALBEDO"),b.GAMMAALBEDO=this._albedoTexture.gammaSpace):b.ALBEDO=!1,this._ambientTexture&&P.c.AmbientTextureEnabled?((0,n.N)(this._ambientTexture,b,"AMBIENT"),b.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):b.AMBIENT=!1,this._opacityTexture&&P.c.OpacityTextureEnabled?((0,n.N)(this._opacityTexture,b,"OPACITY"),b.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):b.OPACITY=!1;const E=this._getReflectionTexture();if(E&&P.c.ReflectionTextureEnabled){switch(b.REFLECTION=!0,b.GAMMAREFLECTION=E.gammaSpace,b.RGBDREFLECTION=E.isRGBD,b.LODINREFLECTIONALPHA=E.lodLevelInAlpha,b.LINEARSPECULARREFLECTION=E.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(b.NUM_SAMPLES=""+this.realTimeFilteringQuality,V._features.needTypeSuffixInShaderConstants&&(b.NUM_SAMPLES=b.NUM_SAMPLES+"u"),b.REALTIME_FILTERING=!0):b.REALTIME_FILTERING=!1,b.INVERTCUBICMAP=E.coordinatesMode===j.b.INVCUBIC_MODE,b.REFLECTIONMAP_3D=E.isCube,b.REFLECTIONMAP_OPPOSITEZ=b.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!E.invertZ:E.invertZ,b.REFLECTIONMAP_CUBIC=!1,b.REFLECTIONMAP_EXPLICIT=!1,b.REFLECTIONMAP_PLANAR=!1,b.REFLECTIONMAP_PROJECTION=!1,b.REFLECTIONMAP_SKYBOX=!1,b.REFLECTIONMAP_SPHERICAL=!1,b.REFLECTIONMAP_EQUIRECTANGULAR=!1,b.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,b.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,E.coordinatesMode){case j.b.EXPLICIT_MODE:b.REFLECTIONMAP_EXPLICIT=!0;break;case j.b.PLANAR_MODE:b.REFLECTIONMAP_PLANAR=!0;break;case j.b.PROJECTION_MODE:b.REFLECTIONMAP_PROJECTION=!0;break;case j.b.SKYBOX_MODE:b.REFLECTIONMAP_SKYBOX=!0;break;case j.b.SPHERICAL_MODE:b.REFLECTIONMAP_SPHERICAL=!0;break;case j.b.EQUIRECTANGULAR_MODE:b.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case j.b.FIXED_EQUIRECTANGULAR_MODE:b.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case j.b.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:b.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case j.b.CUBIC_MODE:case j.b.INVCUBIC_MODE:default:b.REFLECTIONMAP_CUBIC=!0,b.USE_LOCAL_REFLECTIONMAP_CUBIC=!!E.boundingBoxSize}E.coordinatesMode!==j.b.SKYBOX_MODE&&(E.irradianceTexture?(b.USEIRRADIANCEMAP=!0,b.USESPHERICALFROMREFLECTIONMAP=!1):E.isCube&&(b.USESPHERICALFROMREFLECTIONMAP=!0,b.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||V.getCaps().maxVaryingVectors<=8?b.USESPHERICALINVERTEX=!1:b.USESPHERICALINVERTEX=!0))}else b.REFLECTION=!1,b.REFLECTIONMAP_3D=!1,b.REFLECTIONMAP_SPHERICAL=!1,b.REFLECTIONMAP_PLANAR=!1,b.REFLECTIONMAP_CUBIC=!1,b.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,b.REFLECTIONMAP_PROJECTION=!1,b.REFLECTIONMAP_SKYBOX=!1,b.REFLECTIONMAP_EXPLICIT=!1,b.REFLECTIONMAP_EQUIRECTANGULAR=!1,b.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,b.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,b.INVERTCUBICMAP=!1,b.USESPHERICALFROMREFLECTIONMAP=!1,b.USEIRRADIANCEMAP=!1,b.USESPHERICALINVERTEX=!1,b.REFLECTIONMAP_OPPOSITEZ=!1,b.LODINREFLECTIONALPHA=!1,b.GAMMAREFLECTION=!1,b.RGBDREFLECTION=!1,b.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&P.c.LightmapTextureEnabled?((0,n.N)(this._lightmapTexture,b,"LIGHTMAP"),b.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,b.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,b.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):b.LIGHTMAP=!1,this._emissiveTexture&&P.c.EmissiveTextureEnabled?((0,n.N)(this._emissiveTexture,b,"EMISSIVE"),b.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):b.EMISSIVE=!1,P.c.SpecularTextureEnabled?(this._metallicTexture?((0,n.N)(this._metallicTexture,b,"REFLECTIVITY"),b.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,b.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,b.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,b.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,b.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,n.N)(this._reflectivityTexture,b,"REFLECTIVITY"),b.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,b.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,b.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):b.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(b.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,n.N)(this._metallicReflectanceTexture,b,"METALLIC_REFLECTANCE"),b.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):b.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,n.N)(this._reflectanceTexture,b,"REFLECTANCE"),b.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):b.REFLECTANCE=!1):(b.METALLIC_REFLECTANCE=!1,b.REFLECTANCE=!1),this._microSurfaceTexture?(0,n.N)(this._microSurfaceTexture,b,"MICROSURFACEMAP"):b.MICROSURFACEMAP=!1):(b.REFLECTIVITY=!1,b.MICROSURFACEMAP=!1),V.getCaps().standardDerivatives&&this._bumpTexture&&P.c.BumpTextureEnabled&&!this._disableBumpMap?((0,n.N)(this._bumpTexture,b,"BUMP"),this._useParallax&&this._albedoTexture&&P.c.DiffuseTextureEnabled?(b.PARALLAX=!0,b.PARALLAX_RHS=G.useRightHandedSystem,b.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):b.PARALLAX=!1,b.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(b.BUMP=!1,b.PARALLAX=!1,b.PARALLAX_RHS=!1,b.PARALLAXOCCLUSION=!1,b.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&P.c.ReflectionTextureEnabled?(b.ENVIRONMENTBRDF=!0,b.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(b.ENVIRONMENTBRDF=!1,b.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?b.ALPHAFROMALBEDO=!0:b.ALPHAFROMALBEDO=!1}b.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===K.LIGHTFALLOFF_STANDARD?(b.USEPHYSICALLIGHTFALLOFF=!1,b.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===K.LIGHTFALLOFF_GLTF?(b.USEPHYSICALLIGHTFALLOFF=!1,b.USEGLTFLIGHTFALLOFF=!0):(b.USEPHYSICALLIGHTFALLOFF=!0,b.USEGLTFLIGHTFALLOFF=!1),b.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.xh&&this._twoSidedLighting?b.TWOSIDEDLIGHTING=!0:b.TWOSIDEDLIGHTING=!1,b.SPECULARAA=V.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(b._areTexturesDirty||b._areMiscDirty)&&(b.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,b.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,b.ALPHABLEND=this.needAlphaBlendingForMesh(E),b.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,b.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),b._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(b),b.FORCENORMALFORWARD=this._forceNormalForward,b.RADIANCEOCCLUSION=this._useRadianceOcclusion,b.HORIZONOCCLUSION=this._useHorizonOcclusion,b._areMiscDirty&&((0,n.R)(E,G,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(E)||this._forceAlphaTest,b,this._applyDecalMapAfterDetailMap),b.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!E.isVerticesDataPresent(s.g.NormalKind),b.DEBUGMODE=this._debugMode),(0,n.J)(G,V,this,b,!!h,a,k),this._eventInfo.defines=b,this._eventInfo.mesh=E,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,n.H)(E,b,!0,!0,!0,this._transparencyMode!==K.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(E,b,h){const a={clipPlane:!1,useInstances:!1,...h};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const h=new m(this._eventInfo.defineNames),k=this._prepareEffect(E,h,void 0,void 0,a.useInstances,a.clipPlane,E.hasThinInstances);this._onEffectCreatedObservable&&(J.effect=k,J.subMesh=null,this._onEffectCreatedObservable.notifyObservers(J)),k.isReady()?b&&b(this):k.onCompileObservable.add((()=>{b&&b(this)}))})()}buildUniformLayout(){const E=this._uniformBuffer;E.addUniform("vAlbedoInfos",2),E.addUniform("vAmbientInfos",4),E.addUniform("vOpacityInfos",2),E.addUniform("vEmissiveInfos",2),E.addUniform("vLightmapInfos",2),E.addUniform("vReflectivityInfos",3),E.addUniform("vMicroSurfaceSamplerInfos",2),E.addUniform("vReflectionInfos",2),E.addUniform("vReflectionFilteringInfo",2),E.addUniform("vReflectionPosition",3),E.addUniform("vReflectionSize",3),E.addUniform("vBumpInfos",3),E.addUniform("albedoMatrix",16),E.addUniform("ambientMatrix",16),E.addUniform("opacityMatrix",16),E.addUniform("emissiveMatrix",16),E.addUniform("lightmapMatrix",16),E.addUniform("reflectivityMatrix",16),E.addUniform("microSurfaceSamplerMatrix",16),E.addUniform("bumpMatrix",16),E.addUniform("vTangentSpaceParams",2),E.addUniform("reflectionMatrix",16),E.addUniform("vReflectionColor",3),E.addUniform("vAlbedoColor",4),E.addUniform("vLightingIntensity",4),E.addUniform("vReflectionMicrosurfaceInfos",3),E.addUniform("pointSize",1),E.addUniform("vReflectivityColor",4),E.addUniform("vEmissiveColor",3),E.addUniform("vAmbientColor",3),E.addUniform("vDebugMode",2),E.addUniform("vMetallicReflectanceFactors",4),E.addUniform("vMetallicReflectanceInfos",2),E.addUniform("metallicReflectanceMatrix",16),E.addUniform("vReflectanceInfos",2),E.addUniform("reflectanceMatrix",16),E.addUniform("vSphericalL00",3),E.addUniform("vSphericalL1_1",3),E.addUniform("vSphericalL10",3),E.addUniform("vSphericalL11",3),E.addUniform("vSphericalL2_2",3),E.addUniform("vSphericalL2_1",3),E.addUniform("vSphericalL20",3),E.addUniform("vSphericalL21",3),E.addUniform("vSphericalL22",3),E.addUniform("vSphericalX",3),E.addUniform("vSphericalY",3),E.addUniform("vSphericalZ",3),E.addUniform("vSphericalXX_ZZ",3),E.addUniform("vSphericalYY_ZZ",3),E.addUniform("vSphericalZZ",3),E.addUniform("vSphericalXY",3),E.addUniform("vSphericalYZ",3),E.addUniform("vSphericalZX",3),super.buildUniformLayout()}bindForSubMesh(E,b,h){const a=this.va(),k=h.materialDefines;if(!k)return;const G=h.effect;if(!G)return;this._activeEffect=G,b.getMeshUniformBuffer().bindToEffect(G,"Mesh"),b.transferToEffect(E);const V=a.getEngine();this._uniformBuffer.bindToEffect(G,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,a,b,E,this.isFrozen),e.d.Bind(V.currentRenderPassId,this._activeEffect,b,E),this._eventInfo.subMesh=h,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),k.OBJECTSPACE_NORMALMAP&&(E.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const l=this._mustRebind(a,G,h,b.visibility);(0,n.e)(b,this._activeEffect,this.prePassConfiguration);let v=null;const s=this._uniformBuffer;if(l){if(this.bindViewProjection(G),v=this._getReflectionTexture(),!s.useUbo||!this.isFrozen||!s.isSync||h._drawWrapper._forceRebindOnNextCall){var U;if(a.texturesEnabled){if(this._albedoTexture&&P.c.DiffuseTextureEnabled&&(s.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,n.t)(this._albedoTexture,s,"albedo")),this._ambientTexture&&P.c.AmbientTextureEnabled&&(s.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,n.t)(this._ambientTexture,s,"ambient")),this._opacityTexture&&P.c.OpacityTextureEnabled&&(s.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,n.t)(this._opacityTexture,s,"opacity")),v&&P.c.ReflectionTextureEnabled){if(s.Pj("reflectionMatrix",v.getReflectionTextureMatrix()),s.updateFloat2("vReflectionInfos",v.level,0),v.boundingBoxSize){const E=v;s.updateVector3("vReflectionPosition",E.boundingBoxPosition),s.updateVector3("vReflectionSize",E.boundingBoxSize)}if(this.realTimeFiltering){const E=v.getSize().width;s.updateFloat2("vReflectionFilteringInfo",E,Math.log2(E))}if(!k.USEIRRADIANCEMAP){const E=v.sphericalPolynomial;if(k.USESPHERICALFROMREFLECTIONMAP&&E)if(k.SPHERICAL_HARMONICS){const b=E.preScaledHarmonics;s.updateVector3("vSphericalL00",b.l00),s.updateVector3("vSphericalL1_1",b.l1_1),s.updateVector3("vSphericalL10",b.l10),s.updateVector3("vSphericalL11",b.l11),s.updateVector3("vSphericalL2_2",b.l2_2),s.updateVector3("vSphericalL2_1",b.l2_1),s.updateVector3("vSphericalL20",b.l20),s.updateVector3("vSphericalL21",b.l21),s.updateVector3("vSphericalL22",b.l22)}else s.updateFloat3("vSphericalX",E.x.x,E.x.y,E.x.z),s.updateFloat3("vSphericalY",E.y.x,E.y.y,E.y.z),s.updateFloat3("vSphericalZ",E.z.x,E.z.y,E.z.z),s.updateFloat3("vSphericalXX_ZZ",E.xx.x-E.zz.x,E.xx.y-E.zz.y,E.xx.z-E.zz.z),s.updateFloat3("vSphericalYY_ZZ",E.yy.x-E.zz.x,E.yy.y-E.zz.y,E.yy.z-E.zz.z),s.updateFloat3("vSphericalZZ",E.zz.x,E.zz.y,E.zz.z),s.updateFloat3("vSphericalXY",E.xy.x,E.xy.y,E.xy.z),s.updateFloat3("vSphericalYZ",E.yz.x,E.yz.y,E.yz.z),s.updateFloat3("vSphericalZX",E.zx.x,E.zx.y,E.zx.z)}s.updateFloat3("vReflectionMicrosurfaceInfos",v.getSize().width,v.lodGenerationScale,v.lodGenerationOffset)}this._emissiveTexture&&P.c.EmissiveTextureEnabled&&(s.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,n.t)(this._emissiveTexture,s,"emissive")),this._lightmapTexture&&P.c.LightmapTextureEnabled&&(s.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,n.t)(this._lightmapTexture,s,"lightmap")),P.c.SpecularTextureEnabled&&(this._metallicTexture?(s.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,n.t)(this._metallicTexture,s,"reflectivity")):this._reflectivityTexture&&(s.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,n.t)(this._reflectivityTexture,s,"reflectivity")),this._metallicReflectanceTexture&&(s.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,n.t)(this._metallicReflectanceTexture,s,"metallicReflectance")),this._reflectanceTexture&&k.REFLECTANCE&&(s.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,n.t)(this._reflectanceTexture,s,"reflectance")),this._microSurfaceTexture&&(s.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,n.t)(this._microSurfaceTexture,s,"microSurfaceSampler"))),this._bumpTexture&&V.getCaps().standardDerivatives&&P.c.BumpTextureEnabled&&!this._disableBumpMap&&(s.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,n.t)(this._bumpTexture,s,"bump"),a._mirroredCameraPosition?s.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):s.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&s.updateFloat("pointSize",this.pointSize),k.METALLICWORKFLOW){var B;g.j.gb[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,g.j.gb[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,s.updateColor4("vReflectivityColor",g.j.gb[0],1);const E=(null===(B=this.subSurface)||void 0===B?void 0:B._indexOfRefraction)??1.5,b=1,h=Math.pow((E-b)/(E+b),2);this._metallicReflectanceColor.scaleToRef(h*this._metallicF0Factor,g.j.gb[0]);const a=this._metallicF0Factor;s.updateColor4("vMetallicReflectanceFactors",g.j.gb[0],a)}else s.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);s.updateColor3("vEmissiveColor",P.c.EmissiveTextureEnabled?this._emissiveColor:g.b.BlackReadOnly),s.updateColor3("vReflectionColor",this._reflectionColor),!k.SS_REFRACTION&&null!==(U=this.subSurface)&&void 0!==U&&U._linkRefractionWithTransparency?s.updateColor4("vAlbedoColor",this._albedoColor,1):s.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*a.environmentIntensity,this._lightingInfos.w=this._specularIntensity,s.updateVector4("vLightingIntensity",this._lightingInfos),a.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),s.updateColor3("vAmbientColor",this._globalAmbientColor),s.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}a.texturesEnabled&&(this._albedoTexture&&P.c.DiffuseTextureEnabled&&s.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&P.c.AmbientTextureEnabled&&s.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&P.c.OpacityTextureEnabled&&s.setTexture("opacitySampler",this._opacityTexture),v&&P.c.ReflectionTextureEnabled&&(k.LODBASEDMICROSFURACE?s.setTexture("reflectionSampler",v):(s.setTexture("reflectionSampler",v._lodTextureMid||v),s.setTexture("reflectionSamplerLow",v._lodTextureLow||v),s.setTexture("reflectionSamplerHigh",v._lodTextureHigh||v)),k.USEIRRADIANCEMAP&&s.setTexture("irradianceSampler",v.irradianceTexture)),k.ENVIRONMENTBRDF&&s.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&P.c.EmissiveTextureEnabled&&s.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&P.c.LightmapTextureEnabled&&s.setTexture("lightmapSampler",this._lightmapTexture),P.c.SpecularTextureEnabled&&(this._metallicTexture?s.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&s.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&s.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&k.REFLECTANCE&&s.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&s.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&V.getCaps().standardDerivatives&&P.c.BumpTextureEnabled&&!this._disableBumpMap&&s.setTexture("bumpSampler",this._bumpTexture)),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(b)&&this.va().depthPeelingRenderer.bind(G),this._eventInfo.subMesh=h,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,y.f)(this._activeEffect,this,a),this.bindEyePosition(G)}else a.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(l||!this.isFrozen){var o;if(a.lightsEnabled&&!this._disableLighting&&(0,n.i)(a,b,this._activeEffect,k,this._maxSimultaneousLights),(a.fogEnabled&&b.applyFog&&a.fogMode!==O.e.FOGMODE_NONE||v||this.subSurface.refractionTexture||b.receiveShadows||k.PREPASS)&&this.bindView(G),(0,n.f)(a,b,this._activeEffect,!0),k.NUM_MORPH_INFLUENCERS&&(0,n.n)(b,this._activeEffect),k.BAKED_VERTEX_ANIMATION_TEXTURE)null===(o=b.bakedVertexAnimationManager)||void 0===o||o.bind(G,k.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,n.m)(k,this._activeEffect,a)}this._afterBind(b,this._activeEffect,h),s.update()}getAnimatables(){const E=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&E.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&E.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&E.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&E.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&E.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?E.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&E.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&E.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&E.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&E.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&E.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&E.push(this._microSurfaceTexture),E}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.va().environmentTexture}getActiveTextures(){const E=super.getActiveTextures();return this._albedoTexture&&E.push(this._albedoTexture),this._ambientTexture&&E.push(this._ambientTexture),this._opacityTexture&&E.push(this._opacityTexture),this._reflectionTexture&&E.push(this._reflectionTexture),this._emissiveTexture&&E.push(this._emissiveTexture),this._reflectivityTexture&&E.push(this._reflectivityTexture),this._metallicTexture&&E.push(this._metallicTexture),this._metallicReflectanceTexture&&E.push(this._metallicReflectanceTexture),this._reflectanceTexture&&E.push(this._reflectanceTexture),this._microSurfaceTexture&&E.push(this._microSurfaceTexture),this._bumpTexture&&E.push(this._bumpTexture),this._lightmapTexture&&E.push(this._lightmapTexture),E}hasTexture(E){return!!super.hasTexture(E)||(this._albedoTexture===E||(this._ambientTexture===E||(this._opacityTexture===E||(this._reflectionTexture===E||(this._emissiveTexture===E||(this._reflectivityTexture===E||(this._metallicTexture===E||(this._metallicReflectanceTexture===E||(this._reflectanceTexture===E||(this._microSurfaceTexture===E||(this._bumpTexture===E||this._lightmapTexture===E)))))))))))}setPrePassRenderer(){var E;if(null===(E=this.subSurface)||void 0===E||!E.isScatteringEnabled)return!1;const b=this.va().enableSubSurfaceForPrePass();return b&&(b.enabled=!0),!0}dispose(E,b){var h,a,k,G,V,l,O,v,s,U,B,o;(this._breakShaderLoadedCheck=!0,b)&&(this._environmentBRDFTexture&&this.va().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(h=this._albedoTexture)||void 0===h||h.dispose(),null===(a=this._ambientTexture)||void 0===a||a.dispose(),null===(k=this._opacityTexture)||void 0===k||k.dispose(),null===(G=this._reflectionTexture)||void 0===G||G.dispose(),null===(V=this._emissiveTexture)||void 0===V||V.dispose(),null===(l=this._metallicTexture)||void 0===l||l.dispose(),null===(O=this._reflectivityTexture)||void 0===O||O.dispose(),null===(v=this._bumpTexture)||void 0===v||v.dispose(),null===(s=this._lightmapTexture)||void 0===s||s.dispose(),null===(U=this._metallicReflectanceTexture)||void 0===U||U.dispose(),null===(B=this._reflectanceTexture)||void 0===B||B.dispose(),null===(o=this._microSurfaceTexture)||void 0===o||o.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(E,b)}}K.PBRMATERIAL_OPAQUE=M.c.MATERIAL_OPAQUE,K.PBRMATERIAL_ALPHATEST=M.c.MATERIAL_ALPHATEST,K.PBRMATERIAL_ALPHABLEND=M.c.MATERIAL_ALPHABLEND,K.PBRMATERIAL_ALPHATESTANDBLEND=M.c.MATERIAL_ALPHATESTANDBLEND,K.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,K.LIGHTFALLOFF_PHYSICAL=0,K.LIGHTFALLOFF_GLTF=1,K.LIGHTFALLOFF_STANDARD=2,K.ForceGLSL=!1,(0,a.d)([(0,k.q)()],K.prototype,"_imageProcessingConfiguration",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsMiscDirty")],K.prototype,"debugMode",void 0)},10947:(E,b,h)=>{"use strict";h.d(b,{d:()=>V});var a=h(10834);const k=new Map;function G(E,b){(function(E){return k.delete(E)})(E)&&a.c.Warn(`Extension with the name '${name}' already exists`),k.set(E,b)}function V(E,b){"image/ktx"!==b&&"image/ktx2"!==b||(E=".ktx"),k.has(E)||(E.endsWith(".dds")&&G(".dds",(()=>h.e(12).then(h.bind(h,12833)).then((E=>new E._DDSTextureLoader)))),E.endsWith(".basis")&&G(".basis",(()=>h.e(13).then(h.bind(h,12835)).then((E=>new E._BasisTextureLoader)))),E.endsWith(".env")&&G(".env",(()=>h.e(14).then(h.bind(h,12838)).then((E=>new E._ENVTextureLoader)))),E.endsWith(".hdr")&&G(".hdr",(()=>h.e(15).then(h.bind(h,12847)).then((E=>new E._HDRTextureLoader)))),(E.endsWith(".ktx")||E.endsWith(".ktx2"))&&(G(".ktx",(()=>h.e(16).then(h.bind(h,12849)).then((E=>new E._KTXTextureLoader)))),G(".ktx2",(()=>h.e(16).then(h.bind(h,12849)).then((E=>new E._KTXTextureLoader))))),E.endsWith(".tga")&&G(".tga",(()=>h.e(17).then(h.bind(h,12857)).then((E=>new E._TGATextureLoader)))),E.endsWith(".exr")&&G(".exr",(()=>h.e(18).then(h.bind(h,12859)).then((E=>new E._ExrTextureLoader)))));const a=k.get(E);return a?Promise.resolve(a(b)):null}},11381:(E,b,h)=>{"use strict";h.d(b,{e:()=>B});var a=h(11130),k=h(11139),G=h(10824),V=h(11175),l=h(10869),O=h(10966),v=(h(10878),h(11383));class s{get wrapU(){return this._wrapU}set wrapU(E){this._wrapU=E}get wrapV(){return this._wrapV}set wrapV(E){this._wrapV=E}get coordinatesMode(){return 0}get isCube(){return!!this._texture&&this._texture.isCube}set isCube(E){this._texture&&(this._texture.isCube=E)}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(E){this._texture&&(this._texture.is3D=E)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(E){this._texture&&(this._texture.is2DArray=E)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(E){return void 0!==(null===E||void 0===E?void 0:E.shareDepth)}constructor(E){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=v.c.Zero(),this._cachedBaseSize=v.c.Zero(),this._initialSamplingMode=2,this._texture=s._IsRenderTargetWrapper(E)?E.texture:E,this._texture&&(this._engine=this._texture.getEngine())}isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(E){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(E,this._texture)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}var U=h(11206);class B extends s{set Ie(E){this._hasAlpha!==E&&(this._hasAlpha=E,this._scene&&this._scene.markAllMaterialsAsDirty(1,(E=>E.hasTexture(this))))}get Ie(){return this._hasAlpha}set getAlphaFromRGB(E){this._getAlphaFromRGB!==E&&(this._getAlphaFromRGB=E,this._scene&&this._scene.markAllMaterialsAsDirty(1,(E=>E.hasTexture(this))))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(E){this._coordinatesIndex!==E&&(this._coordinatesIndex=E,this._scene&&this._scene.markAllMaterialsAsDirty(1,(E=>E.hasTexture(this))))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(E){this._coordinatesMode!==E&&(this._coordinatesMode=E,this._scene&&this._scene.markAllMaterialsAsDirty(1,(E=>E.hasTexture(this))))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(E){this._wrapU=E}get wrapV(){return this._wrapV}set wrapV(E){this._wrapV=E}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(E){this._texture?this._texture.isCube=E:this._isCube=E}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(E){this._texture&&(this._texture.is3D=E)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(E){this._texture&&(this._texture.is2DArray=E)}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set gammaSpace(E){var b;if(this._texture){if(this._texture._gammaSpace===E)return;this._texture._gammaSpace=E}else{if(this._gammaSpace===E)return;this._gammaSpace=E}null===(b=this.va())||void 0===b||b.markAllMaterialsAsDirty(1,(E=>E.hasTexture(this)))}get isRGBD(){return null!=this._texture&&this._texture._isRGBD}set isRGBD(E){var b;E!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=E),null===(b=this.va())||void 0===b||b.markAllMaterialsAsDirty(1,(E=>E.hasTexture(this))))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(E){this._texture&&(this._texture._lodGenerationOffset=E)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(E){this._texture&&(this._texture._lodGenerationScale=E)}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}set linearSpecularLOD(E){this._texture&&(this._texture._linearSpecularLOD=E)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(E){this._texture&&(this._texture._irradianceTexture=E)}get uid(){return this._uid||(this._uid=(0,O.e)()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(E){this._onDisposeObserver&&this.rj.remove(this._onDisposeObserver),this._onDisposeObserver=this.rj.add(E)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=B.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.rj=new G.e,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,E?B._IsScene(E)?this._scene=E:this._engine=E:this._scene=l.b.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=b,this._uid=null}va(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return V.d.IdentityReadOnly}getReflectionTextureMatrix(){return V.d.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(E){}get canRescale(){return!1}_getFromCache(E,b,h,a,k,G){const V=this._getEngine();if(!V)return null;const l=V._getUseSRGBBuffer(!!k,b),O=V.getLoadedTexturesCache();for(let v=0;v<O.length;v++){const V=O[v];if((void 0===k||l===V._useSRGBBuffer)&&(void 0===a||a===V.invertY)&&V.url===E&&V.generateMipMaps===!b&&(!h||h===V.samplingMode)&&(void 0===G||G===V.isCube))return V.incrementReferences(),V}return null}_rebuild(){}clone(){return null}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const E=this.va();E&&E.markAllMaterialsAsDirty(1)}readPixels(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],k=arguments.length>4&&void 0!==arguments[4]&&arguments[4],G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Number.MAX_VALUE,O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Number.MAX_VALUE;if(!this._texture)return null;const v=this._getEngine();if(!v)return null;const s=this.getSize();let U=s.width,B=s.height;0!==b&&(U/=Math.pow(2,b),B/=Math.pow(2,b),U=Math.round(U),B=Math.round(B)),l=Math.min(U,l),O=Math.min(B,O);try{return this._texture.isCube?v._readTexturePixels(this._texture,l,O,E,b,h,a,k,G,V):v._readTexturePixels(this._texture,l,O,-1,b,h,a,k,G,V)}catch(o){return null}}_readPixelsSync(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],k=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!this._texture)return null;const G=this.getSize();let V=G.width,l=G.height;const O=this._getEngine();if(!O)return null;0!=b&&(V/=Math.pow(2,b),l/=Math.pow(2,b),V=Math.round(V),l=Math.round(l));try{return this._texture.isCube?O._readTexturePixelsSync(this._texture,V,l,E,b,h,a,k):O._readTexturePixelsSync(this._texture,V,l,-1,b,h,a,k)}catch(v){return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const E=this._scene.textures.indexOf(this);if(E>=0&&this._scene.textures.splice(E,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const E=this._parentContainer.textures.indexOf(this);E>-1&&this._parentContainer.textures.splice(E,1),this._parentContainer=null}}this.rj.notifyObservers(this),this.rj.clear(),this.metadata=null,super.dispose()}serialize(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.name&&!E)return null;const b=U.e.Serialize(this);return U.e.AppendSerializedAnimations(this,b),b}static WhenAllReady(E,b){let h=E.length;if(0!==h)for(let a=0;a<E.length;a++){const k=E[a];if(k.isReady())0===--h&&b();else{const E=k.onLoadObservable;E?E.addOnce((()=>{0===--h&&b()})):0===--h&&b()}}else b()}static _IsScene(E){return"Scene"===E.getClassName()}}B.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,a.d)([(0,k.H)()],B.prototype,"uniqueId",void 0),(0,a.d)([(0,k.H)()],B.prototype,"name",void 0),(0,a.d)([(0,k.H)()],B.prototype,"metadata",void 0),(0,a.d)([(0,k.H)("Ie")],B.prototype,"_hasAlpha",void 0),(0,a.d)([(0,k.H)("getAlphaFromRGB")],B.prototype,"_getAlphaFromRGB",void 0),(0,a.d)([(0,k.H)()],B.prototype,"level",void 0),(0,a.d)([(0,k.H)("coordinatesIndex")],B.prototype,"_coordinatesIndex",void 0),(0,a.d)([(0,k.H)()],B.prototype,"optimizeUVAllocation",void 0),(0,a.d)([(0,k.H)("coordinatesMode")],B.prototype,"_coordinatesMode",void 0),(0,a.d)([(0,k.H)()],B.prototype,"wrapU",null),(0,a.d)([(0,k.H)()],B.prototype,"wrapV",null),(0,a.d)([(0,k.H)()],B.prototype,"wrapR",void 0),(0,a.d)([(0,k.H)()],B.prototype,"anisotropicFilteringLevel",void 0),(0,a.d)([(0,k.H)()],B.prototype,"isCube",null),(0,a.d)([(0,k.H)()],B.prototype,"is3D",null),(0,a.d)([(0,k.H)()],B.prototype,"is2DArray",null),(0,a.d)([(0,k.H)()],B.prototype,"gammaSpace",null),(0,a.d)([(0,k.H)()],B.prototype,"invertZ",void 0),(0,a.d)([(0,k.H)()],B.prototype,"lodLevelInAlpha",void 0),(0,a.d)([(0,k.H)()],B.prototype,"lodGenerationOffset",null),(0,a.d)([(0,k.H)()],B.prototype,"lodGenerationScale",null),(0,a.d)([(0,k.H)()],B.prototype,"linearSpecularLOD",null),(0,a.d)([(0,k.C)()],B.prototype,"irradianceTexture",null),(0,a.d)([(0,k.H)()],B.prototype,"isRenderTarget",void 0)},12166:(E,b,h)=>{"use strict";var a=h(11680),k=h(11381);k.e.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(k.e.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=a.b.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((E=>{this._texture._sphericalPolynomial=E,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(E){this._texture&&(this._texture._sphericalPolynomial=E)},enumerable:!0,configurable:!0})},12200:(E,b,h)=>{"use strict";h.d(b,{b:()=>B});var a=h(11130),k=h(11139),G=h(10821),V=h(11175),l=h(11381),O=h(11376),v=h(10958),s=h(10824),U=h(11206);h(11719);class B extends l.e{set boundingBoxSize(E){if(this._boundingBoxSize&&this._boundingBoxSize.equals(E))return;this._boundingBoxSize=E;const b=this.va();b&&b.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(E){this._rotationY=E,this.setReflectionTextureMatrix(V.d.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(E,b,h){let a="";return E.forEach((E=>a+=E)),new B(a,b,null,h,E)}static CreateFromPrefilteredData(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const k=b.useDelayedTextureLoading;b.useDelayedTextureLoading=!1;const G=new B(E,b,null,!1,null,null,null,void 0,!0,h,a);return b.useDelayedTextureLoading=k,G}constructor(E,b){var h;let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]&&arguments[3],G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,U=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,B=arguments.length>8&&void 0!==arguments[8]&&arguments[8],o=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,u=arguments.length>10&&void 0!==arguments[10]&&arguments[10],D=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,g=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,S=arguments.length>13?arguments[13]:void 0,M=arguments.length>14?arguments[14]:void 0;super(b),this.onLoadObservable=new s.e,this.boundingBoxPosition=V.k.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new V.d,this._buffer=null,this.name=E,this.url=E,this._noMipmap=k,this.Ie=!1,this.isCube=!0,this._textureMatrix=V.d.Identity(),this.coordinatesMode=O.b.CUBIC_MODE;let I=null,j=null;null===a||Array.isArray(a)?(this._noMipmap=k,this._format=U,this._createPolynomials=u,I=a,this._loaderOptions=S,this._useSRGBBuffer=M,this._lodScale=D,this._lodOffset=g):(I=a.extensions??null,this._noMipmap=a.noMipmap??!1,G=a.files??null,j=a.buffer??null,this._format=a.format??5,B=a.prefiltered??!1,o=a.forcedExtension??null,this._createPolynomials=a.createPolynomials??!1,this._lodScale=a.lodScale??.8,this._lodOffset=a.lodOffset??0,this._loaderOptions=a.loaderOptions,this._useSRGBBuffer=a.useSRGBBuffer,l=a.X??null,v=a.onError??null),(E||G)&&this.updateURL(E,o,l,B,v,I,null===(h=this.va())||void 0===h?void 0:h.useDelayedTextureLoading,G,j)}getClassName(){return"CubeTexture"}updateURL(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=E),this.url=E,b&&(this._forcedExtension=b);const v=E.lastIndexOf("."),s=b||(v>-1?E.substring(v).toLowerCase():""),U=0===s.indexOf(".dds"),B=0===s.indexOf(".env"),o=0===s.indexOf(".basis");if(B?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=a,a&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),l)this._files=l;else if(o||B||U||G||(G=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,G){for(let b=0;b<G.length;b++)this._files.push(E+G[b]);this._extensions=G}this._buffer=O,V?(this.delayLoadState=4,this._delayedOnLoad=h,this._delayedOnError=k):this._loadTexture(h,k)}delayLoad(E){4===this.delayLoadState&&(E&&(this._forcedExtension=E),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(E){var b,h;if(E.updateFlag===this._textureMatrix.updateFlag)return;E.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(h=this.va())||void 0===h||h.markAllMaterialsAsDirty(1,(E=>-1!==E.getActiveTextures().indexOf(this))));if(this._textureMatrix=E,null===(b=this.va())||void 0===b||!b.useRightHandedSystem)return;const a=V.h.o[0],k=V.h.Quaternion[0],G=V.h.o[1];this._textureMatrix.decompose(a,k,G),k.z*=-1,k.w*=-1,V.d.ComposeToRef(a,k,G,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var E;return null!==(E=this.va())&&void 0!==E&&E.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=this.va(),a=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const k=()=>{var b;(this.onLoadObservable.notifyObservers(this),a)&&(a.dispose(),null===(b=this.va())||void 0===b||b.markAllMaterialsAsDirty(1));E&&E()},V=(E,h)=>{this._loadingError=!0,this._errorObject={message:E,exception:h},b&&b(E,h),O.b.OnTextureLoadErrorObservable.notifyObservers(this)};var l;this._texture?this._texture.isReady?G.g.SetImmediate((()=>k())):this._texture.onLoadedObservable.add((()=>k())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,h,this._lodScale,this._lodOffset,E,V,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,h,this._files,this._noMipmap,E,V,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(l=this._texture)||void 0===l||l.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(E,b,h){const a=U.e.Parse((()=>{let a=!1;return E.prefiltered&&(a=E.prefiltered),new B(h+(E.url??E.name),b,E.extensions,!1,E.files||null,null,null,void 0,a,E.forcedExtension)}),E,b);if(E.boundingBoxPosition&&(a.boundingBoxPosition=V.k.jh(E.boundingBoxPosition)),E.boundingBoxSize&&(a.boundingBoxSize=V.k.jh(E.boundingBoxSize)),E.animations)for(let k=0;k<E.animations.length;k++){const b=E.animations[k],h=(0,v.d)("BABYLON.Animation");h&&a.animations.push(h.Parse(b))}return a}clone(){let E=0;const b=U.e.Clone((()=>{const b=new B(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return E=b.uniqueId,b}),this);return b.uniqueId=E,b}}(0,a.d)([(0,k.H)()],B.prototype,"url",void 0),(0,a.d)([(0,k.G)()],B.prototype,"boundingBoxPosition",void 0),(0,a.d)([(0,k.G)()],B.prototype,"boundingBoxSize",null),(0,a.d)([(0,k.H)("rotationY")],B.prototype,"rotationY",null),(0,a.d)([(0,k.H)("files")],B.prototype,"_files",void 0),(0,a.d)([(0,k.H)("forcedExtension")],B.prototype,"_forcedExtension",void 0),(0,a.d)([(0,k.H)("extensions")],B.prototype,"_extensions",void 0),(0,a.d)([(0,k.s)("textureMatrix")],B.prototype,"_textureMatrix",void 0),(0,a.d)([(0,k.s)("textureMatrixRefraction")],B.prototype,"_textureMatrixRefraction",void 0),O.b._CubeTextureParser=B.Parse,(0,v.f)("BABYLON.CubeTexture",B)},12588:(E,b,h)=>{"use strict";h.d(b,{b:()=>O});var a=h(10834),k=h(11376),G=h(10968),V=h(11594),l=h(10939);V.ThinEngine.prototype.createDynamicTexture=function(E,b,h,a){const k=new l.b(this,4);return k.baseWidth=E,k.baseHeight=b,h&&(E=this.needPOTTextures?(0,G.f)(E,this._caps.maxTextureSize):E,b=this.needPOTTextures?(0,G.f)(b,this._caps.maxTextureSize):b),k.width=E,k.height=b,k.isReady=!1,k.generateMipMaps=h,k.samplingMode=a,this.updateTextureSamplingMode(a,k),this._internalTexturesCache.push(k),k},V.ThinEngine.prototype.updateDynamicTexture=function(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4?arguments[4]:void 0,G=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!E)return;const V=this._gl,l=V.TEXTURE_2D,O=this._bindTextureDirectly(l,E,!0,G);this._unpackFlipY(void 0===h?E.invertY:h),a&&V.pixelStorei(V.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const v=this._getWebGLTextureType(E.type),s=this._getInternalFormat(k||E.format),U=this._getRGBABufferInternalSizedFormat(E.type,s);V.texImage2D(l,0,U,s,v,b),E.generateMipMaps&&V.generateMipmap(l),O||this._bindTextureDirectly(l,null),a&&V.pixelStorei(V.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),k&&(E.format=k),E._dynamicTextureSource=b,E._premulAlpha=a,E.invertY=h||!1,E.isReady=!0};class O extends k.b{constructor(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,V=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,l=arguments.length>6?arguments[6]:void 0;const O=!h||h._isScene;super(null,O?h:null===h||void 0===h?void 0:h.Xd,O?!a:h,l,G,void 0,void 0,void 0,void 0,V),this.name=E,this.wrapU=k.b.CLAMP_ADDRESSMODE,this.wrapV=k.b.CLAMP_ADDRESSMODE,this._generateMipMaps=a;const v=this._getEngine();if(!v)return;if(b.getContext)this._canvas=b,this._ownCanvas=!1,this._texture=v.createDynamicTexture(this._canvas.width,this._canvas.height,a,G);else{this._canvas=v.createCanvas(1,1),this._ownCanvas=!0;const E=b;E.width||0===E.width?this._texture=v.createDynamicTexture(E.width,E.height,a,G):this._texture=v.createDynamicTexture(b,b,a,G)}const s=this.getSize();this._canvas.width!==s.width&&(this._canvas.width=s.width),this._canvas.height!==s.height&&(this._canvas.height=s.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(E){this._canvas.width=E.width,this._canvas.height=E.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(E.width,E.height,this._generateMipMaps,this.samplingMode)}scale(E){const b=this.getSize();b.width*=E,b.height*=E,this._recreate(b)}scaleTo(E,b){const h=this.getSize();h.width=E,h.height=b,this._recreate(h)}getContext(){return this._context}clear(E){const b=this.getSize();E&&(this._context.fillStyle=E),this._context.clearRect(0,0,b.width,b.height)}update(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===E||E,b,this._format||void 0,void 0,h)}drawText(E,b,h,a,k,G,V){let l=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const O=this.getSize();if(G&&(this._context.fillStyle=G,this._context.fillRect(0,0,O.width,O.height)),this._context.font=a,null===b||void 0===b){const h=this._context.measureText(E);b=(O.width-h.width)/2}if(null===h||void 0===h){const E=parseInt(a.replace(/\D/g,""));h=O.height/2+E/3.65}this._context.fillStyle=k||"",this._context.fillText(E,b,h),l&&this.update(V)}dispose(){var E,b;(super.dispose(),this._ownCanvas)&&(null===(E=this._canvas)||void 0===E||null===(b=E.remove)||void 0===b||b.call(E));this._canvas=null,this._context=null}clone(){const E=this.va();if(!E)return this;const b=this.getSize(),h=new O(this.name,b,E,this._generateMipMaps);return h.Ie=this.Ie,h.level=this.level,h.wrapU=this.wrapU,h.wrapV=this.wrapV,h}serialize(){const E=this.va();E&&!E.isReady()&&a.c.Warn("The scene must be ready before serializing the dynamic texture");const b=super.serialize();return O._IsCanvasElement(this._canvas)&&(b.base64String=this._canvas.toDataURL()),b.invertY=this._invertY,b.samplingMode=this.samplingMode,b}static _IsCanvasElement(E){return void 0!==E.toDataURL}_rebuild(){this.update()}}},10939:(E,b,h)=>{"use strict";h.d(b,{b:()=>V});var a,k=h(10824),G=h(10941);!function(E){E[E.Unknown=0]="Unknown",E[E.Url=1]="Url",E[E.Temp=2]="Temp",E[E.Raw=3]="Raw",E[E.Dynamic=4]="Dynamic",E[E.RenderTarget=5]="RenderTarget",E[E.MultiRenderTarget=6]="MultiRenderTarget",E[E.Cube=7]="Cube",E[E.CubeRaw=8]="CubeRaw",E[E.CubePrefiltered=9]="CubePrefiltered",E[E.Raw3D=10]="Raw3D",E[E.Raw2DArray=11]="Raw2DArray",E[E.DepthStencil=12]="DepthStencil",E[E.CubeRawRGBD=13]="CubeRawRGBD",E[E.Depth=14]="Depth"}(a||(a={}));class V extends G.e{get useMipMaps(){return this.generateMipMaps}set useMipMaps(E){this.generateMipMaps=E}get uniqueId(){return this._uniqueId}_setUniqueId(E){this._uniqueId=E}getEngine(){return this._engine}get source(){return this._source}constructor(E,b){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new k.e,this.onErrorObservable=new k.e,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._engine=E,this._source=b,this._uniqueId=V._Counter++,h||(this._hardwareTexture=E._createHardwareTexture())}incrementReferences(){this._references++}updateSize(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._engine.updateTextureDimensions(this,E,b,h),this.width=E,this.height=b,this.depth=h,this.baseWidth=E,this.baseHeight=b,this.baseDepth=h,this._size=E*b*h}_rebuild(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const E=this.onRebuildCallback(this),b=b=>{b._swapAndDie(this,!1),this.isReady=E.isReady};return void(E.isAsync?E.proxy.then(b):b(E.proxy))}let E;switch(this.source){case 2:case 12:case 14:break;case 1:return void(E=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(E=>{E._swapAndDie(this,!1),this.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case 3:E=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),E._swapAndDie(this,!1),this.isReady=!0;break;case 10:E=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),E._swapAndDie(this,!1),this.isReady=!0;break;case 11:E=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),E._swapAndDie(this,!1),this.isReady=!0;break;case 4:E=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),E._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:return void(E=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(()=>{E._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null));case 8:E=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),E._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:return E=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(E=>{E&&E._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension),void(E._sphericalPolynomial=this._sphericalPolynomial)}}_swapAndDie(E){var b;let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null===(b=this._hardwareTexture)||void 0===b||b.setUsage(E._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),E._hardwareTexture=this._hardwareTexture,h&&(E._isRGBD=this._isRGBD),this._lodTextureHigh&&(E._lodTextureHigh&&E._lodTextureHigh.dispose(),E._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(E._lodTextureMid&&E._lodTextureMid.dispose(),E._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(E._lodTextureLow&&E._lodTextureLow.dispose(),E._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(E._irradianceTexture&&E._irradianceTexture.dispose(),E._irradianceTexture=this._irradianceTexture);const a=this._engine.getLoadedTexturesCache();let k=a.indexOf(this);-1!==k&&a.splice(k,1),k=a.indexOf(E),-1===k&&a.push(E)}dispose(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),0===this._references&&(this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}}V._Counter=0},11622:(E,b,h)=>{"use strict";h.d(b,{d:()=>k});var a=h(11376);class k extends a.b{constructor(E,b,h,k,G){let V=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,v=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,s=arguments.length>9?arguments[9]:void 0,U=arguments.length>10?arguments[10]:void 0;super(null,G,!V,l,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,s),this.format=k,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==v||(O=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==v||(O=1),this._texture=this._engine.createRawTexture(E,b,h,k,V,l,O,null,v,s??0,U??!1),this.wrapU=a.b.CLAMP_ADDRESSMODE,this.wrapV=a.b.CLAMP_ADDRESSMODE)}update(E){this._getEngine().updateRawTexture(this._texture,E,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)}clone(){if(!this._texture)return super.clone();const E=new k(null,this.getSize().width,this.getSize().height,this.format,this.va(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return E._texture=this._texture,this._texture.incrementReferences(),E}static CreateLuminanceTexture(E,b,h,a){return new k(E,b,h,1,a,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(E,b,h,a){return new k(E,b,h,2,a,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(E,b,h,a){return new k(E,b,h,0,a,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(E,b,h,a){return new k(E,b,h,4,a,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(E,b,h,a){return new k(E,b,h,5,a,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBAStorageTexture(E,b,h,a){return new k(E,b,h,5,a,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(E,b,h,G){let V=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],l=arguments.length>5&&void 0!==arguments[5]&&arguments[5],O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:a.b.TRILINEAR_SAMPLINGMODE;return new k(E,b,h,6,G,V,l,O,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(E,b,h,G){let V=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],l=arguments.length>5&&void 0!==arguments[5]&&arguments[5],O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:a.b.TRILINEAR_SAMPLINGMODE;return new k(E,b,h,6,G,V,l,O,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},12032:(E,b,h)=>{"use strict";h.d(b,{b:()=>k});var a=h(11376);class k extends a.b{get depth(){return this._depth}constructor(E,b,h,k,G,V){let l=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],O=arguments.length>7&&void 0!==arguments[7]&&arguments[7],v=arguments.length>8&&void 0!==arguments[8]?arguments[8]:a.b.TRILINEAR_SAMPLINGMODE,s=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,U=arguments.length>10?arguments[10]:void 0;super(null,V,!l,O),this.format=G,this._texture=V.getEngine().createRawTexture2DArray(E,b,h,k,G,l,O,v,null,s,U),this._depth=k,this.is2DArray=!0}update(E){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,E,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(E,b,h,a,G){return new k(E,b,h,a,5,G,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},11690:(E,b,h)=>{"use strict";h.d(b,{c:()=>B});var a=h(10824),k=h(11175),G=h(11376),V=h(11247),l=h(11254),O=h(11183),v=h(10968),s=h(10905),U=h(10834);s.b.prototype.setDepthStencilTexture=function(E,b){this._engine.setDepthStencilTexture(this._samplers[E],this._uniforms[E],b,E)};class B extends G.b{get renderList(){return this._renderList}set renderList(E){this._renderList!==E&&(this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),E&&(this._unObserveRenderList=(0,O.i)(E,this._renderListHasChanged)),this._renderList=E)}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(E){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(E)}set onBeforeRender(E){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(E)}set onAfterRender(E){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(E)}set onClear(E){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(E)}get renderPassIds(){return this._renderPassIds}get currentRefreshId(){return this._currentRefreshId}setMaterialForRendering(E,b){let h;h=Array.isArray(E)?E:[E];for(let a=0;a<h.length;++a)for(let E=0;E<this._renderPassIds.length;++E)h[a].setMaterialForRenderPass(this._renderPassIds[E],void 0!==b?Array.isArray(b)?b[E]:b:void 0)}get isMulti(){var E;return(null===(E=this._renderTarget)||void 0===E?void 0:E.isMulti)??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(E){if(this._boundingBoxSize&&this._boundingBoxSize.equals(E))return;this._boundingBoxSize=E;const b=this.va();b&&b.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){var E;return(null===(E=this._renderTarget)||void 0===E?void 0:E._depthStencilTexture)??null}constructor(E,b,h){let V,O=arguments.length>3&&void 0!==arguments[3]&&arguments[3],v=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,U=arguments.length>6&&void 0!==arguments[6]&&arguments[6],B=arguments.length>7&&void 0!==arguments[7]?arguments[7]:G.b.TRILINEAR_SAMPLINGMODE,o=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],u=arguments.length>9&&void 0!==arguments[9]&&arguments[9],D=arguments.length>10&&void 0!==arguments[10]&&arguments[10],g=arguments.length>11&&void 0!==arguments[11]?arguments[11]:5,S=arguments.length>12&&void 0!==arguments[12]&&arguments[12],M=arguments.length>13?arguments[13]:void 0,I=arguments.length>14?arguments[14]:void 0,j=arguments.length>15&&void 0!==arguments[15]&&arguments[15],P=arguments.length>16&&void 0!==arguments[16]&&arguments[16],A=!0;if("object"===typeof O){const E=O;O=!!E.generateMipMaps,v=E.doNotChangeAspectRatio??!0,s=E.type??0,U=!!E.isCube,B=E.samplingMode??G.b.TRILINEAR_SAMPLINGMODE,o=E.generateDepthBuffer??!0,u=!!E.generateStencilBuffer,D=!!E.isMulti,g=E.format??5,S=!!E.delayAllocation,M=E.samples,I=E.creationFlags,j=!!E.noColorAttachment,P=!!E.useSRGBBuffer,V=E.colorAttachment,A=E.gammaSpace??A}if(super(null,h,!O,void 0,B,void 0,void 0,void 0,void 0,g),this._unObserveRenderList=null,this._renderListHasChanged=(E,b)=>{const h=this._renderList?this._renderList.length:0;var a;(0===b&&h>0||0===h)&&(null===(a=this.va())||void 0===a||a.meshes.forEach((E=>{E._markSubMeshesAsLightDirty()})))},this.particleSystemList=null,this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new a.e,this.onAfterUnbindObservable=new a.e,this.onBeforeRenderObservable=new a.e,this.onAfterRenderObservable=new a.e,this.onClearObservable=new a.e,this.onResizeObservable=new a.e,this._cleared=!1,this.skipInitialClear=!1,this._currentRefreshId=-1,this._refreshRate=1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this.boundingBoxPosition=k.k.Zero(),this._dumpToolsLoading=!1,!(h=this.va()))return;const n=this.va().getEngine();this._gammaSpace=A,this._coordinatesMode=G.b.PROJECTION_MODE,this.renderList=[],this.name=E,this.isRenderTarget=!0,this._initialSizeParameter=b,this._renderPassIds=[],this._isCubeData=U,this._processSizeParameter(b),this.renderPassId=this._renderPassIds[0],this._resizeObserver=n.onResizeObservable.add((()=>{})),this._generateMipMaps=!!O,this._doNotChangeAspectRatio=v,this._renderingManager=new l.b(h),this._renderingManager._useSceneAutoClearSetup=!0,D||(this._renderTargetOptions={generateMipMaps:O,type:s,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:o,generateStencilBuffer:u,samples:M,creationFlags:I,noColorAttachment:j,useSRGBBuffer:P,colorAttachment:V,label:this.name},this.samplingMode===G.b.NEAREST_SAMPLINGMODE&&(this.wrapU=G.b.CLAMP_ADDRESSMODE,this.wrapV=G.b.CLAMP_ADDRESSMODE),S||(U?(this._renderTarget=h.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=G.b.INVCUBIC_MODE,this._textureMatrix=k.d.Identity()):this._renderTarget=h.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==M&&(this.samples=M)))}createDepthStencilTexture(){var E;let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,V=arguments.length>5?arguments[5]:void 0;null===(E=this._renderTarget)||void 0===E||E.createDepthStencilTexture(b,h,a,k,G,V)}_releaseRenderPassId(){if(this._scene){const E=this._scene.getEngine();for(let b=0;b<this._renderPassIds.length;++b)E.releaseRenderPassId(this._renderPassIds[b])}this._renderPassIds=[]}_createRenderPassId(){this._releaseRenderPassId();const E=this._scene.getEngine(),b=this._isCubeData?6:this.getRenderLayers()||1;for(let h=0;h<b;++h)this._renderPassIds[h]=E.createRenderPassId(`RenderTargetTexture - ${this.name}#${h}`)}_processSizeParameter(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(E.ratio){this._sizeRatio=E.ratio;const b=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(b.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(b.getRenderHeight(),this._sizeRatio)}}else this._size=E;b&&this._createRenderPassId()}get samples(){var E;return(null===(E=this._renderTarget)||void 0===E?void 0:E.samples)??this._samples}set samples(E){this._renderTarget&&(this._samples=this._renderTarget.setSamples(E))}resetRefreshCounter(){this._currentRefreshId=-1}get refreshRate(){return this._refreshRate}set refreshRate(E){this._refreshRate=E,this.resetRefreshCounter()}addPostProcess(E){if(!this._postProcessManager){const E=this.va();if(!E)return;this._postProcessManager=new V.d(E),this._postProcesses=new Array}this._postProcesses.push(E),this._postProcesses[0]._i=!1}clearPostProcesses(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._postProcesses){if(E)for(const E of this._postProcesses)E.dispose();this._postProcesses=[]}}removePostProcess(E){if(!this._postProcesses)return;const b=this._postProcesses.indexOf(E);-1!==b&&(this._postProcesses.splice(b,1),this._postProcesses.length>0&&(this._postProcesses[0]._i=!1))}_shouldRender(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){const E=this._size.layers;if(E)return E;const b=this._size.depth;return b||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(E){const b=Math.max(1,this.getRenderSize()*E);this.resize(b)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(E){var b;const h=this.isCube;null===(b=this._renderTarget)||void 0===b||b.dispose(),this._renderTarget=null;const a=this.va();a&&(this._processSizeParameter(E,!1),this._renderTarget=h?a.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):a.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._render(E,b)}isReadyForRendering(){return this._dumpToolsLoading||(this._dumpToolsLoading=!0,Promise.resolve().then(h.bind(h,12198)).then((E=>this._dumpTools=E))),this._render(!1,!1,!0)}_render(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a=this.va();if(!a)return h;const k=a.getEngine();if(void 0!==this.useCameraPostProcesses&&(E=this.useCameraPostProcesses),this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(let E=0;E<this._waitingRenderList.length;E++){const b=this._waitingRenderList[E],h=a.getMeshById(b);h&&this.renderList.push(h)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];const E=this.va();if(!E)return h;const b=E.meshes;for(let h=0;h<b.length;h++){const E=b[h];this.renderListPredicate(E)&&this.renderList.push(E)}}const G=k.currentRenderPassId;this.onBeforeBindObservable.notifyObservers(this);const V=this.activeCamera??a.activeCamera,l=a.activeCamera;V&&(V!==a.activeCamera&&(a.setTransformMatrix(V.getViewMatrix(),V.getProjectionMatrix(!0)),a.activeCamera=V),k.setViewport(V.rigParent?V.rigParent.viewport:V.viewport,this.getRenderWidth(),this.getRenderHeight())),this._defaultRenderListPrepared=!1;let O=h;if(h){a.getViewMatrix()||a.updateTransformMatrix();const E=this.is2DArray||this.is3D?this.getRenderLayers():this.isCube?6:1;for(let G=0;G<E&&O;G++){let E=null;const b=this.renderList?this.renderList:a.getActiveMeshes().data,V=this.renderList?this.renderList.length:a.getActiveMeshes().length;k.currentRenderPassId=this._renderPassIds[G],this.onBeforeRenderObservable.notifyObservers(G),this.getCustomRenderList&&(E=this.getCustomRenderList(G,b,V)),E||(E=b),this._doNotChangeAspectRatio||a.updateTransformMatrix(!0);for(let a=0;a<E.length&&O;++a){const b=E[a];if(b.isEnabled()&&!b.isBlocked&&b.isVisible&&b.wg)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(b,this.refreshRate,h)){O=!1;continue}}else if(!b.isReady(!0)){O=!1;continue}}this.onAfterRenderObservable.notifyObservers(G),(this.is2DArray||this.is3D||this.isCube)&&(a.incrementRenderId(),a.resetCachedMaterial())}const b=this.particleSystemList||a.yj;for(const h of b)h.isReady()||(O=!1)}else if(!this.is2DArray&&!this.is3D||this.isMulti)if(this.isCube&&!this.isMulti)for(let v=0;v<6;v++)this._renderToTarget(v,E,b,void 0,V),a.incrementRenderId(),a.resetCachedMaterial();else this._renderToTarget(0,E,b,void 0,V);else for(let v=0;v<this.getRenderLayers();v++)this._renderToTarget(0,E,b,v,V),a.incrementRenderId(),a.resetCachedMaterial();return this.onAfterUnbindObservable.notifyObservers(this),k.currentRenderPassId=G,a.activeCamera=l,l&&(this.activeCamera&&this.activeCamera!==a.activeCamera&&a.setTransformMatrix(l.getViewMatrix(),l.getProjectionMatrix(!0)),k.setViewport(l.viewport)),a.resetCachedMaterial(),O}_bestReflectionRenderTargetDimension(E,b){const h=E*b,a=(0,v.l)(h+16384/(128+h));return Math.min((0,v.b)(E),a)}_prepareRenderingManager(E,b,h,a){const k=this.va();if(!k)return;this._renderingManager.reset();const G=k.getRenderId();for(let l=0;l<b;l++){const b=E[l];if(b&&!b.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(b,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!b.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}if(!b._internalAbstractMeshDataInfo._currentLODIsUpToDate&&h&&(b._internalAbstractMeshDataInfo._currentLOD=k.customLODSelector?k.customLODSelector(b,h):b.getLOD(h),b._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!b._internalAbstractMeshDataInfo._currentLOD)continue;let E,V=b._internalAbstractMeshDataInfo._currentLOD;if(V!==b&&0!==V.billboardMode&&V.Wj(),V._preActivateForIntermediateRendering(G),E=!(!a||!h)&&0===(b.layerMask&h.layerMask),b.isEnabled()&&b.isVisible&&b.wg&&!E){if(V!==b&&V._activate(G,!0),b._activate(G,!0)&&b.wg.length){b.isAnInstance?b._internalAbstractMeshDataInfo._actAsRegularMesh&&(V=b):V._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,V._internalAbstractMeshDataInfo._isActiveIntermediate=!0,k._prepareSkeleton(V);for(let E=0;E<V.wg.length;E++){const b=V.wg[E];this._renderingManager.dispatch(b,V)}}b._postActivate()}}}const V=this.particleSystemList||k.yj;for(let l=0;l<V.length;l++){const E=V[l],b=E.j;E.isStarted()&&b&&(!b.position||b.isEnabled())&&this._renderingManager.dispatchParticles(E)}}_bindFrameBuffer(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const h=this.va();if(!h)return;const a=h.getEngine();this._renderTarget&&a.bindFramebuffer(this._renderTarget,this.isCube?E:void 0,void 0,void 0,this.ignoreCameraViewport,0,b)}_unbindFrameBuffer(E,b){this._renderTarget&&E.unBindFramebuffer(this._renderTarget,this.isCube,(()=>{this.onAfterRenderObservable.notifyObservers(b)}))}_prepareFrame(E,b,h,a){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses):a&&E.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(b,h)}_renderToTarget(E,b,h){var a,k;let G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const l=this.va();if(!l)return;const O=l.getEngine();this._prepareFrame(l,E,G,b),null===(a=O._debugPushGroup)||void 0===a||a.call(O,`render to face #${E} layer #${G}`,2),this.is2DArray||this.is3D?(O.currentRenderPassId=this._renderPassIds[G],this.onBeforeRenderObservable.notifyObservers(G)):(O.currentRenderPassId=this._renderPassIds[E],this.onBeforeRenderObservable.notifyObservers(E));if(O.snapshotRendering&&1===O.snapshotRenderingMode)this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(O):this.skipInitialClear||O.clear(this.clearColor||l.clearColor,!0,!0,!0);else{var v;let a=null;const k=this.renderList?this.renderList:l.getActiveMeshes().data,s=this.renderList?this.renderList.length:l.getActiveMeshes().length;this.getCustomRenderList&&(a=this.getCustomRenderList(this.is2DArray||this.is3D?G:E,k,s)),a?this._prepareRenderingManager(a,a.length,V,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(k,s,V,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),a=k);for(const b of l._beforeRenderTargetClearStage)b.action(this,E,G);this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(O):this.skipInitialClear||O.clear(this.clearColor||l.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||l.updateTransformMatrix(!0);for(const b of l._beforeRenderTargetDrawStage)b.action(this,E,G);this._renderingManager.render(this.customRenderFunction,a,this.renderParticles,this.renderSprites);for(const b of l._afterRenderTargetDrawStage)b.action(this,E,G);const B=(null===(v=this._texture)||void 0===v?void 0:v.generateMipMaps)??!1;this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,E,this._postProcesses,this.ignoreCameraViewport):b&&l.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,E);for(const b of l._afterRenderTargetPostProcessStage)b.action(this,E,G);this._texture&&(this._texture.generateMipMaps=B),this._doNotChangeAspectRatio||l.updateTransformMatrix(!0),h&&(this._dumpTools?this._dumpTools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),O):U.c.Error("dumpTools module is still being loaded. To speed up the process import dump tools directly in your project"))}null===(k=O._debugPopGroup)||void 0===k||k.call(O,2),this._unbindFrameBuffer(O,E),this._texture&&this.isCube&&5===E&&O.generateMipMapsForCubemap(this._texture,!0)}setRenderingOrder(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(E,b,h,a)}setRenderingAutoClearDepthStencil(E,b){this._renderingManager.setRenderingAutoClearDepthStencil(E,b),this._renderingManager._useSceneAutoClearSetup=!1}clone(){const E=this.getSize(),b=new B(this.name,E,this.va(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return b.Ie=this.Ie,b.level=this.level,b.coordinatesMode=this.coordinatesMode,this.renderList&&(b.renderList=this.renderList.slice(0)),b}serialize(){if(!this.name)return null;const E=super.serialize();if(E.renderTargetSize=this.getRenderSize(),E.renderList=[],this.renderList)for(let b=0;b<this.renderList.length;b++)E.renderList.push(this.renderList[b].id);return E}disposeFramebufferObjects(){var E;null===(E=this._renderTarget)||void 0===E||E.dispose(!0)}releaseInternalTexture(){var E;null===(E=this._renderTarget)||void 0===E||E.releaseTextures(),this._texture=null}dispose(){var E;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._releaseRenderPassId(),this.clearPostProcesses(!0),this._resizeObserver&&(this.va().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;const b=this.va();if(!b)return;let h=b.customRenderTargets.indexOf(this);h>=0&&b.customRenderTargets.splice(h,1);for(const a of b.cameras)h=a.customRenderTargets.indexOf(this),h>=0&&a.customRenderTargets.splice(h,1);null===(E=this._renderTarget)||void 0===E||E.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this.refreshRate===B.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=B.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}getViewCount(){return 1}}B.REFRESHRATE_RENDER_ONCE=0,B.REFRESHRATE_RENDER_ONEVERYFRAME=1,B.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,G.b._CreateRenderTargetTexture=(E,b,h,a,k)=>new B(E,b,h,a)},11376:(E,b,h)=>{"use strict";h.d(b,{b:()=>I});var a=h(11130),k=h(11139),G=h(10824),V=h(11175),l=h(11381),O=h(10958),v=h(10855),s=h(10895),U=h(10949),B=h(11284),o=h(10887);function u(E,b){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a=b.width,k=b.height;if(E instanceof Float32Array){let b=E.byteLength/E.BYTES_PER_ELEMENT;const h=new Uint8Array(b);for(;--b>=0;){let a=E[b];a<0?a=0:a>1&&(a=1),h[b]=255*a}E=h}const G=document.createElement("canvas");G.width=a,G.height=k;const V=G.getContext("2d");if(!V)return null;const l=V.createImageData(a,k);if(l.data.set(E),V.putImageData(l,0,0),h){const E=document.createElement("canvas");E.width=a,E.height=k;const b=E.getContext("2d");return b?(b.translate(0,k),b.scale(1,-1),b.drawImage(G,0,0),E.toDataURL("image/png")):null}return G.toDataURL("image/png")}function D(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const a=E.getInternalTexture();if(!a)return null;const k=E._readPixelsSync(b,h);return k?u(k,E.getSize(),a.invertY):null}async function g(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const a=E.getInternalTexture();if(!a)return null;const k=await E.readPixels(b,h);return k?u(k,E.getSize(),a.invertY):null}var S=h(11389),M=h(11206);class I extends l.e{static _CreateVideoTexture(E,b,h){arguments.length>5&&void 0!==arguments[5]||I.TRILINEAR_SAMPLINGMODE;throw(0,v.c)("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(E){this._isBlocking=E}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(E,b,h,a){let k,V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:I.TRILINEAR_SAMPLINGMODE,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,v=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,U=arguments.length>8&&void 0!==arguments[8]&&arguments[8],B=arguments.length>9?arguments[9]:void 0,o=arguments.length>10?arguments[10]:void 0,u=arguments.length>11?arguments[11]:void 0,D=arguments.length>12?arguments[12]:void 0,g=arguments.length>13?arguments[13]:void 0;super(b),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new G.e,this._isBlocking=!0,this.name=E||"",this.url=E;let M=!1,j=null,P=!0;"object"===typeof h&&null!==h?(k=h.noMipmap??!1,a=h.invertY??!S.c,V=h.samplingMode??I.TRILINEAR_SAMPLINGMODE,l=h.X??null,O=h.onError??null,v=h.buffer??null,U=h.deleteBuffer??!1,B=h.format,o=h.mimeType,u=h.loaderOptions,D=h.creationFlags,M=h.useSRGBBuffer??!1,j=h.internalTexture??null,P=h.gammaSpace??P):k=!!h,this._gammaSpace=P,this._noMipmap=k,this._invertY=void 0===a?!S.c:a,this._initialSamplingMode=V,this._buffer=v,this._deleteBuffer=U,this._mimeType=o,this._loaderOptions=u,this._creationFlags=D,this._useSRGBBuffer=M,this._forcedExtension=g,B&&(this._format=B);const A=this.va(),n=this._getEngine();if(!n)return;n.onBeforeTextureInitObservable.notifyObservers(this);const d=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),l&&l(),!this.isBlocking&&A&&A.resetCachedMaterial()},c=(E,b)=>{this._loadingError=!0,this._errorObject={message:E,exception:b},O&&O(E,b),I.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!j)return this._delayedOnLoad=d,void(this._delayedOnError=c);if(this._texture=j??this._getFromCache(this.url,k,V,this._invertY,M,this.isCube),this._texture)if(this._texture.isReady)s.e.SetImmediate((()=>d()));else{const E=this._texture.onLoadedObservable.add(d);this._texture.onErrorObservable.add((b=>{var h;c(b.message,b.exception),null===(h=this._texture)||void 0===h||h.onLoadedObservable.remove(E)}))}else if(A&&A.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=d,this._delayedOnError=c;else{try{this._texture=n.createTexture(this.url,k,this._invertY,A,V,d,c,this._buffer,void 0,this._format,this._forcedExtension,o,u,D,M)}catch(z){throw c("error loading",z),z}U&&(this._buffer=null)}}updateURL(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;this.url&&(this.releaseInternalTexture(),this.va().markAllMaterialsAsDirty(1,(E=>E.hasTexture(this)))),this.name&&!this.name.startsWith("data:")||(this.name=E),this.url=E,this._buffer=b,this._forcedExtension=a,this.delayLoadState=4,h&&(this._delayedOnLoad=h),this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;const E=this.va();E&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?s.e.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=E.getEngine().createTexture(this.url,this._noMipmap,this._invertY,E,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(E,b,h,a){E*=this._cachedUScale,b*=this._cachedVScale,E-=this.uRotationCenter*this._cachedUScale,b-=this.vRotationCenter*this._cachedVScale,h-=this.wRotationCenter,V.k.TransformCoordinatesFromFloatsToRef(E,b,h,this._rowGenerationMatrix,a),a.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,a.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,a.z+=this.wRotationCenter}getTextureMatrix(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*E===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*E,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=V.d.Zero(),this._rowGenerationMatrix=new V.d,this._t0=V.k.Zero(),this._t1=V.k.Zero(),this._t2=V.k.Zero()),V.d.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(V.d.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,V.h.Matrix[0]),V.d.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,V.h.Matrix[1]),V.d.ScalingToRef(this._cachedUScale,this._cachedVScale,0,V.h.Matrix[2]),V.d.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,V.h.Matrix[3]),V.h.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(V.h.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(V.h.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(V.h.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.yi(this._t0),this._t2.yi(this._t0),V.d.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const b=this.va();if(!b)return this._cachedTextureMatrix;const h=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&h!==this._cachedIdentity3x2&&b.markAllMaterialsAsDirty(1,(E=>E.hasTexture(this))),this._cachedTextureMatrix}getReflectionTextureMatrix(){const E=this.va();if(!E)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==I.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===E.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=V.d.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=V.d.Zero());const b=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case I.PLANAR_MODE:V.d.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case I.PROJECTION_MODE:{V.d.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const b=E.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=b.updateFlag,b.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:V.d.IdentityToRef(this._cachedReflectionTextureMatrix)}return b&&E.markAllMaterialsAsDirty(1,(E=>E.hasTexture(this))),this._cachedReflectionTextureMatrix}clone(){const E={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,X:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return M.e.Clone((()=>new I(this._texture?this._texture.url:null,this.va(),E)),this)}serialize(){var E;const b=this.name;I.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const h=super.serialize(I._SerializeInternalTextureUniqueId);if(!h)return null;var a;((I.SerializeBuffers||I.ForceSerializeBuffers)&&("string"===typeof this._buffer&&"data:"===this._buffer.substring(0,5)?(h.base64String=this._buffer,h.name=h.name.replace("data:","")):this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array?h.base64String="data:image/png;base64,"+(0,o.g)(this._buffer):(I.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(h.base64String=!this._engine||this._engine._features.supportSyncTextureRead?D(this):g(this))),h.invertY=this._invertY,h.samplingMode=this.samplingMode,h._creationFlags=this._creationFlags,h._useSRGBBuffer=this._useSRGBBuffer,I._SerializeInternalTextureUniqueId)&&(h.internalTextureUniqueId=null===(a=this._texture)||void 0===a?void 0:a.uniqueId);return h.internalTextureLabel=null===(E=this._texture)||void 0===E?void 0:E.label,h.noMipmap=this._noMipmap,this.name=b,h}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(E,b,h){if(E.customType){const a=U.e.Instantiate(E.customType).Parse(E,b,h);return E.samplingMode&&a.updateSamplingMode&&a._samplingMode&&a._samplingMode!==E.samplingMode&&a.updateSamplingMode(E.samplingMode),a}if(E.isCube&&!E.isRenderTarget)return I._CubeTextureParser(E,b,h);const a=void 0!==E.internalTextureUniqueId;if(!E.name&&!E.isRenderTarget&&!a)return null;let k;if(a){const h=b.getEngine().getLoadedTexturesCache();for(const b of h)if(b.uniqueId===E.internalTextureUniqueId){k=b;break}}const G=b=>{if(b&&b._texture&&(b._texture._cachedWrapU=null,b._texture._cachedWrapV=null,b._texture._cachedWrapR=null),E.samplingMode){const h=E.samplingMode;b&&b.samplingMode!==h&&b.updateSamplingMode(h)}if(b&&E.animations)for(let h=0;h<E.animations.length;h++){const a=E.animations[h],k=(0,O.d)("BABYLON.Animation");k&&b.animations.push(k.Parse(a))}b&&b._texture&&(a&&!k&&b._texture._setUniqueId(E.internalTextureUniqueId),b._texture.label=E.internalTextureLabel)};return M.e.Parse((()=>{let a=!0;if(E.noMipmap&&(a=!1),E.mirrorPlane){const h=I._CreateMirror(E.name,E.renderTargetSize,b,a);return h._waitingRenderList=E.renderList,h.mirrorPlane=B.c.jh(E.mirrorPlane),G(h),h}if(E.isRenderTarget){let h=null;if(E.isCube){if(b.reflectionProbes)for(let a=0;a<b.reflectionProbes.length;a++){const h=b.reflectionProbes[a];if(h.name===E.name)return h.cubeTexture}}else h=I._CreateRenderTargetTexture(E.name,E.renderTargetSize,b,a,E._creationFlags??0),h._waitingRenderList=E.renderList;return G(h),h}if(E.isVideo){const k=I._CreateVideoTexture(h+(E.url||E.name),h+(E.src||E.url),b,a,E.invertY,E.samplingMode,E.settings||{});return G(k),k}{let V;if(E.base64String&&!k)V=I.CreateFromBase64String(E.base64String,E.base64String,b,!a,E.invertY,E.samplingMode,(()=>{G(V)}),E._creationFlags??0,E._useSRGBBuffer??!1),V.name=E.name;else{let l;l=E.name&&(E.name.indexOf("://")>0||E.name.startsWith("data:"))?E.name:h+E.name,E.url&&(E.url.startsWith("data:")||I.UseSerializedUrlIfAny)&&(l=E.url);const O={noMipmap:!a,invertY:E.invertY,samplingMode:E.samplingMode,X:()=>{G(V)},internalTexture:k};V=new I(l,b,O)}return V}}),E,b)}static CreateFromBase64String(E,b,h,a,k){let G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:I.TRILINEAR_SAMPLINGMODE;return new I("data:"+b,h,a,k,G,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,E,!1,arguments.length>8&&void 0!==arguments[8]?arguments[8]:5,void 0,void 0,arguments.length>9?arguments[9]:void 0,arguments.length>10?arguments[10]:void 0)}static LoadFromDataString(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4?arguments[4]:void 0,G=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:I.TRILINEAR_SAMPLINGMODE,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,v=arguments.length>9&&void 0!==arguments[9]?arguments[9]:5,s=arguments.length>10?arguments[10]:void 0,U=arguments.length>11?arguments[11]:void 0;return"data:"!==E.substring(0,5)&&(E="data:"+E),new I(E,h,k,G,V,l,O,b,a,v,void 0,void 0,s,U)}}I.SerializeBuffers=!0,I.ForceSerializeBuffers=!1,I.OnTextureLoadErrorObservable=new G.e,I._SerializeInternalTextureUniqueId=!1,I._CubeTextureParser=(E,b,h)=>{throw(0,v.c)("CubeTexture")},I._CreateMirror=(E,b,h,a)=>{throw(0,v.c)("MirrorTexture")},I._CreateRenderTargetTexture=(E,b,h,a,k)=>{throw(0,v.c)("RenderTargetTexture")},I.NEAREST_SAMPLINGMODE=1,I.NEAREST_NEAREST_MIPLINEAR=8,I.BILINEAR_SAMPLINGMODE=2,I.LINEAR_LINEAR_MIPNEAREST=11,I.TRILINEAR_SAMPLINGMODE=3,I.LINEAR_LINEAR_MIPLINEAR=3,I.NEAREST_NEAREST_MIPNEAREST=4,I.NEAREST_LINEAR_MIPNEAREST=5,I.NEAREST_LINEAR_MIPLINEAR=6,I.NEAREST_LINEAR=7,I.NEAREST_NEAREST=1,I.LINEAR_NEAREST_MIPNEAREST=9,I.LINEAR_NEAREST_MIPLINEAR=10,I.LINEAR_LINEAR=2,I.LINEAR_NEAREST=12,I.EXPLICIT_MODE=0,I.SPHERICAL_MODE=1,I.PLANAR_MODE=2,I.CUBIC_MODE=3,I.PROJECTION_MODE=4,I.SKYBOX_MODE=5,I.INVCUBIC_MODE=6,I.EQUIRECTANGULAR_MODE=7,I.FIXED_EQUIRECTANGULAR_MODE=8,I.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,I.CLAMP_ADDRESSMODE=0,I.WRAP_ADDRESSMODE=1,I.MIRROR_ADDRESSMODE=2,I.UseSerializedUrlIfAny=!1,(0,a.d)([(0,k.H)()],I.prototype,"url",void 0),(0,a.d)([(0,k.H)()],I.prototype,"uOffset",void 0),(0,a.d)([(0,k.H)()],I.prototype,"vOffset",void 0),(0,a.d)([(0,k.H)()],I.prototype,"uScale",void 0),(0,a.d)([(0,k.H)()],I.prototype,"vScale",void 0),(0,a.d)([(0,k.H)()],I.prototype,"uAng",void 0),(0,a.d)([(0,k.H)()],I.prototype,"vAng",void 0),(0,a.d)([(0,k.H)()],I.prototype,"wAng",void 0),(0,a.d)([(0,k.H)()],I.prototype,"uRotationCenter",void 0),(0,a.d)([(0,k.H)()],I.prototype,"vRotationCenter",void 0),(0,a.d)([(0,k.H)()],I.prototype,"wRotationCenter",void 0),(0,a.d)([(0,k.H)()],I.prototype,"homogeneousRotationInUVTransform",void 0),(0,a.d)([(0,k.H)()],I.prototype,"isBlocking",null),(0,O.f)("BABYLON.Texture",I),M.e._TextureParser=I.Parse},10941:(E,b,h)=>{"use strict";h.d(b,{e:()=>a});class a{get wrapU(){return this._cachedWrapU}set wrapU(E){this._cachedWrapU=E}get wrapV(){return this._cachedWrapV}set wrapV(E){this._cachedWrapV=E}get wrapR(){return this._cachedWrapR}set wrapR(E){this._cachedWrapR=E}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(E){this._cachedAnisotropicFilteringLevel=E}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(E){this._comparisonFunction=E}get useMipMaps(){return this._useMipMaps}set useMipMaps(E){this._useMipMaps=E}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this._cachedWrapU=E,this._cachedWrapV=b,this._cachedWrapR=h,this._cachedAnisotropicFilteringLevel=a,this.samplingMode=k,this._comparisonFunction=G,this}compareSampler(E){return this._cachedWrapU===E._cachedWrapU&&this._cachedWrapV===E._cachedWrapV&&this._cachedWrapR===E._cachedWrapR&&this._cachedAnisotropicFilteringLevel===E._cachedAnisotropicFilteringLevel&&this.samplingMode===E.samplingMode&&this._comparisonFunction===E._comparisonFunction&&this._useMipMaps===E._useMipMaps}}},11357:(E,b,h)=>{"use strict";function a(E){-1===E.indexOf("vClipPlane")&&E.push("vClipPlane"),-1===E.indexOf("vClipPlane2")&&E.push("vClipPlane2"),-1===E.indexOf("vClipPlane3")&&E.push("vClipPlane3"),-1===E.indexOf("vClipPlane4")&&E.push("vClipPlane4"),-1===E.indexOf("vClipPlane5")&&E.push("vClipPlane5"),-1===E.indexOf("vClipPlane6")&&E.push("vClipPlane6")}function k(E,b,h){const a=!!(E.clipPlane??b.clipPlane),k=!!(E.clipPlane2??b.clipPlane2),G=!!(E.clipPlane3??b.clipPlane3),V=!!(E.clipPlane4??b.clipPlane4),l=!!(E.clipPlane5??b.clipPlane5),O=!!(E.clipPlane6??b.clipPlane6);a&&h.push("#define CLIPPLANE"),k&&h.push("#define CLIPPLANE2"),G&&h.push("#define CLIPPLANE3"),V&&h.push("#define CLIPPLANE4"),l&&h.push("#define CLIPPLANE5"),O&&h.push("#define CLIPPLANE6")}function G(E,b,h){let a=!1;const k=!!(E.clipPlane??b.clipPlane),G=!!(E.clipPlane2??b.clipPlane2),V=!!(E.clipPlane3??b.clipPlane3),l=!!(E.clipPlane4??b.clipPlane4),O=!!(E.clipPlane5??b.clipPlane5),v=!!(E.clipPlane6??b.clipPlane6);return h.CLIPPLANE!==k&&(h.CLIPPLANE=k,a=!0),h.CLIPPLANE2!==G&&(h.CLIPPLANE2=G,a=!0),h.CLIPPLANE3!==V&&(h.CLIPPLANE3=V,a=!0),h.CLIPPLANE4!==l&&(h.CLIPPLANE4=l,a=!0),h.CLIPPLANE5!==O&&(h.CLIPPLANE5=O,a=!0),h.CLIPPLANE6!==v&&(h.CLIPPLANE6=v,a=!0),a}function V(E,b,h){let a=b.clipPlane??h.clipPlane;l(E,"vClipPlane",a),a=b.clipPlane2??h.clipPlane2,l(E,"vClipPlane2",a),a=b.clipPlane3??h.clipPlane3,l(E,"vClipPlane3",a),a=b.clipPlane4??h.clipPlane4,l(E,"vClipPlane4",a),a=b.clipPlane5??h.clipPlane5,l(E,"vClipPlane5",a),a=b.clipPlane6??h.clipPlane6,l(E,"vClipPlane6",a)}function l(E,b,h){h&&E.setFloat4(b,h.k.x,h.k.y,h.k.z,h.d)}h.d(b,{b:()=>a,f:()=>V,g:()=>G,i:()=>k})},11209:(E,b,h)=>{"use strict";function a(E){E.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}h.d(b,{b:()=>a})},11603:(E,b,h)=>{"use strict";function a(E){return void 0===E.getPipelineContext}h.d(b,{d:()=>a})},11345:(E,b,h)=>{"use strict";h.d(b,{c:()=>a});class a{static GetEffect(E){return void 0===E.getPipelineContext?E.effect:E}constructor(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=E.createDrawContext(),b&&(this.materialContext=E.createMaterialContext())}setEffect(E,b){let h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var a;(this.effect=E,void 0!==b&&(this.defines=b),h)&&(null===(a=this.drawContext)||void 0===a||a.reset())}dispose(){var E;null===(E=this.drawContext)||void 0===E||E.dispose()}}},10918:(E,b,h)=>{"use strict";h.d(b,{b:()=>U,e:()=>o,f:()=>v,h:()=>s});var a=h(10832),k=h(10926),G=h(10912),V=h(10834),l=h(10889),O=h(10893);function v(E,b){return(0,k.w)(b).cachedPipelines[E]}function s(E){const b=E._name,h=E.context;if(b&&h){const E=(0,k.w)(h),a=E.cachedPipelines[b];null===a||void 0===a||a.dispose(),delete E.cachedPipelines[b]}}function U(E,b,h,k,G,V,O){let v,s;const U=(0,a.i)()?null===V||void 0===V?void 0:V.getHostDocument():null;v="string"===typeof b?b:b.vertexSource?"source:"+b.vertexSource:b.vertexElement?(null===U||void 0===U?void 0:U.getElementById(b.vertexElement))||b.vertexElement:b.vertex||b,s="string"===typeof b?b:b.fragmentSource?"source:"+b.fragmentSource:b.fragmentElement?(null===U||void 0===U?void 0:U.getElementById(b.fragmentElement))||b.fragmentElement:b.fragment||b;const o=[void 0,void 0],u=()=>{if(o[0]&&o[1]){E.isFragment=!0;const[a,v]=o;(0,l.i)(v,E,((V,v)=>{O&&(O._fragmentSourceCodeBeforeMigration=v),h&&(V=h("fragment",V));const s=(0,l.c)(a,V,E);E=null;const U=function(E,b,h,a){if(h){return{vertexSourceCode:(1===a?"//":"")+"#define SHADER_NAME vertex:"+(h.vertexElement||h.vertex||h.spectorName||h)+"\n"+E,fragmentSourceCode:(1===a?"//":"")+"#define SHADER_NAME fragment:"+(h.fragmentElement||h.fragment||h.spectorName||h)+"\n"+b}}return{vertexSourceCode:E,fragmentSourceCode:b}}(s.vertexCode,s.fragmentCode,b,G);null===k||void 0===k||k(U.vertexSourceCode,U.fragmentSourceCode)}),V)}};B(v,"Vertex","",(b=>{(0,l.g)(E),(0,l.i)(b,E,((E,a)=>{O&&(O._rawVertexSourceCode=b,O._vertexSourceCodeBeforeMigration=a),h&&(E=h("vertex",E)),o[0]=E,u()}),V)}),G),B(s,"Fragment","Pixel",(E=>{O&&(O._rawFragmentSourceCode=E),o[1]=E,u()}),G)}function B(E,b,h,k,V,l){if("undefined"!==typeof HTMLElement&&E instanceof HTMLElement){return void k((0,a.d)(E))}if("source:"===E.substring(0,7))return void k(E.substring(7));if("base64:"===E.substring(0,7)){return void k(window.atob(E.substring(7)))}const v=G.d.GetShadersStore(V);if(v[E+b+"Shader"])return void k(v[E+b+"Shader"]);if(h&&v[E+h+"Shader"])return void k(v[E+h+"Shader"]);let s;if(s="."===E[0]||"/"===E[0]||E.indexOf("http")>-1?E:G.d.GetShadersRepository(V)+E,!(l=l||O.i))throw new Error("loadFileInjection is not defined");l(s+"."+b.toLowerCase()+".fx",k)}const o=(E,b,h,a)=>{try{const G=E.existingPipelineContext||b(E.shaderProcessingContext);if(G._name=E.name,E.name&&E.context){(0,k.w)(E.context).cachedPipelines[E.name]=G}return h(G,E.vertex,E.fragment,!!E.createAsRaw,"","",E.rebuildRebind,E.defines,E.transformFeedbackVaryings,"",(()=>{a(G,(()=>{var b;null===(b=E.onRenderingStateCompiled)||void 0===b||b.call(E,G)}))})),G}catch(G){throw V.c.Error("Error compiling effect"),G}}},10905:(E,b,h)=>{"use strict";h.d(b,{b:()=>l});var a=h(10824),k=h(10834),G=h(10912),V=h(10918);class l{static get ShadersRepository(){return G.d.ShadersRepository}static set ShadersRepository(E){G.d.ShadersRepository=E}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new a.e),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(E,b,h){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,G=arguments.length>4?arguments[4]:void 0,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,B=arguments.length>9?arguments[9]:void 0,o=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",u=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,D=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new a.e,this.onErrorObservable=new a.e,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=E,this._key=o;const g=this._key.replace(/\r/g,"").replace(/\n/g,"|");let S;if(b.attributes){const E=b;if(this._engine=h,this._attributesNames=E.attributes,this._uniformsNames=E.uniformsNames.concat(E.samplers),this._samplerList=E.samplers.slice(),this.defines=E.defines,this.onError=E.onError,this.onCompiled=E.onCompiled,this._fallbacks=E.fallbacks,this._indexParameters=E.indexParameters,this._transformFeedbackVaryings=E.transformFeedbackVaryings||null,this._multiTarget=!!E.multiTarget,this._shaderLanguage=E.shaderLanguage??0,E.uniformBuffersNames){this._uniformBuffersNamesList=E.uniformBuffersNames.slice();for(let b=0;b<E.uniformBuffersNames.length;b++)this._uniformBuffersNames[E.uniformBuffersNames[b]]=b}this._processFinalCode=E.processFinalCode??null,this._processCodeAfterIncludes=E.processCodeAfterIncludes??void 0,S=E.existingPipelineContext}else this._engine=G,this.defines=null==O?"":O,this._uniformsNames=h.concat(k),this._samplerList=k?k.slice():[],this._attributesNames=b,this._uniformBuffersNamesList=[],this._shaderLanguage=u,this.onError=U,this.onCompiled=s,this._indexParameters=B,this._fallbacks=v;"WEBGL2"===this._engine.shaderPlatformName&&(S=(0,V.f)(g,this._engine._gl)??S),this._attributeLocationByName={},this.uniqueId=l._UniqueIdSeed++,S?(this._pipelineContext=S,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,D)}async _processShaderCodeAsync(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3?arguments[3]:void 0;a&&await a(),this._processingContext=h||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const k={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:E??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:G.d.GetShadersRepository(this._shaderLanguage),includesShadersStore:G.d.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,V.b)(k,this.name,this._processFinalCode,((E,h)=>{this._vertexSourceCode=E,this._fragmentSourceCode=h,this._prepareEffect(b)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.u||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(E){return this._attributes[E]}getAttributeLocationByName(E){return this._attributeLocationByName[E]}getAttributesCount(){return this._attributes.length}getUniformIndex(E){return this._uniformsNames.indexOf(E)}getUniform(E){return this._uniforms[E]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}executeWhenCompiled(E){this.isReady()?E(this):(this.onCompileObservable.add((b=>{E(b)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((()=>{this._checkIsReady(null)}),16))}_checkIsReady(E){try{if(this._isReadyInternal())return}catch(b){return void this._processCompilationErrors(b,E)}this._isDisposed||setTimeout((()=>{this._checkIsReady(E)}),16)}get vertexSourceCode(){var E;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(E=this._pipelineContext)||void 0===E?void 0:E._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var E;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(E=this._pipelineContext)||void 0===E?void 0:E._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(E,b,h,a){this._isReady=!1,this._vertexSourceCodeOverride=E,this._fragmentSourceCodeOverride=b,this.onError=(E,b)=>{a&&a(b)},this.onCompiled=()=>{var E,b;const a=this.getEngine().scenes;if(a)for(let h=0;h<a.length;h++)a[h].markAllMaterialsAsDirty(63);null===(E=(b=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===E||E.call(b,h)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(E){if(this._pipelineContext=E,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let b=0;b<this._attributesNames.length;b++){const E=this._attributesNames[b];this._attributeLocationByName[E]=this._attributes[b]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),l.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b=this._pipelineContext;this._isReady=!1;try{const h=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),a=h?null:this.defines,k=h?this._vertexSourceCodeOverride:this._vertexSourceCode,G=h?this._fragmentSourceCodeOverride:this._fragmentSourceCode,l=this._engine;this._pipelineContext=(0,V.e)({existingPipelineContext:E?b:null,vertex:k,fragment:G,context:"WEBGL2"===l.shaderPlatformName?l._gl:void 0,rebuildRebind:(E,b,h,a)=>this._rebuildProgram(E,b,h,a),defines:a,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:h,parallelShaderCompile:l._caps.parallelShaderCompile,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:h=>{b&&!E&&this._engine._deletePipelineContext(b),h&&this._onRenderingStateCompiled(h)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContext.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(b)}catch(h){this._processCompilationErrors(h,b)}}_getShaderCodeAndErrorLine(E,b,h){const a=h?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let k=null;if(b&&E){const G=b.match(a);if(G&&2===G.length){const b=parseInt(G[1]),a=E.split("\n",-1);a.length>=b&&(k=`Offending line [${b}] in ${h?"fragment":"vertex"} code: ${a[b-1]}`)}}return[E,k]}_processCompilationErrors(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=E.message;const h=this._attributesNames,a=this._fallbacks;if(k.c.Error("Unable to compile effect:"),k.c.Error("Uniforms: "+this._uniformsNames.map((function(E){return" "+E}))),k.c.Error("Attributes: "+h.map((function(E){return" "+E}))),k.c.Error("Defines:\n"+this.defines),l.LogShaderCodeOnCompilationError){var G,V;let E=null,b=null,h=null;var O;if(null!==(G=this._pipelineContext)&&void 0!==G&&G._getVertexShaderCode()&&([h,E]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),h&&(k.c.Error("Vertex code:"),k.c.Error(h))),null!==(V=this._pipelineContext)&&void 0!==V&&V._getFragmentShaderCode())[h,b]=this._getShaderCodeAndErrorLine(null===(O=this._pipelineContext)||void 0===O?void 0:O._getFragmentShaderCode(),this._compilationError,!0),h&&(k.c.Error("Fragment code:"),k.c.Error(h));E&&k.c.Error(E),b&&k.c.Error(b)}k.c.Error("Error: "+this._compilationError);const v=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)};b&&(this._pipelineContext=b,this._isReady=!0,v()),a?(this._pipelineContext=null,a.hasMoreFallbacks?(this._allFallbacksProcessed=!1,k.c.Error("Trying next fallback."),this.defines=a.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,v(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,b||v())}get isSupported(){return""===this._compilationError}_bindTexture(E,b){this._engine._bindTexture(this._samplers[E],b,E)}setTexture(E,b){this._engine.setTexture(this._samplers[E],this._uniforms[E],b,E)}setTextureArray(E,b){const h=E+"Ex";if(-1===this._samplerList.indexOf(h+"0")){const a=this._samplerList.indexOf(E);for(let E=1;E<b.length;E++){const b=h+(E-1).toString();this._samplerList.splice(a+E,0,b)}let k=0;for(const E of this._samplerList)this._samplers[E]=k,k+=1}this._engine.setTextureArray(this._samplers[E],this._uniforms[E],b,E)}bindUniformBuffer(E,b){const h=this._uniformBuffersNames[b];void 0===h||l._BaseCache[h]===E&&this._engine._features.useUBOBindingCache||(l._BaseCache[h]=E,this._engine.bindUniformBufferBase(E,h,b))}bindUniformBlock(E,b){this._engine.bindUniformBlock(this._pipelineContext,E,b)}setInt(E,b){return this._pipelineContext.setInt(E,b),this}setInt2(E,b,h){return this._pipelineContext.setInt2(E,b,h),this}setInt3(E,b,h,a){return this._pipelineContext.setInt3(E,b,h,a),this}setInt4(E,b,h,a,k){return this._pipelineContext.setInt4(E,b,h,a,k),this}setIntArray(E,b){return this._pipelineContext.setIntArray(E,b),this}setIntArray2(E,b){return this._pipelineContext.setIntArray2(E,b),this}setIntArray3(E,b){return this._pipelineContext.setIntArray3(E,b),this}setIntArray4(E,b){return this._pipelineContext.setIntArray4(E,b),this}setUInt(E,b){return this._pipelineContext.setUInt(E,b),this}setUInt2(E,b,h){return this._pipelineContext.setUInt2(E,b,h),this}setUInt3(E,b,h,a){return this._pipelineContext.setUInt3(E,b,h,a),this}setUInt4(E,b,h,a,k){return this._pipelineContext.setUInt4(E,b,h,a,k),this}setUIntArray(E,b){return this._pipelineContext.setUIntArray(E,b),this}setUIntArray2(E,b){return this._pipelineContext.setUIntArray2(E,b),this}setUIntArray3(E,b){return this._pipelineContext.setUIntArray3(E,b),this}setUIntArray4(E,b){return this._pipelineContext.setUIntArray4(E,b),this}setFloatArray(E,b){return this._pipelineContext.setArray(E,b),this}setFloatArray2(E,b){return this._pipelineContext.setArray2(E,b),this}setFloatArray3(E,b){return this._pipelineContext.setArray3(E,b),this}setFloatArray4(E,b){return this._pipelineContext.setArray4(E,b),this}setArray(E,b){return this._pipelineContext.setArray(E,b),this}setArray2(E,b){return this._pipelineContext.setArray2(E,b),this}setArray3(E,b){return this._pipelineContext.setArray3(E,b),this}setArray4(E,b){return this._pipelineContext.setArray4(E,b),this}setMatrices(E,b){return this._pipelineContext.setMatrices(E,b),this}setMatrix(E,b){return this._pipelineContext.setMatrix(E,b),this}setMatrix3x3(E,b){return this._pipelineContext.setMatrix3x3(E,b),this}setMatrix2x2(E,b){return this._pipelineContext.setMatrix2x2(E,b),this}setFloat(E,b){return this._pipelineContext.setFloat(E,b),this}setBool(E,b){return this._pipelineContext.setInt(E,b?1:0),this}setVector2(E,b){return this._pipelineContext.setVector2(E,b),this}setFloat2(E,b,h){return this._pipelineContext.setFloat2(E,b,h),this}setVector3(E,b){return this._pipelineContext.setVector3(E,b),this}setFloat3(E,b,h,a){return this._pipelineContext.setFloat3(E,b,h,a),this}setVector4(E,b){return this._pipelineContext.setVector4(E,b),this}setQuaternion(E,b){return this._pipelineContext.setQuaternion(E,b),this}setFloat4(E,b,h,a,k){return this._pipelineContext.setFloat4(E,b,h,a,k),this}setColor3(E,b){return this._pipelineContext.setColor3(E,b),this}setColor4(E,b,h){return this._pipelineContext.setColor4(E,b,h),this}setDirectColor4(E,b){return this._pipelineContext.setDirectColor4(E,b),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){this._refCount--,this._refCount>0||(this._pipelineContext&&(0,V.h)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;b&&(G.d.GetShadersStore(a)[`${E}PixelShader`]=b),h&&(G.d.GetShadersStore(a)[`${E}VertexShader`]=h)}static ResetCache(){l._BaseCache={}}}l.LogShaderCodeOnCompilationError=!0,l.AutomaticallyClearCodeCache=!1,l._UniqueIdSeed=0,l._BaseCache={},l.ShadersStore=G.d.ShadersStore,l.IncludesShadersStore=G.d.IncludesShadersStore},11396:(E,b,h)=>{"use strict";h.d(b,{b:()=>a});class a{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(E,b){this._defines[E]||(E<this._currentRank&&(this._currentRank=E),E>this._maxRank&&(this._maxRank=E),this._defines[E]=new Array),this._defines[E].push(b)}addCPUSkinningFallback(E,b){this._mesh=b,E<this._currentRank&&(this._currentRank=E),E>this._maxRank&&(this._maxRank=E)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(E,b){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,E=E.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),b._bonesComputationForcedToCPU=!0;const h=this._mesh.va();for(let E=0;E<h.meshes.length;E++){const a=h.meshes[E];if(a.material){if(a.computeBonesUsingShaders&&0!==a.numBoneInfluencers)if(a.material.getEffect()===b)a.computeBonesUsingShaders=!1;else if(a.wg)for(const E of a.wg){if(E.effect===b){a.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&a.computeBonesUsingShaders&&a.numBoneInfluencers>0&&(a.computeBonesUsingShaders=!1)}}else{const b=this._defines[this._currentRank];if(b)for(let h=0;h<b.length;h++)E=E.replace("#define "+b[h],"");this._currentRank++}return E}}},11706:(E,b,h)=>{"use strict";h.d(b,{c:()=>v,d:()=>s});var a=h(11233),k=h(11432),G=h(10824),V=h(10905),l=h(11345);h(11713);const O={xa:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class v{constructor(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O;this._fullscreenViewport=new k.b(0,0,1,1);const h=b.xa??O.xa,G=b.indices??O.indices;this.xd=E,this._vertexBuffers={[a.g.PositionKind]:new a.g(E,h,a.g.PositionKind,!1,!1,2)},this._indexBuffer=E.createIndexBuffer(G),this._onContextRestoredObserver=E.onContextRestoredObservable.add((()=>{this._indexBuffer=E.createIndexBuffer(G);for(const E in this._vertexBuffers){this._vertexBuffers[E]._rebuild()}}))}setViewport(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._fullscreenViewport;this.xd.setViewport(E)}bindBuffers(E){this.xd.bindBuffers(this._vertexBuffers,this._indexBuffer,E)}applyEffectWrapper(E){this.xd.setState(!0),this.xd.depthCullingState.depthTest=!1,this.xd.stencilState.stencilTest=!1,this.xd.enableEffect(E.drawWrapper),this.bindBuffers(E.effect),E.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.xd.depthCullingState.depthTest,this._savedStateStencilTest=this.xd.stencilState.stencilTest}restoreStates(){this.xd.depthCullingState.depthTest=this._savedStateDepthTest,this.xd.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.xd.drawElementsType(0,0,6)}_isRenderTargetTexture(E){return void 0!==E.renderTarget}render(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!E.effect.isReady())return;this.saveStates(),this.setViewport();const h=null===b?null:this._isRenderTargetTexture(b)?b.renderTarget:b;h&&this.xd.bindFramebuffer(h),this.applyEffectWrapper(E),this.draw(),h&&this.xd.unBindFramebuffer(h),this.restoreStates()}dispose(){const E=this._vertexBuffers[a.g.PositionKind];E&&(E.dispose(),delete this._vertexBuffers[a.g.PositionKind]),this._indexBuffer&&this.xd._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.xd.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class s{static RegisterShaderCodeProcessing(E,b){b?s._CustomShaderCodeProcessing[E??""]=b:delete s._CustomShaderCodeProcessing[E??""]}static _GetShaderCodeProcessing(E){return s._CustomShaderCodeProcessing[E]??s._CustomShaderCodeProcessing[""]}get name(){return this.options.name}set name(E){this.options.name=E}isReady(){var E;return(null===(E=this._drawWrapper.effect)||void 0===E?void 0:E.isReady())??!1}get drawWrapper(){return this._drawWrapper}get effect(){return this._drawWrapper.effect}set effect(E){this._drawWrapper.effect=E}constructor(E){this.alphaMode=0,this.onEffectCreatedObservable=new G.e(void 0,!0),this.onApplyObservable=new G.e,this._shadersLoaded=!1,this._webGPUReady=!1,this._importPromises=[],this.options={...E,name:E.name||"effectWrapper",xd:E.xd,uniforms:E.uniforms||E.uniformNames||[],uniformNames:void 0,samplers:E.samplers||E.samplerNames||[],samplerNames:void 0,attributeNames:E.attributeNames||["position"],uniformBuffers:E.uniformBuffers||[],defines:E.defines||"",useShaderStore:E.useShaderStore||!1,vertexUrl:E.vertexUrl||E.vertexShader||"postprocess",vertexShader:void 0,fragmentShader:E.fragmentShader||"pass",indexParameters:E.indexParameters,blockCompilation:E.blockCompilation||!1,shaderLanguage:E.shaderLanguage||0,onCompiled:E.onCompiled||void 0,extraInitializations:E.extraInitializations||void 0,extraInitializationsAsync:E.extraInitializationsAsync||void 0,useAsPostProcess:E.useAsPostProcess??!1},this.options.uniformNames=this.options.uniforms,this.options.samplerNames=this.options.samplers,this.options.vertexShader=this.options.vertexUrl,this.options.useAsPostProcess&&(-1===this.options.samplers.indexOf("textureSampler")&&this.options.samplers.push("textureSampler"),-1===this.options.uniforms.indexOf("scale")&&this.options.uniforms.push("scale")),E.vertexUrl||E.vertexShader?this._shaderPath={vertexSource:this.options.vertexShader}:(this.options.useAsPostProcess||(this.options.uniforms.push("scale"),this.onApplyObservable.add((()=>{this.effect.setFloat2("scale",1,1)}))),this._shaderPath={vertex:this.options.vertexShader}),this._shaderPath.fragmentSource=this.options.fragmentShader,this._shaderPath.spectorName=this.options.name,this.options.useShaderStore&&(this._shaderPath.fragment=this._shaderPath.fragmentSource,this._shaderPath.vertex||(this._shaderPath.vertex=this._shaderPath.vertexSource),delete this._shaderPath.fragmentSource,delete this._shaderPath.vertexSource),this.onApplyObservable.add((()=>{this.bind()})),this.options.useShaderStore||(this._onContextRestoredObserver=this.options.xd.onContextRestoredObservable.add((()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()}))),this._drawWrapper=new l.c(this.options.xd),this._webGPUReady=1===this.options.shaderLanguage;const b=Array.isArray(this.options.defines)?this.options.defines.join("\n"):this.options.defines;this._postConstructor(this.options.blockCompilation,b,this.options.extraInitializations)}_gatherImports(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1?arguments[1]:void 0;this.options.useAsPostProcess&&(E&&this._webGPUReady?b.push(Promise.all([h.e(37).then(h.bind(h,13375))])):b.push(Promise.all([Promise.resolve().then(h.bind(h,11713))])))}_postConstructor(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;this._importPromises.length=0,a&&this._importPromises.push(...a);const k=this.options.xd.isWebGPU&&!s.ForceGLSL;this._gatherImports(k,this._importPromises),void 0!==h&&h(k,this._importPromises),k&&this._webGPUReady&&(this.options.shaderLanguage=1),E||this.updateEffect(b)}updateEffect(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3?arguments[3]:void 0,k=arguments.length>4?arguments[4]:void 0,G=arguments.length>5?arguments[5]:void 0,l=arguments.length>6?arguments[6]:void 0,O=arguments.length>7?arguments[7]:void 0;const v=s._GetShaderCodeProcessing(this.name);if(null!==v&&void 0!==v&&v.defineCustomBindings){var U,B;const a=(null===(U=b)||void 0===U?void 0:U.slice())??[];a.push(...this.options.uniforms);const k=(null===(B=h)||void 0===B?void 0:B.slice())??[];k.push(...this.options.samplers),E=v.defineCustomBindings(this.name,E,a,k),b=a,h=k}this.options.defines=E||"";const o=this._shadersLoaded||0===this._importPromises.length?void 0:async()=>{await Promise.all(this._importPromises),this._shadersLoaded=!0};let u;u=this.options.extraInitializationsAsync?async()=>{null===o||void 0===o||o(),await this.options.extraInitializationsAsync}:o,this.options.useShaderStore?this._drawWrapper.effect=this.options.xd.createEffect({vertex:l??this._shaderPath.vertex,fragment:O??this._shaderPath.fragment},{attributes:this.options.attributeNames,uniformsNames:b||this.options.uniforms,uniformBuffersNames:this.options.uniformBuffers,samplers:h||this.options.samplers,defines:null!==E?E:"",fallbacks:null,onCompiled:k??this.options.onCompiled,onError:G??null,indexParameters:a||this.options.indexParameters,processCodeAfterIncludes:null!==v&&void 0!==v&&v.processCodeAfterIncludes?(E,b)=>v.processCodeAfterIncludes(this.name,E,b):null,processFinalCode:null!==v&&void 0!==v&&v.processFinalCode?(E,b)=>v.processFinalCode(this.name,E,b):null,shaderLanguage:this.options.shaderLanguage,extraInitializationsAsync:u},this.options.xd):this._drawWrapper.effect=new V.b(this._shaderPath,this.options.attributeNames,b||this.options.uniforms,h||this.options.samplerNames,this.options.xd,E,void 0,k||this.options.onCompiled,void 0,void 0,void 0,this.options.shaderLanguage,u),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)}bind(){var E,b;this.options.useAsPostProcess&&(this.options.xd.setAlphaMode(this.alphaMode),this.drawWrapper.effect.setFloat2("scale",1,1)),null===(E=s._GetShaderCodeProcessing(this.name))||void 0===E||null===(b=E.bindCustomBindings)||void 0===b||b.call(E,this.name,this._drawWrapper.effect)}dispose(){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.onEffectCreatedObservable.clear(),this.effect.dispose()}}s.ForceGLSL=!1,s._CustomShaderCodeProcessing={}},11216:(E,b,h)=>{"use strict";h.d(b,{e:()=>G,g:()=>k});var a=h(11209);function k(E,b){b.EXPOSURE&&E.push("exposureLinear"),b.CONTRAST&&E.push("contrast"),b.COLORGRADING&&E.push("colorTransformSettings"),(b.VIGNETTE||b.DITHER)&&E.push("vInverseScreenSize"),b.VIGNETTE&&(E.push("vignetteSettings1"),E.push("vignetteSettings2")),b.COLORCURVES&&(0,a.b)(E),b.DITHER&&E.push("ditherIntensity")}function G(E,b){b.COLORGRADING&&E.push("txColorTransform")}},11195:(E,b,h)=>{"use strict";h.d(b,{d:()=>o});var a=h(11130),k=h(11139),G=h(10824),V=h(11201),l=h(11206),O=h(11209);class v{constructor(){this._dirty=!0,this._tempColor=new V.f(0,0,0,0),this._globalCurve=new V.f(0,0,0,0),this._highlightsCurve=new V.f(0,0,0,0),this._midtonesCurve=new V.f(0,0,0,0),this._shadowsCurve=new V.f(0,0,0,0),this._positiveCurve=new V.f(0,0,0,0),this._negativeCurve=new V.f(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get globalHue(){return this._globalHue}set globalHue(E){this._globalHue=E,this._dirty=!0}get globalDensity(){return this._globalDensity}set globalDensity(E){this._globalDensity=E,this._dirty=!0}get globalSaturation(){return this._globalSaturation}set globalSaturation(E){this._globalSaturation=E,this._dirty=!0}get globalExposure(){return this._globalExposure}set globalExposure(E){this._globalExposure=E,this._dirty=!0}get highlightsHue(){return this._highlightsHue}set highlightsHue(E){this._highlightsHue=E,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}set highlightsDensity(E){this._highlightsDensity=E,this._dirty=!0}get highlightsSaturation(){return this._highlightsSaturation}set highlightsSaturation(E){this._highlightsSaturation=E,this._dirty=!0}get highlightsExposure(){return this._highlightsExposure}set highlightsExposure(E){this._highlightsExposure=E,this._dirty=!0}get midtonesHue(){return this._midtonesHue}set midtonesHue(E){this._midtonesHue=E,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesDensity(E){this._midtonesDensity=E,this._dirty=!0}get midtonesSaturation(){return this._midtonesSaturation}set midtonesSaturation(E){this._midtonesSaturation=E,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set midtonesExposure(E){this._midtonesExposure=E,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set shadowsHue(E){this._shadowsHue=E,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set shadowsDensity(E){this._shadowsDensity=E,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}set shadowsSaturation(E){this._shadowsSaturation=E,this._dirty=!0}get shadowsExposure(){return this._shadowsExposure}set shadowsExposure(E){this._shadowsExposure=E,this._dirty=!0}getClassName(){return"ColorCurves"}static Bind(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vCameraColorCurvePositive",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vCameraColorCurveNeutral",k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"vCameraColorCurveNegative";E._dirty&&(E._dirty=!1,E._getColorGradingDataToRef(E._globalHue,E._globalDensity,E._globalSaturation,E._globalExposure,E._globalCurve),E._getColorGradingDataToRef(E._highlightsHue,E._highlightsDensity,E._highlightsSaturation,E._highlightsExposure,E._tempColor),E._tempColor.multiplyToRef(E._globalCurve,E._highlightsCurve),E._getColorGradingDataToRef(E._midtonesHue,E._midtonesDensity,E._midtonesSaturation,E._midtonesExposure,E._tempColor),E._tempColor.multiplyToRef(E._globalCurve,E._midtonesCurve),E._getColorGradingDataToRef(E._shadowsHue,E._shadowsDensity,E._shadowsSaturation,E._shadowsExposure,E._tempColor),E._tempColor.multiplyToRef(E._globalCurve,E._shadowsCurve),E._highlightsCurve.subtractToRef(E._midtonesCurve,E._positiveCurve),E._midtonesCurve.subtractToRef(E._shadowsCurve,E._negativeCurve)),b&&(b.setFloat4(h,E._positiveCurve.r,E._positiveCurve.g,E._positiveCurve.b,E._positiveCurve.a),b.setFloat4(a,E._midtonesCurve.r,E._midtonesCurve.g,E._midtonesCurve.b,E._midtonesCurve.a),b.setFloat4(k,E._negativeCurve.r,E._negativeCurve.g,E._negativeCurve.b,E._negativeCurve.a))}_getColorGradingDataToRef(E,b,h,a,k){null!=E&&(E=v._Clamp(E,0,360),b=v._Clamp(b,-100,100),h=v._Clamp(h,-100,100),a=v._Clamp(a,-100,100),b=v._ApplyColorGradingSliderNonlinear(b),b*=.5,a=v._ApplyColorGradingSliderNonlinear(a),b<0&&(b*=-1,E=(E+180)%360),v._FromHSBToRef(E,b,50+.25*a,k),k.scaleToRef(2,k),k.a=1+.01*h)}static _ApplyColorGradingSliderNonlinear(E){E/=100;let b=Math.abs(E);return b=Math.pow(b,2),E<0&&(b*=-1),b*=100,b}static _FromHSBToRef(E,b,h,a){let k=v._Clamp(E,0,360);const G=v._Clamp(b/100,0,1),V=v._Clamp(h/100,0,1);if(0===G)a.r=V,a.g=V,a.b=V;else{k/=60;const E=Math.floor(k),b=k-E,h=V*(1-G),l=V*(1-G*b),O=V*(1-G*(1-b));switch(E){case 0:a.r=V,a.g=O,a.b=h;break;case 1:a.r=l,a.g=V,a.b=h;break;case 2:a.r=h,a.g=V,a.b=O;break;case 3:a.r=h,a.g=l,a.b=V;break;case 4:a.r=O,a.g=h,a.b=V;break;default:a.r=V,a.g=h,a.b=l}}a.a=1}static _Clamp(E,b,h){return Math.min(Math.max(E,b),h)}clone(){return l.e.Clone((()=>new v),this)}serialize(){return l.e.Serialize(this)}static Parse(E){return l.e.Parse((()=>new v),E,null,null)}}v.PrepareUniforms=O.b,(0,a.d)([(0,k.H)()],v.prototype,"_globalHue",void 0),(0,a.d)([(0,k.H)()],v.prototype,"_globalDensity",void 0),(0,a.d)([(0,k.H)()],v.prototype,"_globalSaturation",void 0),(0,a.d)([(0,k.H)()],v.prototype,"_globalExposure",void 0),(0,a.d)([(0,k.H)()],v.prototype,"_highlightsHue",void 0),(0,a.d)([(0,k.H)()],v.prototype,"_highlightsDensity",void 0),(0,a.d)([(0,k.H)()],v.prototype,"_highlightsSaturation",void 0),(0,a.d)([(0,k.H)()],v.prototype,"_highlightsExposure",void 0),(0,a.d)([(0,k.H)()],v.prototype,"_midtonesHue",void 0),(0,a.d)([(0,k.H)()],v.prototype,"_midtonesDensity",void 0),(0,a.d)([(0,k.H)()],v.prototype,"_midtonesSaturation",void 0),(0,a.d)([(0,k.H)()],v.prototype,"_midtonesExposure",void 0),l.e._ColorCurvesParser=v.Parse;var s=h(10968),U=h(11216),B=h(10958);class o{constructor(){this.colorCurves=new v,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=o.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new V.f(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=o.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new G.e}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(E){this._colorCurvesEnabled!==E&&(this._colorCurvesEnabled=E,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(E){this._colorGradingTexture!==E&&(this._colorGradingTexture=E,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(E){this._colorGradingEnabled!==E&&(this._colorGradingEnabled=E,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(E){this._colorGradingWithGreenDepth!==E&&(this._colorGradingWithGreenDepth=E,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(E){this._colorGradingBGR!==E&&(this._colorGradingBGR=E,this._updateParameters())}get exposure(){return this._exposure}set exposure(E){this._exposure!==E&&(this._exposure=E,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(E){this._toneMappingEnabled!==E&&(this._toneMappingEnabled=E,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(E){this._toneMappingType!==E&&(this._toneMappingType=E,this._updateParameters())}get contrast(){return this._contrast}set contrast(E){this._contrast!==E&&(this._contrast=E,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(E){this.vignetteCenterY=E}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(E){this.vignetteCenterX=E}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(E){this._vignetteBlendMode!==E&&(this._vignetteBlendMode=E,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(E){this._vignetteEnabled!==E&&(this._vignetteEnabled=E,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(E){this._ditheringEnabled!==E&&(this._ditheringEnabled=E,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(E){this._ditheringIntensity!==E&&(this._ditheringIntensity=E,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(E){this._skipFinalColorClamp!==E&&(this._skipFinalColorClamp=E,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(E){this._applyByPostProcess!==E&&(this._applyByPostProcess=E,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(E){this._isEnabled!==E&&(this._isEnabled=E,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}prepareDefines(E){if((arguments.length>1&&void 0!==arguments[1]&&arguments[1])!==this.applyByPostProcess||!this._isEnabled)return E.VIGNETTE=!1,E.TONEMAPPING=0,E.CONTRAST=!1,E.EXPOSURE=!1,E.COLORCURVES=!1,E.COLORGRADING=!1,E.COLORGRADING3D=!1,E.DITHER=!1,E.IMAGEPROCESSING=!1,E.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(E.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(E.VIGNETTE=this.vignetteEnabled,E.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===o._VIGNETTEMODE_MULTIPLY,E.VIGNETTEBLENDMODEOPAQUE=!E.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case o.TONEMAPPING_KHR_PBR_NEUTRAL:E.TONEMAPPING=3;break;case o.TONEMAPPING_ACES:E.TONEMAPPING=2;break;default:E.TONEMAPPING=1}else E.TONEMAPPING=0;E.CONTRAST=1!==this.contrast,E.EXPOSURE=1!==this.exposure,E.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,E.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,E.COLORGRADING?E.COLORGRADING3D=this.colorGradingTexture.is3D:E.COLORGRADING3D=!1,E.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,E.SAMPLER3DBGRMAP=this.colorGradingBGR,E.DITHER=this._ditheringEnabled,E.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,E.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,E.IMAGEPROCESSING=E.VIGNETTE||!!E.TONEMAPPING||E.CONTRAST||E.EXPOSURE||E.COLORCURVES||E.COLORGRADING||E.DITHER}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(E,b){if(this._colorCurvesEnabled&&this.colorCurves&&v.Bind(this.colorCurves,E),this._vignetteEnabled||this._ditheringEnabled){const h=1/E.getEngine().getRenderWidth(),a=1/E.getEngine().getRenderHeight();if(E.setFloat2("vInverseScreenSize",h,a),this._ditheringEnabled&&E.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const k=null!=b?b:a/h;let G=Math.tan(.5*this.vignetteCameraFov),V=G*k;const l=Math.sqrt(V*G);V=(0,s.k)(V,l,this.vignetteStretch),G=(0,s.k)(G,l,this.vignetteStretch),E.setFloat4("vignetteSettings1",V,G,-V*this.vignetteCenterX,-G*this.vignetteCenterY);const O=-2*this.vignetteWeight;E.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,O)}}if(E.setFloat("exposureLinear",this.exposure),E.setFloat("contrast",this.contrast),this.colorGradingTexture){E.setTexture("txColorTransform",this.colorGradingTexture);const b=this.colorGradingTexture.getSize().height;E.setFloat4("colorTransformSettings",(b-1)/b,.5/b,b,this.colorGradingTexture.level)}}clone(){return l.e.Clone((()=>new o),this)}serialize(){return l.e.Serialize(this)}static Parse(E){const b=l.e.Parse((()=>new o),E,null,null);return void 0!==E.vignetteCentreX&&(b.vignetteCenterX=E.vignetteCentreX),void 0!==E.vignetteCentreY&&(b.vignetteCenterY=E.vignetteCentreY),b}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}o.TONEMAPPING_STANDARD=0,o.TONEMAPPING_ACES=1,o.TONEMAPPING_KHR_PBR_NEUTRAL=2,o.PrepareUniforms=U.g,o.PrepareSamplers=U.e,o._VIGNETTEMODE_MULTIPLY=0,o._VIGNETTEMODE_OPAQUE=1,(0,a.d)([(0,k.f)()],o.prototype,"colorCurves",void 0),(0,a.d)([(0,k.H)()],o.prototype,"_colorCurvesEnabled",void 0),(0,a.d)([(0,k.C)("colorGradingTexture")],o.prototype,"_colorGradingTexture",void 0),(0,a.d)([(0,k.H)()],o.prototype,"_colorGradingEnabled",void 0),(0,a.d)([(0,k.H)()],o.prototype,"_colorGradingWithGreenDepth",void 0),(0,a.d)([(0,k.H)()],o.prototype,"_colorGradingBGR",void 0),(0,a.d)([(0,k.H)()],o.prototype,"_exposure",void 0),(0,a.d)([(0,k.H)()],o.prototype,"_toneMappingEnabled",void 0),(0,a.d)([(0,k.H)()],o.prototype,"_toneMappingType",void 0),(0,a.d)([(0,k.H)()],o.prototype,"_contrast",void 0),(0,a.d)([(0,k.H)()],o.prototype,"vignetteStretch",void 0),(0,a.d)([(0,k.H)()],o.prototype,"vignetteCenterX",void 0),(0,a.d)([(0,k.H)()],o.prototype,"vignetteCenterY",void 0),(0,a.d)([(0,k.H)()],o.prototype,"vignetteWeight",void 0),(0,a.d)([(0,k.k)()],o.prototype,"vignetteColor",void 0),(0,a.d)([(0,k.H)()],o.prototype,"vignetteCameraFov",void 0),(0,a.d)([(0,k.H)()],o.prototype,"_vignetteBlendMode",void 0),(0,a.d)([(0,k.H)()],o.prototype,"_vignetteEnabled",void 0),(0,a.d)([(0,k.H)()],o.prototype,"_ditheringEnabled",void 0),(0,a.d)([(0,k.H)()],o.prototype,"_ditheringIntensity",void 0),(0,a.d)([(0,k.H)()],o.prototype,"_skipFinalColorClamp",void 0),(0,a.d)([(0,k.H)()],o.prototype,"_applyByPostProcess",void 0),(0,a.d)([(0,k.H)()],o.prototype,"_isEnabled",void 0),l.e._ImageProcessingConfigurationParser=o.Parse,(0,B.f)("BABYLON.ImageProcessingConfiguration",o)},11403:(E,b,h)=>{"use strict";h.d(b,{b:()=>U});var a=h(11130),k=h(11311),G=h(11139),V=h(11393),l=h(11366),O=h(11405),v=h(11351);class s extends l.c{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class U extends O.d{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(E,"DetailMap",140,new s,b),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=k.c.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=E._dirtyCallbacks[1]}isReadyForSubMesh(E,b,h){return!this._isEnabled||!(E._areTexturesDirty&&b.texturesEnabled&&h.getCaps().standardDerivatives&&this._texture&&V.c.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(E,b){if(this._isEnabled){E.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const h=b.getEngine();E._areTexturesDirty&&(h.getCaps().standardDerivatives&&this._texture&&V.c.DetailTextureEnabled&&this._isEnabled?((0,v.N)(this._texture,E,"DETAIL"),E.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):E.DETAIL=!1)}else E.DETAIL=!1}bindForSubMesh(E,b){if(!this._isEnabled)return;const h=this._material.isFrozen;E.useUbo&&h&&E.isSync||this._texture&&V.c.DetailTextureEnabled&&(E.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),(0,v.t)(this._texture,E,"detail")),b.texturesEnabled&&this._texture&&V.c.DetailTextureEnabled&&E.setTexture("detailSampler",this._texture)}hasTexture(E){return this._texture===E}getActiveTextures(E){this._texture&&E.push(this._texture)}getAnimatables(E){this._texture&&this._texture.animations&&this._texture.animations.length>0&&E.push(this._texture)}dispose(E){var b;E&&(null===(b=this._texture)||void 0===b||b.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(E){E.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,a.d)([(0,G.C)("detailTexture"),(0,G.b)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"texture",void 0),(0,a.d)([(0,G.H)()],U.prototype,"diffuseBlendLevel",void 0),(0,a.d)([(0,G.H)()],U.prototype,"roughnessBlendLevel",void 0),(0,a.d)([(0,G.H)()],U.prototype,"bumpLevel",void 0),(0,a.d)([(0,G.H)(),(0,G.b)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"normalBlendMethod",void 0),(0,a.d)([(0,G.H)(),(0,G.b)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"isEnabled",void 0)},11311:(E,b,h)=>{"use strict";h.d(b,{c:()=>g});var a=h(11130),k=h(11139),G=h(10821),V=h(10824),l=h(10869),O=h(11319),v=h(11224),s=h(10834),U=h(11284),B=h(11345),o=h(11206);class u{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(E){this._func=E}get funcRef(){return this._funcRef}set funcRef(E){this._funcRef=E}get funcMask(){return this._funcMask}set funcMask(E){this._funcMask=E}get opStencilFail(){return this._opStencilFail}set opStencilFail(E){this._opStencilFail=E}get opDepthFail(){return this._opDepthFail}set opDepthFail(E){this._opDepthFail=E}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(E){this._opStencilDepthPass=E}get mask(){return this._mask}set mask(E){this._mask=E}get enabled(){return this._enabled}set enabled(E){this._enabled=E}getClassName(){return"MaterialStencilState"}copyTo(E){o.e.Clone((()=>E),this)}serialize(){return o.e.Serialize(this)}parse(E,b,h){o.e.Parse((()=>this),E,b,h)}}(0,a.d)([(0,k.H)()],u.prototype,"func",null),(0,a.d)([(0,k.H)()],u.prototype,"funcRef",null),(0,a.d)([(0,k.H)()],u.prototype,"funcMask",null),(0,a.d)([(0,k.H)()],u.prototype,"opStencilFail",null),(0,a.d)([(0,k.H)()],u.prototype,"opDepthFail",null),(0,a.d)([(0,k.H)()],u.prototype,"opStencilDepthPass",null),(0,a.d)([(0,k.H)()],u.prototype,"mask",null),(0,a.d)([(0,k.H)()],u.prototype,"enabled",null);var D=h(11351);class g{get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(E){if(this._alpha===E)return;const b=this._alpha;this._alpha=E,1!==b&&1!==E||this.ah(g.MiscDirtyFlag+g.PrePassDirtyFlag)}get alpha(){return this._alpha}set xh(E){this._backFaceCulling!==E&&(this._backFaceCulling=E,this.ah(g.TextureDirtyFlag))}get xh(){return this._backFaceCulling}set cullBackFaces(E){this._cullBackFaces!==E&&(this._cullBackFaces=E,this.ah(g.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(E){this._blockDirtyMechanism!==E&&(this._blockDirtyMechanism=E,E||this.lj())}atomicMaterialsUpdate(E){this.blockDirtyMechanism=!0;try{E(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(E){this._onDisposeObserver&&this.rj.remove(this._onDisposeObserver),this._onDisposeObserver=this.rj.add(E)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new V.e),this._onBindObservable}set onBind(E){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(E)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new V.e),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new V.e),this._onEffectCreatedObservable}set alphaMode(E){this._alphaMode!==E&&(this._alphaMode=E,this.ah(g.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(E){this._needDepthPrePass!==E&&(this._needDepthPrePass=E,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(E){this._fogEnabled!==E&&(this._fogEnabled=E,this.ah(g.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case g.WireFrameFillMode:case g.LineListDrawMode:case g.LineLoopDrawMode:case g.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(E){this.fillMode=E?g.WireFrameFillMode:g.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case g.PointFillMode:case g.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(E){this.fillMode=E?g.PointFillMode:g.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(E){this._fillMode!==E&&(this._fillMode=E,this.ah(g.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(E){const b=this.va().getEngine().getCaps().fragmentDepthSupported;E&&!b&&s.c.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=E&&b,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(E){this._drawWrapper=E}constructor(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.rj=new V.e,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new u,this._useUBO=!1,this._fillMode=g.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._forceAlphaTest=!1,this._transparencyMode=null,this.name=E;const k=b||l.b.LastCreatedScene;k&&(this._scene=k,this._dirtyCallbacks={},this._forceGLSL=a,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[63]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=E||G.g.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new B.c(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new v.d(this._scene.getEngine(),void 0,void 0,E),this._useUBO=this.va().getEngine().supportsUniformBuffers,this._createUniformBuffer(),h||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),g.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var E;const b=this.va().getEngine();null===(E=this._uniformBuffer)||void 0===E||E.dispose(),b.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new v.d(b,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new v.d(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(E){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.lj(),this.checkReadyOnlyOnce=!0}unfreeze(){this.lj(),this.checkReadyOnlyOnce=!1}isReady(E,b){return!0}isReadyForSubMesh(E,b,h){const a=b.materialDefines;return!!a&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=a,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}va(){return this._scene}_getEffectiveOrientation(E){return null!==this.sideOrientation?this.sideOrientation:E.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(E){this._transparencyMode!==E&&(this._transparencyMode=E,this._forceAlphaTest=E===g.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _disableAlphaBlending(){return this._transparencyMode===g.MATERIAL_OPAQUE||this._transparencyMode===g.MATERIAL_ALPHATEST}needAlphaBlending(){return!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(E){return E.visibility<1||!this._disableAlphaBlending&&(E.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._forceAlphaTest}_shouldTurnAlphaTestOn(E){return!this.needAlphaBlendingForMesh(E)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}lj(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b=this.va().meshes;for(const h of b)if(h.wg)for(const b of h.wg)if(b.Ha()===this)for(const h of b._drawWrappers)h&&this._materialContext===h.materialContext&&(h._wasPreviouslyReady=!1,h._wasPreviouslyUsingInstances=null,h._forceRebindOnNextCall=E);E&&this.ah(g.AllDirtyFlag)}_preBind(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=this._scene.getEngine(),a=(null==b?this.sideOrientation:b)===g.ClockWiseSideOrientation;return h.enableEffect(E||this._getDrawWrapper()),h.setState(this.xh,this.zOffset,!1,a,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),a}bind(E,b){}buildUniformLayout(){const E=this._uniformBuffer;this._eventInfo.ubo=E,this._callbackPluginEventGeneric(8,this._eventInfo),E.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(E,b,h){const a=h._drawWrapper;this._eventInfo.subMesh=h,this._callbackPluginEventBindForSubMesh(this._eventInfo),a._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(E){}bindView(E){this._useUBO?this._needToBindSceneUbo=!0:E.setMatrix("view",this.va().getViewMatrix())}bindViewProjection(E){this._useUBO?this._needToBindSceneUbo=!0:(E.setMatrix("viewProjection",this.va().getTransformMatrix()),E.setMatrix("projection",this.va().getProjectionMatrix()))}bindEyePosition(E,b){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(E,b)}_afterBind(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&b&&(this._needToBindSceneUbo=!1,(0,D.r)(b,this.va().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=E?E.visibility:1,this._onBindObservable&&E&&this._onBindObservable.notifyObservers(E),this.disableDepthWrite){const E=this._scene.getEngine();this._cachedDepthWriteState=E.getDepthWrite(),E.setDepthWrite(!1)}if(this.disableColorWrite){const E=this._scene.getEngine();this._cachedColorWriteState=E.getColorWrite(),E.setColorWrite(!1)}if(0!==this.depthFunction){const E=this._scene.getEngine();this._cachedDepthFunctionState=E.getDepthFunction()||0,E.setDepthFunction(this.depthFunction)}}unbind(){if(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(E){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=E,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(E){return null}_clonePlugins(E,b){const h={};if(this._serializePlugins(h),g._ParsePlugins(h,E,this._scene,b),this.pluginManager)for(const a of this.pluginManager._plugins){const b=E.pluginManager.getPlugin(a.name);b&&a.copyTo(b)}}getBindedMeshes(){if(this.meshMap){const E=[];for(const b in this.meshMap){const h=this.meshMap[b];h&&E.push(h)}return E}return this._scene.meshes.filter((E=>E.material===this))}forceCompilation(E,b,h,a){const k={clipPlane:!1,useInstances:!1,...h},G=this.va(),V=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const l=()=>{if(!this._scene||!this._scene.getEngine())return;const h=G.clipPlane;if(k.clipPlane&&(G.clipPlane=new U.c(0,0,0,1)),this._storeEffectOnSubMeshes){let h=!0,G=null;if(E.wg){const b=new O.b(0,0,0,0,0,E,void 0,!1,!1);b.materialDefines&&(b.materialDefines._renderId=-1),this.isReadyForSubMesh(E,b,k.useInstances)||(b.effect&&b.effect.getCompilationError()&&b.effect.allFallbacksProcessed()?G=b.effect.getCompilationError():(h=!1,setTimeout(l,16)))}h&&(this.allowShaderHotSwapping=V,G&&a&&a(G),b&&b(this))}else this.isReady()?(this.allowShaderHotSwapping=V,b&&b(this)):setTimeout(l,16);k.clipPlane&&(G.clipPlane=h)};l()}forceCompilationAsync(E,b){return new Promise(((h,a)=>{this.forceCompilation(E,(()=>{h()}),b,(E=>{a(E)}))}))}ah(E){this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(g._DirtyCallbackArray.length=0,E&g.TextureDirtyFlag&&g._DirtyCallbackArray.push(g._TextureDirtyCallBack),E&g.LightDirtyFlag&&g._DirtyCallbackArray.push(g._LightsDirtyCallBack),E&g.FresnelDirtyFlag&&g._DirtyCallbackArray.push(g._FresnelDirtyCallBack),E&g.AttributesDirtyFlag&&g._DirtyCallbackArray.push(g._AttributeDirtyCallBack),E&g.MiscDirtyFlag&&g._DirtyCallbackArray.push(g._MiscDirtyCallBack),E&g.PrePassDirtyFlag&&g._DirtyCallbackArray.push(g._PrePassDirtyCallBack),g._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(g._RunDirtyCallBacks),this.va().resetCachedMaterial())}resetDrawCache(){const E=this.va().meshes;for(const b of E)if(b.wg)for(const E of b.wg)E.Ha()===this&&E.resetDrawCache()}_markAllSubMeshesAsDirty(E){if(this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const b=this.va().meshes;for(const h of b)if(h.wg)for(const b of h.wg)if(b.Ha(!1)===this)for(const h of b._drawWrappers)h&&h.defines&&h.defines.markAllAsDirty&&this._materialContext===h.materialContext&&E(h.defines)}_markScenePrePassDirty(){if(this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const E=this.va().enablePrePassRenderer();E&&E.ah()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(g._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(g._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(g._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(g._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(g._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(g._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(g._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(g._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(g._MiscDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(g._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const E=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.rj.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(E)}))}}setPrePassRenderer(E){return!1}dispose(E,b,h){const a=this.va();if(a.stopAnimation(this),a.freeProcessedMaterials(),a.removeMaterial(this),this._eventInfo.forceDisposeTextures=b,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const E=this._parentContainer.materials.indexOf(this);E>-1&&this._parentContainer.materials.splice(E,1),this._parentContainer=null}if(!0!==h)if(this.meshMap)for(const k in this.meshMap){const b=this.meshMap[k];b&&(b.material=null,this.releaseVertexArrayObject(b,E))}else{const b=a.meshes;for(const h of b)h.material!==this||h.sourceMesh||(h.material=null,this.releaseVertexArrayObject(h,E))}this._uniformBuffer.dispose(),E&&this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.rj.notifyObservers(this),this.rj.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}releaseVertexArrayObject(E,b){const h=E.Lj;if(h)if(this._storeEffectOnSubMeshes){if(E.wg)for(const a of E.wg)h._releaseVertexArrayObject(a.effect),b&&a.effect&&a.effect.dispose()}else h._releaseVertexArrayObject(this._drawWrapper.effect)}serialize(){const E=o.e.Serialize(this);return E.stencil=this.stencil.serialize(),E.uniqueId=this.uniqueId,this._serializePlugins(E),E}_serializePlugins(E){if(E.plugins={},this.pluginManager)for(const b of this.pluginManager._plugins)E.plugins[b.getClassName()]=b.serialize()}static Parse(E,b,h){if(E.customType){if("BABYLON.PBRMaterial"===E.customType&&E.overloadedAlbedo&&(E.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return s.c.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else E.customType="BABYLON.StandardMaterial";const a=G.g.Instantiate(E.customType).Parse(E,b,h);return a._loadedUniqueId=E.uniqueId,a}static _ParsePlugins(E,b,h,a){if(E.plugins)for(const l in E.plugins){var k,V;const O=E.plugins[l];let v=null===(k=b.pluginManager)||void 0===k?void 0:k.getPlugin(O.name);if(!v){const E=G.g.Instantiate("BABYLON."+l);E&&(v=new E(b))}null===(V=v)||void 0===V||V.parse(O,h,a)}}}g.TriangleFillMode=0,g.WireFrameFillMode=1,g.PointFillMode=2,g.PointListDrawMode=3,g.LineListDrawMode=4,g.LineLoopDrawMode=5,g.LineStripDrawMode=6,g.TriangleStripDrawMode=7,g.TriangleFanDrawMode=8,g.ClockWiseSideOrientation=0,g.CounterClockWiseSideOrientation=1,g.TextureDirtyFlag=1,g.LightDirtyFlag=2,g.FresnelDirtyFlag=4,g.AttributesDirtyFlag=8,g.MiscDirtyFlag=16,g.PrePassDirtyFlag=32,g.AllDirtyFlag=63,g.MATERIAL_OPAQUE=0,g.MATERIAL_ALPHATEST=1,g.MATERIAL_ALPHABLEND=2,g.MATERIAL_ALPHATESTANDBLEND=3,g.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,g.MATERIAL_NORMALBLENDMETHOD_RNM=1,g.OnEventObservable=new V.e,g._AllDirtyCallBack=E=>E.markAllAsDirty(),g._ImageProcessingDirtyCallBack=E=>E.markAsImageProcessingDirty(),g._TextureDirtyCallBack=E=>E.markAsTexturesDirty(),g._FresnelDirtyCallBack=E=>E.markAsFresnelDirty(),g._MiscDirtyCallBack=E=>E.markAsMiscDirty(),g._PrePassDirtyCallBack=E=>E.markAsPrePassDirty(),g._LightsDirtyCallBack=E=>E.markAsLightDirty(),g._AttributeDirtyCallBack=E=>E.markAsAttributesDirty(),g._FresnelAndMiscDirtyCallBack=E=>{g._FresnelDirtyCallBack(E),g._MiscDirtyCallBack(E)},g._TextureAndMiscDirtyCallBack=E=>{g._TextureDirtyCallBack(E),g._MiscDirtyCallBack(E)},g._DirtyCallbackArray=[],g._RunDirtyCallBacks=E=>{for(const b of g._DirtyCallbackArray)b(E)},(0,a.d)([(0,k.H)()],g.prototype,"id",void 0),(0,a.d)([(0,k.H)()],g.prototype,"uniqueId",void 0),(0,a.d)([(0,k.H)()],g.prototype,"name",void 0),(0,a.d)([(0,k.H)()],g.prototype,"metadata",void 0),(0,a.d)([(0,k.H)()],g.prototype,"checkReadyOnEveryCall",void 0),(0,a.d)([(0,k.H)()],g.prototype,"checkReadyOnlyOnce",void 0),(0,a.d)([(0,k.H)()],g.prototype,"state",void 0),(0,a.d)([(0,k.H)("alpha")],g.prototype,"_alpha",void 0),(0,a.d)([(0,k.H)("xh")],g.prototype,"_backFaceCulling",void 0),(0,a.d)([(0,k.H)("cullBackFaces")],g.prototype,"_cullBackFaces",void 0),(0,a.d)([(0,k.H)()],g.prototype,"sideOrientation",void 0),(0,a.d)([(0,k.H)("alphaMode")],g.prototype,"_alphaMode",void 0),(0,a.d)([(0,k.H)()],g.prototype,"_needDepthPrePass",void 0),(0,a.d)([(0,k.H)()],g.prototype,"disableDepthWrite",void 0),(0,a.d)([(0,k.H)()],g.prototype,"disableColorWrite",void 0),(0,a.d)([(0,k.H)()],g.prototype,"forceDepthWrite",void 0),(0,a.d)([(0,k.H)()],g.prototype,"depthFunction",void 0),(0,a.d)([(0,k.H)()],g.prototype,"separateCullingPass",void 0),(0,a.d)([(0,k.H)("fogEnabled")],g.prototype,"_fogEnabled",void 0),(0,a.d)([(0,k.H)()],g.prototype,"pointSize",void 0),(0,a.d)([(0,k.H)()],g.prototype,"zOffset",void 0),(0,a.d)([(0,k.H)()],g.prototype,"zOffsetUnits",void 0),(0,a.d)([(0,k.H)()],g.prototype,"pointsCloud",null),(0,a.d)([(0,k.H)()],g.prototype,"fillMode",null),(0,a.d)([(0,k.H)()],g.prototype,"useLogarithmicDepth",null),(0,a.d)([(0,k.H)()],g.prototype,"transparencyMode",null)},11366:(E,b,h)=>{"use strict";h.d(b,{c:()=>a});class a{constructor(E){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=E,E)for(const b in E)Object.prototype.hasOwnProperty.call(E,b)&&this._setDefaultValue(b)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!1,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||E,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const E of Object.keys(this))"_"!==E[0]&&this._keys.push(E);if(this._externalProperties)for(const E in this._externalProperties)-1===this._keys.indexOf(E)&&this._keys.push(E)}isEqual(E){if(this._keys.length!==E._keys.length)return!1;for(let b=0;b<this._keys.length;b++){const h=this._keys[b];if(this[h]!==E[h])return!1}return!0}cloneTo(E){this._keys.length!==E._keys.length&&(E._keys=this._keys.slice(0));for(let b=0;b<this._keys.length;b++){const h=this._keys[b];E[h]=this[h]}}reset(){this._keys.forEach((E=>this._setDefaultValue(E)))}_setDefaultValue(E){var b,h,a,k;const G=(null===(b=this._externalProperties)||void 0===b||null===(h=b[E])||void 0===h?void 0:h.type)??typeof this[E],V=null===(a=this._externalProperties)||void 0===a||null===(k=a[E])||void 0===k?void 0:k.default;switch(G){case"number":this[E]=V??0;break;case"string":this[E]=V??"";break;default:this[E]=V??!1}}toString(){let E="";for(let b=0;b<this._keys.length;b++){const h=this._keys[b],a=this[h];switch(typeof a){case"number":case"string":E+="#define "+h+" "+a+"\n";break;default:a&&(E+="#define "+h+"\n")}}return E}}},11393:(E,b,h)=>{"use strict";h.d(b,{c:()=>k});var a=h(10902);class k{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(E){this._DiffuseTextureEnabled!==E&&(this._DiffuseTextureEnabled=E,a.d.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(E){this._DetailTextureEnabled!==E&&(this._DetailTextureEnabled=E,a.d.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(E){this._DecalMapEnabled!==E&&(this._DecalMapEnabled=E,a.d.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(E){this._AmbientTextureEnabled!==E&&(this._AmbientTextureEnabled=E,a.d.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(E){this._OpacityTextureEnabled!==E&&(this._OpacityTextureEnabled=E,a.d.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(E){this._ReflectionTextureEnabled!==E&&(this._ReflectionTextureEnabled=E,a.d.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(E){this._EmissiveTextureEnabled!==E&&(this._EmissiveTextureEnabled=E,a.d.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(E){this._SpecularTextureEnabled!==E&&(this._SpecularTextureEnabled=E,a.d.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(E){this._BumpTextureEnabled!==E&&(this._BumpTextureEnabled=E,a.d.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(E){this._LightmapTextureEnabled!==E&&(this._LightmapTextureEnabled=E,a.d.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(E){this._RefractionTextureEnabled!==E&&(this._RefractionTextureEnabled=E,a.d.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(E){this._ColorGradingTextureEnabled!==E&&(this._ColorGradingTextureEnabled=E,a.d.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(E){this._FresnelEnabled!==E&&(this._FresnelEnabled=E,a.d.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(E){this._ClearCoatTextureEnabled!==E&&(this._ClearCoatTextureEnabled=E,a.d.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(E){this._ClearCoatBumpTextureEnabled!==E&&(this._ClearCoatBumpTextureEnabled=E,a.d.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(E){this._ClearCoatTintTextureEnabled!==E&&(this._ClearCoatTintTextureEnabled=E,a.d.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(E){this._SheenTextureEnabled!==E&&(this._SheenTextureEnabled=E,a.d.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(E){this._AnisotropicTextureEnabled!==E&&(this._AnisotropicTextureEnabled=E,a.d.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(E){this._ThicknessTextureEnabled!==E&&(this._ThicknessTextureEnabled=E,a.d.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(E){this._RefractionIntensityTextureEnabled!==E&&(this._RefractionIntensityTextureEnabled=E,a.d.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(E){this._TranslucencyIntensityTextureEnabled!==E&&(this._TranslucencyIntensityTextureEnabled=E,a.d.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(E){this._TranslucencyColorTextureEnabled!==E&&(this._TranslucencyColorTextureEnabled=E,a.d.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(E){this._IridescenceTextureEnabled!==E&&(this._IridescenceTextureEnabled=E,a.d.MarkAllMaterialsAsDirty(1))}}k._DiffuseTextureEnabled=!0,k._DetailTextureEnabled=!0,k._DecalMapEnabled=!0,k._AmbientTextureEnabled=!0,k._OpacityTextureEnabled=!0,k._ReflectionTextureEnabled=!0,k._EmissiveTextureEnabled=!0,k._SpecularTextureEnabled=!0,k._BumpTextureEnabled=!0,k._LightmapTextureEnabled=!0,k._RefractionTextureEnabled=!0,k._ColorGradingTextureEnabled=!0,k._FresnelEnabled=!0,k._ClearCoatTextureEnabled=!0,k._ClearCoatBumpTextureEnabled=!0,k._ClearCoatTintTextureEnabled=!0,k._SheenTextureEnabled=!0,k._AnisotropicTextureEnabled=!0,k._ThicknessTextureEnabled=!0,k._RefractionIntensityTextureEnabled=!0,k._TranslucencyIntensityTextureEnabled=!0,k._TranslucencyColorTextureEnabled=!0,k._IridescenceTextureEnabled=!0},11351:(E,b,h)=>{"use strict";h.d(b,{$:()=>B,A:()=>P,D:()=>A,E:()=>U,H:()=>Y,J:()=>Z,L:()=>c,N:()=>D,R:()=>d,S:()=>r,V:()=>w,Y:()=>N,Z:()=>f,e:()=>M,f:()=>s,i:()=>j,m:()=>v,n:()=>o,r:()=>u,t:()=>g,w:()=>n,z:()=>S});var a=h(10834),k=h(11201),G=h(10869),V=h(11302),l=h(11357);const O=k.b.Black();function v(E,b,h){if(!E||E.LOGARITHMICDEPTH||E.indexOf&&E.indexOf("LOGARITHMICDEPTH")>=0){const E=h.activeCamera;1===E.mode&&a.c.Error("Logarithmic depth is not compatible with orthographic cameras!",20),b.setFloat("logarithmicDepthConstant",2/(Math.log(E.maxZ+1)/Math.LN2))}}function s(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];h&&E.fogEnabled&&(!b||b.applyFog)&&0!==E.fogMode&&(h.setFloat4("vFogInfos",E.fogMode,E.fogStart,E.fogEnd,E.fogDensity),a?(E.fogColor.toLinearSpaceToRef(O,E.getEngine().useExactSrgbConversions),h.setColor3("vFogColor",O)):h.setColor3("vFogColor",E.fogColor))}function U(E,b,h){const k=h.NUM_MORPH_INFLUENCERS;if(k>0&&G.b.LastCreatedEngine){const V=G.b.LastCreatedEngine.getCaps().maxVertexAttribs,l=b.morphTargetManager;if(null!==l&&void 0!==l&&l.isUsingTextureForTargets)return;const O=l&&l.supportsNormals&&h.NORMAL,v=l&&l.supportsTangents&&h.TANGENT,s=l&&l.supportsUVs&&h.UV1;for(let h=0;h<k;h++)E.push("position"+h),O&&E.push("normal"+h),v&&E.push("tangent"+h),s&&E.push("uv_"+h),E.length>V&&a.c.Error("Cannot add more vertex attributes for mesh "+b.name)}}function B(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];E.push("world0"),E.push("world1"),E.push("world2"),E.push("world3"),b&&(E.push("previousWorld0"),E.push("previousWorld1"),E.push("previousWorld2"),E.push("previousWorld3"))}function o(E,b){const h=E.morphTargetManager;E&&h&&b.setFloatArray("morphTargetInfluences",h.influences)}function u(E,b){b.bindToEffect(E,"Scene")}function D(E,b,h){b._needUVs=!0,b[h]=!0,E.optimizeUVAllocation&&E.getTextureMatrix().isIdentityAs3x2()?(b[h+"DIRECTUV"]=E.coordinatesIndex+1,b["MAINUV"+(E.coordinatesIndex+1)]=!0):b[h+"DIRECTUV"]=0}function g(E,b,h){const a=E.getTextureMatrix();b.Pj(h+"Matrix",a)}function S(E,b,h){h.BAKED_VERTEX_ANIMATION_TEXTURE&&h.INSTANCES&&E.push("bakedVertexAnimationSettingsInstanced")}function M(E,b,h){var a;if(b&&E&&(E.computeBonesUsingShaders&&b._bonesComputationForcedToCPU&&(E.computeBonesUsingShaders=!1),E.useBones&&E.computeBonesUsingShaders&&E.skeleton)){const k=E.skeleton;if(k.isUsingTextureForMatrices&&b.getUniformIndex("boneTextureWidth")>-1){const h=k.getTransformMatrixTexture(E);b.setTexture("boneSampler",h),b.setFloat("boneTextureWidth",4*(k.bones.length+1))}else{const G=k.getTransformMatrices(E);G&&(b.setMatrices("mBones",G),h&&E.va().prePassRenderer&&E.va().prePassRenderer.getIndex(2)&&(h.previousBones[E.uniqueId]||(h.previousBones[E.uniqueId]=G.slice()),b.setMatrices("mPreviousBones",h.previousBones[E.uniqueId]),a=G,h.previousBones[E.uniqueId].set(a)))}}}function I(E,b,h,a,k){let G=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];E._bindLight(b,h,a,k,G)}function j(E,b,h,a){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const G=Math.min(b.lightSources.length,k);for(let V=0;V<G;V++){I(b.lightSources[V],V,E,h,"boolean"===typeof a?a:a.SPECULARTERM,b.receiveShadows)}}function P(E,b,h,a){h.NUM_BONE_INFLUENCERS>0&&(a.addCPUSkinningFallback(0,b),E.push("matricesIndices"),E.push("matricesWeights"),h.NUM_BONE_INFLUENCERS>4&&(E.push("matricesIndicesExtra"),E.push("matricesWeightsExtra")))}function A(E,b){(b.INSTANCES||b.THIN_INSTANCES)&&B(E,!!b.PREPASS_VELOCITY),b.INSTANCESCOLOR&&E.push("instanceColor")}function n(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,k=0;for(let G=0;G<h&&E["LIGHT"+G];G++)G>0&&(k=a+G,b.addFallback(k,"LIGHT"+G)),E.SHADOWS||(E["SHADOW"+G]&&b.addFallback(a,"SHADOW"+G),E["SHADOWPCF"+G]&&b.addFallback(a,"SHADOWPCF"+G),E["SHADOWPCSS"+G]&&b.addFallback(a,"SHADOWPCSS"+G),E["SHADOWPOISSON"+G]&&b.addFallback(a,"SHADOWPOISSON"+G),E["SHADOWESM"+G]&&b.addFallback(a,"SHADOWESM"+G),E["SHADOWCLOSEESM"+G]&&b.addFallback(a,"SHADOWCLOSEESM"+G));return k++}function d(E,b,h,a,k,G,V){let l=arguments.length>7&&void 0!==arguments[7]&&arguments[7];V._areMiscDirty&&(V.LOGARITHMICDEPTH=h,V.POINTSIZE=a,V.FOG=k&&function(E,b){return b.fogEnabled&&E.applyFog&&0!==b.fogMode}(E,b),V.NONUNIFORMSCALING=E.nonUniformScaling,V.ALPHATEST=G,V.DECAL_AFTER_DETAIL=l)}function c(E,b,h,a){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,G=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!h._areLightsDirty)return h._needNormals;let V=0;const l={needNormals:h._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(E.lightsEnabled&&!G)for(const v of b.lightSources)if(z(E,b,v,V,h,a,l),V++,V===k)break;h.SPECULARTERM=l.specularEnabled,h.SHADOWS=l.shadowEnabled;for(let v=V;v<k;v++)void 0!==h["LIGHT"+v]&&(h["LIGHT"+v]=!1,h["HEMILIGHT"+v]=!1,h["POINTLIGHT"+v]=!1,h["DIRLIGHT"+v]=!1,h["SPOTLIGHT"+v]=!1,h["SHADOW"+v]=!1,h["SHADOWCSM"+v]=!1,h["SHADOWCSMDEBUG"+v]=!1,h["SHADOWCSMNUM_CASCADES"+v]=!1,h["SHADOWCSMUSESHADOWMAXZ"+v]=!1,h["SHADOWCSMNOBLEND"+v]=!1,h["SHADOWCSM_RIGHTHANDED"+v]=!1,h["SHADOWPCF"+v]=!1,h["SHADOWPCSS"+v]=!1,h["SHADOWPOISSON"+v]=!1,h["SHADOWESM"+v]=!1,h["SHADOWCLOSEESM"+v]=!1,h["SHADOWCUBE"+v]=!1,h["SHADOWLOWQUALITY"+v]=!1,h["SHADOWMEDIUMQUALITY"+v]=!1);const O=E.getEngine().getCaps();return void 0===h.SHADOWFLOAT&&(l.needRebuild=!0),h.SHADOWFLOAT=l.shadowEnabled&&(O.textureFloatRender&&O.textureFloatLinearFiltering||O.textureHalfFloatRender&&O.textureHalfFloatLinearFiltering),h.LIGHTMAPEXCLUDED=l.lightmapMode,l.needRebuild&&h.rebuild(),l.needNormals}function z(E,b,h,a,k,G,l){switch(l.needNormals=!0,void 0===k["LIGHT"+a]&&(l.needRebuild=!0),k["LIGHT"+a]=!0,k["SPOTLIGHT"+a]=!1,k["HEMILIGHT"+a]=!1,k["POINTLIGHT"+a]=!1,k["DIRLIGHT"+a]=!1,h.prepareLightSpecificDefines(k,a),k["LIGHT_FALLOFF_PHYSICAL"+a]=!1,k["LIGHT_FALLOFF_GLTF"+a]=!1,k["LIGHT_FALLOFF_STANDARD"+a]=!1,h.falloffType){case V.c.FALLOFF_GLTF:k["LIGHT_FALLOFF_GLTF"+a]=!0;break;case V.c.FALLOFF_PHYSICAL:k["LIGHT_FALLOFF_PHYSICAL"+a]=!0;break;case V.c.FALLOFF_STANDARD:k["LIGHT_FALLOFF_STANDARD"+a]=!0}if(G&&!h.Lh.equalsFloats(0,0,0)&&(l.specularEnabled=!0),k["SHADOW"+a]=!1,k["SHADOWCSM"+a]=!1,k["SHADOWCSMDEBUG"+a]=!1,k["SHADOWCSMNUM_CASCADES"+a]=!1,k["SHADOWCSMUSESHADOWMAXZ"+a]=!1,k["SHADOWCSMNOBLEND"+a]=!1,k["SHADOWCSM_RIGHTHANDED"+a]=!1,k["SHADOWPCF"+a]=!1,k["SHADOWPCSS"+a]=!1,k["SHADOWPOISSON"+a]=!1,k["SHADOWESM"+a]=!1,k["SHADOWCLOSEESM"+a]=!1,k["SHADOWCUBE"+a]=!1,k["SHADOWLOWQUALITY"+a]=!1,k["SHADOWMEDIUMQUALITY"+a]=!1,b&&b.receiveShadows&&E.shadowsEnabled&&h.shadowEnabled){const b=h.getShadowGenerator(E.activeCamera)??h.getShadowGenerator();if(b){const E=b.getShadowMap();E&&E.renderList&&E.renderList.length>0&&(l.shadowEnabled=!0,b.prepareDefines(k,a))}}h.lightmapMode!=V.c.LIGHTMAP_DEFAULT?(l.lightmapMode=!0,k["LIGHTMAPEXCLUDED"+a]=!0,k["LIGHTMAPNOSPECULAR"+a]=h.lightmapMode==V.c.LIGHTMAP_SHADOWSONLY):(k["LIGHTMAPEXCLUDED"+a]=!1,k["LIGHTMAPNOSPECULAR"+a]=!1)}function Z(E,b,h,a,k){let G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6&&void 0!==arguments[6]&&arguments[6],O=function(E,b){let h=!1;if(E.activeCamera){const a=b.CAMERA_ORTHOGRAPHIC?1:0,k=b.CAMERA_PERSPECTIVE?1:0,G=1===E.activeCamera.mode?1:0,V=0===E.activeCamera.mode?1:0;(a^G||k^V)&&(b.CAMERA_ORTHOGRAPHIC=1===G,b.CAMERA_PERSPECTIVE=1===V,h=!0)}return h}(E,a);!1!==G&&(O=(0,l.g)(h,E,a)),a.DEPTHPREPASS!==!b.getColorWrite()&&(a.DEPTHPREPASS=!a.DEPTHPREPASS,O=!0),a.INSTANCES!==k&&(a.INSTANCES=k,O=!0),a.THIN_INSTANCES!==V&&(a.THIN_INSTANCES=V,O=!0),O&&a.markAsUnprocessed()}function Y(E,b,h,a){let k=arguments.length>4&&void 0!==arguments[4]&&arguments[4],G=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],V=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!b._areAttributesDirty&&b._needNormals===b._normals&&b._needUVs===b._uvs)return!1;b._normals=b._needNormals,b._uvs=b._needUVs,b.NORMAL=b._needNormals&&E.isVerticesDataPresent("normal"),b._needNormals&&E.isVerticesDataPresent("tangent")&&(b.TANGENT=!0);for(let l=1;l<=6;++l)b["UV"+l]=!!b._needUVs&&E.isVerticesDataPresent(`uv${1===l?"":l}`);if(h){const h=E.useVertexColors&&E.isVerticesDataPresent("color");b.VERTEXCOLOR=h,b.VERTEXALPHA=E.hasVertexAlpha&&h&&G}return E.isVerticesDataPresent("instanceColor")&&(E.hasInstances||E.hasThinInstances)&&(b.INSTANCESCOLOR=!0),a&&function(E,b){if(E.useBones&&E.computeBonesUsingShaders&&E.skeleton){b.NUM_BONE_INFLUENCERS=E.numBoneInfluencers;const h=void 0!==b.BONETEXTURE;if(E.skeleton.isUsingTextureForMatrices&&h)b.BONETEXTURE=!0;else{b.BonesPerMesh=E.skeleton.bones.length+1,b.BONETEXTURE=!h&&void 0;const a=E.va().prePassRenderer;if(a&&a.enabled){const h=-1===a.excludedSkinnedMesh.indexOf(E);b.BONES_VELOCITY_ENABLED=h}}}else b.NUM_BONE_INFLUENCERS=0,b.BonesPerMesh=0,void 0!==b.BONETEXTURE&&(b.BONETEXTURE=!1)}(E,b),k&&function(E,b){const h=E.morphTargetManager;h?(b.MORPHTARGETS_UV=h.supportsUVs&&b.UV1,b.MORPHTARGETS_TANGENT=h.supportsTangents&&b.TANGENT,b.MORPHTARGETS_NORMAL=h.supportsNormals&&b.NORMAL,b.NUM_MORPH_INFLUENCERS=h.numMaxInfluencers||h.numInfluencers,b.MORPHTARGETS=b.NUM_MORPH_INFLUENCERS>0,b.MORPHTARGETS_TEXTURE=h.isUsingTextureForTargets):(b.MORPHTARGETS_UV=!1,b.MORPHTARGETS_TANGENT=!1,b.MORPHTARGETS_NORMAL=!1,b.MORPHTARGETS=!1,b.NUM_MORPH_INFLUENCERS=0)}(E,b),V&&function(E,b){const h=E.bakedVertexAnimationManager;b.BAKED_VERTEX_ANIMATION_TEXTURE=!(!h||!h.isEnabled)}(E,b),!0}function r(E,b){if(E.activeCamera){const h=b.MULTIVIEW;b.MULTIVIEW=null!==E.activeCamera.outputRenderTarget&&E.activeCamera.outputRenderTarget.getViewCount()>1,b.MULTIVIEW!=h&&b.markAsUnprocessed()}}function w(E,b,h){const a=b.ORDER_INDEPENDENT_TRANSPARENCY,k=b.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;b.ORDER_INDEPENDENT_TRANSPARENCY=E.useOrderIndependentTransparency&&h,b.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!E.getEngine().getCaps().textureFloatLinearFiltering,a===b.ORDER_INDEPENDENT_TRANSPARENCY&&k===b.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||b.markAsUnprocessed()}function N(E,b,h){const a=b.PREPASS;if(!b._arePrePassDirty)return;const k=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(E.prePassRenderer&&E.prePassRenderer.enabled&&h){b.PREPASS=!0,b.SCENE_MRT_COUNT=E.prePassRenderer.mrtCount,b.PREPASS_NORMAL_WORLDSPACE=E.prePassRenderer.generateNormalsInWorldSpace,b.PREPASS_COLOR=!0,b.PREPASS_COLOR_INDEX=0;for(let h=0;h<k.length;h++){const a=E.prePassRenderer.getIndex(k[h].type);-1!==a?(b[k[h].define]=!0,b[k[h].index]=a):b[k[h].define]=!1}}else{b.PREPASS=!1;for(let E=0;E<k.length;E++)b[k[E].define]=!1}b.PREPASS!=a&&(b.markAsUnprocessed(),b.markAsImageProcessingDirty())}function H(E,b,h,a){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]&&arguments[5];k&&k.push("Light"+E),G||(b.push("vLightData"+E,"vLightDiffuse"+E,"vLightSpecular"+E,"vLightDirection"+E,"vLightFalloff"+E,"vLightGround"+E,"lightMatrix"+E,"shadowsInfo"+E,"depthValues"+E),h.push("shadowTexture"+E),h.push("depthTexture"+E),b.push("viewFrustumZ"+E,"cascadeBlendFactor"+E,"lightSizeUVCorrection"+E,"depthCorrection"+E,"penumbraDarkness"+E,"frustumLengths"+E),a&&(h.push("projectionLightTexture"+E),b.push("textureProjectionMatrix"+E)))}function f(E,b,h){let a,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4,G=null;if(E.uniformsNames){const V=E;a=V.uniformsNames,G=V.uniformBuffersNames,b=V.samplers,h=V.defines,k=V.maxSimultaneousLights||0}else a=E,b||(b=[]);for(let V=0;V<k&&h["LIGHT"+V];V++)H(V,a,b,h["PROJECTEDLIGHTTEXTURE"+V],G);h.NUM_MORPH_INFLUENCERS&&(a.push("morphTargetInfluences"),a.push("morphTargetCount")),h.BAKED_VERTEX_ANIMATION_TEXTURE&&(a.push("bakedVertexAnimationSettings"),a.push("bakedVertexAnimationTextureSizeInverted"),a.push("bakedVertexAnimationTime"),b.push("bakedVertexAnimationTexture"))}},11413:(E,b,h)=>{"use strict";h.d(b,{d:()=>G});var a,k=h(11175);!function(E){E[E.Zero=0]="Zero",E[E.One=1]="One",E[E.MaxViewZ=2]="MaxViewZ"}(a||(a={}));class G{static CreateConfiguration(E){return G._Configurations[E]={defines:{},previousWorldMatrices:{},previousViewProjection:k.d.Zero(),currentViewProjection:k.d.Zero(),previousBones:{},lastUpdateFrameId:-1,excludedSkinnedMesh:[]},G._Configurations[E]}static DeleteConfiguration(E){delete G._Configurations[E]}static GetConfiguration(E){return G._Configurations[E]}static AddUniformsAndSamplers(E,b){E.push("previousWorld","previousViewProjection","mPreviousBones")}static MarkAsDirty(E,b){for(const h of b)if(h.wg)for(const b of h.wg)b._removeDrawWrapper(E)}static PrepareDefines(E,b,h){if(!h._arePrePassDirty)return;const a=G._Configurations[E];if(!a)return;h.PREPASS=!0,h.PREPASS_COLOR=!1,h.PREPASS_COLOR_INDEX=-1;let k=0;for(let V=0;V<G.GeometryTextureDescriptions.length;V++){const E=G.GeometryTextureDescriptions[V],b=E.define,l=E.defineIndex,O=a.defines[l];void 0!==O?(h[b]=!0,h[l]=O,k++):(h[b]=!1,delete h[l])}h.SCENE_MRT_COUNT=k,h.BONES_VELOCITY_ENABLED=b.useBones&&b.computeBonesUsingShaders&&b.skeleton&&!b.skeleton.isUsingTextureForMatrices&&-1===a.excludedSkinnedMesh.indexOf(b)}static Bind(E,b,h,a){const k=G._Configurations[E];if(k&&(void 0!==k.defines.PREPASS_VELOCITY_INDEX||void 0!==k.defines.PREPASS_VELOCITY_LINEAR_INDEX)){k.previousWorldMatrices[h.uniqueId]||(k.previousWorldMatrices[h.uniqueId]=a.clone());const E=h.va();k.previousViewProjection||(k.previousViewProjection=E.getTransformMatrix().clone(),k.currentViewProjection=E.getTransformMatrix().clone());const G=E.getEngine();if(k.currentViewProjection.updateFlag!==E.getTransformMatrix().updateFlag?(k.lastUpdateFrameId=G.frameId,k.previousViewProjection.p(k.currentViewProjection),k.currentViewProjection.p(E.getTransformMatrix())):k.lastUpdateFrameId!==G.frameId&&(k.lastUpdateFrameId=G.frameId,k.previousViewProjection.p(k.currentViewProjection)),b.setMatrix("previousWorld",k.previousWorldMatrices[h.uniqueId]),b.setMatrix("previousViewProjection",k.previousViewProjection),k.previousWorldMatrices[h.uniqueId]=a.clone(),h.useBones&&h.computeBonesUsingShaders&&h.skeleton){const E=h.skeleton;if(!E.isUsingTextureForMatrices||-1===b.getUniformIndex("boneTextureWidth")){const a=E.getTransformMatrices(h);a&&(k.previousBones[h.uniqueId]||(k.previousBones[h.uniqueId]=a.slice()),b.setMatrices("mPreviousBones",k.previousBones[h.uniqueId]),k.previousBones[h.uniqueId].set(a))}}}}}G.GeometryTextureDescriptions=[{type:0,name:"Irradiance",clearType:0,define:"PREPASS_IRRADIANCE",defineIndex:"PREPASS_IRRADIANCE_INDEX"},{type:1,name:"WorldPosition",clearType:0,define:"PREPASS_POSITION",defineIndex:"PREPASS_POSITION_INDEX"},{type:2,name:"Velocity",clearType:0,define:"PREPASS_VELOCITY",defineIndex:"PREPASS_VELOCITY_INDEX"},{type:3,name:"Reflectivity",clearType:0,define:"PREPASS_REFLECTIVITY",defineIndex:"PREPASS_REFLECTIVITY_INDEX"},{type:5,name:"ViewDepth",clearType:2,define:"PREPASS_DEPTH",defineIndex:"PREPASS_DEPTH_INDEX"},{type:6,name:"ViewNormal",clearType:0,define:"PREPASS_NORMAL",defineIndex:"PREPASS_NORMAL_INDEX"},{type:7,name:"AlbedoSqrt",clearType:0,define:"PREPASS_ALBEDO_SQRT",defineIndex:"PREPASS_ALBEDO_SQRT_INDEX"},{type:8,name:"WorldNormal",clearType:0,define:"PREPASS_WORLD_NORMAL",defineIndex:"PREPASS_WORLD_NORMAL_INDEX"},{type:9,name:"LocalPosition",clearType:0,define:"PREPASS_LOCAL_POSITION",defineIndex:"PREPASS_LOCAL_POSITION_INDEX"},{type:10,name:"ScreenDepth",clearType:1,define:"PREPASS_SCREENSPACE_DEPTH",defineIndex:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:11,name:"LinearVelocity",clearType:0,define:"PREPASS_VELOCITY_LINEAR",defineIndex:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:12,name:"Albedo",clearType:0,define:"PREPASS_ALBEDO",defineIndex:"PREPASS_ALBEDO_INDEX"}],G._Configurations={}},11405:(E,b,h)=>{"use strict";h.d(b,{d:()=>S});var a=h(11130),k=h(11139),G=h(11311),V=h(10869),l=h(10889),O=h(10912);const v=new RegExp("^([gimus]+)!");class s{constructor(E){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=E,this._scene=E.va(),this._engine=this._scene.getEngine()}_addPlugin(E){for(let a=0;a<this._plugins.length;++a)if(this._plugins[a].name===E.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!E.isCompatible(this._material.shaderLanguage))throw`The plugin "${E.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const b=E.getClassName();s._MaterialPluginClassToMainDefine[b]||(s._MaterialPluginClassToMainDefine[b]="MATERIALPLUGIN_"+ ++s._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(E,b)=>this._handlePluginEvent(E,b),this._plugins.push(E),this._plugins.sort(((E,b)=>E.priority-b.priority)),this._codeInjectionPoints={};const h={};h[s._MaterialPluginClassToMainDefine[b]]={type:"boolean",default:!0};for(const a of this._plugins)a.collectDefines(h),this._collectPointNames("vertex",a.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",a.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=h,!0}_activatePlugin(E){-1===this._activePlugins.indexOf(E)&&(this._activePlugins.push(E),this._activePlugins.sort(((E,b)=>E.priority-b.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),E.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(E),this._activePluginsForExtraEvents.sort(((E,b)=>E.priority-b.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(E){for(let b=0;b<this._plugins.length;++b)if(this._plugins[b].name===E)return this._plugins[b];return null}_handlePluginEventIsReadyForSubMesh(E){let b=!0;for(const h of this._activePlugins)b=b&&h.isReadyForSubMesh(E.defines,this._scene,this._engine,E.subMesh);E.isReadyForSubMesh=b}_handlePluginEventPrepareDefinesBeforeAttributes(E){for(const b of this._activePlugins)b.prepareDefinesBeforeAttributes(E.defines,this._scene,E.mesh)}_handlePluginEventPrepareDefines(E){for(const b of this._activePlugins)b.prepareDefines(E.defines,this._scene,E.mesh)}_handlePluginEventHardBindForSubMesh(E){for(const b of this._activePluginsForExtraEvents)b.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,E.subMesh)}_handlePluginEventBindForSubMesh(E){for(const b of this._activePlugins)b.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,E.subMesh)}_handlePluginEventHasRenderTargetTextures(E){let b=!1;for(const h of this._activePluginsForExtraEvents)if(b=h.hasRenderTargetTextures(),b)break;E.hasRenderTargetTextures=b}_handlePluginEventFillRenderTargetTextures(E){for(const b of this._activePluginsForExtraEvents)b.fillRenderTargetTextures(E.renderTargets)}_handlePluginEvent(E,b){switch(E){case 512:{const E=b;for(const b of this._activePlugins)b.getActiveTextures(E.activeTextures);break}case 256:{const E=b;for(const b of this._activePlugins)b.getAnimatables(E.animatables);break}case 1024:{const E=b;let h=!1;for(const b of this._activePlugins)if(h=b.hasTexture(E.texture),h)break;E.hasTexture=h;break}case 2:{const E=b;for(const b of this._plugins)b.dispose(E.forceDisposeTextures);break}case 4:b.defineNames=this._defineNamesFromPlugins;break;case 128:{const E=b;for(const b of this._activePlugins)E.fallbackRank=b.addFallbacks(E.defines,E.fallbacks,E.fallbackRank),b.getAttributes(E.attributes,this._scene,E.mesh);this._uniformList.length>0&&E.uniforms.push(...this._uniformList),this._samplerList.length>0&&E.samplers.push(...this._samplerList),this._uboList.length>0&&E.uniformBuffersNames.push(...this._uboList),E.customCode=this._injectCustomCode(E,E.customCode);break}case 8:{const E=b;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const h=1===this._material.shaderLanguage;for(const b of this._plugins){const a=b.getUniforms(this._material.shaderLanguage);if(a){if(a.ubo)for(const b of a.ubo){if(b.size&&b.type){const a=b.arraySize??0;if(E.ubo.addUniform(b.name,b.size,a),h){let E;switch(b.type){case"mat4":E="mat4x4f";break;case"float":E="f32";break;default:E=`${b.type}f`}this._uboDeclaration+=`uniform ${b.name}: ${E}${a>0?`[${a}]`:""};\n`}else this._uboDeclaration+=`${b.type} ${b.name}${a>0?`[${a}]`:""};\n`}this._uniformList.push(b.name)}a.vertex&&(this._vertexDeclaration+=a.vertex+"\n"),a.fragment&&(this._fragmentDeclaration+=a.fragment+"\n")}b.getSamplers(this._samplerList),b.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(E,b){if(b)for(const h in b)this._codeInjectionPoints[E]||(this._codeInjectionPoints[E]={}),this._codeInjectionPoints[E][h]=!0}_injectCustomCode(E,b){return(h,a)=>{var k;b&&(a=b(h,a)),this._uboDeclaration&&(a=a.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(a=a.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(a=a.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const G=null===(k=this._codeInjectionPoints)||void 0===k?void 0:k[h];if(!G)return a;let V=null;for(let b in G){let k="";for(const a of this._activePlugins){var s;let G=null===(s=a.getCustomCode(h,this._material.shaderLanguage))||void 0===s?void 0:s[b];if(G){if(a.resolveIncludes){if(null===V){const b=0;V={defines:[],indexParameters:E.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:O.d.GetShadersRepository(b),includesShadersStore:O.d.GetIncludesShadersStore(b),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}V.isFragment="fragment"===h,(0,l.m)(G,V,(E=>G=E))}k+=G+"\n"}}if(k.length>0)if("!"===b.charAt(0)){b=b.substring(1);let E="g";if("!"===b.charAt(0))E="",b=b.substring(1);else{const h=v.exec(b);h&&h.length>=2&&(E=h[1],b=b.substring(E.length+1))}E.indexOf("g")<0&&(E+="g");const h=a,G=new RegExp(b,E);let V=G.exec(h);for(;null!==V;){let E=k;for(let b=0;b<V.length;++b)E=E.replace("$"+b,V[b]);a=a.replace(V[0],E),V=G.exec(h)}}else{const E="#define "+b;a=a.replace(E,"\n"+k+"\n"+E)}}return a}}}s._MaterialPluginClassToMainDefine={},s._MaterialPluginCounter=0,V.b.OnEnginesDisposedObservable.add((()=>{u()}));const U=[];let B=!1,o=null;function u(){U.length=0,B=!1,G.c.OnEventObservable.remove(o),o=null}var D=h(11206),g=h(10958);class S{isCompatible(E){return 0===E}_enable(E){E&&this._pluginManager._activatePlugin(this)}constructor(E,b,h,a){let k=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],G=arguments.length>5&&void 0!==arguments[5]&&arguments[5],V=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this._material=E,this.name=b,this.priority=h,this.resolveIncludes=V,E.pluginManager||(E.pluginManager=new s(E),E.rj.add((()=>{E.pluginManager=void 0}))),this._pluginDefineNames=a,this._pluginManager=E.pluginManager,k&&this._pluginManager._addPlugin(this),G&&this._enable(!0),this.markAllDefinesAsDirty=E._dirtyCallbacks[63]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(E,b,h,a){return!0}hardBindForSubMesh(E,b,h,a){}bindForSubMesh(E,b,h,a){}dispose(E){}getCustomCode(E){return null}collectDefines(E){if(this._pluginDefineNames)for(const b of Object.keys(this._pluginDefineNames)){if("_"===b[0])continue;const h=typeof this._pluginDefineNames[b];E[b]={type:"number"===h?"number":"string"===h?"string":"boolean"===h?"boolean":"object",default:this._pluginDefineNames[b]}}}prepareDefinesBeforeAttributes(E,b,h){}prepareDefines(E,b,h){}hasTexture(E){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(E){}getActiveTextures(E){}getAnimatables(E){}addFallbacks(E,b,h){return h}getSamplers(E){}getAttributes(E,b,h){}getUniformBuffersNames(E){}getUniforms(){return{}}copyTo(E){D.e.Clone((()=>E),this)}serialize(){return D.e.Serialize(this)}parse(E,b,h){D.e.Parse((()=>this),E,b,h)}}(0,a.d)([(0,k.H)()],S.prototype,"name",void 0),(0,a.d)([(0,k.H)()],S.prototype,"priority",void 0),(0,a.d)([(0,k.H)()],S.prototype,"resolveIncludes",void 0),(0,a.d)([(0,k.H)()],S.prototype,"registerForExtraEvents",void 0),(0,g.f)("BABYLON.MaterialPluginBase",S)},11473:(E,b,h)=>{"use strict";h.d(b,{b:()=>V});var a=h(11311),k=h(11170),G=h(10958);class V extends a.c{get xg(){return this._subMaterials}set xg(E){this._subMaterials=E,this._hookArray(E)}getChildren(){return this.xg}constructor(E,b){super(E,b,!0),this._waitingSubMaterialsUniqueIds=[],this.va().addMultiMaterial(this),this.xg=[],this._storeEffectOnSubMeshes=!0}_hookArray(E){var b=this;const h=E.push;E.push=function(){for(var a=arguments.length,k=new Array(a),G=0;G<a;G++)k[G]=arguments[G];const V=h.apply(E,k);return b._markAllSubMeshesAsTexturesDirty(),V};const a=E.splice;E.splice=(b,h)=>{const k=a.apply(E,[b,h]);return this._markAllSubMeshesAsTexturesDirty(),k}}getSubMaterial(E){return E<0||E>=this.xg.length?this.va().defaultMaterial:this.xg[E]}getActiveTextures(){return super.getActiveTextures().concat(...this.xg.map((E=>E?E.getActiveTextures():[])))}hasTexture(E){if(super.hasTexture(E))return!0;for(let h=0;h<this.xg.length;h++){var b;if(null!==(b=this.xg[h])&&void 0!==b&&b.hasTexture(E))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(E,b,h){for(let a=0;a<this.xg.length;a++){const k=this.xg[a];if(k){if(k._storeEffectOnSubMeshes){if(!k.isReadyForSubMesh(E,b,h))return!1;continue}if(!k.isReady(E))return!1}}return!0}clone(E,b){const h=new V(E,this.va());for(let a=0;a<this.xg.length;a++){let k=null;const G=this.xg[a];k=b&&G?G.clone(E+"-"+G.name):this.xg[a],h.xg.push(k)}return h}serialize(){const E={};E.name=this.name,E.id=this.id,E.uniqueId=this.uniqueId,k.b&&(E.tags=k.b.GetTags(this)),E.materialsUniqueIds=[],E.materials=[];for(let b=0;b<this.xg.length;b++){const h=this.xg[b];h?(E.materialsUniqueIds.push(h.uniqueId),E.materials.push(h.id)):(E.materialsUniqueIds.push(null),E.materials.push(null))}return E}dispose(E,b,h){const a=this.va();if(!a)return;if(h)for(let G=0;G<this.xg.length;G++){const h=this.xg[G];h&&h.dispose(E,b)}const k=a.multiMaterials.indexOf(this);k>=0&&a.multiMaterials.splice(k,1),super.dispose(E,b)}static ParseMultiMaterial(E,b){const h=new V(E.name,b);return h.id=E.id,h._loadedUniqueId=E.uniqueId,k.b&&k.b.AddTagsTo(h,E.tags),E.materialsUniqueIds?h._waitingSubMaterialsUniqueIds=E.materialsUniqueIds:E.materials.forEach((E=>h.xg.push(b.getLastMaterialById(E)))),h}}(0,G.f)("BABYLON.MultiMaterial",V)},11304:(E,b,h)=>{"use strict";h.d(b,{b:()=>a});class a{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(E){E.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(E){}bindForSubMesh(E,b,h,a,k){if(b.prePassRenderer&&b.prePassRenderer.enabled&&b.prePassRenderer.currentRTisSceneRT&&(-1!==b.prePassRenderer.getIndex(2)||-1!==b.prePassRenderer.getIndex(11))){this.previousWorldMatrices[h.uniqueId]||(this.previousWorldMatrices[h.uniqueId]=a.clone()),this.previousViewProjection||(this.previousViewProjection=b.getTransformMatrix().clone(),this.currentViewProjection=b.getTransformMatrix().clone());const k=b.getEngine();this.currentViewProjection.updateFlag!==b.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=k.frameId,this.previousViewProjection.p(this.currentViewProjection),this.currentViewProjection.p(b.getTransformMatrix())):this._lastUpdateFrameId!==k.frameId&&(this._lastUpdateFrameId=k.frameId,this.previousViewProjection.p(this.currentViewProjection)),E.setMatrix("previousWorld",this.previousWorldMatrices[h.uniqueId]),E.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[h.uniqueId]=a.clone()}}}},11368:(E,b,h)=>{"use strict";h.d(b,{d:()=>G});var a=h(11175),k=h(11311);class G extends k.c{constructor(E,b){let h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(E,b,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new a.d,this._storeEffectOnSubMeshes=h}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(E,b){return!!E&&(!this._storeEffectOnSubMeshes||(!E.wg||0===E.wg.length||this.isReadyForSubMesh(E,E.wg[0],b)))}_isReadyForSubMesh(E){const b=E.materialDefines;return!(this.checkReadyOnEveryCall||!E.effect||!b||b._renderId!==this.va().getRenderId())}bindOnlyWorldMatrix(E){this._activeEffect.setMatrix("world",E)}bindOnlyNormalMatrix(E){this._activeEffect.setMatrix("normalMatrix",E)}bind(E,b){b&&this.bindForSubMesh(E,b,b.wg[0])}_afterBind(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2?arguments[2]:void 0;super._afterBind(E,b,h),this.va()._cachedEffect=b,h?h._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return h._drawWrapper._forceRebindOnNextCall||E.isCachedMaterialInvalid(this,b,a)}dispose(E,b,h){this._activeEffect=void 0,super.dispose(E,b,h)}}},11121:(E,b,h)=>{"use strict";h.d(b,{d:()=>z});var a=h(11130),k=h(11139),G=h(11155),V=h(11163),l=h(11175),O=h(11201),v=h(11233),s=h(11304),U=h(11195),B=h(11311),o=h(11366),u=h(11368),D=h(11376),g=h(10958),S=h(11393),M=h(11396),I=h(11403),j=h(11357),P=h(11351),A=h(11206),n=h(11413);const d={effect:null,subMesh:null};class c extends o.c{constructor(E){super(E),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(E){const b=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const h of b)this[h]=h===E}}class z extends u.d{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(E){this._attachImageProcessingConfiguration(E),this._markAllSubMeshesAsTexturesDirty()}_attachImageProcessingConfiguration(E){E!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=E||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(E){this.imageProcessingConfiguration.colorCurvesEnabled=E}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(E){this.imageProcessingConfiguration.colorGradingEnabled=E}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(E){this._imageProcessingConfiguration.toneMappingEnabled=E}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(E){this._imageProcessingConfiguration.exposure=E}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(E){this._imageProcessingConfiguration.contrast=E}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(E){this._imageProcessingConfiguration.colorGradingTexture=E}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(E){this._imageProcessingConfiguration.colorCurves=E}get canRenderToMRT(){return!0}constructor(E,b){super(E,b,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||z.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new O.b(0,0,0),this.diffuseColor=new O.b(1,1,1),this.specularColor=new O.b(1,1,1),this.emissiveColor=new O.b(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new G.e(16),this._worldViewProjectionMatrix=l.d.Zero(),this._globalAmbientColor=new O.b(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new I.b(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new s.b,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),z.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),z.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(z.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(z.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}getClassName(){return"nb"}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return!!this._forceAlphaTest||this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===B.c.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.Ie&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==B.c.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.Ie||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(E,b){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._uniformBufferLayoutBuilt||this.buildUniformLayout();const k=b._drawWrapper;if(k.effect&&this.isFrozen&&k._wasPreviouslyReady&&k._wasPreviouslyUsingInstances===a)return!0;b.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),b.materialDefines=new c(this._eventInfo.defineNames));const G=this.va(),V=b.materialDefines;if(this._isReadyForSubMesh(b))return!0;const l=G.getEngine();V._needNormals=(0,P.L)(G,E,V,!0,this._maxSimultaneousLights,this._disableLighting),(0,P.S)(G,V);const O=this.needAlphaBlendingForMesh(E)&&this.va().useOrderIndependentTransparency;if((0,P.Y)(G,V,this.canRenderToMRT&&!O),(0,P.V)(G,V,O),n.d.PrepareDefines(l.currentRenderPassId,E,V),V._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,V._needUVs=!1;for(let E=1;E<=6;++E)V["MAINUV"+E]=!1;if(G.texturesEnabled){if(V.DIFFUSEDIRECTUV=0,V.BUMPDIRECTUV=0,V.AMBIENTDIRECTUV=0,V.OPACITYDIRECTUV=0,V.EMISSIVEDIRECTUV=0,V.SPECULARDIRECTUV=0,V.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&z.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,P.N)(this._diffuseTexture,V,"DIFFUSE")}else V.DIFFUSE=!1;if(this._ambientTexture&&z.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;(0,P.N)(this._ambientTexture,V,"AMBIENT")}else V.AMBIENT=!1;if(this._opacityTexture&&z.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;(0,P.N)(this._opacityTexture,V,"OPACITY"),V.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else V.OPACITY=!1;if(this._reflectionTexture&&z.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(V._needNormals=!0,V.REFLECTION=!0,V.ROUGHNESS=this._roughness>0,V.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,V.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===D.b.INVCUBIC_MODE,V.REFLECTIONMAP_3D=this._reflectionTexture.isCube,V.REFLECTIONMAP_OPPOSITEZ=V.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,V.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case D.b.EXPLICIT_MODE:V.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case D.b.PLANAR_MODE:V.setReflectionMode("REFLECTIONMAP_PLANAR");break;case D.b.PROJECTION_MODE:V.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case D.b.SKYBOX_MODE:V.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case D.b.SPHERICAL_MODE:V.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case D.b.EQUIRECTANGULAR_MODE:V.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case D.b.FIXED_EQUIRECTANGULAR_MODE:V.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case D.b.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:V.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case D.b.CUBIC_MODE:case D.b.INVCUBIC_MODE:default:V.setReflectionMode("REFLECTIONMAP_CUBIC")}V.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else V.REFLECTION=!1,V.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&z.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;(0,P.N)(this._emissiveTexture,V,"EMISSIVE")}else V.EMISSIVE=!1;if(this._lightmapTexture&&z.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;(0,P.N)(this._lightmapTexture,V,"LIGHTMAP"),V.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,V.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else V.LIGHTMAP=!1;if(this._specularTexture&&z.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;(0,P.N)(this._specularTexture,V,"SPECULAR"),V.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else V.SPECULAR=!1;if(G.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&z.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,P.N)(this._bumpTexture,V,"BUMP"),V.PARALLAX=this._useParallax,V.PARALLAX_RHS=G.useRightHandedSystem,V.PARALLAXOCCLUSION=this._useParallaxOcclusion,V.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else V.BUMP=!1,V.PARALLAX=!1,V.PARALLAX_RHS=!1,V.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&z.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;V._needUVs=!0,V.REFRACTION=!0,V.REFRACTIONMAP_3D=this._refractionTexture.isCube,V.RGBDREFRACTION=this._refractionTexture.isRGBD,V.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else V.REFRACTION=!1;V.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else V.DIFFUSE=!1,V.AMBIENT=!1,V.OPACITY=!1,V.REFLECTION=!1,V.EMISSIVE=!1,V.LIGHTMAP=!1,V.BUMP=!1,V.REFRACTION=!1;V.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),V.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,V.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,V.SPECULAROVERALPHA=this._useSpecularOverAlpha,V.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,V.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,V.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(E)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=V,this._eventInfo.subMesh=b,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(V._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(V),V.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,V.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}V._areFresnelDirty&&(z.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(V.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,V.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,V.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,V.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,V.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,V.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,V._needNormals=!0,V.FRESNEL=!0):V.FRESNEL=!1),(0,P.R)(E,G,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(E)||this._forceAlphaTest,V,this._applyDecalMapAfterDetailMap),(0,P.J)(G,l,this,V,a,null,b.getRenderingMesh().hasThinInstances),this._eventInfo.defines=V,this._eventInfo.mesh=E,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,P.H)(E,V,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let B=!1;if(V.isDirty){const a=V._areLightsDisposed;V.markAsProcessed();const k=new M.b;V.REFLECTION&&k.addFallback(0,"REFLECTION"),V.SPECULAR&&k.addFallback(0,"SPECULAR"),V.BUMP&&k.addFallback(0,"BUMP"),V.PARALLAX&&k.addFallback(1,"PARALLAX"),V.PARALLAX_RHS&&k.addFallback(1,"PARALLAX_RHS"),V.PARALLAXOCCLUSION&&k.addFallback(0,"PARALLAXOCCLUSION"),V.SPECULAROVERALPHA&&k.addFallback(0,"SPECULAROVERALPHA"),V.FOG&&k.addFallback(1,"FOG"),V.POINTSIZE&&k.addFallback(0,"POINTSIZE"),V.LOGARITHMICDEPTH&&k.addFallback(0,"LOGARITHMICDEPTH"),(0,P.w)(V,k,this._maxSimultaneousLights),V.SPECULARTERM&&k.addFallback(0,"SPECULARTERM"),V.DIFFUSEFRESNEL&&k.addFallback(1,"DIFFUSEFRESNEL"),V.OPACITYFRESNEL&&k.addFallback(2,"OPACITYFRESNEL"),V.REFLECTIONFRESNEL&&k.addFallback(3,"REFLECTIONFRESNEL"),V.EMISSIVEFRESNEL&&k.addFallback(4,"EMISSIVEFRESNEL"),V.FRESNEL&&k.addFallback(4,"FRESNEL"),V.MULTIVIEW&&k.addFallback(0,"MULTIVIEW");const O=[v.g.PositionKind];V.NORMAL&&O.push(v.g.NormalKind),V.TANGENT&&O.push(v.g.TangentKind);for(let E=1;E<=6;++E)V["UV"+E]&&O.push(`uv${1===E?"":E}`);V.VERTEXCOLOR&&O.push(v.g.ColorKind),(0,P.A)(O,E,V,k),(0,P.D)(O,V),(0,P.E)(O,E,V),(0,P.z)(O,E,V);let o="default";const u=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices"],D=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],g=["Material","Scene","Mesh"],S={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:V.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=k,this._eventInfo.fallbackRank=0,this._eventInfo.defines=V,this._eventInfo.uniforms=u,this._eventInfo.attributes=O,this._eventInfo.samplers=D,this._eventInfo.uniformBuffersNames=g,this._eventInfo.customCode=void 0,this._eventInfo.mesh=E,this._eventInfo.indexParameters=S,this._callbackPluginEventGeneric(128,this._eventInfo),n.d.AddUniformsAndSamplers(u,D),s.b.AddUniforms(u),s.b.AddSamplers(D),U.d&&(U.d.PrepareUniforms(u,V),U.d.PrepareSamplers(D,V)),(0,P.Z)({uniformsNames:u,uniformBuffersNames:g,samplers:D,defines:V,maxSimultaneousLights:this._maxSimultaneousLights}),(0,j.b)(u);const I={};this.customShaderNameResolve&&(o=this.customShaderNameResolve(o,u,g,D,V,O,I));const A=V.toString(),c=b.effect;let z=G.getEngine().createEffect(o,{attributes:O,uniformsNames:u,uniformBuffersNames:g,samplers:D,defines:A,fallbacks:k,onCompiled:this.onCompiled,onError:this.onError,indexParameters:S,processFinalCode:I.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:V.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([h.e(21),h.e(19)]).then(h.bind(h,12864)),Promise.all([h.e(22),h.e(20)]).then(h.bind(h,13008))]):await Promise.all([Promise.all([h.e(25),h.e(24)]).then(h.bind(h,13083)),Promise.all([h.e(27),h.e(26)]).then(h.bind(h,13255))]),this._shadersLoaded=!0}},l);if(this._eventInfo.customCode=void 0,z)if(this._onEffectCreatedObservable&&(d.effect=z,d.subMesh=b,this._onEffectCreatedObservable.notifyObservers(d)),this.allowShaderHotSwapping&&c&&!z.isReady()){if(z=c,V.markAsUnprocessed(),B=this.isFrozen,a)return V._areLightsDisposed=!0,!1}else G.resetCachedMaterial(),b.setEffect(z,V,this._materialContext)}return!(!b.effect||!b.effect.isReady())&&(V._renderId=G.getRenderId(),k._wasPreviouslyReady=!B,k._wasPreviouslyUsingInstances=a,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const E=this._uniformBuffer;E.addUniform("diffuseLeftColor",4),E.addUniform("diffuseRightColor",4),E.addUniform("opacityParts",4),E.addUniform("reflectionLeftColor",4),E.addUniform("reflectionRightColor",4),E.addUniform("refractionLeftColor",4),E.addUniform("refractionRightColor",4),E.addUniform("emissiveLeftColor",4),E.addUniform("emissiveRightColor",4),E.addUniform("vDiffuseInfos",2),E.addUniform("vAmbientInfos",2),E.addUniform("vOpacityInfos",2),E.addUniform("vReflectionInfos",2),E.addUniform("vReflectionPosition",3),E.addUniform("vReflectionSize",3),E.addUniform("vEmissiveInfos",2),E.addUniform("vLightmapInfos",2),E.addUniform("vSpecularInfos",2),E.addUniform("vBumpInfos",3),E.addUniform("diffuseMatrix",16),E.addUniform("ambientMatrix",16),E.addUniform("opacityMatrix",16),E.addUniform("reflectionMatrix",16),E.addUniform("emissiveMatrix",16),E.addUniform("lightmapMatrix",16),E.addUniform("specularMatrix",16),E.addUniform("bumpMatrix",16),E.addUniform("vTangentSpaceParams",2),E.addUniform("pointSize",1),E.addUniform("alphaCutOff",1),E.addUniform("refractionMatrix",16),E.addUniform("vRefractionInfos",4),E.addUniform("vRefractionPosition",3),E.addUniform("vRefractionSize",3),E.addUniform("vSpecularColor",4),E.addUniform("vEmissiveColor",3),E.addUniform("vDiffuseColor",4),E.addUniform("vAmbientColor",3),super.buildUniformLayout()}bindForSubMesh(E,b,h){const a=this.va(),k=h.materialDefines;if(!k)return;const G=h.effect;if(!G)return;this._activeEffect=G,b.getMeshUniformBuffer().bindToEffect(G,"Mesh"),b.transferToEffect(E),this._uniformBuffer.bindToEffect(G,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,a,b,E,this.isFrozen),n.d.Bind(a.getEngine().currentRenderPassId,this._activeEffect,b,E),this._eventInfo.subMesh=h,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),k.OBJECTSPACE_NORMALMAP&&(E.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const l=this._mustRebind(a,G,h,b.visibility);(0,P.e)(b,G);const v=this._uniformBuffer;if(l){if(this.bindViewProjection(G),!v.useUbo||!this.isFrozen||!v.isSync||h._drawWrapper._forceRebindOnNextCall){if(z.FresnelEnabled&&k.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(v.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),v.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&v.updateColor4("opacityParts",new O.b(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(v.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),v.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(v.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),v.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(v.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),v.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),a.texturesEnabled){if(this._diffuseTexture&&z.DiffuseTextureEnabled&&(v.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,P.t)(this._diffuseTexture,v,"diffuse")),this._ambientTexture&&z.AmbientTextureEnabled&&(v.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,P.t)(this._ambientTexture,v,"ambient")),this._opacityTexture&&z.OpacityTextureEnabled&&(v.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,P.t)(this._opacityTexture,v,"opacity")),this._hasAlphaChannel()&&v.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&z.ReflectionTextureEnabled&&(v.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),v.Pj("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){const E=this._reflectionTexture;v.updateVector3("vReflectionPosition",E.boundingBoxPosition),v.updateVector3("vReflectionSize",E.boundingBoxSize)}if(this._emissiveTexture&&z.EmissiveTextureEnabled&&(v.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,P.t)(this._emissiveTexture,v,"emissive")),this._lightmapTexture&&z.LightmapTextureEnabled&&(v.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,P.t)(this._lightmapTexture,v,"lightmap")),this._specularTexture&&z.SpecularTextureEnabled&&(v.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,P.t)(this._specularTexture,v,"specular")),this._bumpTexture&&a.getEngine().getCaps().standardDerivatives&&z.BumpTextureEnabled&&(v.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,P.t)(this._bumpTexture,v,"bump"),a._mirroredCameraPosition?v.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):v.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&z.RefractionTextureEnabled){let E=1;if(this._refractionTexture.isCube||(v.Pj("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(E=this._refractionTexture.depth)),v.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,E,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const E=this._refractionTexture;v.updateVector3("vRefractionPosition",E.boundingBoxPosition),v.updateVector3("vRefractionSize",E.boundingBoxSize)}}}this.pointsCloud&&v.updateFloat("pointSize",this.pointSize),v.updateColor4("vSpecularColor",this.specularColor,this.specularPower),v.updateColor3("vEmissiveColor",z.EmissiveTextureEnabled?this.emissiveColor:O.b.BlackReadOnly),v.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),a.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),v.updateColor3("vAmbientColor",this._globalAmbientColor)}a.texturesEnabled&&(this._diffuseTexture&&z.DiffuseTextureEnabled&&G.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&z.AmbientTextureEnabled&&G.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&z.OpacityTextureEnabled&&G.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&z.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?G.setTexture("reflectionCubeSampler",this._reflectionTexture):G.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&z.EmissiveTextureEnabled&&G.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&z.LightmapTextureEnabled&&G.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&z.SpecularTextureEnabled&&G.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&a.getEngine().getCaps().standardDerivatives&&z.BumpTextureEnabled&&G.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&z.RefractionTextureEnabled&&(this._refractionTexture.isCube?G.setTexture("refractionCubeSampler",this._refractionTexture):G.setTexture("refraction2DSampler",this._refractionTexture))),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(b)&&this.va().depthPeelingRenderer.bind(G),this._eventInfo.subMesh=h,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,j.f)(G,this,a),this.bindEyePosition(G)}else a.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(l||!this.isFrozen){var s;if(a.lightsEnabled&&!this._disableLighting&&(0,P.i)(a,b,G,k,this._maxSimultaneousLights),(a.fogEnabled&&b.applyFog&&a.fogMode!==V.e.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||b.receiveShadows||k.PREPASS)&&this.bindView(G),(0,P.f)(a,b,G),k.NUM_MORPH_INFLUENCERS&&(0,P.n)(b,G),k.BAKED_VERTEX_ANIMATION_TEXTURE)null===(s=b.bakedVertexAnimationManager)||void 0===s||s.bind(G,k.INSTANCES);this.useLogarithmicDepth&&(0,P.m)(k,G,a),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)}this._afterBind(b,this._activeEffect,h),v.update()}getAnimatables(){const E=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&E.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&E.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&E.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&E.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&E.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&E.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&E.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&E.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&E.push(this._refractionTexture),E}getActiveTextures(){const E=super.getActiveTextures();return this._diffuseTexture&&E.push(this._diffuseTexture),this._ambientTexture&&E.push(this._ambientTexture),this._opacityTexture&&E.push(this._opacityTexture),this._reflectionTexture&&E.push(this._reflectionTexture),this._emissiveTexture&&E.push(this._emissiveTexture),this._specularTexture&&E.push(this._specularTexture),this._bumpTexture&&E.push(this._bumpTexture),this._lightmapTexture&&E.push(this._lightmapTexture),this._refractionTexture&&E.push(this._refractionTexture),E}hasTexture(E){return!!super.hasTexture(E)||(this._diffuseTexture===E||(this._ambientTexture===E||(this._opacityTexture===E||(this._reflectionTexture===E||(this._emissiveTexture===E||(this._specularTexture===E||(this._bumpTexture===E||(this._lightmapTexture===E||this._refractionTexture===E))))))))}dispose(E,b){var h,a,k,G,V,l,O,v,s;b&&(null===(h=this._diffuseTexture)||void 0===h||h.dispose(),null===(a=this._ambientTexture)||void 0===a||a.dispose(),null===(k=this._opacityTexture)||void 0===k||k.dispose(),null===(G=this._reflectionTexture)||void 0===G||G.dispose(),null===(V=this._emissiveTexture)||void 0===V||V.dispose(),null===(l=this._specularTexture)||void 0===l||l.dispose(),null===(O=this._bumpTexture)||void 0===O||O.dispose(),null===(v=this._lightmapTexture)||void 0===v||v.dispose(),null===(s=this._refractionTexture)||void 0===s||s.dispose());this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(E,b)}clone(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const a=A.e.Clone((()=>new z(E,this.va())),this,{cloneTexturesOnlyOnce:b});return a.name=E,a.id=E,this.stencil.copyTo(a.stencil),this._clonePlugins(a,h),a}static Parse(E,b,h){const a=A.e.Parse((()=>new z(E.name,b)),E,b,h);return E.stencil&&a.stencil.parse(E.stencil,b,h),B.c._ParsePlugins(E,a,b,h),a}static get DiffuseTextureEnabled(){return S.c.DiffuseTextureEnabled}static set DiffuseTextureEnabled(E){S.c.DiffuseTextureEnabled=E}static get DetailTextureEnabled(){return S.c.DetailTextureEnabled}static set DetailTextureEnabled(E){S.c.DetailTextureEnabled=E}static get AmbientTextureEnabled(){return S.c.AmbientTextureEnabled}static set AmbientTextureEnabled(E){S.c.AmbientTextureEnabled=E}static get OpacityTextureEnabled(){return S.c.OpacityTextureEnabled}static set OpacityTextureEnabled(E){S.c.OpacityTextureEnabled=E}static get ReflectionTextureEnabled(){return S.c.ReflectionTextureEnabled}static set ReflectionTextureEnabled(E){S.c.ReflectionTextureEnabled=E}static get EmissiveTextureEnabled(){return S.c.EmissiveTextureEnabled}static set EmissiveTextureEnabled(E){S.c.EmissiveTextureEnabled=E}static get SpecularTextureEnabled(){return S.c.SpecularTextureEnabled}static set SpecularTextureEnabled(E){S.c.SpecularTextureEnabled=E}static get BumpTextureEnabled(){return S.c.BumpTextureEnabled}static set BumpTextureEnabled(E){S.c.BumpTextureEnabled=E}static get LightmapTextureEnabled(){return S.c.LightmapTextureEnabled}static set LightmapTextureEnabled(E){S.c.LightmapTextureEnabled=E}static get RefractionTextureEnabled(){return S.c.RefractionTextureEnabled}static set RefractionTextureEnabled(E){S.c.RefractionTextureEnabled=E}static get ColorGradingTextureEnabled(){return S.c.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(E){S.c.ColorGradingTextureEnabled=E}static get FresnelEnabled(){return S.c.FresnelEnabled}static set FresnelEnabled(E){S.c.FresnelEnabled=E}}z.ForceGLSL=!1,(0,a.d)([(0,k.C)("diffuseTexture")],z.prototype,"_diffuseTexture",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],z.prototype,"diffuseTexture",void 0),(0,a.d)([(0,k.C)("ambientTexture")],z.prototype,"_ambientTexture",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],z.prototype,"ambientTexture",void 0),(0,a.d)([(0,k.C)("opacityTexture")],z.prototype,"_opacityTexture",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],z.prototype,"opacityTexture",void 0),(0,a.d)([(0,k.C)("reflectionTexture")],z.prototype,"_reflectionTexture",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],z.prototype,"reflectionTexture",void 0),(0,a.d)([(0,k.C)("emissiveTexture")],z.prototype,"_emissiveTexture",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],z.prototype,"emissiveTexture",void 0),(0,a.d)([(0,k.C)("specularTexture")],z.prototype,"_specularTexture",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],z.prototype,"specularTexture",void 0),(0,a.d)([(0,k.C)("bumpTexture")],z.prototype,"_bumpTexture",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],z.prototype,"bumpTexture",void 0),(0,a.d)([(0,k.C)("lightmapTexture")],z.prototype,"_lightmapTexture",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],z.prototype,"lightmapTexture",void 0),(0,a.d)([(0,k.C)("refractionTexture")],z.prototype,"_refractionTexture",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],z.prototype,"refractionTexture",void 0),(0,a.d)([(0,k.g)("ambient")],z.prototype,"ambientColor",void 0),(0,a.d)([(0,k.g)("diffuse")],z.prototype,"diffuseColor",void 0),(0,a.d)([(0,k.g)("specular")],z.prototype,"specularColor",void 0),(0,a.d)([(0,k.g)("emissive")],z.prototype,"emissiveColor",void 0),(0,a.d)([(0,k.H)()],z.prototype,"specularPower",void 0),(0,a.d)([(0,k.H)("useAlphaFromDiffuseTexture")],z.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],z.prototype,"useAlphaFromDiffuseTexture",void 0),(0,a.d)([(0,k.H)("useEmissiveAsIllumination")],z.prototype,"_useEmissiveAsIllumination",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],z.prototype,"useEmissiveAsIllumination",void 0),(0,a.d)([(0,k.H)("linkEmissiveWithDiffuse")],z.prototype,"_linkEmissiveWithDiffuse",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],z.prototype,"linkEmissiveWithDiffuse",void 0),(0,a.d)([(0,k.H)("useSpecularOverAlpha")],z.prototype,"_useSpecularOverAlpha",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],z.prototype,"useSpecularOverAlpha",void 0),(0,a.d)([(0,k.H)("useReflectionOverAlpha")],z.prototype,"_useReflectionOverAlpha",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],z.prototype,"useReflectionOverAlpha",void 0),(0,a.d)([(0,k.H)("disableLighting")],z.prototype,"_disableLighting",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsLightsDirty")],z.prototype,"disableLighting",void 0),(0,a.d)([(0,k.H)("useObjectSpaceNormalMap")],z.prototype,"_useObjectSpaceNormalMap",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],z.prototype,"useObjectSpaceNormalMap",void 0),(0,a.d)([(0,k.H)("useParallax")],z.prototype,"_useParallax",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],z.prototype,"useParallax",void 0),(0,a.d)([(0,k.H)("useParallaxOcclusion")],z.prototype,"_useParallaxOcclusion",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],z.prototype,"useParallaxOcclusion",void 0),(0,a.d)([(0,k.H)()],z.prototype,"parallaxScaleBias",void 0),(0,a.d)([(0,k.H)("roughness")],z.prototype,"_roughness",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],z.prototype,"roughness",void 0),(0,a.d)([(0,k.H)()],z.prototype,"indexOfRefraction",void 0),(0,a.d)([(0,k.H)()],z.prototype,"invertRefractionY",void 0),(0,a.d)([(0,k.H)()],z.prototype,"alphaCutOff",void 0),(0,a.d)([(0,k.H)("useLightmapAsShadowmap")],z.prototype,"_useLightmapAsShadowmap",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],z.prototype,"useLightmapAsShadowmap",void 0),(0,a.d)([(0,k.n)("diffuseFresnelParameters")],z.prototype,"_diffuseFresnelParameters",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsFresnelDirty")],z.prototype,"diffuseFresnelParameters",void 0),(0,a.d)([(0,k.n)("opacityFresnelParameters")],z.prototype,"_opacityFresnelParameters",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsFresnelAndMiscDirty")],z.prototype,"opacityFresnelParameters",void 0),(0,a.d)([(0,k.n)("reflectionFresnelParameters")],z.prototype,"_reflectionFresnelParameters",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsFresnelDirty")],z.prototype,"reflectionFresnelParameters",void 0),(0,a.d)([(0,k.n)("refractionFresnelParameters")],z.prototype,"_refractionFresnelParameters",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsFresnelDirty")],z.prototype,"refractionFresnelParameters",void 0),(0,a.d)([(0,k.n)("emissiveFresnelParameters")],z.prototype,"_emissiveFresnelParameters",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsFresnelDirty")],z.prototype,"emissiveFresnelParameters",void 0),(0,a.d)([(0,k.H)("useReflectionFresnelFromSpecular")],z.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsFresnelDirty")],z.prototype,"useReflectionFresnelFromSpecular",void 0),(0,a.d)([(0,k.H)("useGlossinessFromSpecularMapAlpha")],z.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],z.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,a.d)([(0,k.H)("maxSimultaneousLights")],z.prototype,"_maxSimultaneousLights",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsLightsDirty")],z.prototype,"maxSimultaneousLights",void 0),(0,a.d)([(0,k.H)("invertNormalMapX")],z.prototype,"_invertNormalMapX",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],z.prototype,"invertNormalMapX",void 0),(0,a.d)([(0,k.H)("invertNormalMapY")],z.prototype,"_invertNormalMapY",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],z.prototype,"invertNormalMapY",void 0),(0,a.d)([(0,k.H)("twoSidedLighting")],z.prototype,"_twoSidedLighting",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],z.prototype,"twoSidedLighting",void 0),(0,a.d)([(0,k.H)("applyDecalMapAfterDetailMap")],z.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,a.d)([(0,k.b)("_markAllSubMeshesAsMiscDirty")],z.prototype,"applyDecalMapAfterDetailMap",void 0),(0,g.f)("BABYLON.StandardMaterial",z),V.e.DefaultMaterialFactory=E=>new z("default material",E)},11224:(E,b,h)=>{"use strict";h.d(b,{d:()=>G});var a=h(10834),k=h(10821);class G{constructor(E,b,h,a){let k=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._valueCache={},this._engine=E,this._noUBO=!E.supportsUniformBuffers||k,this._dynamic=h,this._name=a??"no-name",this._data=b||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.Pj=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.Pj=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get useUbo(){return!this._noUBO}get isSync(){return!this._needSync}isDynamic(){return void 0!==this._dynamic}getData(){return this._bufferData}getBuffer(){return this._buffer}_fillAlignment(E){let b;if(b=E<=2?E:4,this._uniformLocationPointer%b!==0){const E=this._uniformLocationPointer;this._uniformLocationPointer+=b-this._uniformLocationPointer%b;const h=this._uniformLocationPointer-E;for(let b=0;b<h;b++)this._data.push(0)}}addUniform(E,b){let h,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this._noUBO&&void 0===this._uniformLocations[E]){if(a>0){if(b instanceof Array)throw"addUniform should not be use with Array in UBO: "+E;if(this._fillAlignment(4),this._uniformArraySizes[E]={strideSize:b,arraySize:a},16==b)b*=a;else{b=b*a+(4-b)*a}h=[];for(let E=0;E<b;E++)h.push(0)}else{if(b instanceof Array)h=b,b=h.length;else{h=[];for(let E=0;E<b;E++)h.push(0)}this._fillAlignment(b)}this._uniformSizes[E]=b,this._uniformLocations[E]=this._uniformLocationPointer,this._uniformLocationPointer+=b;for(let E=0;E<b;E++)this._data.push(h[E]);this._needSync=!0}}addMatrix(E,b){this.addUniform(E,Array.prototype.slice.call(b.qj()))}addFloat2(E,b,h){const a=[b,h];this.addUniform(E,a)}addFloat3(E,b,h,a){const k=[b,h,a];this.addUniform(E,k)}addColor3(E,b){const h=[b.r,b.g,b.b];this.addUniform(E,h)}addColor4(E,b,h){const a=[b.r,b.g,b.b,h];this.addUniform(E,a)}addVector3(E,b){const h=[b.x,b.y,b.z];this.addUniform(E,h)}addMatrix3x3(E){this.addUniform(E,12)}addMatrix2x2(E){this.addUniform(E,8)}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}_getNames(){const E=[];let b=0;for(const h in this._uniformLocations)if(E.push(h),10===++b)break;return E.join(",")}_rebuild(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}get _numBuffers(){return this._buffers.length}get _indexBuffer(){return this._bufferIndex}get name(){return this._name}get currentEffect(){return this._currentEffect}_buffersEqual(E,b){for(let h=0;h<E.length;++h)if(E[h]!==b[h])return!1;return!0}_copyBuffer(E,b){for(let h=0;h<E.length;++h)b[h]=E[h]}update(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(G._UpdatedUbosInFrame[this._name]||(G._UpdatedUbosInFrame[this._name]=0),G._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}updateUniform(E,b,h){this._checkNewFrame();let k=this._uniformLocations[E];if(void 0===k){if(this._buffer)return void a.c.Error("Cannot add an uniform after UBO has been created. uniformName="+E);this.addUniform(E,h),k=this._uniformLocations[E]}if(this._buffer||this.create(),this._dynamic)for(let a=0;a<h;a++)this._bufferData[k+a]=b[a];else{let E=!1;for(let a=0;a<h;a++)(16===h&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[k+a]!==Math.fround(b[a]))&&(E=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[k+a]=b[a]);this._needSync=this._needSync||E}}updateUniformArray(E,b,h){this._checkNewFrame();const G=this._uniformLocations[E];if(void 0===G)return void a.c.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");this._buffer||this.create();const V=this._uniformArraySizes[E];if(this._dynamic)for(let a=0;a<h;a++)this._bufferData[G+a]=b[a];else{let E=!1,a=0,l=0;for(let O=0;O<h;O++)if(this._bufferData[G+4*l+a]!==k.g.FloatRound(b[O])&&(E=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[G+4*l+a]=b[O]),a++,a===V.strideSize){for(;a<4;a++)this._bufferData[G+4*l+a]=0;a=0,l++}this._needSync=this._needSync||E}}_cacheMatrix(E,b){this._checkNewFrame();const h=this._valueCache[E],a=b.updateFlag;return(void 0===h||h!==a)&&(this._valueCache[E]=a,!0)}_updateMatrix3x3ForUniform(E,b){for(let h=0;h<3;h++)G._TempBuffer[4*h]=b[3*h],G._TempBuffer[4*h+1]=b[3*h+1],G._TempBuffer[4*h+2]=b[3*h+2],G._TempBuffer[4*h+3]=0;this.updateUniform(E,G._TempBuffer,12)}_updateMatrix3x3ForEffect(E,b){this._currentEffect.setMatrix3x3(E,b)}_updateMatrix2x2ForEffect(E,b){this._currentEffect.setMatrix2x2(E,b)}_updateMatrix2x2ForUniform(E,b){for(let h=0;h<2;h++)G._TempBuffer[4*h]=b[2*h],G._TempBuffer[4*h+1]=b[2*h+1],G._TempBuffer[4*h+2]=0,G._TempBuffer[4*h+3]=0;this.updateUniform(E,G._TempBuffer,8)}_updateFloatForEffect(E,b){this._currentEffect.setFloat(E,b)}_updateFloatForUniform(E,b){G._TempBuffer[0]=b,this.updateUniform(E,G._TempBuffer,1)}_updateFloat2ForEffect(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setFloat2(E+a,b,h)}_updateFloat2ForUniform(E,b,h){G._TempBuffer[0]=b,G._TempBuffer[1]=h,this.updateUniform(E,G._TempBuffer,2)}_updateFloat3ForEffect(E,b,h,a){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setFloat3(E+k,b,h,a)}_updateFloat3ForUniform(E,b,h,a){G._TempBuffer[0]=b,G._TempBuffer[1]=h,G._TempBuffer[2]=a,this.updateUniform(E,G._TempBuffer,3)}_updateFloat4ForEffect(E,b,h,a,k){let G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setFloat4(E+G,b,h,a,k)}_updateFloat4ForUniform(E,b,h,a,k){G._TempBuffer[0]=b,G._TempBuffer[1]=h,G._TempBuffer[2]=a,G._TempBuffer[3]=k,this.updateUniform(E,G._TempBuffer,4)}_updateFloatArrayForEffect(E,b){this._currentEffect.setFloatArray(E,b)}_updateFloatArrayForUniform(E,b){this.updateUniformArray(E,b,b.length)}_updateArrayForEffect(E,b){this._currentEffect.setArray(E,b)}_updateArrayForUniform(E,b){this.updateUniformArray(E,b,b.length)}_updateIntArrayForEffect(E,b){this._currentEffect.setIntArray(E,b)}_updateIntArrayForUniform(E,b){G._TempBufferInt32View.set(b),this.updateUniformArray(E,G._TempBuffer,b.length)}_updateUIntArrayForEffect(E,b){this._currentEffect.setUIntArray(E,b)}_updateUIntArrayForUniform(E,b){G._TempBufferUInt32View.set(b),this.updateUniformArray(E,G._TempBuffer,b.length)}_updateMatrixForEffect(E,b){this._currentEffect.setMatrix(E,b)}_updateMatrixForUniform(E,b){this._cacheMatrix(E,b)&&this.updateUniform(E,b.qj(),16)}_updateMatricesForEffect(E,b){this._currentEffect.setMatrices(E,b)}_updateMatricesForUniform(E,b){this.updateUniform(E,b,b.length)}_updateVector3ForEffect(E,b){this._currentEffect.setVector3(E,b)}_updateVector3ForUniform(E,b){G._TempBuffer[0]=b.x,G._TempBuffer[1]=b.y,G._TempBuffer[2]=b.z,this.updateUniform(E,G._TempBuffer,3)}_updateVector4ForEffect(E,b){this._currentEffect.setVector4(E,b)}_updateVector4ForUniform(E,b){G._TempBuffer[0]=b.x,G._TempBuffer[1]=b.y,G._TempBuffer[2]=b.z,G._TempBuffer[3]=b.w,this.updateUniform(E,G._TempBuffer,4)}_updateColor3ForEffect(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setColor3(E+h,b)}_updateColor3ForUniform(E,b){G._TempBuffer[0]=b.r,G._TempBuffer[1]=b.g,G._TempBuffer[2]=b.b,this.updateUniform(E,G._TempBuffer,3)}_updateColor4ForEffect(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setColor4(E+a,b,h)}_updateDirectColor4ForEffect(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setDirectColor4(E+h,b)}_updateColor4ForUniform(E,b,h){G._TempBuffer[0]=b.r,G._TempBuffer[1]=b.g,G._TempBuffer[2]=b.b,G._TempBuffer[3]=h,this.updateUniform(E,G._TempBuffer,4)}_updateDirectColor4ForUniform(E,b){G._TempBuffer[0]=b.r,G._TempBuffer[1]=b.g,G._TempBuffer[2]=b.b,G._TempBuffer[3]=b.a,this.updateUniform(E,G._TempBuffer,4)}_updateIntForEffect(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setInt(E+h,b)}_updateIntForUniform(E,b){G._TempBufferInt32View[0]=b,this.updateUniform(E,G._TempBuffer,1)}_updateInt2ForEffect(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setInt2(E+a,b,h)}_updateInt2ForUniform(E,b,h){G._TempBufferInt32View[0]=b,G._TempBufferInt32View[1]=h,this.updateUniform(E,G._TempBuffer,2)}_updateInt3ForEffect(E,b,h,a){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setInt3(E+k,b,h,a)}_updateInt3ForUniform(E,b,h,a){G._TempBufferInt32View[0]=b,G._TempBufferInt32View[1]=h,G._TempBufferInt32View[2]=a,this.updateUniform(E,G._TempBuffer,3)}_updateInt4ForEffect(E,b,h,a,k){let G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setInt4(E+G,b,h,a,k)}_updateInt4ForUniform(E,b,h,a,k){G._TempBufferInt32View[0]=b,G._TempBufferInt32View[1]=h,G._TempBufferInt32View[2]=a,G._TempBufferInt32View[3]=k,this.updateUniform(E,G._TempBuffer,4)}_updateUIntForEffect(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setUInt(E+h,b)}_updateUIntForUniform(E,b){G._TempBufferUInt32View[0]=b,this.updateUniform(E,G._TempBuffer,1)}_updateUInt2ForEffect(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setUInt2(E+a,b,h)}_updateUInt2ForUniform(E,b,h){G._TempBufferUInt32View[0]=b,G._TempBufferUInt32View[1]=h,this.updateUniform(E,G._TempBuffer,2)}_updateUInt3ForEffect(E,b,h,a){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setUInt3(E+k,b,h,a)}_updateUInt3ForUniform(E,b,h,a){G._TempBufferUInt32View[0]=b,G._TempBufferUInt32View[1]=h,G._TempBufferUInt32View[2]=a,this.updateUniform(E,G._TempBuffer,3)}_updateUInt4ForEffect(E,b,h,a,k){let G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setUInt4(E+G,b,h,a,k)}_updateUInt4ForUniform(E,b,h,a,k){G._TempBufferUInt32View[0]=b,G._TempBufferUInt32View[1]=h,G._TempBufferUInt32View[2]=a,G._TempBufferUInt32View[3]=k,this.updateUniform(E,G._TempBuffer,4)}setTexture(E,b){this._currentEffect.setTexture(E,b)}setTextureArray(E,b){this._currentEffect.setTextureArray(E,b)}bindTexture(E,b){this._currentEffect._bindTexture(E,b)}updateUniformDirectly(E,b){this.updateUniform(E,b,b.length),this.update()}bindToEffect(E,b){this._currentEffect=E,this._currentEffectName=b}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}setDataBuffer(E){if(!this._buffers)return this._buffer===E;for(let b=0;b<this._buffers.length;++b){if(this._buffers[b][0]===E)return this._bufferIndex=b,this._buffer=E,this._createBufferOnWrite=!1,this._currentEffect=void 0,!0}return!1}dispose(){if(this._noUBO)return;const E=this._engine._uniformBuffers,b=E.indexOf(this);if(-1!==b&&(E[b]=E[E.length-1],E.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let h=0;h<this._buffers.length;++h){const E=this._buffers[h][0];this._engine._releaseBuffer(E)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}G._UpdatedUbosInFrame={},G._MAX_UNIFORM_SIZE=256,G._TempBuffer=new Float32Array(G._MAX_UNIFORM_SIZE),G._TempBufferInt32View=new Int32Array(G._TempBuffer.buffer),G._TempBufferUInt32View=new Uint32Array(G._TempBuffer.buffer)},11466:(E,b,h)=>{"use strict";h.d(b,{b:()=>V,e:()=>a});var a,k,G=h(11175);!function(E){E[E.LOCAL=0]="LOCAL",E[E.WORLD=1]="WORLD",E[E.BONE=2]="BONE"}(a||(a={}));class V{}V.X=new G.k(1,0,0),V.Y=new G.k(0,1,0),V.Z=new G.k(0,0,1),function(E){E[E.X=0]="X",E[E.Y=1]="Y",E[E.Z=2]="Z"}(k||(k={}))},11201:(E,b,h)=>{"use strict";h.d(b,{b:()=>U,f:()=>B,j:()=>o});var a=h(11183),k=h(10958),G=h(11177),V=h(11186);function l(E){return Math.pow(E,G.i)}function O(E){return E<=.04045?.0773993808*E:Math.pow(.947867299*(E+.055),2.4)}function v(E){return Math.pow(E,G.h)}function s(E){return E<=.0031308?12.92*E:1.055*Math.pow(E,.41666)-.055}class U{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.r=E,this.g=b,this.b=h}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"gb"}getHashCode(){let E=255*this.r|0;return E=397*E^255*this.g,E=397*E^255*this.b,E}toArray(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return E[b]=this.r,E[b+1]=this.g,E[b+2]=this.b,this}Yc(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return U.FromArrayToRef(E,b,this),this}toColor4(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new B(this.r,this.g,this.b,E)}qj(){return[this.r,this.g,this.b]}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(E){return new U(this.r*E.r,this.g*E.g,this.b*E.b)}multiplyToRef(E,b){return b.r=this.r*E.r,b.g=this.g*E.g,b.b=this.b*E.b,b}multiplyInPlace(E){return this.r*=E.r,this.g*=E.g,this.b*=E.b,this}multiplyByFloats(E,b,h){return new U(this.r*E,this.g*b,this.b*h)}divide(E){throw new ReferenceError("Can not divide a color")}divideToRef(E,b){throw new ReferenceError("Can not divide a color")}divideInPlace(E){throw new ReferenceError("Can not divide a color")}minimizeInPlace(E){return this.minimizeInPlaceFromFloats(E.r,E.g,E.b)}maximizeInPlace(E){return this.maximizeInPlaceFromFloats(E.r,E.g,E.b)}minimizeInPlaceFromFloats(E,b,h){return this.r=Math.min(E,this.r),this.g=Math.min(b,this.g),this.b=Math.min(h,this.b),this}maximizeInPlaceFromFloats(E,b,h){return this.r=Math.max(E,this.r),this.g=Math.max(b,this.g),this.b=Math.max(h,this.b),this}floorToRef(E){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(E){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}equals(E){return E&&this.r===E.r&&this.g===E.g&&this.b===E.b}equalsFloats(E,b,h){return this.equalsToFloats(E,b,h)}equalsToFloats(E,b,h){return this.r===E&&this.g===b&&this.b===h}equalsWithEpsilon(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:G.d;return(0,V.C)(this.r,E.r,b)&&(0,V.C)(this.g,E.g,b)&&(0,V.C)(this.b,E.b,b)}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(E){throw new ReferenceError("Can not negate a color")}scale(E){return new U(this.r*E,this.g*E,this.b*E)}scaleInPlace(E){return this.r*=E,this.g*=E,this.b*=E,this}scaleToRef(E,b){return b.r=this.r*E,b.g=this.g*E,b.b=this.b*E,b}scaleAndAddToRef(E,b){return b.r+=this.r*E,b.g+=this.g*E,b.b+=this.b*E,b}clampToRef(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,h=arguments.length>2?arguments[2]:void 0;return h.r=(0,V.b)(this.r,E,b),h.g=(0,V.b)(this.g,E,b),h.b=(0,V.b)(this.b,E,b),h}add(E){return new U(this.r+E.r,this.g+E.g,this.b+E.b)}addInPlace(E){return this.r+=E.r,this.g+=E.g,this.b+=E.b,this}addInPlaceFromFloats(E,b,h){return this.r+=E,this.g+=b,this.b+=h,this}addToRef(E,b){return b.r=this.r+E.r,b.g=this.g+E.g,b.b=this.b+E.b,b}Xc(E){return new U(this.r-E.r,this.g-E.g,this.b-E.b)}subtractToRef(E,b){return b.r=this.r-E.r,b.g=this.g-E.g,b.b=this.b-E.b,b}yi(E){return this.r-=E.r,this.g-=E.g,this.b-=E.b,this}subtractFromFloats(E,b,h){return new U(this.r-E,this.g-b,this.b-h)}subtractFromFloatsToRef(E,b,h,a){return a.r=this.r-E,a.g=this.g-b,a.b=this.b-h,a}clone(){return new U(this.r,this.g,this.b)}p(E){return this.r=E.r,this.g=E.g,this.b=E.b,this}ue(E,b,h){return this.r=E,this.g=b,this.b=h,this}set(E,b,h){return this.ue(E,b,h)}te(E){return this.r=this.g=this.b=E,this}toHexString(){const E=Math.round(255*this.r),b=Math.round(255*this.g),h=Math.round(255*this.b);return"#"+(0,V.y)(E)+(0,V.y)(b)+(0,V.y)(h)}fromHexString(E){return"#"!==E.substring(0,1)||7!==E.length||(this.r=parseInt(E.substring(1,3),16)/255,this.g=parseInt(E.substring(3,5),16)/255,this.b=parseInt(E.substring(5,7),16)/255),this}toHSV(){return this.toHSVToRef(new U)}toHSVToRef(E){const b=this.r,h=this.g,a=this.b,k=Math.max(b,h,a),G=Math.min(b,h,a);let V=0,l=0;const O=k,v=k-G;return 0!==k&&(l=v/k),k!=G&&(k==b?(V=(h-a)/v,h<a&&(V+=6)):k==h?V=(a-b)/v+2:k==a&&(V=(b-h)/v+4),V*=60),E.r=V,E.g=l,E.b=O,E}toLinearSpace(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b=new U;return this.toLinearSpaceToRef(b,E),b}toLinearSpaceToRef(E){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(E.r=O(this.r),E.g=O(this.g),E.b=O(this.b)):(E.r=l(this.r),E.g=l(this.g),E.b=l(this.b)),this}toGammaSpace(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b=new U;return this.toGammaSpaceToRef(b,E),b}toGammaSpaceToRef(E){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(E.r=s(this.r),E.g=s(this.g),E.b=s(this.b)):(E.r=v(this.r),E.g=v(this.g),E.b=v(this.b)),this}static HSVtoRGBToRef(E,b,h,a){const k=h*b,G=E/60,V=k*(1-Math.abs(G%2-1));let l=0,O=0,v=0;G>=0&&G<=1?(l=k,O=V):G>=1&&G<=2?(l=V,O=k):G>=2&&G<=3?(O=k,v=V):G>=3&&G<=4?(O=V,v=k):G>=4&&G<=5?(l=V,v=k):G>=5&&G<=6&&(l=k,v=V);const s=h-k;return a.r=l+s,a.g=O+s,a.b=v+s,a}static FromHSV(E,b,h){const a=new U(0,0,0);return U.HSVtoRGBToRef(E,b,h,a),a}static FromHexString(E){return new U(0,0,0).fromHexString(E)}static jh(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new U(E[b],E[b+1],E[b+2])}static FromArrayToRef(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0;h.r=E[b],h.g=E[b+1],h.b=E[b+2]}static FromInts(E,b,h){return new U(E/255,b/255,h/255)}static Lerp(E,b,h){const a=new U(0,0,0);return U.LerpToRef(E,b,h,a),a}static LerpToRef(E,b,h,a){a.r=E.r+(b.r-E.r)*h,a.g=E.g+(b.g-E.g)*h,a.b=E.b+(b.b-E.b)*h}static Hermite(E,b,h,a,k){const G=k*k,V=k*G,l=2*V-3*G+1,O=-2*V+3*G,v=V-2*G+k,s=V-G,B=E.r*l+h.r*O+b.r*v+a.r*s,o=E.g*l+h.g*O+b.g*v+a.g*s,u=E.b*l+h.b*O+b.b*v+a.b*s;return new U(B,o,u)}static Hermite1stDerivative(E,b,h,a,k){const G=U.Black();return this.Hermite1stDerivativeToRef(E,b,h,a,k,G),G}static Hermite1stDerivativeToRef(E,b,h,a,k,G){const V=k*k;G.r=6*(V-k)*E.r+(3*V-4*k+1)*b.r+6*(-V+k)*h.r+(3*V-2*k)*a.r,G.g=6*(V-k)*E.g+(3*V-4*k+1)*b.g+6*(-V+k)*h.g+(3*V-2*k)*a.g,G.b=6*(V-k)*E.b+(3*V-4*k+1)*b.b+6*(-V+k)*h.b+(3*V-2*k)*a.b}static Red(){return new U(1,0,0)}static Green(){return new U(0,1,0)}static Blue(){return new U(0,0,1)}static Black(){return new U(0,0,0)}static get BlackReadOnly(){return U._BlackReadOnly}static White(){return new U(1,1,1)}static Purple(){return new U(.5,0,.5)}static Magenta(){return new U(1,0,1)}static Yellow(){return new U(1,1,0)}static Gray(){return new U(.5,.5,.5)}static Teal(){return new U(0,1,1)}static Random(){return new U(Math.random(),Math.random(),Math.random())}}U._BlackReadOnly=U.Black(),Object.defineProperties(U.prototype,{dimension:{value:[3]},rank:{value:1}});class B{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=E,this.g=b,this.b=h,this.a=a}qj(){return[this.r,this.g,this.b,this.a]}toArray(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return E[b]=this.r,E[b+1]=this.g,E[b+2]=this.b,E[b+3]=this.a,this}Yc(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=E[b],this.g=E[b+1],this.b=E[b+2],this.a=E[b+3],this}equals(E){return E&&this.r===E.r&&this.g===E.g&&this.b===E.b&&this.a===E.a}add(E){return new B(this.r+E.r,this.g+E.g,this.b+E.b,this.a+E.a)}addToRef(E,b){return b.r=this.r+E.r,b.g=this.g+E.g,b.b=this.b+E.b,b.a=this.a+E.a,b}addInPlace(E){return this.r+=E.r,this.g+=E.g,this.b+=E.b,this.a+=E.a,this}addInPlaceFromFloats(E,b,h,a){return this.r+=E,this.g+=b,this.b+=h,this.a+=a,this}Xc(E){return new B(this.r-E.r,this.g-E.g,this.b-E.b,this.a-E.a)}subtractToRef(E,b){return b.r=this.r-E.r,b.g=this.g-E.g,b.b=this.b-E.b,b.a=this.a-E.a,b}yi(E){return this.r-=E.r,this.g-=E.g,this.b-=E.b,this.a-=E.a,this}subtractFromFloats(E,b,h,a){return new B(this.r-E,this.g-b,this.b-h,this.a-a)}subtractFromFloatsToRef(E,b,h,a,k){return k.r=this.r-E,k.g=this.g-b,k.b=this.b-h,k.a=this.a-a,k}scale(E){return new B(this.r*E,this.g*E,this.b*E,this.a*E)}scaleInPlace(E){return this.r*=E,this.g*=E,this.b*=E,this.a*=E,this}scaleToRef(E,b){return b.r=this.r*E,b.g=this.g*E,b.b=this.b*E,b.a=this.a*E,b}scaleAndAddToRef(E,b){return b.r+=this.r*E,b.g+=this.g*E,b.b+=this.b*E,b.a+=this.a*E,b}clampToRef(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,h=arguments.length>2?arguments[2]:void 0;return h.r=(0,V.b)(this.r,E,b),h.g=(0,V.b)(this.g,E,b),h.b=(0,V.b)(this.b,E,b),h.a=(0,V.b)(this.a,E,b),h}multiply(E){return new B(this.r*E.r,this.g*E.g,this.b*E.b,this.a*E.a)}multiplyToRef(E,b){return b.r=this.r*E.r,b.g=this.g*E.g,b.b=this.b*E.b,b.a=this.a*E.a,b}multiplyInPlace(E){return this.r*=E.r,this.g*=E.g,this.b*=E.b,this.a*=E.a,this}multiplyByFloats(E,b,h,a){return new B(this.r*E,this.g*b,this.b*h,this.a*a)}divide(E){throw new ReferenceError("Can not divide a color")}divideToRef(E,b){throw new ReferenceError("Can not divide a color")}divideInPlace(E){throw new ReferenceError("Can not divide a color")}minimizeInPlace(E){return this.r=Math.min(this.r,E.r),this.g=Math.min(this.g,E.g),this.b=Math.min(this.b,E.b),this.a=Math.min(this.a,E.a),this}maximizeInPlace(E){return this.r=Math.max(this.r,E.r),this.g=Math.max(this.g,E.g),this.b=Math.max(this.b,E.b),this.a=Math.max(this.a,E.a),this}minimizeInPlaceFromFloats(E,b,h,a){return this.r=Math.min(E,this.r),this.g=Math.min(b,this.g),this.b=Math.min(h,this.b),this.a=Math.min(a,this.a),this}maximizeInPlaceFromFloats(E,b,h,a){return this.r=Math.max(E,this.r),this.g=Math.max(b,this.g),this.b=Math.max(h,this.b),this.a=Math.max(a,this.a),this}floorToRef(E){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(E){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(E){throw new ReferenceError("Can not negate a color")}equalsWithEpsilon(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:G.d;return(0,V.C)(this.r,E.r,b)&&(0,V.C)(this.g,E.g,b)&&(0,V.C)(this.b,E.b,b)&&(0,V.C)(this.a,E.a,b)}equalsToFloats(E,b,h,a){return this.r===E&&this.g===b&&this.b===h&&this.a===a}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"ob"}getHashCode(){let E=255*this.r|0;return E=397*E^255*this.g,E=397*E^255*this.b,E=397*E^255*this.a,E}clone(){return(new B).p(this)}p(E){return this.r=E.r,this.g=E.g,this.b=E.b,this.a=E.a,this}ue(E,b,h,a){return this.r=E,this.g=b,this.b=h,this.a=a,this}set(E,b,h,a){return this.ue(E,b,h,a)}te(E){return this.r=this.g=this.b=this.a=E,this}toHexString(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b=Math.round(255*this.r),h=Math.round(255*this.g),a=Math.round(255*this.b);if(E)return"#"+(0,V.y)(b)+(0,V.y)(h)+(0,V.y)(a);const k=Math.round(255*this.a);return"#"+(0,V.y)(b)+(0,V.y)(h)+(0,V.y)(a)+(0,V.y)(k)}fromHexString(E){return"#"!==E.substring(0,1)||9!==E.length&&7!==E.length||(this.r=parseInt(E.substring(1,3),16)/255,this.g=parseInt(E.substring(3,5),16)/255,this.b=parseInt(E.substring(5,7),16)/255,9===E.length&&(this.a=parseInt(E.substring(7,9),16)/255)),this}toLinearSpace(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b=new B;return this.toLinearSpaceToRef(b,E),b}toLinearSpaceToRef(E){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(E.r=O(this.r),E.g=O(this.g),E.b=O(this.b)):(E.r=l(this.r),E.g=l(this.g),E.b=l(this.b)),E.a=this.a,this}toGammaSpace(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b=new B;return this.toGammaSpaceToRef(b,E),b}toGammaSpaceToRef(E){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(E.r=s(this.r),E.g=s(this.g),E.b=s(this.b)):(E.r=v(this.r),E.g=v(this.g),E.b=v(this.b)),E.a=this.a,this}static FromHexString(E){return"#"!==E.substring(0,1)||9!==E.length&&7!==E.length?new B(0,0,0,0):new B(0,0,0,1).fromHexString(E)}static Lerp(E,b,h){return B.LerpToRef(E,b,h,new B)}static LerpToRef(E,b,h,a){return a.r=E.r+(b.r-E.r)*h,a.g=E.g+(b.g-E.g)*h,a.b=E.b+(b.b-E.b)*h,a.a=E.a+(b.a-E.a)*h,a}static Hermite(E,b,h,a,k){const G=k*k,V=k*G,l=2*V-3*G+1,O=-2*V+3*G,v=V-2*G+k,s=V-G,U=E.r*l+h.r*O+b.r*v+a.r*s,o=E.g*l+h.g*O+b.g*v+a.g*s,u=E.b*l+h.b*O+b.b*v+a.b*s,D=E.a*l+h.a*O+b.a*v+a.a*s;return new B(U,o,u,D)}static Hermite1stDerivative(E,b,h,a,k){const G=new B;return this.Hermite1stDerivativeToRef(E,b,h,a,k,G),G}static Hermite1stDerivativeToRef(E,b,h,a,k,G){const V=k*k;G.r=6*(V-k)*E.r+(3*V-4*k+1)*b.r+6*(-V+k)*h.r+(3*V-2*k)*a.r,G.g=6*(V-k)*E.g+(3*V-4*k+1)*b.g+6*(-V+k)*h.g+(3*V-2*k)*a.g,G.b=6*(V-k)*E.b+(3*V-4*k+1)*b.b+6*(-V+k)*h.b+(3*V-2*k)*a.b,G.a=6*(V-k)*E.a+(3*V-4*k+1)*b.a+6*(-V+k)*h.a+(3*V-2*k)*a.a}static FromColor3(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new B(E.r,E.g,E.b,b)}static jh(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new B(E[b],E[b+1],E[b+2],E[b+3])}static FromArrayToRef(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0;h.r=E[b],h.g=E[b+1],h.b=E[b+2],h.a=E[b+3]}static FromInts(E,b,h,a){return new B(E/255,b/255,h/255,a/255)}static CheckColors4(E,b){if(E.length===3*b){const b=[];for(let h=0;h<E.length;h+=3){const a=h/3*4;b[a]=E[h],b[a+1]=E[h+1],b[a+2]=E[h+2],b[a+3]=1}return b}return E}}Object.defineProperties(B.prototype,{dimension:{value:[4]},rank:{value:1}});class o{}o.gb=(0,a.b)(3,U.Black),o.ob=(0,a.b)(3,(()=>new B(0,0,0,0))),(0,k.f)("BABYLON.Color3",U),(0,k.f)("BABYLON.Color4",B)},11177:(E,b,h)=>{"use strict";h.d(b,{d:()=>V,g:()=>G,h:()=>a,i:()=>k});const a=1/2.2,k=2.2,G=(1+Math.sqrt(5))/2,V=.001},11282:(E,b,h)=>{"use strict";h.d(b,{c:()=>k});var a=h(11284);class k{static GetPlanes(E){const b=[];for(let h=0;h<6;h++)b.push(new a.c(0,0,0,0));return k.GetPlanesToRef(E,b),b}static GetNearPlaneToRef(E,b){const h=E.m;b.k.x=h[3]+h[2],b.k.y=h[7]+h[6],b.k.z=h[11]+h[10],b.d=h[15]+h[14],b.normalize()}static GetFarPlaneToRef(E,b){const h=E.m;b.k.x=h[3]-h[2],b.k.y=h[7]-h[6],b.k.z=h[11]-h[10],b.d=h[15]-h[14],b.normalize()}static GetLeftPlaneToRef(E,b){const h=E.m;b.k.x=h[3]+h[0],b.k.y=h[7]+h[4],b.k.z=h[11]+h[8],b.d=h[15]+h[12],b.normalize()}static GetRightPlaneToRef(E,b){const h=E.m;b.k.x=h[3]-h[0],b.k.y=h[7]-h[4],b.k.z=h[11]-h[8],b.d=h[15]-h[12],b.normalize()}static GetTopPlaneToRef(E,b){const h=E.m;b.k.x=h[3]-h[1],b.k.y=h[7]-h[5],b.k.z=h[11]-h[9],b.d=h[15]-h[13],b.normalize()}static GetBottomPlaneToRef(E,b){const h=E.m;b.k.x=h[3]+h[1],b.k.y=h[7]+h[5],b.k.z=h[11]+h[9],b.d=h[15]+h[13],b.normalize()}static GetPlanesToRef(E,b){k.GetNearPlaneToRef(E,b[0]),k.GetFarPlaneToRef(E,b[1]),k.GetLeftPlaneToRef(E,b[2]),k.GetRightPlaneToRef(E,b[3]),k.GetTopPlaneToRef(E,b[4]),k.GetBottomPlaneToRef(E,b[5])}static IsPointInFrustum(E,b){for(let h=0;h<6;h++)if(b[h].dotCoordinate(E)<0)return!1;return!0}}},11343:(E,b,h)=>{"use strict";h.d(b,{b:()=>l,d:()=>O});var a=h(11130),k=h(11175),G=h(11139);class V{static extractMinAndMaxIndexed(E,b,h,a,k,G){for(let V=h;V<h+a;V++){const h=3*b[V],a=E[h],l=E[h+1],O=E[h+2];k.minimizeInPlaceFromFloats(a,l,O),G.maximizeInPlaceFromFloats(a,l,O)}}static extractMinAndMax(E,b,h,a,k,G){for(let V=b,l=b*a;V<b+h;V++,l+=a){const b=E[l],h=E[l+1],a=E[l+2];k.minimizeInPlaceFromFloats(b,h,a),G.maximizeInPlaceFromFloats(b,h,a)}}}function l(E,b,h,a){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const l=new k.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),O=new k.k(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return V.extractMinAndMaxIndexed(E,b,h,a,l,O),G&&(l.x-=l.x*G.x+G.y,l.y-=l.y*G.x+G.y,l.z-=l.z*G.x+G.y,O.x+=O.x*G.x+G.y,O.y+=O.y*G.x+G.y,O.z+=O.z*G.x+G.y),{minimum:l,maximum:O}}function O(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,G=arguments.length>4?arguments[4]:void 0;const l=new k.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),O=new k.k(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return G||(G=3),V.extractMinAndMax(E,b,h,G,l,O),a&&(l.x-=l.x*a.x+a.y,l.y-=l.y*a.x+a.y,l.z-=l.z*a.x+a.y,O.x+=O.x*a.x+a.y,O.y+=O.y*a.x+a.y,O.z+=O.z*a.x+a.y),{minimum:l,maximum:O}}(0,a.d)([G.d.filter((function(){for(var E=arguments.length,b=new Array(E),h=0;h<E;h++)b[h]=arguments[h];let[a,k]=b;return!Array.isArray(a)&&!Array.isArray(k)}))],V,"extractMinAndMaxIndexed",null),(0,a.d)([G.d.filter((function(){for(var E=arguments.length,b=new Array(E),h=0;h<E;h++)b[h]=arguments[h];let[a]=b;return!Array.isArray(a)}))],V,"extractMinAndMax",null)},11667:(E,b,h)=>{"use strict";h.d(b,{c:()=>a.h});h(11466),h(11201),h(11177),h(11282),h(11673),h(11284),h(11383);var a=h(11175);h(11432)},11673:(E,b,h)=>{"use strict";h.d(b,{e:()=>l,h:()=>s,k:()=>U});var a,k=h(11186),G=h(11175),V=h(11177);!function(E){E[E.CW=0]="CW",E[E.CCW=1]="CCW"}(a||(a={}));class l{static Interpolate(E,b,h,a,k){const G=1-3*a+3*b,V=3*a-6*b,l=3*b;let O=E;for(let v=0;v<5;v++){const b=O*O;O-=(G*(b*O)+V*b+l*O-E)*(1/(3*G*b+2*V*O+l)),O=Math.min(1,Math.max(0,O))}return 3*Math.pow(1-O,2)*O*h+3*(1-O)*Math.pow(O,2)*k+Math.pow(O,3)}}class O{constructor(E){this._radians=E,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}static BetweenTwoPoints(E,b){const h=b.Xc(E),a=Math.atan2(h.y,h.x);return new O(a)}static BetweenTwoVectors(E,b){let h=E.lengthSquared()*b.lengthSquared();if(0===h)return new O(Math.PI/2);h=Math.sqrt(h);let a=E.dot(b)/h;a=(0,k.b)(a,-1,1);const G=Math.acos(a);return new O(G)}static FromRadians(E){return new O(E)}static FromDegrees(E){return new O(E*Math.PI/180)}}class v{constructor(E,b,h){this.startPoint=E,this.midPoint=b,this.endPoint=h;const a=Math.pow(b.x,2)+Math.pow(b.y,2),k=(Math.pow(E.x,2)+Math.pow(E.y,2)-a)/2,V=(a-Math.pow(h.x,2)-Math.pow(h.y,2))/2,l=(E.x-b.x)*(b.y-h.y)-(b.x-h.x)*(E.y-b.y);this.centerPoint=new G.j((k*(b.y-h.y)-V*(E.y-b.y))/l,((E.x-b.x)*V-(b.x-h.x)*k)/l),this.radius=this.centerPoint.Xc(this.startPoint).length(),this.startAngle=O.BetweenTwoPoints(this.centerPoint,this.startPoint);const v=this.startAngle.degrees();let s=O.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),U=O.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();s-v>180&&(s-=360),s-v<-180&&(s+=360),U-s>180&&(U-=360),U-s<-180&&(U+=360),this.orientation=s-v<0?0:1,this.angle=O.FromDegrees(0===this.orientation?v-U:U-v)}}class s{constructor(E,b){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new G.j(E,b))}addLineTo(E,b){if(this.closed)return this;const h=new G.j(E,b),a=this._points[this._points.length-1];return this._points.push(h),this._length+=h.Xc(a).length(),this}addArcTo(E,b,h,a){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const V=this._points[this._points.length-1],l=new G.j(E,b),O=new G.j(h,a),s=new v(V,l,O);let U=s.angle.radians()/k;0===s.orientation&&(U*=-1);let B=s.startAngle.radians()+U;for(let G=0;G<k;G++){const E=Math.cos(B)*s.radius+s.centerPoint.x,b=Math.sin(B)*s.radius+s.centerPoint.y;this.addLineTo(E,b),B+=U}return this}addQuadraticCurveTo(E,b,h,a){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const G=(E,b,h,a)=>(1-E)*(1-E)*b+2*E*(1-E)*h+E*E*a,V=this._points[this._points.length-1];for(let l=0;l<=k;l++){const O=l/k,v=G(O,V.x,E,h),s=G(O,V.y,b,a);this.addLineTo(v,s)}return this}addBezierCurveTo(E,b,h,a,k,G){let V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:36;if(this.closed)return this;const l=(E,b,h,a,k)=>(1-E)*(1-E)*(1-E)*b+3*E*(1-E)*(1-E)*h+3*E*E*(1-E)*a+E*E*E*k,O=this._points[this._points.length-1];for(let v=0;v<=V;v++){const s=v/V,U=l(s,O.x,E,h,k),B=l(s,O.y,b,a,G);this.addLineTo(U,B)}return this}isPointInside(E){let b=!1;const h=this._points.length;for(let a=h-1,k=0;k<h;a=k++){let h=this._points[a],G=this._points[k],V=G.x-h.x,l=G.y-h.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(h=this._points[k],V=-V,G=this._points[a],l=-l),E.y<h.y||E.y>G.y)continue;if(E.y===h.y&&E.x===h.x)return!0;{const a=l*(E.x-h.x)-V*(E.y-h.y);if(0===a)return!0;if(a<0)continue;b=!b}}else{if(E.y!==h.y)continue;if(G.x<=E.x&&E.x<=h.x||h.x<=E.x&&E.x<=G.x)return!0}}return b}close(){return this.closed=!0,this}length(){let E=this._length;if(this.closed){const b=this._points[this._points.length-1];E+=this._points[0].Xc(b).length()}return E}area(){const E=this._points.length;let b=0;for(let h=E-1,a=0;a<E;h=a++)b+=this._points[h].x*this._points[a].y-this._points[a].x*this._points[h].y;return.5*b}getPoints(){return this._points}getPointAtLengthPosition(E){if(E<0||E>1)return G.j.Zero();const b=E*this.length();let h=0;for(let a=0;a<this._points.length;a++){const E=(a+1)%this._points.length,k=this._points[a],V=this._points[E].Xc(k),l=V.length()+h;if(b>=h&&b<=l){const E=V.normalize(),a=b-h;return new G.j(k.x+E.x*a,k.y+E.y*a)}h=l}return G.j.Zero()}static StartingAt(E,b){return new s(E,b)}}class U{constructor(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.path=E,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:G.k.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:G.d.Identity()};for(let k=0;k<E.length;k++)this._curve[k]=E[k].clone();this._raw=h||!1,this._alignTangentsWithPath=a,this._compute(b,a)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(E){return this._updatePointAtData(E).point}getTangentAt(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(E,b),b?G.k.TransformCoordinates(G.k.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(E,b),b?G.k.TransformCoordinates(G.k.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(E,b),b?G.k.TransformCoordinates(G.k.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(E){return this.length()*E}getPreviousPointIndexAt(E){return this._updatePointAtData(E),this._pointAtData.previousPointArrayIndex}getSubPositionAt(E){return this._updatePointAtData(E),this._pointAtData.subPosition}getClosestPositionTo(E){let b=Number.MAX_VALUE,h=0;for(let a=0;a<this._curve.length-1;a++){const k=this._curve[a+0],V=this._curve[a+1].Xc(k).normalize(),l=this._distances[a+1]-this._distances[a+0],O=Math.min(Math.max(G.k.Dot(V,E.Xc(k).normalize()),0)*G.k.Distance(k,E)/l,1),v=G.k.Distance(k.add(V.scale(O*l)),E);v<b&&(b=v,h=(this._distances[a+0]+l*O)/this.length())}return h}slice(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(E<0&&(E=1- -1*E%1),b<0&&(b=1- -1*b%1),E>b){const h=E;E=b,b=h}const h=this.getCurve(),a=this.getPointAt(E);let k=this.getPreviousPointIndexAt(E);const G=this.getPointAt(b),V=this.getPreviousPointIndexAt(b)+1,l=[];return 0!==E&&(k++,l.push(a)),l.push(...h.slice(k,V)),1===b&&1!==E||l.push(G),new U(l,this.getNormalAt(E),this._raw,this._alignTangentsWithPath)}update(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(let a=0;a<E.length;a++)this._curve[a].x=E[a].x,this._curve[a].y=E[a].y,this._curve[a].z=E[a].z;return this._compute(b,h),this}_compute(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const h=this._curve.length;if(h<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[h-1]=this._curve[h-1].Xc(this._curve[h-2]),this._raw||this._tangents[h-1].normalize();const a=this._tangents[0],k=this._normalVector(a,E);let V,l,O,v,s;this._normals[0]=k,this._raw||this._normals[0].normalize(),this._binormals[0]=G.k.Cross(a,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let U=1;U<h;U++)V=this._getLastNonNullVector(U),U<h-1&&(l=this._getFirstNonNullVector(U),this._tangents[U]=b?l:V.add(l),this._tangents[U].normalize()),this._distances[U]=this._distances[U-1]+this._curve[U].Xc(this._curve[U-1]).length(),O=this._tangents[U],s=this._binormals[U-1],this._normals[U]=G.k.Cross(s,O),this._raw||(0===this._normals[U].length()?(v=this._normals[U-1],this._normals[U]=v.clone()):this._normals[U].normalize()),this._binormals[U]=G.k.Cross(O,this._normals[U]),this._raw||this._binormals[U].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(E){let b=1,h=this._curve[E+b].Xc(this._curve[E]);for(;0===h.length()&&E+b+1<this._curve.length;)b++,h=this._curve[E+b].Xc(this._curve[E]);return h}_getLastNonNullVector(E){let b=1,h=this._curve[E].Xc(this._curve[E-b]);for(;0===h.length()&&E>b+1;)b++,h=this._curve[E].Xc(this._curve[E-b]);return h}_normalVector(E,b){let h,a=E.length();if(0===a&&(a=1),void 0===b||null===b){let b;b=(0,k.C)(Math.abs(E.y)/a,1,V.d)?(0,k.C)(Math.abs(E.x)/a,1,V.d)?(0,k.C)(Math.abs(E.z)/a,1,V.d)?G.k.Zero():new G.k(0,0,1):new G.k(1,0,0):new G.k(0,-1,0),h=G.k.Cross(E,b)}else h=G.k.Cross(E,b),G.k.CrossToRef(h,E,h);return h.normalize(),h}_updatePointAtData(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._pointAtData.id===E)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=E;const h=this.getPoints();if(E<=0)return this._setPointAtData(0,0,h[0],0,b);if(E>=1)return this._setPointAtData(1,1,h[h.length-1],h.length-1,b);let a,k=h[0],V=0;const l=E*this.length();for(let O=1;O<h.length;O++){a=h[O];const v=G.k.Distance(k,a);if(V+=v,V===l)return this._setPointAtData(E,1,a,O,b);if(V>l){const h=(V-l)/v,G=k.Xc(a),s=a.add(G.scaleInPlace(h));return this._setPointAtData(E,1-h,s,O-1,b)}k=a}return this._pointAtData}_setPointAtData(E,b,h,a,k){return this._pointAtData.point=h,this._pointAtData.position=E,this._pointAtData.subPosition=b,this._pointAtData.previousPointArrayIndex=a,this._pointAtData.interpolateReady=k,k&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=G.d.Identity();const E=this._pointAtData.previousPointArrayIndex;if(E!==this._tangents.length-1){const b=E+1,h=this._tangents[E].clone(),a=this._normals[E].clone(),k=this._binormals[E].clone(),V=this._tangents[b].clone(),l=this._normals[b].clone(),O=this._binormals[b].clone(),v=G.g.RotationQuaternionFromAxis(a,k,h),s=G.g.RotationQuaternionFromAxis(l,O,V);G.g.Slerp(v,s,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}},11284:(E,b,h)=>{"use strict";h.d(b,{c:()=>k});var a=h(11175);class k{constructor(E,b,h,k){this.k=new a.k(E,b,h),this.d=k}qj(){return[this.k.x,this.k.y,this.k.z,this.d]}clone(){return new k(this.k.x,this.k.y,this.k.z,this.d)}getClassName(){return"Plane"}getHashCode(){let E=this.k.getHashCode();return E=397*E^this.d,E}normalize(){const E=Math.sqrt(this.k.x*this.k.x+this.k.y*this.k.y+this.k.z*this.k.z);let b=0;return 0!==E&&(b=1/E),this.k.x*=b,this.k.y*=b,this.k.z*=b,this.d*=b,this}transform(E){const b=k._TmpMatrix;E.invertToRef(b);const h=b.m,a=this.k.x,G=this.k.y,V=this.k.z,l=this.d,O=a*h[0]+G*h[1]+V*h[2]+l*h[3],v=a*h[4]+G*h[5]+V*h[6]+l*h[7],s=a*h[8]+G*h[9]+V*h[10]+l*h[11],U=a*h[12]+G*h[13]+V*h[14]+l*h[15];return new k(O,v,s,U)}dotCoordinate(E){return this.k.x*E.x+this.k.y*E.y+this.k.z*E.z+this.d}copyFromPoints(E,b,h){const a=b.x-E.x,k=b.y-E.y,G=b.z-E.z,V=h.x-E.x,l=h.y-E.y,O=h.z-E.z,v=k*O-G*l,s=G*V-a*O,U=a*l-k*V,B=Math.sqrt(v*v+s*s+U*U);let o;return o=0!==B?1/B:0,this.k.x=v*o,this.k.y=s*o,this.k.z=U*o,this.d=-(this.k.x*E.x+this.k.y*E.y+this.k.z*E.z),this}isFrontFacingTo(E,b){return a.k.Dot(this.k,E)<=b}signedDistanceTo(E){return a.k.Dot(E,this.k)+this.d}static jh(E){return new k(E[0],E[1],E[2],E[3])}static FromPoints(E,b,h){const a=new k(0,0,0,0);return a.copyFromPoints(E,b,h),a}static FromPositionAndNormal(E,b){const h=new k(0,0,0,0);return this.FromPositionAndNormalToRef(E,b,h)}static FromPositionAndNormalToRef(E,b,h){return h.k.p(b),h.k.normalize(),h.d=-E.dot(h.k),h}static SignedDistanceToPlaneFromPositionAndNormal(E,b,h){const k=-(b.x*E.x+b.y*E.y+b.z*E.z);return a.k.Dot(h,b)+k}}k._TmpMatrix=a.d.Identity()},11186:(E,b,h)=>{"use strict";function a(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1401298e-51;return Math.abs(E-b)<=h}function k(E,b){return E===b?E:Math.random()*(b-E)+E}function G(E,b,h){return E+(b-E)*h}function V(E,b,h,a,k){const G=k*k,V=k*G;return E*(2*V-3*G+1)+h*(-2*V+3*G)+b*(V-2*G+k)+a*(V-G)}function l(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(h,Math.max(b,E))}function O(E){return E-=2*Math.PI*Math.floor((E+Math.PI)/(2*Math.PI))}function v(E){const b=E.toString(16);return E<=15?("0"+b).toUpperCase():b.toUpperCase()}function s(E){if(Math.log2)return Math.floor(Math.log2(E));if(E<0)return NaN;if(0===E)return-1/0;let b=0;if(E<1){for(;E<1;)b++,E*=2;b=-b}else if(E>1)for(;E>1;)b++,E=Math.floor(E/2);return b}function U(E,b){const h=E%b;return 0===h?b:U(b,h)}h.d(b,{C:()=>a,b:()=>l,d:()=>V,h:()=>U,l:()=>s,o:()=>G,s:()=>O,w:()=>k,y:()=>v})},11383:(E,b,h)=>{"use strict";h.d(b,{c:()=>a});class a{constructor(E,b){this.width=E,this.height=b}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let E=0|this.width;return E=397*E^this.height,E}p(E){this.width=E.width,this.height=E.height}ue(E,b){return this.width=E,this.height=b,this}set(E,b){return this.ue(E,b)}multiplyByFloats(E,b){return new a(this.width*E,this.height*b)}clone(){return new a(this.width,this.height)}equals(E){return!!E&&(this.width===E.width&&this.height===E.height)}get surface(){return this.width*this.height}static Zero(){return new a(0,0)}add(E){return new a(this.width+E.width,this.height+E.height)}Xc(E){return new a(this.width-E.width,this.height-E.height)}scale(E){return new a(this.width*E,this.height*E)}static Lerp(E,b,h){const k=E.width+(b.width-E.width)*h,G=E.height+(b.height-E.height)*h;return new a(k,G)}}},11175:(E,b,h)=>{"use strict";h.d(b,{d:()=>u,g:()=>o,h:()=>g,j:()=>s,k:()=>U,n:()=>B});var a=h(11177),k=h(11183),G=h(10958),V=h(10931),l=h(10869),O=h(11186);const v=E=>parseInt(E.toString().replace(/\W/g,""));class s{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=E,this.y=b}toString(){return`{X: ${this.x} Y: ${this.y}}`}getClassName(){return"Vector2"}getHashCode(){let E=v(this.x);return E=397*E^v(this.y),E}toArray(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return E[b]=this.x,E[b+1]=this.y,this}Yc(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return s.FromArrayToRef(E,b,this),this}qj(){return[this.x,this.y]}p(E){return this.x=E.x,this.y=E.y,this}ue(E,b){return this.x=E,this.y=b,this}set(E,b){return this.ue(E,b)}te(E){return this.ue(E,E)}add(E){return new s(this.x+E.x,this.y+E.y)}addToRef(E,b){return b.x=this.x+E.x,b.y=this.y+E.y,b}addInPlace(E){return this.x+=E.x,this.y+=E.y,this}addInPlaceFromFloats(E,b){return this.x+=E,this.y+=b,this}addVector3(E){return new s(this.x+E.x,this.y+E.y)}Xc(E){return new s(this.x-E.x,this.y-E.y)}subtractToRef(E,b){return b.x=this.x-E.x,b.y=this.y-E.y,b}yi(E){return this.x-=E.x,this.y-=E.y,this}multiplyInPlace(E){return this.x*=E.x,this.y*=E.y,this}multiply(E){return new s(this.x*E.x,this.y*E.y)}multiplyToRef(E,b){return b.x=this.x*E.x,b.y=this.y*E.y,b}multiplyByFloats(E,b){return new s(this.x*E,this.y*b)}divide(E){return new s(this.x/E.x,this.y/E.y)}divideToRef(E,b){return b.x=this.x/E.x,b.y=this.y/E.y,b}divideInPlace(E){return this.x=this.x/E.x,this.y=this.y/E.y,this}minimizeInPlace(E){return this.minimizeInPlaceFromFloats(E.x,E.y)}maximizeInPlace(E){return this.maximizeInPlaceFromFloats(E.x,E.y)}minimizeInPlaceFromFloats(E,b){return this.x=Math.min(E,this.x),this.y=Math.min(b,this.y),this}maximizeInPlaceFromFloats(E,b){return this.x=Math.max(E,this.x),this.y=Math.max(b,this.y),this}subtractFromFloats(E,b){return new s(this.x-E,this.y-b)}subtractFromFloatsToRef(E,b,h){return h.x=this.x-E,h.y=this.y-b,h}negate(){return new s(-this.x,-this.y)}negateInPlace(){return this.x*=-1,this.y*=-1,this}negateToRef(E){return E.x=-this.x,E.y=-this.y,E}scaleInPlace(E){return this.x*=E,this.y*=E,this}scale(E){return new s(this.x*E,this.y*E)}scaleToRef(E,b){return b.x=this.x*E,b.y=this.y*E,b}scaleAndAddToRef(E,b){return b.x+=this.x*E,b.y+=this.y*E,b}equals(E){return E&&this.x===E.x&&this.y===E.y}equalsWithEpsilon(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.d;return E&&(0,O.C)(this.x,E.x,b)&&(0,O.C)(this.y,E.y,b)}equalsToFloats(E,b){return this.x===E&&this.y===b}floor(){return new s(Math.floor(this.x),Math.floor(this.y))}floorToRef(E){return E.x=Math.floor(this.x),E.y=Math.floor(this.y),E}fract(){return new s(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}fractToRef(E){return E.x=this.x-Math.floor(this.x),E.y=this.y-Math.floor(this.y),E}rotateToRef(E,b){const h=Math.cos(E),a=Math.sin(E),k=h*this.x-a*this.y,G=a*this.x+h*this.y;return b.x=k,b.y=G,b}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(E){return 0===E||1===E?this:this.scaleInPlace(1/E)}normalizeToNew(){const E=new s;return this.normalizeToRef(E),E}normalizeToRef(E){const b=this.length();return 0===b&&(E.x=this.x,E.y=this.y),this.scaleToRef(1/b,E)}clone(){return new s(this.x,this.y)}dot(E){return this.x*E.x+this.y*E.y}static Zero(){return new s(0,0)}static One(){return new s(1,1)}static Random(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new s((0,O.w)(E,b),(0,O.w)(E,b))}static RandomToRef(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).ue((0,O.w)(E,b),(0,O.w)(E,b))}static get ZeroReadOnly(){return s._ZeroReadOnly}static jh(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new s(E[b],E[b+1])}static FromArrayToRef(E,b,h){return h.x=E[b],h.y=E[b+1],h}static FromFloatsToRef(E,b,h){return h.ue(E,b),h}static CatmullRom(E,b,h,a,k){const G=k*k,V=k*G,l=.5*(2*b.x+(-E.x+h.x)*k+(2*E.x-5*b.x+4*h.x-a.x)*G+(-E.x+3*b.x-3*h.x+a.x)*V),O=.5*(2*b.y+(-E.y+h.y)*k+(2*E.y-5*b.y+4*h.y-a.y)*G+(-E.y+3*b.y-3*h.y+a.y)*V);return new s(l,O)}static ClampToRef(E,b,h,a){return a.x=(0,O.b)(E.x,b.x,h.x),a.y=(0,O.b)(E.y,b.y,h.y),a}static Clamp(E,b,h){const a=(0,O.b)(E.x,b.x,h.x),k=(0,O.b)(E.y,b.y,h.y);return new s(a,k)}static Hermite(E,b,h,a,k){const G=k*k,V=k*G,l=2*V-3*G+1,O=-2*V+3*G,v=V-2*G+k,U=V-G,B=E.x*l+h.x*O+b.x*v+a.x*U,o=E.y*l+h.y*O+b.y*v+a.y*U;return new s(B,o)}static Hermite1stDerivative(E,b,h,a,k){return this.Hermite1stDerivativeToRef(E,b,h,a,k,new s)}static Hermite1stDerivativeToRef(E,b,h,a,k,G){const V=k*k;return G.x=6*(V-k)*E.x+(3*V-4*k+1)*b.x+6*(-V+k)*h.x+(3*V-2*k)*a.x,G.y=6*(V-k)*E.y+(3*V-4*k+1)*b.y+6*(-V+k)*h.y+(3*V-2*k)*a.y,G}static Lerp(E,b,h){return s.LerpToRef(E,b,h,new s)}static LerpToRef(E,b,h,a){return a.x=E.x+(b.x-E.x)*h,a.y=E.y+(b.y-E.y)*h,a}static Dot(E,b){return E.x*b.x+E.y*b.y}static Normalize(E){return s.NormalizeToRef(E,new s)}static NormalizeToRef(E,b){return E.normalizeToRef(b),b}static Minimize(E,b){const h=E.x<b.x?E.x:b.x,a=E.y<b.y?E.y:b.y;return new s(h,a)}static Maximize(E,b){const h=E.x>b.x?E.x:b.x,a=E.y>b.y?E.y:b.y;return new s(h,a)}static Transform(E,b){return s.TransformToRef(E,b,new s)}static TransformToRef(E,b,h){const a=b.m,k=E.x*a[0]+E.y*a[4]+a[12],G=E.x*a[1]+E.y*a[5]+a[13];return h.x=k,h.y=G,h}static PointInTriangle(E,b,h,a){const k=.5*(-h.y*a.x+b.y*(-h.x+a.x)+b.x*(h.y-a.y)+h.x*a.y),G=k<0?-1:1,V=(b.y*a.x-b.x*a.y+(a.y-b.y)*E.x+(b.x-a.x)*E.y)*G,l=(b.x*h.y-b.y*h.x+(b.y-h.y)*E.x+(h.x-b.x)*E.y)*G;return V>0&&l>0&&V+l<2*k*G}static Distance(E,b){return Math.sqrt(s.DistanceSquared(E,b))}static DistanceSquared(E,b){const h=E.x-b.x,a=E.y-b.y;return h*h+a*a}static Center(E,b){return s.CenterToRef(E,b,new s)}static CenterToRef(E,b,h){return h.ue((E.x+b.x)/2,(E.y+b.y)/2)}static DistanceOfPointFromSegment(E,b,h){const a=s.DistanceSquared(b,h);if(0===a)return s.Distance(E,b);const k=h.Xc(b),G=Math.max(0,Math.min(1,s.Dot(E.Xc(b),k)/a)),V=b.add(k.multiplyByFloats(G,G));return s.Distance(E,V)}}s._ZeroReadOnly=s.Zero(),Object.defineProperties(s.prototype,{dimension:{value:[2]},rank:{value:1}});class U{get x(){return this._x}set x(E){this._x=E,this._isDirty=!0}get y(){return this._y}set y(E){this._y=E,this._isDirty=!0}get z(){return this._z}set z(E){this._z=E,this._isDirty=!0}constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._isDirty=!0,this._x=E,this._y=b,this._z=h}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z}}`}getClassName(){return"o"}getHashCode(){let E=v(this._x);return E=397*E^v(this._y),E=397*E^v(this._z),E}qj(){return[this._x,this._y,this._z]}toArray(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return E[b]=this._x,E[b+1]=this._y,E[b+2]=this._z,this}Yc(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return U.FromArrayToRef(E,b,this),this}toQuaternion(){return o.RotationYawPitchRoll(this._y,this._x,this._z)}addInPlace(E){return this._x+=E._x,this._y+=E._y,this._z+=E._z,this._isDirty=!0,this}addInPlaceFromFloats(E,b,h){return this._x+=E,this._y+=b,this._z+=h,this._isDirty=!0,this}add(E){return new U(this._x+E._x,this._y+E._y,this._z+E._z)}addToRef(E,b){return b._x=this._x+E._x,b._y=this._y+E._y,b._z=this._z+E._z,b._isDirty=!0,b}yi(E){return this._x-=E._x,this._y-=E._y,this._z-=E._z,this._isDirty=!0,this}Xc(E){return new U(this._x-E._x,this._y-E._y,this._z-E._z)}subtractToRef(E,b){return this.subtractFromFloatsToRef(E._x,E._y,E._z,b)}subtractFromFloats(E,b,h){return new U(this._x-E,this._y-b,this._z-h)}subtractFromFloatsToRef(E,b,h,a){return a._x=this._x-E,a._y=this._y-b,a._z=this._z-h,a._isDirty=!0,a}negate(){return new U(-this._x,-this._y,-this._z)}negateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}negateToRef(E){return E._x=-1*this._x,E._y=-1*this._y,E._z=-1*this._z,E._isDirty=!0,E}scaleInPlace(E){return this._x*=E,this._y*=E,this._z*=E,this._isDirty=!0,this}scale(E){return new U(this._x*E,this._y*E,this._z*E)}scaleToRef(E,b){return b._x=this._x*E,b._y=this._y*E,b._z=this._z*E,b._isDirty=!0,b}getNormalToRef(E){const b=this.length();let h=Math.acos(this.y/b);const a=Math.atan2(this.z,this.x);h>Math.PI/2?h-=Math.PI/2:h+=Math.PI/2;const k=b*Math.sin(h)*Math.cos(a),G=b*Math.cos(h),V=b*Math.sin(h)*Math.sin(a);return E.set(k,G,V),E}applyRotationQuaternionToRef(E,b){const h=this._x,a=this._y,k=this._z,G=E._x,V=E._y,l=E._z,O=E._w,v=2*(V*k-l*a),s=2*(l*h-G*k),U=2*(G*a-V*h);return b._x=h+O*v+V*U-l*s,b._y=a+O*s+l*v-G*U,b._z=k+O*U+G*s-V*v,b._isDirty=!0,b}applyRotationQuaternionInPlace(E){return this.applyRotationQuaternionToRef(E,this)}applyRotationQuaternion(E){return this.applyRotationQuaternionToRef(E,new U)}scaleAndAddToRef(E,b){return b._x+=this._x*E,b._y+=this._y*E,b._z+=this._z*E,b._isDirty=!0,b}projectOnPlane(E,b){return this.projectOnPlaneToRef(E,b,new U)}projectOnPlaneToRef(E,b,h){const a=E.k,k=E.d,G=D.o[0];this.subtractToRef(b,G),G.normalize();const V=U.Dot(G,a);if(Math.abs(V)<1e-10)h.te(1/0);else{const E=-(U.Dot(b,a)+k)/V,l=G.scaleInPlace(E);b.addToRef(l,h)}return h}equals(E){return E&&this._x===E._x&&this._y===E._y&&this._z===E._z}equalsWithEpsilon(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.d;return E&&(0,O.C)(this._x,E._x,b)&&(0,O.C)(this._y,E._y,b)&&(0,O.C)(this._z,E._z,b)}equalsToFloats(E,b,h){return this._x===E&&this._y===b&&this._z===h}multiplyInPlace(E){return this._x*=E._x,this._y*=E._y,this._z*=E._z,this._isDirty=!0,this}multiply(E){return this.multiplyByFloats(E._x,E._y,E._z)}multiplyToRef(E,b){return b._x=this._x*E._x,b._y=this._y*E._y,b._z=this._z*E._z,b._isDirty=!0,b}multiplyByFloats(E,b,h){return new U(this._x*E,this._y*b,this._z*h)}divide(E){return new U(this._x/E._x,this._y/E._y,this._z/E._z)}divideToRef(E,b){return b._x=this._x/E._x,b._y=this._y/E._y,b._z=this._z/E._z,b._isDirty=!0,b}divideInPlace(E){return this._x=this._x/E._x,this._y=this._y/E._y,this._z=this._z/E._z,this._isDirty=!0,this}minimizeInPlace(E){return this.minimizeInPlaceFromFloats(E._x,E._y,E._z)}maximizeInPlace(E){return this.maximizeInPlaceFromFloats(E._x,E._y,E._z)}minimizeInPlaceFromFloats(E,b,h){return E<this._x&&(this.x=E),b<this._y&&(this.y=b),h<this._z&&(this.z=h),this}maximizeInPlaceFromFloats(E,b,h){return E>this._x&&(this.x=E),b>this._y&&(this.y=b),h>this._z&&(this.z=h),this}isNonUniformWithinEpsilon(E){const b=Math.abs(this._x),h=Math.abs(this._y);if(!(0,O.C)(b,h,E))return!0;const a=Math.abs(this._z);return!(0,O.C)(b,a,E)||!(0,O.C)(h,a,E)}get isNonUniform(){const E=Math.abs(this._x);if(E!==Math.abs(this._y))return!0;return E!==Math.abs(this._z)}floorToRef(E){return E._x=Math.floor(this._x),E._y=Math.floor(this._y),E._z=Math.floor(this._z),E._isDirty=!0,E}floor(){return new U(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}fractToRef(E){return E._x=this.x-Math.floor(this._x),E._y=this.y-Math.floor(this._y),E._z=this.z-Math.floor(this._z),E._isDirty=!0,E}fract(){return new U(this.x-Math.floor(this._x),this.y-Math.floor(this._y),this.z-Math.floor(this._z))}length(){return Math.sqrt(this.lengthSquared())}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z}get hasAZeroComponent(){return this._x*this._y*this._z===0}normalize(){return this.normalizeFromLength(this.length())}reorderInPlace(E){if("xyz"===(E=E.toLowerCase()))return this;const b=D.o[0].p(this);return this.x=b[E[0]],this.y=b[E[1]],this.z=b[E[2]],this}rotateByQuaternionToRef(E,b){return E.toRotationMatrix(D.Matrix[0]),U.TransformCoordinatesToRef(this,D.Matrix[0],b),b}rotateByQuaternionAroundPointToRef(E,b,h){return this.subtractToRef(b,D.o[0]),D.o[0].rotateByQuaternionToRef(E,D.o[0]),b.addToRef(D.o[0],h),h}cross(E){return U.CrossToRef(this,E,new U)}normalizeFromLength(E){return 0===E||1===E?this:this.scaleInPlace(1/E)}normalizeToNew(){return this.normalizeToRef(new U)}normalizeToRef(E){const b=this.length();return 0===b||1===b?(E._x=this._x,E._y=this._y,E._z=this._z,E._isDirty=!0,E):this.scaleToRef(1/b,E)}clone(){return new U(this._x,this._y,this._z)}p(E){return this.ue(E._x,E._y,E._z)}ue(E,b,h){return this._x=E,this._y=b,this._z=h,this._isDirty=!0,this}set(E,b,h){return this.ue(E,b,h)}te(E){return this._x=this._y=this._z=E,this._isDirty=!0,this}static GetClipFactor(E,b,h,a){const k=U.Dot(E,h);return(k-a)/(k-U.Dot(b,h))}static GetAngleBetweenVectors(E,b,h){const a=E.normalizeToRef(D.o[1]),k=b.normalizeToRef(D.o[2]);let G=U.Dot(a,k);G=(0,O.b)(G,-1,1);const V=Math.acos(G),l=D.o[3];return U.CrossToRef(a,k,l),U.Dot(l,h)>0?isNaN(V)?0:V:isNaN(V)?-Math.PI:-Math.acos(G)}static GetAngleBetweenVectorsOnPlane(E,b,h){D.o[0].p(E);const a=D.o[0];D.o[1].p(b);const k=D.o[1];D.o[2].p(h);const G=D.o[2],V=D.o[3],l=D.o[4];a.normalize(),k.normalize(),G.normalize(),U.CrossToRef(G,a,V),U.CrossToRef(V,G,l);const v=Math.atan2(U.Dot(k,V),U.Dot(k,l));return(0,O.s)(v)}static PitchYawRollToMoveBetweenPointsToRef(E,b,h){const a=g.o[0];return b.subtractToRef(E,a),h._y=Math.atan2(a.x,a.z)||0,h._x=Math.atan2(Math.sqrt(a.x**2+a.z**2),a.y)||0,h._z=0,h._isDirty=!0,h}static PitchYawRollToMoveBetweenPoints(E,b){const h=U.Zero();return U.PitchYawRollToMoveBetweenPointsToRef(E,b,h)}static SlerpToRef(E,b,h,k){h=(0,O.b)(h,0,1);const G=D.o[0],V=D.o[1];G.p(E);const l=G.length();G.normalizeFromLength(l),V.p(b);const v=V.length();V.normalizeFromLength(v);const s=U.Dot(G,V);let B,o;if(s<1-a.d){const E=Math.acos(s),b=1/Math.sin(E);B=Math.sin((1-h)*E)*b,o=Math.sin(h*E)*b}else B=1-h,o=h;return G.scaleInPlace(B),V.scaleInPlace(o),k.p(G).addInPlace(V),k.scaleInPlace((0,O.o)(l,v,h)),k}static SmoothToRef(E,b,h,a,k){return U.SlerpToRef(E,b,0===a?1:h/a,k),k}static jh(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new U(E[b],E[b+1],E[b+2])}static FromFloatArray(E,b){return U.jh(E,b)}static FromArrayToRef(E,b,h){return h._x=E[b],h._y=E[b+1],h._z=E[b+2],h._isDirty=!0,h}static FromFloatArrayToRef(E,b,h){return U.FromArrayToRef(E,b,h)}static FromFloatsToRef(E,b,h,a){return a.ue(E,b,h),a}static Zero(){return new U(0,0,0)}static One(){return new U(1,1,1)}static Up(){return new U(0,1,0)}static get UpReadOnly(){return U._UpReadOnly}static get DownReadOnly(){return U._DownReadOnly}static get RightReadOnly(){return U._RightReadOnly}static get LeftReadOnly(){return U._LeftReadOnly}static get LeftHandedForwardReadOnly(){return U._LeftHandedForwardReadOnly}static get RightHandedForwardReadOnly(){return U._RightHandedForwardReadOnly}static get LeftHandedBackwardReadOnly(){return U._LeftHandedBackwardReadOnly}static get RightHandedBackwardReadOnly(){return U._RightHandedBackwardReadOnly}static get ZeroReadOnly(){return U._ZeroReadOnly}static get OneReadOnly(){return U._OneReadOnly}static Down(){return new U(0,-1,0)}static Forward(){return new U(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?-1:1)}static Backward(){return new U(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?1:-1)}static Right(){return new U(1,0,0)}static Left(){return new U(-1,0,0)}static Random(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new U((0,O.w)(E,b),(0,O.w)(E,b),(0,O.w)(E,b))}static RandomToRef(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).ue((0,O.w)(E,b),(0,O.w)(E,b),(0,O.w)(E,b))}static TransformCoordinates(E,b){const h=U.Zero();return U.TransformCoordinatesToRef(E,b,h),h}static TransformCoordinatesToRef(E,b,h){return U.TransformCoordinatesFromFloatsToRef(E._x,E._y,E._z,b,h),h}static TransformCoordinatesFromFloatsToRef(E,b,h,a,k){const G=a.m,V=E*G[0]+b*G[4]+h*G[8]+G[12],l=E*G[1]+b*G[5]+h*G[9]+G[13],O=E*G[2]+b*G[6]+h*G[10]+G[14],v=1/(E*G[3]+b*G[7]+h*G[11]+G[15]);return k._x=V*v,k._y=l*v,k._z=O*v,k._isDirty=!0,k}static TransformNormal(E,b){const h=U.Zero();return U.TransformNormalToRef(E,b,h),h}static TransformNormalToRef(E,b,h){return this.TransformNormalFromFloatsToRef(E._x,E._y,E._z,b,h),h}static TransformNormalFromFloatsToRef(E,b,h,a,k){const G=a.m;return k._x=E*G[0]+b*G[4]+h*G[8],k._y=E*G[1]+b*G[5]+h*G[9],k._z=E*G[2]+b*G[6]+h*G[10],k._isDirty=!0,k}static CatmullRom(E,b,h,a,k){const G=k*k,V=k*G,l=.5*(2*b._x+(-E._x+h._x)*k+(2*E._x-5*b._x+4*h._x-a._x)*G+(-E._x+3*b._x-3*h._x+a._x)*V),O=.5*(2*b._y+(-E._y+h._y)*k+(2*E._y-5*b._y+4*h._y-a._y)*G+(-E._y+3*b._y-3*h._y+a._y)*V),v=.5*(2*b._z+(-E._z+h._z)*k+(2*E._z-5*b._z+4*h._z-a._z)*G+(-E._z+3*b._z-3*h._z+a._z)*V);return new U(l,O,v)}static Clamp(E,b,h){const a=new U;return U.ClampToRef(E,b,h,a),a}static ClampToRef(E,b,h,a){let k=E._x;k=k>h._x?h._x:k,k=k<b._x?b._x:k;let G=E._y;G=G>h._y?h._y:G,G=G<b._y?b._y:G;let V=E._z;return V=V>h._z?h._z:V,V=V<b._z?b._z:V,a.ue(k,G,V),a}static CheckExtends(E,b,h){b.minimizeInPlace(E),h.maximizeInPlace(E)}static Hermite(E,b,h,a,k){const G=k*k,V=k*G,l=2*V-3*G+1,O=-2*V+3*G,v=V-2*G+k,s=V-G,B=E._x*l+h._x*O+b._x*v+a._x*s,o=E._y*l+h._y*O+b._y*v+a._y*s,u=E._z*l+h._z*O+b._z*v+a._z*s;return new U(B,o,u)}static Hermite1stDerivative(E,b,h,a,k){const G=new U;return this.Hermite1stDerivativeToRef(E,b,h,a,k,G),G}static Hermite1stDerivativeToRef(E,b,h,a,k,G){const V=k*k;return G._x=6*(V-k)*E._x+(3*V-4*k+1)*b._x+6*(-V+k)*h._x+(3*V-2*k)*a._x,G._y=6*(V-k)*E._y+(3*V-4*k+1)*b._y+6*(-V+k)*h._y+(3*V-2*k)*a._y,G._z=6*(V-k)*E._z+(3*V-4*k+1)*b._z+6*(-V+k)*h._z+(3*V-2*k)*a._z,G._isDirty=!0,G}static Lerp(E,b,h){const a=new U(0,0,0);return U.LerpToRef(E,b,h,a),a}static LerpToRef(E,b,h,a){return a._x=E._x+(b._x-E._x)*h,a._y=E._y+(b._y-E._y)*h,a._z=E._z+(b._z-E._z)*h,a._isDirty=!0,a}static Dot(E,b){return E._x*b._x+E._y*b._y+E._z*b._z}dot(E){return this._x*E._x+this._y*E._y+this._z*E._z}static Cross(E,b){const h=new U;return U.CrossToRef(E,b,h),h}static CrossToRef(E,b,h){const a=E._y*b._z-E._z*b._y,k=E._z*b._x-E._x*b._z,G=E._x*b._y-E._y*b._x;return h.ue(a,k,G),h}static Normalize(E){const b=U.Zero();return U.NormalizeToRef(E,b),b}static NormalizeToRef(E,b){return E.normalizeToRef(b),b}static Project(E,b,h,a){const k=new U;return U.ProjectToRef(E,b,h,a,k),k}static ProjectToRef(E,b,h,a,k){var G;const V=a.width,O=a.height,v=a.x,s=a.y,B=D.Matrix[1],o=null===(G=l.b.LastCreatedEngine)||void 0===G?void 0:G.isNDCHalfZRange,g=o?1:.5,S=o?0:.5;u.FromValuesToRef(V/2,0,0,0,0,-O/2,0,0,0,0,g,0,v+V/2,O/2+s,S,1,B);const M=D.Matrix[0];return b.multiplyToRef(h,M),M.multiplyToRef(B,M),U.TransformCoordinatesToRef(E,M,k),k}static Reflect(E,b){return this.ReflectToRef(E,b,new U)}static ReflectToRef(E,b,h){const a=g.o[0];return a.p(b).scaleInPlace(2*U.Dot(E,b)),h.p(E).yi(a)}static _UnprojectFromInvertedMatrixToRef(E,b,h){U.TransformCoordinatesToRef(E,b,h);const a=b.m,k=E._x*a[3]+E._y*a[7]+E._z*a[11]+a[15];return(0,O.C)(k,1)&&h.scaleInPlace(1/k),h}static UnprojectFromTransform(E,b,h,a,k){return this.Unproject(E,b,h,a,k,u.IdentityReadOnly)}static Unproject(E,b,h,a,k,G){const V=new U;return U.UnprojectToRef(E,b,h,a,k,G,V),V}static UnprojectToRef(E,b,h,a,k,G,V){return U.UnprojectFloatsToRef(E._x,E._y,E._z,b,h,a,k,G,V),V}static UnprojectFloatsToRef(E,b,h,a,k,G,V,O,v){var s;const B=D.Matrix[0];G.multiplyToRef(V,B),B.multiplyToRef(O,B),B.invert();const o=D.o[0];return o.x=E/a*2-1,o.y=-(b/k*2-1),null!==(s=l.b.LastCreatedEngine)&&void 0!==s&&s.isNDCHalfZRange?o.z=h:o.z=2*h-1,U._UnprojectFromInvertedMatrixToRef(o,B,v),v}static Minimize(E,b){const h=new U;return h.p(E),h.minimizeInPlace(b),h}static Maximize(E,b){const h=new U;return h.p(E),h.maximizeInPlace(b),h}static Distance(E,b){return Math.sqrt(U.DistanceSquared(E,b))}static DistanceSquared(E,b){const h=E._x-b._x,a=E._y-b._y,k=E._z-b._z;return h*h+a*a+k*k}static ProjectOnTriangleToRef(E,b,h,k,G){const V=D.o[0],l=D.o[1],v=D.o[2],s=D.o[3],B=D.o[4];h.subtractToRef(b,V),k.subtractToRef(b,l),k.subtractToRef(h,v);const o=V.length(),u=l.length(),g=v.length();if(o<a.d||u<a.d||g<a.d)return G.p(b),U.Distance(E,b);E.subtractToRef(b,B),U.CrossToRef(V,l,s);const S=s.length();if(S<a.d)return G.p(b),U.Distance(E,b);s.normalizeFromLength(S);let M=B.length();if(M<a.d)return G.p(b),0;B.normalizeFromLength(M);const I=U.Dot(s,B),j=D.o[5],P=D.o[6];j.p(s).scaleInPlace(-M*I),P.p(E).addInPlace(j);const A=D.o[4],n=D.o[5],d=D.o[7],c=D.o[8];A.p(V).scaleInPlace(1/o),c.p(l).scaleInPlace(1/u),A.addInPlace(c).scaleInPlace(-1),n.p(V).scaleInPlace(-1/o),c.p(v).scaleInPlace(1/g),n.addInPlace(c).scaleInPlace(-1),d.p(v).scaleInPlace(-1/g),c.p(l).scaleInPlace(-1/u),d.addInPlace(c).scaleInPlace(-1);const z=D.o[9];let Z;z.p(P).yi(b),U.CrossToRef(A,z,c),Z=U.Dot(c,s);const Y=Z;z.p(P).yi(h),U.CrossToRef(n,z,c),Z=U.Dot(c,s);const r=Z;z.p(P).yi(k),U.CrossToRef(d,z,c),Z=U.Dot(c,s);const w=Z,N=D.o[10];let H,f;Y>0&&r<0?(N.p(V),H=b,f=h):r>0&&w<0?(N.p(v),H=h,f=k):(N.p(l).scaleInPlace(-1),H=k,f=b);const F=D.o[9],y=D.o[4];H.subtractToRef(P,c),f.subtractToRef(P,F),U.CrossToRef(c,F,y);if(!(U.Dot(y,s)<0))return G.p(P),Math.abs(M*I);const e=D.o[5];U.CrossToRef(N,y,e),e.normalize();const J=D.o[9];J.p(H).yi(P);const m=J.length();if(m<a.d)return G.p(H),U.Distance(E,H);J.normalizeFromLength(m);const K=U.Dot(e,J),x=D.o[7];x.p(P).addInPlace(e.scaleInPlace(m*K)),c.p(x).yi(H),M=N.length(),N.normalizeFromLength(M);let W=U.Dot(c,N)/Math.max(M,a.d);return W=(0,O.b)(W,0,1),x.p(H).addInPlace(N.scaleInPlace(W*M)),G.p(x),U.Distance(E,x)}static Center(E,b){return U.CenterToRef(E,b,U.Zero())}static CenterToRef(E,b,h){return h.ue((E._x+b._x)/2,(E._y+b._y)/2,(E._z+b._z)/2)}static RotationFromAxis(E,b,h){const a=new U;return U.RotationFromAxisToRef(E,b,h,a),a}static RotationFromAxisToRef(E,b,h,a){const k=D.Quaternion[0];return o.RotationQuaternionFromAxisToRef(E,b,h,k),k.toEulerAnglesToRef(a),a}}U._UpReadOnly=U.Up(),U._DownReadOnly=U.Down(),U._LeftHandedForwardReadOnly=U.Forward(!1),U._RightHandedForwardReadOnly=U.Forward(!0),U._LeftHandedBackwardReadOnly=U.Backward(!1),U._RightHandedBackwardReadOnly=U.Backward(!0),U._RightReadOnly=U.Right(),U._LeftReadOnly=U.Left(),U._ZeroReadOnly=U.Zero(),U._OneReadOnly=U.One(),Object.defineProperties(U.prototype,{dimension:{value:[3]},rank:{value:1}});class B{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.x=E,this.y=b,this.z=h,this.w=a}toString(){return`{X: ${this.x} Y: ${this.y} Z: ${this.z} W: ${this.w}}`}getClassName(){return"Vector4"}getHashCode(){let E=v(this.x);return E=397*E^v(this.y),E=397*E^v(this.z),E=397*E^v(this.w),E}qj(){return[this.x,this.y,this.z,this.w]}toArray(E,b){return void 0===b&&(b=0),E[b]=this.x,E[b+1]=this.y,E[b+2]=this.z,E[b+3]=this.w,this}Yc(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return B.FromArrayToRef(E,b,this),this}addInPlace(E){return this.x+=E.x,this.y+=E.y,this.z+=E.z,this.w+=E.w,this}addInPlaceFromFloats(E,b,h,a){return this.x+=E,this.y+=b,this.z+=h,this.w+=a,this}add(E){return new B(this.x+E.x,this.y+E.y,this.z+E.z,this.w+E.w)}addToRef(E,b){return b.x=this.x+E.x,b.y=this.y+E.y,b.z=this.z+E.z,b.w=this.w+E.w,b}yi(E){return this.x-=E.x,this.y-=E.y,this.z-=E.z,this.w-=E.w,this}Xc(E){return new B(this.x-E.x,this.y-E.y,this.z-E.z,this.w-E.w)}subtractToRef(E,b){return b.x=this.x-E.x,b.y=this.y-E.y,b.z=this.z-E.z,b.w=this.w-E.w,b}subtractFromFloats(E,b,h,a){return new B(this.x-E,this.y-b,this.z-h,this.w-a)}subtractFromFloatsToRef(E,b,h,a,k){return k.x=this.x-E,k.y=this.y-b,k.z=this.z-h,k.w=this.w-a,k}negate(){return new B(-this.x,-this.y,-this.z,-this.w)}negateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}negateToRef(E){return E.x=-this.x,E.y=-this.y,E.z=-this.z,E.w=-this.w,E}scaleInPlace(E){return this.x*=E,this.y*=E,this.z*=E,this.w*=E,this}scale(E){return new B(this.x*E,this.y*E,this.z*E,this.w*E)}scaleToRef(E,b){return b.x=this.x*E,b.y=this.y*E,b.z=this.z*E,b.w=this.w*E,b}scaleAndAddToRef(E,b){return b.x+=this.x*E,b.y+=this.y*E,b.z+=this.z*E,b.w+=this.w*E,b}equals(E){return E&&this.x===E.x&&this.y===E.y&&this.z===E.z&&this.w===E.w}equalsWithEpsilon(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.d;return E&&(0,O.C)(this.x,E.x,b)&&(0,O.C)(this.y,E.y,b)&&(0,O.C)(this.z,E.z,b)&&(0,O.C)(this.w,E.w,b)}equalsToFloats(E,b,h,a){return this.x===E&&this.y===b&&this.z===h&&this.w===a}multiplyInPlace(E){return this.x*=E.x,this.y*=E.y,this.z*=E.z,this.w*=E.w,this}multiply(E){return new B(this.x*E.x,this.y*E.y,this.z*E.z,this.w*E.w)}multiplyToRef(E,b){return b.x=this.x*E.x,b.y=this.y*E.y,b.z=this.z*E.z,b.w=this.w*E.w,b}multiplyByFloats(E,b,h,a){return new B(this.x*E,this.y*b,this.z*h,this.w*a)}divide(E){return new B(this.x/E.x,this.y/E.y,this.z/E.z,this.w/E.w)}divideToRef(E,b){return b.x=this.x/E.x,b.y=this.y/E.y,b.z=this.z/E.z,b.w=this.w/E.w,b}divideInPlace(E){return this.divideToRef(E,this)}minimizeInPlace(E){return E.x<this.x&&(this.x=E.x),E.y<this.y&&(this.y=E.y),E.z<this.z&&(this.z=E.z),E.w<this.w&&(this.w=E.w),this}maximizeInPlace(E){return E.x>this.x&&(this.x=E.x),E.y>this.y&&(this.y=E.y),E.z>this.z&&(this.z=E.z),E.w>this.w&&(this.w=E.w),this}minimizeInPlaceFromFloats(E,b,h,a){return this.x=Math.min(E,this.x),this.y=Math.min(b,this.y),this.z=Math.min(h,this.z),this.w=Math.min(a,this.w),this}maximizeInPlaceFromFloats(E,b,h,a){return this.x=Math.max(E,this.x),this.y=Math.max(b,this.y),this.z=Math.max(h,this.z),this.w=Math.max(a,this.w),this}floorToRef(E){return E.x=Math.floor(this.x),E.y=Math.floor(this.y),E.z=Math.floor(this.z),E.w=Math.floor(this.w),E}floor(){return new B(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}fractToRef(E){return E.x=this.x-Math.floor(this.x),E.y=this.y-Math.floor(this.y),E.z=this.z-Math.floor(this.z),E.w=this.w-Math.floor(this.w),E}fract(){return new B(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(E){return 0===E||1===E?this:this.scaleInPlace(1/E)}normalizeToNew(){return this.normalizeToRef(new B)}normalizeToRef(E){const b=this.length();return 0===b||1===b?(E.x=this.x,E.y=this.y,E.z=this.z,E.w=this.w,E):this.scaleToRef(1/b,E)}toVector3(){return new U(this.x,this.y,this.z)}clone(){return new B(this.x,this.y,this.z,this.w)}p(E){return this.x=E.x,this.y=E.y,this.z=E.z,this.w=E.w,this}ue(E,b,h,a){return this.x=E,this.y=b,this.z=h,this.w=a,this}set(E,b,h,a){return this.ue(E,b,h,a)}te(E){return this.x=this.y=this.z=this.w=E,this}dot(E){return this.x*E.x+this.y*E.y+this.z*E.z+this.w*E.w}static jh(E,b){return b||(b=0),new B(E[b],E[b+1],E[b+2],E[b+3])}static FromArrayToRef(E,b,h){return h.x=E[b],h.y=E[b+1],h.z=E[b+2],h.w=E[b+3],h}static FromFloatArrayToRef(E,b,h){return B.FromArrayToRef(E,b,h),h}static FromFloatsToRef(E,b,h,a,k){return k.x=E,k.y=b,k.z=h,k.w=a,k}static Zero(){return new B(0,0,0,0)}static One(){return new B(1,1,1,1)}static Random(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new B((0,O.w)(E,b),(0,O.w)(E,b),(0,O.w)(E,b),(0,O.w)(E,b))}static RandomToRef(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,h=arguments.length>2?arguments[2]:void 0;return h.x=(0,O.w)(E,b),h.y=(0,O.w)(E,b),h.z=(0,O.w)(E,b),h.w=(0,O.w)(E,b),h}static Clamp(E,b,h){return B.ClampToRef(E,b,h,new B)}static ClampToRef(E,b,h,a){return a.x=(0,O.b)(E.x,b.x,h.x),a.y=(0,O.b)(E.y,b.y,h.y),a.z=(0,O.b)(E.z,b.z,h.z),a.w=(0,O.b)(E.w,b.w,h.w),a}static CheckExtends(E,b,h){b.minimizeInPlace(E),h.maximizeInPlace(E)}static get ZeroReadOnly(){return B._ZeroReadOnly}static Normalize(E){return B.NormalizeToRef(E,new B)}static NormalizeToRef(E,b){return E.normalizeToRef(b),b}static Minimize(E,b){const h=new B;return h.p(E),h.minimizeInPlace(b),h}static Maximize(E,b){const h=new B;return h.p(E),h.maximizeInPlace(b),h}static Distance(E,b){return Math.sqrt(B.DistanceSquared(E,b))}static DistanceSquared(E,b){const h=E.x-b.x,a=E.y-b.y,k=E.z-b.z,G=E.w-b.w;return h*h+a*a+k*k+G*G}static Center(E,b){return B.CenterToRef(E,b,new B)}static CenterToRef(E,b,h){return h.x=(E.x+b.x)/2,h.y=(E.y+b.y)/2,h.z=(E.z+b.z)/2,h.w=(E.w+b.w)/2,h}static TransformCoordinates(E,b){return B.TransformCoordinatesToRef(E,b,new B)}static TransformCoordinatesToRef(E,b,h){return B.TransformCoordinatesFromFloatsToRef(E._x,E._y,E._z,b,h),h}static TransformCoordinatesFromFloatsToRef(E,b,h,a,k){const G=a.m,V=E*G[0]+b*G[4]+h*G[8]+G[12],l=E*G[1]+b*G[5]+h*G[9]+G[13],O=E*G[2]+b*G[6]+h*G[10]+G[14],v=E*G[3]+b*G[7]+h*G[11]+G[15];return k.x=V,k.y=l,k.z=O,k.w=v,k}static TransformNormal(E,b){return B.TransformNormalToRef(E,b,new B)}static TransformNormalToRef(E,b,h){const a=b.m,k=E.x*a[0]+E.y*a[4]+E.z*a[8],G=E.x*a[1]+E.y*a[5]+E.z*a[9],V=E.x*a[2]+E.y*a[6]+E.z*a[10];return h.x=k,h.y=G,h.z=V,h.w=E.w,h}static TransformNormalFromFloatsToRef(E,b,h,a,k,G){const V=k.m;return G.x=E*V[0]+b*V[4]+h*V[8],G.y=E*V[1]+b*V[5]+h*V[9],G.z=E*V[2]+b*V[6]+h*V[10],G.w=a,G}static FromVector3(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new B(E._x,E._y,E._z,b)}static Dot(E,b){return E.x*b.x+E.y*b.y+E.z*b.z+E.w*b.w}}B._ZeroReadOnly=B.Zero(),Object.defineProperties(B.prototype,{dimension:{value:[4]},rank:{value:1}});class o{get x(){return this._x}set x(E){this._x=E,this._isDirty=!0}get y(){return this._y}set y(E){this._y=E,this._isDirty=!0}get z(){return this._z}set z(E){this._z=E,this._isDirty=!0}get w(){return this._w}set w(E){this._w=E,this._isDirty=!0}constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this._isDirty=!0,this._x=E,this._y=b,this._z=h,this._w=a}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Quaternion"}getHashCode(){let E=v(this._x);return E=397*E^v(this._y),E=397*E^v(this._z),E=397*E^v(this._w),E}qj(){return[this._x,this._y,this._z,this._w]}toArray(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return E[b]=this._x,E[b+1]=this._y,E[b+2]=this._z,E[b+3]=this._w,this}Yc(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return o.FromArrayToRef(E,b,this)}equals(E){return E&&this._x===E._x&&this._y===E._y&&this._z===E._z&&this._w===E._w}equalsWithEpsilon(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.d;return E&&(0,O.C)(this._x,E._x,b)&&(0,O.C)(this._y,E._y,b)&&(0,O.C)(this._z,E._z,b)&&(0,O.C)(this._w,E._w,b)}clone(){return new o(this._x,this._y,this._z,this._w)}p(E){return this._x=E._x,this._y=E._y,this._z=E._z,this._w=E._w,this._isDirty=!0,this}ue(E,b,h,a){return this._x=E,this._y=b,this._z=h,this._w=a,this._isDirty=!0,this}set(E,b,h,a){return this.ue(E,b,h,a)}te(E){return this.ue(E,E,E,E)}add(E){return new o(this._x+E._x,this._y+E._y,this._z+E._z,this._w+E._w)}addInPlace(E){return this._x+=E._x,this._y+=E._y,this._z+=E._z,this._w+=E._w,this._isDirty=!0,this}addToRef(E,b){return b._x=this._x+E._x,b._y=this._y+E._y,b._z=this._z+E._z,b._w=this._w+E._w,b._isDirty=!0,b}addInPlaceFromFloats(E,b,h,a){return this._x+=E,this._y+=b,this._z+=h,this._w+=a,this._isDirty=!0,this}subtractToRef(E,b){return b._x=this._x-E._x,b._y=this._y-E._y,b._z=this._z-E._z,b._w=this._w-E._w,b._isDirty=!0,b}subtractFromFloats(E,b,h,a){return this.subtractFromFloatsToRef(E,b,h,a,new o)}subtractFromFloatsToRef(E,b,h,a,k){return k._x=this._x-E,k._y=this._y-b,k._z=this._z-h,k._w=this._w-a,k._isDirty=!0,k}Xc(E){return new o(this._x-E._x,this._y-E._y,this._z-E._z,this._w-E._w)}yi(E){return this._x-=E._x,this._y-=E._y,this._z-=E._z,this._w-=E._w,this._isDirty=!0,this}scale(E){return new o(this._x*E,this._y*E,this._z*E,this._w*E)}scaleToRef(E,b){return b._x=this._x*E,b._y=this._y*E,b._z=this._z*E,b._w=this._w*E,b._isDirty=!0,b}scaleInPlace(E){return this._x*=E,this._y*=E,this._z*=E,this._w*=E,this._isDirty=!0,this}scaleAndAddToRef(E,b){return b._x+=this._x*E,b._y+=this._y*E,b._z+=this._z*E,b._w+=this._w*E,b._isDirty=!0,b}multiply(E){const b=new o(0,0,0,1);return this.multiplyToRef(E,b),b}multiplyToRef(E,b){const h=this._x*E._w+this._y*E._z-this._z*E._y+this._w*E._x,a=-this._x*E._z+this._y*E._w+this._z*E._x+this._w*E._y,k=this._x*E._y-this._y*E._x+this._z*E._w+this._w*E._z,G=-this._x*E._x-this._y*E._y-this._z*E._z+this._w*E._w;return b.ue(h,a,k,G),b}multiplyInPlace(E){return this.multiplyToRef(E,this)}multiplyByFloats(E,b,h,a){return this._x*=E,this._y*=b,this._z*=h,this._w*=a,this._isDirty=!0,this}divide(E){throw new ReferenceError("Can not divide a quaternion")}divideToRef(E,b){throw new ReferenceError("Can not divide a quaternion")}divideInPlace(E){throw new ReferenceError("Can not divide a quaternion")}minimizeInPlace(){throw new ReferenceError("Can not minimize a quaternion")}minimizeInPlaceFromFloats(){throw new ReferenceError("Can not minimize a quaternion")}maximizeInPlace(){throw new ReferenceError("Can not maximize a quaternion")}maximizeInPlaceFromFloats(){throw new ReferenceError("Can not maximize a quaternion")}negate(){return this.negateToRef(new o)}negateInPlace(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._isDirty=!0,this}negateToRef(E){return E._x=-this._x,E._y=-this._y,E._z=-this._z,E._w=-this._w,E._isDirty=!0,E}equalsToFloats(E,b,h,a){return this._x===E&&this._y===b&&this._z===h&&this._w===a}floorToRef(E){throw new ReferenceError("Can not floor a quaternion")}floor(){throw new ReferenceError("Can not floor a quaternion")}fractToRef(E){throw new ReferenceError("Can not fract a quaternion")}fract(){throw new ReferenceError("Can not fract a quaternion")}conjugateToRef(E){return E.ue(-this._x,-this._y,-this._z,this._w),E}conjugateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}conjugate(){return new o(-this._x,-this._y,-this._z,this._w)}invert(){const E=this.conjugate(),b=this.lengthSquared();return 0==b||1==b||E.scaleInPlace(1/b),E}invertInPlace(){this.conjugateInPlace();const E=this.lengthSquared();return 0==E||1==E||this.scaleInPlace(1/E),this}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this.lengthSquared())}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(E){return 0===E||1===E?this:this.scaleInPlace(1/E)}normalizeToNew(){const E=new o(0,0,0,1);return this.normalizeToRef(E),E}normalizeToRef(E){const b=this.length();return 0===b||1===b?E.ue(this._x,this._y,this._z,this._w):this.scaleToRef(1/b,E)}toEulerAngles(){const E=U.Zero();return this.toEulerAnglesToRef(E),E}toEulerAnglesToRef(E){const b=this._z,h=this._x,a=this._y,k=this._w,G=a*b-h*k,V=.4999999;if(G<-V)E._y=2*Math.atan2(a,k),E._x=Math.PI/2,E._z=0,E._isDirty=!0;else if(G>V)E._y=2*Math.atan2(a,k),E._x=-Math.PI/2,E._z=0,E._isDirty=!0;else{const V=k*k,l=b*b,O=h*h,v=a*a;E._z=Math.atan2(2*(h*a+b*k),-l-O+v+V),E._x=Math.asin(-2*G),E._y=Math.atan2(2*(b*h+a*k),l-O-v+V),E._isDirty=!0}return E}toAlphaBetaGammaToRef(E){const b=this._z,h=this._x,a=this._y,k=this._w,G=Math.sqrt(h*h+a*a),V=Math.sqrt(b*b+k*k),l=2*Math.atan2(G,V),O=2*Math.atan2(b,k),v=2*Math.atan2(a,h),s=(O+v)/2,U=(O-v)/2;return E.set(U,l,s),E}toRotationMatrix(E){return u.FromQuaternionToRef(this,E),E}fromRotationMatrix(E){return o.FromRotationMatrixToRef(E,this),this}dot(E){return this._x*E._x+this._y*E._y+this._z*E._z+this._w*E._w}static FromRotationMatrix(E){const b=new o;return o.FromRotationMatrixToRef(E,b),b}static FromRotationMatrixToRef(E,b){const h=E.m,a=h[0],k=h[4],G=h[8],V=h[1],l=h[5],O=h[9],v=h[2],s=h[6],U=h[10],B=a+l+U;let o;return B>0?(o=.5/Math.sqrt(B+1),b._w=.25/o,b._x=(s-O)*o,b._y=(G-v)*o,b._z=(V-k)*o,b._isDirty=!0):a>l&&a>U?(o=2*Math.sqrt(1+a-l-U),b._w=(s-O)/o,b._x=.25*o,b._y=(k+V)/o,b._z=(G+v)/o,b._isDirty=!0):l>U?(o=2*Math.sqrt(1+l-a-U),b._w=(G-v)/o,b._x=(k+V)/o,b._y=.25*o,b._z=(O+s)/o,b._isDirty=!0):(o=2*Math.sqrt(1+U-a-l),b._w=(V-k)/o,b._x=(G+v)/o,b._y=(O+s)/o,b._z=.25*o,b._isDirty=!0),b}static Dot(E,b){return E._x*b._x+E._y*b._y+E._z*b._z+E._w*b._w}static AreClose(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1;const a=o.Dot(E,b);return 1-a*a<=h}static SmoothToRef(E,b,h,a,k){let G=0===a?1:h/a;return G=(0,O.b)(G,0,1),o.SlerpToRef(E,b,G,k),k}static Zero(){return new o(0,0,0,0)}static Inverse(E){return new o(-E._x,-E._y,-E._z,E._w)}static InverseToRef(E,b){return b.set(-E._x,-E._y,-E._z,E._w),b}static Identity(){return new o(0,0,0,1)}static IsIdentity(E){return E&&0===E._x&&0===E._y&&0===E._z&&1===E._w}static RotationAxis(E,b){return o.RotationAxisToRef(E,b,new o)}static RotationAxisToRef(E,b,h){h._w=Math.cos(b/2);const a=Math.sin(b/2)/E.length();return h._x=E._x*a,h._y=E._y*a,h._z=E._z*a,h._isDirty=!0,h}static jh(E,b){return b||(b=0),new o(E[b],E[b+1],E[b+2],E[b+3])}static FromArrayToRef(E,b,h){return h._x=E[b],h._y=E[b+1],h._z=E[b+2],h._w=E[b+3],h._isDirty=!0,h}static FromFloatsToRef(E,b,h,a,k){return k.ue(E,b,h,a),k}static FromEulerAngles(E,b,h){const a=new o;return o.RotationYawPitchRollToRef(b,E,h,a),a}static FromEulerAnglesToRef(E,b,h,a){return o.RotationYawPitchRollToRef(b,E,h,a),a}static FromEulerVector(E){const b=new o;return o.RotationYawPitchRollToRef(E._y,E._x,E._z,b),b}static FromEulerVectorToRef(E,b){return o.RotationYawPitchRollToRef(E._y,E._x,E._z,b),b}static FromUnitVectorsToRef(E,b,h){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.d;const G=U.Dot(E,b)+1;return G<k?Math.abs(E.x)>Math.abs(E.z)?h.set(-E.y,E.x,0,0):h.set(0,-E.z,E.y,0):(U.CrossToRef(E,b,g.o[0]),h.set(g.o[0].x,g.o[0].y,g.o[0].z,G)),h.normalize()}static RotationYawPitchRoll(E,b,h){const a=new o;return o.RotationYawPitchRollToRef(E,b,h,a),a}static RotationYawPitchRollToRef(E,b,h,a){const k=.5*h,G=.5*b,V=.5*E,l=Math.sin(k),O=Math.cos(k),v=Math.sin(G),s=Math.cos(G),U=Math.sin(V),B=Math.cos(V);return a._x=B*v*O+U*s*l,a._y=U*s*O-B*v*l,a._z=B*s*l-U*v*O,a._w=B*s*O+U*v*l,a._isDirty=!0,a}static RotationAlphaBetaGamma(E,b,h){const a=new o;return o.RotationAlphaBetaGammaToRef(E,b,h,a),a}static RotationAlphaBetaGammaToRef(E,b,h,a){const k=.5*(h+E),G=.5*(h-E),V=.5*b;return a._x=Math.cos(G)*Math.sin(V),a._y=Math.sin(G)*Math.sin(V),a._z=Math.sin(k)*Math.cos(V),a._w=Math.cos(k)*Math.cos(V),a._isDirty=!0,a}static RotationQuaternionFromAxis(E,b,h){const a=new o(0,0,0,0);return o.RotationQuaternionFromAxisToRef(E,b,h,a),a}static RotationQuaternionFromAxisToRef(E,b,h,a){const k=D.Matrix[0];return E=E.normalizeToRef(D.o[0]),b=b.normalizeToRef(D.o[1]),h=h.normalizeToRef(D.o[2]),u.FromXYZAxesToRef(E,b,h,k),o.FromRotationMatrixToRef(k,a),a}static FromLookDirectionLH(E,b){const h=new o;return o.FromLookDirectionLHToRef(E,b,h),h}static FromLookDirectionLHToRef(E,b,h){const a=D.Matrix[0];return u.LookDirectionLHToRef(E,b,a),o.FromRotationMatrixToRef(a,h),h}static FromLookDirectionRH(E,b){const h=new o;return o.FromLookDirectionRHToRef(E,b,h),h}static FromLookDirectionRHToRef(E,b,h){const a=D.Matrix[0];return u.LookDirectionRHToRef(E,b,a),o.FromRotationMatrixToRef(a,h)}static Slerp(E,b,h){const a=o.Identity();return o.SlerpToRef(E,b,h,a),a}static SlerpToRef(E,b,h,a){let k,G,V=E._x*b._x+E._y*b._y+E._z*b._z+E._w*b._w,l=!1;if(V<0&&(l=!0,V=-V),V>.999999)G=1-h,k=l?-h:h;else{const E=Math.acos(V),b=1/Math.sin(E);G=Math.sin((1-h)*E)*b,k=l?-Math.sin(h*E)*b:Math.sin(h*E)*b}return a._x=G*E._x+k*b._x,a._y=G*E._y+k*b._y,a._z=G*E._z+k*b._z,a._w=G*E._w+k*b._w,a._isDirty=!0,a}static Hermite(E,b,h,a,k){const G=k*k,V=k*G,l=2*V-3*G+1,O=-2*V+3*G,v=V-2*G+k,s=V-G,U=E._x*l+h._x*O+b._x*v+a._x*s,B=E._y*l+h._y*O+b._y*v+a._y*s,u=E._z*l+h._z*O+b._z*v+a._z*s,D=E._w*l+h._w*O+b._w*v+a._w*s;return new o(U,B,u,D)}static Hermite1stDerivative(E,b,h,a,k){const G=new o;return this.Hermite1stDerivativeToRef(E,b,h,a,k,G),G}static Hermite1stDerivativeToRef(E,b,h,a,k,G){const V=k*k;return G._x=6*(V-k)*E._x+(3*V-4*k+1)*b._x+6*(-V+k)*h._x+(3*V-2*k)*a._x,G._y=6*(V-k)*E._y+(3*V-4*k+1)*b._y+6*(-V+k)*h._y+(3*V-2*k)*a._y,G._z=6*(V-k)*E._z+(3*V-4*k+1)*b._z+6*(-V+k)*h._z+(3*V-2*k)*a._z,G._w=6*(V-k)*E._w+(3*V-4*k+1)*b._w+6*(-V+k)*h._w+(3*V-2*k)*a._w,G._isDirty=!0,G}static Normalize(E){const b=o.Zero();return o.NormalizeToRef(E,b),b}static NormalizeToRef(E,b){return E.normalizeToRef(b),b}static Clamp(E,b,h){const a=new o;return o.ClampToRef(E,b,h,a),a}static ClampToRef(E,b,h,a){return a.ue((0,O.b)(E.x,b.x,h.x),(0,O.b)(E.y,b.y,h.y),(0,O.b)(E.z,b.z,h.z),(0,O.b)(E.w,b.w,h.w))}static Random(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new o((0,O.w)(E,b),(0,O.w)(E,b),(0,O.w)(E,b),(0,O.w)(E,b))}static RandomToRef(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).ue((0,O.w)(E,b),(0,O.w)(E,b),(0,O.w)(E,b),(0,O.w)(E,b))}static Minimize(){throw new ReferenceError("Quaternion.Minimize does not make sense")}static Maximize(){throw new ReferenceError("Quaternion.Maximize does not make sense")}static Distance(E,b){return Math.sqrt(o.DistanceSquared(E,b))}static DistanceSquared(E,b){const h=E.x-b.x,a=E.y-b.y,k=E.z-b.z,G=E.w-b.w;return h*h+a*a+k*k+G*G}static Center(E,b){return o.CenterToRef(E,b,o.Zero())}static CenterToRef(E,b,h){return h.ue((E.x+b.x)/2,(E.y+b.y)/2,(E.z+b.z)/2,(E.w+b.w)/2)}}Object.defineProperties(o.prototype,{dimension:{value:[4]},rank:{value:1}});class u{static get Use64Bits(){return V.c.MatrixUse64Bits}get m(){return this.Xj}markAsUpdated(){this.updateFlag=u._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}_updateIdentityStatus(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._isIdentity=E,this._isIdentity3x2=E||h,this._isIdentityDirty=!this._isIdentity&&b,this._isIdentity3x2Dirty=!this._isIdentity3x2&&a}constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,V.c.MatrixTrackPrecisionChange&&V.c.MatrixTrackedMatrices.push(this),this.Xj=new V.c.MatrixCurrentType(16),this.markAsUpdated()}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const E=this.Xj;this._isIdentity=1===E[0]&&0===E[1]&&0===E[2]&&0===E[3]&&0===E[4]&&1===E[5]&&0===E[6]&&0===E[7]&&0===E[8]&&0===E[9]&&1===E[10]&&0===E[11]&&0===E[12]&&0===E[13]&&0===E[14]&&1===E[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this.Xj[0]||1!==this.Xj[5]||1!==this.Xj[15]||0!==this.Xj[1]||0!==this.Xj[2]||0!==this.Xj[3]||0!==this.Xj[4]||0!==this.Xj[6]||0!==this.Xj[7]||0!==this.Xj[8]||0!==this.Xj[9]||0!==this.Xj[10]||0!==this.Xj[11]||0!==this.Xj[12]||0!==this.Xj[13]||0!==this.Xj[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const E=this.Xj,b=E[0],h=E[1],a=E[2],k=E[3],G=E[4],V=E[5],l=E[6],O=E[7],v=E[8],s=E[9],U=E[10],B=E[11],o=E[12],u=E[13],D=E[14],g=E[15],S=U*g-D*B,M=s*g-u*B,I=s*D-u*U,j=v*g-o*B,P=v*D-U*o,A=v*u-o*s;return b*+(V*S-l*M+O*I)+h*-(G*S-l*j+O*P)+a*+(G*M-V*j+O*A)+k*-(G*I-V*P+l*A)}toString(){return`{${this.m[0]}, ${this.m[1]}, ${this.m[2]}, ${this.m[3]}\n${this.m[4]}, ${this.m[5]}, ${this.m[6]}, ${this.m[7]}\n${this.m[8]}, ${this.m[9]}, ${this.m[10]}, ${this.m[11]}\n${this.m[12]}, ${this.m[13]}, ${this.m[14]}, ${this.m[15]}}`}toArray(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!E)return this.Xj;const h=this.Xj;for(let a=0;a<16;a++)E[b+a]=h[a];return this}qj(){return this.Xj}Yc(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return u.FromArrayToRef(E,b,this)}ue(){for(var E=arguments.length,b=new Array(E),h=0;h<E;h++)b[h]=arguments[h];return u.FromArrayToRef(b,0,this)}set(){const E=this.Xj;for(let b=0;b<16;b++)E[b]=b<0||arguments.length<=b?void 0:arguments[b];return this.markAsUpdated(),this}te(E){const b=this.Xj;for(let h=0;h<16;h++)b[h]=E;return this.markAsUpdated(),this}invert(){return this.invertToRef(this),this}reset(){return u.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(E){const b=new u;return this.addToRef(E,b),b}addToRef(E,b){const h=this.Xj,a=b.Xj,k=E.m;for(let G=0;G<16;G++)a[G]=h[G]+k[G];return b.markAsUpdated(),b}addToSelf(E){const b=this.Xj,h=E.m;return b[0]+=h[0],b[1]+=h[1],b[2]+=h[2],b[3]+=h[3],b[4]+=h[4],b[5]+=h[5],b[6]+=h[6],b[7]+=h[7],b[8]+=h[8],b[9]+=h[9],b[10]+=h[10],b[11]+=h[11],b[12]+=h[12],b[13]+=h[13],b[14]+=h[14],b[15]+=h[15],this.markAsUpdated(),this}addInPlace(E){const b=this.Xj,h=E.m;for(let a=0;a<16;a++)b[a]+=h[a];return this.markAsUpdated(),this}addInPlaceFromFloats(){const E=this.Xj;for(let b=0;b<16;b++)E[b]+=b<0||arguments.length<=b?void 0:arguments[b];return this.markAsUpdated(),this}Xc(E){const b=this.Xj,h=E.m;for(let a=0;a<16;a++)b[a]-=h[a];return this.markAsUpdated(),this}subtractToRef(E,b){const h=this.Xj,a=E.m,k=b.Xj;for(let G=0;G<16;G++)k[G]=h[G]-a[G];return b.markAsUpdated(),b}yi(E){const b=this.Xj,h=E.m;for(let a=0;a<16;a++)b[a]-=h[a];return this.markAsUpdated(),this}subtractFromFloats(){for(var E=arguments.length,b=new Array(E),h=0;h<E;h++)b[h]=arguments[h];return this.subtractFromFloatsToRef(...b,new u)}subtractFromFloatsToRef(){for(var E=arguments.length,b=new Array(E),h=0;h<E;h++)b[h]=arguments[h];const a=b.pop(),k=this.Xj,G=a.Xj,V=b;for(let l=0;l<16;l++)G[l]=k[l]-V[l];return a.markAsUpdated(),a}invertToRef(E){if(!0===this._isIdentity)return u.IdentityToRef(E),E;const b=this.Xj,h=b[0],a=b[1],k=b[2],G=b[3],V=b[4],l=b[5],O=b[6],v=b[7],s=b[8],U=b[9],B=b[10],o=b[11],D=b[12],g=b[13],S=b[14],M=b[15],I=B*M-S*o,j=U*M-g*o,P=U*S-g*B,A=s*M-D*o,n=s*S-B*D,d=s*g-D*U,c=+(l*I-O*j+v*P),z=-(V*I-O*A+v*n),Z=+(V*j-l*A+v*d),Y=-(V*P-l*n+O*d),r=h*c+a*z+k*Z+G*Y;if(0===r)return E.p(this),E;const w=1/r,N=O*M-S*v,H=l*M-g*v,f=l*S-g*O,F=V*M-D*v,y=V*S-D*O,e=V*g-D*l,J=O*o-B*v,m=l*o-U*v,K=l*B-U*O,x=V*o-s*v,W=V*B-s*O,L=V*U-s*l,t=-(a*I-k*j+G*P),T=+(h*I-k*A+G*n),X=-(h*j-a*A+G*d),C=+(h*P-a*n+k*d),q=+(a*N-k*H+G*f),R=-(h*N-k*F+G*y),Q=+(h*H-a*F+G*e),i=-(h*f-a*y+k*e),p=-(a*J-k*m+G*K),EE=+(h*J-k*x+G*W),bE=-(h*m-a*x+G*L),hE=+(h*K-a*W+k*L);return u.FromValuesToRef(c*w,t*w,q*w,p*w,z*w,T*w,R*w,EE*w,Z*w,X*w,Q*w,bE*w,Y*w,C*w,i*w,hE*w,E),E}addAtIndex(E,b){return this.Xj[E]+=b,this.markAsUpdated(),this}multiplyAtIndex(E,b){return this.Xj[E]*=b,this.markAsUpdated(),this}setTranslationFromFloats(E,b,h){return this.Xj[12]=E,this.Xj[13]=b,this.Xj[14]=h,this.markAsUpdated(),this}addTranslationFromFloats(E,b,h){return this.Xj[12]+=E,this.Xj[13]+=b,this.Xj[14]+=h,this.markAsUpdated(),this}setTranslation(E){return this.setTranslationFromFloats(E._x,E._y,E._z)}getTranslation(){return new U(this.Xj[12],this.Xj[13],this.Xj[14])}getTranslationToRef(E){return E.x=this.Xj[12],E.y=this.Xj[13],E.z=this.Xj[14],E}removeRotationAndScaling(){const E=this.m;return u.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,E[12],E[13],E[14],E[15],this),this._updateIdentityStatus(0===E[12]&&0===E[13]&&0===E[14]&&1===E[15]),this}p(E){E.copyToArray(this.Xj);const b=E;return this.updateFlag=b.updateFlag,this._updateIdentityStatus(b._isIdentity,b._isIdentityDirty,b._isIdentity3x2,b._isIdentity3x2Dirty),this}copyToArray(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const h=this.Xj;return E[b]=h[0],E[b+1]=h[1],E[b+2]=h[2],E[b+3]=h[3],E[b+4]=h[4],E[b+5]=h[5],E[b+6]=h[6],E[b+7]=h[7],E[b+8]=h[8],E[b+9]=h[9],E[b+10]=h[10],E[b+11]=h[11],E[b+12]=h[12],E[b+13]=h[13],E[b+14]=h[14],E[b+15]=h[15],this}multiply(E){const b=new u;return this.multiplyToRef(E,b),b}multiplyInPlace(E){const b=this.Xj,h=E.m;for(let a=0;a<16;a++)b[a]*=h[a];return this.markAsUpdated(),this}multiplyByFloats(){const E=this.Xj;for(let b=0;b<16;b++)E[b]*=b<0||arguments.length<=b?void 0:arguments[b];return this.markAsUpdated(),this}multiplyByFloatsToRef(){for(var E=arguments.length,b=new Array(E),h=0;h<E;h++)b[h]=arguments[h];const a=b.pop(),k=this.Xj,G=a.Xj,V=b;for(let l=0;l<16;l++)G[l]=k[l]*V[l];return a.markAsUpdated(),a}multiplyToRef(E,b){return this._isIdentity?(b.p(E),b):E._isIdentity?(b.p(this),b):(this.multiplyToArray(E,b.Xj,0),b.markAsUpdated(),b)}multiplyToArray(E,b,h){const a=this.Xj,k=E.m,G=a[0],V=a[1],l=a[2],O=a[3],v=a[4],s=a[5],U=a[6],B=a[7],o=a[8],u=a[9],D=a[10],g=a[11],S=a[12],M=a[13],I=a[14],j=a[15],P=k[0],A=k[1],n=k[2],d=k[3],c=k[4],z=k[5],Z=k[6],Y=k[7],r=k[8],w=k[9],N=k[10],H=k[11],f=k[12],F=k[13],y=k[14],e=k[15];return b[h]=G*P+V*c+l*r+O*f,b[h+1]=G*A+V*z+l*w+O*F,b[h+2]=G*n+V*Z+l*N+O*y,b[h+3]=G*d+V*Y+l*H+O*e,b[h+4]=v*P+s*c+U*r+B*f,b[h+5]=v*A+s*z+U*w+B*F,b[h+6]=v*n+s*Z+U*N+B*y,b[h+7]=v*d+s*Y+U*H+B*e,b[h+8]=o*P+u*c+D*r+g*f,b[h+9]=o*A+u*z+D*w+g*F,b[h+10]=o*n+u*Z+D*N+g*y,b[h+11]=o*d+u*Y+D*H+g*e,b[h+12]=S*P+M*c+I*r+j*f,b[h+13]=S*A+M*z+I*w+j*F,b[h+14]=S*n+M*Z+I*N+j*y,b[h+15]=S*d+M*Y+I*H+j*e,this}divide(E){return this.divideToRef(E,new u)}divideToRef(E,b){const h=this.Xj,a=E.m,k=b.Xj;for(let G=0;G<16;G++)k[G]=h[G]/a[G];return b.markAsUpdated(),b}divideInPlace(E){const b=this.Xj,h=E.m;for(let a=0;a<16;a++)b[a]/=h[a];return this.markAsUpdated(),this}minimizeInPlace(E){const b=this.Xj,h=E.m;for(let a=0;a<16;a++)b[a]=Math.min(b[a],h[a]);return this.markAsUpdated(),this}minimizeInPlaceFromFloats(){const E=this.Xj;for(let b=0;b<16;b++)E[b]=Math.min(E[b],b<0||arguments.length<=b?void 0:arguments[b]);return this.markAsUpdated(),this}maximizeInPlace(E){const b=this.Xj,h=E.m;for(let a=0;a<16;a++)b[a]=Math.min(b[a],h[a]);return this.markAsUpdated(),this}maximizeInPlaceFromFloats(){const E=this.Xj;for(let b=0;b<16;b++)E[b]=Math.min(E[b],b<0||arguments.length<=b?void 0:arguments[b]);return this.markAsUpdated(),this}negate(){return this.negateToRef(new u)}negateInPlace(){const E=this.Xj;for(let b=0;b<16;b++)E[b]=-E[b];return this.markAsUpdated(),this}negateToRef(E){const b=this.Xj,h=E.Xj;for(let a=0;a<16;a++)h[a]=-b[a];return E.markAsUpdated(),E}equals(E){const b=E;if(!b)return!1;if((this._isIdentity||b._isIdentity)&&!this._isIdentityDirty&&!b._isIdentityDirty)return this._isIdentity&&b._isIdentity;const h=this.m,a=b.m;return h[0]===a[0]&&h[1]===a[1]&&h[2]===a[2]&&h[3]===a[3]&&h[4]===a[4]&&h[5]===a[5]&&h[6]===a[6]&&h[7]===a[7]&&h[8]===a[8]&&h[9]===a[9]&&h[10]===a[10]&&h[11]===a[11]&&h[12]===a[12]&&h[13]===a[13]&&h[14]===a[14]&&h[15]===a[15]}equalsWithEpsilon(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const h=this.Xj,a=E.m;for(let k=0;k<16;k++)if(!(0,O.C)(h[k],a[k],b))return!1;return!0}equalsToFloats(){const E=this.Xj;for(let b=0;b<16;b++)if(E[b]!=(b<0||arguments.length<=b?void 0:arguments[b]))return!1;return!0}floor(){return this.floorToRef(new u)}floorToRef(E){const b=this.Xj,h=E.Xj;for(let a=0;a<16;a++)h[a]=Math.floor(b[a]);return E.markAsUpdated(),E}fract(){return this.fractToRef(new u)}fractToRef(E){const b=this.Xj,h=E.Xj;for(let a=0;a<16;a++)h[a]=b[a]-Math.floor(b[a]);return E.markAsUpdated(),E}clone(){const E=new u;return E.p(this),E}getClassName(){return"Matrix"}getHashCode(){let E=v(this.Xj[0]);for(let b=1;b<16;b++)E=397*E^v(this.Xj[b]);return E}decomposeToTransformNode(E){return E.rotationQuaternion=E.rotationQuaternion||new o,this.decompose(E.ve,E.rotationQuaternion,E.position)}decompose(E,b,h,a){let k=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._isIdentity)return h&&h.te(0),E&&E.te(1),b&&b.ue(0,0,0,1),!0;const G=this.Xj;if(h&&h.ue(G[12],G[13],G[14]),(E=E||D.o[0]).x=Math.sqrt(G[0]*G[0]+G[1]*G[1]+G[2]*G[2]),E.y=Math.sqrt(G[4]*G[4]+G[5]*G[5]+G[6]*G[6]),E.z=Math.sqrt(G[8]*G[8]+G[9]*G[9]+G[10]*G[10]),a){const b=(k?a.absoluteScaling.x:a.ve.x)<0?-1:1,h=(k?a.absoluteScaling.y:a.ve.y)<0?-1:1,G=(k?a.absoluteScaling.z:a.ve.z)<0?-1:1;E.x*=b,E.y*=h,E.z*=G}else this.determinant()<=0&&(E.y*=-1);if(0===E._x||0===E._y||0===E._z)return b&&b.ue(0,0,0,1),!1;if(b){const h=1/E._x,a=1/E._y,k=1/E._z;u.FromValuesToRef(G[0]*h,G[1]*h,G[2]*h,0,G[4]*a,G[5]*a,G[6]*a,0,G[8]*k,G[9]*k,G[10]*k,0,0,0,0,1,D.Matrix[0]),o.FromRotationMatrixToRef(D.Matrix[0],b)}return!0}getRow(E){if(E<0||E>3)return null;const b=4*E;return new B(this.Xj[b+0],this.Xj[b+1],this.Xj[b+2],this.Xj[b+3])}getRowToRef(E,b){if(E>=0&&E<=3){const h=4*E;b.x=this.Xj[h+0],b.y=this.Xj[h+1],b.z=this.Xj[h+2],b.w=this.Xj[h+3]}return b}setRow(E,b){return this.setRowFromFloats(E,b.x,b.y,b.z,b.w)}transpose(){const E=new u;return u.TransposeToRef(this,E),E}transposeToRef(E){return u.TransposeToRef(this,E),E}setRowFromFloats(E,b,h,a,k){if(E<0||E>3)return this;const G=4*E;return this.Xj[G+0]=b,this.Xj[G+1]=h,this.Xj[G+2]=a,this.Xj[G+3]=k,this.markAsUpdated(),this}scale(E){const b=new u;return this.scaleToRef(E,b),b}scaleToRef(E,b){for(let h=0;h<16;h++)b.Xj[h]=this.Xj[h]*E;return b.markAsUpdated(),b}scaleAndAddToRef(E,b){for(let h=0;h<16;h++)b.Xj[h]+=this.Xj[h]*E;return b.markAsUpdated(),b}scaleInPlace(E){const b=this.Xj;for(let h=0;h<16;h++)b[h]*=E;return this.markAsUpdated(),this}toNormalMatrix(E){const b=D.Matrix[0];this.invertToRef(b),b.transposeToRef(E);const h=E.Xj;return u.FromValuesToRef(h[0],h[1],h[2],0,h[4],h[5],h[6],0,h[8],h[9],h[10],0,0,0,0,1,E),E}getRotationMatrix(){const E=new u;return this.getRotationMatrixToRef(E),E}getRotationMatrixToRef(E){const b=D.o[0];if(!this.decompose(b))return u.IdentityToRef(E),E;const h=this.Xj,a=1/b._x,k=1/b._y,G=1/b._z;return u.FromValuesToRef(h[0]*a,h[1]*a,h[2]*a,0,h[4]*k,h[5]*k,h[6]*k,0,h[8]*G,h[9]*G,h[10]*G,0,0,0,0,1,E),E}toggleModelMatrixHandInPlace(){const E=this.Xj;return E[2]*=-1,E[6]*=-1,E[8]*=-1,E[9]*=-1,E[14]*=-1,this.markAsUpdated(),this}toggleProjectionMatrixHandInPlace(){const E=this.Xj;return E[8]*=-1,E[9]*=-1,E[10]*=-1,E[11]*=-1,this.markAsUpdated(),this}static jh(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const h=new u;return u.FromArrayToRef(E,b,h),h}static FromArrayToRef(E,b,h){for(let a=0;a<16;a++)h.Xj[a]=E[a+b];return h.markAsUpdated(),h}static FromFloat32ArrayToRefScaled(E,b,h,a){return a.Xj[0]=E[0+b]*h,a.Xj[1]=E[1+b]*h,a.Xj[2]=E[2+b]*h,a.Xj[3]=E[3+b]*h,a.Xj[4]=E[4+b]*h,a.Xj[5]=E[5+b]*h,a.Xj[6]=E[6+b]*h,a.Xj[7]=E[7+b]*h,a.Xj[8]=E[8+b]*h,a.Xj[9]=E[9+b]*h,a.Xj[10]=E[10+b]*h,a.Xj[11]=E[11+b]*h,a.Xj[12]=E[12+b]*h,a.Xj[13]=E[13+b]*h,a.Xj[14]=E[14+b]*h,a.Xj[15]=E[15+b]*h,a.markAsUpdated(),a}static get IdentityReadOnly(){return u._IdentityReadOnly}static FromValuesToRef(E,b,h,a,k,G,V,l,O,v,s,U,B,o,u,D,g){const S=g.Xj;S[0]=E,S[1]=b,S[2]=h,S[3]=a,S[4]=k,S[5]=G,S[6]=V,S[7]=l,S[8]=O,S[9]=v,S[10]=s,S[11]=U,S[12]=B,S[13]=o,S[14]=u,S[15]=D,g.markAsUpdated()}static FromValues(E,b,h,a,k,G,V,l,O,v,s,U,B,o,D,g){const S=new u,M=S.Xj;return M[0]=E,M[1]=b,M[2]=h,M[3]=a,M[4]=k,M[5]=G,M[6]=V,M[7]=l,M[8]=O,M[9]=v,M[10]=s,M[11]=U,M[12]=B,M[13]=o,M[14]=D,M[15]=g,S.markAsUpdated(),S}static Compose(E,b,h){const a=new u;return u.ComposeToRef(E,b,h,a),a}static ComposeToRef(E,b,h,a){const k=a.Xj,G=b._x,V=b._y,l=b._z,O=b._w,v=G+G,s=V+V,U=l+l,B=G*v,o=G*s,u=G*U,D=V*s,g=V*U,S=l*U,M=O*v,I=O*s,j=O*U,P=E._x,A=E._y,n=E._z;return k[0]=(1-(D+S))*P,k[1]=(o+j)*P,k[2]=(u-I)*P,k[3]=0,k[4]=(o-j)*A,k[5]=(1-(B+S))*A,k[6]=(g+M)*A,k[7]=0,k[8]=(u+I)*n,k[9]=(g-M)*n,k[10]=(1-(B+D))*n,k[11]=0,k[12]=h._x,k[13]=h._y,k[14]=h._z,k[15]=1,a.markAsUpdated(),a}static Identity(){const E=u.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return E._updateIdentityStatus(!0),E}static IdentityToRef(E){return u.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,E),E._updateIdentityStatus(!0),E}static Zero(){const E=u.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return E._updateIdentityStatus(!1),E}static RotationX(E){const b=new u;return u.RotationXToRef(E,b),b}static Invert(E){const b=new u;return E.invertToRef(b),b}static RotationXToRef(E,b){const h=Math.sin(E),a=Math.cos(E);return u.FromValuesToRef(1,0,0,0,0,a,h,0,0,-h,a,0,0,0,0,1,b),b._updateIdentityStatus(1===a&&0===h),b}static RotationY(E){const b=new u;return u.RotationYToRef(E,b),b}static RotationYToRef(E,b){const h=Math.sin(E),a=Math.cos(E);return u.FromValuesToRef(a,0,-h,0,0,1,0,0,h,0,a,0,0,0,0,1,b),b._updateIdentityStatus(1===a&&0===h),b}static RotationZ(E){const b=new u;return u.RotationZToRef(E,b),b}static RotationZToRef(E,b){const h=Math.sin(E),a=Math.cos(E);return u.FromValuesToRef(a,h,0,0,-h,a,0,0,0,0,1,0,0,0,0,1,b),b._updateIdentityStatus(1===a&&0===h),b}static RotationAxis(E,b){const h=new u;return u.RotationAxisToRef(E,b,h),h}static RotationAxisToRef(E,b,h){const a=Math.sin(-b),k=Math.cos(-b),G=1-k;E=E.normalizeToRef(D.o[0]);const V=h.Xj;return V[0]=E._x*E._x*G+k,V[1]=E._x*E._y*G-E._z*a,V[2]=E._x*E._z*G+E._y*a,V[3]=0,V[4]=E._y*E._x*G+E._z*a,V[5]=E._y*E._y*G+k,V[6]=E._y*E._z*G-E._x*a,V[7]=0,V[8]=E._z*E._x*G-E._y*a,V[9]=E._z*E._y*G+E._x*a,V[10]=E._z*E._z*G+k,V[11]=0,V[12]=0,V[13]=0,V[14]=0,V[15]=1,h.markAsUpdated(),h}static RotationAlignToRef(E,b,h){let k=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const G=U.Dot(b,E),V=h.Xj;if(G<-1+a.d)V[0]=-1,V[1]=0,V[2]=0,V[3]=0,V[4]=0,V[5]=k?1:-1,V[6]=0,V[7]=0,V[8]=0,V[9]=0,V[10]=k?-1:1,V[11]=0;else{const h=U.Cross(b,E),a=1/(1+G);V[0]=h._x*h._x*a+G,V[1]=h._y*h._x*a-h._z,V[2]=h._z*h._x*a+h._y,V[3]=0,V[4]=h._x*h._y*a+h._z,V[5]=h._y*h._y*a+G,V[6]=h._z*h._y*a-h._x,V[7]=0,V[8]=h._x*h._z*a-h._y,V[9]=h._y*h._z*a+h._x,V[10]=h._z*h._z*a+G,V[11]=0}return V[12]=0,V[13]=0,V[14]=0,V[15]=1,h.markAsUpdated(),h}static RotationYawPitchRoll(E,b,h){const a=new u;return u.RotationYawPitchRollToRef(E,b,h,a),a}static RotationYawPitchRollToRef(E,b,h,a){return o.RotationYawPitchRollToRef(E,b,h,D.Quaternion[0]),D.Quaternion[0].toRotationMatrix(a),a}static Scaling(E,b,h){const a=new u;return u.ScalingToRef(E,b,h,a),a}static ScalingToRef(E,b,h,a){return u.FromValuesToRef(E,0,0,0,0,b,0,0,0,0,h,0,0,0,0,1,a),a._updateIdentityStatus(1===E&&1===b&&1===h),a}static Translation(E,b,h){const a=new u;return u.TranslationToRef(E,b,h,a),a}static TranslationToRef(E,b,h,a){return u.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,E,b,h,1,a),a._updateIdentityStatus(0===E&&0===b&&0===h),a}static Lerp(E,b,h){const a=new u;return u.LerpToRef(E,b,h,a),a}static LerpToRef(E,b,h,a){const k=a.Xj,G=E.m,V=b.m;for(let l=0;l<16;l++)k[l]=G[l]*(1-h)+V[l]*h;return a.markAsUpdated(),a}static DecomposeLerp(E,b,h){const a=new u;return u.DecomposeLerpToRef(E,b,h,a),a}static DecomposeLerpToRef(E,b,h,a){const k=D.o[0],G=D.Quaternion[0],V=D.o[1];E.decompose(k,G,V);const l=D.o[2],O=D.Quaternion[1],v=D.o[3];b.decompose(l,O,v);const s=D.o[4];U.LerpToRef(k,l,h,s);const B=D.Quaternion[2];o.SlerpToRef(G,O,h,B);const g=D.o[5];return U.LerpToRef(V,v,h,g),u.ComposeToRef(s,B,g,a),a}static LookAtLH(E,b,h){const a=new u;return u.LookAtLHToRef(E,b,h,a),a}static LookAtLHToRef(E,b,h,a){const k=D.o[0],G=D.o[1],V=D.o[2];b.subtractToRef(E,V),V.normalize(),U.CrossToRef(h,V,k);const l=k.lengthSquared();0===l?k.x=1:k.normalizeFromLength(Math.sqrt(l)),U.CrossToRef(V,k,G),G.normalize();const O=-U.Dot(k,E),v=-U.Dot(G,E),s=-U.Dot(V,E);return u.FromValuesToRef(k._x,G._x,V._x,0,k._y,G._y,V._y,0,k._z,G._z,V._z,0,O,v,s,1,a),a}static LookAtRH(E,b,h){const a=new u;return u.LookAtRHToRef(E,b,h,a),a}static LookAtRHToRef(E,b,h,a){const k=D.o[0],G=D.o[1],V=D.o[2];E.subtractToRef(b,V),V.normalize(),U.CrossToRef(h,V,k);const l=k.lengthSquared();0===l?k.x=1:k.normalizeFromLength(Math.sqrt(l)),U.CrossToRef(V,k,G),G.normalize();const O=-U.Dot(k,E),v=-U.Dot(G,E),s=-U.Dot(V,E);return u.FromValuesToRef(k._x,G._x,V._x,0,k._y,G._y,V._y,0,k._z,G._z,V._z,0,O,v,s,1,a),a}static LookDirectionLH(E,b){const h=new u;return u.LookDirectionLHToRef(E,b,h),h}static LookDirectionLHToRef(E,b,h){const a=D.o[0];a.p(E),a.scaleInPlace(-1);const k=D.o[1];return U.CrossToRef(b,a,k),u.FromValuesToRef(k._x,k._y,k._z,0,b._x,b._y,b._z,0,a._x,a._y,a._z,0,0,0,0,1,h),h}static LookDirectionRH(E,b){const h=new u;return u.LookDirectionRHToRef(E,b,h),h}static LookDirectionRHToRef(E,b,h){const a=D.o[2];return U.CrossToRef(b,E,a),u.FromValuesToRef(a._x,a._y,a._z,0,b._x,b._y,b._z,0,E._x,E._y,E._z,0,0,0,0,1,h),h}static OrthoLH(E,b,h,a,k){const G=new u;return u.OrthoLHToRef(E,b,h,a,G,k),G}static OrthoLHToRef(E,b,h,a,k,G){const V=2/E,l=2/b,O=2/(a-h),v=-(a+h)/(a-h);return u.FromValuesToRef(V,0,0,0,0,l,0,0,0,0,O,0,0,0,v,1,k),G&&k.multiplyToRef(S,k),k._updateIdentityStatus(1===V&&1===l&&1===O&&0===v),k}static OrthoOffCenterLH(E,b,h,a,k,G,V){const l=new u;return u.OrthoOffCenterLHToRef(E,b,h,a,k,G,l,V),l}static OrthoOffCenterLHToRef(E,b,h,a,k,G,V,l){const O=2/(b-E),v=2/(a-h),s=2/(G-k),U=-(G+k)/(G-k),B=(E+b)/(E-b),o=(a+h)/(h-a);return u.FromValuesToRef(O,0,0,0,0,v,0,0,0,0,s,0,B,o,U,1,V),l&&V.multiplyToRef(S,V),V.markAsUpdated(),V}static ObliqueOffCenterLHToRef(E,b,h,a,k,G,V,l,O,v,s){const U=-V*Math.cos(l),B=-V*Math.sin(l);return u.TranslationToRef(0,0,-O,D.Matrix[1]),u.FromValuesToRef(1,0,0,0,0,1,0,0,U,B,1,0,0,0,0,1,D.Matrix[0]),D.Matrix[1].multiplyToRef(D.Matrix[0],D.Matrix[0]),u.TranslationToRef(0,0,O,D.Matrix[1]),D.Matrix[0].multiplyToRef(D.Matrix[1],D.Matrix[0]),u.OrthoOffCenterLHToRef(E,b,h,a,k,G,v,s),D.Matrix[0].multiplyToRef(v,v),v}static OrthoOffCenterRH(E,b,h,a,k,G,V){const l=new u;return u.OrthoOffCenterRHToRef(E,b,h,a,k,G,l,V),l}static OrthoOffCenterRHToRef(E,b,h,a,k,G,V,l){return u.OrthoOffCenterLHToRef(E,b,h,a,k,G,V,l),V.Xj[10]*=-1,V}static ObliqueOffCenterRHToRef(E,b,h,a,k,G,V,l,O,v,s){const U=V*Math.cos(l),B=V*Math.sin(l);return u.TranslationToRef(0,0,O,D.Matrix[1]),u.FromValuesToRef(1,0,0,0,0,1,0,0,U,B,1,0,0,0,0,1,D.Matrix[0]),D.Matrix[1].multiplyToRef(D.Matrix[0],D.Matrix[0]),u.TranslationToRef(0,0,-O,D.Matrix[1]),D.Matrix[0].multiplyToRef(D.Matrix[1],D.Matrix[0]),u.OrthoOffCenterRHToRef(E,b,h,a,k,G,v,s),D.Matrix[0].multiplyToRef(v,v),v}static PerspectiveLH(E,b,h,a,k){let G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const V=new u,l=2*h/E,O=2*h/b,v=(a+h)/(a-h),s=-2*a*h/(a-h),U=Math.tan(G);return u.FromValuesToRef(l,0,0,0,0,O,0,U,0,0,v,1,0,0,s,0,V),k&&V.multiplyToRef(S,V),V._updateIdentityStatus(!1),V}static PerspectiveFovLH(E,b,h,a,k){let G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,V=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const l=new u;return u.PerspectiveFovLHToRef(E,b,h,a,l,!0,k,G,V),l}static PerspectiveFovLHToRef(E,b,h,a,k){let G=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],V=arguments.length>6?arguments[6]:void 0,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,O=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const v=h,s=a,U=1/Math.tan(.5*E),B=G?U/b:U,o=G?U:U*b,D=O&&0===v?-1:0!==s?(s+v)/(s-v):1,g=O&&0===v?2*s:0!==s?-2*s*v/(s-v):-2*v,M=Math.tan(l);return u.FromValuesToRef(B,0,0,0,0,o,0,M,0,0,D,1,0,0,g,0,k),V&&k.multiplyToRef(S,k),k._updateIdentityStatus(!1),k}static PerspectiveFovReverseLHToRef(E,b,h,a,k){let G=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],V=arguments.length>6?arguments[6]:void 0,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const O=1/Math.tan(.5*E),v=G?O/b:O,s=G?O:O*b,U=Math.tan(l);return u.FromValuesToRef(v,0,0,0,0,s,0,U,0,0,-h,1,0,0,1,0,k),V&&k.multiplyToRef(S,k),k._updateIdentityStatus(!1),k}static PerspectiveFovRH(E,b,h,a,k){let G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,V=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const l=new u;return u.PerspectiveFovRHToRef(E,b,h,a,l,!0,k,G,V),l}static PerspectiveFovRHToRef(E,b,h,a,k){let G=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],V=arguments.length>6?arguments[6]:void 0,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,O=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const v=h,s=a,U=1/Math.tan(.5*E),B=G?U/b:U,o=G?U:U*b,D=O&&0===v?1:0!==s?-(s+v)/(s-v):-1,g=O&&0===v?2*s:0!==s?-2*s*v/(s-v):-2*v,M=Math.tan(l);return u.FromValuesToRef(B,0,0,0,0,o,0,M,0,0,D,-1,0,0,g,0,k),V&&k.multiplyToRef(S,k),k._updateIdentityStatus(!1),k}static PerspectiveFovReverseRHToRef(E,b,h,a,k){let G=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],V=arguments.length>6?arguments[6]:void 0,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const O=1/Math.tan(.5*E),v=G?O/b:O,s=G?O:O*b,U=Math.tan(l);return u.FromValuesToRef(v,0,0,0,0,s,0,U,0,0,-h,-1,0,0,-1,0,k),V&&k.multiplyToRef(S,k),k._updateIdentityStatus(!1),k}static GetFinalMatrix(E,b,h,a,k,G){const V=E.width,l=E.height,O=E.x,v=E.y,s=u.FromValues(V/2,0,0,0,0,-l/2,0,0,0,0,G-k,0,O+V/2,l/2+v,k,1),U=new u;return b.multiplyToRef(h,U),U.multiplyToRef(a,U),U.multiplyToRef(s,U)}static GetAsMatrix2x2(E){const b=E.m,h=[b[0],b[1],b[4],b[5]];return V.c.MatrixUse64Bits?h:new Float32Array(h)}static GetAsMatrix3x3(E){const b=E.m,h=[b[0],b[1],b[2],b[4],b[5],b[6],b[8],b[9],b[10]];return V.c.MatrixUse64Bits?h:new Float32Array(h)}static Transpose(E){const b=new u;return u.TransposeToRef(E,b),b}static TransposeToRef(E,b){const h=E.m,a=h[0],k=h[4],G=h[8],V=h[12],l=h[1],O=h[5],v=h[9],s=h[13],U=h[2],B=h[6],o=h[10],u=h[14],D=h[3],g=h[7],S=h[11],M=h[15],I=b.Xj;return I[0]=a,I[1]=k,I[2]=G,I[3]=V,I[4]=l,I[5]=O,I[6]=v,I[7]=s,I[8]=U,I[9]=B,I[10]=o,I[11]=u,I[12]=D,I[13]=g,I[14]=S,I[15]=M,b.markAsUpdated(),b._updateIdentityStatus(E._isIdentity,E._isIdentityDirty),b}static Reflection(E){const b=new u;return u.ReflectionToRef(E,b),b}static ReflectionToRef(E,b){E.normalize();const h=E.k.x,a=E.k.y,k=E.k.z,G=-2*h,V=-2*a,l=-2*k;return u.FromValuesToRef(G*h+1,V*h,l*h,0,G*a,V*a+1,l*a,0,G*k,V*k,l*k+1,0,G*E.d,V*E.d,l*E.d,1,b),b}static FromXYZAxesToRef(E,b,h,a){return u.FromValuesToRef(E._x,E._y,E._z,0,b._x,b._y,b._z,0,h._x,h._y,h._z,0,0,0,0,1,a),a}static FromQuaternionToRef(E,b){const h=E._x*E._x,a=E._y*E._y,k=E._z*E._z,G=E._x*E._y,V=E._z*E._w,l=E._z*E._x,O=E._y*E._w,v=E._y*E._z,s=E._x*E._w;return b.Xj[0]=1-2*(a+k),b.Xj[1]=2*(G+V),b.Xj[2]=2*(l-O),b.Xj[3]=0,b.Xj[4]=2*(G-V),b.Xj[5]=1-2*(k+h),b.Xj[6]=2*(v+s),b.Xj[7]=0,b.Xj[8]=2*(l+O),b.Xj[9]=2*(v-s),b.Xj[10]=1-2*(a+h),b.Xj[11]=0,b.Xj[12]=0,b.Xj[13]=0,b.Xj[14]=0,b.Xj[15]=1,b.markAsUpdated(),b}}u._UpdateFlagSeed=0,u._IdentityReadOnly=u.Identity(),Object.defineProperties(u.prototype,{dimension:{value:[4,4]},rank:{value:2}});class D{}D.o=(0,k.e)(11,U.Zero),D.Matrix=(0,k.e)(2,u.Identity),D.Quaternion=(0,k.e)(3,o.Zero);class g{}g.Vector2=(0,k.e)(3,s.Zero),g.o=(0,k.e)(13,U.Zero),g.Vector4=(0,k.e)(3,B.Zero),g.Quaternion=(0,k.e)(3,o.Zero),g.Matrix=(0,k.e)(8,u.Identity),(0,G.f)("BABYLON.Vector2",s),(0,G.f)("BABYLON.Vector3",U),(0,G.f)("BABYLON.Vector4",B),(0,G.f)("BABYLON.Matrix",u);const S=u.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)},11432:(E,b,h)=>{"use strict";h.d(b,{b:()=>a});class a{constructor(E,b,h,a){this.x=E,this.y=b,this.width=h,this.height=a}toGlobal(E,b){return new a(this.x*E,this.y*b,this.width*E,this.height*b)}toGlobalToRef(E,b,h){return h.x=this.x*E,h.y=this.y*b,h.width=this.width*E,h.height=this.height*b,this}clone(){return new a(this.x,this.y,this.width,this.height)}}},11659:(E,b,h)=>{"use strict";h.d(b,{e:()=>v,h:()=>s});var a=h(11175),k=h(11667);const G=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],V=[()=>1,E=>E.y,E=>E.z,E=>E.x,E=>E.x*E.y,E=>E.y*E.z,E=>3*E.z*E.z-1,E=>E.x*E.z,E=>E.x*E.x-E.y*E.y],l=(E,b)=>G[E]*V[E](b),O=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class v{constructor(){this.preScaled=!1,this.l00=a.k.Zero(),this.l1_1=a.k.Zero(),this.l10=a.k.Zero(),this.l11=a.k.Zero(),this.l2_2=a.k.Zero(),this.l2_1=a.k.Zero(),this.l20=a.k.Zero(),this.l21=a.k.Zero(),this.l22=a.k.Zero()}addLight(E,b,h){k.c.o[0].set(b.r,b.g,b.b);const a=k.c.o[0],G=k.c.o[1];a.scaleToRef(h,G),G.scaleToRef(l(0,E),k.c.o[2]),this.l00.addInPlace(k.c.o[2]),G.scaleToRef(l(1,E),k.c.o[2]),this.l1_1.addInPlace(k.c.o[2]),G.scaleToRef(l(2,E),k.c.o[2]),this.l10.addInPlace(k.c.o[2]),G.scaleToRef(l(3,E),k.c.o[2]),this.l11.addInPlace(k.c.o[2]),G.scaleToRef(l(4,E),k.c.o[2]),this.l2_2.addInPlace(k.c.o[2]),G.scaleToRef(l(5,E),k.c.o[2]),this.l2_1.addInPlace(k.c.o[2]),G.scaleToRef(l(6,E),k.c.o[2]),this.l20.addInPlace(k.c.o[2]),G.scaleToRef(l(7,E),k.c.o[2]),this.l21.addInPlace(k.c.o[2]),G.scaleToRef(l(8,E),k.c.o[2]),this.l22.addInPlace(k.c.o[2])}scaleInPlace(E){this.l00.scaleInPlace(E),this.l1_1.scaleInPlace(E),this.l10.scaleInPlace(E),this.l11.scaleInPlace(E),this.l2_2.scaleInPlace(E),this.l2_1.scaleInPlace(E),this.l20.scaleInPlace(E),this.l21.scaleInPlace(E),this.l22.scaleInPlace(E)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(O[0]),this.l1_1.scaleInPlace(O[1]),this.l10.scaleInPlace(O[2]),this.l11.scaleInPlace(O[3]),this.l2_2.scaleInPlace(O[4]),this.l2_1.scaleInPlace(O[5]),this.l20.scaleInPlace(O[6]),this.l21.scaleInPlace(O[7]),this.l22.scaleInPlace(O[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(G[0]),this.l1_1.scaleInPlace(G[1]),this.l10.scaleInPlace(G[2]),this.l11.scaleInPlace(G[3]),this.l2_2.scaleInPlace(G[4]),this.l2_1.scaleInPlace(G[5]),this.l20.scaleInPlace(G[6]),this.l21.scaleInPlace(G[7]),this.l22.scaleInPlace(G[8])}updateFromArray(E){return a.k.FromArrayToRef(E[0],0,this.l00),a.k.FromArrayToRef(E[1],0,this.l1_1),a.k.FromArrayToRef(E[2],0,this.l10),a.k.FromArrayToRef(E[3],0,this.l11),a.k.FromArrayToRef(E[4],0,this.l2_2),a.k.FromArrayToRef(E[5],0,this.l2_1),a.k.FromArrayToRef(E[6],0,this.l20),a.k.FromArrayToRef(E[7],0,this.l21),a.k.FromArrayToRef(E[8],0,this.l22),this}updateFromFloatsArray(E){return a.k.FromFloatsToRef(E[0],E[1],E[2],this.l00),a.k.FromFloatsToRef(E[3],E[4],E[5],this.l1_1),a.k.FromFloatsToRef(E[6],E[7],E[8],this.l10),a.k.FromFloatsToRef(E[9],E[10],E[11],this.l11),a.k.FromFloatsToRef(E[12],E[13],E[14],this.l2_2),a.k.FromFloatsToRef(E[15],E[16],E[17],this.l2_1),a.k.FromFloatsToRef(E[18],E[19],E[20],this.l20),a.k.FromFloatsToRef(E[21],E[22],E[23],this.l21),a.k.FromFloatsToRef(E[24],E[25],E[26],this.l22),this}static jh(E){return(new v).updateFromArray(E)}static FromPolynomial(E){const b=new v;return b.l00=E.xx.scale(.376127).add(E.yy.scale(.376127)).add(E.zz.scale(.376126)),b.l1_1=E.y.scale(.977204),b.l10=E.z.scale(.977204),b.l11=E.x.scale(.977204),b.l2_2=E.xy.scale(1.16538),b.l2_1=E.yz.scale(1.16538),b.l20=E.zz.scale(1.34567).Xc(E.xx.scale(.672834)).Xc(E.yy.scale(.672834)),b.l21=E.zx.scale(1.16538),b.l22=E.xx.scale(1.16538).Xc(E.yy.scale(1.16538)),b.l1_1.scaleInPlace(-1),b.l11.scaleInPlace(-1),b.l2_1.scaleInPlace(-1),b.l21.scaleInPlace(-1),b.scaleInPlace(Math.PI),b}}class s{constructor(){this.x=a.k.Zero(),this.y=a.k.Zero(),this.z=a.k.Zero(),this.xx=a.k.Zero(),this.yy=a.k.Zero(),this.zz=a.k.Zero(),this.xy=a.k.Zero(),this.yz=a.k.Zero(),this.zx=a.k.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=v.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(E){k.c.o[0].ue(E.r,E.g,E.b);const b=k.c.o[0];this.xx.addInPlace(b),this.yy.addInPlace(b),this.zz.addInPlace(b)}scaleInPlace(E){this.x.scaleInPlace(E),this.y.scaleInPlace(E),this.z.scaleInPlace(E),this.xx.scaleInPlace(E),this.yy.scaleInPlace(E),this.zz.scaleInPlace(E),this.yz.scaleInPlace(E),this.zx.scaleInPlace(E),this.xy.scaleInPlace(E)}updateFromHarmonics(E){return this._harmonics=E,this.x.p(E.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.p(E.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.p(E.l10),this.z.scaleInPlace(1.02333),this.xx.p(E.l00),k.c.o[0].p(E.l20).scaleInPlace(.247708),k.c.o[1].p(E.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).yi(k.c.o[0]).addInPlace(k.c.o[1]),this.yy.p(E.l00),this.yy.scaleInPlace(.886277).yi(k.c.o[0]).yi(k.c.o[1]),this.zz.p(E.l00),k.c.o[0].p(E.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(k.c.o[0]),this.yz.p(E.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.p(E.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.p(E.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(E){return(new s).updateFromHarmonics(E)}static jh(E){const b=new s;return a.k.FromArrayToRef(E[0],0,b.x),a.k.FromArrayToRef(E[1],0,b.y),a.k.FromArrayToRef(E[2],0,b.z),a.k.FromArrayToRef(E[3],0,b.xx),a.k.FromArrayToRef(E[4],0,b.yy),a.k.FromArrayToRef(E[5],0,b.zz),a.k.FromArrayToRef(E[6],0,b.yz),a.k.FromArrayToRef(E[7],0,b.zx),a.k.FromArrayToRef(E[8],0,b.xy),b}}},11480:(E,b,h)=>{"use strict";h.d(b,{e:()=>v});var a=h(11175),k=h(11201),G=h(11419),V=h(11435),l=h(11389);h(11483);function O(E){let b=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const h=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],G=[];let O=[];const v=E.width||E.size||1,s=E.height||E.size||1,U=E.depth||E.size||1,B=E.wrap||!1;let o=void 0===E.topBaseAt?1:E.topBaseAt,u=void 0===E.bottomBaseAt?0:E.bottomBaseAt;o=(o+4)%4,u=(u+4)%4;let D=[2,0,3,1][o],g=[2,0,1,3][u],S=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(B){b=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],S=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let E=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],h=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const a=[17,18,19,16],k=[22,23,20,21];for(;D>0;)E.unshift(E.pop()),a.unshift(a.pop()),D--;for(;g>0;)h.unshift(h.pop()),k.unshift(k.pop()),g--;E=E.flat(),h=h.flat(),S=S.concat(E).concat(h),b.push(a[0],a[2],a[3],a[0],a[1],a[2]),b.push(k[0],k[2],k[3],k[0],k[1],k[2])}const M=[v/2,s/2,U/2];O=S.reduce(((E,b,h)=>E.concat(b*M[h%3])),[]);const I=0===E.sideOrientation?0:E.sideOrientation||V.c.DEFAULTSIDE,j=E.faceUV||new Array(6),P=E.faceColors,A=[];for(let V=0;V<6;V++)void 0===j[V]&&(j[V]=new a.n(0,0,1,1)),P&&void 0===P[V]&&(P[V]=new k.f(1,1,1,1));for(let a=0;a<6;a++)if(G.push(j[a].z,l.c?1-j[a].w:j[a].w),G.push(j[a].x,l.c?1-j[a].w:j[a].w),G.push(j[a].x,l.c?1-j[a].y:j[a].y),G.push(j[a].z,l.c?1-j[a].y:j[a].y),P)for(let E=0;E<4;E++)A.push(P[a].r,P[a].g,P[a].b,P[a].a);V.c._ComputeSides(I,O,b,h,G,E.frontUVs,E.backUVs);const n=new V.c;if(n.indices=b,n.xa=O,n.ya=h,n.Aa=G,P){const E=I===V.c.DOUBLESIDE?A.concat(A):A;n.za=E}return n}function v(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=new G.b(E,h);b.sideOrientation=G.b._GetDefaultSideOrientation(b.sideOrientation),a._originalBuilderSideOrientation=b.sideOrientation;return O(b).Ca(a,b.updatable),a}V.c.CreateBox=O,G.b.CreateBox=function(E,b){return v(E,{size:b,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},11822:(E,b,h)=>{"use strict";h.d(b,{d:()=>l});var a=h(11419),k=h(11435),G=h(11389);function V(E){const b=[],h=[],a=[],V=[],l=E.radius||.5,O=E.tessellation||64,v=E.arc&&(E.arc<=0||E.arc>1)?1:E.arc||1,s=0===E.sideOrientation?0:E.sideOrientation||k.c.DEFAULTSIDE;b.push(0,0,0),V.push(.5,.5);const U=2*Math.PI*v,B=1===v?U/O:U/(O-1);let o=0;for(let k=0;k<O;k++){const E=Math.cos(o),h=Math.sin(o),a=(E+1)/2,k=(1-h)/2;b.push(l*E,l*h,0),V.push(a,G.c?1-k:k),o+=B}1===v&&(b.push(b[3],b[4],b[5]),V.push(V[2],G.c?1-V[3]:V[3]));const u=b.length/3;for(let k=1;k<u-1;k++)h.push(k+1,0,k);k.c.ComputeNormals(b,h,a),k.c._ComputeSides(s,b,h,a,V,E.frontUVs,E.backUVs);const D=new k.c;return D.indices=h,D.xa=b,D.ya=a,D.Aa=V,D}function l(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=new a.b(E,h);b.sideOrientation=a.b._GetDefaultSideOrientation(b.sideOrientation),k._originalBuilderSideOrientation=b.sideOrientation;return V(b).Ca(k,b.updatable),k}k.c.CreateDisc=V,a.b.CreateDisc=function(E,b,h){return l(E,{radius:b,tessellation:h,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},11483:(E,b,h)=>{"use strict";h.d(b,{d:()=>g,b:()=>M,h:()=>S});var a=h(11175),k=h(11201),G=h(11419),V=h(11435),l=h(11233);G.b._GroundMeshParser=(E,b)=>O.Parse(E,b);class O extends G.b{constructor(E,b){super(E,b),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=E,this._subdivisionsY=E,this.subdivide(E);const h=this;h.createOrUpdateSubmeshesOctree&&h.createOrUpdateSubmeshesOctree(b)}getHeightAtCoordinates(E,b){const h=this.getWorldMatrix(),k=a.h.Matrix[5];h.invertToRef(k);const G=a.h.o[8];if(a.k.TransformCoordinatesFromFloatsToRef(E,0,b,k,G),E=G.x,b=G.z,E<this._minX||E>=this._maxX||b<=this._minZ||b>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const V=this._getFacetAt(E,b),l=-(V.x*E+V.z*b+V.w)/V.y;return a.k.TransformCoordinatesFromFloatsToRef(0,l,0,h,G),G.y}getNormalAtCoordinates(E,b){const h=new a.k(0,1,0);return this.getNormalAtCoordinatesToRef(E,b,h),h}getNormalAtCoordinatesToRef(E,b,h){const k=this.getWorldMatrix(),G=a.h.Matrix[5];k.invertToRef(G);const V=a.h.o[8];if(a.k.TransformCoordinatesFromFloatsToRef(E,0,b,G,V),E=V.x,b=V.z,E<this._minX||E>this._maxX||b<this._minZ||b>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const l=this._getFacetAt(E,b);return a.k.TransformNormalFromFloatsToRef(l.x,l.y,l.z,k,h),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(E,b){const h=Math.floor((E+this._maxX)*this._subdivisionsX/this._width),a=Math.floor(-(b+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),k=this._heightQuads[a*this._subdivisionsX+h];let G;return G=b<k.slope.x*E+k.slope.y?k.facet1:k.facet2,G}_initHeightQuads(){const E=this._subdivisionsX,b=this._subdivisionsY;this._heightQuads=new Array;for(let h=0;h<b;h++)for(let b=0;b<E;b++){const k={slope:a.j.Zero(),facet1:new a.n(0,0,0,0),facet2:new a.n(0,0,0,0)};this._heightQuads[h*E+b]=k}return this}_computeHeightQuads(){const E=this.getVerticesData(l.g.PositionKind);if(!E)return this;const b=a.h.o[3],h=a.h.o[2],k=a.h.o[1],G=a.h.o[0],V=a.h.o[4],O=a.h.o[5],v=a.h.o[6],s=a.h.o[7],U=a.h.o[8];let B=0,o=0,u=0,D=0,g=0,S=0,M=0;const I=this._subdivisionsX,j=this._subdivisionsY;for(let l=0;l<j;l++)for(let j=0;j<I;j++){B=3*j,o=l*(I+1)*3,u=(l+1)*(I+1)*3,b.x=E[o+B],b.y=E[o+B+1],b.z=E[o+B+2],h.x=E[o+B+3],h.y=E[o+B+4],h.z=E[o+B+5],k.x=E[u+B],k.y=E[u+B+1],k.z=E[u+B+2],G.x=E[u+B+3],G.y=E[u+B+4],G.z=E[u+B+5],D=(G.z-b.z)/(G.x-b.x),g=b.z-D*b.x,h.subtractToRef(b,V),k.subtractToRef(b,O),G.subtractToRef(b,v),a.k.CrossToRef(v,O,s),a.k.CrossToRef(V,v,U),s.normalize(),U.normalize(),S=-(s.x*b.x+s.y*b.y+s.z*b.z),M=-(U.x*h.x+U.y*h.y+U.z*h.z);const P=this._heightQuads[l*I+j];P.slope.ue(D,g),P.facet1.ue(s.x,s.y,s.z,S),P.facet2.ue(U.x,U.y,U.z,M)}return this}serialize(E){super.serialize(E),E.subdivisionsX=this._subdivisionsX,E.subdivisionsY=this._subdivisionsY,E.minX=this._minX,E.maxX=this._maxX,E.cj=this._minZ,E.maxZ=this._maxZ,E.width=this._width,E.height=this._height}static Parse(E,b){const h=new O(E.name,b);return h._subdivisionsX=E.subdivisionsX||1,h._subdivisionsY=E.subdivisionsY||1,h._minX=E.minX,h._maxX=E.maxX,h._minZ=E.cj,h._maxZ=E.maxZ,h._width=E.width,h._height=E.height,h}}var v=h(10821),s=h(10869),U=h(11177),B=h(11389);function o(E){const b=[],h=[],k=[],G=[];let l,O;const v=E.width||E.size||1,s=E.height||E.size||1,U=0|(E.subdivisionsX||E.subdivisions||1),o=0|(E.subdivisionsY||E.subdivisions||1);for(l=0;l<=o;l++)for(O=0;O<=U;O++){const E=new a.k(O*v/U-v/2,0,(o-l)*s/o-s/2),b=new a.k(0,1,0);h.push(E.x,E.y,E.z),k.push(b.x,b.y,b.z),G.push(O/U,B.c?l/o:1-l/o)}for(l=0;l<o;l++)for(O=0;O<U;O++)b.push(O+1+(l+1)*(U+1)),b.push(O+1+l*(U+1)),b.push(O+l*(U+1)),b.push(O+(l+1)*(U+1)),b.push(O+1+(l+1)*(U+1)),b.push(O+l*(U+1));const u=new V.c;return u.indices=b,u.xa=h,u.ya=k,u.Aa=G,u}function u(E){const b=void 0!==E.xmin&&null!==E.xmin?E.xmin:-1,h=void 0!==E.zmin&&null!==E.zmin?E.zmin:-1,k=void 0!==E.xmax&&null!==E.xmax?E.xmax:1,G=void 0!==E.zmax&&null!==E.zmax?E.zmax:1,l=E.subdivisions||{w:1,h:1},O=E.precision||{w:1,h:1},v=[],s=[],U=[],B=[];let o,u,D,g;l.h=l.h<1?1:l.h,l.w=l.w<1?1:l.w,O.w=O.w<1?1:O.w,O.h=O.h<1?1:O.h;const S=(k-b)/l.w,M=(G-h)/l.h;function I(E,b,h,k){const G=s.length/3,V=O.w+1;for(o=0;o<O.h;o++)for(u=0;u<O.w;u++){const E=[G+u+o*V,G+(u+1)+o*V,G+(u+1)+(o+1)*V,G+u+(o+1)*V];v.push(E[1]),v.push(E[2]),v.push(E[3]),v.push(E[0]),v.push(E[1]),v.push(E[3])}const l=a.k.Zero(),D=new a.k(0,1,0);for(o=0;o<=O.h;o++)for(l.z=o*(k-b)/O.h+b,u=0;u<=O.w;u++)l.x=u*(h-E)/O.w+E,l.y=0,s.push(l.x,l.y,l.z),U.push(D.x,D.y,D.z),B.push(u/O.w,o/O.h)}for(D=0;D<l.h;D++)for(g=0;g<l.w;g++)I(b+g*S,h+D*M,b+(g+1)*S,h+(D+1)*M);const j=new V.c;return j.indices=v,j.xa=s,j.ya=U,j.Aa=B,j}function D(E){const b=[],h=[],G=[],l=[];let O,v;const s=E.colorFilter||new k.b(.3,.59,.11),B=E.alphaFilter||0;let o=!1;if(E.minHeight>E.maxHeight){o=!0;const b=E.maxHeight;E.maxHeight=E.minHeight,E.minHeight=b}for(O=0;O<=E.subdivisions;O++)for(v=0;v<=E.subdivisions;v++){const b=new a.k(v*E.width/E.subdivisions-E.width/2,0,(E.subdivisions-O)*E.height/E.subdivisions-E.height/2),k=4*(((b.x+E.width/2)/E.width*(E.bufferWidth-1)|0)+((1-(b.z+E.height/2)/E.height)*(E.bufferHeight-1)|0)*E.bufferWidth);let V=E.buffer[k]/255,u=E.buffer[k+1]/255,D=E.buffer[k+2]/255;const g=E.buffer[k+3]/255;o&&(V=1-V,u=1-u,D=1-D);const S=V*s.r+u*s.g+D*s.b;b.y=g>=B?E.minHeight+(E.maxHeight-E.minHeight)*S:E.minHeight-U.d,E.heightBuffer&&(E.heightBuffer[O*(E.subdivisions+1)+v]=b.y),h.push(b.x,b.y,b.z),G.push(0,0,0),l.push(v/E.subdivisions,1-O/E.subdivisions)}for(O=0;O<E.subdivisions;O++)for(v=0;v<E.subdivisions;v++){const a=v+1+(O+1)*(E.subdivisions+1),k=v+1+O*(E.subdivisions+1),G=v+O*(E.subdivisions+1),V=v+(O+1)*(E.subdivisions+1),l=h[3*a+1]>=E.minHeight,s=h[3*k+1]>=E.minHeight,U=h[3*G+1]>=E.minHeight;l&&s&&U&&(b.push(a),b.push(k),b.push(G));h[3*V+1]>=E.minHeight&&l&&U&&(b.push(V),b.push(a),b.push(G))}V.c.ComputeNormals(h,b,G);const u=new V.c;return u.indices=b,u.xa=h,u.ya=G,u.Aa=l,u}function g(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const h=new O(E,arguments.length>2?arguments[2]:void 0);h._setReady(!1),h._subdivisionsX=b.subdivisionsX||b.subdivisions||1,h._subdivisionsY=b.subdivisionsY||b.subdivisions||1,h._width=b.width||1,h._height=b.height||1,h._maxX=h._width/2,h._maxZ=h._height/2,h._minX=-h._maxX,h._minZ=-h._maxZ;return o(b).Ca(h,b.updatable),h._setReady(!0),h}function S(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=new G.b(E,h);return u(b).Ca(a,b.updatable),a}function M(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const G=h.width||10,V=h.height||10,l=h.subdivisions||1,U=h.minHeight||0,B=h.maxHeight||1,o=h.colorFilter||new k.b(.3,.59,.11),u=h.alphaFilter||0,g=h.updatable,S=h.onReady;a=a||s.b.LastCreatedScene;const M=new O(E,a);let I;M._subdivisionsX=l,M._subdivisionsY=l,M._width=G,M._height=V,M._maxX=M._width/2,M._maxZ=M._height/2,M._minX=-M._maxX,M._minZ=-M._maxZ,M._setReady(!1),h.passHeightBufferInCallback&&(I=new Float32Array((l+1)*(l+1)));const j=(E,b,h)=>{D({width:G,height:V,subdivisions:l,minHeight:U,maxHeight:B,colorFilter:o,buffer:E,bufferWidth:b,bufferHeight:h,alphaFilter:u,heightBuffer:I}).Ca(M,g),S&&S(M,I),M._setReady(!0)};if("string"===typeof b){const E=E=>{var b;const h=E.width,k=E.height;if(a.u)return;const G=null===(b=a)||void 0===b?void 0:b.getEngine().resizeImageBitmap(E,h,k);j(G,h,k)};v.g.LoadImage(b,E,h.onError?h.onError:()=>{},a.offlineProvider)}else j(b.data,b.width,b.height);return M}V.c.CreateGround=o,V.c.CreateTiledGround=u,V.c.CreateGroundFromHeightMap=D,G.b.CreateGround=(E,b,h,a,k,G)=>g(E,{width:b,height:h,subdivisions:a,updatable:G},k),G.b.CreateTiledGround=(E,b,h,a,k,G,V,l,O)=>S(E,{xmin:b,zmin:h,xmax:a,zmax:k,subdivisions:G,precision:V,updatable:O},l),G.b.CreateGroundFromHeightMap=(E,b,h,a,k,G,V,l,O,v,s)=>M(E,b,{width:h,height:a,subdivisions:k,minHeight:G,maxHeight:V,updatable:O,onReady:v,alphaFilter:s},l)},12585:(E,b,h)=>{"use strict";h.d(b,{d:()=>r,g:()=>Z,i:()=>Y});var a=h(11175),k=h(11419),G=h(11435),V=h(11201),l=h(11233),O=h(12176),v=h(11311),s=h(11206),U=h(11163),B=h(11376),o=h(10958),u=h(11396),D=h(10861),g=h(11368),S=h(10869),M=h(11357),I=h(11351);const j={effect:null,subMesh:null};class P extends g.d{constructor(E,b,h){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(E,b,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new a.d,this._cachedWorldViewProjectionMatrix=new a.d,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=h,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","k","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...k}}get shaderPath(){return this._shaderPath}set shaderPath(E){this._shaderPath=E}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(E){-1===this._options.uniforms.indexOf(E)&&this._options.uniforms.push(E)}setTexture(E,b){return-1===this._options.samplers.indexOf(E)&&this._options.samplers.push(E),this._textures[E]=b,this}removeTexture(E){delete this._textures[E]}setTextureArray(E,b){return-1===this._options.samplers.indexOf(E)&&this._options.samplers.push(E),this._checkUniform(E),this._textureArrays[E]=b,this}setExternalTexture(E,b){return-1===this._options.externalTextures.indexOf(E)&&this._options.externalTextures.push(E),this._externalTextures[E]=b,this}setFloat(E,b){return this._checkUniform(E),this._floats[E]=b,this}setInt(E,b){return this._checkUniform(E),this._ints[E]=b,this}setUInt(E,b){return this._checkUniform(E),this._uints[E]=b,this}setFloats(E,b){return this._checkUniform(E),this._floatsArrays[E]=b,this}setColor3(E,b){return this._checkUniform(E),this._colors3[E]=b,this}setColor3Array(E,b){return this._checkUniform(E),this._colors3Arrays[E]=b.reduce(((E,b)=>(b.toArray(E,E.length),E)),[]),this}setColor4(E,b){return this._checkUniform(E),this._colors4[E]=b,this}setColor4Array(E,b){return this._checkUniform(E),this._colors4Arrays[E]=b.reduce(((E,b)=>(b.toArray(E,E.length),E)),[]),this}setVector2(E,b){return this._checkUniform(E),this._vectors2[E]=b,this}setVector3(E,b){return this._checkUniform(E),this._vectors3[E]=b,this}setVector4(E,b){return this._checkUniform(E),this._vectors4[E]=b,this}setQuaternion(E,b){return this._checkUniform(E),this._quaternions[E]=b,this}setQuaternionArray(E,b){return this._checkUniform(E),this._quaternionsArrays[E]=b.reduce(((E,b)=>(b.toArray(E,E.length),E)),[]),this}setMatrix(E,b){return this._checkUniform(E),this._matrices[E]=b,this}setMatrices(E,b){this._checkUniform(E);const h=new Float32Array(16*b.length);for(let a=0;a<b.length;a++){b[a].copyToArray(h,16*a)}return this._matrixArrays[E]=h,this}setMatrix3x3(E,b){return this._checkUniform(E),this._matrices3x3[E]=b,this}setMatrix2x2(E,b){return this._checkUniform(E),this._matrices2x2[E]=b,this}setArray2(E,b){return this._checkUniform(E),this._vectors2Arrays[E]=b,this}setArray3(E,b){return this._checkUniform(E),this._vectors3Arrays[E]=b,this}setArray4(E,b){return this._checkUniform(E),this._vectors4Arrays[E]=b,this}setUniformBuffer(E,b){return-1===this._options.uniformBuffers.indexOf(E)&&this._options.uniformBuffers.push(E),this._uniformBuffers[E]=b,this}setTextureSampler(E,b){return-1===this._options.samplerObjects.indexOf(E)&&this._options.samplerObjects.push(E),this._textureSamplers[E]=b,this}setStorageBuffer(E,b){return-1===this._options.storageBuffers.indexOf(E)&&this._options.storageBuffers.push(E),this._storageBuffers[E]=b,this}setDefine(E,b){const h=E.trimEnd()+" ",a=this.options.defines.findIndex((b=>b===E||b.startsWith(h)));return a>=0&&this.options.defines.splice(a,1),("boolean"!==typeof b||b)&&this.options.defines.push(h+b),this}isReadyForSubMesh(E,b,h){return this.isReady(E,h,b)}isReady(E,b,h){var a;const k=h&&this._storeEffectOnSubMeshes;if(this.isFrozen){const E=k?h._drawWrapper:this._drawWrapper;if(E.effect&&E._wasPreviouslyReady&&E._wasPreviouslyUsingInstances===b)return!0}const G=this.va(),V=G.getEngine(),O=[],v=[],s=new u.b;let B=this._shaderPath,o=this._options.uniforms,D=this._options.uniformBuffers,g=this._options.samplers;V.getCaps().multiview&&G.activeCamera&&G.activeCamera.outputRenderTarget&&G.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,O.push("#define MULTIVIEW"),-1!==o.indexOf("viewProjection")&&-1===o.indexOf("viewProjectionR")&&o.push("viewProjectionR"));for(let l=0;l<this._options.defines.length;l++){const E=0===this._options.defines[l].indexOf("#define")?this._options.defines[l]:`#define ${this._options.defines[l]}`;O.push(E)}for(let l=0;l<this._options.attributes.length;l++)v.push(this._options.attributes[l]);if(E&&E.isVerticesDataPresent(l.g.ColorKind)&&(-1===v.indexOf(l.g.ColorKind)&&v.push(l.g.ColorKind),O.push("#define VERTEXCOLOR")),b&&(O.push("#define INSTANCES"),(0,I.$)(v,this._materialHelperNeedsPreviousMatrices),null!==E&&void 0!==E&&E.hasThinInstances&&(O.push("#define THIN_INSTANCES"),E&&E.isVerticesDataPresent(l.g.ColorInstanceKind)&&(v.push(l.g.ColorInstanceKind),O.push("#define INSTANCESCOLOR")))),E&&E.useBones&&E.computeBonesUsingShaders&&E.skeleton){v.push(l.g.MatricesIndicesKind),v.push(l.g.MatricesWeightsKind),E.numBoneInfluencers>4&&(v.push(l.g.MatricesIndicesExtraKind),v.push(l.g.MatricesWeightsExtraKind));const b=E.skeleton;O.push("#define NUM_BONE_INFLUENCERS "+E.numBoneInfluencers),s.addCPUSkinningFallback(0,E),b.isUsingTextureForMatrices?(O.push("#define BONETEXTURE"),-1===o.indexOf("boneTextureWidth")&&o.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(O.push("#define BonesPerMesh "+(b.bones.length+1)),-1===o.indexOf("mBones")&&o.push("mBones"))}else O.push("#define NUM_BONE_INFLUENCERS 0");let S=0;const P=E?E.morphTargetManager:null;if(P){const E=P.supportsUVs&&-1!==O.indexOf("#define UV1"),b=P.supportsTangents&&-1!==O.indexOf("#define TANGENT"),h=P.supportsNormals&&-1!==O.indexOf("#define NORMAL");S=P.numMaxInfluencers||P.numInfluencers,E&&O.push("#define MORPHTARGETS_UV"),b&&O.push("#define MORPHTARGETS_TANGENT"),h&&O.push("#define MORPHTARGETS_NORMAL"),S>0&&O.push("#define MORPHTARGETS"),P.isUsingTextureForTargets&&(O.push("#define MORPHTARGETS_TEXTURE"),-1===o.indexOf("morphTargetTextureIndices")&&o.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),O.push("#define NUM_MORPH_INFLUENCERS "+S);for(let a=0;a<S;a++)v.push(l.g.PositionKind+a),h&&v.push(l.g.NormalKind+a),b&&v.push(l.g.TangentKind+a),E&&v.push(l.g.UVKind+"_"+a);S>0&&(o=o.slice(),o.push("morphTargetInfluences"),o.push("morphTargetCount"),o.push("morphTargetTextureInfo"),o.push("morphTargetTextureIndices"))}else O.push("#define NUM_MORPH_INFLUENCERS 0");if(E){const b=E.bakedVertexAnimationManager;b&&b.isEnabled&&(O.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===o.indexOf("bakedVertexAnimationSettings")&&o.push("bakedVertexAnimationSettings"),-1===o.indexOf("bakedVertexAnimationTextureSizeInverted")&&o.push("bakedVertexAnimationTextureSizeInverted"),-1===o.indexOf("bakedVertexAnimationTime")&&o.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,I.z)(v,E,O)}for(const l in this._textures)if(!this._textures[l].isReady())return!1;E&&this._shouldTurnAlphaTestOn(E)&&O.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,M.b)(o),(0,M.i)(this,G,O)),G.fogEnabled&&null!==E&&void 0!==E&&E.applyFog&&G.fogMode!==U.e.FOGMODE_NONE&&(O.push("#define FOG"),-1===o.indexOf("view")&&o.push("view"),-1===o.indexOf("vFogInfos")&&o.push("vFogInfos"),-1===o.indexOf("vFogColor")&&o.push("vFogColor")),this._useLogarithmicDepth&&(O.push("#define LOGARITHMICDEPTH"),-1===o.indexOf("logarithmicDepthConstant")&&o.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(o=o.slice(),D=D.slice(),g=g.slice(),B=this.customShaderNameResolve(this.name,o,D,g,O,v));const A=k?h._getDrawWrapper(void 0,!0):this._drawWrapper,n=(null===A||void 0===A?void 0:A.effect)??null,d=(null===A||void 0===A?void 0:A.defines)??null,c=O.join("\n");let z=n;return d!==c&&(z=V.createEffect(B,{attributes:v,uniformsNames:o,uniformBuffersNames:D,samplers:g,defines:c,fallbacks:s,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:S},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},V),k?h.setEffect(z,c,this._materialContext):A&&A.setEffect(z,c),this._onEffectCreatedObservable&&(j.effect=z,j.subMesh=h??(null===E||void 0===E?void 0:E.wg[0])??null,this._onEffectCreatedObservable.notifyObservers(j))),A._wasPreviouslyUsingInstances=!!b,!((null===(a=z)||void 0===a||!a.isReady())??1)&&(n!==z&&G.resetCachedMaterial(),A._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(E,b){const h=this.va(),a=b??this.getEffect();a&&(-1!==this._options.uniforms.indexOf("world")&&a.setMatrix("world",E),-1!==this._options.uniforms.indexOf("worldView")&&(E.multiplyToRef(h.getViewMatrix(),this._cachedWorldViewMatrix),a.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(E.multiplyToRef(h.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),a.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==this._options.uniforms.indexOf("view")&&a.setMatrix("view",h.getViewMatrix()))}bindForSubMesh(E,b,h){var a;this.bind(E,b,null===(a=h._drawWrapperOverride)||void 0===a?void 0:a.effect,h)}bind(E,b,h,a){const k=a&&this._storeEffectOnSubMeshes,G=h??(k?a.effect:this.getEffect());if(!G)return;const V=this.va();this._activeEffect=G,this.bindOnlyWorldMatrix(E,h);const l=this._options.uniformBuffers;let O=!1;if(G&&l&&l.length>0&&V.getEngine().supportsUniformBuffers)for(let U=0;U<l.length;++U){switch(l[U]){case"Mesh":b&&(b.getMeshUniformBuffer().bindToEffect(G,"Mesh"),b.transferToEffect(E));break;case"Scene":(0,I.r)(G,V.getSceneUniformBuffer()),V.finalizeSceneUbo(),O=!0}}const v=b&&k?this._mustRebind(V,G,a,b.visibility):V.getCachedMaterial()!==this;if(G&&v){let E;for(E in O||-1===this._options.uniforms.indexOf("view")||G.setMatrix("view",V.getViewMatrix()),O||-1===this._options.uniforms.indexOf("projection")||G.setMatrix("projection",V.getProjectionMatrix()),O||-1===this._options.uniforms.indexOf("viewProjection")||(G.setMatrix("viewProjection",V.getTransformMatrix()),this._multiview&&G.setMatrix("viewProjectionR",V._transformMatrixR)),V.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&G.setVector3("cameraPosition",V.activeCamera.globalPosition),(0,I.e)(b,G),(0,M.f)(G,this,V),this._useLogarithmicDepth&&(0,I.m)(k?a.materialDefines:G.defines,G,V),b&&(0,I.f)(V,b,G),this._textures)G.setTexture(E,this._textures[E]);for(E in this._textureArrays)G.setTextureArray(E,this._textureArrays[E]);for(E in this._ints)G.setInt(E,this._ints[E]);for(E in this._uints)G.setUInt(E,this._uints[E]);for(E in this._floats)G.setFloat(E,this._floats[E]);for(E in this._floatsArrays)G.setArray(E,this._floatsArrays[E]);for(E in this._colors3)G.setColor3(E,this._colors3[E]);for(E in this._colors3Arrays)G.setArray3(E,this._colors3Arrays[E]);for(E in this._colors4){const b=this._colors4[E];G.setFloat4(E,b.r,b.g,b.b,b.a)}for(E in this._colors4Arrays)G.setArray4(E,this._colors4Arrays[E]);for(E in this._vectors2)G.setVector2(E,this._vectors2[E]);for(E in this._vectors3)G.setVector3(E,this._vectors3[E]);for(E in this._vectors4)G.setVector4(E,this._vectors4[E]);for(E in this._quaternions)G.setQuaternion(E,this._quaternions[E]);for(E in this._matrices)G.setMatrix(E,this._matrices[E]);for(E in this._matrixArrays)G.setMatrices(E,this._matrixArrays[E]);for(E in this._matrices3x3)G.setMatrix3x3(E,this._matrices3x3[E]);for(E in this._matrices2x2)G.setMatrix2x2(E,this._matrices2x2[E]);for(E in this._vectors2Arrays)G.setArray2(E,this._vectors2Arrays[E]);for(E in this._vectors3Arrays)G.setArray3(E,this._vectors3Arrays[E]);for(E in this._vectors4Arrays)G.setArray4(E,this._vectors4Arrays[E]);for(E in this._quaternionsArrays)G.setArray4(E,this._quaternionsArrays[E]);for(E in this._uniformBuffers){const b=this._uniformBuffers[E].getBuffer();b&&G.bindUniformBuffer(b,E)}const h=V.getEngine(),l=h.setExternalTexture;if(l)for(E in this._externalTextures)l.call(h,E,this._externalTextures[E]);const v=h.setTextureSampler;if(v)for(E in this._textureSamplers)v.call(h,E,this._textureSamplers[E]);const s=h.setStorageBuffer;if(s)for(E in this._storageBuffers)s.call(h,E,this._storageBuffers[E])}if(G&&b&&(v||!this.isFrozen)){const E=b.morphTargetManager;E&&E.numInfluencers>0&&(0,I.n)(b,G);const h=b.bakedVertexAnimationManager;if(h&&h.isEnabled){var s;const E=k?a._drawWrapper:this._drawWrapper;null===(s=b.bakedVertexAnimationManager)||void 0===s||s.bind(G,!!E._wasPreviouslyUsingInstances)}}this._afterBind(b,G,a)}getActiveTextures(){const E=super.getActiveTextures();for(const b in this._textures)E.push(this._textures[b]);for(const b in this._textureArrays){const h=this._textureArrays[b];for(let b=0;b<h.length;b++)E.push(h[b])}return E}hasTexture(E){if(super.hasTexture(E))return!0;for(const b in this._textures)if(this._textures[b]===E)return!0;for(const b in this._textureArrays){const h=this._textureArrays[b];for(let b=0;b<h.length;b++)if(h[b]===E)return!0}return!1}clone(E){const b=s.e.Clone((()=>new P(E,this.va(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);b.name=E,b.id=E,"object"===typeof b._shaderPath&&(b._shaderPath={...b._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach((E=>{const b=this._options[E];Array.isArray(b)&&(this._options[E]=b.slice(0))})),this.stencil.copyTo(b.stencil);for(const h in this._textures)b.setTexture(h,this._textures[h]);for(const h in this._textureArrays)b.setTextureArray(h,this._textureArrays[h]);for(const h in this._externalTextures)b.setExternalTexture(h,this._externalTextures[h]);for(const h in this._ints)b.setInt(h,this._ints[h]);for(const h in this._uints)b.setUInt(h,this._uints[h]);for(const h in this._floats)b.setFloat(h,this._floats[h]);for(const h in this._floatsArrays)b.setFloats(h,this._floatsArrays[h]);for(const h in this._colors3)b.setColor3(h,this._colors3[h]);for(const h in this._colors3Arrays)b._colors3Arrays[h]=this._colors3Arrays[h];for(const h in this._colors4)b.setColor4(h,this._colors4[h]);for(const h in this._colors4Arrays)b._colors4Arrays[h]=this._colors4Arrays[h];for(const h in this._vectors2)b.setVector2(h,this._vectors2[h]);for(const h in this._vectors3)b.setVector3(h,this._vectors3[h]);for(const h in this._vectors4)b.setVector4(h,this._vectors4[h]);for(const h in this._quaternions)b.setQuaternion(h,this._quaternions[h]);for(const h in this._quaternionsArrays)b._quaternionsArrays[h]=this._quaternionsArrays[h];for(const h in this._matrices)b.setMatrix(h,this._matrices[h]);for(const h in this._matrixArrays)b._matrixArrays[h]=this._matrixArrays[h].slice();for(const h in this._matrices3x3)b.setMatrix3x3(h,this._matrices3x3[h]);for(const h in this._matrices2x2)b.setMatrix2x2(h,this._matrices2x2[h]);for(const h in this._vectors2Arrays)b.setArray2(h,this._vectors2Arrays[h]);for(const h in this._vectors3Arrays)b.setArray3(h,this._vectors3Arrays[h]);for(const h in this._vectors4Arrays)b.setArray4(h,this._vectors4Arrays[h]);for(const h in this._uniformBuffers)b.setUniformBuffer(h,this._uniformBuffers[h]);for(const h in this._textureSamplers)b.setTextureSampler(h,this._textureSamplers[h]);for(const h in this._storageBuffers)b.setStorageBuffer(h,this._storageBuffers[h]);return b}dispose(E,b,h){if(b){let E;for(E in this._textures)this._textures[E].dispose();for(E in this._textureArrays){const b=this._textureArrays[E];for(let E=0;E<b.length;E++)b[E].dispose()}}this._textures={},super.dispose(E,b,h)}serialize(){const E=s.e.Serialize(this);let b;for(b in E.customType="BABYLON.ShaderMaterial",E.uniqueId=this.uniqueId,E.options=this._options,E.shaderPath=this._shaderPath,E.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,E.stencil=this.stencil.serialize(),E.textures={},this._textures)E.textures[b]=this._textures[b].serialize();for(b in E.textureArrays={},this._textureArrays){E.textureArrays[b]=[];const h=this._textureArrays[b];for(let a=0;a<h.length;a++)E.textureArrays[b].push(h[a].serialize())}for(b in E.ints={},this._ints)E.ints[b]=this._ints[b];for(b in E.uints={},this._uints)E.uints[b]=this._uints[b];for(b in E.floats={},this._floats)E.floats[b]=this._floats[b];for(b in E.floatsArrays={},this._floatsArrays)E.floatsArrays[b]=this._floatsArrays[b];for(b in E.colors3={},this._colors3)E.colors3[b]=this._colors3[b].qj();for(b in E.colors3Arrays={},this._colors3Arrays)E.colors3Arrays[b]=this._colors3Arrays[b];for(b in E.colors4={},this._colors4)E.colors4[b]=this._colors4[b].qj();for(b in E.colors4Arrays={},this._colors4Arrays)E.colors4Arrays[b]=this._colors4Arrays[b];for(b in E.vectors2={},this._vectors2)E.vectors2[b]=this._vectors2[b].qj();for(b in E.vectors3={},this._vectors3)E.vectors3[b]=this._vectors3[b].qj();for(b in E.vectors4={},this._vectors4)E.vectors4[b]=this._vectors4[b].qj();for(b in E.quaternions={},this._quaternions)E.quaternions[b]=this._quaternions[b].qj();for(b in E.matrices={},this._matrices)E.matrices[b]=this._matrices[b].qj();for(b in E.matrixArray={},this._matrixArrays)E.matrixArray[b]=this._matrixArrays[b];for(b in E.matrices3x3={},this._matrices3x3)E.matrices3x3[b]=this._matrices3x3[b];for(b in E.matrices2x2={},this._matrices2x2)E.matrices2x2[b]=this._matrices2x2[b];for(b in E.vectors2Arrays={},this._vectors2Arrays)E.vectors2Arrays[b]=this._vectors2Arrays[b];for(b in E.vectors3Arrays={},this._vectors3Arrays)E.vectors3Arrays[b]=this._vectors3Arrays[b];for(b in E.vectors4Arrays={},this._vectors4Arrays)E.vectors4Arrays[b]=this._vectors4Arrays[b];for(b in E.quaternionsArrays={},this._quaternionsArrays)E.quaternionsArrays[b]=this._quaternionsArrays[b];return E}static Parse(E,b,h){const k=s.e.Parse((()=>new P(E.name,b,E.shaderPath,E.options,E.storeEffectOnSubMeshes)),E,b,h);let G;for(G in E.stencil&&k.stencil.parse(E.stencil,b,h),E.textures)k.setTexture(G,B.b.Parse(E.textures[G],b,h));for(G in E.textureArrays){const a=E.textureArrays[G],V=[];for(let E=0;E<a.length;E++)V.push(B.b.Parse(a[E],b,h));k.setTextureArray(G,V)}for(G in E.ints)k.setInt(G,E.ints[G]);for(G in E.uints)k.setUInt(G,E.uints[G]);for(G in E.floats)k.setFloat(G,E.floats[G]);for(G in E.floatsArrays)k.setFloats(G,E.floatsArrays[G]);for(G in E.colors3)k.setColor3(G,V.b.jh(E.colors3[G]));for(G in E.colors3Arrays){const b=E.colors3Arrays[G].reduce(((E,b,h)=>(h%3===0?E.push([b]):E[E.length-1].push(b),E)),[]).map((E=>V.b.jh(E)));k.setColor3Array(G,b)}for(G in E.colors4)k.setColor4(G,V.f.jh(E.colors4[G]));for(G in E.colors4Arrays){const b=E.colors4Arrays[G].reduce(((E,b,h)=>(h%4===0?E.push([b]):E[E.length-1].push(b),E)),[]).map((E=>V.f.jh(E)));k.setColor4Array(G,b)}for(G in E.vectors2)k.setVector2(G,a.j.jh(E.vectors2[G]));for(G in E.vectors3)k.setVector3(G,a.k.jh(E.vectors3[G]));for(G in E.vectors4)k.setVector4(G,a.n.jh(E.vectors4[G]));for(G in E.quaternions)k.setQuaternion(G,a.g.jh(E.quaternions[G]));for(G in E.matrices)k.setMatrix(G,a.d.jh(E.matrices[G]));for(G in E.matrixArray)k._matrixArrays[G]=new Float32Array(E.matrixArray[G]);for(G in E.matrices3x3)k.setMatrix3x3(G,E.matrices3x3[G]);for(G in E.matrices2x2)k.setMatrix2x2(G,E.matrices2x2[G]);for(G in E.vectors2Arrays)k.setArray2(G,E.vectors2Arrays[G]);for(G in E.vectors3Arrays)k.setArray3(G,E.vectors3Arrays[G]);for(G in E.vectors4Arrays)k.setArray4(G,E.vectors4Arrays[G]);for(G in E.quaternionsArrays)k.setArray4(G,E.quaternionsArrays[G]);return k}static ParseFromFileAsync(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return new Promise(((k,G)=>{const V=new D.c;V.addEventListener("readystatechange",(()=>{if(4==V.readyState)if(200==V.status){const b=JSON.parse(V.responseText),G=this.Parse(b,h||S.b.LastCreatedScene,a);E&&(G.name=E),k(G)}else G("Unable to load the ShaderMaterial")})),V.open("GET",b),V.send()}))}static ParseFromSnippetAsync(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Promise(((a,k)=>{const G=new D.c;G.addEventListener("readystatechange",(()=>{if(4==G.readyState)if(200==G.status){const k=JSON.parse(JSON.parse(G.responseText).jsonPayload),V=JSON.parse(k.shaderMaterial),l=this.Parse(V,b||S.b.LastCreatedScene,h);l.snippetId=E,a(l)}else k("Unable to load the snippet "+E)})),G.open("GET",this.SnippetUrl+"/"+E.replace(/#/g,"/")),G.send()}))}}P.SnippetUrl="https://snippet.babylonjs.com",P.CreateFromSnippetAsync=P.ParseFromSnippetAsync,(0,o.f)("BABYLON.ShaderMaterial",P),k.b._LinesMeshParser=(E,b)=>A.Parse(E,b);class A extends k.b{_isShaderMaterial(E){return"ShaderMaterial"===E.getClassName()}constructor(E){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>5?arguments[5]:void 0,k=arguments.length>6?arguments[6]:void 0,G=arguments.length>7?arguments[7]:void 0;super(E,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,b,arguments.length>4?arguments[4]:void 0),this.useVertexColor=a,this.useVertexAlpha=k,this.color=new V.b(1,1,1),this.alpha=1,this._shaderLanguage=0,b&&(this.color=b.color.clone(),this.alpha=b.alpha,this.useVertexColor=b.useVertexColor,this.useVertexAlpha=b.useVertexAlpha),this.intersectionThreshold=.1;const O={attributes:[l.g.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(!1===k?O.needAlphaBlending=!1:O.defines.push("#define VERTEXALPHA"),a?(O.defines.push("#define VERTEXCOLOR"),O.attributes.push(l.g.ColorKind)):(O.uniforms.push("color"),this._color4=new V.f),G)this.material=G;else{this.va().getEngine().isWebGPU&&!A.ForceGLSL&&(this._shaderLanguage=1),O.shaderLanguage=this._shaderLanguage,O.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([h.e(23).then(h.bind(h,13456)),h.e(47).then(h.bind(h,13461))]):await Promise.all([h.e(28).then(h.bind(h,13468)),h.e(48).then(h.bind(h,13474))])},this.material=new P("colorShader",this.va(),"color",O,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(E){this._lineMaterial=E,this._lineMaterial.fillMode=v.c.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(E){}_bind(E,b){if(!this._geometry)return this;const h=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(b,h):this._geometry._bind(b,h,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:E,g:b,b:h}=this.color;this._color4.set(E,b,h,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(E,b,h){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const a=this.va().getEngine();return this._unIndexed?a.drawArraysType(v.c.LineListDrawMode,E.verticesStart,E.verticesCount,h):a.drawElementsType(v.c.LineListDrawMode,E.indexStart,E.indexCount,h),this}dispose(E){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(E)}clone(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2?arguments[2]:void 0;return new A(E,this.va(),b,this,h)}createInstance(E){const b=new n(E,this);if(this.instancedBuffers){b.instancedBuffers={};for(const E in this.instancedBuffers)b.instancedBuffers[E]=this.instancedBuffers[E]}return b}serialize(E){super.serialize(E),E.color=this.color.qj(),E.alpha=this.alpha}static Parse(E,b){const h=new A(E.name,b);return h.color=V.b.jh(E.color),h.alpha=E.alpha,h}}A.ForceGLSL=!1;class n extends O.b{constructor(E,b){super(E,b),this.intersectionThreshold=b.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}var d=h(10834);function c(E){const b=[],h=[],a=E.lines,k=E.za,V=[];let l=0;for(let G=0;G<a.length;G++){const E=a[G];for(let a=0;a<E.length;a++){const{x:O,y:v,z:s}=E[a];if(h.push(O,v,s),k){const E=k[G],{r:b,g:h,b:l,a:O}=E[a];V.push(b,h,l,O)}a>0&&(b.push(l-1),b.push(l)),l++}}const O=new G.c;return O.indices=b,O.xa=h,k&&(O.za=V),O}function z(E){const b=E.dashSize||3,h=E.gapSize||1,k=E.dashNb||200,V=E.points,l=[],O=[],v=a.k.Zero();let s=0,U=0,B=0,o=0,u=0,D=0,g=0;for(g=0;g<V.length-1;g++)V[g+1].subtractToRef(V[g],v),s+=v.length();for(B=s/k,o=b*B/(b+h),g=0;g<V.length-1;g++){V[g+1].subtractToRef(V[g],v),U=Math.floor(v.length()/B),v.normalize();for(let E=0;E<U;E++)u=B*E,l.push(V[g].x+u*v.x,V[g].y+u*v.y,V[g].z+u*v.z),l.push(V[g].x+(u+o)*v.x,V[g].y+(u+o)*v.y,V[g].z+(u+o)*v.z),O.push(D,D+1),D+=2}const S=new G.c;return S.xa=l,S.indices=O,S}function Z(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=b.instance,k=b.lines,G=b.za;if(a){const E=a.getVerticesData(l.g.PositionKind);let b,h;G&&(b=a.getVerticesData(l.g.ColorKind));let V=0,O=0;for(let a=0;a<k.length;a++){const l=k[a];for(let k=0;k<l.length;k++)E[V]=l[k].x,E[V+1]=l[k].y,E[V+2]=l[k].z,G&&b&&(h=G[a],b[O]=h[k].r,b[O+1]=h[k].g,b[O+2]=h[k].b,b[O+3]=h[k].a,O+=4),V+=3}return a.updateVerticesData(l.g.PositionKind,E,!1,!1),G&&b&&a.updateVerticesData(l.g.ColorKind,b,!1,!1),a.refreshBoundingInfo(),a}const V=new A(E,h,null,void 0,void 0,!!G,b.useVertexAlpha,b.material);return c(b).Ca(V,b.updatable),V}function Y(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=b.za?[b.za]:null;return Z(E,{lines:[b.points],updatable:b.updatable,instance:b.instance,za:a,useVertexAlpha:b.useVertexAlpha,material:b.material},h)}function r(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=b.points,V=b.instance,l=b.gapSize||1,O=b.dashSize||3;if(V){const E=E=>{const b=a.k.Zero(),h=E.length/6;let k=0,l=0,O=0,v=0,s=0,U=0,B=0,o=0;for(B=0;B<G.length-1;B++)G[B+1].subtractToRef(G[B],b),k+=b.length();O=k/h;const u=V._creationDataStorage.dashSize;for(v=u*O/(u+V._creationDataStorage.gapSize),B=0;B<G.length-1;B++)for(G[B+1].subtractToRef(G[B],b),l=Math.floor(b.length()/O),b.normalize(),o=0;o<l&&U<E.length;)s=O*o,E[U]=G[B].x+s*b.x,E[U+1]=G[B].y+s*b.y,E[U+2]=G[B].z+s*b.z,E[U+3]=G[B].x+(s+v)*b.x,E[U+4]=G[B].y+(s+v)*b.y,E[U+5]=G[B].z+(s+v)*b.z,U+=6,o++;for(;U<E.length;)E[U]=G[B].x,E[U+1]=G[B].y,E[U+2]=G[B].z,U+=3};return(b.dashNb||b.dashSize||b.gapSize||b.useVertexAlpha||b.material)&&d.c.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),V.updateMeshPositions(E,!1),V}const v=new A(E,h,null,void 0,void 0,void 0,b.useVertexAlpha,b.material);return z(b).Ca(v,b.updatable),v._creationDataStorage=new k.f,v._creationDataStorage.dashSize=O,v._creationDataStorage.gapSize=l,v}G.c.CreateLineSystem=c,G.c.CreateDashedLines=z,k.b.pb=function(E,b){return Y(E,{points:b,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},k.b.CreateDashedLines=function(E,b,h,a,k){return r(E,{points:b,dashSize:h,gapSize:a,dashNb:k,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},11542:(E,b,h)=>{"use strict";h.d(b,{b:()=>l,c:()=>O});var a=h(11419),k=h(11435),G=h(11389);function V(E){const b=[],h=[],a=[],V=[],l=E.width||E.size||1,O=E.height||E.size||1,v=0===E.sideOrientation?0:E.sideOrientation||k.c.DEFAULTSIDE,s=l/2,U=O/2;h.push(-s,-U,0),a.push(0,0,-1),V.push(0,G.c?1:0),h.push(s,-U,0),a.push(0,0,-1),V.push(1,G.c?1:0),h.push(s,U,0),a.push(0,0,-1),V.push(1,G.c?0:1),h.push(-s,U,0),a.push(0,0,-1),V.push(0,G.c?0:1),b.push(0),b.push(1),b.push(2),b.push(0),b.push(2),b.push(3),k.c._ComputeSides(v,h,b,a,V,E.frontUVs,E.backUVs);const B=new k.c;return B.indices=b,B.xa=h,B.ya=a,B.Aa=V,B}function l(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=new a.b(E,h);b.sideOrientation=a.b._GetDefaultSideOrientation(b.sideOrientation),k._originalBuilderSideOrientation=b.sideOrientation;return V(b).Ca(k,b.updatable),b.sourcePlane&&(k.translate(b.sourcePlane.k,-b.sourcePlane.d),k.setDirection(b.sourcePlane.k.scale(-1))),k}const O={Ag:l};k.c.Ag=V,a.b.Ag=(E,b,h,a,k)=>l(E,{size:b,width:b,height:b,sideOrientation:k,updatable:a},h)},11812:(E,b,h)=>{"use strict";h.d(b,{e:()=>O});var a=h(11175),k=h(11419),G=h(11435),V=h(11389);function l(E){const b=0|(E.segments||32),h=E.diameterX||E.diameter||1,k=E.diameterY||E.diameter||1,l=E.diameterZ||E.diameter||1,O=E.arc&&(E.arc<=0||E.arc>1)?1:E.arc||1,v=E.slice&&E.slice<=0?1:E.slice||1,s=0===E.sideOrientation?0:E.sideOrientation||G.c.DEFAULTSIDE,U=!!E.dedupTopBottomIndices,B=new a.k(h/2,k/2,l/2),o=2+b,u=2*o,D=[],g=[],S=[],M=[];for(let G=0;G<=o;G++){const E=G/o,b=E*Math.PI*v;for(let h=0;h<=u;h++){const k=h/u,G=k*Math.PI*2*O,l=a.d.RotationZ(-b),v=a.d.RotationY(G),s=a.k.TransformCoordinates(a.k.Up(),l),U=a.k.TransformCoordinates(s,v),o=U.multiply(B),D=U.divide(B).normalize();g.push(o.x,o.y,o.z),S.push(D.x,D.y,D.z),M.push(k,V.c?1-E:E)}if(G>0){const E=g.length/3;for(let b=E-2*(u+1);b+u+2<E;b++)U?(G>1&&(D.push(b),D.push(b+1),D.push(b+u+1)),(G<o||v<1)&&(D.push(b+u+1),D.push(b+1),D.push(b+u+2))):(D.push(b),D.push(b+1),D.push(b+u+1),D.push(b+u+1),D.push(b+1),D.push(b+u+2))}}G.c._ComputeSides(s,g,D,S,M,E.frontUVs,E.backUVs);const I=new G.c;return I.indices=D,I.xa=g,I.ya=S,I.Aa=M,I}function O(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=new k.b(E,h);b.sideOrientation=k.b._GetDefaultSideOrientation(b.sideOrientation),a._originalBuilderSideOrientation=b.sideOrientation;return l(b).Ca(a,b.updatable),a}G.c.CreateSphere=l,k.b.CreateSphere=(E,b,h,a,k,G)=>O(E,{segments:b,diameterX:h,diameterY:h,diameterZ:h,sideOrientation:G,updatable:k},a)},12217:(E,b,h)=>{"use strict";h.d(b,{e:()=>U});var a=h(10821),k=h(12223),G=h(11442),V=h(11233),l=h(11435),O=h(10834);function v(E,b,h,a,k){let G=null,V=null,l=null;try{let O;G=new E.Decoder,V=new E.DecoderBuffer,V.Init(b,b.byteLength);const v=G.GetEncodedGeometryType(V);switch(v){case E.TRIANGULAR_MESH:{const b=new E.Mesh;if(O=G.DecodeBufferToMesh(V,b),!O.ok()||0===b.ptr)throw new Error(O.error_msg());const h=3*b.num_faces(),k=4*h,v=E._malloc(k);try{G.GetTrianglesUInt32Array(b,k,v);const V=new Uint32Array(h);V.set(new Uint32Array(E.HEAPF32.buffer,v,h)),a(V)}finally{E._free(v)}l=b;break}case E.POINT_CLOUD:{const b=new E.PointCloud;if(O=G.DecodeBufferToPointCloud(V,b),!O.ok()||!b.ptr)throw new Error(O.error_msg());l=b;break}default:throw new Error(`Invalid geometry type ${v}`)}const s=l.num_points(),U=(b,h,a,G)=>{const V=G.data_type(),l=G.num_components(),O=G.normalized(),v=G.byte_stride(),U=G.byte_offset(),B={[E.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:E.HEAPF32},[E.DT_INT8]:{typedArrayConstructor:Int8Array,heap:E.HEAP8},[E.DT_INT16]:{typedArrayConstructor:Int16Array,heap:E.HEAP16},[E.DT_INT32]:{typedArrayConstructor:Int32Array,heap:E.HEAP32},[E.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:E.HEAPU8},[E.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:E.HEAPU16},[E.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:E.HEAPU32}}[V];if(!B)throw new Error(`Invalid data type ${V}`);const o=s*l,u=o*B.typedArrayConstructor.BYTES_PER_ELEMENT,D=E._malloc(u);try{b.GetAttributeDataArrayForAllPoints(h,G,V,u,D);const E=new B.typedArrayConstructor(B.heap.buffer,D,o);k(a,E.slice(),l,U,v,O)}finally{E._free(D)}};if(h)for(const E in h){const b=h[E],a=G.GetAttributeByUniqueId(l,b);U(G,l,E,a)}else{const b={position:E.POSITION,k:E.NORMAL,color:E.COLOR,uv:E.TEX_COORD};for(const E in b){const h=G.GetAttributeId(l,b[E]);if(-1!==h){const b=G.GetAttribute(l,h);U(G,l,E,b)}}}return s}finally{l&&E.destroy(l),V&&E.destroy(V),G&&E.destroy(G)}}function s(){let E;onmessage=b=>{const h=b.data;switch(h.id){case"init":{const b=h.decoder;b.url&&importScripts(b.url);const a=b.wasmBinary?{wasmBinary:b.wasmBinary}:{};E=DracoDecoderModule(a),postMessage({id:"initDone"});break}case"decodeMesh":if(!E)throw new Error("Draco decoder module is not available");E.then((E=>{const b=v(E,h.dataView,h.attributes,(E=>{postMessage({id:"indices",data:E},[E.buffer])}),((E,b,h,a,k,G)=>{postMessage({id:"attribute",kind:E,data:b,size:h,byteOffset:a,byteStride:k,normalized:G},[b.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:b})}))}}}class U{static get DecoderAvailable(){const E=U.Configuration.decoder;return!!(E.wasmUrl&&E.wasmBinaryUrl&&"object"===typeof WebAssembly||E.fallbackUrl)}static GetDefaultNumWorkers(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static get Default(){return U._Default||(U._Default=new U),U._Default}static ResetDefault(E){U._Default&&(E||U._Default.dispose(),U._Default=null)}constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U.DefaultNumWorkers;const b=U.Configuration.decoder;if(b.workerPool||"object"===typeof E&&E.workerPool)this._workerPoolPromise=Promise.resolve(b.workerPool||E.workerPool);else{const h=b.wasmBinary||"object"===typeof E&&E.wasmBinary,G="number"===typeof E?E:E.numWorkers,V=G&&"function"===typeof Worker&&"function"===typeof URL,l=V||!V&&!b.jsModule,O=b.wasmUrl&&b.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:l?a.g.GetBabylonScriptURL(b.wasmUrl,!0):"",wasmBinaryPromise:h?Promise.resolve(h):a.g.LoadFileAsync(a.g.GetBabylonScriptURL(b.wasmBinaryUrl,!0))}:{url:l?a.g.GetBabylonScriptURL(b.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};V?this._workerPoolPromise=O.wasmBinaryPromise.then((E=>{const b=`${v}(${s})()`,h=URL.createObjectURL(new Blob([b],{type:"application/javascript"}));return new k.c(G,(()=>function(E,b,h){return new Promise(((a,k)=>{const G=b=>{E.removeEventListener("error",G),E.removeEventListener("message",V),k(b)},V=b=>{"initDone"===b.data.id&&(E.removeEventListener("error",G),E.removeEventListener("message",V),a(E))};if(E.addEventListener("error",G),E.addEventListener("message",V),b){const a=b.slice(0);E.postMessage({id:"init",decoder:{url:h,wasmBinary:a}},[a])}else E.postMessage({id:"init",decoder:{url:h}})}))}(new Worker(h),E,O.url)))})):this._decoderModulePromise=O.wasmBinaryPromise.then((async E=>{if("undefined"===typeof DracoDecoderModule&&!b.jsModule){if(!O.url)throw new Error("Draco decoder module is not available");await a.g.LoadBabylonScriptAsync(O.url)}return await(h=E,k=b.jsModule,new Promise((E=>{(k||DracoDecoderModule)({wasmBinary:h}).then((b=>{E({module:b})}))})));var h,k}))}}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((E=>{E.dispose()})),delete this._workerPoolPromise,delete this._decoderModulePromise}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._decoderModulePromise&&await this._decoderModulePromise}decodeMeshToMeshDataAsync(E,b,h){const a=E instanceof ArrayBuffer?new Int8Array(E):new Int8Array(E.buffer,E.byteOffset,E.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((E=>new Promise(((k,G)=>{E.push(((E,V)=>{let l=null;const v=[],s=b=>{E.removeEventListener("error",s),E.removeEventListener("message",U),G(b),V()},U=b=>{const a=b.data;switch(a.id){case"decodeMeshDone":E.removeEventListener("error",s),E.removeEventListener("message",U),k({indices:l,attributes:v,totalVertices:a.totalVertices}),V();break;case"indices":l=a.data;break;case"attribute":v.push({kind:a.kind,data:a.data,size:a.size,byteOffset:a.byteOffset,byteStride:a.byteStride,normalized:(G=a.kind,B=a.normalized,h&&void 0!==h[G]?(B!==h[G]&&O.c.Warn(`Normalized flag from Draco data (${B}) does not match normalized flag from glTF accessor (${h[G]}). Using flag from glTF accessor.`),h[G]):B)})}var G,B};E.addEventListener("error",s),E.addEventListener("message",U);const B=a.slice();E.postMessage({id:"decodeMesh",dataView:B,attributes:b},[B.buffer])}))}))));if(this._decoderModulePromise)return this._decoderModulePromise.then((E=>{let h=null;const k=[],G=v(E.module,a,b,(E=>{h=E}),((E,b,h,a,G,V)=>{k.push({kind:E,data:b,size:h,byteOffset:a,byteStride:G,normalized:V})}));return{indices:h,attributes:k,totalVertices:G}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(E,b,h,a){const k=await this.decodeMeshToMeshDataAsync(h,a),l=new G.e(E,b);k.indices&&l.setIndices(k.indices);for(const G of k.attributes)l.setVerticesBuffer(new V.g(b.getEngine(),G.data,G.kind,!1,void 0,G.byteStride,void 0,G.byteOffset,G.size,void 0,G.normalized,!0),k.totalVertices);return l}async _decodeMeshToGeometryForGltfAsync(E,b,h,a,k){const l=await this.decodeMeshToMeshDataAsync(h,a,k),O=new G.e(E,b);l.indices&&O.setIndices(l.indices);for(const G of l.attributes)O.setVerticesBuffer(new V.g(b.getEngine(),G.data,G.kind,!1,void 0,G.byteStride,void 0,G.byteOffset,G.size,void 0,G.normalized,!0),l.totalVertices);return O}async decodeMeshAsync(E,b){const h=await this.decodeMeshToMeshDataAsync(E,b),a=new l.c;h.indices&&(a.indices=h.indices);for(const k of h.attributes){const E=V.g.GetFloatData(k.data,k.size,V.g.GetDataType(k.data),k.byteOffset,k.byteStride,k.normalized,h.totalVertices);a.set(E,k.kind)}return a}}U.Configuration={decoder:{wasmUrl:`${a.g._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${a.g._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${a.g._DefaultCdnUrl}/draco_decoder_gltf.js`}},U.DefaultNumWorkers=U.GetDefaultNumWorkers(),U._Default=null},11612:(E,b,h)=>{"use strict";h.d(b,{c:()=>k});var a=h(11240);class k extends a.d{constructor(E){super(),this._buffer=E}get underlyingResource(){return this._buffer}}},11456:(E,b,h)=>{"use strict";h.d(b,{b:()=>n});var a=h(11130),k=h(10824),G=h(11175),V=h(11233),l=h(11435),O=h(11461),v=h(11231),s=h(11325),U=h(11224);class B{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new G.k(0,0,0),this._diffPositionForCollisions=new G.k(0,0,0),this._collisionResponse=!0}}var o=h(10855),u=h(11343),D=h(11201),g=h(11177),S=h(11466),M=h(10958),I=h(11139),j=h(10902);class P{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=G.k.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class A{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new P,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new B,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class n extends O.c{static get BILLBOARDMODE_NONE(){return O.c.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return O.c.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return O.c.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return O.c.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return O.c.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return O.c.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(E){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=E}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(E){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=E}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(E){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=E}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(E){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=E}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(E){this._internalAbstractMeshDataInfo._collisionRetryCount=E}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(E){this._internalAbstractMeshDataInfo._morphTargetManager!==E&&(this._internalAbstractMeshDataInfo._morphTargetManager=E,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(E){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==E&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=E,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(E){return!!super._updateNonUniformScalingState(E)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(E){this._internalAbstractMeshDataInfo._rawBoundingInfo=E}set Qk(E){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(E)}set onCollisionPositionChange(E){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(E)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(E){if(this._internalAbstractMeshDataInfo._visibility===E)return;const b=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=E,(1===b&&1!==E||1!==b&&1===E)&&this._markSubMeshesAsDirty((E=>{E.markAsMiscDirty(),E.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(E){this._internalAbstractMeshDataInfo._inheritVisibility=E}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let E=this._parentNode;for(;E;){const b=E.isVisible;if("undefined"!==typeof b)return b;E=E.parent}}return this._isVisible}set isVisible(E){this._isVisible=E}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(E){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=E}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(E){this._internalAbstractMeshDataInfo._renderingGroupId=E}get material(){return this._internalAbstractMeshDataInfo._material}set material(E){this._setMaterial(E)}_setMaterial(E){this._internalAbstractMeshDataInfo._material!==E&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=E,E&&E.meshMap&&(E.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.wg&&(this.resetDrawCache(),this._unBindEffect()))}getMaterialForRenderPass(E){var b;return null===(b=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===b?void 0:b[E]}setMaterialForRenderPass(E,b){this.resetDrawCache(E),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[E]=b}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(E){this._internalAbstractMeshDataInfo._receiveShadows!==E&&(this._internalAbstractMeshDataInfo._receiveShadows=E,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(E){this._internalAbstractMeshDataInfo._hasVertexAlpha!==E&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=E,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(E){this._internalAbstractMeshDataInfo._useVertexColors!==E&&(this._internalAbstractMeshDataInfo._useVertexColors=E,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(E){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==E&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=E,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(E){this._internalAbstractMeshDataInfo._numBoneInfluencers!==E&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=E,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(E){this._internalAbstractMeshDataInfo._applyFog!==E&&(this._internalAbstractMeshDataInfo._applyFog=E,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(E){this._internalAbstractMeshDataInfo._enableDistantPicking=E}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(E){E!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=E,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(E){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(E)?-1:E}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(E){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=E}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(E){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(E)?-1:E}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(E){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=E}get lightSources(){return this._lightSources}set skeleton(E){const b=this._internalAbstractMeshDataInfo._skeleton;b&&b.needInitialSkinMatrix&&b._unregisterMeshWithPoseMatrix(this),E&&E.needInitialSkinMatrix&&E._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=E,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(E){var b;let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(E,h,!1),b=this,this._internalAbstractMeshDataInfo=new A,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.Li=n.Mi,this.onCollideObservable=new k.e,this.onCollisionPositionChangeObservable=new k.e,this.onMaterialChangedObservable=new k.e,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.zb=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=D.b.Red(),this.outlineWidth=.02,this.overlayColor=D.b.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.ub=!1,this.Da=!1,this.actionManager=null,this.ellipsoid=new G.k(.5,1,.5),this.ellipsoidOffset=new G.k(0,0,0),this.edgesWidth=1,this.edgesColor=new D.f(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,oc:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new k.e,this._onCollisionPositionChange=function(E,h){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;h.subtractToRef(b._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,b._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),b._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>j.d.CollisionsEpsilon&&b.position.addInPlace(b._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),a&&b.onCollideObservable.notifyObservers(a),b.onCollisionPositionChangeObservable.notifyObservers(b.position)},h=this.va(),h.ti(this),this._resyncLightSources(),this._uniformBuffer=new U.d(this.va().getEngine(),void 0,void 0,E,!this.va().getEngine().isWebGPU),this._buildUniformLayout(),h.performancePriority){case 2:this.Da=!0;case 1:this.ub=!0,this.zb=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(E){const b=this._uniformBuffer;b.Pj("world",E),b.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),b.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(E){let b="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");b+=", # of submeshes: "+(this.wg?this.wg.length:0);const h=this._internalAbstractMeshDataInfo._skeleton;return h&&(b+=", skeleton: "+h.name),E&&(b+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],b+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.oc?"YES":"NO")),b}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==O.c.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(b||this.actionManager.isRecursive)){if(!E)return this.actionManager;if(this.actionManager.hasSpecificTrigger(E))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(E,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.wg){for(const E of this.wg)E._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const E of this.va().lights)E.isEnabled()&&E.canAffectMesh(this)&&this._lightSources.push(E);this._markSubMeshesAsLightDirty()}_resyncLightSource(E){const b=E.isEnabled()&&E.canAffectMesh(this),h=this._lightSources.indexOf(E);let a=!1;if(-1===h){if(!b)return;this._lightSources.push(E)}else{if(b)return;a=!0,this._lightSources.splice(h,1)}this._markSubMeshesAsLightDirty(a)}_unBindEffect(){for(const E of this.wg)E.setEffect(null)}_removeLightSource(E,b){const h=this._lightSources.indexOf(E);-1!==h&&(this._lightSources.splice(h,1),this._markSubMeshesAsLightDirty(b))}_markSubMeshesAsDirty(E){if(this.wg)for(const b of this.wg)for(let h=0;h<b._drawWrappers.length;++h){const a=b._drawWrappers[h];a&&a.defines&&a.defines.markAllAsDirty&&E(a.defines)}}_markSubMeshesAsLightDirty(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((b=>b.markAsLightDirty(E)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((E=>E.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((E=>E.markAsMiscDirty()))}ah(E){return this._currentRenderId=Number.MAX_VALUE,super.ah(E),this._isDirty=!0,this}resetDrawCache(E){if(this.wg)for(const b of this.wg)b.resetDrawCache(E)}get isBlocked(){return!1}getLOD(E){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}rg(){return null}getVerticesData(E){return null}Ga(E,b,h,a){return this}updateVerticesData(E,b,h,a){return this}setIndices(E,b){return this}isVerticesDataPresent(E){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.Ea()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(E){return this._boundingInfo=E,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(E,b,h){return this._boundingInfo=new s.b(E,b,h),this._boundingInfo}normalizeToUnitCube(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(E,b,h)}get useBones(){return this.skeleton&&this.va().skeletonsEnabled&&this.isVerticesDataPresent(V.g.MatricesIndicesKind)&&this.isVerticesDataPresent(V.g.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(E){}_activate(E,b){return this._renderId=E,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===O.c.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(E,b,h){return this.position.addInPlace(this.calcMovePOV(E,b,h)),this}calcMovePOV(E,b,h){const a=new G.d;(this.rotationQuaternion?this.rotationQuaternion:G.g.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(a);const k=G.k.Zero(),V=this.definedFacingForward?-1:1;return G.k.TransformCoordinatesFromFloatsToRef(E*V,b,h*V,a,k),k}rotatePOV(E,b,h){return this.rotation.addInPlace(this.calcRotatePOV(E,b,h)),this}calcRotatePOV(E,b,h){const a=this.definedFacingForward?1:-1;return new G.k(E*a,b,h*a)}Fa(E,b){if(E){const h=(0,u.d)(E,0,this.getTotalVertices(),b);this._boundingInfo?this._boundingInfo.reConstruct(h.minimum,h.maximum):this._boundingInfo=new s.b(h.minimum,h.maximum)}if(this.wg)for(let h=0;h<this.wg.length;h++)this.wg[h].refreshBoundingInfo(E);this.Ea()}_refreshBoundingInfoDirect(E){if(this._boundingInfo?this._boundingInfo.reConstruct(E.minimum,E.maximum):this._boundingInfo=new s.b(E.minimum,E.maximum),this.wg)for(let b=0;b<this.wg.length;b++)this.wg[b].refreshBoundingInfo(null);this.Ea()}static _ApplySkeleton(E,b,h,a,k,l,O){!function(E,b,h,a,k,l,O){const v=G.h.o[0],s=G.h.Matrix[0],U=G.h.Matrix[1],B=b===V.g.NormalKind?G.k.TransformNormalFromFloatsToRef:G.k.TransformCoordinatesFromFloatsToRef;for(let V=0,o=0;V<E.length;V+=3,o+=4){let b,u;for(s.reset(),b=0;b<4;b++)u=k[o+b],u>0&&(G.d.FromFloat32ArrayToRefScaled(h,Math.floor(16*a[o+b]),u,U),s.addToSelf(U));if(l&&O)for(b=0;b<4;b++)u=O[o+b],u>0&&(G.d.FromFloat32ArrayToRefScaled(h,Math.floor(16*l[o+b]),u,U),s.addToSelf(U));B(E[V],E[V+1],E[V+2],s,v),v.toArray(E,V)}}(E,b,h,a,k,l,O)}_getData(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:V.g.PositionKind;const a=E.cache,k=E=>{if(a){const b=a._vertexData||(a._vertexData={});return b[E]||this.copyVerticesData(E,b),b[E]}return this.getVerticesData(E)};if(b||(b=k(h)),!b)return null;if(a?(a._outputData?a._outputData.set(b):a._outputData=new Float32Array(b),b=a._outputData):(E.applyMorph&&this.morphTargetManager||E.applySkeleton&&this.skeleton)&&(b=b.slice()),E.applyMorph&&this.morphTargetManager&&function(E,b,h){let a=null;switch(b){case V.g.PositionKind:a=E=>E.getPositions();break;case V.g.NormalKind:a=E=>E.getNormals();break;case V.g.TangentKind:a=E=>E.getTangents();break;case V.g.UVKind:a=E=>E.getUVs();break;default:return}for(let k=0;k<E.length;k++){let b=E[k];for(let G=0;G<h.numTargets;G++){const V=h.getTarget(G),l=V.influence;if(0!==l){const h=a(V);h&&(b+=(h[k]-E[k])*l)}}E[k]=b}}(b,h,this.morphTargetManager),E.applySkeleton&&this.skeleton){const E=k(V.g.MatricesIndicesKind),a=k(V.g.MatricesWeightsKind);if(a&&E){const G=this.numBoneInfluencers>4,l=G?k(V.g.MatricesIndicesExtraKind):null,O=G?k(V.g.MatricesWeightsExtraKind):null,v=this.skeleton.getTransformMatrices(this);n._ApplySkeleton(b,h,v,E,a,l,O)}}if(!1!==E.updatePositionsArray&&h===V.g.PositionKind){const E=this._internalAbstractMeshDataInfo._positions||[],h=E.length;if(E.length=b.length/3,h<E.length)for(let b=h;b<E.length;b++)E[b]=new G.k;for(let a=0,k=0;a<E.length;a++,k+=3)E[a].ue(b[k],b[k+1],b[k+2]);this._internalAbstractMeshDataInfo._positions=E}return b}getNormalsData(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:E,applyMorph:b,updatePositionsArray:!1},null,V.g.NormalKind)}de(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:E,applyMorph:b,updatePositionsArray:!1},h,V.g.PositionKind)}Ea(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new s.b(G.k.Zero(),G.k.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(E){if(!this.wg)return this;const b=this.wg.length;for(let h=0;h<b;h++){const a=this.wg[h];(b>1||!a.IsGlobal)&&a.updateBoundingInfo(E)}return this}_afterComputeWorldMatrix(){this.Da||(this._boundingInfoIsDirty=!0)}isInFrustum(E){return this.getBoundingInfo().isInFrustum(E,this.Li)}isCompletelyInFrustum(E){return this.getBoundingInfo().isCompletelyInFrustum(E)}intersectsMesh(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2?arguments[2]:void 0;const a=this.getBoundingInfo(),k=E.getBoundingInfo();if(a.intersects(k,b))return!0;if(h)for(const G of this.getChildMeshes())if(G.intersectsMesh(E,b,!0))return!0;return!1}intersectsPoint(E){return this.getBoundingInfo().intersectsPoint(E)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(E){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=E}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(E){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const b=this.va().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=b.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,b.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,E,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}_collideForSubMesh(E,b,h){var a;if(this._generatePointsArray(),!this._positions)return this;if(!E._lastColliderWorldVertices||!E._lastColliderTransformMatrix.equals(b)){E._lastColliderTransformMatrix=b.clone(),E._lastColliderWorldVertices=[],E._trianglePlanes=[];const h=E.verticesStart,a=E.verticesStart+E.verticesCount;for(let k=h;k<a;k++)E._lastColliderWorldVertices.push(G.k.TransformCoordinates(this._positions[k],b))}return h._collide(E._trianglePlanes,E._lastColliderWorldVertices,this.rg(),E.indexStart,E.indexStart+E.indexCount,E.verticesStart,!!E.Ha(),this,this._shouldConvertRHS(),7===(null===(a=E.Ha())||void 0===a?void 0:a.fillMode)),this}_processCollisionsForSubMeshes(E,b){const h=this._scene.getCollidingSubMeshCandidates(this,E),a=h.length;for(let k=0;k<a;k++){const G=h.data[k];a>1&&!G._checkCollision(E)||this._collideForSubMesh(G,b,E)}return this}_shouldConvertRHS(){return!1}_checkCollision(E){if(!this.getBoundingInfo()._checkCollision(E))return this;const b=G.h.Matrix[0],h=G.h.Matrix[1];return G.d.ScalingToRef(1/E._radius.x,1/E._radius.y,1/E._radius.z,b),this.worldMatrixFromCache.multiplyToRef(b,h),this._processCollisionsForSubMeshes(E,h),this}_generatePointsArray(){return!1}intersects(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4?arguments[4]:void 0,V=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const l=new v.d,O=this.getClassName(),s="InstancedLinesMesh"===O||"LinesMesh"===O||"GreasedLineMesh"===O?this.intersectionThreshold:0,U=this.getBoundingInfo();if(!this.wg)return l;if(!V&&(!E.intersectsSphere(U.boundingSphere,s)||!E.intersectsBox(U.boundingBox,s)))return l;if(a)return l.hit=!V,l.pickedMesh=V?null:this,l.distance=V?0:G.k.Distance(E.origin,U.boundingSphere.center),l.subMeshId=0,l;if(!this._generatePointsArray())return l;let B=null;const o=this._scene.getIntersectingSubMeshCandidates(this,E),u=o.length;let D=!1;for(let G=0;G<u;G++){const E=o.data[G].Ha();if(E&&(7==E.fillMode||0==E.fillMode||1==E.fillMode||2==E.fillMode||4==E.fillMode)){D=!0;break}}if(!D)return l.hit=!0,l.pickedMesh=this,l.distance=G.k.Distance(E.origin,U.boundingSphere.center),l.subMeshId=-1,l;for(let G=0;G<u;G++){const a=o.data[G];if(u>1&&!V&&!a.canIntersects(E))continue;const k=a.intersects(E,this._positions,this.rg(),b,h);if(k&&(b||!B||k.distance<B.distance)&&(B=k,B.subMeshId=G,b))break}if(B){const b=k??this.getWorldMatrix(),h=G.h.o[0],a=G.h.o[1];G.k.TransformCoordinatesToRef(E.origin,b,h),E.direction.scaleToRef(B.distance,a);const V=G.k.TransformNormal(a,b).addInPlace(h);return l.hit=!0,l.distance=G.k.Distance(h,V),l.pickedPoint=V,l.pickedMesh=this,l.bu=B.bu||0,l.bv=B.bv||0,l.subMeshFaceId=B.faceId,l.faceId=B.faceId+o.data[B.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),l.subMeshId=B.subMeshId,l}return l}clone(E,b,h){return null}releaseSubMeshes(){if(this.wg)for(;this.wg.length;)this.wg[0].dispose();else this.wg=[];return this}dispose(E){let b,h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const a=this.va();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),a.freeActiveMeshes(),a.freeRenderingGroups(),a.renderingManager.maintainStateBetweenFrames&&a.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((E=>E!==this&&E.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),b=0;b<this._intersectionsInProgress.length;b++){const E=this._intersectionsInProgress[b],h=E._intersectionsInProgress.indexOf(this);E._intersectionsInProgress.splice(h,1)}this._intersectionsInProgress.length=0;a.lights.forEach((E=>{let b=E.includedOnlyMeshes.indexOf(this);-1!==b&&E.includedOnlyMeshes.splice(b,1),b=E.excludedMeshes.indexOf(this),-1!==b&&E.excludedMeshes.splice(b,1);const h=E.getShadowGenerators();if(h){const E=h.values();for(let h=E.next();!0!==h.done;h=E.next()){const E=h.value.getShadowMap();E&&E.renderList&&(b=E.renderList.indexOf(this),-1!==b&&E.renderList.splice(b,1))}}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();const k=a.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,k.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),k.wipeCaches(),a.Wd(this),this._parentContainer){const E=this._parentContainer.meshes.indexOf(this);E>-1&&this._parentContainer.meshes.splice(E,1),this._parentContainer=null}if(h&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!E)for(b=0;b<a.yj.length;b++)a.yj[b].j===this&&(a.yj[b].dispose(),b--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(E,h)}_initFacetData(){const E=this._internalAbstractMeshDataInfo._facetData;E.facetNormals||(E.facetNormals=[]),E.facetPositions||(E.facetPositions=[]),E.facetPartitioning||(E.facetPartitioning=new Array),E.facetNb=this.rg().length/3|0,E.partitioningSubdivisions=E.partitioningSubdivisions?E.partitioningSubdivisions:10,E.partitioningBBoxRatio=E.partitioningBBoxRatio?E.partitioningBBoxRatio:1.01;for(let b=0;b<E.facetNb;b++)E.facetNormals[b]=G.k.Zero(),E.facetPositions[b]=G.k.Zero();return E.facetDataEnabled=!0,this}updateFacetData(){const E=this._internalAbstractMeshDataInfo._facetData;E.facetDataEnabled||this._initFacetData();const b=this.getVerticesData(V.g.PositionKind),h=this.rg(),a=this.getVerticesData(V.g.NormalKind),k=this.getBoundingInfo();if(E.facetDepthSort&&!E.facetDepthSortEnabled){if(E.facetDepthSortEnabled=!0,h instanceof Uint16Array)E.depthSortedIndices=new Uint16Array(h);else if(h instanceof Uint32Array)E.depthSortedIndices=new Uint32Array(h);else{let b=!1;for(let E=0;E<h.length;E++)if(h[E]>65535){b=!0;break}E.depthSortedIndices=b?new Uint32Array(h):new Uint16Array(h)}if(E.facetDepthSortFunction=function(E,b){return b.sqDistance-E.sqDistance},!E.facetDepthSortFrom){const b=this.va().activeCamera;E.facetDepthSortFrom=b?b.position:G.k.Zero()}E.depthSortedFacets=[];for(let b=0;b<E.facetNb;b++){const h={ind:3*b,sqDistance:0};E.depthSortedFacets.push(h)}E.invertedMatrix=G.d.Identity(),E.facetDepthSortOrigin=G.k.Zero()}E.bbSize.x=k.maximum.x-k.minimum.x>g.d?k.maximum.x-k.minimum.x:g.d,E.bbSize.y=k.maximum.y-k.minimum.y>g.d?k.maximum.y-k.minimum.y:g.d,E.bbSize.z=k.maximum.z-k.minimum.z>g.d?k.maximum.z-k.minimum.z:g.d;let O=E.bbSize.x>E.bbSize.y?E.bbSize.x:E.bbSize.y;if(O=O>E.bbSize.z?O:E.bbSize.z,E.subDiv.max=E.partitioningSubdivisions,E.subDiv.X=Math.floor(E.subDiv.max*E.bbSize.x/O),E.subDiv.Y=Math.floor(E.subDiv.max*E.bbSize.y/O),E.subDiv.Z=Math.floor(E.subDiv.max*E.bbSize.z/O),E.subDiv.X=E.subDiv.X<1?1:E.subDiv.X,E.subDiv.Y=E.subDiv.Y<1?1:E.subDiv.Y,E.subDiv.Z=E.subDiv.Z<1?1:E.subDiv.Z,E.facetParameters.facetNormals=this.getFacetLocalNormals(),E.facetParameters.facetPositions=this.getFacetLocalPositions(),E.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),E.facetParameters.bInfo=k,E.facetParameters.bbSize=E.bbSize,E.facetParameters.subDiv=E.subDiv,E.facetParameters.ratio=this.partitioningBBoxRatio,E.facetParameters.depthSort=E.facetDepthSort,E.facetDepthSort&&E.facetDepthSortEnabled&&(this.Wj(!0),this._worldMatrix.invertToRef(E.invertedMatrix),G.k.TransformCoordinatesToRef(E.facetDepthSortFrom,E.invertedMatrix,E.facetDepthSortOrigin),E.facetParameters.distanceTo=E.facetDepthSortOrigin),E.facetParameters.depthSortedFacets=E.depthSortedFacets,a&&l.c.ComputeNormals(b,h,a,E.facetParameters),E.facetDepthSort&&E.facetDepthSortEnabled){E.depthSortedFacets.sort(E.facetDepthSortFunction);const b=E.depthSortedIndices.length/3|0;for(let a=0;a<b;a++){const b=E.depthSortedFacets[a].ind;E.depthSortedIndices[3*a]=h[b],E.depthSortedIndices[3*a+1]=h[b+1],E.depthSortedIndices[3*a+2]=h[b+2]}this.updateIndices(E.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const E=this._internalAbstractMeshDataInfo._facetData;return E.facetNormals||this.updateFacetData(),E.facetNormals}getFacetLocalPositions(){const E=this._internalAbstractMeshDataInfo._facetData;return E.facetPositions||this.updateFacetData(),E.facetPositions}getFacetLocalPartitioning(){const E=this._internalAbstractMeshDataInfo._facetData;return E.facetPartitioning||this.updateFacetData(),E.facetPartitioning}getFacetPosition(E){const b=G.k.Zero();return this.getFacetPositionToRef(E,b),b}getFacetPositionToRef(E,b){const h=this.getFacetLocalPositions()[E],a=this.getWorldMatrix();return G.k.TransformCoordinatesToRef(h,a,b),this}getFacetNormal(E){const b=G.k.Zero();return this.getFacetNormalToRef(E,b),b}getFacetNormalToRef(E,b){const h=this.getFacetLocalNormals()[E];return G.k.TransformNormalToRef(h,this.getWorldMatrix(),b),this}getFacetsAtLocalCoordinates(E,b,h){const a=this.getBoundingInfo(),k=this._internalAbstractMeshDataInfo._facetData,G=Math.floor((E-a.minimum.x*k.partitioningBBoxRatio)*k.subDiv.X*k.partitioningBBoxRatio/k.bbSize.x),V=Math.floor((b-a.minimum.y*k.partitioningBBoxRatio)*k.subDiv.Y*k.partitioningBBoxRatio/k.bbSize.y),l=Math.floor((h-a.minimum.z*k.partitioningBBoxRatio)*k.subDiv.Z*k.partitioningBBoxRatio/k.bbSize.z);return G<0||G>k.subDiv.max||V<0||V>k.subDiv.max||l<0||l>k.subDiv.max?null:k.facetPartitioning[G+k.subDiv.max*V+k.subDiv.max*k.subDiv.max*l]}getClosestFacetAtCoordinates(E,b,h,a){let k=arguments.length>4&&void 0!==arguments[4]&&arguments[4],V=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const l=this.getWorldMatrix(),O=G.h.Matrix[5];l.invertToRef(O);const v=G.h.o[8];G.k.TransformCoordinatesFromFloatsToRef(E,b,h,O,v);const s=this.getClosestFacetAtLocalCoordinates(v.x,v.y,v.z,a,k,V);return a&&G.k.TransformCoordinatesFromFloatsToRef(a.x,a.y,a.z,l,a),s}getClosestFacetAtLocalCoordinates(E,b,h,a){let k=arguments.length>4&&void 0!==arguments[4]&&arguments[4],G=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],V=null,l=0,O=0,v=0,s=0,U=0,B=0,o=0,u=0;const D=this.getFacetLocalPositions(),g=this.getFacetLocalNormals(),S=this.getFacetsAtLocalCoordinates(E,b,h);if(!S)return null;let M,I,j,P=Number.MAX_VALUE,A=P;for(let n=0;n<S.length;n++)M=S[n],I=g[M],j=D[M],s=(E-j.x)*I.x+(b-j.y)*I.y+(h-j.z)*I.z,(!k||k&&G&&s>=0||k&&!G&&s<=0)&&(s=I.x*j.x+I.y*j.y+I.z*j.z,U=-(I.x*E+I.y*b+I.z*h-s)/(I.x*I.x+I.y*I.y+I.z*I.z),B=E+I.x*U,o=b+I.y*U,u=h+I.z*U,l=B-E,O=o-b,v=u-h,A=l*l+O*O+v*v,A<P&&(P=A,V=M,a&&(a.x=B,a.y=o,a.z=u)));return V}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const E=this._internalAbstractMeshDataInfo._facetData;return E.facetDataEnabled&&(E.facetDataEnabled=!1,E.facetPositions=[],E.facetNormals=[],E.facetPartitioning=new Array,E.facetParameters=null,E.depthSortedIndices=new Uint32Array(0)),this}updateIndices(E,b){return this}createNormals(E){const b=this.getVerticesData(V.g.PositionKind),h=this.rg();let a;return a=this.isVerticesDataPresent(V.g.NormalKind)?this.getVerticesData(V.g.NormalKind):[],l.c.ComputeNormals(b,h,a,{useRightHandedSystem:this.va().useRightHandedSystem}),this.Ga(V.g.NormalKind,a,E),this}alignWithNormal(E,b){b||(b=S.b.Y);const h=G.h.o[0],a=G.h.o[1];return G.k.CrossToRef(b,E,a),G.k.CrossToRef(E,a,h),this.rotationQuaternion?G.g.RotationQuaternionFromAxisToRef(h,E,a,this.rotationQuaternion):G.k.RotationFromAxisToRef(h,E,a,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,o.c)("EdgesRenderer")}enableEdgesRendering(E,b,h){throw(0,o.c)("EdgesRenderer")}zj(){return this._scene.yj.filter((E=>E.j===this))}}n.OCCLUSION_TYPE_NONE=0,n.OCCLUSION_TYPE_OPTIMISTIC=1,n.OCCLUSION_TYPE_STRICT=2,n.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,n.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,n.CULLINGSTRATEGY_STANDARD=0,n.Mi=1,n.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,n.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,a.d)([I.d.filter((function(){for(var E=arguments.length,b=new Array(E),h=0;h<E;h++)b[h]=arguments[h];let[a,k,G,V,l]=b;return!Array.isArray(a)&&!Array.isArray(k)&&!Array.isArray(G)&&!Array.isArray(V)&&!Array.isArray(l)}))],n,"_ApplySkeleton",null),(0,M.f)("BABYLON.AbstractMesh",n)},11442:(E,b,h)=>{"use strict";h.d(b,{e:()=>g});var a=h(11175),k=h(11201),G=h(11435),V=h(11233),l=h(11319),O=h(11450),v=h(11325),s=h(10821),U=h(11170),B=h(11343),o=h(10869),u=h(11389),D=h(10834);class g{get boundingBias(){return this._boundingBias}set boundingBias(E){this._boundingBias?this._boundingBias.p(E):this._boundingBias=E.clone(),this.Ea(!0,null)}static CreateGeometryForMesh(E){const b=new g(g.RandomId(),E.va());return b.Ca(E),b}get meshes(){return this._meshes}constructor(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=b||o.b.LastCreatedScene,this._scene&&(this.id=E,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=a,h?this.setAllVerticesData(h,a):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),k&&(this.Ca(k),k.Wj(!0)))}get extend(){return this._extend}va(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let E=0;E<this._meshes.length;E++)if(!this._meshes[E].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const E=new Set;for(const b in this._vertexBuffers)E.add(this._vertexBuffers[b].getWrapperBuffer());E.forEach((E=>{E._rebuild()}))}setAllVerticesData(E,b){E.applyToGeometry(this,b),this._notifyUpdate()}Ga(E,b){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0;h&&Array.isArray(b)&&(b=new Float32Array(b));const k=new V.g(this._engine,b,E,{updatable:h,postponeInternalCreation:0===this._meshes.length,stride:a,label:"Geometry_"+this.id+"_"+E});this.setVerticesBuffer(k)}removeVerticesData(E){this._vertexBuffers[E]&&(this._vertexBuffers[E].dispose(),delete this._vertexBuffers[E]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const k=E.getKind();this._vertexBuffers[k]&&h&&this._vertexBuffers[k].dispose(),E._buffer&&E._buffer._increaseReferences(),this._vertexBuffers[k]=E;const G=this._meshes,l=G.length;if(k===V.g.PositionKind){this._totalVertices=b??E._maxVerticesCount,this._updateExtend(E.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const h=this._extend&&this._extend.minimum||new a.k(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),k=this._extend&&this._extend.maximum||new a.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let E=0;E<l;E++){const b=G[E];b.buildBoundingInfo(h,k),b._createGlobalSubMesh(b.isUnIndexed),b.Wj(!0),b.synchronizeInstances()}}this._notifyUpdate(k)}updateVerticesDataDirectly(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const k=this.getVertexBuffer(E);k&&(k.updateDirectly(b,h,a),this._notifyUpdate(E))}updateVerticesData(E,b){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a=this.getVertexBuffer(E);a&&(a.update(b),E===V.g.PositionKind&&this.Ea(h,b),this._notifyUpdate(E))}Ea(E,b){if(E&&this._updateExtend(b),this._resetPointsArrayCache(),E){const E=this._meshes;for(const b of E){b.hasBoundingInfo?b.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):b.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const E=b.wg;for(const b of E)b.refreshBoundingInfo()}}}_bind(E,b,h,a){if(!E)return;void 0===b&&(b=this._indexBuffer);const k=this.getVertexBuffers();if(!k)return;if(b!=this._indexBuffer||!this._vertexArrayObjects&&!a)return void this._engine.bindBuffers(k,b,E,h);const G=a||this._vertexArrayObjects,V=this._engine;G[E.key]||(G[E.key]=V.recordVertexArrayObject(k,b,E,h)),V.bindVertexArrayObject(G[E.key],b)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(E,b,h){const a=this.getVertexBuffer(E);return a?a.getFloatData(this._totalVertices,h||b&&1!==this._meshes.length):null}copyVerticesData(E,b){const h=this.getVertexBuffer(E);if(!h)return;b[E]||(b[E]=new Float32Array(this._totalVertices*h.getSize()));const a=h.getData();a&&function(E,b,h,a,k,G,l,O){const v=b*V.g.GetTypeByteLength(h),s=l*b;if(O.length!==s)throw new Error("Output length is not valid");if(h===V.g.FLOAT&&k===v)if(E instanceof Array){const b=a/4;O.set(E,b)}else if(E instanceof ArrayBuffer){const b=new Float32Array(E,a,s);O.set(b)}else{const b=E.byteOffset+a;if(b%4)return D.c.Warn("CopyFloatData: copied misaligned data."),void O.set(new Float32Array(E.buffer.slice(b,b+4*s)));const h=new Float32Array(E.buffer,b,s);O.set(h)}else V.g.ForEach(E,a,k,b,h,s,G,((E,b)=>O[b]=E))}(a,h.getSize(),h.type,h.byteOffset,h.byteStride,h.normalized,this._totalVertices,b[E])}isVertexBufferUpdatable(E){const b=this._vertexBuffers[E];return!!b&&b.isUpdatable()}getVertexBuffer(E){return this.isReady()?this._vertexBuffers[E]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(E){return this._vertexBuffers?void 0!==this._vertexBuffers[E]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(E)}getVerticesDataKinds(){const E=[];let b;if(!this._vertexBuffers&&this._delayInfo)for(b in this._delayInfo)E.push(b);else for(b in this._vertexBuffers)E.push(b);return E}updateIndices(E,b){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const a=E.length!==this._indices.length;if(h||(this._indices=E.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,E,b),a)for(const E of this._meshes)E._createGlobalSubMesh(!0)}else this.setIndices(E,null,!0)}setIndexBuffer(E,b,h){this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=E,this._totalVertices=b,this._totalIndices=h,E.is32Bits||(E.is32Bits=this._totalIndices>65535);for(const a of this._meshes)a._createGlobalSubMesh(!0),a.synchronizeInstances();this._notifyUpdate()}setIndices(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=E,this._indexBufferIsUpdatable=h,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,h,"Geometry_"+this.id+"_IndexBuffer")),void 0!=b&&(this._totalVertices=b);for(const k of this._meshes)k._createGlobalSubMesh(!a),k.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}rg(E,b){if(!this.isReady())return null;const h=this._indices;return b||E&&1!==this._meshes.length?h.slice():h}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;E&&this._vertexArrayObjects&&this._vertexArrayObjects[E.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[E.key]),delete this._vertexArrayObjects[E.key])}releaseForMesh(E,b){const h=this._meshes,a=h.indexOf(E);-1!==a&&(h.splice(a,1),this._vertexArrayObjects&&E._invalidateInstanceVertexArrayObject(),E._geometry=null,0===h.length&&b&&this.dispose())}Ca(E){if(E._geometry===this)return;const b=E._geometry;b&&b.releaseForMesh(E),this._vertexArrayObjects&&E._invalidateInstanceVertexArrayObject();const h=this._meshes;E._geometry=this,E._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),h.push(E),this.isReady()?this._applyToMesh(E):this._boundingInfo&&E.setBoundingInfo(this._boundingInfo)}_updateExtend(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!E&&(E=this.getVerticesData(V.g.PositionKind),!E))return;this._extend=(0,B.d)(E,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(E){const b=this._meshes.length;for(const h in this._vertexBuffers)1===b&&this._vertexBuffers[h].create(),h===V.g.PositionKind&&(this._extend||this._updateExtend(),E.buildBoundingInfo(this._extend.minimum,this._extend.maximum),E._createGlobalSubMesh(E.isUnIndexed),E.Ea());1===b&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),E._syncGeometryWithMorphTargetManager(),E.synchronizeInstances()}_notifyUpdate(E){this.onGeometryUpdated&&this.onGeometryUpdated(this,E),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const b of this._meshes)b._markSubMeshesAsAttributesDirty()}load(E,b){2!==this.delayLoadState&&(this.isReady()?b&&b():(this.delayLoadState=2,this._queueLoad(E,b)))}_queueLoad(E,b){this.delayLoadingFile&&(E.addPendingData(this),E._loadFile(this.delayLoadingFile,(h=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(h),this),this.delayLoadState=1,this._delayInfo=[],E.removePendingData(this);const a=this._meshes,k=a.length;for(let E=0;E<k;E++)this._applyToMesh(a[E]);b&&b()}),void 0,!0))}toLeftHanded(){const E=this.rg(!1);if(null!=E&&E.length>0){for(let b=0;b<E.length;b+=3){const h=E[b+0];E[b+0]=E[b+2],E[b+2]=h}this.setIndices(E)}const b=this.getVerticesData(V.g.PositionKind,!1);if(null!=b&&b.length>0){for(let E=0;E<b.length;E+=3)b[E+2]=-b[E+2];this.Ga(V.g.PositionKind,b,!1)}const h=this.getVerticesData(V.g.NormalKind,!1);if(null!=h&&h.length>0){for(let E=0;E<h.length;E+=3)h[E+2]=-h[E+2];this.Ga(V.g.NormalKind,h,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const E=this.getVerticesData(V.g.PositionKind);if(!E||0===E.length)return!1;for(let b=3*this._positionsCache.length,h=this._positionsCache.length;b<E.length;b+=3,++h)this._positionsCache[h]=a.k.jh(E,b);for(let b=0,h=0;b<E.length;b+=3,++h)this._positionsCache[h].set(E[0+b],E[1+b],E[2+b]);return this._positionsCache.length=E.length/3,this._positions=this._positionsCache,!0}u(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const h in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[h]);this._vertexArrayObjects={};const E=this._meshes,b=E.length;for(let h=0;h<b;h++)E[h]._invalidateInstanceVertexArrayObject()}}dispose(){const E=this._meshes,b=E.length;let h;for(h=0;h<b;h++)this.releaseForMesh(E[h]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const a in this._vertexBuffers)this._vertexBuffers[a].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const E=this._parentContainer.geometries.indexOf(this);E>-1&&this._parentContainer.geometries.splice(E,1),this._parentContainer=null}this._isDisposed=!0}i(E){const b=new G.c;b.indices=[];const h=this.rg();if(h)for(let G=0;G<h.length;G++)b.indices.push(h[G]);let a,k=!1,V=!1;for(a in this._vertexBuffers){const E=this.getVerticesData(a);if(E&&(E instanceof Float32Array?b.set(new Float32Array(E),a):b.set(E.slice(0),a),!V)){const E=this.getVertexBuffer(a);E&&(k=E.isUpdatable(),V=!k)}}const l=new g(E,this._scene,b,k);for(a in l.delayLoadState=this.delayLoadState,l.delayLoadingFile=this.delayLoadingFile,l._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)l._delayInfo=l._delayInfo||[],l._delayInfo.push(a);return l._boundingInfo=new v.b(this._extend.minimum,this._extend.maximum),l}serialize(){const E={};return E.id=this.id,E.uniqueId=this.uniqueId,E.updatable=this._updatable,U.b&&U.b.HasTags(this)&&(E.tags=U.b.GetTags(this)),E}_toNumberArray(E){return Array.isArray(E)?E:Array.prototype.slice.call(E)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const E in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,E)&&(this._vertexBuffers[E]._buffer._data=null)}serializeVerticeData(){const E=this.serialize();return this.isVerticesDataPresent(V.g.PositionKind)&&(E.xa=this._toNumberArray(this.getVerticesData(V.g.PositionKind)),this.isVertexBufferUpdatable(V.g.PositionKind)&&(E.xa._updatable=!0)),this.isVerticesDataPresent(V.g.NormalKind)&&(E.ya=this._toNumberArray(this.getVerticesData(V.g.NormalKind)),this.isVertexBufferUpdatable(V.g.NormalKind)&&(E.ya._updatable=!0)),this.isVerticesDataPresent(V.g.TangentKind)&&(E.tangents=this._toNumberArray(this.getVerticesData(V.g.TangentKind)),this.isVertexBufferUpdatable(V.g.TangentKind)&&(E.tangents._updatable=!0)),this.isVerticesDataPresent(V.g.UVKind)&&(E.Aa=this._toNumberArray(this.getVerticesData(V.g.UVKind)),this.isVertexBufferUpdatable(V.g.UVKind)&&(E.Aa._updatable=!0)),this.isVerticesDataPresent(V.g.UV2Kind)&&(E.uvs2=this._toNumberArray(this.getVerticesData(V.g.UV2Kind)),this.isVertexBufferUpdatable(V.g.UV2Kind)&&(E.uvs2._updatable=!0)),this.isVerticesDataPresent(V.g.UV3Kind)&&(E.uvs3=this._toNumberArray(this.getVerticesData(V.g.UV3Kind)),this.isVertexBufferUpdatable(V.g.UV3Kind)&&(E.uvs3._updatable=!0)),this.isVerticesDataPresent(V.g.UV4Kind)&&(E.uvs4=this._toNumberArray(this.getVerticesData(V.g.UV4Kind)),this.isVertexBufferUpdatable(V.g.UV4Kind)&&(E.uvs4._updatable=!0)),this.isVerticesDataPresent(V.g.UV5Kind)&&(E.uvs5=this._toNumberArray(this.getVerticesData(V.g.UV5Kind)),this.isVertexBufferUpdatable(V.g.UV5Kind)&&(E.uvs5._updatable=!0)),this.isVerticesDataPresent(V.g.UV6Kind)&&(E.uvs6=this._toNumberArray(this.getVerticesData(V.g.UV6Kind)),this.isVertexBufferUpdatable(V.g.UV6Kind)&&(E.uvs6._updatable=!0)),this.isVerticesDataPresent(V.g.ColorKind)&&(E.za=this._toNumberArray(this.getVerticesData(V.g.ColorKind)),this.isVertexBufferUpdatable(V.g.ColorKind)&&(E.za._updatable=!0)),this.isVerticesDataPresent(V.g.MatricesIndicesKind)&&(E.matricesIndices=this._toNumberArray(this.getVerticesData(V.g.MatricesIndicesKind)),E.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(V.g.MatricesIndicesKind)&&(E.matricesIndices._updatable=!0)),this.isVerticesDataPresent(V.g.MatricesWeightsKind)&&(E.matricesWeights=this._toNumberArray(this.getVerticesData(V.g.MatricesWeightsKind)),this.isVertexBufferUpdatable(V.g.MatricesWeightsKind)&&(E.matricesWeights._updatable=!0)),E.indices=this._toNumberArray(this.rg()),E}static ExtractFromMesh(E,b){const h=E._geometry;return h?h.i(b):null}static RandomId(){return s.g.RandomId()}static _GetGeometryByLoadedUniqueId(E,b){for(let h=0;h<b.geometries.length;h++)if(b.geometries[h]._loadedUniqueId===E)return b.geometries[h];return null}static _ImportGeometry(E,b){const h=b.va(),a=E.geometryUniqueId,G=E.geometryId;if(a||G){const E=a?this._GetGeometryByLoadedUniqueId(a,h):h.getGeometryById(G);E&&E.Ca(b)}else if(E instanceof ArrayBuffer){const h=b._binaryInfo;if(h.positionsAttrDesc&&h.positionsAttrDesc.count>0){const a=new Float32Array(E,h.positionsAttrDesc.offset,h.positionsAttrDesc.count);b.Ga(V.g.PositionKind,a,!1)}if(h.normalsAttrDesc&&h.normalsAttrDesc.count>0){const a=new Float32Array(E,h.normalsAttrDesc.offset,h.normalsAttrDesc.count);b.Ga(V.g.NormalKind,a,!1)}if(h.tangetsAttrDesc&&h.tangetsAttrDesc.count>0){const a=new Float32Array(E,h.tangetsAttrDesc.offset,h.tangetsAttrDesc.count);b.Ga(V.g.TangentKind,a,!1)}if(h.uvsAttrDesc&&h.uvsAttrDesc.count>0){const a=new Float32Array(E,h.uvsAttrDesc.offset,h.uvsAttrDesc.count);if(u.c)for(let E=1;E<a.length;E+=2)a[E]=1-a[E];b.Ga(V.g.UVKind,a,!1)}if(h.uvs2AttrDesc&&h.uvs2AttrDesc.count>0){const a=new Float32Array(E,h.uvs2AttrDesc.offset,h.uvs2AttrDesc.count);if(u.c)for(let E=1;E<a.length;E+=2)a[E]=1-a[E];b.Ga(V.g.UV2Kind,a,!1)}if(h.uvs3AttrDesc&&h.uvs3AttrDesc.count>0){const a=new Float32Array(E,h.uvs3AttrDesc.offset,h.uvs3AttrDesc.count);if(u.c)for(let E=1;E<a.length;E+=2)a[E]=1-a[E];b.Ga(V.g.UV3Kind,a,!1)}if(h.uvs4AttrDesc&&h.uvs4AttrDesc.count>0){const a=new Float32Array(E,h.uvs4AttrDesc.offset,h.uvs4AttrDesc.count);if(u.c)for(let E=1;E<a.length;E+=2)a[E]=1-a[E];b.Ga(V.g.UV4Kind,a,!1)}if(h.uvs5AttrDesc&&h.uvs5AttrDesc.count>0){const a=new Float32Array(E,h.uvs5AttrDesc.offset,h.uvs5AttrDesc.count);if(u.c)for(let E=1;E<a.length;E+=2)a[E]=1-a[E];b.Ga(V.g.UV5Kind,a,!1)}if(h.uvs6AttrDesc&&h.uvs6AttrDesc.count>0){const a=new Float32Array(E,h.uvs6AttrDesc.offset,h.uvs6AttrDesc.count);if(u.c)for(let E=1;E<a.length;E+=2)a[E]=1-a[E];b.Ga(V.g.UV6Kind,a,!1)}if(h.colorsAttrDesc&&h.colorsAttrDesc.count>0){const a=new Float32Array(E,h.colorsAttrDesc.offset,h.colorsAttrDesc.count);b.Ga(V.g.ColorKind,a,!1,h.colorsAttrDesc.stride)}if(h.matricesIndicesAttrDesc&&h.matricesIndicesAttrDesc.count>0){const a=new Int32Array(E,h.matricesIndicesAttrDesc.offset,h.matricesIndicesAttrDesc.count),k=[];for(let E=0;E<a.length;E++){const b=a[E];k.push(255&b),k.push((65280&b)>>8),k.push((16711680&b)>>16),k.push(b>>24&255)}b.Ga(V.g.MatricesIndicesKind,k,!1)}if(h.matricesIndicesExtraAttrDesc&&h.matricesIndicesExtraAttrDesc.count>0){const a=new Int32Array(E,h.matricesIndicesExtraAttrDesc.offset,h.matricesIndicesExtraAttrDesc.count),k=[];for(let E=0;E<a.length;E++){const b=a[E];k.push(255&b),k.push((65280&b)>>8),k.push((16711680&b)>>16),k.push(b>>24&255)}b.Ga(V.g.MatricesIndicesExtraKind,k,!1)}if(h.matricesWeightsAttrDesc&&h.matricesWeightsAttrDesc.count>0){const a=new Float32Array(E,h.matricesWeightsAttrDesc.offset,h.matricesWeightsAttrDesc.count);b.Ga(V.g.MatricesWeightsKind,a,!1)}if(h.indicesAttrDesc&&h.indicesAttrDesc.count>0){const a=new Int32Array(E,h.indicesAttrDesc.offset,h.indicesAttrDesc.count);b.setIndices(a,null)}if(h.subMeshesAttrDesc&&h.subMeshesAttrDesc.count>0){const a=new Int32Array(E,h.subMeshesAttrDesc.offset,5*h.subMeshesAttrDesc.count);b.wg=[];for(let E=0;E<h.subMeshesAttrDesc.count;E++){const h=a[5*E+0],k=a[5*E+1],G=a[5*E+2],V=a[5*E+3],O=a[5*E+4];l.b.AddToMesh(h,k,G,V,O,b)}}}else if(E.xa&&E.ya&&E.indices){if(b.Ga(V.g.PositionKind,E.xa,E.xa._updatable),b.Ga(V.g.NormalKind,E.ya,E.ya._updatable),E.tangents&&b.Ga(V.g.TangentKind,E.tangents,E.tangents._updatable),E.Aa&&b.Ga(V.g.UVKind,E.Aa,E.Aa._updatable),E.uvs2&&b.Ga(V.g.UV2Kind,E.uvs2,E.uvs2._updatable),E.uvs3&&b.Ga(V.g.UV3Kind,E.uvs3,E.uvs3._updatable),E.uvs4&&b.Ga(V.g.UV4Kind,E.uvs4,E.uvs4._updatable),E.uvs5&&b.Ga(V.g.UV5Kind,E.uvs5,E.uvs5._updatable),E.uvs6&&b.Ga(V.g.UV6Kind,E.uvs6,E.uvs6._updatable),E.za&&b.Ga(V.g.ColorKind,k.f.CheckColors4(E.za,E.xa.length/3),E.za._updatable),E.matricesIndices)if(E.matricesIndices._isExpanded)delete E.matricesIndices._isExpanded,b.Ga(V.g.MatricesIndicesKind,E.matricesIndices,E.matricesIndices._updatable);else{const h=[];for(let b=0;b<E.matricesIndices.length;b++){const a=E.matricesIndices[b];h.push(255&a),h.push((65280&a)>>8),h.push((16711680&a)>>16),h.push(a>>24&255)}b.Ga(V.g.MatricesIndicesKind,h,E.matricesIndices._updatable)}if(E.matricesIndicesExtra)if(E.matricesIndicesExtra._isExpanded)delete E.matricesIndices._isExpanded,b.Ga(V.g.MatricesIndicesExtraKind,E.matricesIndicesExtra,E.matricesIndicesExtra._updatable);else{const h=[];for(let b=0;b<E.matricesIndicesExtra.length;b++){const a=E.matricesIndicesExtra[b];h.push(255&a),h.push((65280&a)>>8),h.push((16711680&a)>>16),h.push(a>>24&255)}b.Ga(V.g.MatricesIndicesExtraKind,h,E.matricesIndicesExtra._updatable)}E.matricesWeights&&(g._CleanMatricesWeights(E,b),b.Ga(V.g.MatricesWeightsKind,E.matricesWeights,E.matricesWeights._updatable)),E.matricesWeightsExtra&&b.Ga(V.g.MatricesWeightsExtraKind,E.matricesWeightsExtra,E.matricesWeights._updatable),b.setIndices(E.indices,null)}if(E.wg){b.wg=[];for(let h=0;h<E.wg.length;h++){const a=E.wg[h];l.b.AddToMesh(a.materialIndex,a.verticesStart,a.verticesCount,a.indexStart,a.indexCount,b)}}b._shouldGenerateFlatShading&&(b.convertToFlatShadedMesh(),b._shouldGenerateFlatShading=!1),b.Wj(!0),h.onMeshImportedObservable.notifyObservers(b)}static _CleanMatricesWeights(E,b){const h=.001;if(!O.c.CleanBoneMatrixWeights)return;let a=0;if(!(E.skeletonId>-1))return;{const h=b.va().getLastSkeletonById(E.skeletonId);if(!h)return;a=h.bones.length}const k=b.getVerticesData(V.g.MatricesIndicesKind),G=b.getVerticesData(V.g.MatricesIndicesExtraKind),l=E.matricesWeights,v=E.matricesWeightsExtra,s=E.numBoneInfluencer,U=l.length;for(let V=0;V<U;V+=4){let E=0,b=-1;for(let a=0;a<4;a++){const k=l[V+a];E+=k,k<h&&b<0&&(b=a)}if(v)for(let a=0;a<4;a++){const k=v[V+a];E+=k,k<h&&b<0&&(b=a+4)}if((b<0||b>s-1)&&(b=s-1),E>h){const b=1/E;for(let E=0;E<4;E++)l[V+E]*=b;if(v)for(let E=0;E<4;E++)v[V+E]*=b}else b>=4?(v[V+b-4]=1-E,G[V+b-4]=a):(l[V+b]=1-E,k[V+b]=a)}b.Ga(V.g.MatricesIndicesKind,k),E.matricesWeightsExtra&&b.Ga(V.g.MatricesIndicesExtraKind,G)}static Parse(E,b,h){const k=new g(E.id,b,void 0,E.updatable);return k._loadedUniqueId=E.uniqueId,U.b&&U.b.AddTagsTo(k,E.tags),E.delayLoadingFile?(k.delayLoadState=4,k.delayLoadingFile=h+E.delayLoadingFile,k._boundingInfo=new v.b(a.k.jh(E.boundingBoxMinimum),a.k.jh(E.boundingBoxMaximum)),k._delayInfo=[],E.hasUVs&&k._delayInfo.push(V.g.UVKind),E.hasUVs2&&k._delayInfo.push(V.g.UV2Kind),E.hasUVs3&&k._delayInfo.push(V.g.UV3Kind),E.hasUVs4&&k._delayInfo.push(V.g.UV4Kind),E.hasUVs5&&k._delayInfo.push(V.g.UV5Kind),E.hasUVs6&&k._delayInfo.push(V.g.UV6Kind),E.hasColors&&k._delayInfo.push(V.g.ColorKind),E.hasMatricesIndices&&k._delayInfo.push(V.g.MatricesIndicesKind),E.hasMatricesWeights&&k._delayInfo.push(V.g.MatricesWeightsKind),k._delayLoadingFunction=G.c.ImportVertexData):G.c.ImportVertexData(E,k),b.pushGeometry(k,!0),k}}},12176:(E,b,h)=>{"use strict";h.d(b,{b:()=>B});var a=h(11175),k=h(10834),G=h(11456),V=h(11419),l=h(10841),O=h(11461),v=h(11233),s=h(10821),U=h(10958);V.b._instancedMeshFactory=(E,b)=>{const h=new B(E,b);if(b.instancedBuffers){h.instancedBuffers={};for(const E in b.instancedBuffers)h.instancedBuffers[E]=b.instancedBuffers[E]}return h};class B extends G.b{constructor(E,b){super(E,b.va()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,b.Oj(this),this._sourceMesh=b,this._unIndexed=b._unIndexed,this.position.p(b.position),this.rotation.p(b.rotation),this.ve.p(b.ve),b.rotationQuaternion&&(this.rotationQuaternion=b.rotationQuaternion.clone()),this.animations=b.animations.slice();for(const h of b.getAnimationRanges())null!=h&&this.createAnimationRange(h.name,h.from,h.to);this.infiniteDistance=b.infiniteDistance,this.setPivotMatrix(b.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(E){var b;(null===(b=this._sourceMesh)||void 0===b?void 0:b.receiveShadows)!==E&&s.g.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(E){var b;(null===(b=this._sourceMesh)||void 0===b?void 0:b.material)!==E&&s.g.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(E){var b;(null===(b=this._sourceMesh)||void 0===b?void 0:b.visibility)!==E&&s.g.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(E){var b;(null===(b=this._sourceMesh)||void 0===b?void 0:b.skeleton)!==E&&s.g.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(E){this._sourceMesh&&E!==this._sourceMesh.renderingGroupId&&k.c.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}createInstance(E){return this._sourceMesh.createInstance(E)}isReady(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(E,!0)}getVerticesData(E,b,h){return this._sourceMesh.getVerticesData(E,b,h)}copyVerticesData(E,b){this._sourceMesh.copyVerticesData(E,b)}Ga(E,b,h,a){return this.sourceMesh&&this.sourceMesh.Ga(E,b,h,a),this.sourceMesh}updateVerticesData(E,b,h,a){return this.sourceMesh&&this.sourceMesh.updateVerticesData(E,b,h,a),this.sourceMesh}setIndices(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(E,b),this.sourceMesh}isVerticesDataPresent(E){return this._sourceMesh.isVerticesDataPresent(E)}rg(){return this._sourceMesh.rg()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let E,b=arguments.length>0&&void 0!==arguments[0]&&arguments[0],h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;E="object"===typeof b?b:{applySkeleton:b,applyMorph:h};const a=this._sourceMesh.Lj?this._sourceMesh.Lj.boundingBias:null;return this.Fa(this._sourceMesh._getData(E,null,v.g.PositionKind),a),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(E,b){if(super._activate(E,b),this._sourceMesh.wg||k.c.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,E),b){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==O.c.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new a.d);const E=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,a.h.o[7].p(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.p(this._currentLOD.Wj(!0)),this._currentLOD.position.p(a.h.o[7]),this._currentLOD._masterMesh=E,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(E){if(!E)return this;const b=this.sourceMesh.getLODLevels();if(b&&0!==b.length){const b=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(E,b.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(E){return this.sourceMesh._preActivateForIntermediateRendering(E)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.wg)for(let E=0;E<this._sourceMesh.wg.length;E++)this._sourceMesh.wg[E].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Ea(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2?arguments[2]:void 0;const a=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).createInstance(E);if(l.c.DeepCopy(this,a,["name","wg","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","xj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),b&&(a.parent=b),!h)for(let k=0;k<this.va().meshes.length;k++){const E=this.va().meshes[k];E.parent===this&&E.clone(E.name,a)}return a.Wj(!0),this.onClonedObservable.notifyObservers(a),a}dispose(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.Nj(this),super.dispose(E,b)}_serializeAsParent(E){super._serializeAsParent(E),E.parentId=this._sourceMesh.uniqueId,E.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1?arguments[1]:void 0,h=arguments.length>2?arguments[2]:void 0;const a=this.clone("Clone of "+(this.name||this.id),E||this.parent,!0,b&&b.newSourcedMesh);a&&h&&h(this,a);for(const k of this.getChildTransformNodes(!0))k.instantiateHierarchy(a,b,h);return a}}V.b.prototype.registerInstancedBuffer=function(E,b){var h,a;if(null===(h=this._userInstancedBuffersStorage)||void 0===h||null===(a=h.vertexBuffers[E])||void 0===a||a.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const E of this.instances)E.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[E]=null,this._userInstancedBuffersStorage.strides[E]=b,this._userInstancedBuffersStorage.sizes[E]=32*b,this._userInstancedBuffersStorage.data[E]=new Float32Array(this._userInstancedBuffersStorage.sizes[E]),this._userInstancedBuffersStorage.vertexBuffers[E]=new v.g(this.getEngine(),this._userInstancedBuffersStorage.data[E],E,!0,!1,b,!0);for(const k of this.instances)k.instancedBuffers[E]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},V.b.prototype._processInstancedBuffers=function(E,b){const h=E?E.length:0;for(const a in this.instancedBuffers){let k=this._userInstancedBuffersStorage.sizes[a];const G=this._userInstancedBuffersStorage.strides[a],V=(h+1)*G;for(;k<V;)k*=2;this._userInstancedBuffersStorage.data[a].length!=k&&(this._userInstancedBuffersStorage.data[a]=new Float32Array(k),this._userInstancedBuffersStorage.sizes[a]=k,this._userInstancedBuffersStorage.vertexBuffers[a]&&(this._userInstancedBuffersStorage.vertexBuffers[a].dispose(),this._userInstancedBuffersStorage.vertexBuffers[a]=null));const l=this._userInstancedBuffersStorage.data[a];let O=0;if(b){const E=this.instancedBuffers[a];E.toArray?E.toArray(l,O):E.copyToArray?E.copyToArray(l,O):l[O]=E,O+=G}for(let b=0;b<h;b++){const h=E[b].instancedBuffers[a];h.toArray?h.toArray(l,O):h.copyToArray?h.copyToArray(l,O):l[O]=h,O+=G}this._userInstancedBuffersStorage.vertexBuffers[a]?this._userInstancedBuffersStorage.vertexBuffers[a].updateDirectly(l,0):(this._userInstancedBuffersStorage.vertexBuffers[a]=new v.g(this.getEngine(),this._userInstancedBuffersStorage.data[a],a,!0,!1,G,!0),this._invalidateInstanceVertexArrayObject())}},V.b.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const E in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[E]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},V.b.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const E in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[E]&&this._userInstancedBuffersStorage.vertexBuffers[E].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,U.f)("BABYLON.InstancedMesh",B)},11419:(E,b,h)=>{"use strict";h.d(b,{b:()=>N,f:()=>z});var a=h(10824),k=h(10821),G=h(10841),V=h(11170),l=h(11422),O=h(11426),v=h(11175),s=h(11201),U=h(11429),B=h(11233),o=h(11435),u=h(11442),D=h(11456),g=h(11319),S=h(11311),M=h(11473),I=h(11450),j=h(11206),P=h(10834),A=h(10958),n=h(10855),d=h(11257);class c{constructor(E,b){this.distanceOrScreenCoverage=E,this.mesh=b}}class z{}class Z{constructor(){this.visibleInstances={},this.batchCache=new Y,this.batchCacheReplacementModeInFrozenMode=new Y,this.instancesBufferSize=2048}}class Y{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class r{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class w{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}class N extends D.b{static _GetDefaultSideOrientation(E){return E||N.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(E){this._internalMeshDataInfo._useLODScreenCoverage=E,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(E){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==E&&(E&&this._internalMeshDataInfo._sourcePositions&&(this.Ga(B.g.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.Ga(B.g.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=E,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new a.e),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new a.e),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new a.e),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new a.e),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new a.e),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(E){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(E)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(E){this._internalMeshDataInfo._forcedInstanceCount=E}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(E){this._internalMeshDataInfo._sideOrientation=E,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===E||!this._scene.useRightHandedSystem&&0===E}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(E){this.sideOrientation=E,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(E){this._internalMeshDataInfo._overrideRenderingFillMode=E}get material(){return this._internalAbstractMeshDataInfo._material}set material(E){E&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(E.sideOrientation=null),this._setMaterial(E)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(E){this._unIndexed!==E&&(this._unIndexed=E,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(E){this._instanceDataStorage.manualUpdate=E}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(E){this._instanceDataStorage.previousManualUpdate=E}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(E){this._instanceDataStorage.forceMatrixUpdates=E}_copySource(E,b){let h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const a=this.va();if(E._geometry&&E._geometry.Ca(this),G.c.DeepCopy(E,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","Lj","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","xj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=E,a.useClonedMeshMap&&(E._internalMeshDataInfo.meshMap||(E._internalMeshDataInfo.meshMap={}),E._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=E._originalBuilderSideOrientation,this._creationDataStorage=E._creationDataStorage,E._ranges){const b=E._ranges;for(const E in b)Object.prototype.hasOwnProperty.call(b,E)&&b[E]&&this.createAnimationRange(E,b[E].from,b[E].to)}if(E.metadata&&E.metadata.clone?this.metadata=E.metadata.clone():this.metadata=E.metadata,this._internalMetadata=E._internalMetadata,V.b&&V.b.HasTags(E)&&V.b.AddTagsTo(this,V.b.GetTags(E,!0)),this.Gb(E.isEnabled(!1)),this.parent=E.parent,this.setPivotMatrix(E.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+E.id,this.material=E.material,!b){const b=E.getDescendants(!0);for(let E=0;E<b.length;E++){const h=b[E];h.clone&&h.clone(this.name+"."+h.name,this)}}if(E.morphTargetManager&&(this.morphTargetManager=E.morphTargetManager),a.getPhysicsEngine){const b=a.getPhysicsEngine();if(h&&b)if(1===b.getPluginVersion()){const h=b.getImpostorForPhysicsObject(E);h&&(this.physicsImpostor=h.clone(this))}else 2===b.getPluginVersion()&&E.physicsBody&&E.physicsBody.clone(this)}for(let k=0;k<a.yj.length;k++){const b=a.yj[k];b.j===E&&b.clone(b.name,this)}this.skeleton=E.skeleton,this.refreshBoundingInfo(!0,!0),this.Wj(!0)}constructor(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,G=arguments.length>4?arguments[4]:void 0,V=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(E,b),this._internalMeshDataInfo=new w,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new Z,this._thinInstanceDataStorage=new r,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=N.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,b=this.va(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(E,b,h)=>{E&&h&&(this._uniformBuffer?this.transferToEffect(b):h.bindOnlyWorldMatrix(b))},k&&this._copySource(k,G,V),null!==h&&(this.parent=h),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=E=>{E.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new a.e(this._internalMeshDataInfo._onMeshReadyObserverAdded),k&&k.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1?arguments[1]:void 0,h=arguments.length>2?arguments[2]:void 0;const a=0===this.getTotalVertices()||b&&b.doNotInstantiate&&(!0===b.doNotInstantiate||b.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),E||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));a.parent=E||this.parent,a.position=this.position.clone(),a.ve=this.ve.clone(),this.rotationQuaternion?a.rotationQuaternion=this.rotationQuaternion.clone():a.rotation=this.rotation.clone(),h&&h(this,a);for(const k of this.getChildTransformNodes(!0))"InstancedMesh"===k.getClassName()&&"Mesh"===a.getClassName()&&k.sourceMesh===this?k.instantiateHierarchy(a,{doNotInstantiate:b&&b.doNotInstantiate||!1,newSourcedMesh:a},h):k.instantiateHierarchy(a,b,h);return a}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(E){let b=super.toString(E);if(b+=", n vertices: "+this.getTotalVertices(),b+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let h=0;h<this.animations.length;h++)b+=", animation[0]: "+this.animations[h].toString(E);if(E)if(this._geometry){const E=this.rg(),h=this.getVerticesData(B.g.PositionKind);h&&E&&(b+=", flat shading: "+(h.length/3===E.length?"YES":"NO"))}else b+=", flat shading: UNKNOWN";return b}_unBindEffect(){super._unBindEffect();for(const E of this.instances)E._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const E=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((b,h)=>b.distanceOrScreenCoverage<h.distanceOrScreenCoverage?E:b.distanceOrScreenCoverage>h.distanceOrScreenCoverage?-E:0))}addLODLevel(E,b){if(b&&b._masterMesh)return P.c.Warn("You cannot use a mesh as LOD level twice"),this;const h=new c(E,b);return this._internalMeshDataInfo._LODLevels.push(h),b&&(b._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(E){const b=this._internalMeshDataInfo;for(let h=0;h<b._LODLevels.length;h++){const a=b._LODLevels[h];if(a.distanceOrScreenCoverage===E)return a.mesh}return null}removeLODLevel(E){const b=this._internalMeshDataInfo;for(let h=0;h<b._LODLevels.length;h++)b._LODLevels[h].mesh===E&&(b._LODLevels.splice(h,1),E&&(E._masterMesh=null));return this._sortLODLevels(),this}getLOD(E,b){const h=this._internalMeshDataInfo;if(!h._LODLevels||0===h._LODLevels.length)return this;const a=b||this.getBoundingInfo().boundingSphere,k=E.mode===O.b.ORTHOGRAPHIC_CAMERA?E.cj:a.centerWorld.Xc(E.globalPosition).length();let G=k,V=1;if(h._useLODScreenCoverage){const b=E.screenArea;let h=a.radiusWorld*E.cj/k;h=h*h*Math.PI,G=h/b,V=-1}if(V*h._LODLevels[h._LODLevels.length-1].distanceOrScreenCoverage>V*G)return this.onLODLevelSelection&&this.onLODLevelSelection(G,this,this),this;for(let l=0;l<h._LODLevels.length;l++){const E=h._LODLevels[l];if(V*E.distanceOrScreenCoverage<V*G){if(E.mesh){if(4===E.mesh.delayLoadState)return E.mesh._checkDelayState(),this;if(2===E.mesh.delayLoadState)return this;E.mesh._preActivate(),E.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(G,this,E.mesh),E.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(G,this,this),this}get Lj(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(E,b,h,a){var k,G;if(!this._geometry)return null;let V=a||null===(k=this._userInstancedBuffersStorage)||void 0===k||null===(G=k.vertexBuffers[E])||void 0===G?void 0:G.getFloatData(this.instances.length+1,h||b&&1!==this._geometry.meshes.length);return V||(V=this._geometry.getVerticesData(E,b,h)),V}copyVerticesData(E,b){this._geometry&&this._geometry.copyVerticesData(E,b)}getVertexBuffer(E,b){var h;return this._geometry?(b||null===(h=this._userInstancedBuffersStorage)||void 0===h?void 0:h.vertexBuffers[E])??this._geometry.getVertexBuffer(E):null}isVerticesDataPresent(E,b){var h;return this._geometry?!b&&void 0!==(null===(h=this._userInstancedBuffersStorage)||void 0===h?void 0:h.vertexBuffers[E])||this._geometry.isVerticesDataPresent(E):!!this._delayInfo&&-1!==this._delayInfo.indexOf(E)}isVertexBufferUpdatable(E,b){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(E);if(!b){var h;const b=null===(h=this._userInstancedBuffersStorage)||void 0===h?void 0:h.vertexBuffers[E];if(b)return b.isUpdatable()}return this._geometry.isVertexBufferUpdatable(E)}getVerticesDataKinds(E){if(!this._geometry){const E=[];return this._delayInfo&&this._delayInfo.forEach((function(b){E.push(b)})),E}const b=this._geometry.getVerticesDataKinds();if(!E&&this._userInstancedBuffersStorage)for(const h in this._userInstancedBuffersStorage.vertexBuffers)-1===b.indexOf(h)&&b.push(h);return b}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}rg(E,b){return this._geometry?this._geometry.rg(E,b):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(E))return!1;if(!this.wg||0===this.wg.length)return!0;if(!E)return!0;const h=this.getEngine(),a=this.va(),k=b||h.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.Wj();const G=this.material||a.defaultMaterial;if(G)if(G._storeEffectOnSubMeshes)for(const B of this.wg){const E=B.Ha();if(E)if(E._storeEffectOnSubMeshes){if(!E.isReadyForSubMesh(this,B,k))return!1}else if(!E.isReady(this,k))return!1}else if(!G.isReady(this,k))return!1;const V=h.currentRenderPassId;for(const B of this.lightSources){const E=B.getShadowGenerators();if(!E)continue;const b=E.values();for(let a=b.next();!0!==a.done;a=b.next()){var l,O,v,s;const E=a.value;if(E&&(null===(l=E.getShadowMap())||void 0===l||!l.renderList||null!==(O=E.getShadowMap())&&void 0!==O&&O.renderList&&-1!==(null===(v=E.getShadowMap())||void 0===v||null===(s=v.renderList)||void 0===s?void 0:s.indexOf(this)))){const b=E.getShadowMap().renderPassIds??[h.currentRenderPassId];for(let a=0;a<b.length;++a){h.currentRenderPassId=b[a];for(const b of this.wg){var U;if(!E.isReady(b,k,(null===(U=b.Ha())||void 0===U?void 0:U.needAlphaBlendingForMesh(this))??!1))return h.currentRenderPassId=V,!1}}h.currentRenderPassId=V}}}for(const B of this._internalMeshDataInfo._LODLevels)if(B.mesh&&!B.mesh.isReady(k))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}Wh(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(E){this._instanceDataStorage.overridenInstanceCount=E}_preActivate(){const E=this._internalMeshDataInfo,b=this.va().getRenderId();return E._preActivateId===b||(E._preActivateId=b,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(E){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=E),this}_registerInstanceForRenderId(E,b){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:b,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[b]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=b,this._instanceDataStorage.visibleInstances[b]=new Array),this._instanceDataStorage.visibleInstances[b].push(E),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.Da||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let E,b=arguments.length>0&&void 0!==arguments[0]&&arguments[0],h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;E="object"===typeof b?b:{applySkeleton:b,applyMorph:h};const a=this.Lj?this.Lj.boundingBias:null;return this.Fa(this._getData(E,null,B.g.PositionKind),a),this}_createGlobalSubMesh(E){const b=this.getTotalVertices();if(!b||!this.rg())return null;if(this.wg&&this.wg.length>0){const h=this.rg();if(!h)return null;const a=h.length;let k=!1;if(E)k=!0;else for(const E of this.wg){if(E.indexStart+E.indexCount>a){k=!0;break}if(E.verticesStart+E.verticesCount>b){k=!0;break}}if(!k)return this.wg[0]}return this.releaseSubMeshes(),new g.b(0,0,b,0,this.getTotalIndices(),this)}subdivide(E){if(E<1)return;const b=this.getTotalIndices();let h=b/E|0,a=0;for(;h%3!==0;)h++;this.releaseSubMeshes();for(let k=0;k<E&&!(a>=b);k++)g.b.CreateFromIndices(0,a,k===E-1?b-a:h,this,void 0,!1),a+=h;this.refreshBoundingInfo(),this.synchronizeInstances()}Ga(E,b){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.Ga(E,b,h,a);else{const a=new o.c;a.set(b,E);const k=this.va();new u.e(u.e.RandomId(),k,a,h,this)}return this}removeVerticesData(E){this._geometry&&this._geometry.removeVerticesData(E)}markVerticesDataAsUpdatable(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const h=this.getVertexBuffer(E);h&&h.isUpdatable()!==b&&this.Ga(E,this.getVerticesData(E),b)}setVerticesBuffer(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=u.e.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(E,null,b),this}updateVerticesData(E,b,h,a){return this._geometry?(a?(this.makeGeometryUnique(),this.updateVerticesData(E,b,h,!1)):this._geometry.updateVerticesData(E,b,h),this):this}updateMeshPositions(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const h=this.getVerticesData(B.g.PositionKind);if(!h)return this;if(E(h),this.updateVerticesData(B.g.PositionKind,h,!1,!1),b){const E=this.rg(),b=this.getVerticesData(B.g.NormalKind);if(!b)return this;o.c.ComputeNormals(h,E,b),this.updateVerticesData(B.g.NormalKind,b,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const E=this._geometry,b=this._geometry.i(u.e.RandomId());return E.releaseForMesh(this,!0),b.Ca(this),this}setIndexBuffer(E,b,h){let a=this._geometry;a||(a=new u.e(u.e.RandomId(),this.va(),void 0,void 0,this)),a.setIndexBuffer(E,b,h)}setIndices(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(E,b,h,a);else{const b=new o.c;b.indices=E;const a=this.va();new u.e(u.e.RandomId(),a,b,h,this)}return this}updateIndices(E,b){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(E,b,h),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(E,b,h){let a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const k=this.va().getEngine();let G;if(this._unIndexed)if(this._getRenderingFillMode(h)===S.c.WireFrameFillMode)G=E._getLinesIndexBuffer(this.rg(),k);else G=null;else switch(this._getRenderingFillMode(h)){case S.c.PointFillMode:G=null;break;case S.c.WireFrameFillMode:G=E._getLinesIndexBuffer(this.rg(),k);break;default:case S.c.TriangleFillMode:G=this._geometry.getIndexBuffer()}return this._bindDirect(b,G,a)}_bindDirect(E,b){let h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(E),h&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(E,b,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(E,b),this):this}_draw(E,b,h){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const a=this.va().getEngine();return this._unIndexed&&b!==S.c.WireFrameFillMode||b==S.c.PointFillMode?a.drawArraysType(b,E.verticesStart,E.verticesCount,this.forcedInstanceCount||h):b==S.c.WireFrameFillMode?a.drawElementsType(b,0,E._linesIndexCount,this.forcedInstanceCount||h):a.drawElementsType(b,E.indexStart,E.indexCount,this.forcedInstanceCount||h),this}registerBeforeRender(E){return this.onBeforeRenderObservable.add(E),this}unregisterBeforeRender(E){return this.onBeforeRenderObservable.removeCallback(E),this}registerAfterRender(E){return this.onAfterRenderObservable.add(E),this}unregisterAfterRender(E){return this.onAfterRenderObservable.removeCallback(E),this}_getInstancesRenderList(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(b)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[E]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[E]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const h=this.va(),a=h._isInIntermediateRendering(),k=a?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,G=this._instanceDataStorage.batchCache;if(G.mustReturn=!1,G.renderSelf[E]=b||!k&&this.isEnabled()&&this.isVisible,G.visibleInstances[E]=null,this._instanceDataStorage.visibleInstances&&!b){const b=this._instanceDataStorage.visibleInstances,k=h.getRenderId(),V=a?b.intermediateDefaultRenderId:b.defaultRenderId;G.visibleInstances[E]=b[k],!G.visibleInstances[E]&&V&&(G.visibleInstances[E]=b[V])}return G.hardwareInstancedRendering[E]=!b&&this._instanceDataStorage.hardwareInstancedRendering&&null!==G.visibleInstances[E]&&void 0!==G.visibleInstances[E],this._instanceDataStorage.previousBatch=G,G}_renderWithInstances(E,b,h,a,k){const G=h.visibleInstances[E._id],V=G?G.length:0,l=this._instanceDataStorage,O=l.instancesBufferSize;let s=l.instancesBuffer,U=l.instancesPreviousBuffer;const o=16*(V+1)*4;for(;l.instancesBufferSize<o;)l.instancesBufferSize*=2;l.instancesData&&O==l.instancesBufferSize||(l.instancesData=new Float32Array(l.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!l.instancesPreviousData||O!=l.instancesBufferSize)&&(l.instancesPreviousData=new Float32Array(l.instancesBufferSize/4));let u=0,D=0;const g=h.renderSelf[E._id],S=!s||O!==l.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!l.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||l.isFrozen&&!S)D=(g?1:0)+V;else{const b=this.getWorldMatrix();if(g&&(this._scene.needsPreviousWorldMatrices&&(l.masterMeshPreviousWorldMatrix?(l.masterMeshPreviousWorldMatrix.copyToArray(l.instancesPreviousData,u),l.masterMeshPreviousWorldMatrix.p(b)):(l.masterMeshPreviousWorldMatrix=b.clone(),l.masterMeshPreviousWorldMatrix.copyToArray(l.instancesPreviousData,u))),b.copyToArray(l.instancesData,u),u+=16,D++),G){var M;if(N.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(M=E.Ha())&&void 0!==M&&M.needAlphaBlendingForMesh(E.getRenderingMesh())){const E=this._scene.activeCamera.globalPosition;for(let b=0;b<G.length;b++){const h=G[b];h._distanceToCamera=v.k.Distance(h.getBoundingInfo().boundingSphere.centerWorld,E)}G.sort(((E,b)=>E._distanceToCamera>b._distanceToCamera?-1:E._distanceToCamera<b._distanceToCamera?1:0))}for(let E=0;E<G.length;E++){const b=G[E],h=b.getWorldMatrix();h.copyToArray(l.instancesData,u),this._scene.needsPreviousWorldMatrices&&(b._previousWorldMatrix?(b._previousWorldMatrix.copyToArray(l.instancesPreviousData,u),b._previousWorldMatrix.p(h)):(b._previousWorldMatrix=h.clone(),b._previousWorldMatrix.copyToArray(l.instancesPreviousData,u))),u+=16,D++}}}return S?(s&&s.dispose(),U&&U.dispose(),s=new B.d(k,l.instancesData,!0,16,!1,!0),l.instancesBuffer=s,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=s.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=s.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=s.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=s.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(U=new B.d(k,l.instancesPreviousData,!0,16,!1,!0),l.instancesPreviousBuffer=U,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=U.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=U.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=U.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=U.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(s.updateDirectly(l.instancesData,0,D),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||U.updateDirectly(l.instancesPreviousData,0,D)),this._processInstancedBuffers(G,g),this.va()._activeIndices.addCount(E.indexCount*D,!1),k._currentDrawContext&&(k._currentDrawContext.useInstancing=!0),this._bind(E,a,b),this._draw(E,b,D),!this._scene.needsPreviousWorldMatrices||S||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||U.updateDirectly(l.instancesData,0,D),k.unbindInstanceAttributes(),this}_renderWithThinInstances(E,b,h,a){var k;const G=(null===(k=this._thinInstanceDataStorage)||void 0===k?void 0:k.instancesCount)??0;this.va()._activeIndices.addCount(E.indexCount*G,!1),a._currentDrawContext&&(a._currentDrawContext.useInstancing=!0),this._bind(E,h,b),this._draw(E,b,G),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,G):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),a.unbindInstanceAttributes()}_processInstancedBuffers(E,b){}_processRendering(E,b,h,a,k,G,V,l){const O=this.va(),v=O.getEngine();if(a=this._getRenderingFillMode(a),G&&b.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(b,a,h,v),this;if(G)this._renderWithInstances(b,a,k,h,v);else{v._currentDrawContext&&(v._currentDrawContext.useInstancing=!1);let h=0;k.renderSelf[b._id]&&(V&&V(!1,E.getWorldMatrix(),l),h++,this._draw(b,a,this._instanceDataStorage.overridenInstanceCount));const G=k.visibleInstances[b._id];if(G){const E=G.length;h+=E;for(let h=0;h<E;h++){const E=G[h].getWorldMatrix();V&&V(!0,E,l),this._draw(b,a)}}O._activeIndices.addCount(b.indexCount*h,!1)}return this}_rebuild(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(E&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const b in this._userInstancedBuffersStorage.vertexBuffers){const h=this._userInstancedBuffersStorage.vertexBuffers[b];h&&(E&&h.dispose(),this._userInstancedBuffersStorage.vertexBuffers[b]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(E)}_freeze(){if(this.wg){for(let E=0;E<this.wg.length;E++)this._getInstancesRenderList(E);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(E,b,h,a){let k=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const G=this._scene.getEngine(),V=G.currentRenderPassId;if(void 0!==E&&(G.currentRenderPassId=E),a)(!k||k&&a.isInFrustum(this._scene._frustumPlanes))&&this.render(a,!!b,h);else for(let l=0;l<this.wg.length;l++){const E=this.wg[l];(!k||k&&E.isInFrustum(this._scene._frustumPlanes))&&this.render(E,!!b,h)}return void 0!==E&&(G.currentRenderPassId=V),this}directRender(){if(!this.wg)return this;for(const E of this.wg)this.render(E,!1);return this}render(E,b,h){var a,k,G;const V=this.va();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const l=(null===(a=V.activeCameras)||void 0===a?void 0:a.length)??0;if((l>1&&V.activeCamera===V.activeCameras[0]||l<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const O=this._getInstancesRenderList(E._id,!!h);if(O.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const v=V.getEngine();let s=0,U=null;this.ignoreCameraMaxZ&&V.activeCamera&&!V._isInIntermediateRendering()&&(s=V.activeCamera.maxZ,U=V.activeCamera,V.activeCamera.maxZ=0,V.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const B=E.getRenderingMesh(),o=O.hardwareInstancedRendering[E._id]||B.hasThinInstances||!!this._userInstancedBuffersStorage&&!E.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,u=this._instanceDataStorage,D=E.Ha();if(!D)return U&&(U.maxZ=s,V.updateTransformMatrix(!0)),this;if(u.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===D){if(D._storeEffectOnSubMeshes&&(null===(k=E._drawWrapper)||void 0===k||!k._wasPreviouslyReady)||!D._storeEffectOnSubMeshes&&!D._getDrawWrapper()._wasPreviouslyReady)return U&&(U.maxZ=s,V.updateTransformMatrix(!0)),this}else{if(D._storeEffectOnSubMeshes){if(!D.isReadyForSubMesh(this,E,o))return U&&(U.maxZ=s,V.updateTransformMatrix(!0)),this}else if(!D.isReady(this,o))return U&&(U.maxZ=s,V.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=D}let g;b&&v.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),g=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?E._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const M=(null===(G=g)||void 0===G?void 0:G.effect)??null;for(const S of V._beforeRenderingMeshStage)S.action(this,E,O,M);if(!g||!M)return U&&(U.maxZ=s,V.updateTransformMatrix(!0)),this;const I=h||this;let j;if(u.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.xh&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)j=u.sideOrientation;else{const E=I._getWorldMatrixDeterminant();j=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),E<0&&(j=j===S.c.ClockWiseSideOrientation?S.c.CounterClockWiseSideOrientation:S.c.ClockWiseSideOrientation),u.sideOrientation=j}const P=this._internalMeshDataInfo._effectiveMaterial._preBind(g,j);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&v.setDepthWrite(!0);const A=this._internalMeshDataInfo._effectiveMaterial,n=A.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),o||this._bind(E,M,n,!1);const d=I.getWorldMatrix();A._storeEffectOnSubMeshes?A.bindForSubMesh(d,this,E):A.bind(d,this),!A.xh&&A.separateCullingPass&&(v.setState(!0,A.zOffset,!1,!P,A.cullBackFaces,A.stencil,A.zOffsetUnits),this._processRendering(this,E,M,n,O,o,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),v.setState(!0,A.zOffset,!1,P,A.cullBackFaces,A.stencil,A.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(E)),this._processRendering(this,E,M,n,O,o,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const S of V._afterRenderingMeshStage)S.action(this,E,O,M);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),U&&(U.maxZ=s,V.updateTransformMatrix(!0)),2!==V.performancePriority||u.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(B.g.MatricesWeightsKind)&&(this.isVerticesDataPresent(B.g.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const E=this.getVerticesData(B.g.MatricesWeightsKind),b=E.length;for(let h=0;h<b;h+=4){const b=E[h]+E[h+1]+E[h+2]+E[h+3];if(0===b)E[h]=1;else{const a=1/b;E[h]*=a,E[h+1]*=a,E[h+2]*=a,E[h+3]*=a}}this.Ga(B.g.MatricesWeightsKind,E)}_normalizeSkinWeightsAndExtra(){const E=this.getVerticesData(B.g.MatricesWeightsExtraKind),b=this.getVerticesData(B.g.MatricesWeightsKind),h=b.length;for(let a=0;a<h;a+=4){let h=b[a]+b[a+1]+b[a+2]+b[a+3];if(h+=E[a]+E[a+1]+E[a+2]+E[a+3],0===h)b[a]=1;else{const k=1/h;b[a]*=k,b[a+1]*=k,b[a+2]*=k,b[a+3]*=k,E[a]*=k,E[a+1]*=k,E[a+2]*=k,E[a+3]*=k}}this.Ga(B.g.MatricesWeightsKind,b),this.Ga(B.g.MatricesWeightsKind,E)}validateSkinning(){const E=this.getVerticesData(B.g.MatricesWeightsExtraKind),b=this.getVerticesData(B.g.MatricesWeightsKind);if(null===b||null==this.skeleton)return{skinned:!1,valid:!0,sm:"not skinned"};const h=b.length;let a=0,k=0,G=0,V=0;const l=null===E?4:8,O=[];for(let B=0;B<=l;B++)O[B]=0;for(let B=0;B<h;B+=4){let h=b[B],v=h,s=0===v?0:1;for(let k=1;k<l;k++){const G=k<4?b[B+k]:E[B+k-4];G>h&&a++,0!==G&&s++,v+=G,h=G}if(O[s]++,s>G&&(G=s),0===v)k++;else{const h=1/v;let a=0;for(let k=0;k<l;k++)a+=k<4?Math.abs(b[B+k]-b[B+k]*h):Math.abs(E[B+k-4]-E[B+k-4]*h);a>.001&&V++}}const v=this.skeleton.bones.length,s=this.getVerticesData(B.g.MatricesIndicesKind),U=this.getVerticesData(B.g.MatricesIndicesExtraKind);let o=0;for(let B=0;B<h;B+=4)for(let E=0;E<l;E++){const b=E<4?s[B+E]:U[B+E-4];(b>=v||b<0)&&o++}return{skinned:!0,valid:0===k&&0===V&&0===o,sm:"Number of Weights = "+h/4+"\nMaximum influences = "+G+"\nMissing Weights = "+k+"\nNot Sorted = "+a+"\nNot Normalized = "+V+"\nWeightCounts = ["+O+"]\nNumber of bones = "+v+"\nBad Bone Indices = "+o}}_checkDelayState(){const E=this.va();return this._geometry?this._geometry.load(E):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(E)),this}_queueLoad(E){E.addPendingData(this);const b=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return k.g.LoadFile(this.delayLoadingFile,(b=>{b instanceof ArrayBuffer?this._delayLoadingFunction(b,this):this._delayLoadingFunction(JSON.parse(b),this),this.instances.forEach((E=>{E.refreshBoundingInfo(),E._syncSubMeshes()})),this.delayLoadState=1,E.removePendingData(this)}),(()=>{}),E.offlineProvider,b),this}isInFrustum(E){return 2!==this.delayLoadState&&(!!super.isInFrustum(E)&&(this._checkDelayState(),!0))}setMaterialById(E){const b=this.va().materials;let h;for(h=b.length-1;h>-1;h--)if(b[h].id===E)return this.material=b[h],this;const a=this.va().multiMaterials;for(h=a.length-1;h>-1;h--)if(a[h].id===E)return this.material=a[h],this;return this}getAnimatables(){const E=[];return this.material&&E.push(this.material),this.skeleton&&E.push(this.skeleton),E}bakeTransformIntoVertices(E){if(!this.isVerticesDataPresent(B.g.PositionKind))return this;const b=this.wg.splice(0);this._resetPointsArrayCache();let h=this.getVerticesData(B.g.PositionKind);const a=v.k.Zero();let k;for(k=0;k<h.length;k+=3)v.k.TransformCoordinatesFromFloatsToRef(h[k],h[k+1],h[k+2],E,a).toArray(h,k);if(this.Ga(B.g.PositionKind,h,this.getVertexBuffer(B.g.PositionKind).isUpdatable()),this.isVerticesDataPresent(B.g.NormalKind)){for(h=this.getVerticesData(B.g.NormalKind),k=0;k<h.length;k+=3)v.k.TransformNormalFromFloatsToRef(h[k],h[k+1],h[k+2],E,a).normalize().toArray(h,k);this.Ga(B.g.NormalKind,h,this.getVertexBuffer(B.g.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(B.g.TangentKind)){for(h=this.getVerticesData(B.g.TangentKind),k=0;k<h.length;k+=4)v.k.TransformNormalFromFloatsToRef(h[k],h[k+1],h[k+2],E,a).normalize().toArray(h,k);this.Ga(B.g.TangentKind,h,this.getVertexBuffer(B.g.TangentKind).isUpdatable())}return E.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.wg=b,this}bakeCurrentTransformIntoVertices(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.bakeTransformIntoVertices(this.Wj(!0)),this.resetLocalMatrix(E),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0,h=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new N(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",this.va(),E,this,b,h)}dispose(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const h=this._internalMeshDataInfo;if(h._onBeforeDrawObservable&&h._onBeforeDrawObservable.clear(),h._onBeforeBindObservable&&h._onBeforeBindObservable.clear(),h._onBeforeRenderObservable&&h._onBeforeRenderObservable.clear(),h._onAfterRenderObservable&&h._onAfterRenderObservable.clear(),h._onBetweenPassObservable&&h._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(h.meshMap)for(const E in h.meshMap){const b=h.meshMap[E];b&&(b._internalMeshDataInfo._source=null,h.meshMap[E]=void 0)}h._source&&h._source._internalMeshDataInfo.meshMap&&(h._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const E=this.va().meshes;for(const b of E){const E=b;E._internalMeshDataInfo&&E._internalMeshDataInfo._source&&E._internalMeshDataInfo._source===this&&(E._internalMeshDataInfo._source=null)}}h._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(E,b)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(E,b,h,a,G,V){let l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],O=arguments.length>7?arguments[7]:void 0;const v=this.va();return k.g.LoadImage(E,(E=>{const k=E.width,O=E.height,v=this.getEngine().createCanvas(k,O).getContext("2d");v.drawImage(E,0,0);const s=v.getImageData(0,0,k,O).data;this.applyDisplacementMapFromBuffer(s,k,O,b,h,G,V,l),a&&a(this)}),O||(()=>{}),v.offlineProvider),this}applyDisplacementMapFromBuffer(E,b,h,a,k,G,V){let l=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(B.g.PositionKind)||!this.isVerticesDataPresent(B.g.NormalKind)||!this.isVerticesDataPresent(B.g.UVKind))return P.c.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const O=this.getVerticesData(B.g.PositionKind,!0,!0),s=this.getVerticesData(B.g.NormalKind),U=this.getVerticesData(B.g.UVKind);let u=v.k.Zero();const D=v.k.Zero(),g=v.j.Zero();G=G||v.j.Zero(),V=V||new v.j(1,1);for(let B=0;B<O.length;B+=3){v.k.FromArrayToRef(O,B,u),v.k.FromArrayToRef(s,B,D),v.j.FromArrayToRef(U,B/3*2,g);const l=4*((Math.abs(g.x*V.x+G.x%1)*(b-1)%b|0)+(Math.abs(g.y*V.y+G.y%1)*(h-1)%h|0)*b),o=.3*(E[l]/255)+.59*(E[l+1]/255)+.11*(E[l+2]/255);D.normalize(),D.scaleInPlace(a+(k-a)*o),u=u.add(D),u.toArray(O,B)}return o.c.ComputeNormals(O,this.rg(),s),l?(this.Ga(B.g.PositionKind,O),this.Ga(B.g.NormalKind,s),this.Ga(B.g.UVKind,U)):(this.updateVerticesData(B.g.PositionKind,O),this.updateVerticesData(B.g.NormalKind,s)),this}_getFlattenedNormals(E,b){const h=new Float32Array(3*E.length);let a=0;const k=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let G=0;G<E.length;G+=3){const V=v.k.jh(b,3*E[G]),l=v.k.jh(b,3*E[G+1]),O=v.k.jh(b,3*E[G+2]),s=V.Xc(l),U=O.Xc(l),B=v.k.Normalize(v.k.Cross(s,U));k&&B.scaleInPlace(-1);for(let E=0;E<3;E++)h[a++]=B.x,h[a++]=B.y,h[a++]=B.z}return h}_convertToUnIndexedMesh(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b=this.getVerticesDataKinds().filter((E=>{var b;return!(null!==(b=this.getVertexBuffer(E))&&void 0!==b&&b.getIsInstanced())})),h=this.rg(),a={},k=(E,b)=>{const a=new Float32Array(h.length*b);let k=0;for(let G=0;G<h.length;G++)for(let V=0;V<b;V++)a[k++]=E[h[G]*b+V];return a},G=this.getBoundingInfo(),V=this.Lj?this.wg.slice(0):[];for(const l of b)a[l]=this.getVerticesData(l);for(const l of b){const b=this.getVertexBuffer(l),G=b.getSize();if(E&&l===B.g.NormalKind){const E=this._getFlattenedNormals(h,a[B.g.PositionKind]);this.Ga(B.g.NormalKind,E,b.isUpdatable(),G)}else this.Ga(l,k(a[l],G),b.isUpdatable(),G)}if(this.morphTargetManager){for(let b=0;b<this.morphTargetManager.numTargets;b++){const a=this.morphTargetManager.getTarget(b),G=a.getPositions();a.setPositions(k(G,3));const V=a.getNormals();V&&a.setNormals(E?this._getFlattenedNormals(h,G):k(V,3));const l=a.getTangents();l&&a.setTangents(k(l,3));const O=a.getUVs();O&&a.setUVs(k(O,2))}this.morphTargetManager.synchronize()}for(let l=0;l<h.length;l++)h[l]=l;this.setIndices(h),this._unIndexed=!0,this.releaseSubMeshes();for(const l of V){const E=l.getBoundingInfo();g.b.AddToMesh(l.materialIndex,l.indexStart,l.indexCount,l.indexStart,l.indexCount,this).setBoundingInfo(E)}return this.setBoundingInfo(G),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b=o.c.ExtractFromMesh(this);let h;if(E&&this.isVerticesDataPresent(B.g.NormalKind)&&b.ya){for(h=0;h<b.ya.length;h++)b.ya[h]*=-1;this.Ga(B.g.NormalKind,b.ya,this.isVertexBufferUpdatable(B.g.NormalKind))}if(b.indices){let E;for(h=0;h<b.indices.length;h+=3)E=b.indices[h+1],b.indices[h+1]=b.indices[h+2],b.indices[h+2]=E;this.setIndices(b.indices,null,this.isVertexBufferUpdatable(B.g.PositionKind),!0)}return this}increaseVertices(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const b=o.c.ExtractFromMesh(this),h=b.indices&&!Array.isArray(b.indices)&&Array.from?Array.from(b.indices):b.indices,a=b.xa&&!Array.isArray(b.xa)&&Array.from?Array.from(b.xa):b.xa,k=b.Aa&&!Array.isArray(b.Aa)&&Array.from?Array.from(b.Aa):b.Aa,G=b.ya&&!Array.isArray(b.ya)&&Array.from?Array.from(b.ya):b.ya;if(h&&a){b.indices=h,b.xa=a,k&&(b.Aa=k),G&&(b.ya=G);const V=E+1,l=new Array;for(let E=0;E<V+1;E++)l[E]=new Array;let O,s;const U=new v.k(0,0,0),o=new v.k(0,0,0),u=new v.j(0,0),D=new Array,g=new Array,S=new Array;let M,I,j,P=a.length;k&&(I=k.length),G&&(j=G.length);for(let E=0;E<h.length;E+=3){g[0]=h[E],g[1]=h[E+1],g[2]=h[E+2];for(let E=0;E<3;E++)if(O=g[E],s=g[(E+1)%3],void 0===S[O]&&void 0===S[s]?(S[O]=new Array,S[s]=new Array):(void 0===S[O]&&(S[O]=new Array),void 0===S[s]&&(S[s]=new Array)),void 0===S[O][s]&&void 0===S[s][O]){S[O][s]=[],U.x=(a[3*s]-a[3*O])/V,U.y=(a[3*s+1]-a[3*O+1])/V,U.z=(a[3*s+2]-a[3*O+2])/V,G&&(o.x=(G[3*s]-G[3*O])/V,o.y=(G[3*s+1]-G[3*O+1])/V,o.z=(G[3*s+2]-G[3*O+2])/V),k&&(u.x=(k[2*s]-k[2*O])/V,u.y=(k[2*s+1]-k[2*O+1])/V),S[O][s].push(O);for(let E=1;E<V;E++)S[O][s].push(a.length/3),a[P++]=a[3*O]+E*U.x,a[P++]=a[3*O+1]+E*U.y,a[P++]=a[3*O+2]+E*U.z,G&&(G[j++]=G[3*O]+E*o.x,G[j++]=G[3*O+1]+E*o.y,G[j++]=G[3*O+2]+E*o.z),k&&(k[I++]=k[2*O]+E*u.x,k[I++]=k[2*O+1]+E*u.y);S[O][s].push(s),S[s][O]=new Array,M=S[O][s].length;for(let E=0;E<M;E++)S[s][O][E]=S[O][s][M-1-E]}l[0][0]=h[E],l[1][0]=S[h[E]][h[E+1]][1],l[1][1]=S[h[E]][h[E+2]][1];for(let b=2;b<V;b++){l[b][0]=S[h[E]][h[E+1]][b],l[b][b]=S[h[E]][h[E+2]][b],U.x=(a[3*l[b][b]]-a[3*l[b][0]])/b,U.y=(a[3*l[b][b]+1]-a[3*l[b][0]+1])/b,U.z=(a[3*l[b][b]+2]-a[3*l[b][0]+2])/b,G&&(o.x=(G[3*l[b][b]]-G[3*l[b][0]])/b,o.y=(G[3*l[b][b]+1]-G[3*l[b][0]+1])/b,o.z=(G[3*l[b][b]+2]-G[3*l[b][0]+2])/b),k&&(u.x=(k[2*l[b][b]]-k[2*l[b][0]])/b,u.y=(k[2*l[b][b]+1]-k[2*l[b][0]+1])/b);for(let E=1;E<b;E++)l[b][E]=a.length/3,a[P++]=a[3*l[b][0]]+E*U.x,a[P++]=a[3*l[b][0]+1]+E*U.y,a[P++]=a[3*l[b][0]+2]+E*U.z,G&&(G[j++]=G[3*l[b][0]]+E*o.x,G[j++]=G[3*l[b][0]+1]+E*o.y,G[j++]=G[3*l[b][0]+2]+E*o.z),k&&(k[I++]=k[2*l[b][0]]+E*u.x,k[I++]=k[2*l[b][0]+1]+E*u.y)}l[V]=S[h[E+1]][h[E+2]],D.push(l[0][0],l[1][0],l[1][1]);for(let E=1;E<V;E++){let b;for(b=0;b<E;b++)D.push(l[E][b],l[E+1][b],l[E+1][b+1]),D.push(l[E][b],l[E+1][b+1],l[E][b+1]);D.push(l[E][b],l[E+1][b],l[E+1][b+1])}}b.indices=D,b.Ca(this,this.isVertexBufferUpdatable(B.g.PositionKind))}else P.c.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const E=o.c.ExtractFromMesh(this),b=E.Aa,h=E.indices,a=E.xa,k=E.za,G=E.matricesIndices,V=E.matricesWeights,l=E.matricesIndicesExtra,O=E.matricesWeightsExtra;if(void 0===h||void 0===a||null===h||null===a)P.c.Warn("VertexData contains empty entries");else{const v=new Array,s=new Array,U=new Array,u=new Array,D=new Array,g=new Array,S=new Array,M=new Array;let I=new Array,j=0;const P={};let A,n;for(let E=0;E<h.length;E+=3){n=[h[E],h[E+1],h[E+2]],I=[];for(let E=0;E<3;E++){I[E]="";for(let b=0;b<3;b++)Math.abs(a[3*n[E]+b])<1e-8&&(a[3*n[E]+b]=0),I[E]+=a[3*n[E]+b]+"|"}if(I[0]!=I[1]&&I[0]!=I[2]&&I[1]!=I[2])for(let E=0;E<3;E++){if(A=P[I[E]],void 0===A){P[I[E]]=j,A=j++;for(let b=0;b<3;b++)v.push(a[3*n[E]+b]);if(null!==k&&void 0!==k)for(let b=0;b<4;b++)u.push(k[4*n[E]+b]);if(null!==b&&void 0!==b)for(let h=0;h<2;h++)U.push(b[2*n[E]+h]);if(null!==G&&void 0!==G)for(let b=0;b<4;b++)D.push(G[4*n[E]+b]);if(null!==V&&void 0!==V)for(let b=0;b<4;b++)g.push(V[4*n[E]+b]);if(null!==l&&void 0!==l)for(let b=0;b<4;b++)S.push(l[4*n[E]+b]);if(null!==O&&void 0!==O)for(let b=0;b<4;b++)M.push(O[4*n[E]+b])}s.push(A)}}const d=new Array;o.c.ComputeNormals(v,s,d),E.xa=v,E.indices=s,E.ya=d,null!==b&&void 0!==b&&(E.Aa=U),null!==k&&void 0!==k&&(E.za=u),null!==G&&void 0!==G&&(E.matricesIndices=D),null!==V&&void 0!==V&&(E.matricesWeights=g),null!==l&&void 0!==l&&(E.matricesIndicesExtra=S),null!==V&&void 0!==V&&(E.matricesWeightsExtra=M),E.Ca(this,this.isVertexBufferUpdatable(B.g.PositionKind))}}static _instancedMeshFactory(E,b){throw(0,n.c)("InstancedMesh")}static _PhysicsImpostorParser(E,b,h){throw(0,n.c)("PhysicsImpostor")}createInstance(E){const b=N._instancedMeshFactory(E,this);return b.parent=this.parent,b}synchronizeInstances(){for(let E=0;E<this.instances.length;E++){this.instances[E]._syncSubMeshes()}return this}optimizeIndices(E){const b=this.rg(),h=this.getVerticesData(B.g.PositionKind);if(!h||!b)return this;const a=[];for(let k=0;k<h.length;k+=3)a.push(v.k.jh(h,k));const G=[];return k.d.SyncAsyncForLoop(a.length,40,(E=>{const b=a.length-1-E,h=a[b];for(let k=0;k<b;++k){const E=a[k];if(h.equals(E)){G[b]=k;break}}}),(()=>{for(let E=0;E<b.length;++E)b[E]=G[b[E]]||b[E];const h=this.wg.slice(0);this.setIndices(b),this.wg=h,E&&E(this)})),this}serialize(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};E.name=this.name,E.id=this.id,E.uniqueId=this.uniqueId,E.type=this.getClassName(),V.b&&V.b.HasTags(this)&&(E.tags=V.b.GetTags(this)),E.position=this.position.qj(),this.rotationQuaternion?E.rotationQuaternion=this.rotationQuaternion.qj():this.rotation&&(E.rotation=this.rotation.qj()),E.ve=this.ve.qj(),this._postMultiplyPivotMatrix?E.pivotMatrix=this.getPivotMatrix().qj():E.localMatrix=this.getPivotMatrix().qj(),E.isEnabled=this.isEnabled(!1),E.isVisible=this.isVisible,E.infiniteDistance=this.infiniteDistance,E.pickable=this.zb,E.receiveShadows=this.receiveShadows,E.billboardMode=this.billboardMode,E.visibility=this.visibility,E.ub=this.ub,E.checkCollisions=this.checkCollisions,E.ellipsoid=this.ellipsoid.qj(),E.ellipsoidOffset=this.ellipsoidOffset.qj(),E.Da=this.Da,E.isBlocker=this.isBlocker,E.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(E),E.isUnIndexed=this.isUnIndexed;const b=this._geometry;if(b&&this.wg){E.geometryUniqueId=b.uniqueId,E.geometryId=b.id,E.wg=[];for(let b=0;b<this.wg.length;b++){const h=this.wg[b];E.wg.push({materialIndex:h.materialIndex,verticesStart:h.verticesStart,verticesCount:h.verticesCount,indexStart:h.indexStart,indexCount:h.indexCount})}}if(this.material?this.material.doNotSerialize||(E.materialUniqueId=this.material.uniqueId,E.materialId=this.material.id):(this.material=null,E.materialUniqueId=this._scene.defaultMaterial.uniqueId,E.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(E.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(E.skeletonId=this.skeleton.id,E.numBoneInfluencers=this.numBoneInfluencers),this.va()._getComponent(d.e.NAME_PHYSICSENGINE)){const b=this.getPhysicsImpostor();b&&(E.physicsMass=b.getParam("mass"),E.physicsFriction=b.getParam("friction"),E.physicsRestitution=b.getParam("mass"),E.physicsImpostor=b.type)}this.metadata&&(E.metadata=this.metadata),E.instances=[];for(let h=0;h<this.instances.length;h++){const b=this.instances[h];if(b.doNotSerialize)continue;const a={name:b.name,id:b.id,isEnabled:b.isEnabled(!1),isVisible:b.isVisible,zb:b.zb,checkCollisions:b.checkCollisions,position:b.position.qj(),ve:b.ve.qj()};if(b.parent&&b.parent._serializeAsParent(a),b.rotationQuaternion?a.rotationQuaternion=b.rotationQuaternion.qj():b.rotation&&(a.rotation=b.rotation.qj()),this.va()._getComponent(d.e.NAME_PHYSICSENGINE)){const E=b.getPhysicsImpostor();E&&(a.physicsMass=E.getParam("mass"),a.physicsFriction=E.getParam("friction"),a.physicsRestitution=E.getParam("mass"),a.physicsImpostor=E.type)}b.metadata&&(a.metadata=b.metadata),b.actionManager&&(a.actions=b.actionManager.serialize(b.name)),E.instances.push(a),j.e.AppendSerializedAnimations(b,a),a.ranges=b.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(E.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const b={data:{},sizes:{},strides:{}};for(const E in this._userThinInstanceBuffersStorage.data)b.data[E]=Array.from(this._userThinInstanceBuffersStorage.data[E]),b.sizes[E]=this._userThinInstanceBuffersStorage.sizes[E],b.strides[E]=this._userThinInstanceBuffersStorage.strides[E];E.thinInstances.userThinInstance=b}return j.e.AppendSerializedAnimations(this,E),E.ranges=this.serializeAnimationRanges(),E.layerMask=this.layerMask,E.alphaIndex=this.alphaIndex,E.hasVertexAlpha=this.hasVertexAlpha,E.overlayAlpha=this.overlayAlpha,E.overlayColor=this.overlayColor.qj(),E.renderOverlay=this.renderOverlay,E.applyFog=this.applyFog,this.actionManager&&(E.actions=this.actionManager.serialize(this.name)),E}_syncGeometryWithMorphTargetManager(){if(!this.Lj)return;this._markSubMeshesAsAttributesDirty();const E=this._internalAbstractMeshDataInfo._morphTargetManager;if(E&&E.vertexCount){if(E.vertexCount!==this.getTotalVertices())return P.c.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(E.isUsingTextureForTargets)return;for(let b=0;b<E.numInfluencers;b++){const h=E.getActiveTarget(b),a=h.getPositions();if(!a)return void P.c.Error("Invalid morph target. Target must have positions.");this.Lj.Ga(B.g.PositionKind+b,a,!1,3);const k=h.getNormals();k&&this.Lj.Ga(B.g.NormalKind+b,k,!1,3);const G=h.getTangents();G&&this.Lj.Ga(B.g.TangentKind+b,G,!1,3);const V=h.getUVs();V&&this.Lj.Ga(B.g.UVKind+"_"+b,V,!1,2)}}else{let E=0;for(;this.Lj.isVerticesDataPresent(B.g.PositionKind+E);)this.Lj.removeVerticesData(B.g.PositionKind+E),this.Lj.isVerticesDataPresent(B.g.NormalKind+E)&&this.Lj.removeVerticesData(B.g.NormalKind+E),this.Lj.isVerticesDataPresent(B.g.TangentKind+E)&&this.Lj.removeVerticesData(B.g.TangentKind+E),this.Lj.isVerticesDataPresent(B.g.UVKind+E)&&this.Lj.removeVerticesData(B.g.UVKind+"_"+E),E++}}static Parse(E,b,h){let a;if(a=E.type&&"LinesMesh"===E.type?N._LinesMeshParser(E,b):E.type&&"GroundMesh"===E.type?N._GroundMeshParser(E,b):E.type&&"GoldbergMesh"===E.type?N._GoldbergMeshParser(E,b):E.type&&"GreasedLineMesh"===E.type?N._GreasedLineMeshParser(E,b):E.type&&"TrailMesh"===E.type?N._TrailMeshParser(E,b):new N(E.name,b),a.id=E.id,a._waitingParsedUniqueId=E.uniqueId,V.b&&V.b.AddTagsTo(a,E.tags),a.position=v.k.jh(E.position),void 0!==E.metadata&&(a.metadata=E.metadata),E.rotationQuaternion?a.rotationQuaternion=v.g.jh(E.rotationQuaternion):E.rotation&&(a.rotation=v.k.jh(E.rotation)),a.ve=v.k.jh(E.ve),E.localMatrix?a.setPreTransformMatrix(v.d.jh(E.localMatrix)):E.pivotMatrix&&a.setPivotMatrix(v.d.jh(E.pivotMatrix)),a.Gb(E.isEnabled),a.isVisible=E.isVisible,a.infiniteDistance=E.infiniteDistance,a.ub=!!E.ub,a.showBoundingBox=E.showBoundingBox,a.showSubMeshesBoundingBox=E.showSubMeshesBoundingBox,void 0!==E.applyFog&&(a.applyFog=E.applyFog),void 0!==E.pickable&&(a.zb=E.pickable),void 0!==E.alphaIndex&&(a.alphaIndex=E.alphaIndex),a.receiveShadows=E.receiveShadows,void 0!==E.billboardMode&&(a.billboardMode=E.billboardMode),void 0!==E.visibility&&(a.visibility=E.visibility),a.checkCollisions=E.checkCollisions,a.Da=!!E.Da,E.ellipsoid&&(a.ellipsoid=v.k.jh(E.ellipsoid)),E.ellipsoidOffset&&(a.ellipsoidOffset=v.k.jh(E.ellipsoidOffset)),null!=E.overrideMaterialSideOrientation&&(a.sideOrientation=E.overrideMaterialSideOrientation),void 0!==E.sideOrientation&&(a.sideOrientation=E.sideOrientation),void 0!==E.isBlocker&&(a.isBlocker=E.isBlocker),a._shouldGenerateFlatShading=E.useFlatShading,E.oc&&(a._waitingData.oc=E.oc),void 0!==E.parentId&&(a._waitingParentId=E.parentId),void 0!==E.parentInstanceIndex&&(a._waitingParentInstanceIndex=E.parentInstanceIndex),void 0!==E.actions&&(a._waitingData.actions=E.actions),void 0!==E.overlayAlpha&&(a.overlayAlpha=E.overlayAlpha),void 0!==E.overlayColor&&(a.overlayColor=s.b.jh(E.overlayColor)),void 0!==E.renderOverlay&&(a.renderOverlay=E.renderOverlay),a.isUnIndexed=!!E.isUnIndexed,a.hasVertexAlpha=E.hasVertexAlpha,E.delayLoadingFile?(a.delayLoadState=4,a.delayLoadingFile=h+E.delayLoadingFile,a.buildBoundingInfo(v.k.jh(E.boundingBoxMinimum),v.k.jh(E.boundingBoxMaximum)),E._binaryInfo&&(a._binaryInfo=E._binaryInfo),a._delayInfo=[],E.hasUVs&&a._delayInfo.push(B.g.UVKind),E.hasUVs2&&a._delayInfo.push(B.g.UV2Kind),E.hasUVs3&&a._delayInfo.push(B.g.UV3Kind),E.hasUVs4&&a._delayInfo.push(B.g.UV4Kind),E.hasUVs5&&a._delayInfo.push(B.g.UV5Kind),E.hasUVs6&&a._delayInfo.push(B.g.UV6Kind),E.hasColors&&a._delayInfo.push(B.g.ColorKind),E.hasMatricesIndices&&a._delayInfo.push(B.g.MatricesIndicesKind),E.hasMatricesWeights&&a._delayInfo.push(B.g.MatricesWeightsKind),a._delayLoadingFunction=u.e._ImportGeometry,I.c.ForceFullSceneLoadingForIncremental&&a._checkDelayState()):u.e._ImportGeometry(E,a),E.materialUniqueId?a._waitingMaterialId=E.materialUniqueId:E.materialId&&(a._waitingMaterialId=E.materialId),E.morphTargetManagerId>-1&&(a._waitingMorphTargetManagerId=E.morphTargetManagerId),void 0!==E.skeletonId&&null!==E.skeletonId&&(a.skeleton=b.getLastSkeletonById(E.skeletonId),E.numBoneInfluencers&&(a.numBoneInfluencers=E.numBoneInfluencers)),E.animations){for(let b=0;b<E.animations.length;b++){const h=E.animations[b],k=(0,A.d)("BABYLON.Animation");k&&a.animations.push(k.Parse(h))}U.d.ParseAnimationRanges(a,E,b)}if(E.autoAnimate&&b.beginAnimation(a,E.autoAnimateFrom,E.autoAnimateTo,E.autoAnimateLoop,E.autoAnimateSpeed||1),E.layerMask&&!isNaN(E.layerMask)?a.layerMask=Math.abs(parseInt(E.layerMask)):a.layerMask=268435455,E.physicsImpostor&&(a.physicsImpostor=N._PhysicsImpostorParser(b,a,E)),E.lodMeshIds&&(a._waitingData.lods={ids:E.lodMeshIds,distances:E.lodDistances?E.lodDistances:null,coverages:E.lodCoverages?E.lodCoverages:null}),E.instances)for(let k=0;k<E.instances.length;k++){const h=E.instances[k],G=a.createInstance(h.name);if(h.id&&(G.id=h.id),V.b&&(h.tags?V.b.AddTagsTo(G,h.tags):V.b.AddTagsTo(G,E.tags)),G.position=v.k.jh(h.position),void 0!==h.metadata&&(G.metadata=h.metadata),void 0!==h.parentId&&(G._waitingParentId=h.parentId),void 0!==h.parentInstanceIndex&&(G._waitingParentInstanceIndex=h.parentInstanceIndex),void 0!==h.isEnabled&&null!==h.isEnabled&&G.Gb(h.isEnabled),void 0!==h.isVisible&&null!==h.isVisible&&(G.isVisible=h.isVisible),void 0!==h.zb&&null!==h.zb&&(G.zb=h.zb),h.rotationQuaternion?G.rotationQuaternion=v.g.jh(h.rotationQuaternion):h.rotation&&(G.rotation=v.k.jh(h.rotation)),G.ve=v.k.jh(h.ve),void 0!=h.checkCollisions&&null!=h.checkCollisions&&(G.checkCollisions=h.checkCollisions),void 0!=h.pickable&&null!=h.pickable&&(G.zb=h.pickable),void 0!=h.showBoundingBox&&null!=h.showBoundingBox&&(G.showBoundingBox=h.showBoundingBox),void 0!=h.showSubMeshesBoundingBox&&null!=h.showSubMeshesBoundingBox&&(G.showSubMeshesBoundingBox=h.showSubMeshesBoundingBox),void 0!=h.alphaIndex&&null!=h.showSubMeshesBoundingBox&&(G.alphaIndex=h.alphaIndex),h.physicsImpostor&&(G.physicsImpostor=N._PhysicsImpostorParser(b,G,h)),void 0!==h.actions&&(G._waitingData.actions=h.actions),h.animations){for(let E=0;E<h.animations.length;E++){const b=h.animations[E],a=(0,A.d)("BABYLON.Animation");a&&G.animations.push(a.Parse(b))}U.d.ParseAnimationRanges(G,h,b),h.autoAnimate&&b.beginAnimation(G,h.autoAnimateFrom,h.autoAnimateTo,h.autoAnimateLoop,h.autoAnimateSpeed||1)}}if(E.thinInstances){const b=E.thinInstances;if(a.thinInstanceEnablePicking=!!b.enablePicking,b.matrixData?(a.Kb("matrix",new Float32Array(b.matrixData),16,!1),a._thinInstanceDataStorage.matrixBufferSize=b.matrixBufferSize,a._thinInstanceDataStorage.instancesCount=b.instancesCount):a._thinInstanceDataStorage.matrixBufferSize=b.matrixBufferSize,E.thinInstances.userThinInstance){const b=E.thinInstances.userThinInstance;for(const E in b.data)a.Kb(E,new Float32Array(b.data[E]),b.strides[E],!1),a._userThinInstanceBuffersStorage.sizes[E]=b.sizes[E]}}return a}setPositionsForCPUSkinning(){const E=this._internalMeshDataInfo;if(!E._sourcePositions){const b=this.getVerticesData(B.g.PositionKind);if(!b)return E._sourcePositions;E._sourcePositions=new Float32Array(b),this.isVertexBufferUpdatable(B.g.PositionKind)||this.Ga(B.g.PositionKind,b,!0)}return E._sourcePositions}setNormalsForCPUSkinning(){const E=this._internalMeshDataInfo;if(!E._sourceNormals){const b=this.getVerticesData(B.g.NormalKind);if(!b)return E._sourceNormals;E._sourceNormals=new Float32Array(b),this.isVertexBufferUpdatable(B.g.NormalKind)||this.Ga(B.g.NormalKind,b,!0)}return E._sourceNormals}applySkeleton(E){if(!this.Lj)return this;if(this.Lj._softwareSkinningFrameId==this.va().getFrameId())return this;if(this.Lj._softwareSkinningFrameId=this.va().getFrameId(),!this.isVerticesDataPresent(B.g.PositionKind))return this;if(!this.isVerticesDataPresent(B.g.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(B.g.MatricesWeightsKind))return this;const b=this.isVerticesDataPresent(B.g.NormalKind),h=this._internalMeshDataInfo;if(!h._sourcePositions){const E=this.wg.slice();this.setPositionsForCPUSkinning(),this.wg=E}b&&!h._sourceNormals&&this.setNormalsForCPUSkinning();let a=this.getVerticesData(B.g.PositionKind);if(!a)return this;a instanceof Float32Array||(a=new Float32Array(a));let k=this.getVerticesData(B.g.NormalKind);if(b){if(!k)return this;k instanceof Float32Array||(k=new Float32Array(k))}const G=this.getVerticesData(B.g.MatricesIndicesKind),V=this.getVerticesData(B.g.MatricesWeightsKind);if(!V||!G)return this;const l=this.numBoneInfluencers>4,O=l?this.getVerticesData(B.g.MatricesIndicesExtraKind):null,s=l?this.getVerticesData(B.g.MatricesWeightsExtraKind):null,U=E.getTransformMatrices(this),o=v.k.Zero(),u=new v.d,D=new v.d;let g,S=0;for(let B=0;B<a.length;B+=3,S+=4){let E;for(g=0;g<4;g++)E=V[S+g],E>0&&(v.d.FromFloat32ArrayToRefScaled(U,Math.floor(16*G[S+g]),E,D),u.addToSelf(D));if(l)for(g=0;g<4;g++)E=s[S+g],E>0&&(v.d.FromFloat32ArrayToRefScaled(U,Math.floor(16*O[S+g]),E,D),u.addToSelf(D));v.k.TransformCoordinatesFromFloatsToRef(h._sourcePositions[B],h._sourcePositions[B+1],h._sourcePositions[B+2],u,o),o.toArray(a,B),b&&(v.k.TransformNormalFromFloatsToRef(h._sourceNormals[B],h._sourceNormals[B+1],h._sourceNormals[B+2],u,o),o.toArray(k,B)),u.reset()}return this.updateVerticesData(B.g.PositionKind,a),b&&this.updateVerticesData(B.g.NormalKind,k),this}static MinMax(E){let b=null,h=null;return E.forEach((function(E){const a=E.getBoundingInfo().boundingBox;b&&h?(b.minimizeInPlace(a.minimumWorld),h.maximizeInPlace(a.maximumWorld)):(b=a.minimumWorld,h=a.maximumWorld)})),b&&h?{min:b,max:h}:{min:v.k.Zero(),max:v.k.Zero()}}static Center(E){const b=E instanceof Array?N.MinMax(E):E;return v.k.Center(b.min,b.max)}static MergeMeshes(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],h=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,k=arguments.length>4?arguments[4]:void 0,G=arguments.length>5?arguments[5]:void 0;return(0,l.h)(N._MergeMeshesCoroutine(E,b,h,a,k,G,!1))}static MergeMeshesAsync(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],h=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,k=arguments.length>4?arguments[4]:void 0,G=arguments.length>5?arguments[5]:void 0;return(0,l.d)(N._MergeMeshesCoroutine(E,b,h,a,k,G,!0),(0,l.b)())}static*_MergeMeshesCoroutine(E){let b,h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=arguments.length>2?arguments[2]:void 0,k=arguments.length>3?arguments[3]:void 0,G=arguments.length>4?arguments[4]:void 0,V=arguments.length>5?arguments[5]:void 0,l=arguments.length>6?arguments[6]:void 0;if(0===(E=E.filter(Boolean)).length)return null;if(!a){let h=0;for(b=0;b<E.length;b++)if(h+=E[b].getTotalVertices(),h>=65536)return P.c.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}V&&(G=!1);const O=new Array,v=new Array,s=new Array,U=E[0].sideOrientation;for(b=0;b<E.length;b++){const h=E[b];if(h.isAnInstance)return P.c.Warn("Cannot merge instance meshes."),null;if(U!==h.sideOrientation)return P.c.Warn("Cannot merge meshes with different sideOrientation values."),null;if(G&&s.push(h.getTotalIndices()),V)if(h.material){const E=h.material;if(E instanceof M.b){for(let b=0;b<E.xg.length;b++)O.indexOf(E.xg[b])<0&&O.push(E.xg[b]);for(let b=0;b<h.wg.length;b++)v.push(O.indexOf(E.xg[h.wg[b].materialIndex])),s.push(h.wg[b].indexCount)}else{O.indexOf(E)<0&&O.push(E);for(let b=0;b<h.wg.length;b++)v.push(O.indexOf(E)),s.push(h.wg[b].indexCount)}}else for(let E=0;E<h.wg.length;E++)v.push(0),s.push(h.wg[E].indexCount)}const B=E[0],u=E=>{const b=E.Wj(!0);return{vertexData:o.c.ExtractFromMesh(E,!1,!1),transform:b}},{vertexData:D,transform:S}=u(B);l&&(yield);const I=new Array(E.length-1);for(let o=1;o<E.length;o++)I[o-1]=u(E[o]),l&&(yield);const j=D._mergeCoroutine(S,I,a,l,!h);let A=j.next();for(;!A.done;)l&&(yield),A=j.next();const n=A.value;k||(k=new N(B.name+"_merged",B.va()));const d=n._applyToCoroutine(k,void 0,l);let c=d.next();for(;!c.done;)l&&(yield),c=d.next();if(k.checkCollisions=B.checkCollisions,k.sideOrientation=B.sideOrientation,h)for(b=0;b<E.length;b++)E[b].dispose();if(G||V){k.releaseSubMeshes(),b=0;let E=0;for(;b<s.length;)g.b.CreateFromIndices(0,E,s[b],k,void 0,!1),E+=s[b],b++;for(const b of k.wg)b.refreshBoundingInfo();k.Wj(!0)}if(V){const E=new M.b(B.name+"_merged",B.va());E.xg=O;for(let b=0;b<k.wg.length;b++)k.wg[b].materialIndex=v[b];k.material=E}else k.material=B.material;return k}Oj(E){E._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(E)}Nj(E){const b=E._indexInSourceMeshInstanceArray;if(-1!=b){if(b!==this.instances.length-1){const E=this.instances[this.instances.length-1];this.instances[b]=E,E._indexInSourceMeshInstanceArray=b}E._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===S.c.CounterClockWiseSideOrientation}_getRenderingFillMode(E){const b=this.va();return b.forcePointsCloud?S.c.PointFillMode:b.forceWireframe?S.c.WireFrameFillMode:this.overrideRenderingFillMode??E}setMaterialByID(E){return this.setMaterialById(E)}static CreateRibbon(E,b,h,a,k,G,V,l,O){throw new Error("Import MeshBuilder to populate this function")}static CreateDisc(E,b,h,a,k,G){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(E,b,h,a,k){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(E,b,h,a,k,G){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(E,b,h,a){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(E,b,h,a,k,G,V,l,O){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(E,b,h,a,k,G,V){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(E,b,h,a,k,G,V,l,O,v){throw new Error("Import MeshBuilder to populate this function")}static pb(E,b,h,a,k){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(E,b,h,a,k,G,V,l){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(E,b,h,a,k,G,V){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(E,b,h,a,k,G,V,l){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(E,b,h,a,k,G,V,l,O,v){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(E,b,h,a,k,G,V,l,O,v,s,U){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(E,b,h,a,k,G,V){throw new Error("Import MeshBuilder to populate this function")}static Ag(E,b,h,a,k){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(E,b,h,a,k,G){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(E,b,h,a,k,G,V,l,O){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(E,b,h,a,k,G,V,l,O,v,s){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(E,b,h,a,k,G,V,l,O,v){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(E,b,h){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(E,b,h){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(E,b,h,a,k,G){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(E,b,h){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(E){throw new Error("Import MeshBuilder to populate this function")}}N.FRONTSIDE=o.c.FRONTSIDE,N.BACKSIDE=o.c.BACKSIDE,N.DOUBLESIDE=o.c.DOUBLESIDE,N.DEFAULTSIDE=o.c.DEFAULTSIDE,N.NO_CAP=0,N.CAP_START=1,N.CAP_END=2,N.CAP_ALL=3,N.NO_FLIP=0,N.FLIP_TILE=1,N.ROTATE_TILE=2,N.FLIP_ROW=3,N.ROTATE_ROW=4,N.FLIP_N_ROTATE_TILE=5,N.FLIP_N_ROTATE_ROW=6,N.CENTER=0,N.LEFT=1,N.RIGHT=2,N.TOP=3,N.BOTTOM=4,N.INSTANCEDMESH_SORT_TRANSPARENT=!1,N._GroundMeshParser=(E,b)=>{throw(0,n.c)("GroundMesh")},N._GoldbergMeshParser=(E,b)=>{throw(0,n.c)("GoldbergMesh")},N._LinesMeshParser=(E,b)=>{throw(0,n.c)("LinesMesh")},N._GreasedLineMeshParser=(E,b)=>{throw(0,n.c)("GreasedLineMesh")},N._GreasedLineRibbonMeshParser=(E,b)=>{throw(0,n.c)("GreasedLineRibbonMesh")},N._TrailMeshParser=(E,b)=>{throw(0,n.c)("TrailMesh")},(0,A.f)("BABYLON.Mesh",N)},11435:(E,b,h)=>{"use strict";h.d(b,{c:()=>u});var a=h(11130),k=h(11175),G=h(11233),V=h(10855),l=h(11201),O=h(10834),v=h(11139),s=h(11422),U=h(10883),B=h(11319);class o{}class u{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,s.c)(this._applyToCoroutine.bind(this)),this.uniqueId=u._UniqueIDGenerator,u._UniqueIDGenerator++}set(E,b){switch(E.length||O.c.Warn(`Setting vertex data kind '${b}' with an empty array`),b){case G.g.PositionKind:this.xa=E;break;case G.g.NormalKind:this.ya=E;break;case G.g.TangentKind:this.tangents=E;break;case G.g.UVKind:this.Aa=E;break;case G.g.UV2Kind:this.uvs2=E;break;case G.g.UV3Kind:this.uvs3=E;break;case G.g.UV4Kind:this.uvs4=E;break;case G.g.UV5Kind:this.uvs5=E;break;case G.g.UV6Kind:this.uvs6=E;break;case G.g.ColorKind:this.za=E;break;case G.g.MatricesIndicesKind:this.matricesIndices=E;break;case G.g.MatricesWeightsKind:this.matricesWeights=E;break;case G.g.MatricesIndicesExtraKind:this.matricesIndicesExtra=E;break;case G.g.MatricesWeightsExtraKind:this.matricesWeightsExtra=E}}Ca(E,b){return this._applyTo(E,b,!1),this}applyToGeometry(E,b){return this._applyTo(E,b,!1),this}updateMesh(E){return this._update(E),this}updateGeometry(E){return this._update(E),this}*_applyToCoroutine(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2?arguments[2]:void 0;if(this.xa&&(E.Ga(G.g.PositionKind,this.xa,b),h&&(yield)),this.ya&&(E.Ga(G.g.NormalKind,this.ya,b),h&&(yield)),this.tangents&&(E.Ga(G.g.TangentKind,this.tangents,b),h&&(yield)),this.Aa&&(E.Ga(G.g.UVKind,this.Aa,b),h&&(yield)),this.uvs2&&(E.Ga(G.g.UV2Kind,this.uvs2,b),h&&(yield)),this.uvs3&&(E.Ga(G.g.UV3Kind,this.uvs3,b),h&&(yield)),this.uvs4&&(E.Ga(G.g.UV4Kind,this.uvs4,b),h&&(yield)),this.uvs5&&(E.Ga(G.g.UV5Kind,this.uvs5,b),h&&(yield)),this.uvs6&&(E.Ga(G.g.UV6Kind,this.uvs6,b),h&&(yield)),this.za&&(E.Ga(G.g.ColorKind,this.za,b),this.hasVertexAlpha&&void 0!==E.hasVertexAlpha&&(E.hasVertexAlpha=!0),h&&(yield)),this.matricesIndices&&(E.Ga(G.g.MatricesIndicesKind,this.matricesIndices,b),h&&(yield)),this.matricesWeights&&(E.Ga(G.g.MatricesWeightsKind,this.matricesWeights,b),h&&(yield)),this.matricesIndicesExtra&&(E.Ga(G.g.MatricesIndicesExtraKind,this.matricesIndicesExtra,b),h&&(yield)),this.matricesWeightsExtra&&(E.Ga(G.g.MatricesWeightsExtraKind,this.matricesWeightsExtra,b),h&&(yield)),this.indices?(E.setIndices(this.indices,null,b),h&&(yield)):E.setIndices([],null),E.wg&&this.materialInfos&&this.materialInfos.length>1){const b=E;b.wg=[];for(const E of this.materialInfos)new B.b(E.materialIndex,E.verticesStart,E.verticesCount,E.indexStart,E.indexCount,b)}return this}_update(E,b,h){return this.xa&&E.updateVerticesData(G.g.PositionKind,this.xa,b,h),this.ya&&E.updateVerticesData(G.g.NormalKind,this.ya,b,h),this.tangents&&E.updateVerticesData(G.g.TangentKind,this.tangents,b,h),this.Aa&&E.updateVerticesData(G.g.UVKind,this.Aa,b,h),this.uvs2&&E.updateVerticesData(G.g.UV2Kind,this.uvs2,b,h),this.uvs3&&E.updateVerticesData(G.g.UV3Kind,this.uvs3,b,h),this.uvs4&&E.updateVerticesData(G.g.UV4Kind,this.uvs4,b,h),this.uvs5&&E.updateVerticesData(G.g.UV5Kind,this.uvs5,b,h),this.uvs6&&E.updateVerticesData(G.g.UV6Kind,this.uvs6,b,h),this.za&&E.updateVerticesData(G.g.ColorKind,this.za,b,h),this.matricesIndices&&E.updateVerticesData(G.g.MatricesIndicesKind,this.matricesIndices,b,h),this.matricesWeights&&E.updateVerticesData(G.g.MatricesWeightsKind,this.matricesWeights,b,h),this.matricesIndicesExtra&&E.updateVerticesData(G.g.MatricesIndicesExtraKind,this.matricesIndicesExtra,b,h),this.matricesWeightsExtra&&E.updateVerticesData(G.g.MatricesWeightsExtraKind,this.matricesWeightsExtra,b,h),this.indices&&E.setIndices(this.indices,null),this}static _TransformVector3Coordinates(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E.length;const G=k.h.o[0],V=k.h.o[1];for(let l=h;l<h+a;l+=3)k.k.FromArrayToRef(E,l,G),k.k.TransformCoordinatesToRef(G,b,V),E[l]=V.x,E[l+1]=V.y,E[l+2]=V.z}static _TransformVector3Normals(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E.length;const G=k.h.o[0],V=k.h.o[1];for(let l=h;l<h+a;l+=3)k.k.FromArrayToRef(E,l,G),k.k.TransformNormalToRef(G,b,V),E[l]=V.x,E[l+1]=V.y,E[l+2]=V.z}static _TransformVector4Normals(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E.length;const G=k.h.Vector4[0],V=k.h.Vector4[1];for(let l=h;l<h+a;l+=4)k.n.FromArrayToRef(E,l,G),k.n.TransformNormalToRef(G,b,V),E[l]=V.x,E[l+1]=V.y,E[l+2]=V.z,E[l+3]=V.w}static _FlipFaces(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:E.length;for(let a=b;a<b+h;a+=3){const b=E[a+1];E[a+1]=E[a+2],E[a+2]=b}}transform(E){const b=E.determinant()<0;return this.xa&&u._TransformVector3Coordinates(this.xa,E),this.ya&&u._TransformVector3Normals(this.ya,E),this.tangents&&u._TransformVector4Normals(this.tangents,E),b&&this.indices&&u._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const E=[];for(const b of this.materialInfos){const h=new u;if(this.xa&&(h.xa=this.xa.slice(3*b.verticesStart,3*(b.verticesCount+b.verticesStart))),this.ya&&(h.ya=this.ya.slice(3*b.verticesStart,3*(b.verticesCount+b.verticesStart))),this.tangents&&(h.tangents=this.tangents.slice(4*b.verticesStart,4*(b.verticesCount+b.verticesStart))),this.za&&(h.za=this.za.slice(4*b.verticesStart,4*(b.verticesCount+b.verticesStart))),this.Aa&&(h.Aa=this.Aa.slice(2*b.verticesStart,2*(b.verticesCount+b.verticesStart))),this.uvs2&&(h.uvs2=this.uvs2.slice(2*b.verticesStart,2*(b.verticesCount+b.verticesStart))),this.uvs3&&(h.uvs3=this.uvs3.slice(2*b.verticesStart,2*(b.verticesCount+b.verticesStart))),this.uvs4&&(h.uvs4=this.uvs4.slice(2*b.verticesStart,2*(b.verticesCount+b.verticesStart))),this.uvs5&&(h.uvs5=this.uvs5.slice(2*b.verticesStart,2*(b.verticesCount+b.verticesStart))),this.uvs6&&(h.uvs6=this.uvs6.slice(2*b.verticesStart,2*(b.verticesCount+b.verticesStart))),this.matricesIndices&&(h.matricesIndices=this.matricesIndices.slice(4*b.verticesStart,4*(b.verticesCount+b.verticesStart))),this.matricesIndicesExtra&&(h.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*b.verticesStart,4*(b.verticesCount+b.verticesStart))),this.matricesWeights&&(h.matricesWeights=this.matricesWeights.slice(4*b.verticesStart,4*(b.verticesCount+b.verticesStart))),this.matricesWeightsExtra&&(h.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*b.verticesStart,4*(b.verticesCount+b.verticesStart))),this.indices){h.indices=[];for(let E=b.indexStart;E<b.indexStart+b.indexCount;E++)h.indices.push(this.indices[E]-b.verticesStart)}const a=new o;a.indexStart=0,a.indexCount=h.indices?h.indices.length:0,a.materialIndex=b.materialIndex,a.verticesStart=0,a.verticesCount=(h.xa?h.xa.length:0)/3,h.materialInfos=[a],E.push(h)}return E}merge(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const G=Array.isArray(E)?E.map((E=>({vertexData:E}))):[{vertexData:E}];return(0,s.h)(this._mergeCoroutine(void 0,G,b,!1,h,a,k))}*_mergeCoroutine(E,b){var h,a;let k=arguments.length>2&&void 0!==arguments[2]&&arguments[2],V=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5],v=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let s=b.map((E=>E.vertexData)),U=this;if(v)for(const G of s)G&&(G._validate(),!this.ya&&G.ya&&(this.ya=new Float32Array(this.xa.length)),!this.tangents&&G.tangents&&(this.tangents=new Float32Array(this.xa.length/3*4)),!this.Aa&&G.Aa&&(this.Aa=new Float32Array(this.xa.length/3*2)),!this.uvs2&&G.uvs2&&(this.uvs2=new Float32Array(this.xa.length/3*2)),!this.uvs3&&G.uvs3&&(this.uvs3=new Float32Array(this.xa.length/3*2)),!this.uvs4&&G.uvs4&&(this.uvs4=new Float32Array(this.xa.length/3*2)),!this.uvs5&&G.uvs5&&(this.uvs5=new Float32Array(this.xa.length/3*2)),!this.uvs6&&G.uvs6&&(this.uvs6=new Float32Array(this.xa.length/3*2)),!this.za&&G.za&&(this.za=new Float32Array(this.xa.length/3*4),this.za.fill(1)),!this.matricesIndices&&G.matricesIndices&&(this.matricesIndices=new Float32Array(this.xa.length/3*4)),!this.matricesWeights&&G.matricesWeights&&(this.matricesWeights=new Float32Array(this.xa.length/3*4)),!this.matricesIndicesExtra&&G.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.xa.length/3*4)),!this.matricesWeightsExtra&&G.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.xa.length/3*4)));for(const G of s)if(G)if(v)this.ya&&!G.ya&&(G.ya=new Float32Array(G.xa.length)),this.tangents&&!G.tangents&&(G.tangents=new Float32Array(G.xa.length/3*4)),this.Aa&&!G.Aa&&(G.Aa=new Float32Array(G.xa.length/3*2)),this.uvs2&&!G.uvs2&&(G.uvs2=new Float32Array(G.xa.length/3*2)),this.uvs3&&!G.uvs3&&(G.uvs3=new Float32Array(G.xa.length/3*2)),this.uvs4&&!G.uvs4&&(G.uvs4=new Float32Array(G.xa.length/3*2)),this.uvs5&&!G.uvs5&&(G.uvs5=new Float32Array(G.xa.length/3*2)),this.uvs6&&!G.uvs6&&(G.uvs6=new Float32Array(G.xa.length/3*2)),this.za&&!G.za&&(G.za=new Float32Array(G.xa.length/3*4),G.za.fill(1)),this.matricesIndices&&!G.matricesIndices&&(G.matricesIndices=new Float32Array(G.xa.length/3*4)),this.matricesWeights&&!G.matricesWeights&&(G.matricesWeights=new Float32Array(G.xa.length/3*4)),this.matricesIndicesExtra&&!G.matricesIndicesExtra&&(G.matricesIndicesExtra=new Float32Array(G.xa.length/3*4)),this.matricesWeightsExtra&&!G.matricesWeightsExtra&&(G.matricesWeightsExtra=new Float32Array(G.xa.length/3*4));else if(G._validate(),!this.ya!==!G.ya||!this.tangents!==!G.tangents||!this.Aa!==!G.Aa||!this.uvs2!==!G.uvs2||!this.uvs3!==!G.uvs3||!this.uvs4!==!G.uvs4||!this.uvs5!==!G.uvs5||!this.uvs6!==!G.uvs6||!this.za!==!G.za||!this.matricesIndices!==!G.matricesIndices||!this.matricesWeights!==!G.matricesWeights||!this.matricesIndicesExtra!==!G.matricesIndicesExtra||!this.matricesWeightsExtra!==!G.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(O){let h=0,a=0,k=0;const G=[];let V=null;const l=[];for(const b of this.splitBasedOnMaterialID())l.push({vertexData:b,transform:E});for(const E of b)if(E.vertexData)for(const b of E.vertexData.splitBasedOnMaterialID())l.push({vertexData:b,transform:E.transform});l.sort(((E,b)=>{const h=E.vertexData.materialInfos?E.vertexData.materialInfos[0].materialIndex:0,a=b.vertexData.materialInfos?b.vertexData.materialInfos[0].materialIndex:0;return h>a?1:h===a?0:-1}));for(const E of l){const b=E.vertexData;if(h=b.materialInfos?b.materialInfos[0].materialIndex:0,V&&V.materialIndex===h)V.indexCount+=b.indices.length,V.verticesCount+=b.xa.length/3;else{const E=new o;E.materialIndex=h,E.indexStart=a,E.indexCount=b.indices.length,E.verticesStart=k,E.verticesCount=b.xa.length/3,G.push(E),V=E}a+=b.indices.length,k+=b.xa.length/3}const O=l.splice(0,1)[0];U=O.vertexData,E=O.transform,s=l.map((E=>E.vertexData)),b=l,this.materialInfos=G}const B=s.reduce(((E,b)=>{var h;return E+((null===(h=b.indices)||void 0===h?void 0:h.length)??0)}),(null===(h=U.indices)||void 0===h?void 0:h.length)??0);let D=l||s.some((E=>E.indices===U.indices))?null===(a=U.indices)||void 0===a?void 0:a.slice():U.indices;if(B>0){var g;let h=(null===(g=D)||void 0===g?void 0:g.length)??0;if(D||(D=new Array(B)),D.length!==B){if(Array.isArray(D))D.length=B;else{const E=k||D instanceof Uint32Array?new Uint32Array(B):new Uint16Array(B);E.set(D),D=E}E&&E.determinant()<0&&u._FlipFaces(D,0,h)}let a=U.xa?U.xa.length/3:0;for(const{vertexData:E,transform:k}of b)if(E.indices){for(let b=0;b<E.indices.length;b++)D[h+b]=E.indices[b]+a;k&&k.determinant()<0&&u._FlipFaces(D,h,E.indices.length),a+=E.xa.length/3,h+=E.indices.length,V&&(yield)}}return this.indices=D,this.xa=u._MergeElement(G.g.PositionKind,U.xa,E,b.map((E=>[E.vertexData.xa,E.transform]))),V&&(yield),U.ya&&(this.ya=u._MergeElement(G.g.NormalKind,U.ya,E,b.map((E=>[E.vertexData.ya,E.transform]))),V&&(yield)),U.tangents&&(this.tangents=u._MergeElement(G.g.TangentKind,U.tangents,E,b.map((E=>[E.vertexData.tangents,E.transform]))),V&&(yield)),U.Aa&&(this.Aa=u._MergeElement(G.g.UVKind,U.Aa,E,b.map((E=>[E.vertexData.Aa,E.transform]))),V&&(yield)),U.uvs2&&(this.uvs2=u._MergeElement(G.g.UV2Kind,U.uvs2,E,b.map((E=>[E.vertexData.uvs2,E.transform]))),V&&(yield)),U.uvs3&&(this.uvs3=u._MergeElement(G.g.UV3Kind,U.uvs3,E,b.map((E=>[E.vertexData.uvs3,E.transform]))),V&&(yield)),U.uvs4&&(this.uvs4=u._MergeElement(G.g.UV4Kind,U.uvs4,E,b.map((E=>[E.vertexData.uvs4,E.transform]))),V&&(yield)),U.uvs5&&(this.uvs5=u._MergeElement(G.g.UV5Kind,U.uvs5,E,b.map((E=>[E.vertexData.uvs5,E.transform]))),V&&(yield)),U.uvs6&&(this.uvs6=u._MergeElement(G.g.UV6Kind,U.uvs6,E,b.map((E=>[E.vertexData.uvs6,E.transform]))),V&&(yield)),U.za&&(this.za=u._MergeElement(G.g.ColorKind,U.za,E,b.map((E=>[E.vertexData.za,E.transform]))),(void 0!==U.hasVertexAlpha||b.some((E=>void 0!==E.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=U.hasVertexAlpha||b.some((E=>E.vertexData.hasVertexAlpha))),V&&(yield)),U.matricesIndices&&(this.matricesIndices=u._MergeElement(G.g.MatricesIndicesKind,U.matricesIndices,E,b.map((E=>[E.vertexData.matricesIndices,E.transform]))),V&&(yield)),U.matricesWeights&&(this.matricesWeights=u._MergeElement(G.g.MatricesWeightsKind,U.matricesWeights,E,b.map((E=>[E.vertexData.matricesWeights,E.transform]))),V&&(yield)),U.matricesIndicesExtra&&(this.matricesIndicesExtra=u._MergeElement(G.g.MatricesIndicesExtraKind,U.matricesIndicesExtra,E,b.map((E=>[E.vertexData.matricesIndicesExtra,E.transform]))),V&&(yield)),U.matricesWeightsExtra&&(this.matricesWeightsExtra=u._MergeElement(G.g.MatricesWeightsExtraKind,U.matricesWeightsExtra,E,b.map((E=>[E.vertexData.matricesWeightsExtra,E.transform])))),this}static _MergeElement(E,b,h,a){const k=a.filter((E=>null!==E[0]&&void 0!==E[0]));if(!b&&0==k.length)return b;if(!b)return this._MergeElement(E,k[0][0],k[0][1],k.slice(1));const V=k.reduce(((E,b)=>E+b[0].length),b.length),l=E===G.g.PositionKind?u._TransformVector3Coordinates:E===G.g.NormalKind?u._TransformVector3Normals:E===G.g.TangentKind?u._TransformVector4Normals:()=>{};if(b instanceof Float32Array){const E=new Float32Array(V);E.set(b),h&&l(E,h,0,b.length);let a=b.length;for(const[b,h]of k)E.set(b,a),h&&l(E,h,a,b.length),a+=b.length;return E}{const E=new Array(V);for(let h=0;h<b.length;h++)E[h]=b[h];h&&l(E,h,0,b.length);let a=b.length;for(const[b,h]of k){for(let h=0;h<b.length;h++)E[a+h]=b[h];h&&l(E,h,a,b.length),a+=b.length}return E}}_validate(){if(!this.xa)throw new U.g("Positions are required",U.e.MeshInvalidPositionsError);const E=(E,b)=>{const h=G.g.DeduceStride(E);if(b.length%h!==0)throw new Error("The "+E+"s array count must be a multiple of "+h);return b.length/h},b=E(G.g.PositionKind,this.xa),h=(h,a)=>{const k=E(h,a);if(k!==b)throw new Error("The "+h+"s element count ("+k+") does not match the positions count ("+b+")")};this.ya&&h(G.g.NormalKind,this.ya),this.tangents&&h(G.g.TangentKind,this.tangents),this.Aa&&h(G.g.UVKind,this.Aa),this.uvs2&&h(G.g.UV2Kind,this.uvs2),this.uvs3&&h(G.g.UV3Kind,this.uvs3),this.uvs4&&h(G.g.UV4Kind,this.uvs4),this.uvs5&&h(G.g.UV5Kind,this.uvs5),this.uvs6&&h(G.g.UV6Kind,this.uvs6),this.za&&h(G.g.ColorKind,this.za),this.matricesIndices&&h(G.g.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&h(G.g.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&h(G.g.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&h(G.g.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const E=this.serialize();return u.Parse(E)}serialize(){const E={};if(this.xa&&(E.xa=Array.from(this.xa)),this.ya&&(E.ya=Array.from(this.ya)),this.tangents&&(E.tangents=Array.from(this.tangents)),this.Aa&&(E.Aa=Array.from(this.Aa)),this.uvs2&&(E.uvs2=Array.from(this.uvs2)),this.uvs3&&(E.uvs3=Array.from(this.uvs3)),this.uvs4&&(E.uvs4=Array.from(this.uvs4)),this.uvs5&&(E.uvs5=Array.from(this.uvs5)),this.uvs6&&(E.uvs6=Array.from(this.uvs6)),this.za&&(E.za=Array.from(this.za),E.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(E.matricesIndices=Array.from(this.matricesIndices),E.matricesIndices._isExpanded=!0),this.matricesWeights&&(E.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(E.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),E.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(E.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),E.indices=Array.from(this.indices),this.materialInfos){E.materialInfos=[];for(const b of this.materialInfos){const h={indexStart:b.indexStart,indexCount:b.indexCount,materialIndex:b.materialIndex,verticesStart:b.verticesStart,verticesCount:b.verticesCount};E.materialInfos.push(h)}}return E}static ExtractFromMesh(E,b,h){return u._ExtractFrom(E,b,h)}static ExtractFromGeometry(E,b,h){return u._ExtractFrom(E,b,h)}static _ExtractFrom(E,b,h){const a=new u;if(E.isVerticesDataPresent(G.g.PositionKind)&&(a.xa=E.getVerticesData(G.g.PositionKind,b,h)),E.isVerticesDataPresent(G.g.NormalKind)&&(a.ya=E.getVerticesData(G.g.NormalKind,b,h)),E.isVerticesDataPresent(G.g.TangentKind)&&(a.tangents=E.getVerticesData(G.g.TangentKind,b,h)),E.isVerticesDataPresent(G.g.UVKind)&&(a.Aa=E.getVerticesData(G.g.UVKind,b,h)),E.isVerticesDataPresent(G.g.UV2Kind)&&(a.uvs2=E.getVerticesData(G.g.UV2Kind,b,h)),E.isVerticesDataPresent(G.g.UV3Kind)&&(a.uvs3=E.getVerticesData(G.g.UV3Kind,b,h)),E.isVerticesDataPresent(G.g.UV4Kind)&&(a.uvs4=E.getVerticesData(G.g.UV4Kind,b,h)),E.isVerticesDataPresent(G.g.UV5Kind)&&(a.uvs5=E.getVerticesData(G.g.UV5Kind,b,h)),E.isVerticesDataPresent(G.g.UV6Kind)&&(a.uvs6=E.getVerticesData(G.g.UV6Kind,b,h)),E.isVerticesDataPresent(G.g.ColorKind)){const k=E.Lj||E,V=k.getVertexBuffer(G.g.ColorKind),l=k.getVerticesData(G.g.ColorKind,b,h);if(3===V.getSize()){const E=new Float32Array(4*l.length/3);for(let b=0,h=0;b<l.length;b+=3,h+=4)E[h]=l[b],E[h+1]=l[b+1],E[h+2]=l[b+2],E[h+3]=1;a.za=E}else{if(4!==V.getSize())throw new Error(`Unexpected number of color components: ${V.getSize()}`);a.za=l}}return E.isVerticesDataPresent(G.g.MatricesIndicesKind)&&(a.matricesIndices=E.getVerticesData(G.g.MatricesIndicesKind,b,h)),E.isVerticesDataPresent(G.g.MatricesWeightsKind)&&(a.matricesWeights=E.getVerticesData(G.g.MatricesWeightsKind,b,h)),E.isVerticesDataPresent(G.g.MatricesIndicesExtraKind)&&(a.matricesIndicesExtra=E.getVerticesData(G.g.MatricesIndicesExtraKind,b,h)),E.isVerticesDataPresent(G.g.MatricesWeightsExtraKind)&&(a.matricesWeightsExtra=E.getVerticesData(G.g.MatricesWeightsExtraKind,b,h)),a.indices=E.rg(b,h),a}static CreateRibbon(E){throw(0,V.c)("ribbonBuilder")}static CreateBox(E){throw(0,V.c)("boxBuilder")}static CreateTiledBox(E){throw(0,V.c)("tiledBoxBuilder")}static CreateTiledPlane(E){throw(0,V.c)("tiledPlaneBuilder")}static CreateSphere(E){throw(0,V.c)("sphereBuilder")}static CreateCylinder(E){throw(0,V.c)("cylinderBuilder")}static CreateTorus(E){throw(0,V.c)("torusBuilder")}static CreateLineSystem(E){throw(0,V.c)("linesBuilder")}static CreateDashedLines(E){throw(0,V.c)("linesBuilder")}static CreateGround(E){throw(0,V.c)("groundBuilder")}static CreateTiledGround(E){throw(0,V.c)("groundBuilder")}static CreateGroundFromHeightMap(E){throw(0,V.c)("groundBuilder")}static Ag(E){throw(0,V.c)("planeBuilder")}static CreateDisc(E){throw(0,V.c)("discBuilder")}static CreatePolygon(E,b,h,a,k,G,l){throw(0,V.c)("polygonBuilder")}static CreateIcoSphere(E){throw(0,V.c)("icoSphereBuilder")}static CreatePolyhedron(E){throw(0,V.c)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||k.k.Up();throw(0,V.c)("capsuleBuilder")}static CreateTorusKnot(E){throw(0,V.c)("torusKnotBuilder")}static ComputeNormals(E,b,h,a){let G=0,V=0,l=0,O=0,v=0,s=0,U=0,B=0,o=0,u=0,D=0,g=0,S=0,M=0,I=0,j=0,P=0,A=0,n=0,d=0,c=!1,z=!1,Z=!1,Y=!1,r=1,w=0,N=null;a&&(c=!!a.facetNormals,z=!!a.facetPositions,Z=!!a.facetPartitioning,r=!0===a.useRightHandedSystem?-1:1,w=a.ratio||0,Y=!!a.depthSort,N=a.distanceTo,Y&&void 0===N&&(N=k.k.Zero()));let H=0,f=0,F=0,y=0;for(Z&&a&&a.bbSize&&(H=a.subDiv.X*w/a.bbSize.x,f=a.subDiv.Y*w/a.bbSize.y,F=a.subDiv.Z*w/a.bbSize.z,y=a.subDiv.max*a.subDiv.max,a.facetPartitioning.length=0),G=0;G<E.length;G++)h[G]=0;const e=b.length/3|0;for(G=0;G<e;G++){if(g=3*b[3*G],S=g+1,M=g+2,I=3*b[3*G+1],j=I+1,P=I+2,A=3*b[3*G+2],n=A+1,d=A+2,V=E[g]-E[I],l=E[S]-E[j],O=E[M]-E[P],v=E[A]-E[I],s=E[n]-E[j],U=E[d]-E[P],B=r*(l*U-O*s),o=r*(O*v-V*U),u=r*(V*s-l*v),D=Math.sqrt(B*B+o*o+u*u),D=0===D?1:D,B/=D,o/=D,u/=D,c&&a&&(a.facetNormals[G].x=B,a.facetNormals[G].y=o,a.facetNormals[G].z=u),z&&a&&(a.facetPositions[G].x=(E[g]+E[I]+E[A])/3,a.facetPositions[G].y=(E[S]+E[j]+E[n])/3,a.facetPositions[G].z=(E[M]+E[P]+E[d])/3),Z&&a){const b=Math.floor((a.facetPositions[G].x-a.bInfo.minimum.x*w)*H),h=Math.floor((a.facetPositions[G].y-a.bInfo.minimum.y*w)*f),k=Math.floor((a.facetPositions[G].z-a.bInfo.minimum.z*w)*F),V=Math.floor((E[g]-a.bInfo.minimum.x*w)*H),l=Math.floor((E[S]-a.bInfo.minimum.y*w)*f),O=Math.floor((E[M]-a.bInfo.minimum.z*w)*F),v=Math.floor((E[I]-a.bInfo.minimum.x*w)*H),s=Math.floor((E[j]-a.bInfo.minimum.y*w)*f),U=Math.floor((E[P]-a.bInfo.minimum.z*w)*F),B=Math.floor((E[A]-a.bInfo.minimum.x*w)*H),o=Math.floor((E[n]-a.bInfo.minimum.y*w)*f),u=Math.floor((E[d]-a.bInfo.minimum.z*w)*F),D=V+a.subDiv.max*l+y*O,c=v+a.subDiv.max*s+y*U,z=B+a.subDiv.max*o+y*u,Z=b+a.subDiv.max*h+y*k;a.facetPartitioning[Z]=a.facetPartitioning[Z]?a.facetPartitioning[Z]:new Array,a.facetPartitioning[D]=a.facetPartitioning[D]?a.facetPartitioning[D]:new Array,a.facetPartitioning[c]=a.facetPartitioning[c]?a.facetPartitioning[c]:new Array,a.facetPartitioning[z]=a.facetPartitioning[z]?a.facetPartitioning[z]:new Array,a.facetPartitioning[D].push(G),c!=D&&a.facetPartitioning[c].push(G),z!=c&&z!=D&&a.facetPartitioning[z].push(G),Z!=D&&Z!=c&&Z!=z&&a.facetPartitioning[Z].push(G)}if(Y&&a&&a.facetPositions){const E=a.depthSortedFacets[G];E.ind=3*G,E.sqDistance=k.k.DistanceSquared(a.facetPositions[G],N)}h[g]+=B,h[S]+=o,h[M]+=u,h[I]+=B,h[j]+=o,h[P]+=u,h[A]+=B,h[n]+=o,h[d]+=u}for(G=0;G<h.length/3;G++)B=h[3*G],o=h[3*G+1],u=h[3*G+2],D=Math.sqrt(B*B+o*o+u*u),D=0===D?1:D,B/=D,o/=D,u/=D,h[3*G]=B,h[3*G+1]=o,h[3*G+2]=u}static _ComputeSides(E,b,h,a,G,V,l){const O=h.length,v=a.length;let s,U;switch(E=E||u.DEFAULTSIDE){case u.FRONTSIDE:break;case u.BACKSIDE:for(s=0;s<O;s+=3){const E=h[s];h[s]=h[s+2],h[s+2]=E}for(U=0;U<v;U++)a[U]=-a[U];break;case u.DOUBLESIDE:{const E=b.length,B=E/3;for(let h=0;h<E;h++)b[E+h]=b[h];for(s=0;s<O;s+=3)h[s+O]=h[s+2]+B,h[s+1+O]=h[s+1]+B,h[s+2+O]=h[s]+B;for(U=0;U<v;U++)a[v+U]=-a[U];const o=G.length;let u=0;for(u=0;u<o;u++)G[u+o]=G[u];for(V=V||new k.n(0,0,1,1),l=l||new k.n(0,0,1,1),u=0,s=0;s<o/2;s++)G[u]=V.x+(V.z-V.x)*G[u],G[u+1]=V.y+(V.w-V.y)*G[u+1],G[u+o]=l.x+(l.z-l.x)*G[u+o],G[u+o+1]=l.y+(l.w-l.y)*G[u+o+1],u+=2;break}}}static Parse(E){const b=new u,h=E.xa;h&&b.set(h,G.g.PositionKind);const a=E.ya;a&&b.set(a,G.g.NormalKind);const k=E.tangents;k&&b.set(k,G.g.TangentKind);const V=E.Aa;V&&b.set(V,G.g.UVKind);const O=E.uvs2;O&&b.set(O,G.g.UV2Kind);const v=E.uvs3;v&&b.set(v,G.g.UV3Kind);const s=E.uvs4;s&&b.set(s,G.g.UV4Kind);const U=E.uvs5;U&&b.set(U,G.g.UV5Kind);const B=E.uvs6;B&&b.set(B,G.g.UV6Kind);const D=E.za;D&&(b.set(l.f.CheckColors4(D,h.length/3),G.g.ColorKind),void 0!==E.hasVertexAlpha&&(b.hasVertexAlpha=E.hasVertexAlpha));const g=E.matricesIndices;g&&b.set(g,G.g.MatricesIndicesKind);const S=E.matricesWeights;S&&b.set(S,G.g.MatricesWeightsKind);const M=E.indices;M&&(b.indices=M);const I=E.materialInfos;if(I){b.materialInfos=[];for(const E of I){const h=new o;h.indexCount=E.indexCount,h.indexStart=E.indexStart,h.verticesCount=E.verticesCount,h.verticesStart=E.verticesStart,h.materialIndex=E.materialIndex,b.materialInfos.push(h)}}return b}static ImportVertexData(E,b){const h=u.Parse(E);b.setAllVerticesData(h,E.updatable)}}u.FRONTSIDE=0,u.BACKSIDE=1,u.DOUBLESIDE=2,u.DEFAULTSIDE=0,u._UniqueIDGenerator=0,(0,a.d)([v.d.filter((function(){for(var E=arguments.length,b=new Array(E),h=0;h<E;h++)b[h]=arguments[h];let[a]=b;return!Array.isArray(a)}))],u,"_TransformVector3Coordinates",null),(0,a.d)([v.d.filter((function(){for(var E=arguments.length,b=new Array(E),h=0;h<E;h++)b[h]=arguments[h];let[a]=b;return!Array.isArray(a)}))],u,"_TransformVector3Normals",null),(0,a.d)([v.d.filter((function(){for(var E=arguments.length,b=new Array(E),h=0;h<E;h++)b[h]=arguments[h];let[a]=b;return!Array.isArray(a)}))],u,"_TransformVector4Normals",null),(0,a.d)([v.d.filter((function(){for(var E=arguments.length,b=new Array(E),h=0;h<E;h++)b[h]=arguments[h];let[a]=b;return!Array.isArray(a)}))],u,"_FlipFaces",null)},12578:(E,b,h)=>{"use strict";h.d(b,{c:()=>DE});var a=h(11175),k=h(11419),G=h(11233),V=h(11435),l=h(11389);function O(E){let b=E.pathArray;const h=E.closeArray||!1,a=E.closePath||!1,k=E.invertUV||!1,O=Math.floor(b[0].length/2);let v=E.offset||O;v=v>O?O:Math.floor(v);const s=0===E.sideOrientation?0:E.sideOrientation||V.c.DEFAULTSIDE,U=E.Aa,B=E.za,o=[],u=[],D=[],g=[],S=[],M=[],I=[],j=[];let P;const A=[],n=[];let d,c,z;if(b.length<2){const E=[],h=[];for(c=0;c<b[0].length-v;c++)E.push(b[0][c]),h.push(b[0][c+v]);b=[E,h]}let Z=0;const Y=a?1:0,r=h?1:0;let w,N,H,f,F,y;for(P=b[0].length,d=0;d<b.length+r;d++){for(I[d]=0,S[d]=[0],w=d===b.length?b[0]:b[d],N=w.length,P=P<N?P:N,z=0;z<N;)o.push(w[z].x,w[z].y,w[z].z),z>0&&(H=w[z].Xc(w[z-1]).length(),f=H+I[d],S[d].push(f),I[d]=f),z++;a&&(z--,o.push(w[0].x,w[0].y,w[0].z),H=w[z].Xc(w[0]).length(),f=H+I[d],S[d].push(f),I[d]=f),A[d]=N+Y,n[d]=Z,Z+=N+Y}let e,J,m=null,K=null;for(c=0;c<P+Y;c++)for(j[c]=0,M[c]=[0],d=0;d<b.length-1+r;d++)F=b[d],y=d===b.length-1?b[0]:b[d+1],c===P?(m=F[0],K=y[0]):(m=F[c],K=y[c]),H=K.Xc(m).length(),f=H+j[c],M[c].push(f),j[c]=f;if(U)for(d=0;d<U.length;d++)g.push(U[d].x,l.c?1-U[d].y:U[d].y);else for(d=0;d<b.length+r;d++)for(c=0;c<P+Y;c++)e=0!=I[d]?S[d][c]/I[d]:0,J=0!=j[c]?M[c][d]/j[c]:0,k?g.push(J,e):g.push(e,l.c?1-J:J);d=0;let x=0,W=A[d]-1,L=A[d+1]-1,t=W<L?W:L,T=n[1]-n[0];const X=A.length-1;for(;x<=t&&d<X;)u.push(x,x+T,x+1),u.push(x+T+1,x+1,x+T),x+=1,x===t&&(d++,T=n[d+1]-n[d],W=A[d]-1,L=A[d+1]-1,x=n[d],t=W<L?W+x:L+x);if(V.c.ComputeNormals(o,u,D),a){let E=0,h=0;for(d=0;d<b.length;d++){E=3*n[d],h=d+1<b.length?3*(n[d+1]-1):D.length-3,D[E]=.5*(D[E]+D[h]),D[E+1]=.5*(D[E+1]+D[h+1]),D[E+2]=.5*(D[E+2]+D[h+2]);const a=Math.sqrt(D[E]*D[E]+D[E+1]*D[E+1]+D[E+2]*D[E+2]);D[E]/=a,D[E+1]/=a,D[E+2]/=a,D[h]=D[E],D[h+1]=D[E+1],D[h+2]=D[E+2]}}if(h){let E=3*n[0],h=3*n[b.length];for(c=0;c<P+Y;c++){D[E]=.5*(D[E]+D[h]),D[E+1]=.5*(D[E+1]+D[h+1]),D[E+2]=.5*(D[E+2]+D[h+2]);const b=Math.sqrt(D[E]*D[E]+D[E+1]*D[E+1]+D[E+2]*D[E+2]);D[E]/=b,D[E+1]/=b,D[E+2]/=b,D[h]=D[E],D[h+1]=D[E+1],D[h+2]=D[E+2],E+=3,h+=3}}V.c._ComputeSides(s,o,u,D,g,E.frontUVs,E.backUVs);let C=null;if(B){C=new Float32Array(4*B.length);for(let E=0;E<B.length;E++)C[4*E]=B[E].r,C[4*E+1]=B[E].g,C[4*E+2]=B[E].b,C[4*E+3]=B[E].a}const q=new V.c,R=new Float32Array(o),Q=new Float32Array(D),i=new Float32Array(g);return q.indices=u,q.xa=R,q.ya=Q,q.Aa=i,C&&q.set(C,G.g.ColorKind),a&&(q._idx=n),q}function v(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=b.pathArray,s=b.closeArray,U=b.closePath,B=k.b._GetDefaultSideOrientation(b.sideOrientation),o=b.instance,u=b.updatable;if(o){const E=a.h.o[0].te(Number.MAX_VALUE),h=a.h.o[1].te(-Number.MAX_VALUE),O=b=>{let a=v[0].length;const G=o;let V=0;const l=G._originalBuilderSideOrientation===k.b.DOUBLESIDE?2:1;for(let k=1;k<=l;++k)for(let l=0;l<v.length;++l){const k=v[l],O=k.length;a=a<O?a:O;for(let G=0;G<a;++G){const a=k[G];b[V]=a.x,b[V+1]=a.y,b[V+2]=a.z,E.minimizeInPlaceFromFloats(a.x,a.y,a.z),h.maximizeInPlaceFromFloats(a.x,a.y,a.z),V+=3}if(G._creationDataStorage&&G._creationDataStorage.closePath){const E=k[0];b[V]=E.x,b[V+1]=E.y,b[V+2]=E.z,V+=3}}},s=o.getVerticesData(G.g.PositionKind);if(O(s),o.hasBoundingInfo?o.getBoundingInfo().reConstruct(E,h,o._worldMatrix):o.buildBoundingInfo(E,h,o._worldMatrix),o.updateVerticesData(G.g.PositionKind,s,!1,!1),b.za){const E=o.getVerticesData(G.g.ColorKind);for(let h=0,a=0;h<b.za.length;h++,a+=4){const k=b.za[h];E[a]=k.r,E[a+1]=k.g,E[a+2]=k.b,E[a+3]=k.a}o.updateVerticesData(G.g.ColorKind,E,!1,!1)}if(b.Aa){const E=o.getVerticesData(G.g.UVKind);for(let h=0;h<b.Aa.length;h++)E[2*h]=b.Aa[h].x,E[2*h+1]=l.c?1-b.Aa[h].y:b.Aa[h].y;o.updateVerticesData(G.g.UVKind,E,!1,!1)}if(!o.areNormalsFrozen||o.isFacetDataEnabled){const E=o.rg(),b=o.getVerticesData(G.g.NormalKind),h=o.isFacetDataEnabled?o.getFacetDataParameters():null;if(V.c.ComputeNormals(s,E,b,h),o._creationDataStorage&&o._creationDataStorage.closePath){let E=0,h=0;for(let a=0;a<v.length;a++)E=3*o._creationDataStorage.idx[a],h=a+1<v.length?3*(o._creationDataStorage.idx[a+1]-1):b.length-3,b[E]=.5*(b[E]+b[h]),b[E+1]=.5*(b[E+1]+b[h+1]),b[E+2]=.5*(b[E+2]+b[h+2]),b[h]=b[E],b[h+1]=b[E+1],b[h+2]=b[E+2]}o.areNormalsFrozen||o.updateVerticesData(G.g.NormalKind,b,!1,!1)}return o}{const a=new k.b(E,h);a._originalBuilderSideOrientation=B,a._creationDataStorage=new k.f;const G=O(b);return U&&(a._creationDataStorage.idx=G._idx),a._creationDataStorage.closePath=U,a._creationDataStorage.closeArray=s,G.Ca(a,u),a}}V.c.CreateRibbon=O,k.b.CreateRibbon=function(E,b){return v(E,{pathArray:b,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var s=h(11822),U=h(11480),B=h(11201);function o(E){const b=E.pattern||k.b.NO_FLIP,h=E.tileWidth||E.tileSize||1,a=E.tileHeight||E.tileSize||1,G=E.alignHorizontal||0,l=E.alignVertical||0,O=E.width||E.size||1,v=Math.floor(O/h);let s=O-v*h;const U=E.height||E.size||1,B=Math.floor(U/a);let o=U-B*a;const u=h*v/2,D=a*B/2;let g=0,S=0,M=0,I=0,j=0,P=0;if(s>0||o>0){switch(M=-u,I=-D,j=u,P=D,G){case k.b.CENTER:s/=2,M-=s,j+=s;break;case k.b.LEFT:j+=s,g=-s/2;break;case k.b.RIGHT:M-=s,g=s/2}switch(l){case k.b.CENTER:o/=2,I-=o,P+=o;break;case k.b.BOTTOM:P+=o,S=-o/2;break;case k.b.TOP:I-=o,S=o/2}}const A=[],n=[],d=[];d[0]=[0,0,1,0,1,1,0,1],d[1]=[0,0,1,0,1,1,0,1],b!==k.b.ROTATE_TILE&&b!==k.b.ROTATE_ROW||(d[1]=[1,1,0,1,0,0,1,0]),b!==k.b.FLIP_TILE&&b!==k.b.FLIP_ROW||(d[1]=[1,0,0,0,0,1,1,1]),b!==k.b.FLIP_N_ROTATE_TILE&&b!==k.b.FLIP_N_ROTATE_ROW||(d[1]=[0,1,1,1,1,0,0,0]);let c=[];const z=[],Z=[];let Y=0;for(let V=0;V<B;V++)for(let E=0;E<v;E++)A.push(E*h-u+g,V*a-D+S,0),A.push((E+1)*h-u+g,V*a-D+S,0),A.push((E+1)*h-u+g,(V+1)*a-D+S,0),A.push(E*h-u+g,(V+1)*a-D+S,0),Z.push(Y,Y+1,Y+3,Y+1,Y+2,Y+3),c=b===k.b.FLIP_TILE||b===k.b.ROTATE_TILE||b===k.b.FLIP_N_ROTATE_TILE?c.concat(d[(E%2+V%2)%2]):b===k.b.FLIP_ROW||b===k.b.ROTATE_ROW||b===k.b.FLIP_N_ROTATE_ROW?c.concat(d[V%2]):c.concat(d[0]),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),n.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),Y+=4;if(s>0||o>0){const E=o>0&&(l===k.b.CENTER||l===k.b.TOP),V=o>0&&(l===k.b.CENTER||l===k.b.BOTTOM),O=s>0&&(G===k.b.CENTER||G===k.b.RIGHT),U=s>0&&(G===k.b.CENTER||G===k.b.LEFT);let d,r,w,N,H=[];if(E&&O&&(A.push(M+g,I+S,0),A.push(-u+g,I+S,0),A.push(-u+g,I+o+S,0),A.push(M+g,I+o+S,0),Z.push(Y,Y+1,Y+3,Y+1,Y+2,Y+3),Y+=4,d=1-s/h,r=1-o/a,w=1,N=1,H=[d,r,w,r,w,N,d,N],b===k.b.ROTATE_ROW&&(H=[1-d,1-r,1-w,1-r,1-w,1-N,1-d,1-N]),b===k.b.FLIP_ROW&&(H=[1-d,r,1-w,r,1-w,N,1-d,N]),b===k.b.FLIP_N_ROTATE_ROW&&(H=[d,1-r,w,1-r,w,1-N,d,1-N]),c=c.concat(H),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),n.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),E&&U&&(A.push(u+g,I+S,0),A.push(j+g,I+S,0),A.push(j+g,I+o+S,0),A.push(u+g,I+o+S,0),Z.push(Y,Y+1,Y+3,Y+1,Y+2,Y+3),Y+=4,d=0,r=1-o/a,w=s/h,N=1,H=[d,r,w,r,w,N,d,N],(b===k.b.ROTATE_ROW||b===k.b.ROTATE_TILE&&v%2===0)&&(H=[1-d,1-r,1-w,1-r,1-w,1-N,1-d,1-N]),(b===k.b.FLIP_ROW||b===k.b.FLIP_TILE&&v%2===0)&&(H=[1-d,r,1-w,r,1-w,N,1-d,N]),(b===k.b.FLIP_N_ROTATE_ROW||b===k.b.FLIP_N_ROTATE_TILE&&v%2===0)&&(H=[d,1-r,w,1-r,w,1-N,d,1-N]),c=c.concat(H),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),n.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),V&&O&&(A.push(M+g,D+S,0),A.push(-u+g,D+S,0),A.push(-u+g,P+S,0),A.push(M+g,P+S,0),Z.push(Y,Y+1,Y+3,Y+1,Y+2,Y+3),Y+=4,d=1-s/h,r=0,w=1,N=o/a,H=[d,r,w,r,w,N,d,N],(b===k.b.ROTATE_ROW&&B%2===1||b===k.b.ROTATE_TILE&&B%1===0)&&(H=[1-d,1-r,1-w,1-r,1-w,1-N,1-d,1-N]),(b===k.b.FLIP_ROW&&B%2===1||b===k.b.FLIP_TILE&&B%2===0)&&(H=[1-d,r,1-w,r,1-w,N,1-d,N]),(b===k.b.FLIP_N_ROTATE_ROW&&B%2===1||b===k.b.FLIP_N_ROTATE_TILE&&B%2===0)&&(H=[d,1-r,w,1-r,w,1-N,d,1-N]),c=c.concat(H),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),n.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),V&&U&&(A.push(u+g,D+S,0),A.push(j+g,D+S,0),A.push(j+g,P+S,0),A.push(u+g,P+S,0),Z.push(Y,Y+1,Y+3,Y+1,Y+2,Y+3),Y+=4,d=0,r=0,w=s/h,N=o/a,H=[d,r,w,r,w,N,d,N],(b===k.b.ROTATE_ROW&&B%2===1||b===k.b.ROTATE_TILE&&(B+v)%2===1)&&(H=[1-d,1-r,1-w,1-r,1-w,1-N,1-d,1-N]),(b===k.b.FLIP_ROW&&B%2===1||b===k.b.FLIP_TILE&&(B+v)%2===1)&&(H=[1-d,r,1-w,r,1-w,N,1-d,N]),(b===k.b.FLIP_N_ROTATE_ROW&&B%2===1||b===k.b.FLIP_N_ROTATE_TILE&&(B+v)%2===1)&&(H=[d,1-r,w,1-r,w,1-N,d,1-N]),c=c.concat(H),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),n.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),E){const E=[];d=0,r=1-o/a,w=1,N=1,E[0]=[d,r,w,r,w,N,d,N],E[1]=[d,r,w,r,w,N,d,N],b!==k.b.ROTATE_TILE&&b!==k.b.ROTATE_ROW||(E[1]=[1-d,1-r,1-w,1-r,1-w,1-N,1-d,1-N]),b!==k.b.FLIP_TILE&&b!==k.b.FLIP_ROW||(E[1]=[1-d,r,1-w,r,1-w,N,1-d,N]),b!==k.b.FLIP_N_ROTATE_TILE&&b!==k.b.FLIP_N_ROTATE_ROW||(E[1]=[d,1-r,w,1-r,w,1-N,d,1-N]);for(let a=0;a<v;a++)A.push(a*h-u+g,I+S,0),A.push((a+1)*h-u+g,I+S,0),A.push((a+1)*h-u+g,I+o+S,0),A.push(a*h-u+g,I+o+S,0),Z.push(Y,Y+1,Y+3,Y+1,Y+2,Y+3),Y+=4,c=b===k.b.FLIP_TILE||b===k.b.ROTATE_TILE||b===k.b.FLIP_N_ROTATE_TILE?c.concat(E[(a+1)%2]):b===k.b.FLIP_ROW||b===k.b.ROTATE_ROW||b===k.b.FLIP_N_ROTATE_ROW?c.concat(E[1]):c.concat(E[0]),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),n.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(V){const E=[];d=0,r=0,w=1,N=o/a,E[0]=[d,r,w,r,w,N,d,N],E[1]=[d,r,w,r,w,N,d,N],b!==k.b.ROTATE_TILE&&b!==k.b.ROTATE_ROW||(E[1]=[1-d,1-r,1-w,1-r,1-w,1-N,1-d,1-N]),b!==k.b.FLIP_TILE&&b!==k.b.FLIP_ROW||(E[1]=[1-d,r,1-w,r,1-w,N,1-d,N]),b!==k.b.FLIP_N_ROTATE_TILE&&b!==k.b.FLIP_N_ROTATE_ROW||(E[1]=[d,1-r,w,1-r,w,1-N,d,1-N]);for(let a=0;a<v;a++)A.push(a*h-u+g,P-o+S,0),A.push((a+1)*h-u+g,P-o+S,0),A.push((a+1)*h-u+g,P+S,0),A.push(a*h-u+g,P+S,0),Z.push(Y,Y+1,Y+3,Y+1,Y+2,Y+3),Y+=4,c=b===k.b.FLIP_TILE||b===k.b.ROTATE_TILE||b===k.b.FLIP_N_ROTATE_TILE?c.concat(E[(a+B)%2]):b===k.b.FLIP_ROW||b===k.b.ROTATE_ROW||b===k.b.FLIP_N_ROTATE_ROW?c.concat(E[B%2]):c.concat(E[0]),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),n.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(O){const E=[];d=1-s/h,r=0,w=1,N=1,E[0]=[d,r,w,r,w,N,d,N],E[1]=[d,r,w,r,w,N,d,N],b!==k.b.ROTATE_TILE&&b!==k.b.ROTATE_ROW||(E[1]=[1-d,1-r,1-w,1-r,1-w,1-N,1-d,1-N]),b!==k.b.FLIP_TILE&&b!==k.b.FLIP_ROW||(E[1]=[1-d,r,1-w,r,1-w,N,1-d,N]),b!==k.b.FLIP_N_ROTATE_TILE&&b!==k.b.FLIP_N_ROTATE_ROW||(E[1]=[d,1-r,w,1-r,w,1-N,d,1-N]);for(let h=0;h<B;h++)A.push(M+g,h*a-D+S,0),A.push(M+s+g,h*a-D+S,0),A.push(M+s+g,(h+1)*a-D+S,0),A.push(M+g,(h+1)*a-D+S,0),Z.push(Y,Y+1,Y+3,Y+1,Y+2,Y+3),Y+=4,c=b===k.b.FLIP_TILE||b===k.b.ROTATE_TILE||b===k.b.FLIP_N_ROTATE_TILE?c.concat(E[(h+1)%2]):b===k.b.FLIP_ROW||b===k.b.ROTATE_ROW||b===k.b.FLIP_N_ROTATE_ROW?c.concat(E[h%2]):c.concat(E[0]),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),n.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(U){const E=[];d=0,r=0,w=s/a,N=1,E[0]=[d,r,w,r,w,N,d,N],E[1]=[d,r,w,r,w,N,d,N],b!==k.b.ROTATE_TILE&&b!==k.b.ROTATE_ROW||(E[1]=[1-d,1-r,1-w,1-r,1-w,1-N,1-d,1-N]),b!==k.b.FLIP_TILE&&b!==k.b.FLIP_ROW||(E[1]=[1-d,r,1-w,r,1-w,N,1-d,N]),b!==k.b.FLIP_N_ROTATE_TILE&&b!==k.b.FLIP_N_ROTATE_ROW||(E[1]=[d,1-r,w,1-r,w,1-N,d,1-N]);for(let h=0;h<B;h++)A.push(j-s+g,h*a-D+S,0),A.push(j+g,h*a-D+S,0),A.push(j+g,(h+1)*a-D+S,0),A.push(j-s+g,(h+1)*a-D+S,0),Z.push(Y,Y+1,Y+3,Y+1,Y+2,Y+3),Y+=4,c=b===k.b.FLIP_TILE||b===k.b.ROTATE_TILE||b===k.b.FLIP_N_ROTATE_TILE?c.concat(E[(h+v)%2]):b===k.b.FLIP_ROW||b===k.b.ROTATE_ROW||b===k.b.FLIP_N_ROTATE_ROW?c.concat(E[h%2]):c.concat(E[0]),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),n.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const r=0===E.sideOrientation?0:E.sideOrientation||V.c.DEFAULTSIDE;V.c._ComputeSides(r,A,Z,n,c,E.frontUVs,E.backUVs);const w=new V.c;w.indices=Z,w.xa=A,w.ya=n,w.Aa=c;const N=r===V.c.DOUBLESIDE?z.concat(z):z;return w.za=N,w}function u(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=new k.b(E,h);b.sideOrientation=k.b._GetDefaultSideOrientation(b.sideOrientation),a._originalBuilderSideOrientation=b.sideOrientation;return o(b).Ca(a,b.updatable),a}function D(E){const b=E.faceUV||new Array(6),h=E.faceColors,G=E.pattern||k.b.NO_FLIP,O=E.width||E.size||1,v=E.height||E.size||1,s=E.depth||E.size||1,U=E.tileWidth||E.tileSize||1,u=E.tileHeight||E.tileSize||1,D=E.alignHorizontal||0,g=E.alignVertical||0,S=0===E.sideOrientation?0:E.sideOrientation||V.c.DEFAULTSIDE;for(let k=0;k<6;k++)void 0===b[k]&&(b[k]=new a.n(0,0,1,1)),h&&void 0===h[k]&&(h[k]=new B.f(1,1,1,1));const M=O/2,I=v/2,j=s/2,P=[];for(let a=0;a<2;a++)P[a]=o({pattern:G,tileWidth:U,tileHeight:u,width:O,height:v,alignVertical:g,alignHorizontal:D,sideOrientation:S});for(let a=2;a<4;a++)P[a]=o({pattern:G,tileWidth:U,tileHeight:u,width:s,height:v,alignVertical:g,alignHorizontal:D,sideOrientation:S});let A=g;g===k.b.BOTTOM?A=k.b.TOP:g===k.b.TOP&&(A=k.b.BOTTOM);for(let a=4;a<6;a++)P[a]=o({pattern:G,tileWidth:U,tileHeight:u,width:O,height:s,alignVertical:A,alignHorizontal:D,sideOrientation:S});let n=[],d=[],c=[],z=[];const Z=[],Y=[],r=[],w=[];let N=0,H=0;for(let k=0;k<6;k++){const E=P[k].xa.length;Y[k]=[],r[k]=[];for(let b=0;b<E/3;b++)Y[k].push(new a.k(P[k].xa[3*b],P[k].xa[3*b+1],P[k].xa[3*b+2])),r[k].push(new a.k(P[k].ya[3*b],P[k].ya[3*b+1],P[k].ya[3*b+2]));N=P[k].Aa.length,w[k]=[];for(let h=0;h<N;h+=2)w[k][h]=b[k].x+(b[k].z-b[k].x)*P[k].Aa[h],w[k][h+1]=b[k].y+(b[k].w-b[k].y)*P[k].Aa[h+1],l.c&&(w[k][h+1]=1-w[k][h+1]);if(c=c.concat(w[k]),z=z.concat(P[k].indices.map((E=>E+H))),H+=Y[k].length,h)for(let b=0;b<4;b++)Z.push(h[k].r,h[k].g,h[k].b,h[k].a)}const f=new a.k(0,0,j),F=a.d.RotationY(Math.PI);n=Y[0].map((E=>a.k.TransformNormal(E,F).add(f))).map((E=>[E.x,E.y,E.z])).reduce(((E,b)=>E.concat(b)),[]),d=r[0].map((E=>a.k.TransformNormal(E,F))).map((E=>[E.x,E.y,E.z])).reduce(((E,b)=>E.concat(b)),[]),n=n.concat(Y[1].map((E=>E.Xc(f))).map((E=>[E.x,E.y,E.z])).reduce(((E,b)=>E.concat(b)),[])),d=d.concat(r[1].map((E=>[E.x,E.y,E.z])).reduce(((E,b)=>E.concat(b)),[]));const y=new a.k(M,0,0),e=a.d.RotationY(-Math.PI/2);n=n.concat(Y[2].map((E=>a.k.TransformNormal(E,e).add(y))).map((E=>[E.x,E.y,E.z])).reduce(((E,b)=>E.concat(b)),[])),d=d.concat(r[2].map((E=>a.k.TransformNormal(E,e))).map((E=>[E.x,E.y,E.z])).reduce(((E,b)=>E.concat(b)),[]));const J=a.d.RotationY(Math.PI/2);n=n.concat(Y[3].map((E=>a.k.TransformNormal(E,J).Xc(y))).map((E=>[E.x,E.y,E.z])).reduce(((E,b)=>E.concat(b)),[])),d=d.concat(r[3].map((E=>a.k.TransformNormal(E,J))).map((E=>[E.x,E.y,E.z])).reduce(((E,b)=>E.concat(b)),[]));const m=new a.k(0,I,0),K=a.d.RotationX(Math.PI/2);n=n.concat(Y[4].map((E=>a.k.TransformNormal(E,K).add(m))).map((E=>[E.x,E.y,E.z])).reduce(((E,b)=>E.concat(b)),[])),d=d.concat(r[4].map((E=>a.k.TransformNormal(E,K))).map((E=>[E.x,E.y,E.z])).reduce(((E,b)=>E.concat(b)),[]));const x=a.d.RotationX(-Math.PI/2);n=n.concat(Y[5].map((E=>a.k.TransformNormal(E,x).Xc(m))).map((E=>[E.x,E.y,E.z])).reduce(((E,b)=>E.concat(b)),[])),d=d.concat(r[5].map((E=>a.k.TransformNormal(E,x))).map((E=>[E.x,E.y,E.z])).reduce(((E,b)=>E.concat(b)),[])),V.c._ComputeSides(S,n,z,d,c);const W=new V.c;if(W.indices=z,W.xa=n,W.ya=d,W.Aa=c,h){const E=S===V.c.DOUBLESIDE?Z.concat(Z):Z;W.za=E}return W}function g(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=new k.b(E,h);b.sideOrientation=k.b._GetDefaultSideOrientation(b.sideOrientation),a._originalBuilderSideOrientation=b.sideOrientation;return D(b).Ca(a,b.updatable),a}V.c.CreateTiledPlane=o;V.c.CreateTiledBox=D;var S=h(11812),M=h(11163),I=h(11466);function j(E){const b=E.height||2;let h=0===E.diameterTop?0:E.diameterTop||E.diameter||1,G=0===E.diameterBottom?0:E.diameterBottom||E.diameter||1;h=h||1e-5,G=G||1e-5;const O=0|(E.tessellation||24),v=0|(E.subdivisions||1),s=!!E.hasRings,U=!!E.enclose,o=0===E.cap?0:E.cap||k.b.CAP_ALL,u=E.arc&&(E.arc<=0||E.arc>1)?1:E.arc||1,D=0===E.sideOrientation?0:E.sideOrientation||V.c.DEFAULTSIDE,g=E.faceUV||new Array(3),S=E.faceColors,M=2+(1+(1!==u&&U?2:0))*(s?v:1);let j;for(j=0;j<M;j++)S&&void 0===S[j]&&(S[j]=new B.f(1,1,1,1));for(j=0;j<M;j++)g&&void 0===g[j]&&(g[j]=new a.n(0,0,1,1));const P=[],A=[],n=[],d=[],c=[],z=2*Math.PI*u/O;let Z,Y,r;const w=(G-h)/2/b,N=a.k.Zero(),H=a.k.Zero(),f=a.k.Zero(),F=a.k.Zero(),y=a.k.Zero(),e=I.b.Y;let J,m,K,x=1,W=1,L=0,t=0;for(J=0;J<=v;J++)for(Y=J/v,r=(Y*(h-G)+G)/2,x=s&&0!==J&&J!==v?2:1,K=0;K<x;K++){for(s&&(W+=K),U&&(W+=2*K),m=0;m<=O;m++)Z=m*z,N.x=Math.cos(-Z)*r,N.y=-b/2+Y*b,N.z=Math.sin(-Z)*r,0===h&&J===v?(H.x=n[n.length-3*(O+1)],H.y=n[n.length-3*(O+1)+1],H.z=n[n.length-3*(O+1)+2]):(H.x=N.x,H.z=N.z,H.y=Math.sqrt(H.x*H.x+H.z*H.z)*w,H.normalize()),0===m&&(f.p(N),F.p(H)),A.push(N.x,N.y,N.z),n.push(H.x,H.y,H.z),t=s?L!==W?g[W].y:g[W].w:g[W].y+(g[W].w-g[W].y)*Y,d.push(g[W].x+(g[W].z-g[W].x)*m/O,l.c?1-t:t),S&&c.push(S[W].r,S[W].g,S[W].b,S[W].a);1!==u&&U&&(A.push(N.x,N.y,N.z),A.push(0,N.y,0),A.push(0,N.y,0),A.push(f.x,f.y,f.z),a.k.CrossToRef(e,H,y),y.normalize(),n.push(y.x,y.y,y.z,y.x,y.y,y.z),a.k.CrossToRef(F,e,y),y.normalize(),n.push(y.x,y.y,y.z,y.x,y.y,y.z),t=s?L!==W?g[W+1].y:g[W+1].w:g[W+1].y+(g[W+1].w-g[W+1].y)*Y,d.push(g[W+1].x,l.c?1-t:t),d.push(g[W+1].z,l.c?1-t:t),t=s?L!==W?g[W+2].y:g[W+2].w:g[W+2].y+(g[W+2].w-g[W+2].y)*Y,d.push(g[W+2].x,l.c?1-t:t),d.push(g[W+2].z,l.c?1-t:t),S&&(c.push(S[W+1].r,S[W+1].g,S[W+1].b,S[W+1].a),c.push(S[W+1].r,S[W+1].g,S[W+1].b,S[W+1].a),c.push(S[W+2].r,S[W+2].g,S[W+2].b,S[W+2].a),c.push(S[W+2].r,S[W+2].g,S[W+2].b,S[W+2].a))),L!==W&&(L=W)}const T=1!==u&&U?O+4:O;for(J=0,W=0;W<v;W++){let E=0,b=0,h=0,a=0;for(m=0;m<O;m++)E=J*(T+1)+m,b=(J+1)*(T+1)+m,h=J*(T+1)+(m+1),a=(J+1)*(T+1)+(m+1),P.push(E,b,h),P.push(a,h,b);1!==u&&U&&(P.push(E+2,b+2,h+2),P.push(a+2,h+2,b+2),P.push(E+4,b+4,h+4),P.push(a+4,h+4,b+4)),J=s?J+2:J+1}const X=E=>{const k=E?h/2:G/2;if(0===k)return;let V,v,s;const U=E?g[M-1]:g[0];let B=null;S&&(B=E?S[M-1]:S[0]);const o=A.length/3,D=E?b/2:-b/2,I=new a.k(0,D,0);A.push(I.x,I.y,I.z),n.push(0,E?1:-1,0);const j=U.y+.5*(U.w-U.y);d.push(U.x+.5*(U.z-U.x),l.c?1-j:j),B&&c.push(B.r,B.g,B.b,B.a);const z=new a.j(.5,.5);for(s=0;s<=O;s++){V=2*Math.PI*s*u/O;const b=Math.cos(-V),h=Math.sin(-V);v=new a.k(b*k,D,h*k);const G=new a.j(b*z.x+.5,h*z.y+.5);A.push(v.x,v.y,v.z),n.push(0,E?1:-1,0);const o=U.y+(U.w-U.y)*G.y;d.push(U.x+(U.z-U.x)*G.x,l.c?1-o:o),B&&c.push(B.r,B.g,B.b,B.a)}for(s=0;s<O;s++)E?(P.push(o),P.push(o+(s+2)),P.push(o+(s+1))):(P.push(o),P.push(o+(s+1)),P.push(o+(s+2)))};o!==k.b.CAP_START&&o!==k.b.CAP_ALL||X(!1),o!==k.b.CAP_END&&o!==k.b.CAP_ALL||X(!0),V.c._ComputeSides(D,A,P,n,d,E.frontUVs,E.backUVs);const C=new V.c;return C.indices=P,C.xa=A,C.ya=n,C.Aa=d,S&&(C.za=c),C}function P(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;const a=new k.b(E,h);b.sideOrientation=k.b._GetDefaultSideOrientation(b.sideOrientation),a._originalBuilderSideOrientation=b.sideOrientation;return j(b).Ca(a,b.updatable),a}function A(E){const b=[],h=[],k=[],G=[],O=E.diameter||1,v=E.thickness||.5,s=0|(E.tessellation||16),U=0===E.sideOrientation?0:E.sideOrientation||V.c.DEFAULTSIDE,B=s+1;for(let V=0;V<=s;V++){const E=V/s,U=V*Math.PI*2/s-Math.PI/2,o=a.d.Translation(O/2,0,0).multiply(a.d.RotationY(U));for(let O=0;O<=s;O++){const U=1-O/s,u=O*Math.PI*2/s+Math.PI,D=Math.cos(u),g=Math.sin(u);let S=new a.k(D,g,0),M=S.scale(v/2);const I=new a.j(E,U);M=a.k.TransformCoordinates(M,o),S=a.k.TransformNormal(S,o),h.push(M.x,M.y,M.z),k.push(S.x,S.y,S.z),G.push(I.x,l.c?1-I.y:I.y);const j=(V+1)%B,P=(O+1)%B;b.push(V*B+O),b.push(V*B+P),b.push(j*B+O),b.push(V*B+P),b.push(j*B+P),b.push(j*B+O)}}V.c._ComputeSides(U,h,b,k,G,E.frontUVs,E.backUVs);const o=new V.c;return o.indices=b,o.xa=h,o.ya=k,o.Aa=G,o}function n(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;const a=new k.b(E,h);b.sideOrientation=k.b._GetDefaultSideOrientation(b.sideOrientation),a._originalBuilderSideOrientation=b.sideOrientation;return A(b).Ca(a,b.updatable),a}V.c.CreateCylinder=j,k.b.CreateCylinder=(E,b,h,a,G,V,l,O,v)=>{void 0!==l&&l instanceof M.e||(void 0!==l&&(v=O||k.b.DEFAULTSIDE,O=l),l=V,V=1);return P(E,{height:b,diameterTop:h,diameterBottom:a,tessellation:G,subdivisions:V,sideOrientation:v,updatable:O},l)};function d(E){const b=[],h=[],k=[],G=[],O=E.radius||2,v=E.tube||.5,s=E.radialSegments||32,U=E.tubularSegments||32,B=E.p||2,o=E.q||3,u=0===E.sideOrientation?0:E.sideOrientation||V.c.DEFAULTSIDE,D=E=>{const b=Math.cos(E),h=Math.sin(E),k=o/B*E,G=Math.cos(k),V=O*(2+G)*.5*b,l=O*(2+G)*h*.5,v=O*Math.sin(k)*.5;return new a.k(V,l,v)};let g,S;for(g=0;g<=s;g++){const E=g%s/s*2*B*Math.PI,b=D(E),k=D(E+.01),V=k.Xc(b);let O=k.add(b);const o=a.k.Cross(V,O);for(O=a.k.Cross(o,V),o.normalize(),O.normalize(),S=0;S<U;S++){const E=S%U/U*2*Math.PI,a=-v*Math.cos(E),k=v*Math.sin(E);h.push(b.x+a*O.x+k*o.x),h.push(b.y+a*O.y+k*o.y),h.push(b.z+a*O.z+k*o.z),G.push(g/s),G.push(l.c?1-S/U:S/U)}}for(g=0;g<s;g++)for(S=0;S<U;S++){const E=(S+1)%U,h=g*U+S,a=(g+1)*U+S,k=(g+1)*U+E,G=g*U+E;b.push(G),b.push(a),b.push(h),b.push(G),b.push(k),b.push(a)}V.c.ComputeNormals(h,b,k),V.c._ComputeSides(u,h,b,k,G,E.frontUVs,E.backUVs);const M=new V.c;return M.indices=b,M.xa=h,M.ya=k,M.Aa=G,M}function c(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;const a=new k.b(E,h);b.sideOrientation=k.b._GetDefaultSideOrientation(b.sideOrientation),a._originalBuilderSideOrientation=b.sideOrientation;return d(b).Ca(a,b.updatable),a}V.c.CreateTorus=A,k.b.CreateTorus=(E,b,h,a,k,G,V)=>n(E,{diameter:b,thickness:h,tessellation:a,sideOrientation:V,updatable:G},k);V.c.CreateTorusKnot=d,k.b.CreateTorusKnot=(E,b,h,a,k,G,V,l,O,v)=>c(E,{radius:b,tube:h,radialSegments:a,tubularSegments:k,p:G,q:V,sideOrientation:v,updatable:O},l);var z=h(12585),Z=h(10834),Y=h(11673),r=h(11177),w=h(10869);class N extends a.j{constructor(E,b){super(E.x,E.y),this.index=b}}class H{constructor(){this.elements=[]}add(E){const b=[];return E.forEach((E=>{const h=new N(E,this.elements.length);b.push(h),this.elements.push(h)})),b}computeBounds(){const E=new a.j(this.elements[0].x,this.elements[0].y),b=new a.j(this.elements[0].x,this.elements[0].y);return this.elements.forEach((h=>{h.x<E.x?E.x=h.x:h.x>b.x&&(b.x=h.x),h.y<E.y?E.y=h.y:h.y>b.y&&(b.y=h.y)})),{min:E,max:b,width:b.x-E.x,height:b.y-E.y}}}class f{_addToepoint(E){for(const b of E)this._epoints.push(b.x,b.y)}constructor(E,b,h){let a,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new H,this._outlinepoints=new H,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=k,this._name=E,this._scene=h||w.b.LastCreatedScene,a=b instanceof Y.h?b.getPoints():b,this._addToepoint(a),this._points.add(a),this._outlinepoints.add(a),"undefined"===typeof this.bjsEarcut&&Z.c.Warn("Earcut was not found, the polygon will not be built.")}addHole(E){this._points.add(E);const b=new H;return b.add(E),this._holes.push(b),this._eholes.push(this._epoints.length/2),this._addToepoint(E),this}build(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const a=new k.b(this._name,this._scene),V=this.buildVertexData(b,h);return a.Ga(G.g.PositionKind,V.xa,E),a.Ga(G.g.NormalKind,V.ya,E),a.Ga(G.g.UVKind,V.Aa,E),a.setIndices(V.indices),a}buildVertexData(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const h=new V.c,a=[],k=[],G=[],l=this._points.computeBounds();this._points.elements.forEach((E=>{a.push(0,1,0),k.push(E.x,0,E.y),G.push((E.x-l.min.x)/l.width,(E.y-l.min.y)/l.height)}));const O=[],v=this.bjsEarcut(this._epoints,this._eholes,2);for(let V=0;V<v.length;V++)O.push(v[V]);if(E>0){const h=k.length/3;this._points.elements.forEach((b=>{a.push(0,-1,0),k.push(b.x,-E,b.y),G.push(1-(b.x-l.min.x)/l.width,1-(b.y-l.min.y)/l.height)}));const V=O.length;for(let E=0;E<V;E+=3){const b=O[E+0],a=O[E+1],k=O[E+2];O.push(k+h),O.push(a+h),O.push(b+h)}this._addSide(k,a,G,O,l,this._outlinepoints,E,!1,b),this._holes.forEach((h=>{this._addSide(k,a,G,O,l,h,E,!0,b)}))}return h.indices=O,h.xa=k,h.ya=a,h.Aa=G,h}_addSide(E,b,h,k,G,V,l,O,v){let s=E.length/3,U=0;for(let B=0;B<V.elements.length;B++){const o=V.elements[B],u=V.elements[(B+1)%V.elements.length];E.push(o.x,0,o.y),E.push(o.x,-l,o.y),E.push(u.x,0,u.y),E.push(u.x,-l,u.y);const D=V.elements[(B+V.elements.length-1)%V.elements.length],g=V.elements[(B+2)%V.elements.length];let S=new a.k(-(u.y-o.y),0,u.x-o.x),M=new a.k(-(o.y-D.y),0,o.x-D.x),I=new a.k(-(g.y-u.y),0,g.x-u.x);O||(S=S.scale(-1),M=M.scale(-1),I=I.scale(-1));const j=S.normalizeToNew();let P=M.normalizeToNew(),A=I.normalizeToNew();const n=a.k.Dot(P,j);P=n>v?n<r.d-1?new a.k(o.x,0,o.y).Xc(new a.k(u.x,0,u.y)).normalize():M.add(S).normalize():j;const d=a.k.Dot(I,S);A=d>v?d<r.d-1?new a.k(u.x,0,u.y).Xc(new a.k(o.x,0,o.y)).normalize():I.add(S).normalize():j,h.push(U/G.width,0),h.push(U/G.width,1),U+=S.length(),h.push(U/G.width,0),h.push(U/G.width,1),b.push(P.x,P.y,P.z),b.push(P.x,P.y,P.z),b.push(A.x,A.y,A.z),b.push(A.x,A.y,A.z),O?(k.push(s),k.push(s+2),k.push(s+1),k.push(s+1),k.push(s+2),k.push(s+3)):(k.push(s),k.push(s+1),k.push(s+2),k.push(s+1),k.push(s+3),k.push(s+2)),s+=4}}}function F(E,b,h,k,O,v,s){const U=h||new Array(3),o=k,u=[],D=s||!1;for(let G=0;G<3;G++)void 0===U[G]&&(U[G]=new a.n(0,0,1,1)),o&&void 0===o[G]&&(o[G]=new B.f(1,1,1,1));const g=E.getVerticesData(G.g.PositionKind),S=E.getVerticesData(G.g.NormalKind),M=E.getVerticesData(G.g.UVKind),I=E.rg(),j=g.length/9;let P=0,A=0,n=0,d=0,c=0;const z=[0];if(D)for(let a=j;a<g.length/3;a+=4)A=g[3*(a+2)]-g[3*a],n=g[3*(a+2)+2]-g[3*a+2],d=Math.sqrt(A*A+n*n),c+=d,z.push(c);let Z=0,Y=0;for(let a=0;a<S.length;a+=3)Math.abs(S[a+1])<.001&&(Y=1),Math.abs(S[a+1]-1)<.001&&(Y=0),Math.abs(S[a+1]+1)<.001&&(Y=2),Z=a/3,1===Y?(P=Z-j,M[2*Z]=P%4<1.5?D?U[Y].x+(U[Y].z-U[Y].x)*z[Math.floor(P/4)]/c:U[Y].x:D?U[Y].x+(U[Y].z-U[Y].x)*z[Math.floor(P/4)+1]/c:U[Y].z,M[2*Z+1]=P%2===0?l.c?1-U[Y].w:U[Y].w:l.c?1-U[Y].y:U[Y].y):(M[2*Z]=(1-M[2*Z])*U[Y].x+M[2*Z]*U[Y].z,M[2*Z+1]=(1-M[2*Z+1])*U[Y].y+M[2*Z+1]*U[Y].w,l.c&&(M[2*Z+1]=1-M[2*Z+1])),o&&u.push(o[Y].r,o[Y].g,o[Y].b,o[Y].a);V.c._ComputeSides(b,g,I,S,M,O,v);const r=new V.c;if(r.indices=I,r.xa=g,r.ya=S,r.Aa=M,o){const E=b===V.c.DOUBLESIDE?u.concat(u):u;r.za=E}return r}function y(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;b.sideOrientation=k.b._GetDefaultSideOrientation(b.sideOrientation);const V=b.shape,l=b.holes||[],O=b.depth||0,v=b.smoothingThreshold||2,s=[];let U=[];for(let k=0;k<V.length;k++)s[k]=new a.j(V[k].x,V[k].z);s[0].equalsWithEpsilon(s[s.length-1],1e-8)&&s.pop();const B=new f(E,s,h||w.b.LastCreatedScene,G);for(let k=0;k<l.length;k++){U=[];for(let E=0;E<l[k].length;E++)U.push(new a.j(l[k][E].x,l[k][E].z));B.addHole(U)}const o=B.build(!1,O,v);o._originalBuilderSideOrientation=b.sideOrientation;return F(o,b.sideOrientation,b.faceUV,b.faceColors,b.frontUVs,b.backUVs,b.wrap).Ca(o,b.updatable),o}function e(E,b){return y(E,b,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}function J(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=b.path,G=b.shape,V=b.scale||1,l=b.rotation||0,O=0===b.cap?0:b.cap||k.b.NO_CAP,v=b.updatable,s=k.b._GetDefaultSideOrientation(b.sideOrientation),U=b.instance||null,B=b.invertUV||!1,o=b.closeShape||!1;return K(E,G,a,V,l,null,null,b.closePath||!1,o,O,!1,h,!!v,s,U,B,b.frontUVs||null,b.backUVs||null,b.firstNormal||null,!!b.adjustFrame)}function m(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=b.path,G=b.shape,V=b.scaleFunction||(()=>1),l=b.rotationFunction||(()=>0),O=b.closePath||b.ribbonCloseArray||!1,v=b.closeShape||b.ribbonClosePath||!1,s=0===b.cap?0:b.cap||k.b.NO_CAP,U=b.updatable,B=b.firstNormal||null,o=b.adjustFrame||!1;return K(E,G,a,null,null,V,l,O,v,s,!0,h,!!U,k.b._GetDefaultSideOrientation(b.sideOrientation),b.instance||null,b.invertUV||!1,b.frontUVs||null,b.backUVs||null,B,o)}function K(E,b,h,G,V,l,O,s,U,B,o,u,D,g,S,M,I,j,P,A){const n=(E,b,h,G,V,l,O,v,s,U,B)=>{const o=h.getTangents(),u=h.getNormals(),D=h.getBinormals(),g=h.getDistances();if(B)for(let k=0;k<o.length;k++)if(0==o[k].x&&0==o[k].y&&0==o[k].z&&o[k].p(o[k-1]),0==u[k].x&&0==u[k].y&&0==u[k].z&&u[k].p(u[k-1]),0==D[k].x&&0==D[k].y&&0==D[k].z&&D[k].p(D[k-1]),k>0){let E=o[k-1];a.k.Dot(E,o[k])<0&&o[k].scaleInPlace(-1),E=u[k-1],a.k.Dot(E,u[k])<0&&u[k].scaleInPlace(-1),E=D[k-1],a.k.Dot(E,D[k])<0&&D[k].scaleInPlace(-1)}let S=0;const M=U&&v?v:()=>null!==l?l:0,I=U&&O?O:()=>null!==V?V:1;let j=s===k.b.NO_CAP||s===k.b.CAP_END?0:2;const P=a.h.Matrix[0];for(let k=0;k<b.length;k++){const h=[],V=M(k,g[k]),l=I(k,g[k]);a.d.RotationAxisToRef(o[k],S,P);for(let G=0;G<E.length;G++){const V=o[k].scale(E[G].z).add(u[k].scale(E[G].x)).add(D[k].scale(E[G].y)),O=a.k.Zero();a.k.TransformCoordinatesToRef(V,P,O),O.scaleInPlace(l).addInPlace(b[k]),h[G]=O}G[j]=h,S+=V,j++}const A=E=>{const b=Array(),h=a.k.Zero();let k;for(k=0;k<E.length;k++)h.addInPlace(E[k]);for(h.scaleInPlace(1/E.length),k=0;k<E.length;k++)b.push(h);return b};switch(s){case k.b.NO_CAP:break;case k.b.CAP_START:G[0]=A(G[2]),G[1]=G[2];break;case k.b.CAP_END:G[j]=G[j-1],G[j+1]=A(G[j-1]);break;case k.b.CAP_ALL:G[0]=A(G[2]),G[1]=G[2],G[j]=G[j-1],G[j+1]=A(G[j-1])}return G};let d,c;if(S){const E=S._creationDataStorage;return d=P?E.path3D.update(h,P):E.path3D.update(h),c=n(b,h,E.path3D,E.pathArray,G,V,l,O,E.cap,o,A),S=v("",{pathArray:c,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:S},u||void 0)}d=P?new Y.k(h,P):new Y.k(h);c=n(b,h,d,new Array,G,V,l,O,B=B<0||B>3?0:B,o,A);const z=v(E,{pathArray:c,closeArray:s,closePath:U,updatable:D,sideOrientation:g,invertUV:M,frontUVs:I||void 0,backUVs:j||void 0},u);return z._creationDataStorage.pathArray=c,z._creationDataStorage.path3D=d,z._creationDataStorage.cap=B,z}V.c.CreatePolygon=F,k.b.CreatePolygon=function(E,b,h,a,k,G){return y(E,{shape:b,holes:a,updatable:k,sideOrientation:G},h,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},k.b.ExtrudePolygon=function(E,b,h,a,k,G,V){return e(E,{shape:b,holes:k,depth:h,updatable:G,sideOrientation:V},a,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)};function x(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=b.arc?b.arc<=0||b.arc>1?1:b.arc:1,V=void 0===b.closed||b.closed,l=b.shape,O=b.radius||1,s=b.tessellation||64,U=b.clip||0,B=b.updatable,o=k.b._GetDefaultSideOrientation(b.sideOrientation),u=b.cap||k.b.NO_CAP,D=2*Math.PI,g=[],S=b.invertUV||!1;let M=0,I=0;const j=D/s*G;let P,A;for(M=0;M<=s-U;M++){for(A=[],u!=k.b.CAP_START&&u!=k.b.CAP_ALL||(A.push(new a.k(0,l[0].y,0)),A.push(new a.k(Math.cos(M*j)*l[0].x*O,l[0].y,Math.sin(M*j)*l[0].x*O))),I=0;I<l.length;I++)P=new a.k(Math.cos(M*j)*l[I].x*O,l[I].y,Math.sin(M*j)*l[I].x*O),A.push(P);u!=k.b.CAP_END&&u!=k.b.CAP_ALL||(A.push(new a.k(Math.cos(M*j)*l[l.length-1].x*O,l[l.length-1].y,Math.sin(M*j)*l[l.length-1].x*O)),A.push(new a.k(0,l[l.length-1].y,0))),g.push(A)}return v(E,{pathArray:g,closeArray:V,sideOrientation:o,updatable:B,invertUV:S,frontUVs:b.frontUVs,backUVs:b.backUVs},h)}k.b.ExtrudeShape=function(E,b,h,a,G,V){let l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7?arguments[7]:void 0,v=arguments.length>8?arguments[8]:void 0,s=arguments.length>9?arguments[9]:void 0;return J(E,{shape:b,path:h,scale:a,rotation:G,cap:0===V?0:V||k.b.NO_CAP,sideOrientation:v,instance:s,updatable:O},l)},k.b.ExtrudeShapeCustom=(E,b,h,a,G,V,l,O,v,s,U,B)=>m(E,{shape:b,path:h,scaleFunction:a,rotationFunction:G,ribbonCloseArray:V,ribbonClosePath:l,cap:0===O?0:O||k.b.NO_CAP,sideOrientation:U,instance:B,updatable:s},v);k.b.CreateLathe=(E,b,h,a,k,G,V)=>x(E,{shape:b,radius:h,tessellation:a,sideOrientation:V,updatable:G},k);var W=h(11542),L=h(11483);function t(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=b.path;let V=b.instance,l=1;void 0!==b.radius?l=b.radius:V&&(l=V._creationDataStorage.radius);const O=b.tessellation||64,s=b.radiusFunction||null;let U=b.cap||k.b.NO_CAP;const B=b.invertUV||!1,o=b.updatable,u=k.b._GetDefaultSideOrientation(b.sideOrientation);b.arc=b.arc&&(b.arc<=0||b.arc>1)?1:b.arc||1;const D=(E,b,h,G,V,l,O,v)=>{const s=b.getTangents(),U=b.getNormals(),B=b.getDistances(),o=2*Math.PI/V*v,u=l||(()=>G);let D,g,S,M;const I=a.h.Matrix[0];let j=O===k.b.NO_CAP||O===k.b.CAP_END?0:2;for(let k=0;k<E.length;k++){g=u(k,B[k]),D=Array(),S=U[k];for(let b=0;b<V;b++)a.d.RotationAxisToRef(s[k],o*b,I),M=D[b]?D[b]:a.k.Zero(),a.k.TransformCoordinatesToRef(S,I,M),M.scaleInPlace(g).addInPlace(E[k]),D[b]=M;h[j]=D,j++}const P=(b,h)=>{const a=Array();for(let k=0;k<b;k++)a.push(E[h]);return a};switch(O){case k.b.NO_CAP:break;case k.b.CAP_START:h[0]=P(V,0),h[1]=h[2].slice(0);break;case k.b.CAP_END:h[j]=h[j-1].slice(0),h[j+1]=P(V,E.length-1);break;case k.b.CAP_ALL:h[0]=P(V,0),h[1]=h[2].slice(0),h[j]=h[j-1].slice(0),h[j+1]=P(V,E.length-1)}return h};let g,S;if(V){const E=V._creationDataStorage,h=b.arc||E.arc;return g=E.path3D.update(G),S=D(G,g,E.pathArray,l,E.tessellation,s,E.cap,h),V=v("",{pathArray:S,instance:V}),E.path3D=g,E.pathArray=S,E.arc=h,E.radius=l,V}g=new Y.k(G);U=U<0||U>3?0:U,S=D(G,g,new Array,l,O,s,U,b.arc);const M=v(E,{pathArray:S,closePath:!0,closeArray:!1,updatable:o,sideOrientation:u,invertUV:B,frontUVs:b.frontUVs,backUVs:b.backUVs},h);return M._creationDataStorage.pathArray=S,M._creationDataStorage.path3D=g,M._creationDataStorage.tessellation=O,M._creationDataStorage.cap=U,M._creationDataStorage.arc=b.arc,M._creationDataStorage.radius=l,M}function T(E){const b=[];b[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},b[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},b[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},b[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},b[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},b[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},b[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},b[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},b[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},b[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},b[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},b[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},b[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},b[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},b[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const h=E.type&&(E.type<0||E.type>=b.length)?0:E.type||0,k=E.size,G=E.sizeX||k||1,O=E.sizeY||k||1,v=E.sizeZ||k||1,s=E.custom||b[h],U=s.face.length,o=E.faceUV||new Array(U),u=E.faceColors,D=void 0===E.flat||E.flat,g=0===E.sideOrientation?0:E.sideOrientation||V.c.DEFAULTSIDE,S=[],M=[],I=[],j=[],P=[];let A=0,n=0;const d=[];let c,z,Z,Y,r,w,N=0,H=0;if(D)for(H=0;H<U;H++)u&&void 0===u[H]&&(u[H]=new B.f(1,1,1,1)),o&&void 0===o[H]&&(o[H]=new a.n(0,0,1,1));if(D)for(H=0;H<U;H++){const E=s.face[H].length;for(Z=2*Math.PI/E,Y=.5*Math.tan(Z/2),r=.5,N=0;N<E;N++)S.push(s.vertex[s.face[H][N]][0]*G,s.vertex[s.face[H][N]][1]*O,s.vertex[s.face[H][N]][2]*v),d.push(A),A++,c=o[H].x+(o[H].z-o[H].x)*(.5+Y),z=o[H].y+(o[H].w-o[H].y)*(r-.5),j.push(c,l.c?1-z:z),w=Y*Math.cos(Z)-r*Math.sin(Z),r=Y*Math.sin(Z)+r*Math.cos(Z),Y=w,u&&P.push(u[H].r,u[H].g,u[H].b,u[H].a);for(N=0;N<E-2;N++)M.push(d[0+n],d[N+2+n],d[N+1+n]);n+=E}else{for(N=0;N<s.vertex.length;N++)S.push(s.vertex[N][0]*G,s.vertex[N][1]*O,s.vertex[N][2]*v),j.push(0,l.c?1:0);for(H=0;H<U;H++)for(N=0;N<s.face[H].length-2;N++)M.push(s.face[H][0],s.face[H][N+2],s.face[H][N+1])}V.c.ComputeNormals(S,M,I),V.c._ComputeSides(g,S,M,I,j,E.frontUVs,E.backUVs);const f=new V.c;return f.xa=S,f.indices=M,f.ya=I,f.Aa=j,u&&D&&(f.za=P),f}function X(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=new k.b(E,h);b.sideOrientation=k.b._GetDefaultSideOrientation(b.sideOrientation),a._originalBuilderSideOrientation=b.sideOrientation;return T(b).Ca(a,b.updatable),a}k.b.CreateTube=(E,b,h,a,k,G,V,l,O,v)=>t(E,{path:b,radius:h,tessellation:a,radiusFunction:k,arc:1,cap:G,updatable:l,sideOrientation:O,instance:v},V);function C(E){const b=E.sideOrientation||V.c.DEFAULTSIDE,h=E.radius||1,k=void 0===E.flat||E.flat,G=0|(E.subdivisions||4),O=E.radiusX||h,v=E.radiusY||h,s=E.radiusZ||h,U=(1+Math.sqrt(5))/2,B=[-1,U,-0,1,U,0,-1,-U,0,1,-U,0,0,-1,-U,0,1,-U,0,-1,U,0,1,U,U,0,1,U,0,-1,-U,0,1,-U,0,-1],o=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],u=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],D=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],g=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],S=[],M=[],I=[],j=[];let P=0;const A=new Array(3),n=new Array(3);let d;for(d=0;d<3;d++)A[d]=a.k.Zero(),n[d]=a.j.Zero();for(let V=0;V<20;V++){for(d=0;d<3;d++){const E=o[3*V+d];A[d].ue(B[3*u[E]],B[3*u[E]+1],B[3*u[E]+2]),A[d].normalize(),n[d].ue(.134765625*D[2*E]+.05859375+-.0390625*g[V],.2333984375*D[2*E+1]+.025390625+.01953125*g[V])}const E=(E,b,h,V)=>{const U=a.k.Lerp(A[0],A[2],b/G),B=a.k.Lerp(A[1],A[2],b/G),o=G===b?A[2]:a.k.Lerp(U,B,E/(G-b));let u;if(o.normalize(),k){const E=a.k.Lerp(A[0],A[2],V/G),b=a.k.Lerp(A[1],A[2],V/G);u=a.k.Lerp(E,b,h/(G-V))}else u=new a.k(o.x,o.y,o.z);u.x/=O,u.y/=v,u.z/=s,u.normalize();const D=a.j.Lerp(n[0],n[2],b/G),g=a.j.Lerp(n[1],n[2],b/G),d=G===b?n[2]:a.j.Lerp(D,g,E/(G-b));M.push(o.x*O,o.y*v,o.z*s),I.push(u.x,u.y,u.z),j.push(d.x,l.c?1-d.y:d.y),S.push(P),P++};for(let b=0;b<G;b++)for(let h=0;h+b<G;h++)E(h,b,h+1/3,b+1/3),E(h+1,b,h+1/3,b+1/3),E(h,b+1,h+1/3,b+1/3),h+b+1<G&&(E(h+1,b,h+2/3,b+2/3),E(h+1,b+1,h+2/3,b+2/3),E(h,b+1,h+2/3,b+2/3))}V.c._ComputeSides(b,M,S,I,j,E.frontUVs,E.backUVs);const c=new V.c;return c.indices=S,c.xa=M,c.ya=I,c.Aa=j,c}function q(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=new k.b(E,h);b.sideOrientation=k.b._GetDefaultSideOrientation(b.sideOrientation),a._originalBuilderSideOrientation=b.sideOrientation;return C(b).Ca(a,b.updatable),a}V.c.CreatePolyhedron=T,k.b.CreatePolyhedron=(E,b,h)=>X(E,b,h);V.c.CreateIcoSphere=C,k.b.CreateIcoSphere=(E,b,h)=>q(E,b,h);var R=h(11186);const Q=new a.k(1,0,0),i=new a.k(-1,0,0),p=new a.k(0,1,0),EE=new a.k(0,-1,0),bE=new a.k(0,0,1),hE=new a.k(0,0,-1);class aE{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.k.Zero(),b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.k.Up(),h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.j.Zero(),k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,V=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,v=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=E,this.k=b,this.uv=h,this.vertexIdx=k,this.vertexIdxForBones=G,this.localPositionOverride=V,this.localNormalOverride=l,this.matrixIndicesOverride=O,this.matrixWeightsOverride=v}clone(){var E,b,h,a;return new aE(this.position.clone(),this.k.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(E=this.localPositionOverride)||void 0===E?void 0:E.slice(),null===(b=this.localNormalOverride)||void 0===b?void 0:b.slice(),null===(h=this.matrixIndicesOverride)||void 0===h?void 0:h.slice(),null===(a=this.matrixWeightsOverride)||void 0===a?void 0:a.slice())}}function kE(E,b,h){var O,v,s,U;const B=!!b.skeleton,o=h.localMode||B,u=b.rg(),D=B?b.de(!0,!0):b.getVerticesData(G.g.PositionKind),g=B?b.getNormalsData(!0,!0):b.getVerticesData(G.g.NormalKind),S=o?B?b.getVerticesData(G.g.PositionKind):D:null,M=o?B?b.getVerticesData(G.g.NormalKind):g:null,I=b.getVerticesData(G.g.UVKind),j=B?b.getVerticesData(G.g.MatricesIndicesKind):null,P=B?b.getVerticesData(G.g.MatricesWeightsKind):null,A=B?b.getVerticesData(G.g.MatricesIndicesExtraKind):null,n=B?b.getVerticesData(G.g.MatricesWeightsExtraKind):null,d=h.position||a.k.Zero();let c=h.k||a.k.Up();const z=h.size||a.k.One(),Z=h.angle||0;if(!c){const E=new a.k(0,0,1),h=b.va().activeCamera,k=a.k.TransformCoordinates(E,h.getWorldMatrix());c=h.globalPosition.Xc(k)}const Y=-Math.atan2(c.z,c.x)-Math.PI/2,r=Math.sqrt(c.x*c.x+c.z*c.z),w=Math.atan2(c.y,r),N=new V.c;N.indices=[],N.xa=[],N.ya=[],N.Aa=[],N.matricesIndices=B?[]:null,N.matricesWeights=B?[]:null,N.matricesIndicesExtra=A?[]:null,N.matricesWeightsExtra=n?[]:null;let H=0;const f=(E,b)=>{const k=new aE;if(!u||!D||!g)return k;const G=u[E];if(k.vertexIdx=3*G,k.vertexIdxForBones=4*G,k.position=new a.k(D[3*G],D[3*G+1],D[3*G+2]),a.k.TransformCoordinatesToRef(k.position,b,k.position),k.k=new a.k(g[3*G],g[3*G+1],g[3*G+2]),a.k.TransformNormalToRef(k.k,b,k.k),h.captureUVS&&I){const E=I[2*G+1];k.uv=new a.j(I[2*G],l.c?1-E:E)}return k},F=[0,0,0,0],y=(E,b)=>{if(0===E.length)return E;const h=.5*Math.abs(a.k.Dot(z,b)),k=(E,b,h,a)=>{for(let k=0;k<a;++k)if(E[h+k]===b)return h+k;return-1},G=(E,G)=>{const V=a.k.GetClipFactor(E.position,G.position,b,h);let l=F,O=F;if(j&&P){const b=E.matrixIndicesOverride?0:E.vertexIdxForBones,h=E.matrixIndicesOverride??j,a=E.matrixWeightsOverride??P,v=G.matrixIndicesOverride?0:G.vertexIdxForBones,s=G.matrixIndicesOverride??j,U=G.matrixWeightsOverride??P;l=[0,0,0,0],O=[0,0,0,0];let B=0;for(let E=0;E<4;++E)if(a[b+E]>0){const G=k(s,h[b+E],v,4);l[B]=h[b+E],O[B]=(0,R.o)(a[b+E],G>=0?U[G]:0,V),B++}for(let E=0;E<4&&B<4;++E){const a=s[v+E];-1===k(h,a,b,4)&&(l[B]=a,O[B]=(0,R.o)(0,U[v+E],V),B++)}const o=O[0]+O[1]+O[2]+O[3];O[0]/=o,O[1]/=o,O[2]/=o,O[3]/=o}const v=E.localPositionOverride?E.localPositionOverride[0]:(null===S||void 0===S?void 0:S[E.vertexIdx])??0,s=E.localPositionOverride?E.localPositionOverride[1]:(null===S||void 0===S?void 0:S[E.vertexIdx+1])??0,U=E.localPositionOverride?E.localPositionOverride[2]:(null===S||void 0===S?void 0:S[E.vertexIdx+2])??0,B=G.localPositionOverride?G.localPositionOverride[0]:(null===S||void 0===S?void 0:S[G.vertexIdx])??0,o=G.localPositionOverride?G.localPositionOverride[1]:(null===S||void 0===S?void 0:S[G.vertexIdx+1])??0,u=G.localPositionOverride?G.localPositionOverride[2]:(null===S||void 0===S?void 0:S[G.vertexIdx+2])??0,D=E.localNormalOverride?E.localNormalOverride[0]:(null===M||void 0===M?void 0:M[E.vertexIdx])??0,g=E.localNormalOverride?E.localNormalOverride[1]:(null===M||void 0===M?void 0:M[E.vertexIdx+1])??0,I=E.localNormalOverride?E.localNormalOverride[2]:(null===M||void 0===M?void 0:M[E.vertexIdx+2])??0,A=D+((G.localNormalOverride?G.localNormalOverride[0]:(null===M||void 0===M?void 0:M[G.vertexIdx])??0)-D)*V,n=g+((G.localNormalOverride?G.localNormalOverride[1]:(null===M||void 0===M?void 0:M[G.vertexIdx+1])??0)-g)*V,d=I+((G.localNormalOverride?G.localNormalOverride[2]:(null===M||void 0===M?void 0:M[G.vertexIdx+2])??0)-I)*V,c=Math.sqrt(A*A+n*n+d*d);return new aE(a.k.Lerp(E.position,G.position,V),a.k.Lerp(E.k,G.k,V).normalize(),a.j.Lerp(E.uv,G.uv,V),-1,-1,S?[v+(B-v)*V,s+(o-s)*V,U+(u-U)*V]:null,M?[A/c,n/c,d/c]:null,l,O)};let V=null;E.length>3&&(V=[]);for(let l=0;l<E.length;l+=3){let k=0,O=null,v=null,s=null,U=null;const B=a.k.Dot(E[l].position,b)-h>0,o=a.k.Dot(E[l+1].position,b)-h>0,u=a.k.Dot(E[l+2].position,b)-h>0;switch(k=(B?1:0)+(o?1:0)+(u?1:0),k){case 0:E.length>3?(V.push(E[l]),V.push(E[l+1]),V.push(E[l+2])):V=E;break;case 1:if(V=V??new Array,B&&(O=E[l+1],v=E[l+2],s=G(E[l],O),U=G(E[l],v)),o){O=E[l],v=E[l+2],s=G(E[l+1],O),U=G(E[l+1],v),V.push(s),V.push(v.clone()),V.push(O.clone()),V.push(v.clone()),V.push(s.clone()),V.push(U);break}u&&(O=E[l],v=E[l+1],s=G(E[l+2],O),U=G(E[l+2],v)),O&&v&&s&&U&&(V.push(O.clone()),V.push(v.clone()),V.push(s),V.push(U),V.push(s.clone()),V.push(v.clone()));break;case 2:V=V??new Array,B||(O=E[l].clone(),v=G(O,E[l+1]),s=G(O,E[l+2]),V.push(O),V.push(v),V.push(s)),o||(O=E[l+1].clone(),v=G(O,E[l+2]),s=G(O,E[l]),V.push(O),V.push(v),V.push(s)),u||(O=E[l+2].clone(),v=G(O,E[l]),s=G(O,E[l+1]),V.push(O),V.push(v),V.push(s))}}return V},e=b instanceof k.b?b:null,J=null===e||void 0===e?void 0:e._thinInstanceDataStorage.matrixData,m=(null===e||void 0===e?void 0:e.Rb)||1,K=a.h.Matrix[0];K.p(a.d.IdentityReadOnly);for(let k=0;k<m;++k){if(null!==e&&void 0!==e&&e.hasThinInstances&&J){const E=16*k;K.setRowFromFloats(0,J[E+0],J[E+1],J[E+2],J[E+3]),K.setRowFromFloats(1,J[E+4],J[E+5],J[E+6],J[E+7]),K.setRowFromFloats(2,J[E+8],J[E+9],J[E+10],J[E+11]),K.setRowFromFloats(3,J[E+12],J[E+13],J[E+14],J[E+15])}const E=a.d.RotationYawPitchRoll(Y,w,Z).multiply(a.d.Translation(d.x,d.y,d.z)),G=a.d.Invert(E),V=b.getWorldMatrix(),O=K.multiply(V).multiply(G),v=new Array(3);for(let b=0;b<u.length;b+=3){let E=v;if(E[0]=f(b,O),E[1]=f(b+1,O),E[2]=f(b+2,O),!(h.cullBackFaces&&-E[0].k.z<=0&&-E[1].k.z<=0&&-E[2].k.z<=0)&&(E=y(E,Q),E&&(E=y(E,i),E&&(E=y(E,p),E&&(E=y(E,EE),E&&(E=y(E,bE),E&&(E=y(E,hE),E)))))))for(let b=0;b<E.length;b++){const a=E[b];if(N.indices.push(H),o?(a.localPositionOverride?(N.xa[3*H]=a.localPositionOverride[0],N.xa[3*H+1]=a.localPositionOverride[1],N.xa[3*H+2]=a.localPositionOverride[2]):S&&(N.xa[3*H]=S[a.vertexIdx],N.xa[3*H+1]=S[a.vertexIdx+1],N.xa[3*H+2]=S[a.vertexIdx+2]),a.localNormalOverride?(N.ya[3*H]=a.localNormalOverride[0],N.ya[3*H+1]=a.localNormalOverride[1],N.ya[3*H+2]=a.localNormalOverride[2]):M&&(N.ya[3*H]=M[a.vertexIdx],N.ya[3*H+1]=M[a.vertexIdx+1],N.ya[3*H+2]=M[a.vertexIdx+2])):(a.position.toArray(N.xa,3*H),a.k.toArray(N.ya,3*H)),N.matricesIndices&&N.matricesWeights&&(a.matrixIndicesOverride?(N.matricesIndices[4*H]=a.matrixIndicesOverride[0],N.matricesIndices[4*H+1]=a.matrixIndicesOverride[1],N.matricesIndices[4*H+2]=a.matrixIndicesOverride[2],N.matricesIndices[4*H+3]=a.matrixIndicesOverride[3]):(j&&(N.matricesIndices[4*H]=j[a.vertexIdxForBones],N.matricesIndices[4*H+1]=j[a.vertexIdxForBones+1],N.matricesIndices[4*H+2]=j[a.vertexIdxForBones+2],N.matricesIndices[4*H+3]=j[a.vertexIdxForBones+3]),A&&N.matricesIndicesExtra&&(N.matricesIndicesExtra[4*H]=A[a.vertexIdxForBones],N.matricesIndicesExtra[4*H+1]=A[a.vertexIdxForBones+1],N.matricesIndicesExtra[4*H+2]=A[a.vertexIdxForBones+2],N.matricesIndicesExtra[4*H+3]=A[a.vertexIdxForBones+3])),a.matrixWeightsOverride?(N.matricesWeights[4*H]=a.matrixWeightsOverride[0],N.matricesWeights[4*H+1]=a.matrixWeightsOverride[1],N.matricesWeights[4*H+2]=a.matrixWeightsOverride[2],N.matricesWeights[4*H+3]=a.matrixWeightsOverride[3]):(P&&(N.matricesWeights[4*H]=P[a.vertexIdxForBones],N.matricesWeights[4*H+1]=P[a.vertexIdxForBones+1],N.matricesWeights[4*H+2]=P[a.vertexIdxForBones+2],N.matricesWeights[4*H+3]=P[a.vertexIdxForBones+3]),n&&N.matricesWeightsExtra&&(N.matricesWeightsExtra[4*H]=n[a.vertexIdxForBones],N.matricesWeightsExtra[4*H+1]=n[a.vertexIdxForBones+1],N.matricesWeightsExtra[4*H+2]=n[a.vertexIdxForBones+2],N.matricesWeightsExtra[4*H+3]=n[a.vertexIdxForBones+3]))),h.captureUVS)a.uv.toArray(N.Aa,2*H);else{N.Aa.push(.5+a.position.x/z.x);const E=.5+a.position.y/z.y;N.Aa.push(l.c?1-E:E)}H++}}}0===N.indices.length&&(N.indices=null),0===N.xa.length&&(N.xa=null),0===N.ya.length&&(N.ya=null),0===N.Aa.length&&(N.Aa=null),0===(null===(O=N.matricesIndices)||void 0===O?void 0:O.length)&&(N.matricesIndices=null),0===(null===(v=N.matricesWeights)||void 0===v?void 0:v.length)&&(N.matricesWeights=null),0===(null===(s=N.matricesIndicesExtra)||void 0===s?void 0:s.length)&&(N.matricesIndicesExtra=null),0===(null===(U=N.matricesWeightsExtra)||void 0===U?void 0:U.length)&&(N.matricesWeightsExtra=null);const x=new k.b(E,b.va());return N.Ca(x),o?(x.skeleton=b.skeleton,x.parent=b):(x.position=d.clone(),x.rotation=new a.k(w,Y,Z)),x.Wj(!0),x.refreshBoundingInfo(!0,!0),x}function GE(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const b=0|Math.max(E.subdivisions?E.subdivisions:2,1),h=0|Math.max(E.tessellation?E.tessellation:16,3),k=Math.max(E.height?E.height:1,0),G=Math.max(E.radius?E.radius:.25,0),O=0|Math.max(E.capSubdivisions?E.capSubdivisions:6,1),v=h,s=b,U=Math.max(E.radiusTop?E.radiusTop:G,0),B=Math.max(E.radiusBottom?E.radiusBottom:G,0),o=k-(U+B),u=2*Math.PI,D=Math.max(E.topCapSubdivisions?E.topCapSubdivisions:O,1),g=Math.max(E.bottomCapSubdivisions?E.bottomCapSubdivisions:O,1),S=Math.acos((B-U)/k);let M=[];const I=[],j=[],P=[];let A=0;const n=[],d=.5*o,c=.5*Math.PI;let z,Z;const Y=a.k.Zero(),r=a.k.Zero(),w=Math.cos(S),N=Math.sin(S),H=new a.j(U*N,d+U*w).Xc(new a.j(B*N,B*w-d)).length(),f=U*S+H+B*(c-S);let F=0;for(Z=0;Z<=D;Z++){const E=[],b=c-S*(Z/D);F+=U*S/D;const h=Math.cos(b),a=Math.sin(b),k=h*U;for(z=0;z<=v;z++){const b=z/v,G=b*u+0,V=Math.sin(G),O=Math.cos(G);r.x=k*V,r.y=d+a*U,r.z=k*O,I.push(r.x,r.y,r.z),Y.set(h*V,a,h*O),j.push(Y.x,Y.y,Y.z),P.push(b,l.c?F/f:1-F/f),E.push(A),A++}n.push(E)}const y=k-U-B+w*U-w*B,e=N*(B-U)/y;for(Z=1;Z<=s;Z++){const E=[];F+=H/s;const b=N*(Z*(B-U)/s+U);for(z=0;z<=v;z++){const h=z/v,a=h*u+0,k=Math.sin(a),G=Math.cos(a);r.x=b*k,r.y=d+w*U-Z*y/s,r.z=b*G,I.push(r.x,r.y,r.z),Y.set(k,e,G).normalize(),j.push(Y.x,Y.y,Y.z),P.push(h,l.c?F/f:1-F/f),E.push(A),A++}n.push(E)}for(Z=1;Z<=g;Z++){const E=[],b=c-S-(Math.PI-S)*(Z/g);F+=B*S/g;const h=Math.cos(b),a=Math.sin(b),k=h*B;for(z=0;z<=v;z++){const b=z/v,G=b*u+0,V=Math.sin(G),O=Math.cos(G);r.x=k*V,r.y=a*B-d,r.z=k*O,I.push(r.x,r.y,r.z),Y.set(h*V,a,h*O),j.push(Y.x,Y.y,Y.z),P.push(b,l.c?F/f:1-F/f),E.push(A),A++}n.push(E)}for(z=0;z<v;z++)for(Z=0;Z<D+s+g;Z++){const E=n[Z][z],b=n[Z+1][z],h=n[Z+1][z+1],a=n[Z][z+1];M.push(E),M.push(b),M.push(a),M.push(b),M.push(h),M.push(a)}if(M=M.reverse(),E.orientation&&!E.orientation.equals(a.k.Up())){const b=new a.d;E.orientation.clone().scale(.5*Math.PI).cross(a.k.Up()).toQuaternion().toRotationMatrix(b);const h=a.k.Zero();for(let E=0;E<I.length;E+=3)h.set(I[E],I[E+1],I[E+2]),a.k.TransformCoordinatesToRef(h.clone(),b,h),I[E]=h.x,I[E+1]=h.y,I[E+2]=h.z}const J=new V.c;return J.xa=I,J.ya=j,J.Aa=P,J.indices=M,J}function VE(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:a.k.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=new k.b(E,h);return GE(b).Ca(G,b.updatable),G}k.b.CreateDecal=(E,b,h,a,k,G)=>kE(E,b,{position:h,k:a,size:k,angle:G});k.b.CreateCapsule=(E,b,h)=>VE(E,b,h),V.c.CreateCapsule=GE;class lE{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=E,this.y=b,E!==Math.floor(E)&&(E=Math.floor(E),Z.c.Warn("x is not an integer, floor(x) used")),b!==Math.floor(b)&&(b=Math.floor(b),Z.c.Warn("y is not an integer, floor(y) used"))}clone(){return new lE(this.x,this.y)}rotate60About(E){const b=this.x;return this.x=E.x+E.y-this.y,this.y=b+this.y-E.x,this}rotateNeg60About(E){const b=this.x;return this.x=b+this.y-E.y,this.y=E.x+E.y-b,this}rotate120(E,b){E!==Math.floor(E)&&(E=Math.floor(E),Z.c.Warn("m not an integer only floor(m) used")),b!==Math.floor(b)&&(b=Math.floor(b),Z.c.Warn("n not an integer only floor(n) used"));const h=this.x;return this.x=E-h-this.y,this.y=b+h,this}rotateNeg120(E,b){E!==Math.floor(E)&&(E=Math.floor(E),Z.c.Warn("m is not an integer, floor(m) used")),b!==Math.floor(b)&&(b=Math.floor(b),Z.c.Warn("n is not an integer,   floor(n) used"));const h=this.x;return this.x=this.y-b,this.y=E+b-h-this.y,this}toCartesianOrigin(E,b){const h=a.k.Zero();return h.x=E.x+2*this.x*b+this.y*b,h.y=E.y+Math.sqrt(3)*this.y*b,h}static Zero(){return new lE(0,0)}}class OE{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new vE("icosahedron","Regular",[[0,r.g,-1],[-r.g,1,0],[-1,0,-r.g],[1,0,-r.g],[r.g,1,0],[0,r.g,1],[-1,0,r.g],[-r.g,-1,0],[0,-r.g,-1],[r.g,-1,0],[1,0,r.g],[0,-r.g,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let E=12;const b={},h=this.m,a=this.n;let k,G,V,l,O,v=h,s=1,U=0;0!==a&&(v=(0,R.h)(h,a)),s=h/v,U=a/v;const B=lE.Zero(),o=new lE(h,a),u=new lE(-a,h+a),D=lE.Zero(),g=lE.Zero(),S=lE.Zero();let M,I,j,P,A=[];const n=[],d=this.vertByDist,c=(h,a,k,G)=>{M=h+"|"+k,I=a+"|"+G,M in b||I in b?M in b&&!(I in b)?b[I]=b[M]:I in b&&!(M in b)&&(b[M]=b[I]):(b[M]=E,b[I]=E,E++),d[k][0]>2?n[b[M]]=[-d[k][0],d[k][1],b[M]]:n[b[M]]=[A[d[k][0]],d[k][1],b[M]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let z=0;z<20;z++){if(A=this.IDATA.face[z],V=A[2],l=A[1],O=A[0],j=B.x+"|"+B.y,M=z+"|"+j,M in b||(b[M]=V,n[V]=[A[d[j][0]],d[j][1]]),j=o.x+"|"+o.y,M=z+"|"+j,M in b||(b[M]=l,n[l]=[A[d[j][0]],d[j][1]]),j=u.x+"|"+u.y,M=z+"|"+j,M in b||(b[M]=O,n[O]=[A[d[j][0]],d[j][1]]),k=this.IDATA.edgematch[z][0],G=this.IDATA.edgematch[z][1],"B"===G)for(let E=1;E<v;E++)g.x=h-E*(s+U),g.y=a+E*s,S.x=-E*U,S.y=E*(s+U),j=g.x+"|"+g.y,P=S.x+"|"+S.y,c(z,k,j,P);if("O"===G)for(let E=1;E<v;E++)S.x=-E*U,S.y=E*(s+U),D.x=E*s,D.y=E*U,j=S.x+"|"+S.y,P=D.x+"|"+D.y,c(z,k,j,P);if(k=this.IDATA.edgematch[z][2],G=this.IDATA.edgematch[z][3],G&&"A"===G)for(let E=1;E<v;E++)D.x=E*s,D.y=E*U,g.x=h-(v-E)*(s+U),g.y=a+(v-E)*s,j=D.x+"|"+D.y,P=g.x+"|"+g.y,c(z,k,j,P);for(let h=0;h<this.vertices.length;h++)j=this.vertices[h].x+"|"+this.vertices[h].y,M=z+"|"+j,M in b||(b[M]=E++,d[j][0]>2?n[b[M]]=[-d[j][0],d[j][1],b[M]]:n[b[M]]=[A[d[j][0]],d[j][1],b[M]])}this.closestTo=n,this.vecToidx=b}calcCoeffs(){const E=this.m,b=this.n,h=Math.sqrt(3)/3,a=E*E+b*b+E*b;this.coau=(E+b)/a,this.cobu=-b/a,this.coav=-h*(E-b)/a,this.cobv=h*(2*E+b)/a}createInnerFacets(){const E=this.m,b=this.n;for(let h=0;h<b+E+1;h++)for(let E=this.min[h];E<this.max[h]+1;E++)E<this.max[h]&&E<this.max[h+1]+1&&this.innerFacets.push(["|"+E+"|"+h,"|"+E+"|"+(h+1),"|"+(E+1)+"|"+h]),h>0&&E<this.max[h-1]&&E+1<this.max[h]+1&&this.innerFacets.push(["|"+E+"|"+h,"|"+(E+1)+"|"+h,"|"+(E+1)+"|"+(h-1)])}edgeVecsABOB(){const E=this.m,b=this.n,h=new lE(-b,E+b);for(let a=1;a<E+b;a++){const E=new lE(this.min[a],a),b=new lE(this.min[a-1],a-1),k=new lE(this.min[a+1],a+1),G=E.clone(),V=b.clone(),l=k.clone();G.rotate60About(h),V.rotate60About(h),l.rotate60About(h);const O=new lE(this.max[G.y],G.y),v=new lE(this.max[G.y-1],G.y-1),s=new lE(this.max[G.y-1]-1,G.y-1);G.x===O.x&&G.y===O.y||(G.x!==v.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([E,v,s]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([E,s,O])):G.y===l.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([E,b,v]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([E,v,k])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([E,b,v]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([E,v,O])))}}mapABOBtoOBOA(){const E=new lE(0,0);for(let b=0;b<this.isoVecsABOB.length;b++){const h=[];for(let a=0;a<3;a++)E.x=this.isoVecsABOB[b][a].x,E.y=this.isoVecsABOB[b][a].y,0===this.vertexTypes[b][a]&&E.rotateNeg120(this.m,this.n),h.push(E.clone());this.isoVecsOBOA.push(h)}}mapABOBtoBAOA(){const E=new lE(0,0);for(let b=0;b<this.isoVecsABOB.length;b++){const h=[];for(let a=0;a<3;a++)E.x=this.isoVecsABOB[b][a].x,E.y=this.isoVecsABOB[b][a].y,1===this.vertexTypes[b][a]&&E.rotate120(this.m,this.n),h.push(E.clone());this.isoVecsBAOA.push(h)}}MapToFace(E,b){const h=this.IDATA.face[E],k=h[2],G=h[1],V=h[0],l=a.k.jh(this.IDATA.vertex[k]),O=a.k.jh(this.IDATA.vertex[G]),v=a.k.jh(this.IDATA.vertex[V]),s=O.Xc(l),U=v.Xc(l),B=s.scale(this.coau).add(U.scale(this.cobu)),o=s.scale(this.coav).add(U.scale(this.cobv)),u=[];let D,g=a.h.o[0];for(let a=0;a<this.cartesian.length;a++)g=B.scale(this.cartesian[a].x).add(o.scale(this.cartesian[a].y)).add(l),u[a]=[g.x,g.y,g.z],D=E+"|"+this.vertices[a].x+"|"+this.vertices[a].y,b.vertex[this.vecToidx[D]]=[g.x,g.y,g.z]}build(E,b){const h=[],a=lE.Zero(),k=new lE(E,b),G=new lE(-b,E+b);h.push(a,k,G);for(let j=b;j<E+1;j++)for(let b=0;b<E+1-j;b++)h.push(new lE(b,j));if(b>0){const a=(0,R.h)(E,b),k=E/a,G=b/a;for(let l=1;l<a;l++)h.push(new lE(l*k,l*G)),h.push(new lE(-l*G,l*(k+G))),h.push(new lE(E-l*(k+G),b+l*k));const V=E/b;for(let l=1;l<b;l++)for(let a=0;a<l*V;a++)h.push(new lE(a,l)),h.push(new lE(a,l).rotate120(E,b)),h.push(new lE(a,l).rotateNeg120(E,b))}h.sort(((E,b)=>E.x-b.x)),h.sort(((E,b)=>E.y-b.y));const V=new Array(E+b+1),l=new Array(E+b+1);for(let j=0;j<V.length;j++)V[j]=1/0,l[j]=-1/0;let O=0,v=0;const s=h.length;for(let j=0;j<s;j++)v=h[j].x,O=h[j].y,V[O]=Math.min(v,V[O]),l[O]=Math.max(v,l[O]);const U=(h,a)=>{const k=h.clone();return"A"===a&&k.rotateNeg120(E,b),"B"===a&&k.rotate120(E,b),k.x<0?k.y:k.x+k.y},B=[],o=[],u=[],D=[],g={},S=[];let M=-1,I=-1;for(let j=0;j<s;j++)B[j]=h[j].toCartesianOrigin(new lE(0,0),.5),o[j]=U(h[j],"O"),u[j]=U(h[j],"A"),D[j]=U(h[j],"B"),o[j]===u[j]&&u[j]===D[j]?(M=3,I=o[j]):o[j]===u[j]?(M=4,I=o[j]):u[j]===D[j]?(M=5,I=u[j]):D[j]===o[j]&&(M=6,I=o[j]),o[j]<u[j]&&o[j]<D[j]&&(M=2,I=o[j]),u[j]<o[j]&&u[j]<D[j]&&(M=1,I=u[j]),D[j]<u[j]&&D[j]<o[j]&&(M=0,I=D[j]),S.push([M,I,h[j].x,h[j].y]);S.sort(((E,b)=>E[2]-b[2])),S.sort(((E,b)=>E[3]-b[3])),S.sort(((E,b)=>E[1]-b[1])),S.sort(((E,b)=>E[0]-b[0]));for(let j=0;j<S.length;j++)g[S[j][2]+"|"+S[j][3]]=[S[j][0],S[j][1],j];return this.m=E,this.n=b,this.vertices=h,this.vertByDist=g,this.cartesian=B,this.min=V,this.max=l,this}}class vE{constructor(E,b,h,a){this.name=E,this.category=b,this.vertex=h,this.face=a}}class sE extends vE{innerToData(E,b){for(let h=0;h<b.innerFacets.length;h++)this.face.push(b.innerFacets[h].map((h=>b.vecToidx[E+h])))}mapABOBtoDATA(E,b){const h=b.IDATA.edgematch[E][0];for(let a=0;a<b.isoVecsABOB.length;a++){const k=[];for(let G=0;G<3;G++)0===b.vertexTypes[a][G]?k.push(E+"|"+b.isoVecsABOB[a][G].x+"|"+b.isoVecsABOB[a][G].y):k.push(h+"|"+b.isoVecsABOB[a][G].x+"|"+b.isoVecsABOB[a][G].y);this.face.push([b.vecToidx[k[0]],b.vecToidx[k[1]],b.vecToidx[k[2]]])}}mapOBOAtoDATA(E,b){const h=b.IDATA.edgematch[E][0];for(let a=0;a<b.isoVecsOBOA.length;a++){const k=[];for(let G=0;G<3;G++)1===b.vertexTypes[a][G]?k.push(E+"|"+b.isoVecsOBOA[a][G].x+"|"+b.isoVecsOBOA[a][G].y):k.push(h+"|"+b.isoVecsOBOA[a][G].x+"|"+b.isoVecsOBOA[a][G].y);this.face.push([b.vecToidx[k[0]],b.vecToidx[k[1]],b.vecToidx[k[2]]])}}mapBAOAtoDATA(E,b){const h=b.IDATA.edgematch[E][2];for(let a=0;a<b.isoVecsBAOA.length;a++){const k=[];for(let G=0;G<3;G++)1===b.vertexTypes[a][G]?k.push(E+"|"+b.isoVecsBAOA[a][G].x+"|"+b.isoVecsBAOA[a][G].y):k.push(h+"|"+b.isoVecsBAOA[a][G].x+"|"+b.isoVecsBAOA[a][G].y);this.face.push([b.vecToidx[k[0]],b.vecToidx[k[1]],b.vecToidx[k[2]]])}}orderData(E){const b=[];for(let G=0;G<13;G++)b[G]=[];const h=E.closestTo;for(let G=0;G<h.length;G++)h[G][0]>-1?h[G][1]>0&&b[h[G][0]].push([G,h[G][1]]):b[12].push([G,h[G][0]]);const a=[];for(let G=0;G<12;G++)a[G]=G;let k=12;for(let G=0;G<12;G++){b[G].sort(((E,b)=>E[1]-b[1]));for(let E=0;E<b[G].length;E++)a[b[G][E][0]]=k++}for(let G=0;G<b[12].length;G++)a[b[12][G][0]]=k++;for(let G=0;G<this.vertex.length;G++)this.vertex[G].push(a[G]);this.vertex.sort(((E,b)=>E[3]-b[3]));for(let G=0;G<this.vertex.length;G++)this.vertex[G].pop();for(let G=0;G<this.face.length;G++)for(let E=0;E<this.face[G].length;E++)this.face[G][E]=a[this.face[G][E]];this.sharedNodes=b[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(E,b){const h=[],a=[];let k=b.pop();a.push(k);let G=this.face[k].indexOf(E);G=(G+2)%3;let V=this.face[k][G];h.push(V);let l=0;for(;b.length>0;)k=b[l],this.face[k].indexOf(V)>-1?(G=(this.face[k].indexOf(V)+1)%3,V=this.face[k][G],h.push(V),a.push(k),b.splice(l,1),l=0):l++;return this.adjacentFaces.push(h),a}toGoldbergPolyhedronData(){const E=new vE("GeoDual","Goldberg",[],[]);E.name="GD dual";const b=this.vertex.length,h=new Array(b);for(let O=0;O<b;O++)h[O]=[];for(let O=0;O<this.face.length;O++)for(let E=0;E<3;E++)h[this.face[O][E]].push(O);let a=0,k=0,G=0,V=[],l=[];this.adjacentFaces=[];for(let O=0;O<h.length;O++)E.face[O]=this.setOrder(O,h[O].concat([])),h[O].forEach((b=>{a=0,k=0,G=0,V=this.face[b];for(let E=0;E<3;E++)l=this.vertex[V[E]],a+=l[0],k+=l[1],G+=l[2];E.vertex[b]=[a/3,k/3,G/3]}));return E}static BuildGeodesicData(E){const b=new sE("Geodesic-m-n","Geodesic",[[0,r.g,-1],[-r.g,1,0],[-1,0,-r.g],[1,0,-r.g],[r.g,1,0],[0,r.g,1],[-1,0,r.g],[-r.g,-1,0],[0,-r.g,-1],[r.g,-1,0],[1,0,r.g],[0,-r.g,1]],[]);E.setIndices(),E.calcCoeffs(),E.createInnerFacets(),E.edgeVecsABOB(),E.mapABOBtoOBOA(),E.mapABOBtoBAOA();for(let h=0;h<E.IDATA.face.length;h++)E.MapToFace(h,b),b.innerToData(h,E),"B"===E.IDATA.edgematch[h][1]&&b.mapABOBtoDATA(h,E),"O"===E.IDATA.edgematch[h][1]&&b.mapOBOAtoDATA(h,E),"A"===E.IDATA.edgematch[h][3]&&b.mapBAOAtoDATA(h,E);b.orderData(E);return b.vertex=b.vertex.map((function(E){const b=E[0],h=E[1],a=E[2],k=Math.sqrt(b*b+h*h+a*a);return E[0]*=1/k,E[1]*=1/k,E[2]*=1/k,E})),b}}k.b._GoldbergMeshParser=(E,b)=>UE.Parse(E,b);class UE extends k.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(E,b){return void 0===b?(E>this.goldbergData.nbUnsharedFaces-1&&(Z.c.Warn("Maximum number of unshared faces used"),E=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+E):(E>11&&(Z.c.Warn("Last pole used"),E=11),b>this.goldbergData.nbFacesAtPole-1&&(Z.c.Warn("Maximum number of faces at a pole used"),b=this.goldbergData.nbFacesAtPole-1),12+E*this.goldbergData.nbFacesAtPole+b)}_changeGoldbergFaceColors(E){for(let h=0;h<E.length;h++){const b=E[h][0],a=E[h][1],k=E[h][2];for(let E=b;E<a+1;E++)this.goldbergData.faceColors[E]=k}const b=[];for(let h=0;h<12;h++)for(let E=0;E<5;E++)b.push(this.goldbergData.faceColors[h].r,this.goldbergData.faceColors[h].g,this.goldbergData.faceColors[h].b,this.goldbergData.faceColors[h].a);for(let h=12;h<this.goldbergData.faceColors.length;h++)for(let E=0;E<6;E++)b.push(this.goldbergData.faceColors[h].r,this.goldbergData.faceColors[h].g,this.goldbergData.faceColors[h].b,this.goldbergData.faceColors[h].a);return b}setGoldbergFaceColors(E){const b=this._changeGoldbergFaceColors(E);this.Ga(G.g.ColorKind,b)}updateGoldbergFaceColors(E){const b=this._changeGoldbergFaceColors(E);this.updateVerticesData(G.g.ColorKind,b)}_changeGoldbergFaceUVs(E){const b=this.getVerticesData(G.g.UVKind);for(let h=0;h<E.length;h++){const a=E[h][0],k=E[h][1],G=E[h][2],V=E[h][3],l=E[h][4],O=[],v=[];let s,U;for(let E=0;E<5;E++)s=G.x+V*Math.cos(l+E*Math.PI/2.5),U=G.y+V*Math.sin(l+E*Math.PI/2.5),s<0&&(s=0),s>1&&(s=1),O.push(s,U);for(let E=0;E<6;E++)s=G.x+V*Math.cos(l+E*Math.PI/3),U=G.y+V*Math.sin(l+E*Math.PI/3),s<0&&(s=0),s>1&&(s=1),v.push(s,U);for(let E=a;E<Math.min(12,k+1);E++)for(let h=0;h<5;h++)b[10*E+2*h]=O[2*h],b[10*E+2*h+1]=O[2*h+1];for(let E=Math.max(12,a);E<k+1;E++)for(let h=0;h<6;h++)b[12*E-24+2*h]=v[2*h],b[12*E-23+2*h]=v[2*h+1]}return b}setGoldbergFaceUVs(E){const b=this._changeGoldbergFaceUVs(E);this.Ga(G.g.UVKind,b)}updateGoldbergFaceUVs(E){const b=this._changeGoldbergFaceUVs(E);this.updateVerticesData(G.g.UVKind,b)}placeOnGoldbergFaceAt(E,b,h){const k=a.k.RotationFromAxis(this.goldbergData.faceXaxis[b],this.goldbergData.faceYaxis[b],this.goldbergData.faceZaxis[b]);E.rotation=k,E.position=this.goldbergData.faceCenters[b].add(this.goldbergData.faceXaxis[b].scale(h.x)).add(this.goldbergData.faceYaxis[b].scale(h.y)).add(this.goldbergData.faceZaxis[b].scale(h.z))}serialize(E){super.serialize(E),E.type="GoldbergMesh";const b={};if(b.adjacentFaces=this.goldbergData.adjacentFaces,b.nbSharedFaces=this.goldbergData.nbSharedFaces,b.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,b.nbFaces=this.goldbergData.nbFaces,b.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){b.faceColors=[];for(const E of this.goldbergData.faceColors)b.faceColors.push(E.qj())}if(this.goldbergData.faceCenters){b.faceCenters=[];for(const E of this.goldbergData.faceCenters)b.faceCenters.push(E.qj())}if(this.goldbergData.faceZaxis){b.faceZaxis=[];for(const E of this.goldbergData.faceZaxis)b.faceZaxis.push(E.qj())}if(this.goldbergData.faceYaxis){b.faceYaxis=[];for(const E of this.goldbergData.faceYaxis)b.faceYaxis.push(E.qj())}if(this.goldbergData.faceXaxis){b.faceXaxis=[];for(const E of this.goldbergData.faceXaxis)b.faceXaxis.push(E.qj())}E.goldbergData=b}static Parse(E,b){const h=E.goldbergData;h.faceColors=h.faceColors.map((E=>B.f.jh(E))),h.faceCenters=h.faceCenters.map((E=>a.k.jh(E))),h.faceZaxis=h.faceZaxis.map((E=>a.k.jh(E))),h.faceXaxis=h.faceXaxis.map((E=>a.k.jh(E))),h.faceYaxis=h.faceYaxis.map((E=>a.k.jh(E)));const k=new UE(E.name,b);return k.goldbergData=h,k}}var BE=h(11461);class oE{constructor(E){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=E}moveTo(E,b){this._currentPath=new Y.h(E,b),this._tempPaths.push(this._currentPath)}lineTo(E,b){this._currentPath.addLineTo(E,b)}quadraticCurveTo(E,b,h,a){this._currentPath.addQuadraticCurveTo(E,b,h,a,this._resolution)}bezierCurveTo(E,b,h,a,k,G){this._currentPath.addBezierCurveTo(E,b,h,a,k,G,this._resolution)}extractHoles(){for(const E of this._tempPaths)E.area()>0?this._holes.push(E):this._paths.push(E);if(!this._paths.length&&this._holes.length){const E=this._holes;this._holes=this._paths,this._paths=E}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function uE(E,b,h,a,k,G){const V=G.glyphs[E]||G.glyphs["?"];if(!V)return null;const l=new oE(k);if(V.o){const E=V.o.split(" ");for(let k=0,G=E.length;k<G;){switch(E[k++]){case"m":{const G=parseInt(E[k++])*b+h,V=parseInt(E[k++])*b+a;l.moveTo(G,V);break}case"l":{const G=parseInt(E[k++])*b+h,V=parseInt(E[k++])*b+a;l.lineTo(G,V);break}case"q":{const G=parseInt(E[k++])*b+h,V=parseInt(E[k++])*b+a,O=parseInt(E[k++])*b+h,v=parseInt(E[k++])*b+a;l.quadraticCurveTo(O,v,G,V);break}case"b":{const G=parseInt(E[k++])*b+h,V=parseInt(E[k++])*b+a,O=parseInt(E[k++])*b+h,v=parseInt(E[k++])*b+a,s=parseInt(E[k++])*b+h,U=parseInt(E[k++])*b+a;l.bezierCurveTo(O,v,s,U,G,V);break}}}}return l.extractHoles(),{offsetX:V.ha*b,shapePath:l}}const DE={CreateBox:U.e,CreateTiledBox:g,CreateSphere:S.e,CreateDisc:s.d,CreateIcoSphere:q,CreateRibbon:v,CreateCylinder:P,CreateTorus:n,CreateTorusKnot:c,CreateLineSystem:z.g,pb:z.i,CreateDashedLines:z.d,ExtrudeShape:J,ExtrudeShapeCustom:m,CreateLathe:x,CreateTiledPlane:u,Ag:W.b,CreateGround:L.d,CreateTiledGround:L.h,CreateGroundFromHeightMap:L.b,CreatePolygon:y,ExtrudePolygon:e,CreateTube:t,CreatePolyhedron:X,CreateGeodesic:function(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=b.m||1;a!==Math.floor(a)&&(a=Math.floor(a),Z.c.Warn("m not an integer only floor(m) used"));let k=b.n||0;if(k!==Math.floor(k)&&(k=Math.floor(k),Z.c.Warn("n not an integer only floor(n) used")),k>a){const E=k;k=a,a=E,Z.c.Warn("n > m therefore m and n swapped")}const G=new OE;return G.build(a,k),X(E,{custom:sE.BuildGeodesicData(G),size:b.size,sizeX:b.sizeX,sizeY:b.sizeY,sizeZ:b.sizeZ,faceUV:b.faceUV,faceColors:b.faceColors,flat:b.flat,updatable:b.updatable,sideOrientation:b.sideOrientation,frontUVs:b.frontUVs,backUVs:b.backUVs},h)},CreateGoldberg:function(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=b.size,O=b.sizeX||G||1,v=b.sizeY||G||1,s=b.sizeZ||G||1;let U=b.m||1;U!==Math.floor(U)&&(U=Math.floor(U),Z.c.Warn("m not an integer only floor(m) used"));let o=b.n||0;if(o!==Math.floor(o)&&(o=Math.floor(o),Z.c.Warn("n not an integer only floor(n) used")),o>U){const E=o;o=U,U=E,Z.c.Warn("n > m therefore m and n swapped")}const u=new OE;u.build(U,o);const D=sE.BuildGeodesicData(u),g=D.toGoldbergPolyhedronData(),S=new UE(E,h);b.sideOrientation=k.b._GetDefaultSideOrientation(b.sideOrientation),S._originalBuilderSideOrientation=b.sideOrientation;(function(E,b){const h=E.size,k=E.sizeX||h||1,G=E.sizeY||h||1,O=E.sizeZ||h||1,v=0===E.sideOrientation?0:E.sideOrientation||V.c.DEFAULTSIDE,s=[],U=[],B=[],o=[];let u=1/0,D=-1/0,g=1/0,S=-1/0;for(let a=0;a<b.vertex.length;a++)u=Math.min(u,b.vertex[a][0]*k),D=Math.max(D,b.vertex[a][0]*k),g=Math.min(g,b.vertex[a][1]*G),S=Math.max(S,b.vertex[a][1]*G);let M=0;for(let V=0;V<b.face.length;V++){const E=b.face[V],h=a.k.jh(b.vertex[E[0]]),v=a.k.jh(b.vertex[E[2]]),I=a.k.jh(b.vertex[E[1]]),j=v.Xc(h),P=I.Xc(h),A=a.k.Cross(P,j).normalize();for(let a=0;a<E.length;a++){B.push(A.x,A.y,A.z);const h=b.vertex[E[a]];s.push(h[0]*k,h[1]*G,h[2]*O);const V=(h[1]*G-g)/(S-g);o.push((h[0]*k-u)/(D-u),l.c?1-V:V)}for(let b=0;b<E.length-2;b++)U.push(M,M+b+2,M+b+1);M+=E.length}V.c._ComputeSides(v,s,U,B,o);const I=new V.c;return I.xa=s,I.indices=U,I.ya=B,I.Aa=o,I})(b,g).Ca(S,b.updatable),S.goldbergData.nbSharedFaces=D.sharedNodes,S.goldbergData.nbUnsharedFaces=D.poleNodes,S.goldbergData.adjacentFaces=D.adjacentFaces,S.goldbergData.nbFaces=S.goldbergData.nbSharedFaces+S.goldbergData.nbUnsharedFaces,S.goldbergData.nbFacesAtPole=(S.goldbergData.nbUnsharedFaces-12)/12;for(let k=0;k<D.vertex.length;k++)S.goldbergData.faceCenters.push(a.k.jh(D.vertex[k])),S.goldbergData.faceCenters[k].x*=O,S.goldbergData.faceCenters[k].y*=v,S.goldbergData.faceCenters[k].z*=s,S.goldbergData.faceColors.push(new B.f(1,1,1,1));for(let k=0;k<g.face.length;k++){const E=g.face[k],b=a.k.jh(g.vertex[E[0]]),h=a.k.jh(g.vertex[E[2]]),G=a.k.jh(g.vertex[E[1]]),V=h.Xc(b),l=G.Xc(b),O=a.k.Cross(l,V).normalize(),v=a.k.Cross(l,O).normalize();S.goldbergData.faceXaxis.push(l.normalize()),S.goldbergData.faceYaxis.push(O),S.goldbergData.faceZaxis.push(v)}return S},CreateDecal:kE,CreateCapsule:VE,CreateText:function(E,b,h){let G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const O=function(E,b,h,a){const k=Array.from(E),G=b/a.resolution,V=(a.boundingBox.yMax-a.boundingBox.yMin+a.underlineThickness)*G,l=[];let O=0,v=0;for(let s=0;s<k.length;s++){const E=k[s];if("\n"===E)O=0,v-=V;else{const b=uE(E,G,O,v,h,a);b&&(O+=b.offsetX,l.push(b.shapePath))}}return l}(b,G.size||50,G.resolution||8,h),v=[];let s=0;for(const u of O){if(!u.paths.length)continue;const b=u.holes.slice();for(const h of u.paths){var U,B;const O=[],o=[],u=h.getPoints();for(const E of u)o.push(new a.k(E.x,0,E.y));const D=b.slice();for(const E of D){const k=E.getPoints();let G=!1;for(const E of k)if(h.isPointInside(E)){G=!0;break}if(!G)continue;const V=[];for(const E of k)V.push(new a.k(E.x,0,E.y));O.push(V),b.splice(b.indexOf(E),1)}if(!O.length&&b.length)for(const E of b){const b=E.getPoints(),h=[];for(const E of b)h.push(new a.k(E.x,0,E.y));O.push(h)}const g=e(E,{shape:o,holes:O.length?O:void 0,depth:G.depth||1,faceUV:G.faceUV||(null===(U=G.perLetterFaceUV)||void 0===U?void 0:U.call(G,s)),faceColors:G.faceColors||(null===(B=G.perLetterFaceColors)||void 0===B?void 0:B.call(G,s)),sideOrientation:k.b._GetDefaultSideOrientation(G.sideOrientation||k.b.DOUBLESIDE)},V,l);v.push(g),s++}}const o=k.b.MergeMeshes(v,!0,!0);if(o){const b=o.getBoundingInfo().boundingBox;o.position.x+=-(b.minimumWorld.x+b.maximumWorld.x)/2,o.position.y+=-(b.minimumWorld.y+b.maximumWorld.y)/2,o.position.z+=-(b.minimumWorld.z+b.maximumWorld.z)/2+b.extendSize.z,o.name=E;const h=new BE.c("pivot",V);h.rotation.x=-Math.PI/2,o.parent=h,o.bakeCurrentTransformIntoVertices(),o.parent=null,h.dispose()}return o}}},11319:(E,b,h)=>{"use strict";h.d(b,{b:()=>O});var a=h(11233),k=h(11322),G=h(11325),V=h(11343),l=h(11345);class O{get materialDefines(){var E;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(E=this._getDrawWrapper())||void 0===E?void 0:E.defines}set materialDefines(E){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=E}_getDrawWrapper(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];E=E??this._engine.currentRenderPassId;let h=this._drawWrappers[E];return!h&&b&&(this._drawWrappers[E]=h=new l.c(this._mesh.va().getEngine())),h}_removeDrawWrapper(E){var b;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(b=this._drawWrappers[E])||void 0===b||b.dispose());this._drawWrappers[E]=void 0}get effect(){var E;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(E=this._getDrawWrapper())||void 0===E?void 0:E.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(E){this._mainDrawWrapperOverride=E}setEffect(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2?arguments[2]:void 0,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const k=this._drawWrapper;k.setEffect(E,b,a),void 0!==h&&(k.materialContext=h),E||(k.defines=null,k.materialContext=void 0)}resetDrawCache(E){if(this._drawWrappers){if(void 0!==E)return void this._removeDrawWrapper(E);for(const E of this._drawWrappers)null===E||void 0===E||E.dispose()}this._drawWrappers=[]}static AddToMesh(E,b,h,a,k,G,V){return new O(E,b,h,a,k,G,V,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(E,b,h,a,k,G,V){let l=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],O=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=E,this.verticesStart=b,this.verticesCount=h,this.indexStart=a,this.indexCount=k,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=G,this._renderingMesh=V||G,O&&G.wg.push(this),this._engine=this._mesh.va().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=G.wg.length-1,l&&(this.refreshBoundingInfo(),G.Wj(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(E){return this._boundingInfo=E,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const E=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return E||this._renderingMesh}Ha(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const b=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!b)return E?this._mesh.va().defaultMaterial:null;if(this._isMultiMaterial(b)){const E=b.getSubMaterial(this.materialIndex);return this._currentMaterial!==E&&(this._currentMaterial=E,this.resetDrawCache()),E}return b}_isMultiMaterial(E){return void 0!==E.getSubMaterial}refreshBoundingInfo(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.Lj)return this;if(E||(E=this._renderingMesh.getVerticesData(a.g.PositionKind)),!E)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const b=this._renderingMesh.rg();let h;if(0===this.indexStart&&this.indexCount===b.length){const E=this._renderingMesh.getBoundingInfo();h={minimum:E.minimum.clone(),maximum:E.maximum.clone()}}else h=(0,V.b)(E,b,this.indexStart,this.indexCount,this._renderingMesh.Lj.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(h.minimum,h.maximum):this._boundingInfo=new G.b(h.minimum,h.maximum),this}_checkCollision(E){return this.getBoundingInfo()._checkCollision(E)}updateBoundingInfo(E){let b=this.getBoundingInfo();return b||(this.refreshBoundingInfo(),b=this.getBoundingInfo()),b&&b.update(E),this}isInFrustum(E){const b=this.getBoundingInfo();return!!b&&b.isInFrustum(E,this._mesh.Li)}isCompletelyInFrustum(E){const b=this.getBoundingInfo();return!!b&&b.isCompletelyInFrustum(E)}render(E){return this._renderingMesh.render(this,E,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(E,b){if(!this._linesIndexBuffer){const h=[];for(let b=this.indexStart;b<this.indexStart+this.indexCount;b+=3)h.push(E[b],E[b+1],E[b+1],E[b+2],E[b+2],E[b]);this._linesIndexBuffer=b.createIndexBuffer(h),this._linesIndexCount=h.length}return this._linesIndexBuffer}canIntersects(E){const b=this.getBoundingInfo();return!!b&&E.intersectsBox(b.boundingBox)}intersects(E,b,h,a,k){const G=this.Ha();if(!G)return null;let V=3,l=!1;switch(G.fillMode){case 3:case 5:case 6:case 8:return null;case 7:V=1,l=!0}return 4===G.fillMode?h.length?this._intersectLines(E,b,h,this._mesh.intersectionThreshold,a):this._intersectUnIndexedLines(E,b,h,this._mesh.intersectionThreshold,a):!h.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(E,b,h,a,k):this._intersectTriangles(E,b,h,V,l,a,k)}_intersectLines(E,b,h,a,G){let V=null;for(let l=this.indexStart;l<this.indexStart+this.indexCount;l+=2){const O=b[h[l]],v=b[h[l+1]],s=E.intersectionSegment(O,v,a);if(!(s<0)&&((G||!V||s<V.distance)&&(V=new k.d(null,null,s),V.faceId=l/2,G)))break}return V}_intersectUnIndexedLines(E,b,h,a,G){let V=null;for(let l=this.verticesStart;l<this.verticesStart+this.verticesCount;l+=2){const h=b[l],O=b[l+1],v=E.intersectionSegment(h,O,a);if(!(v<0)&&((G||!V||v<V.distance)&&(V=new k.d(null,null,v),V.faceId=l/2,G)))break}return V}_intersectTriangles(E,b,h,a,k,G,V){let l=null,O=-1;for(let v=this.indexStart;v<this.indexStart+this.indexCount-(3-a);v+=a){O++;const a=h[v],s=h[v+1],U=h[v+2];if(k&&4294967295===U){v+=2;continue}const B=b[a],o=b[s],u=b[U];if(!B||!o||!u)continue;if(V&&!V(B,o,u,E,a,s,U))continue;const D=E.intersectsTriangle(B,o,u);if(D){if(D.distance<0)continue;if((G||!l||D.distance<l.distance)&&(l=D,l.faceId=O,G))break}}return l}_intersectUnIndexedTriangles(E,b,h,a,k){let G=null;for(let V=this.verticesStart;V<this.verticesStart+this.verticesCount;V+=3){const h=b[V],l=b[V+1],O=b[V+2];if(k&&!k(h,l,O,E,-1,-1,-1))continue;const v=E.intersectsTriangle(h,l,O);if(v){if(v.distance<0)continue;if((a||!G||v.distance<G.distance)&&(G=v,G.faceId=V/3,a))break}}return G}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(E,b){const h=new O(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,E,b,!1);if(!this.IsGlobal){const E=this.getBoundingInfo();if(!E)return h;h._boundingInfo=new G.b(E.minimum,E.maximum)}return h}dispose(){this._linesIndexBuffer&&(this._mesh.va().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const E=this._mesh.wg.indexOf(this);this._mesh.wg.splice(E,1),this.resetDrawCache()}getClassName(){return"SubMesh"}static CreateFromIndices(E,b,h,a,k){let G=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],V=Number.MAX_VALUE,l=-Number.MAX_VALUE;const v=(k||a).rg();for(let O=b;O<b+h;O++){const E=v[O];E<V&&(V=E),E>l&&(l=E)}return new O(E,V,l-V+1,b,h,a,k,G)}}},12208:(E,b,h)=>{"use strict";var a=h(11419),k=h(11233),G=h(11175),V=h(10834),l=h(11325);a.b.prototype.thinInstanceAdd=function(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.va().getEngine().getCaps().instancedArrays)return V.c.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(E)?E.length:1);const h=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(E))for(let a=0;a<E.length;++a)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,E[a],a===E.length-1&&b);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,E,b);return h},a.b.prototype.thinInstanceAddSelf=function(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(G.d.IdentityReadOnly,E)},a.b.prototype.thinInstanceRegisterAttribute=function(E,b){E===k.g.ColorKind&&(E=k.g.ColorInstanceKind),this.removeVerticesData(E),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[E]=b,this._userThinInstanceBuffersStorage.sizes[E]=b*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[E]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[E]),this._userThinInstanceBuffersStorage.vertexBuffers[E]=new k.g(this.getEngine(),this._userThinInstanceBuffersStorage.data[E],E,!0,!1,b,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[E])},a.b.prototype.thinInstanceSetMatrixAt=function(E,b){let h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||E>=this._thinInstanceDataStorage.instancesCount)return!1;const a=this._thinInstanceDataStorage.matrixData;return b.copyToArray(a,16*E),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[E]=b),h&&(this.Xb("matrix"),this.Da||this.thinInstanceRefreshBoundingInfo(!1)),!0},a.b.prototype.thinInstanceSetAttributeAt=function(E,b,h){let a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return E===k.g.ColorKind&&(E=k.g.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[E]||b>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(E,0),this._userThinInstanceBuffersStorage.data[E].set(h,b*this._userThinInstanceBuffersStorage.strides[E]),a&&this.Xb(E),!0)},Object.defineProperty(a.b.prototype,"Rb",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(E){var b;const h=this._thinInstanceDataStorage.matrixData??(null===(b=this.source)||void 0===b?void 0:b._thinInstanceDataStorage.matrixData);E<=(h?h.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=E)},enumerable:!0,configurable:!0}),a.b.prototype._thinInstanceCreateMatrixBuffer=function(E,b){let h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const a=new k.d(this.getEngine(),b,!h,16,!1,!0);for(let k=0;k<4;k++)this.setVerticesBuffer(a.createVertexBuffer(E+k,4*k,4));return a},a.b.prototype.Kb=function(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var G;if(h=h||16,"matrix"===E)null===(G=this._thinInstanceDataStorage.matrixBuffer)||void 0===G||G.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=b?b.length:32*h,this._thinInstanceDataStorage.matrixData=b,this._thinInstanceDataStorage.worldMatrices=null,null!==b?(this._thinInstanceDataStorage.instancesCount=b.length/h,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",b,a),this.Da||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.Da||this.refreshBoundingInfo());else if("previousMatrix"===E){var V;null===(V=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===V||V.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=b,null!==b&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",b,a))}else{var l;if(E===k.g.ColorKind&&(E=k.g.ColorInstanceKind),null===b)null!==(l=this._userThinInstanceBuffersStorage)&&void 0!==l&&l.data[E]&&(this.removeVerticesData(E),delete this._userThinInstanceBuffersStorage.data[E],delete this._userThinInstanceBuffersStorage.strides[E],delete this._userThinInstanceBuffersStorage.sizes[E],delete this._userThinInstanceBuffersStorage.vertexBuffers[E]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[E]=b,this._userThinInstanceBuffersStorage.strides[E]=h,this._userThinInstanceBuffersStorage.sizes[E]=b.length,this._userThinInstanceBuffersStorage.vertexBuffers[E]=new k.g(this.getEngine(),b,E,!a,!1,h,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[E])}},a.b.prototype.Xb=function(E){var b;if("matrix"===E)this.Uj&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(E),null===(b=this._thinInstanceDataStorage.matrixBuffer)||void 0===b||b.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===E){var h;this.Uj&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(E),null===(h=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===h||h.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var a;E===k.g.ColorKind&&(E=k.g.ColorInstanceKind),null!==(a=this._userThinInstanceBuffersStorage)&&void 0!==a&&a.vertexBuffers[E]&&(this.Uj&&!this._userThinInstanceBuffersStorage.vertexBuffers[E].isUpdatable()&&this._thinInstanceRecreateBuffer(E),this._userThinInstanceBuffersStorage.vertexBuffers[E].updateDirectly(this._userThinInstanceBuffersStorage.data[E],0))}},a.b.prototype.thinInstancePartialBufferUpdate=function(E,b,h){var a;"matrix"===E?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(b,h):(E===k.g.ColorKind&&(E=k.g.ColorInstanceKind),null!==(a=this._userThinInstanceBuffersStorage)&&void 0!==a&&a.vertexBuffers[E]&&this._userThinInstanceBuffersStorage.vertexBuffers[E].updateDirectly(b,h))},a.b.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const E=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let b=0;b<this._thinInstanceDataStorage.instancesCount;++b)this._thinInstanceDataStorage.worldMatrices[b]=G.d.jh(E,16*b)}return this._thinInstanceDataStorage.worldMatrices},a.b.prototype.thinInstanceRefreshBoundingInfo=function(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const a=this._thinInstanceDataStorage.boundingVectors;if(E||!this.rawBoundingInfo){a.length=0,this.refreshBoundingInfo(b,h);const E=this.getBoundingInfo();this.rawBoundingInfo=new l.b(E.minimum,E.maximum)}const k=this.getBoundingInfo(),V=this._thinInstanceDataStorage.matrixData;if(0===a.length)for(let G=0;G<k.boundingBox.vectors.length;++G)a.push(k.boundingBox.vectors[G].clone());G.h.o[0].te(Number.POSITIVE_INFINITY),G.h.o[1].te(Number.NEGATIVE_INFINITY);for(let l=0;l<this._thinInstanceDataStorage.instancesCount;++l){G.d.FromArrayToRef(V,16*l,G.h.Matrix[0]);for(let E=0;E<a.length;++E)G.k.TransformCoordinatesToRef(a[E],G.h.Matrix[0],G.h.o[2]),G.h.o[0].minimizeInPlace(G.h.o[2]),G.h.o[1].maximizeInPlace(G.h.o[2])}k.reConstruct(G.h.o[0],G.h.o[1]),this.Ea()},a.b.prototype._thinInstanceRecreateBuffer=function(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var h;if("matrix"===E)null===(h=this._thinInstanceDataStorage.matrixBuffer)||void 0===h||h.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,b);else if("previousMatrix"===E){var a;if(this._scene.needsPreviousWorldMatrices)null===(a=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===a||a.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,b)}else{var G;E===k.g.ColorKind&&(E=k.g.ColorInstanceKind),null===(G=this._userThinInstanceBuffersStorage.vertexBuffers[E])||void 0===G||G.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[E]=new k.g(this.getEngine(),this._userThinInstanceBuffersStorage.data[E],E,!b,!1,this._userThinInstanceBuffersStorage.strides[E],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[E])}},a.b.prototype._thinInstanceUpdateBufferSize=function(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;E===k.g.ColorKind&&(E=k.g.ColorInstanceKind);const h="matrix"===E;if(!h&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[E]))return;const a=h?16:this._userThinInstanceBuffersStorage.strides[E],G=h?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[E];let V=h?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[E];const l=(this._thinInstanceDataStorage.instancesCount+b)*a;let O=G;for(;O<l;)O*=2;if(!V||G!=O){if(V){const E=new Float32Array(O);E.set(V,0),V=E}else V=new Float32Array(O);var v,s,U;if(h){if(null===(v=this._thinInstanceDataStorage.matrixBuffer)||void 0===v||v.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",V,!1),this._thinInstanceDataStorage.matrixData=V,this._thinInstanceDataStorage.matrixBufferSize=O,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(s=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===s||s.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",V,!1)}else null===(U=this._userThinInstanceBuffersStorage.vertexBuffers[E])||void 0===U||U.dispose(),this._userThinInstanceBuffersStorage.data[E]=V,this._userThinInstanceBuffersStorage.sizes[E]=O,this._userThinInstanceBuffersStorage.vertexBuffers[E]=new k.g(this.getEngine(),V,E,!0,!1,a,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[E])}},a.b.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},a.b.prototype._disposeThinInstanceSpecificData=function(){var E;null!==(E=this._thinInstanceDataStorage)&&void 0!==E&&E.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},11461:(E,b,h)=>{"use strict";h.d(b,{c:()=>U});var a=h(11130),k=h(11139),G=h(11206),V=h(10824),l=h(11175),O=h(11429),v=h(10958);const s=l.d.Compose(l.k.One(),l.g.FromEulerAngles(0,Math.PI,0),l.k.Zero());class U extends O.d{get billboardMode(){return this._billboardMode}set billboardMode(E){this._billboardMode!==E&&(this._billboardMode=E,this._cache.useBillboardPosition=0!==(this._billboardMode&U.BILLBOARDMODE_USE_POSITION),this._computeUseBillboardPath())}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set preserveParentRotationForBillboard(E){E!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=E,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==U.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(E){this._infiniteDistance!==E&&(this._infiniteDistance=E)}constructor(E){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(E,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new l.k(0,0,1),this._up=new l.k(0,1,0),this._right=new l.k(1,0,0),this._position=l.k.Zero(),this._rotation=l.k.Zero(),this._rotationQuaternion=null,this._scaling=l.k.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=U.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.Yj=l.d.Zero(),this._usePivotMatrix=!1,this._absolutePosition=l.k.Zero(),this._absoluteScaling=l.k.Zero(),this._absoluteRotationQuaternion=l.g.Identity(),this._pivotMatrix=l.d.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new V.e,this._nonUniformScaling=!1,b&&this.va().addTransformNode(this)}getClassName(){return"sb"}get position(){return this._position}set position(E){this._position=E,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(E){this._rotation=E,this._rotationQuaternion=null,this._markAsDirtyInternal()}get ve(){return this._scaling}set ve(E){this._scaling=E,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(E){this._rotationQuaternion=E,E&&this._rotation.te(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return l.k.TransformNormalFromFloatsToRef(0,0,this.va().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return l.k.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return l.k.TransformNormalFromFloatsToRef(this.va().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(E){return this._poseMatrix?(this._poseMatrix.p(E),this):(this._poseMatrix=E.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=l.d.Identity()),this._poseMatrix}_isSynchronized(){const E=this._cache;return this._billboardMode===E.billboardMode&&this._billboardMode===U.BILLBOARDMODE_NONE&&(!E.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const E=this._cache;E.localMatrixUpdated=!1,E.billboardMode=-1,E.infiniteDistance=!1,E.useBillboardPosition=!1,E.useBillboardPath=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(E){return this.setPivotMatrix(E,!1)}setPivotMatrix(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.p(E),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=b,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=l.d.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1?arguments[1]:void 0,h=arguments.length>2?arguments[2]:void 0;const a=this.clone("Clone of "+(this.name||this.id),E||this.parent,!0);a&&h&&h(this,a);for(const k of this.getChildTransformNodes(!0))k.instantiateHierarchy(a,b,h);return a}oc(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return E?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.te(0),this._rotationQuaternion=this._rotationQuaternion||l.g.Identity(),E.decompose(this._scaling,this._rotationQuaternion,this._position),this.Wj(!0)):(this._worldMatrix=E,this._absolutePosition.ue(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.Wj(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.Wj(!0),this}get xj(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.Wj(),this._absolutePosition}setAbsolutePosition(E){if(!E)return this;let b,h,a;if(void 0===E.x){if(arguments.length<3)return this;b=arguments[0],h=arguments[1],a=arguments[2]}else b=E.x,h=E.y,a=E.z;if(this.parent){const E=l.h.Matrix[0];this.parent.getWorldMatrix().invertToRef(E),l.k.TransformCoordinatesFromFloatsToRef(b,h,a,E,this.position)}else this.position.x=b,this.position.y=h,this.position.z=a;return this._absolutePosition.p(E),this}setPositionWithLocalVector(E){return this.Wj(),this.position=l.k.TransformNormal(E,this.Yj),this}getPositionExpressedInLocalSpace(){this.Wj();const E=l.h.Matrix[0];return this.Yj.invertToRef(E),l.k.TransformNormal(this.position,E)}locallyTranslate(E){return this.Wj(!0),this.position=l.k.TransformCoordinates(E,this.Yj),this}lookAt(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const G=U._LookAtVectorCache,V=0===k?this.position:this.getAbsolutePosition();if(E.subtractToRef(V,G),this.setDirection(G,b,h,a),1===k&&this.parent)if(this.rotationQuaternion){const E=l.h.Matrix[0];this.rotationQuaternion.toRotationMatrix(E);const b=l.h.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(b),b.invert(),E.multiplyToRef(b,E),this.rotationQuaternion.fromRotationMatrix(E)}else{const E=l.h.Quaternion[0];l.g.FromEulerVectorToRef(this.rotation,E);const b=l.h.Matrix[0];E.toRotationMatrix(b);const h=l.h.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(h),h.invert(),b.multiplyToRef(h,b),E.fromRotationMatrix(b),E.toEulerAnglesToRef(this.rotation)}return this}hf(E){const b=l.k.Zero();return this.getDirectionToRef(E,b),b}getDirectionToRef(E,b){return l.k.TransformNormalToRef(E,this.getWorldMatrix(),b),this}setDirection(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const k=-Math.atan2(E.z,E.x)+Math.PI/2,G=Math.sqrt(E.x*E.x+E.z*E.z),V=-Math.atan2(E.y,G);return this.rotationQuaternion?l.g.RotationYawPitchRollToRef(k+b,V+h,a,this.rotationQuaternion):(this.rotation.x=V+h,this.rotation.y=k+b,this.rotation.z=a),this}setPivotPoint(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.va().getRenderId()&&this.Wj(!0);const h=this.getWorldMatrix();if(1==b){const b=l.h.Matrix[0];h.invertToRef(b),E=l.k.TransformCoordinates(E,b)}return this.setPivotMatrix(l.d.Translation(-E.x,-E.y,-E.z),!0)}getPivotPoint(){const E=l.k.Zero();return this.getPivotPointToRef(E),E}getPivotPointToRef(E){return E.x=-this._pivotMatrix.m[12],E.y=-this._pivotMatrix.m[13],E.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const E=l.k.Zero();return this.getAbsolutePivotPointToRef(E),E}getAbsolutePivotPointToRef(E){return this.getPivotPointToRef(E),l.k.TransformCoordinatesToRef(E,this.getWorldMatrix(),E),this}ah(E){if(this._isDirty)return this;if(this._children)for(const b of this._children)b.ah(E);return super.ah(E)}setParent(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!E&&!this.parent)return this;const a=l.h.Quaternion[0],k=l.h.o[0],G=l.h.o[1],V=l.h.Matrix[1];l.d.IdentityToRef(V);const O=l.h.Matrix[0];this.Wj(!0);let v=this.rotationQuaternion;return v||(v=U._TmpRotation,l.g.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,v)),l.d.ComposeToRef(this.ve,v,this.position,O),this.parent&&O.multiplyToRef(this.parent.Wj(!0),O),E&&(E.Wj(!0).invertToRef(V),O.multiplyToRef(V,O)),O.decompose(G,a,k,b?this:void 0),this.rotationQuaternion?this.rotationQuaternion.p(a):a.toEulerAnglesToRef(this.rotation),this.ve.p(G),this.position.p(k),this.parent=E,h&&this.setPivotMatrix(l.d.Identity()),this}addChild(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return E.setParent(this,b),this}removeChild(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return E.setParent(null,b),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(E){return this._nonUniformScaling!==E&&(this._nonUniformScaling=E,!0)}attachToBone(E,b){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=b,this.parent=E,E.getSkeleton().prepare(!0),E.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=E?this._currentParentWhenAttachingToBone:null,this):(E&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(E,b,h){let a;if(E.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.te(0)),h&&0!==h){if(this.parent){const h=this.parent.getWorldMatrix(),a=l.h.Matrix[0];h.invertToRef(a),E=l.k.TransformNormal(E,a),h.determinant()<0&&(b*=-1)}a=l.g.RotationAxisToRef(E,b,U._RotationAxisCache),a.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else a=l.g.RotationAxisToRef(E,b,U._RotationAxisCache),this.rotationQuaternion.multiplyToRef(a,this.rotationQuaternion);return this}rotateAround(E,b,h){b.normalize(),this.rotationQuaternion||(this.rotationQuaternion=l.g.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.te(0));const a=l.h.o[0],k=l.h.o[1],G=l.h.o[2],V=l.h.Quaternion[0],O=l.h.Matrix[0],v=l.h.Matrix[1],s=l.h.Matrix[2],U=l.h.Matrix[3];return E.subtractToRef(this.position,a),l.d.TranslationToRef(a.x,a.y,a.z,O),l.d.TranslationToRef(-a.x,-a.y,-a.z,v),l.d.RotationAxisToRef(b,h,s),v.multiplyToRef(s,U),U.multiplyToRef(O,U),U.decompose(k,V,G),this.position.addInPlace(G),V.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(E,b,h){const a=E.scale(b);if(h&&0!==h)this.setAbsolutePosition(this.getAbsolutePosition().add(a));else{const E=this.getPositionExpressedInLocalSpace().add(a);this.setPositionWithLocalVector(E)}return this}addRotation(E,b,h){let a;this.rotationQuaternion?a=this.rotationQuaternion:(a=l.h.Quaternion[1],l.g.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,a));const k=l.h.Quaternion[0];return l.g.RotationYawPitchRollToRef(b,E,h,k),a.multiplyInPlace(k),this.rotationQuaternion||a.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==U.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}Wj(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const h=this.va().getRenderId();if(!this._isDirty&&!E&&(this._currentRenderId===h||this.isSynchronized()))return this._currentRenderId=h,this._worldMatrix;b=b||this.va().activeCamera,this._updateCache();const a=this._cache;a.pivotMatrixUpdated=!1,a.billboardMode=this.billboardMode,a.infiniteDistance=this.infiniteDistance,a.parent=this._parentNode,this._currentRenderId=h,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const k=this._getEffectiveParent(),G=U._TmpScaling;let V,O=this._position;if(this._infiniteDistance&&!this.parent&&b){const E=b.getWorldMatrix(),h=new l.k(E.m[12],E.m[13],E.m[14]);O=U._TmpTranslation,O.ue(this._position.x+h.x,this._position.y+h.y,this._position.z+h.z)}if(G.ue(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,V=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(l.g.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.ue(0,0,0))}}else V=U._TmpRotation,l.g.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,V);if(this._usePivotMatrix){const E=l.h.Matrix[1];l.d.ScalingToRef(G.x,G.y,G.z,E);const b=l.h.Matrix[0];V.toRotationMatrix(b),this._pivotMatrix.multiplyToRef(E,l.h.Matrix[4]),l.h.Matrix[4].multiplyToRef(b,this.Yj),this._postMultiplyPivotMatrix&&this.Yj.multiplyToRef(this._pivotMatrixInverse,this.Yj),this.Yj.addTranslationFromFloats(O.x,O.y,O.z)}else l.d.ComposeToRef(G,V,O,this.Yj);if(k&&k.getWorldMatrix){if(E&&k.Wj(E),a.useBillboardPath){if(this._transformToBoneReferal){const E=this.parent;E.getSkeleton().prepare(),E.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),l.h.Matrix[7])}else l.h.Matrix[7].p(k.getWorldMatrix());const E=l.h.o[5],b=l.h.o[6],h=l.h.Quaternion[0];l.h.Matrix[7].decompose(b,h,E),l.d.ScalingToRef(b.x,b.y,b.z,l.h.Matrix[7]),l.h.Matrix[7].setTranslation(E),U.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(h,E),this.Yj.setTranslation(E)),this.Yj.multiplyToRef(l.h.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const E=this.parent;E.getSkeleton().prepare(),this.Yj.multiplyToRef(E.getFinalMatrix(),l.h.Matrix[6]),l.h.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.Yj.multiplyToRef(k.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.p(this.Yj);if(a.useBillboardPath&&b&&this.billboardMode&&!a.useBillboardPosition){const E=l.h.o[0];if(this._worldMatrix.getTranslationToRef(E),l.h.Matrix[1].p(b.getViewMatrix()),this._scene.useRightHandedSystem&&l.h.Matrix[1].multiplyToRef(s,l.h.Matrix[1]),l.h.Matrix[1].setTranslationFromFloats(0,0,0),l.h.Matrix[1].invertToRef(l.h.Matrix[0]),(this.billboardMode&U.BILLBOARDMODE_ALL)!==U.BILLBOARDMODE_ALL){l.h.Matrix[0].decompose(void 0,l.h.Quaternion[0],void 0);const E=l.h.o[1];l.h.Quaternion[0].toEulerAnglesToRef(E),(this.billboardMode&U.BILLBOARDMODE_X)!==U.BILLBOARDMODE_X&&(E.x=0),(this.billboardMode&U.BILLBOARDMODE_Y)!==U.BILLBOARDMODE_Y&&(E.y=0),(this.billboardMode&U.BILLBOARDMODE_Z)!==U.BILLBOARDMODE_Z&&(E.z=0),l.d.RotationYawPitchRollToRef(E.y,E.x,E.z,l.h.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(l.h.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(l.h.o[0])}else if(a.useBillboardPath&&b&&a.useBillboardPosition){const E=l.h.o[0];this._worldMatrix.getTranslationToRef(E);const h=b.globalPosition;this._worldMatrix.invertToRef(l.h.Matrix[1]);const a=l.h.o[1];l.k.TransformCoordinatesToRef(h,l.h.Matrix[1],a),a.normalize();const k=-Math.atan2(a.z,a.x)+Math.PI/2,G=Math.sqrt(a.x*a.x+a.z*a.z),V=-Math.atan2(a.y,G);if(l.g.RotationYawPitchRollToRef(k,V,0,l.h.Quaternion[0]),(this.billboardMode&U.BILLBOARDMODE_ALL)!==U.BILLBOARDMODE_ALL){const E=l.h.o[1];l.h.Quaternion[0].toEulerAnglesToRef(E),(this.billboardMode&U.BILLBOARDMODE_X)!==U.BILLBOARDMODE_X&&(E.x=0),(this.billboardMode&U.BILLBOARDMODE_Y)!==U.BILLBOARDMODE_Y&&(E.y=0),(this.billboardMode&U.BILLBOARDMODE_Z)!==U.BILLBOARDMODE_Z&&(E.z=0),l.d.RotationYawPitchRollToRef(E.y,E.x,E.z,l.h.Matrix[0])}else l.d.FromQuaternionToRef(l.h.Quaternion[0],l.h.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(l.h.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(l.h.o[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):k&&k._nonUniformScaling?this._updateNonUniformScalingState(k._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.ue(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=l.d.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.Wj(),E){const E=this.getChildren();for(let b=0;b<E.length;++b){const h=E[b];if(h){h.Wj();const E=l.h.Matrix[0];h.Yj.multiplyToRef(this.Yj,E);const b=l.h.Quaternion[0];E.decompose(h.ve,b,h.position),h.rotationQuaternion?h.rotationQuaternion.p(b):b.toEulerAnglesToRef(h.rotation)}}}this.ve.ue(1,1,1),this.position.ue(0,0,0),this.rotation.ue(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=l.g.Identity()),this._worldMatrix=l.d.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(E){return this.onAfterWorldMatrixUpdateObservable.add(E),this}unregisterAfterWorldMatrixUpdate(E){return this.onAfterWorldMatrixUpdateObservable.removeCallback(E),this}getPositionInCameraSpace(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return E||(E=this.va().activeCamera),l.k.TransformCoordinates(this.getAbsolutePosition(),E.getViewMatrix())}getDistanceToCamera(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return E||(E=this.va().activeCamera),this.getAbsolutePosition().Xc(E.globalPosition).length()}clone(E,b,h){const a=G.e.Clone((()=>new U(E,this.va())),this);if(a.name=E,a.id=E,b&&(a.parent=b),!h){const b=this.getDescendants(!0);for(let h=0;h<b.length;h++){const k=b[h];k.clone&&k.clone(E+"."+k.name,a)}}return a}serialize(E){const b=G.e.Serialize(this,E);return b.type=this.getClassName(),b.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(b),b.localMatrix=this.getPivotMatrix().qj(),b.isEnabled=this.isEnabled(),G.e.AppendSerializedAnimations(this,b),b.ranges=this.serializeAnimationRanges(),b}static Parse(E,b,h){const a=G.e.Parse((()=>new U(E.name,b)),E,b,h);if(E.localMatrix?a.setPreTransformMatrix(l.d.jh(E.localMatrix)):E.pivotMatrix&&a.setPivotMatrix(l.d.jh(E.pivotMatrix)),a.Gb(E.isEnabled),a._waitingParsedUniqueId=E.uniqueId,void 0!==E.parentId&&(a._waitingParentId=E.parentId),void 0!==E.parentInstanceIndex&&(a._waitingParentInstanceIndex=E.parentInstanceIndex),E.animations){for(let b=0;b<E.animations.length;b++){const h=E.animations[b],k=(0,v.d)("BABYLON.Animation");k&&a.animations.push(k.Parse(h))}O.d.ParseAnimationRanges(a,E,b)}return E.autoAnimate&&b.beginAnimation(a,E.autoAnimateFrom,E.autoAnimateTo,E.autoAnimateLoop,E.autoAnimateSpeed||1),a}getChildTransformNodes(E,b){const h=[];return this._getDescendants(h,E,(E=>(!b||b(E))&&E instanceof U)),h}dispose(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.va().stopAnimation(this),this.va().removeTransformNode(this),this._parentContainer){const E=this._parentContainer.transformNodes.indexOf(this);E>-1&&this._parentContainer.transformNodes.splice(E,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),E){const E=this.getChildTransformNodes(!0);for(const b of E)b.parent=null,b.Wj(!0)}super.dispose(E,b)}normalizeToUnitCube(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2?arguments[2]:void 0,a=null,k=null;b&&(this.rotationQuaternion?(k=this.rotationQuaternion.clone(),this.rotationQuaternion.ue(0,0,0,1)):this.rotation&&(a=this.rotation.clone(),this.rotation.ue(0,0,0)));const G=this.getHierarchyBoundingVectors(E,h),V=G.max.Xc(G.min),l=Math.max(V.x,V.y,V.z);if(0===l)return this;const O=1/l;return this.ve.scaleInPlace(O),b&&(this.rotationQuaternion&&k?this.rotationQuaternion.p(k):this.rotation&&a&&this.rotation.p(a)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}U.BILLBOARDMODE_NONE=0,U.BILLBOARDMODE_X=1,U.BILLBOARDMODE_Y=2,U.BILLBOARDMODE_Z=4,U.BILLBOARDMODE_ALL=7,U.BILLBOARDMODE_USE_POSITION=128,U.BillboardUseParentOrientation=!1,U._TmpRotation=l.g.Zero(),U._TmpScaling=l.k.Zero(),U._TmpTranslation=l.k.Zero(),U._LookAtVectorCache=new l.k(0,0,0),U._RotationAxisCache=new l.g,(0,a.d)([(0,k.G)("position")],U.prototype,"_position",void 0),(0,a.d)([(0,k.G)("rotation")],U.prototype,"_rotation",void 0),(0,a.d)([(0,k.z)("rotationQuaternion")],U.prototype,"_rotationQuaternion",void 0),(0,a.d)([(0,k.G)("ve")],U.prototype,"_scaling",void 0),(0,a.d)([(0,k.H)("billboardMode")],U.prototype,"_billboardMode",void 0),(0,a.d)([(0,k.H)()],U.prototype,"scalingDeterminant",void 0),(0,a.d)([(0,k.H)("infiniteDistance")],U.prototype,"_infiniteDistance",void 0),(0,a.d)([(0,k.H)()],U.prototype,"ignoreNonUniformScaling",void 0),(0,a.d)([(0,k.H)()],U.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},11680:(E,b,h)=>{"use strict";h.d(b,{b:()=>v});var a=h(11175),k=h(11186),G=h(11659),V=h(11177),l=h(11201);class O{constructor(E,b,h,a){this.name=E,this.worldAxisForNormal=b,this.worldAxisForFileX=h,this.worldAxisForFileY=a}}class v{static ConvertCubeMapTextureToSphericalPolynomial(E){var b;if(!E.isCube)return null;null===(b=E.va())||void 0===b||b.getEngine().flushFramebuffer();const h=E.getSize().width,a=E.readPixels(0,void 0,void 0,!1),k=E.readPixels(1,void 0,void 0,!1);let G,V;E.isRenderTarget?(G=E.readPixels(3,void 0,void 0,!1),V=E.readPixels(2,void 0,void 0,!1)):(G=E.readPixels(2,void 0,void 0,!1),V=E.readPixels(3,void 0,void 0,!1));const l=E.readPixels(4,void 0,void 0,!1),O=E.readPixels(5,void 0,void 0,!1),v=E.gammaSpace;let s=0;return 1!=E.textureType&&2!=E.textureType||(s=1),new Promise((E=>{Promise.all([k,a,G,V,l,O]).then((b=>{let[a,k,G,V,l,O]=b;const U={size:h,right:k,left:a,up:G,down:V,front:l,back:O,format:5,type:s,gammaSpace:v};E(this.ConvertCubeMapToSphericalPolynomial(U))}))}))}static _AreaElement(E,b){return Math.atan2(E*b,Math.sqrt(E*E+b*b+1))}static ConvertCubeMapToSphericalPolynomial(E){const b=new G.e;let h=0;const a=2/E.size,O=a,v=.5*a,s=v-1;for(let G=0;G<6;G++){const U=this._FileFaces[G],B=E[U.name];let o=s;const u=5===E.format?4:3;for(let G=0;G<E.size;G++){let D=s;for(let O=0;O<E.size;O++){const s=U.worldAxisForFileX.scale(D).add(U.worldAxisForFileY.scale(o)).add(U.worldAxisForNormal);s.normalize();const g=this._AreaElement(D-v,o-v)-this._AreaElement(D-v,o+v)-this._AreaElement(D+v,o-v)+this._AreaElement(D+v,o+v);let S=B[G*E.size*u+O*u+0],M=B[G*E.size*u+O*u+1],I=B[G*E.size*u+O*u+2];isNaN(S)&&(S=0),isNaN(M)&&(M=0),isNaN(I)&&(I=0),0===E.type&&(S/=255,M/=255,I/=255),E.gammaSpace&&(S=Math.pow((0,k.b)(S),V.i),M=Math.pow((0,k.b)(M),V.i),I=Math.pow((0,k.b)(I),V.i));const j=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const E=Math.max(S,M,I);if(E>j){const b=j/E;S*=b,M*=b,I*=b}}else S=(0,k.b)(S,0,j),M=(0,k.b)(M,0,j),I=(0,k.b)(I,0,j);const P=new l.b(S,M,I);b.addLight(s,P,g),h+=g,D+=a}o+=O}}const U=6*(4*Math.PI)/6/h;return b.scaleInPlace(U),b.convertIncidentRadianceToIrradiance(),b.convertIrradianceToLambertianRadiance(),G.h.FromHarmonics(b)}}v._FileFaces=[new O("right",new a.k(1,0,0),new a.k(0,0,-1),new a.k(0,-1,0)),new O("left",new a.k(-1,0,0),new a.k(0,0,1),new a.k(0,-1,0)),new O("up",new a.k(0,1,0),new a.k(1,0,0),new a.k(0,0,1)),new O("down",new a.k(0,-1,0),new a.k(1,0,0),new a.k(0,0,-1)),new O("front",new a.k(0,0,1),new a.k(1,0,0),new a.k(0,-1,0)),new O("back",new a.k(0,0,-1),new a.k(-1,0,0),new a.k(0,-1,0))],v.MAX_HDRI_VALUE=4096,v.PRESERVE_CLAMPED_COLORS=!1},11183:(E,b,h)=>{"use strict";function a(E,b){const h=[];for(let a=0;a<E;++a)h.push(b());return h}function k(E,b){return a(E,b)}h.d(b,{b:()=>a,e:()=>k,i:()=>V});const G=["push","splice","pop","shift","unshift"];function V(E,b){const h=G.map((h=>function(E,b,h){const a=E[b];if("function"!==typeof a)return null;const k=function(){const a=E.length,G=k.previous.apply(E,arguments);return h(b,a),G};return a.next=k,k.previous=a,E[b]=k,()=>{const h=k.previous;if(!h)return;const a=k.next;a?(h.next=a,a.previous=h):(h.next=void 0,E[b]=h),k.next=void 0,k.previous=void 0}}(E,h,b)));return()=>{h.forEach((E=>{null===E||void 0===E||E()}))}}},12150:(E,b,h)=>{"use strict";h.d(b,{e:()=>V});var a=h(11376),k=h(12152);let G=0;const V=E=>{if(!E.environmentBRDFTexture){const b=E.useDelayedTextureLoading;E.useDelayedTextureLoading=!1;const h=E._blockEntityCollection;E._blockEntityCollection=!1;const V=a.b.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+G++,E,!0,!1,a.b.BILINEAR_SAMPLINGMODE);E._blockEntityCollection=h;const l=E.getEngine().getLoadedTexturesCache(),O=l.indexOf(V.getInternalTexture());-1!==O&&l.splice(O,1),V.isRGBD=!0,V.wrapU=a.b.CLAMP_ADDRESSMODE,V.wrapV=a.b.CLAMP_ADDRESSMODE,E.environmentBRDFTexture=V,E.useDelayedTextureLoading=b,k.d.ExpandRGBDTexture(V);const v=E.getEngine().onContextRestoredObservable.add((()=>{V.isRGBD=!0;const b=E.onBeforeRenderObservable.add((()=>{V.isReady()&&(E.onBeforeRenderObservable.remove(b),k.d.ExpandRGBDTexture(V))}))}));E.rj.add((()=>{E.getEngine().onContextRestoredObservable.remove(v)}))}return E.environmentBRDFTexture}},11422:(E,b,h)=>{"use strict";function a(E,b,h){try{const a=E.next();a.done?b(a):a.value?a.value.then((()=>{a.value=void 0,b(a)}),h):b(a)}catch(a){h(a)}}function k(){let E,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(h,k,G)=>{const V=performance.now();void 0===E||V-E>b?(E=V,setTimeout((()=>{a(h,k,G)}),0)):a(h,k,G)}}function G(E,b,h,a,k){const G=()=>{let V;const l=E=>{E.done?h(E.value):void 0===V?V=!0:G()};do{V=void 0,k&&k.aborted?a(new Error("Aborted")):b(E,l,a),void 0===V&&(V=!1)}while(V)};G()}function V(E,b){let h;return G(E,a,(E=>h=E),(E=>{throw E}),b),h}function l(E,b,h){return new Promise(((a,k)=>{G(E,b,a,k,h)}))}function O(E,b){return function(){return V(E(...arguments),b)}}h.d(b,{b:()=>k,c:()=>O,d:()=>l,h:()=>V})},11677:(E,b,h)=>{"use strict";h.d(b,{c:()=>u});var a=h(11186),k=h(10834),G=h(11680),V=h(11685);h(11719);const l=131072,O=131072;function v(E){return E.charCodeAt(0)+(E.charCodeAt(1)<<8)+(E.charCodeAt(2)<<16)+(E.charCodeAt(3)<<24)}const s=v("DXT1"),U=v("DXT3"),B=v("DXT5"),o=v("DX10");class u{static GetDDSInfo(E){const b=new Int32Array(E.buffer,E.byteOffset,31),h=new Int32Array(E.buffer,E.byteOffset,35);let a=1;b[2]&l&&(a=Math.max(1,b[7]));const k=b[21],G=k===o?h[32]:0;let V=0;switch(k){case 113:V=2;break;case 116:V=1;break;case o:if(10===G){V=2;break}if(2===G){V=1;break}}return{width:b[4],height:b[3],mipmapCount:a,isFourCC:4===(4&b[20]),isRGB:64===(64&b[20]),isLuminance:(b[20]&O)===O,isCube:512===(512&b[28]),isCompressed:k===s||k===U||k===B,dxgiFormat:G,textureType:V}}static _GetHalfFloatAsFloatRGBAArrayBuffer(E,b,h,a,k,G){const l=new Float32Array(a),O=new Uint16Array(k,h);let v=0;for(let s=0;s<b;s++)for(let b=0;b<E;b++){const h=4*(b+s*E);l[v]=(0,V.f)(O[h]),l[v+1]=(0,V.f)(O[h+1]),l[v+2]=(0,V.f)(O[h+2]),u.StoreLODInAlphaChannel?l[v+3]=G:l[v+3]=(0,V.f)(O[h+3]),v+=4}return l}static _GetHalfFloatRGBAArrayBuffer(E,b,h,a,k,G){if(u.StoreLODInAlphaChannel){const l=new Uint16Array(a),O=new Uint16Array(k,h);let v=0;for(let h=0;h<b;h++)for(let b=0;b<E;b++){const a=4*(b+h*E);l[v]=O[a],l[v+1]=O[a+1],l[v+2]=O[a+2],l[v+3]=(0,V.h)(G),v+=4}return l}return new Uint16Array(k,h,a)}static _GetFloatRGBAArrayBuffer(E,b,h,a,k,G){if(u.StoreLODInAlphaChannel){const V=new Float32Array(a),l=new Float32Array(k,h);let O=0;for(let h=0;h<b;h++)for(let b=0;b<E;b++){const a=4*(b+h*E);V[O]=l[a],V[O+1]=l[a+1],V[O+2]=l[a+2],V[O+3]=G,O+=4}return V}return new Float32Array(k,h,a)}static _GetFloatAsHalfFloatRGBAArrayBuffer(E,b,h,a,k,G){const l=new Uint16Array(a),O=new Float32Array(k,h);let v=0;for(let s=0;s<b;s++)for(let b=0;b<E;b++)l[v]=(0,V.h)(O[v]),l[v+1]=(0,V.h)(O[v+1]),l[v+2]=(0,V.h)(O[v+2]),u.StoreLODInAlphaChannel?l[v+3]=(0,V.h)(G):l[v+3]=(0,V.h)(O[v+3]),v+=4;return l}static _GetFloatAsUIntRGBAArrayBuffer(E,b,h,k,G,V){const l=new Uint8Array(k),O=new Float32Array(G,h);let v=0;for(let s=0;s<b;s++)for(let b=0;b<E;b++){const h=4*(b+s*E);l[v]=255*(0,a.b)(O[h]),l[v+1]=255*(0,a.b)(O[h+1]),l[v+2]=255*(0,a.b)(O[h+2]),u.StoreLODInAlphaChannel?l[v+3]=V:l[v+3]=255*(0,a.b)(O[h+3]),v+=4}return l}static _GetHalfFloatAsUIntRGBAArrayBuffer(E,b,h,k,G,l){const O=new Uint8Array(k),v=new Uint16Array(G,h);let s=0;for(let U=0;U<b;U++)for(let b=0;b<E;b++){const h=4*(b+U*E);O[s]=255*(0,a.b)((0,V.f)(v[h])),O[s+1]=255*(0,a.b)((0,V.f)(v[h+1])),O[s+2]=255*(0,a.b)((0,V.f)(v[h+2])),u.StoreLODInAlphaChannel?O[s+3]=l:O[s+3]=255*(0,a.b)((0,V.f)(v[h+3])),s+=4}return O}static _GetRGBAArrayBuffer(E,b,h,a,k,G,V,l,O){const v=new Uint8Array(a),s=new Uint8Array(k,h);let U=0;for(let B=0;B<b;B++)for(let b=0;b<E;b++){const h=4*(b+B*E);v[U]=s[h+G],v[U+1]=s[h+V],v[U+2]=s[h+l],v[U+3]=s[h+O],U+=4}return v}static _ExtractLongWordOrder(E){return 0===E||255===E||-16777216===E?0:1+u._ExtractLongWordOrder(E>>8)}static _GetRGBArrayBuffer(E,b,h,a,k,G,V,l){const O=new Uint8Array(a),v=new Uint8Array(k,h);let s=0;for(let U=0;U<b;U++)for(let b=0;b<E;b++){const h=3*(b+U*E);O[s]=v[h+G],O[s+1]=v[h+V],O[s+2]=v[h+l],s+=3}return O}static _GetLuminanceArrayBuffer(E,b,h,a,k){const G=new Uint8Array(a),V=new Uint8Array(k,h);let l=0;for(let O=0;O<b;O++)for(let b=0;b<E;b++){const h=b+O*E;G[l]=V[h],l++}return G}static UploadDDSLevels(E,b,h,a,V,O){let v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:-1,D=arguments.length>7?arguments[7]:void 0,g=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],S=null;a.sphericalPolynomial&&(S=[]);const M=!!E.getCaps().s3tc;b.generateMipMaps=V;const I=new Int32Array(h.buffer,h.byteOffset,31);let j,P,A,n,d,c,z,Z=0,Y=0,r=1;if(542327876!==I[0])return void k.c.Error("Invalid magic number in DDS header");if(!a.isFourCC&&!a.isRGB&&!a.isLuminance)return void k.c.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(a.isCompressed&&!M)return void k.c.Error("Compressed textures are not supported on this platform.");let w=I[22];n=I[1]+4;let N=!1;if(a.isFourCC)switch(j=I[21],j){case s:r=8,Y=33777;break;case U:r=16,Y=33778;break;case B:r=16,Y=33779;break;case 113:N=!0,w=64;break;case 116:N=!0,w=128;break;case o:{n+=20;let E=!1;switch(a.dxgiFormat){case 10:N=!0,w=64,E=!0;break;case 2:N=!0,w=128,E=!0;break;case 88:a.isRGB=!0,a.isFourCC=!1,w=32,E=!0}if(E)break}default:return void k.c.Error(["Unsupported FourCC code:",(H=j,String.fromCharCode(255&H,H>>8&255,H>>16&255,H>>24&255))])}var H;const f=u._ExtractLongWordOrder(I[23]),F=u._ExtractLongWordOrder(I[24]),y=u._ExtractLongWordOrder(I[25]),e=u._ExtractLongWordOrder(I[26]);N&&(Y=E._getRGBABufferInternalSizedFormat(a.textureType)),c=1,I[2]&l&&!1!==V&&(c=Math.max(1,I[7]));const J=D||0,m=E.getCaps();for(let k=J;k<O;k++){for(P=I[4],A=I[3],z=0;z<c;++z){if(-1===v||v===z){const G=-1===v?z:0;if(!a.isCompressed&&a.isFourCC){b.format=5,Z=P*A*4;let a=null;if(E._badOS||E._badDesktopOS||!m.textureHalfFloat&&!m.textureFloat)128===w?(a=u._GetFloatAsUIntRGBAArrayBuffer(P,A,h.byteOffset+n,Z,h.buffer,G),S&&0==G&&S.push(u._GetFloatRGBAArrayBuffer(P,A,h.byteOffset+n,Z,h.buffer,G))):64===w&&(a=u._GetHalfFloatAsUIntRGBAArrayBuffer(P,A,h.byteOffset+n,Z,h.buffer,G),S&&0==G&&S.push(u._GetHalfFloatAsFloatRGBAArrayBuffer(P,A,h.byteOffset+n,Z,h.buffer,G))),b.type=0;else{const E=m.textureFloat&&(g&&m.textureFloatLinearFiltering||!g),k=m.textureHalfFloat&&(g&&m.textureHalfFloatLinearFiltering||!g),V=(128===w||64===w&&!k)&&E?1:(64===w||128===w&&!E)&&k?2:0;let l,O=null;if(128===w)switch(V){case 1:l=u._GetFloatRGBAArrayBuffer,O=null;break;case 2:l=u._GetFloatAsHalfFloatRGBAArrayBuffer,O=u._GetFloatRGBAArrayBuffer;break;case 0:l=u._GetFloatAsUIntRGBAArrayBuffer,O=u._GetFloatRGBAArrayBuffer}else switch(V){case 1:l=u._GetHalfFloatAsFloatRGBAArrayBuffer,O=null;break;case 2:l=u._GetHalfFloatRGBAArrayBuffer,O=u._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:l=u._GetHalfFloatAsUIntRGBAArrayBuffer,O=u._GetHalfFloatAsFloatRGBAArrayBuffer}b.type=V,a=l(P,A,h.byteOffset+n,Z,h.buffer,G),S&&0==G&&S.push(O?O(P,A,h.byteOffset+n,Z,h.buffer,G):a)}a&&E._uploadDataToTextureDirectly(b,a,k,G)}else if(a.isRGB)b.type=0,24===w?(b.format=4,Z=P*A*3,d=u._GetRGBArrayBuffer(P,A,h.byteOffset+n,Z,h.buffer,f,F,y),E._uploadDataToTextureDirectly(b,d,k,G)):(b.format=5,Z=P*A*4,d=u._GetRGBAArrayBuffer(P,A,h.byteOffset+n,Z,h.buffer,f,F,y,e),E._uploadDataToTextureDirectly(b,d,k,G));else if(a.isLuminance){const a=E._getUnpackAlignement(),V=P;Z=Math.floor((P+a-1)/a)*a*(A-1)+V,d=u._GetLuminanceArrayBuffer(P,A,h.byteOffset+n,Z,h.buffer),b.format=1,b.type=0,E._uploadDataToTextureDirectly(b,d,k,G)}else Z=Math.max(4,P)/4*Math.max(4,A)/4*r,d=new Uint8Array(h.buffer,h.byteOffset+n,Z),b.type=0,E._uploadCompressedDataToTextureDirectly(b,Y,P,A,d,k,G)}n+=w?P*A*(w/8):Z,P*=.5,A*=.5,P=Math.max(1,P),A=Math.max(1,A)}if(void 0!==D)break}S&&S.length>0?a.sphericalPolynomial=G.b.ConvertCubeMapToSphericalPolynomial({size:I[4],right:S[0],left:S[1],up:S[2],down:S[3],front:S[4],back:S[5],format:5,type:1,gammaSpace:!1}):a.sphericalPolynomial=void 0}}u.StoreLODInAlphaChannel=!1},11148:(E,b,h)=>{"use strict";h.d(b,{e:()=>G,i:()=>V});const a={},k={};function G(E){const b=E.getClassName();return k[b]||(k[b]={}),k[b]}function V(E){const b=E.getClassName();if(a[b])return a[b];a[b]={};const h=a[b];let G=E,V=b;for(;V;){const E=k[V];for(const k in E)h[k]=E[k];let b,a=!1;do{if(b=Object.getPrototypeOf(G),!b.getClassName){a=!0;break}if(b.getClassName()!==V)break;G=b}while(b);if(a)break;V=b.getClassName(),G=b}return h}},11139:(E,b,h)=>{"use strict";h.d(b,{C:()=>l,F:()=>s,G:()=>U,H:()=>V,b:()=>G,d:()=>M,f:()=>o,g:()=>O,k:()=>u,n:()=>v,q:()=>D,s:()=>S,v:()=>B,z:()=>g});var a=h(11148);function k(E,b){return(h,k)=>{const G=(0,a.e)(h);G[k]||(G[k]={type:E,sourceName:b})}}function G(E){return function(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(h,a)=>{const k=b||"_"+a;Object.defineProperty(h,a,{get:function(){return this[k]},set:function(b){"function"===typeof this.equals&&this.equals(b)||this[k]!==b&&(this[k]=b,h[E].apply(this))},enumerable:!0,configurable:!0})}}(E,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)}function V(E){return k(0,E)}function l(E){return k(1,E)}function O(E){return k(2,E)}function v(E){return k(3,E)}function s(E){return k(4,E)}function U(E){return k(5,E)}function B(E){return k(6,E)}function o(E){return k(7,E)}function u(E){return k(8,E)}function D(E){return k(9,E)}function g(E){return k(10,E)}function S(E){return k(12,E)}function M(E,b,h,a){const k=h.value;h.value=function(){let h=k;if("undefined"!==typeof _native&&_native[b]){const E=_native[b];h=a?function(){return a(...arguments)?E(...arguments):k(...arguments)}:E}return E[b]=h,h(...arguments)}}M.filter=function(E){return(b,h,a)=>M(b,h,a,E)}},11206:(E,b,h)=>{"use strict";h.d(b,{e:()=>v});var a=h(10855),k=h(11170),G=h(11201),V=h(11175),l=h(11148);const O=function(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const G=E();k.b&&k.b.HasTags(b)&&k.b.AddTagsTo(G,k.b.GetTags(b,!0));const V=(0,l.i)(G),O={};for(const k in V){const E=V[k],l=b[k],s=E.type;if(void 0!==l&&null!==l&&("uniqueId"!==k||v.AllowLoadingUniqueId))switch(s){case 0:case 6:case 11:G[k]=l;break;case 1:a.cloneTexturesOnlyOnce&&O[l.uniqueId]?G[k]=O[l.uniqueId]:(G[k]=h||l.isRenderTarget?l:l.clone(),O[l.uniqueId]=G[k]);break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:G[k]=h?l:l.clone()}}return G};class v{static AppendSerializedAnimations(E,b){if(E.animations){b.animations=[];for(let h=0;h<E.animations.length;h++){const a=E.animations[h];b.animations.push(a.serialize())}}}static Serialize(E,b){b||(b={}),k.b&&(b.tags=k.b.GetTags(E));const h=(0,l.i)(E);for(const a in h){const k=h[a],G=k.sourceName||a,V=k.type,l=E[a];if(void 0!==l&&null!==l&&("uniqueId"!==a||v.AllowLoadingUniqueId))switch(V){case 0:b[G]=l;break;case 1:case 3:case 7:case 9:b[G]=l.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:b[G]=l.qj();break;case 6:case 11:b[G]=l.id}}return b}static ParseProperties(E,b,h,a){a||(a="");const k=(0,l.i)(b);for(const l in k){const O=k[l],s=E[O.sourceName||l],U=O.type;if(void 0!==s&&null!==s&&("uniqueId"!==l||v.AllowLoadingUniqueId)){const E=b;switch(U){case 0:E[l]=s;break;case 1:h&&(E[l]=v._TextureParser(s,h,a));break;case 2:E[l]=G.b.jh(s);break;case 3:E[l]=v._FresnelParametersParser(s);break;case 4:E[l]=V.j.jh(s);break;case 5:E[l]=V.k.jh(s);break;case 6:h&&(E[l]=h.getLastMeshById(s));break;case 7:E[l]=v._ColorCurvesParser(s);break;case 8:E[l]=G.f.jh(s);break;case 9:E[l]=v._ImageProcessingConfigurationParser(s);break;case 10:E[l]=V.g.jh(s);break;case 11:h&&(E[l]=h.getCameraById(s));break;case 12:E[l]=V.d.jh(s)}}}}static Parse(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const G=E();return k.b&&k.b.AddTagsTo(G,b.tags),v.ParseProperties(b,G,h,a),G}static Clone(E,b){return O(E,b,!1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}static Instanciate(E,b){return O(E,b,!0)}}v.AllowLoadingUniqueId=!1,v._ImageProcessingConfigurationParser=E=>{throw(0,a.c)("ImageProcessingConfiguration")},v._FresnelParametersParser=E=>{throw(0,a.c)("FresnelParameters")},v._ColorCurvesParser=E=>{throw(0,a.c)("ColorCurves")},v._TextureParser=(E,b,h)=>{throw(0,a.c)("Texture")}},10841:(E,b,h)=>{"use strict";h.d(b,{c:()=>G});var a=h(10834);const k=(E,b,h)=>E?E.getClassName&&"Mesh"===E.getClassName()?null:!E.getClassName||"SubMesh"!==E.getClassName()&&"PhysicsBody"!==E.getClassName()?E.clone?E.clone():Array.isArray(E)?E.slice():h&&"object"===typeof E?{...E}:null:E.clone(b):null;class G{static DeepCopy(E,b,h,G){let V=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const l=function(E){const b=[];do{Object.getOwnPropertyNames(E).forEach((function(E){-1===b.indexOf(E)&&b.push(E)}))}while(E=Object.getPrototypeOf(E));return b}(E);for(const v of l){if("_"===v[0]&&(!G||-1===G.indexOf(v)))continue;if(v.endsWith("Observable"))continue;if(h&&-1!==h.indexOf(v))continue;const l=E[v],s=typeof l;if("function"!==s)try{if("object"===s)if(l instanceof Uint8Array)b[v]=Uint8Array.from(l);else if(l instanceof Array){if(b[v]=[],l.length>0)if("object"==typeof l[0])for(let E=0;E<l.length;E++){const h=k(l[E],b,V);-1===b[v].indexOf(h)&&b[v].push(h)}else b[v]=l.slice(0)}else b[v]=k(l,b,V);else b[v]=l}catch(O){a.c.Warn(O.message)}}}}},10855:(E,b,h)=>{"use strict";h.d(b,{c:()=>k});const a={};function k(E){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!a[E])return a[E]=!0,`${E} needs to be imported before as it contains a side-effect required by your code.`}},10832:(E,b,h)=>{"use strict";function a(){return"undefined"!==typeof window}function k(){return"undefined"!==typeof navigator}function G(){return"undefined"!==typeof document}function V(E){let b="",h=E.firstChild;for(;h;)3===h.nodeType&&(b+=h.textContent),h=h.nextSibling;return b}h.d(b,{d:()=>V,e:()=>G,g:()=>k,i:()=>a})},12198:(E,b,h)=>{"use strict";h.r(b),h.d(b,{Dispose:()=>B,DumpData:()=>U,DumpDataAsync:()=>s,DumpFramebuffer:()=>v,DumpTools:()=>o});var a=h(11706),k=h(10821),G=h(11186),V=h(10869);let l,O=null;async function v(E,b,h,a){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",G=arguments.length>5?arguments[5]:void 0,V=arguments.length>6?arguments[6]:void 0;const l=await h.readPixels(0,0,E,b);U(E,b,new Uint8Array(l.buffer),a,k,G,!0,void 0,V)}function s(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",k=arguments.length>4?arguments[4]:void 0,G=arguments.length>5&&void 0!==arguments[5]&&arguments[5],V=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7?arguments[7]:void 0;return new Promise((O=>{U(E,b,h,(E=>O(E)),a,k,G,V,l)}))}function U(E,b,v,s){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",o=arguments.length>5?arguments[5]:void 0,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],D=arguments.length>7&&void 0!==arguments[7]&&arguments[7],g=arguments.length>8?arguments[8]:void 0;(async function(){return O||(O=new Promise(((E,b)=>{let k,G=null;const O={Ih:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(h.bind(h,11594)).then((v=>{let{ThinEngine:s}=v;try{k=new OffscreenCanvas(100,100),G=new s(k,!1,O)}catch(o){k=document.createElement("canvas"),G=new s(k,!1,O)}V.b.Instances.pop(),V.b.OnEnginesDisposedObservable.add((E=>{G&&E!==G&&!G.u&&0===V.b.Instances.length&&B()})),G.getCaps().parallelShaderCompile=void 0;const U=new a.c(G);h.e(34).then(h.bind(h,13350)).then((h=>{let{passPixelShader:V}=h;if(!G)return void b("Engine is not defined");const O=new a.d({xd:G,name:V.name,fragmentShader:V.shader,samplerNames:["textureSampler"]});l={canvas:k,xd:G,renderer:U,wrapper:O},E(l)}))})).catch(b)}))),await O})().then((h=>{if(h.xd.setSize(E,b,!0),v instanceof Float32Array){const E=new Uint8Array(v.length);let b=v.length;for(;b--;){const h=v[b];E[b]=Math.round(255*(0,G.b)(h))}v=E}const a=h.xd.createRawTexture(v,E,b,5,!1,!u,1);h.renderer.setViewport(),h.renderer.applyEffectWrapper(h.wrapper),h.wrapper.effect._bindTexture("textureSampler",a),h.renderer.draw(),D?k.g.ToBlob(h.canvas,(E=>{const b=new FileReader;b.onload=E=>{const b=E.target.result;s&&s(b)},b.readAsArrayBuffer(E)}),U,g):k.g.EncodeScreenshotCanvasData(h.canvas,s,U,o,g),a.dispose()}))}function B(){var E;l?(l.wrapper.dispose(),l.renderer.dispose(),l.xd.dispose()):null===(E=O)||void 0===E||E.then((E=>{E.wrapper.dispose(),E.renderer.dispose(),E.xd.dispose()}));O=null,l=null}const o={DumpData:U,DumpDataAsync:s,DumpFramebuffer:v,Dispose:B};k.g.DumpData=U,k.g.DumpDataAsync=s,k.g.DumpFramebuffer=v},12191:(E,b,h)=>{"use strict";h.d(b,{c:()=>u,e:()=>S,i:()=>j,m:()=>P});var a=h(10821),k=h(11175),G=h(11186),V=h(11659),l=h(10939),O=h(11381),v=(h(11163),h(11697)),s=h(10834);h(12152),h(12166),h(12198);const U="image/png",B=2,o=[134,22,135,150,246,214,150,54];function u(E){const b=new DataView(E.buffer,E.byteOffset,E.byteLength);let h=0;for(let V=0;V<o.length;V++)if(b.getUint8(h++)!==o[V])return s.c.Error("Not a babylon environment map"),null;let a="",k=0;for(;k=b.getUint8(h++);)a+=String.fromCharCode(k);let G=JSON.parse(a);return G=D(G),G.Lh&&(G.Lh.specularDataPosition=h,G.Lh.lodGenerationScale=G.Lh.lodGenerationScale||.8),G}function D(E){if(E.version>B)throw new Error(`Unsupported babylon environment map version "${E.version}". Latest supported version is "${B}".`);return 2===E.version?E:E={...E,version:2,imageType:U}}function g(E,b){const h=(b=D(b)).Lh;let a=Math.log2(b.width);if(a=Math.round(a)+1,h.mipmaps.length!==6*a)throw new Error(`Unsupported specular mipmaps number "${h.mipmaps.length}"`);const k=new Array(a);for(let G=0;G<a;G++){k[G]=new Array(6);for(let b=0;b<6;b++){const a=h.mipmaps[6*G+b];k[G][b]=new Uint8Array(E.buffer,E.byteOffset+h.specularDataPosition+a.position,a.length)}}return k}function S(E,b,h){const a=(h=D(h)).Lh;if(!a)return Promise.resolve();E._lodGenerationScale=a.lodGenerationScale;return I(E,g(b,h),h.imageType)}function M(E,b,h,a,k,G,V,l,O,v,s){return new Promise(((U,B)=>{if(h){const h=b.createTexture(null,!0,!0,null,1,null,(E=>{B(E)}),E);null===a||void 0===a||a.onEffectCreatedObservable.addOnce((l=>{l.executeWhenCompiled((()=>{a.externalTextureSamplerBinding=!0,a.onApply=a=>{a._bindTexture("textureSampler",h),a.setFloat2("scale",1,b._features.needsInvertingBitmap&&E instanceof ImageBitmap?-1:1)},b.scenes.length&&(b.scenes[0].postProcessManager.directRender([a],v,!0,G,V),b.restoreDefaultFramebuffer(),h.dispose(),URL.revokeObjectURL(k),U())}))}))}else{if(b._uploadImageToTexture(s,E,G,V),l){const h=O[V];h&&b._uploadImageToTexture(h._texture,E,G,0)}U()}}))}async function I(E,b){let k=arguments.length>2&&void 0!==arguments[2]?arguments[2]:U;if(!a.g.IsExponentOfTwo(E.width))throw new Error("Texture size must be a power of two");const V=(0,G.l)(E.width)+1,s=E.getEngine();let B=!1,o=!1,u=null,D=null,g=null;const S=s.getCaps();E.format=5,E.type=0,E.generateMipMaps=!0,E._cachedAnisotropicFilteringLevel=null,s.updateTextureSamplingMode(3,E),S.textureLOD?s._features.supportRenderAndCopyToLodForFloatTextures?S.textureHalfFloatRender&&S.textureHalfFloatLinearFiltering?(B=!0,E.type=2):S.textureFloatRender&&S.textureFloatLinearFiltering&&(B=!0,E.type=1):B=!1:(B=!1,o=!0,g={});let I=0;if(B)s.isWebGPU?(I=1,await h.e(39).then(h.bind(h,13385))):await h.e(41).then(h.bind(h,13402)),u=new v.c("rgbdDecode","rgbdDecode",null,null,1,null,3,s,!1,void 0,E.type,void 0,null,!1,void 0,I),E._isRGBD=!1,E.invertY=!1,D=s.createRenderTargetCubeTexture(E.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:E.type,format:5});else if(E._isRGBD=!0,E.invertY=!0,o){const b=3,h=E._lodGenerationScale,a=E._lodGenerationOffset;for(let k=0;k<b;k++){const G=(V-1)*h+a,v=a+(G-a)*(1-k/(b-1)),U=Math.round(Math.min(Math.max(v,0),G)),B=new l.b(s,2);B.isCube=!0,B.invertY=!0,B.generateMipMaps=!1,s.updateTextureSamplingMode(2,B);const o=new O.e(null);switch(o._isCube=!0,o._texture=B,g[U]=o,k){case 0:E._lodTextureLow=o;break;case 1:E._lodTextureMid=o;break;case 2:E._lodTextureHigh=o}}}const j=[];for(let h=0;h<b.length;h++)for(let a=0;a<6;a++){const G=b[h][a],V=new Blob([G],{type:k}),l=URL.createObjectURL(V);let O;if(s._features.forceBitmapOverHTMLImageElement)O=s.createImageBitmap(V,{premultiplyAlpha:"none"}).then((b=>M(b,s,B,u,l,a,h,o,g,D,E)));else{const b=new Image;b.src=l,O=new Promise(((k,G)=>{b.onload=()=>{M(b,s,B,u,l,a,h,o,g,D,E).then((()=>k())).catch((E=>{G(E)}))},b.onerror=E=>{G(E)}}))}j.push(O)}if(b.length<V){let h;const a=Math.pow(2,V-1-b.length),k=a*a*4;switch(E.type){case 0:h=new Uint8Array(k);break;case 2:h=new Uint16Array(k);break;case 1:h=new Float32Array(k)}for(let G=b.length;G<V;G++)for(let b=0;b<6;b++)s._uploadArrayBufferViewToTexture(E,h,b,G)}return Promise.all(j).then((()=>{D&&(s._releaseTexture(E),D._swapAndDie(E)),u&&u.dispose(),o&&(E._lodTextureHigh&&E._lodTextureHigh._texture&&(E._lodTextureHigh._texture.isReady=!0),E._lodTextureMid&&E._lodTextureMid._texture&&(E._lodTextureMid._texture.isReady=!0),E._lodTextureLow&&E._lodTextureLow._texture&&(E._lodTextureLow._texture.isReady=!0))}))}function j(E,b){const h=(b=D(b)).irradiance;if(!h)return;const a=new V.h;k.k.FromArrayToRef(h.x,0,a.x),k.k.FromArrayToRef(h.y,0,a.y),k.k.FromArrayToRef(h.z,0,a.z),k.k.FromArrayToRef(h.xx,0,a.xx),k.k.FromArrayToRef(h.yy,0,a.yy),k.k.FromArrayToRef(h.zz,0,a.zz),k.k.FromArrayToRef(h.yz,0,a.yz),k.k.FromArrayToRef(h.zx,0,a.zx),k.k.FromArrayToRef(h.xy,0,a.xy),E._sphericalPolynomial=a}function P(E,b,h,a,k){const G=I(E.getEngine().createRawCubeTexture(null,E.width,E.format,E.type,E.generateMipMaps,E.invertY,E.samplingMode,E._compression),b).then((()=>E));return E.onRebuildCallback=E=>({proxy:G,isReady:!0,isAsync:!0}),E._source=13,E._bufferViewArrayArray=b,E._lodGenerationScale=a,E._lodGenerationOffset=k,E._sphericalPolynomial=h,I(E,b).then((()=>(E.isReady=!0,E)))}},10883:(E,b,h)=>{"use strict";h.d(b,{c:()=>a,e:()=>k,g:()=>G});class a extends Error{}a._setPrototypeOf=Object.setPrototypeOf||((E,b)=>(E.__proto__=b,E));const k={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};class G extends a{constructor(E,b,h){super(E),this.errorCode=b,this.innerError=h,this.name="RuntimeError",a._setPrototypeOf(this,G.prototype)}}},10878:(E,b,h)=>{"use strict";h.d(b,{b:()=>r,f:()=>I,j:()=>Z,p:()=>d,m:()=>g,r:()=>A,v:()=>n,y:()=>c,B:()=>j});var a=h(10861),k=h(10832),G=h(10824);class V{}V.FilesToLoad={};var l=h(10883),O=h(10887),v=h(10889),s=h(10869),U=h(10834),B=h(10895),o=h(10893),u=h(10902);const D=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class g extends l.g{constructor(E,b){super(E,l.e.LoadFileError),this.name="LoadFileError",l.c._setPrototypeOf(this,g.prototype),b instanceof a.c?this.request=b:this.file=b}}class S extends l.g{constructor(E,b){super(E,l.e.RequestFileError),this.request=b,this.name="RequestFileError",l.c._setPrototypeOf(this,S.prototype)}}class M extends l.g{constructor(E,b){super(E,l.e.ReadFileError),this.file=b,this.name="ReadFileError",l.c._setPrototypeOf(this,M.prototype)}}const I={DefaultRetryStrategy:class{static ExponentialBackoff(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return(h,a,k)=>0!==a.status||k>=E||-1!==h.indexOf("file:")?-1:Math.pow(2,k)*b}}.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:E=>E,ScriptBaseUrl:"",ScriptPreprocessUrl:E=>E,CleanUrl:E=>E=E.replace(/#/gm,"%23")},j=(E,b)=>{if((!E||0!==E.indexOf("data:"))&&I.CorsBehavior)if("string"===typeof I.CorsBehavior||I.CorsBehavior instanceof String)b.crossOrigin=I.CorsBehavior;else{const h=I.CorsBehavior(E);h&&(b.crossOrigin=h)}},P={getRequiredSize:null},A=function(E,b,h,k){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",l=arguments.length>5?arguments[5]:void 0;const v=s.b.LastCreatedEngine;if("undefined"===typeof HTMLImageElement&&(null===v||void 0===v||!v._features.forceBitmapOverHTMLImageElement))return h("LoadImage is only supported in web or BabylonNative environments."),null;let U,B=!1;E instanceof ArrayBuffer||ArrayBuffer.isView(E)?"undefined"!==typeof Blob&&"undefined"!==typeof URL?(U=URL.createObjectURL(new Blob([E],{type:G})),B=!0):U=`data:${G};base64,`+(0,O.g)(E):E instanceof Blob?(U=URL.createObjectURL(E),B=!0):(U=I.CleanUrl(E),U=I.PreprocessUrl(U));const o=b=>{if(h){const a=U||E.toString();h(`Error while trying to load image: ${0===a.indexOf("http")||a.length<=128?a:a.slice(0,128)+"..."}`,b)}};if(null!==v&&void 0!==v&&v._features.forceBitmapOverHTMLImageElement)return d(U,(a=>{v.createImageBitmap(new Blob([a],{type:G}),{premultiplyAlpha:"none",...l}).then((E=>{b(E),B&&URL.revokeObjectURL(U)})).catch((b=>{h&&h("Error while trying to load image: "+E,b)}))}),void 0,k||void 0,!0,((E,b)=>{o(b)})),null;const u=new Image;if(P.getRequiredSize){const b=P.getRequiredSize(E);b.width&&(u.width=b.width),b.height&&(u.height=b.height)}j(U,u);const D=[],g=()=>{D.forEach((E=>{E.target.removeEventListener(E.name,E.handler)})),D.length=0};D.push({target:u,name:"load",handler:()=>{g(),b(u),B&&u.src&&URL.revokeObjectURL(u.src)}}),D.push({target:u,name:"error",handler:E=>{g(),o(E),B&&u.src&&URL.revokeObjectURL(u.src)}}),D.push({target:document,name:"securitypolicyviolation",handler:E=>{if(E.blockedURI!==u.src||"sm"===E.disposition)return;g();const b=new Error(`CSP violation of policy ${E.effectiveDirective} ${E.blockedURI}. Current policy is ${E.originalPolicy}`);s.b.UseFallbackTexture=!1,o(b),B&&u.src&&URL.revokeObjectURL(u.src),u.src=""}}),D.forEach((E=>{E.target.addEventListener(E.name,E.handler)}));const S="blob:"===U.substring(0,5),M="data:"===U.substring(0,5),A=()=>{S||M||!a.c.IsCustomRequestAvailable?u.src=U:d(U,((E,b,h)=>{const a=new Blob([E],{type:!G&&h?h:G}),k=URL.createObjectURL(a);B=!0,u.src=k}),void 0,k||void 0,!0,((E,b)=>{o(b)}))},n=()=>{k&&k.loadImage(U,u)};if(!S&&!M&&k&&k.enableTexturesOffline)k.open(n,A);else{if(-1!==U.indexOf("file:")){const E=decodeURIComponent(U.substring(5).toLowerCase());if(V.FilesToLoad[E]&&"undefined"!==typeof URL){try{let b;try{b=URL.createObjectURL(V.FilesToLoad[E])}catch(c){b=URL.createObjectURL(V.FilesToLoad[E])}u.src=b,B=!0}catch(z){u.src=""}return u}}A()}return u},n=(E,b,h,a,k)=>{const V=new FileReader,l={onCompleteObservable:new G.e,abort:()=>V.abort()};return V.onloadend=()=>l.onCompleteObservable.notifyObservers(l),k&&(V.onerror=()=>{k(new M(`Unable to read ${E.name}`,E))}),V.onload=E=>{b(E.target.result)},h&&(V.onprogress=h),a?V.readAsArrayBuffer(E):V.readAsText(E),l},d=(E,b,h,a,k,O,v)=>{if(E.name)return n(E,b,h,k,O?E=>{O(void 0,E)}:void 0);const s=E;if(-1!==s.indexOf("file:")){let E=decodeURIComponent(s.substring(5).toLowerCase());0===E.indexOf("./")&&(E=E.substring(2));const a=V.FilesToLoad[E];if(a)return n(a,b,h,k,O?E=>O(void 0,new g(E.message,E.file)):void 0)}const{match:o,type:u}=Y(s);if(o){const E={onCompleteObservable:new G.e,abort:()=>()=>{}};try{const E=k?r(s):w(s);b(E,void 0,u)}catch(l){O?O(void 0,l):U.c.Error(l.message||"Failed to parse the Data URL")}return B.e.SetImmediate((()=>{E.onCompleteObservable.notifyObservers(E)})),E}return c(s,((E,h)=>{b(E,null===h||void 0===h?void 0:h.responseURL,null===h||void 0===h?void 0:h.getResponseHeader("content-type"))}),h,a,k,O?E=>{O(E.request,new g(E.message,E.request))}:void 0,v)},c=(E,b,h,V,l,O,v)=>{E=I.CleanUrl(E),E=I.PreprocessUrl(E);const s=I.BaseUrl+E;let B=!1;const o={onCompleteObservable:new G.e,abort:()=>B=!0},u=()=>{let E,G=new a.c,V=null;const u=()=>{G&&(h&&G.removeEventListener("progress",h),E&&G.removeEventListener("readystatechange",E),G.removeEventListener("loadend",D))};let D=()=>{u(),o.onCompleteObservable.notifyObservers(o),o.onCompleteObservable.clear(),h=void 0,E=null,D=null,O=void 0,v=void 0,b=void 0};o.abort=()=>{B=!0,D&&D(),G&&G.readyState!==(XMLHttpRequest.DONE||4)&&G.abort(),null!==V&&(clearTimeout(V),V=null),G=null};const g=E=>{const b=E.message||"Unknown error";O&&G?O(new S(b,G)):U.c.Error(b)},M=U=>{if(G){if(G.open("GET",s),v)try{v(G)}catch(o){return void g(o)}l&&(G.responseType="arraybuffer"),h&&G.addEventListener("progress",h),D&&G.addEventListener("loadend",D),E=()=>{if(!B&&G&&G.readyState===(XMLHttpRequest.DONE||4)){if(E&&G.removeEventListener("readystatechange",E),G.status>=200&&G.status<300||0===G.status&&(!(0,k.i)()||z())){try{b&&b(l?G.response:G.responseText,G)}catch(o){g(o)}return}const h=I.DefaultRetryStrategy;if(h){const E=h(s,G,U);if(-1!==E)return u(),G=new a.c,void(V=setTimeout((()=>M(U+1)),E))}const v=new S("Error status: "+G.status+" "+G.statusText+" - Unable to load "+s,G);O&&O(v)}},G.addEventListener("readystatechange",E),G.send()}};M(0)};if(V&&V.enableSceneOffline){const a=E=>{E&&E.status>400?O&&O(E):u()},k=()=>{V&&V.loadFile(I.BaseUrl+E,(E=>{!B&&b&&b(E),o.onCompleteObservable.notifyObservers(o)}),h?E=>{!B&&h&&h(E)}:void 0,a,l)};V.open(k,a)}else u();return o},z=()=>"undefined"!==typeof location&&"file:"===location.protocol,Z=E=>D.test(E),Y=E=>{const b=D.exec(E);if(null===b||0===b.length)return{match:!1,type:""};return{match:!0,type:b[0].replace("data:","").replace("base64,","")}};function r(E){return(0,O.b)(E.split(",")[1])}const w=E=>(0,O.d)(E.split(",")[1]);let N;u.d._FileToolsLoadImage=A,o.b.loadFile=d,v.o.loadFile=d;((E,b,h,a,k,G,V,l,O,v)=>{N={DecodeBase64UrlToBinary:E,DecodeBase64UrlToString:b,DefaultRetryStrategy:h.DefaultRetryStrategy,BaseUrl:h.BaseUrl,CorsBehavior:h.CorsBehavior,PreprocessUrl:h.PreprocessUrl,IsBase64DataUrl:a,IsFileURL:k,LoadFile:G,LoadImage:V,ReadFile:l,RequestFile:O,SetCorsBehavior:v},Object.defineProperty(N,"DefaultRetryStrategy",{get:function(){return h.DefaultRetryStrategy},set:function(E){h.DefaultRetryStrategy=E}}),Object.defineProperty(N,"BaseUrl",{get:function(){return h.BaseUrl},set:function(E){h.BaseUrl=E}}),Object.defineProperty(N,"PreprocessUrl",{get:function(){return h.PreprocessUrl},set:function(E){h.PreprocessUrl=E}}),Object.defineProperty(N,"CorsBehavior",{get:function(){return h.CorsBehavior},set:function(E){h.CorsBehavior=E}})})(r,w,I,Z,z,d,A,n,c,j)},10966:(E,b,h)=>{"use strict";function a(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(E=>{const b=16*Math.random()|0;return("x"===E?b:3&b|8).toString(16)}))}h.d(b,{e:()=>a})},10949:(E,b,h)=>{"use strict";h.d(b,{e:()=>G});var a=h(10834),k=h(10958);class G{static Instantiate(E){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[E])return this.RegisteredExternalClasses[E];const b=(0,k.d)(E);if(b)return b;a.c.Warn(E+" not found, you may have missed an import.");const h=E.split(".");let G=window||this;for(let a=0,k=h.length;a<k;a++)G=G[h[a]];return"function"!==typeof G?null:G}}G.RegisteredExternalClasses={}},10834:(E,b,h)=>{"use strict";h.d(b,{c:()=>a});class a{static _CheckLimit(E,b){let h=a._LogLimitOutputs[E];return h?h.current++:(h={limit:b,current:1},a._LogLimitOutputs[E]=h),h.current<=h.limit}static _GenerateLimitMessage(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const h=a._LogLimitOutputs[E];if(!h||!a.MessageLimitReached)return;const k=this._Levels[b];h.current===h.limit&&a[k.name](a.MessageLimitReached.replace(/%LIMIT%/g,""+h.limit).replace(/%TYPE%/g,k.name??""))}static _AddLogEntry(E){a._LogCache=E+a._LogCache,a.OnNewCacheEntry&&a.OnNewCacheEntry(E)}static _FormatMessage(E){const b=E=>E<10?"0"+E:""+E,h=new Date;return"["+b(h.getHours())+":"+b(h.getMinutes())+":"+b(h.getSeconds())+"]: "+E}static _LogDisabled(E,b){}static _LogEnabled(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1?arguments[1]:void 0,h=arguments.length>2?arguments[2]:void 0;const k=Array.isArray(b)?b[0]:b;if(void 0!==h&&!a._CheckLimit(k,h))return;const G=a._FormatMessage(k),V=this._Levels[E],l=Array.isArray(b)?b.slice(1):[];V.logFunc&&V.logFunc("BJS - "+G,...l);const O=`<div style='color:${V.color}'>${G}</div><br>`;a._AddLogEntry(O),a._GenerateLimitMessage(k,E)}static get LogCache(){return a._LogCache}static ClearLogCache(){a._LogCache="",a._LogLimitOutputs={},a.errorsCount=0}static set LogLevels(E){a.Log=a._LogDisabled,a.Warn=a._LogDisabled,a.Error=a._LogDisabled,[a.MessageLogLevel,a.WarningLogLevel,a.ErrorLogLevel].forEach((b=>{if((E&b)===b){const E=this._Levels[b];a[E.name]=a._LogEnabled.bind(a,b)}}))}}a.NoneLogLevel=0,a.MessageLogLevel=1,a.WarningLogLevel=2,a.ErrorLogLevel=4,a.AllLogLevel=7,a.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",a._LogCache="",a._LogLimitOutputs={},a._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],a.errorsCount=0,a.Log=a._LogEnabled.bind(a,a.MessageLogLevel),a.Warn=a._LogEnabled.bind(a,a.WarningLogLevel),a.Error=a._LogEnabled.bind(a,a.ErrorLogLevel)},10824:(E,b,h)=>{"use strict";h.d(b,{e:()=>G});class a{constructor(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;this.initialize(E,b,h,a)}initialize(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;return this.mask=E,this.skipNextObservers=b,this.target=h,this.currentTarget=a,this}}class k{constructor(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=E,this.mask=b,this.scope=h,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){this._remove&&this._remove()}}class G{static FromPromise(E,b){const h=new G;return E.then((E=>{h.notifyObservers(E)})).catch((E=>{if(!b)throw E;b.notifyObservers(E)})),h}get observers(){return this._observers}constructor(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=b,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new a(0),E&&(this._onObserverAdded=E)}add(E){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],h=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!E)return null;const a=new k(E,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);return a.unregisterOnNextCall=h,b?this._observers.unshift(a):this._observers.push(a),this._onObserverAdded&&this._onObserverAdded(a),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(a,this._lastNotifiedValue),a._remove=()=>{this.remove(a)},a}addOnce(E){return this.add(E,void 0,void 0,void 0,!0)}remove(E){if(!E)return!1;E._remove=null;return-1!==this._observers.indexOf(E)&&(this._deferUnregister(E),!0)}removeCallback(E,b){for(let h=0;h<this._observers.length;h++){const a=this._observers[h];if(!a._willBeUnregistered&&(a.callback===E&&(!b||b===a.scope)))return this._deferUnregister(a),!0}return!1}_deferUnregister(E){E._willBeUnregistered||(this._numObserversMarkedAsDeleted++,E.unregisterOnNextCall=!1,E._willBeUnregistered=!0,setTimeout((()=>{this._remove(E)}),0))}_remove(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!E)return!1;const h=this._observers.indexOf(E);return-1!==h&&(b&&this._numObserversMarkedAsDeleted--,this._observers.splice(h,1),!0)}makeObserverTopPriority(E){this._remove(E,!1),this._observers.unshift(E)}makeObserverBottomPriority(E){this._remove(E,!1),this._observers.push(E)}notifyObservers(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,h=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,k=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=E),!this._observers.length)return!0;const G=this._eventState;G.mask=b,G.target=h,G.currentTarget=a,G.skipNextObservers=!1,G.lastReturnValue=E,G.userInfo=k;for(const V of this._observers)if(!V._willBeUnregistered&&(V.mask&b&&(V.unregisterOnNextCall&&this._deferUnregister(V),V.scope?G.lastReturnValue=V.callback.apply(V.scope,[E,G]):G.lastReturnValue=V.callback(E,G)),G.skipNextObservers))return!1;return!0}notifyObserver(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=b),E._willBeUnregistered)return;const a=this._eventState;a.mask=h,a.skipNextObservers=!1,E.unregisterOnNextCall&&this._deferUnregister(E),E.callback(b,a)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const E=this._observers.pop();E&&(E._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const E=new G;return E._observers=this._observers.slice(0),E}hasSpecificMask(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const b of this._observers)if(b.mask&E||b.mask===E)return!0;return!1}}},10972:(E,b,h)=>{"use strict";h.d(b,{d:()=>k});var a=h(10846);class k{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(E,b){k.Enabled&&(this._current+=E,b&&this._fetchResult())}beginMonitoring(){k.Enabled&&(this._startMonitoringTime=a.c.Now)}endMonitoring(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!k.Enabled)return;E&&this.fetchNewFrame();const b=a.c.Now;this._current=b-this._startMonitoringTime,E&&this._fetchResult()}nj(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const E=a.c.Now;E-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=E,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}k.Enabled=!0},10846:(E,b,h)=>{"use strict";h.d(b,{c:()=>k});var a=h(10832);class k{static get Now(){return(0,a.i)()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}},12152:(E,b,h)=>{"use strict";h.d(b,{d:()=>G});var a=h(11697),k=h(11685);class G{static ExpandRGBDTexture(E){const b=E._texture;if(!b||!E.isRGBD)return;const k=b.getEngine(),G=k.getCaps(),V=b.isReady;let l=!1;G.textureHalfFloatRender&&G.textureHalfFloatLinearFiltering?(l=!0,b.type=2):G.textureFloatRender&&G.textureFloatLinearFiltering&&(l=!0,b.type=1),l&&(b.isReady=!1,b._isRGBD=!1,b.invertY=!1);const O=async()=>{const G=k.isWebGPU,V=G?1:0;b.isReady=!1,G?await Promise.all([h.e(39).then(h.bind(h,13385)),h.e(40).then(h.bind(h,13393))]):await Promise.all([h.e(41).then(h.bind(h,13402)),h.e(42).then(h.bind(h,13408))]);const l=new a.c("rgbdDecode","rgbdDecode",null,null,1,null,3,k,!1,void 0,b.type,void 0,null,!1,void 0,V);l.externalTextureSamplerBinding=!0;const O=k.createRenderTargetTexture(b.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:b.samplingMode,type:b.type,format:5});l.onEffectCreatedObservable.addOnce((h=>{h.executeWhenCompiled((()=>{l.onApply=E=>{E._bindTexture("textureSampler",b),E.setFloat2("scale",1,1)},E.va().postProcessManager.directRender([l],O,!0),k.restoreDefaultFramebuffer(),k._releaseTexture(b),l&&l.dispose(),O._swapAndDie(b),b.isReady=!0}))}))};l&&(V?O():E.onLoadObservable.addOnce(O))}static EncodeTextureToRGBD(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,k.c)("rgbdEncode",E,b,h,1,5)}}},11155:(E,b,h)=>{"use strict";h.d(b,{d:()=>k,e:()=>a});class a{constructor(E){this.length=0,this.data=new Array(E),this._id=a._GlobalId++}push(E){this.data[this.length++]=E,this.length>this.data.length&&(this.data.length*=2)}forEach(E){for(let b=0;b<this.length;b++)E(this.data[b])}sort(E){this.data.sort(E)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(E){if(0!==E.length){this.length+E.length>this.data.length&&(this.data.length=2*(this.length+E.length));for(let b=0;b<E.length;b++)this.data[this.length++]=(E.data||E)[b]}}indexOf(E){const b=this.data.indexOf(E);return b>=this.length?-1:b}contains(E){return-1!==this.indexOf(E)}}a._GlobalId=0;class k extends a{constructor(){super(...arguments),this._duplicateId=0}push(E){super.push(E),E.__smartArrayFlags||(E.__smartArrayFlags={}),E.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(E){return(!E.__smartArrayFlags||E.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(E),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(E){if(0!==E.length){this.length+E.length>this.data.length&&(this.data.length=2*(this.length+E.length));for(let b=0;b<E.length;b++){const h=(E.data||E)[b];this.pushNoDuplicate(h)}}}}},10887:(E,b,h)=>{"use strict";h.d(b,{b:()=>V,d:()=>G,f:()=>a,g:()=>k});const a=E=>{if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(E);let b="";for(let h=0;h<E.byteLength;h++)b+=String.fromCharCode(E[h]);return b},k=E=>{const b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let h,a,k,G,V,l,O,v="",s=0;const U=ArrayBuffer.isView(E)?new Uint8Array(E.buffer,E.byteOffset,E.byteLength):new Uint8Array(E);for(;s<U.length;)h=U[s++],a=s<U.length?U[s++]:Number.NaN,k=s<U.length?U[s++]:Number.NaN,G=h>>2,V=(3&h)<<4|a>>4,l=(15&a)<<2|k>>6,O=63&k,isNaN(a)?l=O=64:isNaN(k)&&(O=64),v+=b.charAt(G)+b.charAt(V)+b.charAt(l)+b.charAt(O);return v},G=E=>atob(E),V=E=>{const b=G(E),h=b.length,a=new Uint8Array(new ArrayBuffer(h));for(let k=0;k<h;k++)a[k]=b.charCodeAt(k);return a.buffer}},11170:(E,b,h)=>{"use strict";h.d(b,{b:()=>k});class a{static Eval(E,b){return"true"===(E=E.match(/\([^()]*\)/g)?E.replace(/\([^()]*\)/g,(E=>(E=E.slice(1,E.length-1),a._HandleParenthesisContent(E,b)))):a._HandleParenthesisContent(E,b))||"false"!==E&&a.Eval(E,b)}static _HandleParenthesisContent(E,b){let h;b=b||(E=>"true"===E);const k=E.split("||");for(const G in k)if(Object.prototype.hasOwnProperty.call(k,G)){let E=a._SimplifyNegation(k[G].trim());const V=E.split("&&");if(V.length>1)for(let k=0;k<V.length;++k){const G=a._SimplifyNegation(V[k].trim());if(h="true"!==G&&"false"!==G?"!"===G[0]?!b(G.substring(1)):b(G):"true"===G,!h){E="false";break}}if(h||"true"===E){h=!0;break}h="true"!==E&&"false"!==E?"!"===E[0]?!b(E.substring(1)):b(E):"true"===E}return h?"true":"false"}static _SimplifyNegation(E){return"!true"===(E=(E=E.replace(/^[\s!]+/,(E=>(E=E.replace(/[\s]/g,(()=>""))).length%2?"!":""))).trim())?E="false":"!false"===E&&(E="true"),E}}class k{static EnableFor(E){E._tags=E._tags||{},E.hasTags=()=>k.HasTags(E),E.addTags=b=>k.AddTagsTo(E,b),E.removeTags=b=>k.RemoveTagsFrom(E,b),E.matchesTagsQuery=b=>k.MatchesQuery(E,b)}static DisableFor(E){delete E._tags,delete E.hasTags,delete E.addTags,delete E.removeTags,delete E.matchesTagsQuery}static HasTags(E){if(!E._tags)return!1;const b=E._tags;for(const h in b)if(Object.prototype.hasOwnProperty.call(b,h))return!0;return!1}static GetTags(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!E._tags)return null;if(b){const b=[];for(const h in E._tags)Object.prototype.hasOwnProperty.call(E._tags,h)&&!0===E._tags[h]&&b.push(h);return b.join(" ")}return E._tags}static AddTagsTo(E,b){if(!b)return;if("string"!==typeof b)return;b.split(" ").forEach((function(b){k._AddTagTo(E,b)}))}static _AddTagTo(E,b){""!==(b=b.trim())&&"true"!==b&&"false"!==b&&(b.match(/[\s]/)||b.match(/^([!]|([|]|[&]){2})/)||(k.EnableFor(E),E._tags[b]=!0))}static RemoveTagsFrom(E,b){if(!k.HasTags(E))return;const h=b.split(" ");for(const a in h)k._RemoveTagFrom(E,h[a])}static _RemoveTagFrom(E,b){delete E._tags[b]}static MatchesQuery(E,b){return void 0===b||(""===b?k.HasTags(E):a.Eval(b,(b=>k.HasTags(E)&&E._tags[b])))}}},11685:(E,b,h)=>{"use strict";h.d(b,{c:()=>O,f:()=>B,h:()=>U});h(11376),h(11690);var a=h(11697),k=h(10902),G=h(10958),V=h(11206);class l extends a.c{getClassName(){return"PassPostProcess"}constructor(E,b){super(E,"pass",null,null,b,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>5?arguments[5]:void 0,void 0,arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,void 0,null,arguments.length>7&&void 0!==arguments[7]&&arguments[7])}_gatherImports(E,b){E?(this._webGPUReady=!0,b.push(Promise.all([h.e(33).then(h.bind(h,13348))]))):b.push(Promise.all([h.e(34).then(h.bind(h,13350))])),super._gatherImports(E,b)}static _Parse(E,b,h,a){return V.e.Parse((()=>new l(E.name,E.options,b,E.renderTargetSamplingMode,E._engine,E.reusable)),E,h,a)}}(0,G.f)("BABYLON.PassPostProcess",l);a.c;function O(E,b,h,k,G,V,l,O){const v=b.getEngine();return b.isReady=!1,G=G??b.samplingMode,k=k??b.type,V=V??b.format,l=l??b.width,O=O??b.height,-1===k&&(k=0),new Promise((s=>{const U=new a.c("postprocess",E,null,null,1,null,G,v,!1,void 0,k,void 0,null,!1,V);U.externalTextureSamplerBinding=!0;const B=v.createRenderTargetTexture({width:l,height:O},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:G,type:k,format:V});U.onEffectCreatedObservable.addOnce((E=>{E.executeWhenCompiled((()=>{U.onApply=E=>{E._bindTexture("textureSampler",b),E.setFloat2("scale",1,1)},h.postProcessManager.directRender([U],B,!0),v.restoreDefaultFramebuffer(),v._releaseTexture(b),U&&U.dispose(),B._swapAndDie(b),b.type=k,b.format=5,b.isReady=!0,s(b)}))}))}))}let v,s;function U(E){v||(v=new Float32Array(1),s=new Int32Array(v.buffer)),v[0]=E;const b=s[0];let h=b>>16&32768,a=b>>12&2047;const k=b>>23&255;return k<103?h:k>142?(h|=31744,h|=(255==k?0:1)&&8388607&b,h):k<113?(a|=2048,h|=(a>>114-k)+(a>>113-k&1),h):(h|=k-112<<10|a>>1,h+=1&a,h)}function B(E){const b=(32768&E)>>15,h=(31744&E)>>10,a=1023&E;return 0===h?(b?-1:1)*Math.pow(2,-14)*(a/Math.pow(2,10)):31==h?a?NaN:1/0*(b?-1:1):(b?-1:1)*Math.pow(2,h-15)*(1+a/Math.pow(2,10))}k.d._RescalePostProcessFactory=E=>new l("rescale",1,null,2,E,!1,0)},10895:(E,b,h)=>{"use strict";h.d(b,{e:()=>k});var a=h(10832);class k{static SetImmediate(E){(0,a.i)()&&window.setImmediate?window.setImmediate(E):setTimeout(E,1)}}},10968:(E,b,h)=>{"use strict";function a(E){let b=1;do{b*=2}while(b<E);return b===E}function k(E,b,h){return E*(1-h)+b*h}function G(E){const b=V(E),h=l(E);return b-E>E-h?h:b}function V(E){return E--,E|=E>>1,E|=E>>2,E|=E>>4,E|=E>>8,E|=E>>16,++E}function l(E){return E|=E>>1,E|=E>>2,E|=E>>4,E|=E>>8,(E|=E>>16)-(E>>1)}function O(E,b){let h;switch(arguments.length>2&&void 0!==arguments[2]?arguments[2]:2){case 1:h=l(E);break;case 2:h=G(E);break;default:h=V(E)}return Math.min(h,b)}h.d(b,{b:()=>l,f:()=>O,h:()=>a,k:()=>k,l:()=>G})},10821:(E,b,h)=>{"use strict";h.d(b,{d:()=>S,g:()=>g});var a=h(10824),k=h(10832),G=h(10834),V=h(10841),l=h(10846),O=h(10855),v=h(10861),s=h(10869),U=h(10878),B=h(10895),o=h(10949),u=h(10966),D=h(10968);class g{static get BaseUrl(){return U.f.BaseUrl}static set BaseUrl(E){U.f.BaseUrl=E}static get CleanUrl(){return U.f.CleanUrl}static set CleanUrl(E){U.f.CleanUrl=E}static IsAbsoluteUrl(E){return 0===E.indexOf("//")||-1!==E.indexOf("://")&&(-1!==E.indexOf(".")&&(-1!==E.indexOf("/")&&(!(E.indexOf(":")>E.indexOf("/"))&&(E.indexOf("://")<E.indexOf(".")||(0===E.indexOf("data:")||0===E.indexOf("blob:"))))))}static set ScriptBaseUrl(E){U.f.ScriptBaseUrl=E}static get ScriptBaseUrl(){return U.f.ScriptBaseUrl}static set ScriptPreprocessUrl(E){U.f.ScriptPreprocessUrl=E}static get ScriptPreprocessUrl(){return U.f.ScriptPreprocessUrl}static get DefaultRetryStrategy(){return U.f.DefaultRetryStrategy}static set DefaultRetryStrategy(E){U.f.DefaultRetryStrategy=E}static get CorsBehavior(){return U.f.CorsBehavior}static set CorsBehavior(E){U.f.CorsBehavior=E}static get UseFallbackTexture(){return s.b.UseFallbackTexture}static set UseFallbackTexture(E){s.b.UseFallbackTexture=E}static get RegisteredExternalClasses(){return o.e.RegisteredExternalClasses}static set RegisteredExternalClasses(E){o.e.RegisteredExternalClasses=E}static get fallbackTexture(){return s.b.FallbackTexture}static set fallbackTexture(E){s.b.FallbackTexture=E}static FetchToRef(E,b,h,a,k,G){const V=4*((Math.abs(E)*h%h|0)+(Math.abs(b)*a%a|0)*h);G.r=k[V]/255,G.g=k[V+1]/255,G.b=k[V+2]/255,G.a=k[V+3]/255}static Mix(E,b,h){return 0}static Instantiate(E){return o.e.Instantiate(E)}static SetImmediate(E){B.e.SetImmediate(E)}static IsExponentOfTwo(E){return!0}static FloatRound(E){return Math.fround(E)}static GetFilename(E){const b=E.lastIndexOf("/");return b<0?E:E.substring(b+1)}static GetFolderPath(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const h=E.lastIndexOf("/");return h<0?b?E:"":E.substring(0,h+1)}static ToDegrees(E){return 180*E/Math.PI}static ToRadians(E){return E*Math.PI/180}static SmoothAngleChange(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9;const a=this.ToRadians(E),k=this.ToRadians(b);return this.ToDegrees(Math.atan2((1-h)*Math.sin(k)+h*Math.sin(a),(1-h)*Math.cos(k)+h*Math.cos(a)))}static MakeArray(E,b){return!0===b||void 0!==E&&null!=E?Array.isArray(E)?E:[E]:null}static GetPointerPrefix(E){return(0,k.i)()&&!window.PointerEvent?"mouse":"pointer"}static SetCorsBehavior(E,b){(0,U.B)(E,b)}static SetReferrerPolicyBehavior(E,b){b.referrerPolicy=E}static get PreprocessUrl(){return U.f.PreprocessUrl}static set PreprocessUrl(E){U.f.PreprocessUrl=E}static LoadImage(E,b,h,a,k,G){return(0,U.r)(E,b,h,a,k,G)}static LoadFile(E,b,h,a,k,G){return(0,U.p)(E,b,h,a,k,G)}static LoadFileAsync(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise(((h,a)=>{(0,U.p)(E,(E=>{h(E)}),void 0,void 0,b,((E,b)=>{a(b)}))}))}static GetBabylonScriptURL(E,b){if(!E)return"";if(g.ScriptBaseUrl&&E.startsWith(g._DefaultCdnUrl)){const b="/"===g.ScriptBaseUrl[g.ScriptBaseUrl.length-1]?g.ScriptBaseUrl.substring(0,g.ScriptBaseUrl.length-1):g.ScriptBaseUrl;E=E.replace(g._DefaultCdnUrl,b)}return E=g.ScriptPreprocessUrl(E),b&&(E=g.GetAbsoluteUrl(E)),E}static LoadBabylonScript(E,b,h,a){E=g.GetBabylonScriptURL(E),g.LoadScript(E,b,h)}static LoadBabylonScriptAsync(E){return E=g.GetBabylonScriptURL(E),g.LoadScriptAsync(E)}static LoadScript(E,b,h,a){let G=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("function"===typeof importScripts){try{importScripts(E),b&&b()}catch(O){null===h||void 0===h||h(`Unable to load script '${E}' in worker`,O)}return}if(!(0,k.i)())return void(null===h||void 0===h||h(`Cannot load script '${E}' outside of a window or a worker`));const V=document.getElementsByTagName("head")[0],l=document.createElement("script");G?(l.setAttribute("type","module"),l.innerText=E):(l.setAttribute("type","text/javascript"),l.setAttribute("src",E)),a&&(l.id=a),l.onload=()=>{b&&b()},l.onerror=b=>{h&&h(`Unable to load script '${E}'`,b)},V.appendChild(l)}static LoadScriptAsync(E,b){return new Promise(((h,a)=>{this.LoadScript(E,(()=>{h()}),((E,b)=>{a(b||new Error(E))}),b)}))}static ReadFileAsDataURL(E,b,h){const k=new FileReader,G={onCompleteObservable:new a.e,abort:()=>k.abort()};return k.onloadend=()=>{G.onCompleteObservable.notifyObservers(G)},k.onload=E=>{b(E.target.result)},k.onprogress=h,k.readAsDataURL(E),G}static ReadFile(E,b,h,a,k){return(0,U.v)(E,b,h,a,k)}static FileAsURL(E){const b=new Blob([E]);return window.URL.createObjectURL(b)}static Format(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return E.toFixed(b)}static DeepCopy(E,b,h,a){V.c.DeepCopy(E,b,h,a)}static IsEmpty(E){for(const b in E)if(Object.prototype.hasOwnProperty.call(E,b))return!1;return!0}static RegisterTopRootEvents(E,b){for(let a=0;a<b.length;a++){const k=b[a];E.addEventListener(k.name,k.handler,!1);try{window.parent&&window.parent.addEventListener(k.name,k.handler,!1)}catch(h){}}}static UnregisterTopRootEvents(E,b){for(let a=0;a<b.length;a++){const k=b[a];E.removeEventListener(k.name,k.handler);try{E.parent&&E.parent.removeEventListener(k.name,k.handler)}catch(h){}}}static async DumpFramebuffer(E,b,h,a){throw(0,O.c)("DumpTools")}static DumpData(E,b,h,a){throw(0,O.c)("DumpTools")}static DumpDataAsync(E,b,h){throw(0,O.c)("DumpTools")}static _IsOffScreenCanvas(E){return void 0!==E.convertToBlob}static ToBlob(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",a=arguments.length>3?arguments[3]:void 0;g._IsOffScreenCanvas(E)||E.toBlob||(E.toBlob=function(E,b,h){setTimeout((()=>{const a=atob(this.toDataURL(b,h).split(",")[1]),k=a.length,G=new Uint8Array(k);for(let E=0;E<k;E++)G[E]=a.charCodeAt(E);E(new Blob([G]))}))}),g._IsOffScreenCanvas(E)?E.convertToBlob({type:h,quality:a}).then((E=>b(E))):E.toBlob((function(E){b(E)}),h,a)}static DownloadBlob(E,b){if("download"in document.createElement("a")){if(!b){const E=new Date;b="screenshot_"+((E.getFullYear()+"-"+(E.getMonth()+1)).slice(2)+"-"+E.getDate()+"_"+E.getHours()+"-"+("0"+E.getMinutes()).slice(-2))+".png"}g.Download(E,b)}else if(E&&"undefined"!==typeof URL){const b=URL.createObjectURL(E),h=window.open("");if(!h)return;const a=h.document.createElement("img");a.onload=function(){URL.revokeObjectURL(b)},a.src=b,h.document.body.appendChild(a)}}static EncodeScreenshotCanvasData(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",a=arguments.length>3?arguments[3]:void 0,k=arguments.length>4?arguments[4]:void 0;if("string"!==typeof a&&b){if(b){if(g._IsOffScreenCanvas(E))return void E.convertToBlob({type:h,quality:k}).then((E=>{const h=new FileReader;h.readAsDataURL(E),h.onloadend=()=>{const E=h.result;b(E)}}));const a=E.toDataURL(h,k);b(a)}}else this.ToBlob(E,(function(E){E&&g.DownloadBlob(E,a),b&&b("")}),h,k)}static Download(E,b){if("undefined"===typeof URL)return;const h=window.URL.createObjectURL(E),a=document.createElement("a");document.body.appendChild(a),a.style.display="none",a.href=h,a.download=b,a.addEventListener("click",(()=>{a.parentElement&&a.parentElement.removeChild(a)})),a.click(),window.URL.revokeObjectURL(h)}static BackCompatCameraNoPreventDefault(E){return"boolean"===typeof E[0]?E[0]:"boolean"===typeof E[1]&&E[1]}static CreateScreenshot(E,b,h,a){throw(0,O.c)("ScreenshotTools")}static CreateScreenshotAsync(E,b,h){throw(0,O.c)("ScreenshotTools")}static CreateScreenshotUsingRenderTarget(E,b,h,a){throw(0,O.c)("ScreenshotTools")}static CreateScreenshotUsingRenderTargetAsync(E,b,h){throw(0,O.c)("ScreenshotTools")}static RandomId(){return(0,u.e)()}static IsBase64(E){return(0,U.j)(E)}static DecodeBase64(E){return(0,U.b)(E)}static get errorsCount(){return G.c.errorsCount}static Log(E){G.c.Log(E)}static Warn(E){G.c.Warn(E)}static Error(E){G.c.Error(E)}static get LogCache(){return G.c.LogCache}static ClearLogCache(){G.c.ClearLogCache()}static set LogLevels(E){G.c.LogLevels=E}static set PerformanceLogLevel(E){return(E&g.PerformanceUserMarkLogLevel)===g.PerformanceUserMarkLogLevel?(g.StartPerformanceCounter=g._StartUserMark,void(g.EndPerformanceCounter=g._EndUserMark)):(E&g.PerformanceConsoleLogLevel)===g.PerformanceConsoleLogLevel?(g.StartPerformanceCounter=g._StartPerformanceConsole,void(g.EndPerformanceCounter=g._EndPerformanceConsole)):(g.StartPerformanceCounter=g._StartPerformanceCounterDisabled,void(g.EndPerformanceCounter=g._EndPerformanceCounterDisabled))}static _StartPerformanceCounterDisabled(E,b){}static _EndPerformanceCounterDisabled(E,b){}static _StartUserMark(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!g._Performance){if(!(0,k.i)())return;g._Performance=window.performance}b&&g._Performance.mark&&g._Performance.mark(E+"-Begin")}static _EndUserMark(E){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&g._Performance.mark&&(g._Performance.mark(E+"-End"),g._Performance.measure(E,E+"-Begin",E+"-End"))}static _StartPerformanceConsole(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];b&&(g._StartUserMark(E,b),console.time&&console.time(E))}static _EndPerformanceConsole(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];b&&(g._EndUserMark(E,b),console.timeEnd(E))}static get Now(){return l.c.Now}static GetClassName(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=null;if(!b&&E.getClassName)h=E.getClassName();else{if(E instanceof Object){h=(b?E:Object.getPrototypeOf(E)).constructor.__bjsclassName__}h||(h=typeof E)}return h}static First(E,b){for(const h of E)if(b(h))return h;return null}static getFullClassName(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=null,a=null;if(!b&&E.getClassName)h=E.getClassName();else{if(E instanceof Object){const k=b?E:Object.getPrototypeOf(E);h=k.constructor.__bjsclassName__,a=k.constructor.__bjsmoduleName__}h||(h=typeof E)}return h?(null!=a?a+".":"")+h:null}static DelayAsync(E){return new Promise((b=>{setTimeout((()=>{b()}),E)}))}static IsSafari(){return!!(0,k.g)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}g.UseCustomRequestHeaders=!1,g.CustomRequestHeaders=v.c.CustomRequestHeaders,g.GetDOMTextContent=k.d,g._DefaultCdnUrl="https://cdn.babylonjs.com",g.GetAbsoluteUrl="object"===typeof document?E=>{const b=document.createElement("a");return b.href=E,b.href}:"function"===typeof URL&&"object"===typeof location?E=>new URL(E,location.origin).href:()=>{throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},g.NoneLogLevel=G.c.NoneLogLevel,g.MessageLogLevel=G.c.MessageLogLevel,g.WarningLogLevel=G.c.WarningLogLevel,g.ErrorLogLevel=G.c.ErrorLogLevel,g.AllLogLevel=G.c.AllLogLevel,g.IsWindowObjectExist=k.i,g.PerformanceNoneLogLevel=0,g.PerformanceUserMarkLogLevel=1,g.PerformanceConsoleLogLevel=2,g.StartPerformanceCounter=g._StartPerformanceCounterDisabled,g.EndPerformanceCounter=g._EndPerformanceCounterDisabled;class S{constructor(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.iterations=E,this.index=a-1,this._done=!1,this._fn=b,this._successCallback=h}executeNext(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}breakLoop(){this._done=!0,this._successCallback()}static Run(E,b,h){const a=new S(E,b,h,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return a.executeNext(),a}static SyncAsyncForLoop(E,b,h,a,k){let G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return S.Run(Math.ceil(E/b),(a=>{k&&k()?a.breakLoop():setTimeout((()=>{for(let G=0;G<b;++G){const V=a.index*b+G;if(V>=E)break;if(h(V),k&&k()){a.breakLoop();break}}a.executeNext()}),G)}),a)}}g.Mix=D.k,g.IsExponentOfTwo=D.h,s.b.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},10958:(E,b,h)=>{"use strict";h.d(b,{d:()=>G,f:()=>k});const a={};function k(E,b){a[E]=b}function G(E){return a[E]}},11293:(E,b,h)=>{"use strict";h.d(b,{e:()=>a});class a{static get UniqueId(){const E=this._UniqueIdCounter;return this._UniqueIdCounter++,E}}a._UniqueIdCounter=1},10861:(E,b,h)=>{"use strict";h.d(b,{c:()=>a});class a{constructor(){this._xhr="undefined"!==typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(a.CustomRequestHeaders).length>0||a.CustomRequestModifiers.length>0}get requestURL(){return this._requestURL}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const E in a.CustomRequestHeaders){const b=a.CustomRequestHeaders[E];b&&this._xhr.setRequestHeader(E,b)}}_shouldSkipRequestModifications(E){return a.SkipRequestModificationForBabylonCDN&&(E.includes("preview.babylonjs.com")||E.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(E){this._xhr.onprogress=E}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(E){this._xhr.responseType=E}get timeout(){return this._xhr.timeout}set timeout(E){this._xhr.timeout=E}addEventListener(E,b,h){this._xhr.addEventListener(E,b,h)}removeEventListener(E,b,h){this._xhr.removeEventListener(E,b,h)}abort(){this._xhr.abort()}send(E){a.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(E)}open(E,b){for(const h of a.CustomRequestModifiers){if(this._shouldSkipRequestModifications(b))return;h(this._xhr,b)}b=(b=b.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=b,this._xhr.open(E,b,!0)}setRequestHeader(E,b){this._xhr.setRequestHeader(E,b)}getResponseHeader(E){return this._xhr.getResponseHeader(E)}}a.CustomRequestHeaders={},a.CustomRequestModifiers=new Array,a.SkipRequestModificationForBabylonCDN=!0},12223:(E,b,h)=>{"use strict";h.d(b,{c:()=>k});class a{constructor(E){this._pendingActions=new Array,this._workerInfos=E.map((E=>({workerPromise:Promise.resolve(E),idle:!0})))}dispose(){for(const E of this._workerInfos)E.workerPromise.then((E=>{E.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(E){this._executeOnIdleWorker(E)||this._pendingActions.push(E)}_executeOnIdleWorker(E){for(const b of this._workerInfos)if(b.idle)return this._execute(b,E),!0;return!1}_execute(E,b){E.idle=!1,E.workerPromise.then((h=>{b(h,(()=>{const b=this._pendingActions.shift();b?this._execute(E,b):E.idle=!0}))}))}}class k extends a{constructor(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.DefaultOptions;super([]),this._maxWorkers=E,this._createWorkerAsync=b,this._options=h}push(E){if(!this._executeOnIdleWorker(E))if(this._workerInfos.length<this._maxWorkers){const b={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(b),this._execute(b,E)}else this._pendingActions.push(E)}_execute(E,b){E.timeoutId&&(clearTimeout(E.timeoutId),delete E.timeoutId),super._execute(E,((h,a)=>{b(h,(()=>{a(),E.idle&&(E.timeoutId=setTimeout((()=>{E.workerPromise.then((E=>{E.terminate()}));const b=this._workerInfos.indexOf(E);-1!==b&&this._workerInfos.splice(b,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}k.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},11583:(E,b,h)=>{"use strict";h.d(b,{c:()=>SE});var a=h(11175),k=h(11366);class G extends k.c{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var V=h(11201),l=(h(11588),h(10958));class O{get noiseTexture(){return this._noiseTexture}set noiseTexture(E){this._noiseTexture!==E&&(this._noiseTexture=E,this._reset())}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(E){this._isAnimationSheetEnabled!=E&&(this._isAnimationSheetEnabled=E,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(E){this._useLogarithmicDepth=E&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:a.k.Zero()}set direction1(E){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=E)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:a.k.Zero()}set direction2(E){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=E)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:a.k.Zero()}set minEmitBox(E){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=E)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:a.k.Zero()}set maxEmitBox(E){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=E)}get billboardMode(){return this._billboardMode}set billboardMode(E){this._billboardMode!==E&&(this._billboardMode=E,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(E){this._isBillboardBased!==E&&(this._isBillboardBased=E,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(E){this._attachImageProcessingConfiguration(E)}_attachImageProcessingConfiguration(E){E!==this._imageProcessingConfiguration&&(!E&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=E)}_reset(){}_removeGradientAndTexture(E,b,h){if(!b)return this;let a=0;for(const k of b){if(k.gradient===E){b.splice(a,1);break}a++}return h&&h.dispose(),this}constructor(E){this.animations=[],this.renderingGroupId=0,this.j=a.k.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new a.k(10,10,10),this.onAnimationEnd=null,this.blendMode=O.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new a.j(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.og=new a.k(0,0,0),this._useLogarithmicDepth=!1,this.gravity=a.k.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new V.f(1,1,1,1),this.color2=new V.f(1,1,1,1),this.colorDead=new V.f(0,0,0,1),this.textureMask=new V.f(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new G,this.id=E,this.name=E}createPointEmitter(E,b){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new a.k(0,1,0),arguments.length>2&&void 0!==arguments[2]||new a.k(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new a.k(0,1,0),arguments.length>4&&void 0!==arguments[4]||new a.k(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new a.k(0,1,0),arguments.length>3&&void 0!==arguments[3]||new a.k(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(E,b,h,a){throw new Error("Method not implemented.")}}O.BLENDMODE_ONEONE=0,O.BLENDMODE_STANDARD=1,O.BLENDMODE_ADD=2,O.BLENDMODE_MULTIPLY=3,O.BLENDMODE_MULTIPLYADD=4,(0,l.f)("BABYLON.BaseParticleSystem",O);var v=h(11186),s=h(10841);class U{constructor(){this.direction1=new a.k(0,1,0),this.direction2=new a.k(0,1,0),this.minEmitBox=new a.k(-.5,-.5,-.5),this.maxEmitBox=new a.k(.5,.5,.5)}startDirectionFunction(E,b,h,k){const G=(0,v.w)(this.direction1.x,this.direction2.x),V=(0,v.w)(this.direction1.y,this.direction2.y),l=(0,v.w)(this.direction1.z,this.direction2.z);if(k)return b.x=G,b.y=V,void(b.z=l);a.k.TransformNormalFromFloatsToRef(G,V,l,E,b)}startPositionFunction(E,b,h,k){const G=(0,v.w)(this.minEmitBox.x,this.maxEmitBox.x),V=(0,v.w)(this.minEmitBox.y,this.maxEmitBox.y),l=(0,v.w)(this.minEmitBox.z,this.maxEmitBox.z);if(k)return b.x=G,b.y=V,void(b.z=l);a.k.TransformCoordinatesFromFloatsToRef(G,V,l,E,b)}clone(){const E=new U;return s.c.DeepCopy(this,E),E}applyToShader(E){E.setVector3("direction1",this.direction1),E.setVector3("direction2",this.direction2),E.setVector3("minEmitBox",this.minEmitBox),E.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(E){E.addUniform("direction1",3),E.addUniform("direction2",3),E.addUniform("minEmitBox",3),E.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const E={};return E.type=this.getClassName(),E.direction1=this.direction1.qj(),E.direction2=this.direction2.qj(),E.minEmitBox=this.minEmitBox.qj(),E.maxEmitBox=this.maxEmitBox.qj(),E}parse(E){a.k.FromArrayToRef(E.direction1,0,this.direction1),a.k.FromArrayToRef(E.direction2,0,this.direction2),a.k.FromArrayToRef(E.minEmitBox,0,this.minEmitBox),a.k.FromArrayToRef(E.maxEmitBox,0,this.maxEmitBox)}}class B{get radius(){return this._radius}set radius(E){this._radius=E,this._buildHeight()}get angle(){return this._angle}set angle(E){this._angle=E,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=h,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=b,this.radius=E}startDirectionFunction(E,b,h,k){k?a.h.o[0].p(h.re).normalize():h.position.subtractToRef(E.getTranslation(),a.h.o[0]).normalize();const G=(0,v.w)(0,this.directionRandomizer),V=(0,v.w)(0,this.directionRandomizer),l=(0,v.w)(0,this.directionRandomizer);b.x=a.h.o[0].x+G,b.y=a.h.o[0].y+V,b.z=a.h.o[0].z+l,b.normalize()}startPositionFunction(E,b,h,k){const G=(0,v.w)(0,2*Math.PI);let V;this.emitFromSpawnPointOnly?V=1e-4:(V=(0,v.w)(0,this.heightRange),V=1-V*V);let l=this._radius-(0,v.w)(0,this._radius*this.radiusRange);l*=V;const O=l*Math.sin(G),s=l*Math.cos(G),U=V*this._height;if(k)return b.x=O,b.y=U,void(b.z=s);a.k.TransformCoordinatesFromFloatsToRef(O,U,s,E,b)}clone(){const E=new B(this._radius,this._angle,this.directionRandomizer);return s.c.DeepCopy(this,E),E}applyToShader(E){E.setFloat2("radius",this._radius,this.radiusRange),E.setFloat("coneAngle",this._angle),E.setFloat2("height",this._height,this.heightRange),E.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(E){E.addUniform("radius",2),E.addUniform("coneAngle",1),E.addUniform("height",2),E.addUniform("directionRandomizer",1)}getEffectDefines(){let E="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(E+="\n#define CONEEMITTERSPAWNPOINT"),E}getClassName(){return"ConeParticleEmitter"}serialize(){const E={};return E.type=this.getClassName(),E.radius=this._radius,E.angle=this._angle,E.directionRandomizer=this.directionRandomizer,E.radiusRange=this.radiusRange,E.heightRange=this.heightRange,E.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,E}parse(E){this.radius=E.radius,this.angle=E.angle,this.directionRandomizer=E.directionRandomizer,this.radiusRange=void 0!==E.radiusRange?E.radiusRange:1,this.heightRange=void 0!==E.radiusRange?E.heightRange:1,this.emitFromSpawnPointOnly=void 0!==E.emitFromSpawnPointOnly&&E.emitFromSpawnPointOnly}}class o extends B{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new a.k(0,1,0),k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new a.k(0,1,0);super(E,b),this.direction1=h,this.direction2=k}startDirectionFunction(E,b){const h=(0,v.w)(this.direction1.x,this.direction2.x),k=(0,v.w)(this.direction1.y,this.direction2.y),G=(0,v.w)(this.direction1.z,this.direction2.z);a.k.TransformNormalFromFloatsToRef(h,k,G,E,b)}clone(){const E=new o(this.radius,this.angle,this.direction1,this.direction2);return s.c.DeepCopy(this,E),E}applyToShader(E){E.setFloat("radius",this.radius),E.setFloat("radiusRange",this.radiusRange),E.setVector3("direction1",this.direction1),E.setVector3("direction2",this.direction2)}buildUniformLayout(E){E.addUniform("radius",1),E.addUniform("radiusRange",1),E.addUniform("direction1",3),E.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const E=super.serialize();return E.direction1=this.direction1.qj(),E.direction2=this.direction2.qj(),E}parse(E){super.parse(E),this.direction1.p(E.direction1),this.direction2.p(E.direction2)}}class u{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=E,this.height=b,this.radiusRange=h,this.directionRandomizer=k,this._tempVector=a.k.Zero()}startDirectionFunction(E,b,h,k,G){h.position.subtractToRef(E.getTranslation(),this._tempVector),this._tempVector.normalize(),a.k.TransformNormalToRef(this._tempVector,G,this._tempVector);const V=(0,v.w)(-this.directionRandomizer/2,this.directionRandomizer/2);let l=Math.atan2(this._tempVector.x,this._tempVector.z);l+=(0,v.w)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=V,this._tempVector.x=Math.sin(l),this._tempVector.z=Math.cos(l),this._tempVector.normalize(),k?b.p(this._tempVector):a.k.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,E,b)}startPositionFunction(E,b,h,k){const G=(0,v.w)(-this.height/2,this.height/2),V=(0,v.w)(0,2*Math.PI),l=(0,v.w)((1-this.radiusRange)*(1-this.radiusRange),1),O=Math.sqrt(l)*this.radius,s=O*Math.cos(V),U=O*Math.sin(V);k?b.ue(s,G,U):a.k.TransformCoordinatesFromFloatsToRef(s,G,U,E,b)}clone(){const E=new u(this.radius,this.directionRandomizer);return s.c.DeepCopy(this,E),E}applyToShader(E){E.setFloat("radius",this.radius),E.setFloat("height",this.height),E.setFloat("radiusRange",this.radiusRange),E.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(E){E.addUniform("radius",1),E.addUniform("height",1),E.addUniform("radiusRange",1),E.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const E={};return E.type=this.getClassName(),E.radius=this.radius,E.height=this.height,E.radiusRange=this.radiusRange,E.directionRandomizer=this.directionRandomizer,E}parse(E){this.radius=E.radius,this.height=E.height,this.radiusRange=E.radiusRange,this.directionRandomizer=E.directionRandomizer}}class D extends u{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new a.k(0,1,0),G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new a.k(0,1,0);super(E,b,h),this.direction1=k,this.direction2=G}startDirectionFunction(E,b,h,k){const G=(0,v.w)(this.direction1.x,this.direction2.x),V=(0,v.w)(this.direction1.y,this.direction2.y),l=(0,v.w)(this.direction1.z,this.direction2.z);k?b.ue(G,V,l):a.k.TransformNormalFromFloatsToRef(G,V,l,E,b)}clone(){const E=new D(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return s.c.DeepCopy(this,E),E}applyToShader(E){E.setFloat("radius",this.radius),E.setFloat("height",this.height),E.setFloat("radiusRange",this.radiusRange),E.setVector3("direction1",this.direction1),E.setVector3("direction2",this.direction2)}buildUniformLayout(E){E.addUniform("radius",1),E.addUniform("height",1),E.addUniform("radiusRange",1),E.addUniform("direction1",3),E.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const E=super.serialize();return E.direction1=this.direction1.qj(),E.direction2=this.direction2.qj(),E}parse(E){super.parse(E),a.k.FromArrayToRef(E.direction1,0,this.direction1),a.k.FromArrayToRef(E.direction2,0,this.direction2)}}class g{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=E,this.radiusRange=b,this.directionRandomizer=h}startDirectionFunction(E,b,h,k){const G=h.position.Xc(E.getTranslation()).normalize(),V=(0,v.w)(0,this.directionRandomizer),l=(0,v.w)(0,this.directionRandomizer),O=(0,v.w)(0,this.directionRandomizer);G.x+=V,G.y+=l,G.z+=O,G.normalize(),k?b.p(G):a.k.TransformNormalFromFloatsToRef(G.x,G.y,G.z,E,b)}startPositionFunction(E,b,h,k){const G=this.radius-(0,v.w)(0,this.radius*this.radiusRange),V=(0,v.w)(0,1),l=(0,v.w)(0,2*Math.PI),O=Math.acos(2*V-1),s=G*Math.cos(l)*Math.sin(O),U=G*Math.cos(O),B=G*Math.sin(l)*Math.sin(O);k?b.ue(s,Math.abs(U),B):a.k.TransformCoordinatesFromFloatsToRef(s,Math.abs(U),B,E,b)}clone(){const E=new g(this.radius,this.directionRandomizer);return s.c.DeepCopy(this,E),E}applyToShader(E){E.setFloat("radius",this.radius),E.setFloat("radiusRange",this.radiusRange),E.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(E){E.addUniform("radius",1),E.addUniform("radiusRange",1),E.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const E={};return E.type=this.getClassName(),E.radius=this.radius,E.radiusRange=this.radiusRange,E.directionRandomizer=this.directionRandomizer,E}parse(E){this.radius=E.radius,this.radiusRange=E.radiusRange,this.directionRandomizer=E.directionRandomizer}}class S{constructor(){this.direction1=new a.k(0,1,0),this.direction2=new a.k(0,1,0)}startDirectionFunction(E,b,h,k){const G=(0,v.w)(this.direction1.x,this.direction2.x),V=(0,v.w)(this.direction1.y,this.direction2.y),l=(0,v.w)(this.direction1.z,this.direction2.z);k?b.ue(G,V,l):a.k.TransformNormalFromFloatsToRef(G,V,l,E,b)}startPositionFunction(E,b,h,k){k?b.ue(0,0,0):a.k.TransformCoordinatesFromFloatsToRef(0,0,0,E,b)}clone(){const E=new S;return s.c.DeepCopy(this,E),E}applyToShader(E){E.setVector3("direction1",this.direction1),E.setVector3("direction2",this.direction2)}buildUniformLayout(E){E.addUniform("direction1",3),E.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const E={};return E.type=this.getClassName(),E.direction1=this.direction1.qj(),E.direction2=this.direction2.qj(),E}parse(E){a.k.FromArrayToRef(E.direction1,0,this.direction1),a.k.FromArrayToRef(E.direction2,0,this.direction2)}}class M{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=E,this.radiusRange=b,this.directionRandomizer=h}startDirectionFunction(E,b,h,k){const G=h.position.Xc(E.getTranslation()).normalize(),V=(0,v.w)(0,this.directionRandomizer),l=(0,v.w)(0,this.directionRandomizer),O=(0,v.w)(0,this.directionRandomizer);G.x+=V,G.y+=l,G.z+=O,G.normalize(),k?b.p(G):a.k.TransformNormalFromFloatsToRef(G.x,G.y,G.z,E,b)}startPositionFunction(E,b,h,k){const G=this.radius-(0,v.w)(0,this.radius*this.radiusRange),V=(0,v.w)(0,1),l=(0,v.w)(0,2*Math.PI),O=Math.acos(2*V-1),s=G*Math.cos(l)*Math.sin(O),U=G*Math.cos(O),B=G*Math.sin(l)*Math.sin(O);k?b.ue(s,U,B):a.k.TransformCoordinatesFromFloatsToRef(s,U,B,E,b)}clone(){const E=new M(this.radius,this.directionRandomizer);return s.c.DeepCopy(this,E),E}applyToShader(E){E.setFloat("radius",this.radius),E.setFloat("radiusRange",this.radiusRange),E.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(E){E.addUniform("radius",1),E.addUniform("radiusRange",1),E.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const E={};return E.type=this.getClassName(),E.radius=this.radius,E.radiusRange=this.radiusRange,E.directionRandomizer=this.directionRandomizer,E}parse(E){this.radius=E.radius,this.radiusRange=E.radiusRange,this.directionRandomizer=E.directionRandomizer}}class I extends M{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new a.k(0,1,0),h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new a.k(0,1,0);super(E),this.direction1=b,this.direction2=h}startDirectionFunction(E,b){const h=(0,v.w)(this.direction1.x,this.direction2.x),k=(0,v.w)(this.direction1.y,this.direction2.y),G=(0,v.w)(this.direction1.z,this.direction2.z);a.k.TransformNormalFromFloatsToRef(h,k,G,E,b)}clone(){const E=new I(this.radius,this.direction1,this.direction2);return s.c.DeepCopy(this,E),E}applyToShader(E){E.setFloat("radius",this.radius),E.setFloat("radiusRange",this.radiusRange),E.setVector3("direction1",this.direction1),E.setVector3("direction2",this.direction2)}buildUniformLayout(E){E.addUniform("radius",1),E.addUniform("radiusRange",1),E.addUniform("direction1",3),E.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const E=super.serialize();return E.direction1=this.direction1.qj(),E.direction2=this.direction2.qj(),E}parse(E){super.parse(E),this.direction1.p(E.direction1),this.direction2.p(E.direction2)}}class j{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{}}startDirectionFunction(E,b,h,k){const G=a.h.o[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,h,G);const E=a.h.o[1];G.subtractToRef(h.position,E),E.scaleToRef(1/h.lifeTime,G)}else G.set(0,0,0);k?b.p(G):a.k.TransformNormalToRef(G,E,b)}startPositionFunction(E,b,h,k){const G=a.h.o[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,h,G):G.set(0,0,0),k?b.p(G):a.k.TransformCoordinatesToRef(G,E,b)}clone(){const E=new j;return s.c.DeepCopy(this,E),E}applyToShader(E){}buildUniformLayout(E){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const E={};return E.type=this.getClassName(),E.particlePositionGenerator=this.particlePositionGenerator,E.particleDestinationGenerator=this.particleDestinationGenerator,E}parse(E){E.particlePositionGenerator&&(this.particlePositionGenerator=E.particlePositionGenerator),E.particleDestinationGenerator&&(this.particleDestinationGenerator=E.particleDestinationGenerator)}}var P=h(11233);class A{get mesh(){return this._mesh}set mesh(E){this._mesh!==E&&(this._mesh=E,E?(this._indices=E.rg(),this._positions=E.getVerticesData(P.g.PositionKind),this._normals=E.getVerticesData(P.g.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=a.k.Zero(),this._mesh=null,this.direction1=new a.k(0,1,0),this.direction2=new a.k(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=E}startDirectionFunction(E,b,h,k){if(this.useMeshNormalsForDirection&&this._normals)return void a.k.TransformNormalToRef(this._storedNormal,E,b);const G=(0,v.w)(this.direction1.x,this.direction2.x),V=(0,v.w)(this.direction1.y,this.direction2.y),l=(0,v.w)(this.direction1.z,this.direction2.z);k?b.ue(G,V,l):a.k.TransformNormalFromFloatsToRef(G,V,l,E,b)}startPositionFunction(E,b,h,k){if(!this._indices||!this._positions)return;const G=3*Math.random()*(this._indices.length/3)|0,V=Math.random(),l=Math.random()*(1-V),O=1-V-l,v=this._indices[G],s=this._indices[G+1],U=this._indices[G+2],B=a.h.o[0],o=a.h.o[1],u=a.h.o[2],D=a.h.o[3];a.k.FromArrayToRef(this._positions,3*v,B),a.k.FromArrayToRef(this._positions,3*s,o),a.k.FromArrayToRef(this._positions,3*U,u),D.x=V*B.x+l*o.x+O*u.x,D.y=V*B.y+l*o.y+O*u.y,D.z=V*B.z+l*o.z+O*u.z,k?b.ue(D.x,D.y,D.z):a.k.TransformCoordinatesFromFloatsToRef(D.x,D.y,D.z,E,b),this.useMeshNormalsForDirection&&this._normals&&(a.k.FromArrayToRef(this._normals,3*v,B),a.k.FromArrayToRef(this._normals,3*s,o),a.k.FromArrayToRef(this._normals,3*U,u),this._storedNormal.x=V*B.x+l*o.x+O*u.x,this._storedNormal.y=V*B.y+l*o.y+O*u.y,this._storedNormal.z=V*B.z+l*o.z+O*u.z)}clone(){const E=new A(this.mesh);return s.c.DeepCopy(this,E),E}applyToShader(E){E.setVector3("direction1",this.direction1),E.setVector3("direction2",this.direction2)}buildUniformLayout(E){E.addUniform("direction1",3),E.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var E;const b={};return b.type=this.getClassName(),b.direction1=this.direction1.qj(),b.direction2=this.direction2.qj(),b.meshId=null===(E=this.mesh)||void 0===E?void 0:E.id,b.useMeshNormalsForDirection=this.useMeshNormalsForDirection,b}parse(E,b){a.k.FromArrayToRef(E.direction1,0,this.direction1),a.k.FromArrayToRef(E.direction2,0,this.direction2),E.meshId&&b&&(this.mesh=b.getLastMeshById(E.meshId)),this.useMeshNormalsForDirection=E.useMeshNormalsForDirection}}var n=h(10905);class d{_isUbo(E){return void 0!==E.addUniform}constructor(E){this._isUbo(E)?(this.setMatrix3x3=E.updateMatrix3x3.bind(E),this.setMatrix2x2=E.updateMatrix2x2.bind(E),this.setFloat=E.updateFloat.bind(E),this.setFloat2=E.updateFloat2.bind(E),this.setFloat3=E.updateFloat3.bind(E),this.setFloat4=E.updateFloat4.bind(E),this.setFloatArray=E.updateFloatArray.bind(E),this.setArray=E.updateArray.bind(E),this.setIntArray=E.updateIntArray.bind(E),this.setMatrix=E.Pj.bind(E),this.setMatrices=E.updateMatrices.bind(E),this.setVector3=E.updateVector3.bind(E),this.setVector4=E.updateVector4.bind(E),this.setColor3=E.updateColor3.bind(E),this.setColor4=E.updateColor4.bind(E),this.setDirectColor4=E.updateDirectColor4.bind(E),this.setInt=E.updateInt.bind(E),this.setInt2=E.updateInt2.bind(E),this.setInt3=E.updateInt3.bind(E),this.setInt4=E.updateInt4.bind(E)):(this.setMatrix3x3=E.setMatrix3x3.bind(E),this.setMatrix2x2=E.setMatrix2x2.bind(E),this.setFloat=E.setFloat.bind(E),this.setFloat2=E.setFloat2.bind(E),this.setFloat3=E.setFloat3.bind(E),this.setFloat4=E.setFloat4.bind(E),this.setFloatArray=E.setFloatArray.bind(E),this.setArray=E.setArray.bind(E),this.setIntArray=E.setIntArray.bind(E),this.setMatrix=E.setMatrix.bind(E),this.setMatrices=E.setMatrices.bind(E),this.setVector3=E.setVector3.bind(E),this.setVector4=E.setVector4.bind(E),this.setColor3=E.setColor3.bind(E),this.setColor4=E.setColor4.bind(E),this.setDirectColor4=E.setDirectColor4.bind(E),this.setInt=E.setInt.bind(E),this.setInt2=E.setInt2.bind(E),this.setInt3=E.setInt3.bind(E),this.setInt4=E.setInt4.bind(E))}}var c=h(10912);const z="gpuUpdateParticlesPixelShader",Z="#version 300 es\nvoid main() {discard;}\n";c.d.ShadersStore[z]=Z;const Y="gpuUpdateParticlesVertexShader",r="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";c.d.ShadersStore[Y]=r;(0,l.f)("BABYLON.WebGL2ParticleSystem",class{constructor(E,b){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=E,this._engine=b,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var E;return(null===(E=this._updateEffect)||void 0===E?void 0:E.isReady())??!1}createUpdateBuffer(E){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof j&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=E,this._updateEffect=new n.b("gpuUpdateParticles",this._updateEffectOptions,this._engine),new d(this._updateEffect)}createVertexBuffers(E,b){this._updateVAO.push(this._createUpdateVAO(E)),this._renderVAO.push(this._engine.recordVertexArrayObject(b,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=b}createParticleBuffer(E){return E}bindDrawBuffers(E,b,h){h?this._engine.bindBuffers(this._renderVertexBuffers,h,b):this._engine.bindVertexArrayObject(this._renderVAO[E],null)}preUpdateParticleBuffer(){const E=this._engine;if(this._engine.enableEffect(this._updateEffect),!E.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(E,b,h){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[E],null);const a=this._engine;a.bindTransformFeedbackBuffer(b.getBuffer()),a.setRasterizerState(!1),a.beginTransformFeedback(!0),a.drawArraysType(3,0,h),a.endTransformFeedback(),a.setRasterizerState(!0),a.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let E=0;E<this._updateVAO.length;E++)this._engine.releaseVertexArrayObject(this._updateVAO[E]);this._updateVAO.length=0;for(let E=0;E<this._renderVAO.length;E++)this._engine.releaseVertexArrayObject(this._renderVAO[E]);this._renderVAO.length=0}_createUpdateVAO(E){const b={};b.position=E.createVertexBuffer("position",0,3);let h=3;b.age=E.createVertexBuffer("age",h,1),h+=1,b.size=E.createVertexBuffer("size",h,3),h+=3,b.life=E.createVertexBuffer("life",h,1),h+=1,b.seed=E.createVertexBuffer("seed",h,4),h+=4,b.direction=E.createVertexBuffer("direction",h,3),h+=3,this._parent.particleEmitterType instanceof j&&(b.initialPosition=E.createVertexBuffer("initialPosition",h,3),h+=3),this._parent._colorGradientsTexture||(b.color=E.createVertexBuffer("color",h,4),h+=4),this._parent._isBillboardBased||(b.initialDirection=E.createVertexBuffer("initialDirection",h,3),h+=3),this._parent.noiseTexture&&(b.noiseCoordinates1=E.createVertexBuffer("noiseCoordinates1",h,3),h+=3,b.noiseCoordinates2=E.createVertexBuffer("noiseCoordinates2",h,3),h+=3),this._parent._angularSpeedGradientsTexture?(b.angle=E.createVertexBuffer("angle",h,1),h+=1):(b.angle=E.createVertexBuffer("angle",h,2),h+=2),this._parent._isAnimationSheetEnabled&&(b.cellIndex=E.createVertexBuffer("cellIndex",h,1),h+=1,this._parent.spriteRandomStartCell&&(b.cellStartOffset=E.createVertexBuffer("cellStartOffset",h,1),h+=1));const a=this._engine.recordVertexArrayObject(b,null,this._updateEffect);return this._engine.bindArrayBuffer(null),a}});class w{constructor(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,a=arguments.length>3?arguments[3]:void 0;this._engine=E,this._label=a,this._engine._storageBuffers.push(this),this._create(b,h)}_create(E,b){this._bufferSize=E,this._creationFlags=b,this._buffer=this._engine.createStorageBuffer(E,b,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(E,b,h){this._buffer&&this._engine.updateStorageBuffer(this._buffer,E,b,h)}read(E,b,h,a){return this._engine.readFromStorageBuffer(this._buffer,E,b,h,a)}dispose(){const E=this._engine._storageBuffers,b=E.indexOf(this);-1!==b&&(E[b]=E[E.length-1],E.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var N=h(11130),H=h(11139),f=h(11206),F=h(11376),y=h(11293),e=h(10834),J=h(10941),m=h(10972);class K{constructor(){this._gpuTimeInFrameId=-1,this.counter=new m.d}_addDuration(E,b){E<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==E?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(b,!1),this._gpuTimeInFrameId=E):this.counter.addCount(b,!1))}}class x{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=E,this._engine=b,this.uniqueId=y.e.UniqueId,b.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new K),this._engine.getCaps().supportComputeShaders?a.bindingsMapping?(this._context=b.createComputeContext(),this._shaderPath=h,this._options={bindingsMapping:{},defines:[],...a}):e.c.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):e.c.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(E,b){let h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const a=this._bindings[E];this._bindings[E]={type:h?0:4,object:b,indexInGroupEntries:null===a||void 0===a?void 0:a.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!a||a.object!==b||a.type!==this._bindings[E].type)}setStorageTexture(E,b){const h=this._bindings[E];this._contextIsDirty||(this._contextIsDirty=!h||h.object!==b),this._bindings[E]={type:1,object:b,indexInGroupEntries:null===h||void 0===h?void 0:h.indexInGroupEntries}}setExternalTexture(E,b){const h=this._bindings[E];this._contextIsDirty||(this._contextIsDirty=!h||h.object!==b),this._bindings[E]={type:6,object:b,indexInGroupEntries:null===h||void 0===h?void 0:h.indexInGroupEntries}}setVideoTexture(E,b){return!!b.externalTexture&&(this.setExternalTexture(E,b.externalTexture),!0)}setUniformBuffer(E,b){const h=this._bindings[E];this._contextIsDirty||(this._contextIsDirty=!h||h.object!==b),this._bindings[E]={type:x._BufferIsDataBuffer(b)?7:2,object:b,indexInGroupEntries:null===h||void 0===h?void 0:h.indexInGroupEntries}}setStorageBuffer(E,b){const h=this._bindings[E];this._contextIsDirty||(this._contextIsDirty=!h||h.object!==b),this._bindings[E]={type:x._BufferIsDataBuffer(b)?7:3,object:b,indexInGroupEntries:null===h||void 0===h?void 0:h.indexInGroupEntries}}setTextureSampler(E,b){const h=this._bindings[E];this._contextIsDirty||(this._contextIsDirty=!h||!b.compareSampler(h.object)),this._bindings[E]={type:5,object:b,indexInGroupEntries:null===h||void 0===h?void 0:h.indexInGroupEntries}}isReady(){let E=this._effect;for(const k in this._bindings){const E=this._bindings[k],b=E.type,h=E.object;switch(b){case 0:case 4:case 1:if(!h.isReady())return!1;break;case 6:if(!h.isReady())return!1;break}}const b=[],h=this._shaderPath;if(this._options.defines)for(let k=0;k<this._options.defines.length;k++)b.push(this._options.defines[k]);const a=b.join("\n");return this._cachedDefines!==a&&(this._cachedDefines=a,E=this._engine.createComputeEffect(h,{defines:a,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=E),!!E.isReady()}dispatch(E,b,h){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,E,b,h,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const h=x._BufferIsDataBuffer(E)?E:E.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,h,b,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const b in this._bindings){const h=this._bindings[b];if(!this._options.bindingsMapping[b])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+b+"'");switch(h.type){case 0:{const a=this._samplers[b],k=h.object;var E;if(!a||!k._texture||!a.compareSampler(k._texture))this._samplers[b]=(new J.e).setParameters(k.wrapU,k.wrapV,k.wrapR,k.anisotropicFilteringLevel,k._texture.samplingMode,null===(E=k._texture)||void 0===E?void 0:E._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const E=h.object;E.getBuffer()!==h.buffer&&(h.buffer=E.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}dispatchWhenReady(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return new Promise((k=>{const G=()=>{this.dispatch(E,b,h)?k():setTimeout(G,a)};G()}))}serialize(){const E=f.e.Serialize(this);E.options=this._options,E.shaderPath=this._shaderPath,E.Fj={},E.textures={};for(const b in this._bindings){const h=this._bindings[b],a=h.object;switch(h.type){case 0:case 4:case 1:{const k=a.serialize();k&&(E.textures[b]=k,E.Fj[b]={type:h.type});break}}}return E}static Parse(E,b,h){const a=f.e.Parse((()=>new x(E.name,b.getEngine(),E.shaderPath,E.options)),E,b,h);for(const k in E.textures){const G=E.Fj[k],V=F.b.Parse(E.textures[k],b,h);0===G.type?a.setTexture(k,V):4===G.type?a.setTexture(k,V,!1):a.setStorageTexture(k,V)}return a}static _BufferIsDataBuffer(E){return void 0!==E.underlyingResource}}(0,N.d)([(0,H.H)()],x.prototype,"name",void 0),(0,N.d)([(0,H.H)()],x.prototype,"fastMode",void 0),(0,l.f)("BABYLON.ComputeShader",x);var W=h(11224);const L="gpuUpdateParticlesComputeShader",t="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";c.d.ShadersStoreWGSL[L]=t;(0,l.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(E,b){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=E,this._engine=b}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var E;return(null===(E=this._updateComputeShader)||void 0===E?void 0:E.isReady())??!1}createUpdateBuffer(E){var b;const h={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(h.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(h.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(h.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(h.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(h.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(h.noiseTexture={group:1,binding:11}),this._updateComputeShader=new x("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:h,defines:E.split("\n")}),null===(b=this._simParamsComputeShader)||void 0===b||b.dispose(),this._simParamsComputeShader=new W.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new d(this._simParamsComputeShader)}createVertexBuffers(E,b){this._renderVertexBuffers.push(b)}createParticleBuffer(E){const b=new w(this._engine,4*E.length,11,"ComputeShaderParticleSystemBuffer");return b.update(E),this._bufferComputeShader.push(b),b.getBuffer()}bindDrawBuffers(E,b,h){this._engine.bindBuffers(this._renderVertexBuffers[E],h,b)}preUpdateParticleBuffer(){}updateParticleBuffer(E,b,h){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[E]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^E]),this._updateComputeShader.dispatch(Math.ceil(h/64))}releaseBuffers(){var E;for(let b=0;b<this._bufferComputeShader.length;++b)this._bufferComputeShader[b].dispose();this._bufferComputeShader.length=0,null===(E=this._simParamsComputeShader)||void 0===E||E.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class T{constructor(E,b,h){this.gradient=E,this.color1=b,this.color2=h}getColorToRef(E){this.color2?V.f.LerpToRef(this.color1,this.color2,Math.random(),E):E.p(this.color1)}}class X{constructor(E,b){this.gradient=E,this.color=b}}class C{constructor(E,b,h){this.gradient=E,this.factor1=b,this.factor2=h}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class q{static GetCurrentGradient(E,b,h){if(b[0].gradient>E)return void h(b[0],b[0],1);for(let k=0;k<b.length-1;k++){const a=b[k],G=b[k+1];if(E>=a.gradient&&E<=G.gradient){return void h(a,G,(E-a.gradient)/(G.gradient-a.gradient))}}const a=b.length-1;h(b[a],b[a],1)}}var R=h(10824),Q=h(11622),i=h(10869);class p{constructor(E){this.particleSystem=E,this.position=a.k.Zero(),this.direction=a.k.Zero(),this.color=new V.f(0,0,0,0),this.colorStep=new V.f(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new a.j(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new V.f(0,0,0,0),this._currentColor2=new V.f(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=p._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let E=this.age,b=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===b?(b=1,E=this._randomCellOffset):E+=this._randomCellOffset);const h=this._initialEndSpriteCellID-this._initialStartSpriteCellID+1;let a;a=this._initialSpriteCellLoop?(0,v.b)(E*b%this.lifeTime/this.lifeTime):(0,v.b)(E*b/this.lifeTime),this.cellIndex=this._initialStartSpriteCellID+a*h|0}_inheritParticleInfoToSubEmitter(E){if(E.particleSystem.j.position){const b=E.particleSystem.j;if(b.position.p(this.position),E.inheritDirection){const E=a.h.o[0];this.direction.normalizeToRef(E),b.setDirection(E,0,Math.PI/2)}}else{E.particleSystem.j.p(this.position)}this.direction.scaleToRef(E.inheritedVelocityAmount/2,a.h.o[0]),E.particleSystem._inheritedVelocityOffset.p(a.h.o[0])}_inheritParticleInfoToSubEmitters(){this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach((E=>{this._inheritParticleInfoToSubEmitter(E)}))}_reset(){this.age=0,this.id=p._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(E){E.position.p(this.position),this._initialDirection?E._initialDirection?E._initialDirection.p(this._initialDirection):E._initialDirection=this._initialDirection.clone():E._initialDirection=null,E.direction.p(this.direction),this.re&&(E.re?E.re.p(this.re):E.re=this.re.clone()),E.color.p(this.color),E.colorStep.p(this.colorStep),E.lifeTime=this.lifeTime,E.age=this.age,E._randomCellOffset=this._randomCellOffset,E.size=this.size,E.scale.p(this.scale),E.angle=this.angle,E.angularSpeed=this.angularSpeed,E.particleSystem=this.particleSystem,E.cellIndex=this.cellIndex,E.id=this.id,E._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(E._currentColorGradient=this._currentColorGradient,E._currentColor1.p(this._currentColor1),E._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(E._currentSizeGradient=this._currentSizeGradient,E._currentSize1=this._currentSize1,E._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(E._currentAngularSpeedGradient=this._currentAngularSpeedGradient,E._currentAngularSpeed1=this._currentAngularSpeed1,E._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(E._currentVelocityGradient=this._currentVelocityGradient,E._currentVelocity1=this._currentVelocity1,E._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(E._currentLimitVelocityGradient=this._currentLimitVelocityGradient,E._currentLimitVelocity1=this._currentLimitVelocity1,E._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(E._currentDragGradient=this._currentDragGradient,E._currentDrag1=this._currentDrag1,E._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(E._initialStartSpriteCellID=this._initialStartSpriteCellID,E._initialEndSpriteCellID=this._initialEndSpriteCellID,E._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(E.remapData&&this.remapData?E.remapData.p(this.remapData):E.remapData=new a.n(0,0,0,0)),this._randomNoiseCoordinates1&&(E._randomNoiseCoordinates1?(E._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),E._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(E._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),E._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}p._Count=0;var EE=h(11345),bE=(h(11631),h(11357)),hE=h(11351),aE=h(11216);class kE extends O{set onDispose(E){this._onDisposeObserver&&this.rj.remove(this._onDisposeObserver),this._onDisposeObserver=this.rj.add(E)}get useRampGradients(){return this._useRampGradients}set useRampGradients(E){this._useRampGradients!==E&&(this._useRampGradients=E,this._resetEffect())}get particles(){return this.Aj}get shaderLanguage(){return this._shaderLanguage}getActiveCount(){return this.Aj.length}getClassName(){return"tb"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var E;let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(E=this._customWrappers[b])||void 0===E?void 0:E.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[E]??this._customWrappers[0]}setCustomEffect(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[b]=new EE.c(this._engine),this._customWrappers[b].effect=E,this._customWrappers[b].drawContext&&(this._customWrappers[b].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new R.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}constructor(E,b,h){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,G=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01;super(E),this._emitterInverseWorldMatrix=a.d.Identity(),this._inheritedVelocityOffset=new a.k,this.rj=new R.e,this.onStoppedObservable=new R.e,this.Aj=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new V.f(0,0,0,0),this._colorDiff=new V.f(0,0,0,0),this._scaledDirection=a.k.Zero(),this._scaledGravity=a.k.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this.isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=E=>{},this.recycleParticle=E=>{const b=this.Aj.pop();b!==E&&b.copyTo(E),this._stockParticles.push(b)},this._createParticle=()=>{let E;return 0!==this._stockParticles.length?(E=this._stockParticles.pop(),E._reset()):E=new p(this),this._prepareParticle(E),E},this._shadersLoaded=!1,this._capacity=b,this._epsilon=l,this._isAnimationSheetEnabled=G,h&&"Scene"!==h.getClassName()?(this._engine=h,this.defaultProjectionMatrix=a.d.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=h||i.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.yj.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._attachImageProcessingConfiguration(null),this._customWrappers={0:new EE.c(this._engine)},this._customWrappers[0].effect=k,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new U;let O=null;this.updateFunction=E=>{let b=null;var h;this.noiseTexture&&(b=this.noiseTexture.getSize(),null===(h=this.noiseTexture.getContent())||void 0===h||h.then((E=>{O=E})));const k=E===this.Aj;for(let G=0;G<E.length;G++){const h=E[G];let l=this._scaledUpdateSpeed;const s=h.age;if(h.age+=l,h.age>h.lifeTime){const E=h.age-s;l=(h.lifeTime-s)*l/E,h.age=h.lifeTime}const U=h.age/h.lifeTime;this._colorGradients&&this._colorGradients.length>0?q.GetCurrentGradient(U,this._colorGradients,((E,b,a)=>{E!==h._currentColorGradient&&(h._currentColor1.p(h._currentColor2),b.getColorToRef(h._currentColor2),h._currentColorGradient=E),V.f.LerpToRef(h._currentColor1,h._currentColor2,a,h.color)})):(h.colorStep.scaleToRef(l,this._scaledColorStep),h.color.addInPlace(this._scaledColorStep),h.color.a<0&&(h.color.a=0)),this._angularSpeedGradients&&this._angularSpeedGradients.length>0&&q.GetCurrentGradient(U,this._angularSpeedGradients,((E,b,a)=>{E!==h._currentAngularSpeedGradient&&(h._currentAngularSpeed1=h._currentAngularSpeed2,h._currentAngularSpeed2=b.getFactor(),h._currentAngularSpeedGradient=E),h.angularSpeed=(0,v.o)(h._currentAngularSpeed1,h._currentAngularSpeed2,a)})),h.angle+=h.angularSpeed*l;let B=l;if(this._velocityGradients&&this._velocityGradients.length>0&&q.GetCurrentGradient(U,this._velocityGradients,((E,b,a)=>{E!==h._currentVelocityGradient&&(h._currentVelocity1=h._currentVelocity2,h._currentVelocity2=b.getFactor(),h._currentVelocityGradient=E),B*=(0,v.o)(h._currentVelocity1,h._currentVelocity2,a)})),h.direction.scaleToRef(B,this._scaledDirection),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&q.GetCurrentGradient(U,this._limitVelocityGradients,((E,b,a)=>{E!==h._currentLimitVelocityGradient&&(h._currentLimitVelocity1=h._currentLimitVelocity2,h._currentLimitVelocity2=b.getFactor(),h._currentLimitVelocityGradient=E);const k=(0,v.o)(h._currentLimitVelocity1,h._currentLimitVelocity2,a);h.direction.length()>k&&h.direction.scaleInPlace(this.limitVelocityDamping)})),this._dragGradients&&this._dragGradients.length>0&&q.GetCurrentGradient(U,this._dragGradients,((E,b,a)=>{E!==h._currentDragGradient&&(h._currentDrag1=h._currentDrag2,h._currentDrag2=b.getFactor(),h._currentDragGradient=E);const k=(0,v.o)(h._currentDrag1,h._currentDrag2,a);this._scaledDirection.scaleInPlace(1-k)})),this.isLocal&&h.re?(h.re.addInPlace(this._scaledDirection),a.k.TransformCoordinatesToRef(h.re,this._emitterWorldMatrix,h.position)):h.position.addInPlace(this._scaledDirection),O&&b&&h._randomNoiseCoordinates1){const E=this._fetchR(h._randomNoiseCoordinates1.x,h._randomNoiseCoordinates1.y,b.width,b.height,O),k=this._fetchR(h._randomNoiseCoordinates1.z,h._randomNoiseCoordinates2.x,b.width,b.height,O),G=this._fetchR(h._randomNoiseCoordinates2.y,h._randomNoiseCoordinates2.z,b.width,b.height,O),V=a.h.o[0],v=a.h.o[1];V.ue((2*E-1)*this.noiseStrength.x,(2*k-1)*this.noiseStrength.y,(2*G-1)*this.noiseStrength.z),V.scaleToRef(l,v),h.direction.addInPlace(v)}this.gravity.scaleToRef(l,this._scaledGravity),h.direction.addInPlace(this._scaledGravity),this._sizeGradients&&this._sizeGradients.length>0&&q.GetCurrentGradient(U,this._sizeGradients,((E,b,a)=>{E!==h._currentSizeGradient&&(h._currentSize1=h._currentSize2,h._currentSize2=b.getFactor(),h._currentSizeGradient=E),h.size=(0,v.o)(h._currentSize1,h._currentSize2,a)})),this._useRampGradients&&(this._colorRemapGradients&&this._colorRemapGradients.length>0&&q.GetCurrentGradient(U,this._colorRemapGradients,((E,b,a)=>{const k=(0,v.o)(E.factor1,b.factor1,a),G=(0,v.o)(E.factor2,b.factor2,a);h.remapData.x=k,h.remapData.y=G-k})),this._alphaRemapGradients&&this._alphaRemapGradients.length>0&&q.GetCurrentGradient(U,this._alphaRemapGradients,((E,b,a)=>{const k=(0,v.o)(E.factor1,b.factor1,a),G=(0,v.o)(E.factor2,b.factor2,a);h.remapData.z=k,h.remapData.w=G-k}))),this._isAnimationSheetEnabled&&h.updateCellIndex(),h._inheritParticleInfoToSubEmitters(),h.age>=h.lifeTime&&(this._emitFromParticle(h),h._attachedSubEmitters&&(h._attachedSubEmitters.forEach((E=>{E.particleSystem.disposeOnStop=!0,E.particleSystem.stop()})),h._attachedSubEmitters=null),this.recycleParticle(h),k&&G--)}}}serialize(E){throw new Error("Method not implemented.")}clone(E,b){throw new Error("Method not implemented.")}_addFactorGradient(E,b,h,a){const k=new C(b,h,a);E.push(k),E.sort(((E,b)=>E.gradient<b.gradient?-1:E.gradient>b.gradient?1:0))}_removeFactorGradient(E,b){if(!E)return;let h=0;for(const a of E){if(a.gradient===b){E.splice(h,1);break}h++}}addLifeTimeGradient(E,b,h){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,E,b,h),this}removeLifeTimeGradient(E){return this._removeFactorGradient(this._lifeTimeGradients,E),this}addSizeGradient(E,b,h){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,E,b,h),this}removeSizeGradient(E){return this._removeFactorGradient(this._sizeGradients,E),this}addColorRemapGradient(E,b,h){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,E,b,h),this}removeColorRemapGradient(E){return this._removeFactorGradient(this._colorRemapGradients,E),this}addAlphaRemapGradient(E,b,h){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,E,b,h),this}removeAlphaRemapGradient(E){return this._removeFactorGradient(this._alphaRemapGradients,E),this}addAngularSpeedGradient(E,b,h){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,E,b,h),this}removeAngularSpeedGradient(E){return this._removeFactorGradient(this._angularSpeedGradients,E),this}addVelocityGradient(E,b,h){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,E,b,h),this}removeVelocityGradient(E){return this._removeFactorGradient(this._velocityGradients,E),this}addLimitVelocityGradient(E,b,h){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,E,b,h),this}removeLimitVelocityGradient(E){return this._removeFactorGradient(this._limitVelocityGradients,E),this}addDragGradient(E,b,h){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,E,b,h),this}removeDragGradient(E){return this._removeFactorGradient(this._dragGradients,E),this}addEmitRateGradient(E,b,h){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,E,b,h),this}removeEmitRateGradient(E){return this._removeFactorGradient(this._emitRateGradients,E),this}addStartSizeGradient(E,b,h){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,E,b,h),this}removeStartSizeGradient(E){return this._removeFactorGradient(this._startSizeGradients,E),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const E=new Uint8Array(4*this._rawTextureWidth),b=V.j.gb[0];for(let h=0;h<this._rawTextureWidth;h++){const a=h/this._rawTextureWidth;q.GetCurrentGradient(a,this._rampGradients,((a,k,G)=>{V.b.LerpToRef(a.color,k.color,G,b),E[4*h]=255*b.r,E[4*h+1]=255*b.g,E[4*h+2]=255*b.b,E[4*h+3]=255}))}this._rampGradientsTexture=Q.d.CreateRGBATexture(E,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((E,b)=>E.gradient<b.gradient?-1:E.gradient>b.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(E,b){this._rampGradients||(this._rampGradients=[]);const h=new X(E,b);return this._rampGradients.push(h),this._syncRampGradientTexture(),this}removeRampGradient(E){return this._removeGradientAndTexture(E,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(E,b,h){this._colorGradients||(this._colorGradients=[]);const a=new T(E,b,h);return this._colorGradients.push(a),this._colorGradients.sort(((E,b)=>E.gradient<b.gradient?-1:E.gradient>b.gradient?1:0)),this}removeColorGradient(E){if(!this._colorGradients)return this;let b=0;for(const h of this._colorGradients){if(h.gradient===E){this._colorGradients.splice(b,1);break}b++}return this}resetDrawCache(){for(const E of this._drawWrappers)if(E)for(const b of E)null===b||void 0===b||b.dispose();this._drawWrappers=[]}_fetchR(E,b,h,a,k){return k[4*(((E=.5*Math.abs(E)+.5)*h%h|0)+((b=.5*Math.abs(b)+.5)*a%a|0)*h)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const E=this._engine,b=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*b),this._vertexBuffer=new P.d(E,this._vertexData,!0,b);let h=0;const a=this._vertexBuffer.createVertexBuffer(P.g.PositionKind,h,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[P.g.PositionKind]=a,h+=3;const k=this._vertexBuffer.createVertexBuffer(P.g.ColorKind,h,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[P.g.ColorKind]=k,h+=4;const G=this._vertexBuffer.createVertexBuffer("angle",h,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=G,h+=1;const V=this._vertexBuffer.createVertexBuffer("size",h,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=V,h+=2,this._isAnimationSheetEnabled){const E=this._vertexBuffer.createVertexBuffer("cellIndex",h,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=E,h+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const E=this._vertexBuffer.createVertexBuffer("direction",h,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=E,h+=3}if(this._useRampGradients){const E=this._vertexBuffer.createVertexBuffer("remapData",h,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=E,h+=4}let l;if(this._useInstancing){const b=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new P.d(E,b,!1,2),l=this._spriteBuffer.createVertexBuffer("offset",0,2)}else l=this._vertexBuffer.createVertexBuffer("offset",h,2,this._vertexBufferSize,this._useInstancing),h+=2;this._vertexBuffers.offset=l,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const E=[],b=[];let h=0;for(let a=0;a<this._capacity;a++)E.push(h),E.push(h+1),E.push(h+2),E.push(h),E.push(h+2),E.push(h+3),b.push(h,h+1,h+1,h+2,h+2,h+3,h+3,h,h,h+3),h+=4;this._indexBuffer=this._engine.createIndexBuffer(E),this._linesIndexBuffer=this._engine.createIndexBuffer(b)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(E)setTimeout((()=>{this.start(0)}),E);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var b;-1!==(null===(b=this.j)||void 0===b?void 0:b.getClassName().indexOf("Mesh"))&&this.j.Wj(!0);const E=this.noiseTexture;if(E&&E.onGeneratedObservable)E.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let b=0;b<this.preWarmCycles;b++)this.animate(!0),E.render()}))}));else for(let b=0;b<this.preWarmCycles;b++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}}stop(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(E))}_postStop(E){}reset(){this._stockParticles.length=0,this.Aj.length=0}_appendParticleVertex(E,b,h,k){let G=E*this._vertexBufferSize;if(this._vertexData[G++]=b.position.x+this.og.x,this._vertexData[G++]=b.position.y+this.og.y,this._vertexData[G++]=b.position.z+this.og.z,this._vertexData[G++]=b.color.r,this._vertexData[G++]=b.color.g,this._vertexData[G++]=b.color.b,this._vertexData[G++]=b.color.a,this._vertexData[G++]=b.angle,this._vertexData[G++]=b.scale.x*b.size,this._vertexData[G++]=b.scale.y*b.size,this._isAnimationSheetEnabled&&(this._vertexData[G++]=b.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[G++]=b.direction.x,this._vertexData[G++]=b.direction.y,this._vertexData[G++]=b.direction.z);else if(b._initialDirection){let E=b._initialDirection;this.isLocal&&(a.k.TransformNormalToRef(E,this._emitterWorldMatrix,a.h.o[0]),E=a.h.o[0]),0===E.x&&0===E.z&&(E.x=.001),this._vertexData[G++]=E.x,this._vertexData[G++]=E.y,this._vertexData[G++]=E.z}else{let E=b.direction;this.isLocal&&(a.k.TransformNormalToRef(E,this._emitterWorldMatrix,a.h.o[0]),E=a.h.o[0]),0===E.x&&0===E.z&&(E.x=.001),this._vertexData[G++]=E.x,this._vertexData[G++]=E.y,this._vertexData[G++]=E.z}this._useRampGradients&&b.remapData&&(this._vertexData[G++]=b.remapData.x,this._vertexData[G++]=b.remapData.y,this._vertexData[G++]=b.remapData.z,this._vertexData[G++]=b.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===h?h=this._epsilon:1===h&&(h=1-this._epsilon),0===k?k=this._epsilon:1===k&&(k=1-this._epsilon)),this._vertexData[G++]=h,this._vertexData[G++]=k)}_prepareParticle(E){}_update(E){if(this._alive=this.Aj.length>0,this.j.position){const E=this.j;this._emitterWorldMatrix=E.getWorldMatrix()}else{const E=this.j;this._emitterWorldMatrix=a.d.Translation(E.x,E.y,E.z)}let b;this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Aj);for(let h=0;h<E&&this.Aj.length!==this._capacity;h++){if(b=this._createParticle(),this.Aj.push(b),this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0){const E=(0,v.b)(this._actualFrame/this.targetStopDuration);q.GetCurrentGradient(E,this._lifeTimeGradients,((h,a)=>{const k=h,G=a,V=k.getFactor(),l=G.getFactor(),O=(E-k.gradient)/(G.gradient-k.gradient);b.lifeTime=(0,v.o)(V,l,O)}))}else b.lifeTime=(0,v.w)(this.minLifeTime,this.maxLifeTime);const E=(0,v.w)(this.minEmitPower,this.maxEmitPower);if(this.startPositionFunction?this.startPositionFunction(this._emitterWorldMatrix,b.position,b,this.isLocal):this.particleEmitterType.startPositionFunction(this._emitterWorldMatrix,b.position,b,this.isLocal),this.isLocal&&(b.re?b.re.p(b.position):b.re=b.position.clone(),a.k.TransformCoordinatesToRef(b.re,this._emitterWorldMatrix,b.position)),this.startDirectionFunction?this.startDirectionFunction(this._emitterWorldMatrix,b.direction,b,this.isLocal):this.particleEmitterType.startDirectionFunction(this._emitterWorldMatrix,b.direction,b,this.isLocal,this._emitterInverseWorldMatrix),0===E?b._initialDirection?b._initialDirection.p(b.direction):b._initialDirection=b.direction.clone():b._initialDirection=null,b.direction.scaleInPlace(E),this._sizeGradients&&0!==this._sizeGradients.length?(b._currentSizeGradient=this._sizeGradients[0],b._currentSize1=b._currentSizeGradient.getFactor(),b.size=b._currentSize1,this._sizeGradients.length>1?b._currentSize2=this._sizeGradients[1].getFactor():b._currentSize2=b._currentSize1):b.size=(0,v.w)(this.minSize,this.maxSize),b.scale.ue((0,v.w)(this.minScaleX,this.maxScaleX),(0,v.w)(this.minScaleY,this.maxScaleY)),this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration){const E=this._actualFrame/this.targetStopDuration;q.GetCurrentGradient(E,this._startSizeGradients,((E,h,a)=>{E!==this._currentStartSizeGradient&&(this._currentStartSize1=this._currentStartSize2,this._currentStartSize2=h.getFactor(),this._currentStartSizeGradient=E);const k=(0,v.o)(this._currentStartSize1,this._currentStartSize2,a);b.scale.scaleInPlace(k)}))}if(this._angularSpeedGradients&&0!==this._angularSpeedGradients.length?(b._currentAngularSpeedGradient=this._angularSpeedGradients[0],b.angularSpeed=b._currentAngularSpeedGradient.getFactor(),b._currentAngularSpeed1=b.angularSpeed,this._angularSpeedGradients.length>1?b._currentAngularSpeed2=this._angularSpeedGradients[1].getFactor():b._currentAngularSpeed2=b._currentAngularSpeed1):b.angularSpeed=(0,v.w)(this.minAngularSpeed,this.maxAngularSpeed),b.angle=(0,v.w)(this.minInitialRotation,this.maxInitialRotation),this._velocityGradients&&this._velocityGradients.length>0&&(b._currentVelocityGradient=this._velocityGradients[0],b._currentVelocity1=b._currentVelocityGradient.getFactor(),this._velocityGradients.length>1?b._currentVelocity2=this._velocityGradients[1].getFactor():b._currentVelocity2=b._currentVelocity1),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&(b._currentLimitVelocityGradient=this._limitVelocityGradients[0],b._currentLimitVelocity1=b._currentLimitVelocityGradient.getFactor(),this._limitVelocityGradients.length>1?b._currentLimitVelocity2=this._limitVelocityGradients[1].getFactor():b._currentLimitVelocity2=b._currentLimitVelocity1),this._dragGradients&&this._dragGradients.length>0&&(b._currentDragGradient=this._dragGradients[0],b._currentDrag1=b._currentDragGradient.getFactor(),this._dragGradients.length>1?b._currentDrag2=this._dragGradients[1].getFactor():b._currentDrag2=b._currentDrag1),this._colorGradients&&0!==this._colorGradients.length)b._currentColorGradient=this._colorGradients[0],b._currentColorGradient.getColorToRef(b.color),b._currentColor1.p(b.color),this._colorGradients.length>1?this._colorGradients[1].getColorToRef(b._currentColor2):b._currentColor2.p(b.color);else{const E=(0,v.w)(0,1);V.f.LerpToRef(this.color1,this.color2,E,b.color),this.colorDead.subtractToRef(b.color,this._colorDiff),this._colorDiff.scaleToRef(1/b.lifeTime,b.colorStep)}this._isAnimationSheetEnabled&&(b._initialStartSpriteCellID=this.startSpriteCellID,b._initialEndSpriteCellID=this.endSpriteCellID,b._initialSpriteCellLoop=this.spriteCellLoop),b.direction.addInPlace(this._inheritedVelocityOffset),this._useRampGradients&&(b.remapData=new a.n(0,1,0,1)),this.noiseTexture&&(b._randomNoiseCoordinates1?(b._randomNoiseCoordinates1.ue(Math.random(),Math.random(),Math.random()),b._randomNoiseCoordinates2.ue(Math.random(),Math.random(),Math.random())):(b._randomNoiseCoordinates1=new a.k(Math.random(),Math.random(),Math.random()),b._randomNoiseCoordinates2=new a.k(Math.random(),Math.random(),Math.random()))),b._inheritParticleInfoToSubEmitters()}}static _GetAttributeNamesOrOptions(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a=[P.g.PositionKind,P.g.ColorKind,"angle","offset","size"];return E&&a.push("cellIndex"),b||a.push("direction"),h&&a.push("remapData"),a}static _GetEffectCreationOptions(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,bE.b)(a),E&&a.push("particlesInfos"),b&&a.push("logarithmicDepthConstant"),h&&(a.push("vFogInfos"),a.push("vFogColor")),a}fillDefines(E,b){let h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,bE.i)(this,this._scene,E),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&E.push("#define FOG")),this._isAnimationSheetEnabled&&E.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&E.push("#define LOGARITHMICDEPTH"),b===O.BLENDMODE_MULTIPLY&&E.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&E.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(E.push("#define BILLBOARD"),this.billboardMode){case 2:E.push("#define BILLBOARDY");break;case 8:case 9:E.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&E.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:E.push("#define BILLBOARDMODE_ALL")}h&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),E.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(E,b,h){b.push(...kE._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),E.push(...kE._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),h.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,aE.g)(E,this._imageProcessingConfigurationDefines),(0,aE.e)(h,this._imageProcessingConfigurationDefines))}_getWrapper(E){const b=this._getCustomDrawWrapper(E);if(null!==b&&void 0!==b&&b.effect)return b;const h=[];this.fillDefines(h,E);const a=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let k=this._drawWrappers[a];k||(k=this._drawWrappers[a]=[]);let G=k[E];G||(G=new EE.c(this._engine),G.drawContext&&(G.drawContext.useInstancing=this._useInstancing),k[E]=G);const V=h.join("\n");if(G.defines!==V){const E=[],b=[],h=[];this.fillUniformsAttributesAndSamplerNames(b,E,h),G.setEffect(this._engine.createEffect("particles",E,b,h,V,void 0,void 0,void 0,void 0,this._shaderLanguage),V)}return G}animate(){var E;let b,h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started){if(!h&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(h?this.preWarmStepOffset:(null===(E=this._scene)||void 0===E?void 0:E.getAnimationRatio())||1),this.manualEmitCount>-1)b=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let E=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const b=this._actualFrame/this.targetStopDuration;q.GetCurrentGradient(b,this._emitRateGradients,((b,h,a)=>{b!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=h.getFactor(),this._currentEmitRateGradient=b),E=(0,v.o)(this._currentEmitRate1,this._currentEmitRate2,a)}))}b=E*this._scaledUpdateSpeed|0,this._newPartsExcess+=E*this._scaledUpdateSpeed-b}if(this._newPartsExcess>1&&(b+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?b=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(b),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!h){let E=0;for(let b=0;b<this.Aj.length;b++){const h=this.Aj[b];this._appendParticleVertices(E,h),E+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Aj.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(E,b){this._appendParticleVertex(E++,b,0,0),this._useInstancing||(this._appendParticleVertex(E++,b,1,0),this._appendParticleVertex(E++,b,1,1),this._appendParticleVertex(E++,b,0,1))}rebuild(){var E;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(E=this._spriteBuffer)||void 0===E||E._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!kE.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(h.bind(h,11932)),Promise.resolve().then(h.bind(h,11866))])):await Promise.all([Promise.resolve().then(h.bind(h,11852)),Promise.resolve().then(h.bind(h,11835))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==O.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(O.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(O.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(E){const b=this._getWrapper(E),h=b.effect,k=this._engine;k.enableEffect(b);const G=this.defaultViewMatrix??this._scene.getViewMatrix();if(h.setTexture("diffuseSampler",this.particleTexture),h.setMatrix("view",G),h.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const E=this.particleTexture.getBaseSize();h.setFloat3("particlesInfos",this.spriteCellWidth/E.width,this.spriteCellHeight/E.height,this.spriteCellWidth/E.width)}if(h.setVector2("translationPivot",this.translationPivot),h.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const E=this._scene.activeCamera;h.setVector3("eyePosition",E.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),h.setTexture("rampSampler",this._rampGradientsTexture));const V=h.defines;var l,v,s,U,B,o;(this._scene&&((0,bE.f)(h,this,this._scene),this.applyFog&&(0,hE.f)(this._scene,void 0,h)),V.indexOf("#define BILLBOARDMODE_ALL")>=0&&(G.invertToRef(a.h.Matrix[0]),h.setMatrix("invView",a.h.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(l=this._scene)&&void 0!==l&&l.forceWireframe?k.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,h):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,h)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(v=this._scene)&&void 0!==v&&v.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?k.bindBuffers(this._vertexBuffers,null!==(s=this._scene)&&void 0!==s&&s.forceWireframe?this._linesIndexBuffer:this._indexBuffer,h):k.bindBuffers(this._vertexBuffers,null!==(U=this._scene)&&void 0!==U&&U.forceWireframe?this._linesIndexBufferUseInstancing:null,h);switch(this.useLogarithmicDepth&&this._scene&&(0,hE.m)(V,h,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(h),E){case O.BLENDMODE_ADD:k.setAlphaMode(1);break;case O.BLENDMODE_ONEONE:k.setAlphaMode(6);break;case O.BLENDMODE_STANDARD:k.setAlphaMode(2);break;case O.BLENDMODE_MULTIPLY:k.setAlphaMode(4)}(this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(h),this._useInstancing)?null!==(B=this._scene)&&void 0!==B&&B.forceWireframe?k.drawElementsType(6,0,10,this.Aj.length):k.drawArraysType(7,0,4,this.Aj.length):null!==(o=this._scene)&&void 0!==o&&o.forceWireframe?k.drawElementsType(1,0,10*this.Aj.length):k.drawElementsType(0,0,6*this.Aj.length);return this.Aj.length}render(){if(!this.isReady()||!this.Aj.length)return 0;const E=this._engine;E.setState&&(E.setState(!1),this.forceDepthWrite&&E.setDepthWrite(!0));let b=0;return b=this.blendMode===O.BLENDMODE_MULTIPLYADD?this._render(O.BLENDMODE_MULTIPLY)+this._render(O.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),b}_onDispose(){}dispose(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),E&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),E&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(b,h),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const E=this._scene.yj.indexOf(this);E>-1&&this._scene.yj.splice(E,1),this._scene._activeParticleSystems.dispose()}this.rj.notifyObservers(this),this.rj.clear(),this.onStoppedObservable.clear(),this.reset()}}kE.ForceGLSL=!1;var GE,VE=h(10855);!function(E){E[E.ATTACHED=0]="ATTACHED",E[E.END=1]="END"}(GE||(GE={}));class lE{constructor(E){if(this.particleSystem=E,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!E.j||!E.j.dispose){const b=(0,l.d)("BABYLON.AbstractMesh");E.j=new b("SubemitterSystemEmitter",E.va()),E._disposeEmitterOnDispose=!0}}clone(){let E=this.particleSystem.j;if(E){if(E instanceof a.k)E=E.clone();else if(-1!==E.getClassName().indexOf("Mesh")){E=new((0,l.d)("BABYLON.Mesh"))("",E.va()),E.isVisible=!1}}else E=new a.k;const b=new lE(this.particleSystem.clone(this.particleSystem.name,E));return b.particleSystem.name+="Clone",b.type=this.type,b.inheritDirection=this.inheritDirection,b.inheritedVelocityAmount=this.inheritedVelocityAmount,b.particleSystem._disposeEmitterOnDispose=!0,b.particleSystem.disposeOnStop=!0,b}serialize(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b={};return b.type=this.type,b.inheritDirection=this.inheritDirection,b.inheritedVelocityAmount=this.inheritedVelocityAmount,b.particleSystem=this.particleSystem.serialize(E),b}static _ParseParticleSystem(E,b,h){throw(0,VE.c)("ParseParticle")}static Parse(E,b,h){const a=E.particleSystem,k=new lE(lE._ParseParticleSystem(a,b,h,!0));return k.type=E.type,k.inheritDirection=E.inheritDirection,k.inheritedVelocityAmount=E.inheritedVelocityAmount,k.particleSystem._isSubEmitter=!0,k}dispose(){this.particleSystem.dispose()}}var OE=h(10902);function vE(E,b){const h=new S;return h.direction1=E,h.direction2=b,h}function sE(){return new g(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function UE(){return new M(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function BE(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new a.k(0,1,0),h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new a.k(0,1,0);return new I(E,b,h)}function oE(){return new u(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function uE(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new a.k(0,1,0),G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new a.k(0,1,0);return new D(E,b,h,k,G)}function DE(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new B(E,b)}function gE(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new a.k(0,1,0),k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new a.k(0,1,0);return new o(E,b,h,k)}class SE extends kE{constructor(){super(...arguments),this._disposeEmitterOnDispose=!1,this._emitFromParticle=E=>{if(!this._subEmitters||0===this._subEmitters.length)return;const b=Math.floor(Math.random()*this._subEmitters.length);this._subEmitters[b].forEach((b=>{if(1===b.type){const h=b.clone();E._inheritParticleInfoToSubEmitter(h),h.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(h.particleSystem),h.particleSystem.start()}}))}}createPointEmitter(E,b){const h=vE(E,b);return this.particleEmitterType=h,h}createHemisphericEmitter(){const E=sE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=E,E}createSphereEmitter(){const E=UE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=E,E}createDirectedSphereEmitter(){const E=BE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new a.k(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new a.k(0,1,0));return this.particleEmitterType=E,E}createCylinderEmitter(){const E=oE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=E,E}createDirectedCylinderEmitter(){const E=uE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new a.k(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new a.k(0,1,0));return this.particleEmitterType=E,E}createConeEmitter(){const E=DE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=E,E}createDirectedConeEmitter(){const E=gE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new a.k(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new a.k(0,1,0));return this.particleEmitterType=E,E}createBoxEmitter(E,b,h,a){const k=new U;return this.particleEmitterType=k,this.direction1=E,this.direction2=b,this.minEmitBox=h,this.maxEmitBox=a,k}_prepareSubEmitterInternalArray(){this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach((E=>{E instanceof SE?this._subEmitters.push([new lE(E)]):E instanceof lE?this._subEmitters.push([E]):E instanceof Array&&this._subEmitters.push(E)}))}_stopSubEmitters(){this.activeSubSystems&&(this.activeSubSystems.forEach((E=>{E.stop(!0)})),this.activeSubSystems=[])}_removeFromRoot(){if(!this._rootParticleSystem)return;const E=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==E&&this._rootParticleSystem.activeSubSystems.splice(E,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(E){E&&this._stopSubEmitters()}_prepareParticle(E){if(this._subEmitters&&this._subEmitters.length>0){const b=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];E._attachedSubEmitters=[],b.forEach((b=>{if(0===b.type){const h=b.clone();E._attachedSubEmitters.push(h),h.particleSystem.start()}}))}}_onDispose(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var h;(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),E)&&(null===(h=this.particles)||void 0===h||h.forEach((E=>{if(E._attachedSubEmitters)for(let b=E._attachedSubEmitters.length-1;b>=0;b-=1)E._attachedSubEmitters[b].dispose()})));if(b&&this.activeSubSystems)for(let a=this.activeSubSystems.length-1;a>=0;a-=1)this.activeSubSystems[a].dispose();if(this._subEmitters&&this._subEmitters.length){for(let E=0;E<this._subEmitters.length;E++)for(const b of this._subEmitters[E])b.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.j&&this.j.dispose&&this.j.dispose(!0)}static _Parse(E,b,h,k){let G;G=h instanceof OE.d?null:h;const O=(0,l.d)("BABYLON.Texture");if(O&&G&&(E.texture?b.particleTexture=O.Parse(E.texture,G,k):E.textureName&&(b.particleTexture=new O(k+E.textureName,G,!1,void 0===E.invertY||E.invertY),b.particleTexture.name=E.textureName)),E.emitterId||0===E.emitterId||void 0!==E.j?E.emitterId&&G?b.j=G.getLastMeshById(E.emitterId):b.j=a.k.jh(E.j):b.j=a.k.Zero(),b.isLocal=!!E.isLocal,void 0!==E.renderingGroupId&&(b.renderingGroupId=E.renderingGroupId),void 0!==E.isBillboardBased&&(b.isBillboardBased=E.isBillboardBased),void 0!==E.billboardMode&&(b.billboardMode=E.billboardMode),void 0!==E.useLogarithmicDepth&&(b.useLogarithmicDepth=E.useLogarithmicDepth),E.animations){for(let h=0;h<E.animations.length;h++){const a=E.animations[h],k=(0,l.d)("BABYLON.Animation");k&&b.animations.push(k.Parse(a))}b.beginAnimationOnStart=E.beginAnimationOnStart,b.beginAnimationFrom=E.beginAnimationFrom,b.beginAnimationTo=E.beginAnimationTo,b.beginAnimationLoop=E.beginAnimationLoop}if(E.autoAnimate&&G&&G.beginAnimation(b,E.autoAnimateFrom,E.autoAnimateTo,E.autoAnimateLoop,E.autoAnimateSpeed||1),b.startDelay=0|E.startDelay,b.minAngularSpeed=E.minAngularSpeed,b.maxAngularSpeed=E.maxAngularSpeed,b.minSize=E.minSize,b.maxSize=E.maxSize,E.minScaleX&&(b.minScaleX=E.minScaleX,b.maxScaleX=E.maxScaleX,b.minScaleY=E.minScaleY,b.maxScaleY=E.maxScaleY),void 0!==E.preWarmCycles&&(b.preWarmCycles=E.preWarmCycles,b.preWarmStepOffset=E.preWarmStepOffset),void 0!==E.minInitialRotation&&(b.minInitialRotation=E.minInitialRotation,b.maxInitialRotation=E.maxInitialRotation),b.minLifeTime=E.minLifeTime,b.maxLifeTime=E.maxLifeTime,b.minEmitPower=E.minEmitPower,b.maxEmitPower=E.maxEmitPower,b.emitRate=E.emitRate,b.gravity=a.k.jh(E.gravity),E.noiseStrength&&(b.noiseStrength=a.k.jh(E.noiseStrength)),b.color1=V.f.jh(E.color1),b.color2=V.f.jh(E.color2),b.colorDead=V.f.jh(E.colorDead),b.updateSpeed=E.updateSpeed,b.targetStopDuration=E.targetStopDuration,b.blendMode=E.blendMode,E.colorGradients)for(const a of E.colorGradients)b.addColorGradient(a.gradient,V.f.jh(a.color1),a.color2?V.f.jh(a.color2):void 0);if(E.rampGradients){for(const h of E.rampGradients)b.addRampGradient(h.gradient,V.b.jh(h.color));b.useRampGradients=E.useRampGradients}if(E.colorRemapGradients)for(const a of E.colorRemapGradients)b.addColorRemapGradient(a.gradient,void 0!==a.factor1?a.factor1:a.factor,a.factor2);if(E.alphaRemapGradients)for(const a of E.alphaRemapGradients)b.addAlphaRemapGradient(a.gradient,void 0!==a.factor1?a.factor1:a.factor,a.factor2);if(E.sizeGradients)for(const a of E.sizeGradients)b.addSizeGradient(a.gradient,void 0!==a.factor1?a.factor1:a.factor,a.factor2);if(E.angularSpeedGradients)for(const a of E.angularSpeedGradients)b.addAngularSpeedGradient(a.gradient,void 0!==a.factor1?a.factor1:a.factor,a.factor2);if(E.velocityGradients)for(const a of E.velocityGradients)b.addVelocityGradient(a.gradient,void 0!==a.factor1?a.factor1:a.factor,a.factor2);if(E.dragGradients)for(const a of E.dragGradients)b.addDragGradient(a.gradient,void 0!==a.factor1?a.factor1:a.factor,a.factor2);if(E.emitRateGradients)for(const a of E.emitRateGradients)b.addEmitRateGradient(a.gradient,void 0!==a.factor1?a.factor1:a.factor,a.factor2);if(E.startSizeGradients)for(const a of E.startSizeGradients)b.addStartSizeGradient(a.gradient,void 0!==a.factor1?a.factor1:a.factor,a.factor2);if(E.lifeTimeGradients)for(const a of E.lifeTimeGradients)b.addLifeTimeGradient(a.gradient,void 0!==a.factor1?a.factor1:a.factor,a.factor2);if(E.limitVelocityGradients){for(const h of E.limitVelocityGradients)b.addLimitVelocityGradient(h.gradient,void 0!==h.factor1?h.factor1:h.factor,h.factor2);b.limitVelocityDamping=E.limitVelocityDamping}if(E.noiseTexture&&G){const h=(0,l.d)("BABYLON.ProceduralTexture");b.noiseTexture=h.Parse(E.noiseTexture,G,k)}let v;if(E.particleEmitterType){switch(E.particleEmitterType.type){case"SphereParticleEmitter":v=new M;break;case"SphereDirectedParticleEmitter":v=new I;break;case"ConeEmitter":case"ConeParticleEmitter":v=new B;break;case"ConeDirectedParticleEmitter":v=new o;break;case"CylinderParticleEmitter":v=new u;break;case"CylinderDirectedParticleEmitter":v=new D;break;case"HemisphericParticleEmitter":v=new g;break;case"PointParticleEmitter":v=new S;break;case"MeshParticleEmitter":v=new A;break;case"CustomParticleEmitter":v=new j;break;default:v=new U}v.parse(E.particleEmitterType,G)}else v=new U,v.parse(E,G);b.particleEmitterType=v,b.startSpriteCellID=E.startSpriteCellID,b.endSpriteCellID=E.endSpriteCellID,b.spriteCellLoop=E.spriteCellLoop??!0,b.spriteCellWidth=E.spriteCellWidth,b.spriteCellHeight=E.spriteCellHeight,b.spriteCellChangeSpeed=E.spriteCellChangeSpeed,b.spriteRandomStartCell=E.spriteRandomStartCell,b.disposeOnStop=E.disposeOnStop??!1,b.manualEmitCount=E.manualEmitCount??-1}static Parse(E,b,h){let k=arguments.length>3&&void 0!==arguments[3]&&arguments[3],G=arguments.length>4?arguments[4]:void 0;const l=E.name;let O,v,s=null,U=null;if(b instanceof OE.d?O=b:(v=b,O=v.getEngine()),E.customShader&&O.createEffectForParticles){U=E.customShader;const b=U.shaderOptions.defines.length>0?U.shaderOptions.defines.join("\n"):"";s=O.createEffectForParticles(U.shaderPath.fragmentElement,U.shaderOptions.uniforms,U.shaderOptions.samplers,b)}const B=new SE(l,G||E.mb,b,s,E.isAnimationSheetEnabled);if(B.customShader=U,B._rootUrl=h,E.id&&(B.id=E.id),E.subEmitters){B.subEmitters=[];for(const a of E.subEmitters){const E=[];for(const k of a)E.push(lE.Parse(k,b,h));B.subEmitters.push(E)}}return SE._Parse(E,B,b,h),E.textureMask&&(B.textureMask=V.f.jh(E.textureMask)),E.og&&(B.og=a.k.jh(E.og)),E.preventAutoStart&&(B.preventAutoStart=E.preventAutoStart),k||B.preventAutoStart||B.start(),B}serialize(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b={};if(SE._Serialize(b,this,E),b.textureMask=this.textureMask.qj(),b.customShader=this.customShader,b.preventAutoStart=this.preventAutoStart,b.og=this.og.qj(),this.subEmitters){b.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const h of this._subEmitters){const a=[];for(const b of h)a.push(b.serialize(E));b.subEmitters.push(a)}}return b}static _Serialize(E,b,h){if(E.name=b.name,E.id=b.id,E.mb=b.getCapacity(),E.disposeOnStop=b.disposeOnStop,E.manualEmitCount=b.manualEmitCount,b.j.position){const h=b.j;E.emitterId=h.id}else{const h=b.j;E.j=h.qj()}b.particleEmitterType&&(E.particleEmitterType=b.particleEmitterType.serialize()),b.particleTexture&&(h?E.texture=b.particleTexture.serialize():(E.textureName=b.particleTexture.name,E.invertY=!!b.particleTexture._invertY)),E.isLocal=b.isLocal,f.e.AppendSerializedAnimations(b,E),E.beginAnimationOnStart=b.beginAnimationOnStart,E.beginAnimationFrom=b.beginAnimationFrom,E.beginAnimationTo=b.beginAnimationTo,E.beginAnimationLoop=b.beginAnimationLoop,E.startDelay=b.startDelay,E.renderingGroupId=b.renderingGroupId,E.isBillboardBased=b.isBillboardBased,E.billboardMode=b.billboardMode,E.minAngularSpeed=b.minAngularSpeed,E.maxAngularSpeed=b.maxAngularSpeed,E.minSize=b.minSize,E.maxSize=b.maxSize,E.minScaleX=b.minScaleX,E.maxScaleX=b.maxScaleX,E.minScaleY=b.minScaleY,E.maxScaleY=b.maxScaleY,E.minEmitPower=b.minEmitPower,E.maxEmitPower=b.maxEmitPower,E.minLifeTime=b.minLifeTime,E.maxLifeTime=b.maxLifeTime,E.emitRate=b.emitRate,E.gravity=b.gravity.qj(),E.noiseStrength=b.noiseStrength.qj(),E.color1=b.color1.qj(),E.color2=b.color2.qj(),E.colorDead=b.colorDead.qj(),E.updateSpeed=b.updateSpeed,E.targetStopDuration=b.targetStopDuration,E.blendMode=b.blendMode,E.preWarmCycles=b.preWarmCycles,E.preWarmStepOffset=b.preWarmStepOffset,E.minInitialRotation=b.minInitialRotation,E.maxInitialRotation=b.maxInitialRotation,E.startSpriteCellID=b.startSpriteCellID,E.spriteCellLoop=b.spriteCellLoop,E.endSpriteCellID=b.endSpriteCellID,E.spriteCellChangeSpeed=b.spriteCellChangeSpeed,E.spriteCellWidth=b.spriteCellWidth,E.spriteCellHeight=b.spriteCellHeight,E.spriteRandomStartCell=b.spriteRandomStartCell,E.isAnimationSheetEnabled=b.isAnimationSheetEnabled,E.useLogarithmicDepth=b.useLogarithmicDepth;const a=b.getColorGradients();if(a){E.colorGradients=[];for(const b of a){const h={gradient:b.gradient,color1:b.color1.qj()};b.color2?h.color2=b.color2.qj():h.color2=b.color1.qj(),E.colorGradients.push(h)}}const k=b.getRampGradients();if(k){E.rampGradients=[];for(const b of k){const h={gradient:b.gradient,color:b.color.qj()};E.rampGradients.push(h)}E.useRampGradients=b.useRampGradients}const G=b.getColorRemapGradients();if(G){E.colorRemapGradients=[];for(const b of G){const h={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?h.factor2=b.factor2:h.factor2=b.factor1,E.colorRemapGradients.push(h)}}const V=b.getAlphaRemapGradients();if(V){E.alphaRemapGradients=[];for(const b of V){const h={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?h.factor2=b.factor2:h.factor2=b.factor1,E.alphaRemapGradients.push(h)}}const l=b.getSizeGradients();if(l){E.sizeGradients=[];for(const b of l){const h={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?h.factor2=b.factor2:h.factor2=b.factor1,E.sizeGradients.push(h)}}const O=b.getAngularSpeedGradients();if(O){E.angularSpeedGradients=[];for(const b of O){const h={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?h.factor2=b.factor2:h.factor2=b.factor1,E.angularSpeedGradients.push(h)}}const v=b.getVelocityGradients();if(v){E.velocityGradients=[];for(const b of v){const h={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?h.factor2=b.factor2:h.factor2=b.factor1,E.velocityGradients.push(h)}}const s=b.getDragGradients();if(s){E.dragGradients=[];for(const b of s){const h={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?h.factor2=b.factor2:h.factor2=b.factor1,E.dragGradients.push(h)}}const U=b.getEmitRateGradients();if(U){E.emitRateGradients=[];for(const b of U){const h={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?h.factor2=b.factor2:h.factor2=b.factor1,E.emitRateGradients.push(h)}}const B=b.getStartSizeGradients();if(B){E.startSizeGradients=[];for(const b of B){const h={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?h.factor2=b.factor2:h.factor2=b.factor1,E.startSizeGradients.push(h)}}const o=b.getLifeTimeGradients();if(o){E.lifeTimeGradients=[];for(const b of o){const h={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?h.factor2=b.factor2:h.factor2=b.factor1,E.lifeTimeGradients.push(h)}}const u=b.getLimitVelocityGradients();if(u){E.limitVelocityGradients=[];for(const b of u){const h={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?h.factor2=b.factor2:h.factor2=b.factor1,E.limitVelocityGradients.push(h)}E.limitVelocityDamping=b.limitVelocityDamping}b.noiseTexture&&(E.noiseTexture=b.noiseTexture.serialize())}clone(E,b){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a={...this._customWrappers};let k=null;const G=this._engine;if(G.createEffectForParticles&&null!=this.customShader){k=this.customShader;const E=k.shaderOptions.defines.length>0?k.shaderOptions.defines.join("\n"):"",b=G.createEffectForParticles(k.shaderPath.fragmentElement,k.shaderOptions.uniforms,k.shaderOptions.samplers,E);a[0]?a[0].effect=b:this.setCustomEffect(b,0)}const V=this.serialize(h),l=SE.Parse(V,this._scene||this._engine,this._rootUrl);return l.name=E,l.customShader=k,l._customWrappers=a,void 0===b&&(b=this.j),this.noiseTexture&&(l.noiseTexture=this.noiseTexture.clone()),l.j=b,this.preventAutoStart||l.start(),l}}SE.BILLBOARDMODE_Y=2,SE.BILLBOARDMODE_ALL=7,SE.BILLBOARDMODE_STRETCHED=8,SE.BILLBOARDMODE_STRETCHED_LOCAL=9,lE._ParseParticleSystem=SE.Parse;var ME=h(11195),IE=h(11163),jE=h(11640);jE.b.prototype.createTransformFeedback=function(){const E=this._gl.createTransformFeedback();if(!E)throw new Error("Unable to create Transform Feedback");return E},jE.b.prototype.deleteTransformFeedback=function(E){this._gl.deleteTransformFeedback(E)},jE.b.prototype.bindTransformFeedback=function(E){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,E)},jE.b.prototype.beginTransformFeedback=function(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(E?this._gl.POINTS:this._gl.TRIANGLES)},jE.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},jE.b.prototype.setTranformFeedbackVaryings=function(E,b){this._gl.transformFeedbackVaryings(E,b,this._gl.INTERLEAVED_ATTRIBS)},jE.b.prototype.bindTransformFeedbackBuffer=function(E){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,E?E.underlyingResource:null)},jE.b.prototype.readTransformFeedbackBuffer=function(E){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,E)};const PE="clipPlaneFragmentDeclaration2",AE="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";c.d.IncludesShadersStore[PE]=AE;h(11731),h(11733),h(11737),h(11746),h(11754),h(11759),h(11764),h(11771);const nE="gpuRenderParticlesPixelShader",dE="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";c.d.ShadersStore[nE]=dE;const cE="clipPlaneVertexDeclaration2",zE="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";c.d.IncludesShadersStore[cE]=zE;h(11779),h(11787),h(11796),h(11804);const ZE="gpuRenderParticlesVertexShader",YE="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";c.d.ShadersStore[ZE]=YE;class rE extends O{static get IsSupported(){if(!i.b.LastCreatedEngine)return!1;const E=i.b.LastCreatedEngine.getCaps();return E.supportTransformFeedbacks||E.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(E){this._maxActiveParticleCount=Math.min(E,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(E){this.maxActiveParticleCount=E}createPointEmitter(E,b){const h=vE(E,b);return this.particleEmitterType=h,h}createHemisphericEmitter(){const E=sE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=E,E}createSphereEmitter(){const E=UE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=E,E}createDirectedSphereEmitter(){const E=BE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new a.k(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new a.k(0,1,0));return this.particleEmitterType=E,E}createCylinderEmitter(){const E=oE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=E,E}createDirectedCylinderEmitter(){const E=uE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new a.k(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new a.k(0,1,0));return this.particleEmitterType=E,E}createConeEmitter(){const E=DE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=E,E}createDirectedConeEmitter(){const E=gE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new a.k(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new a.k(0,1,0));return this.particleEmitterType=E,E}createBoxEmitter(E,b,h,a){const k=new U;return this.particleEmitterType=k,this.direction1=E,this.direction2=b,this.minEmitBox=h,this.maxEmitBox=a,k}isReady(){if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==SE.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(SE.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(SE.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";E?setTimeout((()=>{this.start(0)}),E):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var E;let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(E=this._customWrappers[b])||void 0===E?void 0:E.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[E]??this._customWrappers[0]}setCustomEffect(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[b]=new EE.c(this._engine),this._customWrappers[b].effect=E}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new R.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(E,b,h){return super._removeGradientAndTexture(E,b,h),this._releaseBuffers(),this}addColorGradient(E,b){this._colorGradients||(this._colorGradients=[]);const h=new T(E,b);return this._colorGradients.push(h),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(E&&this._colorGradients.sort(((E,b)=>E.gradient<b.gradient?-1:E.gradient>b.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(E){return this._removeGradientAndTexture(E,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const b in this._drawWrappers){var E;null===(E=this._drawWrappers[b].drawContext)||void 0===E||E.reset()}}_addFactorGradient(E,b,h){const a=new C(b,h);E.push(a),this._releaseBuffers()}addSizeGradient(E,b){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,E,b),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(E){return this._removeGradientAndTexture(E,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(E,b){if(!E)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&E.sort(((E,b)=>E.gradient<b.gradient?-1:E.gradient>b.gradient?1:0));const h=this;h[b]&&(h[b].dispose(),h[b]=null)}addAngularSpeedGradient(E,b){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,E,b),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(E){return this._removeGradientAndTexture(E,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(E,b){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,E,b),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(E){return this._removeGradientAndTexture(E,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(E,b){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,E,b),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(E){return this._removeGradientAndTexture(E,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(E,b){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,E,b),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(E){return this._removeGradientAndTexture(E,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(E){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(E,b,h){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,G=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(E),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.rj=new R.e,this.onStoppedObservable=new R.e,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._onBeforeDrawParticlesObservable=null,h&&"Scene"!==h.getClassName()?(this._engine=h,this.defaultProjectionMatrix=a.d.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=h||i.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.yj.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,l.d)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,l.d)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,l.d)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,l.d)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new EE.c(this._engine)},this._customWrappers[0].effect=k,this._drawWrappers={0:new EE.c(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(b=b??{}).randomTextureSize||delete b.randomTextureSize;const V={mb:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...b},O=b;isFinite(O)&&(V.mb=O),this._capacity=V.mb,this._maxActiveParticleCount=V.mb,this._currentActiveCount=0,this._isAnimationSheetEnabled=G,this.particleEmitterType=new U;const v=Math.min(this._engine.getCaps().maxTextureSize,V.randomTextureSize);let s=[];for(let a=0;a<v;++a)s.push(Math.random()),s.push(Math.random()),s.push(Math.random()),s.push(Math.random());this._randomTexture=new Q.d(new Float32Array(s),v,1,5,h,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,s=[];for(let a=0;a<v;++a)s.push(Math.random()),s.push(Math.random()),s.push(Math.random()),s.push(Math.random());this._randomTexture2=new Q.d(new Float32Array(s),v,1,5,h,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=v}_reset(){this._releaseBuffers()}_createVertexBuffers(E,b,h){const a={};a.position=b.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let k=3;a.age=b.createVertexBuffer("age",k,1,this._attributesStrideSize,!0),k+=1,a.size=b.createVertexBuffer("size",k,3,this._attributesStrideSize,!0),k+=3,a.life=b.createVertexBuffer("life",k,1,this._attributesStrideSize,!0),k+=1,k+=4,this.billboardMode===SE.BILLBOARDMODE_STRETCHED&&(a.direction=b.createVertexBuffer("direction",k,3,this._attributesStrideSize,!0)),k+=3,this._platform.alignDataInBuffer&&(k+=1),this.particleEmitterType instanceof j&&(k+=3,this._platform.alignDataInBuffer&&(k+=1)),this._colorGradientsTexture||(a.color=b.createVertexBuffer("color",k,4,this._attributesStrideSize,!0),k+=4),this._isBillboardBased||(a.initialDirection=b.createVertexBuffer("initialDirection",k,3,this._attributesStrideSize,!0),k+=3,this._platform.alignDataInBuffer&&(k+=1)),this.noiseTexture&&(a.noiseCoordinates1=b.createVertexBuffer("noiseCoordinates1",k,3,this._attributesStrideSize,!0),k+=3,this._platform.alignDataInBuffer&&(k+=1),a.noiseCoordinates2=b.createVertexBuffer("noiseCoordinates2",k,3,this._attributesStrideSize,!0),k+=3,this._platform.alignDataInBuffer&&(k+=1)),a.angle=b.createVertexBuffer("angle",k,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?k++:k+=2,this._isAnimationSheetEnabled&&(a.cellIndex=b.createVertexBuffer("cellIndex",k,1,this._attributesStrideSize,!0),k+=1,this.spriteRandomStartCell&&(a.cellStartOffset=b.createVertexBuffer("cellStartOffset",k,1,this._attributesStrideSize,!0),k+=1)),a.offset=h.createVertexBuffer("offset",0,2),a.uv=h.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(a),this._platform.createVertexBuffers(E,a),this.resetDrawCache()}_initialize(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!E)return;const b=this._engine,h=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof j&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const k=this.particleEmitterType instanceof j,G=a.h.o[0];let V=0;for(let a=0;a<this._capacity;a++)if(h.push(0),h.push(0),h.push(0),h.push(0),h.push(0),h.push(0),h.push(0),h.push(0),h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),k?(this.particleEmitterType.particleDestinationGenerator(a,null,G),h.push(G.x),h.push(G.y),h.push(G.z)):(h.push(0),h.push(0),h.push(0)),this._platform.alignDataInBuffer&&h.push(0),V+=16,k&&(this.particleEmitterType.particlePositionGenerator(a,null,G),h.push(G.x),h.push(G.y),h.push(G.z),this._platform.alignDataInBuffer&&h.push(0),V+=4),this._colorGradientsTexture||(h.push(0),h.push(0),h.push(0),h.push(0),V+=4),this.isBillboardBased||(h.push(0),h.push(0),h.push(0),this._platform.alignDataInBuffer&&h.push(0),V+=4),this.noiseTexture&&(h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),this._platform.alignDataInBuffer&&h.push(0),h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),this._platform.alignDataInBuffer&&h.push(0),V+=8),h.push(0),V+=1,this._angularSpeedGradientsTexture||(h.push(0),V+=1),this._isAnimationSheetEnabled&&(h.push(0),V+=1,this.spriteRandomStartCell&&(h.push(0),V+=1)),this._platform.alignDataInBuffer){let E=3-(V+3&3);for(V+=E;E-- >0;)h.push(0)}const l=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),O=this._platform.createParticleBuffer(h),v=this._platform.createParticleBuffer(h);this._buffer0=new P.d(b,O,!1,this._attributesStrideSize),this._buffer1=new P.d(b,v,!1,this._attributesStrideSize),this._spriteBuffer=new P.d(b,l,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let E=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(E+="\n#define BILLBOARD"),this._colorGradientsTexture&&(E+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(E+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(E+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(E+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(E+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(E+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(E+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(E+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(E+="\n#define NOISE"),this.isLocal&&(E+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===E||(this._cachedUpdateDefines=E,this._updateBuffer=this._platform.createUpdateBuffer(E)),this._platform.isUpdateBufferReady()}_getWrapper(E){const b=this._getCustomDrawWrapper(E);if(null!==b&&void 0!==b&&b.effect)return b;const h=[];this.fillDefines(h,E);let a=this._drawWrappers[E];a||(a=new EE.c(this._engine),a.drawContext&&(a.drawContext.useInstancing=!0),this._drawWrappers[E]=a);const k=h.join("\n");if(a.defines!==k){const E=[],b=[],h=[];this.fillUniformsAttributesAndSamplerNames(b,E,h),a.setEffect(this._engine.createEffect("gpuRenderParticles",E,b,h,k),k)}return a}static _GetAttributeNamesOrOptions(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const k=[P.g.PositionKind,"age","life","size","angle"];return E||k.push(P.g.ColorKind),b&&k.push("cellIndex"),h||k.push("initialDirection"),a&&k.push("direction"),k.push("offset",P.g.UVKind),k}static _GetEffectCreationOptions(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a=["emitterWM","og","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,bE.b)(a),E&&a.push("sheetInfos"),b&&a.push("logarithmicDepthConstant"),h&&(a.push("vFogInfos"),a.push("vFogColor")),a}fillDefines(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,bE.i)(this,this._scene,E),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==IE.e.FOGMODE_NONE&&E.push("#define FOG")),b===SE.BLENDMODE_MULTIPLY&&E.push("#define BLENDMULTIPLYMODE"),this.isLocal&&E.push("#define LOCAL"),this.useLogarithmicDepth&&E.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(E.push("#define BILLBOARD"),this.billboardMode){case SE.BILLBOARDMODE_Y:E.push("#define BILLBOARDY");break;case SE.BILLBOARDMODE_STRETCHED:E.push("#define BILLBOARDSTRETCHED");break;case SE.BILLBOARDMODE_ALL:E.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&E.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&E.push("#define ANIMATESHEET"),h&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),E.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(E,b,h){b.push(...rE._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===SE.BILLBOARDMODE_STRETCHED)),E.push(...rE._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),h.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(ME.d.PrepareUniforms(E,this._imageProcessingConfigurationDefines),ME.d.PrepareSamplers(h,this._imageProcessingConfigurationDefines))}animate(){var E;let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(b?this.preWarmStepOffset:(null===(E=this._scene)||void 0===E?void 0:E.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(E,b){const h=this[b];if(!E||!E.length||h)return;const a=new Float32Array(this._rawTextureWidth);for(let k=0;k<this._rawTextureWidth;k++){const b=k/this._rawTextureWidth;q.GetCurrentGradient(b,E,((E,b,h)=>{a[k]=(0,v.o)(E.factor1,b.factor1,h)}))}this[b]=Q.d.CreateRTexture(a,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[b].name=b.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const E=new Uint8Array(4*this._rawTextureWidth),b=V.j.ob[0];for(let h=0;h<this._rawTextureWidth;h++){const a=h/this._rawTextureWidth;q.GetCurrentGradient(a,this._colorGradients,((a,k,G)=>{V.f.LerpToRef(a.color1,k.color1,G,b),E[4*h]=255*b.r,E[4*h+1]=255*b.g,E[4*h+2]=255*b.b,E[4*h+3]=255*b.a}))}this._colorGradientsTexture=Q.d.CreateRGBATexture(E,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(E,b){var h,k,G,V;const l=this._getWrapper(E),O=l.effect;this._engine.enableEffect(l);const v=(null===(h=this._scene)||void 0===h?void 0:h.getViewMatrix())||a.d.IdentityReadOnly;if(O.setMatrix("view",v),O.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),O.setTexture("diffuseSampler",this.particleTexture),O.setVector2("translationPivot",this.translationPivot),O.setVector3("og",this.og),this.isLocal&&O.setMatrix("emitterWM",b),this._colorGradientsTexture?O.setTexture("colorGradientSampler",this._colorGradientsTexture):O.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const E=this.particleTexture.getBaseSize();O.setFloat3("sheetInfos",this.spriteCellWidth/E.width,this.spriteCellHeight/E.height,E.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const E=this._scene.activeCamera;O.setVector3("eyePosition",E.globalPosition)}const s=O.defines;if(this._scene&&((0,bE.f)(O,this,this._scene),this.applyFog&&(0,hE.f)(this._scene,void 0,O)),s.indexOf("#define BILLBOARDMODE_ALL")>=0){const E=v.clone();E.invert(),O.setMatrix("invView",E)}switch(this.useLogarithmicDepth&&this._scene&&(0,hE.m)(s,O,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(O),E){case SE.BLENDMODE_ADD:this._engine.setAlphaMode(1);break;case SE.BLENDMODE_ONEONE:this._engine.setAlphaMode(6);break;case SE.BLENDMODE_STANDARD:this._engine.setAlphaMode(2);break;case SE.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(4)}return this._platform.bindDrawBuffers(this._targetIndex,O,null!==(k=this._scene)&&void 0!==k&&k.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(O),null!==(G=this._scene)&&void 0!==G&&G.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(V=this._scene)&&void 0!==V&&V.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(E){if(!this.j||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!E)if(this.j.position){E=this.j.getWorldMatrix()}else{const b=this.j;E=a.h.Matrix[0],a.d.TranslationToRef(b.x,b.y,b.z,E)}this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this.isLocal||this._updateBuffer.setMatrix("emitterWM",E),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const b=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=b}render(){let E,b=arguments.length>0&&void 0!==arguments[0]&&arguments[0],h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!b&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let E=0;E<this.preWarmCycles;E++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){const E=0|this._accumulatedCount;this._accumulatedCount-=E,this._currentActiveCount+=E}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.j.position){E=this.j.getWorldMatrix()}else{const b=this.j;E=a.h.Matrix[0],a.d.TranslationToRef(b.x,b.y,b.z,E)}const k=this._engine;this.updateInAnimate||this._update(E);let G=0;return b||h||(k.setState(!1),this.forceDepthWrite&&k.setDepthWrite(!0),G=this.blendMode===SE.BLENDMODE_MULTIPLYADD?this._render(SE.BLENDMODE_MULTIPLY,E)+this._render(SE.BLENDMODE_ADD,E):this._render(this.blendMode,E),this._engine.setAlphaMode(0)),G}rebuild(){const E=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(E,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,E()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const b in this._drawWrappers){this._drawWrappers[b].dispose()}if(this._drawWrappers={},this._scene){const E=this._scene.yj.indexOf(this);E>-1&&this._scene.yj.splice(E,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let b=0;b<this._renderVertexBuffers.length;++b){const E=this._renderVertexBuffers[b];for(const b in E)E[b].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),E&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),E&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.rj.notifyObservers(this),this.rj.clear()}clone(E,b){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a={...this._customWrappers};let k=null;const G=this._engine;if(G.createEffectForParticles&&null!=this.customShader){k=this.customShader;const E=k.shaderOptions.defines.length>0?k.shaderOptions.defines.join("\n"):"";a[0]=G.createEffectForParticles(k.shaderPath.fragmentElement,k.shaderOptions.uniforms,k.shaderOptions.samplers,E,void 0,void 0,void 0,this)}const V=this.serialize(h),l=rE.Parse(V,this._scene||this._engine,this._rootUrl);return l.name=E,l.customShader=k,l._customWrappers=a,void 0===b&&(b=this.j),this.noiseTexture&&(l.noiseTexture=this.noiseTexture.clone()),l.j=b,l}serialize(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b={};return SE._Serialize(b,this,E),b.activeParticleCount=this.activeParticleCount,b.randomTextureSize=this._randomTextureSize,b.customShader=this.customShader,b}static Parse(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4?arguments[4]:void 0;const G=E.name;let V,l;b instanceof OE.d?V=b:(l=b,V=l.getEngine());const O=new rE(G,{mb:k||E.mb,randomTextureSize:E.randomTextureSize},b,null,E.isAnimationSheetEnabled);if(O._rootUrl=h,E.customShader&&V.createEffectForParticles){const b=E.customShader,h=b.shaderOptions.defines.length>0?b.shaderOptions.defines.join("\n"):"",a=V.createEffectForParticles(b.shaderPath.fragmentElement,b.shaderOptions.uniforms,b.shaderOptions.samplers,h,void 0,void 0,void 0,O);O.setCustomEffect(a,0),O.customShader=b}return E.id&&(O.id=E.id),E.activeParticleCount&&(O.activeParticleCount=E.activeParticleCount),SE._Parse(E,O,b,h),E.preventAutoStart&&(O.preventAutoStart=E.preventAutoStart),a||O.preventAutoStart||O.start(),O}}var wE=h(10821),NE=h(11812),HE=h(11121);class fE{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(E){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const b of this.systems)b.j=E;this._emitterNode=E}setEmitterAsSphere(E,b,h){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:E,renderingGroupId:b};const a=(0,NE.e)("emitterSphere",{diameter:E.diameter,segments:E.segments},h);a.renderingGroupId=b;const k=new HE.d("emitterSphereMaterial",h);k.emissiveColor=E.color,a.material=k;for(const G of this.systems)G.j=a;this._emitterNode=a}start(E){for(const b of this.systems)E&&(b.j=E),b.start()}dispose(){for(const E of this.systems)E.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b={systems:[]};for(const h of this.systems)b.systems.push(h.serialize(E));return this._emitterNode&&(b.j=this._emitterCreationOptions),b}static Parse(E,b){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0;const k=new fE,G=this.BaseAssetsUrl+"/textures/";b=b||i.b.LastCreatedScene;for(const V of E.systems)k.systems.push(h?rE.Parse(V,b,G,!0,a):SE.Parse(V,b,G,!0,a));if(E.j){const h=E.j.options;if("Sphere"===E.j.kind)k.setEmitterAsSphere({diameter:h.diameter,segments:h.segments,color:V.b.jh(h.color)},E.j.renderingGroupId,b)}return k}}fE.BaseAssetsUrl="https://assets.babylonjs.com/particles";var FE=h(10861);class yE{static CreateDefault(E){let b,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,a=arguments.length>2?arguments[2]:void 0;return b=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new rE("default system",{mb:h},a):new SE("default system",h,a),b.j=E,b.particleTexture=new F.b("https://assets.babylonjs.com/textures/flare.png",b.va()),b.createConeEmitter(.1,Math.PI/4),b.color1=new V.f(1,1,1,1),b.color2=new V.f(1,1,1,1),b.colorDead=new V.f(1,1,1,0),b.minSize=.1,b.maxSize=.1,b.minEmitPower=2,b.maxEmitPower=2,b.updateSpeed=1/60,b.emitRate=30,b}static CreateAsync(E,b){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0;b||(b=i.b.LastCreatedScene);const k={};return b.addPendingData(k),new Promise(((G,V)=>{if(h&&!rE.IsSupported)return b.removePendingData(k),V("Particle system with GPU is not supported.");wE.g.LoadFile(`${yE.BaseAssetsUrl}/systems/${E}.json`,(E=>{b.removePendingData(k);const V=JSON.parse(E.toString());return G(fE.Parse(V,b,h,a))}),void 0,void 0,void 0,(()=>(b.removePendingData(k),V(`An error occurred with the creation of your particle system. Check if your type '${E}' exists.`))))}))}static ExportSet(E){const b=new fE;for(const h of E)b.systems.push(h);return b}static ParseFromFileAsync(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",G=arguments.length>5?arguments[5]:void 0;return new Promise(((V,l)=>{const O=new FE.c;O.addEventListener("readystatechange",(()=>{if(4==O.readyState)if(200==O.status){const b=JSON.parse(O.responseText);let l;l=a?rE.Parse(b,h,k,!1,G):SE.Parse(b,h,k,!1,G),E&&(l.name=E),V(l)}else l("Unable to load the particle system")})),O.open("GET",b),O.send()}))}static ParseFromSnippetAsync(E,b){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",k=arguments.length>4?arguments[4]:void 0;if("_BLANK"===E){const E=this.CreateDefault(null);return E.start(),Promise.resolve(E)}return new Promise(((G,V)=>{const l=new FE.c;l.addEventListener("readystatechange",(()=>{if(4==l.readyState)if(200==l.status){const V=JSON.parse(JSON.parse(l.responseText).jsonPayload),O=JSON.parse(V.particleSystem);let v;v=h?rE.Parse(O,b,a,!1,k):SE.Parse(O,b,a,!1,k),v.snippetId=E,G(v)}else V("Unable to load the snippet "+E)})),l.open("GET",this.SnippetUrl+"/"+E.replace(/#/g,"/")),l.send()}))}}yE.BaseAssetsUrl=fE.BaseAssetsUrl,yE.SnippetUrl="https://snippet.babylonjs.com",yE.CreateFromSnippetAsync=yE.ParseFromSnippetAsync;var eE=h(11419),JE=h(11257),mE=h(11814);(0,mE.h)(JE.e.NAME_PARTICLESYSTEM,((E,b,h,a)=>{const k=(0,mE.k)(JE.e.NAME_PARTICLESYSTEM);if(k&&void 0!==E.yj&&null!==E.yj)for(let G=0,V=E.yj.length;G<V;G++){const V=E.yj[G];h.yj.push(k(V,b,a))}})),(0,mE.e)(JE.e.NAME_PARTICLESYSTEM,((E,b,h)=>{if(E.activeParticleCount){return rE.Parse(E,b,h)}return SE.Parse(E,b,h)})),OE.d.prototype.createEffectForParticles=function(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",G=arguments.length>4?arguments[4]:void 0,V=arguments.length>5?arguments[5]:void 0,l=arguments.length>6?arguments[6]:void 0,O=arguments.length>7?arguments[7]:void 0,v=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,s=[],U=[];const B=[];return O?O.fillUniformsAttributesAndSamplerNames(U,s,B):(s=SE._GetAttributeNamesOrOptions(),U=SE._GetEffectCreationOptions()),-1===k.indexOf(" BILLBOARD")&&(k+="\n#define BILLBOARD\n"),null!==O&&void 0!==O&&O.isAnimationSheetEnabled&&-1===k.indexOf(" ANIMATESHEET")&&(k+="\n#define ANIMATESHEET\n"),-1===a.indexOf("diffuseSampler")&&a.push("diffuseSampler"),this.createEffect({vertex:(null===O||void 0===O?void 0:O.vertexShaderName)??"particles",fragmentElement:E},s,U.concat(b),B.concat(a),k,G,V,l,void 0,v,(async()=>{0===v?await Promise.resolve().then(h.bind(h,11852)):await Promise.resolve().then(h.bind(h,11932))}))},eE.b.prototype.getEmittedParticleSystems=function(){const E=[];for(let b=0;b<this.va().yj.length;b++){const h=this.va().yj[b];h.j===this&&E.push(h)}return E},eE.b.prototype.getHierarchyEmittedParticleSystems=function(){const E=[],b=this.getDescendants();b.push(this);for(let h=0;h<this.va().yj.length;h++){const a=this.va().yj[h],k=a.j;k.position&&-1!==b.indexOf(k)&&E.push(a)}return E};h(11325),h(11335),h(11456);h(11435),h(11822),h(11466),h(11319),h(11473);h(11667);var KE;h(11828),h(11381);!function(E){E[E.Color=2]="Color",E[E.UV=1]="UV",E[E.Random=0]="Random",E[E.Stated=3]="Stated"}(KE||(KE={}));h(11835),h(11852),h(11866),h(11932)},11697:(E,b,h)=>{"use strict";h.d(b,{c:()=>u});var a=h(11130),k=h(11155),G=h(10824),V=h(11175),l=h(10905),O=h(11139),v=h(11206),s=h(10958),U=h(10902),B=h(10968),o=h(11706);U.d.prototype.setTextureFromPostProcess=function(E,b,h){var a;let k=null;b&&(b._forcedOutputTexture?k=b._forcedOutputTexture:b._textures.data[b._currentRenderTextureInd]&&(k=b._textures.data[b._currentRenderTextureInd])),this._bindTexture(E,(null===(a=k)||void 0===a?void 0:a.texture)??null,h)},U.d.prototype.setTextureFromPostProcessOutput=function(E,b,h){var a;this._bindTexture(E,(null===b||void 0===b||null===(a=b._outputTexture)||void 0===a?void 0:a.texture)??null,h)},l.b.prototype.setTextureFromPostProcess=function(E,b){this._engine.setTextureFromPostProcess(this._samplers[E],b,E)},l.b.prototype.setTextureFromPostProcessOutput=function(E,b){this._engine.setTextureFromPostProcessOutput(this._samplers[E],b,E)};class u{static get ForceGLSL(){return o.d.ForceGLSL}static set ForceGLSL(E){o.d.ForceGLSL=E}static RegisterShaderCodeProcessing(E,b){o.d.RegisterShaderCodeProcessing(E,b)}get name(){return this._effectWrapper.name}set name(E){this._effectWrapper.name=E}get alphaMode(){return this._effectWrapper.alphaMode}set alphaMode(E){this._effectWrapper.alphaMode=E}get samples(){return this._samples}set samples(E){this._samples=Math.min(E,this._engine.getCaps().maxMSAASamples),this._textures.forEach((E=>{E.setSamples(this._samples)}))}get shaderLanguage(){return this._shaderLanguage}getEffectName(){return this._fragmentUrl}set onActivate(E){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),E&&(this._onActivateObserver=this.onActivateObservable.add(E))}set onSizeChanged(E){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(E)}set onApply(E){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(E)}set onBeforeRender(E){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(E)}set onAfterRender(E){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(E)}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}set inputTexture(E){this._forcedOutputTexture=E}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}getCamera(){return this._camera}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.ue(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}constructor(E,b,h,a,l,O){var v;let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,U=arguments.length>7?arguments[7]:void 0,B=arguments.length>8?arguments[8]:void 0,D=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,g=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,S=arguments.length>11&&void 0!==arguments[11]?arguments[11]:"postprocess",M=arguments.length>12?arguments[12]:void 0,I=arguments.length>13&&void 0!==arguments[13]&&arguments[13],j=arguments.length>14&&void 0!==arguments[14]?arguments[14]:5,P=arguments.length>15?arguments[15]:void 0,A=arguments.length>16?arguments[16]:void 0;this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this._i=!0,this.forceAutoClearInAlphaMode=!1,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new k.e(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new V.j(1,1),this._texelSize=V.j.Zero(),this.onActivateObservable=new G.e,this.onSizeChangedObservable=new G.e,this.onApplyObservable=new G.e,this.onBeforeRenderObservable=new G.e,this.onAfterRenderObservable=new G.e;let n,d=1,c=null;if(h&&!Array.isArray(h)){const E=h;h=E.uniforms??null,a=E.samplers??null,d=E.size??1,O=E.camera??null,s=E.samplingMode??1,U=E.xd,B=E.reusable,D=Array.isArray(E.defines)?E.defines.join("\n"):E.defines??null,g=E.textureType??0,S=E.vertexUrl??"postprocess",M=E.indexParameters,I=E.blockCompilation??!1,j=E.textureFormat??5,P=E.shaderLanguage??0,c=E.uniformBuffers??null,A=E.extraInitializations,n=E.effectWrapper}else l&&(d="number"===typeof l?l:{width:l.width,height:l.height});const z=!!n;if(this._effectWrapper=n??new o.d({name:E,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:b,xd:U||(null===(v=O)||void 0===v?void 0:v.va().getEngine()),uniforms:h,samplers:a,uniformBuffers:c,defines:D,vertexUrl:S,indexParameters:M,blockCompilation:I,shaderLanguage:P,extraInitializations:A}),this.name=E,this.onEffectCreatedObservable=this._effectWrapper.onEffectCreatedObservable,null!=O?(this._camera=O,this._scene=O.va(),O.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):U&&(this._engine=U,this._engine.postProcesses.push(this)),this._options=d,this.renderTargetSamplingMode=s||1,this._reusable=B||!1,this._textureType=g,this._textureFormat=j,this._shaderLanguage=P||0,this._samplers=a||[],-1===this._samplers.indexOf("textureSampler")&&this._samplers.push("textureSampler"),this._fragmentUrl=b,this._vertexUrl=S,this._parameters=h||[],-1===this._parameters.indexOf("scale")&&this._parameters.push("scale"),this._uniformBuffers=c||[],this._indexParameters=M,!z){this._webGPUReady=1===this._shaderLanguage;const E=[];this._gatherImports(this._engine.isWebGPU&&!u.ForceGLSL,E),this._effectWrapper._webGPUReady=this._webGPUReady,this._effectWrapper._postConstructor(I,D,A,E)}}_gatherImports(){let E=arguments.length>1?arguments[1]:void 0;arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this._webGPUReady?E.push(Promise.all([h.e(37).then(h.bind(h,13375))])):E.push(Promise.all([Promise.resolve().then(h.bind(h,11713))]))}getClassName(){return"PostProcess"}getEngine(){return this._engine}getEffect(){return this._effectWrapper.drawWrapper.effect}shareOutputWith(E){return this._disposeTextures(),this._shareOutputWithPostProcess=E,this}useOwnOutput(){0==this._textures.length&&(this._textures=new k.e(2)),this._shareOutputWithPostProcess=null}updateEffect(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3?arguments[3]:void 0,k=arguments.length>4?arguments[4]:void 0,G=arguments.length>5?arguments[5]:void 0,V=arguments.length>6?arguments[6]:void 0,l=arguments.length>7?arguments[7]:void 0;this._effectWrapper.updateEffect(E,b,h,a,k,G,V,l),this._postProcessDefines=Array.isArray(this._effectWrapper.options.defines)?this._effectWrapper.options.defines.join("\n"):this._effectWrapper.options.defines}isReusable(){return this._reusable}markTextureDirty(){this.width=-1}_createRenderTargetTexture(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let k=0;k<this._textureCache.length;k++)if(this._textureCache[k].texture.width===E.width&&this._textureCache[k].texture.height===E.height&&this._textureCache[k].postProcessChannel===h&&this._textureCache[k].texture._generateDepthBuffer===b.generateDepthBuffer&&this._textureCache[k].texture.samples===b.samples)return this._textureCache[k].texture;const a=this._engine.createRenderTargetTexture(E,b);return this._textureCache.push({texture:a,postProcessChannel:h,lastUsedRenderId:-1}),a}_flushTextureCache(){const E=this._renderId;for(let b=this._textureCache.length-1;b>=0;b--)if(E-this._textureCache[b].lastUsedRenderId>100){let E=!1;for(let h=0;h<this._textures.length;h++)if(this._textures.data[h]===this._textureCache[b].texture){E=!0;break}E||(this._textureCache[b].texture.dispose(),this._textureCache.splice(b,1))}}resize(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._textures.length>0&&this._textures.reset(),this.width=E,this.height=b;let G=null;if(h)for(let O=0;O<h._postProcesses.length;O++)if(null!==h._postProcesses[O]){G=h._postProcesses[O];break}const V={width:this.width,height:this.height},l={generateMipMaps:a,generateDepthBuffer:k||G===this,generateStencilBuffer:(k||G===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(V,l,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(V,l,1)),this._texelSize.ue(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}_getTarget(){let E;if(this._shareOutputWithPostProcess)E=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)E=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{let b;E=this.inputTexture;for(let h=0;h<this._textureCache.length;h++)if(this._textureCache[h].texture===E){b=this._textureCache[h];break}b&&(b.lastUsedRenderId=this._renderId)}return E}activate(E){var b,h;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,k=arguments.length>2?arguments[2]:void 0;const G=(E=E||this._camera).va(),V=G.getEngine(),l=V.getCaps().maxTextureSize,O=(a?a.width:this._engine.getRenderWidth(!0))*this._options|0,v=(a?a.height:this._engine.getRenderHeight(!0))*this._options|0;let s=this._options.width||O,U=this._options.height||v;const o=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;let u=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){const E=V.currentViewport;E&&(s*=E.width,U*=E.height)}(o||this.alwaysForcePOT)&&(this._options.width||(s=V.needPOTTextures?(0,B.f)(s,l,this.scaleMode):s),this._options.height||(U=V.needPOTTextures?(0,B.f)(U,l,this.scaleMode):U)),this.width===s&&this.height===U&&(u=this._getTarget())||this.resize(s,U,E,o,k),this._textures.forEach((E=>{E.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(E,this.samples)})),this._flushTextureCache(),this._renderId++}return u||(u=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.ue(O/s,v/U),this._engine.bindFramebuffer(u,0,O,v,this.forceFullscreenViewport)):(this._scaleRatio.ue(1,1),this._engine.bindFramebuffer(u,0,void 0,void 0,this.forceFullscreenViewport)),null===(b=(h=this._engine)._debugInsertMarker)||void 0===b||b.call(h,`post process ${this.name} input`),this.onActivateObservable.notifyObservers(E),this._i&&(0===this.alphaMode||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:G.clearColor,G._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),u}get isSupported(){return this._effectWrapper.drawWrapper.effect.isSupported}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}isReady(){return this._effectWrapper.isReady()}apply(){if(!this._effectWrapper.isReady())return null;let E;var b;(this._engine.enableEffect(this._effectWrapper.drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),E=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding)||this._effectWrapper.drawWrapper.effect._bindTexture("textureSampler",null===(b=E)||void 0===b?void 0:b.texture);return this._effectWrapper.drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effectWrapper.drawWrapper.effect),this._effectWrapper.bind(),this._effectWrapper.drawWrapper.effect}_disposeTextures(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())}_disposeTextureCache(){for(let E=this._textureCache.length-1;E>=0;E--)this._textureCache[E].texture.dispose();this._textureCache.length=0}setPrePassRenderer(E){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=E.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)}dispose(E){let b;if(E=E||this._camera,this._disposeTextures(),this._scene&&(b=this._scene.postProcesses.indexOf(this),-1!==b&&this._scene.postProcesses.splice(b,1)),this._parentContainer){const E=this._parentContainer.postProcesses.indexOf(this);E>-1&&this._parentContainer.postProcesses.splice(E,1),this._parentContainer=null}if(b=this._engine.postProcesses.indexOf(this),-1!==b&&this._engine.postProcesses.splice(b,1),E){if(E.detachPostProcess(this),b=E._postProcesses.indexOf(this),0===b&&E._postProcesses.length>0){const E=this._camera._getFirstPostProcess();E&&E.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}}serialize(){const E=v.e.Serialize(this),b=this.getCamera()||this._scene&&this._scene.activeCamera;return E.customType="BABYLON."+this.getClassName(),E.cameraId=b?b.id:null,E.reusable=this._reusable,E.textureType=this._textureType,E.fragmentUrl=this._fragmentUrl,E.parameters=this._parameters,E.samplers=this._samplers,E.uniformBuffers=this._uniformBuffers,E.options=this._options,E.defines=this._postProcessDefines,E.textureFormat=this._textureFormat,E.vertexUrl=this._vertexUrl,E.indexParameters=this._indexParameters,E}clone(){const E=this.serialize();E._engine=this._engine,E.cameraId=null;const b=u.Parse(E,this._scene,"");return b?(b.onActivateObservable=this.onActivateObservable.clone(),b.onSizeChangedObservable=this.onSizeChangedObservable.clone(),b.onApplyObservable=this.onApplyObservable.clone(),b.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),b.onAfterRenderObservable=this.onAfterRenderObservable.clone(),b._prePassEffectConfiguration=this._prePassEffectConfiguration,b):null}static Parse(E,b,h){const a=(0,s.d)(E.customType);if(!a||!a._Parse)return null;const k=b?b.getCameraById(E.cameraId):null;return a._Parse(E,k,b,h)}static _Parse(E,b,h,a){return v.e.Parse((()=>new u(E.name,E.fragmentUrl,E.parameters,E.samplers,E.options,b,E.renderTargetSamplingMode,E._engine,E.reusable,E.defines,E.textureType,E.vertexUrl,E.indexParameters,!1,E.textureFormat)),E,h,a)}}(0,a.d)([(0,O.H)()],u.prototype,"uniqueId",void 0),(0,a.d)([(0,O.H)()],u.prototype,"name",null),(0,a.d)([(0,O.H)()],u.prototype,"width",void 0),(0,a.d)([(0,O.H)()],u.prototype,"height",void 0),(0,a.d)([(0,O.H)()],u.prototype,"renderTargetSamplingMode",void 0),(0,a.d)([(0,O.k)()],u.prototype,"clearColor",void 0),(0,a.d)([(0,O.H)()],u.prototype,"_i",void 0),(0,a.d)([(0,O.H)()],u.prototype,"forceAutoClearInAlphaMode",void 0),(0,a.d)([(0,O.H)()],u.prototype,"alphaMode",null),(0,a.d)([(0,O.H)()],u.prototype,"alphaConstants",void 0),(0,a.d)([(0,O.H)()],u.prototype,"enablePixelPerfectMode",void 0),(0,a.d)([(0,O.H)()],u.prototype,"forceFullscreenViewport",void 0),(0,a.d)([(0,O.H)()],u.prototype,"scaleMode",void 0),(0,a.d)([(0,O.H)()],u.prototype,"alwaysForcePOT",void 0),(0,a.d)([(0,O.H)("samples")],u.prototype,"_samples",void 0),(0,a.d)([(0,O.H)()],u.prototype,"adaptScaleToCurrentViewport",void 0),(0,s.f)("BABYLON.PostProcess",u)},11247:(E,b,h)=>{"use strict";h.d(b,{d:()=>G});var a=h(11233),k=h(10824);class G{constructor(E){this._vertexBuffers={},this.onBeforeRenderObservable=new k.e,this._scene=E}_prepareBuffers(){if(this._vertexBuffers[a.g.PositionKind])return;const E=[];E.push(1,1),E.push(-1,1),E.push(-1,-1),E.push(1,-1),this._vertexBuffers[a.g.PositionKind]=new a.g(this._scene.getEngine(),E,a.g.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const E=[];E.push(0),E.push(1),E.push(2),E.push(0),E.push(2),E.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(E)}_rebuild(){const E=this._vertexBuffers[a.g.PositionKind];E&&(E._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=this._scene.activeCamera;return!!h&&(b=b||h._postProcesses.filter((E=>null!=E)),!(!b||0===b.length||!this._scene.postProcessesEnabled)&&(b[0].activate(h,E,null!==b&&void 0!==b),!0))}directRender(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,G=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const V=this._scene.getEngine();for(let O=0;O<E.length;O++){var l;if(O<E.length-1)E[O+1].activate(this._scene.activeCamera,null===b||void 0===b?void 0:b.texture);else b?V.bindFramebuffer(b,a,void 0,void 0,h,k):G||V.restoreDefaultFramebuffer(),null===(l=V._debugInsertMarker)||void 0===l||l.call(V,`post process ${E[O].name} output`);const v=E[O],s=v.apply();s&&(v.onBeforeRenderObservable.notifyObservers(s),this._prepareBuffers(),V.bindBuffers(this._vertexBuffers,this._indexBuffer,s),V.drawElementsType(0,0,6),v.onAfterRenderObservable.notifyObservers(s))}V.setDepthBuffer(!0),V.setDepthWrite(!0)}_finalizeFrame(E,b,h,a){let k=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const G=this._scene.activeCamera;if(!G)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(a=a||G._postProcesses.filter((E=>null!=E))).length||!this._scene.postProcessesEnabled)return;const V=this._scene.getEngine();for(let O=0,v=a.length;O<v;O++){const s=a[O];var l;if(O<v-1)s._outputTexture=a[O+1].activate(G,null===b||void 0===b?void 0:b.texture);else b?(V.bindFramebuffer(b,h,void 0,void 0,k),s._outputTexture=b):(V.restoreDefaultFramebuffer(),s._outputTexture=null),null===(l=V._debugInsertMarker)||void 0===l||l.call(V,`post process ${a[O].name} output`);if(E)break;const U=s.apply();U&&(s.onBeforeRenderObservable.notifyObservers(U),this._prepareBuffers(),V.bindBuffers(this._vertexBuffers,this._indexBuffer,U),V.drawElementsType(0,0,6),s.onAfterRenderObservable.notifyObservers(U))}V.setDepthBuffer(!0),V.setDepthWrite(!0),V.setAlphaMode(0)}dispose(){const E=this._vertexBuffers[a.g.PositionKind];E&&(E.dispose(),this._vertexBuffers[a.g.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11254:(E,b,h)=>{"use strict";h.d(b,{b:()=>l});var a=h(11155),k=h(11175);class G{set opaqueSortCompareFn(E){this._opaqueSortCompareFn=E||G.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(E){this._alphaTestSortCompareFn=E||G.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(E){this._transparentSortCompareFn=E||G.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=E,this._opaqueSubMeshes=new a.e(256),this._transparentSubMeshes=new a.e(256),this._alphaTestSubMeshes=new a.e(256),this._depthOnlySubMeshes=new a.e(256),this._particleSystems=new a.e(256),this._spriteManagers=new a.e(256),this._empty=!0,this._edgesRenderers=new a.d(16),this._scene=b,this.opaqueSortCompareFn=h,this.alphaTestSortCompareFn=k,this.transparentSortCompareFn=G}render(E,b,h,a){if(E)return void E(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const k=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(k.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),k.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const G=k.getStencilBuffer();if(k.setStencilBuffer(!1),b&&this._renderSprites(),h&&this._renderParticles(a),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(k.setStencilBuffer(G),this._scene.useOrderIndependentTransparency){const E=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);E.length&&this._renderTransparent(E)}else this._renderTransparent(this._transparentSubMeshes);k.setAlphaMode(0)}if(k.setStencilBuffer(!1),this._edgesRenderers.length){for(let E=0;E<this._edgesRenderers.length;E++)this._edgesRenderers.data[E].render();k.setAlphaMode(0)}k.setStencilBuffer(G)}_renderOpaqueSorted(E){G._RenderSorted(E,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(E){G._RenderSorted(E,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(E){G._RenderSorted(E,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(E,b,h,a){let V,l=0;const O=h?h.globalPosition:G._ZeroVector;if(a)for(;l<E.length;l++)V=E.data[l],V._alphaIndex=V.getMesh().alphaIndex,V._distanceToCamera=k.k.Distance(V.getBoundingInfo().boundingSphere.centerWorld,O);const v=E.length===E.data.length?E.data:E.data.slice(0,E.length);b&&v.sort(b);const s=v[0].getMesh().va();for(l=0;l<v.length;l++)if(V=v[l],!s._activeMeshesFrozenButKeepClipping||V.isInFrustum(s._frustumPlanes)){if(a){const E=V.Ha();if(E&&E.needDepthPrePass){const b=E.va().getEngine();b.setColorWrite(!1),b.setAlphaMode(0),V.render(!1),b.setColorWrite(!0)}}V.render(a)}}static defaultTransparentSortCompare(E,b){return E._alphaIndex>b._alphaIndex?1:E._alphaIndex<b._alphaIndex?-1:G.backToFrontSortCompare(E,b)}static backToFrontSortCompare(E,b){return E._distanceToCamera<b._distanceToCamera?1:E._distanceToCamera>b._distanceToCamera?-1:0}static frontToBackSortCompare(E,b){return E._distanceToCamera<b._distanceToCamera?-1:E._distanceToCamera>b._distanceToCamera?1:0}static PainterSortCompare(E,b){const h=E.getMesh(),a=b.getMesh();return h.material&&a.material?h.material.uniqueId-a.material.uniqueId:h.uniqueId-a.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(E,b,h){void 0===b&&(b=E.getMesh()),void 0===h&&(h=E.Ha()),null!==h&&void 0!==h&&(h.needAlphaBlendingForMesh(b)?this._transparentSubMeshes.push(E):h.needAlphaTesting()?(h.needDepthPrePass&&this._depthOnlySubMeshes.push(E),this._alphaTestSubMeshes.push(E)):(h.needDepthPrePass&&this._depthOnlySubMeshes.push(E),this._opaqueSubMeshes.push(E)),b._renderingGroup=this,b._edgesRenderer&&b.isEnabled()&&b.isVisible&&b._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(b._edgesRenderer),this._empty=!1)}dispatchSprites(E){this._spriteManagers.push(E),this._empty=!1}dispatchParticles(E){this._particleSystems.push(E),this._empty=!1}_renderParticles(E){if(0===this._particleSystems.length)return;const b=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let h=0;h<this._particleSystems.length;h++){const a=this._particleSystems.data[h];if(0===(b&&b.layerMask&a.layerMask))continue;const k=a.j;k.position&&E&&-1===E.indexOf(k)||this._scene._activeParticles.addCount(a.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const E=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let b=0;b<this._spriteManagers.length;b++){const h=this._spriteManagers.data[b];0!==(E&&E.layerMask&h.layerMask)&&h.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}G._ZeroVector=k.k.Zero();class V{}class l{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(E){E!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=E,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const E of this._scene.meshes)if(E.wg)for(const b of E.wg)b._wasDispatched=!1;if(this._scene.spriteManagers)for(const E of this._scene.spriteManagers)E._wasDispatched=!1;for(const E of this._scene.yj)E._wasDispatched=!1}constructor(E){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new V,this._maintainStateBetweenFrames=!1,this._scene=E;for(let b=l.MIN_RENDERINGGROUPS;b<l.MAX_RENDERINGGROUPS;b++)this._autoClearDepthStencil[b]={_i:!0,depth:!0,stencil:!0}}getRenderingGroup(E){const b=E||0;return this._prepareRenderingGroup(b),this._renderingGroups[b]}_clearDepthStencilBuffer(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,E,b),this._depthStencilBufferAlreadyCleaned=!0)}render(E,b,h,a){const k=this._renderingGroupInfo;if(k.Xd=this._scene,k.camera=this._scene.activeCamera,this._scene.spriteManagers&&a)for(let G=0;G<this._scene.spriteManagers.length;G++){const E=this._scene.spriteManagers[G];this.dispatchSprites(E)}for(let G=l.MIN_RENDERINGGROUPS;G<l.MAX_RENDERINGGROUPS;G++){this._depthStencilBufferAlreadyCleaned=G===l.MIN_RENDERINGGROUPS;const V=this._renderingGroups[G];if(!V||V._empty)continue;const O=1<<G;if(k.renderingGroupId=G,this._scene.onBeforeRenderingGroupObservable.notifyObservers(k,O),l.AUTOCLEAR){const E=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(G):this._autoClearDepthStencil[G];E&&E._i&&this._clearDepthStencilBuffer(E.depth,E.stencil)}for(const E of this._scene._beforeRenderingGroupDrawStage)E.action(G);V.render(E,a,h,b);for(const E of this._scene._afterRenderingGroupDrawStage)E.action(G);this._scene.onAfterRenderingGroupObservable.notifyObservers(k,O)}}reset(){if(!this.maintainStateBetweenFrames)for(let E=l.MIN_RENDERINGGROUPS;E<l.MAX_RENDERINGGROUPS;E++){const b=this._renderingGroups[E];b&&b.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let E=l.MIN_RENDERINGGROUPS;E<l.MAX_RENDERINGGROUPS;E++){const b=this._renderingGroups[E];b&&b.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let E=l.MIN_RENDERINGGROUPS;E<l.MAX_RENDERINGGROUPS;E++){const b=this._renderingGroups[E];b&&b.dispose()}}_prepareRenderingGroup(E){void 0===this._renderingGroups[E]&&(this._renderingGroups[E]=new G(E,this._scene,this._customOpaqueSortCompareFn[E],this._customAlphaTestSortCompareFn[E],this._customTransparentSortCompareFn[E]))}dispatchSprites(E){this.maintainStateBetweenFrames&&E._wasDispatched||(E._wasDispatched=!0,this.getRenderingGroup(E.renderingGroupId).dispatchSprites(E))}dispatchParticles(E){this.maintainStateBetweenFrames&&E._wasDispatched||(E._wasDispatched=!0,this.getRenderingGroup(E.renderingGroupId).dispatchParticles(E))}dispatch(E,b,h){void 0===b&&(b=E.getMesh()),this.maintainStateBetweenFrames&&E._wasDispatched||(E._wasDispatched=!0,this.getRenderingGroup(b.renderingGroupId).dispatch(E,b,h))}setRenderingOrder(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[E]=b,this._customAlphaTestSortCompareFn[E]=h,this._customTransparentSortCompareFn[E]=a,this._renderingGroups[E]){const b=this._renderingGroups[E];b.opaqueSortCompareFn=this._customOpaqueSortCompareFn[E],b.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[E],b.transparentSortCompareFn=this._customTransparentSortCompareFn[E]}}setRenderingAutoClearDepthStencil(E,b){let h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[E]={_i:b,depth:h,stencil:a}}getAutoClearDepthStencilSetup(E){return this._autoClearDepthStencil[E]}}l.MAX_RENDERINGGROUPS=4,l.MIN_RENDERINGGROUPS=0,l.AUTOCLEAR=!0},11911:(E,b,h)=>{"use strict";const a="clipPlaneFragment",k="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";h(10912).d.IncludesShadersStoreWGSL[a]=k},11870:(E,b,h)=>{"use strict";const a="clipPlaneFragmentDeclaration",k="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";h(10912).d.IncludesShadersStoreWGSL[a]=k},11950:(E,b,h)=>{"use strict";const a="clipPlaneVertex",k="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";h(10912).d.IncludesShadersStoreWGSL[a]=k},11934:(E,b,h)=>{"use strict";const a="clipPlaneVertexDeclaration",k="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";h(10912).d.IncludesShadersStoreWGSL[a]=k},11925:(E,b,h)=>{"use strict";const a="fogFragment",k="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";h(10912).d.IncludesShadersStoreWGSL[a]=k},11902:(E,b,h)=>{"use strict";const a="fogFragmentDeclaration",k="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";h(10912).d.IncludesShadersStoreWGSL[a]=k},11955:(E,b,h)=>{"use strict";const a="fogVertex",k="#ifdef FOG\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#endif\n";h(10912).d.IncludesShadersStoreWGSL[a]=k},11942:(E,b,h)=>{"use strict";const a="fogVertexDeclaration",k="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";h(10912).d.IncludesShadersStoreWGSL[a]=k},11892:(E,b,h)=>{"use strict";const a="helperFunctions",k="const PI: f32=3.1415926535897932384626433832795;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3<f32>=vec3<f32> (0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(0.0),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);} \nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3<f32>=inMatrix[0];let i1: vec3<f32>=inMatrix[1];let i2: vec3<f32>=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=0.0773993808*color;let remainingSection: vec3<f32>=pow(0.947867299*(color+vec3<f32>(0.055)),vec3<f32>(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.04045)));}\nfn toGammaSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=12.92*color;let remainingSection: vec3<f32>=1.055*pow(color,vec3<f32>(0.41666))-vec3<f32>(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3<f32>(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3<f32>)->vec3<f32>\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3<f32>)->f32\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3<f32>)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3<f32> =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(clamp(rgb,vec3<f32>(0.,0.,0.),vec3<f32>(1.,1.,1.)),D); }\nfn fromRGBD(rgbd: vec4<f32>)->vec3<f32> {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3<f32>,origVec: vec3<f32>,cubeSize: vec3<f32>,cubePos: vec3<f32>)->vec3<f32> {let invOrigVec: vec3<f32>=vec3<f32>(1.0,1.0,1.0)/origVec;let halfSize: vec3<f32>=cubeSize*0.5;let intersecAtMaxPlane: vec3<f32>=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3<f32>=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3<f32>=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3<f32>=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";h(10912).d.IncludesShadersStoreWGSL[a]=k},11874:(E,b,h)=>{"use strict";const a="imageProcessingDeclaration",k="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";h(10912).d.IncludesShadersStoreWGSL[a]=k},11899:(E,b,h)=>{"use strict";const a="imageProcessingFunctions",k="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";h(10912).d.IncludesShadersStoreWGSL[a]=k},11883:(E,b,h)=>{"use strict";const a="logDepthDeclaration",k="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";h(10912).d.IncludesShadersStoreWGSL[a]=k},11920:(E,b,h)=>{"use strict";const a="logDepthFragment",k="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";h(10912).d.IncludesShadersStoreWGSL[a]=k},11958:(E,b,h)=>{"use strict";const a="logDepthVertex",k="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";h(10912).d.IncludesShadersStoreWGSL[a]=k},11866:(E,b,h)=>{"use strict";h.r(b),h.d(b,{particlesPixelShaderWGSL:()=>V});var a=h(10912);h(11870),h(11874),h(11883),h(11892),h(11899),h(11902),h(11911),h(11920),h(11925);const k="particlesPixelShader",G="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";a.d.ShadersStoreWGSL[k]=G;const V={name:k,shader:G}},11932:(E,b,h)=>{"use strict";h.r(b),h.d(b,{particlesVertexShaderWGSL:()=>V});var a=h(10912);h(11934),h(11942),h(11883),h(11950),h(11955),h(11958);const k="particlesVertexShader",G="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return input.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";a.d.ShadersStoreWGSL[k]=G;const V={name:k,shader:G}},11759:(E,b,h)=>{"use strict";const a="clipPlaneFragment",k="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";h(10912).d.IncludesShadersStore[a]=k},11843:(E,b,h)=>{"use strict";const a="clipPlaneFragmentDeclaration",k="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";h(10912).d.IncludesShadersStore[a]=k},11787:(E,b,h)=>{"use strict";const a="clipPlaneVertex",k="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";h(10912).d.IncludesShadersStore[a]=k},11859:(E,b,h)=>{"use strict";const a="clipPlaneVertexDeclaration",k="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";h(10912).d.IncludesShadersStore[a]=k},11771:(E,b,h)=>{"use strict";const a="fogFragment",k="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";h(10912).d.IncludesShadersStore[a]=k},11754:(E,b,h)=>{"use strict";const a="fogFragmentDeclaration",k="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";h(10912).d.IncludesShadersStore[a]=k},11796:(E,b,h)=>{"use strict";const a="fogVertex",k="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";h(10912).d.IncludesShadersStore[a]=k},11779:(E,b,h)=>{"use strict";const a="fogVertexDeclaration",k="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";h(10912).d.IncludesShadersStore[a]=k},11737:(E,b,h)=>{"use strict";const a="helperFunctions",k="const float PI=3.1415926535897932384626433832795;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.0;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(clamp(rgb,0.,1.),D); }\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";h(10912).d.IncludesShadersStore[a]=k},11731:(E,b,h)=>{"use strict";const a="imageProcessingDeclaration",k="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";h(10912).d.IncludesShadersStore[a]=k},11746:(E,b,h)=>{"use strict";const a="imageProcessingFunctions",k="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";h(10912).d.IncludesShadersStore[a]=k},11733:(E,b,h)=>{"use strict";const a="logDepthDeclaration",k="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";h(10912).d.IncludesShadersStore[a]=k},11764:(E,b,h)=>{"use strict";const a="logDepthFragment",k="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";h(10912).d.IncludesShadersStore[a]=k},11804:(E,b,h)=>{"use strict";const a="logDepthVertex",k="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";h(10912).d.IncludesShadersStore[a]=k},11835:(E,b,h)=>{"use strict";h.r(b),h.d(b,{particlesPixelShader:()=>V});var a=h(10912);h(11843),h(11731),h(11733),h(11737),h(11746),h(11754),h(11759),h(11764),h(11771);const k="particlesPixelShader",G="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";a.d.ShadersStore[k]=G;const V={name:k,shader:G}},11852:(E,b,h)=>{"use strict";h.r(b),h.d(b,{particlesVertexShader:()=>V});var a=h(10912);h(11859),h(11779),h(11733),h(11787),h(11796),h(11804);const k="particlesVertexShader",G="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";a.d.ShadersStore[k]=G;const V={name:k,shader:G}},11713:(E,b,h)=>{"use strict";h.r(b),h.d(b,{postprocessVertexShader:()=>G});const a="postprocessVertexShader",k="attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";h(10912).d.ShadersStore[a]=k;const G={name:a,shader:k}},11273:(E,b,h)=>{"use strict";h.d(b,{d:()=>a});class a{}a._IsPickingAvailable=!1},11429:(E,b,h)=>{"use strict";h.d(b,{d:()=>U});var a=h(11130),k=h(11175),G=h(11139),V=h(10824),l=h(10869),O=h(10855),v=h(11206);class s{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new V.e,this._onClonedObservable=new V.e}}class U{static AddNodeConstructor(E,b){this._NodeConstructors[E]=b}static Construct(E,b,h,a){const k=this._NodeConstructors[E];return k?k(b,h,a):null}set accessibilityTag(E){this._accessibilityTag=E,this.onAccessibilityTagChangedObservable.notifyObservers(E)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(E){this._nodeDataStorage._doNotSerialize=E}u(){return this._nodeDataStorage._isDisposed}set parent(E){if(this._parentNode===E)return;const b=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const b=this._parentNode._children.indexOf(this);-1!==b&&this._parentNode._children.splice(b,1),E||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=E,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),b||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(E){E.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const E=this._scene.rootNodes,b=E.length-1;E[this._nodeDataStorage._sceneRootNodesIndex]=E[b],E[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(E){this._animationPropertiesOverride=E}getClassName(){return"Node"}set onDispose(E){this._onDisposeObserver&&this.rj.remove(this._onDisposeObserver),this._onDisposeObserver=this.rj.add(E)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new s,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new V.e,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=k.d.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.rj=new V.e,this._onDisposeObserver=null,this._behaviors=new Array,this.name=E,this.id=E,this._scene=b||l.b.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),h&&this._addToSceneRootNodes()}va(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(E)||(E.init(),this._scene.isLoading&&!b?this._scene.onDataLoadedObservable.addOnce((()=>{E.attach(this)})):E.attach(this),this._behaviors.push(E)),this}removeBehavior(E){const b=this._behaviors.indexOf(E);return-1===b||(this._behaviors[b].detach(),this._behaviors.splice(b,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(E){for(const b of this._behaviors)if(b.name===E)return b;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.Wj(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(E){!E&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(E){return this.parent?this.parent._getActionManagerForTrigger(E,!1):null}_updateCache(E){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}ah(E){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((E=>{E._syncParentEnabledState()}))}Gb(E){this._nodeDataStorage._isEnabled!==E&&(this._nodeDataStorage._isEnabled=E,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(E))}isDescendantOf(E){return!!this.parent&&(this.parent===E||this.parent.isDescendantOf(E))}_getDescendants(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2?arguments[2]:void 0;if(this._children)for(let a=0;a<this._children.length;a++){const k=this._children[a];h&&!h(k)||E.push(k),b||k._getDescendants(E,!1,h)}}getDescendants(E,b){const h=[];return this._getDescendants(h,E,b),h}getChildMeshes(E,b){const h=[];return this._getDescendants(h,E,(E=>(!b||b(E))&&void 0!==E.Li)),h}getChildren(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(b,E)}_setReady(E){E!==this._nodeDataStorage._isReady&&(E?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(E){for(let b=0;b<this.animations.length;b++){const h=this.animations[b];if(h.name===E)return h}return null}createAnimationRange(E,b,h){if(!this._ranges[E]){this._ranges[E]=U._AnimationRangeFactory(E,b,h);for(let a=0,k=this.animations.length;a<k;a++)this.animations[a]&&this.animations[a].createRange(E,b,h)}}deleteAnimationRange(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let h=0,a=this.animations.length;h<a;h++)this.animations[h]&&this.animations[h].deleteRange(E,b);this._ranges[E]=null}getAnimationRange(E){return this._ranges[E]||null}clone(E,b,h){const a=v.e.Clone((()=>new U(E,this.va())),this);if(b&&(a.parent=b),!h){const b=this.getDescendants(!0);for(let h=0;h<b.length;h++){const k=b[h];k.clone(E+"."+k.name,a)}}return a}getAnimationRanges(){const E=[];let b;for(b in this._ranges)E.push(this._ranges[b]);return E}beginAnimation(E,b,h,a){const k=this.getAnimationRange(E);return k?this._scene.beginAnimation(this,k.from,k.to,b,h,a):null}serializeAnimationRanges(){const E=[];for(const b in this._ranges){const h=this._ranges[b];if(!h)continue;const a={};a.name=b,a.from=h.from,a.to=h.to,E.push(a)}return E}Wj(E){return this._worldMatrix||(this._worldMatrix=k.d.Identity()),this._worldMatrix}dispose(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!E){const h=this.getDescendants(!0);for(const a of h)a.dispose(E,b)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.rj.notifyObservers(this),this.rj.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const h of this._behaviors)h.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(E,b,h){if(b.ranges)for(let a=0;a<b.ranges.length;a++){const h=b.ranges[a];E.createAnimationRange(h.name,h.from,h.to)}}getHierarchyBoundingVectors(){let E,b,h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.va().incrementRenderId(),this.Wj(!0);const G=this;if(G.getBoundingInfo&&G.wg){const h=G.getBoundingInfo();E=h.boundingBox.minimumWorld.clone(),b=h.boundingBox.maximumWorld.clone()}else E=new k.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),b=new k.k(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(h){const h=this.getDescendants(!1);for(const G of h){const h=G;if(h.Wj(!0),a&&!a(h))continue;if(!h.getBoundingInfo||0===h.getTotalVertices())continue;const V=h.getBoundingInfo().boundingBox,l=V.minimumWorld,O=V.maximumWorld;k.k.CheckExtends(l,E,b),k.k.CheckExtends(O,E,b)}}return{min:E,max:b}}}U._AnimationRangeFactory=(E,b,h)=>{throw(0,O.c)("AnimationRange")},U._NodeConstructors={},(0,a.d)([(0,G.H)()],U.prototype,"name",void 0),(0,a.d)([(0,G.H)()],U.prototype,"id",void 0),(0,a.d)([(0,G.H)()],U.prototype,"uniqueId",void 0),(0,a.d)([(0,G.H)()],U.prototype,"state",void 0),(0,a.d)([(0,G.H)()],U.prototype,"metadata",void 0)},11163:(E,b,h)=>{"use strict";h.d(b,{e:()=>EE});var a=h(10821),k=h(10846),G=h(10824),V=h(11155);class l{constructor(){this._count=0,this._data={}}p(E){this.clear(),E.forEach(((E,b)=>this.add(E,b)))}get(E){const b=this._data[E];if(void 0!==b)return b}getOrAddWithFactory(E,b){let h=this.get(E);return void 0!==h||(h=b(E),h&&this.add(E,h)),h}getOrAdd(E,b){const h=this.get(E);return void 0!==h?h:(this.add(E,b),b)}contains(E){return void 0!==this._data[E]}add(E,b){return void 0===this._data[E]&&(this._data[E]=b,++this._count,!0)}set(E,b){return void 0!==this._data[E]&&(this._data[E]=b,!0)}getAndRemove(E){const b=this.get(E);return void 0!==b?(delete this._data[E],--this._count,b):null}remove(E){return!!this.contains(E)&&(delete this._data[E],--this._count,!0)}clear(){this._data={},this._count=0}get count(){return this._count}forEach(E){for(const b in this._data){E(b,this._data[b])}}first(E){for(const b in this._data){const h=E(b,this._data[b]);if(h)return h}return null}}var O=h(11170),v=h(11175),s=h(11195),U=h(11224),B=h(11231);class o{constructor(E,b,h,a,k,G){this.source=E,this.pointerX=b,this.pointerY=h,this.meshUnderPointer=a,this.sourceEvent=k,this.additionalData=G}static CreateNew(E,b,h){const a=E.va();return new o(E,a.pointerX,a.pointerY,a.meshUnderPointer||E,b,h)}static CreateNewFromSprite(E,b,h,a){return new o(E,b.pointerX,b.pointerY,b.meshUnderPointer,h,a)}static CreateNewFromScene(E,b){return new o(null,E.pointerX,E.pointerY,E.meshUnderPointer,b)}static CreateNewFromPrimitive(E,b,h,a){return new o(E,b.x,b.y,null,h,a)}}var u=h(11247),D=h(11254),g=h(11257),S=h(10832),M=h(10869),I=h(10855),j=h(11261);class P{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasTriggers(){for(const E in P.Triggers)if(Object.prototype.hasOwnProperty.call(P.Triggers,E))return!0;return!1}static get HasPickTriggers(){for(const E in P.Triggers)if(Object.prototype.hasOwnProperty.call(P.Triggers,E)){const b=parseInt(E);if(b>=1&&b<=7)return!0}return!1}static HasSpecificTrigger(E){for(const b in P.Triggers)if(Object.prototype.hasOwnProperty.call(P.Triggers,b)){if(parseInt(b)===E)return!0}return!1}}P.Triggers={};var A,n,d,c,z,Z,Y,r=h(11268);!function(E){E[E.Generic=0]="Generic",E[E.Keyboard=1]="Keyboard",E[E.Mouse=2]="Mouse",E[E.Touch=3]="Touch",E[E.DualShock=4]="DualShock",E[E.Xbox=5]="Xbox",E[E.Switch=6]="Switch",E[E.DualSense=7]="DualSense"}(A||(A={})),function(E){E[E.Horizontal=0]="Horizontal",E[E.Vertical=1]="Vertical",E[E.LeftClick=2]="LeftClick",E[E.MiddleClick=3]="MiddleClick",E[E.RightClick=4]="RightClick",E[E.BrowserBack=5]="BrowserBack",E[E.BrowserForward=6]="BrowserForward",E[E.MouseWheelX=7]="MouseWheelX",E[E.MouseWheelY=8]="MouseWheelY",E[E.MouseWheelZ=9]="MouseWheelZ",E[E.Move=12]="Move"}(n||(n={})),function(E){E[E.Horizontal=0]="Horizontal",E[E.Vertical=1]="Vertical",E[E.LeftClick=2]="LeftClick",E[E.MiddleClick=3]="MiddleClick",E[E.RightClick=4]="RightClick",E[E.BrowserBack=5]="BrowserBack",E[E.BrowserForward=6]="BrowserForward",E[E.MouseWheelX=7]="MouseWheelX",E[E.MouseWheelY=8]="MouseWheelY",E[E.MouseWheelZ=9]="MouseWheelZ",E[E.DeltaHorizontal=10]="DeltaHorizontal",E[E.DeltaVertical=11]="DeltaVertical"}(d||(d={})),function(E){E[E.Cross=0]="Cross",E[E.Circle=1]="Circle",E[E.Square=2]="Square",E[E.Triangle=3]="Triangle",E[E.L1=4]="L1",E[E.R1=5]="R1",E[E.L2=6]="L2",E[E.R2=7]="R2",E[E.Share=8]="Share",E[E.Options=9]="Options",E[E.L3=10]="L3",E[E.R3=11]="R3",E[E.DPadUp=12]="DPadUp",E[E.DPadDown=13]="DPadDown",E[E.DPadLeft=14]="DPadLeft",E[E.DPadRight=15]="DPadRight",E[E.Home=16]="Home",E[E.TouchPad=17]="TouchPad",E[E.LStickXAxis=18]="LStickXAxis",E[E.LStickYAxis=19]="LStickYAxis",E[E.RStickXAxis=20]="RStickXAxis",E[E.RStickYAxis=21]="RStickYAxis"}(c||(c={})),function(E){E[E.Cross=0]="Cross",E[E.Circle=1]="Circle",E[E.Square=2]="Square",E[E.Triangle=3]="Triangle",E[E.L1=4]="L1",E[E.R1=5]="R1",E[E.L2=6]="L2",E[E.R2=7]="R2",E[E.Create=8]="Create",E[E.Options=9]="Options",E[E.L3=10]="L3",E[E.R3=11]="R3",E[E.DPadUp=12]="DPadUp",E[E.DPadDown=13]="DPadDown",E[E.DPadLeft=14]="DPadLeft",E[E.DPadRight=15]="DPadRight",E[E.Home=16]="Home",E[E.TouchPad=17]="TouchPad",E[E.LStickXAxis=18]="LStickXAxis",E[E.LStickYAxis=19]="LStickYAxis",E[E.RStickXAxis=20]="RStickXAxis",E[E.RStickYAxis=21]="RStickYAxis"}(z||(z={})),function(E){E[E.A=0]="A",E[E.B=1]="B",E[E.X=2]="X",E[E.Y=3]="Y",E[E.LB=4]="LB",E[E.RB=5]="RB",E[E.LT=6]="LT",E[E.RT=7]="RT",E[E.Back=8]="Back",E[E.Start=9]="Start",E[E.LS=10]="LS",E[E.RS=11]="RS",E[E.DPadUp=12]="DPadUp",E[E.DPadDown=13]="DPadDown",E[E.DPadLeft=14]="DPadLeft",E[E.DPadRight=15]="DPadRight",E[E.Home=16]="Home",E[E.LStickXAxis=17]="LStickXAxis",E[E.LStickYAxis=18]="LStickYAxis",E[E.RStickXAxis=19]="RStickXAxis",E[E.RStickYAxis=20]="RStickYAxis"}(Z||(Z={})),function(E){E[E.B=0]="B",E[E.A=1]="A",E[E.Y=2]="Y",E[E.X=3]="X",E[E.L=4]="L",E[E.R=5]="R",E[E.ZL=6]="ZL",E[E.ZR=7]="ZR",E[E.Minus=8]="Minus",E[E.Plus=9]="Plus",E[E.LS=10]="LS",E[E.RS=11]="RS",E[E.DPadUp=12]="DPadUp",E[E.DPadDown=13]="DPadDown",E[E.DPadLeft=14]="DPadLeft",E[E.DPadRight=15]="DPadRight",E[E.Home=16]="Home",E[E.Capture=17]="Capture",E[E.LStickXAxis=18]="LStickXAxis",E[E.LStickYAxis=19]="LStickYAxis",E[E.RStickXAxis=20]="RStickXAxis",E[E.RStickYAxis=21]="RStickYAxis"}(Y||(Y={}));var w=h(11270);class N{static CreateDeviceEvent(E,b,h,a,k,G,V){switch(E){case A.Keyboard:return this._CreateKeyboardEvent(h,a,k,G);case A.Mouse:if(h===n.MouseWheelX||h===n.MouseWheelY||h===n.MouseWheelZ)return this._CreateWheelEvent(E,b,h,a,k,G);case A.Touch:return this._CreatePointerEvent(E,b,h,a,k,G,V);default:throw`Unable to generate event for device ${A[E]}`}}static _CreatePointerEvent(E,b,h,a,k,G,V){const l=this._CreateMouseEvent(E,b,h,a,k,G);E===A.Mouse?(l.deviceType=A.Mouse,l.pointerId=1,l.pointerType="mouse"):(l.deviceType=A.Touch,l.pointerId=V??b,l.pointerType="touch");let O=0;return O+=k.pollInput(E,b,n.LeftClick),O+=2*k.pollInput(E,b,n.RightClick),O+=4*k.pollInput(E,b,n.MiddleClick),l.buttons=O,h===n.Move?l.type="pointermove":h>=n.LeftClick&&h<=n.RightClick&&(l.type=1===a?"pointerdown":"pointerup",l.button=h-2),l}static _CreateWheelEvent(E,b,h,a,k,G){const V=this._CreateMouseEvent(E,b,h,a,k,G);switch(V.pointerId=1,V.type="wheel",V.deltaMode=w.e.DOM_DELTA_PIXEL,V.deltaX=0,V.deltaY=0,V.deltaZ=0,h){case n.MouseWheelX:V.deltaX=a;break;case n.MouseWheelY:V.deltaY=a;break;case n.MouseWheelZ:V.deltaZ=a}return V}static _CreateMouseEvent(E,b,h,a,k,G){const V=this._CreateEvent(G),l=k.pollInput(E,b,n.Horizontal),O=k.pollInput(E,b,n.Vertical);return G?(V.movementX=0,V.movementY=0,V.offsetX=V.movementX-G.getBoundingClientRect().x,V.offsetY=V.movementY-G.getBoundingClientRect().y):(V.movementX=k.pollInput(E,b,10),V.movementY=k.pollInput(E,b,11),V.offsetX=0,V.offsetY=0),this._CheckNonCharacterKeys(V,k),V.clientX=l,V.clientY=O,V.x=l,V.y=O,V.deviceType=E,V.deviceSlot=b,V.inputIndex=h,V}static _CreateKeyboardEvent(E,b,h,a){const k=this._CreateEvent(a);return this._CheckNonCharacterKeys(k,h),k.deviceType=A.Keyboard,k.deviceSlot=0,k.inputIndex=E,k.type=1===b?"keydown":"keyup",k.key=String.fromCharCode(E),k.keyCode=E,k}static _CheckNonCharacterKeys(E,b){const h=b.isDeviceAvailable(A.Keyboard),a=h&&1===b.pollInput(A.Keyboard,0,18),k=h&&1===b.pollInput(A.Keyboard,0,17),G=h&&(1===b.pollInput(A.Keyboard,0,91)||1===b.pollInput(A.Keyboard,0,92)||1===b.pollInput(A.Keyboard,0,93)),V=h&&1===b.pollInput(A.Keyboard,0,16);E.altKey=a,E.ctrlKey=k,E.metaKey=G,E.shiftKey=V}static _CreateEvent(E){const b={preventDefault:()=>{}};return b.target=E,b}}class H{constructor(E,b,h){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(E,b,((E,b,a,k)=>{const G=N.CreateDeviceEvent(E,b,a,k,this);h(E,b,G)})):this._createDummyNativeInput()}pollInput(E,b,h){return this._nativeInput.pollInput(E,b,h)}isDeviceAvailable(E){return E===A.Mouse||E===A.Touch}dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}}const f=Object.keys(n).length/2;class F{constructor(E,b,h,k){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=a.g.IsSafari(),this._usingMacOS=(0,S.g)()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=E=>{},this._keyboardUpEvent=E=>{},this._keyboardBlurEvent=E=>{},this._pointerMoveEvent=E=>{},this._pointerDownEvent=E=>{},this._pointerUpEvent=E=>{},this._pointerCancelEvent=E=>{},this._pointerWheelEvent=E=>{},this._pointerBlurEvent=E=>{},this._pointerMacOSChromeOutEvent=E=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=(0,S.g)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=(0,S.g)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=E=>{},this._gamepadDisconnectedEvent=E=>{},this._eventPrefix=a.g.GetPointerPrefix(E),this._engine=E,this._onDeviceConnected=b,this._onDeviceDisconnected=h,this._onInputChanged=k,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOS&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}pollInput(E,b,h){const k=this._inputs[E][b];if(!k)throw`Unable to find device ${A[E]}`;E>=A.DualShock&&E<=A.DualSense&&this._updateDevice(E,b,h);const G=k[h];if(void 0===G)throw`Unable to find input ${h} for device ${A[E]} in slot ${b}`;return h===n.Move&&a.g.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),G}isDeviceAvailable(E){return void 0!==this._inputs[E]}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_enableEvents(){const E=null===this||void 0===this?void 0:this._engine.getInputElement();if(E&&(!this._eventsAttached||this._elementToAttachTo!==E)){if(this._disableEvents(),this._inputs)for(const E of this._inputs)if(E)for(const b in E){const h=E[+b];if(h)for(let E=0;E<h.length;E++)h[E]=0}this._elementToAttachTo=E,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOS&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_checkForConnectedDevices(){if(navigator.getGamepads){const E=navigator.getGamepads();for(const b of E)b&&this._addGamePad(b)}"function"===typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(A.Mouse,0,0,0)}_addGamePad(E){const b=this._getGamepadDeviceType(E.id),h=E.index;this._gamepads=this._gamepads||new Array(E.index+1),this._registerDevice(b,h,E.buttons.length+E.axes.length),this._gamepads[h]=b}_addPointerDevice(E,b,h,a){this._pointerActive||(this._pointerActive=!0),this._registerDevice(E,b,f);const k=this._inputs[E][b];k[0]=h,k[1]=a}_registerDevice(E,b,h){if(void 0===b)throw`Unable to register device ${A[E]} to undefined slot.`;if(this._inputs[E]||(this._inputs[E]={}),!this._inputs[E][b]){const a=new Array(h);a.fill(0),this._inputs[E][b]=a,this._onDeviceConnected(E,b)}}_unregisterDevice(E,b){this._inputs[E][b]&&(delete this._inputs[E][b],this._onDeviceDisconnected(E,b))}_handleKeyActions(){this._keyboardDownEvent=E=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(A.Keyboard,0,255));const b=this._inputs[A.Keyboard][0];if(b){b[E.keyCode]=1;const h=E;h.inputIndex=E.keyCode,this._usingMacOS&&E.metaKey&&"Meta"!==E.key&&(this._metaKeys.includes(E.keyCode)||this._metaKeys.push(E.keyCode)),this._onInputChanged(A.Keyboard,0,h)}},this._keyboardUpEvent=E=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(A.Keyboard,0,255));const b=this._inputs[A.Keyboard][0];if(b){b[E.keyCode]=0;const h=E;if(h.inputIndex=E.keyCode,this._usingMacOS&&"Meta"===E.key&&this._metaKeys.length>0){for(const E of this._metaKeys){const h=N.CreateDeviceEvent(A.Keyboard,0,E,0,this,this._elementToAttachTo);b[E]=0,this._onInputChanged(A.Keyboard,0,h)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(A.Keyboard,0,h)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const E=this._inputs[A.Keyboard][0];for(let b=0;b<E.length;b++)if(0!==E[b]){E[b]=0;const h=N.CreateDeviceEvent(A.Keyboard,0,b,0,this,this._elementToAttachTo);this._onInputChanged(A.Keyboard,0,h)}this._usingMacOS&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_handlePointerActions(){this._maxTouchPoints=(0,S.g)()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let a=0;a<this._maxTouchPoints;a++)this._activeTouchIds[a]=-1;this._pointerMoveEvent=E=>{const b=this._getPointerType(E);let h=b===A.Mouse?0:this._activeTouchIds.indexOf(E.pointerId);if(b===A.Touch&&-1===h){const k=this._activeTouchIds.indexOf(-1);if(!(k>=0))return void a.g.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);h=k,this._activeTouchIds[k]=E.pointerId,this._onDeviceConnected(b,h)}this._inputs[b]||(this._inputs[b]={}),this._inputs[b][h]||this._addPointerDevice(b,h,E.clientX,E.clientY);const k=this._inputs[b][h];if(k){const a=E;a.inputIndex=n.Move,k[n.Horizontal]=E.clientX,k[n.Vertical]=E.clientY,b===A.Touch&&0===k[n.LeftClick]&&(k[n.LeftClick]=1),void 0===E.pointerId&&(E.pointerId=this._mouseId),this._onInputChanged(b,h,a),this._usingSafari||-1===E.button||(a.inputIndex=E.button+2,k[E.button+2]=k[E.button+2]?0:1,this._onInputChanged(b,h,a))}},this._pointerDownEvent=E=>{const b=this._getPointerType(E);let h=b===A.Mouse?0:E.pointerId;if(b===A.Touch){let b=this._activeTouchIds.indexOf(E.pointerId);if(-1===b&&(b=this._activeTouchIds.indexOf(-1)),!(b>=0))return void a.g.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);h=b,this._activeTouchIds[b]=E.pointerId}this._inputs[b]||(this._inputs[b]={}),this._inputs[b][h]?b===A.Touch&&this._onDeviceConnected(b,h):this._addPointerDevice(b,h,E.clientX,E.clientY);const k=this._inputs[b][h];if(k){const a=k[n.Horizontal],V=k[n.Vertical];if(b===A.Mouse){if(void 0===E.pointerId&&(E.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(G){}}else if(E.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(E.pointerId)}catch(G){}k[n.Horizontal]=E.clientX,k[n.Vertical]=E.clientY,k[E.button+2]=1;const l=E;l.inputIndex=E.button+2,this._onInputChanged(b,h,l),a===E.clientX&&V===E.clientY||(l.inputIndex=n.Move,this._onInputChanged(b,h,l))}},this._pointerUpEvent=E=>{var b;const h=this._getPointerType(E),a=h===A.Mouse?0:this._activeTouchIds.indexOf(E.pointerId);if(h===A.Touch){if(-1===a)return;this._activeTouchIds[a]=-1}const k=null===(b=this._inputs[h])||void 0===b?void 0:b[a];if(k&&0!==k[E.button+2]){var G,V,l,O;const b=k[n.Horizontal],v=k[n.Vertical];k[n.Horizontal]=E.clientX,k[n.Vertical]=E.clientY,k[E.button+2]=0;const s=E;void 0===E.pointerId&&(E.pointerId=this._mouseId),b===E.clientX&&v===E.clientY||(s.inputIndex=n.Move,this._onInputChanged(h,a,s)),s.inputIndex=E.button+2,h===A.Mouse&&this._mouseId>=0&&null!==(G=(V=this._elementToAttachTo).hasPointerCapture)&&void 0!==G&&G.call(V,this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):E.pointerId&&null!==(l=(O=this._elementToAttachTo).hasPointerCapture)&&void 0!==l&&l.call(O,E.pointerId)&&this._elementToAttachTo.releasePointerCapture(E.pointerId),this._onInputChanged(h,a,s),h===A.Touch&&this._onDeviceDisconnected(h,a)}},this._pointerCancelEvent=E=>{if("mouse"===E.pointerType){var b,h;const E=this._inputs[A.Mouse][0];this._mouseId>=0&&null!==(b=(h=this._elementToAttachTo).hasPointerCapture)&&void 0!==b&&b.call(h,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let b=n.LeftClick;b<=n.BrowserForward;b++)if(1===E[b]){E[b]=0;const h=N.CreateDeviceEvent(A.Mouse,0,b,0,this,this._elementToAttachTo);this._onInputChanged(A.Mouse,0,h)}}else{var a,k;const b=this._activeTouchIds.indexOf(E.pointerId);if(-1===b)return;null!==(a=(k=this._elementToAttachTo).hasPointerCapture)&&void 0!==a&&a.call(k,E.pointerId)&&this._elementToAttachTo.releasePointerCapture(E.pointerId),this._inputs[A.Touch][b][n.LeftClick]=0;const h=N.CreateDeviceEvent(A.Touch,b,n.LeftClick,0,this,this._elementToAttachTo,E.pointerId);this._onInputChanged(A.Touch,b,h),this._activeTouchIds[b]=-1,this._onDeviceDisconnected(A.Touch,b)}},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let E=!1;const b=function(){};try{const h=Object.defineProperty({},"passive",{get:function(){E=!0}});this._elementToAttachTo.addEventListener("test",b,h),this._elementToAttachTo.removeEventListener("test",b,h)}catch(h){}this._pointerBlurEvent=()=>{if(this.isDeviceAvailable(A.Mouse)){var E,b;const h=this._inputs[A.Mouse][0];this._mouseId>=0&&null!==(E=(b=this._elementToAttachTo).hasPointerCapture)&&void 0!==E&&E.call(b,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let E=n.LeftClick;E<=n.BrowserForward;E++)if(1===h[E]){h[E]=0;const b=N.CreateDeviceEvent(A.Mouse,0,E,0,this,this._elementToAttachTo);this._onInputChanged(A.Mouse,0,b)}}if(this.isDeviceAvailable(A.Touch)){const E=this._inputs[A.Touch];for(let b=0;b<this._activeTouchIds.length;b++){var h,a,k;const G=this._activeTouchIds[b];if(null!==(h=(a=this._elementToAttachTo).hasPointerCapture)&&void 0!==h&&h.call(a,G)&&this._elementToAttachTo.releasePointerCapture(G),-1!==G&&1===(null===(k=E[b])||void 0===k?void 0:k[n.LeftClick])){E[b][n.LeftClick]=0;const h=N.CreateDeviceEvent(A.Touch,b,n.LeftClick,0,this,this._elementToAttachTo,G);this._onInputChanged(A.Touch,b,h),this._activeTouchIds[b]=-1,this._onDeviceDisconnected(A.Touch,b)}}}},this._pointerWheelEvent=E=>{const b=A.Mouse;this._inputs[b]||(this._inputs[b]=[]),this._inputs[b][0]||(this._pointerActive=!0,this._registerDevice(b,0,f));const h=this._inputs[b][0];if(h){h[n.MouseWheelX]=E.deltaX||0,h[n.MouseWheelY]=E.deltaY||E.wheelDelta||0,h[n.MouseWheelZ]=E.deltaZ||0;const a=E;void 0===E.pointerId&&(E.pointerId=this._mouseId),0!==h[n.MouseWheelX]&&(a.inputIndex=n.MouseWheelX,this._onInputChanged(b,0,a)),0!==h[n.MouseWheelY]&&(a.inputIndex=n.MouseWheelY,this._onInputChanged(b,0,a)),0!==h[n.MouseWheelZ]&&(a.inputIndex=n.MouseWheelZ,this._onInputChanged(b,0,a))}},this._usingMacOS&&this._isUsingChromium&&(this._pointerMacOSChromeOutEvent=E=>{E.buttons>1&&this._pointerCancelEvent(E)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!E&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((()=>{if(this.isDeviceAvailable(A.Mouse)){const E=this._inputs[A.Mouse][0];E[n.MouseWheelX]=0,E[n.MouseWheelY]=0,E[n.MouseWheelZ]=0}}))}_handleGamepadActions(){this._gamepadConnectedEvent=E=>{this._addGamePad(E.gamepad)},this._gamepadDisconnectedEvent=E=>{if(this._gamepads){const b=this._getGamepadDeviceType(E.gamepad.id),h=E.gamepad.index;this._unregisterDevice(b,h),delete this._gamepads[h]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_updateDevice(E,b,h){const a=navigator.getGamepads()[b];if(a&&E===this._gamepads[b]){const k=this._inputs[E][b];h>=a.buttons.length?k[h]=a.axes[h-a.buttons.length].valueOf():k[h]=a.buttons[h].value}}_getGamepadDeviceType(E){return-1!==E.indexOf("054c")?-1!==E.indexOf("0ce6")?A.DualSense:A.DualShock:-1!==E.indexOf("Xbox One")||-1!==E.search("Xbox 360")||-1!==E.search("xinput")?A.Xbox:-1!==E.indexOf("057e")?A.Switch:A.Generic}_getPointerType(E){let b=A.Mouse;return("touch"===E.pointerType||"pen"===E.pointerType||E.touches)&&(b=A.Touch),b}}class y{constructor(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.deviceType=b,this.deviceSlot=h,this.onInputChangedObservable=new G.e,this._deviceInputSystem=E}getInput(E){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,E)}}class e{constructor(E){this._registeredManagers=new Array,this._refCount=0,this.registerManager=E=>{for(let b=0;b<this._devices.length;b++){const h=this._devices[b];for(const a in h){const h=+a;E._addDevice(new y(this._deviceInputSystem,b,h))}}this._registeredManagers.push(E)},this.unregisterManager=E=>{const b=this._registeredManagers.indexOf(E);b>-1&&this._registeredManagers.splice(b,1)};const b=Object.keys(A).length/2;this._devices=new Array(b);const h=(E,b)=>{this._devices[E]||(this._devices[E]=new Array),this._devices[E][b]||(this._devices[E][b]=b);for(const h of this._registeredManagers){const a=new y(this._deviceInputSystem,E,b);h._addDevice(a)}},a=(E,b)=>{var h;null!==(h=this._devices[E])&&void 0!==h&&h[b]&&delete this._devices[E][b];for(const a of this._registeredManagers)a._removeDevice(E,b)},k=(E,b,h)=>{if(h)for(const a of this._registeredManagers)a._onInputChanged(E,b,h)};"undefined"!==typeof _native?this._deviceInputSystem=new H(h,a,k):this._deviceInputSystem=new F(E,h,a,k)}dispose(){this._deviceInputSystem.dispose()}}class J{getDeviceSource(E,b){if(void 0===b){if(void 0===this._firstDevice[E])return null;b=this._firstDevice[E]}return this._devices[E]&&void 0!==this._devices[E][b]?this._devices[E][b]:null}getDeviceSources(E){return this._devices[E]?this._devices[E].filter((E=>!!E)):[]}constructor(E){const b=Object.keys(A).length/2;this._devices=new Array(b),this._firstDevice=new Array(b),this._engine=E,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new e(E)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new G.e((E=>{for(const b of this._devices)if(b)for(const h of b)h&&this.onDeviceConnectedObservable.notifyObserver(E,h)})),this.onDeviceDisconnectedObservable=new G.e,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=E.rj.add((()=>{this.dispose()}))}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.rj.remove(this._onDisposeObserver)}_addDevice(E){this._devices[E.deviceType]||(this._devices[E.deviceType]=new Array),this._devices[E.deviceType][E.deviceSlot]||(this._devices[E.deviceType][E.deviceSlot]=E,this._updateFirstDevices(E.deviceType)),this.onDeviceConnectedObservable.notifyObservers(E)}_removeDevice(E,b){var h,a;const k=null===(h=this._devices[E])||void 0===h?void 0:h[b];this.onDeviceDisconnectedObservable.notifyObservers(k),null!==(a=this._devices[E])&&void 0!==a&&a[b]&&delete this._devices[E][b],this._updateFirstDevices(E)}_onInputChanged(E,b,h){var a,k;null===(a=this._devices[E])||void 0===a||null===(k=a[b])||void 0===k||k.onInputChangedObservable.notifyObservers(h)}_updateFirstDevices(E){switch(E){case A.Keyboard:case A.Mouse:this._firstDevice[E]=0;break;case A.Touch:case A.DualSense:case A.DualShock:case A.Xbox:case A.Switch:case A.Generic:{delete this._firstDevice[E];const b=this._devices[E];if(b)for(let h=0;h<b.length;h++)if(b[h]){this._firstDevice[E]=h;break}break}}}}var m=h(11273);class K{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get doubleClick(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(E){this._singleClick=E}set doubleClick(E){this._doubleClick=E}set hasSwiped(E){this._hasSwiped=E}set ignore(E){this._ignore=E}}class x{constructor(E){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._activePointerIds=new Array,this._activePointerIdsCount=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new v.j(0,0),this._previousStartingPointerPosition=new v.j(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=E||M.b.LastCreatedScene,this._scene}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(E){return this._meshUnderPointerId[E]||null}get unTranslatedPointer(){return new v.j(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(E){this._pointerX=E}get pointerY(){return this._pointerY}set pointerY(E){this._pointerY=E}_updatePointerPosition(E){const b=this._scene.getEngine().getInputElementClientRect();b&&(this._pointerX=E.clientX-b.left,this._pointerY=E.clientY-b.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(E,b){const h=this._scene,a=h.getEngine(),k=a.getInputElement();k&&(k.tabIndex=a.canvasTabIndex,h.doNotHandleCursors||(k.style.cursor=h.defaultCursor)),this._setCursorAndPointerOverMesh(E,b,h);for(const O of h._pointerMoveStage){var G;const h=!(null===(G=E=E||this._pickMove(b))||void 0===G||!G.pickedMesh);E=O.action(this._unTranslatedPointerX,this._unTranslatedPointerY,E,h,k)}const V=b.inputIndex>=n.MouseWheelX&&b.inputIndex<=n.MouseWheelZ?j.d.POINTERWHEEL:j.d.POINTERMOVE;let l;h.onPointerMove&&(E=E||this._pickMove(b),h.onPointerMove(b,E,V)),E?(l=new j.i(V,b,E),this._setRayOnPointerInfo(E,b)):(l=new j.i(V,b,null,this),this._movePointerInfo=l),h.onPointerObservable.hasObservers()&&h.onPointerObservable.notifyObservers(l,V)}_setRayOnPointerInfo(E,b){const h=this._scene;E&&m.d._IsPickingAvailable&&(E.ray||(E.ray=h.createPickingRay(b.offsetX,b.offsetY,v.d.Identity(),h.activeCamera)))}_addCameraPointerObserver(E,b){return this._cameraObserverCount++,this._scene.onPointerObservable.add(E,b)}_removeCameraPointerObserver(E){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(E)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(E,b,h){const a=this._scene,k=new j.f(h,b,this._unTranslatedPointerX,this._unTranslatedPointerY);return E&&(k.originalPickingInfo=E,k.ray=E.ray,"xr-near"===b.pointerType&&E.originMesh&&(k.nearInteractionPickingInfo=E)),a.onPrePointerObservable.notifyObservers(k,h),!!k.skipOnPointerObservable}_pickMove(E){const b=this._scene,h=b.Uc(this._unTranslatedPointerX,this._unTranslatedPointerY,b.pointerMovePredicate,b.pointerMoveFastCheck,b.cameraToUseForPointers,b.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(h,E,b),h}_setCursorAndPointerOverMesh(E,b,h){const a=h.getEngine().getInputElement();if(null!==E&&void 0!==E&&E.pickedMesh){if(this.setPointerOverMesh(E.pickedMesh,b.pointerId,E,b),!h.doNotHandleCursors&&a&&this._pointerOverMesh){const E=this._pointerOverMesh._getActionManagerForTrigger();E&&E.hasPointerTriggers&&(a.style.cursor=E.hoverCursor||h.hoverCursor)}}else this.setPointerOverMesh(null,b.pointerId,E,b)}simulatePointerMove(E,b){const h=new PointerEvent("pointermove",b);h.inputIndex=n.Move,this._checkPrePointerObservable(E,h,j.d.POINTERMOVE)||this._processPointerMove(E,h)}simulatePointerDown(E,b){const h=new PointerEvent("pointerdown",b);h.inputIndex=h.button+2,this._checkPrePointerObservable(E,h,j.d.POINTERDOWN)||this._processPointerDown(E,h)}_processPointerDown(E,b){var h;const a=this._scene;if(null!==(h=E)&&void 0!==h&&h.pickedMesh){this._pickedDownMesh=E.pickedMesh;const h=E.pickedMesh._getActionManagerForTrigger();if(h){if(h.hasPickTriggers)switch(h.processTrigger(5,o.CreateNew(E.pickedMesh,b,E)),b.button){case 0:h.processTrigger(2,o.CreateNew(E.pickedMesh,b,E));break;case 1:h.processTrigger(4,o.CreateNew(E.pickedMesh,b,E));break;case 2:h.processTrigger(3,o.CreateNew(E.pickedMesh,b,E))}h.hasSpecificTrigger(8)&&window.setTimeout((()=>{const E=a.Uc(this._unTranslatedPointerX,this._unTranslatedPointerY,(E=>E.zb&&E.isVisible&&E.isReady()&&E.actionManager&&E.actionManager.hasSpecificTrigger(8)&&E===this._pickedDownMesh),!1,a.cameraToUseForPointers);null!==E&&void 0!==E&&E.pickedMesh&&h&&0!==this._activePointerIdsCount&&Date.now()-this._startingPointerTime>x.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,h.processTrigger(8,o.CreateNew(E.pickedMesh,b)))}),x.LongPressDelay)}}else for(const V of a._pointerDownStage)E=V.action(this._unTranslatedPointerX,this._unTranslatedPointerY,E,b,!1);let k;const G=j.d.POINTERDOWN;E?(a.onPointerDown&&a.onPointerDown(b,E,G),k=new j.i(G,b,E),this._setRayOnPointerInfo(E,b)):k=new j.i(G,b,null,this),a.onPointerObservable.hasObservers()&&a.onPointerObservable.notifyObservers(k,G)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(E,b,h){const a=new PointerEvent("pointerup",b);a.inputIndex=n.Move;const k=new K;h?k.doubleClick=!0:k.singleClick=!0,this._checkPrePointerObservable(E,a,j.d.POINTERUP)||this._processPointerUp(E,a,k)}_processPointerUp(E,b,h){var a;const k=this._scene;if(null!==(a=E)&&void 0!==a&&a.pickedMesh){if(this._pickedUpMesh=E.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(k.onPointerPick&&k.onPointerPick(b,E),h.singleClick&&!h.ignore&&k.onPointerObservable.observers.length>this._cameraObserverCount)){const h=j.d.POINTERPICK,a=new j.i(h,b,E);this._setRayOnPointerInfo(E,b),k.onPointerObservable.notifyObservers(a,h)}const a=E.pickedMesh._getActionManagerForTrigger();if(a&&!h.ignore){a.processTrigger(7,o.CreateNew(E.pickedMesh,b,E)),!h.hasSwiped&&h.singleClick&&a.processTrigger(1,o.CreateNew(E.pickedMesh,b,E));const k=E.pickedMesh._getActionManagerForTrigger(6);h.doubleClick&&k&&k.processTrigger(6,o.CreateNew(E.pickedMesh,b,E))}}else if(!h.ignore)for(const G of k._pointerUpStage)E=G.action(this._unTranslatedPointerX,this._unTranslatedPointerY,E,b,h.doubleClick);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const E=this._pickedDownMesh._getActionManagerForTrigger(16);E&&E.processTrigger(16,o.CreateNew(this._pickedDownMesh,b))}if(!h.ignore){const a=new j.i(j.d.POINTERUP,b,E);if(this._setRayOnPointerInfo(E,b),k.onPointerObservable.notifyObservers(a,j.d.POINTERUP),k.onPointerUp&&k.onPointerUp(b,E,j.d.POINTERUP),!h.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let a=0;if(h.singleClick?a=j.d.POINTERTAP:h.doubleClick&&(a=j.d.POINTERDOUBLETAP),a){const h=new j.i(a,b,E);k.onPointerObservable.hasObservers()&&k.onPointerObservable.hasSpecificMask(a)&&k.onPointerObservable.notifyObservers(h,a)}}}}isPointerCaptured(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._pointerCaptures[E]}attachControl(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const k=this._scene,G=k.getEngine();a||(a=G.getInputElement()),this._alreadyAttached&&this.$i(),a&&(this._alreadyAttachedTo=a),this._deviceSourceManager=new J(G),this._initActionManager=E=>{if(!this._meshPickProceed){const b=k.skipPointerUpPicking||0===k._registeredActions&&!this._checkForPicking()&&!k.onPointerUp?null:k.Uc(this._unTranslatedPointerX,this._unTranslatedPointerY,k.pointerUpPredicate,k.pointerUpFastCheck,k.cameraToUseForPointers,k.pointerUpTrianglePredicate);this._currentPickResult=b,b&&(E=b.hit&&b.pickedMesh?b.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return E},this._delayedSimpleClick=(E,b,h)=>{if((Date.now()-this._previousStartingPointerTime>x.DoubleClickDelay&&!this._doubleClickOccured||E!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,b.singleClick=!0,b.ignore=!1,this._delayedClicks[E])){const b=this._delayedClicks[E].evt,h=j.d.POINTERTAP,a=new j.i(h,b,this._currentPickResult);k.onPointerObservable.hasObservers()&&k.onPointerObservable.hasSpecificMask(h)&&k.onPointerObservable.notifyObservers(a,h),this._delayedClicks[E]=null}},this._initClickEvent=(E,b,h,a)=>{const k=new K;this._currentPickResult=null;let G=null,V=E.hasSpecificMask(j.d.POINTERPICK)||b.hasSpecificMask(j.d.POINTERPICK)||E.hasSpecificMask(j.d.POINTERTAP)||b.hasSpecificMask(j.d.POINTERTAP)||E.hasSpecificMask(j.d.POINTERDOUBLETAP)||b.hasSpecificMask(j.d.POINTERDOUBLETAP);!V&&P&&(G=this._initActionManager(G,k),G&&(V=G.hasPickTriggers));let l=!1;if(V){const V=h.button;if(k.hasSwiped=this._isPointerSwiping(),!k.hasSwiped){let s=!x.ExclusiveDoubleClickMode;if(s||(s=!E.hasSpecificMask(j.d.POINTERDOUBLETAP)&&!b.hasSpecificMask(j.d.POINTERDOUBLETAP),s&&!P.HasSpecificTrigger(6)&&(G=this._initActionManager(G,k),G&&(s=!G.hasSpecificTrigger(6)))),s)(Date.now()-this._previousStartingPointerTime>x.DoubleClickDelay||V!==this._previousButtonPressed)&&(k.singleClick=!0,a(k,this._currentPickResult),l=!0);else{const E={evt:h,clickInfo:k,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,V,k,a),x.DoubleClickDelay)};this._delayedClicks[V]=E}let U=E.hasSpecificMask(j.d.POINTERDOUBLETAP)||b.hasSpecificMask(j.d.POINTERDOUBLETAP);if(!U&&P.HasSpecificTrigger(6)&&(G=this._initActionManager(G,k),G&&(U=G.hasSpecificTrigger(6))),U)if(V===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<x.DoubleClickDelay&&!this._doubleClickOccured){if(k.hasSwiped||this._isPointerSwiping())if(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=V,x.ExclusiveDoubleClickMode){var O;if(this._delayedClicks[V])clearTimeout(null===(O=this._delayedClicks[V])||void 0===O?void 0:O.timeoutId),this._delayedClicks[V]=null;a(k,this._previousPickResult)}else a(k,this._currentPickResult);else{var v;if(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,k.doubleClick=!0,k.ignore=!1,x.ExclusiveDoubleClickMode&&this._delayedClicks[V])clearTimeout(null===(v=this._delayedClicks[V])||void 0===v?void 0:v.timeoutId),this._delayedClicks[V]=null;a(k,this._currentPickResult)}l=!0}else this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=V}}l||a(k,this._currentPickResult)},this._onPointerMove=E=>{if(this._updatePointerPosition(E),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>x.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>x.DragMovementThreshold),G.isPointerLock&&G._verifyPointerLock(),this._checkPrePointerObservable(null,E,E.inputIndex>=n.MouseWheelX&&E.inputIndex<=n.MouseWheelZ?j.d.POINTERWHEEL:j.d.POINTERMOVE))return;if(!k.cameraToUseForPointers&&!k.activeCamera)return;if(k.hj)return void this._processPointerMove(new B.d,E);k.pointerMovePredicate||(k.pointerMovePredicate=E=>E.zb&&E.isVisible&&E.isReady()&&E.isEnabled()&&(E.enablePointerMoveEvents||k.constantlyUpdateMeshUnderPointer||null!==E._getActionManagerForTrigger())&&(!k.cameraToUseForPointers||0!==(k.cameraToUseForPointers.layerMask&E.layerMask)));const b=k._registeredActions>0||k.constantlyUpdateMeshUnderPointer?this._pickMove(E):null;this._processPointerMove(b,E)},this._onPointerDown=E=>{const b=this._activePointerIds.indexOf(-1);if(-1===b?this._activePointerIds.push(E.pointerId):this._activePointerIds[b]=E.pointerId,this._activePointerIdsCount++,this._pickedDownMesh=null,this._meshPickProceed=!1,x.ExclusiveDoubleClickMode)for(let a=0;a<this._delayedClicks.length;a++)if(this._delayedClicks[a])if(E.button===a){var h;clearTimeout(null===(h=this._delayedClicks[a])||void 0===h?void 0:h.timeoutId)}else{const E=this._delayedClicks[a].clickInfo;this._doubleClickOccured=!1,E.singleClick=!0,E.ignore=!1;const b=this._delayedClicks[a].evt,h=j.d.POINTERTAP,G=new j.i(h,b,this._currentPickResult);k.onPointerObservable.hasObservers()&&k.onPointerObservable.hasSpecificMask(h)&&k.onPointerObservable.notifyObservers(G,h),this._delayedClicks[a]=null}if(this._updatePointerPosition(E),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=E.button),k.preventDefaultOnPointerDown&&a&&(E.preventDefault(),a.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,E,j.d.POINTERDOWN))return;if(!k.cameraToUseForPointers&&!k.activeCamera)return;let G;this._pointerCaptures[E.pointerId]=!0,k.pointerDownPredicate||(k.pointerDownPredicate=E=>E.zb&&E.isVisible&&E.isReady()&&E.isEnabled()&&(!k.cameraToUseForPointers||0!==(k.cameraToUseForPointers.layerMask&E.layerMask))),this._pickedDownMesh=null,G=k.skipPointerDownPicking||0===k._registeredActions&&!this._checkForPicking()&&!k.onPointerDown?new B.d:k.Uc(this._unTranslatedPointerX,this._unTranslatedPointerY,k.pointerDownPredicate,k.pointerDownFastCheck,k.cameraToUseForPointers,k.pointerDownTrianglePredicate),this._processPointerDown(G,E)},this._onPointerUp=E=>{const b=this._activePointerIds.indexOf(E.pointerId);-1!==b&&(this._activePointerIds[b]=-1,this._activePointerIdsCount--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(E),k.preventDefaultOnPointerUp&&a&&(E.preventDefault(),a.focus()),this._initClickEvent(k.onPrePointerObservable,k.onPointerObservable,E,((b,h)=>{if(k.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!b.ignore)){if(this._checkPrePointerObservable(null,E,j.d.POINTERUP))return this._swipeButtonPressed===E.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),void(0===E.buttons&&(this._pointerCaptures[E.pointerId]=!1));b.hasSwiped||(b.singleClick&&k.onPrePointerObservable.hasSpecificMask(j.d.POINTERTAP)&&this._checkPrePointerObservable(null,E,j.d.POINTERTAP)&&(this._skipPointerTap=!0),b.doubleClick&&k.onPrePointerObservable.hasSpecificMask(j.d.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,E,j.d.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}this._pointerCaptures[E.pointerId]?(0===E.buttons&&(this._pointerCaptures[E.pointerId]=!1),(k.cameraToUseForPointers||k.activeCamera)&&(k.pointerUpPredicate||(k.pointerUpPredicate=E=>E.zb&&E.isVisible&&E.isReady()&&E.isEnabled()&&(!k.cameraToUseForPointers||0!==(k.cameraToUseForPointers.layerMask&E.layerMask))),!this._meshPickProceed&&(P&&P.HasTriggers||this._checkForPicking()||k.onPointerUp)&&this._initActionManager(null,b),h||(h=this._currentPickResult),this._processPointerUp(h,E,b),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===E.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))):this._swipeButtonPressed===E.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1)})))},this._onKeyDown=E=>{const b=r.d.KEYDOWN;if(k.onPreKeyboardObservable.hasObservers()){const h=new r.e(b,E);if(k.onPreKeyboardObservable.notifyObservers(h,b),h.skipOnKeyboardObservable)return}if(k.onKeyboardObservable.hasObservers()){const h=new r.f(b,E);k.onKeyboardObservable.notifyObservers(h,b)}k.actionManager&&k.actionManager.processTrigger(14,o.CreateNewFromScene(k,E))},this._onKeyUp=E=>{const b=r.d.KEYUP;if(k.onPreKeyboardObservable.hasObservers()){const h=new r.e(b,E);if(k.onPreKeyboardObservable.notifyObservers(h,b),h.skipOnKeyboardObservable)return}if(k.onKeyboardObservable.hasObservers()){const h=new r.f(b,E);k.onKeyboardObservable.notifyObservers(h,b)}k.actionManager&&k.actionManager.processTrigger(15,o.CreateNewFromScene(k,E))},this._deviceSourceManager.onDeviceConnectedObservable.add((a=>{a.deviceType===A.Mouse?a.onInputChangedObservable.add((k=>{this._originMouseEvent=k,k.inputIndex===n.LeftClick||k.inputIndex===n.MiddleClick||k.inputIndex===n.RightClick||k.inputIndex===n.BrowserBack||k.inputIndex===n.BrowserForward?b&&1===a.getInput(k.inputIndex)?this._onPointerDown(k):E&&0===a.getInput(k.inputIndex)&&this._onPointerUp(k):h&&(k.inputIndex===n.Move?this._onPointerMove(k):k.inputIndex!==n.MouseWheelX&&k.inputIndex!==n.MouseWheelY&&k.inputIndex!==n.MouseWheelZ||this._onPointerMove(k))})):a.deviceType===A.Touch?a.onInputChangedObservable.add((k=>{k.inputIndex===n.LeftClick&&(b&&1===a.getInput(k.inputIndex)?(this._onPointerDown(k),this._activePointerIdsCount>1&&(this._isMultiTouchGesture=!0)):E&&0===a.getInput(k.inputIndex)&&(this._onPointerUp(k),0===this._activePointerIdsCount&&(this._isMultiTouchGesture=!1))),h&&k.inputIndex===n.Move&&this._onPointerMove(k)})):a.deviceType===A.Keyboard&&a.onInputChangedObservable.add((E=>{"keydown"===E.type?this._onKeyDown(E):"keyup"===E.type&&this._onKeyUp(E)}))})),this._alreadyAttached=!0}$i(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;if(this._meshUnderPointerId[b]===E&&(!E||!E._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const k=this._meshUnderPointerId[b];let G;k&&(G=k._getActionManagerForTrigger(10),G&&G.processTrigger(10,o.CreateNew(k,a,{pointerId:b}))),E?(this._meshUnderPointerId[b]=E,this._pointerOverMesh=E,G=E._getActionManagerForTrigger(9),G&&G.processTrigger(9,o.CreateNew(E,a,{pointerId:b,pickResult:h}))):(delete this._meshUnderPointerId[b],this._pointerOverMesh=null)}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(E){this._pointerOverMesh===E&&(this._pointerOverMesh=null),this._pickedDownMesh===E&&(this._pickedDownMesh=null),this._pickedUpMesh===E&&(this._pickedUpMesh=null);for(const b in this._meshUnderPointerId)this._meshUnderPointerId[b]===E&&delete this._meshUnderPointerId[b]}}x.DragMovementThreshold=10,x.LongPressDelay=500,x.DoubleClickDelay=300,x.ExclusiveDoubleClickMode=!1;var W=h(10972),L=h(11201),t=h(11282),T=h(11293),X=h(10878),C=h(11302),q=h(11183);class R{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.hj=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}var Q,i=h(10834),p=h(10958);!function(E){E[E.BackwardCompatible=0]="BackwardCompatible",E[E.Intermediate=1]="Intermediate",E[E.Aggressive=2]="Aggressive"}(Q||(Q={}));class EE{static DefaultMaterialFactory(E){throw(0,I.c)("nb")}static CollisionCoordinatorFactory(){throw(0,I.c)("DefaultCollisionCoordinator")}get clearColor(){return this._clearColor}set clearColor(E){E!==this._clearColor&&(this._clearColor=E,this.onClearColorChangedObservable.notifyObservers(this._clearColor))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get performancePriority(){return this._performancePriority}set performancePriority(E){if(E!==this._performancePriority){switch(this._performancePriority=E,E){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.hj=!1,this._i=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.hj=!0,this._i=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.hj=!0,this._i=!1}this.onScenePerformancePriorityChangedObservable.notifyObservers(E)}}set forceWireframe(E){this._forceWireframe!==E&&(this._forceWireframe=E,this.markAllMaterialsAsDirty(16))}get forceWireframe(){return this._forceWireframe}set skipFrustumClipping(E){this._skipFrustumClipping!==E&&(this._skipFrustumClipping=E)}get skipFrustumClipping(){return this._skipFrustumClipping}set forcePointsCloud(E){this._forcePointsCloud!==E&&(this._forcePointsCloud=E,this.markAllMaterialsAsDirty(16))}get forcePointsCloud(){return this._forcePointsCloud}get environmentTexture(){return this._environmentTexture}set environmentTexture(E){this._environmentTexture!==E&&(this._environmentTexture=E,this.markAllMaterialsAsDirty(1))}getNodes(){let E=[];return E=E.concat(this.meshes),E=E.concat(this.lights),E=E.concat(this.cameras),E=E.concat(this.transformNodes),this.skeletons.forEach((b=>E=E.concat(b.bones))),E}get animationPropertiesOverride(){return this._animationPropertiesOverride}set animationPropertiesOverride(E){this._animationPropertiesOverride=E}set onDispose(E){this._onDisposeObserver&&this.rj.remove(this._onDisposeObserver),this._onDisposeObserver=this.rj.add(E)}set beforeRender(E){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),E&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(E))}set afterRender(E){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),E&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(E))}set beforeCameraRender(E){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(E)}set afterCameraRender(E){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(E)}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}set pointerDownPredicate(E){this._pointerPickingConfiguration.pointerDownPredicate=E}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}set pointerUpPredicate(E){this._pointerPickingConfiguration.pointerUpPredicate=E}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}set pointerMovePredicate(E){this._pointerPickingConfiguration.pointerMovePredicate=E}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}set pointerDownFastCheck(E){this._pointerPickingConfiguration.pointerDownFastCheck=E}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}set pointerUpFastCheck(E){this._pointerPickingConfiguration.pointerUpFastCheck=E}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}set pointerMoveFastCheck(E){this._pointerPickingConfiguration.pointerMoveFastCheck=E}get hj(){return this._pointerPickingConfiguration.hj}set hj(E){this._pointerPickingConfiguration.hj=E}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}set skipPointerDownPicking(E){this._pointerPickingConfiguration.skipPointerDownPicking=E}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}set skipPointerUpPicking(E){this._pointerPickingConfiguration.skipPointerUpPicking=E}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}static get DragMovementThreshold(){return x.DragMovementThreshold}static set DragMovementThreshold(E){x.DragMovementThreshold=E}static get LongPressDelay(){return x.LongPressDelay}static set LongPressDelay(E){x.LongPressDelay=E}static get DoubleClickDelay(){return x.DoubleClickDelay}static set DoubleClickDelay(E){x.DoubleClickDelay=E}static get ExclusiveDoubleClickMode(){return x.ExclusiveDoubleClickMode}static set ExclusiveDoubleClickMode(E){x.ExclusiveDoubleClickMode=E}bindEyePosition(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vEyePosition",h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:this.activeCamera.globalPosition,k=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return v.h.Vector4[0].set(a.x,a.y,a.z,k?-1:1),E&&(h?E.setFloat3(b,v.h.Vector4[0].x,v.h.Vector4[0].y,v.h.Vector4[0].z):E.setVector4(b,v.h.Vector4[0])),v.h.Vector4[0]}finalizeSceneUbo(){const E=this.getSceneUniformBuffer(),b=this.bindEyePosition(null);return E.updateFloat4("vEyePosition",b.x,b.y,b.z,b.w),E.update(),E}set useRightHandedSystem(E){this._useRightHandedSystem!==E&&(this._useRightHandedSystem=E,this.markAllMaterialsAsDirty(16))}get useRightHandedSystem(){return this._useRightHandedSystem}setStepId(E){this._currentStepId=E}getStepId(){return this._currentStepId}getInternalStep(){return this._currentInternalStep}set fogEnabled(E){this._fogEnabled!==E&&(this._fogEnabled=E,this.markAllMaterialsAsDirty(16))}get fogEnabled(){return this._fogEnabled}set fogMode(E){this._fogMode!==E&&(this._fogMode=E,this.markAllMaterialsAsDirty(16))}get fogMode(){return this._fogMode}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set shadowsEnabled(E){this._shadowsEnabled!==E&&(this._shadowsEnabled=E,this.markAllMaterialsAsDirty(2))}get shadowsEnabled(){return this._shadowsEnabled}set lightsEnabled(E){this._lightsEnabled!==E&&(this._lightsEnabled=E,this.markAllMaterialsAsDirty(2))}get lightsEnabled(){return this._lightsEnabled}get activeCameras(){return this._activeCameras}set activeCameras(E){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),E&&(this._unObserveActiveCameras=(0,q.i)(E,(()=>{this.onActiveCamerasChanged.notifyObservers(this)}))),this._activeCameras=E}get activeCamera(){return this._activeCamera}set activeCamera(E){E!==this._activeCamera&&(this._activeCamera=E,this.onActiveCameraChanged.notifyObservers(this))}get defaultMaterial(){return this.Di||(this.Di=EE.DefaultMaterialFactory(this)),this.Di}set defaultMaterial(E){this.Di=E}set texturesEnabled(E){this._texturesEnabled!==E&&(this._texturesEnabled=E,this.markAllMaterialsAsDirty(1))}get texturesEnabled(){return this._texturesEnabled}get frameGraph(){return this._frameGraph}set frameGraph(E){if(this._frameGraph)return this._frameGraph=E,void(E||(this.customRenderFunction=this._currentCustomRenderFunction));this._frameGraph=E,E&&(this._currentCustomRenderFunction=this.customRenderFunction,this.customRenderFunction=this._renderWithFrameGraph)}set skeletonsEnabled(E){this._skeletonsEnabled!==E&&(this._skeletonsEnabled=E,this.markAllMaterialsAsDirty(8))}get skeletonsEnabled(){return this._skeletonsEnabled}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=EE.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get renderingManager(){return this._renderingManager}get frustumPlanes(){return this._frustumPlanes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const E of this._transientComponents)E.register();this._transientComponents.length=0}}fb(E){this._components.push(E),this._transientComponents.push(E);const b=E;b.addFromContainer&&b.serialize&&this._serializableComponents.push(b)}_getComponent(E){for(const b of this._components)if(b.name===E)return b;return null}constructor(E,b){this._inputManager=new x(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this._i=!0,this.autoClearDepthAndStencil=!0,this._clearColor=new L.f(.2,.2,.3,1),this.onClearColorChangedObservable=new G.e,this.ambientColor=new L.b(0,0,0),this.environmentIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new G.e,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.yj=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.effectLayers=[],this.hk=null,this.layers=[],this.lensFlareSystems=[],this.proceduralTextures=[],this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.rj=new G.e,this._onDisposeObserver=null,this.onBeforeRenderObservable=new G.e,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new G.e,this.onAfterRenderCameraObservable=new G.e,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new G.e,this.onAfterAnimationsObservable=new G.e,this.onBeforeDrawPhaseObservable=new G.e,this.onAfterDrawPhaseObservable=new G.e,this.onReadyObservable=new G.e,this.onBeforeCameraRenderObservable=new G.e,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new G.e,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new G.e,this.onAfterActiveMeshesEvaluationObservable=new G.e,this.onBeforeParticlesRenderingObservable=new G.e,this.onAfterParticlesRenderingObservable=new G.e,this.onDataLoadedObservable=new G.e,this.onNewCameraAddedObservable=new G.e,this.onCameraRemovedObservable=new G.e,this.onNewLightAddedObservable=new G.e,this.onLightRemovedObservable=new G.e,this.onNewGeometryAddedObservable=new G.e,this.onGeometryRemovedObservable=new G.e,this.onNewTransformNodeAddedObservable=new G.e,this.onTransformNodeRemovedObservable=new G.e,this.onNewMeshAddedObservable=new G.e,this.onMeshRemovedObservable=new G.e,this.onNewSkeletonAddedObservable=new G.e,this.onSkeletonRemovedObservable=new G.e,this.onNewMaterialAddedObservable=new G.e,this.onNewMultiMaterialAddedObservable=new G.e,this.onMaterialRemovedObservable=new G.e,this.onMultiMaterialRemovedObservable=new G.e,this.onNewTextureAddedObservable=new G.e,this.onTextureRemovedObservable=new G.e,this.onBeforeRenderTargetsRenderObservable=new G.e,this.onAfterRenderTargetsRenderObservable=new G.e,this.onBeforeStepObservable=new G.e,this.onAfterStepObservable=new G.e,this.onActiveCameraChanged=new G.e,this.onActiveCamerasChanged=new G.e,this.onBeforeRenderingGroupObservable=new G.e,this.onAfterRenderingGroupObservable=new G.e,this.onMeshImportedObservable=new G.e,this.onAnimationFileImportedObservable=new G.e,this._registeredForLateAnimationBindings=new V.d(256),this._pointerPickingConfiguration=new R,this.onPrePointerObservable=new G.e,this.onPointerObservable=new G.e,this.onPreKeyboardObservable=new G.e,this.onKeyboardObservable=new G.e,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=EE.FOGMODE_NONE,this.fogColor=new L.b(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this._frameGraph=null,this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new v.k(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new V.d(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new W.d,this._activeIndices=new W.d,this._activeParticles=new W.d,this._activeBones=new W.d,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=new Array,this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new V.e(256),this._processedMaterials=new V.e(256),this._renderTargets=new V.d(256),this._materialsRenderTargets=new V.d(256),this._activeParticleSystems=new V.e(256),this._activeSkeletons=new V.d(32),this._softwareSkinnedMeshes=new V.d(32),this._activeAnimatables=new Array,this._transformMatrix=v.d.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=g.f.Create(),this._beforeClearStage=g.f.Create(),this._beforeRenderTargetClearStage=g.f.Create(),this._gatherRenderTargetsStage=g.f.Create(),this._gatherActiveCameraRenderTargetsStage=g.f.Create(),this._isReadyForMeshStage=g.f.Create(),this._beforeEvaluateActiveMeshStage=g.f.Create(),this._evaluateSubMeshStage=g.f.Create(),this._preActiveMeshStage=g.f.Create(),this._cameraDrawRenderTargetStage=g.f.Create(),this._beforeCameraDrawStage=g.f.Create(),this._beforeRenderTargetDrawStage=g.f.Create(),this._beforeRenderingGroupDrawStage=g.f.Create(),this._beforeRenderingMeshStage=g.f.Create(),this._afterRenderingMeshStage=g.f.Create(),this._afterRenderingGroupDrawStage=g.f.Create(),this._afterCameraDrawStage=g.f.Create(),this._afterCameraPostProcessStage=g.f.Create(),this._afterRenderTargetDrawStage=g.f.Create(),this._afterRenderTargetPostProcessStage=g.f.Create(),this._afterRenderStage=g.f.Create(),this._pointerMoveStage=g.f.Create(),this._pointerDownStage=g.f.Create(),this._pointerUpStage=g.f.Create(),this._geometriesByUniqueId=null,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[];const h={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...b};E=this._engine=E||M.b.LastCreatedEngine,h.virtual?E._virtualScenes.push(this):(M.b._LastCreatedScene=this,E.scenes.push(this)),this._uid=null,this._renderingManager=new D.b(this),u.d&&(this.postProcessManager=new u.d(this)),(0,S.i)()&&this.attachControl(),this._createUbo(),s.d&&(this._imageProcessingConfiguration=new s.d),this.setDefaultCandidateProviders(),h.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=h.useMaterialMeshMap,this.useClonedMeshMap=h.useClonedMeshMap,b&&b.virtual||E.onNewSceneAddedObservable.notifyObservers(this)}getClassName(){return"Scene"}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_getDefaultSubMeshCandidates(E){return this._defaultSubMeshCandidates.data=E.wg,this._defaultSubMeshCandidates.length=E.wg.length,this._defaultSubMeshCandidates}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=E=>this._getDefaultSubMeshCandidates(E),this.getIntersectingSubMeshCandidates=(E,b)=>this._getDefaultSubMeshCandidates(E),this.getCollidingSubMeshCandidates=(E,b)=>this._getDefaultSubMeshCandidates(E)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}get pointerX(){return this._inputManager.pointerX}set pointerX(E){this._inputManager.pointerX=E}get pointerY(){return this._inputManager.pointerY}set pointerY(E){this._inputManager.pointerY=E}getCachedMaterial(){return this._cachedMaterial}getCachedEffect(){return this._cachedEffect}getCachedVisibility(){return this._cachedVisibility}isCachedMaterialInvalid(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this._cachedEffect!==b||this._cachedMaterial!==E||this._cachedVisibility!==h}getEngine(){return this._engine}getTotalVertices(){return this._totalVertices.current}get totalVerticesPerfCounter(){return this._totalVertices}getActiveIndices(){return this._activeIndices.current}get totalActiveIndicesPerfCounter(){return this._activeIndices}getActiveParticles(){return this._activeParticles.current}get activeParticlesPerfCounter(){return this._activeParticles}getActiveBones(){return this._activeBones.current}get activeBonesPerfCounter(){return this._activeBones}getActiveMeshes(){return this._activeMeshes}getAnimationRatio(){return void 0!==this._animationRatio?this._animationRatio:1}getRenderId(){return this._renderId}getFrameId(){return this._frameId}incrementRenderId(){this._renderId++}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}simulatePointerMove(E,b){return this._inputManager.simulatePointerMove(E,b),this}simulatePointerDown(E,b){return this._inputManager.simulatePointerDown(E,b),this}simulatePointerUp(E,b,h){return this._inputManager.simulatePointerUp(E,b,h),this}isPointerCaptured(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._inputManager.isPointerCaptured(E)}attachControl(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._inputManager.attachControl(E,b,h)}$i(){this._inputManager.$i()}isReady(){var E,b;let h,a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._isDisposed)return!1;const k=this.getEngine(),G=k.currentRenderPassId;k.currentRenderPassId=(null===(E=this.activeCamera)||void 0===E?void 0:E.renderPassId)??G;let V=!0;for(this._pendingData.length>0&&(V=!1),null===(b=this.prePassRenderer)||void 0===b||b.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&V&&(V=this.depthPeelingRenderer.isReady()),a&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),h=0;h<this.meshes.length;h++){const E=this.meshes[h];if(!E.wg||0===E.wg.length)continue;if(!E.isReady(!0)){V=!1;continue}const b=E.hasThinInstances||"InstancedMesh"===E.getClassName()||"InstancedLinesMesh"===E.getClassName()||k.getCaps().instancedArrays&&E.instances.length>0;for(const h of this._isReadyForMeshStage)h.action(E,b)||(V=!1);if(!a)continue;const G=E.material||this.defaultMaterial;if(G)if(G._storeEffectOnSubMeshes)for(const h of E.wg){const E=h.Ha();E&&E.hasRenderTargetTextures&&null!=E.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(E)&&(this._processedMaterials.push(E),this._materialsRenderTargets.concatWithNoDuplicate(E.getRenderTargetTextures()))}else G.hasRenderTargetTextures&&null!=G.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(G)&&(this._processedMaterials.push(G),this._materialsRenderTargets.concatWithNoDuplicate(G.getRenderTargetTextures()))}if(a)for(h=0;h<this._materialsRenderTargets.length;++h){this._materialsRenderTargets.data[h].isReadyForRendering()||(V=!1)}for(h=0;h<this.geometries.length;h++){2===this.geometries[h].delayLoadState&&(V=!1)}if(this.activeCameras&&this.activeCameras.length>0)for(const l of this.activeCameras)l.isReady(!0)||(V=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(V=!1));for(const l of this.yj)l.isReady()||(V=!1);if(this.layers)for(const l of this.layers)l.isReady()||(V=!1);return k.areAllEffectsReady()||(V=!1),k.currentRenderPassId=G,V}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}registerBeforeRender(E){this.onBeforeRenderObservable.add(E)}unregisterBeforeRender(E){this.onBeforeRenderObservable.removeCallback(E)}registerAfterRender(E){this.onAfterRenderObservable.add(E)}unregisterAfterRender(E){this.onAfterRenderObservable.removeCallback(E)}_executeOnceBeforeRender(E){const b=()=>{E(),setTimeout((()=>{this.unregisterBeforeRender(b)}))};this.registerBeforeRender(b)}executeOnceBeforeRender(E,b){void 0!==b?setTimeout((()=>{this._executeOnceBeforeRender(E)}),b):this._executeOnceBeforeRender(E)}addPendingData(E){this._pendingData.push(E)}removePendingData(E){const b=this.isLoading,h=this._pendingData.indexOf(E);-1!==h&&this._pendingData.splice(h,1),b&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}getWaitingItemsCount(){return this._pendingData.length}get isLoading(){return this._pendingData.length>0}executeWhenReady(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.onReadyObservable.addOnce(E),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(b)}whenReadyAsync(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise((b=>{this.executeWhenReady((()=>{b()}),E)}))}_checkIsReady(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._registerTransientComponents(),this.isReady(E)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((()=>{this.incrementRenderId(),this._checkIsReady(E)}),100))}get animatables(){return this._activeAnimatables}resetLastAnimationTimeFrame(){this._animationTimeLast=k.c.Now}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projectionMatrix}getTransformMatrix(){return this._transformMatrix}setTransformMatrix(E,b,h,a){h||a||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===E.updateFlag&&this._projectionUpdateFlag===b.updateFlag||(this._viewUpdateFlag=E.updateFlag,this._projectionUpdateFlag=b.updateFlag,this._viewMatrix=E,this._projectionMatrix=b,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?t.c.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=t.c.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(h,a):this._sceneUbo.useUbo&&(this._sceneUbo.Pj("viewProjection",this._transformMatrix),this._sceneUbo.Pj("view",this._viewMatrix),this._sceneUbo.Pj("projection",this._projectionMatrix)))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}createSceneUniformBuffer(E){const b=new U.d(this._engine,void 0,!1,E??"Xd");return b.addUniform("viewProjection",16),b.addUniform("view",16),b.addUniform("projection",16),b.addUniform("vEyePosition",4),b}setSceneUniformBuffer(E){this._sceneUbo=E,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}getUniqueId(){return T.e.UniqueId}ti(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._blockEntityCollection||(this.meshes.push(E),E._resyncLightSources(),E.parent||E._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(E),b&&E.getChildMeshes().forEach((E=>{this.ti(E)})))}Wd(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const h=this.meshes.indexOf(E);return-1!==h&&(this.meshes.splice(h,1),E.parent||E._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(E),this.onMeshRemovedObservable.notifyObservers(E),b&&E.getChildMeshes().forEach((E=>{this.Wd(E)})),h}addTransformNode(E){this._blockEntityCollection||E.va()===this&&-1!==E._indexInSceneTransformNodesArray||(E._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(E),E.parent||E._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(E))}removeTransformNode(E){const b=E._indexInSceneTransformNodesArray;if(-1!==b){if(b!==this.transformNodes.length-1){const E=this.transformNodes[this.transformNodes.length-1];this.transformNodes[b]=E,E._indexInSceneTransformNodesArray=b}E._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),E.parent||E._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(E),b}removeSkeleton(E){const b=this.skeletons.indexOf(E);return-1!==b&&(this.skeletons.splice(b,1),this.onSkeletonRemovedObservable.notifyObservers(E),this._executeActiveContainerCleanup(this._activeSkeletons)),b}removeMorphTargetManager(E){const b=this.morphTargetManagers.indexOf(E);return-1!==b&&this.morphTargetManagers.splice(b,1),b}removeLight(E){const b=this.lights.indexOf(E);if(-1!==b){for(const b of this.meshes)b._removeLightSource(E,!1);this.lights.splice(b,1),this.sortLightsByPriority(),E.parent||E._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(E),b}removeCamera(E){const b=this.cameras.indexOf(E);if(-1!==b&&(this.cameras.splice(b,1),E.parent||E._removeFromSceneRootNodes()),this.activeCameras){const b=this.activeCameras.indexOf(E);-1!==b&&this.activeCameras.splice(b,1)}return this.activeCamera===E&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(E),b}removeParticleSystem(E){const b=this.yj.indexOf(E);return-1!==b&&(this.yj.splice(b,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),b}removeAnimation(E){const b=this.animations.indexOf(E);return-1!==b&&this.animations.splice(b,1),b}stopAnimation(E,b,h){}removeAnimationGroup(E){const b=this.animationGroups.indexOf(E);return-1!==b&&this.animationGroups.splice(b,1),b}removeMultiMaterial(E){const b=this.multiMaterials.indexOf(E);return-1!==b&&this.multiMaterials.splice(b,1),this.onMultiMaterialRemovedObservable.notifyObservers(E),b}removeMaterial(E){const b=E._indexInSceneMaterialArray;if(-1!==b&&b<this.materials.length){if(b!==this.materials.length-1){const E=this.materials[this.materials.length-1];this.materials[b]=E,E._indexInSceneMaterialArray=b}E._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(E),b}removeActionManager(E){const b=this.actionManagers.indexOf(E);return-1!==b&&this.actionManagers.splice(b,1),b}removeTexture(E){const b=this.textures.indexOf(E);return-1!==b&&this.textures.splice(b,1),this.onTextureRemovedObservable.notifyObservers(E),b}addLight(E){if(!this._blockEntityCollection){this.lights.push(E),this.sortLightsByPriority(),E.parent||E._addToSceneRootNodes();for(const b of this.meshes)-1===b.lightSources.indexOf(E)&&(b.lightSources.push(E),b._resyncLightSources());this.onNewLightAddedObservable.notifyObservers(E)}}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(C.c.CompareLightsPriority)}addCamera(E){this._blockEntityCollection||(this.cameras.push(E),this.onNewCameraAddedObservable.notifyObservers(E),E.parent||E._addToSceneRootNodes())}addSkeleton(E){this._blockEntityCollection||(this.skeletons.push(E),this.onNewSkeletonAddedObservable.notifyObservers(E))}addParticleSystem(E){this._blockEntityCollection||this.yj.push(E)}addAnimation(E){this._blockEntityCollection||this.animations.push(E)}addAnimationGroup(E){this._blockEntityCollection||this.animationGroups.push(E)}addMultiMaterial(E){this._blockEntityCollection||(this.multiMaterials.push(E),this.onNewMultiMaterialAddedObservable.notifyObservers(E))}addMaterial(E){this._blockEntityCollection||E.va()===this&&-1!==E._indexInSceneMaterialArray||(E._indexInSceneMaterialArray=this.materials.length,this.materials.push(E),this.onNewMaterialAddedObservable.notifyObservers(E))}addMorphTargetManager(E){this._blockEntityCollection||this.morphTargetManagers.push(E)}addGeometry(E){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[E.uniqueId]=this.geometries.length),this.geometries.push(E))}addActionManager(E){this.actionManagers.push(E)}addTexture(E){this._blockEntityCollection||(this.textures.push(E),this.onNewTextureAddedObservable.notifyObservers(E))}switchActiveCamera(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.$i(),this.activeCamera=E,b&&E.attachControl())}setActiveCameraById(E){const b=this.getCameraById(E);return b?(this.activeCamera=b,b):null}setActiveCameraByName(E){const b=this.getCameraByName(E);return b?(this.activeCamera=b,b):null}getAnimationGroupByName(E){for(let b=0;b<this.animationGroups.length;b++)if(this.animationGroups[b].name===E)return this.animationGroups[b];return null}_getMaterial(E,b){for(let h=0;h<this.materials.length;h++){const E=this.materials[h];if(b(E))return E}if(E)for(let h=0;h<this.multiMaterials.length;h++){const E=this.multiMaterials[h];if(b(E))return E}return null}getMaterialByUniqueID(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(b,(b=>b.uniqueId===E))}getMaterialById(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(b,(b=>b.id===E))}getMaterialByName(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(b,(b=>b.name===E))}getLastMaterialById(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(let h=this.materials.length-1;h>=0;h--)if(this.materials[h].id===E)return this.materials[h];if(b)for(let h=this.multiMaterials.length-1;h>=0;h--)if(this.multiMaterials[h].id===E)return this.multiMaterials[h];return null}getTextureByUniqueId(E){for(let b=0;b<this.textures.length;b++)if(this.textures[b].uniqueId===E)return this.textures[b];return null}getTextureByName(E){for(let b=0;b<this.textures.length;b++)if(this.textures[b].name===E)return this.textures[b];return null}getCameraById(E){for(let b=0;b<this.cameras.length;b++)if(this.cameras[b].id===E)return this.cameras[b];return null}getCameraByUniqueId(E){for(let b=0;b<this.cameras.length;b++)if(this.cameras[b].uniqueId===E)return this.cameras[b];return null}getCameraByName(E){for(let b=0;b<this.cameras.length;b++)if(this.cameras[b].name===E)return this.cameras[b];return null}getBoneById(E){for(let b=0;b<this.skeletons.length;b++){const h=this.skeletons[b];for(let b=0;b<h.bones.length;b++)if(h.bones[b].id===E)return h.bones[b]}return null}getBoneByName(E){for(let b=0;b<this.skeletons.length;b++){const h=this.skeletons[b];for(let b=0;b<h.bones.length;b++)if(h.bones[b].name===E)return h.bones[b]}return null}getLightByName(E){for(let b=0;b<this.lights.length;b++)if(this.lights[b].name===E)return this.lights[b];return null}getLightById(E){for(let b=0;b<this.lights.length;b++)if(this.lights[b].id===E)return this.lights[b];return null}getLightByUniqueId(E){for(let b=0;b<this.lights.length;b++)if(this.lights[b].uniqueId===E)return this.lights[b];return null}getParticleSystemById(E){for(let b=0;b<this.yj.length;b++)if(this.yj[b].id===E)return this.yj[b];return null}getGeometryById(E){for(let b=0;b<this.geometries.length;b++)if(this.geometries[b].id===E)return this.geometries[b];return null}_getGeometryByUniqueId(E){if(this._geometriesByUniqueId){const b=this._geometriesByUniqueId[E];if(void 0!==b)return this.geometries[b]}else for(let b=0;b<this.geometries.length;b++)if(this.geometries[b].uniqueId===E)return this.geometries[b];return null}pushGeometry(E,b){return!(!b&&this._getGeometryByUniqueId(E.uniqueId))&&(this.addGeometry(E),this.onNewGeometryAddedObservable.notifyObservers(E),!0)}removeGeometry(E){let b;if(this._geometriesByUniqueId){if(b=this._geometriesByUniqueId[E.uniqueId],void 0===b)return!1}else if(b=this.geometries.indexOf(E),b<0)return!1;if(b!==this.geometries.length-1){const E=this.geometries[this.geometries.length-1];E&&(this.geometries[b]=E,this._geometriesByUniqueId&&(this._geometriesByUniqueId[E.uniqueId]=b))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[E.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(E),!0}getGeometries(){return this.geometries}getMeshById(E){for(let b=0;b<this.meshes.length;b++)if(this.meshes[b].id===E)return this.meshes[b];return null}getMeshesById(E){return this.meshes.filter((function(b){return b.id===E}))}getTransformNodeById(E){for(let b=0;b<this.transformNodes.length;b++)if(this.transformNodes[b].id===E)return this.transformNodes[b];return null}getTransformNodeByUniqueId(E){for(let b=0;b<this.transformNodes.length;b++)if(this.transformNodes[b].uniqueId===E)return this.transformNodes[b];return null}getTransformNodesById(E){return this.transformNodes.filter((function(b){return b.id===E}))}getMeshByUniqueId(E){for(let b=0;b<this.meshes.length;b++)if(this.meshes[b].uniqueId===E)return this.meshes[b];return null}getLastMeshById(E){for(let b=this.meshes.length-1;b>=0;b--)if(this.meshes[b].id===E)return this.meshes[b];return null}getLastTransformNodeById(E){for(let b=this.transformNodes.length-1;b>=0;b--)if(this.transformNodes[b].id===E)return this.transformNodes[b];return null}getLastEntryById(E){let b;for(b=this.meshes.length-1;b>=0;b--)if(this.meshes[b].id===E)return this.meshes[b];for(b=this.transformNodes.length-1;b>=0;b--)if(this.transformNodes[b].id===E)return this.transformNodes[b];for(b=this.cameras.length-1;b>=0;b--)if(this.cameras[b].id===E)return this.cameras[b];for(b=this.lights.length-1;b>=0;b--)if(this.lights[b].id===E)return this.lights[b];return null}getNodeById(E){const b=this.getMeshById(E);if(b)return b;const h=this.getTransformNodeById(E);if(h)return h;const a=this.getLightById(E);if(a)return a;const k=this.getCameraById(E);if(k)return k;const G=this.getBoneById(E);return G||null}getNodeByName(E){const b=this.getMeshByName(E);if(b)return b;const h=this.getTransformNodeByName(E);if(h)return h;const a=this.getLightByName(E);if(a)return a;const k=this.getCameraByName(E);if(k)return k;const G=this.getBoneByName(E);return G||null}getMeshByName(E){for(let b=0;b<this.meshes.length;b++)if(this.meshes[b].name===E)return this.meshes[b];return null}getTransformNodeByName(E){for(let b=0;b<this.transformNodes.length;b++)if(this.transformNodes[b].name===E)return this.transformNodes[b];return null}getLastSkeletonById(E){for(let b=this.skeletons.length-1;b>=0;b--)if(this.skeletons[b].id===E)return this.skeletons[b];return null}getSkeletonByUniqueId(E){for(let b=0;b<this.skeletons.length;b++)if(this.skeletons[b].uniqueId===E)return this.skeletons[b];return null}getSkeletonById(E){for(let b=0;b<this.skeletons.length;b++)if(this.skeletons[b].id===E)return this.skeletons[b];return null}getSkeletonByName(E){for(let b=0;b<this.skeletons.length;b++)if(this.skeletons[b].name===E)return this.skeletons[b];return null}getMorphTargetManagerById(E){for(let b=0;b<this.morphTargetManagers.length;b++)if(this.morphTargetManagers[b].uniqueId===E)return this.morphTargetManagers[b];return null}getMorphTargetById(E){for(let b=0;b<this.morphTargetManagers.length;++b){const h=this.morphTargetManagers[b];for(let b=0;b<h.numTargets;++b){const a=h.getTarget(b);if(a.id===E)return a}}return null}getMorphTargetByName(E){for(let b=0;b<this.morphTargetManagers.length;++b){const h=this.morphTargetManagers[b];for(let b=0;b<h.numTargets;++b){const a=h.getTarget(b);if(a.name===E)return a}}return null}getPostProcessByName(E){for(let b=0;b<this.postProcesses.length;++b){const h=this.postProcesses[b];if(h.name===E)return h}return null}isActiveMesh(E){return-1!==this._activeMeshes.indexOf(E)}get uid(){return this._uid||(this._uid=a.g.RandomId()),this._uid}addExternalData(E,b){return this._externalData||(this._externalData=new l),this._externalData.add(E,b)}getExternalData(E){return this._externalData?this._externalData.get(E):null}getOrAddExternalDataWithFactory(E,b){return this._externalData||(this._externalData=new l),this._externalData.getOrAddWithFactory(E,b)}removeExternalData(E){return this._externalData.remove(E)}_evaluateSubMesh(E,b,h,a){if(a||E.isInFrustum(this._frustumPlanes)){for(const a of this._evaluateSubMeshStage)a.action(b,E);const h=E.Ha();null!==h&&void 0!==h&&(h.hasRenderTargetTextures&&null!=h.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(h)&&(this._processedMaterials.push(h),this._materialsRenderTargets.concatWithNoDuplicate(h.getRenderTargetTextures())),this._renderingManager.dispatch(E,b,h))}}freeProcessedMaterials(){this._processedMaterials.dispose()}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set blockfreeActiveMeshesAndRenderingGroups(E){this._preventFreeActiveMeshesAndRenderingGroups!==E&&(E&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=E)}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let E=0;E<this.activeCameras.length;E++){const b=this.activeCameras[E];b&&b._activeMeshes&&b._activeMeshes.dispose()}}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let E=0;E<this.textures.length;E++){const b=this.textures[E];b&&b.renderList&&b.freeRenderingGroups()}}_isInIntermediateRendering(){return this._intermediateRendering}freezeActiveMeshes(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1?arguments[1]:void 0,h=arguments.length>2?arguments[2]:void 0,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],k=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.executeWhenReady((()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=k,this._skipEvaluateActiveMeshesCompletely=E,a)for(let E=0;E<this._activeMeshes.length;E++)this._activeMeshes.data[E]._freeze();b&&b()}else h&&h("No active camera found")})),this}unfreezeActiveMeshes(){for(let E=0;E<this.meshes.length;E++){const b=this.meshes[E];b._internalAbstractMeshDataInfo&&(b._internalAbstractMeshDataInfo._isActive=!1)}for(let E=0;E<this._activeMeshes.length;E++)this._activeMeshes.data[E]._unFreeze();return this._activeMeshesFrozen=!1,this}_executeActiveContainerCleanup(E){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((()=>E.dispose()))}_evaluateActiveMeshes(){if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode){var E;if(this._activeMeshes.length>0)null===(E=this.activeCamera)||void 0===E||E._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();return}if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const E=this._activeMeshes.length;for(let b=0;b<E;b++){this._activeMeshes.data[b].Wj()}}if(this._activeParticleSystems){const E=this._activeParticleSystems.length;for(let b=0;b<E;b++)this._activeParticleSystems.data[b].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const a of this._beforeEvaluateActiveMeshStage)a.action();const b=this.getActiveMeshCandidates(),h=b.length;for(let a=0;a<h;a++){const E=b.data[a];if(E._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,E.isBlocked)continue;if(this._totalVertices.addCount(E.getTotalVertices(),!1),!E.isReady()||!E.isEnabled()||E.ve.hasAZeroComponent)continue;E.Wj(),E.actionManager&&E.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(E);let h=this.customLODSelector?this.customLODSelector(E,this.activeCamera):E.getLOD(this.activeCamera);if(E._internalAbstractMeshDataInfo._currentLOD=h,E._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,void 0!==h&&null!==h&&(h!==E&&0!==h.billboardMode&&h.Wj(),E._preActivate(),E.isVisible&&E.visibility>0&&0!==(E.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||E.ub||E.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(E),this.activeCamera._activeMeshes.push(E),h!==E&&h._activate(this._renderId,!1);for(const b of this._preActiveMeshStage)b.action(E);E._activate(this._renderId,!1)&&(E.isAnInstance?E._internalAbstractMeshDataInfo._actAsRegularMesh&&(h=E):h._internalAbstractMeshDataInfo._onlyForInstances=!1,h._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(E,h)),E._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let E=0;E<this.yj.length;E++){const b=this.yj[E];if(!b.isStarted()||!b.j)continue;const h=b.j;h.position&&!h.isEnabled()||(this._activeParticleSystems.push(b),b.animate(),this._renderingManager.dispatchParticles(b))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}_prepareSkeleton(E){this._skeletonsEnabled&&E.skeleton&&(this._activeSkeletons.pushNoDuplicate(E.skeleton)&&(E.skeleton.prepare(),this._activeBones.addCount(E.skeleton.bones.length,!1)),E.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(E)&&this.frameGraph&&E.applySkeleton(E.skeleton))}_activeMesh(E,b){this._prepareSkeleton(b);let h=E.hasInstances||E.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||b.ub;if(b&&b.wg&&b.wg.length>0){const a=this.getActiveSubMeshCandidates(b),k=a.length;h=h||1===k;for(let G=0;G<k;G++){const k=a.data[G];this._evaluateSubMesh(k,b,E,h)}}}updateTransformMatrix(E){const b=this.activeCamera;if(b)if(b._renderingMultiview){const h=b._rigCameras[0],a=b._rigCameras[1];this.setTransformMatrix(h.getViewMatrix(),h.getProjectionMatrix(E),a.getViewMatrix(),a.getProjectionMatrix(E))}else this.setTransformMatrix(b.getViewMatrix(),b.getProjectionMatrix(E))}_bindFrameBuffer(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];E&&E._multiviewTexture?E._multiviewTexture._bindFrameBuffer():E&&E.outputRenderTarget?E.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer(),b&&this._clearFrameBuffer(E)}_clearFrameBuffer(E){if(E&&E._multiviewTexture);else if(E&&E.outputRenderTarget&&!E._renderingMultiview){const b=E.outputRenderTarget;b.onClearObservable.hasObservers()?b.onClearObservable.notifyObservers(this._engine):b.skipInitialClear||E.isRightCamera||(this._i&&this._engine.clear(b.clearColor||this._clearColor,!b._cleared,!0,!0),b._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_renderForCamera(E,b){var h;let k=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(E&&E._skipRendering)return;const G=this._engine;if(this._activeCamera=E,!this.activeCamera)throw new Error("Active camera not set");if(G.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&k){let b=!0;E._renderingMultiview&&E.outputRenderTarget&&(b=E.outputRenderTarget.skipInitialClear,this._i&&(this._defaultFrameBufferCleared=!1,E.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),E._renderingMultiview&&E.outputRenderTarget&&(E.outputRenderTarget.skipInitialClear=b)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let a=0;a<this._softwareSkinnedMeshes.length;a++){const E=this._softwareSkinnedMeshes.data[a];E.applySkeleton(E.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),E.customRenderTargets&&E.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(E.customRenderTargets),b&&b.customRenderTargets&&b.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(b.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const a of this._gatherActiveCameraRenderTargetsStage)a.action(this._renderTargets);let V=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){a.g.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let E=0;E<this._renderTargets.length;E++){const b=this._renderTargets.data[E];if(b._shouldRender()){this._renderId++;const E=b.activeCamera&&b.activeCamera!==this.activeCamera;b.render(E,this.dumpNextRenderTargets),V=!0}}a.g.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const E of this._cameraDrawRenderTargetStage)V=E.action(this.activeCamera)||V;this._intermediateRendering=!1}this._engine.currentRenderPassId=(null===(h=E.outputRenderTarget)||void 0===h?void 0:h.renderPassId)??E.renderPassId??0,V&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||E._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const a of this._beforeCameraDrawStage)a.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),G.snapshotRendering&&1===G.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const a of this._afterCameraDrawStage)a.action(this.activeCamera);if(this.postProcessManager&&!E._multiviewTexture){const b=E.outputRenderTarget?E.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(E.isIntermediate,b)}for(const a of this._afterCameraPostProcessStage)a.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}_processSubCameras(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(0===E.cameraRigMode||E._renderingMultiview)return E._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(E,void 0,b),void this.onAfterRenderCameraObservable.notifyObservers(E);if(E._useMultiviewToSingleView)this._renderMultiviewToSingleView(E);else{this.onBeforeCameraRenderObservable.notifyObservers(E);for(let b=0;b<E._rigCameras.length;b++)this._renderForCamera(E._rigCameras[b],E)}this._activeCamera=E,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(E)}_checkIntersections(){for(let E=0;E<this._meshesForIntersections.length;E++){const b=this._meshesForIntersections.data[E];if(b.actionManager)for(let E=0;b.actionManager&&E<b.actionManager.actions.length;E++){const h=b.actionManager.actions[E];if(12===h.trigger||13===h.trigger){const E=h.getTriggerParameter(),a=E.mesh?E.mesh:E,k=a.intersectsMesh(b,E.usePreciseIntersection),G=b._intersectionsInProgress.indexOf(a);k&&-1===G?12===h.trigger?(h._executeCurrent(o.CreateNew(b,void 0,a)),b._intersectionsInProgress.push(a)):13===h.trigger&&b._intersectionsInProgress.push(a):!k&&G>-1&&(13===h.trigger&&h._executeCurrent(o.CreateNew(b,void 0,a)),b.actionManager.hasSpecificTrigger(13,(E=>{const b=E.mesh?E.mesh:E;return a===b}))&&13!==h.trigger||b._intersectionsInProgress.splice(G,1))}}}}_advancePhysicsEngineStep(E){}_animate(E){}animate(){if(this._engine.isDeterministicLockStep()){let E=Math.max(EE.MinDeltaTime,Math.min(this._engine.getDeltaTime(),EE.MaxDeltaTime))+this._timeAccumulator;const b=this._engine.getTimeStep(),h=1e3/b/1e3;let a=0;const k=this._engine.getLockstepMaxSteps();let G=Math.floor(E/b);for(G=Math.min(G,k);E>0&&a<G;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=b*h,this._animate(b),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(b),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,a++,E-=b;this._timeAccumulator=E<0?0:E}else{const E=this.useConstantAnimationDeltaTime?16:Math.max(EE.MinDeltaTime,Math.min(this._engine.getDeltaTime(),EE.MaxDeltaTime));this._animationRatio=.06*E,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(E)}}_clear(){(this.autoClearDepthAndStencil||this._i)&&this._engine.clear(this._clearColor,this._i||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}_checkCameraRenderTarget(E){var b;if(null===E||void 0===E||!E.outputRenderTarget||null!==E&&void 0!==E&&E.isRigCamera||(E.outputRenderTarget._cleared=!1),null!==E&&void 0!==E&&null!==(b=E.rigCameras)&&void 0!==b&&b.length)for(let h=0;h<E.rigCameras.length;++h){const b=E.rigCameras[h].outputRenderTarget;b&&(b._cleared=!1)}}resetDrawCache(E){if(this.meshes)for(const b of this.meshes)b.resetDrawCache(E)}_renderWithFrameGraph(){var E;let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.activeCamera=null,this._activeParticleSystems.reset(),this._activeSkeletons.reset(),b)for(const k of this.cameras)if(k.update(),0!==k.cameraRigMode)for(let E=0;E<k._rigCameras.length;E++)k._rigCameras[E].update();for(const k of this._beforeClearStage)k.action();const h=this.getActiveMeshCandidates(),a=h.length;for(let k=0;k<a;k++){const E=h.data[k];E.isBlocked||(this._totalVertices.addCount(E.getTotalVertices(),!1),E.isReady()&&E.isEnabled()&&!E.ve.hasAZeroComponent&&(E.Wj(),E.actionManager&&E.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(E)))}if(this.particlesEnabled)for(let k=0;k<this.yj.length;k++){const E=this.yj[k];if(!E.isStarted()||!E.j)continue;const b=E.j;b.position&&!b.isEnabled()||(this._activeParticleSystems.push(E),E.animate())}null===(E=this.frameGraph)||void 0===E||E.execute()}render(){var E;let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.u){this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),null!==(E=this.activeCameras)&&void 0!==E&&E.length&&this.activeCameras.forEach(this._checkCameraRenderTarget),this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),h||this.animate();for(const E of this._beforeCameraUpdateStage)E.action();if(b)if(this.activeCameras&&this.activeCameras.length>0)for(let E=0;E<this.activeCameras.length;E++){const b=this.activeCameras[E];if(b.update(),0!==b.cameraRigMode)for(let E=0;E<b._rigCameras.length;E++)b._rigCameras[E].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let E=0;E<this.activeCamera._rigCameras.length;E++)this.activeCamera._rigCameras[E].update();if(this.onBeforeRenderObservable.notifyObservers(this),this.customRenderFunction)this._renderId++,this._engine.currentRenderPassId=0,this.customRenderFunction(b,h);else{var k;const E=this.getEngine();this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const b=null!==(k=this.activeCameras)&&void 0!==k&&k.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){a.g.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(let h=0;h<this.customRenderTargets.length;h++){const a=this.customRenderTargets[h];if(a._shouldRender()){if(this._renderId++,this.activeCamera=a.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");E.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),a.render(b!==this.activeCamera,this.dumpNextRenderTargets)}}a.g.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this._engine.currentRenderPassId=(null===b||void 0===b?void 0:b.renderPassId)??0,this.activeCamera=b,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const h of this._beforeClearStage)h.action();this._clearFrameBuffer(this.activeCamera);for(const h of this._gatherRenderTargetsStage)h.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let h=0;h<this.activeCameras.length;h++)this._processSubCameras(this.activeCameras[h],h>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}}this._checkIntersections();for(const E of this._afterRenderStage)E.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let E=0;E<this._toBeDisposed.length;E++){const b=this._toBeDisposed[E];b&&b.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}}freezeMaterials(){for(let E=0;E<this.materials.length;E++)this.materials[E].freeze()}unfreezeMaterials(){for(let E=0;E<this.materials.length;E++)this.materials[E].unfreeze()}dispose(){if(this.u)return;this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this._activeAnimatables&&this.stopAllAnimations&&(this._activeAnimatables.forEach((E=>{E.onAnimationEndObservable.clear(),E.onAnimationEnd=null})),this.stopAllAnimations()),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const E=this._activeRequests.slice();for(const k of E)k.abort();this._activeRequests.length=0;try{this.rj.notifyObservers(this)}catch(a){i.c.Error("An error occurred while calling onDisposeObservable!",a)}this.$i();if(this._engine.getInputElement())for(let k=0;k<this.cameras.length;k++)this.cameras[k].$i();this._disposeList(this.animationGroups),this._disposeList(this.lights),this._disposeList(this.meshes,(E=>E.dispose(!0))),this._disposeList(this.transformNodes,(E=>E.dispose(!0)));const b=this.cameras;this._disposeList(b),this.Di&&this.Di.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.yj),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let h=this._engine.scenes.indexOf(this);h>-1&&this._engine.scenes.splice(h,1),M.b._LastCreatedScene===this&&(this._engine.scenes.length>0?M.b._LastCreatedScene=this._engine.scenes[this._engine.scenes.length-1]:M.b._LastCreatedScene=null),h=this._engine._virtualScenes.indexOf(this),h>-1&&this._engine._virtualScenes.splice(h,1),this._engine.wipeCaches(!0),this.rj.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this.onClearColorChangedObservable.clear(),this._isDisposed=!0}_disposeList(E,b){const h=E.slice(0);b=b??(E=>E.dispose());for(const a of h)b(a);E.length=0}get u(){return this._isDisposed}clearCachedVertexData(){for(let E=0;E<this.meshes.length;E++){const b=this.meshes[E].Lj;b&&b.clearCachedData()}}cleanCachedTextureBuffer(){for(const E of this.textures){E._buffer&&(E._buffer=null)}}getWorldExtends(E){const b=new v.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),h=new v.k(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return E=E||(()=>!0),this.meshes.filter(E).forEach((E=>{if(E.Wj(!0),!E.wg||0===E.wg.length||E.infiniteDistance)return;const a=E.getBoundingInfo(),k=a.boundingBox.minimumWorld,G=a.boundingBox.maximumWorld;v.k.CheckExtends(k,b,h),v.k.CheckExtends(G,b,h)})),{min:b,max:h}}createPickingRay(E,b,h,a){throw(0,I.c)("Ray")}createPickingRayToRef(E,b,h,a,k){throw(0,I.c)("Ray")}createPickingRayInCameraSpace(E,b,h){throw(0,I.c)("Ray")}createPickingRayInCameraSpaceToRef(E,b,h,a){throw(0,I.c)("Ray")}Uc(E,b,h,a,k,G){const V=(0,I.c)("Ray",!0);return V&&i.c.Warn(V),new B.d}pickWithBoundingInfo(E,b,h,a,k){const G=(0,I.c)("Ray",!0);return G&&i.c.Warn(G),new B.d}pickWithRay(E,b,h,a){throw(0,I.c)("Ray")}multiPick(E,b,h,a,k){throw(0,I.c)("Ray")}multiPickWithRay(E,b,h){throw(0,I.c)("Ray")}setPointerOverMesh(E,b,h){this._inputManager.setPointerOverMesh(E,b,h)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_rebuildGeometries(){for(const E of this.geometries)E._rebuild();for(const E of this.meshes)E._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const E of this._components)E.rebuild();for(const E of this.yj)E.rebuild();if(this.spriteManagers)for(const E of this.spriteManagers)E.rebuild()}_rebuildTextures(){for(const E of this.textures)E._rebuild(!0);this.markAllMaterialsAsDirty(1)}_getByTags(E,b,h){if(void 0===b)return E;const a=[];for(const k in E){const G=E[k];O.b&&O.b.MatchesQuery(G,b)&&(!h||h(G))&&a.push(G)}return a}getMeshesByTags(E,b){return this._getByTags(this.meshes,E,b)}getCamerasByTags(E,b){return this._getByTags(this.cameras,E,b)}getLightsByTags(E,b){return this._getByTags(this.lights,E,b)}getMaterialByTags(E,b){return this._getByTags(this.materials,E,b).concat(this._getByTags(this.multiMaterials,E,b))}getTransformNodesByTags(E,b){return this._getByTags(this.transformNodes,E,b)}setRenderingOrder(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(E,b,h,a)}setRenderingAutoClearDepthStencil(E,b){let h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(E,b,h,a)}getAutoClearDepthStencilSetup(E){return this._renderingManager.getAutoClearDepthStencilSetup(E)}_forceBlockMaterialDirtyMechanism(E){this._blockMaterialDirtyMechanism=E}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set blockMaterialDirtyMechanism(E){this._blockMaterialDirtyMechanism!==E&&(this._blockMaterialDirtyMechanism=E,E||this.markAllMaterialsAsDirty(63))}markAllMaterialsAsDirty(E,b){if(!this._blockMaterialDirtyMechanism)for(const h of this.materials)b&&!b(h)||h.ah(E)}_loadFile(E,b,h,a,k,G,V){const l=(0,X.p)(E,b,h,a?this.offlineProvider:void 0,k,G,V);return this._activeRequests.push(l),l.onCompleteObservable.add((E=>{this._activeRequests.splice(this._activeRequests.indexOf(E),1)})),l}_loadFileAsync(E,b,h,a,k){return new Promise(((G,V)=>{this._loadFile(E,(E=>{G(E)}),b,h,a,((E,b)=>{V(b)}),k)}))}_requestFile(E,b,h,a,k,G,V){const l=(0,X.y)(E,b,h,a?this.offlineProvider:void 0,k,G,V);return this._activeRequests.push(l),l.onCompleteObservable.add((E=>{this._activeRequests.splice(this._activeRequests.indexOf(E),1)})),l}_requestFileAsync(E,b,h,a,k){return new Promise(((G,V)=>{this._requestFile(E,(E=>{G(E)}),b,h,a,(E=>{V(E)}),k)}))}_readFile(E,b,h,a,k){const G=(0,X.v)(E,b,h,a,k);return this._activeRequests.push(G),G.onCompleteObservable.add((E=>{this._activeRequests.splice(this._activeRequests.indexOf(E),1)})),G}_readFileAsync(E,b,h){return new Promise(((a,k)=>{this._readFile(E,(E=>{a(E)}),b,h,(E=>{k(E)}))}))}getPerfCollector(){throw(0,I.c)("performanceViewerSceneExtension")}setActiveCameraByID(E){return this.setActiveCameraById(E)}getMaterialByID(E){return this.getMaterialById(E)}getLastMaterialByID(E){return this.getLastMaterialById(E)}getTextureByUniqueID(E){return this.getTextureByUniqueId(E)}getCameraByID(E){return this.getCameraById(E)}getCameraByUniqueID(E){return this.getCameraByUniqueId(E)}getBoneByID(E){return this.getBoneById(E)}getLightByID(E){return this.getLightById(E)}getLightByUniqueID(E){return this.getLightByUniqueId(E)}getParticleSystemByID(E){return this.getParticleSystemById(E)}getGeometryByID(E){return this.getGeometryById(E)}getMeshByID(E){return this.getMeshById(E)}getMeshByUniqueID(E){return this.getMeshByUniqueId(E)}getLastMeshByID(E){return this.getLastMeshById(E)}getMeshesByID(E){return this.getMeshesById(E)}getTransformNodeByID(E){return this.getTransformNodeById(E)}getTransformNodeByUniqueID(E){return this.getTransformNodeByUniqueId(E)}getTransformNodesByID(E){return this.getTransformNodesById(E)}getNodeByID(E){return this.getNodeById(E)}getLastEntryByID(E){return this.getLastEntryById(E)}getLastSkeletonByID(E){return this.getLastSkeletonById(E)}}EE.FOGMODE_NONE=0,EE.FOGMODE_EXP=1,EE.FOGMODE_EXP2=2,EE.FOGMODE_LINEAR=3,EE.MinDeltaTime=1,EE.MaxDeltaTime=1e3,(0,p.f)("BABYLON.Scene",EE)},11257:(E,b,h)=>{"use strict";h.d(b,{e:()=>a,f:()=>k});class a{}a.NAME_EFFECTLAYER="EffectLayer",a.NAME_LAYER="Layer",a.NAME_LENSFLARESYSTEM="LensFlareSystem",a.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",a.NAME_PARTICLESYSTEM="tb",a.NAME_GAMEPAD="Gamepad",a.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",a.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",a.NAME_PREPASSRENDERER="PrePassRenderer",a.NAME_DEPTHRENDERER="DepthRenderer",a.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",a.NAME_IBLSHADOWSRENDERER="IblShadowsRenderer",a.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",a.NAME_SPRITE="Sprite",a.NAME_SUBSURFACE="SubSurface",a.NAME_OUTLINERENDERER="Outline",a.NAME_PROCEDURALTEXTURE="ProceduralTexture",a.NAME_SHADOWGENERATOR="ShadowGenerator",a.NAME_OCTREE="wb",a.NAME_PHYSICSENGINE="PhysicsEngine",a.NAME_AUDIO="Audio",a.NAME_FLUIDRENDERER="FluidRenderer",a.STEP_ISREADYFORMESH_EFFECTLAYER=0,a.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,a.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,a.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,a.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,a.STEP_BEFORECAMERADRAW_PREPASS=0,a.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,a.STEP_BEFORECAMERADRAW_LAYER=2,a.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,a.STEP_BEFORERENDERTARGETDRAW_LAYER=1,a.STEP_BEFORERENDERINGMESH_PREPASS=0,a.STEP_BEFORERENDERINGMESH_OUTLINE=1,a.STEP_AFTERRENDERINGMESH_PREPASS=0,a.STEP_AFTERRENDERINGMESH_OUTLINE=1,a.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,a.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,a.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,a.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,a.STEP_BEFORECLEAR_PREPASS=1,a.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,a.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,a.STEP_AFTERRENDERTARGETDRAW_LAYER=1,a.STEP_AFTERCAMERADRAW_PREPASS=0,a.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,a.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,a.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,a.STEP_AFTERCAMERADRAW_LAYER=4,a.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,a.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,a.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,a.STEP_AFTERRENDER_AUDIO=0,a.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,a.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,a.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,a.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,a.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,a.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,a.STEP_POINTERMOVE_SPRITE=0,a.STEP_POINTERDOWN_SPRITE=0,a.STEP_POINTERUP_SPRITE=0;class k extends Array{constructor(E){super(...E)}static Create(){return Object.create(k.prototype)}registerStep(E,b,h){let a=0,k=Number.MAX_VALUE;for(;a<this.length;a++){if(k=this[a].index,E<k)break}this.splice(a,0,{index:E,component:b,action:h.bind(b)})}clear(){this.length=0}}},11130:(E,b,h)=>{"use strict";h.d(b,{d:()=>a});function a(E,b,h,a){var k,G=arguments.length,V=G<3?b:null===a?a=Object.getOwnPropertyDescriptor(b,h):a;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)V=Reflect.decorate(E,b,h,a);else for(var l=E.length-1;l>=0;l--)(k=E[l])&&(V=(G<3?k(V):G>3?k(b,h,V):k(b,h))||V);return G>3&&V&&Object.defineProperty(b,h,V),V}Object.create;Object.create},12116:(E,b,h)=>{"use strict";class a{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((E,b)=>{this._resolve=E,this._reject=b}))}}var k=h(11175),G=h(11201),V=h(10821),l=h(11426),O=h(12123),v=h(12141),s=h(10824),U=h(11622),B=h(12145),o=h(12148),u=h(10869),D=h(10834),g=h(10841);class S{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(E){this._useTextureToStoreBoneMatrices=E,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(E){this._animationPropertiesOverride=E}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(E,b,h){this.name=E,this.id=b,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=k.d.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new s.e,this.bones=[],this._scene=h||u.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const a=this._scene.getEngine().getCaps();this._canUseTextureForBones=a.textureFloat&&a.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((E=>!E.getParent()))}getTransformMatrices(E){if(this.needInitialSkinMatrix){if(!E)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return E._bonesTransformMatrices||this.prepare(!0),E._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(E){return this.needInitialSkinMatrix&&E._transformMatrixTexture?E._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(E){let b=`Name: ${this.name}, nBones: ${this.bones.length}`;if(b+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,E){b+=", Ranges: {";let E=!0;for(const h in this._ranges)E&&(b+=", ",E=!1),b+=h;b+="}"}return b}getBoneIndexByName(E){for(let b=0,h=this.bones.length;b<h;b++)if(this.bones[b].name===E)return b;return-1}createAnimationRange(E,b,h){if(!this._ranges[E]){this._ranges[E]=new o.b(E,b,h);for(let a=0,k=this.bones.length;a<k;a++)this.bones[a].animations[0]&&this.bones[a].animations[0].createRange(E,b,h)}}deleteAnimationRange(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let h=0,a=this.bones.length;h<a;h++)this.bones[h].animations[0]&&this.bones[h].animations[0].deleteRange(E,b);this._ranges[E]=null}getAnimationRange(E){return this._ranges[E]||null}getAnimationRanges(){const E=[];let b;for(b in this._ranges)E.push(this._ranges[b]);return E}copyAnimationRange(E,b){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[b]||!E.getAnimationRange(b))return!1;let a=!0;const k=this._getHighestAnimationFrame()+1,G={},V=E.bones;let l,O;for(O=0,l=V.length;O<l;O++)G[V[O].name]=V[O];this.bones.length!==V.length&&(D.c.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${V.length}`),a=!1);const v=h&&this.dimensionsAtRest&&E.dimensionsAtRest?this.dimensionsAtRest.divide(E.dimensionsAtRest):null;for(O=0,l=this.bones.length;O<l;O++){const E=this.bones[O].name,V=G[E];V?a=a&&this.bones[O].copyAnimationRange(V,b,k,h,v):(D.c.Warn("copyAnimationRange: not same rig, missing source bone "+E),a=!1)}const s=E.getAnimationRange(b);return s&&(this._ranges[b]=new o.b(b,s.from+k,s.to+k)),a}returnToRest(){for(const E of this.bones)-1!==E._index&&E.returnToRest()}_getHighestAnimationFrame(){let E=0;for(let b=0,h=this.bones.length;b<h;b++)if(this.bones[b].animations[0]){const h=this.bones[b].animations[0].getHighestFrame();E<h&&(E=h)}return E}beginAnimation(E,b,h,a){const k=this.getAnimationRange(E);return k?this._scene.beginAnimation(this,k.from,k.to,b,h,a):null}static MakeAnimationAdditive(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0;const a=E.getAnimationRange(h);if(!a)return null;const k=E._scene.getAllAnimatablesByTarget(E);let G=null;for(let l=0;l<k.length;l++){const E=k[l];if(E.fromFrame===(null===a||void 0===a?void 0:a.from)&&E.toFrame===(null===a||void 0===a?void 0:a.to)){G=E;break}}const V=E.getAnimatables();for(let l=0;l<V.length;l++){const E=V[l].animations;if(E)for(let a=0;a<E.length;a++)B.c.MakeAnimationAdditive(E[a],b,h)}return G&&(G.isAdditive=!0),E}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(E){this._meshesWithPoseMatrix.push(E)}_unregisterMeshWithPoseMatrix(E){const b=this._meshesWithPoseMatrix.indexOf(E);b>-1&&this._meshesWithPoseMatrix.splice(b,1)}_computeTransformMatrices(E,b){this.onBeforeComputeObservable.notifyObservers(this);for(let h=0;h<this.bones.length;h++){const a=this.bones[h];a._childUpdateId++;const k=a.getParent();if(k?a.getLocalMatrix().multiplyToRef(k.getFinalMatrix(),a.getFinalMatrix()):b?a.getLocalMatrix().multiplyToRef(b,a.getFinalMatrix()):a.getFinalMatrix().p(a.getLocalMatrix()),-1!==a._index){const b=null===a._index?h:a._index;a.getAbsoluteInverseBindMatrix().multiplyToArray(a.getFinalMatrix(),E,16*b)}}this._identity.copyToArray(E,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const E=this.va().getRenderId();if(this._currentRenderId===E)return;this._currentRenderId=E}if(this._numBonesWithLinkedTransformNode>0)for(const E of this.bones)if(E._linkedTransformNode){const b=E._linkedTransformNode;E.position=b.position,b.rotationQuaternion?E.rotationQuaternion=b.rotationQuaternion:E.rotation=b.rotation,E.ve=b.ve}if(this.needInitialSkinMatrix)for(const E of this._meshesWithPoseMatrix){const b=E.getPoseMatrix();let h=this._isDirty;if(E._bonesTransformMatrices&&E._bonesTransformMatrices.length===16*(this.bones.length+1)||(E._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),h=!0),h){if(this._synchronizedWithMesh!==E){this._synchronizedWithMesh=E;for(const E of this.bones)if(!E.getParent()){E.getBindMatrix().multiplyToRef(b,k.h.Matrix[1]),E._updateAbsoluteBindMatrices(k.h.Matrix[1])}if(this.isUsingTextureForMatrices){const b=4*(this.bones.length+1);E._transformMatrixTexture&&E._transformMatrixTexture.getSize().width===b||(E._transformMatrixTexture&&E._transformMatrixTexture.dispose(),E._transformMatrixTexture=U.d.CreateRGBATexture(E._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(E._bonesTransformMatrices,b),this.isUsingTextureForMatrices&&E._transformMatrixTexture&&E._transformMatrixTexture.update(E._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=U.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let E=0;E<this.bones.length;E++)this._animatables.push(this.bones[E])}return this._animatables}clone(E,b){const h=new S(E,b||E,this._scene);h.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let a=0;a<this.bones.length;a++){const E=this.bones[a];let b=null;const k=E.getParent();if(k){const E=this.bones.indexOf(k);b=h.bones[E]}const G=new v.e(E.name,h,b,E.getBindMatrix().clone(),E.getRestMatrix().clone());G._index=E._index,E._linkedTransformNode&&G.linkTransformNode(E._linkedTransformNode),g.c.DeepCopy(E.animations,G.animations)}if(this._ranges){h._ranges={};for(const E in this._ranges){const b=this._ranges[E];b&&(h._ranges[E]=b.clone())}}return this._isDirty=!0,h.prepare(!0),h}enableBlending(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;this.bones.forEach((b=>{b.animations.forEach((b=>{b.enableBlending=!0,b.blendingSpeed=E}))}))}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const E=this._parentContainer.skeletons.indexOf(this);E>-1&&this._parentContainer.skeletons.splice(E,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const E={};E.name=this.name,E.id=this.id,this.dimensionsAtRest&&(E.dimensionsAtRest=this.dimensionsAtRest.qj()),E.bones=[],E.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let h=0;h<this.bones.length;h++){var b;const a=this.bones[h],k=a.getParent(),G={parentBoneIndex:k?this.bones.indexOf(k):-1,index:a.getIndex(),name:a.name,id:a.id,matrix:a.getBindMatrix().qj(),rest:a.getRestMatrix().qj(),linkedTransformNodeId:null===(b=a.getTransformNode())||void 0===b?void 0:b.id};E.bones.push(G),a.length&&(G.length=a.length),a.metadata&&(G.metadata=a.metadata),a.animations&&a.animations.length>0&&(G.animation=a.animations[0].serialize()),E.ranges=[];for(const b in this._ranges){const h=this._ranges[b];if(!h)continue;const a={};a.name=b,a.from=h.from,a.to=h.to,E.ranges.push(a)}}return E}static Parse(E,b){const h=new S(E.name,E.id,b);let a;for(E.dimensionsAtRest&&(h.dimensionsAtRest=k.k.jh(E.dimensionsAtRest)),h.needInitialSkinMatrix=E.needInitialSkinMatrix,a=0;a<E.bones.length;a++){const b=E.bones[a],G=E.bones[a].index;let V=null;b.parentBoneIndex>-1&&(V=h.bones[b.parentBoneIndex]);const l=b.rest?k.d.jh(b.rest):null,O=new v.e(b.name,h,V,k.d.jh(b.matrix),l,null,G);void 0!==b.id&&null!==b.id&&(O.id=b.id),b.length&&(O.length=b.length),b.metadata&&(O.metadata=b.metadata),b.animation&&O.animations.push(B.c.Parse(b.animation)),void 0!==b.linkedTransformNodeId&&null!==b.linkedTransformNodeId&&(h._hasWaitingData=!0,O._waitingTransformNodeId=b.linkedTransformNodeId)}if(E.ranges)for(a=0;a<E.ranges.length;a++){const b=E.ranges[a];h.createAnimationRange(b.name,b.from,b.to)}return h}computeAbsoluteMatrices(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||E)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(E)}getPoseMatrix(){let E=null;return this._meshesWithPoseMatrix.length>0&&(E=this._meshesWithPoseMatrix[0].getPoseMatrix()),E}sortBones(){const E=[],b=new Array(this.bones.length);for(let h=0;h<this.bones.length;h++)this._sortBones(h,E,b);this.bones=E}_sortBones(E,b,h){if(h[E])return;h[E]=!0;const a=this.bones[E];if(!a)return;void 0===a._index&&(a._index=E);const k=a.getParent();k&&this._sortBones(this.bones.indexOf(k),b,h),b.push(a)}setCurrentPoseAsRest(){this.bones.forEach((E=>{E.setCurrentPoseAsRest()}))}}var M=h(11311),I=h(11130),j=h(11139),P=h(12150),A=h(12159),n=h(10958),d=h(11206);class c extends A.b{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(E){this.subSurface.refractionTexture=E,E?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(E){this.subSurface.indexOfRefraction=E}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(E){this.subSurface.invertRefractionY=E}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(E){this.subSurface.linkRefractionWithTransparency=E,E&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===A.b.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(E){E!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=E?A.b.LIGHTFALLOFF_PHYSICAL:A.b.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===A.b.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(E){E!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=E?A.b.LIGHTFALLOFF_GLTF:A.b.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(E){this._attachImageProcessingConfiguration(E),this._markAllSubMeshesAsTexturesDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(E){this.imageProcessingConfiguration.colorCurvesEnabled=E}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(E){this.imageProcessingConfiguration.colorGradingEnabled=E}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(E){this._imageProcessingConfiguration.toneMappingEnabled=E}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(E){this._imageProcessingConfiguration.exposure=E}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(E){this._imageProcessingConfiguration.contrast=E}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(E){this._imageProcessingConfiguration.colorGradingTexture=E}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(E){this._imageProcessingConfiguration.colorCurves=E}constructor(E,b){super(E,b,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=c.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=G.b.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new G.b(0,0,0),this.albedoColor=new G.b(1,1,1),this.reflectivityColor=new G.b(1,1,1),this.reflectionColor=new G.b(1,1,1),this.emissiveColor=new G.b(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,P.e)(this.va())}getClassName(){return"PBRMaterial"}clone(E){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const a=d.e.Clone((()=>new c(E,this.va())),this,{cloneTexturesOnlyOnce:b});return a.id=E,a.name=E,this.stencil.copyTo(a.stencil),this._clonePlugins(a,h),a}serialize(){const E=super.serialize();return E.customType="BABYLON.PBRMaterial",E}static Parse(E,b,h){const a=d.e.Parse((()=>new c(E.name,b)),E,b,h);return E.stencil&&a.stencil.parse(E.stencil,b,h),M.c._ParsePlugins(E,a,b,h),E.clearCoat&&a.clearCoat.parse(E.clearCoat,b,h),E.anisotropy&&a.anisotropy.parse(E.anisotropy,b,h),E.brdf&&a.brdf.parse(E.brdf,b,h),E.sheen&&a.sheen.parse(E.sheen,b,h),E.subSurface&&a.subSurface.parse(E.subSurface,b,h),E.iridescence&&a.iridescence.parse(E.iridescence,b,h),a}}c.PBRMATERIAL_OPAQUE=A.b.PBRMATERIAL_OPAQUE,c.PBRMATERIAL_ALPHATEST=A.b.PBRMATERIAL_ALPHATEST,c.PBRMATERIAL_ALPHABLEND=A.b.PBRMATERIAL_ALPHABLEND,c.PBRMATERIAL_ALPHATESTANDBLEND=A.b.PBRMATERIAL_ALPHATESTANDBLEND,c.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=A.b.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"directIntensity",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"emissiveIntensity",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"environmentIntensity",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"specularIntensity",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"disableBumpMap",void 0),(0,I.d)([(0,j.C)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"albedoTexture",void 0),(0,I.d)([(0,j.C)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"ambientTexture",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"ambientTextureStrength",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,I.d)([(0,j.C)(),(0,j.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],c.prototype,"opacityTexture",void 0),(0,I.d)([(0,j.C)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"reflectionTexture",void 0),(0,I.d)([(0,j.C)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"emissiveTexture",void 0),(0,I.d)([(0,j.C)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"reflectivityTexture",void 0),(0,I.d)([(0,j.C)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"metallicTexture",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"metallic",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"roughness",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"metallicF0Factor",void 0),(0,I.d)([(0,j.g)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"metallicReflectanceColor",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,I.d)([(0,j.C)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"metallicReflectanceTexture",void 0),(0,I.d)([(0,j.C)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"reflectanceTexture",void 0),(0,I.d)([(0,j.C)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"microSurfaceTexture",void 0),(0,I.d)([(0,j.C)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"bumpTexture",void 0),(0,I.d)([(0,j.C)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty",null)],c.prototype,"lightmapTexture",void 0),(0,I.d)([(0,j.g)("ambient"),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"ambientColor",void 0),(0,I.d)([(0,j.g)("albedo"),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"albedoColor",void 0),(0,I.d)([(0,j.g)("reflectivity"),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"reflectivityColor",void 0),(0,I.d)([(0,j.g)("reflection"),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"reflectionColor",void 0),(0,I.d)([(0,j.g)("emissive"),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"emissiveColor",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"microSurface",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"useLightmapAsShadowmap",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],c.prototype,"useAlphaFromAlbedoTexture",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],c.prototype,"forceAlphaTest",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],c.prototype,"alphaCutOff",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"useSpecularOverAlpha",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"useAmbientInGrayScale",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,I.d)([(0,j.H)()],c.prototype,"usePhysicalLightFalloff",null),(0,I.d)([(0,j.H)()],c.prototype,"useGLTFLightFalloff",null),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"useRadianceOverAlpha",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"useObjectSpaceNormalMap",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"useParallax",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"useParallaxOcclusion",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"parallaxScaleBias",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsLightsDirty")],c.prototype,"disableLighting",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"forceIrradianceInFragment",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsLightsDirty")],c.prototype,"maxSimultaneousLights",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"invertNormalMapX",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"invertNormalMapY",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"twoSidedLighting",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"useAlphaFresnel",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"useLinearAlphaFresnel",void 0),(0,I.d)([(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"environmentBRDFTexture",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"forceNormalForward",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"enableSpecularAntiAliasing",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"useHorizonOcclusion",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"useRadianceOcclusion",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsMiscDirty")],c.prototype,"unlit",void 0),(0,I.d)([(0,j.H)(),(0,j.b)("_markAllSubMeshesAsMiscDirty")],c.prototype,"applyDecalMapAfterDetailMap",void 0),(0,n.f)("BABYLON.PBRMaterial",c);var z=h(11376),Z=h(11461),Y=h(11233),r=h(11442),w=h(11456),N=h(11419);class H{get influence(){return this._influence}set influence(E){if(this._influence===E)return;const b=this._influence;this._influence=E,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===b||0===E)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(E){this._animationPropertiesOverride=E}constructor(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=E,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new s.e,this._onDataLayoutChanged=new s.e,this._animationPropertiesOverride=null,this.id=E,this._scene=h||u.b.LastCreatedScene,this.influence=b,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}setPositions(E){const b=this.hasPositions;this._positions=E,b!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(E){const b=this.hasNormals;this._normals=E,b!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(E){const b=this.hasTangents;this._tangents=E,b!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(E){const b=this.hasUVs;this._uvs=E,b!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}clone(){const E=d.e.Clone((()=>new H(this.name,this.influence,this._scene)),this);return E._positions=this._positions,E._normals=this._normals,E._tangents=this._tangents,E._uvs=this._uvs,E}serialize(){const E={};return E.name=this.name,E.influence=this.influence,E.xa=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(E.id=this.id),this.hasNormals&&(E.ya=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(E.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(E.Aa=Array.prototype.slice.call(this.getUVs())),d.e.AppendSerializedAnimations(this,E),E}getClassName(){return"MorphTarget"}static Parse(E,b){const h=new H(E.name,E.influence);if(h.setPositions(E.xa),null!=E.id&&(h.id=E.id),E.ya&&h.setNormals(E.ya),E.tangents&&h.setTangents(E.tangents),E.Aa&&h.setUVs(E.Aa),E.animations){for(let b=0;b<E.animations.length;b++){const a=E.animations[b],k=(0,n.d)("BABYLON.Animation");k&&h.animations.push(k.Parse(a))}E.autoAnimate&&b&&b.beginAnimation(h,E.autoAnimateFrom,E.autoAnimateTo,E.autoAnimateLoop,E.autoAnimateSpeed||1)}return h}static FromMesh(E,b,h){b||(b=E.name);const a=new H(b,h,E.va());return a.setPositions(E.getVerticesData(Y.g.PositionKind)),E.isVerticesDataPresent(Y.g.NormalKind)&&a.setNormals(E.getVerticesData(Y.g.NormalKind)),E.isVerticesDataPresent(Y.g.TangentKind)&&a.setTangents(E.getVerticesData(Y.g.TangentKind)),E.isVerticesDataPresent(Y.g.UVKind)&&a.setUVs(E.getVerticesData(Y.g.UVKind)),a}}(0,I.d)([(0,j.H)()],H.prototype,"id",void 0);var f=h(11155),F=h(12032);class y{set areUpdatesFrozen(E){E?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(!0)))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new f.e(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,E||(E=u.b.LastCreatedScene),this._scene=E,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const E=this._scene.getEngine().getCaps();this._canUseTextureForTargets=E.canUseGLVertexID&&E.textureFloat&&E.maxVertexTextureImageUnits>0&&E.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return this._numMaxInfluencers}set numMaxInfluencers(E){this._numMaxInfluencers!==E&&(this._numMaxInfluencers=E,this._syncActiveTargets(!0))}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(E){this._useTextureToStoreTargets=E}get isUsingTextureForTargets(){var E;return y.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(E=this._scene)&&void 0!==E&&E.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(E){return this._activeTargets.data[E]}getTarget(E){return this._targets[E]}getTargetByName(E){for(const b of this._targets)if(b.name===E)return b;return null}addTarget(E){this._targets.push(E),this._targetInfluenceChangedObservers.push(E.onInfluenceChanged.add((E=>{this._syncActiveTargets(E)}))),this._targetDataLayoutChangedObservers.push(E._onDataLayoutChanged.add((()=>{this._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)}removeTarget(E){const b=this._targets.indexOf(E);b>=0&&(this._targets.splice(b,1),E.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(b,1)[0]),E._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(b,1)[0]),this._syncActiveTargets(!0)),this._scene&&this._scene.stopAnimation(E)}_bind(E){E.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),E.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),E.setTexture("morphTargets",this._targetStoreTexture),E.setInt("morphTargetCount",this.numInfluencers)}clone(){const E=new y(this._scene);for(const b of this._targets)E.addTarget(b.clone());return E.enableNormalMorphing=this.enableNormalMorphing,E.enableTangentMorphing=this.enableTangentMorphing,E.enableUVMorphing=this.enableUVMorphing,E}serialize(){const E={};E.id=this.uniqueId,E.targets=[];for(const b of this._targets)E.targets.push(b.serialize());return E}_syncActiveTargets(E){if(this.areUpdatesFrozen)return;let b=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,this._scene&&this._targets.length>this._scene.getEngine().getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let h=-1;for(const a of this._targets){if(h++,0===a.influence&&this.optimizeInfluencers)continue;if(this._activeTargets.length>=y.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(a),this._morphTargetTextureIndices[b]=h,this._tempInfluences[b++]=a.influence,this._supportsNormals=this._supportsNormals&&a.hasNormals,this._supportsTangents=this._supportsTangents&&a.hasTangents,this._supportsUVs=this._supportsUVs&&a.hasUVs;const E=a.getPositions();if(E){const b=E.length/3;if(0===this._vertexCount)this._vertexCount=b;else if(this._vertexCount!==b)return void D.c.Error("Incompatible target. Targets must all have the same vertices count.")}}this._morphTargetTextureIndices.length!==b&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,b)),this._influences&&this._influences.length===b||(this._influences=new Float32Array(b));for(let a=0;a<b;a++)this._influences[a]=this._tempInfluences[a];E&&this.synchronize()}synchronize(){if(this._scene&&!this.areUpdatesFrozen){if(this.isUsingTextureForTargets&&(this._vertexCount||this.numMaxInfluencers>0)){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const E=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>E&&(this._textureHeight=Math.ceil(this._textureWidth/E),this._textureWidth=E);let b=!0;if(this._targetStoreTexture){const E=this._targetStoreTexture.getSize();E.width===this._textureWidth&&E.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(b=!1)}if(b){this._targetStoreTexture&&this._targetStoreTexture.dispose();const E=this._targets.length,b=new Float32Array(E*this._textureWidth*this._textureHeight*4);let h=0;for(let a=0;a<E;a++){const E=this._targets[a],k=E.getPositions(),G=E.getNormals(),V=E.getUVs(),l=E.getTangents();if(!k)return void(0===a&&D.c.Error("Invalid morph target. Target must have positions."));h=a*this._textureWidth*this._textureHeight*4;for(let a=0;a<this._vertexCount;a++)b[h]=k[3*a],b[h+1]=k[3*a+1],b[h+2]=k[3*a+2],h+=4,this._supportsNormals&&G&&(b[h]=G[3*a],b[h+1]=G[3*a+1],b[h+2]=G[3*a+2],h+=4),this._supportsUVs&&V&&(b[h]=V[2*a],b[h+1]=V[2*a+1],h+=4),this._supportsTangents&&l&&(b[h]=l[3*a],b[h+1]=l[3*a+1],b[h+2]=l[3*a+2],h+=4)}this._targetStoreTexture=F.b.CreateRGBATexture(b,this._textureWidth,this._textureHeight,E,this._scene,!1,!1,1,1)}}for(const E of this._scene.meshes)E.morphTargetManager===this&&E._syncGeometryWithMorphTargetManager()}}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const E=this._parentContainer.morphTargetManagers.indexOf(this);E>-1&&this._parentContainer.morphTargetManagers.splice(E,1),this._parentContainer=null}for(const E of this._targets)this._scene.stopAnimation(E)}}static Parse(E,b){const h=new y(b);for(const a of E.targets)h.addTarget(H.Parse(a,b));return h}}y.EnableTextureStorage=!0,y.MaxActiveMorphTargetsInVertexAttributeMode=8;var e=h(12168),J=h(10878),m=h(11325);function K(E,b,h,a){return k.k.jh(b,h).scaleInPlace(a)}class x{constructor(E,b,h,a){this.type=E,this.name=b,this.getValue=h,this.getStride=a}_buildAnimation(E,b,h){const a=new B.c(E,this.name,b,this.type);return a.setKeys(h),a}}class W extends x{buildAnimations(E,b,h,a,k){k(E._babylonTransformNode,this._buildAnimation(b,h,a))}}const L={translation:[new W(B.c.ANIMATIONTYPE_VECTOR3,"position",K,(()=>3))],rotation:[new W(B.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",(function(E,b,h,a){return k.g.jh(b,h).scaleInPlace(a)}),(()=>4))],scale:[new W(B.c.ANIMATIONTYPE_VECTOR3,"ve",K,(()=>3))],weights:[new class extends x{buildAnimations(E,b,h,a,k){if(E._numMorphTargets)for(let G=0;G<E._numMorphTargets;G++){const V=new B.c(`${b}_${G}`,this.name,h,this.type);if(V.setKeys(a.map((E=>({frame:E.frame,inTangent:E.inTangent?E.inTangent[G]:void 0,value:E.value[G],outTangent:E.outTangent?E.outTangent[G]:void 0,interpolation:E.interpolation})))),E._primitiveBabylonMeshes)for(const b of E._primitiveBabylonMeshes)if(b.morphTargetManager){const E=b.morphTargetManager.getTarget(G),h=V.clone();E.animations.push(h),k(E,h)}}}}(B.c.ANIMATIONTYPE_FLOAT,"influence",(function(E,b,h,a){const k=new Array(E._numMorphTargets);for(let G=0;G<k.length;G++)k[G]=b[h++]*a;return k}),(E=>E._numMorphTargets))]},t=new Map,T=t;function X(E,b,h){C(E)&&D.c.Warn(`Extension with the name '${E}' already exists`),t.set(E,{isGLTFExtension:b,factory:h})}function C(E){return t.delete(E)}function q(){const E=E=>E&&"object"===typeof E;for(var b=arguments.length,h=new Array(b),a=0;a<b;a++)h[a]=arguments[a];return h.reduce(((b,h)=>(Object.keys(h).forEach((a=>{const k=b[a],G=h[a];Array.isArray(k)&&Array.isArray(G)?b[a]=k.concat(...G):E(k)&&E(G)?b[a]=q(k,G):b[a]=G})),b)),{})}class R{static Get(E,b,h){if(!b||void 0==h||!b[h])throw new Error(`${E}: Failed to find index (${h})`);return b[h]}static TryGet(E,b){return E&&void 0!=b&&E[b]?E[b]:null}static Assign(E){if(E)for(let b=0;b<E.length;b++)E[b].index=b}}class Q{static RegisterExtension(E,b){X(E,!1,b)}static UnregisterExtension(E){return C(E)}get Wi(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(E){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=E}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((E=>E.dispose&&E.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}importMeshAsync(E,b,h,a,k,G){let V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return Promise.resolve().then((()=>{this._babylonScene=b,this._assetContainer=h,this._loadData(a);let G=null;if(E){const b={};if(this._gltf.nodes)for(const E of this._gltf.nodes)E.name&&(b[E.name]=E.index);G=(E instanceof Array?E:[E]).map((E=>{const h=b[E];if(void 0===h)throw new Error(`Failed to find node '${E}'`);return h}))}return this._loadAsync(k,V,G,(()=>({meshes:this._getMeshes(),yj:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}loadAsync(E,b,h,a){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return Promise.resolve().then((()=>(this._babylonScene=E,this._loadData(b),this._loadAsync(h,k,null,(()=>{})))))}_loadAsync(E,b,h,a){return Promise.resolve().then((async()=>{this._rootUrl=E,this._uniqueRootUrl=!E.startsWith("file:")&&b?E:`${E}${Date.now()}/`,this._fileName=b,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const k=`${e.l[e.l.LOADING]} => ${e.l[e.l.READY]}`,G=`${e.l[e.l.LOADING]} => ${e.l[e.l.COMPLETE]}`;this._parent._startPerformanceCounter(k),this._parent._startPerformanceCounter(G),this._parent._setState(e.l.LOADING),this._extensionsOnLoading();const l=new Array;if(!this.parent.loadOnlyMaterials)if(h)l.push(this.loadSceneAsync("/nodes",{nodes:h,index:-1}));else if(void 0!=this._gltf.Xd||this._gltf.scenes&&this._gltf.scenes[0]){const E=R.Get("/scene",this._gltf.scenes,this._gltf.Xd||0);l.push(this.loadSceneAsync(`/scenes/${E.index}`,E))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let E=0;E<this._gltf.materials.length;++E){const b=this._gltf.materials[E],h="/materials/"+E,a=M.c.TriangleFillMode;l.push(this._loadMaterialAsync(h,b,null,a,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&l.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&l.push(this._compileShadowGeneratorsAsync());return Promise.all(l).then((()=>(this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Gb(!0),this._extensionsOnReady(),this._parent._setState(e.l.READY),this._startAnimations(),a()))).then((E=>(this._parent._endPerformanceCounter(k),V.g.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(G),this._parent._setState(e.l.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(E=>{this._parent.onErrorObservable.notifyObservers(E),this._parent.onErrorObservable.clear(),this.dispose()}))})),E)))})).catch((E=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(E),this._parent.onErrorObservable.clear(),this.dispose()),E}))}_loadData(E){if(this._gltf=E.json,this._setupData(),E.bin){const b=this._gltf.buffers;if(b&&b[0]&&!b[0].uri){const h=b[0];(h.byteLength<E.bin.byteLength-3||h.byteLength>E.bin.byteLength)&&D.c.Warn(`Binary buffer length (${h.byteLength}) from JSON does not match chunk length (${E.bin.byteLength})`),this._bin=E.bin}else D.c.Warn("Unexpected BIN chunk")}}_setupData(){if(R.Assign(this._gltf.accessors),R.Assign(this._gltf.animations),R.Assign(this._gltf.buffers),R.Assign(this._gltf.bufferViews),R.Assign(this._gltf.cameras),R.Assign(this._gltf.images),R.Assign(this._gltf.materials),R.Assign(this._gltf.meshes),R.Assign(this._gltf.nodes),R.Assign(this._gltf.samplers),R.Assign(this._gltf.scenes),R.Assign(this._gltf.skins),R.Assign(this._gltf.textures),this._gltf.nodes){const E={};for(const h of this._gltf.nodes)if(h.children)for(const b of h.children)E[b]=h.index;const b=this._createRootNode();for(const h of this._gltf.nodes){const a=E[h.index];h.parent=void 0===a?b:this._gltf.nodes[a]}}}async _loadExtensionsAsync(){const E=[];if(T.forEach(((b,h)=>{var a;!1===(null===(a=this.parent.extensionOptions[h])||void 0===a?void 0:a.enabled)?b.isGLTFExtension&&this.isExtensionUsed(h)&&D.c.Warn(`Extension ${h} is used but has been explicitly disabled.`):b.isGLTFExtension&&!this.isExtensionUsed(h)||E.push((async()=>{const E=await b.factory(this);return E.name!==h&&D.c.Warn(`The name of the glTF loader extension instance does not match the registered name: ${E.name} !== ${h}`),this._parent.onExtensionLoadedObservable.notifyObservers(E),E})())})),this._extensions.push(...await Promise.all(E)),this._extensions.sort(((E,b)=>(E.order||Number.MAX_VALUE)-(b.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const h of this._gltf.extensionsRequired){if(!this._extensions.some((E=>E.name===h&&E.enabled))){var b;if(!1===(null===(b=this.parent.extensionOptions[h])||void 0===b?void 0:b.enabled))throw new Error(`Required extension ${h} is disabled`);throw new Error(`Required extension ${h} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const E=new N.b("__root__",this._babylonScene);this._rootBabylonMesh=E,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Gb(!1);const b={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case e.k.AUTO:this._babylonScene.useRightHandedSystem||(b.rotation=[0,1,0,0],b.scale=[1,1,-1],Q._LoadTransform(b,this._rootBabylonMesh));break;case e.k.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(E),b}loadSceneAsync(E,b){const h=this._extensionsLoadSceneAsync(E,b);if(h)return h;const a=new Array;if(this.logOpen(`${E} ${b.name||""}`),b.nodes)for(const k of b.nodes){const b=R.Get(`${E}/nodes/${k}`,this._gltf.nodes,k);a.push(this.loadNodeAsync(`/nodes/${b.index}`,b,(E=>{E.parent=this._rootBabylonMesh})))}for(const k of this._postSceneLoadActions)k();return a.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(a).then((()=>{}))}_forEachPrimitive(E,b){if(E._primitiveBabylonMeshes)for(const h of E._primitiveBabylonMeshes)b(h)}_getGeometries(){const E=[],b=this._gltf.nodes;if(b)for(const h of b)this._forEachPrimitive(h,(b=>{const h=b.Lj;h&&-1===E.indexOf(h)&&E.push(h)}));return E}_getMeshes(){const E=[];this._rootBabylonMesh instanceof w.b&&E.push(this._rootBabylonMesh);const b=this._gltf.nodes;if(b)for(const h of b)this._forEachPrimitive(h,(b=>{E.push(b)}));return E}_getTransformNodes(){const E=[],b=this._gltf.nodes;if(b)for(const h of b)h._babylonTransformNode&&"sb"===h._babylonTransformNode.getClassName()&&E.push(h._babylonTransformNode),h._babylonTransformNodeForSkin&&E.push(h._babylonTransformNodeForSkin);return E}_getSkeletons(){const E=[],b=this._gltf.skins;if(b)for(const h of b)h._data&&E.push(h._data.babylonSkeleton);return E}_getAnimationGroups(){const E=[],b=this._gltf.animations;if(b)for(const h of b)h._babylonAnimationGroup&&E.push(h._babylonAnimationGroup);return E}_startAnimations(){switch(this._parent.animationStartMode){case e.h.NONE:break;case e.h.FIRST:{const E=this._getAnimationGroups();0!==E.length&&E[0].start(!0);break}case e.h.ALL:{const E=this._getAnimationGroups();for(const b of E)b.start(!0);break}default:return void D.c.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const a=this._extensionsLoadNodeAsync(E,b,h);if(a)return a;if(b._babylonTransformNode)throw new Error(`${E}: Invalid recursive node hierarchy`);const k=new Array;this.logOpen(`${E} ${b.name||""}`);const G=a=>{if(Q.AddPointerMetadata(a,E),Q._LoadTransform(b,a),void 0!=b.camera){const h=R.Get(`${E}/camera`,this._gltf.cameras,b.camera);k.push(this.loadCameraAsync(`/cameras/${h.index}`,h,(E=>{E.parent=a})))}if(b.children)for(const h of b.children){const b=R.Get(`${E}/children/${h}`,this._gltf.nodes,h);k.push(this.loadNodeAsync(`/nodes/${b.index}`,b,(E=>{E.parent=a})))}h(a)},V=void 0!=b.mesh,l=this._parent.loadSkins&&void 0!=b.skin;if(!V||l){const E=b.name||`node${b.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const h=new Z.c(E,this._babylonScene);h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==b.mesh?b._babylonTransformNode=h:b._babylonTransformNodeForSkin=h,G(h)}if(V)if(l){const h=R.Get(`${E}/mesh`,this._gltf.meshes,b.mesh);k.push(this._loadMeshAsync(`/meshes/${h.index}`,b,h,(h=>{const a=b._babylonTransformNodeForSkin;h.metadata=q(a.metadata,h.metadata||{});const G=R.Get(`${E}/skin`,this._gltf.skins,b.skin);k.push(this._loadSkinAsync(`/skins/${G.index}`,b,G,(E=>{this._forEachPrimitive(b,(b=>{b.skeleton=E})),this._postSceneLoadActions.push((()=>{if(void 0!=G.skeleton){const E=R.Get(`/skins/${G.index}/skeleton`,this._gltf.nodes,G.skeleton).parent;b.index===E.index?h.parent=a.parent:h.parent=E._babylonTransformNode}else h.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:a,skinnedNode:h})}))})))})))}else{const h=R.Get(`${E}/mesh`,this._gltf.meshes,b.mesh);k.push(this._loadMeshAsync(`/meshes/${h.index}`,b,h,G))}return this.logClose(),Promise.all(k).then((()=>(this._forEachPrimitive(b,(E=>{E.Lj&&E.Lj.useBoundingInfoFromGeometry?E.Ea():E.refreshBoundingInfo(!0,!0)})),b._babylonTransformNode)))}_loadMeshAsync(E,b,h,a){const k=h.primitives;if(!k||!k.length)throw new Error(`${E}: Primitives are missing`);void 0==k[0].index&&R.Assign(k);const G=new Array;this.logOpen(`${E} ${h.name||""}`);const V=b.name||`node${b.index}`;if(1===k.length){const a=h.primitives[0];G.push(this._loadMeshPrimitiveAsync(`${E}/primitives/${a.index}`,V,b,h,a,(E=>{b._babylonTransformNode=E,b._primitiveBabylonMeshes=[E]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,b._babylonTransformNode=new Z.c(V,this._babylonScene),b._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b._primitiveBabylonMeshes=[];for(const a of k)G.push(this._loadMeshPrimitiveAsync(`${E}/primitives/${a.index}`,`${V}_primitive${a.index}`,b,h,a,(E=>{E.parent=b._babylonTransformNode,b._primitiveBabylonMeshes.push(E)})))}return a(b._babylonTransformNode),this.logClose(),Promise.all(G).then((()=>b._babylonTransformNode))}_loadMeshPrimitiveAsync(E,b,h,a,k,G){const V=this._extensionsLoadMeshPrimitiveAsync(E,b,h,a,k,G);if(V)return V;this.logOpen(`${E}`);const l=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==h.skin&&!a.primitives[0].targets;let O,v;if(l&&k._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,O=k._instanceData.babylonSourceMesh.createInstance(b),O._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,v=k._instanceData.promise;else{const G=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const V=new N.b(b,this._babylonScene);V._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,V.sideOrientation=this._babylonScene.useRightHandedSystem?M.c.CounterClockWiseSideOrientation:M.c.ClockWiseSideOrientation,this._createMorphTargets(E,h,a,k,V),G.push(this._loadVertexDataAsync(E,k,V).then((b=>this._loadMorphTargetsAsync(E,k,V,b).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,b.Ca(V),b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const s=Q._GetDrawMode(E,k.mode);if(void 0==k.material){let E=this._defaultBabylonMaterialData[s];E||(E=this._createDefaultMaterial("__GLTFLoader._default",s),this._parent.onMaterialLoadedObservable.notifyObservers(E),this._defaultBabylonMaterialData[s]=E),V.material=E}else if(!this.parent.skipMaterials){const b=R.Get(`${E}/material`,this._gltf.materials,k.material);G.push(this._loadMaterialAsync(`/materials/${b.index}`,b,V,s,(E=>{V.material=E})))}v=Promise.all(G),l&&(k._instanceData={babylonSourceMesh:V,promise:v}),O=V}return Q.AddPointerMetadata(O,E),this._parent.onMeshLoadedObservable.notifyObservers(O),G(O),this.logClose(),v.then((()=>O))}_loadVertexDataAsync(E,b,h){const a=this._extensionsLoadVertexDataAsync(E,b,h);if(a)return a;const G=b.attributes;if(!G)throw new Error(`${E}: Attributes are missing`);const V=new Array,l=new r.e(h.name,this._babylonScene);if(void 0==b.indices)h.isUnIndexed=!0;else{const h=R.Get(`${E}/indices`,this._gltf.accessors,b.indices);V.push(this._loadIndicesAccessorAsync(`/accessors/${h.index}`,h).then((E=>{l.setIndices(E)})))}const O=(b,a,O)=>{if(void 0==G[b])return;h._delayInfo=h._delayInfo||[],-1===h._delayInfo.indexOf(a)&&h._delayInfo.push(a);const v=R.Get(`${E}/attributes/${b}`,this._gltf.accessors,G[b]);V.push(this._loadVertexAccessorAsync(`/accessors/${v.index}`,v,a).then((E=>{if(E.getKind()===Y.g.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!h.skeleton&&v.min&&v.max){const E=k.h.o[0].ue(...v.min),b=k.h.o[1].ue(...v.max);if(v.normalized&&5126!==v.componentType){let h=1;switch(v.componentType){case 5120:h=127;break;case 5121:h=255;break;case 5122:h=32767;break;case 5123:h=65535}const a=1/h;E.scaleInPlace(a),b.scaleInPlace(a)}l._boundingInfo=new m.b(E,b),l.useBoundingInfoFromGeometry=!0}l.setVerticesBuffer(E,v.count)}))),a==Y.g.MatricesIndicesExtraKind&&(h.numBoneInfluencers=8),O&&O(v)};return O("POSITION",Y.g.PositionKind),O("NORMAL",Y.g.NormalKind),O("TANGENT",Y.g.TangentKind),O("TEXCOORD_0",Y.g.UVKind),O("TEXCOORD_1",Y.g.UV2Kind),O("TEXCOORD_2",Y.g.UV3Kind),O("TEXCOORD_3",Y.g.UV4Kind),O("TEXCOORD_4",Y.g.UV5Kind),O("TEXCOORD_5",Y.g.UV6Kind),O("JOINTS_0",Y.g.MatricesIndicesKind),O("WEIGHTS_0",Y.g.MatricesWeightsKind),O("JOINTS_1",Y.g.MatricesIndicesExtraKind),O("WEIGHTS_1",Y.g.MatricesWeightsExtraKind),O("COLOR_0",Y.g.ColorKind,(E=>{"VEC4"===E.type&&(h.hasVertexAlpha=!0)})),Promise.all(V).then((()=>l))}_createMorphTargets(E,b,h,a,k){if(!a.targets||!this._parent.loadMorphTargets)return;if(void 0==b._numMorphTargets)b._numMorphTargets=a.targets.length;else if(a.targets.length!==b._numMorphTargets)throw new Error(`${E}: Primitives do not have the same number of targets`);const G=h.extras?h.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,k.morphTargetManager=new y(this._babylonScene),k.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,k.morphTargetManager.areUpdatesFrozen=!0;for(let V=0;V<a.targets.length;V++){const E=b.weights?b.weights[V]:h.weights?h.weights[V]:0,a=G?G[V]:`morphTarget${V}`;k.morphTargetManager.addTarget(new H(a,E,k.va()))}}_loadMorphTargetsAsync(E,b,h,a){if(!b.targets||!this._parent.loadMorphTargets)return Promise.resolve();const k=new Array,G=h.morphTargetManager;for(let V=0;V<G.numTargets;V++){const h=G.getTarget(V);k.push(this._loadMorphTargetVertexDataAsync(`${E}/targets/${V}`,a,b.targets[V],h))}return Promise.all(k).then((()=>{G.areUpdatesFrozen=!1}))}_loadMorphTargetVertexDataAsync(E,b,h,a){const k=new Array,G=(a,G,V)=>{if(void 0==h[a])return;const l=b.getVertexBuffer(G);if(!l)return;const O=R.Get(`${E}/${a}`,this._gltf.accessors,h[a]);k.push(this._loadFloatAccessorAsync(`/accessors/${O.index}`,O).then((E=>{V(l,E)})))};return G("POSITION",Y.g.PositionKind,((E,b)=>{const h=new Float32Array(b.length);E.forEach(b.length,((E,a)=>{h[a]=b[a]+E})),a.setPositions(h)})),G("NORMAL",Y.g.NormalKind,((E,b)=>{const h=new Float32Array(b.length);E.forEach(h.length,((E,a)=>{h[a]=b[a]+E})),a.setNormals(h)})),G("TANGENT",Y.g.TangentKind,((E,b)=>{const h=new Float32Array(b.length/3*4);let k=0;E.forEach(b.length/3*4,((E,a)=>{(a+1)%4!==0&&(h[k]=b[k]+E,k++)})),a.setTangents(h)})),Promise.all(k).then((()=>{}))}static _LoadTransform(E,b){if(void 0!=E.skin)return;let h=k.k.Zero(),a=k.g.Identity(),G=k.k.One();if(E.matrix){k.d.jh(E.matrix).decompose(G,a,h)}else E.translation&&(h=k.k.jh(E.translation)),E.rotation&&(a=k.g.jh(E.rotation)),E.scale&&(G=k.k.jh(E.scale));b.position=h,b.rotationQuaternion=a,b.ve=G}_loadSkinAsync(E,b,h,a){if(!this._parent.loadSkins)return Promise.resolve();const k=this._extensionsLoadSkinAsync(E,b,h);if(k)return k;if(h._data)return a(h._data.babylonSkeleton),h._data.promise;const G=`skeleton${h.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const V=new S(h.name||G,G,this._babylonScene);V._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(E,h,V);const l=this._loadSkinInverseBindMatricesDataAsync(E,h).then((E=>{this._updateBoneMatrices(V,E)}));return h._data={babylonSkeleton:V,promise:l},a(V),l}_loadBones(E,b,h){if(void 0==b.skeleton||this._parent.alwaysComputeSkeletonRootNode){const h=this._findSkeletonRootNode(`${E}/joints`,b.joints);if(h)if(void 0===b.skeleton)b.skeleton=h.index;else{const a=(E,b)=>{for(;b.parent;b=b.parent)if(b.parent===E)return!0;return!1},k=R.Get(`${E}/skeleton`,this._gltf.nodes,b.skeleton);k===h||a(k,h)||(D.c.Warn(`${E}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),b.skeleton=h.index)}else D.c.Warn(`${E}: Failed to find common root`)}const a={};for(const k of b.joints){const G=R.Get(`${E}/joints/${k}`,this._gltf.nodes,k);this._loadBone(G,b,h,a)}}_findSkeletonRootNode(E,b){if(0===b.length)return null;const h={};for(const k of b){const b=[];let a=R.Get(`${E}/${k}`,this._gltf.nodes,k);for(;-1!==a.index;)b.unshift(a),a=a.parent;h[k]=b}let a=null;for(let k=0;;++k){let E=h[b[0]];if(k>=E.length)return a;const G=E[k];for(let V=1;V<b.length;++V)if(E=h[b[V]],k>=E.length||G!==E[k])return a;a=G}}_loadBone(E,b,h,a){E._isJoint=!0;let k=a[E.index];if(k)return k;let G=null;E.index!==b.skeleton&&(E.parent&&-1!==E.parent.index?G=this._loadBone(E.parent,b,h,a):void 0!==b.skeleton&&D.c.Warn(`/skins/${b.index}/skeleton: Skeleton node is not a common root`));const V=b.joints.indexOf(E.index);return k=new v.e(E.name||`joint${E.index}`,h,G,this._getNodeMatrix(E),null,null,V),a[E.index]=k,this._postSceneLoadActions.push((()=>{k.linkTransformNode(E._babylonTransformNode)})),k}_loadSkinInverseBindMatricesDataAsync(E,b){if(void 0==b.inverseBindMatrices)return Promise.resolve(null);const h=R.Get(`${E}/inverseBindMatrices`,this._gltf.accessors,b.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${h.index}`,h)}_updateBoneMatrices(E,b){for(const h of E.bones){const E=k.d.Identity(),a=h._index;b&&-1!==a&&(k.d.FromArrayToRef(b,16*a,E),E.invertToRef(E));const G=h.getParent();G&&E.multiplyToRef(G.getAbsoluteInverseBindMatrix(),E),h.Pj(E,!1,!1),h._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(E){return E.matrix?k.d.jh(E.matrix):k.d.Compose(E.scale?k.k.jh(E.scale):k.k.One(),E.rotation?k.g.jh(E.rotation):k.g.Identity(),E.translation?k.k.jh(E.translation):k.k.Zero())}loadCameraAsync(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const a=this._extensionsLoadCameraAsync(E,b,h);if(a)return a;const G=new Array;this.logOpen(`${E} ${b.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const V=new O.d(b.name||`camera${b.index}`,k.k.Zero(),this._babylonScene,!1);switch(V._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,V.ignoreParentScaling=!0,b._babylonCamera=V,V.rotation.set(0,Math.PI,0),b.type){case"perspective":{const h=b.perspective;if(!h)throw new Error(`${E}: Camera perspective properties are missing`);V.fov=h.yfov,V.cj=h.znear,V.maxZ=h.zfar||0;break}case"orthographic":if(!b.orthographic)throw new Error(`${E}: Camera orthographic properties are missing`);V.mode=l.b.ORTHOGRAPHIC_CAMERA,V.orthoLeft=-b.orthographic.xmag,V.orthoRight=b.orthographic.xmag,V.orthoBottom=-b.orthographic.ymag,V.orthoTop=b.orthographic.ymag,V.cj=b.orthographic.znear,V.maxZ=b.orthographic.zfar;break;default:throw new Error(`${E}: Invalid camera type (${b.type})`)}return Q.AddPointerMetadata(V,E),this._parent.onCameraLoadedObservable.notifyObservers(V),h(V),this.logClose(),Promise.all(G).then((()=>V))}_loadAnimationsAsync(){const E=this._gltf.animations;if(!E)return Promise.resolve();const b=new Array;for(let h=0;h<E.length;h++){const a=E[h];b.push(this.loadAnimationAsync(`/animations/${a.index}`,a).then((E=>{0===E.targetedAnimations.length&&E.dispose()})))}return Promise.all(b).then((()=>{}))}loadAnimationAsync(E,b){const a=this._extensionsLoadAnimationAsync(E,b);return a||h.e(38).then(h.bind(h,13377)).then((h=>{let{AnimationGroup:a}=h;this._babylonScene._blockEntityCollection=!!this._assetContainer;const k=new a(b.name||`animation${b.index}`,this._babylonScene);k._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b._babylonAnimationGroup=k;const G=new Array;R.Assign(b.channels),R.Assign(b.samplers);for(const V of b.channels)G.push(this._loadAnimationChannelAsync(`${E}/channels/${V.index}`,E,b,V,((E,b)=>{E.animations=E.animations||[],E.animations.push(b),k.addTargetedAnimation(b,E)})));return Promise.all(G).then((()=>(k.normalize(0),k)))}))}_loadAnimationChannelAsync(E,b,h,a,k){const G=this._extensionsLoadAnimationChannelAsync(E,b,h,a,k);if(G)return G;if(void 0==a.target.node)return Promise.resolve();const V=R.Get(`${E}/target/node`,this._gltf.nodes,a.target.node),l=a.target.path,O="weights"===l;if(O&&!V._numMorphTargets||!O&&!V._babylonTransformNode)return Promise.resolve();if(!this._parent.loadNodeAnimations&&!O&&!V._isJoint)return Promise.resolve();let v;switch(l){case"translation":v=L.translation;break;case"rotation":v=L.rotation;break;case"scale":v=L.scale;break;case"weights":v=L.weights;break;default:throw new Error(`${E}/target/path: Invalid value (${a.target.path})`)}const s={object:V,info:v};return this._loadAnimationChannelFromTargetInfoAsync(E,b,h,a,s,k)}_loadAnimationChannelFromTargetInfoAsync(E,b,h,a,k,G){const V=this.parent.targetFps,l=1/V,O=R.Get(`${E}/sampler`,h.samplers,a.sampler);return this._loadAnimationSamplerAsync(`${b}/samplers/${a.sampler}`,O).then((E=>{let b=0;const O=k.object,v=k.info;for(const k of v){const v=k.getStride(O),s=E.input,U=E.output,B=new Array(s.length);let o=0;switch(E.interpolation){case"STEP":for(let E=0;E<s.length;E++){const b=k.getValue(O,U,o,1);o+=v,B[E]={frame:s[E]*V,value:b,interpolation:1}}break;case"CUBICSPLINE":for(let E=0;E<s.length;E++){const b=k.getValue(O,U,o,l);o+=v;const h=k.getValue(O,U,o,1);o+=v;const a=k.getValue(O,U,o,l);o+=v,B[E]={frame:s[E]*V,inTangent:b,value:h,outTangent:a}}break;case"LINEAR":for(let E=0;E<s.length;E++){const b=k.getValue(O,U,o,1);o+=v,B[E]={frame:s[E]*V,value:b}}}if(o>0){const E=`${h.name||`animation${h.index}`}_channel${a.index}_${b}`;k.buildAnimations(O,E,V,B,((E,h)=>{++b,G(E,h)}))}}}))}_loadAnimationSamplerAsync(E,b){if(b._data)return b._data;const h=b.interpolation||"LINEAR";switch(h){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${E}/interpolation: Invalid value (${b.interpolation})`)}const a=R.Get(`${E}/input`,this._gltf.accessors,b.input),k=R.Get(`${E}/output`,this._gltf.accessors,b.output);return b._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${a.index}`,a),this._loadFloatAccessorAsync(`/accessors/${k.index}`,k)]).then((E=>{let[b,a]=E;return{input:b,interpolation:h,output:a}})),b._data}loadBufferAsync(E,b,h,a){const k=this._extensionsLoadBufferAsync(E,b,h,a);if(k)return k;if(!b._data)if(b.uri)b._data=this.loadUriAsync(`${E}/uri`,b,b.uri);else{if(!this._bin)throw new Error(`${E}: Uri is missing or the binary glTF is missing its binary chunk`);b._data=this._bin.readAsync(0,b.byteLength)}return b._data.then((b=>{try{return new Uint8Array(b.buffer,b.byteOffset+h,a)}catch(k){throw new Error(`${E}: ${k.message}`)}}))}loadBufferViewAsync(E,b){const h=this._extensionsLoadBufferViewAsync(E,b);if(h)return h;if(b._data)return b._data;const a=R.Get(`${E}/buffer`,this._gltf.buffers,b.buffer);return b._data=this.loadBufferAsync(`/buffers/${a.index}`,a,b.byteOffset||0,b.byteLength),b._data}_loadAccessorAsync(E,b,h){if(b._data)return b._data;const a=Q._GetNumComponents(E,b.type),k=a*Y.g.GetTypeByteLength(b.componentType),G=a*b.count;if(void 0==b.bufferView)b._data=Promise.resolve(new h(G));else{const V=R.Get(`${E}/bufferView`,this._gltf.bufferViews,b.bufferView);b._data=this.loadBufferViewAsync(`/bufferViews/${V.index}`,V).then((l=>{if(5126!==b.componentType||b.normalized||V.byteStride&&V.byteStride!==k){const E=new h(G);return Y.g.ForEach(l,b.byteOffset||0,V.byteStride||k,a,b.componentType,E.length,b.normalized||!1,((b,h)=>{E[h]=b})),E}return Q._GetTypedArray(E,b.componentType,l,b.byteOffset,G)}))}if(b.sparse){const G=b.sparse;b._data=b._data.then((V=>{const l=V,O=R.Get(`${E}/sparse/indices/bufferView`,this._gltf.bufferViews,G.indices.bufferView),v=R.Get(`${E}/sparse/values/bufferView`,this._gltf.bufferViews,G.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${O.index}`,O),this.loadBufferViewAsync(`/bufferViews/${v.index}`,v)]).then((V=>{let[O,v]=V;const s=Q._GetTypedArray(`${E}/sparse/indices`,G.indices.componentType,O,G.indices.byteOffset,G.count),U=a*G.count;let B;if(5126!==b.componentType||b.normalized){const V=Q._GetTypedArray(`${E}/sparse/values`,b.componentType,v,G.values.byteOffset,U);B=new h(U),Y.g.ForEach(V,0,k,a,b.componentType,B.length,b.normalized||!1,((E,b)=>{B[b]=E}))}else B=Q._GetTypedArray(`${E}/sparse/values`,b.componentType,v,G.values.byteOffset,U);let o=0;for(let E=0;E<s.length;E++){let b=s[E]*a;for(let E=0;E<a;E++)l[b++]=B[o++]}return l}))}))}return b._data}_loadFloatAccessorAsync(E,b){return this._loadAccessorAsync(E,b,Float32Array)}_loadIndicesAccessorAsync(E,b){if("SCALAR"!==b.type)throw new Error(`${E}/type: Invalid value ${b.type}`);if(5121!==b.componentType&&5123!==b.componentType&&5125!==b.componentType)throw new Error(`${E}/componentType: Invalid value ${b.componentType}`);if(b._data)return b._data;if(b.sparse){const h=Q._GetTypedArrayConstructor(`${E}/componentType`,b.componentType);b._data=this._loadAccessorAsync(E,b,h)}else{const h=R.Get(`${E}/bufferView`,this._gltf.bufferViews,b.bufferView);b._data=this.loadBufferViewAsync(`/bufferViews/${h.index}`,h).then((h=>Q._GetTypedArray(E,b.componentType,h,b.byteOffset,b.count)))}return b._data}_loadVertexBufferViewAsync(E){if(E._babylonBuffer)return E._babylonBuffer;const b=this._babylonScene.getEngine();return E._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${E.index}`,E).then((E=>new Y.d(b,E,!1))),E._babylonBuffer}_loadVertexAccessorAsync(E,b,h){var a;if(null!==(a=b._babylonVertexBuffer)&&void 0!==a&&a[h])return b._babylonVertexBuffer[h];b._babylonVertexBuffer||(b._babylonVertexBuffer={});const k=this._babylonScene.getEngine();if(b.sparse||void 0==b.bufferView)b._babylonVertexBuffer[h]=this._loadFloatAccessorAsync(E,b).then((E=>new Y.g(k,E,h,!1)));else{const a=R.Get(`${E}/bufferView`,this._gltf.bufferViews,b.bufferView);b._babylonVertexBuffer[h]=this._loadVertexBufferViewAsync(a).then((G=>{const V=Q._GetNumComponents(E,b.type);return new Y.g(k,G,h,!1,void 0,a.byteStride,void 0,b.byteOffset,V,b.componentType,b.normalized,!0,void 0,!0)}))}return b._babylonVertexBuffer[h]}_loadMaterialMetallicRoughnessPropertiesAsync(E,b,h){if(!(h instanceof c))throw new Error(`${E}: Material type not supported`);const a=new Array;return b&&(b.baseColorFactor?(h.albedoColor=G.b.jh(b.baseColorFactor),h.alpha=b.baseColorFactor[3]):h.albedoColor=G.b.White(),h.metallic=void 0==b.metallicFactor?1:b.metallicFactor,h.roughness=void 0==b.roughnessFactor?1:b.roughnessFactor,b.baseColorTexture&&a.push(this.loadTextureInfoAsync(`${E}/baseColorTexture`,b.baseColorTexture,(E=>{E.name=`${h.name} (Base Color)`,h.albedoTexture=E}))),b.metallicRoughnessTexture&&(b.metallicRoughnessTexture.nonColorData=!0,a.push(this.loadTextureInfoAsync(`${E}/metallicRoughnessTexture`,b.metallicRoughnessTexture,(E=>{E.name=`${h.name} (Metallic Roughness)`,h.metallicTexture=E}))),h.useMetallnessFromMetallicTextureBlue=!0,h.useRoughnessFromMetallicTextureGreen=!0,h.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(a).then((()=>{}))}_loadMaterialAsync(E,b,h,a){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const G=this._extensionsLoadMaterialAsync(E,b,h,a,k);if(G)return G;b._data=b._data||{};let V=b._data[a];if(!V){this.logOpen(`${E} ${b.name||""}`);const h=this.createMaterial(E,b,a);V={babylonMaterial:h,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(E,b,h)},b._data[a]=V,Q.AddPointerMetadata(h,E),this._parent.onMaterialLoadedObservable.notifyObservers(h),this.logClose()}return h&&(V.babylonMeshes.push(h),h.rj.addOnce((()=>{const E=V.babylonMeshes.indexOf(h);-1!==E&&V.babylonMeshes.splice(E,1)}))),k(V.babylonMaterial),V.promise.then((()=>V.babylonMaterial))}_createDefaultMaterial(E,b){this._babylonScene._blockEntityCollection=!!this._assetContainer;const h=new c(E,this._babylonScene);return h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,h.fillMode=b,h.enableSpecularAntiAliasing=!0,h.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,h.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,h.transparencyMode=c.PBRMATERIAL_OPAQUE,h.metallic=1,h.roughness=1,h}createMaterial(E,b,h){const a=this._extensionsCreateMaterial(E,b,h);if(a)return a;const k=b.name||`material${b.index}`;return this._createDefaultMaterial(k,h)}loadMaterialPropertiesAsync(E,b,h){const a=this._extensionsLoadMaterialPropertiesAsync(E,b,h);if(a)return a;const k=new Array;return k.push(this.loadMaterialBasePropertiesAsync(E,b,h)),b.pbrMetallicRoughness&&k.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${E}/pbrMetallicRoughness`,b.pbrMetallicRoughness,h)),this.loadMaterialAlphaProperties(E,b,h),Promise.all(k).then((()=>{}))}loadMaterialBasePropertiesAsync(E,b,h){if(!(h instanceof c))throw new Error(`${E}: Material type not supported`);const a=new Array;return h.emissiveColor=b.emissiveFactor?G.b.jh(b.emissiveFactor):new G.b(0,0,0),b.doubleSided&&(h.xh=!1,h.twoSidedLighting=!0),b.normalTexture&&(b.normalTexture.nonColorData=!0,a.push(this.loadTextureInfoAsync(`${E}/normalTexture`,b.normalTexture,(E=>{E.name=`${h.name} (Normal)`,h.bumpTexture=E}))),h.invertNormalMapX=!this._babylonScene.useRightHandedSystem,h.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=b.normalTexture.scale&&h.bumpTexture&&(h.bumpTexture.level=b.normalTexture.scale),h.forceIrradianceInFragment=!0),b.occlusionTexture&&(b.occlusionTexture.nonColorData=!0,a.push(this.loadTextureInfoAsync(`${E}/occlusionTexture`,b.occlusionTexture,(E=>{E.name=`${h.name} (Occlusion)`,h.ambientTexture=E}))),h.useAmbientInGrayScale=!0,void 0!=b.occlusionTexture.strength&&(h.ambientTextureStrength=b.occlusionTexture.strength)),b.emissiveTexture&&a.push(this.loadTextureInfoAsync(`${E}/emissiveTexture`,b.emissiveTexture,(E=>{E.name=`${h.name} (Emissive)`,h.emissiveTexture=E}))),Promise.all(a).then((()=>{}))}loadMaterialAlphaProperties(E,b,h){if(!(h instanceof c))throw new Error(`${E}: Material type not supported`);switch(b.alphaMode||"OPAQUE"){case"OPAQUE":h.transparencyMode=c.PBRMATERIAL_OPAQUE,h.alpha=1;break;case"MASK":h.transparencyMode=c.PBRMATERIAL_ALPHATEST,h.alphaCutOff=void 0==b.alphaCutoff?.5:b.alphaCutoff,h.albedoTexture&&(h.albedoTexture.Ie=!0);break;case"BLEND":h.transparencyMode=c.PBRMATERIAL_ALPHABLEND,h.albedoTexture&&(h.albedoTexture.Ie=!0,h.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${E}/alphaMode: Invalid value (${b.alphaMode})`)}}loadTextureInfoAsync(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const a=this._extensionsLoadTextureInfoAsync(E,b,h);if(a)return a;if(this.logOpen(`${E}`),b.texCoord>=6)throw new Error(`${E}/texCoord: Invalid value (${b.texCoord})`);const k=R.Get(`${E}/index`,this._gltf.textures,b.index);k._textureInfo=b;const G=this._loadTextureAsync(`/textures/${b.index}`,k,(a=>{a.coordinatesIndex=b.texCoord||0,Q.AddPointerMetadata(a,E),this._parent.onTextureLoadedObservable.notifyObservers(a),h(a)}));return this.logClose(),G}_loadTextureAsync(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const a=this._extensionsLoadTextureAsync(E,b,h);if(a)return a;this.logOpen(`${E} ${b.name||""}`);const k=void 0==b.sampler?Q.DefaultSampler:R.Get(`${E}/sampler`,this._gltf.samplers,b.sampler),G=R.Get(`${E}/source`,this._gltf.images,b.source),V=this._createTextureAsync(E,k,G,h,void 0,!b._textureInfo.nonColorData);return this.logClose(),V}_createTextureAsync(E,b,h){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},G=arguments.length>4?arguments[4]:void 0,V=arguments.length>5?arguments[5]:void 0;const l=this._loadSampler(`/samplers/${b.index}`,b),O=new Array,v=new a;this._babylonScene._blockEntityCollection=!!this._assetContainer;const s={noMipmap:l.noMipMaps,invertY:!1,samplingMode:l.samplingMode,X:()=>{this._disposed||v.resolve()},onError:(b,h)=>{this._disposed||v.reject(new Error(`${E}: ${h&&h.message?h.message:b||"Failed to load texture"}`))},mimeType:h.mimeType,loaderOptions:G,useSRGBBuffer:!!V&&this._parent.useSRGBBuffers},U=new z.b(null,this._babylonScene,s);return U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,O.push(v.promise),O.push(this.loadImageAsync(`/images/${h.index}`,h).then((E=>{const b=h.uri||`${this._fileName}#image${h.index}`,a=`data:${this._uniqueRootUrl}${b}`;U.updateURL(a,E);const k=U.getInternalTexture();k&&(k.label=h.name)}))),U.wrapU=l.wrapU,U.wrapV=l.wrapV,k(U),this._parent.useGltfTextureNames&&(U.name=h.name||h.uri||`image${h.index}`),Promise.all(O).then((()=>U))}_loadSampler(E,b){return b._data||(b._data={noMipMaps:9728===b.minFilter||9729===b.minFilter,samplingMode:Q._GetTextureSamplingMode(E,b),wrapU:Q._GetTextureWrapMode(`${E}/wrapS`,b.wrapS),wrapV:Q._GetTextureWrapMode(`${E}/wrapT`,b.wrapT)}),b._data}loadImageAsync(E,b){if(!b._data){if(this.logOpen(`${E} ${b.name||""}`),b.uri)b._data=this.loadUriAsync(`${E}/uri`,b,b.uri);else{const h=R.Get(`${E}/bufferView`,this._gltf.bufferViews,b.bufferView);b._data=this.loadBufferViewAsync(`/bufferViews/${h.index}`,h)}this.logClose()}return b._data}loadUriAsync(E,b,h){const a=this._extensionsLoadUriAsync(E,b,h);if(a)return a;if(!Q._ValidateUri(h))throw new Error(`${E}: '${h}' is invalid`);if((0,J.j)(h)){const b=new Uint8Array((0,J.b)(h));return this.log(`${E}: Decoded ${h.substring(0,64)}... (${b.length} bytes)`),Promise.resolve(b)}return this.log(`${E}: Loading ${h}`),this._parent.preprocessUrlAsync(this._rootUrl+h).then((b=>new Promise(((a,k)=>{this._parent._loadFile(this._babylonScene,b,(b=>{this._disposed||(this.log(`${E}: Loaded ${h} (${b.byteLength} bytes)`),a(new Uint8Array(b)))}),!0,(b=>{k(new J.m(`${E}: Failed to load '${h}'${b?": "+b.status+" "+b.statusText:""}`,b))}))}))))}static AddPointerMetadata(E,b){E.metadata=E.metadata||{};const h=E._internalMetadata=E._internalMetadata||{},a=h.Wi=h.Wi||{};(a.pointers=a.pointers||[]).push(b)}static _GetTextureWrapMode(E,b){switch(b=void 0==b?10497:b){case 33071:return z.b.CLAMP_ADDRESSMODE;case 33648:return z.b.MIRROR_ADDRESSMODE;case 10497:return z.b.WRAP_ADDRESSMODE;default:return D.c.Warn(`${E}: Invalid value (${b})`),z.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(E,b){const h=void 0==b.magFilter?9729:b.magFilter,a=void 0==b.minFilter?9987:b.minFilter;if(9729===h)switch(a){case 9728:return z.b.LINEAR_NEAREST;case 9729:return z.b.LINEAR_LINEAR;case 9984:return z.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return z.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return z.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return z.b.LINEAR_LINEAR_MIPLINEAR;default:return D.c.Warn(`${E}/minFilter: Invalid value (${a})`),z.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==h&&D.c.Warn(`${E}/magFilter: Invalid value (${h})`),a){case 9728:return z.b.NEAREST_NEAREST;case 9729:return z.b.NEAREST_LINEAR;case 9984:return z.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return z.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return z.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return z.b.NEAREST_LINEAR_MIPLINEAR;default:return D.c.Warn(`${E}/minFilter: Invalid value (${a})`),z.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(E,b){switch(b){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`${E}: Invalid component type ${b}`)}}static _GetTypedArray(E,b,h,a,k){const G=h.buffer;a=h.byteOffset+(a||0);const V=Q._GetTypedArrayConstructor(`${E}/componentType`,b),l=Y.g.GetTypeByteLength(b);return a%l!==0?(D.c.Warn(`${E}: Copying buffer as byte offset (${a}) is not a multiple of component type byte length (${l})`),new V(G.slice(a,a+k*l),0)):new V(G,a,k)}static _GetNumComponents(E,b){switch(b){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${E}: Invalid type (${b})`)}static _ValidateUri(E){return V.g.IsBase64(E)||-1===E.indexOf("..")}static _GetDrawMode(E,b){switch(void 0==b&&(b=4),b){case 0:return M.c.PointListDrawMode;case 1:return M.c.LineListDrawMode;case 2:return M.c.LineLoopDrawMode;case 3:return M.c.LineStripDrawMode;case 4:return M.c.TriangleFillMode;case 5:return M.c.TriangleStripDrawMode;case 6:return M.c.TriangleFanDrawMode}throw new Error(`${E}: Invalid mesh primitive mode (${b})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const E=new Array;if(this._gltf.materials)for(const b of this._gltf.materials)if(b._data)for(const h in b._data){const a=b._data[h];for(const b of a.babylonMeshes){b.Wj(!0);const h=a.babylonMaterial;E.push(h.forceCompilationAsync(b)),E.push(h.forceCompilationAsync(b,{useInstances:!0})),this._parent.useClipPlane&&(E.push(h.forceCompilationAsync(b,{clipPlane:!0})),E.push(h.forceCompilationAsync(b,{clipPlane:!0,useInstances:!0})))}}return Promise.all(E).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const E=new Array,b=this._babylonScene.lights;for(const h of b){const b=h.getShadowGenerator();b&&E.push(b.forceCompilationAsync())}return Promise.all(E).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(E){for(const b of this._extensions)b.enabled&&E(b)}_applyExtensions(E,b,h){for(const a of this._extensions)if(a.enabled){const k=`${a.name}.${b}`,G=E;G._activeLoaderExtensionFunctions=G._activeLoaderExtensionFunctions||{};const V=G._activeLoaderExtensionFunctions;if(!V[k]){V[k]=!0;try{const E=h(a);if(E)return E}finally{delete V[k]}}}return null}_extensionsOnLoading(){this._forEachExtensions((E=>E.onLoading&&E.onLoading()))}_extensionsOnReady(){this._forEachExtensions((E=>E.onReady&&E.onReady()))}_extensionsLoadSceneAsync(E,b){return this._applyExtensions(b,"loadScene",(h=>h.loadSceneAsync&&h.loadSceneAsync(E,b)))}_extensionsLoadNodeAsync(E,b,h){return this._applyExtensions(b,"loadNode",(a=>a.loadNodeAsync&&a.loadNodeAsync(E,b,h)))}_extensionsLoadCameraAsync(E,b,h){return this._applyExtensions(b,"loadCamera",(a=>a.loadCameraAsync&&a.loadCameraAsync(E,b,h)))}_extensionsLoadVertexDataAsync(E,b,h){return this._applyExtensions(b,"loadVertexData",(a=>a._loadVertexDataAsync&&a._loadVertexDataAsync(E,b,h)))}_extensionsLoadMeshPrimitiveAsync(E,b,h,a,k,G){return this._applyExtensions(k,"loadMeshPrimitive",(V=>V._loadMeshPrimitiveAsync&&V._loadMeshPrimitiveAsync(E,b,h,a,k,G)))}_extensionsLoadMaterialAsync(E,b,h,a,k){return this._applyExtensions(b,"loadMaterial",(G=>G._loadMaterialAsync&&G._loadMaterialAsync(E,b,h,a,k)))}_extensionsCreateMaterial(E,b,h){return this._applyExtensions(b,"createMaterial",(a=>a.createMaterial&&a.createMaterial(E,b,h)))}_extensionsLoadMaterialPropertiesAsync(E,b,h){return this._applyExtensions(b,"loadMaterialProperties",(a=>a.loadMaterialPropertiesAsync&&a.loadMaterialPropertiesAsync(E,b,h)))}_extensionsLoadTextureInfoAsync(E,b,h){return this._applyExtensions(b,"loadTextureInfo",(a=>a.loadTextureInfoAsync&&a.loadTextureInfoAsync(E,b,h)))}_extensionsLoadTextureAsync(E,b,h){return this._applyExtensions(b,"loadTexture",(a=>a._loadTextureAsync&&a._loadTextureAsync(E,b,h)))}_extensionsLoadAnimationAsync(E,b){return this._applyExtensions(b,"loadAnimation",(h=>h.loadAnimationAsync&&h.loadAnimationAsync(E,b)))}_extensionsLoadAnimationChannelAsync(E,b,h,a,k){return this._applyExtensions(h,"loadAnimationChannel",(G=>G._loadAnimationChannelAsync&&G._loadAnimationChannelAsync(E,b,h,a,k)))}_extensionsLoadSkinAsync(E,b,h){return this._applyExtensions(h,"loadSkin",(a=>a._loadSkinAsync&&a._loadSkinAsync(E,b,h)))}_extensionsLoadUriAsync(E,b,h){return this._applyExtensions(b,"loadUri",(a=>a._loadUriAsync&&a._loadUriAsync(E,b,h)))}_extensionsLoadBufferViewAsync(E,b){return this._applyExtensions(b,"loadBufferView",(h=>h.loadBufferViewAsync&&h.loadBufferViewAsync(E,b)))}_extensionsLoadBufferAsync(E,b,h,a){return this._applyExtensions(b,"loadBuffer",(k=>k.loadBufferAsync&&k.loadBufferAsync(E,b,h,a)))}static LoadExtensionAsync(E,b,h,a){if(!b.extensions)return null;const k=b.extensions[h];return k?a(`${E}/extensions/${h}`,k):null}static LoadExtraAsync(E,b,h,a){if(!b.extras)return null;const k=b.extras[h];return k?a(`${E}/extras/${h}`,k):null}isExtensionUsed(E){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(E)}logOpen(E){this._parent._logOpen(E)}logClose(){this._parent._logClose()}log(E){this._parent._log(E)}startPerformanceCounter(E){this._parent._startPerformanceCounter(E)}endPerformanceCounter(E){this._parent._endPerformanceCounter(E)}}Q.DefaultSampler={index:-1},e.d._CreateGLTF2Loader=E=>new Q(E);var i=h(11659),p=h(12191),EE=h(12200);class bE extends EE.b{constructor(E,b,h){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,G=arguments.length>5&&void 0!==arguments[5]&&arguments[5],V=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",E),this._texture=E.getEngine().createRawCubeTexture(b,h,a,k,G,V,l,O)}update(E,b,h,a){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,E,b,h,a,k)}updateRGBDAsync(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,p.m)(this._texture,E,b,h,a).then((()=>{}))}clone(){return d.e.Clone((()=>{const E=this.va(),b=this._texture,h=new bE(E,b._bufferViewArray,b.width,b.format,b.type,b.generateMipMaps,b.invertY,b.samplingMode,b._compression);return 13===b.source&&h.updateRGBDAsync(b._bufferViewArrayArray,b._sphericalPolynomial,b._lodGenerationScale,b._lodGenerationOffset),h}),this)}}const hE="EXT_lights_image_based";class aE{constructor(E){this.name=hE,this._loader=E,this.enabled=this._loader.isExtensionUsed(hE)}dispose(){this._loader=null,delete this._lights}onLoading(){const E=this._loader.Wi.extensions;if(E&&E[this.name]){const b=E[this.name];this._lights=b.lights}}loadSceneAsync(E,b){return Q.LoadExtensionAsync(E,b,this.name,((h,a)=>{this._loader._allMaterialsDirtyRequired=!0;const k=new Array;k.push(this._loader.loadSceneAsync(E,b)),this._loader.logOpen(`${h}`);const G=R.Get(`${h}/light`,this._lights,a.eb);return k.push(this._loadLightAsync(`/extensions/${this.name}/lights/${a.eb}`,G).then((E=>{this._loader.babylonScene.environmentTexture=E}))),this._loader.logClose(),Promise.all(k).then((()=>{}))}))}_loadLightAsync(E,b){if(!b._loaded){const h=new Array;this._loader.logOpen(`${E}`);const a=new Array(b.specularImages.length);for(let k=0;k<b.specularImages.length;k++){const G=b.specularImages[k];a[k]=new Array(G.length);for(let b=0;b<G.length;b++){const V=`${E}/specularImages/${k}/${b}`;this._loader.logOpen(`${V}`);const l=G[b],O=R.Get(V,this._loader.Wi.images,l);h.push(this._loader.loadImageAsync(`/images/${l}`,O).then((E=>{a[k][b]=E}))),this._loader.logClose()}}this._loader.logClose(),b._loaded=Promise.all(h).then((()=>{const h=new bE(this._loader.babylonScene,null,b.specularImageSize);if(h.name=b.name||"environment",b._babylonTexture=h,void 0!=b.gj&&(h.level=b.gj),b.rotation){let E=k.g.jh(b.rotation);this._loader.babylonScene.useRightHandedSystem||(E=k.g.Inverse(E)),k.d.FromQuaternionToRef(E,h.getReflectionTextureMatrix())}if(!b.irradianceCoefficients)throw new Error(`${E}: Irradiance coefficients are missing`);const G=i.e.jh(b.irradianceCoefficients);G.scaleInPlace(b.gj),G.convertIrradianceToLambertianRadiance();const V=i.h.FromHarmonics(G),l=(a.length-1)/Math.log2(b.specularImageSize);return h.updateRGBDAsync(a,V,l)}))}return b._loaded.then((()=>b._babylonTexture))}}C(hE),X(hE,!0,(E=>new aE(E)));h(12208);const kE="EXT_mesh_gpu_instancing";class GE{constructor(E){this.name=kE,this._loader=E,this.enabled=this._loader.isExtensionUsed(kE)}dispose(){this._loader=null}loadNodeAsync(E,b,h){return Q.LoadExtensionAsync(E,b,this.name,((E,a)=>{this._loader._disableInstancedMesh++;const G=this._loader.loadNodeAsync(`/nodes/${b.index}`,b,h);if(this._loader._disableInstancedMesh--,!b._primitiveBabylonMeshes)return G;const V=new Array;let l=0;const O=b=>{if(void 0==a.attributes[b])return void V.push(Promise.resolve(null));const h=R.Get(`${E}/attributes/${b}`,this._loader.Wi.accessors,a.attributes[b]);if(V.push(this._loader._loadFloatAccessorAsync(`/accessors/${h.bufferView}`,h)),0===l)l=h.count;else if(l!==h.count)throw new Error(`${E}/attributes: Instance buffer accessors do not have the same count.`)};return O("TRANSLATION"),O("ROTATION"),O("SCALE"),G.then((E=>Promise.all(V).then((h=>{let[a,G,V]=h;const O=new Float32Array(16*l);k.h.o[0].ue(0,0,0),k.h.Quaternion[0].ue(0,0,0,1),k.h.o[1].ue(1,1,1);for(let E=0;E<l;++E)a&&k.k.FromArrayToRef(a,3*E,k.h.o[0]),G&&k.g.FromArrayToRef(G,4*E,k.h.Quaternion[0]),V&&k.k.FromArrayToRef(V,3*E,k.h.o[1]),k.d.ComposeToRef(k.h.o[1],k.h.Quaternion[0],k.h.o[0],k.h.Matrix[0]),k.h.Matrix[0].copyToArray(O,16*E);for(const E of b._primitiveBabylonMeshes)E.Kb("matrix",O,16,!0);return E}))))}))}}C(kE),X(kE,!0,(E=>new GE(E)));class VE{static get Default(){return VE._Default||(VE._Default=new VE),VE._Default}constructor(){const E=VE.Configuration.decoder;this._decoderModulePromise=V.g.LoadBabylonScriptAsync(E.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}decodeGltfBufferAsync(E,b,h,a,k){return this._decoderModulePromise.then((async()=>{MeshoptDecoder.useWorkers(1);const G=await MeshoptDecoder.decodeGltfBufferAsync(b,h,E,a,k);return MeshoptDecoder.useWorkers(0),G}))}}VE.Configuration={decoder:{url:`${V.g._DefaultCdnUrl}/meshopt_decoder.js`}},VE._Default=null;const lE="EXT_meshopt_compression";class OE{constructor(E){this.name=lE,this.enabled=E.isExtensionUsed(lE),this._loader=E}dispose(){this._loader=null}loadBufferViewAsync(E,b){return Q.LoadExtensionAsync(E,b,this.name,((h,a)=>{const k=b;if(k._meshOptData)return k._meshOptData;const G=R.Get(`${E}/buffer`,this._loader.Wi.buffers,a.buffer);return k._meshOptData=this._loader.loadBufferAsync(`/buffers/${G.index}`,G,a.byteOffset||0,a.byteLength).then((E=>VE.Default.decodeGltfBufferAsync(E,a.count,a.byteStride,a.mode,a.filter))),k._meshOptData}))}}C(lE),X(lE,!0,(E=>new OE(E)));const vE="EXT_texture_webp";class sE{constructor(E){this.name=vE,this._loader=E,this.enabled=E.isExtensionUsed(vE)}dispose(){this._loader=null}_loadTextureAsync(E,b,h){return Q.LoadExtensionAsync(E,b,this.name,((a,k)=>{const G=void 0==b.sampler?Q.DefaultSampler:R.Get(`${E}/sampler`,this._loader.Wi.samplers,b.sampler),V=R.Get(`${a}/source`,this._loader.Wi.images,k.source);return this._loader._createTextureAsync(E,G,V,(E=>{h(E)}),void 0,!b._textureInfo.nonColorData)}))}}C(vE),X(vE,!0,(E=>new sE(E)));const UE="EXT_texture_avif";class BE{constructor(E){this.name=UE,this._loader=E,this.enabled=E.isExtensionUsed(UE)}dispose(){this._loader=null}_loadTextureAsync(E,b,h){return Q.LoadExtensionAsync(E,b,this.name,((a,k)=>{const G=void 0==b.sampler?Q.DefaultSampler:R.Get(`${E}/sampler`,this._loader.Wi.samplers,b.sampler),V=R.Get(`${a}/source`,this._loader.Wi.images,k.source);return this._loader._createTextureAsync(E,G,V,(E=>{h(E)}),void 0,!b._textureInfo.nonColorData)}))}}C(UE),X(UE,!0,(E=>new BE(E)));var oE=h(12217);const uE="KHR_draco_mesh_compression";class DE{constructor(E){this.name=uE,this.useNormalizedFlagFromAccessor=!0,this._loader=E,this.enabled=oE.e.DecoderAvailable&&this._loader.isExtensionUsed(uE)}dispose(){delete this.dracoCompression,this._loader=null}_loadVertexDataAsync(E,b,h){return Q.LoadExtensionAsync(E,b,this.name,((a,k)=>{if(void 0!=b.mode&&4!==b.mode&&5!==b.mode)throw new Error(`${E}: Unsupported mode ${b.mode}`);const G={},V={},l=(E,a)=>{const l=k.attributes[E];if(void 0!=l&&(h._delayInfo=h._delayInfo||[],-1===h._delayInfo.indexOf(a)&&h._delayInfo.push(a),G[a]=l,this.useNormalizedFlagFromAccessor)){const h=R.TryGet(this._loader.Wi.accessors,b.attributes[E]);h&&(V[a]=h.normalized||!1)}};l("POSITION",Y.g.PositionKind),l("NORMAL",Y.g.NormalKind),l("TANGENT",Y.g.TangentKind),l("TEXCOORD_0",Y.g.UVKind),l("TEXCOORD_1",Y.g.UV2Kind),l("TEXCOORD_2",Y.g.UV3Kind),l("TEXCOORD_3",Y.g.UV4Kind),l("TEXCOORD_4",Y.g.UV5Kind),l("TEXCOORD_5",Y.g.UV6Kind),l("JOINTS_0",Y.g.MatricesIndicesKind),l("WEIGHTS_0",Y.g.MatricesWeightsKind),l("COLOR_0",Y.g.ColorKind);const O=R.Get(a,this._loader.Wi.bufferViews,k.bufferView);return O._dracoBabylonGeometry||(O._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${O.index}`,O).then((b=>(this.dracoCompression||oE.e.Default)._decodeMeshToGeometryForGltfAsync(h.name,this._loader.babylonScene,b,G,V).catch((b=>{throw new Error(`${E}: ${b.message}`)}))))),O._dracoBabylonGeometry}))}}C(uE),X(uE,!0,(E=>new DE(E)));var gE=h(12229),SE=h(11429),ME=h(12185),IE=h(12234);SE.d.AddNodeConstructor("Light_Type_0",((E,b)=>()=>new jE(E,k.k.Zero(),b)));class jE extends IE.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(E){this._shadowAngle=E,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(E){const b=this.needCube();if(this._direction=E,this.needCube()!==b&&this._shadowGenerators){const E=this._shadowGenerators.values();for(let b=E.next();!0!==b.done;b=E.next()){b.value.recreateShadowMap()}}}constructor(E,b,h){super(E,h),this._shadowAngle=Math.PI/2,this.position=b}getClassName(){return"PointLight"}getTypeID(){return ME.d.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(E){if(this.direction)return super.getShadowDirection(E);switch(E){case 0:return new k.k(1,0,0);case 1:return new k.k(-1,0,0);case 2:return new k.k(0,-1,0);case 3:return new k.k(0,1,0);case 4:return new k.k(0,0,1);case 5:return new k.k(0,0,-1)}return k.k.Zero()}_setDefaultShadowProjectionMatrix(E,b,h){const a=this.va().activeCamera;if(!a)return;const G=void 0!==this.shadowMinZ?this.shadowMinZ:a.cj,V=void 0!==this.shadowMaxZ?this.shadowMaxZ:a.maxZ,l=this.va().getEngine().useReverseDepthBuffer;k.d.PerspectiveFovLHToRef(this.shadowAngle,1,l?V:G,l?G:V,E,!0,this._scene.getEngine().isNDCHalfZRange,void 0,l)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(E,b){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,b):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,b),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,b),this}transferToNodeMaterialEffect(E,b){return this.computeTransformedInformation()?E.setFloat3(b,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):E.setFloat3(b,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(E,b){E["POINTLIGHT"+b]=!0}}(0,I.d)([(0,j.H)()],jE.prototype,"shadowAngle",null),(0,n.f)("BABYLON.PointLight",jE),SE.d.AddNodeConstructor("Light_Type_2",((E,b)=>()=>new PE(E,k.k.Zero(),k.k.Zero(),0,0,b)));class PE extends IE.b{get angle(){return this._angle}set angle(E){this._angle=E,this._cosHalfAngle=Math.cos(.5*E),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(E){this._innerAngle=E,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(E){this._shadowAngleScale=E,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(E){this._projectionTextureLightNear=E,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(E){this._projectionTextureLightFar=E,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(E){this._projectionTextureUpDirection=E,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(E){this._projectionTexture!==E&&(this._projectionTexture=E,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(PE._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):PE._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(E){return void 0!==E.onGeneratedObservable}static _IsTexture(E){return void 0!==E.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(E){this._projectionTextureProjectionLightMatrix=E,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(E,b,h,a,G,V){super(E,V),this._innerAngle=0,this._projectionTextureMatrix=k.d.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=k.k.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=k.k.Zero(),this._projectionTextureViewLightMatrix=k.d.Zero(),this._projectionTextureProjectionLightMatrix=k.d.Zero(),this._projectionTextureScalingMatrix=k.d.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=b,this.direction=h,this.angle=a,this.exponent=G}getClassName(){return"SpotLight"}getTypeID(){return ME.d.LIGHTTYPEID_SPOTLIGHT}_setDirection(E){super._setDirection(E),this._projectionTextureViewLightDirty=!0}_setPosition(E){super._setPosition(E),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(E,b,h){const a=this.va().activeCamera;if(!a)return;this._shadowAngleScale=this._shadowAngleScale||1;const G=this._shadowAngleScale*this._angle,V=void 0!==this.shadowMinZ?this.shadowMinZ:a.cj,l=void 0!==this.shadowMaxZ?this.shadowMaxZ:a.maxZ,O=this.va().getEngine().useReverseDepthBuffer;k.d.PerspectiveFovLHToRef(G,1,O?l:V,O?V:l,E,!0,this._scene.getEngine().isNDCHalfZRange,void 0,O)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),k.d.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const E=this.projectionTextureLightFar,b=this.projectionTextureLightNear,h=E/(E-b),a=-h*b,G=1/Math.tan(this._angle/2);k.d.FromValuesToRef(G/1,0,0,0,0,G,0,0,0,0,h,1,0,0,a,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof z.b){const E=this._projectionTexture.uScale/2,b=this._projectionTexture.vScale/2;k.d.FromValuesToRef(E,0,0,0,0,b,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(E,b){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),E.setMatrix("textureProjectionMatrix"+b,this._projectionTextureMatrix),E.setTexture("projectionLightTexture"+b,this.projectionTexture)),this}transferToEffect(E,b){let h;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,b),h=k.k.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,b),h=k.k.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",h.x,h.y,h.z,this._cosHalfAngle,b),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,b),this}transferToNodeMaterialEffect(E,b){let h;return h=this.computeTransformedInformation()?k.k.Normalize(this.transformedDirection):k.k.Normalize(this.direction),this.va().useRightHandedSystem?E.setFloat3(b,-h.x,-h.y,-h.z):E.setFloat3(b,h.x,h.y,h.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose()}getDepthMinZ(E){const b=this._scene.getEngine(),h=void 0!==this.shadowMinZ?this.shadowMinZ:E.cj;return b.useReverseDepthBuffer&&b.isNDCHalfZRange?h:this._scene.getEngine().isNDCHalfZRange?0:h}getDepthMaxZ(E){const b=this._scene.getEngine(),h=void 0!==this.shadowMaxZ?this.shadowMaxZ:E.maxZ;return b.useReverseDepthBuffer&&b.isNDCHalfZRange?0:h}prepareLightSpecificDefines(E,b){E["SPOTLIGHT"+b]=!0,E["PROJECTEDLIGHTTEXTURE"+b]=!(!this.projectionTexture||!this.projectionTexture.isReady())}}(0,I.d)([(0,j.H)()],PE.prototype,"angle",null),(0,I.d)([(0,j.H)()],PE.prototype,"innerAngle",null),(0,I.d)([(0,j.H)()],PE.prototype,"shadowAngleScale",null),(0,I.d)([(0,j.H)()],PE.prototype,"exponent",void 0),(0,I.d)([(0,j.H)()],PE.prototype,"projectionTextureLightNear",null),(0,I.d)([(0,j.H)()],PE.prototype,"projectionTextureLightFar",null),(0,I.d)([(0,j.H)()],PE.prototype,"projectionTextureUpDirection",null),(0,I.d)([(0,j.C)("projectedLightTexture")],PE.prototype,"_projectionTexture",void 0),(0,n.f)("BABYLON.SpotLight",PE);const AE="KHR_lights_punctual";class nE{constructor(E){this.name=AE,this._loader=E,this.enabled=this._loader.isExtensionUsed(AE)}dispose(){this._loader=null,delete this._lights}onLoading(){const E=this._loader.Wi.extensions;if(E&&E[this.name]){const b=E[this.name];this._lights=b.lights,R.Assign(this._lights)}}loadNodeAsync(E,b,h){return Q.LoadExtensionAsync(E,b,this.name,((a,V)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(E,b,(E=>{let b;const l=R.Get(a,this._lights,V.eb),O=l.name||E.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,l.type){case"directional":{const E=new gE.d(O,k.k.Backward(),this._loader.babylonScene);E.position.te(0),b=E;break}case"point":b=new jE(O,k.k.Zero(),this._loader.babylonScene);break;case"spot":{const E=new PE(O,k.k.Zero(),k.k.Backward(),0,1,this._loader.babylonScene);E.angle=2*(l.spot&&l.spot.outerConeAngle||Math.PI/4),E.innerAngle=2*(l.spot&&l.spot.innerConeAngle||0),b=E;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${a}: Invalid light type (${l.type})`)}b._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,l._babylonLight=b,b.falloffType=ME.d.FALLOFF_GLTF,b.Kh=l.color?G.b.jh(l.color):G.b.White(),b.gj=void 0==l.gj?1:l.gj,b.range=void 0==l.range?Number.MAX_VALUE:l.range,b.parent=E,this._loader._babylonLights.push(b),Q.AddPointerMetadata(b,a),h(E)})))))}}C(AE),X(AE,!0,(E=>new nE(E)));const dE="KHR_materials_pbrSpecularGlossiness";class cE{constructor(E){this.name=dE,this.order=200,this._loader=E,this.enabled=this._loader.isExtensionUsed(dE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,b,h){return Q.LoadExtensionAsync(E,b,this.name,((a,k)=>{const G=new Array;return G.push(this._loader.loadMaterialBasePropertiesAsync(E,b,h)),G.push(this._loadSpecularGlossinessPropertiesAsync(a,k,h)),this._loader.loadMaterialAlphaProperties(E,b,h),Promise.all(G).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(E,b,h){if(!(h instanceof c))throw new Error(`${E}: Material type not supported`);const a=new Array;return h.metallic=null,h.roughness=null,b.diffuseFactor?(h.albedoColor=G.b.jh(b.diffuseFactor),h.alpha=b.diffuseFactor[3]):h.albedoColor=G.b.White(),h.reflectivityColor=b.specularFactor?G.b.jh(b.specularFactor):G.b.White(),h.microSurface=void 0==b.glossinessFactor?1:b.glossinessFactor,b.diffuseTexture&&a.push(this._loader.loadTextureInfoAsync(`${E}/diffuseTexture`,b.diffuseTexture,(E=>{E.name=`${h.name} (Diffuse)`,h.albedoTexture=E}))),b.specularGlossinessTexture&&(a.push(this._loader.loadTextureInfoAsync(`${E}/specularGlossinessTexture`,b.specularGlossinessTexture,(E=>{E.name=`${h.name} (Specular Glossiness)`,h.reflectivityTexture=E,h.reflectivityTexture.Ie=!0}))),h.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(a).then((()=>{}))}}C(dE),X(dE,!0,(E=>new cE(E)));const zE="KHR_materials_unlit";class ZE{constructor(E){this.name=zE,this.order=210,this._loader=E,this.enabled=this._loader.isExtensionUsed(zE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,b,h){return Q.LoadExtensionAsync(E,b,this.name,(()=>this._loadUnlitPropertiesAsync(E,b,h)))}_loadUnlitPropertiesAsync(E,b,h){if(!(h instanceof c))throw new Error(`${E}: Material type not supported`);const a=new Array;h.unlit=!0;const k=b.pbrMetallicRoughness;return k&&(k.baseColorFactor?(h.albedoColor=G.b.jh(k.baseColorFactor),h.alpha=k.baseColorFactor[3]):h.albedoColor=G.b.White(),k.baseColorTexture&&a.push(this._loader.loadTextureInfoAsync(`${E}/baseColorTexture`,k.baseColorTexture,(E=>{E.name=`${h.name} (Base Color)`,h.albedoTexture=E})))),b.doubleSided&&(h.xh=!1,h.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(E,b,h),Promise.all(a).then((()=>{}))}}C(zE),X(zE,!0,(E=>new ZE(E)));const YE="KHR_materials_clearcoat";class rE{constructor(E){this.name=YE,this.order=190,this._loader=E,this.enabled=this._loader.isExtensionUsed(YE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,b,h){return Q.LoadExtensionAsync(E,b,this.name,((a,k)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(E,b,h)),G.push(this._loadClearCoatPropertiesAsync(a,k,h)),Promise.all(G).then((()=>{}))}))}_loadClearCoatPropertiesAsync(E,b,h){if(!(h instanceof c))throw new Error(`${E}: Material type not supported`);const a=new Array;return h.clearCoat.isEnabled=!0,h.clearCoat.useRoughnessFromMainTexture=!1,h.clearCoat.remapF0OnInterfaceChange=!1,void 0!=b.clearcoatFactor?h.clearCoat.gj=b.clearcoatFactor:h.clearCoat.gj=0,b.clearcoatTexture&&a.push(this._loader.loadTextureInfoAsync(`${E}/clearcoatTexture`,b.clearcoatTexture,(E=>{E.name=`${h.name} (ClearCoat)`,h.clearCoat.texture=E}))),void 0!=b.clearcoatRoughnessFactor?h.clearCoat.roughness=b.clearcoatRoughnessFactor:h.clearCoat.roughness=0,b.clearcoatRoughnessTexture&&(b.clearcoatRoughnessTexture.nonColorData=!0,a.push(this._loader.loadTextureInfoAsync(`${E}/clearcoatRoughnessTexture`,b.clearcoatRoughnessTexture,(E=>{E.name=`${h.name} (ClearCoat Roughness)`,h.clearCoat.textureRoughness=E})))),b.clearcoatNormalTexture&&(b.clearcoatNormalTexture.nonColorData=!0,a.push(this._loader.loadTextureInfoAsync(`${E}/clearcoatNormalTexture`,b.clearcoatNormalTexture,(E=>{E.name=`${h.name} (ClearCoat Normal)`,h.clearCoat.bumpTexture=E}))),h.invertNormalMapX=!h.va().useRightHandedSystem,h.invertNormalMapY=h.va().useRightHandedSystem,void 0!=b.clearcoatNormalTexture.scale&&(h.clearCoat.bumpTexture.level=b.clearcoatNormalTexture.scale)),Promise.all(a).then((()=>{}))}}C(YE),X(YE,!0,(E=>new rE(E)));const wE="KHR_materials_iridescence";class NE{constructor(E){this.name=wE,this.order=195,this._loader=E,this.enabled=this._loader.isExtensionUsed(wE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,b,h){return Q.LoadExtensionAsync(E,b,this.name,((a,k)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(E,b,h)),G.push(this._loadIridescencePropertiesAsync(a,k,h)),Promise.all(G).then((()=>{}))}))}_loadIridescencePropertiesAsync(E,b,h){if(!(h instanceof c))throw new Error(`${E}: Material type not supported`);const a=new Array;return h.iridescence.isEnabled=!0,h.iridescence.gj=b.iridescenceFactor??0,h.iridescence.indexOfRefraction=b.iridescenceIor??b.iridescenceIOR??1.3,h.iridescence.minimumThickness=b.iridescenceThicknessMinimum??100,h.iridescence.maximumThickness=b.iridescenceThicknessMaximum??400,b.iridescenceTexture&&a.push(this._loader.loadTextureInfoAsync(`${E}/iridescenceTexture`,b.iridescenceTexture,(E=>{E.name=`${h.name} (Iridescence)`,h.iridescence.texture=E}))),b.iridescenceThicknessTexture&&a.push(this._loader.loadTextureInfoAsync(`${E}/iridescenceThicknessTexture`,b.iridescenceThicknessTexture,(E=>{E.name=`${h.name} (Iridescence Thickness)`,h.iridescence.thicknessTexture=E}))),Promise.all(a).then((()=>{}))}}C(wE),X(wE,!0,(E=>new NE(E)));const HE="KHR_materials_anisotropy";class fE{constructor(E){this.name=HE,this.order=195,this._loader=E,this.enabled=this._loader.isExtensionUsed(HE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,b,h){return Q.LoadExtensionAsync(E,b,this.name,((a,k)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(E,b,h)),G.push(this._loadIridescencePropertiesAsync(a,k,h)),Promise.all(G).then((()=>{}))}))}_loadIridescencePropertiesAsync(E,b,h){if(!(h instanceof c))throw new Error(`${E}: Material type not supported`);const a=new Array;return h.anisotropy.isEnabled=!0,h.anisotropy.gj=b.anisotropyStrength??0,h.anisotropy.angle=b.anisotropyRotation??0,b.anisotropyTexture&&(b.anisotropyTexture.nonColorData=!0,a.push(this._loader.loadTextureInfoAsync(`${E}/anisotropyTexture`,b.anisotropyTexture,(E=>{E.name=`${h.name} (Anisotropy Intensity)`,h.anisotropy.texture=E})))),Promise.all(a).then((()=>{}))}}C(HE),X(HE,!0,(E=>new fE(E)));const FE="KHR_materials_emissive_strength";class yE{constructor(E){this.name=FE,this.order=170,this._loader=E,this.enabled=this._loader.isExtensionUsed(FE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,b,h){return Q.LoadExtensionAsync(E,b,this.name,((a,k)=>this._loader.loadMaterialPropertiesAsync(E,b,h).then((()=>{this._loadEmissiveProperties(a,k,h)}))))}_loadEmissiveProperties(E,b,h){if(!(h instanceof c))throw new Error(`${E}: Material type not supported`);void 0!==b.emissiveStrength&&(h.emissiveIntensity=b.emissiveStrength)}}C(FE),X(FE,!0,(E=>new yE(E)));const eE="KHR_materials_sheen";class JE{constructor(E){this.name=eE,this.order=190,this._loader=E,this.enabled=this._loader.isExtensionUsed(eE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,b,h){return Q.LoadExtensionAsync(E,b,this.name,((a,k)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(E,b,h)),G.push(this._loadSheenPropertiesAsync(a,k,h)),Promise.all(G).then((()=>{}))}))}_loadSheenPropertiesAsync(E,b,h){if(!(h instanceof c))throw new Error(`${E}: Material type not supported`);const a=new Array;return h.sheen.isEnabled=!0,h.sheen.gj=1,void 0!=b.sheenColorFactor?h.sheen.color=G.b.jh(b.sheenColorFactor):h.sheen.color=G.b.Black(),b.sheenColorTexture&&a.push(this._loader.loadTextureInfoAsync(`${E}/sheenColorTexture`,b.sheenColorTexture,(E=>{E.name=`${h.name} (Sheen Color)`,h.sheen.texture=E}))),void 0!==b.sheenRoughnessFactor?h.sheen.roughness=b.sheenRoughnessFactor:h.sheen.roughness=0,b.sheenRoughnessTexture&&(b.sheenRoughnessTexture.nonColorData=!0,a.push(this._loader.loadTextureInfoAsync(`${E}/sheenRoughnessTexture`,b.sheenRoughnessTexture,(E=>{E.name=`${h.name} (Sheen Roughness)`,h.sheen.textureRoughness=E})))),h.sheen.albedoScaling=!0,h.sheen.useRoughnessFromMainTexture=!1,Promise.all(a).then((()=>{}))}}C(eE),X(eE,!0,(E=>new JE(E)));const mE="KHR_materials_specular";class KE{constructor(E){this.name=mE,this.order=190,this._loader=E,this.enabled=this._loader.isExtensionUsed(mE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,b,h){return Q.LoadExtensionAsync(E,b,this.name,((a,k)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(E,b,h)),G.push(this._loadSpecularPropertiesAsync(a,k,h)),Promise.all(G).then((()=>{}))}))}_loadSpecularPropertiesAsync(E,b,h){if(!(h instanceof c))throw new Error(`${E}: Material type not supported`);const a=new Array;return void 0!==b.specularFactor&&(h.metallicF0Factor=b.specularFactor),void 0!==b.specularColorFactor&&(h.metallicReflectanceColor=G.b.jh(b.specularColorFactor)),b.specularTexture&&(b.specularTexture.nonColorData=!0,a.push(this._loader.loadTextureInfoAsync(`${E}/specularTexture`,b.specularTexture,(E=>{E.name=`${h.name} (Specular)`,h.metallicReflectanceTexture=E,h.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),b.specularColorTexture&&a.push(this._loader.loadTextureInfoAsync(`${E}/specularColorTexture`,b.specularColorTexture,(E=>{E.name=`${h.name} (Specular Color)`,h.reflectanceTexture=E}))),Promise.all(a).then((()=>{}))}}C(mE),X(mE,!0,(E=>new KE(E)));const xE="KHR_materials_ior";class WE{constructor(E){this.name=xE,this.order=180,this._loader=E,this.enabled=this._loader.isExtensionUsed(xE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,b,h){return Q.LoadExtensionAsync(E,b,this.name,((a,k)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(E,b,h)),G.push(this._loadIorPropertiesAsync(a,k,h)),Promise.all(G).then((()=>{}))}))}_loadIorPropertiesAsync(E,b,h){if(!(h instanceof c))throw new Error(`${E}: Material type not supported`);return void 0!==b.ior?h.indexOfRefraction=b.ior:h.indexOfRefraction=WE._DEFAULT_IOR,Promise.resolve()}}WE._DEFAULT_IOR=1.5,C(xE),X(xE,!0,(E=>new WE(E)));const LE="KHR_materials_variants";class tE{constructor(E){this.name=LE,this._loader=E,this.enabled=this._loader.isExtensionUsed(LE)}dispose(){this._loader=null}static GetAvailableVariants(E){const b=this._GetExtensionMetadata(E);return b?Object.keys(b.variants):[]}getAvailableVariants(E){return tE.GetAvailableVariants(E)}static SelectVariant(E,b){const h=this._GetExtensionMetadata(E);if(!h)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${LE} extension`);const a=E=>{const b=h.variants[E];if(b)for(const h of b)h.mesh.material=h.material};if(b instanceof Array)for(const k of b)a(k);else a(b);h.lastSelected=b}selectVariant(E,b){tE.SelectVariant(E,b)}static Reset(E){const b=this._GetExtensionMetadata(E);if(!b)throw new Error(`Cannot reset on a glTF mesh that does not have the ${LE} extension`);for(const h of b.original)h.mesh.material=h.material;b.lastSelected=null}reset(E){tE.Reset(E)}static GetLastSelectedVariant(E){const b=this._GetExtensionMetadata(E);if(!b)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${LE} extension`);return b.lastSelected}getLastSelectedVariant(E){return tE.GetLastSelectedVariant(E)}static _GetExtensionMetadata(E){var b,h;return(null===E||void 0===E||null===(b=E._internalMetadata)||void 0===b||null===(h=b.Wi)||void 0===h?void 0:h[LE])||null}onLoading(){const E=this._loader.Wi.extensions;if(E&&E[this.name]){const b=E[this.name];this._variants=b.variants}}_loadMeshPrimitiveAsync(E,b,h,a,k,G){return Q.LoadExtensionAsync(E,k,this.name,((V,l)=>{const O=new Array;return O.push(this._loader._loadMeshPrimitiveAsync(E,b,h,a,k,(b=>{if(G(b),b instanceof N.b){const h=Q._GetDrawMode(E,k.mode),a=this._loader.rootBabylonMesh,G=a?a._internalMetadata=a._internalMetadata||{}:{},v=G.Wi=G.Wi||{},s=v[LE]=v[LE]||{lastSelected:null,original:[],variants:{}};s.original.push({mesh:b,material:b.material});for(let E=0;E<l.mappings.length;++E){const k=l.mappings[E],G=R.Get(`${V}/mappings/${E}/material`,this._loader.Wi.materials,k.material);O.push(this._loader._loadMaterialAsync(`#/materials/${k.material}`,G,b,h,(E=>{for(let h=0;h<k.variants.length;++h){const G=k.variants[h],V=R.Get(`/extensions/${LE}/variants/${G}`,this._variants,G);s.variants[V.name]=s.variants[V.name]||[],s.variants[V.name].push({mesh:b,material:E}),b.onClonedObservable.add((E=>{const h=E;let k=null,G=h;do{if(G=G.parent,!G)return;k=tE._GetExtensionMetadata(G)}while(null===k);if(a&&k===tE._GetExtensionMetadata(a)){G._internalMetadata={};for(const E in a._internalMetadata)G._internalMetadata[E]=a._internalMetadata[E];G._internalMetadata.Wi=[];for(const E in a._internalMetadata.Wi)G._internalMetadata.Wi[E]=a._internalMetadata.Wi[E];G._internalMetadata.Wi[LE]={lastSelected:null,original:[],variants:{}};for(const E of k.original)G._internalMetadata.Wi[LE].original.push({mesh:E.mesh,material:E.material});for(const E in k.variants)if(Object.prototype.hasOwnProperty.call(k.variants,E)){G._internalMetadata.Wi[LE].variants[E]=[];for(const b of k.variants[E])G._internalMetadata.Wi[LE].variants[E].push({mesh:b.mesh,material:b.material})}k=G._internalMetadata.Wi[LE]}for(const a of k.original)a.mesh===b&&(a.mesh=h);for(const a of k.variants[V.name])a.mesh===b&&(a.mesh=h)}))}})))}}}))),Promise.all(O).then((E=>{let[b]=E;return b}))}))}}C(LE),X(LE,!0,(E=>new tE(E)));var TE=h(11690);class XE{}XE.AUTOSAMPLERSUFFIX="Sampler",XE.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",XE.ALPHA_DISABLE=0,XE.ALPHA_ADD=1,XE.ALPHA_COMBINE=2,XE.ALPHA_SUBTRACT=3,XE.ALPHA_MULTIPLY=4,XE.ALPHA_MAXIMIZED=5,XE.ALPHA_ONEONE=6,XE.ALPHA_PREMULTIPLIED=7,XE.ALPHA_PREMULTIPLIED_PORTERDUFF=8,XE.ALPHA_INTERPOLATE=9,XE.ALPHA_SCREENMODE=10,XE.ALPHA_ONEONE_ONEONE=11,XE.ALPHA_ALPHATOCOLOR=12,XE.ALPHA_REVERSEONEMINUS=13,XE.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,XE.ALPHA_ONEONE_ONEZERO=15,XE.ALPHA_EXCLUSION=16,XE.ALPHA_LAYER_ACCUMULATE=17,XE.ALPHA_EQUATION_ADD=0,XE.ALPHA_EQUATION_SUBSTRACT=1,XE.ALPHA_EQUATION_REVERSE_SUBTRACT=2,XE.ALPHA_EQUATION_MAX=3,XE.ALPHA_EQUATION_MIN=4,XE.ALPHA_EQUATION_DARKEN=5,XE.DELAYLOADSTATE_NONE=0,XE.DELAYLOADSTATE_LOADED=1,XE.DELAYLOADSTATE_LOADING=2,XE.DELAYLOADSTATE_NOTLOADED=4,XE.NEVER=512,XE.ALWAYS=519,XE.LESS=513,XE.EQUAL=514,XE.LEQUAL=515,XE.GREATER=516,XE.GEQUAL=518,XE.NOTEQUAL=517,XE.KEEP=7680,XE.ZERO=0,XE.REPLACE=7681,XE.INCR=7682,XE.DECR=7683,XE.INVERT=5386,XE.INCR_WRAP=34055,XE.DECR_WRAP=34056,XE.TEXTURE_CLAMP_ADDRESSMODE=0,XE.TEXTURE_WRAP_ADDRESSMODE=1,XE.TEXTURE_MIRROR_ADDRESSMODE=2,XE.TEXTURE_CREATIONFLAG_STORAGE=1,XE.TEXTUREFORMAT_ALPHA=0,XE.TEXTUREFORMAT_LUMINANCE=1,XE.TEXTUREFORMAT_LUMINANCE_ALPHA=2,XE.TEXTUREFORMAT_RGB=4,XE.TEXTUREFORMAT_RGBA=5,XE.TEXTUREFORMAT_RED=6,XE.TEXTUREFORMAT_R=6,XE.TEXTUREFORMAT_RG=7,XE.TEXTUREFORMAT_RED_INTEGER=8,XE.TEXTUREFORMAT_R_INTEGER=8,XE.TEXTUREFORMAT_RG_INTEGER=9,XE.TEXTUREFORMAT_RGB_INTEGER=10,XE.TEXTUREFORMAT_RGBA_INTEGER=11,XE.TEXTUREFORMAT_BGRA=12,XE.TEXTUREFORMAT_DEPTH24_STENCIL8=13,XE.TEXTUREFORMAT_DEPTH32_FLOAT=14,XE.TEXTUREFORMAT_DEPTH16=15,XE.TEXTUREFORMAT_DEPTH24=16,XE.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,XE.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,XE.TEXTUREFORMAT_STENCIL8=19,XE.TEXTUREFORMAT_UNDEFINED=4294967295,XE.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,XE.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,XE.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,XE.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,XE.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,XE.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,XE.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,XE.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,XE.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,XE.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,XE.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,XE.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,XE.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,XE.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,XE.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,XE.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,XE.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,XE.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,XE.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,XE.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,XE.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,XE.TEXTURETYPE_UNSIGNED_BYTE=0,XE.TEXTURETYPE_UNSIGNED_INT=0,XE.TEXTURETYPE_FLOAT=1,XE.TEXTURETYPE_HALF_FLOAT=2,XE.TEXTURETYPE_BYTE=3,XE.TEXTURETYPE_SHORT=4,XE.TEXTURETYPE_UNSIGNED_SHORT=5,XE.TEXTURETYPE_INT=6,XE.TEXTURETYPE_UNSIGNED_INTEGER=7,XE.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,XE.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,XE.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,XE.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,XE.TEXTURETYPE_UNSIGNED_INT_24_8=12,XE.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,XE.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,XE.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,XE.TEXTURETYPE_UNDEFINED=16,XE.TEXTURE_2D=3553,XE.TEXTURE_2D_ARRAY=35866,XE.TEXTURE_CUBE_MAP=34067,XE.TEXTURE_CUBE_MAP_ARRAY=3735928559,XE.TEXTURE_3D=32879,XE.TEXTURE_NEAREST_SAMPLINGMODE=1,XE.TEXTURE_NEAREST_NEAREST=1,XE.TEXTURE_BILINEAR_SAMPLINGMODE=2,XE.TEXTURE_LINEAR_LINEAR=2,XE.TEXTURE_TRILINEAR_SAMPLINGMODE=3,XE.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,XE.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,XE.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,XE.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,XE.TEXTURE_NEAREST_LINEAR=7,XE.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,XE.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,XE.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,XE.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,XE.TEXTURE_LINEAR_NEAREST=12,XE.TEXTURE_EXPLICIT_MODE=0,XE.TEXTURE_SPHERICAL_MODE=1,XE.TEXTURE_PLANAR_MODE=2,XE.TEXTURE_CUBIC_MODE=3,XE.TEXTURE_PROJECTION_MODE=4,XE.TEXTURE_SKYBOX_MODE=5,XE.TEXTURE_INVCUBIC_MODE=6,XE.TEXTURE_EQUIRECTANGULAR_MODE=7,XE.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,XE.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,XE.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,XE.TEXTURE_FILTERING_QUALITY_HIGH=64,XE.TEXTURE_FILTERING_QUALITY_MEDIUM=16,XE.TEXTURE_FILTERING_QUALITY_LOW=8,XE.SCALEMODE_FLOOR=1,XE.SCALEMODE_NEAREST=2,XE.SCALEMODE_CEILING=3,XE.MATERIAL_TextureDirtyFlag=1,XE.MATERIAL_LightDirtyFlag=2,XE.MATERIAL_FresnelDirtyFlag=4,XE.MATERIAL_AttributesDirtyFlag=8,XE.MATERIAL_MiscDirtyFlag=16,XE.MATERIAL_PrePassDirtyFlag=32,XE.MATERIAL_AllDirtyFlag=63,XE.MATERIAL_TriangleFillMode=0,XE.MATERIAL_WireFrameFillMode=1,XE.MATERIAL_PointFillMode=2,XE.MATERIAL_PointListDrawMode=3,XE.MATERIAL_LineListDrawMode=4,XE.MATERIAL_LineLoopDrawMode=5,XE.MATERIAL_LineStripDrawMode=6,XE.MATERIAL_TriangleStripDrawMode=7,XE.MATERIAL_TriangleFanDrawMode=8,XE.MATERIAL_ClockWiseSideOrientation=0,XE.MATERIAL_CounterClockWiseSideOrientation=1,XE.ACTION_NothingTrigger=0,XE.ACTION_OnPickTrigger=1,XE.ACTION_OnLeftPickTrigger=2,XE.ACTION_OnRightPickTrigger=3,XE.ACTION_OnCenterPickTrigger=4,XE.ACTION_OnPickDownTrigger=5,XE.ACTION_OnDoublePickTrigger=6,XE.ACTION_OnPickUpTrigger=7,XE.ACTION_OnPickOutTrigger=16,XE.ACTION_OnLongPressTrigger=8,XE.ACTION_OnPointerOverTrigger=9,XE.ACTION_OnPointerOutTrigger=10,XE.ACTION_OnEveryFrameTrigger=11,XE.ACTION_OnIntersectionEnterTrigger=12,XE.ACTION_OnIntersectionExitTrigger=13,XE.ACTION_OnKeyDownTrigger=14,XE.ACTION_OnKeyUpTrigger=15,XE.PARTICLES_BILLBOARDMODE_Y=2,XE.PARTICLES_BILLBOARDMODE_ALL=7,XE.PARTICLES_BILLBOARDMODE_STRETCHED=8,XE.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,XE.MESHES_CULLINGSTRATEGY_STANDARD=0,XE.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,XE.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,XE.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,XE.SCENELOADER_NO_LOGGING=0,XE.SCENELOADER_MINIMAL_LOGGING=1,XE.SCENELOADER_SUMMARY_LOGGING=2,XE.SCENELOADER_DETAILED_LOGGING=3,XE.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,XE.PREPASS_POSITION_TEXTURE_TYPE=1,XE.PREPASS_VELOCITY_TEXTURE_TYPE=2,XE.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,XE.PREPASS_COLOR_TEXTURE_TYPE=4,XE.PREPASS_DEPTH_TEXTURE_TYPE=5,XE.PREPASS_NORMAL_TEXTURE_TYPE=6,XE.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,XE.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,XE.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,XE.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,XE.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,XE.PREPASS_ALBEDO_TEXTURE_TYPE=12,XE.BUFFER_CREATIONFLAG_READ=1,XE.BUFFER_CREATIONFLAG_WRITE=2,XE.BUFFER_CREATIONFLAG_READWRITE=3,XE.BUFFER_CREATIONFLAG_UNIFORM=4,XE.BUFFER_CREATIONFLAG_VERTEX=8,XE.BUFFER_CREATIONFLAG_INDEX=16,XE.BUFFER_CREATIONFLAG_STORAGE=32,XE.BUFFER_CREATIONFLAG_INDIRECT=64,XE.RENDERPASS_MAIN=0,XE.INPUT_ALT_KEY=18,XE.INPUT_CTRL_KEY=17,XE.INPUT_META_KEY1=91,XE.INPUT_META_KEY2=92,XE.INPUT_META_KEY3=93,XE.INPUT_SHIFT_KEY=16,XE.SNAPSHOTRENDERING_STANDARD=0,XE.SNAPSHOTRENDERING_FAST=1,XE.PERSPECTIVE_CAMERA=0,XE.ORTHOGRAPHIC_CAMERA=1,XE.FOVMODE_VERTICAL_FIXED=0,XE.FOVMODE_HORIZONTAL_FIXED=1,XE.RIG_MODE_NONE=0,XE.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,XE.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,XE.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,XE.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,XE.RIG_MODE_STEREOSCOPIC_INTERLACED=14,XE.RIG_MODE_VR=20,XE.RIG_MODE_CUSTOM=22,XE.MAX_SUPPORTED_UV_SETS=6,XE.GL_ALPHA_EQUATION_ADD=32774,XE.GL_ALPHA_EQUATION_MIN=32775,XE.GL_ALPHA_EQUATION_MAX=32776,XE.GL_ALPHA_EQUATION_SUBTRACT=32778,XE.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,XE.GL_ALPHA_FUNCTION_SRC=768,XE.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,XE.GL_ALPHA_FUNCTION_SRC_ALPHA=770,XE.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,XE.GL_ALPHA_FUNCTION_DST_ALPHA=772,XE.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,XE.GL_ALPHA_FUNCTION_DST_COLOR=774,XE.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,XE.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,XE.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,XE.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,XE.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,XE.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,XE.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,XE.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,XE.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,XE.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,XE.SnippetUrl="https://snippet.babylonjs.com",XE.FOGMODE_NONE=0,XE.FOGMODE_EXP=1,XE.FOGMODE_EXP2=2,XE.FOGMODE_LINEAR=3,XE.BYTE=5120,XE.UNSIGNED_BYTE=5121,XE.SHORT=5122,XE.UNSIGNED_SHORT=5123,XE.INT=5124,XE.UNSIGNED_INT=5125,XE.FLOAT=5126,XE.PositionKind="position",XE.NormalKind="k",XE.TangentKind="tangent",XE.UVKind="uv",XE.UV2Kind="uv2",XE.UV3Kind="uv3",XE.UV4Kind="uv4",XE.UV5Kind="uv5",XE.UV6Kind="uv6",XE.ColorKind="color",XE.ColorInstanceKind="instanceColor",XE.MatricesIndicesKind="matricesIndices",XE.MatricesWeightsKind="matricesWeights",XE.MatricesIndicesExtraKind="matricesIndicesExtra",XE.MatricesWeightsExtraKind="matricesWeightsExtra";class CE{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:XE.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(E,b){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...CE._GetDefaultOptions(),...E},this._scene=b,this._scene._transmissionHelper=this,this.onErrorObservable=new s.e,this._scene.rj.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(E){if(!Object.keys(E).filter((b=>this._options[b]!==E[b])).length)return;const b={...this._options,...E},h=this._options;this._options=b,b.renderSize===h.renderSize&&b.renderTargetTextureType===h.renderTargetTextureType&&b.generateMipmaps===h.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=b.samples,this._opaqueRenderTarget.lodGenerationScale=b.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=b.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(E){return!!E&&!!(E instanceof c&&E.subSurface.isRefractionEnabled)}_addMesh(E){this._materialObservers[E.uniqueId]=E.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),V.g.SetImmediate((()=>{this._shouldRenderAsTransmission(E.material)?(E.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(E)&&this._transparentMeshesCache.push(E)):-1===this._opaqueMeshesCache.indexOf(E)&&this._opaqueMeshesCache.push(E)}))}_removeMesh(E){E.onMaterialChangedObservable.remove(this._materialObservers[E.uniqueId]),delete this._materialObservers[E.uniqueId];let b=this._transparentMeshesCache.indexOf(E);-1!==b&&this._transparentMeshesCache.splice(b,1),b=this._opaqueMeshesCache.indexOf(E),-1!==b&&this._opaqueMeshesCache.splice(b,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(E){const b=this._transparentMeshesCache.indexOf(E),h=this._opaqueMeshesCache.indexOf(E);this._shouldRenderAsTransmission(E.material)?(E.material instanceof c&&(E.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==h?(this._opaqueMeshesCache.splice(h,1),this._transparentMeshesCache.push(E)):-1===b&&this._transparentMeshesCache.push(E)):-1!==b?(this._transparentMeshesCache.splice(b,1),this._opaqueMeshesCache.push(E)):-1===h&&this._opaqueMeshesCache.push(E)}_isRenderTargetValid(){var E;return null!==(null===(E=this._opaqueRenderTarget)||void 0===E?void 0:E.getInternalTexture())}_setupRenderTargets(){var E;let b,h;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new TE.c("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(E=this._options.clearColor)||void 0===E?void 0:E.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((E=>{h=this._scene.environmentIntensity,this._scene.environmentIntensity=1,b=this._scene.imageProcessingConfiguration.applyByPostProcess,this._options.clearColor?E.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(E.clearColor,this._scene.getEngine().useExactSrgbConversions),this._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=h,this._scene.imageProcessingConfiguration._applyByPostProcess=b})),this._transparentMeshesCache.forEach((E=>{this._shouldRenderAsTransmission(E.material)&&(E.material.refractionTexture=this._opaqueRenderTarget)}))}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const qE="KHR_materials_transmission";class RE{constructor(E){this.name=qE,this.order=175,this._loader=E,this.enabled=this._loader.isExtensionUsed(qE),this.enabled&&(E.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,b,h){return Q.LoadExtensionAsync(E,b,this.name,((a,k)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(E,b,h)),G.push(this._loadTransparentPropertiesAsync(a,b,h,k)),Promise.all(G).then((()=>{}))}))}_loadTransparentPropertiesAsync(E,b,h,a){if(!(h instanceof c))throw new Error(`${E}: Material type not supported`);const k=h;if(k.subSurface.isRefractionEnabled=!0,k.subSurface.volumeIndexOfRefraction=1,k.subSurface.useAlbedoToTintRefraction=!0,void 0===a.transmissionFactor)return k.subSurface.refractionIntensity=0,k.subSurface.isRefractionEnabled=!1,Promise.resolve();{var G;k.subSurface.refractionIntensity=a.transmissionFactor;const E=k.va();if(k.subSurface.refractionIntensity&&!E._transmissionHelper)new CE({},k.va());else if(k.subSurface.refractionIntensity&&(null===(G=E._transmissionHelper)||void 0===G||!G._isRenderTargetValid())){var V;null===(V=E._transmissionHelper)||void 0===V||V._setupRenderTargets()}}return k.subSurface.minimumThickness=0,k.subSurface.maximumThickness=0,a.transmissionTexture?(a.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${E}/transmissionTexture`,a.transmissionTexture,void 0).then((E=>{E.name=`${h.name} (Transmission)`,k.subSurface.refractionIntensityTexture=E,k.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}C(qE),X(qE,!0,(E=>new RE(E)));const QE="KHR_materials_diffuse_transmission";class iE{constructor(E){this.name=QE,this.order=174,this._loader=E,this.enabled=this._loader.isExtensionUsed(QE),this.enabled&&(E.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,b,h){return Q.LoadExtensionAsync(E,b,this.name,((a,k)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(E,b,h)),G.push(this._loadTranslucentPropertiesAsync(a,b,h,k)),Promise.all(G).then((()=>{}))}))}_loadTranslucentPropertiesAsync(E,b,h,a){if(!(h instanceof c))throw new Error(`${E}: Material type not supported`);const k=h;if(k.subSurface.isTranslucencyEnabled=!0,k.subSurface.volumeIndexOfRefraction=1,k.subSurface.minimumThickness=0,k.subSurface.maximumThickness=0,k.subSurface.useAlbedoToTintTranslucency=!1,void 0===a.diffuseTransmissionFactor)return k.subSurface.translucencyIntensity=0,k.subSurface.isTranslucencyEnabled=!1,Promise.resolve();k.subSurface.translucencyIntensity=a.diffuseTransmissionFactor;const V=new Array;return k.subSurface.useGltfStyleTextures=!0,a.diffuseTransmissionTexture&&(a.diffuseTransmissionTexture.nonColorData=!0,V.push(this._loader.loadTextureInfoAsync(`${E}/diffuseTransmissionTexture`,a.diffuseTransmissionTexture).then((E=>{E.name=`${h.name} (Diffuse Transmission)`,k.subSurface.translucencyIntensityTexture=E})))),void 0!==a.diffuseTransmissionColorFactor?k.subSurface.translucencyColor=G.b.jh(a.diffuseTransmissionColorFactor):k.subSurface.translucencyColor=G.b.White(),a.diffuseTransmissionColorTexture&&V.push(this._loader.loadTextureInfoAsync(`${E}/diffuseTransmissionColorTexture`,a.diffuseTransmissionColorTexture).then((E=>{E.name=`${h.name} (Diffuse Transmission Color)`,k.subSurface.translucencyColorTexture=E}))),Promise.all(V).then((()=>{}))}}C(QE),X(QE,!0,(E=>new iE(E)));const pE="KHR_materials_volume";class Eb{constructor(E){this.name=pE,this.order=173,this._loader=E,this.enabled=this._loader.isExtensionUsed(pE),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(E,b,h){return Q.LoadExtensionAsync(E,b,this.name,((a,k)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(E,b,h)),G.push(this._loadVolumePropertiesAsync(a,b,h,k)),Promise.all(G).then((()=>{}))}))}_loadVolumePropertiesAsync(E,b,h,a){if(!(h instanceof c))throw new Error(`${E}: Material type not supported`);if(!h.subSurface.isRefractionEnabled&&!h.subSurface.isTranslucencyEnabled||!a.thicknessFactor)return Promise.resolve();h.subSurface.volumeIndexOfRefraction=h.indexOfRefraction;const k=void 0!==a.attenuationDistance?a.attenuationDistance:Number.MAX_VALUE;return h.subSurface.tintColorAtDistance=k,void 0!==a.attenuationColor&&3==a.attenuationColor.length&&h.subSurface.tintColor.ue(a.attenuationColor[0],a.attenuationColor[1],a.attenuationColor[2]),h.subSurface.minimumThickness=0,h.subSurface.maximumThickness=a.thicknessFactor,h.subSurface.useThicknessAsDepth=!0,a.thicknessTexture?(a.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${E}/thicknessTexture`,a.thicknessTexture).then((E=>{E.name=`${h.name} (Thickness)`,h.subSurface.thicknessTexture=E,h.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}C(pE),X(pE,!0,(E=>new Eb(E)));const bb="KHR_materials_dispersion";class hb{constructor(E){this.name=bb,this.order=174,this._loader=E,this.enabled=this._loader.isExtensionUsed(bb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,b,h){return Q.LoadExtensionAsync(E,b,this.name,((a,k)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(E,b,h)),G.push(this._loadDispersionPropertiesAsync(a,b,h,k)),Promise.all(G).then((()=>{}))}))}_loadDispersionPropertiesAsync(E,b,h,a){if(!(h instanceof c))throw new Error(`${E}: Material type not supported`);return h.subSurface.isRefractionEnabled&&a.dispersion?(h.subSurface.isDispersionEnabled=!0,h.subSurface.dispersion=a.dispersion,Promise.resolve()):Promise.resolve()}}C(bb),X(bb,!0,(E=>new hb(E)));const ab="KHR_mesh_quantization";class kb{constructor(E){this.name=ab,this.enabled=E.isExtensionUsed(ab)}dispose(){}}C(ab),X(ab,!0,(E=>new kb(E)));const Gb="KHR_texture_basisu";class Vb{constructor(E){this.name=Gb,this._loader=E,this.enabled=E.isExtensionUsed(Gb)}dispose(){this._loader=null}_loadTextureAsync(E,b,h){return Q.LoadExtensionAsync(E,b,this.name,((a,k)=>{const G=void 0==b.sampler?Q.DefaultSampler:R.Get(`${E}/sampler`,this._loader.Wi.samplers,b.sampler),V=R.Get(`${a}/source`,this._loader.Wi.images,k.source);return this._loader._createTextureAsync(E,G,V,(E=>{h(E)}),b._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!b._textureInfo.nonColorData)}))}}C(Gb),X(Gb,!0,(E=>new Vb(E)));const lb="KHR_texture_transform";class Ob{constructor(E){this.name=lb,this._loader=E,this.enabled=this._loader.isExtensionUsed(lb)}dispose(){this._loader=null}loadTextureInfoAsync(E,b,h){return Q.LoadExtensionAsync(E,b,this.name,((a,k)=>this._loader.loadTextureInfoAsync(E,b,(E=>{if(!(E instanceof z.b))throw new Error(`${a}: Texture type not supported`);k.offset&&(E.uOffset=k.offset[0],E.vOffset=k.offset[1]),E.uRotationCenter=0,E.vRotationCenter=0,k.rotation&&(E.wAng=-k.rotation),k.scale&&(E.uScale=k.scale[0],E.vScale=k.scale[1]),void 0!=k.texCoord&&(E.coordinatesIndex=k.texCoord),h(E)}))))}}C(lb),X(lb,!0,(E=>new Ob(E)));const vb="KHR_xmp_json_ld";class sb{constructor(E){this.name=vb,this.order=100,this._loader=E,this.enabled=this._loader.isExtensionUsed(vb)}dispose(){this._loader=null}onLoading(){var E,b,h;if(null===this._loader.rootBabylonMesh)return;const a=null===(E=this._loader.Wi.extensions)||void 0===E?void 0:E.KHR_xmp_json_ld,k=null===(b=this._loader.Wi.asset)||void 0===b||null===(h=b.extensions)||void 0===h?void 0:h.KHR_xmp_json_ld;if(a&&k){const E=+k.packet;a.packets&&E<a.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=a.packets[E])}}}function Ub(E,b,h,a){return G.b.jh(b,h).scale(a)}function Bb(E,b,h,a){return b[h]*a}function ob(E,b,h,a){return-b[h]*a}function ub(E,b,h,a){return b[h+1]*a}function Db(E,b,h,a){return b[h]*a*2}function gb(E){return{scale:[new Mb(B.c.ANIMATIONTYPE_FLOAT,`${E}.uScale`,Bb,(()=>2)),new Mb(B.c.ANIMATIONTYPE_FLOAT,`${E}.vScale`,ub,(()=>2))],offset:[new Mb(B.c.ANIMATIONTYPE_FLOAT,`${E}.uOffset`,Bb,(()=>2)),new Mb(B.c.ANIMATIONTYPE_FLOAT,`${E}.vOffset`,ub,(()=>2))],rotation:[new Mb(B.c.ANIMATIONTYPE_FLOAT,`${E}.wAng`,ob,(()=>1))]}}C(vb),X(vb,!0,(E=>new sb(E)));class Sb extends x{buildAnimations(E,b,h,a,k){k(E._babylonCamera,this._buildAnimation(b,h,a))}}class Mb extends x{buildAnimations(E,b,h,a,k){for(const G in E._data)k(E._data[G].babylonMaterial,this._buildAnimation(b,h,a))}}class Ib extends x{buildAnimations(E,b,h,a,k){k(E._babylonLight,this._buildAnimation(b,h,a))}}const jb={__array__:{__target__:!0,...L}},Pb={__array__:{__target__:!0,orthographic:{xmag:[new Sb(B.c.ANIMATIONTYPE_FLOAT,"orthoLeft",ob,(()=>1)),new Sb(B.c.ANIMATIONTYPE_FLOAT,"orthoRight",ub,(()=>1))],ymag:[new Sb(B.c.ANIMATIONTYPE_FLOAT,"orthoBottom",ob,(()=>1)),new Sb(B.c.ANIMATIONTYPE_FLOAT,"orthoTop",ub,(()=>1))],zfar:[new Sb(B.c.ANIMATIONTYPE_FLOAT,"maxZ",Bb,(()=>1))],znear:[new Sb(B.c.ANIMATIONTYPE_FLOAT,"cj",Bb,(()=>1))]},perspective:{yfov:[new Sb(B.c.ANIMATIONTYPE_FLOAT,"fov",Bb,(()=>1))],zfar:[new Sb(B.c.ANIMATIONTYPE_FLOAT,"maxZ",Bb,(()=>1))],znear:[new Sb(B.c.ANIMATIONTYPE_FLOAT,"cj",Bb,(()=>1))]}}},Ab={nodes:jb,materials:{__array__:{__target__:!0,pbrMetallicRoughness:{baseColorFactor:[new Mb(B.c.ANIMATIONTYPE_COLOR3,"albedoColor",Ub,(()=>4)),new Mb(B.c.ANIMATIONTYPE_FLOAT,"alpha",(function(E,b,h,a){return b[h+3]*a}),(()=>4))],metallicFactor:[new Mb(B.c.ANIMATIONTYPE_FLOAT,"metallic",Bb,(()=>1))],roughnessFactor:[new Mb(B.c.ANIMATIONTYPE_FLOAT,"roughness",Bb,(()=>1))],baseColorTexture:{extensions:{KHR_texture_transform:gb("albedoTexture")}},metallicRoughnessTexture:{extensions:{KHR_texture_transform:gb("metallicTexture")}}},emissiveFactor:[new Mb(B.c.ANIMATIONTYPE_COLOR3,"emissiveColor",Ub,(()=>3))],normalTexture:{scale:[new Mb(B.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",Bb,(()=>1))],extensions:{KHR_texture_transform:gb("bumpTexture")}},occlusionTexture:{strength:[new Mb(B.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",Bb,(()=>1))],extensions:{KHR_texture_transform:gb("ambientTexture")}},emissiveTexture:{extensions:{KHR_texture_transform:gb("emissiveTexture")}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:[new Mb(B.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",Bb,(()=>1))],anisotropyRotation:[new Mb(B.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",Bb,(()=>1))],anisotropyTexture:{extensions:{KHR_texture_transform:gb("anisotropy.texture")}}},KHR_materials_clearcoat:{clearcoatFactor:[new Mb(B.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",Bb,(()=>1))],clearcoatRoughnessFactor:[new Mb(B.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",Bb,(()=>1))],clearcoatTexture:{extensions:{KHR_texture_transform:gb("clearCoat.texture")}},clearcoatNormalTexture:{scale:[new Mb(B.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",Bb,(()=>1))],extensions:{KHR_texture_transform:gb("clearCoat.bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:gb("clearCoat.textureRoughness")}}},KHR_materials_dispersion:{dispersion:[new Mb(B.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",Bb,(()=>1))]},KHR_materials_emissive_strength:{emissiveStrength:[new Mb(B.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",Bb,(()=>1))]},KHR_materials_ior:{ior:[new Mb(B.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",Bb,(()=>1))]},KHR_materials_iridescence:{iridescenceFactor:[new Mb(B.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",Bb,(()=>1))],iridescenceIor:[new Mb(B.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",Bb,(()=>1))],iridescenceThicknessMinimum:[new Mb(B.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",Bb,(()=>1))],iridescenceThicknessMaximum:[new Mb(B.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",Bb,(()=>1))],iridescenceTexture:{extensions:{KHR_texture_transform:gb("iridescence.texture")}},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:gb("iridescence.thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:[new Mb(B.c.ANIMATIONTYPE_COLOR3,"sheen.color",Ub,(()=>3))],sheenRoughnessFactor:[new Mb(B.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",Bb,(()=>1))],sheenColorTexture:{extensions:{KHR_texture_transform:gb("sheen.texture")}},sheenRoughnessTexture:{extensions:{KHR_texture_transform:gb("sheen.textureRoughness")}}},KHR_materials_specular:{specularFactor:[new Mb(B.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",Bb,(()=>1))],specularColorFactor:[new Mb(B.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Ub,(()=>3))],specularTexture:{extensions:{KHR_texture_transform:gb("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:gb("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:[new Mb(B.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",Bb,(()=>1))],transmissionTexture:{extensions:{KHR_texture_transform:gb("subSurface.refractionIntensityTexture")}}},KHR_materials_volume:{attenuationColor:[new Mb(B.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Ub,(()=>3))],attenuationDistance:[new Mb(B.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",Bb,(()=>1))],thicknessFactor:[new Mb(B.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",Bb,(()=>1))],thicknessTexture:{extensions:{KHR_texture_transform:gb("subSurface.thicknessTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:[new Mb(B.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",Bb,(()=>1))],diffuseTransmissionTexture:{extensions:{KHR_texture_transform:gb("subSurface.translucencyIntensityTexture")}},diffuseTransmissionColorFactor:[new Mb(B.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Ub,(()=>3))],diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:gb("subSurface.translucencyColorTexture")}}}}}},cameras:Pb,extensions:{KHR_lights_punctual:{lights:{__array__:{__target__:!0,color:[new Ib(B.c.ANIMATIONTYPE_COLOR3,"diffuse",Ub,(()=>3))],gj:[new Ib(B.c.ANIMATIONTYPE_FLOAT,"intensity",Bb,(()=>1))],range:[new Ib(B.c.ANIMATIONTYPE_FLOAT,"range",Bb,(()=>1))],spot:{innerConeAngle:[new Ib(B.c.ANIMATIONTYPE_FLOAT,"innerAngle",Db,(()=>1))],outerConeAngle:[new Ib(B.c.ANIMATIONTYPE_FLOAT,"angle",Db,(()=>1))]}}}}}};class nb{constructor(E,b){this._gltf=E,this._infoTree=b}convert(E){let b,h=this._gltf,a=this._infoTree;if(!E.startsWith("/"))throw new Error("Path must start with a /");const k=E.split("/");k.shift();for(const G of k){if(a.__array__)a=a.__array__;else if(a=a[G],!a)throw new Error(`Path ${E} is invalid`);if(void 0===h)throw new Error(`Path ${E} is invalid`);h=h[G],a.__target__&&(b=h)}return{object:b,info:a}}}const db="KHR_animation_pointer";class cb extends nb{constructor(E){super(E,Ab)}}class zb{constructor(E){this.name=db,this._loader=E,this._pathToObjectConverter=new cb(this._loader.Wi)}get enabled(){return this._loader.isExtensionUsed(db)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(E,b,h,a,k){var G;const V=null===(G=a.target.extensions)||void 0===G?void 0:G.KHR_animation_pointer;if(!V||!this._pathToObjectConverter)return null;"pointer"!==a.target.path&&D.c.Warn(`${E}/target/path: Value (${a.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=a.target.node&&D.c.Warn(`${E}/target/node: Value (${a.target.node}) must not be present when using the ${this.name} extension`);const l=`${E}/extensions/${this.name}`,O=V.pointer;if(!O)throw new Error(`${l}: Pointer is missing`);try{const G=this._pathToObjectConverter.convert(O);return this._loader._loadAnimationChannelFromTargetInfoAsync(E,b,h,a,G,k)}catch(v){return D.c.Warn(`${l}/pointer: Invalid pointer (${O}) skipped`),null}}}C(db),X(db,!0,(E=>new zb(E)));class Zb{constructor(E,b,h){this.frame=E,this.action=b,this.onlyOnce=h,this.isDone=!1}_clone(){return new Zb(this.frame,this.action,this.onlyOnce)}}var Yb=h(10855),rb=h(10902);class wb{get loop(){return this._loop}set loop(E){E!==this._loop&&(this._loop=E,this.updateOptions({loop:E}))}get currentTime(){var E;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(E=rb.d.audioEngine)&&void 0!==E&&E.audioContext&&(this.isPlaying||this.isPaused)){const E=this.isPaused?0:rb.d.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+E}return 0}get spatialSound(){return this._spatialSound}set spatialSound(E){if(E==this._spatialSound)return;const b=this.isPlaying;this.pause(),E?(this._spatialSound=E,this._updateSpatialParameters()):this._disableSpatialSound(),b&&this.play()}constructor(E,b,h){var a;let G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new s.e,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=k.k.Zero(),this._localDirection=new k.k(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=E,h=h||u.b.LastCreatedScene)if(this._scene=h,wb._SceneComponentInitialization(h),this._readyToPlayCallback=G,this._customAttenuationFunction=(E,b,h,a,k)=>b<h?E*(1-b/h):0,l&&(this.autoplay=l.autoplay||!1,this._loop=l.loop||!1,void 0!==l.volume&&(this._volume=l.volume),this._spatialSound=l.spatialSound??!1,this.maxDistance=l.maxDistance??100,this.useCustomAttenuation=l.useCustomAttenuation??!1,this.rolloffFactor=l.rolloffFactor||1,this.refDistance=l.refDistance||1,this.distanceModel=l.distanceModel||"linear",this._playbackRate=l.playbackRate||1,this._streaming=l.streaming??!1,this._length=l.length,this._offset=l.offset),null!==(a=rb.d.audioEngine)&&void 0!==a&&a.canUseWebAudio&&rb.d.audioEngine.audioContext){this._soundGain=rb.d.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let E=!0;if(b)try{"string"===typeof b?(this._urlType="String",this._url=b):b instanceof ArrayBuffer?this._urlType="ArrayBuffer":b instanceof HTMLMediaElement?this._urlType="MediaElement":b instanceof MediaStream?this._urlType="MediaStream":b instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(b)&&(this._urlType="Array");let h=[],a=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=rb.d.audioEngine.audioContext.createMediaElementSource(b),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=rb.d.audioEngine.audioContext.createMediaStreamSource(b),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":b.byteLength>0&&(a=!0,this._soundLoaded(b));break;case"AudioBuffer":this._audioBufferLoaded(b);break;case"String":h.push(b);case"Array":0===h.length&&(h=b);for(let E=0;E<h.length;E++){const b=h[E];if(a=l&&l.skipCodecCheck||-1!==b.indexOf(".mp3",b.length-4)&&rb.d.audioEngine.isMP3supported||-1!==b.indexOf(".ogg",b.length-4)&&rb.d.audioEngine.isOGGsupported||-1!==b.indexOf(".wav",b.length-4)||-1!==b.indexOf(".m4a",b.length-4)||-1!==b.indexOf(".mp4",b.length-4)||-1!==b.indexOf("blob:"),a){this._streaming?(this._htmlAudioElement=new Audio(b),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,V.g.SetCorsBehavior(b,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(b,(E=>{this._soundLoaded(E)}),void 0,!0,!0,(E=>{E&&D.c.Error("XHR "+E.status+" error on: "+b+"."),D.c.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:E=!1}E?a||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):D.c.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(O){D.c.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),rb.d.audioEngine&&!rb.d.audioEngine.WarnedWebAudioUnsupported&&(D.c.Error("Web Audio is not supported by your browser."),rb.d.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var E;null!==(E=rb.d.audioEngine)&&void 0!==E&&E.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(E){var b;null!==(b=rb.d.audioEngine)&&void 0!==b&&b.audioContext&&(this._audioBuffer=E,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(E){var b;null!==(b=rb.d.audioEngine)&&void 0!==b&&b.audioContext&&rb.d.audioEngine.audioContext.decodeAudioData(E,(E=>{this._audioBufferLoaded(E)}),(E=>{D.c.Error("Error while decoding audio data for: "+this.name+" / Error: "+E)}))}setAudioBuffer(E){var b;null!==(b=rb.d.audioEngine)&&void 0!==b&&b.canUseWebAudio&&(this._audioBuffer=E,this._isReadyToPlay=!0)}updateOptions(E){E&&(this.loop=E.loop??this.loop,this.maxDistance=E.maxDistance??this.maxDistance,this.useCustomAttenuation=E.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=E.rolloffFactor??this.rolloffFactor,this.refDistance=E.refDistance??this.refDistance,this.distanceModel=E.distanceModel??this.distanceModel,this._playbackRate=E.playbackRate??this._playbackRate,this._length=E.length??void 0,this.spatialSound=E.spatialSound??this._spatialSound,this._setOffset(E.offset??void 0),this.setVolume(E.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var E;null!==(E=rb.d.audioEngine)&&void 0!==E&&E.canUseWebAudio&&rb.d.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??rb.d.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var E;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(E=this._soundPanner)||void 0===E||E.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var E;null!==(E=rb.d.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(E){var b;null!==(b=rb.d.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(E),this._isOutputConnected=!0)}setDirectionalCone(E,b,h){b<E?D.c.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=E,this._coneOuterAngle=b,this._coneOuterGain=h,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(E){if(E!=this._coneInnerAngle){var b;if(this._coneOuterAngle<E)return void D.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=E,null!==(b=rb.d.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(E){if(E!=this._coneOuterAngle){var b;if(E<this._coneInnerAngle)return void D.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=E,null!==(b=rb.d.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(E){var b;E.equals(this._position)||(this._position.p(E),null!==(b=rb.d.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(E){var b;this._localDirection=E,null!==(b=rb.d.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const E=this._connectedTransformNode.getWorldMatrix(),b=k.k.TransformNormal(this._localDirection,E);b.normalize(),this._soundPanner.orientationX.value=b.x,this._soundPanner.orientationY.value=b.y,this._soundPanner.orientationZ.value=b.z}updateDistanceFromListener(){var E;if(null!==(E=rb.d.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const E=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Xc(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,E,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(E){this._customAttenuationFunction=E}play(E,b,h){var a;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(a=rb.d.audioEngine)&&void 0!==a&&a.audioContext)try{var k,G;this._clearTimeoutsAndObservers();let a=E?(null===(k=rb.d.audioEngine)||void 0===k?void 0:k.audioContext.currentTime)+E:null===(G=rb.d.audioEngine)||void 0===G?void 0:G.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=rb.d.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const E=()=>{var h;if(null!==(h=rb.d.audioEngine)&&void 0!==h&&h.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=b??0;const h=this._htmlAudioElement.play();void 0!==h&&h.catch((()=>{var b,h;(null===(b=rb.d.audioEngine)||void 0===b||b.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(h=rb.d.audioEngine)||void 0===h?void 0:h.onAudioUnlockedObservable.addOnce((()=>{E()})))}))}else{var a;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(a=rb.d.audioEngine)||void 0===a?void 0:a.onAudioUnlockedObservable.addOnce((()=>{E()}))}};E()}}else{var V;const k=()=>{var k;if(null!==(k=rb.d.audioEngine)&&void 0!==k&&k.audioContext){var G;if(h=h||this._length,void 0!==b&&this._setOffset(b),this._soundSource){const E=this._soundSource;E.onended=()=>{E.disconnect()}}if(this._soundSource=null===(G=rb.d.audioEngine)||void 0===G?void 0:G.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var V;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==b&&(this._soundSource.loopStart=b),void 0!==h&&(this._soundSource.loopEnd=(0|b)+h),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},a=E?(null===(V=rb.d.audioEngine)||void 0===V?void 0:V.audioContext.currentTime)+E:rb.d.audioEngine.audioContext.currentTime;const k=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(a,k,this.loop?void 0:h)}}};"suspended"===(null===(V=rb.d.audioEngine)||void 0===V?void 0:V.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var E;"suspended"===(null===(E=rb.d.audioEngine)||void 0===E?void 0:E.audioContext.state)?(rb.d.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=rb.d.audioEngine.onAudioUnlockedObservable.addOnce((()=>{k()})))):k()}),500):k()}this._startTime=a,this.isPlaying=!0,this.isPaused=!1}catch(l){D.c.Error("Error while trying to play audio: "+this.name+", "+l.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(E){var b;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var h;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(h=this._streamingSource)||void 0===h||h.disconnect();this.isPlaying=!1}else if(null!==(b=rb.d.audioEngine)&&void 0!==b&&b.audioContext&&this._soundSource){const b=E?rb.d.audioEngine.audioContext.currentTime+E:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(b)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var E;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var b;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(b=this._streamingSource)||void 0===b||b.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(E=rb.d.audioEngine)&&void 0!==E&&E.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=rb.d.audioEngine.audioContext.currentTime-this._startTime)}setVolume(E,b){var h;null!==(h=rb.d.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._soundGain&&(b&&rb.d.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(rb.d.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,rb.d.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(E,rb.d.audioEngine.audioContext.currentTime+b)):this._soundGain.gain.value=E),this._volume=E}setPlaybackRate(E){this._playbackRate=E,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(E){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=E,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=E=>this._onRegisterAfterWorldMatrixUpdate(E),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(E){var b;if(E.getBoundingInfo){const b=E.getBoundingInfo();this.setPosition(b.boundingSphere.centerWorld)}else this.setPosition(E.absolutePosition);null!==(b=rb.d.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const E=()=>{this._isReadyToPlay?(h._audioBuffer=this.getAudioBuffer(),h._isReadyToPlay=!0,h.autoplay&&h.play(0,this._offset,this._length)):setTimeout(E,300)},b={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},h=new wb(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,b);return this.useCustomAttenuation&&h.setAttenuationFunction(this._customAttenuationFunction),h.setPosition(this._position),h.setPlaybackRate(this._playbackRate),E(),h}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const E={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(E.connectedMeshId=this._connectedTransformNode.id),E.position=this._position.qj(),E.refDistance=this.refDistance,E.distanceModel=this.distanceModel,E.isDirectional=this._isDirectional,E.localDirectionToMesh=this._localDirection.qj(),E.coneInnerAngle=this._coneInnerAngle,E.coneOuterAngle=this._coneOuterAngle,E.coneOuterGain=this._coneOuterGain),E}static Parse(E,b,h,a){const G=E.name;let V;V=E.url?h+E.url:h+G;const l={autoplay:E.autoplay,loop:E.loop,volume:E.volume,spatialSound:E.spatialSound,maxDistance:E.maxDistance,rolloffFactor:E.rolloffFactor,refDistance:E.refDistance,distanceModel:E.distanceModel,playbackRate:E.playbackRate};let O;if(a){const E=()=>{a._isReadyToPlay?(O._audioBuffer=a.getAudioBuffer(),O._isReadyToPlay=!0,O.autoplay&&O.play(0,O._offset,O._length)):setTimeout(E,300)};O=new wb(G,new ArrayBuffer(0),b,null,l),E()}else O=new wb(G,V,b,(()=>{b.removePendingData(O)}),l),b.addPendingData(O);if(E.position){const b=k.k.jh(E.position);O.setPosition(b)}if(E.isDirectional&&(O.setDirectionalCone(E.coneInnerAngle||360,E.coneOuterAngle||360,E.coneOuterGain||0),E.localDirectionToMesh)){const b=k.k.jh(E.localDirectionToMesh);O.setLocalDirectionToMesh(b)}if(E.connectedMeshId){const h=b.getMeshById(E.connectedMeshId);h&&O.attachToMesh(h)}return E.metadata&&(O.metadata=E.metadata),O}_setOffset(E){this._offset!==E&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=E)}_clearTimeoutsAndObservers(){var E;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(E=rb.d.audioEngine)||void 0===E||E.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}wb._SceneComponentInitialization=E=>{throw(0,Yb.c)("AudioSceneComponent")},(0,n.f)("BABYLON.Sound",wb);class Nb{constructor(E,b,h){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],b.length!==h.length)throw new Error("Sounds length does not equal weights length");this.loop=E,this._weights=h;let a=0;for(const G of h)a+=G;const k=a>0?1/a:0;for(let G=0;G<this._weights.length;G++)this._weights[G]*=k;this._sounds=b;for(const G of this._sounds)G.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(E){if(E!==this._coneInnerAngle){if(this._coneOuterAngle<E)return void D.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=E;for(const b of this._sounds)b.directionalConeInnerAngle=E}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(E){if(E!==this._coneOuterAngle){if(E<this._coneInnerAngle)return void D.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=E;for(const b of this._sounds)b.directionalConeOuterAngle=E}}get volume(){return this._volume}set volume(E){if(E!==this._volume)for(const b of this._sounds)b.setVolume(E)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(E){if(!this.isPaused){this.stop();const E=Math.random();let b=0;for(let h=0;h<this._weights.length;h++)if(b+=this._weights[h],E<=b){this._currentIndex=h;break}}const b=this._sounds[this._currentIndex??0];b.isReady()?b.play(0,this.isPaused?void 0:E):b.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Hb{constructor(E){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(E=E||u.b.LastCreatedScene)&&(this._scene=E,this.soundCollection=[],this._options=b,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var E;null!==(E=rb.d.audioEngine)&&void 0!==E&&E.canUseWebAudio&&rb.d.audioEngine.audioContext&&(this._outputAudioNode=rb.d.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(rb.d.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(rb.d.audioEngine&&rb.d.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(E){var b;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(b=rb.d.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._outputAudioNode&&E.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==E.soundTrackId&&(-1===E.soundTrackId?this._scene.mainSoundTrack.removeSound(E):this._scene.soundTracks&&this._scene.soundTracks[E.soundTrackId].removeSound(E)),this.soundCollection.push(E),E.soundTrackId=this.id}removeSound(E){const b=this.soundCollection.indexOf(E);-1!==b&&this.soundCollection.splice(b,1)}setVolume(E){var b;null!==(b=rb.d.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=E)}switchPanningModelToHRTF(){var E;if(null!==(E=rb.d.audioEngine)&&void 0!==E&&E.canUseWebAudio)for(let b=0;b<this.soundCollection.length;b++)this.soundCollection[b].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var E;if(null!==(E=rb.d.audioEngine)&&void 0!==E&&E.canUseWebAudio)for(let b=0;b<this.soundCollection.length;b++)this.soundCollection[b].switchPanningModelToEqualPower()}connectToAnalyser(E){var b;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=E,null!==(b=rb.d.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,rb.d.audioEngine.masterGain))}}var fb=h(11257),Fb=h(11163),yb=(h(11722),h(10846));(0,h(11814).h)(fb.e.NAME_AUDIO,((E,b,h,a)=>{let k,G=[];if(h.hk=h.hk||[],void 0!==E.hk&&null!==E.hk)for(let l=0,O=E.hk.length;l<O;l++){var V;const O=E.hk[l];null!==(V=rb.d.audioEngine)&&void 0!==V&&V.canUseWebAudio?(O.url||(O.url=O.name),G[O.url]?h.hk.push(wb.Parse(O,b,a,G[O.url])):(k=wb.Parse(O,b,a),G[O.url]=k,h.hk.push(k))):h.hk.push(new wb(O.name,null,b))}G=[]})),Object.defineProperty(Fb.e.prototype,"mainSoundTrack",{get:function(){let E=this._getComponent(fb.e.NAME_AUDIO);return E||(E=new eb(this),this.fb(E)),this._mainSoundTrack||(this._mainSoundTrack=new Hb(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),Fb.e.prototype.getSoundByName=function(E){let b;for(b=0;b<this.mainSoundTrack.soundCollection.length;b++)if(this.mainSoundTrack.soundCollection[b].name===E)return this.mainSoundTrack.soundCollection[b];if(this.soundTracks)for(let h=0;h<this.soundTracks.length;h++)for(b=0;b<this.soundTracks[h].soundCollection.length;b++)if(this.soundTracks[h].soundCollection[b].name===E)return this.soundTracks[h].soundCollection[b];return null},Object.defineProperty(Fb.e.prototype,"audioEnabled",{get:function(){let E=this._getComponent(fb.e.NAME_AUDIO);return E||(E=new eb(this),this.fb(E)),E.audioEnabled},set:function(E){let b=this._getComponent(fb.e.NAME_AUDIO);b||(b=new eb(this),this.fb(b)),E?b.enableAudio():b.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(Fb.e.prototype,"headphone",{get:function(){let E=this._getComponent(fb.e.NAME_AUDIO);return E||(E=new eb(this),this.fb(E)),E.headphone},set:function(E){let b=this._getComponent(fb.e.NAME_AUDIO);b||(b=new eb(this),this.fb(b)),E?b.switchAudioModeForHeadphones():b.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(Fb.e.prototype,"audioListenerPositionProvider",{get:function(){let E=this._getComponent(fb.e.NAME_AUDIO);return E||(E=new eb(this),this.fb(E)),E.audioListenerPositionProvider},set:function(E){let b=this._getComponent(fb.e.NAME_AUDIO);if(b||(b=new eb(this),this.fb(b)),E&&"function"!==typeof E)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");b.audioListenerPositionProvider=E},enumerable:!0,configurable:!0}),Object.defineProperty(Fb.e.prototype,"audioListenerRotationProvider",{get:function(){let E=this._getComponent(fb.e.NAME_AUDIO);return E||(E=new eb(this),this.fb(E)),E.audioListenerRotationProvider},set:function(E){let b=this._getComponent(fb.e.NAME_AUDIO);if(b||(b=new eb(this),this.fb(b)),E&&"function"!==typeof E)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");b.audioListenerRotationProvider=E},enumerable:!0,configurable:!0}),Object.defineProperty(Fb.e.prototype,"audioPositioningRefreshRate",{get:function(){let E=this._getComponent(fb.e.NAME_AUDIO);return E||(E=new eb(this),this.fb(E)),E.audioPositioningRefreshRate},set:function(E){let b=this._getComponent(fb.e.NAME_AUDIO);b||(b=new eb(this),this.fb(b)),b.audioPositioningRefreshRate=E},enumerable:!0,configurable:!0});class eb{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(E){this.name=fb.e.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new k.k,this._cachedCameraPosition=new k.k,this._lastCheck=0,this._invertMatrixTemp=new k.d,this._cameraDirectionTemp=new k.k,(E=E||u.b.LastCreatedScene)&&(this.Xd=E,E.soundTracks=[],E.hk=[])}register(){this.Xd._afterRenderStage.registerStep(fb.e.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(E){if(E.hk=[],this.Xd.soundTracks)for(let b=0;b<this.Xd.soundTracks.length;b++){const h=this.Xd.soundTracks[b];for(let b=0;b<h.soundCollection.length;b++)E.hk.push(h.soundCollection[b].serialize())}}addFromContainer(E){E.hk&&E.hk.forEach((E=>{E.play(),E.autoplay=!0,this.Xd.mainSoundTrack.addSound(E)}))}removeFromContainer(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];E.hk&&E.hk.forEach((E=>{E.stop(),E.autoplay=!1,this.Xd.mainSoundTrack.removeSound(E),b&&E.dispose()}))}dispose(){const E=this.Xd;if(E._mainSoundTrack&&E.mainSoundTrack.dispose(),E.soundTracks)for(let b=0;b<E.soundTracks.length;b++)E.soundTracks[b].dispose()}disableAudio(){const E=this.Xd;let b;for(this._audioEnabled=!1,rb.d.audioEngine&&rb.d.audioEngine.audioContext&&rb.d.audioEngine.audioContext.suspend(),b=0;b<E.mainSoundTrack.soundCollection.length;b++)E.mainSoundTrack.soundCollection[b].pause();if(E.soundTracks)for(b=0;b<E.soundTracks.length;b++)for(let h=0;h<E.soundTracks[b].soundCollection.length;h++)E.soundTracks[b].soundCollection[h].pause()}enableAudio(){const E=this.Xd;let b;for(this._audioEnabled=!0,rb.d.audioEngine&&rb.d.audioEngine.audioContext&&rb.d.audioEngine.audioContext.resume(),b=0;b<E.mainSoundTrack.soundCollection.length;b++)E.mainSoundTrack.soundCollection[b].isPaused&&E.mainSoundTrack.soundCollection[b].play();if(E.soundTracks)for(b=0;b<E.soundTracks.length;b++)for(let h=0;h<E.soundTracks[b].soundCollection.length;h++)E.soundTracks[b].soundCollection[h].isPaused&&E.soundTracks[b].soundCollection[h].play()}switchAudioModeForHeadphones(){const E=this.Xd;if(this._headphone=!0,E.mainSoundTrack.switchPanningModelToHRTF(),E.soundTracks)for(let b=0;b<E.soundTracks.length;b++)E.soundTracks[b].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const E=this.Xd;if(this._headphone=!1,E.mainSoundTrack.switchPanningModelToEqualPower(),E.soundTracks)for(let b=0;b<E.soundTracks.length;b++)E.soundTracks[b].switchPanningModelToEqualPower()}_afterRender(){const E=yb.c.Now;if(this._lastCheck&&E-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=E;const b=this.Xd;if(!this._audioEnabled||!b._mainSoundTrack||!b.soundTracks||0===b._mainSoundTrack.soundCollection.length&&1===b.soundTracks.length)return;const h=rb.d.audioEngine;if(h&&h.audioContext){let E,a=b.activeCamera;if(b.activeCameras&&b.activeCameras.length>0&&(a=b.activeCameras[0]),this.audioListenerPositionProvider){const E=this.audioListenerPositionProvider();h.audioContext.listener.setPosition(E.x||0,E.y||0,E.z||0)}else a?this._cachedCameraPosition.equals(a.globalPosition)||(this._cachedCameraPosition.p(a.globalPosition),h.audioContext.listener.setPosition(a.globalPosition.x,a.globalPosition.y,a.globalPosition.z)):h.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const E=this.audioListenerRotationProvider();h.audioContext.listener.setOrientation(E.x||0,E.y||0,E.z||0,0,1,0)}else a?(a.rigCameras&&a.rigCameras.length>0&&(a=a.rigCameras[0]),a.getViewMatrix().invertToRef(this._invertMatrixTemp),k.k.TransformNormalToRef(eb._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),h.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):h.audioContext.listener.setOrientation(0,0,0,0,1,0);for(E=0;E<b.mainSoundTrack.soundCollection.length;E++){const h=b.mainSoundTrack.soundCollection[E];h.useCustomAttenuation&&h.updateDistanceFromListener()}if(b.soundTracks)for(E=0;E<b.soundTracks.length;E++)for(let h=0;h<b.soundTracks[E].soundCollection.length;h++){const a=b.soundTracks[E].soundCollection[h];a.useCustomAttenuation&&a.updateDistanceFromListener()}}}}eb._CameraDirection=new k.k(0,0,-1),wb._SceneComponentInitialization=E=>{let b=E._getComponent(fb.e.NAME_AUDIO);b||(b=new eb(E),E.fb(b))};const Jb="MSFT_audio_emitter";class mb{constructor(E){this.name=Jb,this._loader=E,this.enabled=this._loader.isExtensionUsed(Jb)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const E=this._loader.Wi.extensions;if(E&&E[this.name]){const b=E[this.name];this._clips=b.clips,this._emitters=b.emitters,R.Assign(this._clips),R.Assign(this._emitters)}}loadSceneAsync(E,b){return Q.LoadExtensionAsync(E,b,this.name,((h,a)=>{const k=new Array;k.push(this._loader.loadSceneAsync(E,b));for(const E of a.emitters){const b=R.Get(`${h}/emitters`,this._emitters,E);if(void 0!=b.refDistance||void 0!=b.maxDistance||void 0!=b.rolloffFactor||void 0!=b.distanceModel||void 0!=b.innerAngle||void 0!=b.outerAngle)throw new Error(`${h}: Direction or Distance properties are not allowed on emitters attached to a scene`);k.push(this._loadEmitterAsync(`${h}/emitters/${b.index}`,b))}return Promise.all(k).then((()=>{}))}))}loadNodeAsync(E,b,h){return Q.LoadExtensionAsync(E,b,this.name,((E,a)=>{const G=new Array;return this._loader.loadNodeAsync(E,b,(b=>{for(const h of a.emitters){const a=R.Get(`${E}/emitters`,this._emitters,h);G.push(this._loadEmitterAsync(`${E}/emitters/${a.index}`,a).then((()=>{for(const E of a._babylonSounds)E.attachToMesh(b),void 0==a.innerAngle&&void 0==a.outerAngle||(E.setLocalDirectionToMesh(k.k.Forward()),E.setDirectionalCone(2*V.g.ToDegrees(void 0==a.innerAngle?Math.PI:a.innerAngle),2*V.g.ToDegrees(void 0==a.outerAngle?Math.PI:a.outerAngle),0))})))}h(b)})).then((E=>Promise.all(G).then((()=>E))))}))}loadAnimationAsync(E,b){return Q.LoadExtensionAsync(E,b,this.name,((h,a)=>this._loader.loadAnimationAsync(E,b).then((k=>{const G=new Array;R.Assign(a.events);for(const V of a.events)G.push(this._loadAnimationEventAsync(`${h}/events/${V.index}`,E,b,V,k));return Promise.all(G).then((()=>k))}))))}_loadClipAsync(E,b){if(b._objectURL)return b._objectURL;let h;if(b.uri)h=this._loader.loadUriAsync(E,b,b.uri);else{const a=R.Get(`${E}/bufferView`,this._loader.Wi.bufferViews,b.bufferView);h=this._loader.loadBufferViewAsync(`/bufferViews/${a.index}`,a)}return b._objectURL=h.then((E=>URL.createObjectURL(new Blob([E],{type:b.mimeType})))),b._objectURL}_loadEmitterAsync(E,b){if(b._babylonSounds=b._babylonSounds||[],!b._babylonData){const E=new Array,h=b.name||`emitter${b.index}`,a={loop:!1,autoplay:!1,volume:void 0==b.volume?1:b.volume};for(let G=0;G<b.clips.length;G++){const k=`/extensions/${this.name}/clips`,V=R.Get(k,this._clips,b.clips[G].clip);E.push(this._loadClipAsync(`${k}/${b.clips[G].clip}`,V).then((E=>{const k=b._babylonSounds[G]=new wb(h,E,this._loader.babylonScene,null,a);k.refDistance=b.refDistance||1,k.maxDistance=b.maxDistance||256,k.rolloffFactor=b.rolloffFactor||1,k.distanceModel=b.distanceModel||"exponential"})))}const k=Promise.all(E).then((()=>{const E=b.clips.map((E=>E.weight||1)),h=new Nb(b.loop||!1,b._babylonSounds,E);b.innerAngle&&(h.directionalConeInnerAngle=2*V.g.ToDegrees(b.innerAngle)),b.outerAngle&&(h.directionalConeOuterAngle=2*V.g.ToDegrees(b.outerAngle)),b.volume&&(h.volume=b.volume),b._babylonData.sound=h}));b._babylonData={loaded:k}}return b._babylonData.loaded}_getEventAction(E,b,h,a,k){switch(h){case"play":return E=>{const h=(k||0)+(E-a);b.play(h)};case"stop":return()=>{b.stop()};case"pause":return()=>{b.pause()};default:throw new Error(`${E}: Unsupported action ${h}`)}}_loadAnimationEventAsync(E,b,h,a,k){if(0==k.targetedAnimations.length)return Promise.resolve();const G=k.targetedAnimations[0],V=a.j,l=R.Get(`/extensions/${this.name}/emitters`,this._emitters,V);return this._loadEmitterAsync(E,l).then((()=>{const b=l._babylonData.sound;if(b){const h=new Zb(a.time,this._getEventAction(E,b,a.action,a.time,a.startOffset));G.animation.addEvent(h),k.onAnimationGroupEndObservable.add((()=>{b.stop()})),k.onAnimationGroupPauseObservable.add((()=>{b.pause()}))}}))}}C(Jb),X(Jb,!0,(E=>new mb(E)));const Kb="MSFT_lod";class xb{constructor(E){var b;this.name=Kb,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new s.e,this.onMaterialLODsLoadedObservable=new s.e,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=E,this.maxLODsToLoad=(null===(b=this._loader.parent.extensionOptions[Kb])||void 0===b?void 0:b.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Kb)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let E=0;E<this._nodePromiseLODs.length;E++){const b=Promise.all(this._nodePromiseLODs[E]).then((()=>{0!==E&&(this._loader.endPerformanceCounter(`Node LOD ${E}`),this._loader.log(`Loaded node LOD ${E}`)),this.onNodeLODsLoadedObservable.notifyObservers(E),E!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${E+1}`),this._loadBufferLOD(this._nodeBufferLODs,E+1),this._nodeSignalLODs[E]&&this._nodeSignalLODs[E].resolve())}));this._loader._completePromises.push(b)}for(let E=0;E<this._materialPromiseLODs.length;E++){const b=Promise.all(this._materialPromiseLODs[E]).then((()=>{0!==E&&(this._loader.endPerformanceCounter(`Material LOD ${E}`),this._loader.log(`Loaded material LOD ${E}`)),this.onMaterialLODsLoadedObservable.notifyObservers(E),E!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${E+1}`),this._loadBufferLOD(this._materialBufferLODs,E+1),this._materialSignalLODs[E]&&this._materialSignalLODs[E].resolve())}));this._loader._completePromises.push(b)}}loadSceneAsync(E,b){const h=this._loader.loadSceneAsync(E,b);return this._loadBufferLOD(this._bufferLODs,0),h}loadNodeAsync(E,b,h){return Q.LoadExtensionAsync(E,b,this.name,((E,k)=>{let G;const V=this._getLODs(E,b,this._loader.Wi.nodes,k.ids);this._loader.logOpen(`${E}`);for(let b=0;b<V.length;b++){const E=V[b];0!==b&&(this._nodeIndexLOD=b,this._nodeSignalLODs[b]=this._nodeSignalLODs[b]||new a);const k=E=>{h(E),E.Gb(!1)},l=this._loader.loadNodeAsync(`/nodes/${E.index}`,E,k).then((E=>{if(0!==b){const E=V[b-1];E._babylonTransformNode&&(this._disposeTransformNode(E._babylonTransformNode),delete E._babylonTransformNode)}return E.Gb(!0),E}));this._nodePromiseLODs[b]=this._nodePromiseLODs[b]||[],0===b?G=l:(this._nodeIndexLOD=null,this._nodePromiseLODs[b].push(l))}return this._loader.logClose(),G}))}_loadMaterialAsync(E,b,h,a,k){return this._nodeIndexLOD?null:Q.LoadExtensionAsync(E,b,this.name,((E,G)=>{let V;const l=this._getLODs(E,b,this._loader.Wi.materials,G.ids);this._loader.logOpen(`${E}`);for(let b=0;b<l.length;b++){const E=l[b];0!==b&&(this._materialIndexLOD=b);const G=this._loader._loadMaterialAsync(`/materials/${E.index}`,E,h,a,(E=>{0===b&&k(E)})).then((E=>{if(0!==b){k(E);const h=l[b-1]._data;h[a]&&(this._disposeMaterials([h[a].babylonMaterial]),delete h[a])}return E}));this._materialPromiseLODs[b]=this._materialPromiseLODs[b]||[],0===b?V=G:(this._materialIndexLOD=null,this._materialPromiseLODs[b].push(G))}return this._loader.logClose(),V}))}_loadUriAsync(E,b,h){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const k=this._nodeIndexLOD-1;return this._nodeSignalLODs[k]=this._nodeSignalLODs[k]||new a,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((()=>this._loader.loadUriAsync(E,b,h)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const k=this._materialIndexLOD-1;return this._materialSignalLODs[k]=this._materialSignalLODs[k]||new a,this._materialSignalLODs[k].promise.then((()=>this._loader.loadUriAsync(E,b,h)))}return null}loadBufferAsync(E,b,h,k){if(this._loader.parent.useRangeRequests&&!b.uri){if(!this._loader.bin)throw new Error(`${E}: Uri is missing or the binary glTF is missing its binary chunk`);const b=(E,b)=>{const G=h,V=G+k-1;let l=E[b];return l?(l.start=Math.min(l.start,G),l.end=Math.max(l.end,V)):(l={start:G,end:V,loaded:new a},E[b]=l),l.loaded.promise.then((E=>new Uint8Array(E.buffer,E.byteOffset+h-l.start,k)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?b(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?b(this._materialBufferLODs,this._materialIndexLOD):b(this._bufferLODs,0)}return null}_loadBufferLOD(E,b){const h=E[b];h&&(this._loader.log(`Loading buffer range [${h.start}-${h.end}]`),this._loader.bin.readAsync(h.start,h.end-h.start+1).then((E=>{h.loaded.resolve(E)}),(E=>{h.loaded.reject(E)})))}_getLODs(E,b,h,a){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const k=[];for(let G=a.length-1;G>=0;G--)if(k.push(R.Get(`${E}/ids/${a[G]}`,h,a[G])),k.length===this.maxLODsToLoad)return k;return k.push(b),k}_disposeTransformNode(E){const b=[],h=E.material;h&&b.push(h);for(const k of E.getChildMeshes())k.material&&b.push(k.material);E.dispose();const a=b.filter((E=>this._loader.babylonScene.meshes.every((b=>b.material!=E))));this._disposeMaterials(a)}_disposeMaterials(E){const b={};for(const h of E){for(const E of h.getActiveTextures())b[E.uniqueId]=E;h.dispose()}for(const h in b)for(const E of this._loader.babylonScene.materials)E.hasTexture(b[h])&&delete b[h];for(const h in b)b[h].dispose()}}C(Kb),X(Kb,!0,(E=>new xb(E)));const Wb="MSFT_minecraftMesh";class Lb{constructor(E){this.name=Wb,this._loader=E,this.enabled=this._loader.isExtensionUsed(Wb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,b,h){return Q.LoadExtraAsync(E,b,this.name,((a,k)=>{if(k){if(!(h instanceof c))throw new Error(`${a}: Material type not supported`);const k=this._loader.loadMaterialPropertiesAsync(E,b,h);return h.needAlphaBlending()&&(h.forceDepthWrite=!0,h.separateCullingPass=!0),h.xh=h.forceDepthWrite,h.twoSidedLighting=!0,k}return null}))}}C(Wb),X(Wb,!0,(E=>new Lb(E)));const tb="MSFT_sRGBFactors";class Tb{constructor(E){this.name=tb,this._loader=E,this.enabled=this._loader.isExtensionUsed(tb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,b,h){return Q.LoadExtraAsync(E,b,this.name,((a,k)=>{if(k){if(!(h instanceof c))throw new Error(`${a}: Material type not supported`);const k=this._loader.loadMaterialPropertiesAsync(E,b,h),G=h.va().getEngine().useExactSrgbConversions;return h.albedoTexture||h.albedoColor.toLinearSpaceToRef(h.albedoColor,G),h.reflectivityTexture||h.reflectivityColor.toLinearSpaceToRef(h.reflectivityColor,G),k}return null}))}}C(tb),X(tb,!0,(E=>new Tb(E)));var Xb,Cb=h(10966);!function(E){E[E.Input=0]="Input",E[E.Output=1]="Output"}(Xb||(Xb={}));class qb{constructor(E,b,h){this._ownerBlock=h,this._connectedPoint=[],this.uniqueId=(0,Cb.e)(),this.connectedPointIds=[],this.name=E,this._connectionType=b}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(E){if(this._connectionType===E._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||E._isSingularConnection()&&E._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(E),E._connectedPoint.push(this)}serialize(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};E.uniqueId=this.uniqueId,E.name=this.name,E._connectionType=this._connectionType,E.connectedPointIds=[],E.className=this.getClassName();for(const b of this._connectedPoint)E.connectedPointIds.push(b.uniqueId)}getClassName(){return"FGConnection"}deserialize(E){this.uniqueId=E.uniqueId,this.name=E.name,this._connectionType=E._connectionType,this.connectedPointIds=E.connectedPointIds}static Parse(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=arguments.length>1?arguments[1]:void 0;const h=new(V.g.Instantiate(E.className))(E.name,E._connectionType,b);return h.deserialize(E),h}}class Rb{constructor(E){this.value=this._toInt(E)}_toInt(E){return 0|E}add(E){return new Rb(this.value+E.value)}Xc(E){return new Rb(this.value-E.value)}multiply(E){return new Rb(Math.imul(this.value,E.value))}divide(E){return new Rb(this.value/E.value)}getClassName(){return Rb.ClassName}equals(E){return this.value===E.value}static Parse(E){return new Rb(E.value)}}Rb.ClassName="FlowGraphInteger",(0,n.f)("FlowGraphInteger",Rb);class Qb{constructor(E,b){this.typeName=E,this.defaultValue=b}serialize(E){E.typeName=this.typeName,E.defaultValue=this.defaultValue}static Parse(E){return new Qb(E.typeName,E.defaultValue)}}const ib=new Qb("any",void 0),pb=(new Qb("string",""),new Qb("number",0)),Eh=new Qb("boolean",!1),bh=new Qb("Vector2",k.j.Zero()),hh=new Qb("o",k.k.Zero()),ah=(new Qb("Vector4",k.n.Zero()),new Qb("Matrix",k.d.Identity())),kh=(new Qb("gb",G.b.Black()),new Qb("ob",new G.f(0,0,0,0)),new Qb("Quaternion",k.g.Identity()),new Qb("FlowGraphInteger",new Rb(0)));class Gh extends qb{constructor(E,b,h,a){super(E,b,h),this.richType=a}_isSingularConnection(){return 0===this.connectionType}setValue(E,b){b._setConnectionValue(this,E)}connectTo(E){super.connectTo(E)}_getValueOrDefault(E){return E._hasConnectionValue(this)?E._getConnectionValue(this):this.richType.defaultValue}getValue(E){return 1===this.connectionType?(E._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(E),this._getValueOrDefault(E)):this.isConnected()?this._connectedPoint[0].getValue(E):this._getValueOrDefault(E)}getClassName(){return"FGDataConnection"}serialize(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(E),E.richType={},this.richType.serialize(E.richType)}static Parse(E,b){const h=qb.Parse(E,b);return h.richType=Qb.Parse(E.richType),h}}function Vh(E){return"Mesh"===E||"AbstractMesh"===E||"GroundMesh"===E||"InstanceMesh"===E||"LinesMesh"===E||"GoldbergMesh"===E||"GreasedLineMesh"===E||"TrailMesh"===E}function lh(E){return"Vector2"===E||"o"===E||"Vector4"===E||"Quaternion"===E||"gb"===E||"ob"===E}function Oh(E,b,h){var a;const k=(null===b||void 0===b||null===(a=b.getClassName)||void 0===a?void 0:a.call(b))??"";Vh(k)?h[E]={name:b.name,className:k}:lh(k)?h[E]={value:b.qj(),className:k}:h[E]=b}function vh(E,b,h){const a=b[E];let V;const l=null===a||void 0===a?void 0:a.className;return V=Vh(l)?h.getMeshByName(a.name):lh(l)?function(E,b){if("Vector2"===E)return k.j.jh(b);if("o"===E)return k.k.jh(b);if("Vector4"===E)return k.n.jh(b);if("Quaternion"===E)return k.g.jh(b);if("gb"===E)return new G.b(b[0],b[1],b[2]);if("ob"===E)return new G.f(b[0],b[1],b[2],b[3]);throw new Error(`Unknown vector class name ${E}`)}(l,a.value):"Matrix"===l?k.d.jh(a.value):l===Rb.ClassName?Rb.Parse(a):a&&void 0!==a.value?a.value:a,V}(0,n.f)("FGDataConnection",Gh);class sh{constructor(E){var b;this.config=E,this.uniqueId=(0,Cb.e)(),this.name=(null===(b=this.config)||void 0===b?void 0:b.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(E){}registerDataInput(E,b){const h=new Gh(E,0,this,b);return this.dataInputs.push(h),h}registerDataOutput(E,b){const h=new Gh(E,1,this,b);return this.dataOutputs.push(h),h}getDataInput(E){return this.dataInputs.find((b=>b.name===E))}getDataOutput(E){return this.dataOutputs.find((b=>b.name===E))}serialize(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};E.uniqueId=this.uniqueId,E.config={},this.config&&(E.config.name=this.config.name),E.dataInputs=[],E.dataOutputs=[],E.className=this.getClassName();for(const b of this.dataInputs){const h={};b.serialize(h),E.dataInputs.push(h)}for(const b of this.dataOutputs){const h={};b.serialize(h),E.dataOutputs.push(h)}}getClassName(){return"FGBlock"}static Parse(E,b){const h=V.g.Instantiate(E.className),a={},k=b.valueParseFunction??vh;if(E.config)for(const V in E.config)a[V]=k(V,E.config,b.Xd);var G;("FGSetPropertyBlock"===(G=E.className)||"FGGetPropertyBlock"===G||"FGPlayAnimationBlock"===G||"FGMeshPickEventBlock"===G)&&(a.pathConverter=b.pathConverter);const l=new h(a);l.uniqueId=E.uniqueId;for(let V=0;V<E.dataInputs.length;V++){const b=l.getDataInput(E.dataInputs[V].name);if(!b)throw new Error("Could not find data input with name "+E.dataInputs[V].name+" in block "+E.className);b.deserialize(E.dataInputs[V])}for(let V=0;V<E.dataOutputs.length;V++){const b=l.getDataOutput(E.dataOutputs[V].name);if(!b)throw new Error("Could not find data output with name "+E.dataOutputs[V].name+" in block "+E.className);b.deserialize(E.dataOutputs[V])}return l.metadata=E.metadata,l.deserialize&&l.deserialize(E),l}}class Uh extends qb{_isSingularConnection(){return 1===this.connectionType}_activateSignal(E){var b;0===this.connectionType?(E._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(E,this),E._increaseExecutionId()):null===(b=this._connectedPoint[0])||void 0===b||b._activateSignal(E)}}(0,n.f)("FlowGraphSignalConnection",Uh);class Bh extends sh{constructor(E){super(E),this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in")}_registerSignalInput(E){const b=new Uh(E,0,this);return this.signalInputs.push(b),b}_registerSignalOutput(E){const b=new Uh(E,1,this);return this.signalOutputs.push(b),b}getSignalInput(E){return this.signalInputs.find((b=>b.name===E))}getSignalOutput(E){return this.signalOutputs.find((b=>b.name===E))}serialize(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(E),E.signalInputs=[],E.signalOutputs=[];for(const b of this.signalInputs){const h={};b.serialize(h),E.signalInputs.push(h)}for(const b of this.signalOutputs){const h={};b.serialize(h),E.signalOutputs.push(h)}}deserialize(E){for(let b=0;b<E.signalInputs.length;b++){const h=this.getSignalInput(E.signalInputs[b].name);if(!h)throw new Error("Could not find signal input with name "+E.signalInputs[b].name+" in block "+E.className);h.deserialize(E.signalInputs[b])}for(let b=0;b<E.signalOutputs.length;b++){const h=this.getSignalOutput(E.signalOutputs[b].name);if(!h)throw new Error("Could not find signal output with name "+E.signalOutputs[b].name+" in block "+E.className);h.deserialize(E.signalOutputs[b])}}getClassName(){return"FGExecutionBlock"}}class oh extends Bh{constructor(E){super(E),this.out=this._registerSignalOutput("out"),this.done=this._registerSignalOutput("done")}_startPendingTasks(E){this._preparePendingTasks(E),E._addPendingBlock(this)}}class uh extends oh{_execute(E){E._notifyExecuteNode(this),this.out._activateSignal(E)}}class Dh{constructor(E){this.uniqueId=(0,Cb.e)(),this._userVariables={},this._executionVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new s.e,this._configuration=E}hasVariable(E){return E in this._userVariables}setVariable(E,b){this._userVariables[E]=b}getVariable(E){return this._userVariables[E]}get userVariables(){return this._userVariables}_getUniqueIdPrefixedName(E,b){return`${E.uniqueId}_${b}`}_setExecutionVariable(E,b,h){this._executionVariables[this._getUniqueIdPrefixedName(E,b)]=h}_getExecutionVariable(E,b,h){return this._hasExecutionVariable(E,b)?this._executionVariables[this._getUniqueIdPrefixedName(E,b)]:h}_deleteExecutionVariable(E,b){delete this._executionVariables[this._getUniqueIdPrefixedName(E,b)]}_hasExecutionVariable(E,b){return this._getUniqueIdPrefixedName(E,b)in this._executionVariables}_hasConnectionValue(E){return E.uniqueId in this._connectionValues}_setConnectionValue(E,b){this._connectionValues[E.uniqueId]=b}_getConnectionValue(E){return this._connectionValues[E.uniqueId]}get configuration(){return this._configuration}_addPendingBlock(E){this._pendingBlocks.push(E)}_removePendingBlock(E){const b=this._pendingBlocks.indexOf(E);-1!==b&&this._pendingBlocks.splice(b,1)}_clearPendingBlocks(){for(const E of this._pendingBlocks)E._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(E){this.onNodeExecutedObservable.notifyObservers(E)}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Oh;E.uniqueId=this.uniqueId,E._userVariables={};for(const h in this._userVariables)b(h,this._userVariables[h],E._userVariables);E._connectionValues={};for(const h in this._connectionValues)b(h,this._connectionValues[h],E._connectionValues)}getClassName(){return"FGContext"}static Parse(E,b){const h=b.graph.createContext(),a=b.valueParseFunction??vh;h.uniqueId=E.uniqueId;for(const k in E._userVariables){const b=a(k,E._userVariables,h._configuration.Xd);h._userVariables[k]=b}for(const k in E._connectionValues){const b=a(k,E._connectionValues,h._configuration.Xd);h._connectionValues[k]=b}return h}}(0,I.d)([(0,j.H)()],Dh.prototype,"uniqueId",void 0);var gh,Sh,Mh=h(11261);function Ih(E,b){return!(!E.parent||E.parent!==b&&!Ih(E.parent,b))}class jh extends uh{constructor(E){super(E),this.config=E}_getReferencedMesh(){const E=this.config.pathConverter.convert(this.config.path),b=E.info.getObject(E.object);if(!b||!(b instanceof w.b))throw new Error("Mesh pick event block requires a valid mesh");return b}_preparePendingTasks(E){let b=E._getExecutionVariable(this,"meshPickObserver");if(!b){const h=this._getReferencedMesh();E._setExecutionVariable(this,"mesh",h),b=h.va().onPointerObservable.add((b=>{var a,k,G;b.type===Mh.d.POINTERPICK&&null!==(a=b.pickInfo)&&void 0!==a&&a.pickedMesh&&((null===(k=b.pickInfo)||void 0===k?void 0:k.pickedMesh)===h||Ih(null===(G=b.pickInfo)||void 0===G?void 0:G.pickedMesh,h))&&this._execute(E)}));const a=h.rj.add((()=>this._onDispose));E._setExecutionVariable(this,"meshPickObserver",b),E._setExecutionVariable(this,"meshDisposeObserver",a)}}_onDispose(E){this._cancelPendingTasks(E),E._removePendingBlock(this)}_cancelPendingTasks(E){const b=E._getExecutionVariable(this,"mesh"),h=E._getExecutionVariable(this,"meshPickObserver"),a=E._getExecutionVariable(this,"meshDisposeObserver");b.va().onPointerObservable.remove(h),b.rj.remove(a),E._deleteExecutionVariable(this,"mesh"),E._deleteExecutionVariable(this,"meshPickObserver"),E._deleteExecutionVariable(this,"meshDisposeObserver")}getClassName(){return jh.ClassName}serialize(E){super.serialize(E),E.config.path=this.config.path}}jh.ClassName="FGMeshPickEventBlock",(0,n.f)(jh.ClassName,jh),function(E){E[E.Stopped=0]="Stopped",E[E.Started=1]="Started"}(gh||(gh={}));class Ph{constructor(E){this._eventBlocks=[],this._executionContexts=[],this.state=0,this._scene=E.Xd,this._coordinator=E.coordinator,this._sceneDisposeObserver=this._scene.rj.add((()=>this.dispose()))}createContext(){const E=new Dh({Xd:this._scene,coordinator:this._coordinator});return this._executionContexts.push(E),E}getContext(E){return this._executionContexts[E]}addEventBlock(E){this._eventBlocks.push(E)}start(){if(1!==this.state){this.state=1,0===this._executionContexts.length&&this.createContext();for(const E of this._executionContexts){const b=this._getContextualOrder();for(const h of b)h._startPendingTasks(E)}}}_getContextualOrder(){const E=[];for(const b of this._eventBlocks)if(b.getClassName()===jh.ClassName){const h=b._getReferencedMesh();let a=0;for(;a<E.length;a++){const b=E[a]._getReferencedMesh();if(h&&b&&Ih(h,b))break}E.splice(a,0,b)}else E.push(b);return E}dispose(){if(0!==this.state){this.state=0;for(const E of this._executionContexts)E._clearPendingBlocks();this._executionContexts.length=0,this._eventBlocks.length=0,this._scene.rj.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null}}visitAllBlocks(E){const b=[],h=new Set;for(const a of this._eventBlocks)b.push(a),h.add(a.uniqueId);for(;b.length>0;){const a=b.pop();E(a);for(const E of a.dataInputs)for(const a of E._connectedPoint)h.has(a._ownerBlock.uniqueId)||(b.push(a._ownerBlock),h.add(a._ownerBlock.uniqueId));if(a instanceof Bh)for(const E of a.signalOutputs)for(const a of E._connectedPoint)h.has(a._ownerBlock.uniqueId)||(b.push(a._ownerBlock),h.add(a._ownerBlock.uniqueId))}}serialize(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=arguments.length>1?arguments[1]:void 0;E.allBlocks=[],this.visitAllBlocks((b=>{const h={};b.serialize(h),E.allBlocks.push(h)})),E.executionContexts=[];for(const h of this._executionContexts){const a={};h.serialize(a,b),E.executionContexts.push(a)}}static GetDataOutConnectionByUniqueId(E,b){for(const h of E)for(const E of h.dataOutputs)if(E.uniqueId===b)return E;throw new Error("Could not find data out connection with unique id "+b)}static GetSignalInConnectionByUniqueId(E,b){for(const h of E)if(h instanceof Bh)for(const E of h.signalInputs)if(E.uniqueId===b)return E;throw new Error("Could not find signal in connection with unique id "+b)}static Parse(E,b){const h=b.coordinator.createGraph(),a=[],k=b.valueParseFunction??vh;for(const G of E.allBlocks){const E=sh.Parse(G,{Xd:b.coordinator.config.Xd,pathConverter:b.pathConverter,valueParseFunction:k});a.push(E),E instanceof uh&&h.addEventBlock(E)}for(const G of a){for(const E of G.dataInputs)for(const b of E.connectedPointIds){const h=Ph.GetDataOutConnectionByUniqueId(a,b);E.connectTo(h)}if(G instanceof Bh)for(const E of G.signalOutputs)for(const b of E.connectedPointIds){const h=Ph.GetSignalInConnectionByUniqueId(a,b);E.connectTo(h)}}for(const G of E.executionContexts)Dh.Parse(G,{graph:h,valueParseFunction:k});return h}}class Ah{constructor(E){this.config=E,this._flowGraphs=[],this._customEventsMap=new Map,this.config.Xd.rj.add((()=>{this.dispose()}));(Ah.SceneCoordinators.get(this.config.Xd)??[]).push(this)}createGraph(){const E=new Ph({Xd:this.config.Xd,coordinator:this});return this._flowGraphs.push(E),E}removeGraph(E){const b=this._flowGraphs.indexOf(E);-1!==b&&(E.dispose(),this._flowGraphs.splice(b,1))}start(){this._flowGraphs.forEach((E=>E.start()))}dispose(){this._flowGraphs.forEach((E=>E.dispose())),this._flowGraphs.length=0;const E=Ah.SceneCoordinators.get(this.config.Xd)??[],b=E.indexOf(this);-1!==b&&E.splice(b,1)}serialize(E,b){E._flowGraphs=[],this._flowGraphs.forEach((h=>{const a={};h.serialize(a,b),E._flowGraphs.push(a)}))}static Parse(E,b){var h;const a=b.valueParseFunction??vh,k=new Ah({Xd:b.Xd});return null===(h=E._flowGraphs)||void 0===h||h.forEach((E=>{Ph.Parse(E,{coordinator:k,valueParseFunction:a,pathConverter:b.pathConverter})})),k}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(E){let b=this._customEventsMap.get(E);return b||(b=new s.e,this._customEventsMap.set(E,b)),b}notifyCustomEvent(E,b){const h=this._customEventsMap.get(E);h&&h.notifyObservers(b)}}Ah.SceneCoordinators=new Map;class nh extends uh{_preparePendingTasks(E){if(!E._getExecutionVariable(this,"sceneReadyObserver")){const b=E.configuration.Xd.onReadyObservable.add((()=>{this._execute(E)}));E._setExecutionVariable(this,"sceneReadyObserver",b)}}_cancelPendingTasks(E){const b=E._getExecutionVariable(this,"sceneReadyObserver");E.configuration.Xd.onReadyObservable.remove(b),E._deleteExecutionVariable(this,"sceneReadyObserver")}getClassName(){return nh.ClassName}}nh.ClassName="FGSceneReadyEventBlock",(0,n.f)("FGSceneReadyEventBlock",nh);class dh extends uh{_preparePendingTasks(E){if(!E._getExecutionVariable(this,"sceneBeforeRender")){const b=E.configuration.Xd.onBeforeRenderObservable.add((()=>{this._execute(E)}));E._setExecutionVariable(this,"sceneBeforeRender",b)}}_cancelPendingTasks(E){const b=E._getExecutionVariable(this,"sceneBeforeRender");E.configuration.Xd.onBeforeRenderObservable.remove(b),E._deleteExecutionVariable(this,"sceneBeforeRender")}getClassName(){return dh.ClassName}}dh.ClassName="FGSceneTickEventBlock",(0,n.f)(dh.ClassName,dh);class ch extends Bh{constructor(E){super(E),this.out=this._registerSignalOutput("out")}}class zh extends ch{constructor(E){super(E),this.message=this.registerDataInput("message",ib)}_execute(E){const b=this.message.getValue(E);D.c.Log(b),this.out._activateSignal(E)}getClassName(){return zh.ClassName}}zh.ClassName="FGConsoleLogBlock",(0,n.f)(zh.ClassName,zh),function(E){E[E.INIT=0]="INIT",E[E.STARTED=1]="STARTED",E[E.ENDED=2]="ENDED"}(Sh||(Sh={}));class Zh{constructor(E){this.onEachCountObservable=new s.e,this.onTimerAbortedObservable=new s.e,this.onTimerEndedObservable=new s.e,this.onStateChangedObservable=new s.e,this._observer=null,this._breakOnNextTick=!1,this._tick=E=>{const b=Date.now();this._timer=b-this._startTime;const h={startTime:this._startTime,currentTime:b,deltaTime:this._timer,completeRate:this._timer/this._timeToEnd,payload:E},a=this._breakOnNextTick||this._breakCondition(h);a||this._timer>=this._timeToEnd?this._stop(h,a):this.onEachCountObservable.notifyObservers(h)},this._setState(0),this._contextObservable=E.contextObservable,this._observableParameters=E.observableParameters??{},this._breakCondition=E.breakCondition??(()=>!1),this._timeToEnd=E.timeout,E.onEnded&&this.onTimerEndedObservable.add(E.onEnded),E.ki&&this.onEachCountObservable.add(E.ki),E.onAborted&&this.onTimerAbortedObservable.add(E.onAborted)}set breakCondition(E){this._breakCondition=E}clearObservables(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()}start(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._timeToEnd;if(1===this._state)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=E,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(1)}stop(){1===this._state&&(this._breakOnNextTick=!0)}dispose(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()}_setState(E){this._state=E,this.onStateChangedObservable.notifyObservers(this._state)}_stop(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._contextObservable.remove(this._observer),this._setState(2),b?this.onTimerAbortedObservable.notifyObservers(E):this.onTimerEndedObservable.notifyObservers(E)}}class Yh extends oh{constructor(E){super(E),this.timeout=this.registerDataInput("timeout",pb)}_preparePendingTasks(E){const b=this.timeout.getValue(E);if(void 0!==b&&b>=0){const h=E._getExecutionVariable(this,"runningTimers")||[],a=E.configuration.Xd,k=new Zh({timeout:b,contextObservable:a.onBeforeRenderObservable,onEnded:()=>this._onEnded(k,E)});k.start(),h.push(k),E._setExecutionVariable(this,"runningTimers",h)}}_execute(E){this._startPendingTasks(E),this.out._activateSignal(E)}_onEnded(E,b){const h=b._getExecutionVariable(this,"runningTimers")||[],a=h.indexOf(E);-1!==a?h.splice(a,1):V.g.Warn("FlowGraphTimerBlock: Timer ended but was not found in the running timers list"),b._removePendingBlock(this),this.done._activateSignal(b)}_cancelPendingTasks(E){const b=E._getExecutionVariable(this,"runningTimers")||[];for(const h of b)h.dispose();E._deleteExecutionVariable(this,"runningTimers")}getClassName(){return Yh.ClassName}}Yh.ClassName="FGTimerBlock",(0,n.f)("FGTimerBlock",Yh);class rh extends ch{constructor(E){super(E),this.config=E;for(let b=0;b<this.config.eventData.length;b++){const E=this.config.eventData[b];this.registerDataInput(E,ib)}}_execute(E){const b=this.config.eventId,h=this.dataInputs.map((b=>b.getValue(E)));E.configuration.coordinator.notifyCustomEvent(b,h),this.out._activateSignal(E)}getClassName(){return rh.ClassName}}rh.ClassName="FGSendCustomEventBlock",(0,n.f)("FGSendCustomEventBlock",rh);class wh extends uh{constructor(E){super(E),this.config=E;for(let b=0;b<this.config.eventData.length;b++){const E=this.config.eventData[b];this.registerDataOutput(E,ib)}}_preparePendingTasks(E){const b=E.configuration.coordinator.getCustomEventObservable(this.config.eventId);this._eventObserver=b.add((b=>{for(let h=0;h<b.length;h++)this.dataOutputs[h].setValue(b[h],E);this._execute(E)}))}_cancelPendingTasks(E){const b=E.configuration.coordinator.getCustomEventObservable(this.config.eventId);b?b.remove(this._eventObserver):V.g.Warn(`FlowGraphReceiveCustomEventBlock: Missing observable for event ${this.config.eventId}`)}getClassName(){return wh.ClassName}serialize(E){super.serialize(E),E.eventId=this.config.eventId,E.eventData=this.config.eventData}}wh.ClassName="FGReceiveCustomEventBlock",(0,n.f)(wh.ClassName,wh);class Nh extends Bh{constructor(E){super(E),this.config=E,this.outFlows=[];for(let b=0;b<this.config.numberOutputFlows;b++)this.outFlows.push(this._registerSignalOutput(`${b}`))}_execute(E){for(let b=0;b<this.config.numberOutputFlows;b++)this.outFlows[b]._activateSignal(E)}getClassName(){return Nh.ClassName}}Nh.ClassName="FGSequenceBlock",(0,n.f)(Nh.ClassName,Nh);const Hh=new RegExp(/\{(\w+)\}/g);class fh{constructor(E,b){this.path=E,this.ownerBlock=b,this.templatedInputs=[];let h=Hh.exec(E);for(;h;){const[,a]=h;this.templatedInputs.push(b.registerDataInput(a,kh)),h=Hh.exec(E)}}getAccessor(E,b){let h=this.path;for(const a of this.templatedInputs){const E=a.getValue(b).value;h=h.replace(`{${a.name}}`,E.toString())}return E.convert(h)}}class Fh extends sh{constructor(E){super(E),this.config=E,this.value=this.registerDataOutput("value",ib),this.templateComponent=new fh(E.path,this)}_updateOutputs(E){const b=this.templateComponent.getAccessor(this.config.pathConverter,E),h=b.info.get(b.object);this.value.setValue(h,E)}getClassName(){return Fh.ClassName}serialize(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(E),E.config.path=this.config.path}}Fh.ClassName="FGGetPropertyBlock",(0,n.f)(Fh.ClassName,Fh);class yh extends ch{constructor(E){super(E),this.config=E,this.a=this.registerDataInput("a",ib),this.templateComponent=new fh(E.path,this)}_execute(E){const b=this.a.getValue(E),h=this.templateComponent.getAccessor(this.config.pathConverter,E);h.info.set(b,h.object),this.out._activateSignal(E)}serialize(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(E),E.config.path=this.config.path}getClassName(){return yh.ClassName}}yh.ClassName="FGSetPropertyBlock",(0,n.f)("FGSetPropertyBlock",yh);const eh="cachedOperationValue",Jh="cachedExecutionId";class mh extends sh{constructor(E,b){super(b),this.value=this.registerDataOutput("value",E)}_updateOutputs(E){const b=E._getExecutionVariable(this,Jh),h=E._getExecutionVariable(this,eh);if(void 0!==h&&b===E.executionId)this.value.setValue(h,E);else{const b=this._doOperation(E);E._setExecutionVariable(this,eh,b),E._setExecutionVariable(this,Jh,E.executionId),this.value.setValue(b,E)}}}class Kh extends mh{constructor(E,b,h,a,k,G){super(h,G),this._operation=a,this._className=k,this.a=this.registerDataInput("a",E),this.b=this.registerDataInput("b",b)}_doOperation(E){return this._operation(this.a.getValue(E),this.b.getValue(E))}getClassName(){return this._className}}class xh extends mh{constructor(E,b,h,a){super(E,a),this._operation=b,this._className=h}_doOperation(E){return this._operation()}getClassName(){return this._className}}class Wh extends mh{constructor(E,b,h,a,k){super(b,k),this._operation=h,this._className=a,this.a=this.registerDataInput("a",E)}_doOperation(E){return this._operation(this.a.getValue(E))}getClassName(){return this._className}}class Lh extends mh{constructor(E,b,h,a,k,G,V){super(a,V),this._operation=k,this._className=G,this.a=this.registerDataInput("a",E),this.b=this.registerDataInput("b",b),this.c=this.registerDataInput("c",h)}_doOperation(E){return this._operation(this.a.getValue(E),this.b.getValue(E),this.c.getValue(E))}getClassName(){return this._className}}function th(E){return E.getClassName?E.getClassName():""}function Th(E,b){return"Vector2"===E&&"Vector2"===b||"o"===E&&"o"===b||"Vector4"===E&&"Vector4"===b}function Xh(E,b){return"Matrix"===E&&"Matrix"===b}function Ch(E,b){return"FlowGraphInteger"===E&&"FlowGraphInteger"===b}class qh extends Kh{constructor(E){super(ib,ib,ib,((E,b)=>this._polymorphicAdd(E,b)),qh.ClassName,E)}_polymorphicAdd(E,b){const h=th(E),a=th(b);return Th(h,a)||Xh(h,a)||Ch(h,a)?E.add(b):E+b}}qh.ClassName="FGAddBlock",(0,n.f)(qh.ClassName,qh);class Rh extends Kh{constructor(E){super(ib,ib,ib,((E,b)=>this._polymorphicAdd(E,b)),Rh.ClassName,E)}_polymorphicAdd(E,b){const h=th(E),a=th(b);return Th(h,a)||Ch(h,a)?E.Xc(b):Xh(h,a)?E.add(b.scale(-1)):E-b}}Rh.ClassName="FGSubBlock",(0,n.f)(Rh.ClassName,Rh);class Qh extends Kh{constructor(E){super(ib,ib,ib,((E,b)=>this._polymorphicMultiply(E,b)),Qh.ClassName,E)}_polymorphicMultiply(E,b){const h=th(E),a=th(b);return Th(h,a)||Ch(h,a)?E.multiply(b):Xh(h,a)?k.d.FromValues(E.m[0]*b.m[0],E.m[4]*b.m[4],E.m[8]*b.m[8],E.m[12]*b.m[12],E.m[1]*b.m[1],E.m[5]*b.m[5],E.m[9]*b.m[9],E.m[13]*b.m[13],E.m[2]*b.m[2],E.m[6]*b.m[6],E.m[10]*b.m[10],E.m[14]*b.m[14],E.m[3]*b.m[3],E.m[7]*b.m[7],E.m[11]*b.m[11],E.m[15]*b.m[15]):E*b}}Qh.ClassName="FGMultiplyBlock",(0,n.f)(Qh.ClassName,Qh);class ih extends Kh{constructor(E){super(ib,ib,ib,((E,b)=>this._polymorphicDivide(E,b)),ih.ClassName,E)}_polymorphicDivide(E,b){const h=th(E),a=th(b);return Th(h,a)||Ch(h,a)?E.divide(b):Xh(h,a)?k.d.FromValues(E.m[0]/b.m[0],E.m[4]/b.m[4],E.m[8]/b.m[8],E.m[12]/b.m[12],E.m[1]/b.m[1],E.m[5]/b.m[5],E.m[9]/b.m[9],E.m[13]/b.m[13],E.m[2]/b.m[2],E.m[6]/b.m[6],E.m[10]/b.m[10],E.m[14]/b.m[14],E.m[3]/b.m[3],E.m[7]/b.m[7],E.m[11]/b.m[11],E.m[15]/b.m[15]):E/b}}ih.ClassName="FGDivideBlock",(0,n.f)(ih.ClassName,ih);class ph extends xh{constructor(E){super(pb,(()=>Math.random()),ph.ClassName,E)}}ph.ClassName="FGRandomBlock",(0,n.f)(ph.ClassName,ph);class Ea extends Kh{constructor(E){super(ib,ib,pb,((E,b)=>this._polymorphicDot(E,b)),Ea.ClassName,E)}_polymorphicDot(E,b){switch(th(E)){case"Vector2":return k.j.Dot(E,b);case"o":return k.k.Dot(E,b);case"Vector4":return k.n.Dot(E,b);default:throw new Error(`Cannot get dot product of ${E} and ${b}`)}}}Ea.ClassName="FGDotBlock",(0,n.f)(Ea.ClassName,Ea);class ba extends xh{constructor(E){super(pb,(()=>Math.E),ba.ClassName,E)}}ba.ClassName="FGEBlock",(0,n.f)(ba.ClassName,ba);class ha extends xh{constructor(E){super(pb,(()=>Math.PI),ha.ClassName,E)}}ha.ClassName="FGPIBlock",(0,n.f)(ha.ClassName,ha);class aa extends xh{constructor(E){super(pb,(()=>Number.POSITIVE_INFINITY),aa.ClassName,E)}}aa.ClassName="FGInfBlock",(0,n.f)(aa.ClassName,aa);class ka extends xh{constructor(E){super(pb,(()=>Number.NaN),ka.ClassName,E)}}function Ga(E,b){switch(th(E)){case"FlowGraphInteger":return new Rb(b(E.value));case"Vector2":return new k.j(b(E.x),b(E.y));case"o":return new k.k(b(E.x),b(E.y),b(E.z));case"Vector4":return new k.n(b(E.x),b(E.y),b(E.z),b(E.w));case"Matrix":return k.d.FromValues(b(E.m[0]),b(E.m[4]),b(E.m[8]),b(E.m[12]),b(E.m[1]),b(E.m[5]),b(E.m[9]),b(E.m[13]),b(E.m[2]),b(E.m[6]),b(E.m[10]),b(E.m[14]),b(E.m[3]),b(E.m[7]),b(E.m[11]),b(E.m[15]));default:return b(E)}}ka.ClassName="FGNaNBlock",(0,n.f)(ka.ClassName,ka);class Va extends Wh{constructor(E){super(ib,ib,(E=>this._polymorphicAbs(E)),Va.ClassName,E)}_polymorphicAbs(E){return Ga(E,Math.abs)}}Va.ClassName="FGAbsBlock",(0,n.f)(Va.ClassName,Va);class la extends Wh{constructor(E){super(ib,ib,(E=>this._polymorphicSign(E)),la.ClassName,E)}_polymorphicSign(E){return Ga(E,Math.sign)}}la.ClassName="FGSignBlock",(0,n.f)(la.ClassName,la);class Oa extends Wh{constructor(E){super(ib,ib,(E=>this._polymorphicTrunc(E)),Oa.ClassName,E)}_polymorphicTrunc(E){return Ga(E,Math.trunc)}}Oa.ClassName="FGTruncBlock",(0,n.f)(Oa.ClassName,Oa);class va extends Wh{constructor(E){super(ib,ib,(E=>this._polymorphicFloor(E)),va.ClassName,E)}_polymorphicFloor(E){return Ga(E,Math.floor)}}va.ClassName="FGFloorBlock",(0,n.f)(va.ClassName,va);class sa extends Wh{constructor(E){super(ib,ib,(E=>this._polymorphicCeiling(E)),sa.ClassName,E)}_polymorphicCeiling(E){return Ga(E,Math.ceil)}}sa.ClassName="FGCeilBlock",(0,n.f)(sa.ClassName,sa);class Ua extends Wh{constructor(E){super(ib,ib,(E=>this._polymorphicFract(E)),Ua.ClassName,E)}_polymorphicFract(E){return Ga(E,(E=>E-Math.floor(E)))}}Ua.ClassName="FGFractBlock",(0,n.f)(Ua.ClassName,Ua);class Ba extends Wh{constructor(E){super(ib,ib,(E=>this._polymorphicNeg(E)),Ba.ClassName,E)}_polymorphicNeg(E){return Ga(E,(E=>-E))}}function oa(E,b,h){switch(th(E)){case"FlowGraphInteger":return new Rb(h(E.value,b.value));case"Vector2":return new k.j(h(E.x,b.x),h(E.y,b.y));case"o":return new k.k(h(E.x,b.x),h(E.y,b.y),h(E.z,b.z));case"Vector4":return new k.n(h(E.x,b.x),h(E.y,b.y),h(E.z,b.z),h(E.w,b.w));case"Matrix":return k.d.FromValues(h(E.m[0],b.m[0]),h(E.m[4],b.m[4]),h(E.m[8],b.m[8]),h(E.m[12],b.m[12]),h(E.m[1],b.m[1]),h(E.m[5],b.m[5]),h(E.m[9],b.m[9]),h(E.m[13],b.m[13]),h(E.m[2],b.m[2]),h(E.m[6],b.m[6]),h(E.m[10],b.m[10]),h(E.m[14],b.m[14]),h(E.m[3],b.m[3]),h(E.m[7],b.m[7]),h(E.m[11],b.m[11]),h(E.m[15],b.m[15]));default:return h(E,b)}}Ba.ClassName="FGNegBlock",(0,n.f)(Ba.ClassName,Ba);class ua extends Kh{constructor(E){super(ib,ib,ib,((E,b)=>this._polymorphicRemainder(E,b)),ua.ClassName,E)}_polymorphicRemainder(E,b){return oa(E,b,((E,b)=>E%b))}}ua.ClassName="FGRemainderBlock",(0,n.f)(ua.ClassName,ua);class Da extends Kh{constructor(E){super(ib,ib,ib,((E,b)=>this._polymorphicMin(E,b)),Da.ClassName,E)}_polymorphicMin(E,b){return oa(E,b,Math.min)}}Da.ClassName="FGMinBlock",(0,n.f)(Da.ClassName,Da);class ga extends Kh{constructor(E){super(ib,ib,ib,((E,b)=>this._polymorphicMax(E,b)),ga.ClassName,E)}_polymorphicMax(E,b){return oa(E,b,Math.max)}}function Sa(E,b,h){return Math.min(Math.max(E,Math.min(b,h)),Math.max(b,h))}function Ma(E,b,h,a){switch(th(E)){case"FlowGraphInteger":return new Rb(a(E.value,b.value,h.value));case"Vector2":return new k.j(a(E.x,b.x,h.x),a(E.y,b.y,h.y));case"o":return new k.k(a(E.x,b.x,h.x),a(E.y,b.y,h.y),a(E.z,b.z,h.z));case"Vector4":return new k.n(a(E.x,b.x,h.x),a(E.y,b.y,h.y),a(E.z,b.z,h.z),a(E.w,b.w,h.w));case"Matrix":return k.d.FromValues(a(E.m[0],b.m[0],h.m[0]),a(E.m[4],b.m[4],h.m[4]),a(E.m[8],b.m[8],h.m[8]),a(E.m[12],b.m[12],h.m[12]),a(E.m[1],b.m[1],h.m[1]),a(E.m[5],b.m[5],h.m[5]),a(E.m[9],b.m[9],h.m[9]),a(E.m[13],b.m[13],h.m[13]),a(E.m[2],b.m[2],h.m[2]),a(E.m[6],b.m[6],h.m[6]),a(E.m[10],b.m[10],h.m[10]),a(E.m[14],b.m[14],h.m[14]),a(E.m[3],b.m[3],h.m[3]),a(E.m[7],b.m[7],h.m[7]),a(E.m[11],b.m[11],h.m[11]),a(E.m[15],b.m[15],h.m[15]));default:return a(E,b,h)}}ga.ClassName="FGMaxBlock",(0,n.f)(ga.ClassName,ga);class Ia extends Lh{constructor(E){super(ib,ib,ib,ib,((E,b,h)=>this._polymorphicClamp(E,b,h)),Ia.ClassName,E)}_polymorphicClamp(E,b,h){return Ma(E,b,h,Sa)}}function ja(E){return Math.min(Math.max(E,0),1)}Ia.ClassName="FGClampBlock",(0,n.f)(Ia.ClassName,Ia);class Pa extends Wh{constructor(E){super(ib,ib,(E=>this._polymorphicSaturate(E)),Pa.ClassName,E)}_polymorphicSaturate(E){return Ga(E,ja)}}Pa.ClassName="FGSaturateBlock",(0,n.f)(Pa.ClassName,Pa);class Aa extends Lh{constructor(E){super(ib,ib,ib,ib,((E,b,h)=>this._polymorphicInterpolate(E,b,h)),Aa.ClassName,E)}_interpolate(E,b,h){return(1-h)*E+h*b}_polymorphicInterpolate(E,b,h){return Ma(E,b,h,this._interpolate)}}Aa.ClassName="FGInterpolateBlock",(0,n.f)(Aa.ClassName,Aa);class na extends Kh{constructor(E){super(ib,ib,Eh,((E,b)=>this._polymorphicEq(E,b)),na.ClassName,E)}_polymorphicEq(E,b){const h=th(E),a=th(b);return Th(h,a)||Xh(h,a)||Ch(h,a)?E.equals(b):E===b}}function da(E,b,h){const a=th(E);if(a===th(b)){if(""===a)return h(E,b);if("FlowGraphInteger"===a)return h(E.value,b.value);throw new Error(`Cannot compare ${E} and ${b}`)}throw new Error(`${E} and ${b} are of different types.`)}na.ClassName="FGEqBlock",(0,n.f)(na.ClassName,na);class ca extends Kh{constructor(E){super(ib,ib,Eh,((E,b)=>this._polymorphicLessThan(E,b)),ca.ClassName,E)}_polymorphicLessThan(E,b){return da(E,b,((E,b)=>E<b))}}ca.ClassName="FGLessThanBlock",(0,n.f)(ca.ClassName,ca);class za extends Kh{constructor(E){super(ib,ib,Eh,((E,b)=>this._polymorphicLessThanOrEqual(E,b)),za.ClassName,E)}_polymorphicLessThanOrEqual(E,b){return da(E,b,((E,b)=>E<=b))}}za.ClassName="FGLessThanOrEqualBlock";class Za extends Kh{constructor(E){super(ib,ib,Eh,((E,b)=>this._polymorphicGreaterThan(E,b)),Za.ClassName,E)}_polymorphicGreaterThan(E,b){return da(E,b,((E,b)=>E>b))}}Za.ClassName="FGGreaterThanBlock",(0,n.f)(Za.ClassName,Za);class Ya extends Kh{constructor(E){super(ib,ib,Eh,((E,b)=>this._polymorphicGreaterThanOrEqual(E,b)),Ya.ClassName,E)}_polymorphicGreaterThanOrEqual(E,b){return da(E,b,((E,b)=>E>=b))}}Ya.ClassName="FGGreaterThanOrEqualBlock",(0,n.f)(Ya.ClassName,Ya);class ra extends Wh{constructor(E){super(ib,Eh,(E=>this._polymorphicIsNan(E)),ra.ClassName,E)}_polymorphicIsNan(E){const b=th(E);if(""===b)return isNaN(E);if("FlowGraphInteger"===b)return isNaN(E.value);throw new Error(`Cannot get NaN of ${E}`)}}ra.ClassName="FGIsNanBlock",(0,n.f)(ra.ClassName,ra);class wa extends Wh{constructor(E){super(ib,Eh,(E=>this._polymorphicIsInf(E)),wa.ClassName,E)}_polymorphicIsInf(E){const b=th(E);if(""===b)return!isFinite(E);if("FlowGraphInteger"===b)return!isFinite(E.value);throw new Error(`Cannot get isInf of ${E}`)}}wa.ClassName="FGIsInfBlock";class Na extends Wh{constructor(E){super(ib,ib,(E=>this._polymorphicDegToRad(E)),Na.ClassName,E)}_degToRad(E){return E*Math.PI/180}_polymorphicDegToRad(E){return Ga(E,this._degToRad)}}Na.ClassName="FGDegToRadBlock",(0,n.f)(Na.ClassName,Na);class Ha extends Wh{constructor(E){super(ib,ib,(E=>this._polymorphicRadToDeg(E)),Ha.ClassName,E)}_radToDeg(E){return 180*E/Math.PI}_polymorphicRadToDeg(E){return Ga(E,this._radToDeg)}}Ha.ClassName="FGRadToDegBlock",(0,n.f)(Ha.ClassName,Ha);class fa extends Wh{constructor(E){super(ib,ib,(E=>this._polymorphicSin(E)),fa.ClassName,E)}_polymorphicSin(E){return Ga(E,Math.sin)}}fa.ClassName="FGSinBlock",(0,n.f)(fa.ClassName,fa);class Fa extends Wh{constructor(E){super(ib,ib,(E=>this._polymorphicCos(E)),Fa.ClassName,E)}_polymorphicCos(E){return Ga(E,Math.cos)}}Fa.ClassName="FGCosBlock",(0,n.f)(Fa.ClassName,Fa);class ya extends Wh{constructor(E){super(ib,ib,(E=>this._polymorphicTan(E)),ya.ClassName,E)}_polymorphicTan(E){return Ga(E,Math.tan)}}ya.ClassName="FGTanBlock",(0,n.f)(ya.ClassName,ya);class ea extends Wh{constructor(E){super(ib,ib,(E=>this._polymorphicAsin(E)),ea.ClassName,E)}_polymorphicAsin(E){return Ga(E,Math.asin)}}ea.ClassName="FGAsinBlock",(0,n.f)(ea.ClassName,ea);class Ja extends Wh{constructor(E){super(ib,ib,(E=>this._polymorphicAcos(E)),Ja.ClassName,E)}_polymorphicAcos(E){return Ga(E,Math.acos)}}Ja.ClassName="FGAcosBlock",(0,n.f)(Ja.ClassName,Ja);class ma extends Wh{constructor(E){super(ib,ib,(E=>this._polymorphicAtan(E)),ma.ClassName,E)}_polymorphicAtan(E){return Ga(E,Math.atan)}}ma.ClassName="FGAtanBlock",(0,n.f)(ma.ClassName,ma);class Ka extends Kh{constructor(E){super(ib,ib,ib,((E,b)=>this._polymorphicAtan2(E,b)),Ka.ClassName,E)}_polymorphicAtan2(E,b){return oa(E,b,Math.atan2)}}Ka.ClassName="FGAtan2Block",(0,n.f)(Ka.ClassName,Ka);class xa extends Wh{constructor(E){super(ib,ib,(E=>this._polymorphicSinh(E)),xa.ClassName,E)}_polymorphicSinh(E){return Ga(E,Math.sinh)}}xa.ClassName="FGSinhBlock",(0,n.f)(xa.ClassName,xa);class Wa extends Wh{constructor(E){super(ib,ib,(E=>this._polymorphicCosh(E)),Wa.ClassName,E)}_polymorphicCosh(E){return Ga(E,Math.cosh)}}Wa.ClassName="FGCoshBlock",(0,n.f)(Wa.ClassName,Wa);class La extends Wh{constructor(E){super(ib,ib,(E=>this._polymorphicTanh(E)),La.ClassName,E)}_polymorphicTanh(E){return Ga(E,Math.tanh)}}La.ClassName="FGTanhBlock",(0,n.f)(La.ClassName,La);class ta extends Wh{constructor(E){super(ib,pb,(E=>this._polymorphicAsinh(E)),ta.ClassName,E)}_polymorphicAsinh(E){return Ga(E,Math.asinh)}}ta.ClassName="FGAsinhBlock",(0,n.f)(ta.ClassName,ta);class Ta extends Wh{constructor(E){super(ib,pb,(E=>this._polymorphicAcosh(E)),Ta.ClassName,E)}_polymorphicAcosh(E){return Ga(E,Math.acosh)}}Ta.ClassName="FGAcoshBlock",(0,n.f)(Ta.ClassName,Ta);class Xa extends Wh{constructor(E){super(ib,pb,(E=>this._polymorphicAtanh(E)),Xa.ClassName,E)}_polymorphicAtanh(E){return Ga(E,Math.atanh)}}Xa.ClassName="FGAtanhBlock",(0,n.f)(Xa.ClassName,Xa);class Ca extends Wh{constructor(E){super(ib,pb,(E=>this._polymorphicExp(E)),Ca.ClassName,E)}_polymorphicExp(E){return Ga(E,Math.exp)}}Ca.ClassName="FGExpBlock",(0,n.f)(Ca.ClassName,Ca);class qa extends Wh{constructor(E){super(ib,pb,(E=>this._polymorphicLog(E)),qa.ClassName,E)}_polymorphicLog(E){return Ga(E,Math.log)}}qa.ClassName="FGLogBlock",(0,n.f)(qa.ClassName,qa);class Ra extends Wh{constructor(E){super(ib,pb,(E=>this._polymorphicLog2(E)),Ra.ClassName,E)}_polymorphicLog2(E){return Ga(E,Math.log2)}}Ra.ClassName="FGLog2Block",(0,n.f)(Ra.ClassName,Ra);class Qa extends Wh{constructor(E){super(ib,pb,(E=>this._polymorphicLog10(E)),Qa.ClassName,E)}_polymorphicLog10(E){return Ga(E,Math.log10)}}Qa.ClassName="FGLog10Block",(0,n.f)(Qa.ClassName,Qa);class ia extends Wh{constructor(E){super(ib,pb,(E=>this._polymorphicSqrt(E)),ia.ClassName,E)}_polymorphicSqrt(E){return Ga(E,Math.sqrt)}}ia.ClassName="FGSqrtBlock",(0,n.f)(ia.ClassName,ia);class pa extends Wh{constructor(E){super(ib,pb,(E=>this._polymorphicCubeRoot(E)),pa.ClassName,E)}_polymorphicCubeRoot(E){return Ga(E,Math.cbrt)}}pa.ClassName="FGCubeRootBlock",(0,n.f)(pa.ClassName,pa);class Ek extends Kh{constructor(E){super(ib,pb,pb,((E,b)=>this._polymorphicPow(E,b)),Ek.ClassName,E)}_polymorphicPow(E,b){return oa(E,b,Math.pow)}}Ek.ClassName="FGPowBlock",(0,n.f)(Ek.ClassName,Ek);class bk extends Wh{constructor(E){super(ib,pb,(E=>this._polymorphicLength(E)),bk.ClassName,E)}_polymorphicLength(E){switch(th(E)){case"Vector2":case"o":case"Vector4":return E.length();default:throw new Error(`Cannot compute length of value ${E}`)}}}bk.ClassName="FGLengthBlock",(0,n.f)(bk.ClassName,bk);class hk extends Wh{constructor(E){super(ib,ib,(E=>this._polymorphicNormalize(E)),hk.ClassName,E)}_polymorphicNormalize(E){switch(th(E)){case"Vector2":case"o":case"Vector4":return E.normalize();default:throw new Error(`Cannot normalize value ${E}`)}}}hk.ClassName="FGNormalizeBlock",(0,n.f)(hk.ClassName,hk);class ak extends Kh{constructor(E){super(hh,hh,hh,((E,b)=>k.k.Cross(E,b)),ak.ClassName,E)}}ak.ClassName="FGCrossBlock",(0,n.f)(ak.ClassName,ak);class kk extends Kh{constructor(E){super(bh,pb,bh,((E,b)=>k.j.Transform(E,k.d.RotationZ(b))),kk.ClassName,E)}}kk.ClassName="FGRotate2DBlock",(0,n.f)(kk.ClassName,kk);class Gk extends Lh{constructor(E){super(hh,hh,pb,hh,((E,b,h)=>k.k.TransformCoordinates(E,k.d.RotationAxis(b,h))),Gk.ClassName,E)}}Gk.ClassName="FGRotate3DBlock",(0,n.f)(Gk.ClassName,Gk);class Vk extends Wh{constructor(E){super(ah,ah,(E=>k.d.Transpose(E)),Vk.ClassName,E)}}Vk.ClassName="FGTransposeBlock",(0,n.f)(Vk.ClassName,Vk);class lk extends Wh{constructor(E){super(ah,pb,(E=>E.determinant()),lk.ClassName,E)}}lk.ClassName="FGDeterminantBlock",(0,n.f)(lk.ClassName,lk);class Ok extends Wh{constructor(E){super(ah,ah,(E=>k.d.Invert(E)),Ok.ClassName,E)}}Ok.ClassName="FGInvertMatrixBlock",(0,n.f)(Ok.ClassName,Ok);class vk extends Kh{constructor(E){super(ah,ah,ah,((E,b)=>b.multiply(E)),vk.ClassName,E)}}vk.ClassName="FGMatMulBlock",(0,n.f)(vk.ClassName,vk);class sk extends Wh{constructor(E){super(kh,kh,(E=>new Rb(~E.value)),sk.ClassName,E)}}sk.ClassName="FGBitwiseNotBlock",(0,n.f)(sk.ClassName,sk);class Uk extends Kh{constructor(E){super(kh,kh,kh,((E,b)=>new Rb(E.value&b.value)),Uk.ClassName,E)}}Uk.ClassName="FGBitwiseAndBlock",(0,n.f)(Uk.ClassName,Uk);class Bk extends Kh{constructor(E){super(kh,kh,kh,((E,b)=>new Rb(E.value|b.value)),Bk.ClassName,E)}}Bk.ClassName="FGBitwiseOrBlock",(0,n.f)(Bk.ClassName,Bk);class ok extends Kh{constructor(E){super(kh,kh,kh,((E,b)=>new Rb(E.value^b.value)),ok.ClassName,E)}}ok.ClassName="FGBitwiseXorBlock",(0,n.f)(ok.ClassName,ok);class uk extends Kh{constructor(E){super(kh,kh,kh,((E,b)=>new Rb(E.value<<b.value)),uk.ClassName,E)}}uk.ClassName="FGBitwiseLeftShiftBlock",(0,n.f)(uk.ClassName,uk);class Dk extends Kh{constructor(E){super(kh,kh,kh,((E,b)=>new Rb(E.value>>b.value)),Dk.ClassName,E)}}Dk.ClassName="FGBitwiseRightShiftBlock",(0,n.f)(Dk.ClassName,Dk);class gk extends Wh{constructor(E){super(kh,kh,(E=>new Rb(Math.clz32(E.value))),gk.ClassName,E)}}gk.ClassName="FGCountLeadingZerosBlock",(0,n.f)(gk.ClassName,gk);class Sk extends Wh{constructor(E){super(kh,kh,(E=>new Rb(E.value?31-Math.clz32(E.value&-E.value):32)),Sk.ClassName,E)}}Sk.ClassName="FGCountTrailingZerosBlock",(0,n.f)(Sk.ClassName,Sk);class Mk extends Wh{constructor(E){super(kh,kh,(E=>new Rb(function(E){let b=0;for(;E;)b+=1&E,E>>=1;return b}(E.value))),Mk.ClassName,E)}}Mk.ClassName="FGCountOneBitsBlock",(0,n.f)(Mk.ClassName,Mk);class Ik extends ch{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startIndex:new Rb(0)};super(E),this.config=E,this.reset=this._registerSignalInput("reset"),this.n=this.registerDataInput("n",kh),this.value=this.registerDataOutput("value",kh)}_execute(E,b){if(b===this.reset)this.value.setValue(this.config.startIndex,E);else{const b=this.value.getValue(E);b.value<this.n.getValue(E).value&&(this.value.setValue(new Rb(b.value+1),E),this.out._activateSignal(E))}}getClassName(){return Ik.ClassName}}Ik.ClassName="FGDoNBlock",(0,n.f)(Ik.ClassName,Ik);class jk extends sh{constructor(E){super(E),this.config=E,this.output=this.registerDataOutput(E.variableName,ib)}_updateOutputs(E){const b=this.config.variableName;E.hasVariable(b)&&this.output.setValue(E.getVariable(b),E)}getClassName(){return jk.ClassName}serialize(E){super.serialize(E),E.config.variableName=this.config.variableName}}jk.ClassName="FGGetVariableBlock",(0,n.f)(jk.ClassName,jk);class Pk extends ch{constructor(E){super(E),this.config=E,this.input=this.registerDataInput(E.variableName,ib)}_execute(E){const b=this.config.variableName,h=this.input.getValue(E);E.setVariable(b,h),this.out._activateSignal(E)}getClassName(){return Pk.ClassName}}Pk.ClassName="FGSetVariableBlock",(0,n.f)(Pk.ClassName,Pk);class Ak extends ch{constructor(E){super(E),this.config=E,this.condition=this.registerDataInput("condition",Eh),this.loopBody=this._registerSignalOutput("loopBody")}_execute(E,b){var h;let a=this.condition.getValue(E);for(null!==(h=this.config)&&void 0!==h&&h.isDo&&!a&&this.loopBody._activateSignal(E);a;)this.loopBody._activateSignal(E),a=this.condition.getValue(E);this.out._activateSignal(E)}getClassName(){return Ak.ClassName}serialize(E){var b;super.serialize(E),E.isDo=null===(b=this.config)||void 0===b?void 0:b.isDo}}Ak.ClassName="FGWhileLoopBlock",(0,n.f)(Ak.ClassName,Ak);const nk={"lifecycle/onStart":nh.ClassName,"lifecycle/onTick":dh.ClassName,log:zh.ClassName,"flow/delay":Yh.ClassName,"customEvent/send":rh.ClassName,"customEvent/receive":wh.ClassName,"flow/sequence":Nh.ClassName,"world/get":Fh.ClassName,"world/set":yh.ClassName,"flow/doN":Ik.ClassName,"variable/get":jk.ClassName,"variable/set":Pk.ClassName,"flow/whileLoop":Ak.ClassName,"math/random":ph.ClassName,"math/e":ba.ClassName,"math/pi":ha.ClassName,"math/inf":aa.ClassName,"math/nan":ka.ClassName,"math/abs":Va.ClassName,"math/sign":la.ClassName,"math/trunc":Oa.ClassName,"math/floor":va.ClassName,"math/ceil":sa.ClassName,"math/fract":Ua.ClassName,"math/neg":Ba.ClassName,"math/add":qh.ClassName,"math/sub":Rh.ClassName,"math/mul":Qh.ClassName,"math/div":ih.ClassName,"math/rem":ua.ClassName,"math/min":Da.ClassName,"math/max":ga.ClassName,"math/clamp":Ia.ClassName,"math/saturate":Pa.ClassName,"math/mix":Aa.ClassName,"math/eq":na.ClassName,"math/lt":ca.ClassName,"math/le":za.ClassName,"math/gt":Za.ClassName,"math/ge":Ya.ClassName,"math/isnan":ra.ClassName,"math/isinf":wa.ClassName,"math/rad":Na.ClassName,"math/deg":Ha.ClassName,"math/sin":fa.ClassName,"math/cos":Fa.ClassName,"math/tan":ya.ClassName,"math/asin":ea.ClassName,"math/acos":Ja.ClassName,"math/atan":ma.ClassName,"math/atan2":Ka.ClassName,"math/sinh":xa.ClassName,"math/cosh":Wa.ClassName,"math/tanh":La.ClassName,"math/asinh":ta.ClassName,"math/acosh":Ta.ClassName,"math/atanh":Xa.ClassName,"math/exp":Ca.ClassName,"math/log":qa.ClassName,"math/log2":Ra.ClassName,"math/log10":Qa.ClassName,"math/sqrt":ia.ClassName,"math/cbrt":pa.ClassName,"math/pow":Ek.ClassName,"math/length":bk.ClassName,"math/normalize":hk.ClassName,"math/dot":Ea.ClassName,"math/cross":ak.ClassName,"math/rotate2d":kk.ClassName,"math/rotate3d":Gk.ClassName,"math/transpose":Vk.ClassName,"math/determinant":lk.ClassName,"math/inverse":Ok.ClassName,"math/matmul":vk.ClassName,"math/not":sk.ClassName,"math/and":Uk.ClassName,"math/or":Bk.ClassName,"math/xor":ok.ClassName,"math/asr":Dk.ClassName,"math/lsl":uk.ClassName,"math/clz":gk.ClassName,"math/ctz":Sk.ClassName,"math/popcnt":Mk.ClassName},dk={float2:"Vector2",float3:"o",float4:"Vector4",float4x4:"Matrix",int:"FlowGraphInteger"};function ck(E,b,h){if(void 0!==E.type){const a=b.types&&b.types[E.type];if(!a)throw new Error(`${h}: Unknown type: ${E.type}`);const k=a.signature;if(!k)throw new Error(`${h}: Type ${E.type} has no signature`);const G=dk[k];return{value:E.value,className:G}}return E.value}function zk(E,b,h){const a=nk[b.type];if(!a)throw new Error(`/extensions/KHR_interactivity/nodes/${E}: Unknown block type: ${b.type}`);const k=E.toString(),G=function(E,b,h){const a={},k=E.configuration??[];for(const G of k)if("customEvent"===G.id){const E=b.customEvents&&b.customEvents[G.value];if(!E)throw new Error(`/extensions/KHR_interactivity/nodes/${h}: Unknown custom event: ${G.value}`);a.eventId=E.id,a.eventData=E.values.map((E=>E.id))}else if("variable"===G.id){const E=b.variables&&b.variables[G.value];if(!E)throw new Error(`/extensions/KHR_interactivity/nodes/${h}: Unknown variable: ${G.value}`);a.variableName=E.id}else if("path"===G.id){const E=G.value;a.path=E}else a[G.id]=ck(G,b,`/extensions/KHR_interactivity/nodes/${h}`);return a}(b,h,k);return{className:a,config:G,uniqueId:k,metadata:b.metadata,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[]}}class Zk extends nb{constructor(E){super(E,rk)}}const Yk={__array__:{__target__:!0,translation:{type:"o",get:E=>E._babylonTransformNode.position,set:(E,b)=>{b._babylonTransformNode.position=E},getObject:E=>E._babylonTransformNode}}},rk={nodes:Yk},wk="KHR_interactivity";class Nk{constructor(E){this._loader=E,this.name=wk,this.enabled=this._loader.isExtensionUsed(wk),this._pathConverter=new Zk(this._loader.Wi)}dispose(){this._loader=null,delete this._pathConverter}onReady(){var E;if(!this._loader.babylonScene||!this._pathConverter)return;const b=this._loader.babylonScene,h=function(E){const b={uniqueId:(0,Cb.e)(),_userVariables:{},_connectionValues:{}},h=[b],a=[];for(let G=0;G<E.nodes.length;G++){const b=zk(G,E.nodes[G],E);a.push(b)}for(let G=0;G<E.nodes.length;G++){const h=E.nodes[G],k=a[G],V=h.flows??[];for(const E of V){const b=E.id,h={uniqueId:(0,Cb.e)(),name:b,_connectionType:1,connectedPointIds:[]};k.signalOutputs.push(h);const V=E.node,l=E.socket,O=a[V];if(!O)throw new Error(`/extensions/KHR_interactivity/nodes/${G}: Could not find node with id ${V} that connects its input with with node ${G}'s output ${b}`);let v=O.signalInputs.find((E=>E.name===l));v||(v={uniqueId:(0,Cb.e)(),name:l,_connectionType:0,connectedPointIds:[]},O.signalInputs.push(v)),v.connectedPointIds.push(h.uniqueId),h.connectedPointIds.push(v.uniqueId)}const l=h.values??[];for(const O of l){const h=O.id,V={uniqueId:(0,Cb.e)(),name:h,_connectionType:0,connectedPointIds:[]};if(k.dataInputs.push(V),void 0!==O.value){const h=ck(O,E,`/extensions/KHR_interactivity/nodes/${G}`);b._connectionValues[V.uniqueId]=h}else{if(void 0===O.node||void 0===O.socket)throw new Error(`/extensions/KHR_interactivity/nodes/${G}: Invalid socket ${h} in node ${G}`);{const E=O.node,b=O.socket,k=a[E];if(!k)throw new Error(`/extensions/KHR_interactivity/nodes/${G}: Could not find node with id ${E} that connects its output with node${G}'s input ${h}`);let l=k.dataOutputs.find((E=>E.name===b));l||(l={uniqueId:(0,Cb.e)(),name:b,_connectionType:1,connectedPointIds:[]},k.dataOutputs.push(l)),V.connectedPointIds.push(l.uniqueId),l.connectedPointIds.push(V.uniqueId)}}}}const k=E.variables??[];for(let G=0;G<k.length;G++){const h=k[G],a=h.id;b._userVariables[a]=ck(h,E,`/extensions/KHR_interactivity/variables/${G}`)}return{allBlocks:a,executionContexts:h}}(null===(E=this._loader.Wi.extensions)||void 0===E?void 0:E.KHR_interactivity),a=new Ah({Xd:b});Ph.Parse(h,{coordinator:a,pathConverter:this._pathConverter}),a.start()}}C(wk),X(wk,!0,(E=>new Nk(E)));const Hk="KHR_node_visibility";class fk{constructor(E){this.name=Hk,this._loader=E,this.enabled=E.isExtensionUsed(Hk)}async onReady(){var E;null===(E=this._loader.Wi.nodes)||void 0===E||E.forEach((E=>{var b,h,a,k;(null===(b=E._primitiveBabylonMeshes)||void 0===b||b.forEach((E=>{E.inheritVisibility=!0})),null!==(h=E.extensions)&&void 0!==h&&h.KHR_node_visibility)&&(!1===(null===(a=E.extensions)||void 0===a?void 0:a.KHR_node_visibility.visible)&&(E._babylonTransformNode&&(E._babylonTransformNode.isVisible=!1),null===(k=E._primitiveBabylonMeshes)||void 0===k||k.forEach((E=>{E.isVisible=!1}))))}))}dispose(){this._loader=null}}C(Hk),X(Hk,!0,(E=>new fk(E)));const Fk="ExtrasAsMetadata";class yk{_assignExtras(E,b){if(b.extras&&Object.keys(b.extras).length>0){const h=E.metadata=E.metadata||{};(h.Wi=h.Wi||{}).extras=b.extras}}constructor(E){this.name=Fk,this.enabled=!0,this._loader=E}dispose(){this._loader=null}loadNodeAsync(E,b,h){return this._loader.loadNodeAsync(E,b,(E=>{this._assignExtras(E,b),h(E)}))}loadCameraAsync(E,b,h){return this._loader.loadCameraAsync(E,b,(E=>{this._assignExtras(E,b),h(E)}))}createMaterial(E,b,h){const a=this._loader.createMaterial(E,b,h);return this._assignExtras(a,b),a}}C(Fk),X(Fk,!1,(E=>new yk(E)))},12168:(E,b,h)=>{"use strict";h.d(b,{d:()=>w,h:()=>d,k:()=>n,l:()=>c});var a=h(10824),k=h(10821),G=h(11535),V=h(11419),l=h(11461),O=h(11456),v=h(10834),s=h(10869),U=h(12176),B=h(12185),o=h(11426);class u{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.yj=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.hk=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(E){this._environmentTexture=E}getNodes(){let E=[];return E=E.concat(this.meshes),E=E.concat(this.lights),E=E.concat(this.cameras),E=E.concat(this.transformNodes),this.skeletons.forEach((b=>E=E.concat(b.bones))),E}}class D extends u{}class g{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){this.rootNodes.slice(0).forEach((E=>{E.dispose()})),this.rootNodes.length=0,this.skeletons.slice(0).forEach((E=>{E.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((E=>{E.dispose()})),this.animationGroups.length=0}}class S extends u{constructor(E){super(),this._wasAddedToScene=!1,(E=E||s.b.LastCreatedScene)&&(this.Xd=E,this.proceduralTextures=[],E.rj.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=E.getEngine().onContextRestoredObservable.add((()=>{for(const E of this.geometries)E._rebuild();for(const E of this.meshes)E._rebuild();for(const E of this.yj)E.rebuild();for(const E of this.textures)E._rebuild()})))}_topologicalSort(E){const b=new Map;for(const V of E)b.set(V.uniqueId,V);const h={dependsOn:new Map,dependedBy:new Map};for(const V of E){const E=V.uniqueId;h.dependsOn.set(E,new Set),h.dependedBy.set(E,new Set)}for(const V of E){const E=V.uniqueId,a=h.dependsOn.get(E);if(V instanceof U.b){const k=V.sourceMesh;b.has(k.uniqueId)&&(a.add(k.uniqueId),h.dependedBy.get(k.uniqueId).add(E))}const k=h.dependedBy.get(E);for(const G of V.getDescendants()){const a=G.uniqueId;if(b.has(a)){k.add(a);h.dependsOn.get(a).add(E)}}}const a=[],k=[];for(const V of E){const E=V.uniqueId;0===h.dependsOn.get(E).size&&(k.push(V),b.delete(E))}const G=k;for(;G.length>0;){const E=G.shift();a.push(E);const k=h.dependedBy.get(E.uniqueId);for(const a of Array.from(k.values())){const k=h.dependsOn.get(a);k.delete(E.uniqueId),0===k.size&&b.get(a)&&(G.push(b.get(a)),b.delete(a))}}return b.size>0&&(v.c.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),b.forEach((E=>v.c.Error(E.name)))),a}_addNodeAndDescendantsToList(E,b,h,a){if(h&&(!a||a(h))&&!b.has(h.uniqueId)){E.push(h),b.add(h.uniqueId);for(const k of h.getDescendants(!0))this._addNodeAndDescendantsToList(E,b,k,a)}}_isNodeInContainer(E){return E instanceof O.b&&-1!==this.meshes.indexOf(E)||(E instanceof l.c&&-1!==this.transformNodes.indexOf(E)||(E instanceof B.d&&-1!==this.lights.indexOf(E)||E instanceof o.b&&-1!==this.cameras.indexOf(E)))}_isValidHierarchy(){for(const E of this.meshes)if(E.parent&&!this._isNodeInContainer(E.parent))return v.c.Warn(`Node ${E.name} has a parent that is not in the container.`),!1;for(const E of this.transformNodes)if(E.parent&&!this._isNodeInContainer(E.parent))return v.c.Warn(`Node ${E.name} has a parent that is not in the container.`),!1;for(const E of this.lights)if(E.parent&&!this._isNodeInContainer(E.parent))return v.c.Warn(`Node ${E.name} has a parent that is not in the container.`),!1;for(const E of this.cameras)if(E.parent&&!this._isNodeInContainer(E.parent))return v.c.Warn(`Node ${E.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(E){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||k.g.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const a={},G={},l=new g,O=[],v=[],s={doNotInstantiate:!0,...h},U=[],B=new Set;for(const k of this.transformNodes)null===k.parent&&this._addNodeAndDescendantsToList(U,B,k,s.predicate);for(const k of this.meshes)null===k.parent&&this._addNodeAndDescendantsToList(U,B,k,s.predicate);const o=this._topologicalSort(U),u=(h,k)=>{if(((b,h)=>{if(a[b.uniqueId]=h.uniqueId,G[h.uniqueId]=h,E&&(h.name=E(b.name)),h instanceof V.b){const E=h;if(E.morphTargetManager){const h=b.morphTargetManager;E.morphTargetManager=h.clone();for(let b=0;b<h.numTargets;b++){const k=h.getTarget(b),V=E.morphTargetManager.getTarget(b);a[k.uniqueId]=V.uniqueId,G[V.uniqueId]=V}}}})(h,k),h.parent){const E=a[h.parent.uniqueId],b=G[E];k.parent=b||h.parent}if(k.position&&h.position&&k.position.p(h.position),k.rotationQuaternion&&h.rotationQuaternion&&k.rotationQuaternion.p(h.rotationQuaternion),k.rotation&&h.rotation&&k.rotation.p(h.rotation),k.ve&&h.ve&&k.ve.p(h.ve),k.material){const V=k;if(V.material)if(b){const b=h.material;if(-1===v.indexOf(b)){let h=b.clone(E?E(b.name):"Clone of "+b.name);if(v.push(b),a[b.uniqueId]=h.uniqueId,G[h.uniqueId]=h,"MultiMaterial"===b.getClassName()){const k=b;for(const b of k.xg)b&&(h=b.clone(E?E(b.name):"Clone of "+b.name),v.push(b),a[b.uniqueId]=h.uniqueId,G[h.uniqueId]=h);k.xg=k.xg.map((E=>E&&G[a[E.uniqueId]]))}}"InstancedMesh"!==V.getClassName()&&(V.material=G[a[b.uniqueId]])}else"MultiMaterial"===V.material.getClassName()?-1===this.Xd.multiMaterials.indexOf(V.material)&&this.Xd.addMultiMaterial(V.material):-1===this.Xd.materials.indexOf(V.material)&&this.Xd.addMaterial(V.material)}null===k.parent&&l.rootNodes.push(k)};return o.forEach((E=>{if("InstancedMesh"===E.getClassName()){const b=E,h=b.sourceMesh,k=a[h.uniqueId],V=("number"===typeof k?G[k]:h).createInstance(b.name);u(b,V)}else{let b=!0;"sb"===E.getClassName()||"Node"===E.getClassName()||E.skeleton||!E.getTotalVertices||0===E.getTotalVertices()?b=!1:s.doNotInstantiate&&(b="function"===typeof s.doNotInstantiate?!s.doNotInstantiate(E):!s.doNotInstantiate);const h=b?E.createInstance(`instance of ${E.name}`):E.clone(`Clone of ${E.name}`,null,!0);if(!h)throw new Error(`Could not clone or instantiate node on Asset Container ${E.name}`);u(E,h)}})),this.skeletons.forEach((b=>{if(s.predicate&&!s.predicate(b))return;const h=b.clone(E?E(b.name):"Clone of "+b.name);for(const E of this.meshes)if(E.skeleton===b&&!E.isAnInstance){const b=G[a[E.uniqueId]];if(!b||b.isAnInstance)continue;if(b.skeleton=h,-1!==O.indexOf(h))continue;O.push(h);for(const E of h.bones)E._linkedTransformNode&&(E._linkedTransformNode=G[a[E._linkedTransformNode.uniqueId]])}l.skeletons.push(h)})),this.animationGroups.forEach((b=>{if(s.predicate&&!s.predicate(b))return;const h=b.clone(E?E(b.name):"Clone of "+b.name,(E=>G[a[E.uniqueId]]||E));l.animationGroups.push(h)})),l}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||k.g.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Xd.environmentTexture=this.environmentTexture);for(const E of this.Xd._serializableComponents)E.addFromContainer(this);this.Xd.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const b=[];this.cameras.forEach((h=>{E&&!E(h)||(this.Xd.addCamera(h),b.push(h))})),this.lights.forEach((h=>{E&&!E(h)||(this.Xd.addLight(h),b.push(h))})),this.meshes.forEach((h=>{E&&!E(h)||(this.Xd.ti(h),b.push(h))})),this.skeletons.forEach((b=>{E&&!E(b)||this.Xd.addSkeleton(b)})),this.animations.forEach((b=>{E&&!E(b)||this.Xd.addAnimation(b)})),this.animationGroups.forEach((b=>{E&&!E(b)||this.Xd.addAnimationGroup(b)})),this.multiMaterials.forEach((b=>{E&&!E(b)||this.Xd.addMultiMaterial(b)})),this.materials.forEach((b=>{E&&!E(b)||this.Xd.addMaterial(b)})),this.morphTargetManagers.forEach((b=>{E&&!E(b)||this.Xd.addMorphTargetManager(b)})),this.geometries.forEach((b=>{E&&!E(b)||this.Xd.addGeometry(b)})),this.transformNodes.forEach((h=>{E&&!E(h)||(this.Xd.addTransformNode(h),b.push(h))})),this.actionManagers.forEach((b=>{E&&!E(b)||this.Xd.addActionManager(b)})),this.textures.forEach((b=>{E&&!E(b)||this.Xd.addTexture(b)})),this.reflectionProbes.forEach((b=>{E&&!E(b)||this.Xd.addReflectionProbe(b)}));for(const h of b)h.parent&&-1===this.Xd.getNodes().indexOf(h.parent)&&(h.setParent?h.setParent(null):h.parent=null)}removeAllFromScene(){this._isValidHierarchy()||k.g.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Xd.environmentTexture&&(this.Xd.environmentTexture=null);for(const E of this.Xd._serializableComponents)E.removeFromContainer(this)}removeFromScene(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.cameras.forEach((b=>{E&&!E(b)||this.Xd.removeCamera(b)})),this.lights.forEach((b=>{E&&!E(b)||this.Xd.removeLight(b)})),this.meshes.forEach((b=>{E&&!E(b)||this.Xd.Wd(b,!0)})),this.skeletons.forEach((b=>{E&&!E(b)||this.Xd.removeSkeleton(b)})),this.animations.forEach((b=>{E&&!E(b)||this.Xd.removeAnimation(b)})),this.animationGroups.forEach((b=>{E&&!E(b)||this.Xd.removeAnimationGroup(b)})),this.multiMaterials.forEach((b=>{E&&!E(b)||this.Xd.removeMultiMaterial(b)})),this.materials.forEach((b=>{E&&!E(b)||this.Xd.removeMaterial(b)})),this.morphTargetManagers.forEach((b=>{E&&!E(b)||this.Xd.removeMorphTargetManager(b)})),this.geometries.forEach((b=>{E&&!E(b)||this.Xd.removeGeometry(b)})),this.transformNodes.forEach((b=>{E&&!E(b)||this.Xd.removeTransformNode(b)})),this.actionManagers.forEach((b=>{E&&!E(b)||this.Xd.removeActionManager(b)})),this.textures.forEach((b=>{E&&!E(b)||this.Xd.removeTexture(b)})),this.reflectionProbes.forEach((b=>{E&&!E(b)||this.Xd.removeReflectionProbe(b)}))}dispose(){this.cameras.slice(0).forEach((E=>{E.dispose()})),this.cameras.length=0,this.lights.slice(0).forEach((E=>{E.dispose()})),this.lights.length=0,this.meshes.slice(0).forEach((E=>{E.dispose()})),this.meshes.length=0,this.skeletons.slice(0).forEach((E=>{E.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((E=>{E.dispose()})),this.animationGroups.length=0,this.multiMaterials.slice(0).forEach((E=>{E.dispose()})),this.multiMaterials.length=0,this.materials.slice(0).forEach((E=>{E.dispose()})),this.materials.length=0,this.geometries.slice(0).forEach((E=>{E.dispose()})),this.geometries.length=0,this.transformNodes.slice(0).forEach((E=>{E.dispose()})),this.transformNodes.length=0,this.actionManagers.slice(0).forEach((E=>{E.dispose()})),this.actionManagers.length=0,this.textures.slice(0).forEach((E=>{E.dispose()})),this.textures.length=0,this.reflectionProbes.slice(0).forEach((E=>{E.dispose()})),this.reflectionProbes.length=0,this.morphTargetManagers.slice(0).forEach((E=>{E.dispose()})),this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const E of this.Xd._serializableComponents)E.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Xd.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(E,b,h){if(E&&b)for(const a of E){let E=!0;if(h)for(const b of h)if(a===b){E=!1;break}E&&(b.push(a),a._parentContainer=this)}}moveAllFromScene(E){this._wasAddedToScene=!1,void 0===E&&(E=new D);for(const b in this)Object.prototype.hasOwnProperty.call(this,b)&&(this[b]=this[b]||("_environmentTexture"===b?null:[]),this._moveAssets(this.Xd[b],this[b],E[b]));this.environmentTexture=this.Xd.environmentTexture,this.removeAllFromScene()}createRootMesh(){const E=new V.b("assetContainerRootMesh",this.Xd);return this.meshes.forEach((b=>{b.parent||E.addChild(b)})),this.meshes.unshift(E),E}mergeAnimationsTo(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.b.LastCreatedScene,b=arguments.length>1?arguments[1]:void 0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!E)return v.c.Error("No scene available to merge animations to"),[];const a=h||(b=>{let h=null;const a=b.animations.length?b.animations[0].targetProperty:"",k=b.name.split(".").join("").split("_primitive")[0];switch(a){case"position":case"rotationQuaternion":h=E.getTransformNodeByName(b.name)||E.getTransformNodeByName(k);break;case"influence":h=E.getMorphTargetByName(b.name)||E.getMorphTargetByName(k);break;default:h=E.getNodeByName(b.name)||E.getNodeByName(k)}return h});this.getNodes().forEach((E=>{const b=a(E);if(null!==b){for(const h of E.animations){const E=b.animations.filter((E=>E.targetProperty===h.targetProperty));for(const h of E){const E=b.animations.indexOf(h,0);E>-1&&b.animations.splice(E,1)}}b.animations=b.animations.concat(E.animations)}}));const k=[];return this.animationGroups.slice().forEach((E=>{k.push(E.clone(E.name,a)),E.animatables.forEach((E=>{E.stop()}))})),b.forEach((b=>{const h=a(b.target);h&&(E.beginAnimation(h,b.fromFrame,b.toFrame,b.loopAnimation,b.speedRatio,b.onAnimationEnd?b.onAnimationEnd:void 0,void 0,!0,void 0,b.onAnimationLoop?b.onAnimationLoop:void 0),E.stopAnimation(b.target))})),k}populateRootNodes(){this.rootNodes.length=0,this.meshes.forEach((E=>{E.parent||-1!==this.rootNodes.indexOf(E)||this.rootNodes.push(E)})),this.transformNodes.forEach((E=>{E.parent||-1!==this.rootNodes.indexOf(E)||this.rootNodes.push(E)})),this.lights.forEach((E=>{E.parent||-1!==this.rootNodes.indexOf(E)||this.rootNodes.push(E)})),this.cameras.forEach((E=>{E.parent||-1!==this.rootNodes.indexOf(E)||this.rootNodes.push(E)}))}addAllAssetsToContainer(E){if(!E)return;const b=[],h=new Set;for(b.push(E);b.length>0;){const E=b.pop();if(E instanceof V.b?(E.Lj&&-1===this.geometries.indexOf(E.Lj)&&this.geometries.push(E.Lj),this.meshes.push(E)):E instanceof l.c?this.transformNodes.push(E):E instanceof B.d?this.lights.push(E):E instanceof o.b&&this.cameras.push(E),E instanceof O.b){if(E.material&&-1===this.materials.indexOf(E.material)){this.materials.push(E.material);for(const b of E.material.getActiveTextures())-1===this.textures.indexOf(b)&&this.textures.push(b)}E.skeleton&&-1===this.skeletons.indexOf(E.skeleton)&&this.skeletons.push(E.skeleton),E.morphTargetManager&&-1===this.morphTargetManagers.indexOf(E.morphTargetManager)&&this.morphTargetManagers.push(E.morphTargetManager)}for(const a of E.getChildren())h.has(a)||b.push(a);h.add(E)}this.populateRootNodes()}}var M=h(10887);class I{constructor(E){this.byteOffset=0,this.buffer=E}loadAsync(E){return this.buffer.readAsync(this.byteOffset,E).then((E=>{this._dataView=new DataView(E.buffer,E.byteOffset,E.byteLength),this._dataByteOffset=0}))}readUint32(){const E=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,E}readUint8Array(E){const b=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,E);return this._dataByteOffset+=E,this.byteOffset+=E,b}readString(E){return(0,M.f)(this.readUint8Array(E))}skipBytes(E){this._dataByteOffset+=E,this.byteOffset+=E}}var j=h(12188);const P="Z2xURg",A={name:"Wi",extensions:{".gltf":{isBinary:!1},".glb":{isBinary:!0}},canDirectLoad:E=>-1!==E.indexOf("asset")&&-1!==E.indexOf("version")||E.startsWith("data:base64,"+P)||E.startsWith("data:;base64,"+P)||E.startsWith("data:application/octet-stream;base64,"+P)||E.startsWith("data:model/gltf-binary;base64,"+P)};var n,d,c,z=h(10878),Z=h(10883);function Y(E,b,h){try{return Promise.resolve(new Uint8Array(E,b,h))}catch(a){return Promise.reject(a)}}!function(E){E[E.AUTO=0]="AUTO",E[E.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(n||(n={})),function(E){E[E.NONE=0]="NONE",E[E.FIRST=1]="FIRST",E[E.ALL=2]="ALL"}(d||(d={})),function(E){E[E.LOADING=0]="LOADING",E[E.READY=1]="READY",E[E.COMPLETE=2]="COMPLETE"}(c||(c={}));class r{constructor(){this.coordinateSystemMode=n.AUTO,this.animationStartMode=d.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=E=>Promise.resolve(E),this.extensionOptions={}}p(E){E&&(this.onParsed=E.onParsed,this.coordinateSystemMode=E.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=E.animationStartMode??this.animationStartMode,this.loadNodeAnimations=E.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=E.loadSkins??this.loadSkins,this.loadMorphTargets=E.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=E.compileMaterials??this.compileMaterials,this.useClipPlane=E.useClipPlane??this.useClipPlane,this.compileShadowGenerators=E.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=E.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=E.useRangeRequests??this.useRangeRequests,this.createInstances=E.createInstances??this.createInstances,this.alwaysComputeBoundingBox=E.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=E.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=E.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=E.skipMaterials??this.skipMaterials,this.useSRGBBuffers=E.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=E.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=E.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=E.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=E.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=E.customRootNode,this.onMeshLoaded=E.onMeshLoaded,this.onSkinLoaded=E.onSkinLoaded,this.onTextureLoaded=E.onTextureLoaded,this.onMaterialLoaded=E.onMaterialLoaded,this.onCameraLoaded=E.onCameraLoaded,this.extensionOptions=E.extensionOptions??this.extensionOptions)}}class w extends r{constructor(E){super(),this.onParsedObservable=new a.e,this.onMeshLoadedObservable=new a.e,this.onSkinLoadedObservable=new a.e,this.onTextureLoadedObservable=new a.e,this.onMaterialLoadedObservable=new a.e,this.onCameraLoadedObservable=new a.e,this.onCompleteObservable=new a.e,this.onErrorObservable=new a.e,this.rj=new a.e,this.onExtensionLoadedObservable=new a.e,this.validate=!1,this.onValidatedObservable=new a.e,this._loader=null,this._state=null,this._requests=new Array,this.name=A.name,this.extensions=A.extensions,this.onLoaderStateChangedObservable=new a.e,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(E)}set onParsed(E){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),E&&(this._onParsedObserver=this.onParsedObservable.add(E))}set onMeshLoaded(E){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),E&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(E))}set onSkinLoaded(E){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),E&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((b=>E(b.node,b.skinnedNode))))}set onTextureLoaded(E){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),E&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(E))}set onMaterialLoaded(E){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),E&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(E))}set onCameraLoaded(E){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),E&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(E))}set onComplete(E){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(E)}set onError(E){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(E)}set onDispose(E){this._onDisposeObserver&&this.rj.remove(this._onDisposeObserver),this._onDisposeObserver=this.rj.add(E)}set onExtensionLoaded(E){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(E)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(E){this._loggingEnabled!==E&&(this._loggingEnabled=E,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(E){this._capturePerformanceCounters!==E&&(this._capturePerformanceCounters=E,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(E){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(E)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const E of this._requests)E.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=E=>Promise.resolve(E),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.rj.notifyObservers(void 0),this.rj.clear()}loadFile(E,b,h,G,V,l,O,s){if(ArrayBuffer.isView(b))return this._loadBinary(E,b,h,G,O,s),null;this._progressCallback=V;const U=b.name||k.g.GetFilename(b);if(l){if(this.useRangeRequests){this.validate&&v.c.Warn("glTF validation is not supported when range requests are enabled");const h={abort:()=>{},onCompleteObservable:new a.e},k={readAsync:(h,a)=>new Promise(((k,G)=>{this._loadFile(E,b,(E=>{k(new Uint8Array(E))}),!0,(E=>{G(E)}),(E=>{E.setRequestHeader("Range",`bytes=${h}-${h+a-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new I(k)).then((E=>{h.onCompleteObservable.notifyObservers(h),G(E)}),O?E=>O(void 0,E):void 0),h}return this._loadFile(E,b,(b=>{this._validate(E,new Uint8Array(b,0,b.byteLength),h,U),this._unpackBinaryAsync(new I({readAsync:(E,h)=>Y(b,E,h),byteLength:b.byteLength})).then((E=>{G(E)}),O?E=>O(void 0,E):void 0)}),!0,O)}return this._loadFile(E,b,(b=>{try{this._validate(E,b,h,U),G({json:this._parseJson(b)})}catch{O&&O()}}),!1,O)}_loadBinary(E,b,h,a,k,G){this._validate(E,new Uint8Array(b.buffer,b.byteOffset,b.byteLength),h,G),this._unpackBinaryAsync(new I({readAsync:(E,h)=>function(E,b,h){try{if(b<0||b>=E.byteLength)throw new RangeError("Offset is out of range.");if(b+h>E.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(E.buffer,E.byteOffset+b,h))}catch(a){return Promise.reject(a)}}(b,E,h),byteLength:b.byteLength})).then((E=>{a(E)}),k?E=>k(void 0,E):void 0)}importMeshAsync(E,b,h,a,k,G){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(h),this.onParsedObservable.clear(),this._log(`Loading ${G||""}`),this._loader=this._getLoader(h),this._loader.importMeshAsync(E,b,null,h,a,k,G))))}loadAsync(E,b,h,a,k){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(b),this.onParsedObservable.clear(),this._log(`Loading ${k||""}`),this._loader=this._getLoader(b),this._loader.loadAsync(E,b,h,a,k))))}loadAssetContainerAsync(E,b,h,a,k){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(b),this.onParsedObservable.clear(),this._log(`Loading ${k||""}`),this._loader=this._getLoader(b);const G=new S(E),V=[];this.onMaterialLoadedObservable.add((E=>{V.push(E)}));const l=[];this.onTextureLoadedObservable.add((E=>{l.push(E)}));const O=[];this.onCameraLoadedObservable.add((E=>{O.push(E)}));const v=[];return this.onMeshLoadedObservable.add((E=>{E.morphTargetManager&&v.push(E.morphTargetManager)})),this._loader.importMeshAsync(null,E,G,b,h,a,k).then((E=>(Array.prototype.push.apply(G.geometries,E.geometries),Array.prototype.push.apply(G.meshes,E.meshes),Array.prototype.push.apply(G.yj,E.yj),Array.prototype.push.apply(G.skeletons,E.skeletons),Array.prototype.push.apply(G.animationGroups,E.animationGroups),Array.prototype.push.apply(G.materials,V),Array.prototype.push.apply(G.textures,l),Array.prototype.push.apply(G.lights,E.lights),Array.prototype.push.apply(G.transformNodes,E.transformNodes),Array.prototype.push.apply(G.cameras,O),Array.prototype.push.apply(G.morphTargetManagers,v),G)))}))}canDirectLoad(E){return A.canDirectLoad(E)}directLoad(E,b){if(b.startsWith("base64,"+P)||b.startsWith(";base64,"+P)||b.startsWith("application/octet-stream;base64,"+P)||b.startsWith("model/gltf-binary;base64,"+P)){const h=(0,z.b)(b);return this._validate(E,new Uint8Array(h,0,h.byteLength)),this._unpackBinaryAsync(new I({readAsync:(E,b)=>Y(h,E,b),byteLength:h.byteLength}))}return this._validate(E,b),Promise.resolve({json:this._parseJson(b)})}createPlugin(E){return new w(E[A.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((E,b)=>{this.onCompleteObservable.addOnce((()=>{E()})),this.onErrorObservable.addOnce((E=>{b(E)}))}))}_setState(E){this._state!==E&&(this._state=E,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(c[this._state]))}_loadFile(E,b,h,a,k,G){const V=E._loadFile(b,h,(E=>{this._onProgress(E,V)}),!0,a,k,G);return V.onCompleteObservable.add((()=>{V._lengthComputable=!0,V._total=V._loaded})),this._requests.push(V),V}_onProgress(E,b){if(!this._progressCallback)return;b._lengthComputable=E.lengthComputable,b._loaded=E.loaded,b._total=E.total;let h=!0,a=0,k=0;for(const G of this._requests){if(void 0===G._lengthComputable||void 0===G._loaded||void 0===G._total)return;h=h&&G._lengthComputable,a+=G._loaded,k+=G._total}this._progressCallback({lengthComputable:h,loaded:a,total:h?k:0})}_validate(E,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),j.e.ValidateAsync(b,h,a,(b=>this.preprocessUrlAsync(h+b).then((b=>E._loadFileAsync(b,void 0,!0,!0).then((E=>new Uint8Array(E,0,E.byteLength))))))).then((E=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(E),this.onValidatedObservable.clear()}),(E=>{this._endPerformanceCounter("Validate JSON"),k.g.Warn(`Failed to validate: ${E.message}`),this.onValidatedObservable.clear()})))}_getLoader(E){const b=E.json.asset||{};this._log(`Asset version: ${b.version}`),b.minVersion&&this._log(`Asset minimum version: ${b.minVersion}`),b.generator&&this._log(`Asset generator: ${b.generator}`);const h=w._parseVersion(b.version);if(!h)throw new Error("Invalid version: "+b.version);if(void 0!==b.minVersion){const E=w._parseVersion(b.minVersion);if(!E)throw new Error("Invalid minimum version: "+b.minVersion);if(w._compareVersion(E,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+b.minVersion)}const a={1:w._CreateGLTF1Loader,2:w._CreateGLTF2Loader}[h.major];if(!a)throw new Error("Unsupported version: "+b.version);return a(this)}_parseJson(E){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${E.length}`);const b=JSON.parse(E);return this._endPerformanceCounter("Parse JSON"),b}_unpackBinaryAsync(E){return this._startPerformanceCounter("Unpack Binary"),E.loadAsync(20).then((()=>{const b=E.readUint32();if(1179937895!==b)throw new Z.g("Unexpected magic: "+b,Z.e.GLTFLoaderUnexpectedMagicError);const h=E.readUint32();this.loggingEnabled&&this._log(`Binary version: ${h}`);const a=E.readUint32();let k;switch(this.useRangeRequests||a===E.buffer.byteLength||v.c.Warn(`Length in header does not match actual data length: ${a} != ${E.buffer.byteLength}`),h){case 1:k=this._unpackBinaryV1Async(E,a);break;case 2:k=this._unpackBinaryV2Async(E,a);break;default:throw new Error("Unsupported version: "+h)}return this._endPerformanceCounter("Unpack Binary"),k}))}_unpackBinaryV1Async(E,b){const h=E.readUint32(),a=E.readUint32();if(0!==a)throw new Error(`Unexpected content format: ${a}`);const k=b-E.byteOffset,G={json:this._parseJson(E.readString(h)),bin:null};if(0!==k){const b=E.byteOffset;G.bin={readAsync:(h,a)=>E.buffer.readAsync(b+h,a),byteLength:k}}return Promise.resolve(G)}_unpackBinaryV2Async(E,b){const h=1313821514,a=5130562,k=E.readUint32();if(E.readUint32()!==h)throw new Error("First chunk format is not JSON");return E.byteOffset+k===b?E.loadAsync(k).then((()=>({json:this._parseJson(E.readString(k)),bin:null}))):E.loadAsync(k+8).then((()=>{const G={json:this._parseJson(E.readString(k)),bin:null},V=()=>{const k=E.readUint32();switch(E.readUint32()){case h:throw new Error("Unexpected JSON chunk");case a:{const b=E.byteOffset;G.bin={readAsync:(h,a)=>E.buffer.readAsync(b+h,a),byteLength:k},E.skipBytes(k);break}default:E.skipBytes(k)}return E.byteOffset!==b?E.loadAsync(8).then(V):Promise.resolve(G)};return V()}))}static _parseVersion(E){if("1.0"===E||"1.0.1"===E)return{major:1,minor:0};const b=(E+"").match(/^(\d+)\.(\d+)/);return b?{major:parseInt(b[1]),minor:parseInt(b[2])}:null}static _compareVersion(E,b){return E.major>b.major?1:E.major<b.major?-1:E.minor>b.minor?1:E.minor<b.minor?-1:0}_logOpen(E){this._log(E),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(E){const b=w._logSpaces.substring(0,2*this._logIndentLevel);v.c.Log(`${b}${E}`)}_logDisabled(E){}_startPerformanceCounterEnabled(E){k.g.StartPerformanceCounter(E)}_startPerformanceCounterDisabled(E){}_endPerformanceCounterEnabled(E){k.g.EndPerformanceCounter(E)}_endPerformanceCounterDisabled(E){}}w.IncrementalLoading=!0,w.HomogeneousCoordinates=!1,w._logSpaces="                                ",(0,G.d)(new w)},12188:(E,b,h)=>{"use strict";h.d(b,{e:()=>V});var a=h(10821);function k(E,b,h,a){const k={externalResourceFunction:a};return h&&(k.uri="file:"===b?h:b+h),ArrayBuffer.isView(E)?GLTFValidator.validateBytes(E,k):GLTFValidator.validateString(E,k)}function G(){const E=[];onmessage=b=>{const h=b.data;switch(h.id){case"init":importScripts(h.url);break;case"validate":k(h.data,h.rootUrl,h.fileName,(b=>new Promise(((h,a)=>{const k=E.length;E.push({resolve:h,reject:a}),postMessage({id:"getExternalResource",index:k,uri:b})})))).then((E=>{postMessage({id:"validate.resolve",value:E})}),(E=>{postMessage({id:"validate.reject",reason:E})}));break;case"getExternalResource.resolve":E[h.index].resolve(h.value);break;case"getExternalResource.reject":E[h.index].reject(h.reason)}}}class V{static ValidateAsync(E,b,h,V){return"function"===typeof Worker?new Promise(((l,O)=>{const v=`${k}(${G})()`,s=URL.createObjectURL(new Blob([v],{type:"application/javascript"})),U=new Worker(s),B=E=>{U.removeEventListener("error",B),U.removeEventListener("message",o),O(E)},o=E=>{const b=E.data;switch(b.id){case"getExternalResource":V(b.uri).then((E=>{U.postMessage({id:"getExternalResource.resolve",index:b.index,value:E},[E.buffer])}),(E=>{U.postMessage({id:"getExternalResource.reject",index:b.index,reason:E})}));break;case"validate.resolve":U.removeEventListener("error",B),U.removeEventListener("message",o),l(b.value),U.terminate();break;case"validate.reject":U.removeEventListener("error",B),U.removeEventListener("message",o),O(b.reason),U.terminate()}};if(U.addEventListener("error",B),U.addEventListener("message",o),U.postMessage({id:"init",url:a.g.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(E)){const a=E.slice();U.postMessage({id:"validate",data:a,rootUrl:b,fileName:h},[a.buffer])}else U.postMessage({id:"validate",data:E,rootUrl:b,fileName:h})})):(this._LoadScriptPromise||(this._LoadScriptPromise=a.g.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>k(E,b,h,V))))}}V.Configuration={url:`${a.g._DefaultCdnUrl}/gltf_validator.js`}},12594:(E,b,h)=>{"use strict";h.d(b,{e:()=>n});var a=h(11130),k=h(11139),G=h(11206),V=h(11175),l=h(11366),O=h(11368),v=h(11233),s=h(11163),U=h(10958),B=h(10912);h(11843),h(11733),h(11754),h(11737),h(11759),h(11764),h(11771);const o="imageProcessingCompatibility",u="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";B.d.IncludesShadersStore[o]=u;const D="skyPixelShader",g="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";B.d.ShadersStore[D]=g;h(11859),h(11779),h(11787),h(11804),h(11796);const S="skyVertexShader",M="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";B.d.ShadersStore[S]=M;var I=h(11396),j=h(11357),P=h(11351);class A extends l.c{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class n extends O.d{constructor(E,b){super(E,b),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new V.k(0,100,0),this.useSunPosition=!1,this.cameraOffset=V.k.Zero(),this.up=V.k.Up(),this.dithering=!1,this._cameraPosition=V.k.Zero(),this._skyOrientation=new V.g}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(E,b){const h=b._drawWrapper;if(this.isFrozen&&h.effect&&h._wasPreviouslyReady)return!0;b.materialDefines||(b.materialDefines=new A);const a=b.materialDefines,k=this.va();if(this._isReadyForSubMesh(b))return!0;if((0,P.R)(E,k,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,a),(0,P.H)(E,a,!0,!1),a.IMAGEPROCESSINGPOSTPROCESS!==k.imageProcessingConfiguration.applyByPostProcess&&a.markAsMiscDirty(),a.DITHER!==this.dithering&&a.markAsMiscDirty(),a.isDirty){a.markAsProcessed(),k.resetCachedMaterial();const E=new I.b;a.FOG&&E.addFallback(1,"FOG"),a.IMAGEPROCESSINGPOSTPROCESS=k.imageProcessingConfiguration.applyByPostProcess,a.DITHER=this.dithering;const h=[v.g.PositionKind];a.VERTEXCOLOR&&h.push(v.g.ColorKind);const G="sky",V=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,j.b)(V);const l=a.toString();b.setEffect(k.getEngine().createEffect(G,h,V,[],l,E,this.onCompiled,this.onError),a,this._materialContext)}return!(!b.effect||!b.effect.isReady())&&(a._renderId=k.getRenderId(),h._wasPreviouslyReady=!0,!0)}bindForSubMesh(E,b,h){const a=this.va(),k=h.materialDefines;if(!k)return;const G=h.effect;if(!G)return;this._activeEffect=G,this.bindOnlyWorldMatrix(E),this._activeEffect.setMatrix("viewProjection",a.getTransformMatrix()),this._mustRebind(a,G,h)&&((0,j.f)(G,this,a),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,P.m)(k,G,a)),a.fogEnabled&&b.applyFog&&a.fogMode!==s.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",a.getViewMatrix()),(0,P.f)(a,b,this._activeEffect);const l=a.activeCamera;if(l){const E=l.getWorldMatrix();this._cameraPosition.x=E.m[12],this._cameraPosition.y=E.m[13],this._cameraPosition.z=E.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const E=Math.PI*(this.inclination-.5),b=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(b)*Math.cos(E),this.sunPosition.y=this.distance*Math.sin(-E),this.sunPosition.z=this.distance*Math.sin(b)*Math.cos(E),V.g.FromUnitVectorsToRef(V.k.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(b,this._activeEffect,h)}getAnimatables(){return[]}dispose(E){super.dispose(E)}clone(E){return G.e.Clone((()=>new n(E,this.va())),this)}serialize(){const E=super.serialize();return E.customType="BABYLON.SkyMaterial",E}getClassName(){return"SkyMaterial"}static Parse(E,b,h){return G.e.Parse((()=>new n(E.name,b)),E,b,h)}}(0,a.d)([(0,k.H)()],n.prototype,"luminance",void 0),(0,a.d)([(0,k.H)()],n.prototype,"turbidity",void 0),(0,a.d)([(0,k.H)()],n.prototype,"rayleigh",void 0),(0,a.d)([(0,k.H)()],n.prototype,"mieCoefficient",void 0),(0,a.d)([(0,k.H)()],n.prototype,"mieDirectionalG",void 0),(0,a.d)([(0,k.H)()],n.prototype,"distance",void 0),(0,a.d)([(0,k.H)()],n.prototype,"inclination",void 0),(0,a.d)([(0,k.H)()],n.prototype,"azimuth",void 0),(0,a.d)([(0,k.G)()],n.prototype,"sunPosition",void 0),(0,a.d)([(0,k.H)()],n.prototype,"useSunPosition",void 0),(0,a.d)([(0,k.G)()],n.prototype,"cameraOffset",void 0),(0,a.d)([(0,k.G)()],n.prototype,"up",void 0),(0,a.d)([(0,k.H)()],n.prototype,"dithering",void 0),(0,U.f)("BABYLON.SkyMaterial",n)},10678:(E,b,h)=>{"use strict";function a(E,b){b.headers=E.headers||{},b.statusMessage=E.statusText,b.statusCode=E.status,b.data=E.response}function k(E,b,h){return new Promise((function(k,G){h=h||{};var V,l,O,v=new XMLHttpRequest,s=h.body,U=h.headers||{};for(V in h.timeout&&(v.timeout=h.timeout),v.ontimeout=v.onerror=function(E){E.timeout="timeout"==E.type,G(E)},v.open(E,b.href||b),v.onload=function(){for(O=v.getAllResponseHeaders().trim().split(/[\r\n]+/),a(v,v);l=O.shift();)l=l.split(": "),v.headers[l.shift().toLowerCase()]=l.join(": ");if((l=v.headers["content-type"])&&~l.indexOf("application/json"))try{v.data=JSON.parse(v.data,h.reviver)}catch(E){return a(v,E),G(E)}(v.status>=400?G:k)(v)},typeof FormData<"u"&&s instanceof FormData||s&&"object"==typeof s&&(U["content-type"]="application/json",s=JSON.stringify(s)),v.withCredentials=!!h.withCredentials,U)v.setRequestHeader(V,U[V]);v.send(s)}))}h.r(b),h.d(b,{del:()=>O,get:()=>G,patch:()=>l,post:()=>V,put:()=>v,send:()=>k});var G=k.bind(k,"GET"),V=k.bind(k,"POST"),l=k.bind(k,"PATCH"),O=k.bind(k,"DELETE"),v=k.bind(k,"PUT")},12705:(E,b,h)=>{"use strict";h.d(b,{d:()=>U});const a=.5*(Math.sqrt(3)-1),k=(3-Math.sqrt(3))/6,G=1/3,V=1/6,l=(Math.sqrt(5)-1)/4,O=(5-Math.sqrt(5))/20,v=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),s=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const U=class{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const b="function"==typeof E?E:function(E){let b=0,h=0,a=0,k=1;const G=function(){let E=4022871197;return function(b){b=b.toString();for(let h=0;h<b.length;h++){E+=b.charCodeAt(h);let a=.02519603282416938*E;E=a>>>0,a-=E,a*=E,E=a>>>0,a-=E,E+=4294967296*a}return 2.3283064365386963e-10*(E>>>0)}}();b=G(" "),h=G(" "),a=G(" "),b-=G(E),b<0&&(b+=1);h-=G(E),h<0&&(h+=1);a-=G(E),a<0&&(a+=1);return function(){const E=2091639*b+2.3283064365386963e-10*k;return b=h,h=a,a=E-(k=0|E)}}(E);this.p=function(E){const b=new Uint8Array(256);for(let h=0;h<256;h++)b[h]=h;for(let h=0;h<255;h++){const a=h+~~(E()*(256-h)),k=b[h];b[h]=b[a],b[a]=k}return b}(b),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let h=0;h<512;h++)this.perm[h]=this.p[255&h],this.permMod12[h]=this.perm[h]%12}noise2D(E,b){const h=this.permMod12,G=this.perm;let V=0,l=0,O=0;const s=(E+b)*a,U=Math.floor(E+s),B=Math.floor(b+s),o=(U+B)*k,u=E-(U-o),D=b-(B-o);let g,S;u>D?(g=1,S=0):(g=0,S=1);const M=u-g+k,I=D-S+k,j=u-1+2*k,P=D-1+2*k,A=255&U,n=255&B;let d=.5-u*u-D*D;if(d>=0){const E=3*h[A+G[n]];d*=d,V=d*d*(v[E]*u+v[E+1]*D)}let c=.5-M*M-I*I;if(c>=0){const E=3*h[A+g+G[n+S]];c*=c,l=c*c*(v[E]*M+v[E+1]*I)}let z=.5-j*j-P*P;if(z>=0){const E=3*h[A+1+G[n+1]];z*=z,O=z*z*(v[E]*j+v[E+1]*P)}return 70*(V+l+O)}noise3D(E,b,h){const a=this.permMod12,k=this.perm;let l,O,s,U;const B=(E+b+h)*G,o=Math.floor(E+B),u=Math.floor(b+B),D=Math.floor(h+B),g=(o+u+D)*V,S=E-(o-g),M=b-(u-g),I=h-(D-g);let j,P,A,n,d,c;S>=M?M>=I?(j=1,P=0,A=0,n=1,d=1,c=0):S>=I?(j=1,P=0,A=0,n=1,d=0,c=1):(j=0,P=0,A=1,n=1,d=0,c=1):M<I?(j=0,P=0,A=1,n=0,d=1,c=1):S<I?(j=0,P=1,A=0,n=0,d=1,c=1):(j=0,P=1,A=0,n=1,d=1,c=0);const z=S-j+V,Z=M-P+V,Y=I-A+V,r=S-n+2*V,w=M-d+2*V,N=I-c+2*V,H=S-1+.5,f=M-1+.5,F=I-1+.5,y=255&o,e=255&u,J=255&D;let m=.6-S*S-M*M-I*I;if(m<0)l=0;else{const E=3*a[y+k[e+k[J]]];m*=m,l=m*m*(v[E]*S+v[E+1]*M+v[E+2]*I)}let K=.6-z*z-Z*Z-Y*Y;if(K<0)O=0;else{const E=3*a[y+j+k[e+P+k[J+A]]];K*=K,O=K*K*(v[E]*z+v[E+1]*Z+v[E+2]*Y)}let x=.6-r*r-w*w-N*N;if(x<0)s=0;else{const E=3*a[y+n+k[e+d+k[J+c]]];x*=x,s=x*x*(v[E]*r+v[E+1]*w+v[E+2]*N)}let W=.6-H*H-f*f-F*F;if(W<0)U=0;else{const E=3*a[y+1+k[e+1+k[J+1]]];W*=W,U=W*W*(v[E]*H+v[E+1]*f+v[E+2]*F)}return 32*(l+O+s+U)}noise4D(E,b,h,a){const k=this.perm;let G,V,v,U,B;const o=(E+b+h+a)*l,u=Math.floor(E+o),D=Math.floor(b+o),g=Math.floor(h+o),S=Math.floor(a+o),M=(u+D+g+S)*O,I=E-(u-M),j=b-(D-M),P=h-(g-M),A=a-(S-M);let n=0,d=0,c=0,z=0;I>j?n++:d++,I>P?n++:c++,I>A?n++:z++,j>P?d++:c++,j>A?d++:z++,P>A?c++:z++;const Z=n>=3?1:0,Y=d>=3?1:0,r=c>=3?1:0,w=z>=3?1:0,N=n>=2?1:0,H=d>=2?1:0,f=c>=2?1:0,F=z>=2?1:0,y=n>=1?1:0,e=d>=1?1:0,J=c>=1?1:0,m=z>=1?1:0,K=I-Z+O,x=j-Y+O,W=P-r+O,L=A-w+O,t=I-N+2*O,T=j-H+2*O,X=P-f+2*O,C=A-F+2*O,q=I-y+3*O,R=j-e+3*O,Q=P-J+3*O,i=A-m+3*O,p=I-1+4*O,EE=j-1+4*O,bE=P-1+4*O,hE=A-1+4*O,aE=255&u,kE=255&D,GE=255&g,VE=255&S;let lE=.6-I*I-j*j-P*P-A*A;if(lE<0)G=0;else{const E=k[aE+k[kE+k[GE+k[VE]]]]%32*4;lE*=lE,G=lE*lE*(s[E]*I+s[E+1]*j+s[E+2]*P+s[E+3]*A)}let OE=.6-K*K-x*x-W*W-L*L;if(OE<0)V=0;else{const E=k[aE+Z+k[kE+Y+k[GE+r+k[VE+w]]]]%32*4;OE*=OE,V=OE*OE*(s[E]*K+s[E+1]*x+s[E+2]*W+s[E+3]*L)}let vE=.6-t*t-T*T-X*X-C*C;if(vE<0)v=0;else{const E=k[aE+N+k[kE+H+k[GE+f+k[VE+F]]]]%32*4;vE*=vE,v=vE*vE*(s[E]*t+s[E+1]*T+s[E+2]*X+s[E+3]*C)}let sE=.6-q*q-R*R-Q*Q-i*i;if(sE<0)U=0;else{const E=k[aE+y+k[kE+e+k[GE+J+k[VE+m]]]]%32*4;sE*=sE,U=sE*sE*(s[E]*q+s[E+1]*R+s[E+2]*Q+s[E+3]*i)}let UE=.6-p*p-EE*EE-bE*bE-hE*hE;if(UE<0)B=0;else{const E=k[aE+1+k[kE+1+k[GE+1+k[VE+1]]]]%32*4;UE*=UE,B=UE*UE*(s[E]*p+s[E+1]*EE+s[E+2]*bE+s[E+3]*hE)}return 27*(G+V+v+U+B)}}}}]);