"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[9],{11611:(s,Z,o)=>{o.d(Z,{e:()=>U,i:()=>f,k:()=>A,n:()=>D,q:()=>b,s:()=>Y,t:()=>z});var t=o(10900),j=o(11174),S=o(10935),a=o(10916),O=o(11614),v=o(11201),G=o(11389),B=o(10977),Q=o(11167);const D=Object.freeze(new t.e(0,0,0,0)),z=Object.freeze(t.n.Zero()),Y=Object.freeze(t.j.Zero()),b=Object.freeze(G.b.Zero()),f=Object.freeze(j.d.Black()),A=Object.freeze(new j.h(0,0,0,0)),d={key:0,repeatCount:0,loopMode:2};class U{static _PrepareAnimation(s,Z,o,S,a,O,v,B){let Q;if(!isNaN(parseFloat(a))&&isFinite(a)?Q=U.ANIMATIONTYPE_FLOAT:a instanceof t.e?Q=U.ANIMATIONTYPE_QUATERNION:a instanceof t.n?Q=U.ANIMATIONTYPE_VECTOR3:a instanceof t.j?Q=U.ANIMATIONTYPE_VECTOR2:a instanceof j.d?Q=U.ANIMATIONTYPE_COLOR3:a instanceof j.h?Q=U.ANIMATIONTYPE_COLOR4:a instanceof G.b&&(Q=U.ANIMATIONTYPE_SIZE),void 0==Q)return null;const D=new U(s,Z,o,Q,v),z=[{frame:0,value:a},{frame:S,value:O}];return D.setKeys(z),void 0!==B&&D.setEasingFunction(B),D}static CreateAnimation(s,Z,o,t){const j=new U(s+"Animation",s,o,Z,U.ANIMATIONLOOPMODE_CONSTANT);return j.setEasingFunction(t),j}static CreateAndStartAnimation(s,Z,o,t,j,S,a,O,v,G,B){const Q=U._PrepareAnimation(s,o,t,j,S,a,O,v);return Q?(Z.Ls&&(B=Z.Ls()),B?B.beginDirectAnimation(Z,[Q],0,j,Q.loopMode!==U.ANIMATIONLOOPMODE_CONSTANT,1,G):null):null}static CreateAndStartHierarchyAnimation(s,Z,o,t,j,S,a,O,v,G,B){const Q=U._PrepareAnimation(s,t,j,S,a,O,v,G);if(!Q)return null;return Z.Ls().beginDirectHierarchyAnimation(Z,o,[Q],0,S,1===Q.loopMode,1,B)}static CreateMergeAndStartAnimation(s,Z,o,t,j,S,a,O,v,G){const B=U._PrepareAnimation(s,o,t,j,S,a,O,v);return B?(Z.animations.push(B),Z.Ls().beginAnimation(Z,0,j,1===B.loopMode,1,G)):null}static MakeAnimationAdditive(s,Z,o){let j;j="object"===typeof Z?Z:{referenceFrame:Z??0,range:o,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let S=s;if(j.cloneOriginalAnimation&&(S=s.clone(),S.name=j.clonedAnimationName||S.name),!S._keys.length)return S;const a=j.referenceFrame&&j.referenceFrame>=0?j.referenceFrame:0;let O=0;const v=S._keys[0];let G=S._keys.length-1;const B=S._keys[G],Q={referenceValue:v.value,referencePosition:t.g.sO[0],referenceQuaternion:t.g.Quaternion[0],referenceScaling:t.g.sO[1],keyPosition:t.g.sO[2],keyQuaternion:t.g.Quaternion[1],keyScaling:t.g.sO[3]};let D=v.frame,z=B.frame;if(j.range){const s=S.getRange(j.range);s&&(D=s.from,z=s.to)}else D=j.fromFrame??D,z=j.toFrame??z;if(D!==v.frame&&(O=S.createKeyForFrame(D)),z!==B.frame&&(G=S.createKeyForFrame(z)),1===S._keys.length){const s=S._getKeyValue(S._keys[0]);Q.referenceValue=s.clone?s.clone():s}else if(a<=v.frame){const s=S._getKeyValue(v.value);Q.referenceValue=s.clone?s.clone():s}else if(a>=B.frame){const s=S._getKeyValue(B.value);Q.referenceValue=s.clone?s.clone():s}else{d.key=0;const s=S._interpolate(a,d);Q.referenceValue=s.clone?s.clone():s}S.dataType===U.ANIMATIONTYPE_QUATERNION?Q.referenceValue.normalize().conjugateInPlace():S.dataType===U.ANIMATIONTYPE_MATRIX&&(Q.referenceValue.decompose(Q.referenceScaling,Q.referenceQuaternion,Q.referencePosition),Q.referenceQuaternion.normalize().conjugateInPlace());let Y=Number.MAX_VALUE;const b=j.clipKeys?[]:null;for(let f=O;f<=G;f++){let s=S._keys[f];if((b||j.cloneOriginalAnimation)&&(s={frame:s.frame,value:s.value.clone?s.value.clone():s.value,inTangent:s.inTangent,outTangent:s.outTangent,interpolation:s.interpolation,lockedTangent:s.lockedTangent},b&&(Y===Number.MAX_VALUE&&(Y=s.frame),s.frame-=Y,b.push(s))),!f||S.dataType===U.ANIMATIONTYPE_FLOAT||s.value!==v.value)switch(S.dataType){case U.ANIMATIONTYPE_MATRIX:s.value.decompose(Q.keyScaling,Q.keyQuaternion,Q.keyPosition),Q.keyPosition.RB(Q.referencePosition),Q.keyScaling.divideInPlace(Q.referenceScaling),Q.referenceQuaternion.multiplyToRef(Q.keyQuaternion,Q.keyQuaternion),t.b.ComposeToRef(Q.keyScaling,Q.keyQuaternion,Q.keyPosition,s.value);break;case U.ANIMATIONTYPE_QUATERNION:Q.referenceValue.multiplyToRef(s.value,s.value);break;case U.ANIMATIONTYPE_VECTOR2:case U.ANIMATIONTYPE_VECTOR3:case U.ANIMATIONTYPE_COLOR3:case U.ANIMATIONTYPE_COLOR4:s.value.subtractToRef(Q.referenceValue,s.value);break;case U.ANIMATIONTYPE_SIZE:s.value.width-=Q.referenceValue.width,s.value.height-=Q.referenceValue.height;break;default:s.value-=Q.referenceValue}}return b&&S.setKeys(b,!0),S}static TransitionTo(s,Z,o,t,j,S,a){let O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(a<=0)return o[s]=Z,O&&O(),null;const v=j*(a/1e3);S.setKeys([{frame:0,value:o[s].clone?o[s].clone():o[s]},{frame:v,value:Z}]),o.animations||(o.animations=[]),o.animations.push(S);const G=t.beginAnimation(o,0,v,!1);return G.onAnimationEnd=O,G}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const s of this._runtimeAnimations)if(!s.isStopped())return!0;return!1}constructor(s,Z,o,t,j,S){this.name=s,this.targetProperty=Z,this.framePerSecond=o,this.dataType=t,this.loopMode=j,this.enableBlending=S,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this._coreAnimation=null,this.targetPropertyPath=Z.split("."),this.dataType=t,this.loopMode=void 0===j?U.ANIMATIONLOOPMODE_CYCLE:j,this.uniqueId=U._UniqueIdGenerator++}toString(s){let Z="Name: "+this.name+", property: "+this.targetProperty;if(Z+=", datatype: "+["Float","sO","Quaternion","Matrix","pz","Vector2"][this.dataType],Z+=", nKeys: "+(this._keys?this._keys.length:"none"),Z+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),s){Z+=", Ranges: {";let s=!0;for(const o in this._ranges)s&&(Z+=", ",s=!1),Z+=o;Z+="}"}return Z}addEvent(s){this._events.push(s),this._events.sort(((s,Z)=>s.frame-Z.frame))}removeEvents(s){for(let Z=0;Z<this._events.length;Z++)this._events[Z].frame===s&&(this._events.splice(Z,1),Z--)}getEvents(){return this._events}createRange(s,Z,o){this._ranges[s]||(this._ranges[s]=new O.e(s,Z,o))}deleteRange(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const o=this._ranges[s];if(o){if(Z){const s=o.from,Z=o.to;for(let o=this._keys.length-1;o>=0;o--)this._keys[o].frame>=s&&this._keys[o].frame<=Z&&this._keys.splice(o,1)}this._ranges[s]=null}}getRange(s){return this._ranges[s]}getKeys(){return this._keys}getHighestFrame(){let s=0;for(let Z=0,o=this._keys.length;Z<o;Z++)s<this._keys[Z].frame&&(s=this._keys[Z].frame);return s}getEasingFunction(){return this._easingFunction}setEasingFunction(s){this._easingFunction=s}floatInterpolateFunction(s,Z,o){return(0,S.Lerp)(s,Z,o)}floatInterpolateFunctionWithTangents(s,Z,o,t,j){return(0,S.Hermite)(s,Z,o,t,j)}quaternionInterpolateFunction(s,Z,o){return t.e.Slerp(s,Z,o)}quaternionInterpolateFunctionWithTangents(s,Z,o,j,S){return t.e.Hermite(s,Z,o,j,S).normalize()}vector3InterpolateFunction(s,Z,o){return t.n.Lerp(s,Z,o)}vector3InterpolateFunctionWithTangents(s,Z,o,j,S){return t.n.Hermite(s,Z,o,j,S)}vector2InterpolateFunction(s,Z,o){return t.j.Lerp(s,Z,o)}vector2InterpolateFunctionWithTangents(s,Z,o,j,S){return t.j.Hermite(s,Z,o,j,S)}sizeInterpolateFunction(s,Z,o){return G.b.Lerp(s,Z,o)}color3InterpolateFunction(s,Z,o){return j.d.Lerp(s,Z,o)}color3InterpolateFunctionWithTangents(s,Z,o,t,S){return j.d.Hermite(s,Z,o,t,S)}color4InterpolateFunction(s,Z,o){return j.h.Lerp(s,Z,o)}color4InterpolateFunctionWithTangents(s,Z,o,t,S){return j.h.Hermite(s,Z,o,t,S)}_getKeyValue(s){return"function"===typeof s?s():s}evaluate(s){return d.key=0,this._interpolate(s,d)}_interpolate(s,Z){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Z.loopMode===U.ANIMATIONLOOPMODE_CONSTANT&&Z.repeatCount>0)return Z.highLimitValue.clone?Z.highLimitValue.clone():Z.highLimitValue;const t=this._keys;let j;if(this._coreAnimation)j=this._coreAnimation._key;else{const S=t.length;for(j=Z.key;j>=0&&s<t[j].frame;)--j;for(;j+1<=S-1&&s>=t[j+1].frame;)++j;if(Z.key=j,j<0)return o?void 0:this._getKeyValue(t[0].value);if(j+1>S-1)return o?void 0:this._getKeyValue(t[S-1].value);this._key=j}const S=t[j],a=t[j+1];if(o&&(s===S.frame||s===a.frame))return;const O=this._getKeyValue(S.value),v=this._getKeyValue(a.value);if(1===S.interpolation)return a.frame>s?O:v;const G=void 0!==S.outTangent&&void 0!==a.inTangent,B=a.frame-S.frame;let Q=(s-S.frame)/B;const d=S.easingFunction||this.getEasingFunction();switch(d&&(Q=d.ease(Q)),this.dataType){case U.ANIMATIONTYPE_FLOAT:{const s=G?this.floatInterpolateFunctionWithTangents(O,S.outTangent*B,v,a.inTangent*B,Q):this.floatInterpolateFunction(O,v,Q);switch(Z.loopMode){case U.ANIMATIONLOOPMODE_CYCLE:case U.ANIMATIONLOOPMODE_CONSTANT:case U.ANIMATIONLOOPMODE_YOYO:return s;case U.ANIMATIONLOOPMODE_RELATIVE:case U.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(Z.offsetValue??0)*Z.repeatCount+s}break}case U.ANIMATIONTYPE_QUATERNION:{const s=G?this.quaternionInterpolateFunctionWithTangents(O,S.outTangent.scale(B),v,a.inTangent.scale(B),Q):this.quaternionInterpolateFunction(O,v,Q);switch(Z.loopMode){case U.ANIMATIONLOOPMODE_CYCLE:case U.ANIMATIONLOOPMODE_CONSTANT:case U.ANIMATIONLOOPMODE_YOYO:return s;case U.ANIMATIONLOOPMODE_RELATIVE:case U.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return s.addInPlace((Z.offsetValue||D).scale(Z.repeatCount))}return s}case U.ANIMATIONTYPE_VECTOR3:{const s=G?this.vector3InterpolateFunctionWithTangents(O,S.outTangent.scale(B),v,a.inTangent.scale(B),Q):this.vector3InterpolateFunction(O,v,Q);switch(Z.loopMode){case U.ANIMATIONLOOPMODE_CYCLE:case U.ANIMATIONLOOPMODE_CONSTANT:case U.ANIMATIONLOOPMODE_YOYO:return s;case U.ANIMATIONLOOPMODE_RELATIVE:case U.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return s.add((Z.offsetValue||z).scale(Z.repeatCount))}break}case U.ANIMATIONTYPE_VECTOR2:{const s=G?this.vector2InterpolateFunctionWithTangents(O,S.outTangent.scale(B),v,a.inTangent.scale(B),Q):this.vector2InterpolateFunction(O,v,Q);switch(Z.loopMode){case U.ANIMATIONLOOPMODE_CYCLE:case U.ANIMATIONLOOPMODE_CONSTANT:case U.ANIMATIONLOOPMODE_YOYO:return s;case U.ANIMATIONLOOPMODE_RELATIVE:case U.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return s.add((Z.offsetValue||Y).scale(Z.repeatCount))}break}case U.ANIMATIONTYPE_SIZE:switch(Z.loopMode){case U.ANIMATIONLOOPMODE_CYCLE:case U.ANIMATIONLOOPMODE_CONSTANT:case U.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(O,v,Q);case U.ANIMATIONLOOPMODE_RELATIVE:case U.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(O,v,Q).add((Z.offsetValue||b).scale(Z.repeatCount))}break;case U.ANIMATIONTYPE_COLOR3:{const s=G?this.color3InterpolateFunctionWithTangents(O,S.outTangent.scale(B),v,a.inTangent.scale(B),Q):this.color3InterpolateFunction(O,v,Q);switch(Z.loopMode){case U.ANIMATIONLOOPMODE_CYCLE:case U.ANIMATIONLOOPMODE_CONSTANT:case U.ANIMATIONLOOPMODE_YOYO:return s;case U.ANIMATIONLOOPMODE_RELATIVE:case U.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return s.add((Z.offsetValue||f).scale(Z.repeatCount))}break}case U.ANIMATIONTYPE_COLOR4:{const s=G?this.color4InterpolateFunctionWithTangents(O,S.outTangent.scale(B),v,a.inTangent.scale(B),Q):this.color4InterpolateFunction(O,v,Q);switch(Z.loopMode){case U.ANIMATIONLOOPMODE_CYCLE:case U.ANIMATIONLOOPMODE_CONSTANT:case U.ANIMATIONLOOPMODE_YOYO:return s;case U.ANIMATIONLOOPMODE_RELATIVE:case U.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return s.add((Z.offsetValue||A).scale(Z.repeatCount))}break}case U.ANIMATIONTYPE_MATRIX:switch(Z.loopMode){case U.ANIMATIONLOOPMODE_CYCLE:case U.ANIMATIONLOOPMODE_CONSTANT:case U.ANIMATIONLOOPMODE_YOYO:return U.AllowMatricesInterpolation?this.matrixInterpolateFunction(O,v,Q,Z.workValue):O;case U.ANIMATIONLOOPMODE_RELATIVE:case U.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return O}}return 0}matrixInterpolateFunction(s,Z,o,j){return U.AllowMatrixDecomposeForInterpolation?j?(t.b.DecomposeLerpToRef(s,Z,o,j),j):t.b.DecomposeLerp(s,Z,o):j?(t.b.LerpToRef(s,Z,o,j),j):t.b.Lerp(s,Z,o)}clone(){const s=new U(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(s.enableBlending=this.enableBlending,s.blendingSpeed=this.blendingSpeed,this._keys&&s.setKeys(this._keys),this._ranges){s._ranges={};for(const Z in this._ranges){const o=this._ranges[Z];o&&(s._ranges[Z]=o.clone())}}return s}setKeys(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=Z?s:s.slice(0)}createKeyForFrame(s){d.key=0;const Z=this._interpolate(s,d,!0);if(!Z)return this._keys[d.key].frame===s?d.key:d.key+1;const o={frame:s,value:Z.clone?Z.clone():Z};return this._keys.splice(d.key+1,0,o),d.key+1}serialize(){const s={};s.name=this.name,s.property=this.targetProperty,s.framePerSecond=this.framePerSecond,s.dataType=this.dataType,s.loopBehavior=this.loopMode,s.enableBlending=this.enableBlending,s.blendingSpeed=this.blendingSpeed;const Z=this.dataType;s.keys=[];const o=this.getKeys();for(let t=0;t<o.length;t++){const j=o[t],S={};switch(S.frame=j.frame,Z){case U.ANIMATIONTYPE_FLOAT:S.values=[j.value],void 0!==j.inTangent&&S.values.push(j.inTangent),void 0!==j.outTangent&&(void 0===j.inTangent&&S.values.push(void 0),S.values.push(j.outTangent)),void 0!==j.interpolation&&(void 0===j.inTangent&&S.values.push(void 0),void 0===j.outTangent&&S.values.push(void 0),S.values.push(j.interpolation));break;case U.ANIMATIONTYPE_QUATERNION:case U.ANIMATIONTYPE_MATRIX:case U.ANIMATIONTYPE_VECTOR3:case U.ANIMATIONTYPE_COLOR3:case U.ANIMATIONTYPE_COLOR4:S.values=j.value.ma(),void 0!=j.inTangent&&S.values.push(j.inTangent.ma()),void 0!=j.outTangent&&(void 0===j.inTangent&&S.values.push(void 0),S.values.push(j.outTangent.ma())),void 0!==j.interpolation&&(void 0===j.inTangent&&S.values.push(void 0),void 0===j.outTangent&&S.values.push(void 0),S.values.push(j.interpolation))}s.keys.push(S)}s.ranges=[];for(const t in this._ranges){const Z=this._ranges[t];if(!Z)continue;const o={};o.name=t,o.from=Z.from,o.to=Z.to,s.ranges.push(o)}return s}static _UniversalLerp(s,Z,o){const t=s.constructor;return t.Lerp?t.Lerp(s,Z,o):t.Slerp?t.Slerp(s,Z,o):s.toFixed?s*(1-o)+o*Z:Z}static Parse(s){const Z=new U(s.name,s.property,s.framePerSecond,s.dataType,s.loopBehavior),o=s.dataType,S=[];let a,O;for(s.enableBlending&&(Z.enableBlending=s.enableBlending),s.blendingSpeed&&(Z.blendingSpeed=s.blendingSpeed),O=0;O<s.keys.length;O++){const Z=s.keys[O];let v,G,B;switch(o){case U.ANIMATIONTYPE_FLOAT:a=Z.values[0],Z.values.length>=2&&(v=Z.values[1]),Z.values.length>=3&&(G=Z.values[2]),Z.values.length>=4&&(B=Z.values[3]);break;case U.ANIMATIONTYPE_QUATERNION:if(a=t.e.oO(Z.values),Z.values.length>=8){const s=t.e.oO(Z.values.slice(4,8));s.equals(t.e.Zero())||(v=s)}if(Z.values.length>=12){const s=t.e.oO(Z.values.slice(8,12));s.equals(t.e.Zero())||(G=s)}Z.values.length>=13&&(B=Z.values[12]);break;case U.ANIMATIONTYPE_MATRIX:a=t.b.oO(Z.values),Z.values.length>=17&&(B=Z.values[16]);break;case U.ANIMATIONTYPE_COLOR3:a=j.d.oO(Z.values),Z.values[3]&&(v=j.d.oO(Z.values[3])),Z.values[4]&&(G=j.d.oO(Z.values[4])),Z.values[5]&&(B=Z.values[5]);break;case U.ANIMATIONTYPE_COLOR4:a=j.h.oO(Z.values),Z.values[4]&&(v=j.h.oO(Z.values[4])),Z.values[5]&&(G=j.h.oO(Z.values[5])),Z.values[6]&&(B=j.h.oO(Z.values[6]));break;case U.ANIMATIONTYPE_VECTOR3:default:a=t.n.oO(Z.values),Z.values[3]&&(v=t.n.oO(Z.values[3])),Z.values[4]&&(G=t.n.oO(Z.values[4])),Z.values[5]&&(B=Z.values[5])}const Q={};Q.frame=Z.frame,Q.value=a,void 0!=v&&(Q.inTangent=v),void 0!=G&&(Q.outTangent=G),void 0!=B&&(Q.interpolation=B),S.push(Q)}if(Z.setKeys(S),s.ranges)for(O=0;O<s.ranges.length;O++)a=s.ranges[O],Z.createRange(a.name,a.from,a.to);return Z}static AppendSerializedAnimations(s,Z){Q.c.AppendSerializedAnimations(s,Z)}static async ParseFromFileAsync(s,Z){return await new Promise(((o,t)=>{const j=new B.c;j.addEventListener("readystatechange",(()=>{if(4==j.readyState)if(200==j.status){let Z=JSON.parse(j.responseText);if(Z.animations&&(Z=Z.animations),Z.length){const s=[];for(const o of Z)s.push(this.Parse(o));o(s)}else{const t=this.Parse(Z);s&&(t.name=s),o(t)}}else t("Unable to load the animation")})),j.open("GET",Z),j.send()}))}static async ParseFromSnippetAsync(s){return await new Promise(((Z,o)=>{const t=new B.c;t.addEventListener("readystatechange",(()=>{if(4==t.readyState)if(200==t.status){const o=JSON.parse(JSON.parse(t.responseText).jsonPayload);if(o.animations){const t=JSON.parse(o.animations),j=[];for(const Z of t.animations){const o=this.Parse(Z);o.snippetId=s,j.push(o)}Z(j)}else{const t=JSON.parse(o.animation),j=this.Parse(t);j.snippetId=s,Z(j)}}else o("Unable to load the snippet "+s)})),t.open("GET",this.SnippetUrl+"/"+s.replace(/#/g,"/")),t.send()}))}}U._UniqueIdGenerator=0,U.AllowMatricesInterpolation=!1,U.AllowMatrixDecomposeForInterpolation=!0,U.SnippetUrl="https://snippet.babylonjs.com",U.ANIMATIONTYPE_FLOAT=0,U.ANIMATIONTYPE_VECTOR3=1,U.ANIMATIONTYPE_QUATERNION=2,U.ANIMATIONTYPE_MATRIX=3,U.ANIMATIONTYPE_COLOR3=4,U.ANIMATIONTYPE_COLOR4=7,U.ANIMATIONTYPE_VECTOR2=5,U.ANIMATIONTYPE_SIZE=6,U.ANIMATIONLOOPMODE_RELATIVE=0,U.ANIMATIONLOOPMODE_CYCLE=1,U.ANIMATIONLOOPMODE_CONSTANT=2,U.ANIMATIONLOOPMODE_YOYO=4,U.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,U.CreateFromSnippetAsync=U.ParseFromSnippetAsync,(0,a.f)("BABYLON.Animation",U),v.d._AnimationRangeFactory=(s,Z,o)=>new O.e(s,Z,o)},11614:(s,Z,o)=>{o.d(Z,{e:()=>t});class t{constructor(s,Z,o){this.name=s,this.from=Z,this.to=o}clone(){return new t(this.name,this.from,this.to)}}},11113:(s,Z,o)=>{o.d(Z,{c:()=>a,e:()=>O});var t=o(11115),j=o(10955),S=o(11122);class a{get B(){return this._isDisposed}constructor(s,Z,o){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,S=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],O=arguments.length>6&&void 0!==arguments[6]&&arguments[6],v=arguments.length>7?arguments[7]:void 0,G=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,s&&s.Ls?this._engine=s.Ls().getEngine():this._engine=s,this._updatable=o,this._instanced=a,this._divisor=v||1,this._label=G,Z instanceof t.b?(this._data=null,this._buffer=Z):(this._data=Z,this._buffer=null),this.byteStride=O?j:j*Float32Array.BYTES_PER_ELEMENT,S||this.create()}createVertexBuffer(s,Z,o,t,j){let S=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6?arguments[6]:void 0;const v=S?Z:Z*Float32Array.BYTES_PER_ELEMENT,G=t?S?t:t*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new O(this._engine,this,s,this._updatable,!0,G,void 0===j?this._instanced:j,v,o,void 0,void 0,!0,this._divisor||a)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!s&&this._buffer||(s=s||this._data,s&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,s),this._data=s):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(s,this._label),this._data=s):this._buffer=this._engine.createVertexBuffer(s,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.eZ>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.eZ,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.eZ,void 0,this._label));j.b.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(s){this.create(s)}updateDirectly(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,s,t?Z:Z*Float32Array.BYTES_PER_ELEMENT,o?o*this.byteStride:void 0),this._data=0===Z&&void 0===o?s:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class O{get B(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(s){const Z=0!=s;this._instanceDivisor=s,Z!==this._instanced&&(this._instanced=Z,this._computeHashCode())}get _maxVerticesCount(){const s=this.getData();return s?Array.isArray(s)?s.length/(this.byteStride/4)-this.byteOffset/4:(s.byteLength-this.byteOffset)/this.byteStride:0}constructor(s,Z,o,t,j,v,G,B,Q,D){let z=arguments.length>10&&void 0!==arguments[10]&&arguments[10],Y=arguments.length>11&&void 0!==arguments[11]&&arguments[11],b=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,f=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let A=!1;if(this.wa=s,"object"===typeof t&&null!==t?(A=t.updatable??!1,j=t.postponeInternalCreation,v=t.stride,G=t.instanced,B=t.offset,Q=t.size,D=t.type,z=t.normalized??!1,Y=t.useBytes??!1,b=t.divisor??1,f=t.takeBufferOwnership??!1,this._label=t.label):A=!!t,Z instanceof a?(this._buffer=Z,this._ownsBuffer=f):(this._buffer=new a(s,Z,A,v,j,G,Y,b,this._label),this._ownsBuffer=!0),this.uniqueId=O._Counter++,this._kind=o,void 0===D){const s=this.getData();this.type=s?O.GetDataType(s):O.FLOAT}else this.type=D;const d=(0,S.o)(this.type);Y?(this._size=Q||(v?v/d:O.DeduceStride(o)),this.byteStride=v||this._buffer.byteStride||this._size*d,this.byteOffset=B||0):(this._size=Q||v||O.DeduceStride(o),this.byteStride=v?v*d:this._buffer.byteStride||this._size*d,this.byteOffset=(B||0)*d),this.normalized=z,this._instanced=void 0!==G&&G,this._instanceDivisor=G?b:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var s;null===(s=this._buffer)||void 0===s||s._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(s,Z){const o=this.getData();return o?(0,S.l)(o,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,s,Z):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,S.o)(this.type)}getOffset(){return this.byteOffset/(0,S.o)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,S.o)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(s){this._buffer.create(s),this._alignBuffer()}update(s){this._buffer.update(s),this._alignBuffer()}updateDirectly(s,Z){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(s,Z,void 0,o),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(s,Z){(0,S.j)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,s,this.normalized,((s,o)=>{for(let t=0;t<this._size;t++)Z(s[t],o+t)}))}_alignBuffer(){}static DeduceStride(s){switch(s){case O.UVKind:case O.UV2Kind:case O.UV3Kind:case O.UV4Kind:case O.UV5Kind:case O.UV6Kind:return 2;case O.NormalKind:case O.PositionKind:return 3;case O.ColorKind:case O.ColorInstanceKind:case O.MatricesIndicesKind:case O.MatricesIndicesExtraKind:case O.MatricesWeightsKind:case O.MatricesWeightsExtraKind:case O.TangentKind:return 4;default:throw new Error("Invalid kind '"+s+"'")}}static GetDataType(s){return s instanceof Int8Array?O.BYTE:s instanceof Uint8Array?O.UNSIGNED_BYTE:s instanceof Int16Array?O.SHORT:s instanceof Uint16Array?O.UNSIGNED_SHORT:s instanceof Int32Array?O.INT:s instanceof Uint32Array?O.UNSIGNED_INT:O.FLOAT}static GetTypeByteLength(s){return(0,S.o)(s)}static ForEach(s,Z,o,t,j,a,O,v){(0,S.j)(s,Z,o,t,j,a,O,((s,Z)=>{for(let o=0;o<t;o++)v(s[o],Z+o)}))}static GetFloatData(s,Z,o,t,j,a,O,v){return(0,S.l)(s,Z,o,t,j,a,O,v)}}O._Counter=0,O.BYTE=5120,O.UNSIGNED_BYTE=5121,O.SHORT=5122,O.UNSIGNED_SHORT=5123,O.INT=5124,O.UNSIGNED_INT=5125,O.FLOAT=5126,O.PositionKind="position",O.NormalKind="normal",O.TangentKind="tangent",O.UVKind="uv",O.UV2Kind="uv2",O.UV3Kind="uv3",O.UV4Kind="uv4",O.UV5Kind="uv5",O.UV6Kind="uv6",O.ColorKind="color",O.ColorInstanceKind="instanceColor",O.MatricesIndicesKind="matricesIndices",O.MatricesWeightsKind="matricesWeights",O.MatricesIndicesExtraKind="matricesIndicesExtra",O.MatricesWeightsExtraKind="matricesWeightsExtra"},11122:(s,Z,o)=>{o.d(Z,{e:()=>D,h:()=>Q,j:()=>v,l:()=>G,o:()=>a,q:()=>O,u:()=>B});var t=o(10955);function j(s,Z,o,t){switch(Z){case 5120:{let Z=s.getInt8(o);return t&&(Z=Math.max(Z/127,-1)),Z}case 5121:{let Z=s.getUint8(o);return t&&(Z/=255),Z}case 5122:{let Z=s.getInt16(o,!0);return t&&(Z=Math.max(Z/32767,-1)),Z}case 5123:{let Z=s.getUint16(o,!0);return t&&(Z/=65535),Z}case 5124:return s.getInt32(o,!0);case 5125:return s.getUint32(o,!0);case 5126:return s.getFloat32(o,!0);default:throw new Error(`Invalid component type ${Z}`)}}function S(s,Z,o,t,j){switch(Z){case 5120:t&&(j=Math.round(127*j)),s.setInt8(o,j);break;case 5121:t&&(j=Math.round(255*j)),s.setUint8(o,j);break;case 5122:t&&(j=Math.round(32767*j)),s.setInt16(o,j,!0);break;case 5123:t&&(j=Math.round(65535*j)),s.setUint16(o,j,!0);break;case 5124:s.setInt32(o,j,!0);break;case 5125:s.setUint32(o,j,!0);break;case 5126:s.setFloat32(o,j,!0);break;default:throw new Error(`Invalid component type ${Z}`)}}function a(s){switch(s){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${s}'`)}}function O(s){switch(s){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${s}'`)}}function v(s,Z,o,t,O,v,G,B){const Q=new Array(t),D=new Array(t);if(s instanceof Array){let j=Z/4;const S=o/4;for(let Z=0;Z<v;Z+=t){for(let Z=0;Z<t;Z++)Q[Z]=D[Z]=s[j+Z];B(D,Z);for(let Z=0;Z<t;Z++)Q[Z]!==D[Z]&&(s[j+Z]=D[Z]);j+=S}}else{const z=ArrayBuffer.isView(s)?new DataView(s.buffer,s.byteOffset,s.byteLength):new DataView(s),Y=a(O);for(let s=0;s<v;s+=t){for(let s=0,o=Z;s<t;s++,o+=Y)Q[s]=D[s]=j(z,O,o,G);B(D,s);for(let s=0,o=Z;s<t;s++,o+=Y)Q[s]!==D[s]&&S(z,O,o,G,D[s]);Z+=o}}}function G(s,Z,o,j,S,O,G,B){const Q=Z*a(o),D=G*Z;if(5126!==o||S!==Q){const t=new Float32Array(D);return v(s,j,S,Z,o,D,O,((s,o)=>{for(let j=0;j<Z;j++)t[o+j]=s[j]})),t}if(!(s instanceof Array||s instanceof Float32Array)||0!==j||s.length!==D){if(s instanceof Array){const Z=j/4;return s.slice(Z,Z+D)}if(s instanceof ArrayBuffer)return new Float32Array(s,j,D);{const Z=s.byteOffset+j;return 0!==(3&Z)&&(t.b.Warn("Float array must be aligned to 4-bytes border"),B=!0),B?new Float32Array(s.buffer.slice(Z,Z+D*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(s.buffer,Z,D)}}return B?s.slice():s}function B(s,Z,o,j,S,G,B,Q){const D=a(o),z=O(o),Y=B*Z;if(Array.isArray(s)){if(0!==(3&j)||0!==(3&S))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const t=j/4,a=S/4;if(t+(B-1)*a+Z>s.length)throw new Error("Last accessed index is out of bounds.");if(a<Z)throw new Error("Data stride cannot be smaller than the component size.");if(a!==Z){const t=new z(Y);return v(s,j,S,Z,o,Y,G,((s,o)=>{for(let j=0;j<Z;j++)t[o+j]=s[j]})),t}return new z(s.slice(t,t+Y))}let b,f=j;s instanceof ArrayBuffer?b=s:(b=s.buffer,f+=s.byteOffset);if(f+(B-1)*S+Z*D>b.byteLength)throw new Error("Last accessed byte is out of bounds.");const A=Z*D;if(S<A)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(S!==A){const s=new z(Y);return v(b,f,S,Z,o,Y,G,((o,t)=>{for(let j=0;j<Z;j++)s[t+j]=o[j]})),s}return 1!==D&&0!==(f&D-1)&&(t.b.Warn("Array must be aligned to border of element size. Data will be copied."),Q=!0),Q?new z(b.slice(f,f+Y*D)):new z(b,f,Y)}function Q(s,Z,o,j,S,O,G,B){const Q=Z*a(o),D=G*Z;if(B.length!==D)throw new Error("Output length is not valid");if(5126===o&&S===Q)if(s instanceof Array){const Z=j/4;B.set(s,Z)}else if(s instanceof ArrayBuffer){const Z=new Float32Array(s,j,D);B.set(Z)}else{const Z=s.byteOffset+j;if(0!==(3&Z))return t.b.Warn("Float array must be aligned to 4-bytes border"),void B.set(new Float32Array(s.buffer.slice(Z,Z+D*Float32Array.BYTES_PER_ELEMENT)));const o=new Float32Array(s.buffer,Z,D);B.set(o)}else v(s,j,S,Z,o,D,O,((s,o)=>{for(let t=0;t<Z;t++)B[o+t]=s[t]}))}function D(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(s)){for(let j=0;j<Z;j++)if(s[o+j]-t>65535)return!0;return!1}return 4===s.BYTES_PER_ELEMENT}},11115:(s,Z,o)=>{o.d(Z,{b:()=>t});class t{get underlyingResource(){return null}constructor(){this.references=0,this.eZ=0,this.is32Bits=!1,this.uniqueId=t._Counter++}}t._Counter=0},11246:(s,Z,o)=>{o.d(Z,{e:()=>f});var t=o(11086),j=o(11091),S=o(11253),a=o(10938),O=o(10932),v=o(10900),G=o(11201),B=o(10955),Q=o(10916),D=o(10975),z=o(11262),Y=o(11267),b=o(11167);class f extends G.d{get position(){return this._position}set position(s){this._position=s}set upVector(s){this._upVector=s}get upVector(){return this._upVector}get screenArea(){let s=0,Z=0;if(this.mode===f.PERSPECTIVE_CAMERA)this.fovMode===f.FOVMODE_VERTICAL_FIXED?(Z=2*this.OO*Math.tan(this.fov/2),s=this.getEngine().getAspectRatio(this)*Z):(s=2*this.OO*Math.tan(this.fov/2),Z=s/this.getEngine().getAspectRatio(this));else{const o=this.getEngine().getRenderWidth()/2,t=this.getEngine().getRenderHeight()/2;s=(this.orthoRight??o)-(this.orthoLeft??-o),Z=(this.orthoTop??t)-(this.orthoBottom??-t)}return s*Z}set orthoLeft(s){this._orthoLeft=s;for(const Z of this._rigCameras)Z.orthoLeft=s}get orthoLeft(){return this._orthoLeft}set orthoRight(s){this._orthoRight=s;for(const Z of this._rigCameras)Z.orthoRight=s}get orthoRight(){return this._orthoRight}set orthoBottom(s){this._orthoBottom=s;for(const Z of this._rigCameras)Z.orthoBottom=s}get orthoBottom(){return this._orthoBottom}set orthoTop(s){this._orthoTop=s;for(const Z of this._rigCameras)Z.orthoTop=s}get orthoTop(){return this._orthoTop}setFocalLength(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:36;this.fov=2*Math.atan(Z/(2*s))}set mode(s){this._mode=s;for(const Z of this._rigCameras)Z.mode=s}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(s,Z,o){let t=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(s,o,!1),this._position=v.n.Zero(),this._upVector=v.n.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.OO=1,this.maxZ=1e4,this.inertia=.9,this._mode=f.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new z.b(0,0,1,1),this.layerMask=268435455,this.fovMode=f.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=f.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new O.b,this.onProjectionMatrixChangedObservable=new O.b,this.onAfterCheckInputsObservable=new O.b,this.onRestoreStateObservable=new O.b,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new v.b,this._postProcesses=new Array,this._activeMeshes=new S.f(256),this._globalPosition=v.n.Zero(),this._computedViewMatrix=v.b.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=v.b.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=v.e.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.Ls().addCamera(this),t&&!this.Ls().activeCamera&&(this.Ls().activeCamera=this),this.position=Z,this.renderPassId=this.Ls().getEngine().createRenderPassId(`Camera ${s}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"IG"}toString(s){let Z="Name: "+this.name;if(Z+=", type: "+this.getClassName(),this.animations)for(let o=0;o<this.animations.length;o++)Z+=", animation[0]: "+this.animations[o].toString(s);return Z}applyVerticalCorrection(){const s=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-s.x:s.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(s){return-1!==this._activeMeshes.indexOf(s)}isReady(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(s)for(const Z of this._postProcesses)if(Z&&!Z.isReady())return!1;return super.isReady(s)}_initCache(){super._initCache(),this._cache.position=new v.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new v.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.OO=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(s){s||super._updateCache(),this._cache.position.O(this.position),this._cache.upVector.O(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let s=this._cache.mode===this.mode&&this._cache.OO===this.OO&&this._cache.maxZ===this.maxZ;if(!s)return!1;const Z=this.getEngine();return this.mode===f.PERSPECTIVE_CAMERA?s=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===Z.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(s=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===Z.getRenderWidth()&&this._cache.renderHeight===Z.getRenderHeight(),this.oblique&&(s=s&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),s}attachControl(s,Z){}SQ(s){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==f.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let s=0;s<this._postProcesses.length;s++)if(null!==this._postProcesses[s])return this._postProcesses[s];return null}_cascadePostProcessesToRigCams(){const s=this._getFirstPostProcess();s&&s.markTextureDirty();for(let Z=0,o=this._rigCameras.length;Z<o;Z++){const s=this._rigCameras[Z],o=s._rigPostProcess;if(o){"pass"===o.getEffectName()&&(s.isIntermediate=0===this._postProcesses.length),s._postProcesses=this._postProcesses.slice(0).concat(o),o.markTextureDirty()}else s._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!s.isReusable()&&this._postProcesses.indexOf(s)>-1?(B.b.Error("You're trying to reuse a post process not defined as reusable."),0):(null==Z||Z<0?this._postProcesses.push(s):null===this._postProcesses[Z]?this._postProcesses[Z]=s:this._postProcesses.splice(Z,0,s),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.dG(),this._postProcesses.indexOf(s))}detachPostProcess(s){const Z=this._postProcesses.indexOf(s);-1!==Z&&(this._postProcesses[Z]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.dG(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return v.b.Identity()}getViewMatrix(s){return!s&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.Ls().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(s){this._doNotComputeProjectionMatrix=!0,void 0!==s&&(this._projectionMatrix=s)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(s){if(this._doNotComputeProjectionMatrix||!s&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.OO=this.OO,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const Z=this.getEngine(),o=this.Ls(),t=Z.useReverseDepthBuffer;if(this.mode===f.PERSPECTIVE_CAMERA){let s;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=Z.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.OO<=0&&(this.OO=.1),s=o.useRightHandedSystem?v.b.PerspectiveFovRHToRef:v.b.PerspectiveFovLHToRef,s(this.fov,Z.getAspectRatio(this),t?this.maxZ:this.OO,t?this.OO:this.maxZ,this._projectionMatrix,this.fovMode===f.FOVMODE_VERTICAL_FIXED,Z.isNDCHalfZRange,this.projectionPlaneTilt,t)}else{var j,S,a;const s=Z.getRenderWidth()/2,O=Z.getRenderHeight()/2;o.useRightHandedSystem?this.oblique?v.b.ObliqueOffCenterRHToRef(this.orthoLeft??-s,this.orthoRight??s,this.orthoBottom??-O,this.orthoTop??O,t?this.maxZ:this.OO,t?this.OO:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,Z.isNDCHalfZRange):v.b.OrthoOffCenterRHToRef(this.orthoLeft??-s,this.orthoRight??s,this.orthoBottom??-O,this.orthoTop??O,t?this.maxZ:this.OO,t?this.OO:this.maxZ,this._projectionMatrix,Z.isNDCHalfZRange):this.oblique?v.b.ObliqueOffCenterLHToRef(this.orthoLeft??-s,this.orthoRight??s,this.orthoBottom??-O,this.orthoTop??O,t?this.maxZ:this.OO,t?this.OO:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,Z.isNDCHalfZRange):v.b.OrthoOffCenterLHToRef(this.orthoLeft??-s,this.orthoRight??s,this.orthoBottom??-O,this.orthoTop??O,t?this.maxZ:this.OO,t?this.OO:this.maxZ,this._projectionMatrix,Z.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(j=this.oblique)||void 0===j?void 0:j.angle,this._cache.obliqueLength=null===(S=this.oblique)||void 0===S?void 0:S.length,this._cache.obliqueOffset=null===(a=this.oblique)||void 0===a?void 0:a.offset,this._cache.renderWidth=Z.getRenderWidth(),this._cache.renderHeight=Z.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(s){return(this.radius||(this.target?v.n.Distance(this.position,this.target):this.position.length()))+s}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?Y.c.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=Y.c.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),Z&&this.rigCameras.length>0){let Z=!1;for(const o of this.rigCameras)o._updateFrustumPlanes(),Z=Z||s.isInFrustum(o._frustumPlanes);return Z}return s.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(s){return this._updateFrustumPlanes(),s.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,D.d)("Ray")}getForwardRayToRef(s){throw(0,D.d)("Ray")}dispose(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.Ls().stopAnimation(this),this.Ls().removeCamera(this);this._rigCameras.length>0;){const s=this._rigCameras.pop();s&&s.dispose()}if(this._parentContainer){const s=this._parentContainer.cameras.indexOf(this);s>-1&&this._parentContainer.cameras.splice(s,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==f.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let s=this._postProcesses.length;for(;--s>=0;){const Z=this._postProcesses[s];Z&&Z.dispose(this)}}let o=this.customRenderTargets.length;for(;--o>=0;)this.customRenderTargets[o].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.Ls().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(s,Z)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(s,Z){if(this.cameraRigMode!==s){for(;this._rigCameras.length>0;){const s=this._rigCameras.pop();s&&s.dispose()}if(this.cameraRigMode=s,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=Z.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=a.g.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==f.RIG_MODE_NONE){const s=this.createRigCamera(this.name+"_L",0);s&&(s._isLeftCamera=!0);const Z=this.createRigCamera(this.name+"_R",1);Z&&(Z._isRightCamera=!0),s&&Z&&(this._rigCameras.push(s),this._rigCameras.push(Z))}this._setRigMode(Z),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(s){}_getVRProjectionMatrix(){return v.b.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.OO,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(s,Z){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[s]=Z,"interaxialDistance"===s&&(this._cameraRigParams.stereoHalfAngle=a.g.ToRadians(Z/.0637))}createRigCamera(s,Z){return null}_updateRigCameras(){for(let s=0;s<this._rigCameras.length;s++)this._rigCameras[s].OO=this.OO,this._rigCameras[s].maxZ=this.maxZ,this._rigCameras[s].fov=this.fov,this._rigCameras[s].upVector.O(this.upVector);this.cameraRigMode===f.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const s=b.c.Serialize(this);return s.uniqueId=this.uniqueId,s.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(s),this.inputs&&this.inputs.serialize(s),b.c.AppendSerializedAnimations(this,s),s.ranges=this.serializeAnimationRanges(),s.isEnabled=this.isEnabled(),s}clone(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=b.c.Clone(f.GetConstructorFromName(this.getClassName(),s,this.Ls(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return o.name=s,o.parent=Z,this.onClonedObservable.notifyObservers(o),o}Bv(s){const Z=v.n.Zero();return this.getDirectionToRef(s,Z),Z}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(s,Z){v.n.TransformNormalToRef(s,this.getWorldMatrix(),Z)}static GetConstructorFromName(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,j=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const S=G.d.Construct(s,Z,o,{interaxial_distance:t,isStereoscopicSideBySide:j});return S||(()=>f._CreateDefaultParsedCamera(Z,o))}Ea(){return this.getWorldMatrix()}static Parse(s,Z){const o=s.type,t=f.GetConstructorFromName(o,s.name,Z,s.interaxial_distance,s.isStereoscopicSideBySide),j=b.c.Parse(t,s,Z);if(void 0!==s.parentId&&(j._waitingParentId=s.parentId),void 0!==s.parentInstanceIndex&&(j._waitingParentInstanceIndex=s.parentInstanceIndex),j.inputs&&(j.inputs.parse(s),j._setupInputs()),s.upVector&&(j.upVector=v.n.oO(s.upVector)),j.setPosition&&(j.position.Ja(0,0,0),j.setPosition(v.n.oO(s.position))),s.target&&j.setTarget&&j.setTarget(v.n.oO(s.target)),s.cameraRigMode){const Z=s.interaxial_distance?{interaxialDistance:s.interaxial_distance}:{};j.setCameraRigMode(s.cameraRigMode,Z)}if(s.animations){for(let Z=0;Z<s.animations.length;Z++){const o=s.animations[Z],t=(0,Q.e)("BABYLON.Animation");t&&j.animations.push(t.Parse(o))}G.d.ParseAnimationRanges(j,s,Z)}return s.autoAnimate&&Z.beginAnimation(j,s.autoAnimateFrom,s.autoAnimateTo,s.autoAnimateLoop,s.autoAnimateSpeed||1),void 0!==s.isEnabled&&j.iO(s.isEnabled),j}_calculateHandednessMultiplier(){let s=this.Ls().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(s*=-1),s}}f._CreateDefaultParsedCamera=(s,Z)=>{throw(0,D.d)("UniversalCamera")},f.PERSPECTIVE_CAMERA=0,f.ORTHOGRAPHIC_CAMERA=1,f.FOVMODE_VERTICAL_FIXED=0,f.FOVMODE_HORIZONTAL_FIXED=1,f.RIG_MODE_NONE=0,f.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,f.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,f.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,f.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,f.RIG_MODE_STEREOSCOPIC_INTERLACED=14,f.RIG_MODE_VR=20,f.RIG_MODE_CUSTOM=22,f.ForceAttachControlToAlwaysPreventDefault=!1,(0,t.c)([(0,j.G)("position")],f.prototype,"_position",void 0),(0,t.c)([(0,j.G)("upVector")],f.prototype,"_upVector",void 0),(0,t.c)([(0,j.K)()],f.prototype,"orthoLeft",null),(0,t.c)([(0,j.K)()],f.prototype,"orthoRight",null),(0,t.c)([(0,j.K)()],f.prototype,"orthoBottom",null),(0,t.c)([(0,j.K)()],f.prototype,"orthoTop",null),(0,t.c)([(0,j.K)()],f.prototype,"fov",void 0),(0,t.c)([(0,j.K)()],f.prototype,"projectionPlaneTilt",void 0),(0,t.c)([(0,j.K)()],f.prototype,"OO",void 0),(0,t.c)([(0,j.K)()],f.prototype,"maxZ",void 0),(0,t.c)([(0,j.K)()],f.prototype,"inertia",void 0),(0,t.c)([(0,j.K)()],f.prototype,"mode",null),(0,t.c)([(0,j.K)()],f.prototype,"layerMask",void 0),(0,t.c)([(0,j.K)()],f.prototype,"fovMode",void 0),(0,t.c)([(0,j.K)()],f.prototype,"cameraRigMode",void 0),(0,t.c)([(0,j.K)()],f.prototype,"interaxialDistance",void 0),(0,t.c)([(0,j.K)()],f.prototype,"isStereoscopicSideBySide",void 0)},11468:(s,Z,o)=>{o.d(Z,{b:()=>Q});var t=o(11086),j=o(11091),S=o(11246),a=o(10900),O=o(10904),v=o(11229);o(11201).d.AddNodeConstructor("TargetCamera",((s,Z)=>()=>new Q(s,a.n.Zero(),Z)));const G=a.b.Zero(),B=a.e.Identity();class Q extends S.e{constructor(s,Z,o){super(s,Z,o,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this.cameraDirection=new a.n(0,0,0),this.cameraRotation=new a.j(0,0),this.updateUpVectorFromRotation=!1,this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=a.n.Zero(),this._initialFocalDistance=1,this._viewMatrix=a.b.Zero(),this._cameraTransformMatrix=a.b.Zero(),this._cameraRotationMatrix=a.b.Zero(),this._transformedReferencePoint=a.n.Zero(),this._deferredPositionUpdate=new a.n,this._deferredRotationQuaternionUpdate=new a.e,this._deferredRotationUpdate=new a.n,this._deferredUpdated=!1,this._deferOnly=!1,this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0,this._referencePoint=a.n.Forward(this.Ls().useRightHandedSystem),this.rotation=new a.n(0,this.Ls().useRightHandedSystem?Math.PI:0,0)}getFrontPosition(s){this.getWorldMatrix();const Z=a.g.sO[0],o=a.g.sO[1];return o.set(0,0,this._scene.useRightHandedSystem?-1:1),this.getDirectionToRef(o,Z),Z.scaleInPlace(s),this.globalPosition.add(Z)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const s=this.lockedTarget;s.Ea().getTranslationToRef(s.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.Ja(0,0,0),this.cameraRotation.Ja(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new a.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new a.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new a.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(s){s||super._updateCache();const Z=this._getLockedTargetPosition();Z?this._cache.lockedTarget?this._cache.lockedTarget.O(Z):this._cache.lockedTarget=Z.clone():this._cache.lockedTarget=null,this._cache.rotation.O(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.O(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const s=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(s):!s)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const s=this.getEngine();return this.speed*Math.sqrt(s.getDeltaTime()/(100*s.getFps()))}setTarget(s){this.upVector.normalize(),this._initialFocalDistance=s.Go(this.position).length(),this.position.z===s.z&&(this.position.z+=O.b),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),this.Ls().useRightHandedSystem?a.b.LookAtRHToRef(this.position,s,a.n.UpReadOnly,G):a.b.LookAtLHToRef(this.position,s,a.n.UpReadOnly,G),G.invert();const Z=this.rotationQuaternion||B;a.e.FromRotationMatrixToRef(G,Z),Z.toEulerAnglesToRef(this.rotation),this.rotation.z=0}get target(){return this.getTarget()}set target(s){this.setTarget(s)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(a.g.Matrix[0]),a.n.TransformNormalToRef(this.cameraDirection,a.g.Matrix[0],a.g.sO[0]),this._deferredPositionUpdate.addInPlace(a.g.sO[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.O(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.O(this._deferredPositionUpdate)}_checkInputs(){const s=this.invertRotation?-this.inverseRotationSpeed:1,Z=this._decideIfNeedsToMove(),o=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.O(this.rotation),this._deferredPositionUpdate.O(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.O(this.rotationQuaternion),Z&&this._updatePosition(),o){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*s,this._deferredRotationUpdate.y+=this.cameraRotation.y*s,!this.noRotationConstraint){const s=1.570796;this._deferredRotationUpdate.x>s&&(this._deferredRotationUpdate.x=s),this._deferredRotationUpdate.x<-s&&(this._deferredRotationUpdate.x=-s)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.O(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(a.e.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.O(this._deferredRotationQuaternionUpdate))}}Z&&(Math.abs(this.cameraDirection.x)<this.speed*O.b&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*O.b&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*O.b&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),o&&(Math.abs(this.cameraRotation.x)<this.speed*O.b&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*O.b&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):a.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return a.n.TransformNormalToRef(a.n.UpReadOnly,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),a.n.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?v.c.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(a.e.FromEulerVectorToRef(this.rotation,B),v.c.Y.rotateByQuaternionToRef(B,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(s,Z,o){if(this.Ls().useRightHandedSystem?a.b.LookAtRHToRef(s,Z,o,this._viewMatrix):a.b.LookAtLHToRef(s,Z,o,this._viewMatrix),this.parent){const s=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(s,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.O(s)}createRigCamera(s,Z){if(this.cameraRigMode!==S.e.RIG_MODE_NONE){const Z=new Q(s,this.position.clone(),this.Ls());return Z.isRigCamera=!0,Z.rigParent=this,this.cameraRigMode===S.e.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new a.e),Z._cameraRigParams={},Z.rotationQuaternion=new a.e),Z.mode=this.mode,Z.orthoLeft=this.orthoLeft,Z.orthoRight=this.orthoRight,Z.orthoTop=this.orthoTop,Z.orthoBottom=this.orthoBottom,Z}return null}_updateRigCameras(){const s=this._rigCameras[0],Z=this._rigCameras[1];switch(this.Ea(),this.cameraRigMode){case S.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case S.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case S.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case S.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case S.e.RIG_MODE_STEREOSCOPIC_INTERLACED:{const o=this.cameraRigMode===S.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,t=this.cameraRigMode===S.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*o,s),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*t,Z);break}case S.e.RIG_MODE_VR:s.rotationQuaternion?(s.rotationQuaternion.O(this.rotationQuaternion),Z.rotationQuaternion.O(this.rotationQuaternion)):(s.rotation.O(this.rotation),Z.rotation.O(this.rotation)),s.position.O(this.position),Z.position.O(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(s,Z){this.getTarget().subtractToRef(this.position,Q._TargetFocalPoint),Q._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const o=Q._TargetFocalPoint.addInPlace(this.position);a.b.TranslationToRef(-o.x,-o.y,-o.z,Q._TargetTransformMatrix),Q._TargetTransformMatrix.multiplyToRef(a.b.RotationAxis(Z.upVector,s),Q._RigCamTransformMatrix),a.b.TranslationToRef(o.x,o.y,o.z,Q._TargetTransformMatrix),Q._RigCamTransformMatrix.multiplyToRef(Q._TargetTransformMatrix,Q._RigCamTransformMatrix),a.n.TransformCoordinatesToRef(this.position,Q._RigCamTransformMatrix,Z.position),Z.setTarget(o)}getClassName(){return"TargetCamera"}}Q._RigCamTransformMatrix=new a.b,Q._TargetTransformMatrix=new a.b,Q._TargetFocalPoint=new a.n,(0,t.c)([(0,j.K)()],Q.prototype,"updateUpVectorFromRotation",void 0),(0,t.c)([(0,j.G)()],Q.prototype,"rotation",void 0),(0,t.c)([(0,j.K)()],Q.prototype,"speed",void 0),(0,t.c)([(0,j.v)("lockedTargetId")],Q.prototype,"lockedTarget",void 0)},11126:(s,Z,o)=>{o.d(Z,{d:()=>t});class t{constructor(s,Z,o){this.bu=s,this.bv=Z,this.distance=o,this.faceId=0,this.subMeshId=0}}},11223:(s,Z,o)=>{o.d(Z,{b:()=>S});var t=o(10900),j=o(11113);class S{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(){var s;let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.pickedMesh||o&&!this.pickedMesh.isVerticesDataPresent(j.e.NormalKind))return null;let S,a=this.pickedMesh.ra();0===(null===(s=a)||void 0===s?void 0:s.length)&&(a=null);const O=t.g.sO[0],v=t.g.sO[1],G=t.g.sO[2];if(o){const s=this.pickedMesh.getVerticesData(j.e.NormalKind);let Z=a?t.n.FromArrayToRef(s,3*a[3*this.faceId],O):O.Ja(s[3*this.faceId*3],s[3*this.faceId*3+1],s[3*this.faceId*3+2]),o=a?t.n.FromArrayToRef(s,3*a[3*this.faceId+1],v):v.Ja(s[3*(3*this.faceId+1)],s[3*(3*this.faceId+1)+1],s[3*(3*this.faceId+1)+2]),B=a?t.n.FromArrayToRef(s,3*a[3*this.faceId+2],G):G.Ja(s[3*(3*this.faceId+2)],s[3*(3*this.faceId+2)+1],s[3*(3*this.faceId+2)+2]);Z=Z.scale(this.bu),o=o.scale(this.bv),B=B.scale(1-this.bu-this.bv),S=new t.n(Z.x+o.x+B.x,Z.y+o.y+B.y,Z.z+o.z+B.z)}else{const s=this.pickedMesh.getVerticesData(j.e.PositionKind),Z=a?t.n.FromArrayToRef(s,3*a[3*this.faceId],O):O.Ja(s[3*this.faceId*3],s[3*this.faceId*3+1],s[3*this.faceId*3+2]),o=a?t.n.FromArrayToRef(s,3*a[3*this.faceId+1],v):v.Ja(s[3*(3*this.faceId+1)],s[3*(3*this.faceId+1)+1],s[3*(3*this.faceId+1)+2]),B=a?t.n.FromArrayToRef(s,3*a[3*this.faceId+2],G):G.Ja(s[3*(3*this.faceId+2)],s[3*(3*this.faceId+2)+1],s[3*(3*this.faceId+2)+2]),Q=Z.Go(o),D=B.Go(o);S=t.n.Cross(Q,D)}const B=(s,Z)=>{if(-1!==this.thinInstanceIndex){const o=s.thinInstanceGetWorldMatrices()[this.thinInstanceIndex];o&&t.n.TransformNormalToRef(Z,o,Z)}let o=s.getWorldMatrix();s.nonUniformScaling&&(t.g.Matrix[0].O(o),o=t.g.Matrix[0],o.setTranslationFromFloats(0,0,0),o.invert(),o.transposeToRef(t.g.Matrix[1]),o=t.g.Matrix[1]),t.n.TransformNormalToRef(Z,o,Z)};if(Z&&B(this.pickedMesh,S),this.ray){const s=t.g.sO[0].O(S);Z||B(this.pickedMesh,s),t.n.Dot(s,this.ray.direction)>0&&S.negateInPlace()}return S.normalize(),S}getTextureCoordinates(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j.e.UVKind;if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(s))return null;const Z=this.pickedMesh.ra();if(!Z)return null;const o=this.pickedMesh.getVerticesData(s);if(!o)return null;let S=t.j.oO(o,2*Z[3*this.faceId]),a=t.j.oO(o,2*Z[3*this.faceId+1]),O=t.j.oO(o,2*Z[3*this.faceId+2]);return S=S.scale(this.bu),a=a.scale(this.bv),O=O.scale(1-this.bu-this.bv),new t.j(S.x+a.x+O.x,S.y+a.y+O.y)}}},11291:(s,Z,o)=>{o.d(Z,{b:()=>t});let t=!1},11133:(s,Z,o)=>{o.d(Z,{b:()=>a});var t=o(10911),j=o(10900),S=o(10904);class a{constructor(s,Z,o){this.vectors=(0,t.e)(8,j.n.Zero),this.center=j.n.Zero(),this.centerWorld=j.n.Zero(),this.extendSize=j.n.Zero(),this.extendSizeWorld=j.n.Zero(),this.directions=(0,t.e)(3,j.n.Zero),this.vectorsWorld=(0,t.e)(8,j.n.Zero),this.minimumWorld=j.n.Zero(),this.maximumWorld=j.n.Zero(),this.minimum=j.n.Zero(),this.maximum=j.n.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(s,Z,o)}reConstruct(s,Z,o){const t=s.x,S=s.y,a=s.z,O=Z.x,v=Z.y,G=Z.z,B=this.vectors;this.minimum.Ja(t,S,a),this.maximum.Ja(O,v,G),B[0].Ja(t,S,a),B[1].Ja(O,v,G),B[2].Ja(O,S,a),B[3].Ja(t,v,a),B[4].Ja(t,S,G),B[5].Ja(O,v,a),B[6].Ja(t,v,G),B[7].Ja(O,S,G),Z.addToRef(s,this.center).scaleInPlace(.5),Z.subtractToRef(s,this.extendSize).scaleInPlace(.5),this._worldMatrix=o||j.b.IdentityReadOnly,this._update(this._worldMatrix)}scale(s){const Z=a._TmpVector3,o=this.maximum.subtractToRef(this.minimum,Z[0]),t=o.length();o.normalizeFromLength(t);const j=t*s,S=o.scaleInPlace(.5*j),O=this.center.subtractToRef(S,Z[1]),v=this.center.addToRef(S,Z[2]);return this.reConstruct(O,v,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(s){const Z=this.minimumWorld,o=this.maximumWorld,t=this.directions,S=this.vectorsWorld,a=this.vectors;if(s.isIdentity()){Z.O(this.minimum),o.O(this.maximum);for(let s=0;s<8;++s)S[s].O(a[s]);this.extendSizeWorld.O(this.extendSize),this.centerWorld.O(this.center)}else{Z.tO(Number.MAX_VALUE),o.tO(-Number.MAX_VALUE);for(let t=0;t<8;++t){const O=S[t];j.n.TransformCoordinatesToRef(a[t],s,O),Z.minimizeInPlace(O),o.maximizeInPlace(O)}o.subtractToRef(Z,this.extendSizeWorld).scaleInPlace(.5),o.addToRef(Z,this.centerWorld).scaleInPlace(.5)}j.n.FromArrayToRef(s.m,0,t[0]),j.n.FromArrayToRef(s.m,4,t[1]),j.n.FromArrayToRef(s.m,8,t[2]),this._worldMatrix=s}isInFrustum(s){return a.IsInFrustum(this.vectorsWorld,s)}isCompletelyInFrustum(s){return a.IsCompletelyInFrustum(this.vectorsWorld,s)}intersectsPoint(s){const Z=this.minimumWorld,o=this.maximumWorld,t=Z.x,j=Z.y,a=Z.z,O=o.x,v=o.y,G=o.z,B=s.x,Q=s.y,D=s.z,z=-S.b;return!(O-B<z||z>B-t)&&(!(v-Q<z||z>Q-j)&&!(G-D<z||z>D-a))}intersectsSphere(s){return a.IntersectsSphere(this.minimumWorld,this.maximumWorld,s.centerWorld,s.radiusWorld)}intersectsMinMax(s,Z){const o=this.minimumWorld,t=this.maximumWorld,j=o.x,S=o.y,a=o.z,O=t.x,v=t.y,G=t.z,B=s.x,Q=s.y,D=s.z,z=Z.x,Y=Z.y,b=Z.z;return!(O<B||j>z)&&(!(v<Q||S>Y)&&!(G<D||a>b))}dispose(){var s,Z;null===(s=this._drawWrapperFront)||void 0===s||s.dispose(),null===(Z=this._drawWrapperBack)||void 0===Z||Z.dispose()}static Intersects(s,Z){return s.intersectsMinMax(Z.minimumWorld,Z.maximumWorld)}static IntersectsSphere(s,Z,o,t){const S=a._TmpVector3[0];j.n.ClampToRef(o,s,Z,S);return j.n.DistanceSquared(o,S)<=t*t}static IsCompletelyInFrustum(s,Z){for(let o=0;o<6;++o){const t=Z[o];for(let Z=0;Z<8;++Z)if(t.dotCoordinate(s[Z])<0)return!1}return!0}static IsInFrustum(s,Z){for(let o=0;o<6;++o){let t=!0;const j=Z[o];for(let Z=0;Z<8;++Z)if(j.dotCoordinate(s[Z])>=0){t=!1;break}if(t)return!1}return!0}}a._TmpVector3=(0,t.e)(3,j.n.Zero)},11130:(s,Z,o)=>{o.d(Z,{e:()=>Q});var t=o(10911),j=o(10900),S=o(11133),a=o(11138);const O={min:0,max:0},v={min:0,max:0},G=(s,Z,o)=>{const t=j.n.Dot(Z.centerWorld,s),S=Math.abs(j.n.Dot(Z.directions[0],s))*Z.extendSize.x+Math.abs(j.n.Dot(Z.directions[1],s))*Z.extendSize.y+Math.abs(j.n.Dot(Z.directions[2],s))*Z.extendSize.z;o.min=t-S,o.max=t+S},B=(s,Z,o)=>(G(s,Z,O),G(s,o,v),!(O.min>v.max||v.min>O.max));class Q{constructor(s,Z,o){this._isLocked=!1,this.boundingBox=new S.b(s,Z,o),this.boundingSphere=new a.c(s,Z,o)}reConstruct(s,Z,o){this.boundingBox.reConstruct(s,Z,o),this.boundingSphere.reConstruct(s,Z,o)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(s){this._isLocked=s}update(s){this._isLocked||(this.boundingBox._update(s),this.boundingSphere._update(s))}centerOn(s,Z){const o=Q._TmpVector3[0].O(s).RB(Z),t=Q._TmpVector3[1].O(s).addInPlace(Z);return this.boundingBox.reConstruct(o,t,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(o,t,this.boundingBox.getWorldMatrix()),this}encapsulate(s){const Z=j.n.Minimize(this.minimum,s),o=j.n.Maximize(this.maximum,s);return this.reConstruct(Z,o,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(s){const Z=j.g.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(Z);const o=j.g.sO[0];return j.n.TransformCoordinatesToRef(s.boundingBox.minimumWorld,Z,o),this.encapsulate(o),j.n.TransformCoordinatesToRef(s.boundingBox.maximumWorld,Z,o),this.encapsulate(o),this}scale(s){return this.boundingBox.scale(s),this.boundingSphere.scale(s),this}isInFrustum(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===Z||3===Z)&&this.boundingSphere.isCenterInFrustum(s))return!0;if(!this.boundingSphere.isInFrustum(s))return!1;return!(1!==Z&&3!==Z)||this.boundingBox.isInFrustum(s)}get diagonalLength(){const s=this.boundingBox;return s.maximumWorld.subtractToRef(s.minimumWorld,Q._TmpVector3[0]).length()}isCompletelyInFrustum(s){return this.boundingBox.isCompletelyInFrustum(s)}_checkCollision(s){return s._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(s){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(s)&&!!this.boundingBox.intersectsPoint(s))}intersects(s,Z){if(!a.c.Intersects(this.boundingSphere,s.boundingSphere))return!1;if(!S.b.Intersects(this.boundingBox,s.boundingBox))return!1;if(!Z)return!0;const o=this.boundingBox,t=s.boundingBox;return!!B(o.directions[0],o,t)&&(!!B(o.directions[1],o,t)&&(!!B(o.directions[2],o,t)&&(!!B(t.directions[0],o,t)&&(!!B(t.directions[1],o,t)&&(!!B(t.directions[2],o,t)&&(!!B(j.n.Cross(o.directions[0],t.directions[0]),o,t)&&(!!B(j.n.Cross(o.directions[0],t.directions[1]),o,t)&&(!!B(j.n.Cross(o.directions[0],t.directions[2]),o,t)&&(!!B(j.n.Cross(o.directions[1],t.directions[0]),o,t)&&(!!B(j.n.Cross(o.directions[1],t.directions[1]),o,t)&&(!!B(j.n.Cross(o.directions[1],t.directions[2]),o,t)&&(!!B(j.n.Cross(o.directions[2],t.directions[0]),o,t)&&(!!B(j.n.Cross(o.directions[2],t.directions[1]),o,t)&&!!B(j.n.Cross(o.directions[2],t.directions[2]),o,t))))))))))))))}}Q._TmpVector3=(0,t.e)(2,j.n.Zero)},11138:(s,Z,o)=>{o.d(Z,{c:()=>S});var t=o(10911),j=o(10900);class S{constructor(s,Z,o){this.center=j.n.Zero(),this.centerWorld=j.n.Zero(),this.minimum=j.n.Zero(),this.maximum=j.n.Zero(),this.reConstruct(s,Z,o)}reConstruct(s,Z,o){this.minimum.O(s),this.maximum.O(Z);const t=j.n.Distance(s,Z);Z.addToRef(s,this.center).scaleInPlace(.5),this.radius=.5*t,this._update(o||j.b.IdentityReadOnly)}scale(s){const Z=this.radius*s,o=S._TmpVector3,t=o[0].tO(Z),j=this.center.subtractToRef(t,o[1]),a=this.center.addToRef(t,o[2]);return this.reConstruct(j,a,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(s){if(s.isIdentity())this.centerWorld.O(this.center),this.radiusWorld=this.radius;else{j.n.TransformCoordinatesToRef(this.center,s,this.centerWorld);const Z=S._TmpVector3[0];j.n.TransformNormalFromFloatsToRef(1,1,1,s,Z),this.radiusWorld=Math.max(Math.abs(Z.x),Math.abs(Z.y),Math.abs(Z.z))*this.radius}}isInFrustum(s){const Z=this.centerWorld,o=this.radiusWorld;for(let t=0;t<6;t++)if(s[t].dotCoordinate(Z)<=-o)return!1;return!0}isCenterInFrustum(s){const Z=this.centerWorld;for(let o=0;o<6;o++)if(s[o].dotCoordinate(Z)<0)return!1;return!0}intersectsPoint(s){const Z=j.n.DistanceSquared(this.centerWorld,s);return!(this.radiusWorld*this.radiusWorld<Z)}static Intersects(s,Z){const o=j.n.DistanceSquared(s.centerWorld,Z.centerWorld),t=s.radiusWorld+Z.radiusWorld;return!(t*t<o)}static CreateFromCenterAndRadius(s,Z,o){this._TmpVector3[0].O(s),this._TmpVector3[1].Ja(0,0,Z),this._TmpVector3[2].O(s),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].RB(this._TmpVector3[1]);const t=new S(this._TmpVector3[0],this._TmpVector3[2]);return t._worldMatrix=o||j.b.Identity(),t}}S._TmpVector3=(0,t.e)(3,j.n.Zero)},11361:(s,Z,o)=>{o(11013).e.prototype.createDepthStencilTexture=function(s,Z,o){if(Z.isCube){const o=s.width||s;return this._createDepthStencilCubeTexture(o,Z)}return this._createDepthStencilTexture(s,Z,o)}},11343:(s,Z,o)=>{o(11313).ThinEngine.prototype.setAlphaMode=function(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._alphaMode!==s){switch(s){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}Z||(this.depthCullingState.depthMask=0===s),this._alphaMode=s}else if(!Z){const Z=0===s;this.depthCullingState.depthMask!==Z&&(this.depthCullingState.depthMask=Z)}}},11346:(s,Z,o)=>{var t=o(11313);t.ThinEngine.prototype.updateDynamicIndexBuffer=function(s,Z){let o;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(s),o=s.is32Bits?Z instanceof Uint32Array?Z:new Uint32Array(Z):Z instanceof Uint16Array?Z:new Uint16Array(Z),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,o,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},t.ThinEngine.prototype.updateDynamicVertexBuffer=function(s,Z,o,t){this.bindArrayBuffer(s),void 0===o&&(o=0);const j=Z.byteLength||Z.length;void 0===t||t>=j&&0===o?Z instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,o,new Float32Array(Z)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,o,Z):Z instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,o,new Float32Array(Z).subarray(0,t/4)):(Z=Z instanceof ArrayBuffer?new Uint8Array(Z,0,t):new Uint8Array(Z.buffer,Z.byteOffset,t),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,o,Z)),this._resetVertexBufferBinding()}},11348:(s,Z,o)=>{var t=o(11044),j=o(10955),S=o(11313),a=o(11357),O=o(11334);class v extends a.c{setDepthStencilTexture(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(super.setDepthStencilTexture(s,Z),!s)return;const o=this._engine,t=this._context,j=s._hardwareTexture;if(j&&s._autoMSAAManagement&&this._MSAAFramebuffer){const Z=o._currentFramebuffer;o._bindUnboundFramebuffer(this._MSAAFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,(0,O.e)(s.format)?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,t.RENDERBUFFER,j.getMSAARenderBuffer()),o._bindUnboundFramebuffer(Z)}}constructor(s,Z,o,t,j){super(s,Z,o,t),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=j}_cloneRenderTargetWrapper(){let s=null;return this._colorTextureArray&&this._depthStencilTextureArray?(s=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),s.texture.isReady=!0):s=super._cloneRenderTargetWrapper(),s}_swapRenderTargetWrapper(s){super._swapRenderTargetWrapper(s),s._framebuffer=this._framebuffer,s._depthStencilBuffer=this._depthStencilBuffer,s._MSAAFramebuffer=this._MSAAFramebuffer,s._colorTextureArray=this._colorTextureArray,s._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,S=arguments.length>5?arguments[5]:void 0;if(this._depthStencilBuffer){const s=this._engine,Z=s._currentFramebuffer,o=this._context;s._bindUnboundFramebuffer(this._framebuffer),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,null),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,null),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.STENCIL_ATTACHMENT,o.RENDERBUFFER,null),s._bindUnboundFramebuffer(Z),o.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(s,Z,o,t,j,S)}shareDepth(s){super.shareDepth(s);const Z=this._context,o=this._depthStencilBuffer,t=s._MSAAFramebuffer||s._framebuffer,j=this._engine;s._depthStencilBuffer&&s._depthStencilBuffer!==o&&Z.deleteRenderbuffer(s._depthStencilBuffer),s._depthStencilBuffer=o;const S=s._generateStencilBuffer?Z.DEPTH_STENCIL_ATTACHMENT:Z.DEPTH_ATTACHMENT;j._bindUnboundFramebuffer(t),Z.framebufferRenderbuffer(Z.FRAMEBUFFER,S,Z.RENDERBUFFER,o),j._bindUnboundFramebuffer(null)}_bindTextureRenderTarget(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const j=s._hardwareTexture;if(!j)return;const S=this._framebuffer,a=this._engine,O=a._currentFramebuffer;let v;if(a._bindUnboundFramebuffer(S),a.webGLVersion>1){const S=this._context;var G;if(v=S["COLOR_ATTACHMENT"+Z],s.is2DArray||s.is3D)o=o??(null===(G=this.layerIndices)||void 0===G?void 0:G[Z])??0,S.framebufferTextureLayer(S.FRAMEBUFFER,v,j.underlyingResource,t,o);else if(s.isCube){var B;o=o??(null===(B=this.faceIndices)||void 0===B?void 0:B[Z])??0,S.framebufferTexture2D(S.FRAMEBUFFER,v,S.TEXTURE_CUBE_MAP_POSITIVE_X+o,j.underlyingResource,t)}else S.framebufferTexture2D(S.FRAMEBUFFER,v,S.TEXTURE_2D,j.underlyingResource,t)}else{const s=this._context;v=s["COLOR_ATTACHMENT"+Z+"_WEBGL"];const S=void 0!==o?s.TEXTURE_CUBE_MAP_POSITIVE_X+o:s.TEXTURE_2D;s.framebufferTexture2D(s.FRAMEBUFFER,v,S,j.underlyingResource,t)}if(s._autoMSAAManagement&&this._MSAAFramebuffer){const s=this._context;a._bindUnboundFramebuffer(this._MSAAFramebuffer),s.framebufferRenderbuffer(s.FRAMEBUFFER,v,s.RENDERBUFFER,j.getMSAARenderBuffer())}a._bindUnboundFramebuffer(O)}setTexture(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super.setTexture(s,Z,o),this._bindTextureRenderTarget(s,Z)}setLayerAndFaceIndices(s,Z){var o;if(super.setLayerAndFaceIndices(s,Z),!this.textures||!this.layerIndices||!this.faceIndices)return;const t=(null===(o=this._attachments)||void 0===o?void 0:o.length)??this.textures.length;for(let j=0;j<t;j++){const s=this.textures[j];s&&(s.is2DArray||s.is3D?this._bindTextureRenderTarget(s,j,this.layerIndices[j]):s.isCube?this._bindTextureRenderTarget(s,j,this.faceIndices[j]):this._bindTextureRenderTarget(s,j))}}setLayerAndFaceIndex(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;if(super.setLayerAndFaceIndex(s,Z,o),!this.textures||!this.layerIndices||!this.faceIndices)return;const t=this.textures[s];t.is2DArray||t.is3D?this._bindTextureRenderTarget(this.textures[s],s,this.layerIndices[s]):t.isCube&&this._bindTextureRenderTarget(this.textures[s],s,this.faceIndices[s])}resolveMSAATextures(){const s=this._engine,Z=s._currentFramebuffer;s._bindUnboundFramebuffer(this._MSAAFramebuffer),super.resolveMSAATextures(),s._bindUnboundFramebuffer(Z)}dispose(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._disposeOnlyFramebuffers;const Z=this._context;s||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(Z.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(Z.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(Z.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(s)}}o(11361);S.ThinEngine.prototype._createHardwareRenderTargetWrapper=function(s,Z,o){const t=new v(s,Z,o,this,this._gl);return this._renderTargetWrapperCache.push(t),t},S.ThinEngine.prototype.createRenderTargetTexture=function(s,Z){const o=this._createHardwareRenderTargetWrapper(!1,!1,s);let t,j,S=!0,a=!1,O=!1,v=1;void 0!==Z&&"object"===typeof Z&&(S=Z.generateDepthBuffer??!0,a=!!Z.generateStencilBuffer,O=!!Z.noColorAttachment,t=Z.colorAttachment,v=Z.samples??1,j=Z.label);const G=t||(O?null:this._createInternalTexture(s,Z,!0,5)),B=s.width||s,Q=s.height||s,D=this._currentFramebuffer,z=this._gl,Y=z.createFramebuffer();if(this._bindUnboundFramebuffer(Y),o._depthStencilBuffer=this._setupFramebufferDepthAttachments(a,S,B,Q),!G||G.is2DArray||G.is3D||z.framebufferTexture2D(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,z.TEXTURE_2D,G._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(D),o.label=j??"RenderTargetWrapper",o._framebuffer=Y,o._generateDepthBuffer=S,o._generateStencilBuffer=a,o.setTextures(G),t){if(o._samples=t.samples,t.samples>1){const s=t._hardwareTexture.getMSAARenderBuffer(0);o._MSAAFramebuffer=z.createFramebuffer(),this._bindUnboundFramebuffer(o._MSAAFramebuffer),z.framebufferRenderbuffer(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,z.RENDERBUFFER,s),this._bindUnboundFramebuffer(null)}}else this.updateRenderTargetTextureSampleCount(o,v);return o},S.ThinEngine.prototype._createDepthStencilTexture=function(s,Z,o){const S=this._gl,a=s.layers||0,v=s.depth||0;let G=S.TEXTURE_2D;0!==a?G=S.TEXTURE_2D_ARRAY:0!==v&&(G=S.TEXTURE_3D);const B=new t.b(this,12);if(B.label=Z.label,!this._caps.depthTextureExtension)return j.b.Error("Depth texture is not supported by your browser or hardware."),B;const Q={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...Z};if(this._bindTextureDirectly(G,B,!0),this._setupDepthStencilTexture(B,s,0!==Q.comparisonFunction&&Q.bilinearFiltering,Q.comparisonFunction,Q.samples),void 0!==Q.depthTextureFormat){if(15!==Q.depthTextureFormat&&16!==Q.depthTextureFormat&&17!==Q.depthTextureFormat&&13!==Q.depthTextureFormat&&14!==Q.depthTextureFormat&&18!==Q.depthTextureFormat)return j.b.Error(`Depth texture ${Q.depthTextureFormat} format is not supported.`),B;B.format=Q.depthTextureFormat}else B.format=Q.generateStencil?13:16;const D=(0,O.e)(B.format),z=this._getWebGLTextureTypeFromDepthTextureFormat(B.format),Y=D?S.DEPTH_STENCIL:S.DEPTH_COMPONENT,b=this._getInternalFormatFromDepthTextureFormat(B.format,!0,D);return B.is2DArray?S.texImage3D(G,0,b,B.width,B.height,a,0,Y,z,null):B.is3D?S.texImage3D(G,0,b,B.width,B.height,v,0,Y,z,null):S.texImage2D(G,0,b,B.width,B.height,0,Y,z,null),this._bindTextureDirectly(G,null),this._internalTexturesCache.push(B),o._depthStencilBuffer&&(S.deleteRenderbuffer(o._depthStencilBuffer),o._depthStencilBuffer=null),this._bindUnboundFramebuffer(o._MSAAFramebuffer??o._framebuffer),o._generateStencilBuffer=D,o._depthStencilTextureWithStencil=D,o._depthStencilBuffer=this._setupFramebufferDepthAttachments(o._generateStencilBuffer,o._generateDepthBuffer,o.width,o.height,o.samples,B.format),this._bindUnboundFramebuffer(null),B},S.ThinEngine.prototype.updateRenderTargetTextureSampleCount=function(s,Z){var o;if(this.webGLVersion<2||!s)return 1;if(s.samples===Z)return Z;const t=this._gl;Z=Math.min(Z,this.getCaps().maxMSAASamples),s._depthStencilBuffer&&(t.deleteRenderbuffer(s._depthStencilBuffer),s._depthStencilBuffer=null),s._MSAAFramebuffer&&(t.deleteFramebuffer(s._MSAAFramebuffer),s._MSAAFramebuffer=null);const j=null===(o=s.texture)||void 0===o?void 0:o._hardwareTexture;if(null===j||void 0===j||j.releaseMSAARenderBuffers(),s.texture&&Z>1&&"function"===typeof t.renderbufferStorageMultisample){const o=t.createFramebuffer();if(!o)throw new Error("Unable to create multi sampled framebuffer");s._MSAAFramebuffer=o,this._bindUnboundFramebuffer(s._MSAAFramebuffer);const S=this._createRenderBuffer(s.texture.width,s.texture.height,Z,-1,this._getRGBABufferInternalSizedFormat(s.texture.type,s.texture.format,s.texture._useSRGBBuffer),t.COLOR_ATTACHMENT0,!1);if(!S)throw new Error("Unable to create multi sampled framebuffer");null===j||void 0===j||j.addMSAARenderBuffer(S)}this._bindUnboundFramebuffer(s._MSAAFramebuffer??s._framebuffer),s.texture&&(s.texture.samples=Z),s._samples=Z;const S=s._depthStencilTexture?s._depthStencilTexture.format:void 0;return s._depthStencilBuffer=this._setupFramebufferDepthAttachments(s._generateStencilBuffer,s._generateDepthBuffer,s.width,s.height,Z,S),this._bindUnboundFramebuffer(null),Z},S.ThinEngine.prototype._setupDepthStencilTexture=function(s,Z,o,t){let j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const S=Z.width??Z,a=Z.height??Z,O=Z.layers||0,v=Z.depth||0;s.baseWidth=S,s.baseHeight=a,s.width=S,s.height=a,s.is2DArray=O>0,s.depth=O||v,s.isReady=!0,s.samples=j,s.generateMipMaps=!1,s.samplingMode=o?2:1,s.type=0,s._comparisonFunction=t;const G=this._gl,B=this._getTextureTarget(s),Q=this._getSamplingParameters(s.samplingMode,!1);G.texParameteri(B,G.TEXTURE_MAG_FILTER,Q.mag),G.texParameteri(B,G.TEXTURE_MIN_FILTER,Q.min),G.texParameteri(B,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(B,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===t?(G.texParameteri(B,G.TEXTURE_COMPARE_FUNC,515),G.texParameteri(B,G.TEXTURE_COMPARE_MODE,G.NONE)):(G.texParameteri(B,G.TEXTURE_COMPARE_FUNC,t),G.texParameteri(B,G.TEXTURE_COMPARE_MODE,G.COMPARE_REF_TO_TEXTURE)))}},11004:(s,Z,o)=>{o.d(Z,{d:()=>N,g:()=>F,i:()=>i,h:()=>c,m:()=>w});class t{constructor(){this.children=[]}isValid(s){return!0}process(s,Z,o){let t="";if(this.line){let o=this.line;const B=Z.processor;if(B){var j,S,a,O,v,G;B.lineProcessor&&(o=B.lineProcessor(o,Z.isFragment,Z.processingContext));const t=(null===(j=Z.processor)||void 0===j?void 0:j.attributeKeywordName)??"attribute",Q=Z.isFragment&&null!==(S=Z.processor)&&void 0!==S&&S.varyingFragmentKeywordName?null===(a=Z.processor)||void 0===a?void 0:a.varyingFragmentKeywordName:!Z.isFragment&&null!==(O=Z.processor)&&void 0!==O&&O.varyingVertexKeywordName?null===(v=Z.processor)||void 0===v?void 0:v.varyingVertexKeywordName:"varying";if(!Z.isFragment&&B.attributeProcessor&&this.line.startsWith(t))o=B.attributeProcessor(this.line,s,Z.processingContext);else if(B.varyingProcessor&&(null!==(G=B.varyingCheck)&&void 0!==G&&G.call(B,this.line,Z.isFragment)||!B.varyingCheck&&this.line.startsWith(Q)))o=B.varyingProcessor(this.line,Z.isFragment,s,Z.processingContext);else if(B.uniformProcessor&&B.uniformRegexp&&B.uniformRegexp.test(this.line))Z.lookForClosingBracketForUniformBuffer||(o=B.uniformProcessor(this.line,Z.isFragment,s,Z.processingContext));else if(B.uniformBufferProcessor&&B.uniformBufferRegexp&&B.uniformBufferRegexp.test(this.line))Z.lookForClosingBracketForUniformBuffer||(o=B.uniformBufferProcessor(this.line,Z.isFragment,Z.processingContext),Z.lookForClosingBracketForUniformBuffer=!0);else if(B.textureProcessor&&B.textureRegexp&&B.textureRegexp.test(this.line))o=B.textureProcessor(this.line,Z.isFragment,s,Z.processingContext);else if((B.uniformProcessor||B.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!Z.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?B.uniformProcessor&&(o=B.uniformProcessor(this.line,Z.isFragment,s,Z.processingContext)):B.uniformBufferProcessor&&(o=B.uniformBufferProcessor(this.line,Z.isFragment,Z.processingContext),Z.lookForClosingBracketForUniformBuffer=!0)}Z.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(Z.lookForClosingBracketForUniformBuffer=!1,B.endOfUniformBufferProcessor&&(o=B.endOfUniformBufferProcessor(this.line,Z.isFragment,Z.processingContext)))}t+=o+"\n"}for(const B of this.children)t+=B.process(s,Z,o);return this.additionalDefineKey&&(s[this.additionalDefineKey]=this.additionalDefineValue||"true",o[this.additionalDefineKey]=s[this.additionalDefineKey]),t}}class j{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(s){this._lines.length=0;for(const Z of s){if(!Z||"\r"===Z)continue;if("#"===Z[0]){this._lines.push(Z);continue}const s=Z.trim();if(!s)continue;if(s.startsWith("//")){this._lines.push(Z);continue}const o=s.indexOf(";");if(-1===o)this._lines.push(s);else if(o===s.length-1)s.length>1&&this._lines.push(s);else{const s=Z.split(";");for(let Z=0;Z<s.length;Z++){let o=s[Z];o&&(o=o.trim(),o&&this._lines.push(o+(Z!==s.length-1?";":"")))}}}}}class S extends t{process(s,Z,o){for(let t=0;t<this.children.length;t++){const j=this.children[t];if(j.isValid(s))return j.process(s,Z,o)}return""}}class a extends t{isValid(s){return this.testExpression.isTrue(s)}}class O{isTrue(s){return!0}static postfixToInfix(s){const Z=[];for(const o of s)if(void 0===O._OperatorPriority[o])Z.push(o);else{const s=Z[Z.length-1],t=Z[Z.length-2];Z.length-=2,Z.push(`(${t}${o}${s})`)}return Z[Z.length-1]}static infixToPostfix(s){const Z=O._InfixToPostfixCache.get(s);if(Z)return Z.accessTime=Date.now(),Z.result;if(!s.includes("&&")&&!s.includes("||")&&!s.includes(")")&&!s.includes("("))return[s];const o=[];let t=-1;const j=()=>{B=B.trim(),""!==B&&(o.push(B),B="")},S=s=>{t<O._Stack.length-1&&(O._Stack[++t]=s)},a=()=>O._Stack[t],v=()=>-1===t?"!!INVALID EXPRESSION!!":O._Stack[t--];let G=0,B="";for(;G<s.length;){const Z=s.charAt(G),Q=G<s.length-1?s.substring(G,2+G):"";if("("===Z)B="",S(Z);else if(")"===Z){for(j();-1!==t&&"("!==a();)o.push(v());v()}else if(O._OperatorPriority[Q]>1){for(j();-1!==t&&O._OperatorPriority[a()]>=O._OperatorPriority[Q];)o.push(v());S(Q),G++}else B+=Z;G++}for(j();-1!==t;)"("===a()?v():o.push(v());return O._InfixToPostfixCache.size>=O.InfixToPostfixCacheLimitSize&&O.ClearCache(),O._InfixToPostfixCache.set(s,{result:o,accessTime:Date.now()}),o}static ClearCache(){const s=Array.from(O._InfixToPostfixCache.entries()).sort(((s,Z)=>s[1].accessTime-Z[1].accessTime));for(let Z=0;Z<O.InfixToPostfixCacheCleanupSize;Z++)O._InfixToPostfixCache.delete(s[Z][0])}}O.InfixToPostfixCacheLimitSize=5e4,O.InfixToPostfixCacheCleanupSize=25e3,O._InfixToPostfixCache=new Map,O._OperatorPriority={")":0,"(":1,"||":2,"&&":3},O._Stack=["","","","","","","","","","","","","","","","","","","",""];class v extends O{constructor(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=s,this.not=Z}isTrue(s){let Z=void 0!==s[this.define];return this.not&&(Z=!Z),Z}}class G extends O{isTrue(s){return this.leftOperand.isTrue(s)||this.rightOperand.isTrue(s)}}class B extends O{isTrue(s){return this.leftOperand.isTrue(s)&&this.rightOperand.isTrue(s)}}class Q extends O{constructor(s,Z,o){super(),this.define=s,this.operand=Z,this.testValue=o}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(s){let Z=!1;const o=parseInt(void 0!=s[this.define]?s[this.define]:this.define),t=parseInt(void 0!=s[this.testValue]?s[this.testValue]:this.testValue);if(isNaN(o)||isNaN(t))return!1;switch(this.operand){case">":Z=o>t;break;case"<":Z=o<t;break;case"<=":Z=o<=t;break;case">=":Z=o>=t;break;case"==":Z=o===t;break;case"!=":Z=o!==t}return Z}}var D=o(10975),z=o(11007);const Y=/defined\s*?\((.+?)\)/g,b=/defined\s*?\[(.+?)\]/g,f=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,A=/__decl__/,d=/light\{X\}.(\w*)/g,U=/\{X\}/g,u=[],H=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function F(s){s.processor&&s.processor.initializeShaders&&s.processor.initializeShaders(s.processingContext)}function i(s,Z,o,t){var j;null!==(j=Z.processor)&&void 0!==j&&j.preProcessShaderCode&&(s=Z.processor.preProcessShaderCode(s,Z.isFragment)),c(s,Z,(s=>{Z.processCodeAfterIncludes&&(s=Z.processCodeAfterIncludes(Z.isFragment?"fragment":"vertex",s,Z.defines));const j=function(s,Z,o){let t=function(s,Z){var o;if(null!==(o=Z.processor)&&void 0!==o&&o.noPrecision)return s;const t=Z.shouldUseHighPrecisionShader;-1===s.indexOf("precision highp float")?s=t?"precision highp float;\n"+s:"precision mediump float;\n"+s:t||(s=s.replace("precision highp float","precision mediump float"));return s}(s,Z);if(!Z.processor)return t;if(0===Z.processor.shaderLanguage&&-1!==t.indexOf("#version 3")&&(t=t.replace("#version 300 es",""),!Z.processor.parseGLES3))return t;const j=Z.defines,S=e(Z,o);Z.processor.preProcessor&&(t=Z.processor.preProcessor(t,j,S,Z.isFragment,Z.processingContext));const a={};t=R(t,S,Z,a),Z.processor.postProcessor&&(t=Z.processor.postProcessor(t,j,Z.isFragment,Z.processingContext,o?{drawBuffersExtensionDisabled:!o.getCaps().drawBuffersExtension}:{},S,a));null!==o&&void 0!==o&&o._features.needShaderCodeInlining&&(t=o.inlineShaderCode(t));return t}(s,Z,t);o(j,s)}))}function N(s,Z,o){return o.processor&&o.processor.finalizeShaders?o.processor.finalizeShaders(s,Z,o.processingContext):{vertexCode:s,fragmentCode:Z}}function L(s){const Z=/defined\((.+)\)/.exec(s);if(Z&&Z.length)return new v(Z[1].trim(),"!"===s[0]);const o=["==","!=",">=","<=","<",">"];let t="",j=0;for(t of o)if(j=s.indexOf(t),j>-1)break;if(-1===j)return new v(s);const S=s.substring(0,j).trim(),a=s.substring(j+t.length).trim();return new Q(S,t,a)}function V(s,Z){const o=new a,t=s.substring(0,Z);let j=s.substring(Z);return j=j.substring(0,(j.indexOf("//")+1||j.length+1)-1).trim(),o.testExpression="#ifdef"===t?new v(j):"#ifndef"===t?new v(j,!0):function(s){s=s.replace(Y,"defined[$1]");const Z=O.infixToPostfix(s),o=[];for(const j of Z)if("||"!==j&&"&&"!==j)o.push(j);else if(o.length>=2){let s=o[o.length-1],Z=o[o.length-2];o.length-=2;const t="&&"==j?new B:new G;"string"===typeof s&&(s=s.replace(b,"defined($1)")),"string"===typeof Z&&(Z=Z.replace(b,"defined($1)")),t.leftOperand="string"===typeof Z?L(Z):Z,t.rightOperand="string"===typeof s?L(s):s,o.push(t)}let t=o[o.length-1];return"string"===typeof t&&(t=t.replace(b,"defined($1)")),"string"===typeof t?L(t):t}(j),o}function g(s,Z,o,j){let S=s.currentLine;for(;l(s,o,j);){S=s.currentLine;const a=S.substring(0,5).toLowerCase();if("#else"===a){const o=new t;return Z.children.push(o),void l(s,o,j)}if("#elif"===a){const s=V(S,5);Z.children.push(s),o=s}}}function l(s,Z,o){for(;s.canRead;){s.lineIndex++;const j=s.currentLine;if(j.indexOf("#")>=0){const t=H.exec(j);if(t&&t.length){switch(t[0]){case"#ifdef":{const t=new S;Z.children.push(t);const a=V(j,6);t.children.push(a),g(s,t,a,o);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const t=new S;Z.children.push(t);const a=V(j,7);t.children.push(a),g(s,t,a,o);break}case"#if":{const t=new S,a=V(j,3);Z.children.push(t),t.children.push(a),g(s,t,a,o);break}}continue}}const a=new t;if(a.line=j,Z.children.push(a),"#"===j[0]&&"d"===j[1]){const s=j.replace(";","").split(" ");a.additionalDefineKey=s[1],3===s.length&&(a.additionalDefineValue=s[2])}}return!1}function R(s,Z,o,S){const a=new t,O=new j;return O.lineIndex=-1,O.lines=s.split("\n"),l(O,a,S),a.process(Z,o,S)}function e(s,Z){var o;const t=s.defines,j={};for(const S of t){const s=S.replace("#define","").replace(";","").trim().split(" ");j[s[0]]=s.length>1?s[1]:""}return 0===(null===(o=s.processor)||void 0===o?void 0:o.shaderLanguage)&&(j.GL_ES="true"),j.__VERSION__=s.version,j[s.platformName]="true",(0,z.i)(j,null===Z||void 0===Z?void 0:Z.isNDCHalfZRange,null===Z||void 0===Z?void 0:Z.useReverseDepthBuffer,null===Z||void 0===Z?void 0:Z.useExactSrgbConversions),j}function c(s,Z,o){let t;for(u.length=0;null!==(t=f.exec(s));)u.push(t);let j=String(s),S=[s],a=!1;for(const O of u){let s=O[1];if(-1!==s.indexOf("__decl__")&&(s=s.replace(A,""),Z.supportsUniformBuffers&&(s=s.replace("Vertex","Ubo").replace("Fragment","Ubo")),s+="Declaration"),!Z.includesShadersStore[s]){const t=Z.shadersRepository+"ShadersInclude/"+s+".fx";return void w.loadFile(t,(t=>{Z.includesShadersStore[s]=t,c(S.join(""),Z,o)}))}{let o=Z.includesShadersStore[s];if(O[2]){const s=O[3].split(",");for(let Z=0;Z<s.length;Z+=2){const t=new RegExp(s[Z],"g"),j=s[Z+1];o=o.replace(t,j)}}if(O[4]){const s=O[5];if(-1!==s.indexOf("..")){const t=s.split(".."),j=parseInt(t[0]);let S=parseInt(t[1]),a=o.slice(0);o="",isNaN(S)&&(S=Z.indexParameters[t[1]]);for(let s=j;s<S;s++)Z.supportsUniformBuffers||(a=a.replace(d,((s,Z)=>Z+"{X}"))),o+=a.replace(U,s.toString())+"\n"}else Z.supportsUniformBuffers||(o=o.replace(d,((s,Z)=>Z+"{X}"))),o=o.replace(U,s)}const t=[];for(const s of S){const Z=s.split(O[0]);for(let s=0;s<Z.length-1;s++)t.push(Z[s]),t.push(o);t.push(Z[Z.length-1])}S=t,a=a||o.indexOf("#include<")>=0||o.indexOf("#include <")>=0}}u.length=0,j=S.join(""),a?c(j.toString(),Z,o):o(j)}const w={loadFile:(s,Z,o,t,j,S)=>{throw(0,D.d)("FileTools")}}},11325:(s,Z,o)=>{o.d(Z,{e:()=>t});class t{get underlyingResource(){return this._webGLTexture}constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,Z=arguments.length>1?arguments[1]:void 0;if(this._MSAARenderBuffers=null,this._context=Z,!s&&(s=Z.createTexture(),!s))throw new Error("Unable to create webGL texture");this.set(s)}setUsage(){}set(s){this._webGLTexture=s}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(s){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(s)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const s of this._MSAARenderBuffers)this._context.deleteRenderbuffer(s);this._MSAARenderBuffers=null}}getMSAARenderBuffer(){var s;let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(s=this._MSAARenderBuffers)||void 0===s?void 0:s[Z])??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},11007:(s,Z,o)=>{o.d(Z,{c:()=>j,f:()=>S,i:()=>O,k:()=>a,l:()=>v});var t=o(10975);o(10947);const j={};function S(s,Z){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(Z?Z+"\n":"")+s}function a(s,Z,o,S,a,O,v){const G=v||j.loadFile;if(G){return G(s,Z,o,S,a,O)}throw(0,t.d)("FileTools")}function O(s,Z,o,t){if(s)return Z?s.IS_NDC_HALF_ZRANGE="":delete s.IS_NDC_HALF_ZRANGE,o?s.USE_REVERSE_DEPTHBUFFER="":delete s.USE_REVERSE_DEPTHBUFFER,void(t?s.USE_EXACT_SRGB_CONVERSIONS="":delete s.USE_EXACT_SRGB_CONVERSIONS);{let s="";return Z&&(s+="#define IS_NDC_HALF_ZRANGE"),o&&(s&&(s+="\n"),s+="#define USE_REVERSE_DEPTHBUFFER"),t&&(s&&(s+="\n"),s+="#define USE_EXACT_SRGB_CONVERSIONS"),s}}function v(s,Z){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3?arguments[3]:void 0;switch(s){case 3:{const s=(ArrayBuffer,new Int8Array(Z));return t&&s.set(new Int8Array(t)),s}case 0:{const s=(ArrayBuffer,new Uint8Array(Z));return t&&s.set(new Uint8Array(t)),s}case 4:{const s=Z instanceof ArrayBuffer?new Int16Array(Z):new Int16Array(o?Z/2:Z);return t&&s.set(new Int16Array(t)),s}case 5:case 8:case 9:case 10:case 2:{const s=Z instanceof ArrayBuffer?new Uint16Array(Z):new Uint16Array(o?Z/2:Z);return t&&s.set(new Uint16Array(t)),s}case 6:{const s=Z instanceof ArrayBuffer?new Int32Array(Z):new Int32Array(o?Z/4:Z);return t&&s.set(new Int32Array(t)),s}case 7:case 11:case 12:case 13:case 14:case 15:{const s=Z instanceof ArrayBuffer?new Uint32Array(Z):new Uint32Array(o?Z/4:Z);return t&&s.set(new Uint32Array(t)),s}case 1:{const s=Z instanceof ArrayBuffer?new Float32Array(Z):new Float32Array(o?Z/4:Z);return t&&s.set(new Float32Array(t)),s}}const j=(ArrayBuffer,new Uint8Array(Z));return t&&j.set(new Uint8Array(t)),j}},11013:(s,Z,o)=>{o.d(Z,{e:()=>U});var t=o(10927),j=o(10955),S=o(11019),a=o(10924),O=o(10968);class v{constructor(){let s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,s&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(s){this._zOffset!==s&&(this._zOffset=s,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(s){this._zOffsetUnits!==s&&(this._zOffsetUnits=s,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(s){this._cullFace!==s&&(this._cullFace=s,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(s){this._cull!==s&&(this._cull=s,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(s){this._depthFunc!==s&&(this._depthFunc=s,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(s){this._depthMask!==s&&(this._depthMask=s,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(s){this._depthTest!==s&&(this._depthTest=s,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(s){this._frontFace!==s&&(this._frontFace=s,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(s){this.isDirty&&(this._isCullDirty&&(this.cull?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(s.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(s.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(s.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(s.enable(s.POLYGON_OFFSET_FILL),s.polygonOffset(this.zOffset,this.zOffsetUnits)):s.disable(s.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(s.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}class G{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(s){this._func!==s&&(this._func=s,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(s){this._funcRef!==s&&(this._funcRef=s,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(s){this._funcMask!==s&&(this._funcMask=s,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(s){this._opStencilFail!==s&&(this._opStencilFail=s,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(s){this._opDepthFail!==s&&(this._opDepthFail=s,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(s){this._opStencilDepthPass!==s&&(this._opStencilDepthPass=s,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(s){this._mask!==s&&(this._mask=s,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(s){this._enabled!==s&&(this._enabled=s,this._isStencilTestDirty=!0)}constructor(){let s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,s&&this.reset()}reset(){var s;this.stencilMaterial=void 0,null===(s=this.stencilGlobal)||void 0===s||s.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(s){var Z;if(!s)return;const o=!this.useStencilGlobalOnly&&!(null===(Z=this.stencilMaterial)||void 0===Z||!Z.enabled);this.enabled=o?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=o?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=o?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=o?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=o?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=o?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=o?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=o?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(s.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(s.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(s.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}class B{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=B.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=B.KEEP,this.opDepthFail=B.KEEP,this.opStencilDepthPass=B.REPLACE}get stencilFunc(){return this.func}set stencilFunc(s){this.func=s}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(s){this.funcRef=s}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(s){this.funcMask=s}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(s){this.opStencilFail=s}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(s){this.opDepthFail=s}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(s){this.opStencilDepthPass=s}get stencilMask(){return this.mask}set stencilMask(s){this.mask=s}get stencilTest(){return this.enabled}set stencilTest(s){this.enabled=s}}B.ALWAYS=519,B.KEEP=7680,B.REPLACE=7681;class Q{constructor(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._alphaBlend}set alphaBlend(s){this._alphaBlend!==s&&(this._alphaBlend=s,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(s,Z,o,t){this._blendConstants[0]===s&&this._blendConstants[1]===Z&&this._blendConstants[2]===o&&this._blendConstants[3]===t||(this._blendConstants[0]=s,this._blendConstants[1]=Z,this._blendConstants[2]=o,this._blendConstants[3]=t,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(s,Z,o,t){this._blendFunctionParameters[0]===s&&this._blendFunctionParameters[1]===Z&&this._blendFunctionParameters[2]===o&&this._blendFunctionParameters[3]===t||(this._blendFunctionParameters[0]=s,this._blendFunctionParameters[1]=Z,this._blendFunctionParameters[2]=o,this._blendFunctionParameters[3]=t,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(s,Z){this._blendEquationParameters[0]===s&&this._blendEquationParameters[1]===Z||(this._blendEquationParameters[0]=s,this._blendEquationParameters[1]=Z,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(s){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?s.enable(s.BLEND):s.disable(s.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(s.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(s.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(s.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}var D=o(10975),z=o(11044),Y=o(10947),b=o(10932),f=o(11007),A=o(11059);function d(s,Z){if((0,Y.i)()){const{requestAnimationFrame:o}=Z||window;if("function"===typeof o)return o(s)}else if("function"===typeof requestAnimationFrame)return requestAnimationFrame(s);return setTimeout(s,16)}class U{get frameId(){return this._frameId}get isWebGPU(){return this._isWebGPU}_getShaderProcessor(s){return this._shaderProcessor}get shaderPlatformName(){return this._shaderPlatformName}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}set useReverseDepthBuffer(s){s!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=s,this._depthCullingState.depthFunc=s?518:515)}setColorWrite(s){s!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=s)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}_getGlobalDefines(s){if(s)return this.isNDCHalfZRange?s.IS_NDC_HALF_ZRANGE="":delete s.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?s.USE_REVERSE_DEPTHBUFFER="":delete s.USE_REVERSE_DEPTHBUFFER,void(this.useExactSrgbConversions?s.USE_EXACT_SRGB_CONVERSIONS="":delete s.USE_EXACT_SRGB_CONVERSIONS);{let s="";return this.isNDCHalfZRange&&(s+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(s&&(s+="\n"),s+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(s&&(s+="\n"),s+="#define USE_EXACT_SRGB_CONVERSIONS"),s}}_rebuildInternalTextures(){const s=this._internalTexturesCache.slice();for(const Z of s)Z._rebuild()}_rebuildRenderTargetWrappers(){const s=this._renderTargetWrapperCache.slice();for(const Z of s)Z._rebuild()}_rebuildEffects(){for(const s in this._compiledEffects){const Z=this._compiledEffects[s];Z._pipelineContext=null,Z._prepareEffect()}S.d.ResetCache()}_rebuildGraphicsResources(){var s;this.wipeCaches(!0),this._rebuildEffects(),null===(s=this._rebuildComputeEffects)||void 0===s||s.call(this),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_flagContextRestored(){j.b.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}_restoreEngineAfterContextLost(s){setTimeout((()=>{this._clearEmptyResources();const Z=this._depthCullingState.depthTest,o=this._depthCullingState.depthFunc,t=this._depthCullingState.depthMask,j=this._stencilState.stencilTest;s(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=Z,this._depthCullingState.depthFunc=o,this._depthCullingState.depthMask=t,this._stencilState.stencilTest=j,this._flagContextRestored()}),0)}get B(){return this._isDisposed}get snapshotRendering(){return!1}set snapshotRendering(s){}get snapshotRenderingMode(){return 0}set snapshotRenderingMode(s){}getClassName(){return"AbstractEngine"}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){const s=new Uint8Array(4),Z=[s,s,s,s,s,s];this._emptyCubeTexture=this.createRawCubeTexture(Z,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get activeRenderLoops(){return this._activeRenderLoops}stopRenderLoop(s){if(!s)return this._activeRenderLoops.length=0,void this._cancelFrame();const Z=this._activeRenderLoops.indexOf(s);Z>=0&&(this._activeRenderLoops.splice(Z,1),0==this._activeRenderLoops.length&&this._cancelFrame())}_cancelFrame(){if(0!==this._frameHandler){const s=this._frameHandler;if(this._frameHandler=0,(0,Y.i)()){const{cancelAnimationFrame:Z}=this.getHostWindow()||window;if("function"===typeof Z)return Z(s)}else if("function"===typeof cancelAnimationFrame)return cancelAnimationFrame(s);return clearTimeout(s)}}AQ(){this.onBeginFrameObservable.notifyObservers(this)}dQ(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}get maxFPS(){return this._maxFPS}set maxFPS(s){this._maxFPS=s,void 0!==s&&(this._minFrameTime=s<=0?Number.MAX_VALUE:1e3/s)}_isOverFrameTime(s){if(!s||void 0===this._maxFPS)return!1;const Z=s-this._lastFrameTime;return this._lastFrameTime=s,this._renderAccumulator+=Z,this._renderAccumulator<this._minFrameTime||(this._renderAccumulator-=this._minFrameTime,this._renderAccumulator>this._minFrameTime&&(this._renderAccumulator=this._minFrameTime),!1)}_processFrame(s){if(this._frameHandler=0,!this._contextWasLost&&!this._isOverFrameTime(s)){let s=!0;(this.B||!this.renderEvenInBackground&&this._windowIsBackground)&&(s=!1),s&&(this.AQ(),this.skipFrameRender||this._renderViews()||this._renderFrame(),this.dQ())}}_renderLoop(s){this._processFrame(s),this._activeRenderLoops.length>0&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_renderFrame(){for(let s=0;s<this._activeRenderLoops.length;s++){(0,this._activeRenderLoops[s])()}}_renderViews(){return!1}_queueNewFrame(s,Z){return d(s,Z)}runRenderLoop(s){-1===this._activeRenderLoops.indexOf(s)&&(this._activeRenderLoops.push(s),1===this._activeRenderLoops.length&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(s){this._depthCullingState.depthTest=s}setZOffset(s){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-s:s}getZOffset(){const s=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-s:s}setZOffsetUnits(s){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-s:s}getZOffsetUnits(){const s=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-s:s}getHostWindow(){return(0,Y.i)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(s){this._compatibilityMode=!0}_rebuildTextures(){for(const s of this.scenes)s._rebuildTextures();for(const s of this._virtualScenes)s._rebuildTextures()}_releaseRenderTargetWrapper(s){const Z=this._renderTargetWrapperCache.indexOf(s);-1!==Z&&this._renderTargetWrapperCache.splice(Z,1)}get currentViewport(){return this._cachedViewport}setViewport(s,Z,o){const t=Z||this.getRenderWidth(),j=o||this.getRenderHeight(),S=s.x||0,a=s.y||0;this._cachedViewport=s,this._viewport(S*t,a*j,t*s.width,j*s.height)}createCanvasImage(){return document.createElement("img")}createCanvasPath2D(s){return new Path2D(s)}get description(){let s=this.name+this.version;return this._caps.parallelShaderCompile&&(s+=" - Parallel shader compilation"),s}_createTextureBase(s,Z,o,S){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,G=arguments.length>7?arguments[7]:void 0,B=arguments.length>8?arguments[8]:void 0,Q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,D=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,Y=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,b=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,f=arguments.length>13?arguments[13]:void 0,d=arguments.length>14?arguments[14]:void 0,u=arguments.length>15?arguments[15]:void 0;const H="data:"===(s=s||"").substring(0,5),F="blob:"===s.substring(0,5),i=H&&-1!==s.indexOf(";base64,"),N=D||new z.b(this,1);N!==D&&(N.label=s.substring(0,60));const L=s;!this._transformTextureUrl||i||D||Q||(s=this._transformTextureUrl(s)),L!==s&&(N._originalUrl=L);const V=s.lastIndexOf(".");let g=b||(V>-1?s.substring(V).toLowerCase():"");g.indexOf("?")>-1&&(g=g.split("?")[0]);const l=(0,A.c)(g,f);S&&S.addPendingData(N),N.url=s,N.generateMipMaps=!Z,N.samplingMode=a,N.invertY=o,N._useSRGBBuffer=this._getUseSRGBBuffer(!!u,Z),this._doNotHandleContextLost||(N._buffer=Q);let R=null;O&&!D&&(R=N.onLoadedObservable.add(O)),D||this._internalTexturesCache.push(N);const e=(o,D)=>{S&&S.removePendingData(N),s===L?(R&&N.onLoadedObservable.remove(R),t.c.UseFallbackTexture&&s!==t.c.FallbackTexture&&this._createTextureBase(t.c.FallbackTexture,Z,N.invertY,S,a,null,v,G,B,Q,N),o=(o||"Unknown error")+(t.c.UseFallbackTexture?" - Fallback texture was used":""),N.onErrorObservable.notifyObservers({message:o,exception:D}),v&&v(o,D)):(j.b.Warn(`Failed to load ${s}, falling back to ${L}`),this._createTextureBase(L,Z,N.invertY,S,a,O,v,G,B,Q,N,Y,b,f,d,u))};if(l){const Z=async s=>{(await l).loadData(s,N,((s,Z,o,t,j,O)=>{O?e("TextureLoader failed to load data"):G(N,g,S,{width:s,height:Z},N.invertY,!o,t,(()=>(j(),!1)),a)}),d)};Q?Q instanceof ArrayBuffer?Z(new Uint8Array(Q)):ArrayBuffer.isView(Q)?Z(Q):v&&v("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(s,(s=>{Z(new Uint8Array(s))}),void 0,S?S.offlineProvider:void 0,!0,((s,Z)=>{e("Unable to load "+(s&&s.responseURL,Z))}))}else{const o=s=>{F&&!this._doNotHandleContextLost&&(N._buffer=s),G(N,g,S,s,N.invertY,Z,!1,B,a)};!H||i?Q&&("string"===typeof Q.decoding||Q.close)?o(Q):U._FileToolsLoadImage(s||"",o,e,S?S.offlineProvider:null,f,N.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0,this):"string"===typeof Q||Q instanceof ArrayBuffer||ArrayBuffer.isView(Q)||Q instanceof Blob?U._FileToolsLoadImage(Q,o,e,S?S.offlineProvider:null,f,N.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0,this):Q&&o(Q)}return N}_rebuildBuffers(){for(const s of this._uniformBuffers)s._rebuildAfterContextLost()}get _shouldUseHighPrecisionShader(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,Y.f)()?document:null}getLoadedTexturesCache(){return this._internalTexturesCache}clearInternalTexturesCache(){this._internalTexturesCache.length=0}getCaps(){return this._caps}resetTextureCache(){for(const s in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,s)&&(this._boundTexturesCache[s]=null);this._currentTextureChannel=-1}get name(){return this._name}set name(s){this._name=s}static get NpmPackage(){return"babylonjs@8.13.0"}static get Version(){return"8.13.0"}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}setHardwareScalingLevel(s){this._hardwareScalingLevel=s,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(s){this._doNotHandleContextLost=s}get isStencilEnable(){return this._isStencilEnable}getCreationOptions(){return this._creationOptions}constructor(s,Z,o){var j,S;this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new v,this._stencilStateComposer=new G,this._stencilState=new B,this._alphaState=new Q,this._alphaMode=1,this._alphaEquation=0,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new b.b,this.onCanvasFocusObservable=new b.b,this.onNewSceneAddedObservable=new b.b,this.onResizeObservable=new b.b,this.onCanvasPointerOutObservable=new b.b,this.onEffectErrorObservable=new b.b,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new b.b,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=s=>this._renderLoop(s),this._lastFrameTime=0,this._renderAccumulator=0,this.skipFrameRender=!1,this.onBeforeShaderCompilationObservable=new b.b,this.onAfterShaderCompilationObservable=new b.b,this.onBeginFrameObservable=new b.b,this.onEndFrameObservable=new b.b,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new b.b,this.onContextRestoredObservable=new b.b,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.jO=new b.b,this.onReleaseEffectsObservable=new b.b,t.c.Instances.push(this),this.startTime=O.c.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,a.e.SetMatrixPrecision(!!Z.useHighPrecisionMatrix),(0,Y.g)()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=o??!1,Z.antialias=s??Z.antialias,Z.deterministicLockstep=Z.deterministicLockstep??!1,Z.lockstepMaxSteps=Z.lockstepMaxSteps??4,Z.timeStep=Z.timeStep??1/60,Z.stencil=Z.stencil??!0,this._audioContext=(null===(j=Z.audioEngineOptions)||void 0===j?void 0:j.audioContext)??null,this._audioDestination=(null===(S=Z.audioEngineOptions)||void 0===S?void 0:S.audioDestination)??null,this.premultipliedAlpha=Z.premultipliedAlpha??!0,this._doNotHandleContextLost=!!Z.doNotHandleContextLost,this._isStencilEnable=!!Z.stencil,this.useExactSrgbConversions=Z.useExactSrgbConversions??!1;const D=(0,Y.i)()&&window.devicePixelRatio||1,z=Z.limitDeviceRatio||D;o=o||Z.adaptToDeviceRatio||!1,this._hardwareScalingLevel=o?1/Math.min(z,D):1,this._lastDevicePixelRatio=D,this._creationOptions=Z}resize(){let s,Z,o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.adaptToDeviceRatio){const s=(0,Y.i)()&&window.devicePixelRatio||1,Z=this._lastDevicePixelRatio/s;this._lastDevicePixelRatio=s,this._hardwareScalingLevel*=Z}if((0,Y.i)()&&(0,Y.f)())if(this._renderingCanvas){var t,j;const o=null===(t=(j=this._renderingCanvas).getBoundingClientRect)||void 0===t?void 0:t.call(j);s=this._renderingCanvas.clientWidth||(null===o||void 0===o?void 0:o.width)||this._renderingCanvas.width*this._hardwareScalingLevel||100,Z=this._renderingCanvas.clientHeight||(null===o||void 0===o?void 0:o.height)||this._renderingCanvas.height*this._hardwareScalingLevel||100}else s=window.innerWidth,Z=window.innerHeight;else s=this._renderingCanvas?this._renderingCanvas.width:100,Z=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(s/this._hardwareScalingLevel,Z/this._hardwareScalingLevel,o)}setSize(s,Z){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._renderingCanvas)return!1;if(s|=0,Z|=0,!o&&this._renderingCanvas.width===s&&this._renderingCanvas.height===Z)return!1;if(this._renderingCanvas.width=s,this._renderingCanvas.height=Z,this.scenes){for(let s=0;s<this.scenes.length;s++){const Z=this.scenes[s];for(let s=0;s<Z.cameras.length;s++){Z.cameras[s]._currentRenderId=0}}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}createRawTexture(s,Z,o,t,j,S,a,O,v,G,B){throw(0,D.d)("engine.rawTexture")}createRawCubeTexture(s,Z,o,t,j,S,a,O){throw(0,D.d)("engine.rawTexture")}createRawTexture3D(s,Z,o,t,j,S,a,O,v,G,B){throw(0,D.d)("engine.rawTexture")}createRawTexture2DArray(s,Z,o,t,j,S,a,O,v,G,B){throw(0,D.d)("engine.rawTexture")}_sharedInit(s){this._renderingCanvas=s}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const s=navigator.userAgent;this.hostInformation.isMobile=-1!==s.indexOf("Mobile")||-1!==s.indexOf("Mac")&&(0,Y.f)()&&"ontouchend"in document},this._checkForMobile(),(0,Y.i)()&&window.addEventListener("resize",this._checkForMobile))}createVideoElement(s){return document.createElement("video")}_reportDrawCall(){var s;let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;null===(s=this._drawCalls)||void 0===s||s.addCount(Z,!1)}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return 1e3*this._timeStep}_createImageBitmapFromSource(s,Z){throw new Error("createImageBitmapFromSource is not implemented")}createImageBitmap(s,Z){return createImageBitmap(s,Z)}resizeImageBitmap(s,Z,o){throw new Error("resizeImageBitmap is not implemented")}getFontOffset(s){throw new Error("getFontOffset is not implemented")}static _CreateCanvas(s,Z){if("undefined"===typeof document)return new OffscreenCanvas(s,Z);const o=document.createElement("canvas");return o.width=s,o.height=Z,o}createCanvas(s,Z){return U._CreateCanvas(s,Z)}static _FileToolsLoadImage(s,Z,o,t,j,S,a){throw(0,D.d)("FileTools")}_loadFile(s,Z,o,t,j,S){const a=(0,f.k)(s,Z,o,t,j,S);return this._activeRequests.push(a),a.onCompleteObservable.add((()=>{const s=this._activeRequests.indexOf(a);-1!==s&&this._activeRequests.splice(s,1)})),a}static _FileToolsLoadFile(s,Z,o,t,j,S){if(f.c.loadFile)return f.c.loadFile(s,Z,o,t,j,S);throw(0,D.d)("FileTools")}dispose(){var s;for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();null===(s=this.releaseComputeEffects)||void 0===s||s.call(this),S.d.ResetCache();for(const o of this._activeRequests)o.abort();this._boundRenderFunction=null,this.jO.notifyObservers(this),this.jO.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),this.onEffectErrorObservable.clear(),(0,Y.i)()&&window.removeEventListener("resize",this._checkForMobile);const Z=t.c.Instances.indexOf(this);Z>=0&&t.c.Instances.splice(Z,1),t.c.Instances.length||(t.c.OnEnginesDisposedObservable.notifyObservers(this),t.c.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}static DefaultLoadingScreenFactory(s){throw(0,D.d)("LoadingScreen")}static MarkAllMaterialsAsDirty(s,Z){for(let o=0;o<t.c.Instances.length;o++){const j=t.c.Instances[o];for(let o=0;o<j.scenes.length;o++)j.scenes[o].markAllMaterialsAsDirty(s,Z)}}}U._RenderPassIdCounter=0,U._RescalePostProcessFactory=null,U.CollisionsEpsilon=.001,U.QueueNewFrame=d},11457:(s,Z,o)=>{o.d(Z,{b:()=>t});class t{}t.AUTOSAMPLERSUFFIX="Sampler",t.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",t.ALPHA_DISABLE=0,t.ALPHA_ADD=1,t.ALPHA_COMBINE=2,t.ALPHA_SUBTRACT=3,t.ALPHA_MULTIPLY=4,t.ALPHA_MAXIMIZED=5,t.ALPHA_ONEONE=6,t.ALPHA_PREMULTIPLIED=7,t.ALPHA_PREMULTIPLIED_PORTERDUFF=8,t.ALPHA_INTERPOLATE=9,t.ALPHA_SCREENMODE=10,t.ALPHA_ONEONE_ONEONE=11,t.ALPHA_ALPHATOCOLOR=12,t.ALPHA_REVERSEONEMINUS=13,t.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,t.ALPHA_ONEONE_ONEZERO=15,t.ALPHA_EXCLUSION=16,t.ALPHA_LAYER_ACCUMULATE=17,t.ALPHA_EQUATION_ADD=0,t.ALPHA_EQUATION_SUBSTRACT=1,t.ALPHA_EQUATION_REVERSE_SUBTRACT=2,t.ALPHA_EQUATION_MAX=3,t.ALPHA_EQUATION_MIN=4,t.ALPHA_EQUATION_DARKEN=5,t.DELAYLOADSTATE_NONE=0,t.DELAYLOADSTATE_LOADED=1,t.DELAYLOADSTATE_LOADING=2,t.DELAYLOADSTATE_NOTLOADED=4,t.NEVER=512,t.ALWAYS=519,t.LESS=513,t.EQUAL=514,t.LEQUAL=515,t.GREATER=516,t.GEQUAL=518,t.NOTEQUAL=517,t.KEEP=7680,t.ZERO=0,t.REPLACE=7681,t.INCR=7682,t.DECR=7683,t.INVERT=5386,t.INCR_WRAP=34055,t.DECR_WRAP=34056,t.TEXTURE_CLAMP_ADDRESSMODE=0,t.TEXTURE_WRAP_ADDRESSMODE=1,t.TEXTURE_MIRROR_ADDRESSMODE=2,t.TEXTURE_CREATIONFLAG_STORAGE=1,t.TEXTUREFORMAT_ALPHA=0,t.TEXTUREFORMAT_LUMINANCE=1,t.TEXTUREFORMAT_LUMINANCE_ALPHA=2,t.TEXTUREFORMAT_RGB=4,t.TEXTUREFORMAT_RGBA=5,t.TEXTUREFORMAT_RED=6,t.TEXTUREFORMAT_R=6,t.TEXTUREFORMAT_R16_UNORM=33322,t.TEXTUREFORMAT_RG16_UNORM=33324,t.TEXTUREFORMAT_RGB16_UNORM=32852,t.TEXTUREFORMAT_RGBA16_UNORM=32859,t.TEXTUREFORMAT_R16_SNORM=36760,t.TEXTUREFORMAT_RG16_SNORM=36761,t.TEXTUREFORMAT_RGB16_SNORM=36762,t.TEXTUREFORMAT_RGBA16_SNORM=36763,t.TEXTUREFORMAT_RG=7,t.TEXTUREFORMAT_RED_INTEGER=8,t.TEXTUREFORMAT_R_INTEGER=8,t.TEXTUREFORMAT_RG_INTEGER=9,t.TEXTUREFORMAT_RGB_INTEGER=10,t.TEXTUREFORMAT_RGBA_INTEGER=11,t.TEXTUREFORMAT_BGRA=12,t.TEXTUREFORMAT_DEPTH24_STENCIL8=13,t.TEXTUREFORMAT_DEPTH32_FLOAT=14,t.TEXTUREFORMAT_DEPTH16=15,t.TEXTUREFORMAT_DEPTH24=16,t.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,t.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,t.TEXTUREFORMAT_STENCIL8=19,t.TEXTUREFORMAT_UNDEFINED=4294967295,t.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,t.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,t.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,t.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,t.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,t.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,t.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,t.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,t.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,t.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,t.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,t.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,t.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,t.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,t.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,t.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,t.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,t.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,t.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,t.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,t.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,t.TEXTURETYPE_UNSIGNED_BYTE=0,t.TEXTURETYPE_UNSIGNED_INT=0,t.TEXTURETYPE_FLOAT=1,t.TEXTURETYPE_HALF_FLOAT=2,t.TEXTURETYPE_BYTE=3,t.TEXTURETYPE_SHORT=4,t.TEXTURETYPE_UNSIGNED_SHORT=5,t.TEXTURETYPE_INT=6,t.TEXTURETYPE_UNSIGNED_INTEGER=7,t.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,t.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,t.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,t.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,t.TEXTURETYPE_UNSIGNED_INT_24_8=12,t.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,t.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,t.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,t.TEXTURETYPE_UNDEFINED=16,t.TEXTURE_2D=3553,t.TEXTURE_2D_ARRAY=35866,t.TEXTURE_CUBE_MAP=34067,t.TEXTURE_CUBE_MAP_ARRAY=3735928559,t.TEXTURE_3D=32879,t.TEXTURE_NEAREST_SAMPLINGMODE=1,t.TEXTURE_NEAREST_NEAREST=1,t.TEXTURE_BILINEAR_SAMPLINGMODE=2,t.TEXTURE_LINEAR_LINEAR=2,t.TEXTURE_TRILINEAR_SAMPLINGMODE=3,t.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,t.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,t.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,t.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,t.TEXTURE_NEAREST_LINEAR=7,t.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,t.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,t.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,t.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,t.TEXTURE_LINEAR_NEAREST=12,t.TEXTURE_EXPLICIT_MODE=0,t.TEXTURE_SPHERICAL_MODE=1,t.TEXTURE_PLANAR_MODE=2,t.TEXTURE_CUBIC_MODE=3,t.TEXTURE_PROJECTION_MODE=4,t.TEXTURE_SKYBOX_MODE=5,t.TEXTURE_INVCUBIC_MODE=6,t.TEXTURE_EQUIRECTANGULAR_MODE=7,t.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,t.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,t.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,t.TEXTURE_FILTERING_QUALITY_HIGH=64,t.TEXTURE_FILTERING_QUALITY_MEDIUM=16,t.TEXTURE_FILTERING_QUALITY_LOW=8,t.SCALEMODE_FLOOR=1,t.SCALEMODE_NEAREST=2,t.SCALEMODE_CEILING=3,t.MATERIAL_TextureDirtyFlag=1,t.MATERIAL_LightDirtyFlag=2,t.MATERIAL_FresnelDirtyFlag=4,t.MATERIAL_AttributesDirtyFlag=8,t.MATERIAL_MiscDirtyFlag=16,t.MATERIAL_PrePassDirtyFlag=32,t.MATERIAL_ImageProcessingDirtyFlag=64,t.MATERIAL_AllDirtyFlag=127,t.MATERIAL_TriangleFillMode=0,t.MATERIAL_WireFrameFillMode=1,t.MATERIAL_PointFillMode=2,t.MATERIAL_PointListDrawMode=3,t.MATERIAL_LineListDrawMode=4,t.MATERIAL_LineLoopDrawMode=5,t.MATERIAL_LineStripDrawMode=6,t.MATERIAL_TriangleStripDrawMode=7,t.MATERIAL_TriangleFanDrawMode=8,t.MATERIAL_ClockWiseSideOrientation=0,t.MATERIAL_CounterClockWiseSideOrientation=1,t.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR=0,t.MATERIAL_DIFFUSE_MODEL_BURLEY=1,t.MATERIAL_DIFFUSE_MODEL_LAMBERT=2,t.MATERIAL_DIFFUSE_MODEL_LEGACY=3,t.MATERIAL_DIELECTRIC_SPECULAR_MODEL_GLTF=0,t.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR=1,t.MATERIAL_CONDUCTOR_SPECULAR_MODEL_GLTF=0,t.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR=1,t.ACTION_NothingTrigger=0,t.ACTION_OnPickTrigger=1,t.ACTION_OnLeftPickTrigger=2,t.ACTION_OnRightPickTrigger=3,t.ACTION_OnCenterPickTrigger=4,t.ACTION_OnPickDownTrigger=5,t.ACTION_OnDoublePickTrigger=6,t.ACTION_OnPickUpTrigger=7,t.ACTION_OnPickOutTrigger=16,t.ACTION_OnLongPressTrigger=8,t.ACTION_OnPointerOverTrigger=9,t.ACTION_OnPointerOutTrigger=10,t.ACTION_OnEveryFrameTrigger=11,t.ACTION_OnIntersectionEnterTrigger=12,t.ACTION_OnIntersectionExitTrigger=13,t.ACTION_OnKeyDownTrigger=14,t.ACTION_OnKeyUpTrigger=15,t.PARTICLES_BILLBOARDMODE_Y=2,t.PARTICLES_BILLBOARDMODE_ALL=7,t.PARTICLES_BILLBOARDMODE_STRETCHED=8,t.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,t.MESHES_CULLINGSTRATEGY_STANDARD=0,t.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,t.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,t.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,t.SCENELOADER_NO_LOGGING=0,t.SCENELOADER_MINIMAL_LOGGING=1,t.SCENELOADER_SUMMARY_LOGGING=2,t.SCENELOADER_DETAILED_LOGGING=3,t.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,t.PREPASS_POSITION_TEXTURE_TYPE=1,t.PREPASS_VELOCITY_TEXTURE_TYPE=2,t.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,t.PREPASS_COLOR_TEXTURE_TYPE=4,t.PREPASS_DEPTH_TEXTURE_TYPE=5,t.PREPASS_NORMAL_TEXTURE_TYPE=6,t.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,t.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,t.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,t.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,t.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,t.PREPASS_ALBEDO_TEXTURE_TYPE=12,t.PREPASS_NORMALIZED_VIEW_DEPTH_TEXTURE_TYPE=13,t.BUFFER_CREATIONFLAG_READ=1,t.BUFFER_CREATIONFLAG_WRITE=2,t.BUFFER_CREATIONFLAG_READWRITE=3,t.BUFFER_CREATIONFLAG_UNIFORM=4,t.BUFFER_CREATIONFLAG_VERTEX=8,t.BUFFER_CREATIONFLAG_INDEX=16,t.BUFFER_CREATIONFLAG_STORAGE=32,t.BUFFER_CREATIONFLAG_INDIRECT=64,t.RENDERPASS_MAIN=0,t.INPUT_ALT_KEY=18,t.INPUT_CTRL_KEY=17,t.INPUT_META_KEY1=91,t.INPUT_META_KEY2=92,t.INPUT_META_KEY3=93,t.INPUT_SHIFT_KEY=16,t.SNAPSHOTRENDERING_STANDARD=0,t.SNAPSHOTRENDERING_FAST=1,t.PERSPECTIVE_CAMERA=0,t.ORTHOGRAPHIC_CAMERA=1,t.FOVMODE_VERTICAL_FIXED=0,t.FOVMODE_HORIZONTAL_FIXED=1,t.RIG_MODE_NONE=0,t.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,t.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,t.RIG_MODE_STEREOSCOPIC_INTERLACED=14,t.RIG_MODE_VR=20,t.RIG_MODE_CUSTOM=22,t.MAX_SUPPORTED_UV_SETS=6,t.GL_ALPHA_EQUATION_ADD=32774,t.GL_ALPHA_EQUATION_MIN=32775,t.GL_ALPHA_EQUATION_MAX=32776,t.GL_ALPHA_EQUATION_SUBTRACT=32778,t.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,t.GL_ALPHA_FUNCTION_SRC=768,t.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,t.GL_ALPHA_FUNCTION_SRC_ALPHA=770,t.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,t.GL_ALPHA_FUNCTION_DST_ALPHA=772,t.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,t.GL_ALPHA_FUNCTION_DST_COLOR=774,t.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,t.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,t.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,t.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,t.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,t.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,t.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,t.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,t.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,t.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,t.SnippetUrl="https://snippet.babylonjs.com",t.FOGMODE_NONE=0,t.FOGMODE_EXP=1,t.FOGMODE_EXP2=2,t.FOGMODE_LINEAR=3,t.BYTE=5120,t.UNSIGNED_BYTE=5121,t.SHORT=5122,t.UNSIGNED_SHORT=5123,t.INT=5124,t.UNSIGNED_INT=5125,t.FLOAT=5126,t.PositionKind="position",t.NormalKind="gt",t.TangentKind="tangent",t.UVKind="uv",t.UV2Kind="uv2",t.UV3Kind="uv3",t.UV4Kind="uv4",t.UV5Kind="uv5",t.UV6Kind="uv6",t.ColorKind="color",t.ColorInstanceKind="instanceColor",t.MatricesIndicesKind="matricesIndices",t.MatricesWeightsKind="matricesWeights",t.MatricesIndicesExtraKind="matricesIndicesExtra",t.MatricesWeightsExtraKind="matricesWeightsExtra",t.ANIMATIONTYPE_FLOAT=0,t.ANIMATIONTYPE_VECTOR3=1,t.ANIMATIONTYPE_QUATERNION=2,t.ANIMATIONTYPE_MATRIX=3,t.ANIMATIONTYPE_COLOR3=4,t.ANIMATIONTYPE_COLOR4=7,t.ANIMATIONTYPE_VECTOR2=5,t.ANIMATIONTYPE_SIZE=6,t.ShadowMinZ=0,t.ShadowMaxZ=1e4},11304:(s,Z,o)=>{o.d(Z,{d:()=>N});var t=o(11044),j=o(10927),S=o(11313),a=o(10968);class O{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;this._enabled=!0,this._rollingFrameTime=new v(s)}sampleFrame(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.c.Now;if(this._enabled){if(null!=this._lastFrameTimeMs){const Z=s-this._lastFrameTimeMs;this._rollingFrameTime.add(Z)}this._lastFrameTimeMs=s}}get averageFrameTime(){return this._rollingFrameTime.average}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFPS(){return 1e3/this._rollingFrameTime.average}get instantaneousFPS(){const s=this._rollingFrameTime.history(0);return 0===s?0:1e3/s}get isSaturated(){return this._rollingFrameTime.isSaturated()}enable(){this._enabled=!0}disable(){this._enabled=!1,this._lastFrameTimeMs=null}get isEnabled(){return this._enabled}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class v{constructor(s){this._samples=new Array(s),this.reset()}add(s){let Z;if(this.isSaturated()){const s=this._samples[this._pos];Z=s-this.average,this.average-=Z/(this._sampleCount-1),this._m2-=Z*(s-this.average)}else this._sampleCount++;Z=s-this.average,this.average+=Z/this._sampleCount,this._m2+=Z*(s-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=s,this._pos++,this._pos%=this._samples.length}history(s){if(s>=this._sampleCount||s>=this._samples.length)return 0;const Z=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(Z-s)]}isSaturated(){return this._sampleCount>=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(s){const Z=this._samples.length;return(s%Z+Z)%Z}}var G=o(11322),B=o(10955),Q=o(11325),D=(o(11343),o(11077));function z(s,Z,o,t){let j,S=1;1===t?j=new Float32Array(Z*o*4):2===t?(j=new Uint16Array(Z*o*4),S=15360):j=7===t?new Uint32Array(Z*o*4):new Uint8Array(Z*o*4);for(let a=0;a<Z;a++)for(let t=0;t<o;t++){const o=3*(t*Z+a),O=4*(t*Z+a);j[O+0]=s[o+0],j[O+1]=s[o+1],j[O+2]=s[o+2],j[O+3]=S}return j}function Y(s){return function(Z,o,j,S,a,O,v,G){let B=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,Q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const D=s?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,z=s?10:11,Y=new t.b(this,z);Y.baseWidth=o,Y.baseHeight=j,Y.baseDepth=S,Y.width=o,Y.height=j,Y.depth=S,Y.format=a,Y.type=Q,Y.generateMipMaps=O,Y.samplingMode=G,s?Y.is3D=!0:Y.is2DArray=!0,this._doNotHandleContextLost||(Y._bufferView=Z),s?this.updateRawTexture3D(Y,Z,a,v,B,Q):this.updateRawTexture2DArray(Y,Z,a,v,B,Q),this._bindTextureDirectly(D,Y,!0);const b=this._getSamplingParameters(G,O);return this._gl.texParameteri(D,this._gl.TEXTURE_MAG_FILTER,b.mag),this._gl.texParameteri(D,this._gl.TEXTURE_MIN_FILTER,b.min),O&&this._gl.generateMipmap(D),this._bindTextureDirectly(D,null),this._internalTexturesCache.push(Y),Y}}function b(s){return function(Z,o,t,j){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const O=s?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,v=this._getWebGLTextureType(a),G=this._getInternalFormat(t),B=this._getRGBABufferInternalSizedFormat(a,t);this._bindTextureDirectly(O,Z,!0),this._unpackFlipY(void 0===j||!!j),this._doNotHandleContextLost||(Z._bufferView=o,Z.format=t,Z.invertY=j,Z._compression=S),Z.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),S&&o?this._gl.compressedTexImage3D(O,0,this.getCaps().s3tc[S],Z.width,Z.height,Z.depth,0,o):this._gl.texImage3D(O,0,B,Z.width,Z.height,Z.depth,0,G,v,o),Z.generateMipMaps&&this._gl.generateMipmap(O),this._bindTextureDirectly(O,null),Z.isReady=!0}}S.ThinEngine.prototype.updateRawTexture=function(s,Z,o,t){let j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!s)return;const O=this._getRGBABufferInternalSizedFormat(S,o,a),v=this._getInternalFormat(o),G=this._getWebGLTextureType(S);this._bindTextureDirectly(this._gl.TEXTURE_2D,s,!0),this._unpackFlipY(void 0===t||!!t),this._doNotHandleContextLost||(s._bufferView=Z,s.format=o,s.type=S,s.invertY=t,s._compression=j),s.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),j&&Z?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[j],s.width,s.height,0,Z):this._gl.texImage2D(this._gl.TEXTURE_2D,0,O,s.width,s.height,0,v,G,Z),s.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),s.isReady=!0},S.ThinEngine.prototype.createRawTexture=function(s,Z,o,j,S,a,O){let v=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,B=arguments.length>10&&void 0!==arguments[10]&&arguments[10];const Q=new t.b(this,3);Q.baseWidth=Z,Q.baseHeight=o,Q.width=Z,Q.height=o,Q.format=j,Q.generateMipMaps=S,Q.samplingMode=O,Q.invertY=a,Q._compression=v,Q.type=G,Q._useSRGBBuffer=this._getUseSRGBBuffer(B,!S),this._doNotHandleContextLost||(Q._bufferView=s),this.updateRawTexture(Q,s,j,a,v,G,Q._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,Q,!0);const D=this._getSamplingParameters(O,S);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,D.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,D.min),S&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(Q),Q},S.ThinEngine.prototype.createRawCubeTexture=function(s,Z,o,j,S,a,O){let v=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;const G=this._gl,Q=new t.b(this,8);Q.isCube=!0,Q.format=o,Q.type=j,this._doNotHandleContextLost||(Q._bufferViewArray=s);const z=this._getWebGLTextureType(j);let Y=this._getInternalFormat(o);Y===G.RGB&&(Y=G.RGBA),z!==G.FLOAT||this._caps.textureFloatLinearFiltering?z!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?z!==G.FLOAT||this._caps.textureFloatRender?z!==G.HALF_FLOAT||this._caps.colorBufferFloat||(S=!1,B.b.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(S=!1,B.b.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(S=!1,O=1,B.b.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(S=!1,O=1,B.b.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));const b=Z,f=b;Q.width=b,Q.height=f,Q.invertY=a,Q._compression=v;if(!this.needPOTTextures||(0,D.i)(Q.width)&&(0,D.i)(Q.height)||(S=!1),s)this.updateRawCubeTexture(Q,s,o,j,a,v);else{const s=this._getRGBABufferInternalSizedFormat(j),Z=0;this._bindTextureDirectly(G.TEXTURE_CUBE_MAP,Q,!0);for(let o=0;o<6;o++)v?G.compressedTexImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_X+o,Z,this.getCaps().s3tc[v],Q.width,Q.height,0,void 0):G.texImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_X+o,Z,s,Q.width,Q.height,0,Y,z,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,Q,!0),s&&S&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);const A=this._getSamplingParameters(O,S);return G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MAG_FILTER,A.mag),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MIN_FILTER,A.min),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),this._bindTextureDirectly(G.TEXTURE_CUBE_MAP,null),Q.generateMipMaps=S,Q.samplingMode=O,Q.isReady=!0,Q},S.ThinEngine.prototype.updateRawCubeTexture=function(s,Z,o,t,j){let S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;s._bufferViewArray=Z,s.format=o,s.type=t,s.invertY=j,s._compression=S;const O=this._gl,v=this._getWebGLTextureType(t);let G=this._getInternalFormat(o);const B=this._getRGBABufferInternalSizedFormat(t);let Q=!1;G===O.RGB&&(G=O.RGBA,Q=!0),this._bindTextureDirectly(O.TEXTURE_CUBE_MAP,s,!0),this._unpackFlipY(void 0===j||!!j),s.width%4!==0&&O.pixelStorei(O.UNPACK_ALIGNMENT,1);for(let D=0;D<6;D++){let o=Z[D];S?O.compressedTexImage2D(O.TEXTURE_CUBE_MAP_POSITIVE_X+D,a,this.getCaps().s3tc[S],s.width,s.height,0,o):(Q&&(o=z(o,s.width,s.height,t)),O.texImage2D(O.TEXTURE_CUBE_MAP_POSITIVE_X+D,a,B,s.width,s.height,0,G,v,o))}(!this.needPOTTextures||(0,D.i)(s.width)&&(0,D.i)(s.height))&&s.generateMipMaps&&0===a&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),s.isReady=!0},S.ThinEngine.prototype.createRawCubeTextureFromUrl=function(s,Z,o,t,j,S,a,O){let v=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,G=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,B=arguments.length>10&&void 0!==arguments[10]?arguments[10]:3,Q=arguments.length>11&&void 0!==arguments[11]&&arguments[11];const D=this._gl,Y=this.createRawCubeTexture(null,o,t,j,!S,Q,B,null);null===Z||void 0===Z||Z.addPendingData(Y),Y.url=s,Y.isReady=!1,this._internalTexturesCache.push(Y);const b=s=>{if(!Y._hardwareTexture)return;const o=Y.width,S=a(s);if(S){if(O){const s=this._getWebGLTextureType(j);let Z=this._getInternalFormat(t);const a=this._getRGBABufferInternalSizedFormat(j);let v=!1;Z===D.RGB&&(Z=D.RGBA,v=!0),this._bindTextureDirectly(D.TEXTURE_CUBE_MAP,Y,!0),this._unpackFlipY(!1);const G=O(S);for(let t=0;t<G.length;t++){const S=o>>t;for(let o=0;o<6;o++){let O=G[t][o];v&&(O=z(O,S,S,j)),D.texImage2D(o,t,a,S,S,0,Z,s,O)}}this._bindTextureDirectly(D.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(Y,S,t,j,Q);Y.isReady=!0,null===Z||void 0===Z||Z.removePendingData(Y),Y.onLoadedObservable.notifyObservers(Y),Y.onLoadedObservable.clear(),v&&v()}};return this._loadFile(s,(s=>{b(s)}),void 0,null===Z||void 0===Z?void 0:Z.offlineProvider,!0,((s,o)=>{null===Z||void 0===Z||Z.removePendingData(Y),G&&s&&G(s.status+" "+s.statusText,o)})),Y},S.ThinEngine.prototype.createRawTexture2DArray=Y(!1),S.ThinEngine.prototype.createRawTexture3D=Y(!0),S.ThinEngine.prototype.updateRawTexture2DArray=b(!1),S.ThinEngine.prototype.updateRawTexture3D=b(!0);var f=o(11007);S.ThinEngine.prototype._readTexturePixelsSync=function(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],O=arguments.length>7&&void 0!==arguments[7]&&arguments[7],v=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,G=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const B=this._gl;if(!B)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const s=B.createFramebuffer();if(!s)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=s}var Q,D;(B.bindFramebuffer(B.FRAMEBUFFER,this._dummyFramebuffer),t>-1)?B.framebufferTexture2D(B.FRAMEBUFFER,B.COLOR_ATTACHMENT0,B.TEXTURE_CUBE_MAP_POSITIVE_X+t,null===(Q=s._hardwareTexture)||void 0===Q?void 0:Q.underlyingResource,j):B.framebufferTexture2D(B.FRAMEBUFFER,B.COLOR_ATTACHMENT0,B.TEXTURE_2D,null===(D=s._hardwareTexture)||void 0===D?void 0:D.underlyingResource,j);let z=void 0!==s.type?this._getWebGLTextureType(s.type):B.UNSIGNED_BYTE;if(O)S||(S=(0,f.l)(s.type,4*Z*o));else if(z===B.UNSIGNED_BYTE)S||(S=new Uint8Array(4*Z*o)),z=B.UNSIGNED_BYTE;else S||(S=new Float32Array(4*Z*o)),z=B.FLOAT;return a&&this.flushFramebuffer(),B.readPixels(v,G,Z,o,B.RGBA,z,S),B.bindFramebuffer(B.FRAMEBUFFER,this._currentFramebuffer),S},S.ThinEngine.prototype._readTexturePixels=function(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],O=arguments.length>7&&void 0!==arguments[7]&&arguments[7],v=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,G=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;return Promise.resolve(this._readTexturePixelsSync(s,Z,o,t,j,S,a,O,v,G))};o(11346);S.ThinEngine.prototype._createDepthStencilCubeTexture=function(s,Z){const o=new t.b(this,12);if(o.isCube=!0,1===this.webGLVersion)return B.b.Error("Depth cube texture is not supported by WebGL 1."),o;const j={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...Z},S=this._gl;this._bindTextureDirectly(S.TEXTURE_CUBE_MAP,o,!0),this._setupDepthStencilTexture(o,s,j.bilinearFiltering,j.comparisonFunction);for(let t=0;t<6;t++)j.generateStencil?S.texImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,S.DEPTH24_STENCIL8,s,s,0,S.DEPTH_STENCIL,S.UNSIGNED_INT_24_8,null):S.texImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,S.DEPTH_COMPONENT24,s,s,0,S.DEPTH_COMPONENT,S.UNSIGNED_INT,null);return this._bindTextureDirectly(S.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(o),o},S.ThinEngine.prototype._setCubeMapTextureParams=function(s,Z,o){const t=this._gl;t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,Z?t.LINEAR_MIPMAP_LINEAR:t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),s.samplingMode=Z?3:2,Z&&this.getCaps().textureMaxLevel&&void 0!==o&&o>0&&(t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAX_LEVEL,o),s._maxLodLevel=o),this._bindTextureDirectly(t.TEXTURE_CUBE_MAP,null)},S.ThinEngine.prototype.createCubeTexture=function(s,Z,o,t){let j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6?arguments[6]:void 0,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,v=arguments.length>8&&void 0!==arguments[8]&&arguments[8],G=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,Q=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,z=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,Y=arguments.length>13&&void 0!==arguments[13]&&arguments[13],b=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null;const f=this._gl;return this.createCubeTextureBase(s,Z,o,!!t,j,S,a,O,v,G,Q,z,(s=>this._bindTextureDirectly(f.TEXTURE_CUBE_MAP,s,!0)),((s,Z)=>{const o=this.needPOTTextures?(0,D.f)(Z[0].width,this._caps.maxCubemapTextureSize):Z[0].width,S=o,O=[f.TEXTURE_CUBE_MAP_POSITIVE_X,f.TEXTURE_CUBE_MAP_POSITIVE_Y,f.TEXTURE_CUBE_MAP_POSITIVE_Z,f.TEXTURE_CUBE_MAP_NEGATIVE_X,f.TEXTURE_CUBE_MAP_NEGATIVE_Y,f.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(f.TEXTURE_CUBE_MAP,s,!0),this._unpackFlipY(!1);const v=a?this._getInternalFormat(a,s._useSRGBBuffer):s._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:f.RGBA;let G=a?this._getInternalFormat(a):f.RGBA;s._useSRGBBuffer&&1===this.webGLVersion&&(G=v);for(let t=0;t<O.length;t++)if(Z[t].width!==o||Z[t].height!==S){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void B.b.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=o,this._workingCanvas.height=S,this._workingContext.drawImage(Z[t],0,0,Z[t].width,Z[t].height,0,0,o,S),f.texImage2D(O[t],0,v,G,f.UNSIGNED_BYTE,this._workingCanvas)}else f.texImage2D(O[t],0,v,G,f.UNSIGNED_BYTE,Z[t]);t||f.generateMipmap(f.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(s,!t),s.width=o,s.height=S,s.isReady=!0,a&&(s.format=a),s.onLoadedObservable.notifyObservers(s),s.onLoadedObservable.clear(),j&&j()}),!!Y,b)},S.ThinEngine.prototype.generateMipMapsForCubemap=function(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(s.generateMipMaps){const o=this._gl;this._bindTextureDirectly(o.TEXTURE_CUBE_MAP,s,!0),o.generateMipmap(o.TEXTURE_CUBE_MAP),Z&&this._bindTextureDirectly(o.TEXTURE_CUBE_MAP,null)}};o(11348);S.ThinEngine.prototype.setDepthStencilTexture=function(s,Z,o,t){void 0!==s&&(Z&&(this._boundUniforms[s]=Z),o&&o.depthStencilTexture?this._setTexture(s,o,!1,!0,t):this._setTexture(s,null,void 0,void 0,t))},S.ThinEngine.prototype.createRenderTargetCubeTexture=function(s,Z){const o=this._createHardwareRenderTargetWrapper(!1,!0,s),j={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...Z};j.generateStencilBuffer=j.generateDepthBuffer&&j.generateStencilBuffer,(1!==j.type||this._caps.textureFloatLinearFiltering)&&(2!==j.type||this._caps.textureHalfFloatLinearFiltering)||(j.samplingMode=1);const S=this._gl,a=new t.b(this,5);this._bindTextureDirectly(S.TEXTURE_CUBE_MAP,a,!0);const O=this._getSamplingParameters(j.samplingMode,j.generateMipMaps);1!==j.type||this._caps.textureFloat||(j.type=0,B.b.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_MAG_FILTER,O.mag),S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_MIN_FILTER,O.min),S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_WRAP_S,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_WRAP_T,S.CLAMP_TO_EDGE);for(let t=0;t<6;t++)S.texImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,this._getRGBABufferInternalSizedFormat(j.type,j.format),s,s,0,this._getInternalFormat(j.format),this._getWebGLTextureType(j.type),null);const v=S.createFramebuffer();return this._bindUnboundFramebuffer(v),o._depthStencilBuffer=this._setupFramebufferDepthAttachments(j.generateStencilBuffer,j.generateDepthBuffer,s,s),j.generateMipMaps&&S.generateMipmap(S.TEXTURE_CUBE_MAP),this._bindTextureDirectly(S.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),o._framebuffer=v,o._generateDepthBuffer=j.generateDepthBuffer,o._generateStencilBuffer=j.generateStencilBuffer,a.width=s,a.height=s,a.isReady=!0,a.isCube=!0,a.samples=1,a.generateMipMaps=j.generateMipMaps,a.samplingMode=j.samplingMode,a.type=j.type,a.format=j.format,this._internalTexturesCache.push(a),o.setTextures(a),o};var A=o(11367),d=o(11393);S.ThinEngine.prototype.createPrefilteredCubeTexture=function(s,Z,j,S){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6?arguments[6]:void 0,G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Q=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];return this.createCubeTexture(s,Z,null,!1,(async s=>{if(!s)return void(a&&a(null));const O=s.texture;if(Q?s.info.sphericalPolynomial&&(O._sphericalPolynomial=s.info.sphericalPolynomial):O._sphericalPolynomial=new A.h,O._source=9,this.getCaps().textureLOD)return void(a&&a(O));const v=this._gl,G=s.width;if(!G)return;const{DDSTools:D}=await o.e(26).then(o.bind(o,13498)),z=[];for(let o=0;o<3;o++){const a=1-o/2,Q=S,Y=Math.log2(G)*j+S,b=Q+(Y-Q)*a,f=Math.round(Math.min(Math.max(b,0),Y)),A=new t.b(this,2);if(A.type=O.type,A.format=O.format,A.width=Math.pow(2,Math.max(Math.log2(G)-f,0)),A.height=A.width,A.isCube=!0,A._cachedWrapU=0,A._cachedWrapV=0,this._bindTextureDirectly(v.TEXTURE_CUBE_MAP,A,!0),A.samplingMode=2,v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_MAG_FILTER,v.LINEAR),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_MIN_FILTER,v.LINEAR),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),s.isDDS){const Z=s.info,o=s.data;this._unpackFlipY(Z.isCompressed),D.UploadDDSLevels(this,A,o,Z,!0,6,f)}else B.b.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(v.TEXTURE_CUBE_MAP,null);const U=new d.b(Z);U._isCube=!0,U._texture=A,A.isReady=!0,z.push(U)}O._lodTextureHigh=z[2],O._lodTextureMid=z[1],O._lodTextureLow=z[0],a&&a(O)}),O,v,G,Q,j,S)},S.ThinEngine.prototype.createUniformBuffer=function(s,Z){const o=this._gl.createBuffer();if(!o)throw new Error("Unable to create uniform buffer");const t=new G.b(o);return this.bindUniformBuffer(t),s instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,s,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(s),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),t.references=1,t},S.ThinEngine.prototype.createDynamicUniformBuffer=function(s,Z){const o=this._gl.createBuffer();if(!o)throw new Error("Unable to create dynamic uniform buffer");const t=new G.b(o);return this.bindUniformBuffer(t),s instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,s,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(s),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),t.references=1,t},S.ThinEngine.prototype.updateUniformBuffer=function(s,Z,o,t){this.bindUniformBuffer(s),void 0===o&&(o=0),void 0===t?Z instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,o,Z):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,o,new Float32Array(Z)):Z instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,Z.subarray(o,o+t)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(Z).subarray(o,o+t)),this.bindUniformBuffer(null)},S.ThinEngine.prototype.bindUniformBuffer=function(s){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,s?s.underlyingResource:null)},S.ThinEngine.prototype.bindUniformBufferBase=function(s,Z,o){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,Z,s?s.underlyingResource:null)},S.ThinEngine.prototype.bindUniformBlock=function(s,Z,o){const t=s.program,j=this._gl.getUniformBlockIndex(t,Z);4294967295!==j&&this._gl.uniformBlockBinding(t,j,o)};var U=o(10947),u=o(11013);u.e.prototype.displayLoadingUI=function(){if(!(0,U.i)())return;const s=this.loadingScreen;s&&s.displayLoadingUI()},u.e.prototype.hideLoadingUI=function(){if(!(0,U.i)())return;const s=this._loadingScreen;s&&s.hideLoadingUI()},Object.defineProperty(u.e.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=u.e.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(s){this._loadingScreen=s},enumerable:!0,configurable:!0}),Object.defineProperty(u.e.prototype,"loadingUIText",{set:function(s){this.loadingScreen.loadingUIText=s},enumerable:!0,configurable:!0}),Object.defineProperty(u.e.prototype,"loadingUIBackgroundColor",{set:function(s){this.loadingScreen.loadingUIBackgroundColor=s},enumerable:!0,configurable:!0}),u.e.prototype.getInputElement=function(){return this._renderingCanvas},u.e.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},u.e.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},u.e.prototype.getAspectRatio=function(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const o=s.viewport;return this.getRenderWidth(Z)*o.width/(this.getRenderHeight(Z)*o.height)},u.e.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},u.e.prototype._verifyPointerLock=function(){var s;null===(s=this._onPointerLockChange)||void 0===s||s.call(this)},u.e.prototype.setAlphaEquation=function(s){if(this._alphaEquation!==s){switch(s){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=s}},u.e.prototype.getInputElement=function(){return this._renderingCanvas},u.e.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},u.e.prototype.setDepthFunction=function(s){this._depthCullingState.depthFunc=s},u.e.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},u.e.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},u.e.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},u.e.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},u.e.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},u.e.prototype.setDepthWrite=function(s){this._depthCullingState.depthMask=s},u.e.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},u.e.prototype.setStencilBuffer=function(s){this._stencilState.stencilTest=s},u.e.prototype.getStencilMask=function(){return this._stencilState.stencilMask},u.e.prototype.setStencilMask=function(s){this._stencilState.stencilMask=s},u.e.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},u.e.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},u.e.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},u.e.prototype.setStencilFunction=function(s){this._stencilState.stencilFunc=s},u.e.prototype.setStencilFunctionReference=function(s){this._stencilState.stencilFuncRef=s},u.e.prototype.setStencilFunctionMask=function(s){this._stencilState.stencilFuncMask=s},u.e.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},u.e.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},u.e.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},u.e.prototype.setStencilOperationFail=function(s){this._stencilState.stencilOpStencilFail=s},u.e.prototype.setStencilOperationDepthFail=function(s){this._stencilState.stencilOpDepthFail=s},u.e.prototype.setStencilOperationPass=function(s){this._stencilState.stencilOpStencilDepthPass=s},u.e.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},u.e.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},u.e.prototype.setAlphaConstants=function(s,Z,o,t){this._alphaState.setAlphaBlendConstants(s,Z,o,t)},u.e.prototype.getAlphaMode=function(){return this._alphaMode},u.e.prototype.getAlphaEquation=function(){return this._alphaEquation},u.e.prototype.getRenderPassNames=function(){return this._renderPassNames},u.e.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},u.e.prototype.createRenderPassId=function(s){const Z=++u.e._RenderPassIdCounter;return this._renderPassNames[Z]=s??"NONAME",Z},u.e.prototype.releaseRenderPassId=function(s){this._renderPassNames[s]=void 0;for(let Z=0;Z<this.scenes.length;++Z){const o=this.scenes[Z];for(let Z=0;Z<o.meshes.length;++Z){const t=o.meshes[Z];if(t.vO)for(let Z=0;Z<t.vO.length;++Z){t.vO[Z]._removeDrawWrapper(s)}}}};o(11361);function H(s){if(s.requestPointerLock){const Z=s.requestPointerLock();Z instanceof Promise?Z.then((()=>{s.focus()})).catch((()=>{})):s.focus()}}var F=o(11396),i=o(11009);class N extends S.ThinEngine{static get NpmPackage(){return u.e.NpmPackage}static get Version(){return u.e.Version}static get Instances(){return j.c.Instances}static get LastCreatedEngine(){return j.c.LastCreatedEngine}static get LastCreatedScene(){return j.c.LastCreatedScene}static DefaultLoadingScreenFactory(s){return u.e.DefaultLoadingScreenFactory(s)}get _supportsHardwareTextureRescaling(){return!!N._RescalePostProcessFactory}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}get performanceMonitor(){return this._performanceMonitor}constructor(s,Z,o){super(s,Z,o,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this.customAnimationFrameRequester=null,this._performanceMonitor=new O,this._drawCalls=new F.d,s&&(this._features.supportRenderPasses=!0,o=this._creationOptions)}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_sharedInit(s){super._sharedInit(s),function(s,Z,o){s._onCanvasFocus=()=>{s.onCanvasFocusObservable.notifyObservers(s)},s._onCanvasBlur=()=>{s.onCanvasBlurObservable.notifyObservers(s)},s._onCanvasContextMenu=Z=>{s.disableContextMenu&&Z.preventDefault()},Z.addEventListener("focus",s._onCanvasFocus),Z.addEventListener("blur",s._onCanvasBlur),Z.addEventListener("contextmenu",s._onCanvasContextMenu),s._onBlur=()=>{s.disablePerformanceMonitorInBackground&&s.performanceMonitor.disable(),s._windowIsBackground=!0},s._onFocus=()=>{s.disablePerformanceMonitorInBackground&&s.performanceMonitor.enable(),s._windowIsBackground=!1},s._onCanvasPointerOut=o=>{document.elementFromPoint(o.clientX,o.clientY)!==Z&&s.onCanvasPointerOutObservable.notifyObservers(o)};const t=s.getHostWindow();t&&"function"===typeof t.addEventListener&&(t.addEventListener("blur",s._onBlur),t.addEventListener("focus",s._onFocus)),Z.addEventListener("pointerout",s._onCanvasPointerOut),o.doNotHandleTouchAction||function(s){s&&s.setAttribute&&(s.setAttribute("touch-action","none"),s.style.touchAction="none",s.style.webkitTapHighlightColor="transparent")}(Z),!u.e.audioEngine&&o.audioEngine&&u.e.AudioEngineFactory&&(u.e.audioEngine=u.e.AudioEngineFactory(s.getRenderingCanvas(),s.getAudioContext(),s.getAudioDestination())),(0,U.f)()&&(s._onFullscreenChange=()=>{s.isFullscreen=!!document.fullscreenElement,s.isFullscreen&&s._pointerLockRequested&&Z&&H(Z)},document.addEventListener("fullscreenchange",s._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",s._onFullscreenChange,!1),s._onPointerLockChange=()=>{s.isPointerLock=document.pointerLockElement===Z},document.addEventListener("pointerlockchange",s._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",s._onPointerLockChange,!1)),s.enableOfflineSupport=void 0!==u.e.OfflineProviderFactory,s._deterministicLockstep=!!o.deterministicLockstep,s._lockstepMaxSteps=o.lockstepMaxSteps||0,s._timeStep=o.timeStep||1/60}(this,s,this._creationOptions)}resizeImageBitmap(s,Z,o){return function(s,Z,o,t){const j=s.createCanvas(o,t).getContext("2d");if(!j)throw new Error("Unable to get 2d context for resizeImageBitmap");return j.drawImage(Z,0,0),j.getImageData(0,0,o,t).data}(this,s,Z,o)}async _createImageBitmapFromSource(s,Z){return await async function(s,Z,o){return await new Promise(((t,j)=>{const S=new Image;S.onload=()=>{S.decode().then((()=>{s.createImageBitmap(S,o).then((s=>{t(s)}))}))},S.onerror=()=>{j(`Error loading image ${S.src}`)},S.src=Z}))}(this,s,Z)}switchFullscreen(s){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(s)}enterFullscreen(s){this.isFullscreen||(this._pointerLockRequested=s,this._renderingCanvas&&function(s){const Z=s.requestFullscreen||s.webkitRequestFullscreen;Z&&Z.call(s)}(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&function(){const s=document;document.exitFullscreen?document.exitFullscreen():s.webkitCancelFullScreen&&s.webkitCancelFullScreen()}()}setDitheringState(s){s?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(s){s?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}setDirectViewport(s,Z,o,t){const j=this._cachedViewport;return this._cachedViewport=null,this._viewport(s,Z,o,t),j}scissorClear(s,Z,o,t,j){this.enableScissor(s,Z,o,t),this.clear(j,!0,!0,!0),this.disableScissor()}enableScissor(s,Z,o,t){const j=this._gl;j.enable(j.SCISSOR_TEST),j.scissor(s,Z,o,t)}disableScissor(){const s=this._gl;s.disable(s.SCISSOR_TEST)}async _loadFileAsync(s,Z,o){return await new Promise(((t,j)=>{this._loadFile(s,(s=>{t(s)}),void 0,Z,o,((s,Z)=>{j(Z)}))}))}getVertexShaderSource(s){const Z=this._gl.getAttachedShaders(s);return Z?this._gl.getShaderSource(Z[0]):null}getFragmentShaderSource(s){const Z=this._gl.getAttachedShaders(s);return Z?this._gl.getShaderSource(Z[1]):null}set framebufferDimensionsObject(s){this._framebufferDimensionsObject=s,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}_rebuildBuffers(){for(const s of this.scenes)s.resetCachedMaterial(),s._rebuildGeometries();for(const s of this._virtualScenes)s.resetCachedMaterial(),s._rebuildGeometries();super._rebuildBuffers()}getFontOffset(s){return function(s){const Z=document.createElement("span");Z.textContent="Hg",Z.style.font=s;const o=document.createElement("div");o.style.display="inline-block",o.style.width="1px",o.style.height="0px",o.style.verticalAlign="bottom";const t=document.createElement("div");t.style.whiteSpace="nowrap",t.appendChild(Z),t.appendChild(o),document.body.appendChild(t);let j=0,S=0;try{S=o.getBoundingClientRect().top-Z.getBoundingClientRect().top,o.style.verticalAlign="baseline",j=o.getBoundingClientRect().top-Z.getBoundingClientRect().top}finally{document.body.removeChild(t)}return{ascent:j,height:S,descent:S-j}}(s)}_cancelFrame(){if(this.customAnimationFrameRequester){if(0!==this._frameHandler){this._frameHandler=0;const{cancelAnimationFrame:s}=this.customAnimationFrameRequester;s&&s(this.customAnimationFrameRequester.D)}}else super._cancelFrame()}_renderLoop(s){this._processFrame(s),this._activeRenderLoops.length>0&&0===this._frameHandler&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.D=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.D):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}enterPointerlock(){this._renderingCanvas&&H(this._renderingCanvas)}exitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}AQ(){this._measureFps(),super.AQ()}_deletePipelineContext(s){const Z=s;Z&&Z.program&&Z.transformFeedback&&(this.deleteTransformFeedback(Z.transformFeedback),Z.transformFeedback=null),super._deletePipelineContext(s)}createShaderProgram(s,Z,o,t,j){let S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;j=j||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const a=super.createShaderProgram(s,Z,o,t,j,S);return this.onAfterShaderCompilationObservable.notifyObservers(this),a}_createShaderProgram(s,Z,o,t){let j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const S=t.createProgram();if(s.program=S,!S)throw new Error("Unable to create program");if(t.attachShader(S,Z),t.attachShader(S,o),this.webGLVersion>1&&j){const Z=this.createTransformFeedback();this.bindTransformFeedback(Z),this.setTranformFeedbackVaryings(S,j),s.transformFeedback=Z}return t.linkProgram(S),this.webGLVersion>1&&j&&this.bindTransformFeedback(null),s.context=t,s.vertexShader=Z,s.fragmentShader=o,s.isParallelCompiled||this._finalizePipelineContext(s),S}_releaseTexture(s){super._releaseTexture(s)}_releaseRenderTargetWrapper(s){super._releaseRenderTargetWrapper(s);for(const Z of this.scenes){for(const o of Z.postProcesses)o._outputTexture===s&&(o._outputTexture=null);for(const o of Z.cameras)for(const Z of o._postProcesses)Z&&Z._outputTexture===s&&(Z._outputTexture=null)}}_rescaleTexture(s,Z,o,t,j){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const S=this.createRenderTargetTexture({width:Z.width,height:Z.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});if(!this._rescalePostProcess&&N._RescalePostProcessFactory&&(this._rescalePostProcess=N._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;const a=()=>{this._rescalePostProcess.onApply=function(Z){Z._bindTexture("textureSampler",s)};let a=o;a||(a=this.scenes[this.scenes.length-1]),a.postProcessManager.directRender([this._rescalePostProcess],S,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,Z,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,t,0,0,Z.width,Z.height,0),this.unBindFramebuffer(S),S.dispose(),j&&j()},O=this._rescalePostProcess.getEffect();O?O.executeWhenCompiled(a):this._rescalePostProcess.onEffectCreatedObservable.addOnce((s=>{s.executeWhenCompiled(a)}))}}wrapWebGLTexture(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const a=new Q.e(s,this._gl),O=new t.b(this,0,!0);return O._hardwareTexture=a,O.baseWidth=j,O.baseHeight=S,O.width=j,O.height=S,O.isReady=!0,O.useMipMaps=Z,this.updateTextureSamplingMode(o,O),O}_uploadImageToTexture(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const j=this._gl,S=this._getWebGLTextureType(s.type),a=this._getInternalFormat(s.format),O=this._getRGBABufferInternalSizedFormat(s.type,a),v=s.isCube?j.TEXTURE_CUBE_MAP:j.TEXTURE_2D;this._bindTextureDirectly(v,s,!0),this._unpackFlipY(s.invertY);let G=j.TEXTURE_2D;s.isCube&&(G=j.TEXTURE_CUBE_MAP_POSITIVE_X+o),j.texImage2D(G,t,O,a,S,Z),this._bindTextureDirectly(v,null,!0)}updateTextureComparisonFunction(s,Z){if(1===this.webGLVersion)return void B.b.Error("WebGL 1 does not support texture comparison.");const o=this._gl;s.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,s,!0),0===Z?(o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_COMPARE_FUNC,515),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_COMPARE_MODE,o.NONE)):(o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_COMPARE_FUNC,Z),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_COMPARE_MODE,o.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,s,!0),0===Z?(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_COMPARE_FUNC,515),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_COMPARE_MODE,o.NONE)):(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_COMPARE_FUNC,Z),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_COMPARE_MODE,o.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),s._comparisonFunction=Z}createInstancesBuffer(s){const Z=this._gl.createBuffer();if(!Z)throw new Error("Unable to create instance buffer");const o=new G.b(Z);return o.eZ=s,this.bindArrayBuffer(o),this._gl.bufferData(this._gl.ARRAY_BUFFER,s,this._gl.DYNAMIC_DRAW),o.references=1,o}deleteInstancesBuffer(s){this._gl.deleteBuffer(s)}async _clientWaitAsync(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;const t=this._gl;return await new Promise(((j,S)=>{(0,i.d)((()=>{const o=t.clientWaitSync(s,Z,0);if(o==t.WAIT_FAILED)throw new Error("clientWaitSync failed");return o!=t.TIMEOUT_EXPIRED}),j,S,o)}))}_readPixelsAsync(s,Z,o,t,j,S,a){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const O=this._gl,v=O.createBuffer();O.bindBuffer(O.PIXEL_PACK_BUFFER,v),O.bufferData(O.PIXEL_PACK_BUFFER,a.byteLength,O.STREAM_READ),O.readPixels(s,Z,o,t,j,S,0),O.bindBuffer(O.PIXEL_PACK_BUFFER,null);const G=O.fenceSync(O.SYNC_GPU_COMMANDS_COMPLETE,0);return G?(O.flush(),this._clientWaitAsync(G,0,10).then((()=>(O.deleteSync(G),O.bindBuffer(O.PIXEL_PACK_BUFFER,v),O.getBufferSubData(O.PIXEL_PACK_BUFFER,0,a),O.bindBuffer(O.PIXEL_PACK_BUFFER,null),O.deleteBuffer(v),a)))):null}dispose(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),function(s,Z){1===j.c.Instances.length&&u.e.audioEngine&&(u.e.audioEngine.dispose(),u.e.audioEngine=null);const o=s.getHostWindow();o&&"function"===typeof o.removeEventListener&&(o.removeEventListener("blur",s._onBlur),o.removeEventListener("focus",s._onFocus)),Z&&(Z.removeEventListener("focus",s._onCanvasFocus),Z.removeEventListener("blur",s._onCanvasBlur),Z.removeEventListener("pointerout",s._onCanvasPointerOut),Z.removeEventListener("contextmenu",s._onCanvasContextMenu)),(0,U.f)()&&(document.removeEventListener("fullscreenchange",s._onFullscreenChange),document.removeEventListener("mozfullscreenchange",s._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",s._onFullscreenChange),document.removeEventListener("msfullscreenchange",s._onFullscreenChange),document.removeEventListener("pointerlockchange",s._onPointerLockChange),document.removeEventListener("mspointerlockchange",s._onPointerLockChange),document.removeEventListener("mozpointerlockchange",s._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",s._onPointerLockChange))}(this,this._renderingCanvas),super.dispose()}}N.ALPHA_DISABLE=0,N.ALPHA_ADD=1,N.ALPHA_COMBINE=2,N.ALPHA_SUBTRACT=3,N.ALPHA_MULTIPLY=4,N.ALPHA_MAXIMIZED=5,N.ALPHA_ONEONE=6,N.ALPHA_PREMULTIPLIED=7,N.ALPHA_PREMULTIPLIED_PORTERDUFF=8,N.ALPHA_INTERPOLATE=9,N.ALPHA_SCREENMODE=10,N.DELAYLOADSTATE_NONE=0,N.DELAYLOADSTATE_LOADED=1,N.DELAYLOADSTATE_LOADING=2,N.DELAYLOADSTATE_NOTLOADED=4,N.NEVER=512,N.ALWAYS=519,N.LESS=513,N.EQUAL=514,N.LEQUAL=515,N.GREATER=516,N.GEQUAL=518,N.NOTEQUAL=517,N.KEEP=7680,N.REPLACE=7681,N.INCR=7682,N.DECR=7683,N.INVERT=5386,N.INCR_WRAP=34055,N.DECR_WRAP=34056,N.TEXTURE_CLAMP_ADDRESSMODE=0,N.TEXTURE_WRAP_ADDRESSMODE=1,N.TEXTURE_MIRROR_ADDRESSMODE=2,N.TEXTUREFORMAT_ALPHA=0,N.TEXTUREFORMAT_LUMINANCE=1,N.TEXTUREFORMAT_LUMINANCE_ALPHA=2,N.TEXTUREFORMAT_RGB=4,N.TEXTUREFORMAT_RGBA=5,N.TEXTUREFORMAT_RED=6,N.TEXTUREFORMAT_R=6,N.TEXTUREFORMAT_R16_UNORM=33322,N.TEXTUREFORMAT_RG16_UNORM=33324,N.TEXTUREFORMAT_RGB16_UNORM=32852,N.TEXTUREFORMAT_RGBA16_UNORM=32859,N.TEXTUREFORMAT_R16_SNORM=36760,N.TEXTUREFORMAT_RG16_SNORM=36761,N.TEXTUREFORMAT_RGB16_SNORM=36762,N.TEXTUREFORMAT_RGBA16_SNORM=36763,N.TEXTUREFORMAT_RG=7,N.TEXTUREFORMAT_RED_INTEGER=8,N.TEXTUREFORMAT_R_INTEGER=8,N.TEXTUREFORMAT_RG_INTEGER=9,N.TEXTUREFORMAT_RGB_INTEGER=10,N.TEXTUREFORMAT_RGBA_INTEGER=11,N.TEXTURETYPE_UNSIGNED_BYTE=0,N.TEXTURETYPE_UNSIGNED_INT=0,N.TEXTURETYPE_FLOAT=1,N.TEXTURETYPE_HALF_FLOAT=2,N.TEXTURETYPE_BYTE=3,N.TEXTURETYPE_SHORT=4,N.TEXTURETYPE_UNSIGNED_SHORT=5,N.TEXTURETYPE_INT=6,N.TEXTURETYPE_UNSIGNED_INTEGER=7,N.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,N.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,N.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,N.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,N.TEXTURETYPE_UNSIGNED_INT_24_8=12,N.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,N.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,N.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,N.TEXTURE_NEAREST_SAMPLINGMODE=1,N.TEXTURE_BILINEAR_SAMPLINGMODE=2,N.TEXTURE_TRILINEAR_SAMPLINGMODE=3,N.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,N.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,N.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,N.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,N.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,N.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,N.TEXTURE_NEAREST_LINEAR=7,N.TEXTURE_NEAREST_NEAREST=1,N.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,N.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,N.TEXTURE_LINEAR_LINEAR=2,N.TEXTURE_LINEAR_NEAREST=12,N.TEXTURE_EXPLICIT_MODE=0,N.TEXTURE_SPHERICAL_MODE=1,N.TEXTURE_PLANAR_MODE=2,N.TEXTURE_CUBIC_MODE=3,N.TEXTURE_PROJECTION_MODE=4,N.TEXTURE_SKYBOX_MODE=5,N.TEXTURE_INVCUBIC_MODE=6,N.TEXTURE_EQUIRECTANGULAR_MODE=7,N.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,N.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,N.SCALEMODE_FLOOR=1,N.SCALEMODE_NEAREST=2,N.SCALEMODE_CEILING=3},10927:(s,Z,o)=>{o.d(Z,{c:()=>j});var t=o(10932);class j{static get LastCreatedEngine(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}static get LastCreatedScene(){return this._LastCreatedScene}}j.Instances=[],j.OnEnginesDisposedObservable=new t.b,j._LastCreatedScene=null,j.UseFallbackTexture=!0,j.FallbackTexture=""},10924:(s,Z,o)=>{o.d(Z,{e:()=>t});class t{static SetMatrixPrecision(s){if(t.MatrixTrackPrecisionChange=!1,s&&!t.MatrixUse64Bits&&t.MatrixTrackedMatrices)for(let Z=0;Z<t.MatrixTrackedMatrices.length;++Z){const s=t.MatrixTrackedMatrices[Z],o=s.mQ;s.mQ=new Array(16);for(let Z=0;Z<16;++Z)s.mQ[Z]=o[Z]}t.MatrixUse64Bits=s,t.MatrixCurrentType=t.MatrixUse64Bits?Array:Float32Array,t.MatrixTrackedMatrices=null}}t.MatrixUse64Bits=!1,t.MatrixTrackPrecisionChange=!0,t.MatrixCurrentType=Float32Array,t.MatrixTrackedMatrices=[]},11357:(s,Z,o)=>{o.d(Z,{c:()=>j});var t=o(11334);class j{get depthStencilTexture(){return this._depthStencilTexture}setDepthStencilTexture(s){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this._depthStencilTexture&&this._depthStencilTexture.dispose(),this._depthStencilTexture=s,this._generateDepthBuffer=this._generateStencilBuffer=this._depthStencilTextureWithStencil=!1,s&&(this._generateDepthBuffer=!0,this._generateStencilBuffer=this._depthStencilTextureWithStencil=(0,t.e)(s.format))}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}get isCube(){return this._isCube}get isMulti(){return this._isMulti}get is2DArray(){return this.layers>0}get is3D(){return this.depth>0}get size(){return this.width}get width(){return this._size.width??this._size}get height(){return this._size.height??this._size}get layers(){return this._size.layers||0}get depth(){return this._size.depth||0}get texture(){var s;return(null===(s=this._textures)||void 0===s?void 0:s[0])??null}get textures(){return this._textures}get faceIndices(){return this._faceIndices}get layerIndices(){return this._layerIndices}getBaseArrayLayer(s){var Z,o;if(!this._textures)return-1;const t=this._textures[s],j=(null===(Z=this._layerIndices)||void 0===Z?void 0:Z[s])??0,S=(null===(o=this._faceIndices)||void 0===o?void 0:o[s])??0;return t.isCube?6*j+S:t.is3D?0:j}get samples(){return this._samples}setSamples(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.samples===s&&!o)return s;const t=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,s,Z):this._engine.updateRenderTargetTextureSampleCount(this,s);return this._samples=s,t}resolveMSAATextures(){this.isMulti?this._engine.resolveMultiFramebuffer(this):this._engine.resolveFramebuffer(this)}generateMipMaps(){this._engine._currentRenderTarget===this&&this._engine.unBindFramebuffer(this,!0),this.isMulti?this._engine.generateMipMapsMultiFramebuffer(this):this._engine.generateMipMapsFramebuffer(this)}constructor(s,Z,o,t,j){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this.disableAutomaticMSAAResolve=!1,this.resolveMSAAColors=!0,this.resolveMSAADepth=!1,this.resolveMSAAStencil=!1,this._isMulti=s,this._isCube=Z,this._size=o,this._engine=t,this._depthStencilTexture=null,this.label=j}setTextures(s){Array.isArray(s)?this._textures=s:this._textures=s?[s]:null}setTexture(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._textures||(this._textures=[]),this._textures[Z]!==s&&(this._textures[Z]&&o&&this._textures[Z].dispose(),this._textures[Z]=s)}setLayerAndFaceIndices(s,Z){this._layerIndices=s,this._faceIndices=Z}setLayerAndFaceIndex(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),void 0!==Z&&Z>=0&&(this._layerIndices[s]=Z),void 0!==o&&o>=0&&(this._faceIndices[s]=o)}createDepthStencilTexture(){var s;let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,a=arguments.length>5?arguments[5]:void 0;return null===(s=this._depthStencilTexture)||void 0===s||s.dispose(),this._depthStencilTextureWithStencil=t,this._depthStencilTextureLabel=a,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:o,comparisonFunction:Z,generateStencil:t,isCube:this._isCube,samples:j,depthTextureFormat:S,label:a},this),this._depthStencilTexture}_shareDepth(s){this.shareDepth(s)}shareDepth(s){this._depthStencilTexture&&(s._depthStencilTexture&&s._depthStencilTexture.dispose(),s._depthStencilTexture=this._depthStencilTexture,s._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}_swapAndDie(s){this.texture&&this.texture._swapAndDie(s),this._textures=null,this.dispose(!0)}_cloneRenderTargetWrapper(){let s=null;if(this._isMulti){const Z=this.textures;if(Z&&Z.length>0){let o=!1,t=Z.length,j=-1;const S=Z[Z.length-1]._source;14!==S&&12!==S||(o=!0,j=Z[Z.length-1].format,t--);const a=[],O=[],v=[],G=[],B=[],Q=[],D=[],z={};for(let s=0;s<t;++s){const o=Z[s];a.push(o.samplingMode),O.push(o.type),v.push(o.format);void 0!==z[o.uniqueId]?(G.push(-1),D.push(0)):(z[o.uniqueId]=s,o.is2DArray?(G.push(35866),D.push(o.depth)):o.isCube?(G.push(34067),D.push(0)):o.is3D?(G.push(32879),D.push(o.depth)):(G.push(3553),D.push(0))),this._faceIndices&&B.push(this._faceIndices[s]??0),this._layerIndices&&Q.push(this._layerIndices[s]??0)}const Y={samplingModes:a,generateMipMaps:Z[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:o,depthTextureFormat:j,types:O,formats:v,textureCount:t,targetTypes:G,faceIndex:B,layerIndex:Q,layerCounts:D,label:this.label},b={width:this.width,height:this.height,depth:this.depth};s=this._engine.createMultipleRenderTarget(b,Y);for(let f=0;f<t;++f){if(-1!==G[f])continue;const o=z[Z[f].uniqueId];s.setTexture(s.textures[o],f)}}}else{var Z,o,t,j;const a={};if(a.generateDepthBuffer=this._generateDepthBuffer,a.generateMipMaps=(null===(Z=this.texture)||void 0===Z?void 0:Z.generateMipMaps)??!1,a.generateStencilBuffer=this._generateStencilBuffer,a.samplingMode=null===(o=this.texture)||void 0===o?void 0:o.samplingMode,a.type=null===(t=this.texture)||void 0===t?void 0:t.type,a.format=null===(j=this.texture)||void 0===j?void 0:j.format,a.noColorAttachment=!this._textures,a.label=this.label,this.isCube)s=this._engine.createRenderTargetCubeTexture(this.width,a);else{var S;const Z={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?null===(S=this.texture)||void 0===S?void 0:S.depth:void 0};s=this._engine.createRenderTargetTexture(Z,a)}s.texture&&(s.texture.isReady=!0)}return s}_swapRenderTargetWrapper(s){if(this._textures&&s._textures)for(let Z=0;Z<this._textures.length;++Z)this._textures[Z]._swapAndDie(s._textures[Z],!1),s._textures[Z].isReady=!0;this._depthStencilTexture&&s._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(s._depthStencilTexture),s._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}_rebuild(){const s=this._cloneRenderTargetWrapper();if(s){if(this._depthStencilTexture){const Z=this._depthStencilTexture.samplingMode,o=this._depthStencilTexture.format,t=2===Z||3===Z||11===Z;s.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,t,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,o,this._depthStencilTextureLabel)}this.samples>1&&s.setSamples(this.samples),s._swapRenderTargetWrapper(this),s.dispose()}}releaseTextures(){if(this._textures)for(let s=0;s<this._textures.length;++s)this._textures[s].dispose();this._textures=null}dispose(){var s;arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(null===(s=this._depthStencilTexture)||void 0===s||s.dispose(),this._depthStencilTexture=null,this.releaseTextures());this._engine._releaseRenderTargetWrapper(this)}}},11026:(s,Z,o)=>{o.d(Z,{d:()=>t});class t{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?t.ShadersRepository:t.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?t.ShadersStore:t.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?t.IncludesShadersStore:t.IncludesShadersStoreWGSL}}t.ShadersRepository="src/Shaders/",t.ShadersStore={},t.IncludesShadersStore={},t.ShadersRepositoryWGSL="src/ShadersWGSL/",t.ShadersStoreWGSL={},t.IncludesShadersStoreWGSL={}},11037:(s,Z,o)=>{o.d(Z,{c:()=>D,g:()=>U,i:()=>Y,j:()=>z,m:()=>b,o:()=>d,s:()=>Q,v:()=>G,y:()=>B,z:()=>v,C:()=>O});class t{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.wa._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(s){s&&this.program&&s(this.program)}setEngine(s){this.wa=s}_fillEffectInformation(s,Z,o,t,j,S,a,O){const v=this.wa;if(v.supportsUniformBuffers)for(const B in Z)s.bindUniformBlock(B,Z[B]);let G;for(this.wa.getUniforms(this,o).forEach(((s,Z)=>{t[o[Z]]=s})),this._uniforms=t,G=0;G<j.length;G++){null==s.getUniform(j[G])&&(j.splice(G,1),G--)}j.forEach(((s,Z)=>{S[s]=Z}));for(const B of v.getAttributes(this,a))O.push(B)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(s,Z){const o=this._valueCache[s],t=Z.updateFlag;return(void 0===o||o!==t)&&(this._valueCache[s]=t,!0)}_cacheFloat2(s,Z,o){let t=this._valueCache[s];if(!t||2!==t.length)return t=[Z,o],this._valueCache[s]=t,!0;let j=!1;return t[0]!==Z&&(t[0]=Z,j=!0),t[1]!==o&&(t[1]=o,j=!0),j}_cacheFloat3(s,Z,o,t){let j=this._valueCache[s];if(!j||3!==j.length)return j=[Z,o,t],this._valueCache[s]=j,!0;let S=!1;return j[0]!==Z&&(j[0]=Z,S=!0),j[1]!==o&&(j[1]=o,S=!0),j[2]!==t&&(j[2]=t,S=!0),S}_cacheFloat4(s,Z,o,t,j){let S=this._valueCache[s];if(!S||4!==S.length)return S=[Z,o,t,j],this._valueCache[s]=S,!0;let a=!1;return S[0]!==Z&&(S[0]=Z,a=!0),S[1]!==o&&(S[1]=o,a=!0),S[2]!==t&&(S[2]=t,a=!0),S[3]!==j&&(S[3]=j,a=!0),a}setInt(s,Z){const o=this._valueCache[s];void 0!==o&&o===Z||this.wa.setInt(this._uniforms[s],Z)&&(this._valueCache[s]=Z)}setInt2(s,Z,o){this._cacheFloat2(s,Z,o)&&(this.wa.setInt2(this._uniforms[s],Z,o)||(this._valueCache[s]=null))}setInt3(s,Z,o,t){this._cacheFloat3(s,Z,o,t)&&(this.wa.setInt3(this._uniforms[s],Z,o,t)||(this._valueCache[s]=null))}setInt4(s,Z,o,t,j){this._cacheFloat4(s,Z,o,t,j)&&(this.wa.setInt4(this._uniforms[s],Z,o,t,j)||(this._valueCache[s]=null))}setIntArray(s,Z){this._valueCache[s]=null,this.wa.setIntArray(this._uniforms[s],Z)}setIntArray2(s,Z){this._valueCache[s]=null,this.wa.setIntArray2(this._uniforms[s],Z)}setIntArray3(s,Z){this._valueCache[s]=null,this.wa.setIntArray3(this._uniforms[s],Z)}setIntArray4(s,Z){this._valueCache[s]=null,this.wa.setIntArray4(this._uniforms[s],Z)}setUInt(s,Z){const o=this._valueCache[s];void 0!==o&&o===Z||this.wa.setUInt(this._uniforms[s],Z)&&(this._valueCache[s]=Z)}setUInt2(s,Z,o){this._cacheFloat2(s,Z,o)&&(this.wa.setUInt2(this._uniforms[s],Z,o)||(this._valueCache[s]=null))}setUInt3(s,Z,o,t){this._cacheFloat3(s,Z,o,t)&&(this.wa.setUInt3(this._uniforms[s],Z,o,t)||(this._valueCache[s]=null))}setUInt4(s,Z,o,t,j){this._cacheFloat4(s,Z,o,t,j)&&(this.wa.setUInt4(this._uniforms[s],Z,o,t,j)||(this._valueCache[s]=null))}setUIntArray(s,Z){this._valueCache[s]=null,this.wa.setUIntArray(this._uniforms[s],Z)}setUIntArray2(s,Z){this._valueCache[s]=null,this.wa.setUIntArray2(this._uniforms[s],Z)}setUIntArray3(s,Z){this._valueCache[s]=null,this.wa.setUIntArray3(this._uniforms[s],Z)}setUIntArray4(s,Z){this._valueCache[s]=null,this.wa.setUIntArray4(this._uniforms[s],Z)}setArray(s,Z){this._valueCache[s]=null,this.wa.setArray(this._uniforms[s],Z)}setArray2(s,Z){this._valueCache[s]=null,this.wa.setArray2(this._uniforms[s],Z)}setArray3(s,Z){this._valueCache[s]=null,this.wa.setArray3(this._uniforms[s],Z)}setArray4(s,Z){this._valueCache[s]=null,this.wa.setArray4(this._uniforms[s],Z)}setMatrices(s,Z){Z&&(this._valueCache[s]=null,this.wa.setMatrices(this._uniforms[s],Z))}setMatrix(s,Z){this._cacheMatrix(s,Z)&&(this.wa.setMatrices(this._uniforms[s],Z.ma())||(this._valueCache[s]=null))}setMatrix3x3(s,Z){this._valueCache[s]=null,this.wa.setMatrix3x3(this._uniforms[s],Z)}setMatrix2x2(s,Z){this._valueCache[s]=null,this.wa.setMatrix2x2(this._uniforms[s],Z)}setFloat(s,Z){const o=this._valueCache[s];void 0!==o&&o===Z||this.wa.setFloat(this._uniforms[s],Z)&&(this._valueCache[s]=Z)}setVector2(s,Z){this._cacheFloat2(s,Z.x,Z.y)&&(this.wa.setFloat2(this._uniforms[s],Z.x,Z.y)||(this._valueCache[s]=null))}setFloat2(s,Z,o){this._cacheFloat2(s,Z,o)&&(this.wa.setFloat2(this._uniforms[s],Z,o)||(this._valueCache[s]=null))}setVector3(s,Z){this._cacheFloat3(s,Z.x,Z.y,Z.z)&&(this.wa.setFloat3(this._uniforms[s],Z.x,Z.y,Z.z)||(this._valueCache[s]=null))}setFloat3(s,Z,o,t){this._cacheFloat3(s,Z,o,t)&&(this.wa.setFloat3(this._uniforms[s],Z,o,t)||(this._valueCache[s]=null))}setVector4(s,Z){this._cacheFloat4(s,Z.x,Z.y,Z.z,Z.w)&&(this.wa.setFloat4(this._uniforms[s],Z.x,Z.y,Z.z,Z.w)||(this._valueCache[s]=null))}setQuaternion(s,Z){this._cacheFloat4(s,Z.x,Z.y,Z.z,Z.w)&&(this.wa.setFloat4(this._uniforms[s],Z.x,Z.y,Z.z,Z.w)||(this._valueCache[s]=null))}setFloat4(s,Z,o,t,j){this._cacheFloat4(s,Z,o,t,j)&&(this.wa.setFloat4(this._uniforms[s],Z,o,t,j)||(this._valueCache[s]=null))}setColor3(s,Z){this._cacheFloat3(s,Z.r,Z.g,Z.b)&&(this.wa.setFloat3(this._uniforms[s],Z.r,Z.g,Z.b)||(this._valueCache[s]=null))}setColor4(s,Z,o){this._cacheFloat4(s,Z.r,Z.g,Z.b,o)&&(this.wa.setFloat4(this._uniforms[s],Z.r,Z.g,Z.b,o)||(this._valueCache[s]=null))}setDirectColor4(s,Z){this._cacheFloat4(s,Z.r,Z.g,Z.b,Z.a)&&(this.wa.setFloat4(this._uniforms[s],Z.r,Z.g,Z.b,Z.a)||(this._valueCache[s]=null))}_getVertexShaderCode(){return this.vertexShader?this.wa._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.wa._getShaderSource(this.fragmentShader):null}}var j=o(11007);const S=new WeakMap,a={_webGLVersion:2,cachedPipelines:{}};function O(s){let Z=S.get(s);if(!Z){if(!s)return a;Z={_webGLVersion:s.TEXTURE_BINDING_3D?2:1,_context:s,parallelShaderCompile:s.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},S.set(s,Z)}return Z}function v(s){S.delete(s)}function G(s,Z,o,t,j,S){const a=O(t);S||(S=a._createShaderProgramInjection??D);return S(s,A(Z,"vertex",t,a._contextWasLost),A(o,"fragment",t,a._contextWasLost),t,j,a.validateShaderPrograms)}function B(s,Z,o,t,j){let S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6?arguments[6]:void 0;const v=O(j);a||(a=v._createShaderProgramInjection??D);const G=v._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return a(s,f(Z,"vertex",t,G,j,v._contextWasLost),f(o,"fragment",t,G,j,v._contextWasLost),j,S,v.validateShaderPrograms)}function Q(s,Z){const o=new t,j=O(s);return j.parallelShaderCompile&&!j.disableParallelShaderCompile&&(o.isParallelCompiled=!0),o.context=j._context,o}function D(s,Z,o,t){let j=arguments.length>5?arguments[5]:void 0;const S=t.createProgram();if(s.program=S,!S)throw new Error("Unable to create program");return t.attachShader(S,Z),t.attachShader(S,o),t.linkProgram(S),s.context=t,s.vertexShader=Z,s.fragmentShader=o,s.isParallelCompiled||Y(s,t,j),S}function z(s,Z,o){const t=s;if(t._isDisposed)return!1;const j=O(Z);return!!(j&&j.parallelShaderCompile&&j.parallelShaderCompile.COMPLETION_STATUS_KHR&&t.program&&Z.getProgramParameter(t.program,j.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(Y(t,Z,o),!0)}function Y(s,Z,o){const t=s.context,j=s.vertexShader,S=s.fragmentShader,a=s.program;if(!t.getProgramParameter(a,t.LINK_STATUS)){if(!Z.getShaderParameter(j,Z.COMPILE_STATUS)){const o=Z.getShaderInfoLog(j);if(o)throw s.vertexCompilationError=o,new Error("VERTEX SHADER "+o)}if(!Z.getShaderParameter(S,Z.COMPILE_STATUS)){const o=Z.getShaderInfoLog(S);if(o)throw s.fragmentCompilationError=o,new Error("FRAGMENT SHADER "+o)}const o=t.getProgramInfoLog(a);if(o)throw s.programLinkError=o,new Error(o)}if(o){t.validateProgram(a);if(!t.getProgramParameter(a,t.VALIDATE_STATUS)){const Z=t.getProgramInfoLog(a);if(Z)throw s.programValidationError=Z,new Error(Z)}}t.deleteShader(j),t.deleteShader(S),s.vertexShader=void 0,s.fragmentShader=void 0,s.onCompiled&&(s.onCompiled(),s.onCompiled=void 0)}function b(s,Z,o,t,j,S,a,v,Q){let D=arguments.length>10?arguments[10]:void 0,z=arguments.length>11?arguments[11]:void 0,Y=arguments.length>12?arguments[12]:void 0;const b=O(s.context);z||(z=b.createRawShaderProgramInjection??G),Y||(Y=b.createShaderProgramInjection??B);const f=s;f.program=t?z(f,Z,o,f.context,Q):Y(f,Z,o,v,f.context,Q),f.program.__SPECTOR_rebuildProgram=a,D()}function f(s,Z,o,t,S,a){return A((0,j.f)(s,o,t),Z,S,a)}function A(s,Z,o,t){const j=o.createShader("vertex"===Z?o.VERTEX_SHADER:o.FRAGMENT_SHADER);if(!j){let s=o.NO_ERROR,j=o.NO_ERROR;for(;(j=o.getError())!==o.NO_ERROR;)s=j;throw new Error(`Something went wrong while creating a gl ${Z} shader object. gl error=${s}, gl isContextLost=${o.isContextLost()}, _contextWasLost=${t}`)}return o.shaderSource(j,s),o.compileShader(j),j}function d(s,Z){Z.useProgram(s)}function U(s,Z){const o=s;if(!o.isParallelCompiled)return void Z(s);const t=o.onCompiled;o.onCompiled=()=>{null===t||void 0===t||t(),Z(s)}}},11313:(s,Z,o)=>{o.r(Z),o.d(Z,{ThinEngine:()=>u});var t=o(11037),j=o(11318),S=o(10955),a=o(10947);class O{constructor(){this.shaderLanguage=0}postProcessor(s,Z,o,t,j){if(j.drawBuffersExtensionDisabled){const Z=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;s=s.replace(Z,"")}return s}}const v=/(flat\s)?\s*varying\s*.*/;class G{constructor(){this.shaderLanguage=0}attributeProcessor(s){return s.replace("attribute","in")}varyingCheck(s,Z){return v.test(s)}varyingProcessor(s,Z){return s.replace("varying",Z?"in":"out")}postProcessor(s,Z,o){const t=-1!==s.search(/#extension.+GL_EXT_draw_buffers.+require/);if(s=(s=s.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),o){const Z=-1!==s.search(/layout *\(location *= *0\) *out/g);s=(s=(s=(s=(s=(s=(s=s.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(t||Z?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==Z.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+s}return s}}var B=o(11322),Q=o(11077),D=o(11013),z=o(11325),Y=o(11044),b=o(11019),f=o(11007),A=o(11029),d=o(11334);class U{}class u extends D.e{get name(){return this._name}set name(s){this._name=s}get version(){return this._webGLVersion}static get ShadersRepository(){return b.d.ShadersRepository}static set ShadersRepository(s){b.d.ShadersRepository=s}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(s){this._framebufferDimensionsObject=s}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(s,Z,o,j){if(o=o||{},super(Z??o.antialias,o,j),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!s)return;let a=null;if(s.getContext){if(a=s,void 0===o.yG&&(o.yG=!1),void 0===o.xrCompatible&&(o.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const s=navigator.userAgent;for(const Z of u.ExceptionList){const t=Z.key,j=Z.targets;if(new RegExp(t).test(s)){if(Z.capture&&Z.captureConstraint){const o=Z.capture,t=Z.captureConstraint,j=new RegExp(o).exec(s);if(j&&j.length>0){if(parseInt(j[j.length-1])>=t)continue}}for(const s of j)switch(s){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":o.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost?this._onContextLost=()=>{(0,t.z)(this._gl)}:(this._onContextLost=s=>{s.preventDefault(),this._contextWasLost=!0,(0,t.z)(this._gl),S.b.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},a.addEventListener("webglcontextrestored",this._onContextRestored,!1),o.powerPreference=o.powerPreference||"high-performance"),a.addEventListener("webglcontextlost",this._onContextLost,!1),this._badDesktopOS&&(o.xrCompatible=!1),!o.disableWebGL2Support)try{this._gl=a.getContext("webgl2",o)||a.getContext("experimental-webgl2",o),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(Q){}if(!this._gl){if(!a)throw new Error("The provided canvas is null or undefined.");try{this._gl=a.getContext("webgl",o)||a.getContext("experimental-webgl",o)}catch(Q){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=s,a=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const Z=this._gl.getContextAttributes();Z&&(o.stencil=Z.stencil)}this._sharedInit(a),this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==o.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=o.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let t=0;t<this._caps.maxVertexAttribs;t++)this._currentBufferPointers[t]=new U;this._shaderProcessor=this.webGLVersion>1?new G:new O;const v=`Babylon.js v${u.Version}`;S.b.Log(v+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",v);const B=(0,t.C)(this._gl);B.validateShaderPrograms=this.validateShaderPrograms,B.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(s){return null}areAllEffectsReady(){for(const s in this._compiledEffects){if(!this._compiledEffects[s].isReady())return!1}return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1,textureNorm16:!!this._gl.getExtension("EXT_texture_norm16")},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const s=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=s&&(this._glRenderer=this._gl.getParameter(s.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(s.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.textureNorm16&&(this._gl.R16_EXT=33322,this._gl.RG16_EXT=33324,this._gl.RGB16_EXT=32852,this._gl.RGBA16_EXT=32859,this._gl.R16_SNORM_EXT=36760,this._gl.RG16_SNORM_EXT=36761,this._gl.RGB16_SNORM_EXT=36762,this._gl.RGBA16_SNORM_EXT=36763),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{const s=this._gl.getExtension("WEBGL_draw_buffers");if(null!==s){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=s.drawBuffersWEBGL.bind(s),this._caps.maxDrawBuffers=this._gl.getParameter(s.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let Z=0;Z<16;Z++)this._gl["COLOR_ATTACHMENT"+Z+"_WEBGL"]=s["COLOR_ATTACHMENT"+Z+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const s=this._gl.getExtension("WEBGL_depth_texture");null!=s&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=s.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const s=this._gl.getExtension("OES_vertex_array_object");null!=s&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=s.createVertexArrayOES.bind(s),this._gl.bindVertexArray=s.bindVertexArrayOES.bind(s),this._gl.deleteVertexArray=s.deleteVertexArrayOES.bind(s))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const s=this._gl.getExtension("ANGLE_instanced_arrays");null!=s?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=s.drawArraysInstancedANGLE.bind(s),this._gl.drawElementsInstanced=s.drawElementsInstancedANGLE.bind(s),this._gl.vertexAttribDivisor=s.vertexAttribDivisorANGLE.bind(s)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const s=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),Z=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);s&&Z&&(this._caps.highPrecisionShaderSupported=0!==s.precision&&0!==Z.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const s=this._gl.getExtension("EXT_blend_minmax");null!=s&&(this._caps.blendMinMax=!0,this._gl.MAX=s.MAX_EXT,this._gl.MIN=s.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const s=this._gl.getExtension("EXT_sRGB");null!=s&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:s.SRGB_EXT,SRGB8:s.SRGB_ALPHA_EXT,SRGB8_ALPHA8:s.SRGB_ALPHA_EXT})}if(this._creationOptions){const s=this._creationOptions.forceSRGBBufferSupportState;void 0!==s&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&s)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let Z=0;Z<this._maxSimultaneousTextures;Z++)this._nextFreeTextureSlots.push(Z);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"===typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const s=this._workingCanvas.getContext("2d");s&&(this._workingContext=s)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const s=this.getGlInfo();return s&&s.renderer?s.renderer:""}getRenderWidth(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const j=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=j;let S=0;if(Z&&s){let Z=!0;if(this._currentRenderTarget){var a;const o=null===(a=this._currentRenderTarget.texture)||void 0===a?void 0:a.format;if(8===o||9===o||10===o||11===o){var O;const o=null===(O=this._currentRenderTarget.texture)||void 0===O?void 0:O.type;7===o||5===o?(u._TempClearColorUint32[0]=255*s.r,u._TempClearColorUint32[1]=255*s.g,u._TempClearColorUint32[2]=255*s.b,u._TempClearColorUint32[3]=255*s.a,this._gl.clearBufferuiv(this._gl.COLOR,0,u._TempClearColorUint32),Z=!1):(u._TempClearColorInt32[0]=255*s.r,u._TempClearColorInt32[1]=255*s.g,u._TempClearColorInt32[2]=255*s.b,u._TempClearColorInt32[3]=255*s.a,this._gl.clearBufferiv(this._gl.COLOR,0,u._TempClearColorInt32),Z=!1)}}Z&&(this._gl.clearColor(s.r,s.g,s.b,void 0!==s.a?s.a:1),S|=this._gl.COLOR_BUFFER_BIT)}o&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),S|=this._gl.DEPTH_BUFFER_BIT),t&&(this._gl.clearStencil(0),S|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(S)}_viewport(s,Z,o,t){s===this._viewportCached.x&&Z===this._viewportCached.y&&o===this._viewportCached.z&&t===this._viewportCached.w||(this._viewportCached.x=s,this._viewportCached.y=Z,this._viewportCached.z=o,this._viewportCached.w=t,this._gl.viewport(s,Z,o,t))}dQ(){super.dQ(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0,t=arguments.length>3?arguments[3]:void 0,j=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const v=s;this._currentRenderTarget&&this._resolveAndGenerateMipMapsFramebuffer(this._currentRenderTarget),this._currentRenderTarget=s,this._bindUnboundFramebuffer(v._framebuffer);const G=this._gl;var B;if(!s.isMulti)if(s.is2DArray||s.is3D)G.framebufferTextureLayer(G.FRAMEBUFFER,G.COLOR_ATTACHMENT0,null===(B=s.texture._hardwareTexture)||void 0===B?void 0:B.underlyingResource,a,O),v._currentLOD=a;else if(s.isCube){var Q;G.framebufferTexture2D(G.FRAMEBUFFER,G.COLOR_ATTACHMENT0,G.TEXTURE_CUBE_MAP_POSITIVE_X+Z,null===(Q=s.texture._hardwareTexture)||void 0===Q?void 0:Q.underlyingResource,a)}else if(v._currentLOD!==a){var D;G.framebufferTexture2D(G.FRAMEBUFFER,G.COLOR_ATTACHMENT0,G.TEXTURE_2D,null===(D=s.texture._hardwareTexture)||void 0===D?void 0:D.underlyingResource,a),v._currentLOD=a}const z=s._depthStencilTexture;if(z){s.is3D&&(s.texture.width===z.width&&s.texture.height===z.height&&s.texture.depth===z.depth||S.b.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const o=s._depthStencilTextureWithStencil?G.DEPTH_STENCIL_ATTACHMENT:G.DEPTH_ATTACHMENT;var Y;if(s.is2DArray||s.is3D)G.framebufferTextureLayer(G.FRAMEBUFFER,o,null===(Y=z._hardwareTexture)||void 0===Y?void 0:Y.underlyingResource,a,O);else if(s.isCube){var b;G.framebufferTexture2D(G.FRAMEBUFFER,o,G.TEXTURE_CUBE_MAP_POSITIVE_X+Z,null===(b=z._hardwareTexture)||void 0===b?void 0:b.underlyingResource,a)}else{var f;G.framebufferTexture2D(G.FRAMEBUFFER,o,G.TEXTURE_2D,null===(f=z._hardwareTexture)||void 0===f?void 0:f.underlyingResource,a)}}v._MSAAFramebuffer&&this._bindUnboundFramebuffer(v._MSAAFramebuffer),this._cachedViewport&&!j?this.setViewport(this._cachedViewport,o,t):(o||(o=s.width,a&&(o/=Math.pow(2,a))),t||(t=s.height,a&&(t/=Math.pow(2,a))),this._viewport(0,0,o,t)),this.wipeCaches()}setStateCullFaceType(s,Z){const o=this.cullBackFaces??s??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==o||Z)&&(this._depthCullingState.cullFace=o)}setState(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0,t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],j=arguments.length>4?arguments[4]:void 0,S=arguments.length>5?arguments[5]:void 0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(this._depthCullingState.cull!==s||o)&&(this._depthCullingState.cull=s),this.setStateCullFaceType(j,o),this.setZOffset(Z),this.setZOffsetUnits(a);const O=t?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==O||o)&&(this._depthCullingState.frontFace=O),this._stencilStateComposer.stencilMaterial=S}_resolveAndGenerateMipMapsFramebuffer(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];s.disableAutomaticMSAAResolve||(s.isMulti?this.resolveMultiFramebuffer(s):this.resolveFramebuffer(s)),Z||(s.isMulti?this.generateMipMapsMultiFramebuffer(s):this.generateMipMapsFramebuffer(s))}_bindUnboundFramebuffer(s){this._currentFramebuffer!==s&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,s),this._currentFramebuffer=s)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(s){const Z=this._getTextureTarget(s);this._bindTextureDirectly(Z,s,!0),this._gl.generateMipmap(Z),this._bindTextureDirectly(Z,null)}unBindFramebuffer(s,Z,o){const t=s;this._currentRenderTarget=null,this._resolveAndGenerateMipMapsFramebuffer(s,Z),o&&(t._MSAAFramebuffer&&this._bindUnboundFramebuffer(t._framebuffer),o()),this._bindUnboundFramebuffer(null)}generateMipMapsFramebuffer(s){var Z;s.isMulti||null===(Z=s.texture)||void 0===Z||!Z.generateMipMaps||s.isCube||this.generateMipmaps(s.texture)}resolveFramebuffer(s){const Z=s,o=this._gl;if(!Z._MSAAFramebuffer||Z.isMulti)return;let t=Z.resolveMSAAColors?o.COLOR_BUFFER_BIT:0;t|=Z._generateDepthBuffer&&Z.resolveMSAADepth?o.DEPTH_BUFFER_BIT:0,t|=Z._generateStencilBuffer&&Z.resolveMSAAStencil?o.STENCIL_BUFFER_BIT:0,o.bindFramebuffer(o.READ_FRAMEBUFFER,Z._MSAAFramebuffer),o.bindFramebuffer(o.DRAW_FRAMEBUFFER,Z._framebuffer),o.blitFramebuffer(0,0,s.width,s.height,0,0,s.width,s.height,t,o.NEAREST)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(s,Z,o){return this._createVertexBuffer(s,this._gl.STATIC_DRAW)}_createVertexBuffer(s,Z){const o=this._gl.createBuffer();if(!o)throw new Error("Unable to create vertex buffer");const t=new B.b(o);return this.bindArrayBuffer(t),"number"!==typeof s?s instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(s),Z),t.eZ=4*s.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,s,Z),t.eZ=s.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(s),Z),t.eZ=s),this._resetVertexBufferBinding(),t.references=1,t}createDynamicVertexBuffer(s,Z){return this._createVertexBuffer(s,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(s,Z,o){const t=this._gl.createBuffer(),j=new B.b(t);if(!t)throw new Error("Unable to create index buffer");this.bindIndexBuffer(j);const S=this._normalizeIndexData(s);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,S,Z?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),j.references=1,j.is32Bits=4===S.BYTES_PER_ELEMENT,j}_normalizeIndexData(s){if(2===s.BYTES_PER_ELEMENT)return s;if(this._caps.uintIndices){if(s instanceof Uint32Array)return s;for(let Z=0;Z<s.length;Z++)if(s[Z]>=65535)return new Uint32Array(s);return new Uint16Array(s)}return new Uint16Array(s)}bindArrayBuffer(s){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(s,this._gl.ARRAY_BUFFER)}bindUniformBlock(s,Z,o){const t=s.program,j=this._gl.getUniformBlockIndex(t,Z);this._gl.uniformBlockBinding(t,j,o)}bindIndexBuffer(s){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(s,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(s,Z){(this._vaoRecordInProgress||this._currentBoundBuffer[Z]!==s)&&(this._gl.bindBuffer(Z,s?s.underlyingResource:null),this._currentBoundBuffer[Z]=s)}updateArrayBuffer(s){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,s)}_vertexAttribPointer(s,Z,o,t,j,S,a){const O=this._currentBufferPointers[Z];if(!O)return;let v=!1;O.active?(O.buffer!==s&&(O.buffer=s,v=!0),O.size!==o&&(O.size=o,v=!0),O.type!==t&&(O.type=t,v=!0),O.normalized!==j&&(O.normalized=j,v=!0),O.stride!==S&&(O.stride=S,v=!0),O.offset!==a&&(O.offset=a,v=!0)):(v=!0,O.active=!0,O.index=Z,O.size=o,O.type=t,O.normalized=j,O.stride=S,O.offset=a,O.buffer=s),(v||this._vaoRecordInProgress)&&(this.bindArrayBuffer(s),t===this._gl.UNSIGNED_INT||t===this._gl.INT?this._gl.vertexAttribIPointer(Z,o,t,S,a):this._gl.vertexAttribPointer(Z,o,t,j,S,a))}_bindIndexBufferWithCache(s){null!=s&&this._cachedIndexBuffer!==s&&(this._cachedIndexBuffer=s,this.bindIndexBuffer(s),this._uintIndicesCurrentlySet=s.is32Bits)}_bindVertexBuffersAttributes(s,Z,o){const t=Z.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let j=0;j<t.length;j++){const S=Z.getAttributeLocation(j);if(S>=0){const Z=t[j];let a=null;if(o&&(a=o[Z]),a||(a=s[Z]),!a)continue;this._gl.enableVertexAttribArray(S),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[S]=!0);const O=a.getBuffer();O&&(this._vertexAttribPointer(O,S,a.getSize(),a.type,a.normalized,a.byteStride,a.byteOffset),a.getIsInstanced()&&(this._gl.vertexAttribDivisor(S,a.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(S),this._currentInstanceBuffers.push(O))))}}}recordVertexArrayObject(s,Z,o,t){const j=this._gl.createVertexArray();if(!j)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(j),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(s,o,t),this.bindIndexBuffer(Z),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),j}bindVertexArrayObject(s,Z){this._cachedVertexArrayObject!==s&&(this._cachedVertexArrayObject=s,this._gl.bindVertexArray(s),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=Z&&Z.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(s,Z,o,t,j){if(this._cachedVertexBuffers!==s||this._cachedEffectForVertexBuffers!==j){this._cachedVertexBuffers=s,this._cachedEffectForVertexBuffers=j;const Z=j.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let S=0;for(let a=0;a<Z;a++)if(a<o.length){const Z=j.getAttributeLocation(a);Z>=0&&(this._gl.enableVertexAttribArray(Z),this._vertexAttribArraysEnabled[Z]=!0,this._vertexAttribPointer(s,Z,o[a],this._gl.FLOAT,!1,t,S)),S+=4*o[a]}}this._bindIndexBufferWithCache(Z)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(s,Z,o,t){this._cachedVertexBuffers===s&&this._cachedEffectForVertexBuffers===o||(this._cachedVertexBuffers=s,this._cachedEffectForVertexBuffers=o,this._bindVertexBuffersAttributes(s,o,t)),this._bindIndexBufferWithCache(Z)}unbindInstanceAttributes(){let s;for(let Z=0,o=this._currentInstanceLocations.length;Z<o;Z++){const o=this._currentInstanceBuffers[Z];s!=o&&o.references&&(s=o,this.bindArrayBuffer(o));const t=this._currentInstanceLocations[Z];this._gl.vertexAttribDivisor(t,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(s){this._gl.deleteVertexArray(s)}_releaseBuffer(s){return s.references--,0===s.references&&(this._deleteBuffer(s),!0)}_deleteBuffer(s){this._gl.deleteBuffer(s.underlyingResource)}updateAndBindInstancesBuffer(s,Z,o){if(this.bindArrayBuffer(s),Z&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,Z),void 0!==o[0].index)this.bindInstancesBuffer(s,o,!0);else for(let t=0;t<4;t++){const Z=o[t];this._vertexAttribArraysEnabled[Z]||(this._gl.enableVertexAttribArray(Z),this._vertexAttribArraysEnabled[Z]=!0),this._vertexAttribPointer(s,Z,4,this._gl.FLOAT,!1,64,16*t),this._gl.vertexAttribDivisor(Z,1),this._currentInstanceLocations.push(Z),this._currentInstanceBuffers.push(s)}}bindInstancesBuffer(s,Z){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.bindArrayBuffer(s);let t=0;if(o)for(let j=0;j<Z.length;j++){t+=4*Z[j].attributeSize}for(let j=0;j<Z.length;j++){const o=Z[j];void 0===o.index&&(o.index=this._currentEffect.getAttributeLocationByName(o.attributeName)),o.index<0||(this._vertexAttribArraysEnabled[o.index]||(this._gl.enableVertexAttribArray(o.index),this._vertexAttribArraysEnabled[o.index]=!0),this._vertexAttribPointer(s,o.index,o.attributeSize,o.attributeType||this._gl.FLOAT,o.normalized||!1,t,o.offset),this._gl.vertexAttribDivisor(o.index,void 0===o.divisor?1:o.divisor),this._currentInstanceLocations.push(o.index),this._currentInstanceBuffers.push(s))}}disableInstanceAttributeByName(s){if(!this._currentEffect)return;const Z=this._currentEffect.getAttributeLocationByName(s);this.disableInstanceAttribute(Z)}disableInstanceAttribute(s){let Z,o=!1;for(;-1!==(Z=this._currentInstanceLocations.indexOf(s));)this._currentInstanceLocations.splice(Z,1),this._currentInstanceBuffers.splice(Z,1),o=!0,Z=this._currentInstanceLocations.indexOf(s);o&&(this._gl.vertexAttribDivisor(s,0),this.disableAttributeByIndex(s))}disableAttributeByIndex(s){this._gl.disableVertexAttribArray(s),this._vertexAttribArraysEnabled[s]=!1,this._currentBufferPointers[s].active=!1}draw(s,Z,o,t){this.drawElementsType(s?0:1,Z,o,t)}drawPointClouds(s,Z,o){this.drawArraysType(2,s,Z,o)}drawUnIndexed(s,Z,o,t){this.drawArraysType(s?0:1,Z,o,t)}drawElementsType(s,Z,o,t){this.applyStates(),this._reportDrawCall();const j=this._drawMode(s),S=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,a=this._uintIndicesCurrentlySet?4:2;t?this._gl.drawElementsInstanced(j,o,S,Z*a,t):this._gl.drawElements(j,o,S,Z*a)}drawArraysType(s,Z,o,t){this.applyStates(),this._reportDrawCall();const j=this._drawMode(s);t?this._gl.drawArraysInstanced(j,Z,o,t):this._gl.drawArrays(j,Z,o)}_drawMode(s){switch(s){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(s){this._compiledEffects[s._key]&&delete this._compiledEffects[s._key];const Z=s.getPipelineContext();Z&&this._deletePipelineContext(Z)}_deletePipelineContext(s){const Z=s;Z&&Z.program&&(Z.program.__SPECTOR_rebuildProgram=null,(0,A.j)(Z),this._gl&&(this._currentProgram===Z.program&&this._setProgram(null),this._gl.deleteProgram(Z.program)))}_getGlobalDefines(s){return(0,f.i)(s,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(s,Z,o,j,S,a,O,v,G){let B=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,Q=arguments.length>10?arguments[10]:void 0;const D="string"===typeof s?s:s.vertexToken||s.vertexSource||s.vertexElement||s.vertex,z="string"===typeof s?s:s.fragmentToken||s.fragmentSource||s.fragmentElement||s.fragment,Y=this._getGlobalDefines(),f=void 0!==Z.attributes;let A=S??Z.defines??"";Y&&(A+=Y);const d=D+"+"+z+"@"+A;if(this._compiledEffects[d]){const s=this._compiledEffects[d];return O&&s.isReady()&&O(s),s._refCount++,s}this._gl&&(0,t.C)(this._gl);const U=new b.d(s,Z,f?this:o,j,this,S,a,O,v,G,d,Z.shaderLanguage??B,Z.extraInitializationsAsync??Q);return this._compiledEffects[d]=U,U}_getShaderSource(s){return this._gl.getShaderSource(s)}createRawShaderProgram(s,Z,o,j){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const a=(0,t.C)(this._gl);return a._contextWasLost=this._contextWasLost,a.validateShaderPrograms=this.validateShaderPrograms,(0,t.v)(s,Z,o,j||this._gl,S)}createShaderProgram(s,Z,o,j,S){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const O=(0,t.C)(this._gl);return O._contextWasLost=this._contextWasLost,O.validateShaderPrograms=this.validateShaderPrograms,(0,t.y)(s,Z,o,j,S||this._gl,a)}inlineShaderCode(s){return s}createPipelineContext(s){if(this._gl){(0,t.C)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const Z=(0,t.s)(this._gl,s);return Z.wa=this,Z}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(s){return(0,t.i)(s,this._gl,this.validateShaderPrograms)}_preparePipelineContextAsync(s,Z,o,j,S,a,O,v,G,B,Q){const D=(0,t.C)(this._gl);return D._contextWasLost=this._contextWasLost,D.validateShaderPrograms=this.validateShaderPrograms,D._createShaderProgramInjection=this._createShaderProgram.bind(this),D.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),D.createShaderProgramInjection=this.createShaderProgram.bind(this),D.loadFileInjection=this._loadFile.bind(this),(0,t.m)(s,Z,o,j,S,a,O,v,G,B,Q)}_createShaderProgram(s,Z,o,j){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,t.c)(s,Z,o,j,S)}_isRenderingStateCompiled(s){return!this._isDisposed&&(0,t.j)(s,this._gl,this.validateShaderPrograms)}_executeWhenRenderingStateIsCompiled(s,Z){(0,t.g)(s,Z)}getUniforms(s,Z){const o=new Array,t=s;for(let j=0;j<Z.length;j++)o.push(this._gl.getUniformLocation(t.program,Z[j]));return o}getAttributes(s,Z){const o=[],t=s;for(let S=0;S<Z.length;S++)try{o.push(this._gl.getAttribLocation(t.program,Z[S]))}catch(j){o.push(-1)}return o}enableEffect(s){(s=null!==s&&(0,j.c)(s)?s.effect:s)&&s!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(s),this._currentEffect=s,s.onBind&&s.onBind(s),s._onBindObservable&&s._onBindObservable.notifyObservers(s))}setInt(s,Z){return!!s&&(this._gl.uniform1i(s,Z),!0)}setInt2(s,Z,o){return!!s&&(this._gl.uniform2i(s,Z,o),!0)}setInt3(s,Z,o,t){return!!s&&(this._gl.uniform3i(s,Z,o,t),!0)}setInt4(s,Z,o,t,j){return!!s&&(this._gl.uniform4i(s,Z,o,t,j),!0)}setIntArray(s,Z){return!!s&&(this._gl.uniform1iv(s,Z),!0)}setIntArray2(s,Z){return!(!s||Z.length%2!==0)&&(this._gl.uniform2iv(s,Z),!0)}setIntArray3(s,Z){return!(!s||Z.length%3!==0)&&(this._gl.uniform3iv(s,Z),!0)}setIntArray4(s,Z){return!(!s||Z.length%4!==0)&&(this._gl.uniform4iv(s,Z),!0)}setUInt(s,Z){return!!s&&(this._gl.uniform1ui(s,Z),!0)}setUInt2(s,Z,o){return!!s&&(this._gl.uniform2ui(s,Z,o),!0)}setUInt3(s,Z,o,t){return!!s&&(this._gl.uniform3ui(s,Z,o,t),!0)}setUInt4(s,Z,o,t,j){return!!s&&(this._gl.uniform4ui(s,Z,o,t,j),!0)}setUIntArray(s,Z){return!!s&&(this._gl.uniform1uiv(s,Z),!0)}setUIntArray2(s,Z){return!(!s||Z.length%2!==0)&&(this._gl.uniform2uiv(s,Z),!0)}setUIntArray3(s,Z){return!(!s||Z.length%3!==0)&&(this._gl.uniform3uiv(s,Z),!0)}setUIntArray4(s,Z){return!(!s||Z.length%4!==0)&&(this._gl.uniform4uiv(s,Z),!0)}setArray(s,Z){return!!s&&(!(Z.length<1)&&(this._gl.uniform1fv(s,Z),!0))}setArray2(s,Z){return!(!s||Z.length%2!==0)&&(this._gl.uniform2fv(s,Z),!0)}setArray3(s,Z){return!(!s||Z.length%3!==0)&&(this._gl.uniform3fv(s,Z),!0)}setArray4(s,Z){return!(!s||Z.length%4!==0)&&(this._gl.uniform4fv(s,Z),!0)}setMatrices(s,Z){return!!s&&(this._gl.uniformMatrix4fv(s,!1,Z),!0)}setMatrix3x3(s,Z){return!!s&&(this._gl.uniformMatrix3fv(s,!1,Z),!0)}setMatrix2x2(s,Z){return!!s&&(this._gl.uniformMatrix2fv(s,!1,Z),!0)}setFloat(s,Z){return!!s&&(this._gl.uniform1f(s,Z),!0)}setFloat2(s,Z,o){return!!s&&(this._gl.uniform2f(s,Z,o),!0)}setFloat3(s,Z,o,t){return!!s&&(this._gl.uniform3f(s,Z,o,t),!0)}setFloat4(s,Z,o,t,j){return!!s&&(this._gl.uniform4f(s,Z,o,t,j),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const s=this._colorWrite;this._gl.colorMask(s,s,s,s)}}wipeCaches(s){this.preventCacheWipeBetweenFrames&&!s||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),s&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(s,Z){const o=this._gl;let t=o.NEAREST,j=o.NEAREST,S=!1;switch(s){case 11:t=o.LINEAR,j=Z?o.LINEAR_MIPMAP_NEAREST:o.LINEAR;break;case 3:t=o.LINEAR,S=!0,j=Z?o.LINEAR_MIPMAP_LINEAR:o.LINEAR;break;case 8:S=!0,t=o.NEAREST,j=Z?o.NEAREST_MIPMAP_LINEAR:o.NEAREST;break;case 4:t=o.NEAREST,j=Z?o.NEAREST_MIPMAP_NEAREST:o.NEAREST;break;case 5:t=o.NEAREST,j=Z?o.LINEAR_MIPMAP_NEAREST:o.LINEAR;break;case 6:S=!0,t=o.NEAREST,j=Z?o.LINEAR_MIPMAP_LINEAR:o.LINEAR;break;case 7:t=o.NEAREST,j=o.LINEAR;break;case 1:t=o.NEAREST,j=o.NEAREST;break;case 9:t=o.LINEAR,j=Z?o.NEAREST_MIPMAP_NEAREST:o.NEAREST;break;case 10:S=!0,t=o.LINEAR,j=Z?o.NEAREST_MIPMAP_LINEAR:o.NEAREST;break;case 2:t=o.LINEAR,j=o.LINEAR;break;case 12:t=o.LINEAR,j=o.NEAREST}return{min:j,mag:t,hasMipMaps:S}}_createTexture(){const s=this._gl.createTexture();if(!s)throw new Error("Unable to create texture");return s}_createHardwareTexture(){return new z.e(this._createTexture(),this._gl)}_createInternalTexture(s,Z){let o,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,j=!1,a=!1,O=0,v=3,G=5,B=!1,Q=1,D=!1,z=0;void 0!==Z&&"object"===typeof Z?(j=!!Z.generateMipMaps,a=!!Z.createMipMaps,O=void 0===Z.type?0:Z.type,v=void 0===Z.samplingMode?3:Z.samplingMode,G=void 0===Z.format?5:Z.format,B=void 0!==Z.useSRGBBuffer&&Z.useSRGBBuffer,Q=Z.samples??1,o=Z.label,D=!!Z.createMSAATexture,z=Z.comparisonFunction||0):j=!!Z,B&&(B=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==O||this._caps.textureFloatLinearFiltering)&&(2!==O||this._caps.textureHalfFloatLinearFiltering)||(v=1),1!==O||this._caps.textureFloat||(O=0,S.b.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const b=(0,d.g)(G),f=(0,d.e)(G),A=this._gl,U=new Y.b(this,t),u=s.width||s,H=s.height||s,F=s.depth||0,i=s.layers||0,N=this._getSamplingParameters(v,(j||a)&&!b),L=0!==i?A.TEXTURE_2D_ARRAY:0!==F?A.TEXTURE_3D:A.TEXTURE_2D,V=b?this._getInternalFormatFromDepthTextureFormat(G,!0,f):this._getRGBABufferInternalSizedFormat(O,G,B),g=b?f?A.DEPTH_STENCIL:A.DEPTH_COMPONENT:this._getInternalFormat(G),l=b?this._getWebGLTextureTypeFromDepthTextureFormat(G):this._getWebGLTextureType(O);if(this._bindTextureDirectly(L,U),0!==i?(U.is2DArray=!0,A.texImage3D(L,0,V,u,H,i,0,g,l,null)):0!==F?(U.is3D=!0,A.texImage3D(L,0,V,u,H,F,0,g,l,null)):A.texImage2D(L,0,V,u,H,0,g,l,null),A.texParameteri(L,A.TEXTURE_MAG_FILTER,N.mag),A.texParameteri(L,A.TEXTURE_MIN_FILTER,N.min),A.texParameteri(L,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE),A.texParameteri(L,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE),b&&this.webGLVersion>1&&(0===z?(A.texParameteri(L,A.TEXTURE_COMPARE_FUNC,515),A.texParameteri(L,A.TEXTURE_COMPARE_MODE,A.NONE)):(A.texParameteri(L,A.TEXTURE_COMPARE_FUNC,z),A.texParameteri(L,A.TEXTURE_COMPARE_MODE,A.COMPARE_REF_TO_TEXTURE))),(j||a)&&this._gl.generateMipmap(L),this._bindTextureDirectly(L,null),U._useSRGBBuffer=B,U.baseWidth=u,U.baseHeight=H,U.width=u,U.height=H,U.depth=i||F,U.isReady=!0,U.samples=Q,U.generateMipMaps=j,U.samplingMode=v,U.type=O,U.format=G,U.label=o,U.comparisonFunction=z,this._internalTexturesCache.push(U),D){let s=null;if(s=(0,d.g)(U.format)?this._setupFramebufferDepthAttachments((0,d.e)(U.format),19!==U.format,U.width,U.height,Q,U.format,!0):this._createRenderBuffer(U.width,U.height,Q,-1,this._getRGBABufferInternalSizedFormat(U.type,U.format,U._useSRGBBuffer),-1),!s)throw new Error("Unable to create render buffer");U._autoMSAAManagement=!0;let Z=U._hardwareTexture;Z||(Z=U._hardwareTexture=this._createHardwareTexture()),Z.addMSAARenderBuffer(s)}return U}_getUseSRGBBuffer(s,Z){return s&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||Z)}createTexture(s,Z,o,t){var j=this;let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,v=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,B=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,Q=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,D=arguments.length>11?arguments[11]:void 0,z=arguments.length>12?arguments[12]:void 0,b=arguments.length>13?arguments[13]:void 0,f=arguments.length>14?arguments[14]:void 0;return this._createTextureBase(s,Z,o,t,S,a,O,(function(){for(var s=arguments.length,Z=new Array(s),o=0;o<s;o++)Z[o]=arguments[o];return j._prepareWebGLTexture(...Z,B)}),((s,Z,o,j,S,a)=>{const O=this._gl,v=o.width===s&&o.height===Z;S._creationFlags=b??0;const G=this._getTexImageParametersForCreateTexture(S.format,S._useSRGBBuffer);if(v)return O.texImage2D(O.TEXTURE_2D,0,G.internalFormat,G.format,G.type,o),!1;const B=this._caps.maxTextureSize;if(o.width>B||o.height>B||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=s,this._workingCanvas.height=Z,this._workingContext.drawImage(o,0,0,o.width,o.height,0,0,s,Z),O.texImage2D(O.TEXTURE_2D,0,G.internalFormat,G.format,G.type,this._workingCanvas),S.width=s,S.height=Z,!1);{const s=new Y.b(this,2);this._bindTextureDirectly(O.TEXTURE_2D,s,!0),O.texImage2D(O.TEXTURE_2D,0,G.internalFormat,G.format,G.type,o),this._rescaleTexture(s,S,t,G.format,(()=>{this._releaseTexture(s),this._bindTextureDirectly(O.TEXTURE_2D,S,!0),a()}))}return!0}),v,G,B,Q,D,z,f)}_getTexImageParametersForCreateTexture(s,Z){let o,t;return 1===this.webGLVersion?(o=this._getInternalFormat(s,Z),t=o):(o=this._getInternalFormat(s,!1),t=this._getRGBABufferInternalSizedFormat(0,s,Z)),{internalFormat:t,format:o,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(s,Z,o,t,j){}_unpackFlipY(s){this._unpackFlipYCached!==s&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,s?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=s))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(s){return s.isCube?this._gl.TEXTURE_CUBE_MAP:s.is3D?this._gl.TEXTURE_3D:s.is2DArray||s.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(s,Z){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const t=this._getTextureTarget(Z),j=this._getSamplingParameters(s,Z.useMipMaps||o);this._setTextureParameterInteger(t,this._gl.TEXTURE_MAG_FILTER,j.mag,Z),this._setTextureParameterInteger(t,this._gl.TEXTURE_MIN_FILTER,j.min),o&&j.hasMipMaps&&(Z.generateMipMaps=!0,this._gl.generateMipmap(t)),this._bindTextureDirectly(t,null),Z.samplingMode=s}updateTextureDimensions(s,Z,o){}updateTextureWrappingMode(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const j=this._getTextureTarget(s);null!==Z&&(this._setTextureParameterInteger(j,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(Z),s),s._cachedWrapU=Z),null!==o&&(this._setTextureParameterInteger(j,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(o),s),s._cachedWrapV=o),(s.is2DArray||s.is3D)&&null!==t&&(this._setTextureParameterInteger(j,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(t),s),s._cachedWrapR=t),this._bindTextureDirectly(j,null)}_uploadCompressedDataToTextureDirectly(s,Z,o,t,j){let S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const O=this._gl;let v=O.TEXTURE_2D;if(s.isCube&&(v=O.TEXTURE_CUBE_MAP_POSITIVE_X+S),s._useSRGBBuffer)switch(Z){case 37492:case 36196:this._caps.etc2?Z=O.COMPRESSED_SRGB8_ETC2:s._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?Z=O.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s._useSRGBBuffer=!1;break;case 36492:Z=O.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:Z=O.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?Z=O.COMPRESSED_SRGB_S3TC_DXT1_EXT:s._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?Z=O.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:s._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?Z=O.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:s._useSRGBBuffer=!1;break;default:s._useSRGBBuffer=!1}this._gl.compressedTexImage2D(v,a,Z,o,t,0,j)}_uploadDataToTextureDirectly(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,j=arguments.length>4?arguments[4]:void 0,S=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const a=this._gl,O=this._getWebGLTextureType(s.type),v=this._getInternalFormat(s.format),G=void 0===j?this._getRGBABufferInternalSizedFormat(s.type,s.format,s._useSRGBBuffer):this._getInternalFormat(j,s._useSRGBBuffer);this._unpackFlipY(s.invertY);let B=a.TEXTURE_2D;s.isCube&&(B=a.TEXTURE_CUBE_MAP_POSITIVE_X+o);const Q=Math.round(Math.log(s.width)*Math.LOG2E),D=Math.round(Math.log(s.height)*Math.LOG2E),z=S?s.width:Math.pow(2,Math.max(Q-t,0)),Y=S?s.height:Math.pow(2,Math.max(D-t,0));a.texImage2D(B,t,G,z,Y,0,v,O,Z)}updateTextureData(s,Z,o,t,j,S){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,v=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const G=this._gl,B=this._getWebGLTextureType(s.type),Q=this._getInternalFormat(s.format);this._unpackFlipY(s.invertY);let D=G.TEXTURE_2D,z=G.TEXTURE_2D;s.isCube&&(z=G.TEXTURE_CUBE_MAP_POSITIVE_X+a,D=G.TEXTURE_CUBE_MAP),this._bindTextureDirectly(D,s,!0),G.texSubImage2D(z,O,o,t,j,S,Q,B,Z),v&&this._gl.generateMipmap(z),this._bindTextureDirectly(D,null)}_uploadArrayBufferViewToTexture(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const j=this._gl,S=s.isCube?j.TEXTURE_CUBE_MAP:j.TEXTURE_2D;this._bindTextureDirectly(S,s,!0),this._uploadDataToTextureDirectly(s,Z,o,t),this._bindTextureDirectly(S,null,!0)}_prepareWebGLTextureContinuation(s,Z,o,t,j){const S=this._gl;if(!S)return;const a=this._getSamplingParameters(j,!o);S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,a.mag),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,a.min),o||t||S.generateMipmap(S.TEXTURE_2D),this._bindTextureDirectly(S.TEXTURE_2D,null),Z&&Z.removePendingData(s),s.onLoadedObservable.notifyObservers(s),s.onLoadedObservable.clear()}_prepareWebGLTexture(s,Z,o,t,j,S,a,O,v,G){const B=this.getCaps().maxTextureSize,D=Math.min(B,this.needPOTTextures?(0,Q.f)(t.width,B):t.width),z=Math.min(B,this.needPOTTextures?(0,Q.f)(t.height,B):t.height),Y=this._gl;Y&&(s._hardwareTexture?(this._bindTextureDirectly(Y.TEXTURE_2D,s,!0),this._unpackFlipY(void 0===j||!!j),s.baseWidth=t.width,s.baseHeight=t.height,s.width=D,s.height=z,s.isReady=!0,s.type=-1!==s.type?s.type:0,s.format=-1!==s.format?s.format:G??(".jpg"!==Z||s._useSRGBBuffer?5:4),O(D,z,t,Z,s,(()=>{this._prepareWebGLTextureContinuation(s,o,S,a,v)}))||this._prepareWebGLTextureContinuation(s,o,S,a,v)):o&&o.removePendingData(s))}_getInternalFormatFromDepthTextureFormat(s,Z,o){const t=this._gl;if(!Z)return t.STENCIL_INDEX8;let j=o?t.DEPTH_STENCIL:t.DEPTH_COMPONENT;return this.webGLVersion>1?15===s?j=t.DEPTH_COMPONENT16:16===s?j=t.DEPTH_COMPONENT24:17===s||13===s?j=o?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24:14===s?j=t.DEPTH_COMPONENT32F:18===s&&(j=o?t.DEPTH32F_STENCIL8:t.DEPTH_COMPONENT32F):j=t.DEPTH_COMPONENT16,j}_getWebGLTextureTypeFromDepthTextureFormat(s){const Z=this._gl;let o=Z.UNSIGNED_INT;return 15===s?o=Z.UNSIGNED_SHORT:17===s||13===s?o=Z.UNSIGNED_INT_24_8:14===s?o=Z.FLOAT:18===s?o=Z.FLOAT_32_UNSIGNED_INT_24_8_REV:19===s&&(o=Z.UNSIGNED_BYTE),o}_setupFramebufferDepthAttachments(s,Z,o,t){let j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,S=arguments.length>5?arguments[5]:void 0,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const O=this._gl;S=S??(s?13:14);const v=this._getInternalFormatFromDepthTextureFormat(S,Z,s);return s&&Z?this._createRenderBuffer(o,t,j,O.DEPTH_STENCIL,v,a?-1:O.DEPTH_STENCIL_ATTACHMENT):Z?this._createRenderBuffer(o,t,j,v,v,a?-1:O.DEPTH_ATTACHMENT):s?this._createRenderBuffer(o,t,j,v,v,a?-1:O.STENCIL_ATTACHMENT):null}_createRenderBuffer(s,Z,o,t,j,S){let a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const O=this._gl.createRenderbuffer();return this._updateRenderBuffer(O,s,Z,o,t,j,S,a)}_updateRenderBuffer(s,Z,o,t,j,S,a){let O=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const v=this._gl;return v.bindRenderbuffer(v.RENDERBUFFER,s),t>1&&v.renderbufferStorageMultisample?v.renderbufferStorageMultisample(v.RENDERBUFFER,t,S,Z,o):v.renderbufferStorage(v.RENDERBUFFER,j,Z,o),-1!==a&&v.framebufferRenderbuffer(v.FRAMEBUFFER,a,v.RENDERBUFFER,s),O&&v.bindRenderbuffer(v.RENDERBUFFER,null),s}_releaseTexture(s){this._deleteTexture(s._hardwareTexture),this.unbindAllTextures();const Z=this._internalTexturesCache.indexOf(s);-1!==Z&&this._internalTexturesCache.splice(Z,1),s._lodTextureHigh&&s._lodTextureHigh.dispose(),s._lodTextureMid&&s._lodTextureMid.dispose(),s._lodTextureLow&&s._lodTextureLow.dispose(),s._irradianceTexture&&s._irradianceTexture.dispose()}_deleteTexture(s){null===s||void 0===s||s.release()}_setProgram(s){this._currentProgram!==s&&((0,t.o)(s,this._gl),this._currentProgram=s)}bindSamplers(s){const Z=s.getPipelineContext();this._setProgram(Z.program);const o=s.getSamplers();for(let t=0;t<o.length;t++){const Z=s.getUniform(o[t]);Z&&(this._boundUniforms[t]=Z)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(s,Z){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],j=!1;const a=Z&&Z._associatedChannel>-1;o&&a&&(this._activeChannel=Z._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==Z||t){if(this._activateCurrentTexture(),Z&&Z.isMultiview)throw S.b.Error(["_bindTextureDirectly called with a multiview texture!",s,Z]),"_bindTextureDirectly called with a multiview texture!";var O;this._gl.bindTexture(s,(null===Z||void 0===Z||null===(O=Z._hardwareTexture)||void 0===O?void 0:O.underlyingResource)??null),this._boundTexturesCache[this._activeChannel]=Z,Z&&(Z._associatedChannel=this._activeChannel)}else o&&(j=!0,this._activateCurrentTexture());return a&&!o&&this._bindSamplerUniformToChannel(Z._associatedChannel,this._activeChannel),j}_bindTexture(s,Z,o){if(void 0===s)return;Z&&(Z._associatedChannel=s),this._activeChannel=s;const t=Z?this._getTextureTarget(Z):this._gl.TEXTURE_2D;this._bindTextureDirectly(t,Z)}unbindAllTextures(){for(let s=0;s<this._maxSimultaneousTextures;s++)this._activeChannel=s,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(s,Z,o,t){void 0!==s&&(Z&&(this._boundUniforms[s]=Z),this._setTexture(s,o))}_bindSamplerUniformToChannel(s,Z){const o=this._boundUniforms[s];o&&o._currentState!==Z&&(this._gl.uniform1i(o,Z),o._currentState=Z)}_getTextureWrapMode(s){switch(s){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(s,Z){let o,t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!Z)return null!=this._boundTexturesCache[s]&&(this._activeChannel=s,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(Z.video){this._activeChannel=s;const o=Z.getInternalTexture();o&&(o._associatedChannel=s),Z.update()}else if(4===Z.delayLoadState)return Z.delayLoad(),!1;o=j?Z.depthStencilTexture:Z.isReady()?Z.getInternalTexture():Z.isCube?this.emptyCubeTexture:Z.is3D?this.emptyTexture3D:Z.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!t&&o&&(o._associatedChannel=s);let S=!0;this._boundTexturesCache[s]===o&&(t||this._bindSamplerUniformToChannel(o._associatedChannel,s),S=!1),this._activeChannel=s;const a=this._getTextureTarget(o);if(S&&this._bindTextureDirectly(a,o,t),o&&!o.isMultiview){if(o.isCube&&o._cachedCoordinatesMode!==Z.coordinatesMode){o._cachedCoordinatesMode=Z.coordinatesMode;const s=3!==Z.coordinatesMode&&5!==Z.coordinatesMode?1:0;Z.wrapU=s,Z.wrapV=s}o._cachedWrapU!==Z.wrapU&&(o._cachedWrapU=Z.wrapU,this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(Z.wrapU),o)),o._cachedWrapV!==Z.wrapV&&(o._cachedWrapV=Z.wrapV,this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(Z.wrapV),o)),o.is3D&&o._cachedWrapR!==Z.wrapR&&(o._cachedWrapR=Z.wrapR,this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(Z.wrapR),o)),this._setAnisotropicLevel(a,o,Z.anisotropicFilteringLevel)}return!0}setTextureArray(s,Z,o,t){if(void 0!==s&&Z){this._textureUnits&&this._textureUnits.length===o.length||(this._textureUnits=new Int32Array(o.length));for(let Z=0;Z<o.length;Z++){const t=o[Z].getInternalTexture();t?(this._textureUnits[Z]=s+Z,t._associatedChannel=s+Z):this._textureUnits[Z]=-1}this._gl.uniform1iv(Z,this._textureUnits);for(let s=0;s<o.length;s++)this._setTexture(this._textureUnits[s],o[s],!0)}}_setAnisotropicLevel(s,Z,o){const t=this._caps.textureAnisotropicFilterExtension;11!==Z.samplingMode&&3!==Z.samplingMode&&2!==Z.samplingMode&&(o=1),t&&Z._cachedAnisotropicFilteringLevel!==o&&(this._setTextureParameterFloat(s,t.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o,this._caps.maxAnisotropy),Z),Z._cachedAnisotropicFilteringLevel=o)}_setTextureParameterFloat(s,Z,o,t){this._bindTextureDirectly(s,t,!0,!0),this._gl.texParameterf(s,Z,o)}_setTextureParameterInteger(s,Z,o,t){t&&this._bindTextureDirectly(s,t,!0,!0),this._gl.texParameteri(s,Z,o)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let s=0;s<this._caps.maxVertexAttribs;s++)this.disableAttributeByIndex(s)}else for(let s=0,Z=this._vertexAttribArraysEnabled.length;s<Z;s++)s>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[s]||this.disableAttributeByIndex(s)}releaseEffects(){this._compiledEffects={},this.onReleaseEffectsObservable.notifyObservers(this)}dispose(){var s;((0,a.i)()&&this._renderingCanvas&&(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._onContextRestored&&this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored)),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose)&&(null===(s=this._gl.getExtension("WEBGL_lose_context"))||void 0===s||s.loseContext());(0,t.z)(this._gl)}attachContextLostEvent(s){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",s,!1)}attachContextRestoredEvent(s){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",s,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(s){const Z=this._gl;for(;Z.getError()!==Z.NO_ERROR;);let o=!0;const t=Z.createTexture();Z.bindTexture(Z.TEXTURE_2D,t),Z.texImage2D(Z.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(s),1,1,0,Z.RGBA,this._getWebGLTextureType(s),null),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MIN_FILTER,Z.NEAREST),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MAG_FILTER,Z.NEAREST);const j=Z.createFramebuffer();Z.bindFramebuffer(Z.FRAMEBUFFER,j),Z.framebufferTexture2D(Z.FRAMEBUFFER,Z.COLOR_ATTACHMENT0,Z.TEXTURE_2D,t,0);const S=Z.checkFramebufferStatus(Z.FRAMEBUFFER);if(o=o&&S===Z.FRAMEBUFFER_COMPLETE,o=o&&Z.getError()===Z.NO_ERROR,o&&(Z.clear(Z.COLOR_BUFFER_BIT),o=o&&Z.getError()===Z.NO_ERROR),o){Z.bindFramebuffer(Z.FRAMEBUFFER,null);const s=Z.RGBA,t=Z.UNSIGNED_BYTE,j=new Uint8Array(4);Z.readPixels(0,0,1,1,s,t,j),o=o&&Z.getError()===Z.NO_ERROR}for(Z.deleteTexture(t),Z.deleteFramebuffer(j),Z.bindFramebuffer(Z.FRAMEBUFFER,null);!o&&Z.getError()!==Z.NO_ERROR;);return o}_getWebGLTextureType(s){if(1===this._webGLVersion){switch(s){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(s){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=Z?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(s){case 0:o=this._gl.ALPHA;break;case 1:o=this._gl.LUMINANCE;break;case 2:o=this._gl.LUMINANCE_ALPHA;break;case 6:case 33322:case 36760:o=this._gl.RED;break;case 7:case 33324:case 36761:o=this._gl.RG;break;case 4:case 32852:case 36762:o=Z?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:case 32859:case 36763:o=Z?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(s){case 8:o=this._gl.RED_INTEGER;break;case 9:o=this._gl.RG_INTEGER;break;case 10:o=this._gl.RGB_INTEGER;break;case 11:o=this._gl.RGBA_INTEGER}return o}_getRGBABufferInternalSizedFormat(s,Z){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(1===this._webGLVersion){if(void 0!==Z)switch(Z){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return o?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(s){case 3:switch(Z){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(Z){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return o?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return o?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(Z){case 8:return this._gl.R16I;case 36760:return this._gl.R16_SNORM_EXT;case 36761:return this._gl.RG16_SNORM_EXT;case 36762:return this._gl.RGB16_SNORM_EXT;case 36763:return this._gl.RGBA16_SNORM_EXT;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(Z){case 8:return this._gl.R16UI;case 33322:return this._gl.R16_EXT;case 33324:return this._gl.RG16_EXT;case 32852:return this._gl.RGB16_EXT;case 32859:return this._gl.RGBA16_EXT;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(Z){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(Z){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(Z){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(Z){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(Z){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return o?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(s,Z,o,t){let j=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;const v=j?4:3,G=j?this._gl.RGBA:this._gl.RGB,B=o*t*v;if(O){if(O.length<B)return S.b.Error(`Data buffer is too small to store the read pixels (${O.length} should be more than ${B})`),Promise.resolve(O)}else O=new Uint8Array(B);return a&&this.flushFramebuffer(),this._gl.readPixels(s,Z,o,t,G,this._gl.UNSIGNED_BYTE,O),Promise.resolve(O)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const s=D.e._CreateCanvas(1,1),Z=s.getContext("webgl")||s.getContext("experimental-webgl");this._IsSupported=null!=Z&&!!window.WebGLRenderingContext}catch(s){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const s=D.e._CreateCanvas(1,1),Z=s.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||s.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!Z}catch(s){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}u._TempClearColorUint32=new Uint32Array(4),u._TempClearColorInt32=new Int32Array(4),u.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],u._ConcatenateShader=f.f,u._IsSupported=null,u._HasMajorPerformanceCaveat=null},11532:(s,Z,o)=>{var t;o.d(Z,{d:()=>j}),function(s){s[s.PointerMove=0]="PointerMove",s[s.PointerDown=1]="PointerDown",s[s.PointerUp=2]="PointerUp"}(t||(t={}));class j{}j.DOM_DELTA_PIXEL=0,j.DOM_DELTA_LINE=1,j.DOM_DELTA_PAGE=2},11525:(s,Z,o)=>{o.d(Z,{e:()=>t,h:()=>S,l:()=>j});class t{}t.KEYDOWN=1,t.KEYUP=2;class j{constructor(s,Z){this.type=s,this.event=Z}}class S extends j{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(s){this.skipOnKeyboardObservable=s}constructor(s,Z){super(s,Z),this.type=s,this.event=Z,this.skipOnKeyboardObservable=!1}}},11516:(s,Z,o)=>{o.d(Z,{b:()=>j,d:()=>a,f:()=>O});var t=o(10900);class j{}j.POINTERDOWN=1,j.POINTERUP=2,j.POINTERMOVE=4,j.POINTERWHEEL=8,j.POINTERPICK=16,j.POINTERTAP=32,j.POINTERDOUBLETAP=64;class S{constructor(s,Z){this.type=s,this.event=Z}}class a extends S{constructor(s,Z,o,j){super(s,Z),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new t.j(o,j)}}class O extends S{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}constructor(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(s,Z),this._pickInfo=o,this._inputManager=t}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}},11626:(s,Z,o)=>{o.d(Z,{b:()=>D});var t=o(11086),j=o(11091),S=o(10900),a=o(11174),O=o(11201),v=o(11155),G=o(10916),B=o(11187),Q=o(11167);class D extends O.d{get range(){return this._range}set range(s){this._range=s,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(s){this._intensityMode=s,this._computePhotometricScale()}get radius(){return this._radius}set radius(s){this._radius=s,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(s){this._shadowEnabled!==s&&(this._shadowEnabled=s,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(s){this._includedOnlyMeshes=s,this._hookArrayForIncludedOnly(s)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(s){this._excludedMeshes=s,this._hookArrayForExcluded(s)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(s){this._excludeWithLayerMask=s,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(s){this._includeOnlyWithLayerMask=s,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(s){this._lightmapMode!==s&&(this._lightmapMode=s,this._markMeshesAsLightDirty())}getViewMatrix(s){return null}getProjectionMatrix(s,Z){return null}constructor(s,Z){super(s,Z,!1),this.DO=new a.d(1,1,1),this.CG=new a.d(1,1,1),this.falloffType=D.FALLOFF_DEFAULT,this.QO=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=D.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.Ls().addLight(this),this._uniformBuffer=new v.e(this.Ls().getEngine(),void 0,void 0,s),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(s,Z){return this}_bindLight(s,Z,o,t){let j=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const S=s.toString();let O=!1;if(this._uniformBuffer.bindToEffect(o,"Light"+S),this._renderId!==Z.getRenderId()||this._lastUseSpecular!==t||!this._uniformBuffer.useUbo){this._renderId=Z.getRenderId(),this._lastUseSpecular=t;const s=this.getScaledIntensity();this.transferToEffect(o,S),this.DO.scaleToRef(s,a.k.pz[0]),this._uniformBuffer.updateColor4("vLightDiffuse",a.k.pz[0],this.range,S),t&&(this.CG.scaleToRef(s,a.k.pz[1]),this._uniformBuffer.updateColor4("vLightSpecular",a.k.pz[1],this.radius,S)),O=!0}if(this.transferTexturesToEffect(o,S),Z.shadowsEnabled&&this.shadowEnabled&&j){const s=this.getShadowGenerator(Z.activeCamera)??this.getShadowGenerator();s&&(s.bindShadowLight(S,o),O=!0)}O?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(s){let Z="Name: "+this.name;if(Z+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let o=0;o<this.animations.length;o++)Z+=", animation[0]: "+this.animations[o].toString(s);return Z}_syncParentEnabledState(){super._syncParentEnabledState(),this.B()||this._resyncMeshes()}iO(s){super.iO(s),this._resyncMeshes()}getShadowGenerator(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(s)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return S.n.Zero()}canAffectMesh(s){return!s||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(s))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(s))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&s.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&s.layerMask)))}dispose(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const s=this._shadowGenerators.values();for(let Z=s.next();!0!==Z.done;Z=s.next()){Z.value.dispose()}this._shadowGenerators=null}if(this.Ls().stopAnimation(this),this._parentContainer){const s=this._parentContainer.lights.indexOf(this);s>-1&&this._parentContainer.lights.splice(s,1),this._parentContainer=null}for(const o of this.Ls().meshes)o._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.Ls().removeLight(this),super.dispose(s,Z)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.QO}clone(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=D.GetConstructorFromName(this.getTypeID(),s,this.Ls());if(!o)return null;const t=Q.c.Clone(o,this);return s&&(t.name=s),Z&&(t.parent=Z),t.iO(this.isEnabled()),this.onClonedObservable.notifyObservers(t),t}serialize(){const s=Q.c.Serialize(this);if(s.uniqueId=this.uniqueId,s.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(s),this.excludedMeshes.length>0){s.excludedMeshesIds=[];for(const Z of this.excludedMeshes)s.excludedMeshesIds.push(Z.id)}if(this.includedOnlyMeshes.length>0){s.includedOnlyMeshesIds=[];for(const Z of this.includedOnlyMeshes)s.includedOnlyMeshesIds.push(Z.id)}return Q.c.AppendSerializedAnimations(this,s),s.ranges=this.serializeAnimationRanges(),s.isEnabled=this.isEnabled(),s}static GetConstructorFromName(s,Z,o){const t=O.d.Construct("Light_Type_"+s,Z,o);return t||null}static Parse(s,Z){const o=D.GetConstructorFromName(s.type,s.name,Z);if(!o)return null;const t=Q.c.Parse(o,s,Z);if(s.excludedMeshesIds&&(t._excludedMeshesIds=s.excludedMeshesIds),s.includedOnlyMeshesIds&&(t._includedOnlyMeshesIds=s.includedOnlyMeshesIds),void 0!==s.parentId&&(t._waitingParentId=s.parentId),void 0!==s.parentInstanceIndex&&(t._waitingParentInstanceIndex=s.parentInstanceIndex),void 0!==s.falloffType&&(t.falloffType=s.falloffType),void 0!==s.lightmapMode&&(t.lightmapMode=s.lightmapMode),s.animations){for(let Z=0;Z<s.animations.length;Z++){const o=s.animations[Z],j=(0,G.e)("BABYLON.Animation");j&&t.animations.push(j.Parse(o))}O.d.ParseAnimationRanges(t,s,Z)}return s.autoAnimate&&Z.beginAnimation(t,s.autoAnimateFrom,s.autoAnimateTo,s.autoAnimateLoop,s.autoAnimateSpeed||1),void 0!==s.isEnabled&&t.iO(s.isEnabled),t}_hookArrayForExcluded(s){var Z=this;const o=s.push;s.push=function(){for(var t=arguments.length,j=new Array(t),S=0;S<t;S++)j[S]=arguments[S];const a=o.apply(s,j);for(const s of j)s._resyncLightSource(Z);return a};const t=s.splice;s.splice=(Z,o)=>{const j=t.apply(s,[Z,o]);for(const s of j)s._resyncLightSource(this);return j};for(const j of s)j._resyncLightSource(this)}_hookArrayForIncludedOnly(s){var Z=this;const o=s.push;s.push=function(){for(var t=arguments.length,j=new Array(t),S=0;S<t;S++)j[S]=arguments[S];const a=o.apply(s,j);return Z._resyncMeshes(),a};const t=s.splice;s.splice=(Z,o)=>{const j=t.apply(s,[Z,o]);return this._resyncMeshes(),j},this._resyncMeshes()}_resyncMeshes(){for(const s of this.Ls().meshes)s._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const s of this.Ls().meshes)-1!==s.lightSources.indexOf(this)&&s._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.Ls().resetCachedMaterial()}_getPhotometricScale(){let s=0;const Z=this.getTypeID();let o=this.intensityMode;switch(o===D.INTENSITYMODE_AUTOMATIC&&(o=Z===D.LIGHTTYPEID_DIRECTIONALLIGHT?D.INTENSITYMODE_ILLUMINANCE:D.INTENSITYMODE_LUMINOUSINTENSITY),Z){case D.LIGHTTYPEID_POINTLIGHT:case D.LIGHTTYPEID_SPOTLIGHT:switch(o){case D.INTENSITYMODE_LUMINOUSPOWER:s=1/(4*Math.PI);break;case D.INTENSITYMODE_LUMINOUSINTENSITY:s=1;break;case D.INTENSITYMODE_LUMINANCE:s=this.radius*this.radius}break;case D.LIGHTTYPEID_DIRECTIONALLIGHT:switch(o){case D.INTENSITYMODE_ILLUMINANCE:s=1;break;case D.INTENSITYMODE_LUMINANCE:{let Z=this.radius;Z=Math.max(Z,.001);s=2*Math.PI*(1-Math.cos(Z));break}}break;case D.LIGHTTYPEID_HEMISPHERICLIGHT:s=1}return s}_reorderLightsInScene(){const s=this.Ls();0!=this._renderPriority&&(s.requireLightSorting=!0),this.Ls().sortLightsByPriority()}_isReady(){return!0}}D.FALLOFF_DEFAULT=B.b.FALLOFF_DEFAULT,D.FALLOFF_PHYSICAL=B.b.FALLOFF_PHYSICAL,D.FALLOFF_GLTF=B.b.FALLOFF_GLTF,D.FALLOFF_STANDARD=B.b.FALLOFF_STANDARD,D.LIGHTMAP_DEFAULT=B.b.LIGHTMAP_DEFAULT,D.LIGHTMAP_SPECULAR=B.b.LIGHTMAP_SPECULAR,D.LIGHTMAP_SHADOWSONLY=B.b.LIGHTMAP_SHADOWSONLY,D.INTENSITYMODE_AUTOMATIC=B.b.INTENSITYMODE_AUTOMATIC,D.INTENSITYMODE_LUMINOUSPOWER=B.b.INTENSITYMODE_LUMINOUSPOWER,D.INTENSITYMODE_LUMINOUSINTENSITY=B.b.INTENSITYMODE_LUMINOUSINTENSITY,D.INTENSITYMODE_ILLUMINANCE=B.b.INTENSITYMODE_ILLUMINANCE,D.INTENSITYMODE_LUMINANCE=B.b.INTENSITYMODE_LUMINANCE,D.LIGHTTYPEID_POINTLIGHT=B.b.LIGHTTYPEID_POINTLIGHT,D.LIGHTTYPEID_DIRECTIONALLIGHT=B.b.LIGHTTYPEID_DIRECTIONALLIGHT,D.LIGHTTYPEID_SPOTLIGHT=B.b.LIGHTTYPEID_SPOTLIGHT,D.LIGHTTYPEID_HEMISPHERICLIGHT=B.b.LIGHTTYPEID_HEMISPHERICLIGHT,D.LIGHTTYPEID_RECT_AREALIGHT=B.b.LIGHTTYPEID_RECT_AREALIGHT,(0,t.c)([(0,j.i)()],D.prototype,"diffuse",void 0),(0,t.c)([(0,j.i)()],D.prototype,"specular",void 0),(0,t.c)([(0,j.K)()],D.prototype,"falloffType",void 0),(0,t.c)([(0,j.K)()],D.prototype,"intensity",void 0),(0,t.c)([(0,j.K)()],D.prototype,"range",null),(0,t.c)([(0,j.K)()],D.prototype,"intensityMode",null),(0,t.c)([(0,j.K)()],D.prototype,"radius",null),(0,t.c)([(0,j.K)()],D.prototype,"_renderPriority",void 0),(0,t.c)([(0,j.c)("_reorderLightsInScene")],D.prototype,"renderPriority",void 0),(0,t.c)([(0,j.K)("shadowEnabled")],D.prototype,"_shadowEnabled",void 0),(0,t.c)([(0,j.K)("excludeWithLayerMask")],D.prototype,"_excludeWithLayerMask",void 0),(0,t.c)([(0,j.K)("includeOnlyWithLayerMask")],D.prototype,"_includeOnlyWithLayerMask",void 0),(0,t.c)([(0,j.K)("lightmapMode")],D.prototype,"_lightmapMode",void 0)},11187:(s,Z,o)=>{o.d(Z,{b:()=>t});class t{static CompareLightsPriority(s,Z){return s.shadowEnabled!==Z.shadowEnabled?(Z.shadowEnabled?1:0)-(s.shadowEnabled?1:0):Z.renderPriority-s.renderPriority}}t.FALLOFF_DEFAULT=0,t.FALLOFF_PHYSICAL=1,t.FALLOFF_GLTF=2,t.FALLOFF_STANDARD=3,t.LIGHTMAP_DEFAULT=0,t.LIGHTMAP_SPECULAR=1,t.LIGHTMAP_SHADOWSONLY=2,t.INTENSITYMODE_AUTOMATIC=0,t.INTENSITYMODE_LUMINOUSPOWER=1,t.INTENSITYMODE_LUMINOUSINTENSITY=2,t.INTENSITYMODE_ILLUMINANCE=3,t.INTENSITYMODE_LUMINANCE=4,t.LIGHTTYPEID_POINTLIGHT=0,t.LIGHTTYPEID_DIRECTIONALLIGHT=1,t.LIGHTTYPEID_SPOTLIGHT=2,t.LIGHTTYPEID_HEMISPHERICLIGHT=3,t.LIGHTTYPEID_RECT_AREALIGHT=4},11689:(s,Z,o)=>{o.d(Z,{d:()=>v});var t=o(11086),j=o(11091),S=o(10900),a=o(11626),O=o(11229);class v extends a.b{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=S.b.Identity(),this._projectionMatrix=S.b.Identity()}_setPosition(s){this._position=s}get position(){return this._position}set position(s){this._setPosition(s)}_setDirection(s){this._direction=s}get direction(){return this._direction}set direction(s){this._setDirection(s)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(s){this._shadowMinZ=s,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(s){this._shadowMaxZ=s,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=S.n.Zero()),S.n.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=S.n.Zero()),S.n.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(s){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(s){return this.direction=S.n.Normalize(s.Go(this.position)),this.direction}getRotation(){this.direction.normalize();const s=S.n.Cross(this.direction,O.c.Y),Z=S.n.Cross(s,this.direction);return S.n.RotationFromAxis(s,Z,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=S.n.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}Ea(s){return!s&&this.isSynchronized()?(this._currentRenderId=this.Ls().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.O(this.position),this._worldMatrix||(this._worldMatrix=S.b.Identity()),S.b.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(s){return void 0!==this.shadowMinZ?this.shadowMinZ:(null===s||void 0===s?void 0:s.OO)||0}getDepthMaxZ(s){return void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===s||void 0===s?void 0:s.maxZ)||1e4}setShadowProjectionMatrix(s,Z,o){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(Z,o,s):this._setDefaultShadowProjectionMatrix(s,Z,o),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(s){const Z=S.g.sO[0];let o=this.position;this.computeTransformedInformation()&&(o=this.transformedPosition),S.n.NormalizeToRef(this.getShadowDirection(s),Z),1===Math.abs(S.n.Dot(Z,S.n.Up()))&&(Z.z=1e-13);const t=S.g.sO[1];return o.addToRef(Z,t),S.b.LookAtLHToRef(o,t,S.n.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(s,Z){return this.setShadowProjectionMatrix(this._projectionMatrix,s??this._viewMatrix,Z??[]),this._projectionMatrix}}(0,t.c)([(0,j.G)()],v.prototype,"position",null),(0,t.c)([(0,j.G)()],v.prototype,"direction",null),(0,t.c)([(0,j.K)()],v.prototype,"shadowMinZ",null),(0,t.c)([(0,j.K)()],v.prototype,"shadowMaxZ",null)},11282:(s,Z,o)=>{o.d(Z,{b:()=>t});class t{static get ForceFullSceneLoadingForIncremental(){return t._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(s){t._ForceFullSceneLoadingForIncremental=s}static get ShowLoadingScreen(){return t._ShowLoadingScreen}static set ShowLoadingScreen(s){t._ShowLoadingScreen=s}static get loggingLevel(){return t._LoggingLevel}static set loggingLevel(s){t._LoggingLevel=s}static get CleanBoneMatrixWeights(){return t._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(s){t._CleanBoneMatrixWeights=s}}t._ForceFullSceneLoadingForIncremental=!1,t._ShowLoadingScreen=!0,t._CleanBoneMatrixWeights=!1,t._LoggingLevel=0},11486:(s,Z,o)=>{o.d(Z,{d:()=>k});var t=o(11086),j=o(11091),S=o(10955),a=o(11253),O=o(11480),v=o(11493),G=o(10900),B=o(11113),Q=o(11548),D=o(11556);class z extends Q.b{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1,this.MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,this.LEGACY_SPECULAR_ENERGY_CONSERVATION=!1,this.BASE_DIFFUSE_MODEL=0,this.DIELECTRIC_SPECULAR_MODEL=0,this.CONDUCTOR_SPECULAR_MODEL=0}}class Y extends D.c{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(s,"PBRBRDF",90,new z,Z),this._useEnergyConservation=Y.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=Y.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=Y.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=Y.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=Y.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=Y.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=Y.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=Y.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._mixIblRadianceWithIrradiance=Y.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this.mixIblRadianceWithIrradiance=Y.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this._useLegacySpecularEnergyConservation=Y.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this.useLegacySpecularEnergyConservation=Y.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this._baseDiffuseModel=Y.DEFAULT_DIFFUSE_MODEL,this.baseDiffuseModel=Y.DEFAULT_DIFFUSE_MODEL,this._dielectricSpecularModel=Y.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this.dielectricSpecularModel=Y.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this._conductorSpecularModel=Y.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this.conductorSpecularModel=Y.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this._internalMarkAllSubMeshesAsMiscDirty=s._dirtyCallbacks[16],this._enable(!0)}prepareDefines(s){s.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,s.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,s.SPHERICAL_HARMONICS=this._useSphericalHarmonics,s.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation,s.MIX_IBL_RADIANCE_WITH_IRRADIANCE=this._mixIblRadianceWithIrradiance,s.LEGACY_SPECULAR_ENERGY_CONSERVATION=this._useLegacySpecularEnergyConservation,s.BASE_DIFFUSE_MODEL=this._baseDiffuseModel,s.DIELECTRIC_SPECULAR_MODEL=this._dielectricSpecularModel,s.CONDUCTOR_SPECULAR_MODEL=this._conductorSpecularModel}getClassName(){return"PBRBRDFConfiguration"}}Y.DEFAULT_USE_ENERGY_CONSERVATION=!0,Y.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,Y.DEFAULT_USE_SPHERICAL_HARMONICS=!0,Y.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,Y.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,Y.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION=!0,Y.DEFAULT_DIFFUSE_MODEL=0,Y.DEFAULT_DIELECTRIC_SPECULAR_MODEL=0,Y.DEFAULT_CONDUCTOR_SPECULAR_MODEL=0,(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsMiscDirty")],Y.prototype,"useEnergyConservation",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsMiscDirty")],Y.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsMiscDirty")],Y.prototype,"useSphericalHarmonics",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsMiscDirty")],Y.prototype,"useSpecularGlossinessInputEnergyConservation",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsMiscDirty")],Y.prototype,"mixIblRadianceWithIrradiance",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsMiscDirty")],Y.prototype,"useLegacySpecularEnergyConservation",void 0),(0,t.c)([(0,j.K)("baseDiffuseModel"),(0,j.c)("_markAllSubMeshesAsMiscDirty")],Y.prototype,"baseDiffuseModel",void 0),(0,t.c)([(0,j.K)("dielectricSpecularModel"),(0,j.c)("_markAllSubMeshesAsMiscDirty")],Y.prototype,"dielectricSpecularModel",void 0),(0,t.c)([(0,j.K)("conductorSpecularModel"),(0,j.c)("_markAllSubMeshesAsMiscDirty")],Y.prototype,"conductorSpecularModel",void 0);var b=o(11560),f=o(11174),A=o(11502),d=o(11081),U=o(11566),u=o(11410),H=o(11572),F=(o(11576),o(11590)),i=o(11181);class N extends Q.b{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class L extends D.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(s,"PBRClearCoat",100,new N,Z),this._isEnabled=!1,this.isEnabled=!1,this.QO=1,this.roughness=0,this._indexOfRefraction=L._DefaultIndexOfRefraction,this.indexOfRefraction=L._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=f.d.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=s._dirtyCallbacks[1]}isReadyForSubMesh(s,Z,o){if(!this._isEnabled)return!0;const t=this._material._disableBumpMap;if(s._areTexturesDirty&&Z.texturesEnabled){if(this._texture&&H.c.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&H.c.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(o.getCaps().standardDerivatives&&this._bumpTexture&&H.c.ClearCoatBumpTextureEnabled&&!t&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&H.c.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(s,Z){this._isEnabled?(s.CLEARCOAT=!0,s.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,s.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,s._areTexturesDirty&&Z.texturesEnabled&&(this._texture&&H.c.ClearCoatTextureEnabled?(0,i.G)(this._texture,s,"CLEARCOAT_TEXTURE"):s.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&H.c.ClearCoatTextureEnabled?(0,i.G)(this._textureRoughness,s,"CLEARCOAT_TEXTURE_ROUGHNESS"):s.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&H.c.ClearCoatBumpTextureEnabled?(0,i.G)(this._bumpTexture,s,"CLEARCOAT_BUMP"):s.CLEARCOAT_BUMP=!1,s.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===L._DefaultIndexOfRefraction,this._isTintEnabled?(s.CLEARCOAT_TINT=!0,this._tintTexture&&H.c.ClearCoatTintTextureEnabled?((0,i.G)(this._tintTexture,s,"CLEARCOAT_TINT_TEXTURE"),s.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):s.CLEARCOAT_TINT_TEXTURE=!1):(s.CLEARCOAT_TINT=!1,s.CLEARCOAT_TINT_TEXTURE=!1))):(s.CLEARCOAT=!1,s.CLEARCOAT_TEXTURE=!1,s.CLEARCOAT_TEXTURE_ROUGHNESS=!1,s.CLEARCOAT_BUMP=!1,s.CLEARCOAT_TINT=!1,s.CLEARCOAT_TINT_TEXTURE=!1,s.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,s.CLEARCOAT_DEFAULTIOR=!1,s.CLEARCOAT_TEXTUREDIRECTUV=0,s.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,s.CLEARCOAT_BUMPDIRECTUV=0,s.CLEARCOAT_REMAP_F0=!1,s.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,s.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(s,Z,o,t){if(!this._isEnabled)return;const j=t.materialDefines,S=this._material.isFrozen,a=this._material._disableBumpMap,O=this._material._invertNormalMapX,v=this._material._invertNormalMapY;if(!s.useUbo||!S||!s.isSync){var G,B,Q,D;if((this._texture||this._textureRoughness)&&H.c.ClearCoatTextureEnabled)s.updateFloat4("vClearCoatInfos",(null===(G=this._texture)||void 0===G?void 0:G.coordinatesIndex)??0,(null===(B=this._texture)||void 0===B?void 0:B.level)??0,(null===(Q=this._textureRoughness)||void 0===Q?void 0:Q.coordinatesIndex)??0,(null===(D=this._textureRoughness)||void 0===D?void 0:D.level)??0),this._texture&&(0,i.l)(this._texture,s,"clearCoat"),this._textureRoughness&&!j.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,i.l)(this._textureRoughness,s,"clearCoatRoughness");this._bumpTexture&&o.getCaps().standardDerivatives&&H.c.ClearCoatTextureEnabled&&!a&&(s.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,i.l)(this._bumpTexture,s,"clearCoatBump"),Z._mirroredCameraPosition?s.updateFloat2("vClearCoatTangentSpaceParams",O?1:-1,v?1:-1):s.updateFloat2("vClearCoatTangentSpaceParams",O?-1:1,v?-1:1)),this._tintTexture&&H.c.ClearCoatTintTextureEnabled&&(s.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,i.l)(this._tintTexture,s,"clearCoatTint")),s.updateFloat2("vClearCoatParams",this.QO,this.roughness);const t=1-this._indexOfRefraction,S=1+this._indexOfRefraction,z=Math.pow(-t/S,2),Y=1/this._indexOfRefraction;s.updateFloat4("vClearCoatRefractionParams",z,Y,t,S),this._isTintEnabled&&(s.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),s.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}Z.texturesEnabled&&(this._texture&&H.c.ClearCoatTextureEnabled&&s.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!j.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&H.c.ClearCoatTextureEnabled&&s.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&o.getCaps().standardDerivatives&&H.c.ClearCoatBumpTextureEnabled&&!a&&s.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&H.c.ClearCoatTintTextureEnabled&&s.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(s){return this._texture===s||(this._textureRoughness===s||(this._bumpTexture===s||this._tintTexture===s))}getActiveTextures(s){this._texture&&s.push(this._texture),this._textureRoughness&&s.push(this._textureRoughness),this._bumpTexture&&s.push(this._bumpTexture),this._tintTexture&&s.push(this._tintTexture)}getAnimatables(s){this._texture&&this._texture.animations&&this._texture.animations.length>0&&s.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&s.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&s.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&s.push(this._tintTexture)}dispose(s){var Z,o,t,j;s&&(null===(Z=this._texture)||void 0===Z||Z.dispose(),null===(o=this._textureRoughness)||void 0===o||o.dispose(),null===(t=this._bumpTexture)||void 0===t||t.dispose(),null===(j=this._tintTexture)||void 0===j||j.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(s,Z,o){return s.CLEARCOAT_BUMP&&Z.addFallback(o++,"CLEARCOAT_BUMP"),s.CLEARCOAT_TINT&&Z.addFallback(o++,"CLEARCOAT_TINT"),s.CLEARCOAT&&Z.addFallback(o++,"CLEARCOAT"),o}getSamplers(s){s.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}L._DefaultIndexOfRefraction=1.5,(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"isEnabled",void 0),(0,t.c)([(0,j.K)()],L.prototype,"intensity",void 0),(0,t.c)([(0,j.K)()],L.prototype,"roughness",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"indexOfRefraction",void 0),(0,t.c)([(0,j.D)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"texture",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"useRoughnessFromMainTexture",void 0),(0,t.c)([(0,j.D)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"textureRoughness",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"remapF0OnInterfaceChange",void 0),(0,t.c)([(0,j.D)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"bumpTexture",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"isTintEnabled",void 0),(0,t.c)([(0,j.i)()],L.prototype,"tintColor",void 0),(0,t.c)([(0,j.K)()],L.prototype,"tintColorAtDistance",void 0),(0,t.c)([(0,j.K)()],L.prototype,"tintThickness",void 0),(0,t.c)([(0,j.D)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"tintTexture",void 0);class V extends Q.b{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class g extends D.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(s,"PBRIridescence",110,new V,Z),this._isEnabled=!1,this.isEnabled=!1,this.QO=1,this.minimumThickness=g._DefaultMinimumThickness,this.maximumThickness=g._DefaultMaximumThickness,this.indexOfRefraction=g._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=s._dirtyCallbacks[1]}isReadyForSubMesh(s,Z){if(!this._isEnabled)return!0;if(s._areTexturesDirty&&Z.texturesEnabled){if(this._texture&&H.c.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&H.c.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(s,Z){this._isEnabled?(s.IRIDESCENCE=!0,s._areTexturesDirty&&Z.texturesEnabled&&(this._texture&&H.c.IridescenceTextureEnabled?(0,i.G)(this._texture,s,"IRIDESCENCE_TEXTURE"):s.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&H.c.IridescenceTextureEnabled?(0,i.G)(this._thicknessTexture,s,"IRIDESCENCE_THICKNESS_TEXTURE"):s.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(s.IRIDESCENCE=!1,s.IRIDESCENCE_TEXTURE=!1,s.IRIDESCENCE_THICKNESS_TEXTURE=!1,s.IRIDESCENCE_TEXTUREDIRECTUV=0,s.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(s,Z){if(!this._isEnabled)return;const o=this._material.isFrozen;if(!s.useUbo||!o||!s.isSync){var t,j,S,a;if((this._texture||this._thicknessTexture)&&H.c.IridescenceTextureEnabled)s.updateFloat4("vIridescenceInfos",(null===(t=this._texture)||void 0===t?void 0:t.coordinatesIndex)??0,(null===(j=this._texture)||void 0===j?void 0:j.level)??0,(null===(S=this._thicknessTexture)||void 0===S?void 0:S.coordinatesIndex)??0,(null===(a=this._thicknessTexture)||void 0===a?void 0:a.level)??0),this._texture&&(0,i.l)(this._texture,s,"iridescence"),this._thicknessTexture&&(0,i.l)(this._thicknessTexture,s,"iridescenceThickness");s.updateFloat4("vIridescenceParams",this.QO,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}Z.texturesEnabled&&(this._texture&&H.c.IridescenceTextureEnabled&&s.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&H.c.IridescenceTextureEnabled&&s.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(s){return this._texture===s||this._thicknessTexture===s}getActiveTextures(s){this._texture&&s.push(this._texture),this._thicknessTexture&&s.push(this._thicknessTexture)}getAnimatables(s){this._texture&&this._texture.animations&&this._texture.animations.length>0&&s.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&s.push(this._thicknessTexture)}dispose(s){var Z,o;s&&(null===(Z=this._texture)||void 0===Z||Z.dispose(),null===(o=this._thicknessTexture)||void 0===o||o.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(s,Z,o){return s.IRIDESCENCE&&Z.addFallback(o++,"IRIDESCENCE"),o}getSamplers(s){s.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}g._DefaultMinimumThickness=100,g._DefaultMaximumThickness=400,g._DefaultIndexOfRefraction=1.3,(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"isEnabled",void 0),(0,t.c)([(0,j.K)()],g.prototype,"intensity",void 0),(0,t.c)([(0,j.K)()],g.prototype,"minimumThickness",void 0),(0,t.c)([(0,j.K)()],g.prototype,"maximumThickness",void 0),(0,t.c)([(0,j.K)()],g.prototype,"indexOfRefraction",void 0),(0,t.c)([(0,j.D)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"texture",void 0),(0,t.c)([(0,j.D)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"thicknessTexture",void 0);class l extends Q.b{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class R extends D.c{set angle(s){this.direction.x=Math.cos(s),this.direction.y=Math.sin(s)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(s,"PBRAnisotropic",110,new l,Z),this._isEnabled=!1,this.isEnabled=!1,this.QO=1,this.direction=new G.j(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=s._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=s._dirtyCallbacks[16]}isReadyForSubMesh(s,Z){return!this._isEnabled||!(s._areTexturesDirty&&Z.texturesEnabled&&this._texture&&H.c.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(s,Z,o){this._isEnabled?(s.ANISOTROPIC=this._isEnabled,this._isEnabled&&!o.isVerticesDataPresent(B.e.TangentKind)&&(s._needUVs=!0,s.MAINUV1=!0),s._areTexturesDirty&&Z.texturesEnabled&&(this._texture&&H.c.AnisotropicTextureEnabled?(0,i.G)(this._texture,s,"ANISOTROPIC_TEXTURE"):s.ANISOTROPIC_TEXTURE=!1),s._areMiscDirty&&(s.ANISOTROPIC_LEGACY=this._legacy)):(s.ANISOTROPIC=!1,s.ANISOTROPIC_TEXTURE=!1,s.ANISOTROPIC_TEXTUREDIRECTUV=0,s.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(s,Z){if(!this._isEnabled)return;const o=this._material.isFrozen;s.useUbo&&o&&s.isSync||(this._texture&&H.c.AnisotropicTextureEnabled&&(s.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,i.l)(this._texture,s,"anisotropy")),s.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.QO)),Z.texturesEnabled&&this._texture&&H.c.AnisotropicTextureEnabled&&s.setTexture("anisotropySampler",this._texture)}hasTexture(s){return this._texture===s}getActiveTextures(s){this._texture&&s.push(this._texture)}getAnimatables(s){this._texture&&this._texture.animations&&this._texture.animations.length>0&&s.push(this._texture)}dispose(s){s&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(s,Z,o){return s.ANISOTROPIC&&Z.addFallback(o++,"ANISOTROPIC"),o}getSamplers(s){s.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(s,Z,o){super.parse(s,Z,o),void 0===s.legacy&&(this.legacy=!0)}}(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"isEnabled",void 0),(0,t.c)([(0,j.K)()],R.prototype,"intensity",void 0),(0,t.c)([(0,j.F)()],R.prototype,"direction",void 0),(0,t.c)([(0,j.D)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"texture",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsMiscDirty")],R.prototype,"legacy",void 0);class e extends Q.b{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class c extends D.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(s,"Sheen",120,new e,Z),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.QO=1,this.color=f.d.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=s._dirtyCallbacks[1]}isReadyForSubMesh(s,Z){if(!this._isEnabled)return!0;if(s._areTexturesDirty&&Z.texturesEnabled){if(this._texture&&H.c.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&H.c.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(s,Z){this._isEnabled?(s.SHEEN=!0,s.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,s.SHEEN_ROUGHNESS=null!==this._roughness,s.SHEEN_ALBEDOSCALING=this._albedoScaling,s.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,s._areTexturesDirty&&Z.texturesEnabled&&(this._texture&&H.c.SheenTextureEnabled?((0,i.G)(this._texture,s,"SHEEN_TEXTURE"),s.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):s.SHEEN_TEXTURE=!1,this._textureRoughness&&H.c.SheenTextureEnabled?(0,i.G)(this._textureRoughness,s,"SHEEN_TEXTURE_ROUGHNESS"):s.SHEEN_TEXTURE_ROUGHNESS=!1)):(s.SHEEN=!1,s.SHEEN_TEXTURE=!1,s.SHEEN_TEXTURE_ROUGHNESS=!1,s.SHEEN_LINKWITHALBEDO=!1,s.SHEEN_ROUGHNESS=!1,s.SHEEN_ALBEDOSCALING=!1,s.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,s.SHEEN_GAMMATEXTURE=!1,s.SHEEN_TEXTUREDIRECTUV=0,s.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(s,Z,o,t){if(!this._isEnabled)return;const j=t.materialDefines,S=this._material.isFrozen;if(!s.useUbo||!S||!s.isSync){var a,O,v,G;if((this._texture||this._textureRoughness)&&H.c.SheenTextureEnabled)s.updateFloat4("vSheenInfos",(null===(a=this._texture)||void 0===a?void 0:a.coordinatesIndex)??0,(null===(O=this._texture)||void 0===O?void 0:O.level)??0,(null===(v=this._textureRoughness)||void 0===v?void 0:v.coordinatesIndex)??0,(null===(G=this._textureRoughness)||void 0===G?void 0:G.level)??0),this._texture&&(0,i.l)(this._texture,s,"sheen"),this._textureRoughness&&!j.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,i.l)(this._textureRoughness,s,"sheenRoughness");s.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.QO),null!==this._roughness&&s.updateFloat("vSheenRoughness",this._roughness)}Z.texturesEnabled&&(this._texture&&H.c.SheenTextureEnabled&&s.setTexture("sheenSampler",this._texture),this._textureRoughness&&!j.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&H.c.SheenTextureEnabled&&s.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(s){return this._texture===s||this._textureRoughness===s}getActiveTextures(s){this._texture&&s.push(this._texture),this._textureRoughness&&s.push(this._textureRoughness)}getAnimatables(s){this._texture&&this._texture.animations&&this._texture.animations.length>0&&s.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&s.push(this._textureRoughness)}dispose(s){var Z,o;s&&(null===(Z=this._texture)||void 0===Z||Z.dispose(),null===(o=this._textureRoughness)||void 0===o||o.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(s,Z,o){return s.SHEEN&&Z.addFallback(o++,"SHEEN"),o}getSamplers(s){s.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"isEnabled",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"linkSheenWithAlbedo",void 0),(0,t.c)([(0,j.K)()],c.prototype,"intensity",void 0),(0,t.c)([(0,j.i)()],c.prototype,"color",void 0),(0,t.c)([(0,j.D)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"texture",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"useRoughnessFromMainTexture",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"roughness",void 0),(0,t.c)([(0,j.D)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"textureRoughness",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"albedoScaling",void 0);class w extends Q.b{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1,this.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1,this.SS_TRANSLUCENCY_LEGACY=!1}}class X extends D.c{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(s){this._scene.enableSubSurfaceForPrePass()&&s&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(s))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(s){this._volumeIndexOfRefraction=s>=1?s:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(s,"PBRSubSurface",130,new w,Z),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=f.d.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=f.d.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this.applyAlbedoAfterSubSurface=X.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE,this.legacyTransluceny=X.DEFAULT_LEGACY_TRANSLUCENCY,this._scene=s.Ls(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=s._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=s._dirtyCallbacks[32]}isReadyForSubMesh(s,Z){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(s._areTexturesDirty&&Z.texturesEnabled){if(this._thicknessTexture&&H.c.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&H.c.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&H.c.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const s=this._getRefractionTexture(Z);if(s&&H.c.RefractionTextureEnabled&&!s.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(s,Z){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return s.SUBSURFACE=!1,s.SS_DISPERSION=!1,s.SS_TRANSLUCENCY=!1,s.SS_SCATTERING=!1,s.SS_REFRACTION=!1,s.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,s.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,s.SS_THICKNESSANDMASK_TEXTURE=!1,s.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,s.SS_HAS_THICKNESS=!1,s.SS_REFRACTIONINTENSITY_TEXTURE=!1,s.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,s.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,s.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,s.SS_REFRACTIONMAP_3D=!1,s.SS_REFRACTIONMAP_OPPOSITEZ=!1,s.SS_LODINREFRACTIONALPHA=!1,s.SS_GAMMAREFRACTION=!1,s.SS_RGBDREFRACTION=!1,s.SS_LINEARSPECULARREFRACTION=!1,s.SS_LINKREFRACTIONTOTRANSPARENCY=!1,s.SS_ALBEDOFORREFRACTIONTINT=!1,s.SS_ALBEDOFORTRANSLUCENCYTINT=!1,s.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,s.SS_USE_THICKNESS_AS_DEPTH=!1,s.SS_USE_GLTF_TEXTURES=!1,s.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,s.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,s.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,void(s.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1);if(s._areTexturesDirty){if(s.SUBSURFACE=!0,s.SS_DISPERSION=this._isDispersionEnabled,s.SS_TRANSLUCENCY=this._isTranslucencyEnabled,s.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,s.SS_TRANSLUCENCY_LEGACY=this.legacyTransluceny,s.SS_SCATTERING=this._isScatteringEnabled,s.SS_THICKNESSANDMASK_TEXTURE=!1,s.SS_REFRACTIONINTENSITY_TEXTURE=!1,s.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,s.SS_HAS_THICKNESS=!1,s.SS_USE_GLTF_TEXTURES=!1,s.SS_REFRACTION=!1,s.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,s.SS_REFRACTIONMAP_3D=!1,s.SS_GAMMAREFRACTION=!1,s.SS_RGBDREFRACTION=!1,s.SS_LINEARSPECULARREFRACTION=!1,s.SS_REFRACTIONMAP_OPPOSITEZ=!1,s.SS_LODINREFRACTIONALPHA=!1,s.SS_LINKREFRACTIONTOTRANSPARENCY=!1,s.SS_ALBEDOFORREFRACTIONTINT=!1,s.SS_ALBEDOFORTRANSLUCENCYTINT=!1,s.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,s.SS_USE_THICKNESS_AS_DEPTH=!1,s.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,s.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=this.applyAlbedoAfterSubSurface,s._areTexturesDirty&&Z.texturesEnabled&&(this._thicknessTexture&&H.c.ThicknessTextureEnabled&&(0,i.G)(this._thicknessTexture,s,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&H.c.RefractionIntensityTextureEnabled&&(0,i.G)(this._refractionIntensityTexture,s,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&H.c.TranslucencyIntensityTextureEnabled&&(0,i.G)(this._translucencyIntensityTexture,s,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&H.c.TranslucencyColorTextureEnabled&&((0,i.G)(this._translucencyColorTexture,s,"SS_TRANSLUCENCYCOLOR_TEXTURE"),s.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=this._translucencyColorTexture.gammaSpace)),s.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,s.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,s.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,s.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&Z.texturesEnabled){const o=this._getRefractionTexture(Z);o&&H.c.RefractionTextureEnabled&&(s.SS_REFRACTION=!0,s.SS_REFRACTIONMAP_3D=o.isCube,s.SS_GAMMAREFRACTION=o.gammaSpace,s.SS_RGBDREFRACTION=o.isRGBD,s.SS_LINEARSPECULARREFRACTION=o.linearSpecularLOD,s.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&o.isCube?!o.invertZ:o.invertZ,s.SS_LODINREFRACTIONALPHA=o.lodLevelInAlpha,s.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,s.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,s.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=o.isCube&&o.boundingBoxSize,s.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(s.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(s,Z,o,t){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)s.updateFloat2("vThicknessParam",0,0);else{t.getRenderingMesh().getWorldMatrix().decompose(G.g.sO[0]);const Z=Math.max(Math.abs(G.g.sO[0].x),Math.abs(G.g.sO[0].y),Math.abs(G.g.sO[0].z));s.updateFloat2("vThicknessParam",this.minimumThickness*Z,(this.maximumThickness-this.minimumThickness)*Z)}}bindForSubMesh(s,Z,o,t){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const j=t.materialDefines,S=this._material.isFrozen,a=this._material.realTimeFiltering,O=j.LODBASEDMICROSFURACE,v=this._getRefractionTexture(Z);if(!s.useUbo||!S||!s.isSync){if(this._thicknessTexture&&H.c.ThicknessTextureEnabled&&(s.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,i.l)(this._thicknessTexture,s,"thickness")),this._refractionIntensityTexture&&H.c.RefractionIntensityTextureEnabled&&j.SS_REFRACTIONINTENSITY_TEXTURE&&(s.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,i.l)(this._refractionIntensityTexture,s,"refractionIntensity")),this._translucencyColorTexture&&H.c.TranslucencyColorTextureEnabled&&j.SS_TRANSLUCENCYCOLOR_TEXTURE&&(s.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,i.l)(this._translucencyColorTexture,s,"translucencyColor")),this._translucencyIntensityTexture&&H.c.TranslucencyIntensityTextureEnabled&&j.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(s.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,i.l)(this._translucencyIntensityTexture,s,"translucencyIntensity")),v&&H.c.RefractionTextureEnabled){s.SO("refractionMatrix",v.getRefractionTextureMatrix());let Z=1;v.isCube||v.depth&&(Z=v.depth);const o=v.getSize().width,t=this.volumeIndexOfRefraction;if(s.updateFloat4("vRefractionInfos",v.level,1/t,Z,this._invertRefractionY?-1:1),s.updateFloat4("vRefractionMicrosurfaceInfos",o,v.lodGenerationScale,v.lodGenerationOffset,1/this.indexOfRefraction),a&&s.updateFloat2("vRefractionFilteringInfo",o,Math.log2(o)),v.boundingBoxSize){const Z=v;s.updateVector3("vRefractionPosition",Z.boundingBoxPosition),s.updateVector3("vRefractionSize",Z.boundingBoxSize)}}this._isScatteringEnabled&&s.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),s.updateColor3("vDiffusionDistance",this.diffusionDistance),s.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),s.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),s.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),s.updateFloat("dispersion",this.dispersion)}Z.texturesEnabled&&(this._thicknessTexture&&H.c.ThicknessTextureEnabled&&s.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&H.c.RefractionIntensityTextureEnabled&&j.SS_REFRACTIONINTENSITY_TEXTURE&&s.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&H.c.TranslucencyIntensityTextureEnabled&&j.SS_TRANSLUCENCYINTENSITY_TEXTURE&&s.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&H.c.TranslucencyColorTextureEnabled&&j.SS_TRANSLUCENCYCOLOR_TEXTURE&&s.setTexture("translucencyColorSampler",this._translucencyColorTexture),v&&H.c.RefractionTextureEnabled&&(O?s.setTexture("refractionSampler",v):(s.setTexture("refractionSampler",v._lodTextureMid||v),s.setTexture("refractionSamplerLow",v._lodTextureLow||v),s.setTexture("refractionSamplerHigh",v._lodTextureHigh||v))))}_getRefractionTexture(s){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?s.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(s){H.c.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&s.push(this._refractionTexture)}hasTexture(s){return this._thicknessTexture===s||(this._refractionTexture===s||(this._refractionIntensityTexture===s||(this._translucencyIntensityTexture===s||this._translucencyColorTexture===s)))}hasRenderTargetTextures(){return!!(H.c.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(s){this._thicknessTexture&&s.push(this._thicknessTexture),this._refractionTexture&&s.push(this._refractionTexture),this._translucencyColorTexture&&s.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&s.push(this._translucencyIntensityTexture)}getAnimatables(s){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&s.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&s.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&s.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&s.push(this._translucencyIntensityTexture)}dispose(s){s&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(s,Z,o){return s.SS_SCATTERING&&Z.addFallback(o++,"SS_SCATTERING"),s.SS_TRANSLUCENCY&&Z.addFallback(o++,"SS_TRANSLUCENCY"),o}getSamplers(s){s.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}X.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE=!1,X.DEFAULT_LEGACY_TRANSLUCENCY=!1,(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"isRefractionEnabled",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"isTranslucencyEnabled",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"isDispersionEnabled",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markScenePrePassDirty")],X.prototype,"isScatteringEnabled",void 0),(0,t.c)([(0,j.K)()],X.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,t.c)([(0,j.K)()],X.prototype,"refractionIntensity",void 0),(0,t.c)([(0,j.K)()],X.prototype,"translucencyIntensity",void 0),(0,t.c)([(0,j.K)()],X.prototype,"useAlbedoToTintRefraction",void 0),(0,t.c)([(0,j.K)()],X.prototype,"useAlbedoToTintTranslucency",void 0),(0,t.c)([(0,j.D)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"thicknessTexture",void 0),(0,t.c)([(0,j.D)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"refractionTexture",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"indexOfRefraction",void 0),(0,t.c)([(0,j.K)()],X.prototype,"_volumeIndexOfRefraction",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"volumeIndexOfRefraction",null),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"invertRefractionY",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"linkRefractionWithTransparency",void 0),(0,t.c)([(0,j.K)()],X.prototype,"minimumThickness",void 0),(0,t.c)([(0,j.K)()],X.prototype,"maximumThickness",void 0),(0,t.c)([(0,j.K)()],X.prototype,"useThicknessAsDepth",void 0),(0,t.c)([(0,j.i)()],X.prototype,"tintColor",void 0),(0,t.c)([(0,j.K)()],X.prototype,"tintColorAtDistance",void 0),(0,t.c)([(0,j.K)()],X.prototype,"dispersion",void 0),(0,t.c)([(0,j.i)()],X.prototype,"diffusionDistance",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"useMaskFromThicknessTexture",void 0),(0,t.c)([(0,j.D)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"refractionIntensityTexture",void 0),(0,t.c)([(0,j.D)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"translucencyIntensityTexture",void 0),(0,t.c)([(0,j.i)()],X.prototype,"translucencyColor",void 0),(0,t.c)([(0,j.D)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"translucencyColorTexture",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"useGltfStyleTextures",void 0),(0,t.c)([(0,j.K)()],X.prototype,"applyAlbedoAfterSubSurface",void 0),(0,t.c)([(0,j.K)()],X.prototype,"legacyTransluceny",void 0);var W=o(11598),q=o(11189),h=o(11601);const M={effect:null,subMesh:null};class x extends Q.b{constructor(s){super(s),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.IBL_CDF_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BASE_WEIGHT=!1,this.BASE_WEIGHTDIRECTUV=0,this.BASE_DIFFUSE_ROUGHNESS=!1,this.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.MIRRORED=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class k extends U.e{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(s){this._realTimeFiltering=s,this.dG(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(s){this._realTimeFilteringQuality=s,this.dG(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(s){s!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=s||this.Ls().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(s,Z){super(s,Z,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||k.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new G.p(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._baseWeightTexture=null,this._baseDiffuseRoughnessTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=k.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=f.d.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new f.d(0,0,0),this._albedoColor=new f.d(1,1,1),this._baseWeight=1,this._baseDiffuseRoughness=null,this._reflectivityColor=new f.d(1,1,1),this._reflectionColor=new f.d(1,1,1),this._emissiveColor=new f.d(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=k.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new a.f(16),this._globalAmbientColor=new f.d(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new Y(this),this.clearCoat=new L(this),this.iridescence=new g(this),this.anisotropy=new R(this),this.sheen=new c(this),this.subSurface=new X(this),this.detailMap=new W.d(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),H.c.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,O.b)(this.Ls()),this.prePassConfiguration=new b.e}get hasRenderTargetTextures(){return!!(H.c.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var s;return this._transparencyMode===k.PBRMATERIAL_OPAQUE||this._transparencyMode===k.PBRMATERIAL_ALPHATEST||(null===(s=this.subSurface)||void 0===s?void 0:s.disableAlphaBlending)}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var s;return this._hasTransparencyMode?this._transparencyModeIsTest:(null===(s=this.subSurface)||void 0===s||!s.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===k.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.na&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==k.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.na||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(s,Z,o){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const t=Z._drawWrapper;if(t.effect&&this.isFrozen&&t._wasPreviouslyReady&&t._wasPreviouslyUsingInstances===o)return!0;Z.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),Z.materialDefines=new x(this._eventInfo.defineNames));const j=Z.materialDefines;if(this._isReadyForSubMesh(Z))return!0;const a=this.Ls(),O=a.getEngine();if(j._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,a.texturesEnabled)){if(this._albedoTexture&&H.c.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._baseWeightTexture&&H.c.BaseWeightTextureEnabled&&!this._baseWeightTexture.isReadyOrNotBlocking())return!1;if(this._baseDiffuseRoughnessTexture&&H.c.BaseDiffuseRoughnessTextureEnabled&&!this._baseDiffuseRoughnessTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&H.c.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&H.c.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const s=this._getReflectionTexture();if(s&&H.c.ReflectionTextureEnabled){if(!s.isReadyOrNotBlocking())return!1;var v;if(s.irradianceTexture){if(!s.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!s.sphericalPolynomial&&null!==(v=s.getInternalTexture())&&void 0!==v&&v._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&H.c.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&H.c.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(H.c.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(O.getCaps().standardDerivatives&&this._bumpTexture&&H.c.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&H.c.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=j,this._eventInfo.subMesh=Z,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(j._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;if(j.AREALIGHTUSED)for(let S=0;S<s.lightSources.length;S++)if(!s.lightSources[S]._isReady())return!1;O.getCaps().standardDerivatives||s.isVerticesDataPresent(B.e.NormalKind)||(s.createNormals(!0),S.b.Warn("PBRMaterial: Normals have been created for the mesh: "+s.name));const G=Z.effect,Q=j._areLightsDisposed;let D=this._prepareEffect(s,j,this.onCompiled,this.onError,o,null,Z.getRenderingMesh().hasThinInstances),z=!1;if(D)if(this._onEffectCreatedObservable&&(M.effect=D,M.subMesh=Z,this._onEffectCreatedObservable.notifyObservers(M)),this.allowShaderHotSwapping&&G&&!D.isReady()){if(D=G,j.markAsUnprocessed(),z=this.isFrozen,Q)return j._areLightsDisposed=!0,!1}else a.resetCachedMaterial(),Z.setEffect(D,j,this._materialContext);return!(!Z.effect||!Z.effect.isReady())&&(j._renderId=a.getRenderId(),t._wasPreviouslyReady=!z,t._wasPreviouslyUsingInstances=!!o,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(s,Z){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(s,Z,S,a,O),!Z.isDirty)return null;Z.markAsProcessed();const v=this.Ls().getEngine(),G=new F.c;let Q=0;Z.USESPHERICALINVERTEX&&G.addFallback(Q++,"USESPHERICALINVERTEX"),Z.FOG&&G.addFallback(Q,"FOG"),Z.SPECULARAA&&G.addFallback(Q,"SPECULARAA"),Z.POINTSIZE&&G.addFallback(Q,"POINTSIZE"),Z.LOGARITHMICDEPTH&&G.addFallback(Q,"LOGARITHMICDEPTH"),Z.PARALLAX&&G.addFallback(Q,"PARALLAX"),Z.PARALLAX_RHS&&G.addFallback(Q,"PARALLAX_RHS"),Z.PARALLAXOCCLUSION&&G.addFallback(Q++,"PARALLAXOCCLUSION"),Z.ENVIRONMENTBRDF&&G.addFallback(Q++,"ENVIRONMENTBRDF"),Z.TANGENT&&G.addFallback(Q++,"TANGENT"),Z.BUMP&&G.addFallback(Q++,"BUMP"),Q=(0,i.m)(Z,G,this._maxSimultaneousLights,Q++),Z.SPECULARTERM&&G.addFallback(Q++,"SPECULARTERM"),Z.USESPHERICALFROMREFLECTIONMAP&&G.addFallback(Q++,"USESPHERICALFROMREFLECTIONMAP"),Z.USEIRRADIANCEMAP&&G.addFallback(Q++,"USEIRRADIANCEMAP"),Z.LIGHTMAP&&G.addFallback(Q++,"LIGHTMAP"),Z.NORMAL&&G.addFallback(Q++,"NORMAL"),Z.AMBIENT&&G.addFallback(Q++,"AMBIENT"),Z.EMISSIVE&&G.addFallback(Q++,"EMISSIVE"),Z.VERTEXCOLOR&&G.addFallback(Q++,"VERTEXCOLOR"),Z.MORPHTARGETS&&G.addFallback(Q++,"MORPHTARGETS"),Z.MULTIVIEW&&G.addFallback(0,"MULTIVIEW");const D=[B.e.PositionKind];Z.NORMAL&&D.push(B.e.NormalKind),Z.TANGENT&&D.push(B.e.TangentKind);for(let o=1;o<=6;++o)Z["UV"+o]&&D.push(`uv${1===o?"":o}`);Z.VERTEXCOLOR&&D.push(B.e.ColorKind),(0,i.q)(D,s,Z,G),(0,i.s)(D,Z),(0,i.v)(D,s,Z),(0,i.n)(D,s,Z);let z="pbr";const Y=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","baseWeight","baseDiffuseRoughness","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vBaseWeightInfos","vBaseDiffuseRoughnessInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","baseWeightMatrix","baseDiffuseRoughnessMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vReflectionDominantDirection","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],f=["albedoSampler","baseWeightSampler","baseDiffuseRoughnessSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","icdfSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],d=["Material","Scene","Mesh"],U={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:Z.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=G,this._eventInfo.fallbackRank=Q,this._eventInfo.defines=Z,this._eventInfo.uniforms=Y,this._eventInfo.attributes=D,this._eventInfo.samplers=f,this._eventInfo.uniformBuffersNames=d,this._eventInfo.customCode=void 0,this._eventInfo.mesh=s,this._eventInfo.indexParameters=U,this._callbackPluginEventGeneric(128,this._eventInfo),h.c.AddUniformsAndSamplers(Y,f),b.e.AddUniforms(Y),b.e.AddSamplers(f),(0,q.b)(Y),A.c&&(A.c.PrepareUniforms(Y,Z),A.c.PrepareSamplers(f,Z)),(0,i.U)({uniformsNames:Y,uniformBuffersNames:d,samplers:f,defines:Z,maxSimultaneousLights:this._maxSimultaneousLights});const u={};this.customShaderNameResolve&&(z=this.customShaderNameResolve(z,Y,d,f,Z,D,u));const H=Z.toString(),N=v.createEffect(z,{attributes:D,uniformsNames:Y,uniformBuffersNames:d,samplers:f,defines:H,fallbacks:G,onCompiled:t,onError:j,indexParameters:U,processFinalCode:u.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:Z.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([o.e(20),o.e(45)]).then(o.bind(o,13606)),Promise.all([o.e(18),o.e(46)]).then(o.bind(o,13793))]):await Promise.all([Promise.all([o.e(13),o.e(48)]).then(o.bind(o,13883)),Promise.all([o.e(12),o.e(49)]).then(o.bind(o,14032))]),this._shadersLoaded=!0}},v);return this._eventInfo.customCode=void 0,N}_prepareDefines(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,j=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const S=this.Ls(),a=S.getEngine();(0,i.C)(S,s,Z,!0,this._maxSimultaneousLights,this._disableLighting),Z._needNormals=!0,(0,i.L)(S,Z);const O=this.needAlphaBlendingForMesh(s)&&this.Ls().useOrderIndependentTransparency;if((0,i.Q)(S,Z,this.canRenderToMRT&&!O),(0,i.N)(S,Z,O),h.c.PrepareDefines(a.currentRenderPassId,s,Z),Z.METALLICWORKFLOW=this.isMetallicWorkflow(),Z._areTexturesDirty){Z._needUVs=!1;for(let s=1;s<=6;++s)Z["MAINUV"+s]=!1;if(S.texturesEnabled){Z.ALBEDODIRECTUV=0,Z.BASE_WEIGHTDIRECTUV=0,Z.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,Z.AMBIENTDIRECTUV=0,Z.OPACITYDIRECTUV=0,Z.EMISSIVEDIRECTUV=0,Z.REFLECTIVITYDIRECTUV=0,Z.MICROSURFACEMAPDIRECTUV=0,Z.METALLIC_REFLECTANCEDIRECTUV=0,Z.REFLECTANCEDIRECTUV=0,Z.BUMPDIRECTUV=0,Z.LIGHTMAPDIRECTUV=0,a.getCaps().textureLOD&&(Z.LODBASEDMICROSFURACE=!0),this._albedoTexture&&H.c.DiffuseTextureEnabled?((0,i.G)(this._albedoTexture,Z,"ALBEDO"),Z.GAMMAALBEDO=this._albedoTexture.gammaSpace):Z.ALBEDO=!1,this._baseWeightTexture&&H.c.BaseWeightTextureEnabled?(0,i.G)(this._baseWeightTexture,Z,"BASE_WEIGHT"):Z.BASE_WEIGHT=!1,this._baseDiffuseRoughnessTexture&&H.c.BaseDiffuseRoughnessTextureEnabled?(0,i.G)(this._baseDiffuseRoughnessTexture,Z,"BASE_DIFFUSE_ROUGHNESS"):Z.BASE_DIFFUSE_ROUGHNESS=!1,this._ambientTexture&&H.c.AmbientTextureEnabled?((0,i.G)(this._ambientTexture,Z,"AMBIENT"),Z.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):Z.AMBIENT=!1,this._opacityTexture&&H.c.OpacityTextureEnabled?((0,i.G)(this._opacityTexture,Z,"OPACITY"),Z.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):Z.OPACITY=!1;const s=this._getReflectionTexture();if(s&&H.c.ReflectionTextureEnabled){switch(Z.REFLECTION=!0,Z.GAMMAREFLECTION=s.gammaSpace,Z.RGBDREFLECTION=s.isRGBD,Z.LODINREFLECTIONALPHA=s.lodLevelInAlpha,Z.LINEARSPECULARREFLECTION=s.linearSpecularLOD,Z.USEIRRADIANCEMAP=!1,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(Z.NUM_SAMPLES=""+this.realTimeFilteringQuality,a._features.needTypeSuffixInShaderConstants&&(Z.NUM_SAMPLES=Z.NUM_SAMPLES+"u"),Z.REALTIME_FILTERING=!0,this.Ls().iblCdfGenerator&&(Z.IBL_CDF_FILTERING=!0)):Z.REALTIME_FILTERING=!1,Z.INVERTCUBICMAP=s.coordinatesMode===u.c.INVCUBIC_MODE,Z.REFLECTIONMAP_3D=s.isCube,Z.REFLECTIONMAP_OPPOSITEZ=Z.REFLECTIONMAP_3D&&this.Ls().useRightHandedSystem?!s.invertZ:s.invertZ,Z.REFLECTIONMAP_CUBIC=!1,Z.REFLECTIONMAP_EXPLICIT=!1,Z.REFLECTIONMAP_PLANAR=!1,Z.REFLECTIONMAP_PROJECTION=!1,Z.REFLECTIONMAP_SKYBOX=!1,Z.REFLECTIONMAP_SPHERICAL=!1,Z.REFLECTIONMAP_EQUIRECTANGULAR=!1,Z.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,Z.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,s.coordinatesMode){case u.c.EXPLICIT_MODE:Z.REFLECTIONMAP_EXPLICIT=!0;break;case u.c.PLANAR_MODE:Z.REFLECTIONMAP_PLANAR=!0;break;case u.c.PROJECTION_MODE:Z.REFLECTIONMAP_PROJECTION=!0;break;case u.c.SKYBOX_MODE:Z.REFLECTIONMAP_SKYBOX=!0;break;case u.c.SPHERICAL_MODE:Z.REFLECTIONMAP_SPHERICAL=!0;break;case u.c.EQUIRECTANGULAR_MODE:Z.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case u.c.FIXED_EQUIRECTANGULAR_MODE:Z.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case u.c.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:Z.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case u.c.CUBIC_MODE:case u.c.INVCUBIC_MODE:default:Z.REFLECTIONMAP_CUBIC=!0,Z.USE_LOCAL_REFLECTIONMAP_CUBIC=!!s.boundingBoxSize}s.coordinatesMode!==u.c.SKYBOX_MODE&&(s.irradianceTexture?(Z.USEIRRADIANCEMAP=!0,Z.USESPHERICALFROMREFLECTIONMAP=!1,Z.USESPHERICALINVERTEX=!1,s.irradianceTexture._dominantDirection&&(Z.USE_IRRADIANCE_DOMINANT_DIRECTION=!0)):s.isCube&&(Z.USESPHERICALFROMREFLECTIONMAP=!0,Z.USEIRRADIANCEMAP=!1,Z.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||a.getCaps().maxVaryingVectors<=8||this._baseDiffuseRoughnessTexture?Z.USESPHERICALINVERTEX=!1:Z.USESPHERICALINVERTEX=!0))}else Z.REFLECTION=!1,Z.REFLECTIONMAP_3D=!1,Z.REFLECTIONMAP_SPHERICAL=!1,Z.REFLECTIONMAP_PLANAR=!1,Z.REFLECTIONMAP_CUBIC=!1,Z.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,Z.REFLECTIONMAP_PROJECTION=!1,Z.REFLECTIONMAP_SKYBOX=!1,Z.REFLECTIONMAP_EXPLICIT=!1,Z.REFLECTIONMAP_EQUIRECTANGULAR=!1,Z.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,Z.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,Z.INVERTCUBICMAP=!1,Z.USESPHERICALFROMREFLECTIONMAP=!1,Z.USEIRRADIANCEMAP=!1,Z.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,Z.USESPHERICALINVERTEX=!1,Z.REFLECTIONMAP_OPPOSITEZ=!1,Z.LODINREFLECTIONALPHA=!1,Z.GAMMAREFLECTION=!1,Z.RGBDREFLECTION=!1,Z.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&H.c.LightmapTextureEnabled?((0,i.G)(this._lightmapTexture,Z,"LIGHTMAP"),Z.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,Z.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,Z.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):Z.LIGHTMAP=!1,this._emissiveTexture&&H.c.EmissiveTextureEnabled?((0,i.G)(this._emissiveTexture,Z,"EMISSIVE"),Z.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):Z.EMISSIVE=!1,H.c.SpecularTextureEnabled?(this._metallicTexture?((0,i.G)(this._metallicTexture,Z,"REFLECTIVITY"),Z.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,Z.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,Z.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,Z.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,Z.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,i.G)(this._reflectivityTexture,Z,"REFLECTIVITY"),Z.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,Z.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,Z.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):Z.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(Z.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,i.G)(this._metallicReflectanceTexture,Z,"METALLIC_REFLECTANCE"),Z.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):Z.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,i.G)(this._reflectanceTexture,Z,"REFLECTANCE"),Z.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):Z.REFLECTANCE=!1):(Z.METALLIC_REFLECTANCE=!1,Z.REFLECTANCE=!1),this._microSurfaceTexture?(0,i.G)(this._microSurfaceTexture,Z,"MICROSURFACEMAP"):Z.MICROSURFACEMAP=!1):(Z.REFLECTIVITY=!1,Z.MICROSURFACEMAP=!1),a.getCaps().standardDerivatives&&this._bumpTexture&&H.c.BumpTextureEnabled&&!this._disableBumpMap?((0,i.G)(this._bumpTexture,Z,"BUMP"),this._useParallax&&this._albedoTexture&&H.c.DiffuseTextureEnabled?(Z.PARALLAX=!0,Z.PARALLAX_RHS=S.useRightHandedSystem,Z.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):Z.PARALLAX=!1,Z.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(Z.BUMP=!1,Z.PARALLAX=!1,Z.PARALLAX_RHS=!1,Z.PARALLAXOCCLUSION=!1,Z.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&H.c.ReflectionTextureEnabled?(Z.ENVIRONMENTBRDF=!0,Z.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(Z.ENVIRONMENTBRDF=!1,Z.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?Z.ALPHAFROMALBEDO=!0:Z.ALPHAFROMALBEDO=!1}Z.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===k.LIGHTFALLOFF_STANDARD?(Z.USEPHYSICALLIGHTFALLOFF=!1,Z.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===k.LIGHTFALLOFF_GLTF?(Z.USEPHYSICALLIGHTFALLOFF=!1,Z.USEGLTFLIGHTFALLOFF=!0):(Z.USEPHYSICALLIGHTFALLOFF=!0,Z.USEGLTFLIGHTFALLOFF=!1),Z.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.Ta&&this._twoSidedLighting?Z.TWOSIDEDLIGHTING=!0:Z.TWOSIDEDLIGHTING=!1,Z.MIRRORED=!!S._mirroredCameraPosition,Z.SPECULARAA=a.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(Z._areTexturesDirty||Z._areMiscDirty)&&(Z.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,Z.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,Z.ALPHABLEND=this.needAlphaBlendingForMesh(s),Z.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,Z.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),Z._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(Z),Z.FORCENORMALFORWARD=this._forceNormalForward,Z.RADIANCEOCCLUSION=this._useRadianceOcclusion,Z.HORIZONOCCLUSION=this._useHorizonOcclusion,Z._areMiscDirty&&((0,i.I)(s,S,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(s),Z,this._applyDecalMapAfterDetailMap),Z.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!s.isVerticesDataPresent(B.e.NormalKind),Z.DEBUGMODE=this._debugMode),(0,i.B)(S,a,this,Z,!!o,t,j),this._eventInfo.defines=Z,this._eventInfo.mesh=s,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,i.z)(s,Z,!0,!0,!0,this._transparencyMode!==k.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(s,Z,o){const t={clipPlane:!1,useInstances:!1,...o};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const o=new x(this._eventInfo.defineNames),j=this._prepareEffect(s,o,void 0,void 0,t.useInstances,t.clipPlane,s.hasThinInstances);this._onEffectCreatedObservable&&(M.effect=j,M.subMesh=null,this._onEffectCreatedObservable.notifyObservers(M)),j.isReady()?Z&&Z(this):j.onCompileObservable.add((()=>{Z&&Z(this)}))})()}buildUniformLayout(){const s=this._uniformBuffer;s.addUniform("vAlbedoInfos",2),s.addUniform("vBaseWeightInfos",2),s.addUniform("vBaseDiffuseRoughnessInfos",2),s.addUniform("vAmbientInfos",4),s.addUniform("vOpacityInfos",2),s.addUniform("vEmissiveInfos",2),s.addUniform("vLightmapInfos",2),s.addUniform("vReflectivityInfos",3),s.addUniform("vMicroSurfaceSamplerInfos",2),s.addUniform("vReflectionInfos",2),s.addUniform("vReflectionFilteringInfo",2),s.addUniform("vReflectionPosition",3),s.addUniform("vReflectionSize",3),s.addUniform("vBumpInfos",3),s.addUniform("albedoMatrix",16),s.addUniform("baseWeightMatrix",16),s.addUniform("baseDiffuseRoughnessMatrix",16),s.addUniform("ambientMatrix",16),s.addUniform("opacityMatrix",16),s.addUniform("emissiveMatrix",16),s.addUniform("lightmapMatrix",16),s.addUniform("reflectivityMatrix",16),s.addUniform("microSurfaceSamplerMatrix",16),s.addUniform("bumpMatrix",16),s.addUniform("vTangentSpaceParams",2),s.addUniform("reflectionMatrix",16),s.addUniform("vReflectionColor",3),s.addUniform("vAlbedoColor",4),s.addUniform("baseWeight",1),s.addUniform("baseDiffuseRoughness",1),s.addUniform("vLightingIntensity",4),s.addUniform("vReflectionMicrosurfaceInfos",3),s.addUniform("vReflectionDominantDirection",3),s.addUniform("pointSize",1),s.addUniform("vReflectivityColor",4),s.addUniform("vEmissiveColor",3),s.addUniform("vAmbientColor",3),s.addUniform("vDebugMode",2),s.addUniform("vMetallicReflectanceFactors",4),s.addUniform("vMetallicReflectanceInfos",2),s.addUniform("metallicReflectanceMatrix",16),s.addUniform("vReflectanceInfos",2),s.addUniform("reflectanceMatrix",16),s.addUniform("vSphericalL00",3),s.addUniform("vSphericalL1_1",3),s.addUniform("vSphericalL10",3),s.addUniform("vSphericalL11",3),s.addUniform("vSphericalL2_2",3),s.addUniform("vSphericalL2_1",3),s.addUniform("vSphericalL20",3),s.addUniform("vSphericalL21",3),s.addUniform("vSphericalL22",3),s.addUniform("vSphericalX",3),s.addUniform("vSphericalY",3),s.addUniform("vSphericalZ",3),s.addUniform("vSphericalXX_ZZ",3),s.addUniform("vSphericalYY_ZZ",3),s.addUniform("vSphericalZZ",3),s.addUniform("vSphericalXY",3),s.addUniform("vSphericalYZ",3),s.addUniform("vSphericalZX",3),s.addUniform("cameraInfo",4),super.buildUniformLayout()}bindForSubMesh(s,Z,o){const t=this.Ls(),j=o.materialDefines;if(!j)return;const S=o.effect;if(!S)return;this._activeEffect=S,Z.getMeshUniformBuffer().bindToEffect(S,"Mesh"),Z.transferToEffect(s);const a=t.getEngine();this._uniformBuffer.bindToEffect(S,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,t,Z,s,this.isFrozen),h.c.Bind(a.currentRenderPassId,this._activeEffect,Z,s,this);const O=t.activeCamera;O?this._uniformBuffer.updateFloat4("cameraInfo",O.OO,O.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=o,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),j.OBJECTSPACE_NORMALMAP&&(s.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const G=this._mustRebind(t,S,o,Z.visibility);(0,i.b)(Z,this._activeEffect,this.prePassConfiguration);let B=null;const Q=this._uniformBuffer;if(G){if(this.bindViewProjection(S),B=this._getReflectionTexture(),!Q.useUbo||!this.isFrozen||!Q.isSync||o._drawWrapper._forceRebindOnNextCall){var D;if(t.texturesEnabled){if(this._albedoTexture&&H.c.DiffuseTextureEnabled&&(Q.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,i.l)(this._albedoTexture,Q,"albedo")),this._baseWeightTexture&&H.c.BaseWeightTextureEnabled&&(Q.updateFloat2("vBaseWeightInfos",this._baseWeightTexture.coordinatesIndex,this._baseWeightTexture.level),(0,i.l)(this._baseWeightTexture,Q,"baseWeight")),this._baseDiffuseRoughnessTexture&&H.c.BaseDiffuseRoughnessTextureEnabled&&(Q.updateFloat2("vBaseDiffuseRoughnessInfos",this._baseDiffuseRoughnessTexture.coordinatesIndex,this._baseDiffuseRoughnessTexture.level),(0,i.l)(this._baseDiffuseRoughnessTexture,Q,"baseDiffuseRoughness")),this._ambientTexture&&H.c.AmbientTextureEnabled&&(Q.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,i.l)(this._ambientTexture,Q,"ambient")),this._opacityTexture&&H.c.OpacityTextureEnabled&&(Q.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,i.l)(this._opacityTexture,Q,"opacity")),B&&H.c.ReflectionTextureEnabled){if(Q.SO("reflectionMatrix",B.getReflectionTextureMatrix()),Q.updateFloat2("vReflectionInfos",B.level*t.iblIntensity,0),B.boundingBoxSize){const s=B;Q.updateVector3("vReflectionPosition",s.boundingBoxPosition),Q.updateVector3("vReflectionSize",s.boundingBoxSize)}if(this.realTimeFiltering){const s=B.getSize().width;Q.updateFloat2("vReflectionFilteringInfo",s,Math.log2(s))}if(j.USEIRRADIANCEMAP)j.USEIRRADIANCEMAP&&j.USE_IRRADIANCE_DOMINANT_DIRECTION&&Q.updateVector3("vReflectionDominantDirection",B.irradianceTexture._dominantDirection);else{const s=B.sphericalPolynomial;if(j.USESPHERICALFROMREFLECTIONMAP&&s)if(j.SPHERICAL_HARMONICS){const Z=s.preScaledHarmonics;Q.updateVector3("vSphericalL00",Z.l00),Q.updateVector3("vSphericalL1_1",Z.l1_1),Q.updateVector3("vSphericalL10",Z.l10),Q.updateVector3("vSphericalL11",Z.l11),Q.updateVector3("vSphericalL2_2",Z.l2_2),Q.updateVector3("vSphericalL2_1",Z.l2_1),Q.updateVector3("vSphericalL20",Z.l20),Q.updateVector3("vSphericalL21",Z.l21),Q.updateVector3("vSphericalL22",Z.l22)}else Q.updateFloat3("vSphericalX",s.x.x,s.x.y,s.x.z),Q.updateFloat3("vSphericalY",s.y.x,s.y.y,s.y.z),Q.updateFloat3("vSphericalZ",s.z.x,s.z.y,s.z.z),Q.updateFloat3("vSphericalXX_ZZ",s.xx.x-s.zz.x,s.xx.y-s.zz.y,s.xx.z-s.zz.z),Q.updateFloat3("vSphericalYY_ZZ",s.yy.x-s.zz.x,s.yy.y-s.zz.y,s.yy.z-s.zz.z),Q.updateFloat3("vSphericalZZ",s.zz.x,s.zz.y,s.zz.z),Q.updateFloat3("vSphericalXY",s.xy.x,s.xy.y,s.xy.z),Q.updateFloat3("vSphericalYZ",s.yz.x,s.yz.y,s.yz.z),Q.updateFloat3("vSphericalZX",s.zx.x,s.zx.y,s.zx.z)}Q.updateFloat3("vReflectionMicrosurfaceInfos",B.getSize().width,B.lodGenerationScale,B.lodGenerationOffset)}this._emissiveTexture&&H.c.EmissiveTextureEnabled&&(Q.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,i.l)(this._emissiveTexture,Q,"emissive")),this._lightmapTexture&&H.c.LightmapTextureEnabled&&(Q.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,i.l)(this._lightmapTexture,Q,"lightmap")),H.c.SpecularTextureEnabled&&(this._metallicTexture?(Q.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,i.l)(this._metallicTexture,Q,"reflectivity")):this._reflectivityTexture&&(Q.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,i.l)(this._reflectivityTexture,Q,"reflectivity")),this._metallicReflectanceTexture&&(Q.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,i.l)(this._metallicReflectanceTexture,Q,"metallicReflectance")),this._reflectanceTexture&&j.REFLECTANCE&&(Q.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,i.l)(this._reflectanceTexture,Q,"reflectance")),this._microSurfaceTexture&&(Q.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,i.l)(this._microSurfaceTexture,Q,"microSurfaceSampler"))),this._bumpTexture&&a.getCaps().standardDerivatives&&H.c.BumpTextureEnabled&&!this._disableBumpMap&&(Q.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,i.l)(this._bumpTexture,Q,"bump"),t._mirroredCameraPosition?Q.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):Q.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&Q.updateFloat("pointSize",this.pointSize),j.METALLICWORKFLOW){var z;f.k.nz[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,f.k.nz[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness;const s=(null===(z=this.subSurface)||void 0===z?void 0:z._indexOfRefraction)??1.5,Z=1;f.k.nz[0].b=s;const o=Math.pow((s-Z)/(s+Z),2);f.k.nz[0].a=o,Q.updateDirectColor4("vReflectivityColor",f.k.nz[0]),Q.updateColor4("vMetallicReflectanceFactors",this._metallicReflectanceColor,this._metallicF0Factor)}else Q.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);Q.updateColor3("vEmissiveColor",H.c.EmissiveTextureEnabled?this._emissiveColor:f.d.BlackReadOnly),Q.updateColor3("vReflectionColor",this._reflectionColor),!j.SS_REFRACTION&&null!==(D=this.subSurface)&&void 0!==D&&D._linkRefractionWithTransparency?Q.updateColor4("vAlbedoColor",this._albedoColor,1):Q.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),Q.updateFloat("baseWeight",this._baseWeight),Q.updateFloat("baseDiffuseRoughness",this._baseDiffuseRoughness||0),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*t.environmentIntensity,this._lightingInfos.w=this._specularIntensity,Q.updateVector4("vLightingIntensity",this._lightingInfos),t.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),Q.updateColor3("vAmbientColor",this._globalAmbientColor),Q.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}if(t.texturesEnabled){if(this._albedoTexture&&H.c.DiffuseTextureEnabled&&Q.setTexture("albedoSampler",this._albedoTexture),this._baseWeightTexture&&H.c.BaseWeightTextureEnabled&&Q.setTexture("baseWeightSampler",this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&H.c.BaseDiffuseRoughnessTextureEnabled&&Q.setTexture("baseDiffuseRoughnessSampler",this._baseDiffuseRoughnessTexture),this._ambientTexture&&H.c.AmbientTextureEnabled&&Q.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&H.c.OpacityTextureEnabled&&Q.setTexture("opacitySampler",this._opacityTexture),B&&H.c.ReflectionTextureEnabled){j.LODBASEDMICROSFURACE?Q.setTexture("reflectionSampler",B):(Q.setTexture("reflectionSampler",B._lodTextureMid||B),Q.setTexture("reflectionSamplerLow",B._lodTextureLow||B),Q.setTexture("reflectionSamplerHigh",B._lodTextureHigh||B)),j.USEIRRADIANCEMAP&&Q.setTexture("irradianceSampler",B.irradianceTexture);const s=this.Ls().iblCdfGenerator;this.realTimeFiltering&&s&&Q.setTexture("icdfSampler",s.getIcdfTexture())}j.ENVIRONMENTBRDF&&Q.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&H.c.EmissiveTextureEnabled&&Q.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&H.c.LightmapTextureEnabled&&Q.setTexture("lightmapSampler",this._lightmapTexture),H.c.SpecularTextureEnabled&&(this._metallicTexture?Q.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&Q.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&Q.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&j.REFLECTANCE&&Q.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&Q.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&a.getCaps().standardDerivatives&&H.c.BumpTextureEnabled&&!this._disableBumpMap&&Q.setTexture("bumpSampler",this._bumpTexture)}this.Ls().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(Z)&&this.Ls().depthPeelingRenderer.bind(S),this._eventInfo.subMesh=o,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,q.f)(this._activeEffect,this,t),this.bindEyePosition(S)}else t.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(G||!this.isFrozen){var Y;if(t.lightsEnabled&&!this._disableLighting&&(0,i.g)(t,Z,this._activeEffect,j,this._maxSimultaneousLights),(t.fogEnabled&&Z.applyFog&&t.fogMode!==v.c.FOGMODE_NONE||B||this.subSurface.refractionTexture||Z.receiveShadows||j.PREPASS)&&this.bindView(S),(0,i.e)(t,Z,this._activeEffect,!0),j.NUM_MORPH_INFLUENCERS&&(0,i.j)(Z,this._activeEffect),j.BAKED_VERTEX_ANIMATION_TEXTURE)null===(Y=Z.bakedVertexAnimationManager)||void 0===Y||Y.bind(S,j.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,i.h)(j,this._activeEffect,t)}this._afterBind(Z,this._activeEffect,o),Q.update()}getAnimatables(){const s=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&s.push(this._albedoTexture),this._baseWeightTexture&&this._baseWeightTexture.animations&&this._baseWeightTexture.animations.length>0&&s.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&this._baseDiffuseRoughnessTexture.animations&&this._baseDiffuseRoughnessTexture.animations.length>0&&s.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&s.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&s.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&s.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&s.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?s.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&s.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&s.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&s.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&s.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&s.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&s.push(this._microSurfaceTexture),s}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.Ls().environmentTexture}getActiveTextures(){const s=super.getActiveTextures();return this._albedoTexture&&s.push(this._albedoTexture),this._baseWeightTexture&&s.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&s.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&s.push(this._ambientTexture),this._opacityTexture&&s.push(this._opacityTexture),this._reflectionTexture&&s.push(this._reflectionTexture),this._emissiveTexture&&s.push(this._emissiveTexture),this._reflectivityTexture&&s.push(this._reflectivityTexture),this._metallicTexture&&s.push(this._metallicTexture),this._metallicReflectanceTexture&&s.push(this._metallicReflectanceTexture),this._reflectanceTexture&&s.push(this._reflectanceTexture),this._microSurfaceTexture&&s.push(this._microSurfaceTexture),this._bumpTexture&&s.push(this._bumpTexture),this._lightmapTexture&&s.push(this._lightmapTexture),s}hasTexture(s){return!!super.hasTexture(s)||(this._albedoTexture===s||(this._baseWeightTexture===s||(this._baseDiffuseRoughnessTexture===s||(this._ambientTexture===s||(this._opacityTexture===s||(this._reflectionTexture===s||(this._emissiveTexture===s||(this._reflectivityTexture===s||(this._metallicTexture===s||(this._metallicReflectanceTexture===s||(this._reflectanceTexture===s||(this._microSurfaceTexture===s||(this._bumpTexture===s||this._lightmapTexture===s)))))))))))))}setPrePassRenderer(){var s;if(null===(s=this.subSurface)||void 0===s||!s.isScatteringEnabled)return!1;const Z=this.Ls().enableSubSurfaceForPrePass();return Z&&(Z.enabled=!0),!0}dispose(s,Z){var o,t,j,S,a,O,v,G,B,Q,D,z,Y,b;(this._breakShaderLoadedCheck=!0,Z)&&(this._environmentBRDFTexture&&this.Ls().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(o=this._albedoTexture)||void 0===o||o.dispose(),null===(t=this._baseWeightTexture)||void 0===t||t.dispose(),null===(j=this._baseDiffuseRoughnessTexture)||void 0===j||j.dispose(),null===(S=this._ambientTexture)||void 0===S||S.dispose(),null===(a=this._opacityTexture)||void 0===a||a.dispose(),null===(O=this._reflectionTexture)||void 0===O||O.dispose(),null===(v=this._emissiveTexture)||void 0===v||v.dispose(),null===(G=this._metallicTexture)||void 0===G||G.dispose(),null===(B=this._reflectivityTexture)||void 0===B||B.dispose(),null===(Q=this._bumpTexture)||void 0===Q||Q.dispose(),null===(D=this._lightmapTexture)||void 0===D||D.dispose(),null===(z=this._metallicReflectanceTexture)||void 0===z||z.dispose(),null===(Y=this._reflectanceTexture)||void 0===Y||Y.dispose(),null===(b=this._microSurfaceTexture)||void 0===b||b.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(s,Z)}}k.PBRMATERIAL_OPAQUE=d.c.MATERIAL_OPAQUE,k.PBRMATERIAL_ALPHATEST=d.c.MATERIAL_ALPHATEST,k.PBRMATERIAL_ALPHABLEND=d.c.MATERIAL_ALPHABLEND,k.PBRMATERIAL_ALPHATESTANDBLEND=d.c.MATERIAL_ALPHATESTANDBLEND,k.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,k.LIGHTFALLOFF_PHYSICAL=0,k.LIGHTFALLOFF_GLTF=1,k.LIGHTFALLOFF_STANDARD=2,k.ForceGLSL=!1,(0,t.c)([(0,j.r)()],k.prototype,"_imageProcessingConfiguration",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsMiscDirty")],k.prototype,"debugMode",void 0)},11475:(s,Z,o)=>{o.d(Z,{d:()=>Q});var t=o(11086),j=o(11091),S=o(11480),a=o(11174),O=o(11486),v=o(10916),G=o(11081),B=o(11167);class Q extends O.d{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(s){this.subSurface.refractionTexture=s,s?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(s){this.subSurface.indexOfRefraction=s}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(s){this.subSurface.invertRefractionY=s}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(s){this.subSurface.linkRefractionWithTransparency=s,s&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===O.d.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(s){s!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=s?O.d.LIGHTFALLOFF_PHYSICAL:O.d.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===O.d.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(s){s!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=s?O.d.LIGHTFALLOFF_GLTF:O.d.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(s){this._attachImageProcessingConfiguration(s),this._markAllSubMeshesAsImageProcessingDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(s){this.imageProcessingConfiguration.colorCurvesEnabled=s}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(s){this.imageProcessingConfiguration.colorGradingEnabled=s}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(s){this._imageProcessingConfiguration.toneMappingEnabled=s}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(s){this._imageProcessingConfiguration.exposure=s}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(s){this._imageProcessingConfiguration.contrast=s}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(s){this._imageProcessingConfiguration.colorGradingTexture=s}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(s){this._imageProcessingConfiguration.colorCurves=s}constructor(s,Z){super(s,Z,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=Q.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=a.d.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new a.d(0,0,0),this.albedoColor=new a.d(1,1,1),this.baseWeight=1,this.reflectivityColor=new a.d(1,1,1),this.reflectionColor=new a.d(1,1,1),this.emissiveColor=new a.d(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,S.b)(this.Ls())}getClassName(){return"PBRMaterial"}clone(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const t=B.c.Clone((()=>new Q(s,this.Ls())),this,{cloneTexturesOnlyOnce:Z});return t.id=s,t.name=s,this.stencil.copyTo(t.stencil),this._clonePlugins(t,o),t}serialize(){const s=super.serialize();return s.customType="BABYLON.PBRMaterial",s}static Parse(s,Z,o){const t=B.c.Parse((()=>new Q(s.name,Z)),s,Z,o);return s.stencil&&t.stencil.parse(s.stencil,Z,o),G.c._ParsePlugins(s,t,Z,o),s.clearCoat&&t.clearCoat.parse(s.clearCoat,Z,o),s.anisotropy&&t.anisotropy.parse(s.anisotropy,Z,o),s.brdf&&t.brdf.parse(s.brdf,Z,o),s.sheen&&t.sheen.parse(s.sheen,Z,o),s.subSurface&&t.subSurface.parse(s.subSurface,Z,o),s.iridescence&&t.iridescence.parse(s.iridescence,Z,o),t}}Q.PBRMATERIAL_OPAQUE=O.d.PBRMATERIAL_OPAQUE,Q.PBRMATERIAL_ALPHATEST=O.d.PBRMATERIAL_ALPHATEST,Q.PBRMATERIAL_ALPHABLEND=O.d.PBRMATERIAL_ALPHABLEND,Q.PBRMATERIAL_ALPHATESTANDBLEND=O.d.PBRMATERIAL_ALPHATESTANDBLEND,Q.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=O.d.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"directIntensity",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"emissiveIntensity",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"environmentIntensity",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"specularIntensity",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"disableBumpMap",void 0),(0,t.c)([(0,j.D)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"albedoTexture",void 0),(0,t.c)([(0,j.D)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"baseWeightTexture",void 0),(0,t.c)([(0,j.D)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"baseDiffuseRoughnessTexture",void 0),(0,t.c)([(0,j.D)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"ambientTexture",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"ambientTextureStrength",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,t.c)([(0,j.D)(),(0,j.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],Q.prototype,"opacityTexture",void 0),(0,t.c)([(0,j.D)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"reflectionTexture",void 0),(0,t.c)([(0,j.D)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"emissiveTexture",void 0),(0,t.c)([(0,j.D)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"reflectivityTexture",void 0),(0,t.c)([(0,j.D)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"metallicTexture",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"metallic",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"roughness",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"metallicF0Factor",void 0),(0,t.c)([(0,j.i)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"metallicReflectanceColor",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,t.c)([(0,j.D)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"metallicReflectanceTexture",void 0),(0,t.c)([(0,j.D)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"reflectanceTexture",void 0),(0,t.c)([(0,j.D)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"microSurfaceTexture",void 0),(0,t.c)([(0,j.D)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"bumpTexture",void 0),(0,t.c)([(0,j.D)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty",null)],Q.prototype,"lightmapTexture",void 0),(0,t.c)([(0,j.i)("ambient"),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"ambientColor",void 0),(0,t.c)([(0,j.i)("albedo"),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"albedoColor",void 0),(0,t.c)([(0,j.K)("baseWeight"),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"baseWeight",void 0),(0,t.c)([(0,j.K)("baseDiffuseRoughness"),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"baseDiffuseRoughness",void 0),(0,t.c)([(0,j.i)("reflectivity"),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"reflectivityColor",void 0),(0,t.c)([(0,j.i)("reflection"),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"reflectionColor",void 0),(0,t.c)([(0,j.i)("emissive"),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"emissiveColor",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"microSurface",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"useLightmapAsShadowmap",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],Q.prototype,"useAlphaFromAlbedoTexture",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],Q.prototype,"forceAlphaTest",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],Q.prototype,"alphaCutOff",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"useSpecularOverAlpha",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"useAmbientInGrayScale",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,t.c)([(0,j.K)()],Q.prototype,"usePhysicalLightFalloff",null),(0,t.c)([(0,j.K)()],Q.prototype,"useGLTFLightFalloff",null),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"useRadianceOverAlpha",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"useObjectSpaceNormalMap",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"useParallax",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"useParallaxOcclusion",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"parallaxScaleBias",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsLightsDirty")],Q.prototype,"disableLighting",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"forceIrradianceInFragment",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsLightsDirty")],Q.prototype,"maxSimultaneousLights",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"invertNormalMapX",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"invertNormalMapY",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"twoSidedLighting",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"useAlphaFresnel",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"useLinearAlphaFresnel",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"environmentBRDFTexture",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"forceNormalForward",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"enableSpecularAntiAliasing",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"useHorizonOcclusion",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"useRadianceOcclusion",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsMiscDirty")],Q.prototype,"unlit",void 0),(0,t.c)([(0,j.K)(),(0,j.c)("_markAllSubMeshesAsMiscDirty")],Q.prototype,"applyDecalMapAfterDetailMap",void 0),(0,v.f)("BABYLON.PBRMaterial",Q)},11059:(s,Z,o)=>{o.d(Z,{c:()=>a});var t=o(10955);const j=new Map;function S(s,Z){(function(s){return j.delete(s)})(s)&&t.b.Warn(`Extension with the name '${s}' already exists`),j.set(s,Z)}function a(s,Z){"image/ktx"!==Z&&"image/ktx2"!==Z||(s=".ktx"),j.has(s)||(s.endsWith(".ies")&&S(".ies",(async()=>await o.e(28).then(o.bind(o,13483)).then((s=>new s._IESTextureLoader)))),s.endsWith(".dds")&&S(".dds",(async()=>await o.e(25).then(o.bind(o,13489)).then((s=>new s._DDSTextureLoader)))),s.endsWith(".basis")&&S(".basis",(async()=>await o.e(29).then(o.bind(o,13501)).then((s=>new s._BasisTextureLoader)))),s.endsWith(".env")&&S(".env",(async()=>await Promise.all([o.e(24),o.e(30)]).then(o.bind(o,13505)).then((s=>new s._ENVTextureLoader)))),s.endsWith(".hdr")&&S(".hdr",(async()=>await o.e(31).then(o.bind(o,13509)).then((s=>new s._HDRTextureLoader)))),(s.endsWith(".ktx")||s.endsWith(".ktx2"))&&(S(".ktx",(async()=>await o.e(32).then(o.bind(o,13518)).then((s=>new s._KTXTextureLoader)))),S(".ktx2",(async()=>await o.e(32).then(o.bind(o,13518)).then((s=>new s._KTXTextureLoader))))),s.endsWith(".tga")&&S(".tga",(async()=>await o.e(33).then(o.bind(o,13524)).then((s=>new s._TGATextureLoader)))),s.endsWith(".exr")&&S(".exr",(async()=>await o.e(34).then(o.bind(o,13531)).then((s=>new s._ExrTextureLoader)))));const t=j.get(s);return t?Promise.resolve(t(Z)):null}},11393:(s,Z,o)=>{o.d(Z,{b:()=>D});var t=o(11086),j=o(11091),S=o(10932),a=o(10900),O=o(10927),v=o(11070),G=(o(10982),o(11389));class B{get wrapU(){return this._wrapU}set wrapU(s){this._wrapU=s}get wrapV(){return this._wrapV}set wrapV(s){this._wrapV=s}get coordinatesMode(){return 0}get isCube(){return!!this._texture&&this._texture.isCube}set isCube(s){this._texture&&(this._texture.isCube=s)}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(s){this._texture&&(this._texture.is3D=s)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(s){this._texture&&(this._texture.is2DArray=s)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(s){return void 0!==(null===s||void 0===s?void 0:s.shareDepth)}constructor(s){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=G.b.Zero(),this._cachedBaseSize=G.b.Zero(),this._initialSamplingMode=2,this._texture=B._IsRenderTargetWrapper(s)?s.texture:s,this._texture&&(this._engine=this._texture.getEngine(),this.wrapU=this._texture._cachedWrapU??this.wrapU,this.wrapV=this._texture._cachedWrapV??this.wrapV,this.wrapR=this._texture._cachedWrapR??this.wrapR)}isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(s){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(s,this._texture,this._texture.generateMipMaps)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}var Q=o(11167);class D extends B{set na(s){this._hasAlpha!==s&&(this._hasAlpha=s,this._scene&&this._scene.markAllMaterialsAsDirty(1,(s=>s.hasTexture(this))))}get na(){return this._hasAlpha}set getAlphaFromRGB(s){this._getAlphaFromRGB!==s&&(this._getAlphaFromRGB=s,this._scene&&this._scene.markAllMaterialsAsDirty(1,(s=>s.hasTexture(this))))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(s){this._coordinatesIndex!==s&&(this._coordinatesIndex=s,this._scene&&this._scene.markAllMaterialsAsDirty(1,(s=>s.hasTexture(this))))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(s){this._coordinatesMode!==s&&(this._coordinatesMode=s,this._scene&&this._scene.markAllMaterialsAsDirty(1,(s=>s.hasTexture(this))))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(s){this._wrapU=s}get wrapV(){return this._wrapV}set wrapV(s){this._wrapV=s}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(s){this._texture?this._texture.isCube=s:this._isCube=s}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(s){this._texture&&(this._texture.is3D=s)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(s){this._texture&&(this._texture.is2DArray=s)}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set gammaSpace(s){var Z;if(this._texture){if(this._texture._gammaSpace===s)return;this._texture._gammaSpace=s}else{if(this._gammaSpace===s)return;this._gammaSpace=s}null===(Z=this.Ls())||void 0===Z||Z.markAllMaterialsAsDirty(1,(s=>s.hasTexture(this)))}get isRGBD(){return null!=this._texture&&this._texture._isRGBD}set isRGBD(s){var Z;s!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=s),null===(Z=this.Ls())||void 0===Z||Z.markAllMaterialsAsDirty(1,(s=>s.hasTexture(this))))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(s){this._texture&&(this._texture._lodGenerationOffset=s)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(s){this._texture&&(this._texture._lodGenerationScale=s)}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}set linearSpecularLOD(s){this._texture&&(this._texture._linearSpecularLOD=s)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(s){this._texture&&(this._texture._irradianceTexture=s)}get uid(){return this._uid||(this._uid=(0,v.c)()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(s){this._onDisposeObserver&&this.jO.remove(this._onDisposeObserver),this._onDisposeObserver=this.jO.add(s)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=D.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this._dominantDirection=null,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.jO=new S.b,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,s?D._IsScene(s)?this._scene=s:this._engine=s:this._scene=O.c.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=Z,this._uid=null}Ls(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return a.b.IdentityReadOnly}getReflectionTextureMatrix(){return a.b.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(s){}get canRescale(){return!1}_getFromCache(s,Z,o,t,j,S){const a=this._getEngine();if(!a)return null;const O=a._getUseSRGBBuffer(!!j,Z),v=a.getLoadedTexturesCache();for(let G=0;G<v.length;G++){const a=v[G];if((void 0===j||O===a._useSRGBBuffer)&&(void 0===t||t===a.invertY)&&a.url===s&&a.generateMipMaps===!Z&&(!o||o===a.samplingMode)&&(void 0===S||S===a.isCube))return a.incrementReferences(),a}return null}_rebuild(){}clone(){return null}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const s=this.Ls();s&&s.markAllMaterialsAsDirty(1)}readPixels(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],j=arguments.length>4&&void 0!==arguments[4]&&arguments[4],S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Number.MAX_VALUE,v=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Number.MAX_VALUE;if(!this._texture)return null;const G=this._getEngine();if(!G)return null;const B=this.getSize();let Q=B.width,D=B.height;0!==Z&&(Q/=Math.pow(2,Z),D/=Math.pow(2,Z),Q=Math.round(Q),D=Math.round(D)),O=Math.min(Q,O),v=Math.min(D,v);try{return this._texture.isCube?G._readTexturePixels(this._texture,O,v,s,Z,o,t,j,S,a):G._readTexturePixels(this._texture,O,v,-1,Z,o,t,j,S,a)}catch(z){return null}}_readPixelsSync(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],j=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!this._texture)return null;const S=this.getSize();let a=S.width,O=S.height;const v=this._getEngine();if(!v)return null;0!=Z&&(a/=Math.pow(2,Z),O/=Math.pow(2,Z),a=Math.round(a),O=Math.round(O));try{return this._texture.isCube?v._readTexturePixelsSync(this._texture,a,O,s,Z,o,t,j):v._readTexturePixelsSync(this._texture,a,O,-1,Z,o,t,j)}catch(G){return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const s=this._scene.textures.indexOf(this);if(s>=0&&this._scene.textures.splice(s,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const s=this._parentContainer.textures.indexOf(this);s>-1&&this._parentContainer.textures.splice(s,1),this._parentContainer=null}}this.jO.notifyObservers(this),this.jO.clear(),this.metadata=null,super.dispose()}serialize(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.name&&!s)return null;const Z=Q.c.Serialize(this);return Q.c.AppendSerializedAnimations(this,Z),Z}static WhenAllReady(s,Z){let o=s.length;if(0!==o)for(let t=0;t<s.length;t++){const j=s[t];if(j.isReady())0===--o&&Z();else{const s=j.onLoadObservable;s?s.addOnce((()=>{0===--o&&Z()})):0===--o&&Z()}}else Z()}static _IsScene(s){return"Scene"===s.getClassName()}}D.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,t.c)([(0,j.K)()],D.prototype,"uniqueId",void 0),(0,t.c)([(0,j.K)()],D.prototype,"name",void 0),(0,t.c)([(0,j.K)()],D.prototype,"displayName",void 0),(0,t.c)([(0,j.K)()],D.prototype,"metadata",void 0),(0,t.c)([(0,j.K)("na")],D.prototype,"_hasAlpha",void 0),(0,t.c)([(0,j.K)("getAlphaFromRGB")],D.prototype,"_getAlphaFromRGB",void 0),(0,t.c)([(0,j.K)()],D.prototype,"level",void 0),(0,t.c)([(0,j.K)("coordinatesIndex")],D.prototype,"_coordinatesIndex",void 0),(0,t.c)([(0,j.K)()],D.prototype,"optimizeUVAllocation",void 0),(0,t.c)([(0,j.K)("coordinatesMode")],D.prototype,"_coordinatesMode",void 0),(0,t.c)([(0,j.K)()],D.prototype,"wrapU",null),(0,t.c)([(0,j.K)()],D.prototype,"wrapV",null),(0,t.c)([(0,j.K)()],D.prototype,"wrapR",void 0),(0,t.c)([(0,j.K)()],D.prototype,"anisotropicFilteringLevel",void 0),(0,t.c)([(0,j.K)()],D.prototype,"isCube",null),(0,t.c)([(0,j.K)()],D.prototype,"is3D",null),(0,t.c)([(0,j.K)()],D.prototype,"is2DArray",null),(0,t.c)([(0,j.K)()],D.prototype,"gammaSpace",null),(0,t.c)([(0,j.K)()],D.prototype,"invertZ",void 0),(0,t.c)([(0,j.K)()],D.prototype,"lodLevelInAlpha",void 0),(0,t.c)([(0,j.K)()],D.prototype,"lodGenerationOffset",null),(0,t.c)([(0,j.K)()],D.prototype,"lodGenerationScale",null),(0,t.c)([(0,j.K)()],D.prototype,"linearSpecularLOD",null),(0,t.c)([(0,j.D)()],D.prototype,"irradianceTexture",null),(0,t.c)([(0,j.K)()],D.prototype,"isRenderTarget",void 0)},11576:(s,Z,o)=>{var t=o(11581),j=o(11393);j.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(j.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=t.b.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((s=>{this._texture._sphericalPolynomial=s,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(s){this._texture&&(this._texture._sphericalPolynomial=s)},enumerable:!0,configurable:!0})},11044:(s,Z,o)=>{o.d(Z,{b:()=>a});var t,j=o(10932),S=o(11052);!function(s){s[s.Unknown=0]="Unknown",s[s.Url=1]="Url",s[s.Temp=2]="Temp",s[s.Raw=3]="Raw",s[s.Dynamic=4]="Dynamic",s[s.RenderTarget=5]="RenderTarget",s[s.MultiRenderTarget=6]="MultiRenderTarget",s[s.Cube=7]="Cube",s[s.CubeRaw=8]="CubeRaw",s[s.CubePrefiltered=9]="CubePrefiltered",s[s.Raw3D=10]="Raw3D",s[s.Raw2DArray=11]="Raw2DArray",s[s.DepthStencil=12]="DepthStencil",s[s.CubeRawRGBD=13]="CubeRawRGBD",s[s.Depth=14]="Depth"}(t||(t={}));class a extends S.e{get useMipMaps(){return this.generateMipMaps}set useMipMaps(s){this.generateMipMaps=s}get uniqueId(){return this._uniqueId}_setUniqueId(s){this._uniqueId=s}getEngine(){return this._engine}get source(){return this._source}constructor(s,Z){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new j.b,this.onErrorObservable=new j.b,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._autoMSAAManagement=!1,this._engine=s,this._source=Z,this._uniqueId=a._Counter++,o||(this._hardwareTexture=s._createHardwareTexture())}incrementReferences(){this._references++}updateSize(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._engine.updateTextureDimensions(this,s,Z,o),this.width=s,this.height=Z,this.depth=o,this.baseWidth=s,this.baseHeight=Z,this.baseDepth=o,this._size=s*Z*o}_rebuild(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const s=this.onRebuildCallback(this),Z=Z=>{Z._swapAndDie(this,!1),this.isReady=s.isReady};return void(s.isAsync?s.proxy.then(Z):Z(s.proxy))}let s;switch(this.source){case 2:case 12:case 14:break;case 1:return void(s=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(s=>{s._swapAndDie(this,!1),this.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case 3:s=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),s._swapAndDie(this,!1),this.isReady=!0;break;case 10:s=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),s._swapAndDie(this,!1),this.isReady=!0;break;case 11:s=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),s._swapAndDie(this,!1),this.isReady=!0;break;case 4:s=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),s._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:return void(s=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(()=>{s._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null));case 8:s=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),s._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:return s=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(s=>{s&&s._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension),void(s._sphericalPolynomial=this._sphericalPolynomial)}}_swapAndDie(s){var Z;let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null===(Z=this._hardwareTexture)||void 0===Z||Z.setUsage(s._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),s._hardwareTexture=this._hardwareTexture,o&&(s._isRGBD=this._isRGBD),this._lodTextureHigh&&(s._lodTextureHigh&&s._lodTextureHigh.dispose(),s._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(s._lodTextureMid&&s._lodTextureMid.dispose(),s._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(s._lodTextureLow&&s._lodTextureLow.dispose(),s._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(s._irradianceTexture&&s._irradianceTexture.dispose(),s._irradianceTexture=this._irradianceTexture);const t=this._engine.getLoadedTexturesCache();let j=t.indexOf(this);-1!==j&&t.splice(j,1),j=t.indexOf(s),-1===j&&t.push(s)}dispose(){this._references--,0===this._references&&(this.onLoadedObservable.clear(),this.onErrorObservable.clear(),this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}}a._Counter=0},11451:(s,Z,o)=>{o.d(Z,{b:()=>j});var t=o(11410);class j extends t.c{constructor(s,Z,o,j,S){let a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],O=arguments.length>6&&void 0!==arguments[6]&&arguments[6],v=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,B=arguments.length>9?arguments[9]:void 0,Q=arguments.length>10?arguments[10]:void 0,D=arguments.length>11?arguments[11]:void 0;super(null,S,!a,O,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,B),this.format=j,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==G||(v=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==G||(v=1),this._texture=this._engine.createRawTexture(s,Z,o,j,a,O,v,null,G,B??0,Q??!1),this.wrapU=t.c.CLAMP_ADDRESSMODE,this.wrapV=t.c.CLAMP_ADDRESSMODE,this._waitingForData=!!D&&!s)}update(s){this._getEngine().updateRawTexture(this._texture,s,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer),this._waitingForData=!1}clone(){if(!this._texture)return super.clone();const s=new j(null,this.getSize().width,this.getSize().height,this.format,this.Ls(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return s._texture=this._texture,this._texture.incrementReferences(),s}isReady(){return super.isReady()&&!this._waitingForData}static CreateLuminanceTexture(s,Z,o,t){return new j(s,Z,o,1,t,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(s,Z,o,t){return new j(s,Z,o,2,t,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(s,Z,o,t){return new j(s,Z,o,0,t,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(s,Z,o,t){return new j(s,Z,o,4,t,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(s,Z,o,t){return new j(s,Z,o,5,t,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9],arguments.length>10&&void 0!==arguments[10]&&arguments[10])}static CreateRGBAStorageTexture(s,Z,o,t){return new j(s,Z,o,5,t,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(s,Z,o,S){let a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],O=arguments.length>5&&void 0!==arguments[5]&&arguments[5],v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t.c.TRILINEAR_SAMPLINGMODE;return new j(s,Z,o,6,S,a,O,v,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(s,Z,o,S){let a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],O=arguments.length>5&&void 0!==arguments[5]&&arguments[5],v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t.c.TRILINEAR_SAMPLINGMODE;return new j(s,Z,o,6,S,a,O,v,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},11416:(s,Z,o)=>{o.d(Z,{d:()=>z});var t=o(10932),j=o(10900),S=o(11410),a=o(11424),O=o(11077),v=o(11019),G=o(10955),B=o(11428),Q=o(10911);class D{get renderList(){return this._renderList}set renderList(s){this._renderList!==s&&(this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),s&&(this._unObserveRenderList=(0,Q.m)(s,this._renderListHasChanged)),this._renderList=s)}get disableImageProcessing(){return this._disableImageProcessing}set disableImageProcessing(s){s!==this._disableImageProcessing&&(this._disableImageProcessing=s,this._scene.markAllMaterialsAsDirty(64))}get name(){return this._name}set name(s){if(this._name===s)return;if(this._name=s,!this._scene)return;const Z=this._scene.getEngine();for(let o=0;o<this._renderPassIds.length;++o){const s=this._renderPassIds[o];Z._renderPassNames[s]=`${this._name}#${o}`}}get renderPassIds(){return this._renderPassIds}get currentRefreshId(){return this._currentRefreshId}setMaterialForRendering(s,Z){let o;o=Array.isArray(s)?s:[s];for(let t=0;t<o.length;++t)for(let s=0;s<this.options.numPasses;++s){let j=o[t];o[t].isAnInstance&&(j=o[t].sourceMesh),j.setMaterialForRenderPass(this._renderPassIds[s],void 0!==Z?Array.isArray(Z)?Z[s]:Z:void 0)}}constructor(s,Z,o){this._unObserveRenderList=null,this._renderListHasChanged=(s,Z)=>{const o=this._renderList?this._renderList.length:0;if(0===Z&&o>0||0===o)for(const t of this._scene.meshes)t._markSubMeshesAsLightDirty()},this.particleSystemList=null,this.getCustomRenderList=null,this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this._disableImageProcessing=!1,this.onBeforeRenderObservable=new t.b,this.onAfterRenderObservable=new t.b,this.onBeforeRenderingManagerRenderObservable=new t.b,this.onAfterRenderingManagerRenderObservable=new t.b,this.onFastPathRenderObservable=new t.b,this._currentRefreshId=-1,this._refreshRate=1,this._currentApplyByPostProcessSetting=!1,this._currentSceneCamera=null,this.name=s,this._scene=Z,this.renderList=[],this._renderPassIds=[],this.options={numPasses:1,doNotChangeAspectRatio:!0,...o},this._createRenderPassId(),this.renderPassId=this._renderPassIds[0],this._renderingManager=new B.e(Z),this._renderingManager._useSceneAutoClearSetup=!0}_releaseRenderPassId(){const s=this._scene.getEngine();for(let Z=0;Z<this.options.numPasses;++Z)s.releaseRenderPassId(this._renderPassIds[Z]);this._renderPassIds.length=0}_createRenderPassId(){this._releaseRenderPassId();const s=this._scene.getEngine();for(let Z=0;Z<this.options.numPasses;++Z)this._renderPassIds[Z]=s.createRenderPassId(`${this.name}#${Z}`)}resetRefreshCounter(){this._currentRefreshId=-1}get refreshRate(){return this._refreshRate}set refreshRate(s){this._refreshRate=s,this.resetRefreshCounter()}shouldRender(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}isReadyForRendering(s,Z){this.prepareRenderList(),this.initRender(s,Z);const o=this._checkReadiness();return this.finishRender(),o}prepareRenderList(){const s=this._scene;if(this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(let Z=0;Z<this._waitingRenderList.length;Z++){const o=this._waitingRenderList[Z],t=s.getMeshById(o);t&&this.renderList.push(t)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];const s=this._scene.meshes;for(let Z=0;Z<s.length;Z++){const o=s[Z];this.renderListPredicate(o)&&this.renderList.push(o)}}this._currentApplyByPostProcessSetting=this._scene.imageProcessingConfiguration.applyByPostProcess,this._disableImageProcessing&&(this._scene.imageProcessingConfiguration._applyByPostProcess=this._disableImageProcessing)}initRender(s,Z){const o=this._scene.getEngine(),t=this.activeCamera??this._scene.activeCamera;this._currentSceneCamera=this._scene.activeCamera,t&&(t!==this._scene.activeCamera&&(this._scene.setTransformMatrix(t.getViewMatrix(),t.getProjectionMatrix(!0)),this._scene.activeCamera=t),o.setViewport(t.rigParent?t.rigParent.viewport:t.viewport,s,Z)),this._defaultRenderListPrepared=!1}finishRender(){const s=this._scene;this._disableImageProcessing&&(s.imageProcessingConfiguration._applyByPostProcess=this._currentApplyByPostProcessSetting),s.activeCamera=this._currentSceneCamera,this._currentSceneCamera&&(this.activeCamera&&this.activeCamera!==s.activeCamera&&s.setTransformMatrix(this._currentSceneCamera.getViewMatrix(),this._currentSceneCamera.getProjectionMatrix(!0)),s.getEngine().setViewport(this._currentSceneCamera.viewport)),s.resetCachedMaterial()}render(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const o=this._scene,t=o.getEngine(),j=t.currentRenderPassId;t.currentRenderPassId=this._renderPassIds[s],this.onBeforeRenderObservable.notifyObservers(s);if(t.snapshotRendering&&1===t.snapshotRenderingMode)this.onFastPathRenderObservable.notifyObservers(s);else{let Z=null;const t=this.renderList?this.renderList:o.getActiveMeshes().data,j=this.renderList?this.renderList.length:o.getActiveMeshes().length;this.getCustomRenderList&&(Z=this.getCustomRenderList(s,t,j)),Z?this._prepareRenderingManager(Z,Z.length,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(t,j,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),Z=t),this.onBeforeRenderingManagerRenderObservable.notifyObservers(s),this._renderingManager.render(this.customRenderFunction,Z,this.renderParticles,this.renderSprites),this.onAfterRenderingManagerRenderObservable.notifyObservers(s)}Z||this.onAfterRenderObservable.notifyObservers(s),t.currentRenderPassId=j}_checkReadiness(){const s=this._scene,Z=s.getEngine(),o=Z.currentRenderPassId;let t=!0;s.getViewMatrix()||s.updateTransformMatrix();const j=this.options.numPasses;for(let a=0;a<j&&t;a++){let o=null;const S=this.renderList?this.renderList:s.getActiveMeshes().data,O=this.renderList?this.renderList.length:s.getActiveMeshes().length;Z.currentRenderPassId=this._renderPassIds[a],this.onBeforeRenderObservable.notifyObservers(a),this.getCustomRenderList&&(o=this.getCustomRenderList(a,S,O)),o||(o=S),this.options.doNotChangeAspectRatio||s.updateTransformMatrix(!0);for(let s=0;s<o.length&&t;++s){const Z=o[s];if(Z.isEnabled()&&!Z.isBlocked&&Z.isVisible&&Z.vO)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(Z,this.refreshRate,!0)){t=!1;continue}}else if(!Z.isReady(!0)){t=!1;continue}}this.onAfterRenderObservable.notifyObservers(a),j>1&&(s.incrementRenderId(),s.resetCachedMaterial())}const S=this.particleSystemList||s.gQ;for(const a of S)a.isReady()||(t=!1);return Z.currentRenderPassId=o,t}_prepareRenderingManager(s,Z,o){const t=this._scene,j=t.activeCamera,S=this.cameraForLOD??j;this._renderingManager.reset();const a=t.getRenderId(),O=t.getFrameId();for(let G=0;G<Z;G++){const Z=s[G];if(Z&&!Z.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(Z,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!Z.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}let s,v=null;if(S){const s=Z._internalAbstractMeshDataInfo._currentLOD.get(S);s&&s[1]===O?v=s[0]:(v=t.customLODSelector?t.customLODSelector(Z,S):Z.getLOD(S),s?(s[0]=v,s[1]=O):Z._internalAbstractMeshDataInfo._currentLOD.set(S,[v,O]))}else v=Z;if(!v)continue;if(v!==Z&&0!==v.billboardMode&&v.Ea(),v._preActivateForIntermediateRendering(a),s=!(!o||!j)&&0===(Z.layerMask&j.layerMask),Z.isEnabled()&&Z.isVisible&&Z.vO&&!s){if(v!==Z&&v._activate(a,!0),Z._activate(a,!0)&&Z.vO.length){Z.isAnInstance?Z._internalAbstractMeshDataInfo._actAsRegularMesh&&(v=Z):v._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,v._internalAbstractMeshDataInfo._isActiveIntermediate=!0,t._prepareSkeleton(v);for(let s=0;s<v.vO.length;s++){const Z=v.vO[s];this._renderingManager.dispatch(Z,v)}}Z._postActivate()}}}const v=this.particleSystemList||t.gQ;for(let G=0;G<v.length;G++){const s=v[G],Z=s.k;s.isStarted()&&Z&&(!Z.position||Z.isEnabled())&&this._renderingManager.dispatchParticles(s)}}setRenderingOrder(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(s,Z,o,t)}setRenderingAutoClearDepthStencil(s,Z){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],t=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(s,Z,o,t),this._renderingManager._useSceneAutoClearSetup=!1}clone(){const s=new D(this.name,this._scene,this.options);return this.renderList&&(s.renderList=this.renderList.slice(0)),s}dispose(){const s=this.renderList?this.renderList:this._scene.getActiveMeshes().data,Z=this.renderList?this.renderList.length:this._scene.getActiveMeshes().length;for(let o=0;o<Z;o++){const Z=s[o];Z&&void 0!==Z.getMaterialForRenderPass(this.renderPassId)&&Z.setMaterialForRenderPass(this.renderPassId,void 0)}this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderingManagerRenderObservable.clear(),this.onAfterRenderingManagerRenderObservable.clear(),this.onFastPathRenderObservable.clear(),this._releaseRenderPassId(),this.renderList=null}_rebuild(){this.refreshRate===D.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=D.REFRESHRATE_RENDER_ONCE)}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}}D.REFRESHRATE_RENDER_ONCE=0,D.REFRESHRATE_RENDER_ONEVERYFRAME=1,D.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,v.d.prototype.setDepthStencilTexture=function(s,Z){this._engine.setDepthStencilTexture(this._samplers[s],this._uniforms[s],Z,s)};class z extends S.c{get renderListPredicate(){return this._objectRenderer.renderListPredicate}set renderListPredicate(s){this._objectRenderer.renderListPredicate=s}get renderList(){return this._objectRenderer.renderList}set renderList(s){this._objectRenderer.renderList=s}get particleSystemList(){return this._objectRenderer.particleSystemList}set particleSystemList(s){this._objectRenderer.particleSystemList=s}get getCustomRenderList(){return this._objectRenderer.getCustomRenderList}set getCustomRenderList(s){this._objectRenderer.getCustomRenderList=s}get renderParticles(){return this._objectRenderer.renderParticles}set renderParticles(s){this._objectRenderer.renderParticles=s}get renderSprites(){return this._objectRenderer.renderSprites}set renderSprites(s){this._objectRenderer.renderSprites=s}get forceLayerMaskCheck(){return this._objectRenderer.forceLayerMaskCheck}set forceLayerMaskCheck(s){this._objectRenderer.forceLayerMaskCheck=s}get activeCamera(){return this._objectRenderer.activeCamera}set activeCamera(s){this._objectRenderer.activeCamera=s}get cameraForLOD(){return this._objectRenderer.cameraForLOD}set cameraForLOD(s){this._objectRenderer.cameraForLOD=s}get disableImageProcessing(){return this._objectRenderer.disableImageProcessing}set disableImageProcessing(s){this._objectRenderer.disableImageProcessing=s}get customIsReadyFunction(){return this._objectRenderer.customIsReadyFunction}set customIsReadyFunction(s){this._objectRenderer.customIsReadyFunction=s}get customRenderFunction(){return this._objectRenderer.customRenderFunction}set customRenderFunction(s){this._objectRenderer.customRenderFunction=s}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(s){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(s)}get onBeforeRenderObservable(){return this._objectRenderer.onBeforeRenderObservable}set onBeforeRender(s){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(s)}get onAfterRenderObservable(){return this._objectRenderer.onAfterRenderObservable}set onAfterRender(s){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(s)}set onClear(s){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(s)}get _waitingRenderList(){return this._objectRenderer._waitingRenderList}set _waitingRenderList(s){this._objectRenderer._waitingRenderList=s}get renderPassId(){return this._objectRenderer.renderPassId}get renderPassIds(){return this._objectRenderer.renderPassIds}get currentRefreshId(){return this._objectRenderer.currentRefreshId}setMaterialForRendering(s,Z){this._objectRenderer.setMaterialForRendering(s,Z)}get isMulti(){var s;return(null===(s=this._renderTarget)||void 0===s?void 0:s.isMulti)??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(s){if(this._boundingBoxSize&&this._boundingBoxSize.equals(s))return;this._boundingBoxSize=s;const Z=this.Ls();Z&&Z.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){var s;return(null===(s=this._renderTarget)||void 0===s?void 0:s._depthStencilTexture)??null}constructor(s,Z,o){let a,O,v=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:S.c.TRILINEAR_SAMPLINGMODE,b=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],f=arguments.length>9&&void 0!==arguments[9]&&arguments[9],A=arguments.length>10&&void 0!==arguments[10]&&arguments[10],d=arguments.length>11&&void 0!==arguments[11]?arguments[11]:5,U=arguments.length>12&&void 0!==arguments[12]&&arguments[12],u=arguments.length>13?arguments[13]:void 0,H=arguments.length>14?arguments[14]:void 0,F=arguments.length>15&&void 0!==arguments[15]&&arguments[15],i=arguments.length>16&&void 0!==arguments[16]&&arguments[16],N=!0;if("object"===typeof v){const s=v;v=!!s.generateMipMaps,B=s.doNotChangeAspectRatio??!0,Q=s.type??0,z=!!s.isCube,Y=s.samplingMode??S.c.TRILINEAR_SAMPLINGMODE,b=s.generateDepthBuffer??!0,f=!!s.generateStencilBuffer,A=!!s.isMulti,d=s.format??5,U=!!s.delayAllocation,u=s.samples,H=s.creationFlags,F=!!s.noColorAttachment,i=!!s.useSRGBBuffer,a=s.colorAttachment,N=s.gammaSpace??N,O=s.existingObjectRenderer}if(super(null,o,!v,void 0,Y,void 0,void 0,void 0,void 0,d),this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new t.b,this.onAfterUnbindObservable=new t.b,this.onClearObservable=new t.b,this.onResizeObservable=new t.b,this._cleared=!1,this.skipInitialClear=!1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this._dontDisposeObjectRenderer=!1,this.boundingBoxPosition=j.n.Zero(),this._disableEngineStages=!1,this._dumpToolsLoading=!1,!(o=this.Ls()))return;const L=this.Ls().getEngine();this._gammaSpace=N,this._coordinatesMode=S.c.PROJECTION_MODE,this.name=s,this.isRenderTarget=!0,this._initialSizeParameter=Z,this._dontDisposeObjectRenderer=!!O,this._processSizeParameter(Z),this._objectRenderer=O??new D(s,o,{numPasses:z?6:this.getRenderLayers()||1,doNotChangeAspectRatio:B}),this._onBeforeRenderingManagerRenderObserver=this._objectRenderer.onBeforeRenderingManagerRenderObservable.add((()=>{if(!this._disableEngineStages)for(const s of this._scene._beforeRenderTargetClearStage)s.action(this,this._currentFaceIndex,this._currentLayer);if(this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(L):this.skipInitialClear||L.clear(this.clearColor||this._scene.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||this._scene.updateTransformMatrix(!0),!this._disableEngineStages)for(const s of this._scene._beforeRenderTargetDrawStage)s.action(this,this._currentFaceIndex,this._currentLayer)})),this._onAfterRenderingManagerRenderObserver=this._objectRenderer.onAfterRenderingManagerRenderObservable.add((()=>{var s;if(!this._disableEngineStages)for(const o of this._scene._afterRenderTargetDrawStage)o.action(this,this._currentFaceIndex,this._currentLayer);const Z=(null===(s=this._texture)||void 0===s?void 0:s.generateMipMaps)??!1;if(this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,this._currentFaceIndex,this._postProcesses,this.ignoreCameraViewport):this._currentUseCameraPostProcess&&this._scene.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,this._currentFaceIndex),!this._disableEngineStages)for(const o of this._scene._afterRenderTargetPostProcessStage)o.action(this,this._currentFaceIndex,this._currentLayer);this._texture&&(this._texture.generateMipMaps=Z),this._doNotChangeAspectRatio||this._scene.updateTransformMatrix(!0),this._currentDumpForDebug&&(this._dumpTools?this._dumpTools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),L):G.b.Error("dumpTools module is still being loaded. To speed up the process import dump tools directly in your project"))})),this._onFastPathRenderObserver=this._objectRenderer.onFastPathRenderObservable.add((()=>{this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(L):this.skipInitialClear||L.clear(this.clearColor||this._scene.clearColor,!0,!0,!0)})),this._resizeObserver=L.onResizeObservable.add((()=>{})),this._generateMipMaps=!!v,this._doNotChangeAspectRatio=B,A||(this._renderTargetOptions={generateMipMaps:v,type:Q,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:b,generateStencilBuffer:f,samples:u,creationFlags:H,noColorAttachment:F,useSRGBBuffer:i,colorAttachment:a,label:this.name},this.samplingMode===S.c.NEAREST_SAMPLINGMODE&&(this.wrapU=S.c.CLAMP_ADDRESSMODE,this.wrapV=S.c.CLAMP_ADDRESSMODE),U||(z?(this._renderTarget=o.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=S.c.INVCUBIC_MODE,this._textureMatrix=j.b.Identity()):this._renderTarget=o.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==u&&(this.samples=u)))}createDepthStencilTexture(){var s;let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,a=arguments.length>5?arguments[5]:void 0;null===(s=this._renderTarget)||void 0===s||s.createDepthStencilTexture(Z,o,t,j,S,a)}_processSizeParameter(s){if(s.ratio){this._sizeRatio=s.ratio;const Z=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(Z.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(Z.getRenderHeight(),this._sizeRatio)}}else this._size=s}get samples(){var s;return(null===(s=this._renderTarget)||void 0===s?void 0:s.samples)??this._samples}set samples(s){this._renderTarget&&(this._samples=this._renderTarget.setSamples(s))}addPostProcess(s){if(!this._postProcessManager){const s=this.Ls();if(!s)return;this._postProcessManager=new a.e(s),this._postProcesses=new Array}this._postProcesses.push(s),this._postProcesses[0].aQ=!1}clearPostProcesses(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._postProcesses){if(s)for(const s of this._postProcesses)s.dispose();this._postProcesses=[]}}removePostProcess(s){if(!this._postProcesses)return;const Z=this._postProcesses.indexOf(s);-1!==Z&&(this._postProcesses.splice(Z,1),this._postProcesses.length>0&&(this._postProcesses[0].aQ=!1))}resetRefreshCounter(){this._objectRenderer.resetRefreshCounter()}get refreshRate(){return this._objectRenderer.refreshRate}set refreshRate(s){this._objectRenderer.refreshRate=s}_shouldRender(){return this._objectRenderer.shouldRender()}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){const s=this._size.layers;if(s)return s;const Z=this._size.depth;return Z||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(s){const Z=Math.max(1,this.getRenderSize()*s);this.resize(Z)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(s){var Z;const o=this.isCube;null===(Z=this._renderTarget)||void 0===Z||Z.dispose(),this._renderTarget=null;const t=this.Ls();t&&(this._processSizeParameter(s),this._renderTarget=o?t.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):t.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._render(s,Z)}isReadyForRendering(){this._dumpToolsLoading||(this._dumpToolsLoading=!0,Promise.resolve().then(o.bind(o,11460)).then((s=>this._dumpTools=s))),this._objectRenderer.prepareRenderList(),this.onBeforeBindObservable.notifyObservers(this),this._objectRenderer.initRender(this.getRenderWidth(),this.getRenderHeight());const s=this._objectRenderer._checkReadiness();return this.onAfterUnbindObservable.notifyObservers(this),this._objectRenderer.finishRender(),s}_render(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const o=this.Ls();if(o){if(void 0!==this.useCameraPostProcesses&&(s=this.useCameraPostProcesses),this._objectRenderer.prepareRenderList(),this.onBeforeBindObservable.notifyObservers(this),this._objectRenderer.initRender(this.getRenderWidth(),this.getRenderHeight()),!this.is2DArray&&!this.is3D||this.isMulti)if(this.isCube&&!this.isMulti)for(let t=0;t<6;t++)this._renderToTarget(t,s,Z),o.incrementRenderId(),o.resetCachedMaterial();else this._renderToTarget(0,s,Z);else for(let t=0;t<this.getRenderLayers();t++)this._renderToTarget(0,s,Z,t),o.incrementRenderId(),o.resetCachedMaterial();this.onAfterUnbindObservable.notifyObservers(this),this._objectRenderer.finishRender()}}_bestReflectionRenderTargetDimension(s,Z){const o=s*Z,t=(0,O.m)(o+16384/(128+o));return Math.min((0,O.d)(s),t)}_bindFrameBuffer(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const o=this.Ls();if(!o)return;const t=o.getEngine();this._renderTarget&&t.bindFramebuffer(this._renderTarget,this.isCube?s:void 0,void 0,void 0,this.ignoreCameraViewport,0,Z)}_unbindFrameBuffer(s,Z){this._renderTarget&&s.unBindFramebuffer(this._renderTarget,this.isCube,(()=>{this.onAfterRenderObservable.notifyObservers(Z)}))}_prepareFrame(s,Z,o,t){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses)||this._bindFrameBuffer(Z,o):t&&s.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(Z,o)}_renderToTarget(s,Z,o){var t,j;let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const a=this.Ls();if(!a)return;const O=a.getEngine();this._currentFaceIndex=s,this._currentLayer=S,this._currentUseCameraPostProcess=Z,this._currentDumpForDebug=o,this._prepareFrame(a,s,S,Z),null===(t=O._debugPushGroup)||void 0===t||t.call(O,`render to face #${s} layer #${S}`,2),this._objectRenderer.render(s+S,!0),null===(j=O._debugPopGroup)||void 0===j||j.call(O,2),this._unbindFrameBuffer(O,s),this._texture&&this.isCube&&5===s&&O.generateMipMapsForCubemap(this._texture,!0)}setRenderingOrder(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._objectRenderer.setRenderingOrder(s,Z,o,t)}setRenderingAutoClearDepthStencil(s,Z){this._objectRenderer.setRenderingAutoClearDepthStencil(s,Z)}clone(){const s=this.getSize(),Z=new z(this.name,s,this.Ls(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return Z.na=this.na,Z.level=this.level,Z.coordinatesMode=this.coordinatesMode,this.renderList&&(Z.renderList=this.renderList.slice(0)),Z}serialize(){if(!this.name)return null;const s=super.serialize();if(s.renderTargetSize=this.getRenderSize(),s.renderList=[],this.renderList)for(let Z=0;Z<this.renderList.length;Z++)s.renderList.push(this.renderList[Z].id);return s}disposeFramebufferObjects(){var s;null===(s=this._renderTarget)||void 0===s||s.dispose(!0)}releaseInternalTexture(){var s;null===(s=this._renderTarget)||void 0===s||s.releaseTextures(),this._texture=null}dispose(){var s;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._objectRenderer.onBeforeRenderingManagerRenderObservable.remove(this._onBeforeRenderingManagerRenderObserver),this._objectRenderer.onAfterRenderingManagerRenderObservable.remove(this._onAfterRenderingManagerRenderObserver),this._objectRenderer.onFastPathRenderObservable.remove(this._onFastPathRenderObserver),this._dontDisposeObjectRenderer||this._objectRenderer.dispose(),this.clearPostProcesses(!0),this._resizeObserver&&(this.Ls().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null);const Z=this.Ls();if(!Z)return;let o=Z.customRenderTargets.indexOf(this);o>=0&&Z.customRenderTargets.splice(o,1);for(const t of Z.cameras)o=t.customRenderTargets.indexOf(this),o>=0&&t.customRenderTargets.splice(o,1);null===(s=this._renderTarget)||void 0===s||s.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this._objectRenderer._rebuild(),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._objectRenderer.freeRenderingGroups()}getViewCount(){return 1}}z.REFRESHRATE_RENDER_ONCE=D.REFRESHRATE_RENDER_ONCE,z.REFRESHRATE_RENDER_ONEVERYFRAME=D.REFRESHRATE_RENDER_ONEVERYFRAME,z.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=D.REFRESHRATE_RENDER_ONEVERYTWOFRAMES,S.c._CreateRenderTargetTexture=(s,Z,o,t,j)=>new z(s,Z,o,t)},11410:(s,Z,o)=>{o.d(Z,{c:()=>U});var t=o(11086),j=o(11091),S=o(10932),a=o(10900),O=o(11393),v=o(10916),G=o(10975),B=o(11009),Q=o(11066),D=o(11159),z=o(10999);function Y(s,Z){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const t=Z.width,j=Z.height;if(s instanceof Float32Array){let Z=s.byteLength/s.BYTES_PER_ELEMENT;const o=new Uint8Array(Z);for(;--Z>=0;){let t=s[Z];t<0?t=0:t>1&&(t=1),o[Z]=255*t}s=o}const S=document.createElement("canvas");S.width=t,S.height=j;const a=S.getContext("2d");if(!a)return null;const O=a.createImageData(t,j);if(O.data.set(s),a.putImageData(O,0,0),o){const s=document.createElement("canvas");s.width=t,s.height=j;const Z=s.getContext("2d");return Z?(Z.translate(0,j),Z.scale(1,-1),Z.drawImage(S,0,0),s.toDataURL("image/png")):null}return S.toDataURL("image/png")}function b(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const t=s.getInternalTexture();if(!t)return null;const j=s._readPixelsSync(Z,o);return j?Y(j,s.getSize(),t.invertY):null}async function f(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const t=s.getInternalTexture();if(!t)return null;const j=await s.readPixels(Z,o);return j?Y(j,s.getSize(),t.invertY):null}var A=o(11291),d=o(11167);class U extends O.b{static _CreateVideoTexture(s,Z,o){arguments.length>5&&void 0!==arguments[5]||U.TRILINEAR_SAMPLINGMODE;throw(0,G.d)("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(s){this._isBlocking=s}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(s,Z,o,t){let j,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:U.TRILINEAR_SAMPLINGMODE,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Q=arguments.length>8&&void 0!==arguments[8]&&arguments[8],D=arguments.length>9?arguments[9]:void 0,z=arguments.length>10?arguments[10]:void 0,Y=arguments.length>11?arguments[11]:void 0,b=arguments.length>12?arguments[12]:void 0,f=arguments.length>13?arguments[13]:void 0;super(Z),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new S.b,this._isBlocking=!0,this.name=s||"",this.url=s;let d=!1,u=null,H=!0;"object"===typeof o&&null!==o?(j=o.noMipmap??!1,t=o.invertY??!A.b,a=o.samplingMode??U.TRILINEAR_SAMPLINGMODE,O=o.T??null,v=o.onError??null,G=o.buffer??null,Q=o.deleteBuffer??!1,D=o.format,z=o.mimeType,Y=o.loaderOptions,b=o.creationFlags,d=o.useSRGBBuffer??!1,u=o.internalTexture??null,H=o.gammaSpace??H,f=o.forcedExtension??f):j=!!o,this._gammaSpace=H,this._noMipmap=j,this._invertY=void 0===t?!A.b:t,this._initialSamplingMode=a,this._buffer=G,this._deleteBuffer=Q,this._mimeType=z,this._loaderOptions=Y,this._creationFlags=b,this._useSRGBBuffer=d,this._forcedExtension=f,void 0!==D&&(this._format=D);const F=this.Ls(),i=this._getEngine();if(!i)return;i.onBeforeTextureInitObservable.notifyObservers(this);const N=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),O&&O(),!this.isBlocking&&F&&F.resetCachedMaterial()},L=(s,Z)=>{this._loadingError=!0,this._errorObject={message:s,exception:Z},v&&v(s,Z),U.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!u)return this._delayedOnLoad=N,void(this._delayedOnError=L);if(this._texture=u??this._getFromCache(this.url,j,a,this._invertY,d,this.isCube),this._texture)if(this._texture.isReady)B.c.SetImmediate((()=>N()));else{const s=this._texture.onLoadedObservable.add(N);this._texture.onErrorObservable.add((Z=>{var o;L(Z.message,Z.exception),null===(o=this._texture)||void 0===o||o.onLoadedObservable.remove(s)}))}else if(F&&F.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=N,this._delayedOnError=L;else{try{this._texture=i.createTexture(this.url,j,this._invertY,F,a,N,L,this._buffer,void 0,this._format,this._forcedExtension,z,Y,b,d)}catch(V){throw L("error loading",V),V}Q&&(this._buffer=null)}}updateURL(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2?arguments[2]:void 0,t=arguments.length>3?arguments[3]:void 0;this.url&&(this.releaseInternalTexture(),this.Ls().markAllMaterialsAsDirty(1,(s=>s.hasTexture(this)))),this.name&&!this.name.startsWith("data:")||(this.name=s),this.url=s,this._buffer=Z,this._forcedExtension=t,this.delayLoadState=4,o&&(this._delayedOnLoad=o),this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;const s=this.Ls();s&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?B.c.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=s.getEngine().createTexture(this.url,this._noMipmap,this._invertY,s,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(s,Z,o,t){s*=this._cachedUScale,Z*=this._cachedVScale,s-=this.uRotationCenter*this._cachedUScale,Z-=this.vRotationCenter*this._cachedVScale,o-=this.wRotationCenter,a.n.TransformCoordinatesFromFloatsToRef(s,Z,o,this._rowGenerationMatrix,t),t.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,t.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,t.z+=this.wRotationCenter}getTextureMatrix(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*s===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*s,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=a.b.Zero(),this._rowGenerationMatrix=new a.b,this._t0=a.n.Zero(),this._t1=a.n.Zero(),this._t2=a.n.Zero()),a.b.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(a.b.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,a.g.Matrix[0]),a.b.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,a.g.Matrix[1]),a.b.ScalingToRef(this._cachedUScale,this._cachedVScale,0,a.g.Matrix[2]),a.b.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,a.g.Matrix[3]),a.g.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(a.g.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(a.g.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(a.g.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.RB(this._t0),this._t2.RB(this._t0),a.b.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const Z=this.Ls();if(!Z)return this._cachedTextureMatrix;const o=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&o!==this._cachedIdentity3x2&&Z.markAllMaterialsAsDirty(1,(s=>s.hasTexture(this))),this._cachedTextureMatrix}getReflectionTextureMatrix(){const s=this.Ls();if(!s)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==U.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===s.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=a.b.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=a.b.Zero());const Z=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case U.PLANAR_MODE:a.b.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case U.PROJECTION_MODE:{a.b.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const Z=s.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=Z.updateFlag,Z.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:a.b.IdentityToRef(this._cachedReflectionTextureMatrix)}return Z&&s.markAllMaterialsAsDirty(1,(s=>s.hasTexture(this))),this._cachedReflectionTextureMatrix}clone(){const s={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,T:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return d.c.Clone((()=>new U(this._texture?this._texture.url:null,this.Ls(),s)),this)}serialize(){var s;const Z=this.name;U.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const o=super.serialize(U._SerializeInternalTextureUniqueId);if(!o)return null;if(U.SerializeBuffers||U.ForceSerializeBuffers)if("string"===typeof this._buffer&&this._buffer.startsWith("data:"))o.base64String=this._buffer,o.name=o.name.replace("data:","");else if(this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array){const s=this.mimeType||"image/png";o.base64String=`data:${s};base64,${(0,z.i)(this._buffer)}`}else(U.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(o.base64String=!this._engine||this._engine._features.supportSyncTextureRead?b(this):f(this));var t;(o.invertY=this._invertY,o.samplingMode=this.samplingMode,o._creationFlags=this._creationFlags,o._useSRGBBuffer=this._useSRGBBuffer,U._SerializeInternalTextureUniqueId)&&(o.internalTextureUniqueId=null===(t=this._texture)||void 0===t?void 0:t.uniqueId);return o.internalTextureLabel=null===(s=this._texture)||void 0===s?void 0:s.label,o.noMipmap=this._noMipmap,this.name=Z,o}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(s,Z,o){if(s.customType){const t=Q.c.Instantiate(s.customType).Parse(s,Z,o);return s.samplingMode&&t.updateSamplingMode&&t._samplingMode&&t._samplingMode!==s.samplingMode&&t.updateSamplingMode(s.samplingMode),t}if(s.isCube&&!s.isRenderTarget)return U._CubeTextureParser(s,Z,o);const t=void 0!==s.internalTextureUniqueId;if(!s.name&&!s.isRenderTarget&&!t)return null;let j;if(t){const o=Z.getEngine().getLoadedTexturesCache();for(const Z of o)if(Z.uniqueId===s.internalTextureUniqueId){j=Z;break}}const S=Z=>{if(Z&&Z._texture&&(Z._texture._cachedWrapU=null,Z._texture._cachedWrapV=null,Z._texture._cachedWrapR=null),s.samplingMode){const o=s.samplingMode;Z&&Z.samplingMode!==o&&Z.updateSamplingMode(o)}if(Z&&s.animations)for(let o=0;o<s.animations.length;o++){const t=s.animations[o],j=(0,v.e)("BABYLON.Animation");j&&Z.animations.push(j.Parse(t))}Z&&Z._texture&&(t&&!j&&Z._texture._setUniqueId(s.internalTextureUniqueId),Z._texture.label=s.internalTextureLabel)};return d.c.Parse((()=>{let t=!0;if(s.noMipmap&&(t=!1),s.mirrorPlane){const o=U._CreateMirror(s.name,s.renderTargetSize,Z,t);return o._waitingRenderList=s.renderList,o.mirrorPlane=D.b.oO(s.mirrorPlane),S(o),o}if(s.isRenderTarget){let o=null;if(s.isCube){if(Z.reflectionProbes)for(let t=0;t<Z.reflectionProbes.length;t++){const o=Z.reflectionProbes[t];if(o.name===s.name)return o.cubeTexture}}else o=U._CreateRenderTargetTexture(s.name,s.renderTargetSize,Z,t,s._creationFlags??0),o._waitingRenderList=s.renderList;return S(o),o}if(s.isVideo){const j=U._CreateVideoTexture(o+(s.url||s.name),o+(s.src||s.url),Z,t,s.invertY,s.samplingMode,s.settings||{});return S(j),j}{let a;if(s.base64String&&!j)a=U.CreateFromBase64String(s.base64String,s.base64String,Z,!t,s.invertY,s.samplingMode,(()=>{S(a)}),s._creationFlags??0,s._useSRGBBuffer??!1),a.name=s.name;else{let O;O=s.name&&(s.name.indexOf("://")>0||s.name.startsWith("data:"))?s.name:o+s.name,s.url&&(s.url.startsWith("data:")||U.UseSerializedUrlIfAny)&&(O=s.url);const v={noMipmap:!t,invertY:s.invertY,samplingMode:s.samplingMode,T:()=>{S(a)},internalTexture:j};a=new U(O,Z,v)}return a}}),s,Z)}static CreateFromBase64String(s,Z,o,t,j){let S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:U.TRILINEAR_SAMPLINGMODE;return new U("data:"+Z,o,t,j,S,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,s,!1,arguments.length>8&&void 0!==arguments[8]?arguments[8]:5,void 0,void 0,arguments.length>9?arguments[9]:void 0,arguments.length>10?arguments[10]:void 0)}static LoadFromDataString(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],j=arguments.length>4?arguments[4]:void 0,S=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:U.TRILINEAR_SAMPLINGMODE,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,v=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,G=arguments.length>9&&void 0!==arguments[9]?arguments[9]:5,B=arguments.length>10?arguments[10]:void 0,Q=arguments.length>11?arguments[11]:void 0;return"data:"!==s.substring(0,5)&&(s="data:"+s),new U(s,o,j,S,a,O,v,Z,t,G,void 0,void 0,B,Q)}}U.SerializeBuffers=!0,U.ForceSerializeBuffers=!1,U.OnTextureLoadErrorObservable=new S.b,U._SerializeInternalTextureUniqueId=!1,U._CubeTextureParser=(s,Z,o)=>{throw(0,G.d)("CubeTexture")},U._CreateMirror=(s,Z,o,t)=>{throw(0,G.d)("MirrorTexture")},U._CreateRenderTargetTexture=(s,Z,o,t,j)=>{throw(0,G.d)("RenderTargetTexture")},U.NEAREST_SAMPLINGMODE=1,U.NEAREST_NEAREST_MIPLINEAR=8,U.BILINEAR_SAMPLINGMODE=2,U.LINEAR_LINEAR_MIPNEAREST=11,U.TRILINEAR_SAMPLINGMODE=3,U.LINEAR_LINEAR_MIPLINEAR=3,U.NEAREST_NEAREST_MIPNEAREST=4,U.NEAREST_LINEAR_MIPNEAREST=5,U.NEAREST_LINEAR_MIPLINEAR=6,U.NEAREST_LINEAR=7,U.NEAREST_NEAREST=1,U.LINEAR_NEAREST_MIPNEAREST=9,U.LINEAR_NEAREST_MIPLINEAR=10,U.LINEAR_LINEAR=2,U.LINEAR_NEAREST=12,U.EXPLICIT_MODE=0,U.SPHERICAL_MODE=1,U.PLANAR_MODE=2,U.CUBIC_MODE=3,U.PROJECTION_MODE=4,U.SKYBOX_MODE=5,U.INVCUBIC_MODE=6,U.EQUIRECTANGULAR_MODE=7,U.FIXED_EQUIRECTANGULAR_MODE=8,U.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,U.CLAMP_ADDRESSMODE=0,U.WRAP_ADDRESSMODE=1,U.MIRROR_ADDRESSMODE=2,U.UseSerializedUrlIfAny=!1,(0,t.c)([(0,j.K)()],U.prototype,"url",void 0),(0,t.c)([(0,j.K)()],U.prototype,"uOffset",void 0),(0,t.c)([(0,j.K)()],U.prototype,"vOffset",void 0),(0,t.c)([(0,j.K)()],U.prototype,"uScale",void 0),(0,t.c)([(0,j.K)()],U.prototype,"vScale",void 0),(0,t.c)([(0,j.K)()],U.prototype,"uAng",void 0),(0,t.c)([(0,j.K)()],U.prototype,"vAng",void 0),(0,t.c)([(0,j.K)()],U.prototype,"wAng",void 0),(0,t.c)([(0,j.K)()],U.prototype,"uRotationCenter",void 0),(0,t.c)([(0,j.K)()],U.prototype,"vRotationCenter",void 0),(0,t.c)([(0,j.K)()],U.prototype,"wRotationCenter",void 0),(0,t.c)([(0,j.K)()],U.prototype,"homogeneousRotationInUVTransform",void 0),(0,t.c)([(0,j.K)()],U.prototype,"isBlocking",null),(0,v.f)("BABYLON.Texture",U),d.c._TextureParser=U.Parse},11334:(s,Z,o)=>{function t(s){return 13===s||14===s||15===s||16===s||17===s||18===s||19===s}function j(s){return 13===s||17===s||18===s||19===s}o.d(Z,{e:()=>j,g:()=>t})},11052:(s,Z,o)=>{o.d(Z,{e:()=>t});class t{get wrapU(){return this._cachedWrapU}set wrapU(s){this._cachedWrapU=s}get wrapV(){return this._cachedWrapV}set wrapV(s){this._cachedWrapV=s}get wrapR(){return this._cachedWrapR}set wrapR(s){this._cachedWrapR=s}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(s){this._cachedAnisotropicFilteringLevel=s}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(s){this._comparisonFunction=s}get useMipMaps(){return this._useMipMaps}set useMipMaps(s){this._useMipMaps=s}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this._cachedWrapU=s,this._cachedWrapV=Z,this._cachedWrapR=o,this._cachedAnisotropicFilteringLevel=t,this.samplingMode=j,this._comparisonFunction=S,this}compareSampler(s){return this._cachedWrapU===s._cachedWrapU&&this._cachedWrapV===s._cachedWrapV&&this._cachedWrapR===s._cachedWrapR&&this._cachedAnisotropicFilteringLevel===s._cachedAnisotropicFilteringLevel&&this.samplingMode===s.samplingMode&&this._comparisonFunction===s._comparisonFunction&&this._useMipMaps===s._useMipMaps}}},11189:(s,Z,o)=>{function t(s){-1===s.indexOf("vClipPlane")&&s.push("vClipPlane"),-1===s.indexOf("vClipPlane2")&&s.push("vClipPlane2"),-1===s.indexOf("vClipPlane3")&&s.push("vClipPlane3"),-1===s.indexOf("vClipPlane4")&&s.push("vClipPlane4"),-1===s.indexOf("vClipPlane5")&&s.push("vClipPlane5"),-1===s.indexOf("vClipPlane6")&&s.push("vClipPlane6")}function j(s,Z,o){const t=!!(s.clipPlane??Z.clipPlane),j=!!(s.clipPlane2??Z.clipPlane2),S=!!(s.clipPlane3??Z.clipPlane3),a=!!(s.clipPlane4??Z.clipPlane4),O=!!(s.clipPlane5??Z.clipPlane5),v=!!(s.clipPlane6??Z.clipPlane6);t&&o.push("#define CLIPPLANE"),j&&o.push("#define CLIPPLANE2"),S&&o.push("#define CLIPPLANE3"),a&&o.push("#define CLIPPLANE4"),O&&o.push("#define CLIPPLANE5"),v&&o.push("#define CLIPPLANE6")}function S(s,Z,o){let t=!1;const j=!!(s.clipPlane??Z.clipPlane),S=!!(s.clipPlane2??Z.clipPlane2),a=!!(s.clipPlane3??Z.clipPlane3),O=!!(s.clipPlane4??Z.clipPlane4),v=!!(s.clipPlane5??Z.clipPlane5),G=!!(s.clipPlane6??Z.clipPlane6);return o.CLIPPLANE!==j&&(o.CLIPPLANE=j,t=!0),o.CLIPPLANE2!==S&&(o.CLIPPLANE2=S,t=!0),o.CLIPPLANE3!==a&&(o.CLIPPLANE3=a,t=!0),o.CLIPPLANE4!==O&&(o.CLIPPLANE4=O,t=!0),o.CLIPPLANE5!==v&&(o.CLIPPLANE5=v,t=!0),o.CLIPPLANE6!==G&&(o.CLIPPLANE6=G,t=!0),t}function a(s,Z,o){let t=Z.clipPlane??o.clipPlane;O(s,"vClipPlane",t),t=Z.clipPlane2??o.clipPlane2,O(s,"vClipPlane2",t),t=Z.clipPlane3??o.clipPlane3,O(s,"vClipPlane3",t),t=Z.clipPlane4??o.clipPlane4,O(s,"vClipPlane4",t),t=Z.clipPlane5??o.clipPlane5,O(s,"vClipPlane5",t),t=Z.clipPlane6??o.clipPlane6,O(s,"vClipPlane6",t)}function O(s,Z,o){o&&s.setFloat4(Z,o.gt.x,o.gt.y,o.gt.z,o.d)}o.d(Z,{b:()=>t,f:()=>a,h:()=>S,i:()=>j})},11506:(s,Z,o)=>{function t(s){s.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}o.d(Z,{e:()=>t})},11318:(s,Z,o)=>{function t(s){return void 0===s.getPipelineContext}o.d(Z,{c:()=>t})},11151:(s,Z,o)=>{o.d(Z,{e:()=>j});var t=o(11009);class j{static GetEffect(s){return void 0===s.getPipelineContext?s.effect:s}constructor(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=s.createDrawContext(),Z&&(this.materialContext=s.createMaterialContext())}setEffect(s,Z){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var t;(this.effect=s,void 0!==Z&&(this.defines=Z),o)&&(null===(t=this.drawContext)||void 0===t||t.reset())}dispose(){var s;let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const s=this.effect;Z?s.dispose():t.c.SetImmediate((()=>{s.getEngine().onEndFrameObservable.addOnce((()=>{s.dispose()}))})),this.effect=null}null===(s=this.drawContext)||void 0===s||s.dispose()}}},11029:(s,Z,o)=>{o.d(Z,{c:()=>Q,e:()=>z,i:()=>G,j:()=>B});var t=o(10947),j=o(11037),S=o(11026),a=o(10955),O=o(11004),v=o(11007);function G(s,Z){return(0,j.C)(Z).cachedPipelines[s]}function B(s){const Z=s._name,o=s.context;if(Z&&o){const s=(0,j.C)(o),t=s.cachedPipelines[Z];null===t||void 0===t||t.dispose(),delete s.cachedPipelines[Z]}}function Q(s,Z,o,j,S,a,v){let G,B;const Q=(0,t.i)()?null===a||void 0===a?void 0:a.getHostDocument():null;G="string"===typeof Z?Z:Z.vertexSource?"source:"+Z.vertexSource:Z.vertexElement?(null===Q||void 0===Q?void 0:Q.getElementById(Z.vertexElement))||Z.vertexElement:Z.vertex||Z,B="string"===typeof Z?Z:Z.fragmentSource?"source:"+Z.fragmentSource:Z.fragmentElement?(null===Q||void 0===Q?void 0:Q.getElementById(Z.fragmentElement))||Z.fragmentElement:Z.fragment||Z;const z=[void 0,void 0],Y=()=>{if(z[0]&&z[1]){s.isFragment=!0;const[t,G]=z;(0,O.i)(G,s,((a,G)=>{v&&(v._fragmentSourceCodeBeforeMigration=G),o&&(a=o("fragment",a));const B=(0,O.d)(t,a,s);s=null;const Q=function(s,Z,o,t){if(o){return{vertexSourceCode:(1===t?"//":"")+"#define SHADER_NAME vertex:"+(o.vertexElement||o.vertex||o.spectorName||o)+"\n"+s,fragmentSourceCode:(1===t?"//":"")+"#define SHADER_NAME fragment:"+(o.fragmentElement||o.fragment||o.spectorName||o)+"\n"+Z}}return{vertexSourceCode:s,fragmentSourceCode:Z}}(B.vertexCode,B.fragmentCode,Z,S);null===j||void 0===j||j(Q.vertexSourceCode,Q.fragmentSourceCode)}),a)}};D(G,"Vertex","",(Z=>{(0,O.g)(s),(0,O.i)(Z,s,((s,t)=>{v&&(v._rawVertexSourceCode=Z,v._vertexSourceCodeBeforeMigration=t),o&&(s=o("vertex",s)),z[0]=s,Y()}),a)}),S),D(B,"Fragment","Pixel",(s=>{v&&(v._rawFragmentSourceCode=s),z[1]=s,Y()}),S)}function D(s,Z,o,j,a,O){if("undefined"!==typeof HTMLElement&&s instanceof HTMLElement){return void j((0,t.d)(s))}if("source:"===s.substring(0,7))return void j(s.substring(7));if("base64:"===s.substring(0,7)){return void j(window.atob(s.substring(7)))}const G=S.d.GetShadersStore(a);if(G[s+Z+"Shader"])return void j(G[s+Z+"Shader"]);if(o&&G[s+o+"Shader"])return void j(G[s+o+"Shader"]);let B;if(B="."===s[0]||"/"===s[0]||s.indexOf("http")>-1?s:S.d.GetShadersRepository(a)+s,!(O=O||v.k))throw new Error("loadFileInjection is not defined");O(B+"."+Z.toLowerCase()+".fx",j)}const z=(s,Z,o,t)=>{try{const S=s.context?(0,j.C)(s.context):null;S&&(S.disableParallelShaderCompile=s.disableParallelCompilation);const a=s.existingPipelineContext||Z(s.shaderProcessingContext);return a._name=s.name,s.name&&S&&(S.cachedPipelines[s.name]=a),o(a,s.vertex,s.fragment,!!s.createAsRaw,"","",s.rebuildRebind,s.defines,s.transformFeedbackVaryings,"",(()=>{t(a,(()=>{var Z;null===(Z=s.onRenderingStateCompiled)||void 0===Z||Z.call(s,a)}))})),a}catch(S){throw a.b.Error("Error compiling effect"),S}}},11019:(s,Z,o)=>{o.d(Z,{d:()=>v});var t=o(10932),j=o(10955),S=o(11026),a=o(11029),O=o(11009);class v{static get ShadersRepository(){return S.d.ShadersRepository}static set ShadersRepository(s){S.d.ShadersRepository=s}get B(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new t.b),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(s,Z,o){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,S=arguments.length>4?arguments[4]:void 0,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,B=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,D=arguments.length>9?arguments[9]:void 0,z=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",Y=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,b=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new t.b,this.onErrorObservable=new t.b,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=s,this._key=z;const f=this._key.replace(/\r/g,"").replace(/\n/g,"|");let A;if(Z.attributes){const s=Z;if(this._engine=o,this._attributesNames=s.attributes,this._uniformsNames=s.uniformsNames.concat(s.samplers),this._samplerList=s.samplers.slice(),this.defines=s.defines,this.onError=s.onError,this.onCompiled=s.onCompiled,this._fallbacks=s.fallbacks,this._indexParameters=s.indexParameters,this._transformFeedbackVaryings=s.transformFeedbackVaryings||null,this._multiTarget=!!s.multiTarget,this._shaderLanguage=s.shaderLanguage??0,this._disableParallelShaderCompilation=!!s.disableParallelShaderCompilation,s.uniformBuffersNames){this._uniformBuffersNamesList=s.uniformBuffersNames.slice();for(let Z=0;Z<s.uniformBuffersNames.length;Z++)this._uniformBuffersNames[s.uniformBuffersNames[Z]]=Z}this._processFinalCode=s.processFinalCode??null,this._processCodeAfterIncludes=s.processCodeAfterIncludes??void 0,b=s.extraInitializationsAsync,A=s.existingPipelineContext}else this._engine=S,this.defines=null==O?"":O,this._uniformsNames=o.concat(j),this._samplerList=j?j.slice():[],this._attributesNames=Z,this._uniformBuffersNamesList=[],this._shaderLanguage=Y,this.onError=Q,this.onCompiled=B,this._indexParameters=D,this._fallbacks=G;"WEBGL2"===this._engine.shaderPlatformName&&(A=(0,a.i)(f,this._engine._gl)??A),this._attributeLocationByName={},this.uniqueId=v._UniqueIdSeed++,A?(this._pipelineContext=A,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,b),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.B||this.dispose(!0)}))}async _processShaderCodeAsync(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3?arguments[3]:void 0;t&&await t(),this._processingContext=o||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const j={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:s??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:S.d.GetShadersRepository(this._shaderLanguage),includesShadersStore:S.d.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,a.c)(j,this.name,this._processFinalCode,((s,o)=>{this._vertexSourceCode=s,this._fragmentSourceCode=o,this._prepareEffect(Z)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.B||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(s){return this._attributes[s]}getAttributeLocationByName(s){return this._attributeLocationByName[s]}getAttributesCount(){return this._attributes.length}getUniformIndex(s){return this._uniformsNames.indexOf(s)}getUniform(s){return this._uniforms[s]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((s=>{this.executeWhenCompiled(s)}))}executeWhenCompiled(s){this.isReady()?s(this):(this.onCompileObservable.add((Z=>{s(Z)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(s){(0,O.d)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(Z=>{this._processCompilationErrors(Z,s)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var s;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(s=this._pipelineContext)||void 0===s?void 0:s._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var s;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(s=this._pipelineContext)||void 0===s?void 0:s._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(s,Z,o,t){this._isReady=!1,this._vertexSourceCodeOverride=s,this._fragmentSourceCodeOverride=Z,this.onError=(s,Z)=>{t&&t(Z)},this.onCompiled=()=>{var s,Z;const t=this.getEngine().scenes;if(t)for(let o=0;o<t.length;o++)t[o].markAllMaterialsAsDirty(127);null===(s=(Z=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===s||s.call(Z,o)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(s){if(this._pipelineContext=s,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let Z=0;Z<this._attributesNames.length;Z++){const s=this._attributesNames[Z];this._attributeLocationByName[s]=this._attributes[Z]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),v.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Z=this._pipelineContext;this._isReady=!1;try{const o=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),t=o?null:this.defines,j=o?this._vertexSourceCodeOverride:this._vertexSourceCode,S=o?this._fragmentSourceCodeOverride:this._fragmentSourceCode,O=this._engine;this._pipelineContext=(0,a.e)({existingPipelineContext:s?Z:null,vertex:j,fragment:S,context:"WEBGL2"===O.shaderPlatformName||"WEBGL1"===O.shaderPlatformName?O._gl:void 0,rebuildRebind:(s,Z,o,t)=>this._rebuildProgram(s,Z,o,t),defines:t,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:o,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:o=>{Z&&!s&&this._engine._deletePipelineContext(Z),o&&this._onRenderingStateCompiled(o)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(Z)}catch(o){this._processCompilationErrors(o,Z)}}_getShaderCodeAndErrorLine(s,Z,o){const t=o?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let j=null;if(Z&&s){const S=Z.match(t);if(S&&2===S.length){const Z=parseInt(S[1]),t=s.split("\n",-1);t.length>=Z&&(j=`Offending line [${Z}] in ${o?"fragment":"vertex"} code: ${t[Z-1]}`)}}return[s,j]}_processCompilationErrors(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=s.message;const o=this._attributesNames,t=this._fallbacks;if(j.b.Error("Unable to compile effect:"),j.b.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),j.b.Error(`Attributes: ${o.join(" ")}`),j.b.Error("Defines:\n"+this.defines),v.LogShaderCodeOnCompilationError){var S,a;let s=null,Z=null,o=null;var O;if(null!==(S=this._pipelineContext)&&void 0!==S&&S._getVertexShaderCode()&&([o,s]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),o&&(j.b.Error("Vertex code:"),j.b.Error(o))),null!==(a=this._pipelineContext)&&void 0!==a&&a._getFragmentShaderCode())[o,Z]=this._getShaderCodeAndErrorLine(null===(O=this._pipelineContext)||void 0===O?void 0:O._getFragmentShaderCode(),this._compilationError,!0),o&&(j.b.Error("Fragment code:"),j.b.Error(o));s&&j.b.Error(s),Z&&j.b.Error(Z)}j.b.Error("Error: "+this._compilationError);const G=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};Z&&(this._pipelineContext=Z,this._isReady=!0,G()),t?(this._pipelineContext=null,t.hasMoreFallbacks?(this._allFallbacksProcessed=!1,j.b.Error("Trying next fallback."),this.defines=t.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,G(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,Z||G())}get isSupported(){return""===this._compilationError}_bindTexture(s,Z){this._engine._bindTexture(this._samplers[s],Z,s)}setTexture(s,Z){this._engine.setTexture(this._samplers[s],this._uniforms[s],Z,s)}setTextureArray(s,Z){const o=s+"Ex";if(-1===this._samplerList.indexOf(o+"0")){const t=this._samplerList.indexOf(s);for(let s=1;s<Z.length;s++){const Z=o+(s-1).toString();this._samplerList.splice(t+s,0,Z)}let j=0;for(const s of this._samplerList)this._samplers[s]=j,j+=1}this._engine.setTextureArray(this._samplers[s],this._uniforms[s],Z,s)}bindUniformBuffer(s,Z){const o=this._uniformBuffersNames[Z];void 0===o||v._BaseCache[o]===s&&this._engine._features.useUBOBindingCache||(v._BaseCache[o]=s,this._engine.bindUniformBufferBase(s,o,Z))}bindUniformBlock(s,Z){this._engine.bindUniformBlock(this._pipelineContext,s,Z)}setInt(s,Z){return this._pipelineContext.setInt(s,Z),this}setInt2(s,Z,o){return this._pipelineContext.setInt2(s,Z,o),this}setInt3(s,Z,o,t){return this._pipelineContext.setInt3(s,Z,o,t),this}setInt4(s,Z,o,t,j){return this._pipelineContext.setInt4(s,Z,o,t,j),this}setIntArray(s,Z){return this._pipelineContext.setIntArray(s,Z),this}setIntArray2(s,Z){return this._pipelineContext.setIntArray2(s,Z),this}setIntArray3(s,Z){return this._pipelineContext.setIntArray3(s,Z),this}setIntArray4(s,Z){return this._pipelineContext.setIntArray4(s,Z),this}setUInt(s,Z){return this._pipelineContext.setUInt(s,Z),this}setUInt2(s,Z,o){return this._pipelineContext.setUInt2(s,Z,o),this}setUInt3(s,Z,o,t){return this._pipelineContext.setUInt3(s,Z,o,t),this}setUInt4(s,Z,o,t,j){return this._pipelineContext.setUInt4(s,Z,o,t,j),this}setUIntArray(s,Z){return this._pipelineContext.setUIntArray(s,Z),this}setUIntArray2(s,Z){return this._pipelineContext.setUIntArray2(s,Z),this}setUIntArray3(s,Z){return this._pipelineContext.setUIntArray3(s,Z),this}setUIntArray4(s,Z){return this._pipelineContext.setUIntArray4(s,Z),this}setFloatArray(s,Z){return this._pipelineContext.setArray(s,Z),this}setFloatArray2(s,Z){return this._pipelineContext.setArray2(s,Z),this}setFloatArray3(s,Z){return this._pipelineContext.setArray3(s,Z),this}setFloatArray4(s,Z){return this._pipelineContext.setArray4(s,Z),this}setArray(s,Z){return this._pipelineContext.setArray(s,Z),this}setArray2(s,Z){return this._pipelineContext.setArray2(s,Z),this}setArray3(s,Z){return this._pipelineContext.setArray3(s,Z),this}setArray4(s,Z){return this._pipelineContext.setArray4(s,Z),this}setMatrices(s,Z){return this._pipelineContext.setMatrices(s,Z),this}setMatrix(s,Z){return this._pipelineContext.setMatrix(s,Z),this}setMatrix3x3(s,Z){return this._pipelineContext.setMatrix3x3(s,Z),this}setMatrix2x2(s,Z){return this._pipelineContext.setMatrix2x2(s,Z),this}setFloat(s,Z){return this._pipelineContext.setFloat(s,Z),this}setBool(s,Z){return this._pipelineContext.setInt(s,Z?1:0),this}setVector2(s,Z){return this._pipelineContext.setVector2(s,Z),this}setFloat2(s,Z,o){return this._pipelineContext.setFloat2(s,Z,o),this}setVector3(s,Z){return this._pipelineContext.setVector3(s,Z),this}setFloat3(s,Z,o,t){return this._pipelineContext.setFloat3(s,Z,o,t),this}setVector4(s,Z){return this._pipelineContext.setVector4(s,Z),this}setQuaternion(s,Z){return this._pipelineContext.setQuaternion(s,Z),this}setFloat4(s,Z,o,t,j){return this._pipelineContext.setFloat4(s,Z,o,t,j),this}setColor3(s,Z){return this._pipelineContext.setColor3(s,Z),this}setColor4(s,Z,o){return this._pipelineContext.setColor4(s,Z,o),this}setDirectColor4(s,Z){return this._pipelineContext.setDirectColor4(s,Z),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(v.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,a.j)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Z&&(S.d.GetShadersStore(t)[`${s}PixelShader`]=Z),o&&(S.d.GetShadersStore(t)[`${s}VertexShader`]=o)}static ResetCache(){v._BaseCache={}}}v.LogShaderCodeOnCompilationError=!0,v.PersistentMode=!1,v.AutomaticallyClearCodeCache=!1,v._UniqueIdSeed=0,v._BaseCache={},v.ShadersStore=S.d.ShadersStore,v.IncludesShadersStore=S.d.IncludesShadersStore},11590:(s,Z,o)=>{o.d(Z,{c:()=>t});class t{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(s,Z){this._defines[s]||(s<this._currentRank&&(this._currentRank=s),s>this._maxRank&&(this._maxRank=s),this._defines[s]=new Array),this._defines[s].push(Z)}addCPUSkinningFallback(s,Z){this._mesh=Z,s<this._currentRank&&(this._currentRank=s),s>this._maxRank&&(this._maxRank=s)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(s,Z){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,s=s.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),Z._bonesComputationForcedToCPU=!0;const o=this._mesh.Ls();for(let s=0;s<o.meshes.length;s++){const t=o.meshes[s];if(t.material){if(t.computeBonesUsingShaders&&0!==t.numBoneInfluencers)if(t.material.getEffect()===Z)t.computeBonesUsingShaders=!1;else if(t.vO)for(const s of t.vO){if(s.effect===Z){t.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&t.computeBonesUsingShaders&&t.numBoneInfluencers>0&&(t.computeBonesUsingShaders=!1)}}else{const Z=this._defines[this._currentRank];if(Z)for(let o=0;o<Z.length;o++)s=s.replace("#define "+Z[o],"");this._currentRank++}return s}}},11441:(s,Z,o)=>{o.d(Z,{b:()=>G,c:()=>B});var t=o(11113),j=o(11262),S=o(10932),a=o(11019),O=o(11151);o(11447);const v={gs:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class G{constructor(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v;this._fullscreenViewport=new j.b(0,0,1,1);const o=Z.gs??v.gs,S=Z.indices??v.indices;this.wa=s,this._vertexBuffers={[t.e.PositionKind]:new t.e(s,o,t.e.PositionKind,!1,!1,2)},this._indexBuffer=s.createIndexBuffer(S),this._indexBufferLength=S.length,this._onContextRestoredObserver=s.onContextRestoredObservable.add((()=>{this._indexBuffer=s.createIndexBuffer(S);for(const s in this._vertexBuffers){this._vertexBuffers[s]._rebuild()}}))}setViewport(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._fullscreenViewport;this.wa.setViewport(s)}bindBuffers(s){this.wa.bindBuffers(this._vertexBuffers,this._indexBuffer,s)}applyEffectWrapper(s){this.wa.setState(!0),this.wa.depthCullingState.depthTest=!1,this.wa.stencilState.stencilTest=!1,this.wa.enableEffect(s.drawWrapper),this.bindBuffers(s.effect),s.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.wa.depthCullingState.depthTest,this._savedStateStencilTest=this.wa.stencilState.stencilTest}restoreStates(){this.wa.depthCullingState.depthTest=this._savedStateDepthTest,this.wa.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.wa.drawElementsType(0,0,this._indexBufferLength)}_isRenderTargetTexture(s){return void 0!==s.renderTarget}render(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!s.effect.isReady())return;this.saveStates(),this.setViewport();const o=null===Z?null:this._isRenderTargetTexture(Z)?Z.renderTarget:Z;o&&this.wa.bindFramebuffer(o),this.applyEffectWrapper(s),this.draw(),o&&this.wa.unBindFramebuffer(o),this.restoreStates()}dispose(){const s=this._vertexBuffers[t.e.PositionKind];s&&(s.dispose(),delete this._vertexBuffers[t.e.PositionKind]),this._indexBuffer&&this.wa._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.wa.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class B{static RegisterShaderCodeProcessing(s,Z){Z?B._CustomShaderCodeProcessing[s??""]=Z:delete B._CustomShaderCodeProcessing[s??""]}static _GetShaderCodeProcessing(s){return B._CustomShaderCodeProcessing[s]??B._CustomShaderCodeProcessing[""]}get name(){return this.options.name}set name(s){this.options.name=s}isReady(){var s;return(null===(s=this._drawWrapper.effect)||void 0===s?void 0:s.isReady())??!1}get drawWrapper(){return this._drawWrapper}get effect(){return this._drawWrapper.effect}set effect(s){this._drawWrapper.effect=s}constructor(s){this.alphaMode=0,this.onEffectCreatedObservable=new S.b(void 0,!0),this.onApplyObservable=new S.b,this._shadersLoaded=!1,this._webGPUReady=!1,this._importPromises=[],this.options={...s,name:s.name||"effectWrapper",wa:s.wa,uniforms:s.uniforms||s.uniformNames||[],uniformNames:void 0,samplers:s.samplers||s.samplerNames||[],samplerNames:void 0,attributeNames:s.attributeNames||["position"],uniformBuffers:s.uniformBuffers||[],defines:s.defines||"",useShaderStore:s.useShaderStore||!1,vertexUrl:s.vertexUrl||s.vertexShader||"postprocess",vertexShader:void 0,fragmentShader:s.fragmentShader||"pass",indexParameters:s.indexParameters,blockCompilation:s.blockCompilation||!1,shaderLanguage:s.shaderLanguage||0,onCompiled:s.onCompiled||void 0,extraInitializations:s.extraInitializations||void 0,extraInitializationsAsync:s.extraInitializationsAsync||void 0,useAsPostProcess:s.useAsPostProcess??!1},this.options.uniformNames=this.options.uniforms,this.options.samplerNames=this.options.samplers,this.options.vertexShader=this.options.vertexUrl,this.options.useAsPostProcess&&(-1===this.options.samplers.indexOf("textureSampler")&&this.options.samplers.push("textureSampler"),-1===this.options.uniforms.indexOf("scale")&&this.options.uniforms.push("scale")),s.vertexUrl||s.vertexShader?this._shaderPath={vertexSource:this.options.vertexShader}:(this.options.useAsPostProcess||(this.options.uniforms.push("scale"),this.onApplyObservable.add((()=>{this.effect.setFloat2("scale",1,1)}))),this._shaderPath={vertex:this.options.vertexShader}),this._shaderPath.fragmentSource=this.options.fragmentShader,this._shaderPath.spectorName=this.options.name,this.options.useShaderStore&&(this._shaderPath.fragment=this._shaderPath.fragmentSource,this._shaderPath.vertex||(this._shaderPath.vertex=this._shaderPath.vertexSource),delete this._shaderPath.fragmentSource,delete this._shaderPath.vertexSource),this.onApplyObservable.add((()=>{this.bind()})),this.options.useShaderStore||(this._onContextRestoredObserver=this.options.wa.onContextRestoredObservable.add((()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()}))),this._drawWrapper=new O.e(this.options.wa),this._webGPUReady=1===this.options.shaderLanguage;const Z=Array.isArray(this.options.defines)?this.options.defines.join("\n"):this.options.defines;this._postConstructor(this.options.blockCompilation,Z,this.options.extraInitializations)}_gatherImports(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1?arguments[1]:void 0;this.options.useAsPostProcess&&(s&&this._webGPUReady?Z.push(Promise.all([o.e(42).then(o.bind(o,13571))])):Z.push(Promise.all([Promise.resolve().then(o.bind(o,11447))])))}_postConstructor(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2?arguments[2]:void 0,t=arguments.length>3?arguments[3]:void 0;this._importPromises.length=0,t&&this._importPromises.push(...t);const j=this.options.wa.isWebGPU&&!B.ForceGLSL;this._gatherImports(j,this._importPromises),void 0!==o&&o(j,this._importPromises),j&&this._webGPUReady&&(this.options.shaderLanguage=1),s||this.updateEffect(Z)}updateEffect(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3?arguments[3]:void 0,j=arguments.length>4?arguments[4]:void 0,S=arguments.length>5?arguments[5]:void 0,O=arguments.length>6?arguments[6]:void 0,v=arguments.length>7?arguments[7]:void 0;const G=B._GetShaderCodeProcessing(this.name);if(null!==G&&void 0!==G&&G.defineCustomBindings){var Q,D;const t=(null===(Q=Z)||void 0===Q?void 0:Q.slice())??[];t.push(...this.options.uniforms);const j=(null===(D=o)||void 0===D?void 0:D.slice())??[];j.push(...this.options.samplers),s=G.defineCustomBindings(this.name,s,t,j),Z=t,o=j}this.options.defines=s||"";const z=this._shadersLoaded||0===this._importPromises.length?void 0:async()=>{await Promise.all(this._importPromises),this._shadersLoaded=!0};let Y;Y=this.options.extraInitializationsAsync?async()=>{null===z||void 0===z||z(),await this.options.extraInitializationsAsync()}:z,this.options.useShaderStore?this._drawWrapper.effect=this.options.wa.createEffect({vertex:O??this._shaderPath.vertex,fragment:v??this._shaderPath.fragment},{attributes:this.options.attributeNames,uniformsNames:Z||this.options.uniforms,uniformBuffersNames:this.options.uniformBuffers,samplers:o||this.options.samplers,defines:null!==s?s:"",fallbacks:null,onCompiled:j??this.options.onCompiled,onError:S??null,indexParameters:t||this.options.indexParameters,processCodeAfterIncludes:null!==G&&void 0!==G&&G.processCodeAfterIncludes?(s,Z)=>G.processCodeAfterIncludes(this.name,s,Z):null,processFinalCode:null!==G&&void 0!==G&&G.processFinalCode?(s,Z)=>G.processFinalCode(this.name,s,Z):null,shaderLanguage:this.options.shaderLanguage,extraInitializationsAsync:Y},this.options.wa):this._drawWrapper.effect=new a.d(this._shaderPath,this.options.attributeNames,Z||this.options.uniforms,o||this.options.samplerNames,this.options.wa,s,void 0,j||this.options.onCompiled,void 0,void 0,void 0,this.options.shaderLanguage,Y),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)}bind(){var s,Z;let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.options.useAsPostProcess&&!o&&(this.options.wa.setAlphaMode(this.alphaMode),this.drawWrapper.effect.setFloat2("scale",1,1)),null===(s=B._GetShaderCodeProcessing(this.name))||void 0===s||null===(Z=s.bindCustomBindings)||void 0===Z||Z.call(s,this.name,this._drawWrapper.effect)}dispose(){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.onEffectCreatedObservable.clear(),this._drawWrapper.dispose(!0)}}B.ForceGLSL=!1,B._CustomShaderCodeProcessing={}},11509:(s,Z,o)=>{o.d(Z,{d:()=>S,e:()=>j});var t=o(11506);function j(s,Z){Z.EXPOSURE&&s.push("exposureLinear"),Z.CONTRAST&&s.push("contrast"),Z.COLORGRADING&&s.push("colorTransformSettings"),(Z.VIGNETTE||Z.DITHER)&&s.push("vInverseScreenSize"),Z.VIGNETTE&&(s.push("vignetteSettings1"),s.push("vignetteSettings2")),Z.COLORCURVES&&(0,t.e)(s),Z.DITHER&&s.push("ditherIntensity")}function S(s,Z){Z.COLORGRADING&&s.push("txColorTransform")}},11502:(s,Z,o)=>{o.d(Z,{c:()=>z});var t=o(11086),j=o(11091),S=o(10932),a=o(11174),O=o(11167),v=o(11506);class G{constructor(){this._dirty=!0,this._tempColor=new a.h(0,0,0,0),this._globalCurve=new a.h(0,0,0,0),this._highlightsCurve=new a.h(0,0,0,0),this._midtonesCurve=new a.h(0,0,0,0),this._shadowsCurve=new a.h(0,0,0,0),this._positiveCurve=new a.h(0,0,0,0),this._negativeCurve=new a.h(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get globalHue(){return this._globalHue}set globalHue(s){this._globalHue=s,this._dirty=!0}get globalDensity(){return this._globalDensity}set globalDensity(s){this._globalDensity=s,this._dirty=!0}get globalSaturation(){return this._globalSaturation}set globalSaturation(s){this._globalSaturation=s,this._dirty=!0}get globalExposure(){return this._globalExposure}set globalExposure(s){this._globalExposure=s,this._dirty=!0}get highlightsHue(){return this._highlightsHue}set highlightsHue(s){this._highlightsHue=s,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}set highlightsDensity(s){this._highlightsDensity=s,this._dirty=!0}get highlightsSaturation(){return this._highlightsSaturation}set highlightsSaturation(s){this._highlightsSaturation=s,this._dirty=!0}get highlightsExposure(){return this._highlightsExposure}set highlightsExposure(s){this._highlightsExposure=s,this._dirty=!0}get midtonesHue(){return this._midtonesHue}set midtonesHue(s){this._midtonesHue=s,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesDensity(s){this._midtonesDensity=s,this._dirty=!0}get midtonesSaturation(){return this._midtonesSaturation}set midtonesSaturation(s){this._midtonesSaturation=s,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set midtonesExposure(s){this._midtonesExposure=s,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set shadowsHue(s){this._shadowsHue=s,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set shadowsDensity(s){this._shadowsDensity=s,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}set shadowsSaturation(s){this._shadowsSaturation=s,this._dirty=!0}get shadowsExposure(){return this._shadowsExposure}set shadowsExposure(s){this._shadowsExposure=s,this._dirty=!0}getClassName(){return"ColorCurves"}static Bind(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vCameraColorCurvePositive",t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vCameraColorCurveNeutral",j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"vCameraColorCurveNegative";s._dirty&&(s._dirty=!1,s._getColorGradingDataToRef(s._globalHue,s._globalDensity,s._globalSaturation,s._globalExposure,s._globalCurve),s._getColorGradingDataToRef(s._highlightsHue,s._highlightsDensity,s._highlightsSaturation,s._highlightsExposure,s._tempColor),s._tempColor.multiplyToRef(s._globalCurve,s._highlightsCurve),s._getColorGradingDataToRef(s._midtonesHue,s._midtonesDensity,s._midtonesSaturation,s._midtonesExposure,s._tempColor),s._tempColor.multiplyToRef(s._globalCurve,s._midtonesCurve),s._getColorGradingDataToRef(s._shadowsHue,s._shadowsDensity,s._shadowsSaturation,s._shadowsExposure,s._tempColor),s._tempColor.multiplyToRef(s._globalCurve,s._shadowsCurve),s._highlightsCurve.subtractToRef(s._midtonesCurve,s._positiveCurve),s._midtonesCurve.subtractToRef(s._shadowsCurve,s._negativeCurve)),Z&&(Z.setFloat4(o,s._positiveCurve.r,s._positiveCurve.g,s._positiveCurve.b,s._positiveCurve.a),Z.setFloat4(t,s._midtonesCurve.r,s._midtonesCurve.g,s._midtonesCurve.b,s._midtonesCurve.a),Z.setFloat4(j,s._negativeCurve.r,s._negativeCurve.g,s._negativeCurve.b,s._negativeCurve.a))}_getColorGradingDataToRef(s,Z,o,t,j){null!=s&&(s=G._Clamp(s,0,360),Z=G._Clamp(Z,-100,100),o=G._Clamp(o,-100,100),t=G._Clamp(t,-100,100),Z=G._ApplyColorGradingSliderNonlinear(Z),Z*=.5,t=G._ApplyColorGradingSliderNonlinear(t),Z<0&&(Z*=-1,s=(s+180)%360),G._FromHSBToRef(s,Z,50+.25*t,j),j.scaleToRef(2,j),j.a=1+.01*o)}static _ApplyColorGradingSliderNonlinear(s){s/=100;let Z=Math.abs(s);return Z=Math.pow(Z,2),s<0&&(Z*=-1),Z*=100,Z}static _FromHSBToRef(s,Z,o,t){let j=G._Clamp(s,0,360);const S=G._Clamp(Z/100,0,1),a=G._Clamp(o/100,0,1);if(0===S)t.r=a,t.g=a,t.b=a;else{j/=60;const s=Math.floor(j),Z=j-s,o=a*(1-S),O=a*(1-S*Z),v=a*(1-S*(1-Z));switch(s){case 0:t.r=a,t.g=v,t.b=o;break;case 1:t.r=O,t.g=a,t.b=o;break;case 2:t.r=o,t.g=a,t.b=v;break;case 3:t.r=o,t.g=O,t.b=a;break;case 4:t.r=v,t.g=o,t.b=a;break;default:t.r=a,t.g=o,t.b=O}}t.a=1}static _Clamp(s,Z,o){return Math.min(Math.max(s,Z),o)}clone(){return O.c.Clone((()=>new G),this)}serialize(){return O.c.Serialize(this)}static Parse(s){return O.c.Parse((()=>new G),s,null,null)}}G.PrepareUniforms=v.e,(0,t.c)([(0,j.K)()],G.prototype,"_globalHue",void 0),(0,t.c)([(0,j.K)()],G.prototype,"_globalDensity",void 0),(0,t.c)([(0,j.K)()],G.prototype,"_globalSaturation",void 0),(0,t.c)([(0,j.K)()],G.prototype,"_globalExposure",void 0),(0,t.c)([(0,j.K)()],G.prototype,"_highlightsHue",void 0),(0,t.c)([(0,j.K)()],G.prototype,"_highlightsDensity",void 0),(0,t.c)([(0,j.K)()],G.prototype,"_highlightsSaturation",void 0),(0,t.c)([(0,j.K)()],G.prototype,"_highlightsExposure",void 0),(0,t.c)([(0,j.K)()],G.prototype,"_midtonesHue",void 0),(0,t.c)([(0,j.K)()],G.prototype,"_midtonesDensity",void 0),(0,t.c)([(0,j.K)()],G.prototype,"_midtonesSaturation",void 0),(0,t.c)([(0,j.K)()],G.prototype,"_midtonesExposure",void 0),O.c._ColorCurvesParser=G.Parse;var B=o(11077),Q=o(11509),D=o(10916);class z{constructor(){this.colorCurves=new G,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=z.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new a.h(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=z.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.outputTextureWidth=0,this.outputTextureHeight=0,this.onUpdateParameters=new S.b}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(s){this._colorCurvesEnabled!==s&&(this._colorCurvesEnabled=s,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(s){this._colorGradingTexture!==s&&(this._colorGradingTexture=s,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(s){this._colorGradingEnabled!==s&&(this._colorGradingEnabled=s,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(s){this._colorGradingWithGreenDepth!==s&&(this._colorGradingWithGreenDepth=s,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(s){this._colorGradingBGR!==s&&(this._colorGradingBGR=s,this._updateParameters())}get exposure(){return this._exposure}set exposure(s){this._exposure!==s&&(this._exposure=s,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(s){this._toneMappingEnabled!==s&&(this._toneMappingEnabled=s,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(s){this._toneMappingType!==s&&(this._toneMappingType=s,this._updateParameters())}get contrast(){return this._contrast}set contrast(s){this._contrast!==s&&(this._contrast=s,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(s){this.vignetteCenterY=s}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(s){this.vignetteCenterX=s}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(s){this._vignetteBlendMode!==s&&(this._vignetteBlendMode=s,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(s){this._vignetteEnabled!==s&&(this._vignetteEnabled=s,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(s){this._ditheringEnabled!==s&&(this._ditheringEnabled=s,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(s){this._ditheringIntensity!==s&&(this._ditheringIntensity=s,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(s){this._skipFinalColorClamp!==s&&(this._skipFinalColorClamp=s,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(s){this._applyByPostProcess!==s&&(this._applyByPostProcess=s,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(s){this._isEnabled!==s&&(this._isEnabled=s,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}prepareDefines(s){if((arguments.length>1&&void 0!==arguments[1]&&arguments[1])!==this.applyByPostProcess||!this._isEnabled)return s.VIGNETTE=!1,s.TONEMAPPING=0,s.CONTRAST=!1,s.EXPOSURE=!1,s.COLORCURVES=!1,s.COLORGRADING=!1,s.COLORGRADING3D=!1,s.DITHER=!1,s.IMAGEPROCESSING=!1,s.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(s.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(s.VIGNETTE=this.vignetteEnabled,s.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===z._VIGNETTEMODE_MULTIPLY,s.VIGNETTEBLENDMODEOPAQUE=!s.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case z.TONEMAPPING_KHR_PBR_NEUTRAL:s.TONEMAPPING=3;break;case z.TONEMAPPING_ACES:s.TONEMAPPING=2;break;default:s.TONEMAPPING=1}else s.TONEMAPPING=0;s.CONTRAST=1!==this.contrast,s.EXPOSURE=1!==this.exposure,s.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,s.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,s.COLORGRADING?s.COLORGRADING3D=this.colorGradingTexture.is3D:s.COLORGRADING3D=!1,s.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,s.SAMPLER3DBGRMAP=this.colorGradingBGR,s.DITHER=this._ditheringEnabled,s.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,s.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,s.IMAGEPROCESSING=s.VIGNETTE||!!s.TONEMAPPING||s.CONTRAST||s.EXPOSURE||s.COLORCURVES||s.COLORGRADING||s.DITHER}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(s,Z){if(this._colorCurvesEnabled&&this.colorCurves&&G.Bind(this.colorCurves,s),this._vignetteEnabled||this._ditheringEnabled){const o=1/(this.outputTextureWidth||s.getEngine().getRenderWidth()),t=1/(this.outputTextureHeight||s.getEngine().getRenderHeight());if(s.setFloat2("vInverseScreenSize",o,t),this._ditheringEnabled&&s.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const j=null!=Z?Z:t/o;let S=Math.tan(.5*this.vignetteCameraFov),a=S*j;const O=Math.sqrt(a*S);a=(0,B.l)(a,O,this.vignetteStretch),S=(0,B.l)(S,O,this.vignetteStretch),s.setFloat4("vignetteSettings1",a,S,-a*this.vignetteCenterX,-S*this.vignetteCenterY);const v=-2*this.vignetteWeight;s.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,v)}}if(s.setFloat("exposureLinear",this.exposure),s.setFloat("contrast",this.contrast),this.colorGradingTexture){s.setTexture("txColorTransform",this.colorGradingTexture);const Z=this.colorGradingTexture.getSize().height;s.setFloat4("colorTransformSettings",(Z-1)/Z,.5/Z,Z,this.colorGradingTexture.level)}}clone(){return O.c.Clone((()=>new z),this)}serialize(){return O.c.Serialize(this)}static Parse(s){const Z=O.c.Parse((()=>new z),s,null,null);return void 0!==s.vignetteCentreX&&(Z.vignetteCenterX=s.vignetteCentreX),void 0!==s.vignetteCentreY&&(Z.vignetteCenterY=s.vignetteCentreY),Z}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}z.TONEMAPPING_STANDARD=0,z.TONEMAPPING_ACES=1,z.TONEMAPPING_KHR_PBR_NEUTRAL=2,z.PrepareUniforms=Q.e,z.PrepareSamplers=Q.d,z._VIGNETTEMODE_MULTIPLY=0,z._VIGNETTEMODE_OPAQUE=1,(0,t.c)([(0,j.f)()],z.prototype,"colorCurves",void 0),(0,t.c)([(0,j.K)()],z.prototype,"_colorCurvesEnabled",void 0),(0,t.c)([(0,j.D)("colorGradingTexture")],z.prototype,"_colorGradingTexture",void 0),(0,t.c)([(0,j.K)()],z.prototype,"_colorGradingEnabled",void 0),(0,t.c)([(0,j.K)()],z.prototype,"_colorGradingWithGreenDepth",void 0),(0,t.c)([(0,j.K)()],z.prototype,"_colorGradingBGR",void 0),(0,t.c)([(0,j.K)()],z.prototype,"_exposure",void 0),(0,t.c)([(0,j.K)()],z.prototype,"_toneMappingEnabled",void 0),(0,t.c)([(0,j.K)()],z.prototype,"_toneMappingType",void 0),(0,t.c)([(0,j.K)()],z.prototype,"_contrast",void 0),(0,t.c)([(0,j.K)()],z.prototype,"vignetteStretch",void 0),(0,t.c)([(0,j.K)()],z.prototype,"vignetteCenterX",void 0),(0,t.c)([(0,j.K)()],z.prototype,"vignetteCenterY",void 0),(0,t.c)([(0,j.K)()],z.prototype,"vignetteWeight",void 0),(0,t.c)([(0,j.j)()],z.prototype,"vignetteColor",void 0),(0,t.c)([(0,j.K)()],z.prototype,"vignetteCameraFov",void 0),(0,t.c)([(0,j.K)()],z.prototype,"_vignetteBlendMode",void 0),(0,t.c)([(0,j.K)()],z.prototype,"_vignetteEnabled",void 0),(0,t.c)([(0,j.K)()],z.prototype,"_ditheringEnabled",void 0),(0,t.c)([(0,j.K)()],z.prototype,"_ditheringIntensity",void 0),(0,t.c)([(0,j.K)()],z.prototype,"_skipFinalColorClamp",void 0),(0,t.c)([(0,j.K)()],z.prototype,"_applyByPostProcess",void 0),(0,t.c)([(0,j.K)()],z.prototype,"_isEnabled",void 0),(0,t.c)([(0,j.K)()],z.prototype,"outputTextureWidth",void 0),(0,t.c)([(0,j.K)()],z.prototype,"outputTextureHeight",void 0),O.c._ImageProcessingConfigurationParser=z.Parse,(0,D.f)("BABYLON.ImageProcessingConfiguration",z)},11598:(s,Z,o)=>{o.d(Z,{d:()=>Q});var t=o(11086),j=o(11081),S=o(11091),a=o(11572),O=o(11548),v=o(11556),G=o(11181);class B extends O.b{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class Q extends v.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(s,"DetailMap",140,new B,Z),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=j.c.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=s._dirtyCallbacks[1]}isReadyForSubMesh(s,Z,o){return!this._isEnabled||!(s._areTexturesDirty&&Z.texturesEnabled&&o.getCaps().standardDerivatives&&this._texture&&a.c.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(s,Z){if(this._isEnabled){s.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const o=Z.getEngine();s._areTexturesDirty&&(o.getCaps().standardDerivatives&&this._texture&&a.c.DetailTextureEnabled&&this._isEnabled?((0,G.G)(this._texture,s,"DETAIL"),s.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):s.DETAIL=!1)}else s.DETAIL=!1}bindForSubMesh(s,Z){if(!this._isEnabled)return;const o=this._material.isFrozen;s.useUbo&&o&&s.isSync||this._texture&&a.c.DetailTextureEnabled&&(s.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),(0,G.l)(this._texture,s,"detail")),Z.texturesEnabled&&this._texture&&a.c.DetailTextureEnabled&&s.setTexture("detailSampler",this._texture)}hasTexture(s){return this._texture===s}getActiveTextures(s){this._texture&&s.push(this._texture)}getAnimatables(s){this._texture&&this._texture.animations&&this._texture.animations.length>0&&s.push(this._texture)}dispose(s){var Z;s&&(null===(Z=this._texture)||void 0===Z||Z.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(s){s.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,t.c)([(0,S.D)("detailTexture"),(0,S.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"texture",void 0),(0,t.c)([(0,S.K)()],Q.prototype,"diffuseBlendLevel",void 0),(0,t.c)([(0,S.K)()],Q.prototype,"roughnessBlendLevel",void 0),(0,t.c)([(0,S.K)()],Q.prototype,"bumpLevel",void 0),(0,t.c)([(0,S.K)(),(0,S.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"normalBlendMethod",void 0),(0,t.c)([(0,S.K)(),(0,S.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"isEnabled",void 0)},11081:(s,Z,o)=>{o.d(Z,{c:()=>f});var t=o(11086),j=o(11091),S=o(10938),a=o(10932),O=o(10927),v=o(11108),G=o(11155),B=o(10955),Q=o(11159),D=o(11151),z=o(11167);class Y{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(s){this._func=s}get funcRef(){return this._funcRef}set funcRef(s){this._funcRef=s}get funcMask(){return this._funcMask}set funcMask(s){this._funcMask=s}get opStencilFail(){return this._opStencilFail}set opStencilFail(s){this._opStencilFail=s}get opDepthFail(){return this._opDepthFail}set opDepthFail(s){this._opDepthFail=s}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(s){this._opStencilDepthPass=s}get mask(){return this._mask}set mask(s){this._mask=s}get enabled(){return this._enabled}set enabled(s){this._enabled=s}getClassName(){return"MaterialStencilState"}copyTo(s){z.c.Clone((()=>s),this)}serialize(){return z.c.Serialize(this)}parse(s,Z,o){z.c.Parse((()=>this),s,Z,o)}}(0,t.c)([(0,j.K)()],Y.prototype,"func",null),(0,t.c)([(0,j.K)()],Y.prototype,"funcRef",null),(0,t.c)([(0,j.K)()],Y.prototype,"funcMask",null),(0,t.c)([(0,j.K)()],Y.prototype,"opStencilFail",null),(0,t.c)([(0,j.K)()],Y.prototype,"opDepthFail",null),(0,t.c)([(0,j.K)()],Y.prototype,"opStencilDepthPass",null),(0,t.c)([(0,j.K)()],Y.prototype,"mask",null),(0,t.c)([(0,j.K)()],Y.prototype,"enabled",null);var b=o(11181);class f{get _supportGlowLayer(){return!1}set _glowModeEnabled(s){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(s){if(this._alpha===s)return;const Z=this._alpha;this._alpha=s,1!==Z&&1!==s||this.dG(f.MiscDirtyFlag+f.PrePassDirtyFlag)}get alpha(){return this._alpha}set Ta(s){this._backFaceCulling!==s&&(this._backFaceCulling=s,this.dG(f.TextureDirtyFlag))}get Ta(){return this._backFaceCulling}set cullBackFaces(s){this._cullBackFaces!==s&&(this._cullBackFaces=s,this.dG(f.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(s){this._blockDirtyMechanism!==s&&(this._blockDirtyMechanism=s,s||this.fQ())}atomicMaterialsUpdate(s){this.blockDirtyMechanism=!0;try{s(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(s){this._onDisposeObserver&&this.jO.remove(this._onDisposeObserver),this._onDisposeObserver=this.jO.add(s)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new a.b),this._onBindObservable}set onBind(s){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(s)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new a.b),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new a.b),this._onEffectCreatedObservable}set alphaMode(s){this._alphaMode!==s&&(this._alphaMode=s,this.dG(f.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(s){this._needDepthPrePass!==s&&(this._needDepthPrePass=s,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(s){this._fogEnabled!==s&&(this._fogEnabled=s,this.dG(f.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case f.WireFrameFillMode:case f.LineListDrawMode:case f.LineLoopDrawMode:case f.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(s){this.fillMode=s?f.WireFrameFillMode:f.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case f.PointFillMode:case f.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(s){this.fillMode=s?f.PointFillMode:f.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(s){this._fillMode!==s&&(this._fillMode=s,this.dG(f.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(s){const Z=this.Ls().getEngine().getCaps().fragmentDepthSupported;s&&!Z&&B.b.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=s&&Z,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(s){this._drawWrapper=s}constructor(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.jO=new a.b,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new Y,this._useUBO=!1,this._fillMode=f.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=s;const j=Z||O.c.LastCreatedScene;j&&(this._scene=j,this._dirtyCallbacks={},this._forceGLSL=t,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=s||S.g.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new D.e(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new G.e(this._scene.getEngine(),void 0,void 0,s),this._useUBO=this.Ls().getEngine().supportsUniformBuffers,this._createUniformBuffer(),o||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),f.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var s;const Z=this.Ls().getEngine();null===(s=this._uniformBuffer)||void 0===s||s.dispose(),Z.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new G.e(Z,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new G.e(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(s){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.fQ(),this.checkReadyOnlyOnce=!0}unfreeze(){this.fQ(),this.checkReadyOnlyOnce=!1}isReady(s,Z){return!0}isReadyForSubMesh(s,Z,o){const t=Z.materialDefines;return!!t&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=t,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}Ls(){return this._scene}_getEffectiveOrientation(s){return null!==this.sideOrientation?this.sideOrientation:s.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(s){this._transparencyMode!==s&&(this._transparencyMode=s,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===f.MATERIAL_ALPHABLEND||this._transparencyMode===f.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===f.MATERIAL_ALPHATEST||this._transparencyMode===f.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===f.MATERIAL_OPAQUE||this._transparencyMode===f.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(s){return this._hasTransparencyMode?this._transparencyModeIsBlend:s.visibility<1||!this._disableAlphaBlending&&(s.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(s){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(s)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}fQ(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Z=this.Ls().meshes;for(const o of Z)if(o.vO)for(const Z of o.vO)if(Z.Ms()===this)for(const o of Z._drawWrappers)o&&this._materialContext===o.materialContext&&(o._wasPreviouslyReady=!1,o._wasPreviouslyUsingInstances=null,o._forceRebindOnNextCall=s);s&&this.dG(f.AllDirtyFlag)}_preBind(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=this._scene.getEngine(),t=(null==Z?this.sideOrientation:Z)===f.ClockWiseSideOrientation;return o.enableEffect(s||this._getDrawWrapper()),o.setState(this.Ta,this.zOffset,!1,t,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),t}bind(s,Z){}buildUniformLayout(){const s=this._uniformBuffer;this._eventInfo.ubo=s,this._callbackPluginEventGeneric(8,this._eventInfo),s.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(s,Z,o){const t=o._drawWrapper;this._eventInfo.subMesh=o,this._callbackPluginEventBindForSubMesh(this._eventInfo),t._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(s){}bindView(s){this._useUBO?this._needToBindSceneUbo=!0:s.setMatrix("view",this.Ls().getViewMatrix())}bindViewProjection(s){this._useUBO?this._needToBindSceneUbo=!0:(s.setMatrix("viewProjection",this.Ls().getTransformMatrix()),s.setMatrix("projection",this.Ls().getProjectionMatrix()))}bindEyePosition(s,Z){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(s,Z)}_afterBind(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&Z&&(this._needToBindSceneUbo=!1,(0,b.k)(Z,this.Ls().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=s?s.visibility:1,this._onBindObservable&&s&&this._onBindObservable.notifyObservers(s),this.disableDepthWrite){const s=this._scene.getEngine();this._cachedDepthWriteState=s.getDepthWrite(),s.setDepthWrite(!1)}if(this.disableColorWrite){const s=this._scene.getEngine();this._cachedColorWriteState=s.getColorWrite(),s.setColorWrite(!1)}if(0!==this.depthFunction){const s=this._scene.getEngine();this._cachedDepthFunctionState=s.getDepthFunction()||0,s.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(s){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=s,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(s){return null}_clonePlugins(s,Z){const o={};if(this._serializePlugins(o),f._ParsePlugins(o,s,this._scene,Z),this.pluginManager)for(const t of this.pluginManager._plugins){const Z=s.pluginManager.getPlugin(t.name);Z&&t.copyTo(Z)}}getBindedMeshes(){if(this.meshMap){const s=[];for(const Z in this.meshMap){const o=this.meshMap[Z];o&&s.push(o)}return s}return this._scene.meshes.filter((s=>s.material===this))}forceCompilation(s,Z,o,t){const j={clipPlane:!1,useInstances:!1,...o},S=this.Ls(),a=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const O=()=>{if(!this._scene||!this._scene.getEngine())return;const o=S.clipPlane;if(j.clipPlane&&(S.clipPlane=new Q.b(0,0,0,1)),this._storeEffectOnSubMeshes){let o=!0,S=null;if(s.vO){const Z=new v.b(0,0,0,0,0,s,void 0,!1,!1);Z.materialDefines&&(Z.materialDefines._renderId=-1),this.isReadyForSubMesh(s,Z,j.useInstances)||(Z.effect&&Z.effect.getCompilationError()&&Z.effect.allFallbacksProcessed()?S=Z.effect.getCompilationError():(o=!1,setTimeout(O,16)))}o&&(this.allowShaderHotSwapping=a,S&&t&&t(S),Z&&Z(this))}else this.isReady()?(this.allowShaderHotSwapping=a,Z&&Z(this)):setTimeout(O,16);j.clipPlane&&(S.clipPlane=o)};O()}async forceCompilationAsync(s,Z){return await new Promise(((o,t)=>{this.forceCompilation(s,(()=>{o()}),Z,(s=>{t(s)}))}))}dG(s){this.Ls().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(f._DirtyCallbackArray.length=0,s&f.ImageProcessingDirtyFlag&&f._DirtyCallbackArray.push(f._ImageProcessingDirtyCallBack),s&f.TextureDirtyFlag&&f._DirtyCallbackArray.push(f._TextureDirtyCallBack),s&f.LightDirtyFlag&&f._DirtyCallbackArray.push(f._LightsDirtyCallBack),s&f.FresnelDirtyFlag&&f._DirtyCallbackArray.push(f._FresnelDirtyCallBack),s&f.AttributesDirtyFlag&&f._DirtyCallbackArray.push(f._AttributeDirtyCallBack),s&f.MiscDirtyFlag&&f._DirtyCallbackArray.push(f._MiscDirtyCallBack),s&f.PrePassDirtyFlag&&f._DirtyCallbackArray.push(f._PrePassDirtyCallBack),f._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(f._RunDirtyCallBacks),this.Ls().resetCachedMaterial())}resetDrawCache(){const s=this.Ls().meshes;for(const Z of s)if(Z.vO)for(const s of Z.vO)s.Ms()===this&&s.resetDrawCache()}_markAllSubMeshesAsDirty(s){const Z=this.Ls();if(Z.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const o=Z.meshes;for(const t of o)if(t.vO)for(const o of t.vO){if((o.Ms()||(Z._hasDefaultMaterial?Z.defaultMaterial:null))===this)for(const Z of o._drawWrappers)Z&&Z.defines&&Z.defines.markAllAsDirty&&this._materialContext===Z.materialContext&&s(Z.defines)}}_markScenePrePassDirty(){if(this.Ls().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const s=this.Ls().enablePrePassRenderer();s&&s.dG()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(f._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(f._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(f._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(f._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(f._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(f._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(f._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(f._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(f._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(f._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const s=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.jO.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(s)}))}}setPrePassRenderer(s){return!1}dispose(s,Z,o){const t=this.Ls();if(t.stopAnimation(this),t.freeProcessedMaterials(),t.removeMaterial(this),this._eventInfo.forceDisposeTextures=Z,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const s=this._parentContainer.materials.indexOf(this);s>-1&&this._parentContainer.materials.splice(s,1),this._parentContainer=null}if(!0!==o)if(this.meshMap)for(const j in this.meshMap){const s=this.meshMap[j];this._disposeMeshResources(s)}else{const s=t.meshes;for(const Z of s)this._disposeMeshResources(Z)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.jO.notifyObservers(this),this.jO.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(s){if(!s)return;const Z=s.Pa,o=s._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(s.vO&&o)for(const j of s.vO){const s=j._drawWrappers;for(let S=0;S<s.length;S++){var t;const a=null===(t=s[S])||void 0===t?void 0:t.effect;if(!a)continue;o[S]===this&&(null===Z||void 0===Z||Z._releaseVertexArrayObject(a),j._removeDrawWrapper(S,!0,!0))}}}else null===Z||void 0===Z||Z._releaseVertexArrayObject(this._drawWrapper.effect);s.material!==this||s.sourceMesh||(s.material=null)}serialize(){const s=z.c.Serialize(this);return s.stencil=this.stencil.serialize(),s.uniqueId=this.uniqueId,this._serializePlugins(s),s}_serializePlugins(s){if(s.plugins={},this.pluginManager)for(const Z of this.pluginManager._plugins)Z.doNotSerialize||(s.plugins[Z.getClassName()]=Z.serialize())}static Parse(s,Z,o){if(s.customType){if("BABYLON.PBRMaterial"===s.customType&&s.overloadedAlbedo&&(s.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return B.b.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else s.customType="BABYLON.StandardMaterial";const t=S.g.Instantiate(s.customType).Parse(s,Z,o);return t._loadedUniqueId=s.uniqueId,t}static _ParsePlugins(s,Z,o,t){if(s.plugins)for(const O in s.plugins){var j,a;const v=s.plugins[O];let G=null===(j=Z.pluginManager)||void 0===j?void 0:j.getPlugin(v.name);if(!G){const s=S.g.Instantiate("BABYLON."+O);s&&(G=new s(Z))}null===(a=G)||void 0===a||a.parse(v,o,t)}}}f.TriangleFillMode=0,f.WireFrameFillMode=1,f.PointFillMode=2,f.PointListDrawMode=3,f.LineListDrawMode=4,f.LineLoopDrawMode=5,f.LineStripDrawMode=6,f.TriangleStripDrawMode=7,f.TriangleFanDrawMode=8,f.ClockWiseSideOrientation=0,f.CounterClockWiseSideOrientation=1,f.ImageProcessingDirtyFlag=64,f.TextureDirtyFlag=1,f.LightDirtyFlag=2,f.FresnelDirtyFlag=4,f.AttributesDirtyFlag=8,f.MiscDirtyFlag=16,f.PrePassDirtyFlag=32,f.AllDirtyFlag=127,f.MATERIAL_OPAQUE=0,f.MATERIAL_ALPHATEST=1,f.MATERIAL_ALPHABLEND=2,f.MATERIAL_ALPHATESTANDBLEND=3,f.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,f.MATERIAL_NORMALBLENDMETHOD_RNM=1,f.OnEventObservable=new a.b,f._AllDirtyCallBack=s=>s.markAllAsDirty(),f._ImageProcessingDirtyCallBack=s=>s.markAsImageProcessingDirty(),f._TextureDirtyCallBack=s=>s.markAsTexturesDirty(),f._FresnelDirtyCallBack=s=>s.markAsFresnelDirty(),f._MiscDirtyCallBack=s=>s.markAsMiscDirty(),f._PrePassDirtyCallBack=s=>s.markAsPrePassDirty(),f._LightsDirtyCallBack=s=>s.markAsLightDirty(),f._AttributeDirtyCallBack=s=>s.markAsAttributesDirty(),f._FresnelAndMiscDirtyCallBack=s=>{f._FresnelDirtyCallBack(s),f._MiscDirtyCallBack(s)},f._TextureAndMiscDirtyCallBack=s=>{f._TextureDirtyCallBack(s),f._MiscDirtyCallBack(s)},f._DirtyCallbackArray=[],f._RunDirtyCallBacks=s=>{for(const Z of f._DirtyCallbackArray)Z(s)},(0,t.c)([(0,j.K)()],f.prototype,"id",void 0),(0,t.c)([(0,j.K)()],f.prototype,"uniqueId",void 0),(0,t.c)([(0,j.K)()],f.prototype,"name",void 0),(0,t.c)([(0,j.K)()],f.prototype,"metadata",void 0),(0,t.c)([(0,j.K)()],f.prototype,"checkReadyOnEveryCall",void 0),(0,t.c)([(0,j.K)()],f.prototype,"checkReadyOnlyOnce",void 0),(0,t.c)([(0,j.K)()],f.prototype,"state",void 0),(0,t.c)([(0,j.K)("alpha")],f.prototype,"_alpha",void 0),(0,t.c)([(0,j.K)("Ta")],f.prototype,"_backFaceCulling",void 0),(0,t.c)([(0,j.K)("cullBackFaces")],f.prototype,"_cullBackFaces",void 0),(0,t.c)([(0,j.K)()],f.prototype,"sideOrientation",void 0),(0,t.c)([(0,j.K)("alphaMode")],f.prototype,"_alphaMode",void 0),(0,t.c)([(0,j.K)()],f.prototype,"_needDepthPrePass",void 0),(0,t.c)([(0,j.K)()],f.prototype,"disableDepthWrite",void 0),(0,t.c)([(0,j.K)()],f.prototype,"disableColorWrite",void 0),(0,t.c)([(0,j.K)()],f.prototype,"forceDepthWrite",void 0),(0,t.c)([(0,j.K)()],f.prototype,"depthFunction",void 0),(0,t.c)([(0,j.K)()],f.prototype,"separateCullingPass",void 0),(0,t.c)([(0,j.K)("fogEnabled")],f.prototype,"_fogEnabled",void 0),(0,t.c)([(0,j.K)()],f.prototype,"pointSize",void 0),(0,t.c)([(0,j.K)()],f.prototype,"zOffset",void 0),(0,t.c)([(0,j.K)()],f.prototype,"zOffsetUnits",void 0),(0,t.c)([(0,j.K)()],f.prototype,"pointsCloud",null),(0,t.c)([(0,j.K)()],f.prototype,"fillMode",null),(0,t.c)([(0,j.K)()],f.prototype,"useLogarithmicDepth",null),(0,t.c)([(0,j.K)()],f.prototype,"transparencyMode",null)},11548:(s,Z,o)=>{o.d(Z,{b:()=>t});class t{constructor(s){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=s,s)for(const Z in s)Object.prototype.hasOwnProperty.call(s,Z)&&this._setDefaultValue(Z)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||s,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const s of Object.keys(this))"_"!==s[0]&&this._keys.push(s);if(this._externalProperties)for(const s in this._externalProperties)-1===this._keys.indexOf(s)&&this._keys.push(s)}isEqual(s){if(this._keys.length!==s._keys.length)return!1;for(let Z=0;Z<this._keys.length;Z++){const o=this._keys[Z];if(this[o]!==s[o])return!1}return!0}cloneTo(s){this._keys.length!==s._keys.length&&(s._keys=this._keys.slice(0));for(let Z=0;Z<this._keys.length;Z++){const o=this._keys[Z];s[o]=this[o]}}reset(){for(const s of this._keys)this._setDefaultValue(s)}_setDefaultValue(s){var Z,o,t,j;const S=(null===(Z=this._externalProperties)||void 0===Z||null===(o=Z[s])||void 0===o?void 0:o.type)??typeof this[s],a=null===(t=this._externalProperties)||void 0===t||null===(j=t[s])||void 0===j?void 0:j.default;switch(S){case"number":this[s]=a??0;break;case"string":this[s]=a??"";break;default:this[s]=a??!1}}toString(){let s="";for(let Z=0;Z<this._keys.length;Z++){const o=this._keys[Z],t=this[o];switch(typeof t){case"number":case"string":s+="#define "+o+" "+t+"\n";break;default:t&&(s+="#define "+o+"\n")}}return s}}},11572:(s,Z,o)=>{o.d(Z,{c:()=>j});var t=o(11013);class j{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(s){this._DiffuseTextureEnabled!==s&&(this._DiffuseTextureEnabled=s,t.e.MarkAllMaterialsAsDirty(1))}static get BaseWeightTextureEnabled(){return this._BaseWeightTextureEnabled}static set BaseWeightTextureEnabled(s){this._BaseWeightTextureEnabled!==s&&(this._BaseWeightTextureEnabled=s,t.e.MarkAllMaterialsAsDirty(1))}static get BaseDiffuseRoughnessTextureEnabled(){return this._BaseDiffuseRoughnessTextureEnabled}static set BaseDiffuseRoughnessTextureEnabled(s){this._BaseDiffuseRoughnessTextureEnabled!==s&&(this._BaseDiffuseRoughnessTextureEnabled=s,t.e.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(s){this._DetailTextureEnabled!==s&&(this._DetailTextureEnabled=s,t.e.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(s){this._DecalMapEnabled!==s&&(this._DecalMapEnabled=s,t.e.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(s){this._AmbientTextureEnabled!==s&&(this._AmbientTextureEnabled=s,t.e.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(s){this._OpacityTextureEnabled!==s&&(this._OpacityTextureEnabled=s,t.e.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(s){this._ReflectionTextureEnabled!==s&&(this._ReflectionTextureEnabled=s,t.e.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(s){this._EmissiveTextureEnabled!==s&&(this._EmissiveTextureEnabled=s,t.e.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(s){this._SpecularTextureEnabled!==s&&(this._SpecularTextureEnabled=s,t.e.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(s){this._BumpTextureEnabled!==s&&(this._BumpTextureEnabled=s,t.e.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(s){this._LightmapTextureEnabled!==s&&(this._LightmapTextureEnabled=s,t.e.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(s){this._RefractionTextureEnabled!==s&&(this._RefractionTextureEnabled=s,t.e.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(s){this._ColorGradingTextureEnabled!==s&&(this._ColorGradingTextureEnabled=s,t.e.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(s){this._FresnelEnabled!==s&&(this._FresnelEnabled=s,t.e.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(s){this._ClearCoatTextureEnabled!==s&&(this._ClearCoatTextureEnabled=s,t.e.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(s){this._ClearCoatBumpTextureEnabled!==s&&(this._ClearCoatBumpTextureEnabled=s,t.e.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(s){this._ClearCoatTintTextureEnabled!==s&&(this._ClearCoatTintTextureEnabled=s,t.e.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(s){this._SheenTextureEnabled!==s&&(this._SheenTextureEnabled=s,t.e.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(s){this._AnisotropicTextureEnabled!==s&&(this._AnisotropicTextureEnabled=s,t.e.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(s){this._ThicknessTextureEnabled!==s&&(this._ThicknessTextureEnabled=s,t.e.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(s){this._RefractionIntensityTextureEnabled!==s&&(this._RefractionIntensityTextureEnabled=s,t.e.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(s){this._TranslucencyIntensityTextureEnabled!==s&&(this._TranslucencyIntensityTextureEnabled=s,t.e.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(s){this._TranslucencyColorTextureEnabled!==s&&(this._TranslucencyColorTextureEnabled=s,t.e.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(s){this._IridescenceTextureEnabled!==s&&(this._IridescenceTextureEnabled=s,t.e.MarkAllMaterialsAsDirty(1))}}j._DiffuseTextureEnabled=!0,j._BaseWeightTextureEnabled=!0,j._BaseDiffuseRoughnessTextureEnabled=!0,j._DetailTextureEnabled=!0,j._DecalMapEnabled=!0,j._AmbientTextureEnabled=!0,j._OpacityTextureEnabled=!0,j._ReflectionTextureEnabled=!0,j._EmissiveTextureEnabled=!0,j._SpecularTextureEnabled=!0,j._BumpTextureEnabled=!0,j._LightmapTextureEnabled=!0,j._RefractionTextureEnabled=!0,j._ColorGradingTextureEnabled=!0,j._FresnelEnabled=!0,j._ClearCoatTextureEnabled=!0,j._ClearCoatBumpTextureEnabled=!0,j._ClearCoatTintTextureEnabled=!0,j._SheenTextureEnabled=!0,j._AnisotropicTextureEnabled=!0,j._ThicknessTextureEnabled=!0,j._RefractionIntensityTextureEnabled=!0,j._TranslucencyIntensityTextureEnabled=!0,j._TranslucencyColorTextureEnabled=!0,j._IridescenceTextureEnabled=!0},11181:(s,Z,o)=>{o.d(Z,{B:()=>R,C:()=>g,G:()=>A,I:()=>V,L:()=>c,N:()=>w,Q:()=>X,U:()=>q,W:()=>Y,b:()=>u,e:()=>Q,g:()=>F,h:()=>B,j:()=>b,k:()=>f,l:()=>d,m:()=>L,n:()=>U,q:()=>i,s:()=>N,v:()=>z,x:()=>D,z:()=>e});var t=o(10955),j=o(11174),S=o(10927),a=o(11187),O=o(11189);const v=j.d.Black(),G={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function B(s,Z,o){if(!s||s.LOGARITHMICDEPTH||s.indexOf&&s.indexOf("LOGARITHMICDEPTH")>=0){const s=o.activeCamera;1===s.mode&&t.b.Error("Logarithmic depth is not compatible with orthographic cameras!",20),Z.setFloat("logarithmicDepthConstant",2/(Math.log(s.maxZ+1)/Math.LN2))}}function Q(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3];o&&s.fogEnabled&&(!Z||Z.applyFog)&&0!==s.fogMode&&(o.setFloat4("vFogInfos",s.fogMode,s.fogStart,s.fogEnd,s.fogDensity),t?(s.fogColor.toLinearSpaceToRef(v,s.getEngine().useExactSrgbConversions),o.setColor3("vFogColor",v)):o.setColor3("vFogColor",s.fogColor))}function D(s,Z,o,t,j,S,a,O,v,B){const Q=s.numMaxInfluencers||s.numInfluencers;return Q<=0?0:(Z.push("#define MORPHTARGETS"),s.hasPositions&&Z.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),s.hasNormals&&Z.push("#define MORPHTARGETTEXTURE_HASNORMALS"),s.hasTangents&&Z.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),s.hasUVs&&Z.push("#define MORPHTARGETTEXTURE_HASUVS"),s.hasUV2s&&Z.push("#define MORPHTARGETTEXTURE_HASUV2S"),s.hasColors&&Z.push("#define MORPHTARGETTEXTURE_HASCOLORS"),s.supportsPositions&&j&&Z.push("#define MORPHTARGETS_POSITION"),s.supportsNormals&&S&&Z.push("#define MORPHTARGETS_NORMAL"),s.supportsTangents&&a&&Z.push("#define MORPHTARGETS_TANGENT"),s.supportsUVs&&O&&Z.push("#define MORPHTARGETS_UV"),s.supportsUV2s&&v&&Z.push("#define MORPHTARGETS_UV2"),s.supportsColors&&B&&Z.push("#define MORPHTARGETS_COLOR"),Z.push("#define NUM_MORPH_INFLUENCERS "+Q),s.isUsingTextureForTargets&&Z.push("#define MORPHTARGETS_TEXTURE"),G.NUM_MORPH_INFLUENCERS=Q,G.NORMAL=S,G.TANGENT=a,G.UV=O,G.UV2=v,G.COLOR=B,z(o,t,G,j),Q)}function z(s,Z,o){let j=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const a=o.NUM_MORPH_INFLUENCERS;if(a>0&&S.c.LastCreatedEngine){const O=S.c.LastCreatedEngine.getCaps().maxVertexAttribs,v=Z.morphTargetManager;if(null!==v&&void 0!==v&&v.isUsingTextureForTargets)return;const G=v&&v.supportsPositions&&j,B=v&&v.supportsNormals&&o.NORMAL,Q=v&&v.supportsTangents&&o.TANGENT,D=v&&v.supportsUVs&&o.UV1,z=v&&v.supportsUV2s&&o.UV2,Y=v&&v.supportsColors&&o.VERTEXCOLOR;for(let o=0;o<a;o++)G&&s.push("position"+o),B&&s.push("normal"+o),Q&&s.push("tangent"+o),D&&s.push("uv_"+o),z&&s.push("uv2_"+o),Y&&s.push("color"+o),s.length>O&&t.b.Error("Cannot add more vertex attributes for mesh "+Z.name)}}function Y(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];s.push("world0"),s.push("world1"),s.push("world2"),s.push("world3"),Z&&(s.push("previousWorld0"),s.push("previousWorld1"),s.push("previousWorld2"),s.push("previousWorld3"))}function b(s,Z){const o=s.morphTargetManager;s&&o&&Z.setFloatArray("morphTargetInfluences",o.influences)}function f(s,Z){Z.bindToEffect(s,"Scene")}function A(s,Z,o){Z._needUVs=!0,Z[o]=!0,s.optimizeUVAllocation&&s.getTextureMatrix().isIdentityAs3x2()?(Z[o+"DIRECTUV"]=s.coordinatesIndex+1,Z["MAINUV"+(s.coordinatesIndex+1)]=!0):Z[o+"DIRECTUV"]=0}function d(s,Z,o){const t=s.getTextureMatrix();Z.SO(o+"Matrix",t)}function U(s,Z,o){o.BAKED_VERTEX_ANIMATION_TEXTURE&&o.INSTANCES&&s.push("bakedVertexAnimationSettingsInstanced")}function u(s,Z,o){var t;if(Z&&s&&(s.computeBonesUsingShaders&&Z._bonesComputationForcedToCPU&&(s.computeBonesUsingShaders=!1),s.useBones&&s.computeBonesUsingShaders&&s.skeleton)){const j=s.skeleton;if(j.isUsingTextureForMatrices&&Z.getUniformIndex("boneTextureWidth")>-1){const o=j.getTransformMatrixTexture(s);Z.setTexture("boneSampler",o),Z.setFloat("boneTextureWidth",4*(j.bones.length+1))}else{const S=j.getTransformMatrices(s);S&&(Z.setMatrices("mBones",S),o&&s.Ls().prePassRenderer&&s.Ls().prePassRenderer.getIndex(2)&&(o.previousBones[s.uniqueId]||(o.previousBones[s.uniqueId]=S.slice()),Z.setMatrices("mPreviousBones",o.previousBones[s.uniqueId]),t=S,o.previousBones[s.uniqueId].set(t)))}}}function H(s,Z,o,t,j){let S=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];s._bindLight(Z,o,t,j,S)}function F(s,Z,o,t){let j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const S=Math.min(Z.lightSources.length,j);for(let a=0;a<S;a++){H(Z.lightSources[a],a,s,o,"boolean"===typeof t?t:t.SPECULARTERM,Z.receiveShadows)}}function i(s,Z,o,t){o.NUM_BONE_INFLUENCERS>0&&(t.addCPUSkinningFallback(0,Z),s.push("matricesIndices"),s.push("matricesWeights"),o.NUM_BONE_INFLUENCERS>4&&(s.push("matricesIndicesExtra"),s.push("matricesWeightsExtra")))}function N(s,Z){(Z.INSTANCES||Z.THIN_INSTANCES)&&Y(s,!!Z.PREPASS_VELOCITY),Z.INSTANCESCOLOR&&s.push("instanceColor")}function L(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,j=0;for(let S=0;S<o&&s["LIGHT"+S];S++)S>0&&(j=t+S,Z.addFallback(j,"LIGHT"+S)),s.SHADOWS||(s["SHADOW"+S]&&Z.addFallback(t,"SHADOW"+S),s["SHADOWPCF"+S]&&Z.addFallback(t,"SHADOWPCF"+S),s["SHADOWPCSS"+S]&&Z.addFallback(t,"SHADOWPCSS"+S),s["SHADOWPOISSON"+S]&&Z.addFallback(t,"SHADOWPOISSON"+S),s["SHADOWESM"+S]&&Z.addFallback(t,"SHADOWESM"+S),s["SHADOWCLOSEESM"+S]&&Z.addFallback(t,"SHADOWCLOSEESM"+S));return j++}function V(s,Z,o,t,j,S,a){let O=arguments.length>7&&void 0!==arguments[7]&&arguments[7];a._areMiscDirty&&(a.LOGARITHMICDEPTH=o,a.POINTSIZE=t,a.FOG=j&&function(s,Z){return Z.fogEnabled&&s.applyFog&&0!==Z.fogMode}(s,Z),a.NONUNIFORMSCALING=s.nonUniformScaling,a.ALPHATEST=S,a.DECAL_AFTER_DETAIL=O)}function g(s,Z,o,t){let j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,S=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!o._areLightsDirty)return o._needNormals;let a=0;const O={needNormals:o._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(s.lightsEnabled&&!S)for(const G of Z.lightSources)if(l(s,Z,G,a,o,t,O),a++,a===j)break;o.SPECULARTERM=O.specularEnabled,o.SHADOWS=O.shadowEnabled;for(let G=a;G<j;G++)void 0!==o["LIGHT"+G]&&(o["LIGHT"+G]=!1,o["HEMILIGHT"+G]=!1,o["POINTLIGHT"+G]=!1,o["DIRLIGHT"+G]=!1,o["SPOTLIGHT"+G]=!1,o["AREALIGHT"+G]=!1,o["SHADOW"+G]=!1,o["SHADOWCSM"+G]=!1,o["SHADOWCSMDEBUG"+G]=!1,o["SHADOWCSMNUM_CASCADES"+G]=!1,o["SHADOWCSMUSESHADOWMAXZ"+G]=!1,o["SHADOWCSMNOBLEND"+G]=!1,o["SHADOWCSM_RIGHTHANDED"+G]=!1,o["SHADOWPCF"+G]=!1,o["SHADOWPCSS"+G]=!1,o["SHADOWPOISSON"+G]=!1,o["SHADOWESM"+G]=!1,o["SHADOWCLOSEESM"+G]=!1,o["SHADOWCUBE"+G]=!1,o["SHADOWLOWQUALITY"+G]=!1,o["SHADOWMEDIUMQUALITY"+G]=!1);const v=s.getEngine().getCaps();return void 0===o.SHADOWFLOAT&&(O.needRebuild=!0),o.SHADOWFLOAT=O.shadowEnabled&&(v.textureFloatRender&&v.textureFloatLinearFiltering||v.textureHalfFloatRender&&v.textureHalfFloatLinearFiltering),o.LIGHTMAPEXCLUDED=O.lightmapMode,O.needRebuild&&o.rebuild(),O.needNormals}function l(s,Z,o,t,j,S,O){switch(O.needNormals=!0,void 0===j["LIGHT"+t]&&(O.needRebuild=!0),j["LIGHT"+t]=!0,j["SPOTLIGHT"+t]=!1,j["HEMILIGHT"+t]=!1,j["POINTLIGHT"+t]=!1,j["DIRLIGHT"+t]=!1,j["AREALIGHT"+t]=!1,o.prepareLightSpecificDefines(j,t),j["LIGHT_FALLOFF_PHYSICAL"+t]=!1,j["LIGHT_FALLOFF_GLTF"+t]=!1,j["LIGHT_FALLOFF_STANDARD"+t]=!1,o.falloffType){case a.b.FALLOFF_GLTF:j["LIGHT_FALLOFF_GLTF"+t]=!0;break;case a.b.FALLOFF_PHYSICAL:j["LIGHT_FALLOFF_PHYSICAL"+t]=!0;break;case a.b.FALLOFF_STANDARD:j["LIGHT_FALLOFF_STANDARD"+t]=!0}if(S&&!o.CG.equalsFloats(0,0,0)&&(O.specularEnabled=!0),j["SHADOW"+t]=!1,j["SHADOWCSM"+t]=!1,j["SHADOWCSMDEBUG"+t]=!1,j["SHADOWCSMNUM_CASCADES"+t]=!1,j["SHADOWCSMUSESHADOWMAXZ"+t]=!1,j["SHADOWCSMNOBLEND"+t]=!1,j["SHADOWCSM_RIGHTHANDED"+t]=!1,j["SHADOWPCF"+t]=!1,j["SHADOWPCSS"+t]=!1,j["SHADOWPOISSON"+t]=!1,j["SHADOWESM"+t]=!1,j["SHADOWCLOSEESM"+t]=!1,j["SHADOWCUBE"+t]=!1,j["SHADOWLOWQUALITY"+t]=!1,j["SHADOWMEDIUMQUALITY"+t]=!1,Z&&Z.receiveShadows&&s.shadowsEnabled&&o.shadowEnabled){const Z=o.getShadowGenerator(s.activeCamera)??o.getShadowGenerator();if(Z){const s=Z.getShadowMap();s&&s.renderList&&s.renderList.length>0&&(O.shadowEnabled=!0,Z.prepareDefines(j,t))}}o.lightmapMode!=a.b.LIGHTMAP_DEFAULT?(O.lightmapMode=!0,j["LIGHTMAPEXCLUDED"+t]=!0,j["LIGHTMAPNOSPECULAR"+t]=o.lightmapMode==a.b.LIGHTMAP_SHADOWSONLY):(j["LIGHTMAPEXCLUDED"+t]=!1,j["LIGHTMAPNOSPECULAR"+t]=!1)}function R(s,Z,o,t,j){let S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],v=function(s,Z){let o=!1;if(s.activeCamera){const t=Z.CAMERA_ORTHOGRAPHIC?1:0,j=Z.CAMERA_PERSPECTIVE?1:0,S=1===s.activeCamera.mode?1:0,a=0===s.activeCamera.mode?1:0;(t^S||j^a)&&(Z.CAMERA_ORTHOGRAPHIC=1===S,Z.CAMERA_PERSPECTIVE=1===a,o=!0)}return o}(s,t);!1!==S&&(v=(0,O.h)(o,s,t)),t.DEPTHPREPASS!==!Z.getColorWrite()&&(t.DEPTHPREPASS=!t.DEPTHPREPASS,v=!0),t.INSTANCES!==j&&(t.INSTANCES=j,v=!0),t.THIN_INSTANCES!==a&&(t.THIN_INSTANCES=a,v=!0),v&&t.markAsUnprocessed()}function e(s,Z,o,t){let j=arguments.length>4&&void 0!==arguments[4]&&arguments[4],S=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!Z._areAttributesDirty&&Z._needNormals===Z._normals&&Z._needUVs===Z._uvs)return!1;Z._normals=Z._needNormals,Z._uvs=Z._needUVs,Z.NORMAL=Z._needNormals&&s.isVerticesDataPresent("normal"),Z._needNormals&&s.isVerticesDataPresent("tangent")&&(Z.TANGENT=!0);for(let O=1;O<=6;++O)Z["UV"+O]=!!Z._needUVs&&s.isVerticesDataPresent(`uv${1===O?"":O}`);if(o){const o=s.useVertexColors&&s.isVerticesDataPresent("color");Z.VERTEXCOLOR=o,Z.VERTEXALPHA=s.hasVertexAlpha&&o&&S}return s.isVerticesDataPresent("instanceColor")&&(s.hasInstances||s.hasThinInstances)&&(Z.INSTANCESCOLOR=!0),t&&function(s,Z){if(s.useBones&&s.computeBonesUsingShaders&&s.skeleton){Z.NUM_BONE_INFLUENCERS=s.numBoneInfluencers;const o=void 0!==Z.BONETEXTURE;if(s.skeleton.isUsingTextureForMatrices&&o)Z.BONETEXTURE=!0;else{Z.BonesPerMesh=s.skeleton.bones.length+1,Z.BONETEXTURE=!o&&void 0;const t=s.Ls().prePassRenderer;if(t&&t.enabled){const o=-1===t.excludedSkinnedMesh.indexOf(s);Z.BONES_VELOCITY_ENABLED=o}}}else Z.NUM_BONE_INFLUENCERS=0,Z.BonesPerMesh=0,void 0!==Z.BONETEXTURE&&(Z.BONETEXTURE=!1)}(s,Z),j&&function(s,Z){const o=s.morphTargetManager;o?(Z.MORPHTARGETS_UV=o.supportsUVs&&Z.UV1,Z.MORPHTARGETS_UV2=o.supportsUV2s&&Z.UV2,Z.MORPHTARGETS_TANGENT=o.supportsTangents&&Z.TANGENT,Z.MORPHTARGETS_NORMAL=o.supportsNormals&&Z.NORMAL,Z.MORPHTARGETS_POSITION=o.supportsPositions,Z.MORPHTARGETS_COLOR=o.supportsColors,Z.MORPHTARGETTEXTURE_HASUVS=o.hasUVs,Z.MORPHTARGETTEXTURE_HASUV2S=o.hasUV2s,Z.MORPHTARGETTEXTURE_HASTANGENTS=o.hasTangents,Z.MORPHTARGETTEXTURE_HASNORMALS=o.hasNormals,Z.MORPHTARGETTEXTURE_HASPOSITIONS=o.hasPositions,Z.MORPHTARGETTEXTURE_HASCOLORS=o.hasColors,Z.NUM_MORPH_INFLUENCERS=o.numMaxInfluencers||o.numInfluencers,Z.MORPHTARGETS=Z.NUM_MORPH_INFLUENCERS>0,Z.MORPHTARGETS_TEXTURE=o.isUsingTextureForTargets):(Z.MORPHTARGETS_UV=!1,Z.MORPHTARGETS_UV2=!1,Z.MORPHTARGETS_TANGENT=!1,Z.MORPHTARGETS_NORMAL=!1,Z.MORPHTARGETS_POSITION=!1,Z.MORPHTARGETS_COLOR=!1,Z.MORPHTARGETTEXTURE_HASUVS=!1,Z.MORPHTARGETTEXTURE_HASUV2S=!1,Z.MORPHTARGETTEXTURE_HASTANGENTS=!1,Z.MORPHTARGETTEXTURE_HASNORMALS=!1,Z.MORPHTARGETTEXTURE_HASPOSITIONS=!1,Z.MORPHTARGETTEXTURE_HAS_COLORS=!1,Z.MORPHTARGETS=!1,Z.NUM_MORPH_INFLUENCERS=0)}(s,Z),a&&function(s,Z){const o=s.bakedVertexAnimationManager;Z.BAKED_VERTEX_ANIMATION_TEXTURE=!(!o||!o.isEnabled)}(s,Z),!0}function c(s,Z){if(s.activeCamera){const o=Z.MULTIVIEW;Z.MULTIVIEW=null!==s.activeCamera.outputRenderTarget&&s.activeCamera.outputRenderTarget.getViewCount()>1,Z.MULTIVIEW!=o&&Z.markAsUnprocessed()}}function w(s,Z,o){const t=Z.ORDER_INDEPENDENT_TRANSPARENCY,j=Z.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;Z.ORDER_INDEPENDENT_TRANSPARENCY=s.useOrderIndependentTransparency&&o,Z.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!s.getEngine().getCaps().textureFloatLinearFiltering,t===Z.ORDER_INDEPENDENT_TRANSPARENCY&&j===Z.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||Z.markAsUnprocessed()}function X(s,Z,o){const t=Z.PREPASS;if(!Z._arePrePassDirty)return;const j=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(s.prePassRenderer&&s.prePassRenderer.enabled&&o){Z.PREPASS=!0,Z.SCENE_MRT_COUNT=s.prePassRenderer.mrtCount,Z.PREPASS_NORMAL_WORLDSPACE=s.prePassRenderer.generateNormalsInWorldSpace,Z.PREPASS_COLOR=!0,Z.PREPASS_COLOR_INDEX=0;for(let o=0;o<j.length;o++){const t=s.prePassRenderer.getIndex(j[o].type);-1!==t?(Z[j[o].define]=!0,Z[j[o].index]=t):Z[j[o].define]=!1}}else{Z.PREPASS=!1;for(let s=0;s<j.length;s++)Z[j[s].define]=!1}Z.PREPASS!=t&&(Z.markAsUnprocessed(),Z.markAsImageProcessingDirty())}function W(s,Z,o,t){let j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,S=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];j&&j.push("Light"+s),S||(Z.push("vLightData"+s,"vLightDiffuse"+s,"vLightSpecular"+s,"vLightDirection"+s,"vLightWidth"+s,"vLightHeight"+s,"vLightFalloff"+s,"vLightGround"+s,"lightMatrix"+s,"shadowsInfo"+s,"depthValues"+s),o.push("shadowTexture"+s),o.push("depthTexture"+s),Z.push("viewFrustumZ"+s,"cascadeBlendFactor"+s,"lightSizeUVCorrection"+s,"depthCorrection"+s,"penumbraDarkness"+s,"frustumLengths"+s),t&&(o.push("projectionLightTexture"+s),Z.push("textureProjectionMatrix"+s)),a&&o.push("iesLightTexture"+s))}function q(s,Z,o){let t,j,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(s.uniformsNames){const a=s;t=a.uniformsNames,j=a.uniformBuffersNames,Z=a.samplers,o=a.defines,S=a.maxSimultaneousLights||0}else t=s,Z||(Z=[]);for(let a=0;a<S&&o["LIGHT"+a];a++)W(a,t,Z,o["PROJECTEDLIGHTTEXTURE"+a],j,!1,o["IESLIGHTTEXTURE"+a]);o.NUM_MORPH_INFLUENCERS&&(t.push("morphTargetInfluences"),t.push("morphTargetCount")),o.BAKED_VERTEX_ANIMATION_TEXTURE&&(t.push("bakedVertexAnimationSettings"),t.push("bakedVertexAnimationTextureSizeInverted"),t.push("bakedVertexAnimationTime"),Z.push("bakedVertexAnimationTexture"))}},11601:(s,Z,o)=>{o.d(Z,{c:()=>S});var t,j=o(10900);!function(s){s[s.Zero=0]="Zero",s[s.One=1]="One",s[s.MaxViewZ=2]="MaxViewZ"}(t||(t={}));class S{static CreateConfiguration(s){return S._Configurations[s]={defines:{},previousWorldMatrices:{},previousViewProjection:j.b.Zero(),currentViewProjection:j.b.Zero(),previousBones:{},lastUpdateFrameId:-1,excludedSkinnedMesh:[],reverseCulling:!1},S._Configurations[s]}static DeleteConfiguration(s){delete S._Configurations[s]}static GetConfiguration(s){return S._Configurations[s]}static AddUniformsAndSamplers(s,Z){s.push("previousWorld","previousViewProjection","mPreviousBones")}static MarkAsDirty(s,Z){for(const o of Z)if(o.vO)for(const Z of o.vO)Z._removeDrawWrapper(s)}static PrepareDefines(s,Z,o){if(!o._arePrePassDirty)return;const t=S._Configurations[s];if(!t)return;o.PREPASS=!0,o.PREPASS_COLOR=!1,o.PREPASS_COLOR_INDEX=-1;let j=0;for(let a=0;a<S.GeometryTextureDescriptions.length;a++){const s=S.GeometryTextureDescriptions[a],Z=s.define,O=s.defineIndex,v=t.defines[O];void 0!==v?(o[Z]=!0,o[O]=v,j++):(o[Z]=!1,delete o[O])}o.SCENE_MRT_COUNT=j,o.BONES_VELOCITY_ENABLED=Z.useBones&&Z.computeBonesUsingShaders&&Z.skeleton&&!Z.skeleton.isUsingTextureForMatrices&&-1===t.excludedSkinnedMesh.indexOf(Z)}static Bind(s,Z,o,t,j){const a=S._Configurations[s];if(!a)return;const O=o.Ls(),v=O.getEngine();if(a.reverseCulling&&v.setStateCullFaceType(O._mirroredCameraPosition?j.cullBackFaces:!j.cullBackFaces),(void 0!==a.defines.PREPASS_VELOCITY_INDEX||void 0!==a.defines.PREPASS_VELOCITY_LINEAR_INDEX)&&(a.previousWorldMatrices[o.uniqueId]||(a.previousWorldMatrices[o.uniqueId]=t.clone()),a.previousViewProjection||(a.previousViewProjection=O.getTransformMatrix().clone(),a.currentViewProjection=O.getTransformMatrix().clone()),a.currentViewProjection.updateFlag!==O.getTransformMatrix().updateFlag?(a.lastUpdateFrameId=v.frameId,a.previousViewProjection.O(a.currentViewProjection),a.currentViewProjection.O(O.getTransformMatrix())):a.lastUpdateFrameId!==v.frameId&&(a.lastUpdateFrameId=v.frameId,a.previousViewProjection.O(a.currentViewProjection)),Z.setMatrix("previousWorld",a.previousWorldMatrices[o.uniqueId]),Z.setMatrix("previousViewProjection",a.previousViewProjection),a.previousWorldMatrices[o.uniqueId]=t.clone(),o.useBones&&o.computeBonesUsingShaders&&o.skeleton)){const s=o.skeleton;if(!s.isUsingTextureForMatrices||-1===Z.getUniformIndex("boneTextureWidth")){const t=s.getTransformMatrices(o);t&&(a.previousBones[o.uniqueId]||(a.previousBones[o.uniqueId]=t.slice()),Z.setMatrices("mPreviousBones",a.previousBones[o.uniqueId]),a.previousBones[o.uniqueId].set(t))}}}}S.GeometryTextureDescriptions=[{type:0,name:"Irradiance",clearType:0,define:"PREPASS_IRRADIANCE",defineIndex:"PREPASS_IRRADIANCE_INDEX"},{type:1,name:"WorldPosition",clearType:0,define:"PREPASS_POSITION",defineIndex:"PREPASS_POSITION_INDEX"},{type:2,name:"Velocity",clearType:0,define:"PREPASS_VELOCITY",defineIndex:"PREPASS_VELOCITY_INDEX"},{type:3,name:"Reflectivity",clearType:0,define:"PREPASS_REFLECTIVITY",defineIndex:"PREPASS_REFLECTIVITY_INDEX"},{type:5,name:"ViewDepth",clearType:2,define:"PREPASS_DEPTH",defineIndex:"PREPASS_DEPTH_INDEX"},{type:6,name:"ViewNormal",clearType:0,define:"PREPASS_NORMAL",defineIndex:"PREPASS_NORMAL_INDEX"},{type:7,name:"AlbedoSqrt",clearType:0,define:"PREPASS_ALBEDO_SQRT",defineIndex:"PREPASS_ALBEDO_SQRT_INDEX"},{type:8,name:"WorldNormal",clearType:0,define:"PREPASS_WORLD_NORMAL",defineIndex:"PREPASS_WORLD_NORMAL_INDEX"},{type:9,name:"LocalPosition",clearType:0,define:"PREPASS_LOCAL_POSITION",defineIndex:"PREPASS_LOCAL_POSITION_INDEX"},{type:10,name:"ScreenDepth",clearType:1,define:"PREPASS_SCREENSPACE_DEPTH",defineIndex:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:11,name:"LinearVelocity",clearType:0,define:"PREPASS_VELOCITY_LINEAR",defineIndex:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:12,name:"Albedo",clearType:0,define:"PREPASS_ALBEDO",defineIndex:"PREPASS_ALBEDO_INDEX"},{type:13,name:"NormalizedViewDepth",clearType:1,define:"PREPASS_NORMALIZED_VIEW_DEPTH",defineIndex:"PREPASS_NORMALIZED_VIEW_DEPTH_INDEX"}],S._Configurations={}},11556:(s,Z,o)=>{o.d(Z,{c:()=>A});var t=o(11086),j=o(11091),S=o(11081),a=o(10927),O=o(11004),v=o(11026);const G=new RegExp("^([gimus]+)!");class B{constructor(s){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=s,this._scene=s.Ls(),this._engine=this._scene.getEngine()}_addPlugin(s){for(let t=0;t<this._plugins.length;++t)if(this._plugins[t].name===s.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!s.isCompatible(this._material.shaderLanguage))throw`The plugin "${s.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const Z=s.getClassName();B._MaterialPluginClassToMainDefine[Z]||(B._MaterialPluginClassToMainDefine[Z]="MATERIALPLUGIN_"+ ++B._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(s,Z)=>this._handlePluginEvent(s,Z),this._plugins.push(s),this._plugins.sort(((s,Z)=>s.priority-Z.priority)),this._codeInjectionPoints={};const o={};o[B._MaterialPluginClassToMainDefine[Z]]={type:"boolean",default:!0};for(const t of this._plugins)t.collectDefines(o),this._collectPointNames("vertex",t.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",t.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=o,!0}_activatePlugin(s){-1===this._activePlugins.indexOf(s)&&(this._activePlugins.push(s),this._activePlugins.sort(((s,Z)=>s.priority-Z.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),s.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(s),this._activePluginsForExtraEvents.sort(((s,Z)=>s.priority-Z.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(s){for(let Z=0;Z<this._plugins.length;++Z)if(this._plugins[Z].name===s)return this._plugins[Z];return null}_handlePluginEventIsReadyForSubMesh(s){let Z=!0;for(const o of this._activePlugins)Z=Z&&o.isReadyForSubMesh(s.defines,this._scene,this._engine,s.subMesh);s.isReadyForSubMesh=Z}_handlePluginEventPrepareDefinesBeforeAttributes(s){for(const Z of this._activePlugins)Z.prepareDefinesBeforeAttributes(s.defines,this._scene,s.mesh)}_handlePluginEventPrepareDefines(s){for(const Z of this._activePlugins)Z.prepareDefines(s.defines,this._scene,s.mesh)}_handlePluginEventHardBindForSubMesh(s){for(const Z of this._activePluginsForExtraEvents)Z.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,s.subMesh)}_handlePluginEventBindForSubMesh(s){for(const Z of this._activePlugins)Z.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,s.subMesh)}_handlePluginEventHasRenderTargetTextures(s){let Z=!1;for(const o of this._activePluginsForExtraEvents)if(Z=o.hasRenderTargetTextures(),Z)break;s.hasRenderTargetTextures=Z}_handlePluginEventFillRenderTargetTextures(s){for(const Z of this._activePluginsForExtraEvents)Z.fillRenderTargetTextures(s.renderTargets)}_handlePluginEvent(s,Z){switch(s){case 512:{const s=Z;for(const Z of this._activePlugins)Z.getActiveTextures(s.activeTextures);break}case 256:{const s=Z;for(const Z of this._activePlugins)Z.getAnimatables(s.animatables);break}case 1024:{const s=Z;let o=!1;for(const Z of this._activePlugins)if(o=Z.hasTexture(s.texture),o)break;s.hasTexture=o;break}case 2:{const s=Z;for(const Z of this._plugins)Z.dispose(s.forceDisposeTextures);break}case 4:Z.defineNames=this._defineNamesFromPlugins;break;case 128:{const s=Z;for(const Z of this._activePlugins)s.fallbackRank=Z.addFallbacks(s.defines,s.fallbacks,s.fallbackRank),Z.getAttributes(s.attributes,this._scene,s.mesh);this._uniformList.length>0&&s.uniforms.push(...this._uniformList),this._samplerList.length>0&&s.samplers.push(...this._samplerList),this._uboList.length>0&&s.uniformBuffersNames.push(...this._uboList),s.customCode=this._injectCustomCode(s,s.customCode);break}case 8:{const s=Z;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const o=1===this._material.shaderLanguage;for(const Z of this._plugins){const t=Z.getUniforms(this._material.shaderLanguage);if(t){if(t.ubo)for(const Z of t.ubo){if(Z.size&&Z.type){const t=Z.arraySize??0;if(s.ubo.addUniform(Z.name,Z.size,t),o){let s;switch(Z.type){case"mat4":s="mat4x4f";break;case"float":s="f32";break;default:s=`${Z.type}f`}this._uboDeclaration+=t>0?`uniform ${Z.name}: array<${s}, ${t}>;\n`:`uniform ${Z.name}: ${s};\n`}else this._uboDeclaration+=`${Z.type} ${Z.name}${t>0?`[${t}]`:""};\n`}this._uniformList.push(Z.name)}t.vertex&&(this._vertexDeclaration+=t.vertex+"\n"),t.fragment&&(this._fragmentDeclaration+=t.fragment+"\n")}Z.getSamplers(this._samplerList),Z.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(s,Z){if(Z)for(const o in Z)this._codeInjectionPoints[s]||(this._codeInjectionPoints[s]={}),this._codeInjectionPoints[s][o]=!0}_injectCustomCode(s,Z){return(o,t)=>{var j;Z&&(t=Z(o,t)),this._uboDeclaration&&(t=t.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(t=t.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(t=t.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const S=null===(j=this._codeInjectionPoints)||void 0===j?void 0:j[o];if(!S)return t;let a=null;for(let Z in S){let j="";for(const t of this._activePlugins){var B;let S=null===(B=t.getCustomCode(o,this._material.shaderLanguage))||void 0===B?void 0:B[Z];if(S){if(t.resolveIncludes){if(null===a){const Z=0;a={defines:[],indexParameters:s.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:v.d.GetShadersRepository(Z),includesShadersStore:v.d.GetIncludesShadersStore(Z),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}a.isFragment="fragment"===o,(0,O.h)(S,a,(s=>S=s))}j+=S+"\n"}}if(j.length>0)if("!"===Z.charAt(0)){Z=Z.substring(1);let s="g";if("!"===Z.charAt(0))s="",Z=Z.substring(1);else{const o=G.exec(Z);o&&o.length>=2&&(s=o[1],Z=Z.substring(s.length+1))}s.indexOf("g")<0&&(s+="g");const o=t,S=new RegExp(Z,s);let a=S.exec(o);for(;null!==a;){let s=j;for(let Z=0;Z<a.length;++Z)s=s.replace("$"+Z,a[Z]);t=t.replace(a[0],s),a=S.exec(o)}}else{const s="#define "+Z;t=t.replace(s,"\n"+j+"\n"+s)}}return t}}}B._MaterialPluginClassToMainDefine={},B._MaterialPluginCounter=0,a.c.OnEnginesDisposedObservable.add((()=>{Y()}));const Q=[];let D=!1,z=null;function Y(){Q.length=0,D=!1,S.c.OnEventObservable.remove(z),z=null}var b=o(11167),f=o(10916);class A{isCompatible(s){return 0===s}_enable(s){s&&this._pluginManager._activatePlugin(this)}constructor(s,Z,o,t){let j=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],S=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this.doNotSerialize=!1,this._material=s,this.name=Z,this.priority=o,this.resolveIncludes=a,s.pluginManager||(s.pluginManager=new B(s),s.jO.add((()=>{s.pluginManager=void 0}))),this._pluginDefineNames=t,this._pluginManager=s.pluginManager,j&&this._pluginManager._addPlugin(this),S&&this._enable(!0),this.markAllDefinesAsDirty=s._dirtyCallbacks[127]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(s,Z,o,t){return!0}hardBindForSubMesh(s,Z,o,t){}bindForSubMesh(s,Z,o,t){}dispose(s){}getCustomCode(s){return null}collectDefines(s){if(this._pluginDefineNames)for(const Z of Object.keys(this._pluginDefineNames)){if("_"===Z[0])continue;const o=typeof this._pluginDefineNames[Z];s[Z]={type:"number"===o?"number":"string"===o?"string":"boolean"===o?"boolean":"object",default:this._pluginDefineNames[Z]}}}prepareDefinesBeforeAttributes(s,Z,o){}prepareDefines(s,Z,o){}hasTexture(s){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(s){}getActiveTextures(s){}getAnimatables(s){}addFallbacks(s,Z,o){return o}getSamplers(s){}getAttributes(s,Z,o){}getUniformBuffersNames(s){}getUniforms(){return{}}copyTo(s){b.c.Clone((()=>s),this)}serialize(){return b.c.Serialize(this)}parse(s,Z,o){b.c.Parse((()=>this),s,Z,o)}}(0,t.c)([(0,j.K)()],A.prototype,"name",void 0),(0,t.c)([(0,j.K)()],A.prototype,"priority",void 0),(0,t.c)([(0,j.K)()],A.prototype,"resolveIncludes",void 0),(0,t.c)([(0,j.K)()],A.prototype,"registerForExtraEvents",void 0),(0,f.f)("BABYLON.MaterialPluginBase",A)},11295:(s,Z,o)=>{o.d(Z,{d:()=>a});var t=o(11081),j=o(11172),S=o(10916);class a extends t.c{get GO(){return this._subMaterials}set GO(s){this._subMaterials=s,this._hookArray(s)}getChildren(){return this.GO}constructor(s,Z){super(s,Z,!0),this._waitingSubMaterialsUniqueIds=[],this.Ls().addMultiMaterial(this),this.GO=[],this._storeEffectOnSubMeshes=!0}_hookArray(s){var Z=this;const o=s.push;s.push=function(){for(var t=arguments.length,j=new Array(t),S=0;S<t;S++)j[S]=arguments[S];const a=o.apply(s,j);return Z._markAllSubMeshesAsTexturesDirty(),a};const t=s.splice;s.splice=(Z,o)=>{const j=t.apply(s,[Z,o]);return this._markAllSubMeshesAsTexturesDirty(),j}}getSubMaterial(s){return s<0||s>=this.GO.length?this.Ls().defaultMaterial:this.GO[s]}getActiveTextures(){return super.getActiveTextures().concat(...this.GO.map((s=>s?s.getActiveTextures():[])))}hasTexture(s){if(super.hasTexture(s))return!0;for(let o=0;o<this.GO.length;o++){var Z;if(null!==(Z=this.GO[o])&&void 0!==Z&&Z.hasTexture(s))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(s,Z,o){for(let t=0;t<this.GO.length;t++){const j=this.GO[t];if(j){if(j._storeEffectOnSubMeshes){if(!j.isReadyForSubMesh(s,Z,o))return!1;continue}if(!j.isReady(s))return!1}}return!0}clone(s,Z){const o=new a(s,this.Ls());for(let t=0;t<this.GO.length;t++){let j=null;const S=this.GO[t];j=Z&&S?S.clone(s+"-"+S.name):this.GO[t],o.GO.push(j)}return o}serialize(){const s={};s.name=this.name,s.id=this.id,s.uniqueId=this.uniqueId,j.b&&(s.tags=j.b.GetTags(this)),s.materialsUniqueIds=[],s.materials=[];for(let Z=0;Z<this.GO.length;Z++){const o=this.GO[Z];o?(s.materialsUniqueIds.push(o.uniqueId),s.materials.push(o.id)):(s.materialsUniqueIds.push(null),s.materials.push(null))}return s}dispose(s,Z,o){const t=this.Ls();if(!t)return;if(o)for(let S=0;S<this.GO.length;S++){const o=this.GO[S];o&&o.dispose(s,Z)}const j=t.multiMaterials.indexOf(this);j>=0&&t.multiMaterials.splice(j,1),super.dispose(s,Z)}static ParseMultiMaterial(s,Z){const o=new a(s.name,Z);if(o.id=s.id,o._loadedUniqueId=s.uniqueId,j.b&&j.b.AddTagsTo(o,s.tags),s.materialsUniqueIds)o._waitingSubMaterialsUniqueIds=s.materialsUniqueIds;else for(const t of s.materials)o.GO.push(Z.getLastMaterialById(t));return o}}(0,S.f)("BABYLON.MultiMaterial",a)},11560:(s,Z,o)=>{o.d(Z,{e:()=>t});class t{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(s){s.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(s){}bindForSubMesh(s,Z,o,t,j){if(Z.prePassRenderer&&Z.prePassRenderer.enabled&&Z.prePassRenderer.currentRTisSceneRT&&(-1!==Z.prePassRenderer.getIndex(2)||-1!==Z.prePassRenderer.getIndex(11))){this.previousWorldMatrices[o.uniqueId]||(this.previousWorldMatrices[o.uniqueId]=t.clone()),this.previousViewProjection||(this.previousViewProjection=Z.getTransformMatrix().clone(),this.currentViewProjection=Z.getTransformMatrix().clone());const j=Z.getEngine();this.currentViewProjection.updateFlag!==Z.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=j.frameId,this.previousViewProjection.O(this.currentViewProjection),this.currentViewProjection.O(Z.getTransformMatrix())):this._lastUpdateFrameId!==j.frameId&&(this._lastUpdateFrameId=j.frameId,this.previousViewProjection.O(this.currentViewProjection)),s.setMatrix("previousWorld",this.previousWorldMatrices[o.uniqueId]),s.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[o.uniqueId]=t.clone()}}}},11566:(s,Z,o)=>{o.d(Z,{e:()=>S});var t=o(10900),j=o(11081);class S extends j.c{constructor(s,Z){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(s,Z,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new t.b,this._storeEffectOnSubMeshes=o}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(s,Z){return!!s&&(!this._storeEffectOnSubMeshes||(!s.vO||0===s.vO.length||this.isReadyForSubMesh(s,s.vO[0],Z)))}_isReadyForSubMesh(s){const Z=s.materialDefines;return!(this.checkReadyOnEveryCall||!s.effect||!Z||Z._renderId!==this.Ls().getRenderId())}bindOnlyWorldMatrix(s){this._activeEffect.setMatrix("world",s)}bindOnlyNormalMatrix(s){this._activeEffect.setMatrix("normalMatrix",s)}bind(s,Z){Z&&this.bindForSubMesh(s,Z,Z.vO[0])}_afterBind(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2?arguments[2]:void 0;super._afterBind(s,Z,o),this.Ls()._cachedEffect=Z,o?o._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return o._drawWrapper._forceRebindOnNextCall||s.isCachedMaterialInvalid(this,Z,t)}dispose(s,Z,o){this._activeEffect=void 0,super.dispose(s,Z,o)}}},11642:(s,Z,o)=>{o.d(Z,{e:()=>f});var t=o(11167),j=o(11493),S=o(10900),a=o(11113),O=o(11410),v=o(10916),G=o(11590),B=o(10977),Q=o(11566),D=o(10927),z=o(11189),Y=o(11181);const b={effect:null,subMesh:null};class f extends Q.e{constructor(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(s,Z,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new S.b,this._cachedWorldViewProjectionMatrix=new S.b,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=o,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","gt","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...t}}get shaderPath(){return this._shaderPath}set shaderPath(s){this._shaderPath=s}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(s){-1===this._options.uniforms.indexOf(s)&&this._options.uniforms.push(s)}setTexture(s,Z){return-1===this._options.samplers.indexOf(s)&&this._options.samplers.push(s),this._textures[s]=Z,this}removeTexture(s){delete this._textures[s]}setTextureArray(s,Z){return-1===this._options.samplers.indexOf(s)&&this._options.samplers.push(s),this._checkUniform(s),this._textureArrays[s]=Z,this}setExternalTexture(s,Z){return-1===this._options.externalTextures.indexOf(s)&&this._options.externalTextures.push(s),this._externalTextures[s]=Z,this}setFloat(s,Z){return this._checkUniform(s),this._floats[s]=Z,this}setInt(s,Z){return this._checkUniform(s),this._ints[s]=Z,this}setUInt(s,Z){return this._checkUniform(s),this._uints[s]=Z,this}setFloats(s,Z){return this._checkUniform(s),this._floatsArrays[s]=Z,this}setColor3(s,Z){return this._checkUniform(s),this._colors3[s]=Z,this}setColor3Array(s,Z){return this._checkUniform(s),this._colors3Arrays[s]=Z.reduce(((s,Z)=>(s.push(Z.r,Z.g,Z.b),s)),[]),this}setColor4(s,Z){return this._checkUniform(s),this._colors4[s]=Z,this}setColor4Array(s,Z){return this._checkUniform(s),this._colors4Arrays[s]=Z.reduce(((s,Z)=>(s.push(Z.r,Z.g,Z.b,Z.a),s)),[]),this}setVector2(s,Z){return this._checkUniform(s),this._vectors2[s]=Z,this}setVector3(s,Z){return this._checkUniform(s),this._vectors3[s]=Z,this}setVector4(s,Z){return this._checkUniform(s),this._vectors4[s]=Z,this}setQuaternion(s,Z){return this._checkUniform(s),this._quaternions[s]=Z,this}setQuaternionArray(s,Z){return this._checkUniform(s),this._quaternionsArrays[s]=Z.reduce(((s,Z)=>(Z.toArray(s,s.length),s)),[]),this}setMatrix(s,Z){return this._checkUniform(s),this._matrices[s]=Z,this}setMatrices(s,Z){this._checkUniform(s);const o=new Float32Array(16*Z.length);for(let t=0;t<Z.length;t++){Z[t].copyToArray(o,16*t)}return this._matrixArrays[s]=o,this}setMatrix3x3(s,Z){return this._checkUniform(s),this._matrices3x3[s]=Z,this}setMatrix2x2(s,Z){return this._checkUniform(s),this._matrices2x2[s]=Z,this}setArray2(s,Z){return this._checkUniform(s),this._vectors2Arrays[s]=Z,this}setArray3(s,Z){return this._checkUniform(s),this._vectors3Arrays[s]=Z,this}setArray4(s,Z){return this._checkUniform(s),this._vectors4Arrays[s]=Z,this}setUniformBuffer(s,Z){return-1===this._options.uniformBuffers.indexOf(s)&&this._options.uniformBuffers.push(s),this._uniformBuffers[s]=Z,this}setTextureSampler(s,Z){return-1===this._options.samplerObjects.indexOf(s)&&this._options.samplerObjects.push(s),this._textureSamplers[s]=Z,this}setStorageBuffer(s,Z){return-1===this._options.storageBuffers.indexOf(s)&&this._options.storageBuffers.push(s),this._storageBuffers[s]=Z,this}setDefine(s,Z){const o=s.trimEnd()+" ",t=this.options.defines.findIndex((Z=>Z===s||Z.startsWith(o)));return t>=0&&this.options.defines.splice(t,1),("boolean"!==typeof Z||Z)&&this.options.defines.push(o+Z),this}isReadyForSubMesh(s,Z,o){return this.isReady(s,o,Z)}isReady(s,Z,o){var t;const S=o&&this._storeEffectOnSubMeshes;if(this.isFrozen){const s=S?o._drawWrapper:this._drawWrapper;if(s.effect&&s._wasPreviouslyReady&&s._wasPreviouslyUsingInstances===Z)return!0}const O=this.Ls(),v=O.getEngine(),B=[],Q=[];let D=null,f=this._shaderPath,A=this._options.uniforms,d=this._options.uniformBuffers,U=this._options.samplers;v.getCaps().multiview&&O.activeCamera&&O.activeCamera.outputRenderTarget&&O.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,B.push("#define MULTIVIEW"),-1!==A.indexOf("viewProjection")&&-1===A.indexOf("viewProjectionR")&&A.push("viewProjectionR"));for(let j=0;j<this._options.defines.length;j++){const s=0===this._options.defines[j].indexOf("#define")?this._options.defines[j]:`#define ${this._options.defines[j]}`;B.push(s)}for(let j=0;j<this._options.attributes.length;j++)Q.push(this._options.attributes[j]);if(s&&s.isVerticesDataPresent(a.e.ColorKind)&&(-1===Q.indexOf(a.e.ColorKind)&&Q.push(a.e.ColorKind),B.push("#define VERTEXCOLOR")),Z&&(B.push("#define INSTANCES"),(0,Y.W)(Q,this._materialHelperNeedsPreviousMatrices),null!==s&&void 0!==s&&s.hasThinInstances&&(B.push("#define THIN_INSTANCES"),s&&s.isVerticesDataPresent(a.e.ColorInstanceKind)&&(Q.push(a.e.ColorInstanceKind),B.push("#define INSTANCESCOLOR")))),s&&s.useBones&&s.computeBonesUsingShaders&&s.skeleton){Q.push(a.e.MatricesIndicesKind),Q.push(a.e.MatricesWeightsKind),s.numBoneInfluencers>4&&(Q.push(a.e.MatricesIndicesExtraKind),Q.push(a.e.MatricesWeightsExtraKind));const Z=s.skeleton;B.push("#define NUM_BONE_INFLUENCERS "+s.numBoneInfluencers),D=new G.c,D.addCPUSkinningFallback(0,s),Z.isUsingTextureForMatrices?(B.push("#define BONETEXTURE"),-1===A.indexOf("boneTextureWidth")&&A.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(B.push("#define BonesPerMesh "+(Z.bones.length+1)),-1===A.indexOf("mBones")&&A.push("mBones"))}else B.push("#define NUM_BONE_INFLUENCERS 0");let u=0;const H=s?s.morphTargetManager:null;if(H){const Z=-1!==B.indexOf("#define UV1"),o=-1!==B.indexOf("#define UV2"),t=-1!==B.indexOf("#define TANGENT"),j=-1!==B.indexOf("#define NORMAL"),S=-1!==B.indexOf("#define VERTEXCOLOR");u=(0,Y.x)(H,B,Q,s,!0,j,t,Z,o,S),H.isUsingTextureForTargets&&(-1===A.indexOf("morphTargetTextureIndices")&&A.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),u>0&&(A=A.slice(),A.push("morphTargetInfluences"),A.push("morphTargetCount"),A.push("morphTargetTextureInfo"),A.push("morphTargetTextureIndices"))}else B.push("#define NUM_MORPH_INFLUENCERS 0");if(s){const Z=s.bakedVertexAnimationManager;Z&&Z.isEnabled&&(B.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===A.indexOf("bakedVertexAnimationSettings")&&A.push("bakedVertexAnimationSettings"),-1===A.indexOf("bakedVertexAnimationTextureSizeInverted")&&A.push("bakedVertexAnimationTextureSizeInverted"),-1===A.indexOf("bakedVertexAnimationTime")&&A.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,Y.n)(Q,s,B)}for(const j in this._textures)if(!this._textures[j].isReady())return!1;s&&this.needAlphaTestingForMesh(s)&&B.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,z.b)(A),(0,z.i)(this,O,B)),O.fogEnabled&&null!==s&&void 0!==s&&s.applyFog&&O.fogMode!==j.c.FOGMODE_NONE&&(B.push("#define FOG"),-1===A.indexOf("view")&&A.push("view"),-1===A.indexOf("vFogInfos")&&A.push("vFogInfos"),-1===A.indexOf("vFogColor")&&A.push("vFogColor")),this._useLogarithmicDepth&&(B.push("#define LOGARITHMICDEPTH"),-1===A.indexOf("logarithmicDepthConstant")&&A.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(A=A.slice(),d=d.slice(),U=U.slice(),f=this.customShaderNameResolve(this.name,A,d,U,B,Q));const F=S?o._getDrawWrapper(void 0,!0):this._drawWrapper,i=(null===F||void 0===F?void 0:F.effect)??null,N=(null===F||void 0===F?void 0:F.defines)??null,L=B.join("\n");let V=i;return N!==L&&(V=v.createEffect(f,{attributes:Q,uniformsNames:A,uniformBuffersNames:d,samplers:U,defines:L,fallbacks:D,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:u},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},v),S?o.setEffect(V,L,this._materialContext):F&&F.setEffect(V,L),this._onEffectCreatedObservable&&(b.effect=V,b.subMesh=o??(null===s||void 0===s?void 0:s.vO[0])??null,this._onEffectCreatedObservable.notifyObservers(b))),F._wasPreviouslyUsingInstances=!!Z,!(null===(t=V)||void 0===t||!t.isReady())&&(i!==V&&O.resetCachedMaterial(),F._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(s,Z){const o=Z??this.getEffect();if(!o)return;const t=this._options.uniforms;-1!==t.indexOf("world")&&o.setMatrix("world",s);const j=this.Ls();-1!==t.indexOf("worldView")&&(s.multiplyToRef(j.getViewMatrix(),this._cachedWorldViewMatrix),o.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==t.indexOf("worldViewProjection")&&(s.multiplyToRef(j.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),o.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==t.indexOf("view")&&o.setMatrix("view",j.getViewMatrix())}bindForSubMesh(s,Z,o){var t;this.bind(s,Z,null===(t=o._drawWrapperOverride)||void 0===t?void 0:t.effect,o)}bind(s,Z,o,t){const j=t&&this._storeEffectOnSubMeshes,S=o??(j?t.effect:this.getEffect());if(!S)return;const a=this.Ls();this._activeEffect=S,this.bindOnlyWorldMatrix(s,o);const O=this._options.uniformBuffers;let v=!1;if(S&&O&&O.length>0&&a.getEngine().supportsUniformBuffers)for(let Q=0;Q<O.length;++Q){switch(O[Q]){case"Mesh":Z&&(Z.getMeshUniformBuffer().bindToEffect(S,"Mesh"),Z.transferToEffect(s));break;case"Scene":(0,Y.k)(S,a.getSceneUniformBuffer()),a.finalizeSceneUbo(),v=!0}}const G=Z&&j?this._mustRebind(a,S,t,Z.visibility):a.getCachedMaterial()!==this;if(S&&G){let s;for(s in v||-1===this._options.uniforms.indexOf("view")||S.setMatrix("view",a.getViewMatrix()),v||-1===this._options.uniforms.indexOf("projection")||S.setMatrix("projection",a.getProjectionMatrix()),v||-1===this._options.uniforms.indexOf("viewProjection")||(S.setMatrix("viewProjection",a.getTransformMatrix()),this._multiview&&S.setMatrix("viewProjectionR",a._transformMatrixR)),a.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&S.setVector3("cameraPosition",a.activeCamera.globalPosition),(0,Y.b)(Z,S),(0,z.f)(S,this,a),this._useLogarithmicDepth&&(0,Y.h)(j?t.materialDefines:S.defines,S,a),Z&&(0,Y.e)(a,Z,S),this._textures)S.setTexture(s,this._textures[s]);for(s in this._textureArrays)S.setTextureArray(s,this._textureArrays[s]);for(s in this._ints)S.setInt(s,this._ints[s]);for(s in this._uints)S.setUInt(s,this._uints[s]);for(s in this._floats)S.setFloat(s,this._floats[s]);for(s in this._floatsArrays)S.setArray(s,this._floatsArrays[s]);for(s in this._colors3)S.setColor3(s,this._colors3[s]);for(s in this._colors3Arrays)S.setArray3(s,this._colors3Arrays[s]);for(s in this._colors4){const Z=this._colors4[s];S.setFloat4(s,Z.r,Z.g,Z.b,Z.a)}for(s in this._colors4Arrays)S.setArray4(s,this._colors4Arrays[s]);for(s in this._vectors2)S.setVector2(s,this._vectors2[s]);for(s in this._vectors3)S.setVector3(s,this._vectors3[s]);for(s in this._vectors4)S.setVector4(s,this._vectors4[s]);for(s in this._quaternions)S.setQuaternion(s,this._quaternions[s]);for(s in this._matrices)S.setMatrix(s,this._matrices[s]);for(s in this._matrixArrays)S.setMatrices(s,this._matrixArrays[s]);for(s in this._matrices3x3)S.setMatrix3x3(s,this._matrices3x3[s]);for(s in this._matrices2x2)S.setMatrix2x2(s,this._matrices2x2[s]);for(s in this._vectors2Arrays)S.setArray2(s,this._vectors2Arrays[s]);for(s in this._vectors3Arrays)S.setArray3(s,this._vectors3Arrays[s]);for(s in this._vectors4Arrays)S.setArray4(s,this._vectors4Arrays[s]);for(s in this._quaternionsArrays)S.setArray4(s,this._quaternionsArrays[s]);for(s in this._uniformBuffers){const Z=this._uniformBuffers[s].getBuffer();Z&&S.bindUniformBuffer(Z,s)}const o=a.getEngine(),O=o.setExternalTexture;if(O)for(s in this._externalTextures)O.call(o,s,this._externalTextures[s]);const G=o.setTextureSampler;if(G)for(s in this._textureSamplers)G.call(o,s,this._textureSamplers[s]);const B=o.setStorageBuffer;if(B)for(s in this._storageBuffers)B.call(o,s,this._storageBuffers[s])}if(S&&Z&&(G||!this.isFrozen)){(0,Y.j)(Z,S),Z.morphTargetManager&&Z.morphTargetManager.isUsingTextureForTargets&&Z.morphTargetManager._bind(S);const s=Z.bakedVertexAnimationManager;if(s&&s.isEnabled){var B;const s=j?t._drawWrapper:this._drawWrapper;null===(B=Z.bakedVertexAnimationManager)||void 0===B||B.bind(S,!!s._wasPreviouslyUsingInstances)}}this._afterBind(Z,S,t)}getActiveTextures(){const s=super.getActiveTextures();for(const Z in this._textures)s.push(this._textures[Z]);for(const Z in this._textureArrays){const o=this._textureArrays[Z];for(let Z=0;Z<o.length;Z++)s.push(o[Z])}return s}hasTexture(s){if(super.hasTexture(s))return!0;for(const Z in this._textures)if(this._textures[Z]===s)return!0;for(const Z in this._textureArrays){const o=this._textureArrays[Z];for(let Z=0;Z<o.length;Z++)if(o[Z]===s)return!0}return!1}clone(s){const Z=t.c.Clone((()=>new f(s,this.Ls(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);Z.name=s,Z.id=s,"object"===typeof Z._shaderPath&&(Z._shaderPath={...Z._shaderPath}),this._options={...this._options};const o=Object.keys(this._options);for(const t of o){const s=this._options[t];Array.isArray(s)&&(this._options[t]=s.slice(0))}this.stencil.copyTo(Z.stencil);for(const t in this._textures)Z.setTexture(t,this._textures[t]);for(const t in this._textureArrays)Z.setTextureArray(t,this._textureArrays[t]);for(const t in this._externalTextures)Z.setExternalTexture(t,this._externalTextures[t]);for(const t in this._ints)Z.setInt(t,this._ints[t]);for(const t in this._uints)Z.setUInt(t,this._uints[t]);for(const t in this._floats)Z.setFloat(t,this._floats[t]);for(const t in this._floatsArrays)Z.setFloats(t,this._floatsArrays[t]);for(const t in this._colors3)Z.setColor3(t,this._colors3[t]);for(const t in this._colors3Arrays)Z._colors3Arrays[t]=this._colors3Arrays[t];for(const t in this._colors4)Z.setColor4(t,this._colors4[t]);for(const t in this._colors4Arrays)Z._colors4Arrays[t]=this._colors4Arrays[t];for(const t in this._vectors2)Z.setVector2(t,this._vectors2[t]);for(const t in this._vectors3)Z.setVector3(t,this._vectors3[t]);for(const t in this._vectors4)Z.setVector4(t,this._vectors4[t]);for(const t in this._quaternions)Z.setQuaternion(t,this._quaternions[t]);for(const t in this._quaternionsArrays)Z._quaternionsArrays[t]=this._quaternionsArrays[t];for(const t in this._matrices)Z.setMatrix(t,this._matrices[t]);for(const t in this._matrixArrays)Z._matrixArrays[t]=this._matrixArrays[t].slice();for(const t in this._matrices3x3)Z.setMatrix3x3(t,this._matrices3x3[t]);for(const t in this._matrices2x2)Z.setMatrix2x2(t,this._matrices2x2[t]);for(const t in this._vectors2Arrays)Z.setArray2(t,this._vectors2Arrays[t]);for(const t in this._vectors3Arrays)Z.setArray3(t,this._vectors3Arrays[t]);for(const t in this._vectors4Arrays)Z.setArray4(t,this._vectors4Arrays[t]);for(const t in this._uniformBuffers)Z.setUniformBuffer(t,this._uniformBuffers[t]);for(const t in this._textureSamplers)Z.setTextureSampler(t,this._textureSamplers[t]);for(const t in this._storageBuffers)Z.setStorageBuffer(t,this._storageBuffers[t]);return Z}dispose(s,Z,o){if(Z){let s;for(s in this._textures)this._textures[s].dispose();for(s in this._textureArrays){const Z=this._textureArrays[s];for(let s=0;s<Z.length;s++)Z[s].dispose()}}this._textures={},super.dispose(s,Z,o)}serialize(){const s=t.c.Serialize(this);let Z;for(Z in s.customType="BABYLON.ShaderMaterial",s.uniqueId=this.uniqueId,s.options=this._options,s.shaderPath=this._shaderPath,s.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,s.stencil=this.stencil.serialize(),s.textures={},this._textures)s.textures[Z]=this._textures[Z].serialize();for(Z in s.textureArrays={},this._textureArrays){s.textureArrays[Z]=[];const o=this._textureArrays[Z];for(let t=0;t<o.length;t++)s.textureArrays[Z].push(o[t].serialize())}for(Z in s.ints={},this._ints)s.ints[Z]=this._ints[Z];for(Z in s.uints={},this._uints)s.uints[Z]=this._uints[Z];for(Z in s.floats={},this._floats)s.floats[Z]=this._floats[Z];for(Z in s.floatsArrays={},this._floatsArrays)s.floatsArrays[Z]=this._floatsArrays[Z];for(Z in s.colors3={},this._colors3){const o=this._colors3[Z];s.colors3[Z]=[o.r,o.g,o.b]}for(Z in s.colors3Arrays={},this._colors3Arrays)s.colors3Arrays[Z]=this._colors3Arrays[Z];for(Z in s.colors4={},this._colors4){const o=this._colors4[Z];s.colors4[Z]=[o.r,o.g,o.b,o.a]}for(Z in s.colors4Arrays={},this._colors4Arrays)s.colors4Arrays[Z]=this._colors4Arrays[Z];for(Z in s.vectors2={},this._vectors2){const o=this._vectors2[Z];s.vectors2[Z]=[o.x,o.y]}for(Z in s.vectors3={},this._vectors3){const o=this._vectors3[Z];s.vectors3[Z]=[o.x,o.y,o.z]}for(Z in s.vectors4={},this._vectors4){const o=this._vectors4[Z];s.vectors4[Z]=[o.x,o.y,o.z,o.w]}for(Z in s.quaternions={},this._quaternions)s.quaternions[Z]=this._quaternions[Z].ma();for(Z in s.matrices={},this._matrices)s.matrices[Z]=this._matrices[Z].ma();for(Z in s.matrixArray={},this._matrixArrays)s.matrixArray[Z]=this._matrixArrays[Z];for(Z in s.matrices3x3={},this._matrices3x3)s.matrices3x3[Z]=this._matrices3x3[Z];for(Z in s.matrices2x2={},this._matrices2x2)s.matrices2x2[Z]=this._matrices2x2[Z];for(Z in s.vectors2Arrays={},this._vectors2Arrays)s.vectors2Arrays[Z]=this._vectors2Arrays[Z];for(Z in s.vectors3Arrays={},this._vectors3Arrays)s.vectors3Arrays[Z]=this._vectors3Arrays[Z];for(Z in s.vectors4Arrays={},this._vectors4Arrays)s.vectors4Arrays[Z]=this._vectors4Arrays[Z];for(Z in s.quaternionsArrays={},this._quaternionsArrays)s.quaternionsArrays[Z]=this._quaternionsArrays[Z];return s}static Parse(s,Z,o){const j=t.c.Parse((()=>new f(s.name,Z,s.shaderPath,s.options,s.storeEffectOnSubMeshes)),s,Z,o);let a;for(a in s.stencil&&j.stencil.parse(s.stencil,Z,o),s.textures)j.setTexture(a,O.c.Parse(s.textures[a],Z,o));for(a in s.textureArrays){const t=s.textureArrays[a],S=[];for(let s=0;s<t.length;s++)S.push(O.c.Parse(t[s],Z,o));j.setTextureArray(a,S)}for(a in s.ints)j.setInt(a,s.ints[a]);for(a in s.uints)j.setUInt(a,s.uints[a]);for(a in s.floats)j.setFloat(a,s.floats[a]);for(a in s.floatsArrays)j.setFloats(a,s.floatsArrays[a]);for(a in s.colors3){const Z=s.colors3[a];j.setColor3(a,{r:Z[0],g:Z[1],b:Z[2]})}for(a in s.colors3Arrays){const Z=s.colors3Arrays[a].reduce(((s,Z,o)=>(o%3===0?s.push([Z]):s[s.length-1].push(Z),s)),[]).map((s=>({r:s[0],g:s[1],b:s[2]})));j.setColor3Array(a,Z)}for(a in s.colors4){const Z=s.colors4[a];j.setColor4(a,{r:Z[0],g:Z[1],b:Z[2],a:Z[3]})}for(a in s.colors4Arrays){const Z=s.colors4Arrays[a].reduce(((s,Z,o)=>(o%4===0?s.push([Z]):s[s.length-1].push(Z),s)),[]).map((s=>({r:s[0],g:s[1],b:s[2],a:s[3]})));j.setColor4Array(a,Z)}for(a in s.vectors2){const Z=s.vectors2[a];j.setVector2(a,{x:Z[0],y:Z[1]})}for(a in s.vectors3){const Z=s.vectors3[a];j.setVector3(a,{x:Z[0],y:Z[1],z:Z[2]})}for(a in s.vectors4){const Z=s.vectors4[a];j.setVector4(a,{x:Z[0],y:Z[1],z:Z[2],w:Z[3]})}for(a in s.quaternions)j.setQuaternion(a,S.e.oO(s.quaternions[a]));for(a in s.matrices)j.setMatrix(a,S.b.oO(s.matrices[a]));for(a in s.matrixArray)j._matrixArrays[a]=new Float32Array(s.matrixArray[a]);for(a in s.matrices3x3)j.setMatrix3x3(a,s.matrices3x3[a]);for(a in s.matrices2x2)j.setMatrix2x2(a,s.matrices2x2[a]);for(a in s.vectors2Arrays)j.setArray2(a,s.vectors2Arrays[a]);for(a in s.vectors3Arrays)j.setArray3(a,s.vectors3Arrays[a]);for(a in s.vectors4Arrays)j.setArray4(a,s.vectors4Arrays[a]);for(a in s.quaternionsArrays)j.setArray4(a,s.quaternionsArrays[a]);return j}static async ParseFromFileAsync(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return await new Promise(((j,S)=>{const a=new B.c;a.addEventListener("readystatechange",(()=>{if(4==a.readyState)if(200==a.status){const Z=JSON.parse(a.responseText),S=this.Parse(Z,o||D.c.LastCreatedScene,t);s&&(S.name=s),j(S)}else S("Unable to load the ShaderMaterial")})),a.open("GET",Z),a.send()}))}static async ParseFromSnippetAsync(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return await new Promise(((t,j)=>{const S=new B.c;S.addEventListener("readystatechange",(()=>{if(4==S.readyState)if(200==S.status){const j=JSON.parse(JSON.parse(S.responseText).jsonPayload),a=JSON.parse(j.shaderMaterial),O=this.Parse(a,Z||D.c.LastCreatedScene,o);O.snippetId=s,t(O)}else j("Unable to load the snippet "+s)})),S.open("GET",this.SnippetUrl+"/"+s.replace(/#/g,"/")),S.send()}))}}f.SnippetUrl="https://snippet.babylonjs.com",f.CreateFromSnippetAsync=f.ParseFromSnippetAsync,(0,v.f)("BABYLON.ShaderMaterial",f)},11608:(s,Z,o)=>{o.d(Z,{e:()=>L});var t=o(11086),j=o(11091),S=o(11253),a=o(11493),O=o(11174),v=o(11113),G=o(11560),B=o(11502),Q=o(11081),D=o(11548),z=o(11566),Y=o(11410),b=o(10916),f=o(11572),A=o(11590),d=o(11598),U=o(11189),u=o(11181),H=o(11167),F=o(11601);const i={effect:null,subMesh:null};class N extends D.b{constructor(s){super(s),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(s){const Z=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const o of Z)this[o]=o===s}}class L extends z.e{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(s){this._attachImageProcessingConfiguration(s),this._markAllSubMeshesAsImageProcessingDirty()}_attachImageProcessingConfiguration(s){s!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=s||this.Ls().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(s){this.imageProcessingConfiguration.colorCurvesEnabled=s}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(s){this.imageProcessingConfiguration.colorGradingEnabled=s}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(s){this._imageProcessingConfiguration.toneMappingEnabled=s}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(s){this._imageProcessingConfiguration.exposure=s}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(s){this._imageProcessingConfiguration.contrast=s}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(s){this._imageProcessingConfiguration.colorGradingTexture=s}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(s){this._imageProcessingConfiguration.colorCurves=s}get canRenderToMRT(){return!0}constructor(s,Z){super(s,Z,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||L.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new O.d(0,0,0),this.diffuseColor=new O.d(1,1,1),this.specularColor=new O.d(1,1,1),this.emissiveColor=new O.d(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new S.f(16),this._globalAmbientColor=new O.d(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new d.d(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new G.e,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),L.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),L.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(L.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(L.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}getClassName(){return"zO"}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return this._hasTransparencyMode?this._transparencyModeIsTest:this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===Q.c.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.na&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==Q.c.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.na||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(s,Z){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._uniformBufferLayoutBuilt||this.buildUniformLayout();const j=Z._drawWrapper;if(j.effect&&this.isFrozen&&j._wasPreviouslyReady&&j._wasPreviouslyUsingInstances===t)return!0;Z.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),Z.materialDefines=new N(this._eventInfo.defineNames));const S=this.Ls(),a=Z.materialDefines;if(this._isReadyForSubMesh(Z))return!0;const O=S.getEngine();a._needNormals=(0,u.C)(S,s,a,!0,this._maxSimultaneousLights,this._disableLighting),(0,u.L)(S,a);const Q=this.needAlphaBlendingForMesh(s)&&this.Ls().useOrderIndependentTransparency;if((0,u.Q)(S,a,this.canRenderToMRT&&!Q),(0,u.N)(S,a,Q),F.c.PrepareDefines(O.currentRenderPassId,s,a),a._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,a._needUVs=!1;for(let s=1;s<=6;++s)a["MAINUV"+s]=!1;if(S.texturesEnabled){if(a.DIFFUSEDIRECTUV=0,a.BUMPDIRECTUV=0,a.AMBIENTDIRECTUV=0,a.OPACITYDIRECTUV=0,a.EMISSIVEDIRECTUV=0,a.SPECULARDIRECTUV=0,a.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&L.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,u.G)(this._diffuseTexture,a,"DIFFUSE")}else a.DIFFUSE=!1;if(this._ambientTexture&&L.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;(0,u.G)(this._ambientTexture,a,"AMBIENT")}else a.AMBIENT=!1;if(this._opacityTexture&&L.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;(0,u.G)(this._opacityTexture,a,"OPACITY"),a.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else a.OPACITY=!1;if(this._reflectionTexture&&L.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(a._needNormals=!0,a.REFLECTION=!0,a.ROUGHNESS=this._roughness>0,a.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,a.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===Y.c.INVCUBIC_MODE,a.REFLECTIONMAP_3D=this._reflectionTexture.isCube,a.REFLECTIONMAP_OPPOSITEZ=a.REFLECTIONMAP_3D&&this.Ls().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,a.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case Y.c.EXPLICIT_MODE:a.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case Y.c.PLANAR_MODE:a.setReflectionMode("REFLECTIONMAP_PLANAR");break;case Y.c.PROJECTION_MODE:a.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case Y.c.SKYBOX_MODE:a.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case Y.c.SPHERICAL_MODE:a.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case Y.c.EQUIRECTANGULAR_MODE:a.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case Y.c.FIXED_EQUIRECTANGULAR_MODE:a.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case Y.c.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:a.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case Y.c.CUBIC_MODE:case Y.c.INVCUBIC_MODE:default:a.setReflectionMode("REFLECTIONMAP_CUBIC")}a.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else a.REFLECTION=!1,a.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&L.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;(0,u.G)(this._emissiveTexture,a,"EMISSIVE")}else a.EMISSIVE=!1;if(this._lightmapTexture&&L.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;(0,u.G)(this._lightmapTexture,a,"LIGHTMAP"),a.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,a.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else a.LIGHTMAP=!1;if(this._specularTexture&&L.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;(0,u.G)(this._specularTexture,a,"SPECULAR"),a.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else a.SPECULAR=!1;if(S.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&L.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,u.G)(this._bumpTexture,a,"BUMP"),a.PARALLAX=this._useParallax,a.PARALLAX_RHS=S.useRightHandedSystem,a.PARALLAXOCCLUSION=this._useParallaxOcclusion,a.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else a.BUMP=!1,a.PARALLAX=!1,a.PARALLAX_RHS=!1,a.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&L.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;a._needUVs=!0,a.REFRACTION=!0,a.REFRACTIONMAP_3D=this._refractionTexture.isCube,a.RGBDREFRACTION=this._refractionTexture.isRGBD,a.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else a.REFRACTION=!1;a.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else a.DIFFUSE=!1,a.AMBIENT=!1,a.OPACITY=!1,a.REFLECTION=!1,a.EMISSIVE=!1,a.LIGHTMAP=!1,a.BUMP=!1,a.REFRACTION=!1;a.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),a.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,a.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,a.SPECULAROVERALPHA=this._useSpecularOverAlpha,a.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,a.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,a.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(s)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=a,this._eventInfo.subMesh=Z,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(a._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(a),a.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,a.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(a._areFresnelDirty&&(L.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(a.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,a.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,a.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,a.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,a.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,a.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,a._needNormals=!0,a.FRESNEL=!0):a.FRESNEL=!1),a.AREALIGHTUSED)for(let o=0;o<s.lightSources.length;o++)if(!s.lightSources[o]._isReady())return!1;(0,u.I)(s,S,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(s),a,this._applyDecalMapAfterDetailMap),(0,u.B)(S,O,this,a,t,null,Z.getRenderingMesh().hasThinInstances),this._eventInfo.defines=a,this._eventInfo.mesh=s,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,u.z)(s,a,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let D=!1;if(a.isDirty){const t=a._areLightsDisposed;a.markAsProcessed();const j=new A.c;a.REFLECTION&&j.addFallback(0,"REFLECTION"),a.SPECULAR&&j.addFallback(0,"SPECULAR"),a.BUMP&&j.addFallback(0,"BUMP"),a.PARALLAX&&j.addFallback(1,"PARALLAX"),a.PARALLAX_RHS&&j.addFallback(1,"PARALLAX_RHS"),a.PARALLAXOCCLUSION&&j.addFallback(0,"PARALLAXOCCLUSION"),a.SPECULAROVERALPHA&&j.addFallback(0,"SPECULAROVERALPHA"),a.FOG&&j.addFallback(1,"FOG"),a.POINTSIZE&&j.addFallback(0,"POINTSIZE"),a.LOGARITHMICDEPTH&&j.addFallback(0,"LOGARITHMICDEPTH"),(0,u.m)(a,j,this._maxSimultaneousLights),a.SPECULARTERM&&j.addFallback(0,"SPECULARTERM"),a.DIFFUSEFRESNEL&&j.addFallback(1,"DIFFUSEFRESNEL"),a.OPACITYFRESNEL&&j.addFallback(2,"OPACITYFRESNEL"),a.REFLECTIONFRESNEL&&j.addFallback(3,"REFLECTIONFRESNEL"),a.EMISSIVEFRESNEL&&j.addFallback(4,"EMISSIVEFRESNEL"),a.FRESNEL&&j.addFallback(4,"FRESNEL"),a.MULTIVIEW&&j.addFallback(0,"MULTIVIEW");const Q=[v.e.PositionKind];a.NORMAL&&Q.push(v.e.NormalKind),a.TANGENT&&Q.push(v.e.TangentKind);for(let s=1;s<=6;++s)a["UV"+s]&&Q.push(`uv${1===s?"":s}`);a.VERTEXCOLOR&&Q.push(v.e.ColorKind),(0,u.q)(Q,s,a,j),(0,u.s)(Q,a),(0,u.v)(Q,s,a),(0,u.n)(Q,s,a);let z="default";const Y=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],b=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],f=["Material","Scene","Mesh"],d={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:a.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=j,this._eventInfo.fallbackRank=0,this._eventInfo.defines=a,this._eventInfo.uniforms=Y,this._eventInfo.attributes=Q,this._eventInfo.samplers=b,this._eventInfo.uniformBuffersNames=f,this._eventInfo.customCode=void 0,this._eventInfo.mesh=s,this._eventInfo.indexParameters=d,this._callbackPluginEventGeneric(128,this._eventInfo),F.c.AddUniformsAndSamplers(Y,b),G.e.AddUniforms(Y),G.e.AddSamplers(b),B.c&&(B.c.PrepareUniforms(Y,a),B.c.PrepareSamplers(b,a)),(0,u.U)({uniformsNames:Y,uniformBuffersNames:f,samplers:b,defines:a,maxSimultaneousLights:this._maxSimultaneousLights}),(0,U.b)(Y);const H={};this.customShaderNameResolve&&(z=this.customShaderNameResolve(z,Y,f,b,a,Q,H));const N=a.toString(),L=Z.effect;let V=S.getEngine().createEffect(z,{attributes:Q,uniformsNames:Y,uniformBuffersNames:f,samplers:b,defines:N,fallbacks:j,onCompiled:this.onCompiled,onError:this.onError,indexParameters:d,processFinalCode:H.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:a.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([o.e(20),o.e(51)]).then(o.bind(o,14119)),Promise.all([o.e(18),o.e(52)]).then(o.bind(o,14135))]):await Promise.all([Promise.all([o.e(13),o.e(53)]).then(o.bind(o,14139)),Promise.all([o.e(12),o.e(54)]).then(o.bind(o,14155))]),this._shadersLoaded=!0}},O);if(this._eventInfo.customCode=void 0,V)if(this._onEffectCreatedObservable&&(i.effect=V,i.subMesh=Z,this._onEffectCreatedObservable.notifyObservers(i)),this.allowShaderHotSwapping&&L&&!V.isReady()){if(V=L,a.markAsUnprocessed(),D=this.isFrozen,t)return a._areLightsDisposed=!0,!1}else S.resetCachedMaterial(),Z.setEffect(V,a,this._materialContext)}return!(!Z.effect||!Z.effect.isReady())&&(a._renderId=S.getRenderId(),j._wasPreviouslyReady=!D,j._wasPreviouslyUsingInstances=t,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const s=this._uniformBuffer;s.addUniform("diffuseLeftColor",4),s.addUniform("diffuseRightColor",4),s.addUniform("opacityParts",4),s.addUniform("reflectionLeftColor",4),s.addUniform("reflectionRightColor",4),s.addUniform("refractionLeftColor",4),s.addUniform("refractionRightColor",4),s.addUniform("emissiveLeftColor",4),s.addUniform("emissiveRightColor",4),s.addUniform("vDiffuseInfos",2),s.addUniform("vAmbientInfos",2),s.addUniform("vOpacityInfos",2),s.addUniform("vReflectionInfos",2),s.addUniform("vReflectionPosition",3),s.addUniform("vReflectionSize",3),s.addUniform("vEmissiveInfos",2),s.addUniform("vLightmapInfos",2),s.addUniform("vSpecularInfos",2),s.addUniform("vBumpInfos",3),s.addUniform("diffuseMatrix",16),s.addUniform("ambientMatrix",16),s.addUniform("opacityMatrix",16),s.addUniform("reflectionMatrix",16),s.addUniform("emissiveMatrix",16),s.addUniform("lightmapMatrix",16),s.addUniform("specularMatrix",16),s.addUniform("bumpMatrix",16),s.addUniform("vTangentSpaceParams",2),s.addUniform("pointSize",1),s.addUniform("alphaCutOff",1),s.addUniform("refractionMatrix",16),s.addUniform("vRefractionInfos",4),s.addUniform("vRefractionPosition",3),s.addUniform("vRefractionSize",3),s.addUniform("vSpecularColor",4),s.addUniform("vEmissiveColor",3),s.addUniform("vDiffuseColor",4),s.addUniform("vAmbientColor",3),s.addUniform("cameraInfo",4),super.buildUniformLayout()}bindForSubMesh(s,Z,o){const t=this.Ls(),j=o.materialDefines;if(!j)return;const S=o.effect;if(!S)return;this._activeEffect=S,Z.getMeshUniformBuffer().bindToEffect(S,"Mesh"),Z.transferToEffect(s),this._uniformBuffer.bindToEffect(S,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,t,Z,s,this.isFrozen),F.c.Bind(t.getEngine().currentRenderPassId,this._activeEffect,Z,s,this);const v=t.activeCamera;v?this._uniformBuffer.updateFloat4("cameraInfo",v.OO,v.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=o,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),j.OBJECTSPACE_NORMALMAP&&(s.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const G=this._mustRebind(t,S,o,Z.visibility);(0,u.b)(Z,S);const B=this._uniformBuffer;if(G){if(this.bindViewProjection(S),!B.useUbo||!this.isFrozen||!B.isSync||o._drawWrapper._forceRebindOnNextCall){if(L.FresnelEnabled&&j.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(B.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),B.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&B.updateColor4("opacityParts",new O.d(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(B.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),B.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(B.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),B.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(B.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),B.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),t.texturesEnabled){if(this._diffuseTexture&&L.DiffuseTextureEnabled&&(B.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,u.l)(this._diffuseTexture,B,"diffuse")),this._ambientTexture&&L.AmbientTextureEnabled&&(B.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,u.l)(this._ambientTexture,B,"ambient")),this._opacityTexture&&L.OpacityTextureEnabled&&(B.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,u.l)(this._opacityTexture,B,"opacity")),this._hasAlphaChannel()&&B.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&L.ReflectionTextureEnabled){if(B.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),B.SO("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize){const s=this._reflectionTexture;B.updateVector3("vReflectionPosition",s.boundingBoxPosition),B.updateVector3("vReflectionSize",s.boundingBoxSize)}}else B.updateFloat2("vReflectionInfos",0,this.roughness);if(this._emissiveTexture&&L.EmissiveTextureEnabled&&(B.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,u.l)(this._emissiveTexture,B,"emissive")),this._lightmapTexture&&L.LightmapTextureEnabled&&(B.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,u.l)(this._lightmapTexture,B,"lightmap")),this._specularTexture&&L.SpecularTextureEnabled&&(B.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,u.l)(this._specularTexture,B,"specular")),this._bumpTexture&&t.getEngine().getCaps().standardDerivatives&&L.BumpTextureEnabled&&(B.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,u.l)(this._bumpTexture,B,"bump"),t._mirroredCameraPosition?B.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):B.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&L.RefractionTextureEnabled){let s=1;if(this._refractionTexture.isCube||(B.SO("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(s=this._refractionTexture.depth)),B.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,s,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const s=this._refractionTexture;B.updateVector3("vRefractionPosition",s.boundingBoxPosition),B.updateVector3("vRefractionSize",s.boundingBoxSize)}}}this.pointsCloud&&B.updateFloat("pointSize",this.pointSize),B.updateColor4("vSpecularColor",this.specularColor,this.specularPower),B.updateColor3("vEmissiveColor",L.EmissiveTextureEnabled?this.emissiveColor:O.d.BlackReadOnly),B.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),t.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),B.updateColor3("vAmbientColor",this._globalAmbientColor)}t.texturesEnabled&&(this._diffuseTexture&&L.DiffuseTextureEnabled&&S.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&L.AmbientTextureEnabled&&S.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&L.OpacityTextureEnabled&&S.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&L.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?S.setTexture("reflectionCubeSampler",this._reflectionTexture):S.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&L.EmissiveTextureEnabled&&S.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&L.LightmapTextureEnabled&&S.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&L.SpecularTextureEnabled&&S.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&t.getEngine().getCaps().standardDerivatives&&L.BumpTextureEnabled&&S.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&L.RefractionTextureEnabled&&(this._refractionTexture.isCube?S.setTexture("refractionCubeSampler",this._refractionTexture):S.setTexture("refraction2DSampler",this._refractionTexture))),this.Ls().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(Z)&&this.Ls().depthPeelingRenderer.bind(S),this._eventInfo.subMesh=o,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,U.f)(S,this,t),this.bindEyePosition(S)}else t.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(G||!this.isFrozen){var Q;if(t.lightsEnabled&&!this._disableLighting&&(0,u.g)(t,Z,S,j,this._maxSimultaneousLights),(t.fogEnabled&&Z.applyFog&&t.fogMode!==a.c.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||Z.receiveShadows||j.PREPASS)&&this.bindView(S),(0,u.e)(t,Z,S),j.NUM_MORPH_INFLUENCERS&&(0,u.j)(Z,S),j.BAKED_VERTEX_ANIMATION_TEXTURE)null===(Q=Z.bakedVertexAnimationManager)||void 0===Q||Q.bind(S,j.INSTANCES);this.useLogarithmicDepth&&(0,u.h)(j,S,t),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)}this._afterBind(Z,this._activeEffect,o),B.update()}getAnimatables(){const s=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&s.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&s.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&s.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&s.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&s.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&s.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&s.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&s.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&s.push(this._refractionTexture),s}getActiveTextures(){const s=super.getActiveTextures();return this._diffuseTexture&&s.push(this._diffuseTexture),this._ambientTexture&&s.push(this._ambientTexture),this._opacityTexture&&s.push(this._opacityTexture),this._reflectionTexture&&s.push(this._reflectionTexture),this._emissiveTexture&&s.push(this._emissiveTexture),this._specularTexture&&s.push(this._specularTexture),this._bumpTexture&&s.push(this._bumpTexture),this._lightmapTexture&&s.push(this._lightmapTexture),this._refractionTexture&&s.push(this._refractionTexture),s}hasTexture(s){return!!super.hasTexture(s)||(this._diffuseTexture===s||(this._ambientTexture===s||(this._opacityTexture===s||(this._reflectionTexture===s||(this._emissiveTexture===s||(this._specularTexture===s||(this._bumpTexture===s||(this._lightmapTexture===s||this._refractionTexture===s))))))))}dispose(s,Z){var o,t,j,S,a,O,v,G,B;Z&&(null===(o=this._diffuseTexture)||void 0===o||o.dispose(),null===(t=this._ambientTexture)||void 0===t||t.dispose(),null===(j=this._opacityTexture)||void 0===j||j.dispose(),null===(S=this._reflectionTexture)||void 0===S||S.dispose(),null===(a=this._emissiveTexture)||void 0===a||a.dispose(),null===(O=this._specularTexture)||void 0===O||O.dispose(),null===(v=this._bumpTexture)||void 0===v||v.dispose(),null===(G=this._lightmapTexture)||void 0===G||G.dispose(),null===(B=this._refractionTexture)||void 0===B||B.dispose());this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(s,Z)}clone(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const t=H.c.Clone((()=>new L(s,this.Ls())),this,{cloneTexturesOnlyOnce:Z});return t.name=s,t.id=s,this.stencil.copyTo(t.stencil),this._clonePlugins(t,o),t}static Parse(s,Z,o){const t=H.c.Parse((()=>new L(s.name,Z)),s,Z,o);return s.stencil&&t.stencil.parse(s.stencil,Z,o),Q.c._ParsePlugins(s,t,Z,o),t}static get DiffuseTextureEnabled(){return f.c.DiffuseTextureEnabled}static set DiffuseTextureEnabled(s){f.c.DiffuseTextureEnabled=s}static get DetailTextureEnabled(){return f.c.DetailTextureEnabled}static set DetailTextureEnabled(s){f.c.DetailTextureEnabled=s}static get AmbientTextureEnabled(){return f.c.AmbientTextureEnabled}static set AmbientTextureEnabled(s){f.c.AmbientTextureEnabled=s}static get OpacityTextureEnabled(){return f.c.OpacityTextureEnabled}static set OpacityTextureEnabled(s){f.c.OpacityTextureEnabled=s}static get ReflectionTextureEnabled(){return f.c.ReflectionTextureEnabled}static set ReflectionTextureEnabled(s){f.c.ReflectionTextureEnabled=s}static get EmissiveTextureEnabled(){return f.c.EmissiveTextureEnabled}static set EmissiveTextureEnabled(s){f.c.EmissiveTextureEnabled=s}static get SpecularTextureEnabled(){return f.c.SpecularTextureEnabled}static set SpecularTextureEnabled(s){f.c.SpecularTextureEnabled=s}static get BumpTextureEnabled(){return f.c.BumpTextureEnabled}static set BumpTextureEnabled(s){f.c.BumpTextureEnabled=s}static get LightmapTextureEnabled(){return f.c.LightmapTextureEnabled}static set LightmapTextureEnabled(s){f.c.LightmapTextureEnabled=s}static get RefractionTextureEnabled(){return f.c.RefractionTextureEnabled}static set RefractionTextureEnabled(s){f.c.RefractionTextureEnabled=s}static get ColorGradingTextureEnabled(){return f.c.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(s){f.c.ColorGradingTextureEnabled=s}static get FresnelEnabled(){return f.c.FresnelEnabled}static set FresnelEnabled(s){f.c.FresnelEnabled=s}}L.ForceGLSL=!1,(0,t.c)([(0,j.D)("diffuseTexture")],L.prototype,"_diffuseTexture",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],L.prototype,"diffuseTexture",void 0),(0,t.c)([(0,j.D)("ambientTexture")],L.prototype,"_ambientTexture",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"ambientTexture",void 0),(0,t.c)([(0,j.D)("opacityTexture")],L.prototype,"_opacityTexture",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],L.prototype,"opacityTexture",void 0),(0,t.c)([(0,j.D)("reflectionTexture")],L.prototype,"_reflectionTexture",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"reflectionTexture",void 0),(0,t.c)([(0,j.D)("emissiveTexture")],L.prototype,"_emissiveTexture",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"emissiveTexture",void 0),(0,t.c)([(0,j.D)("specularTexture")],L.prototype,"_specularTexture",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"specularTexture",void 0),(0,t.c)([(0,j.D)("bumpTexture")],L.prototype,"_bumpTexture",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"bumpTexture",void 0),(0,t.c)([(0,j.D)("lightmapTexture")],L.prototype,"_lightmapTexture",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"lightmapTexture",void 0),(0,t.c)([(0,j.D)("refractionTexture")],L.prototype,"_refractionTexture",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"refractionTexture",void 0),(0,t.c)([(0,j.i)("ambient")],L.prototype,"ambientColor",void 0),(0,t.c)([(0,j.i)("diffuse")],L.prototype,"diffuseColor",void 0),(0,t.c)([(0,j.i)("specular")],L.prototype,"specularColor",void 0),(0,t.c)([(0,j.i)("emissive")],L.prototype,"emissiveColor",void 0),(0,t.c)([(0,j.K)()],L.prototype,"specularPower",void 0),(0,t.c)([(0,j.K)("useAlphaFromDiffuseTexture")],L.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],L.prototype,"useAlphaFromDiffuseTexture",void 0),(0,t.c)([(0,j.K)("useEmissiveAsIllumination")],L.prototype,"_useEmissiveAsIllumination",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"useEmissiveAsIllumination",void 0),(0,t.c)([(0,j.K)("linkEmissiveWithDiffuse")],L.prototype,"_linkEmissiveWithDiffuse",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"linkEmissiveWithDiffuse",void 0),(0,t.c)([(0,j.K)("useSpecularOverAlpha")],L.prototype,"_useSpecularOverAlpha",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"useSpecularOverAlpha",void 0),(0,t.c)([(0,j.K)("useReflectionOverAlpha")],L.prototype,"_useReflectionOverAlpha",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"useReflectionOverAlpha",void 0),(0,t.c)([(0,j.K)("disableLighting")],L.prototype,"_disableLighting",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsLightsDirty")],L.prototype,"disableLighting",void 0),(0,t.c)([(0,j.K)("useObjectSpaceNormalMap")],L.prototype,"_useObjectSpaceNormalMap",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"useObjectSpaceNormalMap",void 0),(0,t.c)([(0,j.K)("useParallax")],L.prototype,"_useParallax",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"useParallax",void 0),(0,t.c)([(0,j.K)("useParallaxOcclusion")],L.prototype,"_useParallaxOcclusion",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"useParallaxOcclusion",void 0),(0,t.c)([(0,j.K)()],L.prototype,"parallaxScaleBias",void 0),(0,t.c)([(0,j.K)("roughness")],L.prototype,"_roughness",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"roughness",void 0),(0,t.c)([(0,j.K)()],L.prototype,"indexOfRefraction",void 0),(0,t.c)([(0,j.K)()],L.prototype,"invertRefractionY",void 0),(0,t.c)([(0,j.K)()],L.prototype,"alphaCutOff",void 0),(0,t.c)([(0,j.K)("useLightmapAsShadowmap")],L.prototype,"_useLightmapAsShadowmap",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"useLightmapAsShadowmap",void 0),(0,t.c)([(0,j.n)("diffuseFresnelParameters")],L.prototype,"_diffuseFresnelParameters",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsFresnelDirty")],L.prototype,"diffuseFresnelParameters",void 0),(0,t.c)([(0,j.n)("opacityFresnelParameters")],L.prototype,"_opacityFresnelParameters",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsFresnelAndMiscDirty")],L.prototype,"opacityFresnelParameters",void 0),(0,t.c)([(0,j.n)("reflectionFresnelParameters")],L.prototype,"_reflectionFresnelParameters",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsFresnelDirty")],L.prototype,"reflectionFresnelParameters",void 0),(0,t.c)([(0,j.n)("refractionFresnelParameters")],L.prototype,"_refractionFresnelParameters",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsFresnelDirty")],L.prototype,"refractionFresnelParameters",void 0),(0,t.c)([(0,j.n)("emissiveFresnelParameters")],L.prototype,"_emissiveFresnelParameters",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsFresnelDirty")],L.prototype,"emissiveFresnelParameters",void 0),(0,t.c)([(0,j.K)("useReflectionFresnelFromSpecular")],L.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsFresnelDirty")],L.prototype,"useReflectionFresnelFromSpecular",void 0),(0,t.c)([(0,j.K)("useGlossinessFromSpecularMapAlpha")],L.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,t.c)([(0,j.K)("maxSimultaneousLights")],L.prototype,"_maxSimultaneousLights",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsLightsDirty")],L.prototype,"maxSimultaneousLights",void 0),(0,t.c)([(0,j.K)("invertNormalMapX")],L.prototype,"_invertNormalMapX",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"invertNormalMapX",void 0),(0,t.c)([(0,j.K)("invertNormalMapY")],L.prototype,"_invertNormalMapY",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"invertNormalMapY",void 0),(0,t.c)([(0,j.K)("twoSidedLighting")],L.prototype,"_twoSidedLighting",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"twoSidedLighting",void 0),(0,t.c)([(0,j.K)("applyDecalMapAfterDetailMap")],L.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,t.c)([(0,j.c)("_markAllSubMeshesAsMiscDirty")],L.prototype,"applyDecalMapAfterDetailMap",void 0),(0,b.f)("BABYLON.StandardMaterial",L),a.c.DefaultMaterialFactory=s=>new L("default material",s)},11155:(s,Z,o)=>{o.d(Z,{e:()=>S});var t=o(10955),j=o(10938);class S{constructor(s,Z,o,t){let j=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._valueCache={},this._engine=s,this._noUBO=!s.supportsUniformBuffers||j,this._dynamic=o,this._name=t??"no-name",this._data=Z||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.SO=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.SO=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get useUbo(){return!this._noUBO}get isSync(){return!this._needSync}isDynamic(){return void 0!==this._dynamic}getData(){return this._bufferData}getBuffer(){return this._buffer}_fillAlignment(s){let Z;if(Z=s<=2?s:4,this._uniformLocationPointer%Z!==0){const s=this._uniformLocationPointer;this._uniformLocationPointer+=Z-this._uniformLocationPointer%Z;const o=this._uniformLocationPointer-s;for(let Z=0;Z<o;Z++)this._data.push(0)}}addUniform(s,Z){let o,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this._noUBO&&void 0===this._uniformLocations[s]){if(t>0){if(Z instanceof Array)throw"addUniform should not be use with Array in UBO: "+s;if(this._fillAlignment(4),this._uniformArraySizes[s]={strideSize:Z,arraySize:t},16==Z)Z*=t;else{Z=Z*t+(4-Z)*t}o=[];for(let s=0;s<Z;s++)o.push(0)}else{if(Z instanceof Array)o=Z,Z=o.length;else{o=[];for(let s=0;s<Z;s++)o.push(0)}this._fillAlignment(Z)}this._uniformSizes[s]=Z,this._uniformLocations[s]=this._uniformLocationPointer,this._uniformLocationPointer+=Z;for(let s=0;s<Z;s++)this._data.push(o[s]);this._needSync=!0}}addMatrix(s,Z){this.addUniform(s,Array.prototype.slice.call(Z.ma()))}addFloat2(s,Z,o){const t=[Z,o];this.addUniform(s,t)}addFloat3(s,Z,o,t){const j=[Z,o,t];this.addUniform(s,j)}addColor3(s,Z){const o=[Z.r,Z.g,Z.b];this.addUniform(s,o)}addColor4(s,Z,o){const t=[Z.r,Z.g,Z.b,o];this.addUniform(s,t)}addVector3(s,Z){const o=[Z.x,Z.y,Z.z];this.addUniform(s,o)}addMatrix3x3(s){this.addUniform(s,12)}addMatrix2x2(s){this.addUniform(s,8)}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}_getNames(){const s=[];let Z=0;for(const o in this._uniformLocations)if(s.push(o),10===++Z)break;return s.join(",")}_rebuild(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}get _numBuffers(){return this._buffers.length}get _indexBuffer(){return this._bufferIndex}get name(){return this._name}get currentEffect(){return this._currentEffect}_buffersEqual(s,Z){for(let o=0;o<s.length;++o)if(s[o]!==Z[o])return!1;return!0}_copyBuffer(s,Z){for(let o=0;o<s.length;++o)Z[o]=s[o]}update(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(S._UpdatedUbosInFrame[this._name]||(S._UpdatedUbosInFrame[this._name]=0),S._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}updateUniform(s,Z,o){this._checkNewFrame();let j=this._uniformLocations[s];if(void 0===j){if(this._buffer)return void t.b.Error("Cannot add an uniform after UBO has been created. uniformName="+s);this.addUniform(s,o),j=this._uniformLocations[s]}if(this._buffer||this.create(),this._dynamic)for(let t=0;t<o;t++)this._bufferData[j+t]=Z[t];else{let s=!1;for(let t=0;t<o;t++)(16===o&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[j+t]!==Math.fround(Z[t]))&&(s=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[j+t]=Z[t]);this._needSync=this._needSync||s}}updateUniformArray(s,Z,o){this._checkNewFrame();const S=this._uniformLocations[s];if(void 0===S)return void t.b.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");this._buffer||this.create();const a=this._uniformArraySizes[s];if(this._dynamic)for(let t=0;t<o;t++)this._bufferData[S+t]=Z[t];else{let s=!1,t=0,O=0;for(let v=0;v<o;v++)if(this._bufferData[S+4*O+t]!==j.g.FloatRound(Z[v])&&(s=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[S+4*O+t]=Z[v]),t++,t===a.strideSize){for(;t<4;t++)this._bufferData[S+4*O+t]=0;t=0,O++}this._needSync=this._needSync||s}}_cacheMatrix(s,Z){this._checkNewFrame();const o=this._valueCache[s],t=Z.updateFlag;return(void 0===o||o!==t)&&(this._valueCache[s]=t,!0)}_updateMatrix3x3ForUniform(s,Z){for(let o=0;o<3;o++)S._TempBuffer[4*o]=Z[3*o],S._TempBuffer[4*o+1]=Z[3*o+1],S._TempBuffer[4*o+2]=Z[3*o+2],S._TempBuffer[4*o+3]=0;this.updateUniform(s,S._TempBuffer,12)}_updateMatrix3x3ForEffect(s,Z){this._currentEffect.setMatrix3x3(s,Z)}_updateMatrix2x2ForEffect(s,Z){this._currentEffect.setMatrix2x2(s,Z)}_updateMatrix2x2ForUniform(s,Z){for(let o=0;o<2;o++)S._TempBuffer[4*o]=Z[2*o],S._TempBuffer[4*o+1]=Z[2*o+1],S._TempBuffer[4*o+2]=0,S._TempBuffer[4*o+3]=0;this.updateUniform(s,S._TempBuffer,8)}_updateFloatForEffect(s,Z){this._currentEffect.setFloat(s,Z)}_updateFloatForUniform(s,Z){S._TempBuffer[0]=Z,this.updateUniform(s,S._TempBuffer,1)}_updateFloat2ForEffect(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setFloat2(s+t,Z,o)}_updateFloat2ForUniform(s,Z,o){S._TempBuffer[0]=Z,S._TempBuffer[1]=o,this.updateUniform(s,S._TempBuffer,2)}_updateFloat3ForEffect(s,Z,o,t){let j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setFloat3(s+j,Z,o,t)}_updateFloat3ForUniform(s,Z,o,t){S._TempBuffer[0]=Z,S._TempBuffer[1]=o,S._TempBuffer[2]=t,this.updateUniform(s,S._TempBuffer,3)}_updateFloat4ForEffect(s,Z,o,t,j){let S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setFloat4(s+S,Z,o,t,j)}_updateFloat4ForUniform(s,Z,o,t,j){S._TempBuffer[0]=Z,S._TempBuffer[1]=o,S._TempBuffer[2]=t,S._TempBuffer[3]=j,this.updateUniform(s,S._TempBuffer,4)}_updateFloatArrayForEffect(s,Z){this._currentEffect.setFloatArray(s,Z)}_updateFloatArrayForUniform(s,Z){this.updateUniformArray(s,Z,Z.length)}_updateArrayForEffect(s,Z){this._currentEffect.setArray(s,Z)}_updateArrayForUniform(s,Z){this.updateUniformArray(s,Z,Z.length)}_updateIntArrayForEffect(s,Z){this._currentEffect.setIntArray(s,Z)}_updateIntArrayForUniform(s,Z){S._TempBufferInt32View.set(Z),this.updateUniformArray(s,S._TempBuffer,Z.length)}_updateUIntArrayForEffect(s,Z){this._currentEffect.setUIntArray(s,Z)}_updateUIntArrayForUniform(s,Z){S._TempBufferUInt32View.set(Z),this.updateUniformArray(s,S._TempBuffer,Z.length)}_updateMatrixForEffect(s,Z){this._currentEffect.setMatrix(s,Z)}_updateMatrixForUniform(s,Z){this._cacheMatrix(s,Z)&&this.updateUniform(s,Z.ma(),16)}_updateMatricesForEffect(s,Z){this._currentEffect.setMatrices(s,Z)}_updateMatricesForUniform(s,Z){this.updateUniform(s,Z,Z.length)}_updateVector3ForEffect(s,Z){this._currentEffect.setVector3(s,Z)}_updateVector3ForUniform(s,Z){S._TempBuffer[0]=Z.x,S._TempBuffer[1]=Z.y,S._TempBuffer[2]=Z.z,this.updateUniform(s,S._TempBuffer,3)}_updateVector4ForEffect(s,Z){this._currentEffect.setVector4(s,Z)}_updateVector4ForUniform(s,Z){S._TempBuffer[0]=Z.x,S._TempBuffer[1]=Z.y,S._TempBuffer[2]=Z.z,S._TempBuffer[3]=Z.w,this.updateUniform(s,S._TempBuffer,4)}_updateColor3ForEffect(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setColor3(s+o,Z)}_updateColor3ForUniform(s,Z){S._TempBuffer[0]=Z.r,S._TempBuffer[1]=Z.g,S._TempBuffer[2]=Z.b,this.updateUniform(s,S._TempBuffer,3)}_updateColor4ForEffect(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setColor4(s+t,Z,o)}_updateDirectColor4ForEffect(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setDirectColor4(s+o,Z)}_updateColor4ForUniform(s,Z,o){S._TempBuffer[0]=Z.r,S._TempBuffer[1]=Z.g,S._TempBuffer[2]=Z.b,S._TempBuffer[3]=o,this.updateUniform(s,S._TempBuffer,4)}_updateDirectColor4ForUniform(s,Z){S._TempBuffer[0]=Z.r,S._TempBuffer[1]=Z.g,S._TempBuffer[2]=Z.b,S._TempBuffer[3]=Z.a,this.updateUniform(s,S._TempBuffer,4)}_updateIntForEffect(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setInt(s+o,Z)}_updateIntForUniform(s,Z){S._TempBufferInt32View[0]=Z,this.updateUniform(s,S._TempBuffer,1)}_updateInt2ForEffect(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setInt2(s+t,Z,o)}_updateInt2ForUniform(s,Z,o){S._TempBufferInt32View[0]=Z,S._TempBufferInt32View[1]=o,this.updateUniform(s,S._TempBuffer,2)}_updateInt3ForEffect(s,Z,o,t){let j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setInt3(s+j,Z,o,t)}_updateInt3ForUniform(s,Z,o,t){S._TempBufferInt32View[0]=Z,S._TempBufferInt32View[1]=o,S._TempBufferInt32View[2]=t,this.updateUniform(s,S._TempBuffer,3)}_updateInt4ForEffect(s,Z,o,t,j){let S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setInt4(s+S,Z,o,t,j)}_updateInt4ForUniform(s,Z,o,t,j){S._TempBufferInt32View[0]=Z,S._TempBufferInt32View[1]=o,S._TempBufferInt32View[2]=t,S._TempBufferInt32View[3]=j,this.updateUniform(s,S._TempBuffer,4)}_updateUIntForEffect(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setUInt(s+o,Z)}_updateUIntForUniform(s,Z){S._TempBufferUInt32View[0]=Z,this.updateUniform(s,S._TempBuffer,1)}_updateUInt2ForEffect(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setUInt2(s+t,Z,o)}_updateUInt2ForUniform(s,Z,o){S._TempBufferUInt32View[0]=Z,S._TempBufferUInt32View[1]=o,this.updateUniform(s,S._TempBuffer,2)}_updateUInt3ForEffect(s,Z,o,t){let j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setUInt3(s+j,Z,o,t)}_updateUInt3ForUniform(s,Z,o,t){S._TempBufferUInt32View[0]=Z,S._TempBufferUInt32View[1]=o,S._TempBufferUInt32View[2]=t,this.updateUniform(s,S._TempBuffer,3)}_updateUInt4ForEffect(s,Z,o,t,j){let S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setUInt4(s+S,Z,o,t,j)}_updateUInt4ForUniform(s,Z,o,t,j){S._TempBufferUInt32View[0]=Z,S._TempBufferUInt32View[1]=o,S._TempBufferUInt32View[2]=t,S._TempBufferUInt32View[3]=j,this.updateUniform(s,S._TempBuffer,4)}setTexture(s,Z){this._currentEffect.setTexture(s,Z)}setTextureArray(s,Z){this._currentEffect.setTextureArray(s,Z)}bindTexture(s,Z){this._currentEffect._bindTexture(s,Z)}updateUniformDirectly(s,Z){this.updateUniform(s,Z,Z.length),this.update()}bindToEffect(s,Z){this._currentEffect=s,this._currentEffectName=Z}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}setDataBuffer(s){if(!this._buffers)return this._buffer===s;for(let Z=0;Z<this._buffers.length;++Z){if(this._buffers[Z][0]===s)return this._bufferIndex=Z,this._buffer=s,this._createBufferOnWrite=!1,this._currentEffect=void 0,this._buffers.length>1&&this._buffers[Z][1]&&this._bufferData.set(this._buffers[Z][1]),this._valueCache={},this._currentFrameId=this._engine.frameId,!0}return!1}dispose(){if(this._noUBO)return;const s=this._engine._uniformBuffers,Z=s.indexOf(this);if(-1!==Z&&(s[Z]=s[s.length-1],s.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let o=0;o<this._buffers.length;++o){const s=this._buffers[o][0];this._engine._releaseBuffer(s)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}S._UpdatedUbosInFrame={},S._MAX_UNIFORM_SIZE=256,S._TempBuffer=new Float32Array(S._MAX_UNIFORM_SIZE),S._TempBufferInt32View=new Int32Array(S._TempBuffer.buffer),S._TempBufferUInt32View=new Uint32Array(S._TempBuffer.buffer)},11229:(s,Z,o)=>{o.d(Z,{c:()=>a,d:()=>t});var t,j,S=o(10900);!function(s){s[s.LOCAL=0]="LOCAL",s[s.WORLD=1]="WORLD",s[s.BONE=2]="BONE"}(t||(t={}));class a{}a.X=new S.n(1,0,0),a.Y=new S.n(0,1,0),a.Z=new S.n(0,0,1),function(s){s[s.X=0]="X",s[s.Y=1]="Y",s[s.Z=2]="Z"}(j||(j={}))},11174:(s,Z,o)=>{o.d(Z,{d:()=>Q,h:()=>D,k:()=>z});var t=o(10911),j=o(10916),S=o(10904),a=o(10935);function O(s){return Math.pow(s,S.j)}function v(s){return s<=.04045?.0773993808*s:Math.pow(.947867299*(s+.055),2.4)}function G(s){return Math.pow(s,S.i)}function B(s){return s<=.0031308?12.92*s:1.055*Math.pow(s,.41666)-.055}class Q{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.r=s,this.g=Z,this.b=o}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"pz"}getHashCode(){let s=255*this.r|0;return s=397*s^255*this.g,s=397*s^255*this.b,s}toArray(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return s[Z]=this.r,s[Z+1]=this.g,s[Z+2]=this.b,this}Bo(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Q.FromArrayToRef(s,Z,this),this}toColor4(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new D(this.r,this.g,this.b,s)}ma(){return[this.r,this.g,this.b]}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(s){return new Q(this.r*s.r,this.g*s.g,this.b*s.b)}multiplyToRef(s,Z){return Z.r=this.r*s.r,Z.g=this.g*s.g,Z.b=this.b*s.b,Z}multiplyInPlace(s){return this.r*=s.r,this.g*=s.g,this.b*=s.b,this}multiplyByFloats(s,Z,o){return new Q(this.r*s,this.g*Z,this.b*o)}divide(s){throw new ReferenceError("Can not divide a color")}divideToRef(s,Z){throw new ReferenceError("Can not divide a color")}divideInPlace(s){throw new ReferenceError("Can not divide a color")}minimizeInPlace(s){return this.minimizeInPlaceFromFloats(s.r,s.g,s.b)}maximizeInPlace(s){return this.maximizeInPlaceFromFloats(s.r,s.g,s.b)}minimizeInPlaceFromFloats(s,Z,o){return this.r=Math.min(s,this.r),this.g=Math.min(Z,this.g),this.b=Math.min(o,this.b),this}maximizeInPlaceFromFloats(s,Z,o){return this.r=Math.max(s,this.r),this.g=Math.max(Z,this.g),this.b=Math.max(o,this.b),this}floorToRef(s){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(s){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}equals(s){return s&&this.r===s.r&&this.g===s.g&&this.b===s.b}equalsFloats(s,Z,o){return this.equalsToFloats(s,Z,o)}equalsToFloats(s,Z,o){return this.r===s&&this.g===Z&&this.b===o}equalsWithEpsilon(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S.b;return(0,a.WithinEpsilon)(this.r,s.r,Z)&&(0,a.WithinEpsilon)(this.g,s.g,Z)&&(0,a.WithinEpsilon)(this.b,s.b,Z)}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(s){throw new ReferenceError("Can not negate a color")}scale(s){return new Q(this.r*s,this.g*s,this.b*s)}scaleInPlace(s){return this.r*=s,this.g*=s,this.b*=s,this}scaleToRef(s,Z){return Z.r=this.r*s,Z.g=this.g*s,Z.b=this.b*s,Z}scaleAndAddToRef(s,Z){return Z.r+=this.r*s,Z.g+=this.g*s,Z.b+=this.b*s,Z}clampToRef(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2?arguments[2]:void 0;return o.r=(0,a.Clamp)(this.r,s,Z),o.g=(0,a.Clamp)(this.g,s,Z),o.b=(0,a.Clamp)(this.b,s,Z),o}add(s){return new Q(this.r+s.r,this.g+s.g,this.b+s.b)}addInPlace(s){return this.r+=s.r,this.g+=s.g,this.b+=s.b,this}addInPlaceFromFloats(s,Z,o){return this.r+=s,this.g+=Z,this.b+=o,this}addToRef(s,Z){return Z.r=this.r+s.r,Z.g=this.g+s.g,Z.b=this.b+s.b,Z}Go(s){return new Q(this.r-s.r,this.g-s.g,this.b-s.b)}subtractToRef(s,Z){return Z.r=this.r-s.r,Z.g=this.g-s.g,Z.b=this.b-s.b,Z}RB(s){return this.r-=s.r,this.g-=s.g,this.b-=s.b,this}subtractFromFloats(s,Z,o){return new Q(this.r-s,this.g-Z,this.b-o)}subtractFromFloatsToRef(s,Z,o,t){return t.r=this.r-s,t.g=this.g-Z,t.b=this.b-o,t}clone(){return new Q(this.r,this.g,this.b)}O(s){return this.r=s.r,this.g=s.g,this.b=s.b,this}Ja(s,Z,o){return this.r=s,this.g=Z,this.b=o,this}set(s,Z,o){return this.Ja(s,Z,o)}tO(s){return this.r=this.g=this.b=s,this}toHexString(){const s=Math.round(255*this.r),Z=Math.round(255*this.g),o=Math.round(255*this.b);return"#"+(0,a.ToHex)(s)+(0,a.ToHex)(Z)+(0,a.ToHex)(o)}fromHexString(s){return"#"!==s.substring(0,1)||7!==s.length||(this.r=parseInt(s.substring(1,3),16)/255,this.g=parseInt(s.substring(3,5),16)/255,this.b=parseInt(s.substring(5,7),16)/255),this}toHSV(){return this.toHSVToRef(new Q)}toHSVToRef(s){const Z=this.r,o=this.g,t=this.b,j=Math.max(Z,o,t),S=Math.min(Z,o,t);let a=0,O=0;const v=j,G=j-S;return 0!==j&&(O=G/j),j!=S&&(j==Z?(a=(o-t)/G,o<t&&(a+=6)):j==o?a=(t-Z)/G+2:j==t&&(a=(Z-o)/G+4),a*=60),s.r=a,s.g=O,s.b=v,s}toLinearSpace(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Z=new Q;return this.toLinearSpaceToRef(Z,s),Z}toLinearSpaceToRef(s){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(s.r=v(this.r),s.g=v(this.g),s.b=v(this.b)):(s.r=O(this.r),s.g=O(this.g),s.b=O(this.b)),this}toGammaSpace(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Z=new Q;return this.toGammaSpaceToRef(Z,s),Z}toGammaSpaceToRef(s){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(s.r=B(this.r),s.g=B(this.g),s.b=B(this.b)):(s.r=G(this.r),s.g=G(this.g),s.b=G(this.b)),this}static HSVtoRGBToRef(s,Z,o,t){const j=o*Z,S=s/60,a=j*(1-Math.abs(S%2-1));let O=0,v=0,G=0;S>=0&&S<=1?(O=j,v=a):S>=1&&S<=2?(O=a,v=j):S>=2&&S<=3?(v=j,G=a):S>=3&&S<=4?(v=a,G=j):S>=4&&S<=5?(O=a,G=j):S>=5&&S<=6&&(O=j,G=a);const B=o-j;return t.r=O+B,t.g=v+B,t.b=G+B,t}static FromHSV(s,Z,o){const t=new Q(0,0,0);return Q.HSVtoRGBToRef(s,Z,o,t),t}static FromHexString(s){return new Q(0,0,0).fromHexString(s)}static oO(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new Q(s[Z],s[Z+1],s[Z+2])}static FromArrayToRef(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;o.r=s[Z],o.g=s[Z+1],o.b=s[Z+2]}static FromInts(s,Z,o){return new Q(s/255,Z/255,o/255)}static Lerp(s,Z,o){const t=new Q(0,0,0);return Q.LerpToRef(s,Z,o,t),t}static LerpToRef(s,Z,o,t){t.r=s.r+(Z.r-s.r)*o,t.g=s.g+(Z.g-s.g)*o,t.b=s.b+(Z.b-s.b)*o}static Hermite(s,Z,o,t,j){const S=j*j,a=j*S,O=2*a-3*S+1,v=-2*a+3*S,G=a-2*S+j,B=a-S,D=s.r*O+o.r*v+Z.r*G+t.r*B,z=s.g*O+o.g*v+Z.g*G+t.g*B,Y=s.b*O+o.b*v+Z.b*G+t.b*B;return new Q(D,z,Y)}static Hermite1stDerivative(s,Z,o,t,j){const S=Q.Black();return this.Hermite1stDerivativeToRef(s,Z,o,t,j,S),S}static Hermite1stDerivativeToRef(s,Z,o,t,j,S){const a=j*j;S.r=6*(a-j)*s.r+(3*a-4*j+1)*Z.r+6*(-a+j)*o.r+(3*a-2*j)*t.r,S.g=6*(a-j)*s.g+(3*a-4*j+1)*Z.g+6*(-a+j)*o.g+(3*a-2*j)*t.g,S.b=6*(a-j)*s.b+(3*a-4*j+1)*Z.b+6*(-a+j)*o.b+(3*a-2*j)*t.b}static Red(){return new Q(1,0,0)}static Green(){return new Q(0,1,0)}static Blue(){return new Q(0,0,1)}static Black(){return new Q(0,0,0)}static get BlackReadOnly(){return Q._BlackReadOnly}static White(){return new Q(1,1,1)}static Purple(){return new Q(.5,0,.5)}static Magenta(){return new Q(1,0,1)}static Yellow(){return new Q(1,1,0)}static Gray(){return new Q(.5,.5,.5)}static Teal(){return new Q(0,1,1)}static Random(){return new Q(Math.random(),Math.random(),Math.random())}}Q._V8PerformanceHack=new Q(.5,.5,.5),Q._BlackReadOnly=Q.Black(),Object.defineProperties(Q.prototype,{dimension:{value:[3]},rank:{value:1}});class D{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=s,this.g=Z,this.b=o,this.a=t}ma(){return[this.r,this.g,this.b,this.a]}toArray(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return s[Z]=this.r,s[Z+1]=this.g,s[Z+2]=this.b,s[Z+3]=this.a,this}Bo(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=s[Z],this.g=s[Z+1],this.b=s[Z+2],this.a=s[Z+3],this}equals(s){return s&&this.r===s.r&&this.g===s.g&&this.b===s.b&&this.a===s.a}add(s){return new D(this.r+s.r,this.g+s.g,this.b+s.b,this.a+s.a)}addToRef(s,Z){return Z.r=this.r+s.r,Z.g=this.g+s.g,Z.b=this.b+s.b,Z.a=this.a+s.a,Z}addInPlace(s){return this.r+=s.r,this.g+=s.g,this.b+=s.b,this.a+=s.a,this}addInPlaceFromFloats(s,Z,o,t){return this.r+=s,this.g+=Z,this.b+=o,this.a+=t,this}Go(s){return new D(this.r-s.r,this.g-s.g,this.b-s.b,this.a-s.a)}subtractToRef(s,Z){return Z.r=this.r-s.r,Z.g=this.g-s.g,Z.b=this.b-s.b,Z.a=this.a-s.a,Z}RB(s){return this.r-=s.r,this.g-=s.g,this.b-=s.b,this.a-=s.a,this}subtractFromFloats(s,Z,o,t){return new D(this.r-s,this.g-Z,this.b-o,this.a-t)}subtractFromFloatsToRef(s,Z,o,t,j){return j.r=this.r-s,j.g=this.g-Z,j.b=this.b-o,j.a=this.a-t,j}scale(s){return new D(this.r*s,this.g*s,this.b*s,this.a*s)}scaleInPlace(s){return this.r*=s,this.g*=s,this.b*=s,this.a*=s,this}scaleToRef(s,Z){return Z.r=this.r*s,Z.g=this.g*s,Z.b=this.b*s,Z.a=this.a*s,Z}scaleAndAddToRef(s,Z){return Z.r+=this.r*s,Z.g+=this.g*s,Z.b+=this.b*s,Z.a+=this.a*s,Z}clampToRef(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2?arguments[2]:void 0;return o.r=(0,a.Clamp)(this.r,s,Z),o.g=(0,a.Clamp)(this.g,s,Z),o.b=(0,a.Clamp)(this.b,s,Z),o.a=(0,a.Clamp)(this.a,s,Z),o}multiply(s){return new D(this.r*s.r,this.g*s.g,this.b*s.b,this.a*s.a)}multiplyToRef(s,Z){return Z.r=this.r*s.r,Z.g=this.g*s.g,Z.b=this.b*s.b,Z.a=this.a*s.a,Z}multiplyInPlace(s){return this.r*=s.r,this.g*=s.g,this.b*=s.b,this.a*=s.a,this}multiplyByFloats(s,Z,o,t){return new D(this.r*s,this.g*Z,this.b*o,this.a*t)}divide(s){throw new ReferenceError("Can not divide a color")}divideToRef(s,Z){throw new ReferenceError("Can not divide a color")}divideInPlace(s){throw new ReferenceError("Can not divide a color")}minimizeInPlace(s){return this.r=Math.min(this.r,s.r),this.g=Math.min(this.g,s.g),this.b=Math.min(this.b,s.b),this.a=Math.min(this.a,s.a),this}maximizeInPlace(s){return this.r=Math.max(this.r,s.r),this.g=Math.max(this.g,s.g),this.b=Math.max(this.b,s.b),this.a=Math.max(this.a,s.a),this}minimizeInPlaceFromFloats(s,Z,o,t){return this.r=Math.min(s,this.r),this.g=Math.min(Z,this.g),this.b=Math.min(o,this.b),this.a=Math.min(t,this.a),this}maximizeInPlaceFromFloats(s,Z,o,t){return this.r=Math.max(s,this.r),this.g=Math.max(Z,this.g),this.b=Math.max(o,this.b),this.a=Math.max(t,this.a),this}floorToRef(s){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(s){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(s){throw new ReferenceError("Can not negate a color")}equalsWithEpsilon(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S.b;return(0,a.WithinEpsilon)(this.r,s.r,Z)&&(0,a.WithinEpsilon)(this.g,s.g,Z)&&(0,a.WithinEpsilon)(this.b,s.b,Z)&&(0,a.WithinEpsilon)(this.a,s.a,Z)}equalsToFloats(s,Z,o,t){return this.r===s&&this.g===Z&&this.b===o&&this.a===t}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"nz"}getHashCode(){let s=255*this.r|0;return s=397*s^255*this.g,s=397*s^255*this.b,s=397*s^255*this.a,s}clone(){return(new D).O(this)}O(s){return this.r=s.r,this.g=s.g,this.b=s.b,this.a=s.a,this}Ja(s,Z,o,t){return this.r=s,this.g=Z,this.b=o,this.a=t,this}set(s,Z,o,t){return this.Ja(s,Z,o,t)}tO(s){return this.r=this.g=this.b=this.a=s,this}toHexString(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Z=Math.round(255*this.r),o=Math.round(255*this.g),t=Math.round(255*this.b);if(s)return"#"+(0,a.ToHex)(Z)+(0,a.ToHex)(o)+(0,a.ToHex)(t);const j=Math.round(255*this.a);return"#"+(0,a.ToHex)(Z)+(0,a.ToHex)(o)+(0,a.ToHex)(t)+(0,a.ToHex)(j)}fromHexString(s){return"#"!==s.substring(0,1)||9!==s.length&&7!==s.length||(this.r=parseInt(s.substring(1,3),16)/255,this.g=parseInt(s.substring(3,5),16)/255,this.b=parseInt(s.substring(5,7),16)/255,9===s.length&&(this.a=parseInt(s.substring(7,9),16)/255)),this}toLinearSpace(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Z=new D;return this.toLinearSpaceToRef(Z,s),Z}toLinearSpaceToRef(s){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(s.r=v(this.r),s.g=v(this.g),s.b=v(this.b)):(s.r=O(this.r),s.g=O(this.g),s.b=O(this.b)),s.a=this.a,this}toGammaSpace(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Z=new D;return this.toGammaSpaceToRef(Z,s),Z}toGammaSpaceToRef(s){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(s.r=B(this.r),s.g=B(this.g),s.b=B(this.b)):(s.r=G(this.r),s.g=G(this.g),s.b=G(this.b)),s.a=this.a,this}static FromHexString(s){return"#"!==s.substring(0,1)||9!==s.length&&7!==s.length?new D(0,0,0,0):new D(0,0,0,1).fromHexString(s)}static Lerp(s,Z,o){return D.LerpToRef(s,Z,o,new D)}static LerpToRef(s,Z,o,t){return t.r=s.r+(Z.r-s.r)*o,t.g=s.g+(Z.g-s.g)*o,t.b=s.b+(Z.b-s.b)*o,t.a=s.a+(Z.a-s.a)*o,t}static Hermite(s,Z,o,t,j){const S=j*j,a=j*S,O=2*a-3*S+1,v=-2*a+3*S,G=a-2*S+j,B=a-S,Q=s.r*O+o.r*v+Z.r*G+t.r*B,z=s.g*O+o.g*v+Z.g*G+t.g*B,Y=s.b*O+o.b*v+Z.b*G+t.b*B,b=s.a*O+o.a*v+Z.a*G+t.a*B;return new D(Q,z,Y,b)}static Hermite1stDerivative(s,Z,o,t,j){const S=new D;return this.Hermite1stDerivativeToRef(s,Z,o,t,j,S),S}static Hermite1stDerivativeToRef(s,Z,o,t,j,S){const a=j*j;S.r=6*(a-j)*s.r+(3*a-4*j+1)*Z.r+6*(-a+j)*o.r+(3*a-2*j)*t.r,S.g=6*(a-j)*s.g+(3*a-4*j+1)*Z.g+6*(-a+j)*o.g+(3*a-2*j)*t.g,S.b=6*(a-j)*s.b+(3*a-4*j+1)*Z.b+6*(-a+j)*o.b+(3*a-2*j)*t.b,S.a=6*(a-j)*s.a+(3*a-4*j+1)*Z.a+6*(-a+j)*o.a+(3*a-2*j)*t.a}static FromColor3(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new D(s.r,s.g,s.b,Z)}static oO(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new D(s[Z],s[Z+1],s[Z+2],s[Z+3])}static FromArrayToRef(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;o.r=s[Z],o.g=s[Z+1],o.b=s[Z+2],o.a=s[Z+3]}static FromInts(s,Z,o,t){return new D(s/255,Z/255,o/255,t/255)}static CheckColors4(s,Z){if(s.length===3*Z){const Z=[];for(let o=0;o<s.length;o+=3){const t=o/3*4;Z[t]=s[o],Z[t+1]=s[o+1],Z[t+2]=s[o+2],Z[t+3]=1}return Z}return s}}D._V8PerformanceHack=new D(.5,.5,.5,.5),Object.defineProperties(D.prototype,{dimension:{value:[4]},rank:{value:1}});class z{}z.pz=(0,t.e)(3,Q.Black),z.nz=(0,t.e)(3,(()=>new D(0,0,0,0))),(0,j.f)("BABYLON.Color3",Q),(0,j.f)("BABYLON.Color4",D)},10904:(s,Z,o)=>{o.d(Z,{b:()=>a,e:()=>S,i:()=>t,j:()=>j});const t=1/2.2,j=2.2,S=(1+Math.sqrt(5))/2,a=.001},11267:(s,Z,o)=>{o.d(Z,{c:()=>j});var t=o(11159);class j{static GetPlanes(s){const Z=[];for(let o=0;o<6;o++)Z.push(new t.b(0,0,0,0));return j.GetPlanesToRef(s,Z),Z}static GetNearPlaneToRef(s,Z){const o=s.m;Z.gt.x=o[3]+o[2],Z.gt.y=o[7]+o[6],Z.gt.z=o[11]+o[10],Z.d=o[15]+o[14],Z.normalize()}static GetFarPlaneToRef(s,Z){const o=s.m;Z.gt.x=o[3]-o[2],Z.gt.y=o[7]-o[6],Z.gt.z=o[11]-o[10],Z.d=o[15]-o[14],Z.normalize()}static GetLeftPlaneToRef(s,Z){const o=s.m;Z.gt.x=o[3]+o[0],Z.gt.y=o[7]+o[4],Z.gt.z=o[11]+o[8],Z.d=o[15]+o[12],Z.normalize()}static GetRightPlaneToRef(s,Z){const o=s.m;Z.gt.x=o[3]-o[0],Z.gt.y=o[7]-o[4],Z.gt.z=o[11]-o[8],Z.d=o[15]-o[12],Z.normalize()}static GetTopPlaneToRef(s,Z){const o=s.m;Z.gt.x=o[3]-o[1],Z.gt.y=o[7]-o[5],Z.gt.z=o[11]-o[9],Z.d=o[15]-o[13],Z.normalize()}static GetBottomPlaneToRef(s,Z){const o=s.m;Z.gt.x=o[3]+o[1],Z.gt.y=o[7]+o[5],Z.gt.z=o[11]+o[9],Z.d=o[15]+o[13],Z.normalize()}static GetPlanesToRef(s,Z){j.GetNearPlaneToRef(s,Z[0]),j.GetFarPlaneToRef(s,Z[1]),j.GetLeftPlaneToRef(s,Z[2]),j.GetRightPlaneToRef(s,Z[3]),j.GetTopPlaneToRef(s,Z[4]),j.GetBottomPlaneToRef(s,Z[5])}static IsPointInFrustum(s,Z){for(let o=0;o<6;o++)if(Z[o].dotCoordinate(s)<0)return!1;return!0}}},11145:(s,Z,o)=>{o.d(Z,{c:()=>O,e:()=>v});var t=o(11086),j=o(10900),S=o(11091);class a{static extractMinAndMaxIndexed(s,Z,o,t,j,S){for(let a=o;a<o+t;a++){const o=3*Z[a],t=s[o],O=s[o+1],v=s[o+2];j.minimizeInPlaceFromFloats(t,O,v),S.maximizeInPlaceFromFloats(t,O,v)}}static extractMinAndMax(s,Z,o,t,j,S){for(let a=Z,O=Z*t;a<Z+o;a++,O+=t){const Z=s[O],o=s[O+1],t=s[O+2];j.minimizeInPlaceFromFloats(Z,o,t),S.maximizeInPlaceFromFloats(Z,o,t)}}}function O(s,Z,o,t){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const O=new j.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),v=new j.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return a.extractMinAndMaxIndexed(s,Z,o,t,O,v),S&&(O.x-=O.x*S.x+S.y,O.y-=O.y*S.x+S.y,O.z-=O.z*S.x+S.y,v.x+=v.x*S.x+S.y,v.y+=v.y*S.x+S.y,v.z+=v.z*S.x+S.y),{minimum:O,maximum:v}}function v(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,S=arguments.length>4?arguments[4]:void 0;const O=new j.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),v=new j.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return S||(S=3),a.extractMinAndMax(s,Z,o,S,O,v),t&&(O.x-=O.x*t.x+t.y,O.y-=O.y*t.x+t.y,O.z-=O.z*t.x+t.y,v.x+=v.x*t.x+t.y,v.y+=v.y*t.x+t.y,v.z+=v.z*t.x+t.y),{minimum:O,maximum:v}}(0,t.c)([S.e.filter((function(){for(var s=arguments.length,Z=new Array(s),o=0;o<s;o++)Z[o]=arguments[o];let[t,j]=Z;return!Array.isArray(t)&&!Array.isArray(j)}))],a,"extractMinAndMaxIndexed",null),(0,t.c)([S.e.filter((function(){for(var s=arguments.length,Z=new Array(s),o=0;o<s;o++)Z[o]=arguments[o];let[t]=Z;return!Array.isArray(t)}))],a,"extractMinAndMax",null)},11376:(s,Z,o)=>{o.d(Z,{e:()=>t.b,f:()=>t.e,h:()=>t.g,k:()=>t.n});o(11229),o(11174),o(10904),o(11267),o(11383),o(11159),o(11389);var t=o(10900);o(11262)},11383:(s,Z,o)=>{o.d(Z,{d:()=>O,h:()=>D,i:()=>B,j:()=>Q});var t,j=o(10935),S=o(10900),a=o(10904);!function(s){s[s.CW=0]="CW",s[s.CCW=1]="CCW"}(t||(t={}));class O{static Interpolate(s,Z,o,t,j){if(0===s)return 0;const S=1-3*t+3*Z,a=3*t-6*Z,O=3*Z;let v=s;for(let G=0;G<5;G++){const Z=v*v;v-=(S*(Z*v)+a*Z+O*v-s)*(1/(3*S*Z+2*a*v+O)),v=Math.min(1,Math.max(0,v))}return 3*Math.pow(1-v,2)*v*o+3*(1-v)*Math.pow(v,2)*j+Math.pow(v,3)}}class v{constructor(s){this._radians=s,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}static BetweenTwoPoints(s,Z){const o=Z.Go(s),t=Math.atan2(o.y,o.x);return new v(t)}static BetweenTwoVectors(s,Z){let o=s.lengthSquared()*Z.lengthSquared();if(0===o)return new v(Math.PI/2);o=Math.sqrt(o);let t=s.dot(Z)/o;t=(0,j.Clamp)(t,-1,1);const S=Math.acos(t);return new v(S)}static FromRadians(s){return new v(s)}static FromDegrees(s){return new v(s*Math.PI/180)}}class G{constructor(s,Z,o){this.startPoint=s,this.midPoint=Z,this.endPoint=o;const t=Math.pow(Z.x,2)+Math.pow(Z.y,2),j=(Math.pow(s.x,2)+Math.pow(s.y,2)-t)/2,a=(t-Math.pow(o.x,2)-Math.pow(o.y,2))/2,O=(s.x-Z.x)*(Z.y-o.y)-(Z.x-o.x)*(s.y-Z.y);this.centerPoint=new S.j((j*(Z.y-o.y)-a*(s.y-Z.y))/O,((s.x-Z.x)*a-(Z.x-o.x)*j)/O),this.radius=this.centerPoint.Go(this.startPoint).length(),this.startAngle=v.BetweenTwoPoints(this.centerPoint,this.startPoint);const G=this.startAngle.degrees();let B=v.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),Q=v.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();B-G>180&&(B-=360),B-G<-180&&(B+=360),Q-B>180&&(Q-=360),Q-B<-180&&(Q+=360),this.orientation=B-G<0?0:1,this.angle=v.FromDegrees(0===this.orientation?G-Q:Q-G)}}class B{constructor(s,Z){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new S.j(s,Z))}addLineTo(s,Z){if(this.closed)return this;const o=new S.j(s,Z),t=this._points[this._points.length-1];return this._points.push(o),this._length+=o.Go(t).length(),this}addArcTo(s,Z,o,t){let j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const a=this._points[this._points.length-1],O=new S.j(s,Z),v=new S.j(o,t),B=new G(a,O,v);let Q=B.angle.radians()/j;0===B.orientation&&(Q*=-1);let D=B.startAngle.radians()+Q;for(let S=0;S<j;S++){const s=Math.cos(D)*B.radius+B.centerPoint.x,Z=Math.sin(D)*B.radius+B.centerPoint.y;this.addLineTo(s,Z),D+=Q}return this}addQuadraticCurveTo(s,Z,o,t){let j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const S=(s,Z,o,t)=>(1-s)*(1-s)*Z+2*s*(1-s)*o+s*s*t,a=this._points[this._points.length-1];for(let O=0;O<=j;O++){const v=O/j,G=S(v,a.x,s,o),B=S(v,a.y,Z,t);this.addLineTo(G,B)}return this}addBezierCurveTo(s,Z,o,t,j,S){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:36;if(this.closed)return this;const O=(s,Z,o,t,j)=>(1-s)*(1-s)*(1-s)*Z+3*s*(1-s)*(1-s)*o+3*s*s*(1-s)*t+s*s*s*j,v=this._points[this._points.length-1];for(let G=0;G<=a;G++){const B=G/a,Q=O(B,v.x,s,o,j),D=O(B,v.y,Z,t,S);this.addLineTo(Q,D)}return this}isPointInside(s){let Z=!1;const o=this._points.length;for(let t=o-1,j=0;j<o;t=j++){let o=this._points[t],S=this._points[j],a=S.x-o.x,O=S.y-o.y;if(Math.abs(O)>Number.EPSILON){if(O<0&&(o=this._points[j],a=-a,S=this._points[t],O=-O),s.y<o.y||s.y>S.y)continue;if(s.y===o.y&&s.x===o.x)return!0;{const t=O*(s.x-o.x)-a*(s.y-o.y);if(0===t)return!0;if(t<0)continue;Z=!Z}}else{if(s.y!==o.y)continue;if(S.x<=s.x&&s.x<=o.x||o.x<=s.x&&s.x<=S.x)return!0}}return Z}close(){return this.closed=!0,this}length(){let s=this._length;if(this.closed){const Z=this._points[this._points.length-1];s+=this._points[0].Go(Z).length()}return s}area(){const s=this._points.length;let Z=0;for(let o=s-1,t=0;t<s;o=t++)Z+=this._points[o].x*this._points[t].y-this._points[t].x*this._points[o].y;return.5*Z}getPoints(){return this._points}getPointAtLengthPosition(s){if(s<0||s>1)return S.j.Zero();const Z=s*this.length();let o=0;for(let t=0;t<this._points.length;t++){const s=(t+1)%this._points.length,j=this._points[t],a=this._points[s].Go(j),O=a.length()+o;if(Z>=o&&Z<=O){const s=a.normalize(),t=Z-o;return new S.j(j.x+s.x*t,j.y+s.y*t)}o=O}return S.j.Zero()}static StartingAt(s,Z){return new B(s,Z)}}class Q{constructor(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2?arguments[2]:void 0,t=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.path=s,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:S.n.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:S.b.Identity()};for(let j=0;j<s.length;j++)this._curve[j]=s[j].clone();this._raw=o||!1,this._alignTangentsWithPath=t,this._compute(Z,t)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(s){return this._updatePointAtData(s).point}getTangentAt(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(s,Z),Z?S.n.TransformCoordinates(S.n.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(s,Z),Z?S.n.TransformCoordinates(S.n.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(s,Z),Z?S.n.TransformCoordinates(S.n.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(s){return this.length()*s}getPreviousPointIndexAt(s){return this._updatePointAtData(s),this._pointAtData.previousPointArrayIndex}getSubPositionAt(s){return this._updatePointAtData(s),this._pointAtData.subPosition}getClosestPositionTo(s){let Z=Number.MAX_VALUE,o=0;for(let t=0;t<this._curve.length-1;t++){const j=this._curve[t+0],a=this._curve[t+1].Go(j).normalize(),O=this._distances[t+1]-this._distances[t+0],v=Math.min(Math.max(S.n.Dot(a,s.Go(j).normalize()),0)*S.n.Distance(j,s)/O,1),G=S.n.Distance(j.add(a.scale(v*O)),s);G<Z&&(Z=G,o=(this._distances[t+0]+O*v)/this.length())}return o}slice(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(s<0&&(s=1- -1*s%1),Z<0&&(Z=1- -1*Z%1),s>Z){const o=s;s=Z,Z=o}const o=this.getCurve(),t=this.getPointAt(s);let j=this.getPreviousPointIndexAt(s);const S=this.getPointAt(Z),a=this.getPreviousPointIndexAt(Z)+1,O=[];return 0!==s&&(j++,O.push(t)),O.push(...o.slice(j,a)),1===Z&&1!==s||O.push(S),new Q(O,this.getNormalAt(s),this._raw,this._alignTangentsWithPath)}update(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(let t=0;t<s.length;t++)this._curve[t].x=s[t].x,this._curve[t].y=s[t].y,this._curve[t].z=s[t].z;return this._compute(Z,o),this}_compute(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const o=this._curve.length;if(o<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[o-1]=this._curve[o-1].Go(this._curve[o-2]),this._raw||this._tangents[o-1].normalize();const t=this._tangents[0],j=this._normalVector(t,s);let a,O,v,G,B;this._normals[0]=j,this._raw||this._normals[0].normalize(),this._binormals[0]=S.n.Cross(t,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let Q=1;Q<o;Q++)a=this._getLastNonNullVector(Q),Q<o-1&&(O=this._getFirstNonNullVector(Q),this._tangents[Q]=Z?O:a.add(O),this._tangents[Q].normalize()),this._distances[Q]=this._distances[Q-1]+this._curve[Q].Go(this._curve[Q-1]).length(),v=this._tangents[Q],B=this._binormals[Q-1],this._normals[Q]=S.n.Cross(B,v),this._raw||(0===this._normals[Q].length()?(G=this._normals[Q-1],this._normals[Q]=G.clone()):this._normals[Q].normalize()),this._binormals[Q]=S.n.Cross(v,this._normals[Q]),this._raw||this._binormals[Q].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(s){let Z=1,o=this._curve[s+Z].Go(this._curve[s]);for(;0===o.length()&&s+Z+1<this._curve.length;)Z++,o=this._curve[s+Z].Go(this._curve[s]);return o}_getLastNonNullVector(s){let Z=1,o=this._curve[s].Go(this._curve[s-Z]);for(;0===o.length()&&s>Z+1;)Z++,o=this._curve[s].Go(this._curve[s-Z]);return o}_normalVector(s,Z){let o,t=s.length();if(0===t&&(t=1),void 0===Z||null===Z){let Z;Z=(0,j.WithinEpsilon)(Math.abs(s.y)/t,1,a.b)?(0,j.WithinEpsilon)(Math.abs(s.x)/t,1,a.b)?(0,j.WithinEpsilon)(Math.abs(s.z)/t,1,a.b)?S.n.Zero():new S.n(0,0,1):new S.n(1,0,0):new S.n(0,-1,0),o=S.n.Cross(s,Z)}else o=S.n.Cross(s,Z),S.n.CrossToRef(o,s,o);return o.normalize(),o}_updatePointAtData(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._pointAtData.id===s)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=s;const o=this.getPoints();if(s<=0)return this._setPointAtData(0,0,o[0],0,Z);if(s>=1)return this._setPointAtData(1,1,o[o.length-1],o.length-1,Z);let t,j=o[0],a=0;const O=s*this.length();for(let v=1;v<o.length;v++){t=o[v];const G=S.n.Distance(j,t);if(a+=G,a===O)return this._setPointAtData(s,1,t,v,Z);if(a>O){const o=(a-O)/G,S=j.Go(t),B=t.add(S.scaleInPlace(o));return this._setPointAtData(s,1-o,B,v-1,Z)}j=t}return this._pointAtData}_setPointAtData(s,Z,o,t,j){return this._pointAtData.point=o,this._pointAtData.position=s,this._pointAtData.subPosition=Z,this._pointAtData.previousPointArrayIndex=t,this._pointAtData.interpolateReady=j,j&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=S.b.Identity();const s=this._pointAtData.previousPointArrayIndex;if(s!==this._tangents.length-1){const Z=s+1,o=this._tangents[s].clone(),t=this._normals[s].clone(),j=this._binormals[s].clone(),a=this._tangents[Z].clone(),O=this._normals[Z].clone(),v=this._binormals[Z].clone(),G=S.e.RotationQuaternionFromAxis(t,j,o),B=S.e.RotationQuaternionFromAxis(O,v,a);S.e.Slerp(G,B,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}class D{static CreateQuadraticBezier(s,Z,o,t){t=t>2?t:3;const j=[],a=(s,Z,o,t)=>(1-s)*(1-s)*Z+2*s*(1-s)*o+s*s*t;for(let O=0;O<=t;O++)j.push(new S.n(a(O/t,s.x,Z.x,o.x),a(O/t,s.y,Z.y,o.y),a(O/t,s.z,Z.z,o.z)));return new D(j)}static CreateCubicBezier(s,Z,o,t,j){j=j>3?j:4;const a=[],O=(s,Z,o,t,j)=>(1-s)*(1-s)*(1-s)*Z+3*s*(1-s)*(1-s)*o+3*s*s*(1-s)*t+s*s*s*j;for(let v=0;v<=j;v++)a.push(new S.n(O(v/j,s.x,Z.x,o.x,t.x),O(v/j,s.y,Z.y,o.y,t.y),O(v/j,s.z,Z.z,o.z,t.z)));return new D(a)}static CreateHermiteSpline(s,Z,o,t,j){const a=[],O=1/j;for(let v=0;v<=j;v++)a.push(S.n.Hermite(s,Z,o,t,v*O));return new D(a)}static CreateCatmullRomSpline(s,Z,o){const t=[],j=1/Z;let a=0;if(o){const o=s.length;for(let O=0;O<o;O++){a=0;for(let v=0;v<Z;v++)t.push(S.n.CatmullRom(s[O%o],s[(O+1)%o],s[(O+2)%o],s[(O+3)%o],a)),a+=j}t.push(t[0])}else{const o=[];o.push(s[0].clone()),Array.prototype.push.apply(o,s),o.push(s[s.length-1].clone());let O=0;for(;O<o.length-3;O++){a=0;for(let s=0;s<Z;s++)t.push(S.n.CatmullRom(o[O],o[O+1],o[O+2],o[O+3],a)),a+=j}O--,t.push(S.n.CatmullRom(o[O],o[O+1],o[O+2],o[O+3],a))}return new D(t)}static ArcThru3Points(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,j=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const O=[],v=Z.Go(s),G=o.Go(Z),B=s.Go(o),Q=S.n.Cross(v,G),z=Q.length();if(z<Math.pow(10,-8))return new D(O);const Y=v.lengthSquared(),b=G.lengthSquared(),f=B.lengthSquared(),A=Q.lengthSquared(),d=.5*v.length()*G.length()*B.length()/z,U=-.5*b*S.n.Dot(v,B)/A,u=-.5*f*S.n.Dot(v,G)/A,H=-.5*Y*S.n.Dot(G,B)/A,F=s.scale(U).add(Z.scale(u)).add(o.scale(H)),i=s.Go(F).normalize(),N=S.n.Cross(Q,i).normalize();if(a){const Z=2*Math.PI/t;for(let s=0;s<=2*Math.PI;s+=Z)O.push(F.add(i.scale(d*Math.cos(s)).add(N.scale(d*Math.sin(s)))));O.push(s)}else{const Z=1/t;let a=0,v=S.n.Zero();do{v=F.add(i.scale(d*Math.cos(a)).add(N.scale(d*Math.sin(a)))),O.push(v),a+=Z}while(!v.equalsWithEpsilon(o,d*Z*1.1));O.push(o),j&&O.push(s)}return new D(O)}constructor(s){this._length=0,this._points=s,this._length=this._computeLength(s)}getPoints(){return this._points}length(){return this._length}continue(s){const Z=this._points[this._points.length-1],o=this._points.slice(),t=s.getPoints();for(let j=1;j<t.length;j++)o.push(t[j].Go(t[0]).add(Z));return new D(o)}_computeLength(s){let Z=0;for(let o=1;o<s.length;o++)Z+=s[o].Go(s[o-1]).length();return Z}}},11159:(s,Z,o)=>{o.d(Z,{b:()=>j});var t=o(10900);class j{constructor(s,Z,o,j){this.gt=new t.n(s,Z,o),this.d=j}ma(){return[this.gt.x,this.gt.y,this.gt.z,this.d]}clone(){return new j(this.gt.x,this.gt.y,this.gt.z,this.d)}getClassName(){return"Plane"}getHashCode(){let s=this.gt.getHashCode();return s=397*s^this.d,s}normalize(){const s=Math.sqrt(this.gt.x*this.gt.x+this.gt.y*this.gt.y+this.gt.z*this.gt.z);let Z=0;return 0!==s&&(Z=1/s),this.gt.x*=Z,this.gt.y*=Z,this.gt.z*=Z,this.d*=Z,this}transform(s){const Z=j._TmpMatrix;s.invertToRef(Z);const o=Z.m,t=this.gt.x,S=this.gt.y,a=this.gt.z,O=this.d,v=t*o[0]+S*o[1]+a*o[2]+O*o[3],G=t*o[4]+S*o[5]+a*o[6]+O*o[7],B=t*o[8]+S*o[9]+a*o[10]+O*o[11],Q=t*o[12]+S*o[13]+a*o[14]+O*o[15];return new j(v,G,B,Q)}dotCoordinate(s){return this.gt.x*s.x+this.gt.y*s.y+this.gt.z*s.z+this.d}copyFromPoints(s,Z,o){const t=Z.x-s.x,j=Z.y-s.y,S=Z.z-s.z,a=o.x-s.x,O=o.y-s.y,v=o.z-s.z,G=j*v-S*O,B=S*a-t*v,Q=t*O-j*a,D=Math.sqrt(G*G+B*B+Q*Q);let z;return z=0!==D?1/D:0,this.gt.x=G*z,this.gt.y=B*z,this.gt.z=Q*z,this.d=-(this.gt.x*s.x+this.gt.y*s.y+this.gt.z*s.z),this}isFrontFacingTo(s,Z){return t.n.Dot(this.gt,s)<=Z}signedDistanceTo(s){return t.n.Dot(s,this.gt)+this.d}static oO(s){return new j(s[0],s[1],s[2],s[3])}static FromPoints(s,Z,o){const t=new j(0,0,0,0);return t.copyFromPoints(s,Z,o),t}static FromPositionAndNormal(s,Z){const o=new j(0,0,0,0);return this.FromPositionAndNormalToRef(s,Z,o)}static FromPositionAndNormalToRef(s,Z,o){return o.gt.O(Z),o.gt.normalize(),o.d=-s.dot(o.gt),o}static SignedDistanceToPlaneFromPositionAndNormal(s,Z,o){const j=-(Z.x*s.x+Z.y*s.y+Z.z*s.z);return t.n.Dot(o,Z)+j}}j._TmpMatrix=t.b.Identity()},10935:(s,Z,o)=>{function t(s){return parseInt(s.toString().replace(/\W/g,""))}function j(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1401298e-51;return Math.abs(s-Z)<=o}function S(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1401298e-51;return s<Z-t||s>o+t}function a(s,Z){return s===Z?s:Math.random()*(Z-s)+s}function O(s,Z,o){return s+(Z-s)*o}function v(s,Z,o){let t=f(Z-s,360);return t>180&&(t-=360),s+t*D(o)}function G(s,Z,o){let t=0;return t=s!=Z?D((o-s)/(Z-s)):0,t}function B(s,Z,o,t,j){const S=j*j,a=j*S;return s*(2*a-3*S+1)+o*(-2*a+3*S)+Z*(a-2*S+j)+t*(a-S)}function Q(s,Z,o,t,j){const S=j*j;return 6*(S-j)*s+(3*S-4*j+1)*Z+6*(-S+j)*o+(3*S-2*j)*t}function D(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(o,Math.max(Z,s))}function z(s){return s-=2*Math.PI*Math.floor((s+Math.PI)/(2*Math.PI))}function Y(s){const Z=s.toString(16);return s<=15?("0"+Z).toUpperCase():Z.toUpperCase()}function b(s){if(Math.log2)return Math.floor(Math.log2(s));if(s<0)return NaN;if(0===s)return-1/0;let Z=0;if(s<1){for(;s<1;)Z++,s*=2;Z=-Z}else if(s>1)for(;s>1;)Z++,s=Math.floor(s/2);return Z}function f(s,Z){return s-Math.floor(s/Z)*Z}function A(s,Z,o){return(s-Z)/(o-Z)}function d(s,Z,o){return s*(o-Z)+Z}function U(s,Z){let o=f(Z-s,360);return o>180&&(o-=360),o}function u(s,Z){const o=f(s,2*Z);return Z-Math.abs(o-Z)}function H(s,Z,o){let t=D(o);return t=-2*t*t*t+3*t*t,Z*t+s*(1-t)}function F(s,Z,o){let t=0;return t=Math.abs(Z-s)<=o?Z:s+Math.sign(Z-s)*o,t}function i(s,Z,o){const t=U(s,Z);let j=0;return j=-o<t&&t<o?Z:F(s,Z=s+t,o),j}function N(s,Z,o){return(s-Z)/(o-Z)}function L(s,Z,o){return(o-Z)*s+Z}function V(s,Z){const o=s%Z;return 0===o?Z:V(Z,o)}o.r(Z),o.d(Z,{Clamp:()=>D,DeltaAngle:()=>U,Denormalize:()=>d,ExtractAsInt:()=>t,Hermite:()=>B,Hermite1stDerivative:()=>Q,HighestCommonFactor:()=>V,ILog2:()=>b,InverseLerp:()=>G,Lerp:()=>O,LerpAngle:()=>v,MoveTowards:()=>F,MoveTowardsAngle:()=>i,Normalize:()=>A,NormalizeRadians:()=>z,OutsideRange:()=>S,PercentToRange:()=>L,PingPong:()=>u,RandomRange:()=>a,RangeToPercent:()=>N,Repeat:()=>f,SmoothStep:()=>H,ToHex:()=>Y,WithinEpsilon:()=>j})},11389:(s,Z,o)=>{o.d(Z,{b:()=>t});class t{constructor(s,Z){this.width=s,this.height=Z}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let s=0|this.width;return s=397*s^this.height,s}O(s){this.width=s.width,this.height=s.height}Ja(s,Z){return this.width=s,this.height=Z,this}set(s,Z){return this.Ja(s,Z)}multiplyByFloats(s,Z){return new t(this.width*s,this.height*Z)}clone(){return new t(this.width,this.height)}equals(s){return!!s&&(this.width===s.width&&this.height===s.height)}get surface(){return this.width*this.height}static Zero(){return new t(0,0)}add(s){return new t(this.width+s.width,this.height+s.height)}Go(s){return new t(this.width-s.width,this.height-s.height)}scale(s){return new t(this.width*s,this.height*s)}static Lerp(s,Z,o){const j=s.width+(Z.width-s.width)*o,S=s.height+(Z.height-s.height)*o;return new t(j,S)}}},10900:(s,Z,o)=>{o.d(Z,{b:()=>d,e:()=>A,g:()=>u,j:()=>Y,n:()=>b,p:()=>f});var t=o(10904),j=o(10911),S=o(10916),a=o(10924),O=o(10927),v=o(10935);class G{}function B(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const j=s.ma(),S=Z.ma(),a=j[0],O=j[1],v=j[2],G=j[3],B=j[4],Q=j[5],D=j[6],z=j[7],Y=j[8],b=j[9],f=j[10],A=j[11],d=j[12],U=j[13],u=j[14],H=j[15],F=S[0],i=S[1],N=S[2],L=S[3],V=S[4],g=S[5],l=S[6],R=S[7],e=S[8],c=S[9],w=S[10],X=S[11],W=S[12],q=S[13],h=S[14],M=S[15];o[t]=a*F+O*V+v*e+G*W,o[t+1]=a*i+O*g+v*c+G*q,o[t+2]=a*N+O*l+v*w+G*h,o[t+3]=a*L+O*R+v*X+G*M,o[t+4]=B*F+Q*V+D*e+z*W,o[t+5]=B*i+Q*g+D*c+z*q,o[t+6]=B*N+Q*l+D*w+z*h,o[t+7]=B*L+Q*R+D*X+z*M,o[t+8]=Y*F+b*V+f*e+A*W,o[t+9]=Y*i+b*g+f*c+A*q,o[t+10]=Y*N+b*l+f*w+A*h,o[t+11]=Y*L+b*R+f*X+A*M,o[t+12]=d*F+U*V+u*e+H*W,o[t+13]=d*i+U*g+u*c+H*q,o[t+14]=d*N+U*l+u*w+H*h,o[t+15]=d*L+U*R+u*X+H*M}function Q(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const t=s.ma();Z[o]=t[0],Z[o+1]=t[1],Z[o+2]=t[2],Z[o+3]=t[3],Z[o+4]=t[4],Z[o+5]=t[5],Z[o+6]=t[6],Z[o+7]=t[7],Z[o+8]=t[8],Z[o+9]=t[9],Z[o+10]=t[10],Z[o+11]=t[11],Z[o+12]=t[12],Z[o+13]=t[13],Z[o+14]=t[14],Z[o+15]=t[15]}function D(s,Z){const o=s.ma(),t=o[0],j=o[1],S=o[2],a=o[3],O=o[4],v=o[5],G=o[6],B=o[7],Q=o[8],D=o[9],z=o[10],Y=o[11],b=o[12],f=o[13],A=o[14],d=o[15],U=z*d-A*Y,u=D*d-f*Y,H=D*A-f*z,F=Q*d-b*Y,i=Q*A-z*b,N=Q*f-b*D,L=+(v*U-G*u+B*H),V=-(O*U-G*F+B*i),g=+(O*u-v*F+B*N),l=-(O*H-v*i+G*N),R=t*L+j*V+S*g+a*l;if(0===R)return!1;const e=1/R,c=G*d-A*B,w=v*d-f*B,X=v*A-f*G,W=O*d-b*B,q=O*A-b*G,h=O*f-b*v,M=G*Y-z*B,x=v*Y-D*B,k=v*z-D*G,y=O*Y-Q*B,I=O*z-Q*G,C=O*D-Q*v,K=-(j*U-S*u+a*H),p=+(t*U-S*F+a*i),E=-(t*u-j*F+a*N),P=+(t*H-j*i+S*N),r=+(j*c-S*w+a*X),T=-(t*c-S*W+a*q),m=+(t*w-j*W+a*h),n=-(t*X-j*q+S*h),J=-(j*M-S*x+a*k),ss=+(t*M-S*y+a*I),Zs=-(t*x-j*y+a*C),os=+(t*k-j*I+S*C);return Z[0]=L*e,Z[1]=K*e,Z[2]=r*e,Z[3]=J*e,Z[4]=V*e,Z[5]=p*e,Z[6]=T*e,Z[7]=ss*e,Z[8]=g*e,Z[9]=E*e,Z[10]=m*e,Z[11]=Zs*e,Z[12]=l*e,Z[13]=P*e,Z[14]=n*e,Z[15]=os*e,!0}G._UpdateFlagSeed=0;const z=s=>parseInt(s.toString().replace(/\W/g,""));class Y{constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=s,this.y=Z}toString(){return`{X: ${this.x} Y: ${this.y}}`}getClassName(){return"Vector2"}getHashCode(){let s=z(this.x);return s=397*s^z(this.y),s}toArray(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return s[Z]=this.x,s[Z+1]=this.y,this}Bo(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Y.FromArrayToRef(s,Z,this),this}ma(){return[this.x,this.y]}O(s){return this.x=s.x,this.y=s.y,this}Ja(s,Z){return this.x=s,this.y=Z,this}set(s,Z){return this.Ja(s,Z)}tO(s){return this.Ja(s,s)}add(s){return new Y(this.x+s.x,this.y+s.y)}addToRef(s,Z){return Z.x=this.x+s.x,Z.y=this.y+s.y,Z}addInPlace(s){return this.x+=s.x,this.y+=s.y,this}addInPlaceFromFloats(s,Z){return this.x+=s,this.y+=Z,this}addVector3(s){return new Y(this.x+s.x,this.y+s.y)}Go(s){return new Y(this.x-s.x,this.y-s.y)}subtractToRef(s,Z){return Z.x=this.x-s.x,Z.y=this.y-s.y,Z}RB(s){return this.x-=s.x,this.y-=s.y,this}multiplyInPlace(s){return this.x*=s.x,this.y*=s.y,this}multiply(s){return new Y(this.x*s.x,this.y*s.y)}multiplyToRef(s,Z){return Z.x=this.x*s.x,Z.y=this.y*s.y,Z}multiplyByFloats(s,Z){return new Y(this.x*s,this.y*Z)}divide(s){return new Y(this.x/s.x,this.y/s.y)}divideToRef(s,Z){return Z.x=this.x/s.x,Z.y=this.y/s.y,Z}divideInPlace(s){return this.x=this.x/s.x,this.y=this.y/s.y,this}minimizeInPlace(s){return this.minimizeInPlaceFromFloats(s.x,s.y)}maximizeInPlace(s){return this.maximizeInPlaceFromFloats(s.x,s.y)}minimizeInPlaceFromFloats(s,Z){return this.x=Math.min(s,this.x),this.y=Math.min(Z,this.y),this}maximizeInPlaceFromFloats(s,Z){return this.x=Math.max(s,this.x),this.y=Math.max(Z,this.y),this}subtractFromFloats(s,Z){return new Y(this.x-s,this.y-Z)}subtractFromFloatsToRef(s,Z,o){return o.x=this.x-s,o.y=this.y-Z,o}negate(){return new Y(-this.x,-this.y)}negateInPlace(){return this.x*=-1,this.y*=-1,this}negateToRef(s){return s.x=-this.x,s.y=-this.y,s}scaleInPlace(s){return this.x*=s,this.y*=s,this}scale(s){return new Y(this.x*s,this.y*s)}scaleToRef(s,Z){return Z.x=this.x*s,Z.y=this.y*s,Z}scaleAndAddToRef(s,Z){return Z.x+=this.x*s,Z.y+=this.y*s,Z}equals(s){return s&&this.x===s.x&&this.y===s.y}equalsWithEpsilon(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.b;return s&&(0,v.WithinEpsilon)(this.x,s.x,Z)&&(0,v.WithinEpsilon)(this.y,s.y,Z)}equalsToFloats(s,Z){return this.x===s&&this.y===Z}floor(){return new Y(Math.floor(this.x),Math.floor(this.y))}floorToRef(s){return s.x=Math.floor(this.x),s.y=Math.floor(this.y),s}fract(){return new Y(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}fractToRef(s){return s.x=this.x-Math.floor(this.x),s.y=this.y-Math.floor(this.y),s}rotate(s){return this.rotateToRef(s,new Y)}rotateToRef(s,Z){const o=Math.cos(s),t=Math.sin(s);return Z.x=o*this.x-t*this.y,Z.y=t*this.x+o*this.y,Z}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(s){return 0===s||1===s?this:this.scaleInPlace(1/s)}normalizeToNew(){const s=new Y;return this.normalizeToRef(s),s}normalizeToRef(s){const Z=this.length();return 0===Z&&(s.x=this.x,s.y=this.y),this.scaleToRef(1/Z,s)}clone(){return new Y(this.x,this.y)}dot(s){return this.x*s.x+this.y*s.y}static Zero(){return new Y(0,0)}static One(){return new Y(1,1)}static Random(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new Y((0,v.RandomRange)(s,Z),(0,v.RandomRange)(s,Z))}static RandomToRef(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).Ja((0,v.RandomRange)(s,Z),(0,v.RandomRange)(s,Z))}static get ZeroReadOnly(){return Y._ZeroReadOnly}static oO(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new Y(s[Z],s[Z+1])}static FromArrayToRef(s,Z,o){return o.x=s[Z],o.y=s[Z+1],o}static FromFloatsToRef(s,Z,o){return o.Ja(s,Z),o}static CatmullRom(s,Z,o,t,j){const S=j*j,a=j*S,O=.5*(2*Z.x+(-s.x+o.x)*j+(2*s.x-5*Z.x+4*o.x-t.x)*S+(-s.x+3*Z.x-3*o.x+t.x)*a),v=.5*(2*Z.y+(-s.y+o.y)*j+(2*s.y-5*Z.y+4*o.y-t.y)*S+(-s.y+3*Z.y-3*o.y+t.y)*a);return new Y(O,v)}static ClampToRef(s,Z,o,t){return t.x=(0,v.Clamp)(s.x,Z.x,o.x),t.y=(0,v.Clamp)(s.y,Z.y,o.y),t}static Clamp(s,Z,o){const t=(0,v.Clamp)(s.x,Z.x,o.x),j=(0,v.Clamp)(s.y,Z.y,o.y);return new Y(t,j)}static Hermite(s,Z,o,t,j){const S=j*j,a=j*S,O=2*a-3*S+1,v=-2*a+3*S,G=a-2*S+j,B=a-S,Q=s.x*O+o.x*v+Z.x*G+t.x*B,D=s.y*O+o.y*v+Z.y*G+t.y*B;return new Y(Q,D)}static Hermite1stDerivative(s,Z,o,t,j){return this.Hermite1stDerivativeToRef(s,Z,o,t,j,new Y)}static Hermite1stDerivativeToRef(s,Z,o,t,j,S){const a=j*j;return S.x=6*(a-j)*s.x+(3*a-4*j+1)*Z.x+6*(-a+j)*o.x+(3*a-2*j)*t.x,S.y=6*(a-j)*s.y+(3*a-4*j+1)*Z.y+6*(-a+j)*o.y+(3*a-2*j)*t.y,S}static Lerp(s,Z,o){return Y.LerpToRef(s,Z,o,new Y)}static LerpToRef(s,Z,o,t){return t.x=s.x+(Z.x-s.x)*o,t.y=s.y+(Z.y-s.y)*o,t}static Dot(s,Z){return s.x*Z.x+s.y*Z.y}static Normalize(s){return Y.NormalizeToRef(s,new Y)}static NormalizeToRef(s,Z){return s.normalizeToRef(Z),Z}static Minimize(s,Z){const o=s.x<Z.x?s.x:Z.x,t=s.y<Z.y?s.y:Z.y;return new Y(o,t)}static Maximize(s,Z){const o=s.x>Z.x?s.x:Z.x,t=s.y>Z.y?s.y:Z.y;return new Y(o,t)}static Transform(s,Z){return Y.TransformToRef(s,Z,new Y)}static TransformToRef(s,Z,o){const t=Z.m,j=s.x*t[0]+s.y*t[4]+t[12],S=s.x*t[1]+s.y*t[5]+t[13];return o.x=j,o.y=S,o}static PointInTriangle(s,Z,o,t){const j=.5*(-o.y*t.x+Z.y*(-o.x+t.x)+Z.x*(o.y-t.y)+o.x*t.y),S=j<0?-1:1,a=(Z.y*t.x-Z.x*t.y+(t.y-Z.y)*s.x+(Z.x-t.x)*s.y)*S,O=(Z.x*o.y-Z.y*o.x+(Z.y-o.y)*s.x+(o.x-Z.x)*s.y)*S;return a>0&&O>0&&a+O<2*j*S}static Distance(s,Z){return Math.sqrt(Y.DistanceSquared(s,Z))}static DistanceSquared(s,Z){const o=s.x-Z.x,t=s.y-Z.y;return o*o+t*t}static Center(s,Z){return Y.CenterToRef(s,Z,new Y)}static CenterToRef(s,Z,o){return o.Ja((s.x+Z.x)/2,(s.y+Z.y)/2)}static DistanceOfPointFromSegment(s,Z,o){const t=Y.DistanceSquared(Z,o);if(0===t)return Y.Distance(s,Z);const j=o.Go(Z),S=Math.max(0,Math.min(1,Y.Dot(s.Go(Z),j)/t)),a=Z.add(j.multiplyByFloats(S,S));return Y.Distance(s,a)}}Y._V8PerformanceHack=new Y(.5,.5),Y._ZeroReadOnly=Y.Zero(),Object.defineProperties(Y.prototype,{dimension:{value:[2]},rank:{value:1}});class b{get x(){return this._x}set x(s){this._x=s,this._isDirty=!0}get y(){return this._y}set y(s){this._y=s,this._isDirty=!0}get z(){return this._z}set z(s){this._z=s,this._isDirty=!0}constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._isDirty=!0,this._x=s,this._y=Z,this._z=o}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z}}`}getClassName(){return"sO"}getHashCode(){let s=z(this._x);return s=397*s^z(this._y),s=397*s^z(this._z),s}ma(){return[this._x,this._y,this._z]}toArray(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return s[Z]=this._x,s[Z+1]=this._y,s[Z+2]=this._z,this}Bo(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return b.FromArrayToRef(s,Z,this),this}toQuaternion(){return A.RotationYawPitchRoll(this._y,this._x,this._z)}addInPlace(s){return this._x+=s._x,this._y+=s._y,this._z+=s._z,this._isDirty=!0,this}addInPlaceFromFloats(s,Z,o){return this._x+=s,this._y+=Z,this._z+=o,this._isDirty=!0,this}add(s){return new b(this._x+s._x,this._y+s._y,this._z+s._z)}addToRef(s,Z){return Z._x=this._x+s._x,Z._y=this._y+s._y,Z._z=this._z+s._z,Z._isDirty=!0,Z}RB(s){return this._x-=s._x,this._y-=s._y,this._z-=s._z,this._isDirty=!0,this}Go(s){return new b(this._x-s._x,this._y-s._y,this._z-s._z)}subtractToRef(s,Z){return this.subtractFromFloatsToRef(s._x,s._y,s._z,Z)}subtractFromFloats(s,Z,o){return new b(this._x-s,this._y-Z,this._z-o)}subtractFromFloatsToRef(s,Z,o,t){return t._x=this._x-s,t._y=this._y-Z,t._z=this._z-o,t._isDirty=!0,t}negate(){return new b(-this._x,-this._y,-this._z)}negateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}negateToRef(s){return s._x=-1*this._x,s._y=-1*this._y,s._z=-1*this._z,s._isDirty=!0,s}scaleInPlace(s){return this._x*=s,this._y*=s,this._z*=s,this._isDirty=!0,this}scale(s){return new b(this._x*s,this._y*s,this._z*s)}scaleToRef(s,Z){return Z._x=this._x*s,Z._y=this._y*s,Z._z=this._z*s,Z._isDirty=!0,Z}getNormalToRef(s){const Z=this.length();let o=Math.acos(this._y/Z);const t=Math.atan2(this._z,this._x);o>Math.PI/2?o-=Math.PI/2:o+=Math.PI/2;const j=Z*Math.sin(o)*Math.cos(t),S=Z*Math.cos(o),a=Z*Math.sin(o)*Math.sin(t);return s.set(j,S,a),s}applyRotationQuaternionToRef(s,Z){const o=this._x,t=this._y,j=this._z,S=s._x,a=s._y,O=s._z,v=s._w,G=2*(a*j-O*t),B=2*(O*o-S*j),Q=2*(S*t-a*o);return Z._x=o+v*G+a*Q-O*B,Z._y=t+v*B+O*G-S*Q,Z._z=j+v*Q+S*B-a*G,Z._isDirty=!0,Z}applyRotationQuaternionInPlace(s){return this.applyRotationQuaternionToRef(s,this)}applyRotationQuaternion(s){return this.applyRotationQuaternionToRef(s,new b)}scaleAndAddToRef(s,Z){return Z._x+=this._x*s,Z._y+=this._y*s,Z._z+=this._z*s,Z._isDirty=!0,Z}projectOnPlane(s,Z){return this.projectOnPlaneToRef(s,Z,new b)}projectOnPlaneToRef(s,Z,o){const t=s.gt,j=s.d,S=U.sO[0];this.subtractToRef(Z,S),S.normalize();const a=b.Dot(S,t);if(Math.abs(a)<1e-10)o.tO(1/0);else{const s=-(b.Dot(Z,t)+j)/a,O=S.scaleInPlace(s);Z.addToRef(O,o)}return o}equals(s){return s&&this._x===s._x&&this._y===s._y&&this._z===s._z}equalsWithEpsilon(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.b;return s&&(0,v.WithinEpsilon)(this._x,s._x,Z)&&(0,v.WithinEpsilon)(this._y,s._y,Z)&&(0,v.WithinEpsilon)(this._z,s._z,Z)}equalsToFloats(s,Z,o){return this._x===s&&this._y===Z&&this._z===o}multiplyInPlace(s){return this._x*=s._x,this._y*=s._y,this._z*=s._z,this._isDirty=!0,this}multiply(s){return this.multiplyByFloats(s._x,s._y,s._z)}multiplyToRef(s,Z){return Z._x=this._x*s._x,Z._y=this._y*s._y,Z._z=this._z*s._z,Z._isDirty=!0,Z}multiplyByFloats(s,Z,o){return new b(this._x*s,this._y*Z,this._z*o)}divide(s){return new b(this._x/s._x,this._y/s._y,this._z/s._z)}divideToRef(s,Z){return Z._x=this._x/s._x,Z._y=this._y/s._y,Z._z=this._z/s._z,Z._isDirty=!0,Z}divideInPlace(s){return this._x=this._x/s._x,this._y=this._y/s._y,this._z=this._z/s._z,this._isDirty=!0,this}minimizeInPlace(s){return this.minimizeInPlaceFromFloats(s._x,s._y,s._z)}maximizeInPlace(s){return this.maximizeInPlaceFromFloats(s._x,s._y,s._z)}minimizeInPlaceFromFloats(s,Z,o){return s<this._x&&(this.x=s),Z<this._y&&(this.y=Z),o<this._z&&(this.z=o),this}maximizeInPlaceFromFloats(s,Z,o){return s>this._x&&(this.x=s),Z>this._y&&(this.y=Z),o>this._z&&(this.z=o),this}isNonUniformWithinEpsilon(s){const Z=Math.abs(this._x),o=Math.abs(this._y);if(!(0,v.WithinEpsilon)(Z,o,s))return!0;const t=Math.abs(this._z);return!(0,v.WithinEpsilon)(Z,t,s)||!(0,v.WithinEpsilon)(o,t,s)}get isNonUniform(){const s=Math.abs(this._x);if(s!==Math.abs(this._y))return!0;return s!==Math.abs(this._z)}floorToRef(s){return s._x=Math.floor(this._x),s._y=Math.floor(this._y),s._z=Math.floor(this._z),s._isDirty=!0,s}floor(){return new b(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))}fractToRef(s){return s._x=this._x-Math.floor(this._x),s._y=this._y-Math.floor(this._y),s._z=this._z-Math.floor(this._z),s._isDirty=!0,s}fract(){return new b(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z))}length(){return Math.sqrt(this.lengthSquared())}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z}get hasAZeroComponent(){return this._x*this._y*this._z===0}normalize(){return this.normalizeFromLength(this.length())}reorderInPlace(s){if("xyz"===(s=s.toLowerCase()))return this;const Z=U.sO[0].O(this);return this.x=Z[s[0]],this.y=Z[s[1]],this.z=Z[s[2]],this}rotateByQuaternionToRef(s,Z){return s.toRotationMatrix(U.Matrix[0]),b.TransformCoordinatesToRef(this,U.Matrix[0],Z),Z}rotateByQuaternionAroundPointToRef(s,Z,o){return this.subtractToRef(Z,U.sO[0]),U.sO[0].rotateByQuaternionToRef(s,U.sO[0]),Z.addToRef(U.sO[0],o),o}cross(s){return b.CrossToRef(this,s,new b)}normalizeFromLength(s){return 0===s||1===s?this:this.scaleInPlace(1/s)}normalizeToNew(){return this.normalizeToRef(new b)}normalizeToRef(s){const Z=this.length();return 0===Z||1===Z?(s._x=this._x,s._y=this._y,s._z=this._z,s._isDirty=!0,s):this.scaleToRef(1/Z,s)}clone(){return new b(this._x,this._y,this._z)}O(s){return this.Ja(s._x,s._y,s._z)}Ja(s,Z,o){return this._x=s,this._y=Z,this._z=o,this._isDirty=!0,this}set(s,Z,o){return this.Ja(s,Z,o)}tO(s){return this._x=this._y=this._z=s,this._isDirty=!0,this}static GetClipFactor(s,Z,o,t){const j=b.Dot(s,o);return(j-t)/(j-b.Dot(Z,o))}static GetAngleBetweenVectors(s,Z,o){const t=s.normalizeToRef(U.sO[1]),j=Z.normalizeToRef(U.sO[2]);let S=b.Dot(t,j);S=(0,v.Clamp)(S,-1,1);const a=Math.acos(S),O=U.sO[3];return b.CrossToRef(t,j,O),b.Dot(O,o)>0?isNaN(a)?0:a:isNaN(a)?-Math.PI:-Math.acos(S)}static GetAngleBetweenVectorsOnPlane(s,Z,o){U.sO[0].O(s);const t=U.sO[0];U.sO[1].O(Z);const j=U.sO[1];U.sO[2].O(o);const S=U.sO[2],a=U.sO[3],O=U.sO[4];t.normalize(),j.normalize(),S.normalize(),b.CrossToRef(S,t,a),b.CrossToRef(a,S,O);const G=Math.atan2(b.Dot(j,a),b.Dot(j,O));return(0,v.NormalizeRadians)(G)}static PitchYawRollToMoveBetweenPointsToRef(s,Z,o){const t=u.sO[0];return Z.subtractToRef(s,t),o._y=Math.atan2(t.x,t.z)||0,o._x=Math.atan2(Math.sqrt(t.x**2+t.z**2),t.y)||0,o._z=0,o._isDirty=!0,o}static PitchYawRollToMoveBetweenPoints(s,Z){const o=b.Zero();return b.PitchYawRollToMoveBetweenPointsToRef(s,Z,o)}static SlerpToRef(s,Z,o,j){o=(0,v.Clamp)(o,0,1);const S=U.sO[0],a=U.sO[1];S.O(s);const O=S.length();S.normalizeFromLength(O),a.O(Z);const G=a.length();a.normalizeFromLength(G);const B=b.Dot(S,a);let Q,D;if(B<1-t.b){const s=Math.acos(B),Z=1/Math.sin(s);Q=Math.sin((1-o)*s)*Z,D=Math.sin(o*s)*Z}else Q=1-o,D=o;return S.scaleInPlace(Q),a.scaleInPlace(D),j.O(S).addInPlace(a),j.scaleInPlace((0,v.Lerp)(O,G,o)),j}static SmoothToRef(s,Z,o,t,j){return b.SlerpToRef(s,Z,0===t?1:o/t,j),j}static oO(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new b(s[Z],s[Z+1],s[Z+2])}static FromFloatArray(s,Z){return b.oO(s,Z)}static FromArrayToRef(s,Z,o){return o._x=s[Z],o._y=s[Z+1],o._z=s[Z+2],o._isDirty=!0,o}static FromFloatArrayToRef(s,Z,o){return b.FromArrayToRef(s,Z,o)}static FromFloatsToRef(s,Z,o,t){return t.Ja(s,Z,o),t}static Zero(){return new b(0,0,0)}static One(){return new b(1,1,1)}static Up(){return new b(0,1,0)}static get UpReadOnly(){return b._UpReadOnly}static get DownReadOnly(){return b._DownReadOnly}static get RightReadOnly(){return b._RightReadOnly}static get LeftReadOnly(){return b._LeftReadOnly}static get LeftHandedForwardReadOnly(){return b._LeftHandedForwardReadOnly}static get RightHandedForwardReadOnly(){return b._RightHandedForwardReadOnly}static get LeftHandedBackwardReadOnly(){return b._LeftHandedBackwardReadOnly}static get RightHandedBackwardReadOnly(){return b._RightHandedBackwardReadOnly}static get ZeroReadOnly(){return b._ZeroReadOnly}static get OneReadOnly(){return b._OneReadOnly}static Down(){return new b(0,-1,0)}static Forward(){return new b(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?-1:1)}static Backward(){return new b(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?1:-1)}static Right(){return new b(1,0,0)}static Left(){return new b(-1,0,0)}static Random(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new b((0,v.RandomRange)(s,Z),(0,v.RandomRange)(s,Z),(0,v.RandomRange)(s,Z))}static RandomToRef(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).Ja((0,v.RandomRange)(s,Z),(0,v.RandomRange)(s,Z),(0,v.RandomRange)(s,Z))}static TransformCoordinates(s,Z){const o=b.Zero();return b.TransformCoordinatesToRef(s,Z,o),o}static TransformCoordinatesToRef(s,Z,o){return b.TransformCoordinatesFromFloatsToRef(s._x,s._y,s._z,Z,o),o}static TransformCoordinatesFromFloatsToRef(s,Z,o,t,j){const S=t.m,a=s*S[0]+Z*S[4]+o*S[8]+S[12],O=s*S[1]+Z*S[5]+o*S[9]+S[13],v=s*S[2]+Z*S[6]+o*S[10]+S[14],G=1/(s*S[3]+Z*S[7]+o*S[11]+S[15]);return j._x=a*G,j._y=O*G,j._z=v*G,j._isDirty=!0,j}static TransformNormal(s,Z){const o=b.Zero();return b.TransformNormalToRef(s,Z,o),o}static TransformNormalToRef(s,Z,o){return this.TransformNormalFromFloatsToRef(s._x,s._y,s._z,Z,o),o}static TransformNormalFromFloatsToRef(s,Z,o,t,j){const S=t.m;return j._x=s*S[0]+Z*S[4]+o*S[8],j._y=s*S[1]+Z*S[5]+o*S[9],j._z=s*S[2]+Z*S[6]+o*S[10],j._isDirty=!0,j}static CatmullRom(s,Z,o,t,j){const S=j*j,a=j*S,O=.5*(2*Z._x+(-s._x+o._x)*j+(2*s._x-5*Z._x+4*o._x-t._x)*S+(-s._x+3*Z._x-3*o._x+t._x)*a),v=.5*(2*Z._y+(-s._y+o._y)*j+(2*s._y-5*Z._y+4*o._y-t._y)*S+(-s._y+3*Z._y-3*o._y+t._y)*a),G=.5*(2*Z._z+(-s._z+o._z)*j+(2*s._z-5*Z._z+4*o._z-t._z)*S+(-s._z+3*Z._z-3*o._z+t._z)*a);return new b(O,v,G)}static Clamp(s,Z,o){const t=new b;return b.ClampToRef(s,Z,o,t),t}static ClampToRef(s,Z,o,t){let j=s._x;j=j>o._x?o._x:j,j=j<Z._x?Z._x:j;let S=s._y;S=S>o._y?o._y:S,S=S<Z._y?Z._y:S;let a=s._z;return a=a>o._z?o._z:a,a=a<Z._z?Z._z:a,t.Ja(j,S,a),t}static CheckExtends(s,Z,o){Z.minimizeInPlace(s),o.maximizeInPlace(s)}static Hermite(s,Z,o,t,j){const S=j*j,a=j*S,O=2*a-3*S+1,v=-2*a+3*S,G=a-2*S+j,B=a-S,Q=s._x*O+o._x*v+Z._x*G+t._x*B,D=s._y*O+o._y*v+Z._y*G+t._y*B,z=s._z*O+o._z*v+Z._z*G+t._z*B;return new b(Q,D,z)}static Hermite1stDerivative(s,Z,o,t,j){const S=new b;return this.Hermite1stDerivativeToRef(s,Z,o,t,j,S),S}static Hermite1stDerivativeToRef(s,Z,o,t,j,S){const a=j*j;return S._x=6*(a-j)*s._x+(3*a-4*j+1)*Z._x+6*(-a+j)*o._x+(3*a-2*j)*t._x,S._y=6*(a-j)*s._y+(3*a-4*j+1)*Z._y+6*(-a+j)*o._y+(3*a-2*j)*t._y,S._z=6*(a-j)*s._z+(3*a-4*j+1)*Z._z+6*(-a+j)*o._z+(3*a-2*j)*t._z,S._isDirty=!0,S}static Lerp(s,Z,o){const t=new b(0,0,0);return b.LerpToRef(s,Z,o,t),t}static LerpToRef(s,Z,o,t){return t._x=s._x+(Z._x-s._x)*o,t._y=s._y+(Z._y-s._y)*o,t._z=s._z+(Z._z-s._z)*o,t._isDirty=!0,t}static Dot(s,Z){return s._x*Z._x+s._y*Z._y+s._z*Z._z}dot(s){return this._x*s._x+this._y*s._y+this._z*s._z}static Cross(s,Z){const o=new b;return b.CrossToRef(s,Z,o),o}static CrossToRef(s,Z,o){const t=s._y*Z._z-s._z*Z._y,j=s._z*Z._x-s._x*Z._z,S=s._x*Z._y-s._y*Z._x;return o.Ja(t,j,S),o}static Normalize(s){const Z=b.Zero();return b.NormalizeToRef(s,Z),Z}static NormalizeToRef(s,Z){return s.normalizeToRef(Z),Z}static Project(s,Z,o,t){const j=new b;return b.ProjectToRef(s,Z,o,t,j),j}static ProjectToRef(s,Z,o,t,j){var S;const a=t.width,v=t.height,G=t.x,B=t.y,Q=U.Matrix[1],D=null===(S=O.c.LastCreatedEngine)||void 0===S?void 0:S.isNDCHalfZRange,z=D?1:.5,Y=D?0:.5;d.FromValuesToRef(a/2,0,0,0,0,-v/2,0,0,0,0,z,0,G+a/2,v/2+B,Y,1,Q);const f=U.Matrix[0];return Z.multiplyToRef(o,f),f.multiplyToRef(Q,f),b.TransformCoordinatesToRef(s,f,j),j}static Reflect(s,Z){return this.ReflectToRef(s,Z,new b)}static ReflectToRef(s,Z,o){const t=u.sO[0];return t.O(Z).scaleInPlace(2*b.Dot(s,Z)),o.O(s).RB(t)}static _UnprojectFromInvertedMatrixToRef(s,Z,o){b.TransformCoordinatesToRef(s,Z,o);const t=Z.m,j=s._x*t[3]+s._y*t[7]+s._z*t[11]+t[15];return(0,v.WithinEpsilon)(j,1)&&o.scaleInPlace(1/j),o}static UnprojectFromTransform(s,Z,o,t,j){return this.Unproject(s,Z,o,t,j,d.IdentityReadOnly)}static Unproject(s,Z,o,t,j,S){const a=new b;return b.UnprojectToRef(s,Z,o,t,j,S,a),a}static UnprojectToRef(s,Z,o,t,j,S,a){return b.UnprojectFloatsToRef(s._x,s._y,s._z,Z,o,t,j,S,a),a}static UnprojectFloatsToRef(s,Z,o,t,j,S,a,v,G){var B;const Q=U.Matrix[0];S.multiplyToRef(a,Q),Q.multiplyToRef(v,Q),Q.invert();const D=U.sO[0];return D.x=s/t*2-1,D.y=-(Z/j*2-1),null!==(B=O.c.LastCreatedEngine)&&void 0!==B&&B.isNDCHalfZRange?D.z=o:D.z=2*o-1,b._UnprojectFromInvertedMatrixToRef(D,Q,G),G}static Minimize(s,Z){const o=new b;return o.O(s),o.minimizeInPlace(Z),o}static Maximize(s,Z){const o=new b;return o.O(s),o.maximizeInPlace(Z),o}static Distance(s,Z){return Math.sqrt(b.DistanceSquared(s,Z))}static DistanceSquared(s,Z){const o=s._x-Z._x,t=s._y-Z._y,j=s._z-Z._z;return o*o+t*t+j*j}static ProjectOnTriangleToRef(s,Z,o,j,S){const a=U.sO[0],O=U.sO[1],G=U.sO[2],B=U.sO[3],Q=U.sO[4];o.subtractToRef(Z,a),j.subtractToRef(Z,O),j.subtractToRef(o,G);const D=a.length(),z=O.length(),Y=G.length();if(D<t.b||z<t.b||Y<t.b)return S.O(Z),b.Distance(s,Z);s.subtractToRef(Z,Q),b.CrossToRef(a,O,B);const f=B.length();if(f<t.b)return S.O(Z),b.Distance(s,Z);B.normalizeFromLength(f);let A=Q.length();if(A<t.b)return S.O(Z),0;Q.normalizeFromLength(A);const d=b.Dot(B,Q),u=U.sO[5],H=U.sO[6];u.O(B).scaleInPlace(-A*d),H.O(s).addInPlace(u);const F=U.sO[4],i=U.sO[5],N=U.sO[7],L=U.sO[8];F.O(a).scaleInPlace(1/D),L.O(O).scaleInPlace(1/z),F.addInPlace(L).scaleInPlace(-1),i.O(a).scaleInPlace(-1/D),L.O(G).scaleInPlace(1/Y),i.addInPlace(L).scaleInPlace(-1),N.O(G).scaleInPlace(-1/Y),L.O(O).scaleInPlace(-1/z),N.addInPlace(L).scaleInPlace(-1);const V=U.sO[9];let g;V.O(H).RB(Z),b.CrossToRef(F,V,L),g=b.Dot(L,B);const l=g;V.O(H).RB(o),b.CrossToRef(i,V,L),g=b.Dot(L,B);const R=g;V.O(H).RB(j),b.CrossToRef(N,V,L),g=b.Dot(L,B);const e=g,c=U.sO[10];let w,X;l>0&&R<0?(c.O(a),w=Z,X=o):R>0&&e<0?(c.O(G),w=o,X=j):(c.O(O).scaleInPlace(-1),w=j,X=Z);const W=U.sO[9],q=U.sO[4];w.subtractToRef(H,L),X.subtractToRef(H,W),b.CrossToRef(L,W,q);if(!(b.Dot(q,B)<0))return S.O(H),Math.abs(A*d);const h=U.sO[5];b.CrossToRef(c,q,h),h.normalize();const M=U.sO[9];M.O(w).RB(H);const x=M.length();if(x<t.b)return S.O(w),b.Distance(s,w);M.normalizeFromLength(x);const k=b.Dot(h,M),y=U.sO[7];y.O(H).addInPlace(h.scaleInPlace(x*k)),L.O(y).RB(w),A=c.length(),c.normalizeFromLength(A);let I=b.Dot(L,c)/Math.max(A,t.b);return I=(0,v.Clamp)(I,0,1),y.O(w).addInPlace(c.scaleInPlace(I*A)),S.O(y),b.Distance(s,y)}static Center(s,Z){return b.CenterToRef(s,Z,b.Zero())}static CenterToRef(s,Z,o){return o.Ja((s._x+Z._x)/2,(s._y+Z._y)/2,(s._z+Z._z)/2)}static RotationFromAxis(s,Z,o){const t=new b;return b.RotationFromAxisToRef(s,Z,o,t),t}static RotationFromAxisToRef(s,Z,o,t){const j=U.Quaternion[0];return A.RotationQuaternionFromAxisToRef(s,Z,o,j),j.toEulerAnglesToRef(t),t}}b._V8PerformanceHack=new b(.5,.5,.5),b._UpReadOnly=b.Up(),b._DownReadOnly=b.Down(),b._LeftHandedForwardReadOnly=b.Forward(!1),b._RightHandedForwardReadOnly=b.Forward(!0),b._LeftHandedBackwardReadOnly=b.Backward(!1),b._RightHandedBackwardReadOnly=b.Backward(!0),b._RightReadOnly=b.Right(),b._LeftReadOnly=b.Left(),b._ZeroReadOnly=b.Zero(),b._OneReadOnly=b.One(),Object.defineProperties(b.prototype,{dimension:{value:[3]},rank:{value:1}});class f{get x(){return this._x}set x(s){this._x=s,this._isDirty=!0}get y(){return this._y}set y(s){this._y=s,this._isDirty=!0}get z(){return this._z}set z(s){this._z=s,this._isDirty=!0}get w(){return this._w}set w(s){this._w=s,this._isDirty=!0}constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._isDirty=!0,this._x=s,this._y=Z,this._z=o,this._w=t}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Vector4"}getHashCode(){let s=z(this._x);return s=397*s^z(this._y),s=397*s^z(this._z),s=397*s^z(this._w),s}ma(){return[this._x,this._y,this._z,this._w]}toArray(s,Z){return void 0===Z&&(Z=0),s[Z]=this._x,s[Z+1]=this._y,s[Z+2]=this._z,s[Z+3]=this._w,this}Bo(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return f.FromArrayToRef(s,Z,this),this}addInPlace(s){return this.x+=s._x,this.y+=s._y,this.z+=s._z,this.w+=s._w,this}addInPlaceFromFloats(s,Z,o,t){return this.x+=s,this.y+=Z,this.z+=o,this.w+=t,this}add(s){return new f(this._x+s.x,this._y+s.y,this._z+s.z,this._w+s.w)}addToRef(s,Z){return Z.x=this._x+s.x,Z.y=this._y+s.y,Z.z=this._z+s.z,Z.w=this._w+s.w,Z}RB(s){return this.x-=s.x,this.y-=s.y,this.z-=s.z,this.w-=s.w,this}Go(s){return new f(this._x-s.x,this._y-s.y,this._z-s.z,this._w-s.w)}subtractToRef(s,Z){return Z.x=this._x-s.x,Z.y=this._y-s.y,Z.z=this._z-s.z,Z.w=this._w-s.w,Z}subtractFromFloats(s,Z,o,t){return new f(this._x-s,this._y-Z,this._z-o,this._w-t)}subtractFromFloatsToRef(s,Z,o,t,j){return j.x=this._x-s,j.y=this._y-Z,j.z=this._z-o,j.w=this._w-t,j}negate(){return new f(-this._x,-this._y,-this._z,-this._w)}negateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}negateToRef(s){return s.x=-this._x,s.y=-this._y,s.z=-this._z,s.w=-this._w,s}scaleInPlace(s){return this.x*=s,this.y*=s,this.z*=s,this.w*=s,this}scale(s){return new f(this._x*s,this._y*s,this._z*s,this._w*s)}scaleToRef(s,Z){return Z.x=this._x*s,Z.y=this._y*s,Z.z=this._z*s,Z.w=this._w*s,Z}scaleAndAddToRef(s,Z){return Z.x+=this._x*s,Z.y+=this._y*s,Z.z+=this._z*s,Z.w+=this._w*s,Z}equals(s){return s&&this._x===s.x&&this._y===s.y&&this._z===s.z&&this._w===s.w}equalsWithEpsilon(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.b;return s&&(0,v.WithinEpsilon)(this._x,s.x,Z)&&(0,v.WithinEpsilon)(this._y,s.y,Z)&&(0,v.WithinEpsilon)(this._z,s.z,Z)&&(0,v.WithinEpsilon)(this._w,s.w,Z)}equalsToFloats(s,Z,o,t){return this._x===s&&this._y===Z&&this._z===o&&this._w===t}multiplyInPlace(s){return this.x*=s.x,this.y*=s.y,this.z*=s.z,this.w*=s.w,this}multiply(s){return new f(this._x*s.x,this._y*s.y,this._z*s.z,this._w*s.w)}multiplyToRef(s,Z){return Z.x=this._x*s.x,Z.y=this._y*s.y,Z.z=this._z*s.z,Z.w=this._w*s.w,Z}multiplyByFloats(s,Z,o,t){return new f(this._x*s,this._y*Z,this._z*o,this._w*t)}divide(s){return new f(this._x/s.x,this._y/s.y,this._z/s.z,this._w/s.w)}divideToRef(s,Z){return Z.x=this._x/s.x,Z.y=this._y/s.y,Z.z=this._z/s.z,Z.w=this._w/s.w,Z}divideInPlace(s){return this.divideToRef(s,this)}minimizeInPlace(s){return s.x<this._x&&(this.x=s.x),s.y<this._y&&(this.y=s.y),s.z<this._z&&(this.z=s.z),s.w<this._w&&(this.w=s.w),this}maximizeInPlace(s){return s.x>this._x&&(this.x=s.x),s.y>this._y&&(this.y=s.y),s.z>this._z&&(this.z=s.z),s.w>this._w&&(this.w=s.w),this}minimizeInPlaceFromFloats(s,Z,o,t){return this.x=Math.min(s,this._x),this.y=Math.min(Z,this._y),this.z=Math.min(o,this._z),this.w=Math.min(t,this._w),this}maximizeInPlaceFromFloats(s,Z,o,t){return this.x=Math.max(s,this._x),this.y=Math.max(Z,this._y),this.z=Math.max(o,this._z),this.w=Math.max(t,this._w),this}floorToRef(s){return s.x=Math.floor(this._x),s.y=Math.floor(this._y),s.z=Math.floor(this._z),s.w=Math.floor(this._w),s}floor(){return new f(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z),Math.floor(this._w))}fractToRef(s){return s.x=this._x-Math.floor(this._x),s.y=this._y-Math.floor(this._y),s.z=this._z-Math.floor(this._z),s.w=this._w-Math.floor(this._w),s}fract(){return new f(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z),this._w-Math.floor(this._w))}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(s){return 0===s||1===s?this:this.scaleInPlace(1/s)}normalizeToNew(){return this.normalizeToRef(new f)}normalizeToRef(s){const Z=this.length();return 0===Z||1===Z?(s.x=this._x,s.y=this._y,s.z=this._z,s.w=this._w,s):this.scaleToRef(1/Z,s)}toVector3(){return new b(this._x,this._y,this._z)}clone(){return new f(this._x,this._y,this._z,this._w)}O(s){return this.x=s.x,this.y=s.y,this.z=s.z,this.w=s.w,this}Ja(s,Z,o,t){return this.x=s,this.y=Z,this.z=o,this.w=t,this}set(s,Z,o,t){return this.Ja(s,Z,o,t)}tO(s){return this.x=this.y=this.z=this.w=s,this}dot(s){return this._x*s.x+this._y*s.y+this._z*s.z+this._w*s.w}static oO(s,Z){return Z||(Z=0),new f(s[Z],s[Z+1],s[Z+2],s[Z+3])}static FromArrayToRef(s,Z,o){return o.x=s[Z],o.y=s[Z+1],o.z=s[Z+2],o.w=s[Z+3],o}static FromFloatArrayToRef(s,Z,o){return f.FromArrayToRef(s,Z,o),o}static FromFloatsToRef(s,Z,o,t,j){return j.x=s,j.y=Z,j.z=o,j.w=t,j}static Zero(){return new f(0,0,0,0)}static One(){return new f(1,1,1,1)}static Random(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new f((0,v.RandomRange)(s,Z),(0,v.RandomRange)(s,Z),(0,v.RandomRange)(s,Z),(0,v.RandomRange)(s,Z))}static RandomToRef(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2?arguments[2]:void 0;return o.x=(0,v.RandomRange)(s,Z),o.y=(0,v.RandomRange)(s,Z),o.z=(0,v.RandomRange)(s,Z),o.w=(0,v.RandomRange)(s,Z),o}static Clamp(s,Z,o){return f.ClampToRef(s,Z,o,new f)}static ClampToRef(s,Z,o,t){return t.x=(0,v.Clamp)(s.x,Z.x,o.x),t.y=(0,v.Clamp)(s.y,Z.y,o.y),t.z=(0,v.Clamp)(s.z,Z.z,o.z),t.w=(0,v.Clamp)(s.w,Z.w,o.w),t}static CheckExtends(s,Z,o){Z.minimizeInPlace(s),o.maximizeInPlace(s)}static get ZeroReadOnly(){return f._ZeroReadOnly}static Normalize(s){return f.NormalizeToRef(s,new f)}static NormalizeToRef(s,Z){return s.normalizeToRef(Z),Z}static Minimize(s,Z){const o=new f;return o.O(s),o.minimizeInPlace(Z),o}static Maximize(s,Z){const o=new f;return o.O(s),o.maximizeInPlace(Z),o}static Distance(s,Z){return Math.sqrt(f.DistanceSquared(s,Z))}static DistanceSquared(s,Z){const o=s.x-Z.x,t=s.y-Z.y,j=s.z-Z.z,S=s.w-Z.w;return o*o+t*t+j*j+S*S}static Center(s,Z){return f.CenterToRef(s,Z,new f)}static CenterToRef(s,Z,o){return o.x=(s.x+Z.x)/2,o.y=(s.y+Z.y)/2,o.z=(s.z+Z.z)/2,o.w=(s.w+Z.w)/2,o}static TransformCoordinates(s,Z){return f.TransformCoordinatesToRef(s,Z,new f)}static TransformCoordinatesToRef(s,Z,o){return f.TransformCoordinatesFromFloatsToRef(s._x,s._y,s._z,Z,o),o}static TransformCoordinatesFromFloatsToRef(s,Z,o,t,j){const S=t.m,a=s*S[0]+Z*S[4]+o*S[8]+S[12],O=s*S[1]+Z*S[5]+o*S[9]+S[13],v=s*S[2]+Z*S[6]+o*S[10]+S[14],G=s*S[3]+Z*S[7]+o*S[11]+S[15];return j.x=a,j.y=O,j.z=v,j.w=G,j}static TransformNormal(s,Z){return f.TransformNormalToRef(s,Z,new f)}static TransformNormalToRef(s,Z,o){const t=Z.m,j=s.x*t[0]+s.y*t[4]+s.z*t[8],S=s.x*t[1]+s.y*t[5]+s.z*t[9],a=s.x*t[2]+s.y*t[6]+s.z*t[10];return o.x=j,o.y=S,o.z=a,o.w=s.w,o}static TransformNormalFromFloatsToRef(s,Z,o,t,j,S){const a=j.m;return S.x=s*a[0]+Z*a[4]+o*a[8],S.y=s*a[1]+Z*a[5]+o*a[9],S.z=s*a[2]+Z*a[6]+o*a[10],S.w=t,S}static FromVector3(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new f(s._x,s._y,s._z,Z)}static Dot(s,Z){return s.x*Z.x+s.y*Z.y+s.z*Z.z+s.w*Z.w}}f._V8PerformanceHack=new f(.5,.5,.5,.5),f._ZeroReadOnly=f.Zero(),Object.defineProperties(f.prototype,{dimension:{value:[4]},rank:{value:1}});class A{get x(){return this._x}set x(s){this._x=s,this._isDirty=!0}get y(){return this._y}set y(s){this._y=s,this._isDirty=!0}get z(){return this._z}set z(s){this._z=s,this._isDirty=!0}get w(){return this._w}set w(s){this._w=s,this._isDirty=!0}constructor(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this._isDirty=!0,this._x=s,this._y=Z,this._z=o,this._w=t}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Quaternion"}getHashCode(){let s=z(this._x);return s=397*s^z(this._y),s=397*s^z(this._z),s=397*s^z(this._w),s}ma(){return[this._x,this._y,this._z,this._w]}toArray(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return s[Z]=this._x,s[Z+1]=this._y,s[Z+2]=this._z,s[Z+3]=this._w,this}Bo(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return A.FromArrayToRef(s,Z,this)}equals(s){return s&&this._x===s._x&&this._y===s._y&&this._z===s._z&&this._w===s._w}equalsWithEpsilon(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.b;return s&&(0,v.WithinEpsilon)(this._x,s._x,Z)&&(0,v.WithinEpsilon)(this._y,s._y,Z)&&(0,v.WithinEpsilon)(this._z,s._z,Z)&&(0,v.WithinEpsilon)(this._w,s._w,Z)}isApprox(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.b;return s&&((0,v.WithinEpsilon)(this._x,s._x,Z)&&(0,v.WithinEpsilon)(this._y,s._y,Z)&&(0,v.WithinEpsilon)(this._z,s._z,Z)&&(0,v.WithinEpsilon)(this._w,s._w,Z)||(0,v.WithinEpsilon)(this._x,-s._x,Z)&&(0,v.WithinEpsilon)(this._y,-s._y,Z)&&(0,v.WithinEpsilon)(this._z,-s._z,Z)&&(0,v.WithinEpsilon)(this._w,-s._w,Z))}clone(){return new A(this._x,this._y,this._z,this._w)}O(s){return this._x=s._x,this._y=s._y,this._z=s._z,this._w=s._w,this._isDirty=!0,this}Ja(s,Z,o,t){return this._x=s,this._y=Z,this._z=o,this._w=t,this._isDirty=!0,this}set(s,Z,o,t){return this.Ja(s,Z,o,t)}tO(s){return this.Ja(s,s,s,s)}add(s){return new A(this._x+s._x,this._y+s._y,this._z+s._z,this._w+s._w)}addInPlace(s){return this._x+=s._x,this._y+=s._y,this._z+=s._z,this._w+=s._w,this._isDirty=!0,this}addToRef(s,Z){return Z._x=this._x+s._x,Z._y=this._y+s._y,Z._z=this._z+s._z,Z._w=this._w+s._w,Z._isDirty=!0,Z}addInPlaceFromFloats(s,Z,o,t){return this._x+=s,this._y+=Z,this._z+=o,this._w+=t,this._isDirty=!0,this}subtractToRef(s,Z){return Z._x=this._x-s._x,Z._y=this._y-s._y,Z._z=this._z-s._z,Z._w=this._w-s._w,Z._isDirty=!0,Z}subtractFromFloats(s,Z,o,t){return this.subtractFromFloatsToRef(s,Z,o,t,new A)}subtractFromFloatsToRef(s,Z,o,t,j){return j._x=this._x-s,j._y=this._y-Z,j._z=this._z-o,j._w=this._w-t,j._isDirty=!0,j}Go(s){return new A(this._x-s._x,this._y-s._y,this._z-s._z,this._w-s._w)}RB(s){return this._x-=s._x,this._y-=s._y,this._z-=s._z,this._w-=s._w,this._isDirty=!0,this}scale(s){return new A(this._x*s,this._y*s,this._z*s,this._w*s)}scaleToRef(s,Z){return Z._x=this._x*s,Z._y=this._y*s,Z._z=this._z*s,Z._w=this._w*s,Z._isDirty=!0,Z}scaleInPlace(s){return this._x*=s,this._y*=s,this._z*=s,this._w*=s,this._isDirty=!0,this}scaleAndAddToRef(s,Z){return Z._x+=this._x*s,Z._y+=this._y*s,Z._z+=this._z*s,Z._w+=this._w*s,Z._isDirty=!0,Z}multiply(s){const Z=new A(0,0,0,1);return this.multiplyToRef(s,Z),Z}multiplyToRef(s,Z){const o=this._x*s._w+this._y*s._z-this._z*s._y+this._w*s._x,t=-this._x*s._z+this._y*s._w+this._z*s._x+this._w*s._y,j=this._x*s._y-this._y*s._x+this._z*s._w+this._w*s._z,S=-this._x*s._x-this._y*s._y-this._z*s._z+this._w*s._w;return Z.Ja(o,t,j,S),Z}multiplyInPlace(s){return this.multiplyToRef(s,this)}multiplyByFloats(s,Z,o,t){return this._x*=s,this._y*=Z,this._z*=o,this._w*=t,this._isDirty=!0,this}divide(s){throw new ReferenceError("Can not divide a quaternion")}divideToRef(s,Z){throw new ReferenceError("Can not divide a quaternion")}divideInPlace(s){throw new ReferenceError("Can not divide a quaternion")}minimizeInPlace(){throw new ReferenceError("Can not minimize a quaternion")}minimizeInPlaceFromFloats(){throw new ReferenceError("Can not minimize a quaternion")}maximizeInPlace(){throw new ReferenceError("Can not maximize a quaternion")}maximizeInPlaceFromFloats(){throw new ReferenceError("Can not maximize a quaternion")}negate(){return this.negateToRef(new A)}negateInPlace(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._isDirty=!0,this}negateToRef(s){return s._x=-this._x,s._y=-this._y,s._z=-this._z,s._w=-this._w,s._isDirty=!0,s}equalsToFloats(s,Z,o,t){return this._x===s&&this._y===Z&&this._z===o&&this._w===t}floorToRef(s){throw new ReferenceError("Can not floor a quaternion")}floor(){throw new ReferenceError("Can not floor a quaternion")}fractToRef(s){throw new ReferenceError("Can not fract a quaternion")}fract(){throw new ReferenceError("Can not fract a quaternion")}conjugateToRef(s){return s.Ja(-this._x,-this._y,-this._z,this._w),s}conjugateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}conjugate(){return new A(-this._x,-this._y,-this._z,this._w)}invert(){const s=this.conjugate(),Z=this.lengthSquared();return 0==Z||1==Z||s.scaleInPlace(1/Z),s}invertInPlace(){this.conjugateInPlace();const s=this.lengthSquared();return 0==s||1==s||this.scaleInPlace(1/s),this}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this.lengthSquared())}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(s){return 0===s||1===s?this:this.scaleInPlace(1/s)}normalizeToNew(){const s=new A(0,0,0,1);return this.normalizeToRef(s),s}normalizeToRef(s){const Z=this.length();return 0===Z||1===Z?s.Ja(this._x,this._y,this._z,this._w):this.scaleToRef(1/Z,s)}toEulerAngles(){const s=b.Zero();return this.toEulerAnglesToRef(s),s}toEulerAnglesToRef(s){const Z=this._z,o=this._x,t=this._y,j=this._w,S=t*Z-o*j,a=.4999999;if(S<-a)s._y=2*Math.atan2(t,j),s._x=Math.PI/2,s._z=0,s._isDirty=!0;else if(S>a)s._y=2*Math.atan2(t,j),s._x=-Math.PI/2,s._z=0,s._isDirty=!0;else{const a=j*j,O=Z*Z,v=o*o,G=t*t;s._z=Math.atan2(2*(o*t+Z*j),-O-v+G+a),s._x=Math.asin(-2*S),s._y=Math.atan2(2*(Z*o+t*j),O-v-G+a),s._isDirty=!0}return s}toAlphaBetaGammaToRef(s){const Z=this._z,o=this._x,t=this._y,j=this._w,S=Math.sqrt(o*o+t*t),a=Math.sqrt(Z*Z+j*j),O=2*Math.atan2(S,a),v=2*Math.atan2(Z,j),G=2*Math.atan2(t,o),B=(v+G)/2,Q=(v-G)/2;return s.set(Q,O,B),s}toRotationMatrix(s){return d.FromQuaternionToRef(this,s),s}fromRotationMatrix(s){return A.FromRotationMatrixToRef(s,this),this}dot(s){return this._x*s._x+this._y*s._y+this._z*s._z+this._w*s._w}toAxisAngle(){const s=b.Zero();return{axis:s,angle:this.toAxisAngleToRef(s)}}toAxisAngleToRef(s){let Z=0;const o=Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z),t=this._w;return o>0?(Z=2*Math.atan2(o,t),s.set(this._x/o,this._y/o,this._z/o)):(Z=0,s.set(1,0,0)),Z}static FromRotationMatrix(s){const Z=new A;return A.FromRotationMatrixToRef(s,Z),Z}static FromRotationMatrixToRef(s,Z){const o=s.m,t=o[0],j=o[4],S=o[8],a=o[1],O=o[5],v=o[9],G=o[2],B=o[6],Q=o[10],D=t+O+Q;let z;return D>0?(z=.5/Math.sqrt(D+1),Z._w=.25/z,Z._x=(B-v)*z,Z._y=(S-G)*z,Z._z=(a-j)*z,Z._isDirty=!0):t>O&&t>Q?(z=2*Math.sqrt(1+t-O-Q),Z._w=(B-v)/z,Z._x=.25*z,Z._y=(j+a)/z,Z._z=(S+G)/z,Z._isDirty=!0):O>Q?(z=2*Math.sqrt(1+O-t-Q),Z._w=(S-G)/z,Z._x=(j+a)/z,Z._y=.25*z,Z._z=(v+B)/z,Z._isDirty=!0):(z=2*Math.sqrt(1+Q-t-O),Z._w=(a-j)/z,Z._x=(S+G)/z,Z._y=(v+B)/z,Z._z=.25*z,Z._isDirty=!0),Z}static Dot(s,Z){return s._x*Z._x+s._y*Z._y+s._z*Z._z+s._w*Z._w}static AreClose(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1;const t=A.Dot(s,Z);return 1-t*t<=o}static SmoothToRef(s,Z,o,t,j){let S=0===t?1:o/t;return S=(0,v.Clamp)(S,0,1),A.SlerpToRef(s,Z,S,j),j}static Zero(){return new A(0,0,0,0)}static Inverse(s){return new A(-s._x,-s._y,-s._z,s._w)}static InverseToRef(s,Z){return Z.set(-s._x,-s._y,-s._z,s._w),Z}static Identity(){return new A(0,0,0,1)}static IsIdentity(s){return s&&0===s._x&&0===s._y&&0===s._z&&1===s._w}static RotationAxis(s,Z){return A.RotationAxisToRef(s,Z,new A)}static RotationAxisToRef(s,Z,o){o._w=Math.cos(Z/2);const t=Math.sin(Z/2)/s.length();return o._x=s._x*t,o._y=s._y*t,o._z=s._z*t,o._isDirty=!0,o}static oO(s,Z){return Z||(Z=0),new A(s[Z],s[Z+1],s[Z+2],s[Z+3])}static FromArrayToRef(s,Z,o){return o._x=s[Z],o._y=s[Z+1],o._z=s[Z+2],o._w=s[Z+3],o._isDirty=!0,o}static FromFloatsToRef(s,Z,o,t,j){return j.Ja(s,Z,o,t),j}static FromEulerAngles(s,Z,o){const t=new A;return A.RotationYawPitchRollToRef(Z,s,o,t),t}static FromEulerAnglesToRef(s,Z,o,t){return A.RotationYawPitchRollToRef(Z,s,o,t),t}static FromEulerVector(s){const Z=new A;return A.RotationYawPitchRollToRef(s._y,s._x,s._z,Z),Z}static FromEulerVectorToRef(s,Z){return A.RotationYawPitchRollToRef(s._y,s._x,s._z,Z),Z}static FromUnitVectorsToRef(s,Z,o){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.b;const S=b.Dot(s,Z)+1;return S<j?Math.abs(s.x)>Math.abs(s.z)?o.set(-s.y,s.x,0,0):o.set(0,-s.z,s.y,0):(b.CrossToRef(s,Z,u.sO[0]),o.set(u.sO[0].x,u.sO[0].y,u.sO[0].z,S)),o.normalize()}static RotationYawPitchRoll(s,Z,o){const t=new A;return A.RotationYawPitchRollToRef(s,Z,o,t),t}static RotationYawPitchRollToRef(s,Z,o,t){const j=.5*o,S=.5*Z,a=.5*s,O=Math.sin(j),v=Math.cos(j),G=Math.sin(S),B=Math.cos(S),Q=Math.sin(a),D=Math.cos(a);return t._x=D*G*v+Q*B*O,t._y=Q*B*v-D*G*O,t._z=D*B*O-Q*G*v,t._w=D*B*v+Q*G*O,t._isDirty=!0,t}static RotationAlphaBetaGamma(s,Z,o){const t=new A;return A.RotationAlphaBetaGammaToRef(s,Z,o,t),t}static RotationAlphaBetaGammaToRef(s,Z,o,t){const j=.5*(o+s),S=.5*(o-s),a=.5*Z;return t._x=Math.cos(S)*Math.sin(a),t._y=Math.sin(S)*Math.sin(a),t._z=Math.sin(j)*Math.cos(a),t._w=Math.cos(j)*Math.cos(a),t._isDirty=!0,t}static RotationQuaternionFromAxis(s,Z,o){const t=new A(0,0,0,0);return A.RotationQuaternionFromAxisToRef(s,Z,o,t),t}static RotationQuaternionFromAxisToRef(s,Z,o,t){const j=U.Matrix[0];return s=s.normalizeToRef(U.sO[0]),Z=Z.normalizeToRef(U.sO[1]),o=o.normalizeToRef(U.sO[2]),d.FromXYZAxesToRef(s,Z,o,j),A.FromRotationMatrixToRef(j,t),t}static FromLookDirectionLH(s,Z){const o=new A;return A.FromLookDirectionLHToRef(s,Z,o),o}static FromLookDirectionLHToRef(s,Z,o){const t=U.Matrix[0];return d.LookDirectionLHToRef(s,Z,t),A.FromRotationMatrixToRef(t,o),o}static FromLookDirectionRH(s,Z){const o=new A;return A.FromLookDirectionRHToRef(s,Z,o),o}static FromLookDirectionRHToRef(s,Z,o){const t=U.Matrix[0];return d.LookDirectionRHToRef(s,Z,t),A.FromRotationMatrixToRef(t,o)}static Slerp(s,Z,o){const t=A.Identity();return A.SlerpToRef(s,Z,o,t),t}static SlerpToRef(s,Z,o,t){let j,S,a=s._x*Z._x+s._y*Z._y+s._z*Z._z+s._w*Z._w,O=!1;if(a<0&&(O=!0,a=-a),a>.999999)S=1-o,j=O?-o:o;else{const s=Math.acos(a),Z=1/Math.sin(s);S=Math.sin((1-o)*s)*Z,j=O?-Math.sin(o*s)*Z:Math.sin(o*s)*Z}return t._x=S*s._x+j*Z._x,t._y=S*s._y+j*Z._y,t._z=S*s._z+j*Z._z,t._w=S*s._w+j*Z._w,t._isDirty=!0,t}static Hermite(s,Z,o,t,j){const S=j*j,a=j*S,O=2*a-3*S+1,v=-2*a+3*S,G=a-2*S+j,B=a-S,Q=s._x*O+o._x*v+Z._x*G+t._x*B,D=s._y*O+o._y*v+Z._y*G+t._y*B,z=s._z*O+o._z*v+Z._z*G+t._z*B,Y=s._w*O+o._w*v+Z._w*G+t._w*B;return new A(Q,D,z,Y)}static Hermite1stDerivative(s,Z,o,t,j){const S=new A;return this.Hermite1stDerivativeToRef(s,Z,o,t,j,S),S}static Hermite1stDerivativeToRef(s,Z,o,t,j,S){const a=j*j;return S._x=6*(a-j)*s._x+(3*a-4*j+1)*Z._x+6*(-a+j)*o._x+(3*a-2*j)*t._x,S._y=6*(a-j)*s._y+(3*a-4*j+1)*Z._y+6*(-a+j)*o._y+(3*a-2*j)*t._y,S._z=6*(a-j)*s._z+(3*a-4*j+1)*Z._z+6*(-a+j)*o._z+(3*a-2*j)*t._z,S._w=6*(a-j)*s._w+(3*a-4*j+1)*Z._w+6*(-a+j)*o._w+(3*a-2*j)*t._w,S._isDirty=!0,S}static Normalize(s){const Z=A.Zero();return A.NormalizeToRef(s,Z),Z}static NormalizeToRef(s,Z){return s.normalizeToRef(Z),Z}static Clamp(s,Z,o){const t=new A;return A.ClampToRef(s,Z,o,t),t}static ClampToRef(s,Z,o,t){return t.Ja((0,v.Clamp)(s.x,Z.x,o.x),(0,v.Clamp)(s.y,Z.y,o.y),(0,v.Clamp)(s.z,Z.z,o.z),(0,v.Clamp)(s.w,Z.w,o.w))}static Random(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new A((0,v.RandomRange)(s,Z),(0,v.RandomRange)(s,Z),(0,v.RandomRange)(s,Z),(0,v.RandomRange)(s,Z))}static RandomToRef(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).Ja((0,v.RandomRange)(s,Z),(0,v.RandomRange)(s,Z),(0,v.RandomRange)(s,Z),(0,v.RandomRange)(s,Z))}static Minimize(){throw new ReferenceError("Quaternion.Minimize does not make sense")}static Maximize(){throw new ReferenceError("Quaternion.Maximize does not make sense")}static Distance(s,Z){return Math.sqrt(A.DistanceSquared(s,Z))}static DistanceSquared(s,Z){const o=s.x-Z.x,t=s.y-Z.y,j=s.z-Z.z,S=s.w-Z.w;return o*o+t*t+j*j+S*S}static Center(s,Z){return A.CenterToRef(s,Z,A.Zero())}static CenterToRef(s,Z,o){return o.Ja((s.x+Z.x)/2,(s.y+Z.y)/2,(s.z+Z.z)/2,(s.w+Z.w)/2)}}A._V8PerformanceHack=new A(.5,.5,.5,.5),Object.defineProperties(A.prototype,{dimension:{value:[4]},rank:{value:1}});class d{static get Use64Bits(){return a.e.MatrixUse64Bits}get m(){return this.mQ}markAsUpdated(){this.updateFlag=G._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}_updateIdentityStatus(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._isIdentity=s,this._isIdentity3x2=s||o,this._isIdentityDirty=!this._isIdentity&&Z,this._isIdentity3x2Dirty=!this._isIdentity3x2&&t}constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,a.e.MatrixTrackPrecisionChange&&a.e.MatrixTrackedMatrices.push(this),this.mQ=new a.e.MatrixCurrentType(16),this.markAsUpdated()}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const s=this.mQ;this._isIdentity=1===s[0]&&0===s[1]&&0===s[2]&&0===s[3]&&0===s[4]&&1===s[5]&&0===s[6]&&0===s[7]&&0===s[8]&&0===s[9]&&1===s[10]&&0===s[11]&&0===s[12]&&0===s[13]&&0===s[14]&&1===s[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this.mQ[0]||1!==this.mQ[5]||1!==this.mQ[15]||0!==this.mQ[1]||0!==this.mQ[2]||0!==this.mQ[3]||0!==this.mQ[4]||0!==this.mQ[6]||0!==this.mQ[7]||0!==this.mQ[8]||0!==this.mQ[9]||0!==this.mQ[10]||0!==this.mQ[11]||0!==this.mQ[12]||0!==this.mQ[13]||0!==this.mQ[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const s=this.mQ,Z=s[0],o=s[1],t=s[2],j=s[3],S=s[4],a=s[5],O=s[6],v=s[7],G=s[8],B=s[9],Q=s[10],D=s[11],z=s[12],Y=s[13],b=s[14],f=s[15],A=Q*f-b*D,d=B*f-Y*D,U=B*b-Y*Q,u=G*f-z*D,H=G*b-Q*z,F=G*Y-z*B;return Z*+(a*A-O*d+v*U)+o*-(S*A-O*u+v*H)+t*+(S*d-a*u+v*F)+j*-(S*U-a*H+O*F)}toString(){return`{${this.m[0]}, ${this.m[1]}, ${this.m[2]}, ${this.m[3]}\n${this.m[4]}, ${this.m[5]}, ${this.m[6]}, ${this.m[7]}\n${this.m[8]}, ${this.m[9]}, ${this.m[10]}, ${this.m[11]}\n${this.m[12]}, ${this.m[13]}, ${this.m[14]}, ${this.m[15]}}`}toArray(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!s)return this.mQ;const o=this.mQ;for(let t=0;t<16;t++)s[Z+t]=o[t];return this}ma(){return this.mQ}Bo(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return d.FromArrayToRef(s,Z,this)}Ja(){for(var s=arguments.length,Z=new Array(s),o=0;o<s;o++)Z[o]=arguments[o];return d.FromArrayToRef(Z,0,this)}set(){const s=this.mQ;for(let Z=0;Z<16;Z++)s[Z]=Z<0||arguments.length<=Z?void 0:arguments[Z];return this.markAsUpdated(),this}tO(s){const Z=this.mQ;for(let o=0;o<16;o++)Z[o]=s;return this.markAsUpdated(),this}invert(){return this.invertToRef(this),this}reset(){return d.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(s){const Z=new d;return this.addToRef(s,Z),Z}addToRef(s,Z){const o=this.mQ,t=Z.mQ,j=s.m;for(let S=0;S<16;S++)t[S]=o[S]+j[S];return Z.markAsUpdated(),Z}addToSelf(s){const Z=this.mQ,o=s.m;return Z[0]+=o[0],Z[1]+=o[1],Z[2]+=o[2],Z[3]+=o[3],Z[4]+=o[4],Z[5]+=o[5],Z[6]+=o[6],Z[7]+=o[7],Z[8]+=o[8],Z[9]+=o[9],Z[10]+=o[10],Z[11]+=o[11],Z[12]+=o[12],Z[13]+=o[13],Z[14]+=o[14],Z[15]+=o[15],this.markAsUpdated(),this}addInPlace(s){const Z=this.mQ,o=s.m;for(let t=0;t<16;t++)Z[t]+=o[t];return this.markAsUpdated(),this}addInPlaceFromFloats(){const s=this.mQ;for(let Z=0;Z<16;Z++)s[Z]+=Z<0||arguments.length<=Z?void 0:arguments[Z];return this.markAsUpdated(),this}Go(s){const Z=this.mQ,o=s.m;for(let t=0;t<16;t++)Z[t]-=o[t];return this.markAsUpdated(),this}subtractToRef(s,Z){const o=this.mQ,t=s.m,j=Z.mQ;for(let S=0;S<16;S++)j[S]=o[S]-t[S];return Z.markAsUpdated(),Z}RB(s){const Z=this.mQ,o=s.m;for(let t=0;t<16;t++)Z[t]-=o[t];return this.markAsUpdated(),this}subtractFromFloats(){for(var s=arguments.length,Z=new Array(s),o=0;o<s;o++)Z[o]=arguments[o];return this.subtractFromFloatsToRef(...Z,new d)}subtractFromFloatsToRef(){for(var s=arguments.length,Z=new Array(s),o=0;o<s;o++)Z[o]=arguments[o];const t=Z.pop(),j=this.mQ,S=t.mQ,a=Z;for(let O=0;O<16;O++)S[O]=j[O]-a[O];return t.markAsUpdated(),t}invertToRef(s){return!0===this._isIdentity?(d.IdentityToRef(s),s):(D(this,s.ma())?s.markAsUpdated():s.O(this),s)}addAtIndex(s,Z){return this.mQ[s]+=Z,this.markAsUpdated(),this}multiplyAtIndex(s,Z){return this.mQ[s]*=Z,this.markAsUpdated(),this}setTranslationFromFloats(s,Z,o){return this.mQ[12]=s,this.mQ[13]=Z,this.mQ[14]=o,this.markAsUpdated(),this}addTranslationFromFloats(s,Z,o){return this.mQ[12]+=s,this.mQ[13]+=Z,this.mQ[14]+=o,this.markAsUpdated(),this}setTranslation(s){return this.setTranslationFromFloats(s._x,s._y,s._z)}getTranslation(){return new b(this.mQ[12],this.mQ[13],this.mQ[14])}getTranslationToRef(s){return s.x=this.mQ[12],s.y=this.mQ[13],s.z=this.mQ[14],s}removeRotationAndScaling(){const s=this.m;return d.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,s[12],s[13],s[14],s[15],this),this._updateIdentityStatus(0===s[12]&&0===s[13]&&0===s[14]&&1===s[15]),this}O(s){s.copyToArray(this.mQ);const Z=s;return this.updateFlag=Z.updateFlag,this._updateIdentityStatus(Z._isIdentity,Z._isIdentityDirty,Z._isIdentity3x2,Z._isIdentity3x2Dirty),this}copyToArray(s){return Q(this,s,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),this}multiply(s){const Z=new d;return this.multiplyToRef(s,Z),Z}multiplyInPlace(s){const Z=this.mQ,o=s.m;for(let t=0;t<16;t++)Z[t]*=o[t];return this.markAsUpdated(),this}multiplyByFloats(){const s=this.mQ;for(let Z=0;Z<16;Z++)s[Z]*=Z<0||arguments.length<=Z?void 0:arguments[Z];return this.markAsUpdated(),this}multiplyByFloatsToRef(){for(var s=arguments.length,Z=new Array(s),o=0;o<s;o++)Z[o]=arguments[o];const t=Z.pop(),j=this.mQ,S=t.mQ,a=Z;for(let O=0;O<16;O++)S[O]=j[O]*a[O];return t.markAsUpdated(),t}multiplyToRef(s,Z){return this._isIdentity?(Z.O(s),Z):s._isIdentity?(Z.O(this),Z):(this.multiplyToArray(s,Z.mQ,0),Z.markAsUpdated(),Z)}multiplyToArray(s,Z,o){return B(this,s,Z,o),this}divide(s){return this.divideToRef(s,new d)}divideToRef(s,Z){const o=this.mQ,t=s.m,j=Z.mQ;for(let S=0;S<16;S++)j[S]=o[S]/t[S];return Z.markAsUpdated(),Z}divideInPlace(s){const Z=this.mQ,o=s.m;for(let t=0;t<16;t++)Z[t]/=o[t];return this.markAsUpdated(),this}minimizeInPlace(s){const Z=this.mQ,o=s.m;for(let t=0;t<16;t++)Z[t]=Math.min(Z[t],o[t]);return this.markAsUpdated(),this}minimizeInPlaceFromFloats(){const s=this.mQ;for(let Z=0;Z<16;Z++)s[Z]=Math.min(s[Z],Z<0||arguments.length<=Z?void 0:arguments[Z]);return this.markAsUpdated(),this}maximizeInPlace(s){const Z=this.mQ,o=s.m;for(let t=0;t<16;t++)Z[t]=Math.min(Z[t],o[t]);return this.markAsUpdated(),this}maximizeInPlaceFromFloats(){const s=this.mQ;for(let Z=0;Z<16;Z++)s[Z]=Math.min(s[Z],Z<0||arguments.length<=Z?void 0:arguments[Z]);return this.markAsUpdated(),this}negate(){return this.negateToRef(new d)}negateInPlace(){const s=this.mQ;for(let Z=0;Z<16;Z++)s[Z]=-s[Z];return this.markAsUpdated(),this}negateToRef(s){const Z=this.mQ,o=s.mQ;for(let t=0;t<16;t++)o[t]=-Z[t];return s.markAsUpdated(),s}equals(s){const Z=s;if(!Z)return!1;if((this._isIdentity||Z._isIdentity)&&!this._isIdentityDirty&&!Z._isIdentityDirty)return this._isIdentity&&Z._isIdentity;const o=this.m,t=Z.m;return o[0]===t[0]&&o[1]===t[1]&&o[2]===t[2]&&o[3]===t[3]&&o[4]===t[4]&&o[5]===t[5]&&o[6]===t[6]&&o[7]===t[7]&&o[8]===t[8]&&o[9]===t[9]&&o[10]===t[10]&&o[11]===t[11]&&o[12]===t[12]&&o[13]===t[13]&&o[14]===t[14]&&o[15]===t[15]}equalsWithEpsilon(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const o=this.mQ,t=s.m;for(let j=0;j<16;j++)if(!(0,v.WithinEpsilon)(o[j],t[j],Z))return!1;return!0}equalsToFloats(){const s=this.mQ;for(let Z=0;Z<16;Z++)if(s[Z]!=(Z<0||arguments.length<=Z?void 0:arguments[Z]))return!1;return!0}floor(){return this.floorToRef(new d)}floorToRef(s){const Z=this.mQ,o=s.mQ;for(let t=0;t<16;t++)o[t]=Math.floor(Z[t]);return s.markAsUpdated(),s}fract(){return this.fractToRef(new d)}fractToRef(s){const Z=this.mQ,o=s.mQ;for(let t=0;t<16;t++)o[t]=Z[t]-Math.floor(Z[t]);return s.markAsUpdated(),s}clone(){const s=new d;return s.O(this),s}getClassName(){return"Matrix"}getHashCode(){let s=z(this.mQ[0]);for(let Z=1;Z<16;Z++)s=397*s^z(this.mQ[Z]);return s}decomposeToTransformNode(s){return s.rotationQuaternion=s.rotationQuaternion||new A,this.decompose(s.ZO,s.rotationQuaternion,s.position)}decompose(s,Z,o,t){let j=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._isIdentity)return o&&o.tO(0),s&&s.tO(1),Z&&Z.Ja(0,0,0,1),!0;const S=this.mQ;if(o&&o.Ja(S[12],S[13],S[14]),(s=s||U.sO[0]).x=Math.sqrt(S[0]*S[0]+S[1]*S[1]+S[2]*S[2]),s.y=Math.sqrt(S[4]*S[4]+S[5]*S[5]+S[6]*S[6]),s.z=Math.sqrt(S[8]*S[8]+S[9]*S[9]+S[10]*S[10]),t){const Z=(j?t.absoluteScaling.x:t.ZO.x)<0?-1:1,o=(j?t.absoluteScaling.y:t.ZO.y)<0?-1:1,S=(j?t.absoluteScaling.z:t.ZO.z)<0?-1:1;s.x*=Z,s.y*=o,s.z*=S}else this.determinant()<=0&&(s.y*=-1);if(0===s._x||0===s._y||0===s._z)return Z&&Z.Ja(0,0,0,1),!1;if(Z){const o=1/s._x,t=1/s._y,j=1/s._z;d.FromValuesToRef(S[0]*o,S[1]*o,S[2]*o,0,S[4]*t,S[5]*t,S[6]*t,0,S[8]*j,S[9]*j,S[10]*j,0,0,0,0,1,U.Matrix[0]),A.FromRotationMatrixToRef(U.Matrix[0],Z)}return!0}getRow(s){if(s<0||s>3)return null;const Z=4*s;return new f(this.mQ[Z+0],this.mQ[Z+1],this.mQ[Z+2],this.mQ[Z+3])}getRowToRef(s,Z){if(s>=0&&s<=3){const o=4*s;Z.x=this.mQ[o+0],Z.y=this.mQ[o+1],Z.z=this.mQ[o+2],Z.w=this.mQ[o+3]}return Z}setRow(s,Z){return this.setRowFromFloats(s,Z.x,Z.y,Z.z,Z.w)}transpose(){const s=new d;return d.TransposeToRef(this,s),s}transposeToRef(s){return d.TransposeToRef(this,s),s}setRowFromFloats(s,Z,o,t,j){if(s<0||s>3)return this;const S=4*s;return this.mQ[S+0]=Z,this.mQ[S+1]=o,this.mQ[S+2]=t,this.mQ[S+3]=j,this.markAsUpdated(),this}scale(s){const Z=new d;return this.scaleToRef(s,Z),Z}scaleToRef(s,Z){for(let o=0;o<16;o++)Z.mQ[o]=this.mQ[o]*s;return Z.markAsUpdated(),Z}scaleAndAddToRef(s,Z){for(let o=0;o<16;o++)Z.mQ[o]+=this.mQ[o]*s;return Z.markAsUpdated(),Z}scaleInPlace(s){const Z=this.mQ;for(let o=0;o<16;o++)Z[o]*=s;return this.markAsUpdated(),this}toNormalMatrix(s){const Z=U.Matrix[0];this.invertToRef(Z),Z.transposeToRef(s);const o=s.mQ;return d.FromValuesToRef(o[0],o[1],o[2],0,o[4],o[5],o[6],0,o[8],o[9],o[10],0,0,0,0,1,s),s}getRotationMatrix(){const s=new d;return this.getRotationMatrixToRef(s),s}getRotationMatrixToRef(s){const Z=U.sO[0];if(!this.decompose(Z))return d.IdentityToRef(s),s;const o=this.mQ,t=1/Z._x,j=1/Z._y,S=1/Z._z;return d.FromValuesToRef(o[0]*t,o[1]*t,o[2]*t,0,o[4]*j,o[5]*j,o[6]*j,0,o[8]*S,o[9]*S,o[10]*S,0,0,0,0,1,s),s}toggleModelMatrixHandInPlace(){const s=this.mQ;return s[2]*=-1,s[6]*=-1,s[8]*=-1,s[9]*=-1,s[14]*=-1,this.markAsUpdated(),this}toggleProjectionMatrixHandInPlace(){const s=this.mQ;return s[8]*=-1,s[9]*=-1,s[10]*=-1,s[11]*=-1,this.markAsUpdated(),this}static oO(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const o=new d;return d.FromArrayToRef(s,Z,o),o}static FromArrayToRef(s,Z,o){for(let t=0;t<16;t++)o.mQ[t]=s[t+Z];return o.markAsUpdated(),o}static FromFloat32ArrayToRefScaled(s,Z,o,t){return t.mQ[0]=s[0+Z]*o,t.mQ[1]=s[1+Z]*o,t.mQ[2]=s[2+Z]*o,t.mQ[3]=s[3+Z]*o,t.mQ[4]=s[4+Z]*o,t.mQ[5]=s[5+Z]*o,t.mQ[6]=s[6+Z]*o,t.mQ[7]=s[7+Z]*o,t.mQ[8]=s[8+Z]*o,t.mQ[9]=s[9+Z]*o,t.mQ[10]=s[10+Z]*o,t.mQ[11]=s[11+Z]*o,t.mQ[12]=s[12+Z]*o,t.mQ[13]=s[13+Z]*o,t.mQ[14]=s[14+Z]*o,t.mQ[15]=s[15+Z]*o,t.markAsUpdated(),t}static get IdentityReadOnly(){return d._IdentityReadOnly}static FromValuesToRef(s,Z,o,t,j,S,a,O,v,G,B,Q,D,z,Y,b,f){const A=f.mQ;A[0]=s,A[1]=Z,A[2]=o,A[3]=t,A[4]=j,A[5]=S,A[6]=a,A[7]=O,A[8]=v,A[9]=G,A[10]=B,A[11]=Q,A[12]=D,A[13]=z,A[14]=Y,A[15]=b,f.markAsUpdated()}static FromValues(s,Z,o,t,j,S,a,O,v,G,B,Q,D,z,Y,b){const f=new d,A=f.mQ;return A[0]=s,A[1]=Z,A[2]=o,A[3]=t,A[4]=j,A[5]=S,A[6]=a,A[7]=O,A[8]=v,A[9]=G,A[10]=B,A[11]=Q,A[12]=D,A[13]=z,A[14]=Y,A[15]=b,f.markAsUpdated(),f}static Compose(s,Z,o){const t=new d;return d.ComposeToRef(s,Z,o,t),t}static ComposeToRef(s,Z,o,t){const j=t.mQ,S=Z._x,a=Z._y,O=Z._z,v=Z._w,G=S+S,B=a+a,Q=O+O,D=S*G,z=S*B,Y=S*Q,b=a*B,f=a*Q,A=O*Q,d=v*G,U=v*B,u=v*Q,H=s._x,F=s._y,i=s._z;return j[0]=(1-(b+A))*H,j[1]=(z+u)*H,j[2]=(Y-U)*H,j[3]=0,j[4]=(z-u)*F,j[5]=(1-(D+A))*F,j[6]=(f+d)*F,j[7]=0,j[8]=(Y+U)*i,j[9]=(f-d)*i,j[10]=(1-(D+b))*i,j[11]=0,j[12]=o._x,j[13]=o._y,j[14]=o._z,j[15]=1,t.markAsUpdated(),t}static Identity(){const s=d.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return s._updateIdentityStatus(!0),s}static IdentityToRef(s){return d.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,s),s._updateIdentityStatus(!0),s}static Zero(){const s=d.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return s._updateIdentityStatus(!1),s}static RotationX(s){const Z=new d;return d.RotationXToRef(s,Z),Z}static Invert(s){const Z=new d;return s.invertToRef(Z),Z}static RotationXToRef(s,Z){const o=Math.sin(s),t=Math.cos(s);return d.FromValuesToRef(1,0,0,0,0,t,o,0,0,-o,t,0,0,0,0,1,Z),Z._updateIdentityStatus(1===t&&0===o),Z}static RotationY(s){const Z=new d;return d.RotationYToRef(s,Z),Z}static RotationYToRef(s,Z){const o=Math.sin(s),t=Math.cos(s);return d.FromValuesToRef(t,0,-o,0,0,1,0,0,o,0,t,0,0,0,0,1,Z),Z._updateIdentityStatus(1===t&&0===o),Z}static RotationZ(s){const Z=new d;return d.RotationZToRef(s,Z),Z}static RotationZToRef(s,Z){const o=Math.sin(s),t=Math.cos(s);return d.FromValuesToRef(t,o,0,0,-o,t,0,0,0,0,1,0,0,0,0,1,Z),Z._updateIdentityStatus(1===t&&0===o),Z}static RotationAxis(s,Z){const o=new d;return d.RotationAxisToRef(s,Z,o),o}static RotationAxisToRef(s,Z,o){const t=Math.sin(-Z),j=Math.cos(-Z),S=1-j;s=s.normalizeToRef(U.sO[0]);const a=o.mQ;return a[0]=s._x*s._x*S+j,a[1]=s._x*s._y*S-s._z*t,a[2]=s._x*s._z*S+s._y*t,a[3]=0,a[4]=s._y*s._x*S+s._z*t,a[5]=s._y*s._y*S+j,a[6]=s._y*s._z*S-s._x*t,a[7]=0,a[8]=s._z*s._x*S-s._y*t,a[9]=s._z*s._y*S+s._x*t,a[10]=s._z*s._z*S+j,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,o.markAsUpdated(),o}static RotationAlignToRef(s,Z,o){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const S=b.Dot(Z,s),a=o.mQ;if(S<-1+t.b)a[0]=-1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=j?1:-1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=j?-1:1,a[11]=0;else{const o=b.Cross(Z,s),t=1/(1+S);a[0]=o._x*o._x*t+S,a[1]=o._y*o._x*t-o._z,a[2]=o._z*o._x*t+o._y,a[3]=0,a[4]=o._x*o._y*t+o._z,a[5]=o._y*o._y*t+S,a[6]=o._z*o._y*t-o._x,a[7]=0,a[8]=o._x*o._z*t-o._y,a[9]=o._y*o._z*t+o._x,a[10]=o._z*o._z*t+S,a[11]=0}return a[12]=0,a[13]=0,a[14]=0,a[15]=1,o.markAsUpdated(),o}static RotationYawPitchRoll(s,Z,o){const t=new d;return d.RotationYawPitchRollToRef(s,Z,o,t),t}static RotationYawPitchRollToRef(s,Z,o,t){return A.RotationYawPitchRollToRef(s,Z,o,U.Quaternion[0]),U.Quaternion[0].toRotationMatrix(t),t}static Scaling(s,Z,o){const t=new d;return d.ScalingToRef(s,Z,o,t),t}static ScalingToRef(s,Z,o,t){return d.FromValuesToRef(s,0,0,0,0,Z,0,0,0,0,o,0,0,0,0,1,t),t._updateIdentityStatus(1===s&&1===Z&&1===o),t}static Translation(s,Z,o){const t=new d;return d.TranslationToRef(s,Z,o,t),t}static TranslationToRef(s,Z,o,t){return d.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,s,Z,o,1,t),t._updateIdentityStatus(0===s&&0===Z&&0===o),t}static Lerp(s,Z,o){const t=new d;return d.LerpToRef(s,Z,o,t),t}static LerpToRef(s,Z,o,t){const j=t.mQ,S=s.m,a=Z.m;for(let O=0;O<16;O++)j[O]=S[O]*(1-o)+a[O]*o;return t.markAsUpdated(),t}static DecomposeLerp(s,Z,o){const t=new d;return d.DecomposeLerpToRef(s,Z,o,t),t}static DecomposeLerpToRef(s,Z,o,t){const j=U.sO[0],S=U.Quaternion[0],a=U.sO[1];s.decompose(j,S,a);const O=U.sO[2],v=U.Quaternion[1],G=U.sO[3];Z.decompose(O,v,G);const B=U.sO[4];b.LerpToRef(j,O,o,B);const Q=U.Quaternion[2];A.SlerpToRef(S,v,o,Q);const D=U.sO[5];return b.LerpToRef(a,G,o,D),d.ComposeToRef(B,Q,D,t),t}static LookAtLH(s,Z,o){const t=new d;return d.LookAtLHToRef(s,Z,o,t),t}static LookAtLHToRef(s,Z,o,t){const j=U.sO[0],S=U.sO[1],a=U.sO[2];Z.subtractToRef(s,a),a.normalize(),b.CrossToRef(o,a,j);const O=j.lengthSquared();0===O?j.x=1:j.normalizeFromLength(Math.sqrt(O)),b.CrossToRef(a,j,S),S.normalize();const v=-b.Dot(j,s),G=-b.Dot(S,s),B=-b.Dot(a,s);return d.FromValuesToRef(j._x,S._x,a._x,0,j._y,S._y,a._y,0,j._z,S._z,a._z,0,v,G,B,1,t),t}static LookAtRH(s,Z,o){const t=new d;return d.LookAtRHToRef(s,Z,o,t),t}static LookAtRHToRef(s,Z,o,t){const j=U.sO[0],S=U.sO[1],a=U.sO[2];s.subtractToRef(Z,a),a.normalize(),b.CrossToRef(o,a,j);const O=j.lengthSquared();0===O?j.x=1:j.normalizeFromLength(Math.sqrt(O)),b.CrossToRef(a,j,S),S.normalize();const v=-b.Dot(j,s),G=-b.Dot(S,s),B=-b.Dot(a,s);return d.FromValuesToRef(j._x,S._x,a._x,0,j._y,S._y,a._y,0,j._z,S._z,a._z,0,v,G,B,1,t),t}static LookDirectionLH(s,Z){const o=new d;return d.LookDirectionLHToRef(s,Z,o),o}static LookDirectionLHToRef(s,Z,o){const t=U.sO[0];t.O(s),t.scaleInPlace(-1);const j=U.sO[1];return b.CrossToRef(Z,t,j),d.FromValuesToRef(j._x,j._y,j._z,0,Z._x,Z._y,Z._z,0,t._x,t._y,t._z,0,0,0,0,1,o),o}static LookDirectionRH(s,Z){const o=new d;return d.LookDirectionRHToRef(s,Z,o),o}static LookDirectionRHToRef(s,Z,o){const t=U.sO[2];return b.CrossToRef(Z,s,t),d.FromValuesToRef(t._x,t._y,t._z,0,Z._x,Z._y,Z._z,0,s._x,s._y,s._z,0,0,0,0,1,o),o}static OrthoLH(s,Z,o,t,j){const S=new d;return d.OrthoLHToRef(s,Z,o,t,S,j),S}static OrthoLHToRef(s,Z,o,t,j,S){const a=2/s,O=2/Z,v=2/(t-o),G=-(t+o)/(t-o);return d.FromValuesToRef(a,0,0,0,0,O,0,0,0,0,v,0,0,0,G,1,j),S&&j.multiplyToRef(H,j),j._updateIdentityStatus(1===a&&1===O&&1===v&&0===G),j}static OrthoOffCenterLH(s,Z,o,t,j,S,a){const O=new d;return d.OrthoOffCenterLHToRef(s,Z,o,t,j,S,O,a),O}static OrthoOffCenterLHToRef(s,Z,o,t,j,S,a,O){const v=2/(Z-s),G=2/(t-o),B=2/(S-j),Q=-(S+j)/(S-j),D=(s+Z)/(s-Z),z=(t+o)/(o-t);return d.FromValuesToRef(v,0,0,0,0,G,0,0,0,0,B,0,D,z,Q,1,a),O&&a.multiplyToRef(H,a),a.markAsUpdated(),a}static ObliqueOffCenterLHToRef(s,Z,o,t,j,S,a,O,v,G,B){const Q=-a*Math.cos(O),D=-a*Math.sin(O);return d.TranslationToRef(0,0,-v,U.Matrix[1]),d.FromValuesToRef(1,0,0,0,0,1,0,0,Q,D,1,0,0,0,0,1,U.Matrix[0]),U.Matrix[1].multiplyToRef(U.Matrix[0],U.Matrix[0]),d.TranslationToRef(0,0,v,U.Matrix[1]),U.Matrix[0].multiplyToRef(U.Matrix[1],U.Matrix[0]),d.OrthoOffCenterLHToRef(s,Z,o,t,j,S,G,B),U.Matrix[0].multiplyToRef(G,G),G}static OrthoOffCenterRH(s,Z,o,t,j,S,a){const O=new d;return d.OrthoOffCenterRHToRef(s,Z,o,t,j,S,O,a),O}static OrthoOffCenterRHToRef(s,Z,o,t,j,S,a,O){return d.OrthoOffCenterLHToRef(s,Z,o,t,j,S,a,O),a.mQ[10]*=-1,a}static ObliqueOffCenterRHToRef(s,Z,o,t,j,S,a,O,v,G,B){const Q=a*Math.cos(O),D=a*Math.sin(O);return d.TranslationToRef(0,0,v,U.Matrix[1]),d.FromValuesToRef(1,0,0,0,0,1,0,0,Q,D,1,0,0,0,0,1,U.Matrix[0]),U.Matrix[1].multiplyToRef(U.Matrix[0],U.Matrix[0]),d.TranslationToRef(0,0,-v,U.Matrix[1]),U.Matrix[0].multiplyToRef(U.Matrix[1],U.Matrix[0]),d.OrthoOffCenterRHToRef(s,Z,o,t,j,S,G,B),U.Matrix[0].multiplyToRef(G,G),G}static PerspectiveLH(s,Z,o,t,j){let S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const a=new d,O=2*o/s,v=2*o/Z,G=(t+o)/(t-o),B=-2*t*o/(t-o),Q=Math.tan(S);return d.FromValuesToRef(O,0,0,0,0,v,0,Q,0,0,G,1,0,0,B,0,a),j&&a.multiplyToRef(H,a),a._updateIdentityStatus(!1),a}static PerspectiveFovLH(s,Z,o,t,j){let S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const O=new d;return d.PerspectiveFovLHToRef(s,Z,o,t,O,!0,j,S,a),O}static PerspectiveFovLHToRef(s,Z,o,t,j){let S=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=arguments.length>6?arguments[6]:void 0,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,v=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const G=o,B=t,Q=1/Math.tan(.5*s),D=S?Q/Z:Q,z=S?Q:Q*Z,Y=v&&0===G?-1:0!==B?(B+G)/(B-G):1,b=v&&0===G?2*B:0!==B?-2*B*G/(B-G):-2*G,f=Math.tan(O);return d.FromValuesToRef(D,0,0,0,0,z,0,f,0,0,Y,1,0,0,b,0,j),a&&j.multiplyToRef(H,j),j._updateIdentityStatus(!1),j}static PerspectiveFovReverseLHToRef(s,Z,o,t,j){let S=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=arguments.length>6?arguments[6]:void 0,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const v=1/Math.tan(.5*s),G=S?v/Z:v,B=S?v:v*Z,Q=Math.tan(O);return d.FromValuesToRef(G,0,0,0,0,B,0,Q,0,0,-o,1,0,0,1,0,j),a&&j.multiplyToRef(H,j),j._updateIdentityStatus(!1),j}static PerspectiveFovRH(s,Z,o,t,j){let S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const O=new d;return d.PerspectiveFovRHToRef(s,Z,o,t,O,!0,j,S,a),O}static PerspectiveFovRHToRef(s,Z,o,t,j){let S=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=arguments.length>6?arguments[6]:void 0,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,v=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const G=o,B=t,Q=1/Math.tan(.5*s),D=S?Q/Z:Q,z=S?Q:Q*Z,Y=v&&0===G?1:0!==B?-(B+G)/(B-G):-1,b=v&&0===G?2*B:0!==B?-2*B*G/(B-G):-2*G,f=Math.tan(O);return d.FromValuesToRef(D,0,0,0,0,z,0,f,0,0,Y,-1,0,0,b,0,j),a&&j.multiplyToRef(H,j),j._updateIdentityStatus(!1),j}static PerspectiveFovReverseRHToRef(s,Z,o,t,j){let S=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=arguments.length>6?arguments[6]:void 0,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const v=1/Math.tan(.5*s),G=S?v/Z:v,B=S?v:v*Z,Q=Math.tan(O);return d.FromValuesToRef(G,0,0,0,0,B,0,Q,0,0,-o,-1,0,0,-1,0,j),a&&j.multiplyToRef(H,j),j._updateIdentityStatus(!1),j}static GetFinalMatrix(s,Z,o,t,j,S){const a=s.width,O=s.height,v=s.x,G=s.y,B=d.FromValues(a/2,0,0,0,0,-O/2,0,0,0,0,S-j,0,v+a/2,O/2+G,j,1),Q=new d;return Z.multiplyToRef(o,Q),Q.multiplyToRef(t,Q),Q.multiplyToRef(B,Q)}static GetAsMatrix2x2(s){const Z=s.m,o=[Z[0],Z[1],Z[4],Z[5]];return a.e.MatrixUse64Bits?o:new Float32Array(o)}static GetAsMatrix3x3(s){const Z=s.m,o=[Z[0],Z[1],Z[2],Z[4],Z[5],Z[6],Z[8],Z[9],Z[10]];return a.e.MatrixUse64Bits?o:new Float32Array(o)}static Transpose(s){const Z=new d;return d.TransposeToRef(s,Z),Z}static TransposeToRef(s,Z){const o=s.m,t=o[0],j=o[4],S=o[8],a=o[12],O=o[1],v=o[5],G=o[9],B=o[13],Q=o[2],D=o[6],z=o[10],Y=o[14],b=o[3],f=o[7],A=o[11],d=o[15],U=Z.mQ;return U[0]=t,U[1]=j,U[2]=S,U[3]=a,U[4]=O,U[5]=v,U[6]=G,U[7]=B,U[8]=Q,U[9]=D,U[10]=z,U[11]=Y,U[12]=b,U[13]=f,U[14]=A,U[15]=d,Z.markAsUpdated(),Z._updateIdentityStatus(s._isIdentity,s._isIdentityDirty),Z}static Reflection(s){const Z=new d;return d.ReflectionToRef(s,Z),Z}static ReflectionToRef(s,Z){s.normalize();const o=s.gt.x,t=s.gt.y,j=s.gt.z,S=-2*o,a=-2*t,O=-2*j;return d.FromValuesToRef(S*o+1,a*o,O*o,0,S*t,a*t+1,O*t,0,S*j,a*j,O*j+1,0,S*s.d,a*s.d,O*s.d,1,Z),Z}static FromXYZAxesToRef(s,Z,o,t){return d.FromValuesToRef(s._x,s._y,s._z,0,Z._x,Z._y,Z._z,0,o._x,o._y,o._z,0,0,0,0,1,t),t}static FromQuaternionToRef(s,Z){const o=s._x*s._x,t=s._y*s._y,j=s._z*s._z,S=s._x*s._y,a=s._z*s._w,O=s._z*s._x,v=s._y*s._w,G=s._y*s._z,B=s._x*s._w;return Z.mQ[0]=1-2*(t+j),Z.mQ[1]=2*(S+a),Z.mQ[2]=2*(O-v),Z.mQ[3]=0,Z.mQ[4]=2*(S-a),Z.mQ[5]=1-2*(j+o),Z.mQ[6]=2*(G+B),Z.mQ[7]=0,Z.mQ[8]=2*(O+v),Z.mQ[9]=2*(G-B),Z.mQ[10]=1-2*(t+o),Z.mQ[11]=0,Z.mQ[12]=0,Z.mQ[13]=0,Z.mQ[14]=0,Z.mQ[15]=1,Z.markAsUpdated(),Z}}d._IdentityReadOnly=d.Identity(),Object.defineProperties(d.prototype,{dimension:{value:[4,4]},rank:{value:2}});class U{}U.sO=(0,j.i)(11,b.Zero),U.Matrix=(0,j.i)(2,d.Identity),U.Quaternion=(0,j.i)(3,A.Zero);class u{}u.Vector2=(0,j.i)(3,Y.Zero),u.sO=(0,j.i)(13,b.Zero),u.Vector4=(0,j.i)(3,f.Zero),u.Quaternion=(0,j.i)(3,A.Zero),u.Matrix=(0,j.i)(8,d.Identity),(0,S.f)("BABYLON.Vector2",Y),(0,S.f)("BABYLON.Vector3",b),(0,S.f)("BABYLON.Vector4",f),(0,S.f)("BABYLON.Matrix",d);const H=d.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)},11262:(s,Z,o)=>{o.d(Z,{b:()=>t});class t{constructor(s,Z,o,t){this.x=s,this.y=Z,this.width=o,this.height=t}toGlobal(s,Z){return new t(this.x*s,this.y*Z,this.width*s,this.height*Z)}toGlobalToRef(s,Z,o){return o.x=this.x*s,o.y=this.y*Z,o.width=this.width*s,o.height=this.height*Z,this}clone(){return new t(this.x,this.y,this.width,this.height)}}},11367:(s,Z,o)=>{o.d(Z,{e:()=>G,h:()=>B});var t=o(10900),j=o(11376);const S=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],a=[()=>1,s=>s.y,s=>s.z,s=>s.x,s=>s.x*s.y,s=>s.y*s.z,s=>3*s.z*s.z-1,s=>s.x*s.z,s=>s.x*s.x-s.y*s.y],O=(s,Z)=>S[s]*a[s](Z),v=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class G{constructor(){this.preScaled=!1,this.l00=t.n.Zero(),this.l1_1=t.n.Zero(),this.l10=t.n.Zero(),this.l11=t.n.Zero(),this.l2_2=t.n.Zero(),this.l2_1=t.n.Zero(),this.l20=t.n.Zero(),this.l21=t.n.Zero(),this.l22=t.n.Zero()}addLight(s,Z,o){j.h.sO[0].set(Z.r,Z.g,Z.b);const t=j.h.sO[0],S=j.h.sO[1];t.scaleToRef(o,S),S.scaleToRef(O(0,s),j.h.sO[2]),this.l00.addInPlace(j.h.sO[2]),S.scaleToRef(O(1,s),j.h.sO[2]),this.l1_1.addInPlace(j.h.sO[2]),S.scaleToRef(O(2,s),j.h.sO[2]),this.l10.addInPlace(j.h.sO[2]),S.scaleToRef(O(3,s),j.h.sO[2]),this.l11.addInPlace(j.h.sO[2]),S.scaleToRef(O(4,s),j.h.sO[2]),this.l2_2.addInPlace(j.h.sO[2]),S.scaleToRef(O(5,s),j.h.sO[2]),this.l2_1.addInPlace(j.h.sO[2]),S.scaleToRef(O(6,s),j.h.sO[2]),this.l20.addInPlace(j.h.sO[2]),S.scaleToRef(O(7,s),j.h.sO[2]),this.l21.addInPlace(j.h.sO[2]),S.scaleToRef(O(8,s),j.h.sO[2]),this.l22.addInPlace(j.h.sO[2])}scaleInPlace(s){this.l00.scaleInPlace(s),this.l1_1.scaleInPlace(s),this.l10.scaleInPlace(s),this.l11.scaleInPlace(s),this.l2_2.scaleInPlace(s),this.l2_1.scaleInPlace(s),this.l20.scaleInPlace(s),this.l21.scaleInPlace(s),this.l22.scaleInPlace(s)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(v[0]),this.l1_1.scaleInPlace(v[1]),this.l10.scaleInPlace(v[2]),this.l11.scaleInPlace(v[3]),this.l2_2.scaleInPlace(v[4]),this.l2_1.scaleInPlace(v[5]),this.l20.scaleInPlace(v[6]),this.l21.scaleInPlace(v[7]),this.l22.scaleInPlace(v[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(S[0]),this.l1_1.scaleInPlace(S[1]),this.l10.scaleInPlace(S[2]),this.l11.scaleInPlace(S[3]),this.l2_2.scaleInPlace(S[4]),this.l2_1.scaleInPlace(S[5]),this.l20.scaleInPlace(S[6]),this.l21.scaleInPlace(S[7]),this.l22.scaleInPlace(S[8])}updateFromArray(s){return t.n.FromArrayToRef(s[0],0,this.l00),t.n.FromArrayToRef(s[1],0,this.l1_1),t.n.FromArrayToRef(s[2],0,this.l10),t.n.FromArrayToRef(s[3],0,this.l11),t.n.FromArrayToRef(s[4],0,this.l2_2),t.n.FromArrayToRef(s[5],0,this.l2_1),t.n.FromArrayToRef(s[6],0,this.l20),t.n.FromArrayToRef(s[7],0,this.l21),t.n.FromArrayToRef(s[8],0,this.l22),this}updateFromFloatsArray(s){return t.n.FromFloatsToRef(s[0],s[1],s[2],this.l00),t.n.FromFloatsToRef(s[3],s[4],s[5],this.l1_1),t.n.FromFloatsToRef(s[6],s[7],s[8],this.l10),t.n.FromFloatsToRef(s[9],s[10],s[11],this.l11),t.n.FromFloatsToRef(s[12],s[13],s[14],this.l2_2),t.n.FromFloatsToRef(s[15],s[16],s[17],this.l2_1),t.n.FromFloatsToRef(s[18],s[19],s[20],this.l20),t.n.FromFloatsToRef(s[21],s[22],s[23],this.l21),t.n.FromFloatsToRef(s[24],s[25],s[26],this.l22),this}static oO(s){return(new G).updateFromArray(s)}static FromPolynomial(s){const Z=new G;return Z.l00=s.xx.scale(.376127).add(s.yy.scale(.376127)).add(s.zz.scale(.376126)),Z.l1_1=s.y.scale(.977204),Z.l10=s.z.scale(.977204),Z.l11=s.x.scale(.977204),Z.l2_2=s.xy.scale(1.16538),Z.l2_1=s.yz.scale(1.16538),Z.l20=s.zz.scale(1.34567).Go(s.xx.scale(.672834)).Go(s.yy.scale(.672834)),Z.l21=s.zx.scale(1.16538),Z.l22=s.xx.scale(1.16538).Go(s.yy.scale(1.16538)),Z.l1_1.scaleInPlace(-1),Z.l11.scaleInPlace(-1),Z.l2_1.scaleInPlace(-1),Z.l21.scaleInPlace(-1),Z.scaleInPlace(Math.PI),Z}}class B{constructor(){this.x=t.n.Zero(),this.y=t.n.Zero(),this.z=t.n.Zero(),this.xx=t.n.Zero(),this.yy=t.n.Zero(),this.zz=t.n.Zero(),this.xy=t.n.Zero(),this.yz=t.n.Zero(),this.zx=t.n.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=G.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(s){j.h.sO[0].Ja(s.r,s.g,s.b);const Z=j.h.sO[0];this.xx.addInPlace(Z),this.yy.addInPlace(Z),this.zz.addInPlace(Z)}scaleInPlace(s){this.x.scaleInPlace(s),this.y.scaleInPlace(s),this.z.scaleInPlace(s),this.xx.scaleInPlace(s),this.yy.scaleInPlace(s),this.zz.scaleInPlace(s),this.yz.scaleInPlace(s),this.zx.scaleInPlace(s),this.xy.scaleInPlace(s)}updateFromHarmonics(s){return this._harmonics=s,this.x.O(s.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.O(s.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.O(s.l10),this.z.scaleInPlace(1.02333),this.xx.O(s.l00),j.h.sO[0].O(s.l20).scaleInPlace(.247708),j.h.sO[1].O(s.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).RB(j.h.sO[0]).addInPlace(j.h.sO[1]),this.yy.O(s.l00),this.yy.scaleInPlace(.886277).RB(j.h.sO[0]).RB(j.h.sO[1]),this.zz.O(s.l00),j.h.sO[0].O(s.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(j.h.sO[0]),this.yz.O(s.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.O(s.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.O(s.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(s){return(new B).updateFromHarmonics(s)}static oO(s){const Z=new B;return t.n.FromArrayToRef(s[0],0,Z.x),t.n.FromArrayToRef(s[1],0,Z.y),t.n.FromArrayToRef(s[2],0,Z.z),t.n.FromArrayToRef(s[3],0,Z.xx),t.n.FromArrayToRef(s[4],0,Z.yy),t.n.FromArrayToRef(s[5],0,Z.zz),t.n.FromArrayToRef(s[6],0,Z.yz),t.n.FromArrayToRef(s[7],0,Z.zx),t.n.FromArrayToRef(s[8],0,Z.xy),Z}}},11653:(s,Z,o)=>{o.d(Z,{d:()=>A,f:()=>d});var t=o(10900),j=o(11174),S=o(11240),a=o(11214),O=o(10955),v=o(11113),G=o(11383),B=o(10904),Q=o(10927);class D extends t.j{constructor(s,Z){super(s.x,s.y),this.index=Z}}class z{constructor(){this.elements=[]}add(s){const Z=[];for(const o of s){const s=new D(o,this.elements.length);Z.push(s),this.elements.push(s)}return Z}computeBounds(){const s=new t.j(this.elements[0].x,this.elements[0].y),Z=new t.j(this.elements[0].x,this.elements[0].y);for(const o of this.elements)o.x<s.x?s.x=o.x:o.x>Z.x&&(Z.x=o.x),o.y<s.y?s.y=o.y:o.y>Z.y&&(Z.y=o.y);return{min:s,max:Z,width:Z.x-s.x,height:Z.y-s.y}}}class Y{_addToepoint(s){for(const Z of s)this._epoints.push(Z.x,Z.y)}constructor(s,Z,o){let t,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new z,this._outlinepoints=new z,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=j,this._name=s,this._scene=o||Q.c.LastCreatedScene,t=Z instanceof G.i?Z.getPoints():Z,this._addToepoint(t),this._points.add(t),this._outlinepoints.add(t),"undefined"===typeof this.bjsEarcut&&O.b.Warn("Earcut was not found, the polygon will not be built.")}addHole(s){this._points.add(s);const Z=new z;return Z.add(s),this._holes.push(Z),this._eholes.push(this._epoints.length/2),this._addToepoint(s),this}build(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const t=new S.d(this._name,this._scene),j=this.buildVertexData(Z,o);return t.hs(v.e.PositionKind,j.gs,s),t.hs(v.e.NormalKind,j.ls,s),t.hs(v.e.UVKind,j.es,s),t.setIndices(j.indices),t}buildVertexData(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const o=new a.d,t=[],j=[],S=[],O=this._points.computeBounds();for(const a of this._points.elements)t.push(0,1,0),j.push(a.x,0,a.y),S.push((a.x-O.min.x)/O.width,(a.y-O.min.y)/O.height);const v=[],G=this.bjsEarcut(this._epoints,this._eholes,2);for(let a=0;a<G.length;a++)v.push(G[a]);if(s>0){const o=j.length/3;for(const Z of this._points.elements)t.push(0,-1,0),j.push(Z.x,-s,Z.y),S.push(1-(Z.x-O.min.x)/O.width,1-(Z.y-O.min.y)/O.height);const a=v.length;for(let s=0;s<a;s+=3){const Z=v[s+0],t=v[s+1],j=v[s+2];v.push(j+o),v.push(t+o),v.push(Z+o)}this._addSide(j,t,S,v,O,this._outlinepoints,s,!1,Z);for(const G of this._holes)this._addSide(j,t,S,v,O,G,s,!0,Z)}return o.indices=v,o.gs=j,o.ls=t,o.es=S,o}_addSide(s,Z,o,j,S,a,O,v,G){let Q=s.length/3,D=0;for(let z=0;z<a.elements.length;z++){const Y=a.elements[z],b=a.elements[(z+1)%a.elements.length];s.push(Y.x,0,Y.y),s.push(Y.x,-O,Y.y),s.push(b.x,0,b.y),s.push(b.x,-O,b.y);const f=a.elements[(z+a.elements.length-1)%a.elements.length],A=a.elements[(z+2)%a.elements.length];let d=new t.n(-(b.y-Y.y),0,b.x-Y.x),U=new t.n(-(Y.y-f.y),0,Y.x-f.x),u=new t.n(-(A.y-b.y),0,A.x-b.x);v||(d=d.scale(-1),U=U.scale(-1),u=u.scale(-1));const H=d.normalizeToNew();let F=U.normalizeToNew(),i=u.normalizeToNew();const N=t.n.Dot(F,H);F=N>G?N<B.b-1?new t.n(Y.x,0,Y.y).Go(new t.n(b.x,0,b.y)).normalize():U.add(d).normalize():H;const L=t.n.Dot(u,d);i=L>G?L<B.b-1?new t.n(b.x,0,b.y).Go(new t.n(Y.x,0,Y.y)).normalize():u.add(d).normalize():H,o.push(D/S.width,0),o.push(D/S.width,1),D+=d.length(),o.push(D/S.width,0),o.push(D/S.width,1),Z.push(F.x,F.y,F.z),Z.push(F.x,F.y,F.z),Z.push(i.x,i.y,i.z),Z.push(i.x,i.y,i.z),v?(j.push(Q),j.push(Q+2),j.push(Q+1),j.push(Q+1),j.push(Q+2),j.push(Q+3)):(j.push(Q),j.push(Q+1),j.push(Q+2),j.push(Q+1),j.push(Q+3),j.push(Q+2)),Q+=4}}}var b=o(11291);function f(s,Z,o,S,O,G,B){const Q=o||new Array(3),D=S,z=[],Y=B||!1;for(let a=0;a<3;a++)void 0===Q[a]&&(Q[a]=new t.p(0,0,1,1)),D&&void 0===D[a]&&(D[a]=new j.h(1,1,1,1));const f=s.getVerticesData(v.e.PositionKind),A=s.getVerticesData(v.e.NormalKind),d=s.getVerticesData(v.e.UVKind),U=s.ra(),u=f.length/9;let H=0,F=0,i=0,N=0,L=0;const V=[0];if(Y)for(let t=u;t<f.length/3;t+=4)F=f[3*(t+2)]-f[3*t],i=f[3*(t+2)+2]-f[3*t+2],N=Math.sqrt(F*F+i*i),L+=N,V.push(L);let g=0,l=0;for(let t=0;t<A.length;t+=3)Math.abs(A[t+1])<.001&&(l=1),Math.abs(A[t+1]-1)<.001&&(l=0),Math.abs(A[t+1]+1)<.001&&(l=2),g=t/3,1===l?(H=g-u,d[2*g]=H%4<1.5?Y?Q[l].x+(Q[l].z-Q[l].x)*V[Math.floor(H/4)]/L:Q[l].x:Y?Q[l].x+(Q[l].z-Q[l].x)*V[Math.floor(H/4)+1]/L:Q[l].z,d[2*g+1]=H%2===0?b.b?1-Q[l].w:Q[l].w:b.b?1-Q[l].y:Q[l].y):(d[2*g]=(1-d[2*g])*Q[l].x+d[2*g]*Q[l].z,d[2*g+1]=(1-d[2*g+1])*Q[l].y+d[2*g+1]*Q[l].w,b.b&&(d[2*g+1]=1-d[2*g+1])),D&&z.push(D[l].r,D[l].g,D[l].b,D[l].a);a.d._ComputeSides(Z,f,U,A,d,O,G);const R=new a.d;if(R.indices=U,R.gs=f,R.ls=A,R.es=d,D){const s=Z===a.d.DOUBLESIDE?z.concat(z):z;R.Rs=s}return R}function A(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;Z.sideOrientation=S.d._GetDefaultSideOrientation(Z.sideOrientation);const a=Z.shape,O=Z.holes||[],v=Z.depth||0,G=Z.smoothingThreshold||2,B=[];let D=[];for(let S=0;S<a.length;S++)B[S]=new t.j(a[S].x,a[S].z);B[0].equalsWithEpsilon(B[B.length-1],1e-8)&&B.pop();const z=new Y(s,B,o||Q.c.LastCreatedScene,j);for(let S=0;S<O.length;S++){D=[];for(let s=0;s<O[S].length;s++)D.push(new t.j(O[S][s].x,O[S][s].z));z.addHole(D)}const b=z.build(!1,v,G);b._originalBuilderSideOrientation=Z.sideOrientation;return f(b,Z.sideOrientation,Z.faceUV,Z.faceColors,Z.frontUVs,Z.backUVs,Z.wrap).ws(b,Z.updatable),b}function d(s,Z){return A(s,Z,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}a.d.CreatePolygon=f,S.d.CreatePolygon=function(s,Z,o,t,j,S){return A(s,{shape:Z,holes:t,updatable:j,sideOrientation:S},o,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},S.d.ExtrudePolygon=function(s,Z,o,t,j,S,a){return d(s,{shape:Z,holes:j,depth:o,updatable:S,sideOrientation:a},t,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)}},11649:(s,Z,o)=>{o.d(Z,{c:()=>B,e:()=>Q});var t=o(11383),j=o(10900),S=o(11240),a=o(11197),O=o(11653);class v{constructor(s){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=s}moveTo(s,Z){this._currentPath=new t.i(s,Z),this._tempPaths.push(this._currentPath)}lineTo(s,Z){this._currentPath.addLineTo(s,Z)}quadraticCurveTo(s,Z,o,t){this._currentPath.addQuadraticCurveTo(s,Z,o,t,this._resolution)}bezierCurveTo(s,Z,o,t,j,S){this._currentPath.addBezierCurveTo(s,Z,o,t,j,S,this._resolution)}extractHoles(){for(const s of this._tempPaths)s.area()>0?this._holes.push(s):this._paths.push(s);if(!this._paths.length&&this._holes.length){const s=this._holes;this._holes=this._paths,this._paths=s}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function G(s,Z,o,t,j,S){const a=S.glyphs[s]||S.glyphs["?"];if(!a)return null;const O=new v(j);if(a.o){const s=a.o.split(" ");for(let j=0,S=s.length;j<S;){switch(s[j++]){case"m":{const S=parseInt(s[j++])*Z+o,a=parseInt(s[j++])*Z+t;O.moveTo(S,a);break}case"l":{const S=parseInt(s[j++])*Z+o,a=parseInt(s[j++])*Z+t;O.lineTo(S,a);break}case"q":{const S=parseInt(s[j++])*Z+o,a=parseInt(s[j++])*Z+t,v=parseInt(s[j++])*Z+o,G=parseInt(s[j++])*Z+t;O.quadraticCurveTo(v,G,S,a);break}case"b":{const S=parseInt(s[j++])*Z+o,a=parseInt(s[j++])*Z+t,v=parseInt(s[j++])*Z+o,G=parseInt(s[j++])*Z+t,B=parseInt(s[j++])*Z+o,Q=parseInt(s[j++])*Z+t;O.bezierCurveTo(v,G,B,Q,S,a);break}}}}return O.extractHoles(),{offsetX:a.ha*Z,shapePath:O}}function B(s,Z,o,t){const j=Array.from(s),S=Z/t.resolution,a=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*S,O=[];let v=0,B=0;for(let Q=0;Q<j.length;Q++){const s=j[Q];if("\n"===s)v=0,B-=a;else{const Z=G(s,S,v,B,o,t);Z&&(v+=Z.offsetX,O.push(Z.shapePath))}}return O}function Q(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const Q=B(Z,t.size||50,t.resolution||8,o),D=[];let z=0;for(const a of Q){if(!a.paths.length)continue;const Z=a.holes.slice();for(const o of a.paths){var Y,b;const a=[],B=[],Q=o.getPoints();for(const s of Q)B.push(new j.n(s.x,0,s.y));const f=Z.slice();for(const s of f){const t=s.getPoints();let S=!1;for(const s of t)if(o.isPointInside(s)){S=!0;break}if(!S)continue;const O=[];for(const s of t)O.push(new j.n(s.x,0,s.y));a.push(O),Z.splice(Z.indexOf(s),1)}if(!a.length&&Z.length)for(const s of Z){const Z=s.getPoints(),o=[];for(const s of Z)o.push(new j.n(s.x,0,s.y));a.push(o)}const A=(0,O.f)(s,{shape:B,holes:a.length?a:void 0,depth:t.depth||1,faceUV:t.faceUV||(null===(Y=t.perLetterFaceUV)||void 0===Y?void 0:Y.call(t,z)),faceColors:t.faceColors||(null===(b=t.perLetterFaceColors)||void 0===b?void 0:b.call(t,z)),sideOrientation:S.d._GetDefaultSideOrientation(t.sideOrientation||S.d.DOUBLESIDE)},v,G);D.push(A),z++}}const f=S.d.MergeMeshes(D,!0,!0);if(f){const Z=f.getBoundingInfo().boundingBox;f.position.x+=-(Z.minimumWorld.x+Z.maximumWorld.x)/2,f.position.y+=-(Z.minimumWorld.y+Z.maximumWorld.y)/2,f.position.z+=-(Z.minimumWorld.z+Z.maximumWorld.z)/2+Z.extendSize.z,f.name=s;const o=new a.c("pivot",v);o.rotation.x=-Math.PI/2,f.parent=o,f.bakeCurrentTransformIntoVertices(),f.parent=null,o.dispose()}return f}},11661:(s,Z,o)=>{o.d(Z,{e:()=>v,g:()=>a,i:()=>O});var t=o(10938),j=o(11665),S=o(11669);function a(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}function O(s){return!!(s.wasmUrl&&(s.wasmBinary||s.wasmBinaryUrl)&&"object"===typeof WebAssembly||s.fallbackUrl)}class v{constructor(s){if(s.workerPool)return void(this._workerPoolPromise=Promise.resolve(s.workerPool));const Z=s.wasmBinary,o=s.numWorkers??a(),O=o&&"function"===typeof Worker&&"function"===typeof URL,v=O||!s.jsModule,G=s.wasmUrl&&s.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:v?t.g.GetBabylonScriptURL(s.wasmUrl,!0):"",wasmBinaryPromise:Z?Promise.resolve(Z):t.g.LoadFileAsync(t.g.GetBabylonScriptURL(s.wasmBinaryUrl,!0))}:{url:v?t.g.GetBabylonScriptURL(s.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};O?this._workerPoolPromise=G.wasmBinaryPromise.then((s=>{const Z=this._getWorkerContent(),t=URL.createObjectURL(new Blob([Z],{type:"application/javascript"}));return new j.d(o,(()=>{const Z=new Worker(t);return(0,S.n)(Z,s,G.url)}))})):this._modulePromise=G.wasmBinaryPromise.then((async Z=>{if(!this._isModuleAvailable()&&!s.jsModule){if(!G.url)throw new Error("Draco codec module is not available");await t.g.LoadBabylonScriptAsync(G.url)}return await this._createModuleAsync(Z,s.jsModule)}))}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._modulePromise&&await this._modulePromise}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((s=>{s.dispose()})),delete this._workerPoolPromise,delete this._modulePromise}}},11669:(s,Z,o)=>{function t(s,Z,o,t){const j=s;let S=null,a=null,O=null,v=null;const G={},B=Z.find((s=>"POSITION"===s.dracoName));if(!B)throw new Error("Position attribute is required for Draco encoding");if(!o){const s=B.data.length/B.size;o=new(s>65535?Uint32Array:Uint16Array)(s);for(let Z=0;Z<s;Z++)o[Z]=Z}try{S=new j.Encoder,a=new j.MeshBuilder,O=new j.Mesh,a.AddFacesToMesh(O,o.length/3,o);const s=new Map([[Float32Array,(s,Z,o,t,j,S)=>s.AddFloatAttribute(Z,o,t,j,S)],[Uint32Array,(s,Z,o,t,j,S)=>s.AddUInt32Attribute(Z,o,t,j,S)],[Uint16Array,(s,Z,o,t,j,S)=>s.AddUInt16Attribute(Z,o,t,j,S)],[Uint8Array,(s,Z,o,t,j,S)=>s.AddUInt8Attribute(Z,o,t,j,S)],[Int32Array,(s,Z,o,t,j,S)=>s.AddInt32Attribute(Z,o,t,j,S)],[Int16Array,(s,Z,o,t,j,S)=>s.AddInt16Attribute(Z,o,t,j,S)],[Int8Array,(s,Z,o,t,j,S)=>s.AddInt8Attribute(Z,o,t,j,S)]]);for(const o of Z){o.data instanceof Uint8ClampedArray&&(o.data=new Uint8Array(o.data));const Z=s.get(o.data.constructor),v=o.data.length/o.size;G[o.kind]=Z(a,O,j[o.dracoName],v,o.size,o.data),t.quantizationBits&&t.quantizationBits[o.dracoName]&&S.SetAttributeQuantization(j[o.dracoName],t.quantizationBits[o.dracoName])}t.method&&S.SetEncodingMethod(j[t.method]),void 0!==t.encodeSpeed&&void 0!==t.decodeSpeed&&S.SetSpeedOptions(t.encodeSpeed,t.decodeSpeed),v=new j.DracoInt8Array;const B=S.EncodeMeshToDracoBuffer(O,v);if(B<=0)throw new Error("Draco encoding failed.");const Q=new Int8Array(B);for(let Z=0;Z<B;Z++)Q[Z]=v.GetValue(Z);return{data:Q,attributeIds:G}}finally{O&&j.destroy(O),a&&j.destroy(a),S&&j.destroy(S),v&&j.destroy(v)}}function j(){let s;onmessage=Z=>{const o=Z.data;switch(o.id){case"init":{o.url&&importScripts(o.url);const Z=o.wasmBinary?{wasmBinary:o.wasmBinary}:{};s=DracoEncoderModule(Z),postMessage({id:"initDone"});break}case"encodeMesh":if(!s)throw new Error("Draco encoder module is not available");s.then((s=>{const Z=t(s,o.attributes,o.indices,o.options);postMessage({id:"encodeMeshDone",encodedMeshData:Z},Z?[Z.data.buffer]:void 0)}))}}}function S(s,Z,o,t,j){const S=s;let a=null,O=null,v=null;try{let s;a=new S.Decoder,O=new S.DecoderBuffer,O.Init(Z,Z.byteLength);const G=a.GetEncodedGeometryType(O);switch(G){case S.TRIANGULAR_MESH:{const Z=new S.Mesh;if(s=a.DecodeBufferToMesh(O,Z),!s.ok()||0===Z.ptr)throw new Error(s.error_msg());const o=3*Z.num_faces(),j=4*o,G=S._malloc(j);try{a.GetTrianglesUInt32Array(Z,j,G);const s=new Uint32Array(o);s.set(new Uint32Array(S.HEAPF32.buffer,G,o)),t(s)}finally{S._free(G)}v=Z;break}case S.POINT_CLOUD:{const Z=new S.PointCloud;if(s=a.DecodeBufferToPointCloud(O,Z),!s.ok()||!Z.ptr)throw new Error(s.error_msg());v=Z;break}default:throw new Error(`Invalid geometry type ${G}`)}const B=v.num_points(),Q=(s,Z,o,t)=>{const a=t.data_type(),O=t.num_components(),v=t.normalized(),G=t.byte_stride(),Q=t.byte_offset(),D={[S.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:S.HEAPF32},[S.DT_INT8]:{typedArrayConstructor:Int8Array,heap:S.HEAP8},[S.DT_INT16]:{typedArrayConstructor:Int16Array,heap:S.HEAP16},[S.DT_INT32]:{typedArrayConstructor:Int32Array,heap:S.HEAP32},[S.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:S.HEAPU8},[S.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:S.HEAPU16},[S.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:S.HEAPU32}}[a];if(!D)throw new Error(`Invalid data type ${a}`);const z=B*O,Y=z*D.typedArrayConstructor.BYTES_PER_ELEMENT,b=S._malloc(Y);try{s.GetAttributeDataArrayForAllPoints(Z,t,a,Y,b);const S=new D.typedArrayConstructor(D.heap.buffer,b,z);j(o,S.slice(),O,Q,G,v)}finally{S._free(b)}};if(o)for(const Z in o){const s=o[Z],t=a.GetAttributeByUniqueId(v,s);Q(a,v,Z,t)}else{const s={position:S.POSITION,gt:S.NORMAL,color:S.COLOR,uv:S.TEX_COORD};for(const Z in s){const o=a.GetAttributeId(v,s[Z]);if(-1!==o){const s=a.GetAttribute(v,o);Q(a,v,Z,s)}}}return B}finally{v&&S.destroy(v),O&&S.destroy(O),a&&S.destroy(a)}}function a(){let s;onmessage=Z=>{const o=Z.data;switch(o.id){case"init":{o.url&&importScripts(o.url);const Z=o.wasmBinary?{wasmBinary:o.wasmBinary}:{};s=DracoDecoderModule(Z),postMessage({id:"initDone"});break}case"decodeMesh":if(!s)throw new Error("Draco decoder module is not available");s.then((s=>{const Z=S(s,o.dataView,o.attributes,(s=>{postMessage({id:"indices",data:s},[s.buffer])}),((s,Z,o,t,j,S)=>{postMessage({id:"attribute",kind:s,data:Z,size:o,byteOffset:t,byteStride:j,normalized:S},[Z.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:Z})}))}}}async function O(s,Z,o){return await new Promise(((t,j)=>{const S=Z=>{s.removeEventListener("error",S),s.removeEventListener("message",a),j(Z)},a=Z=>{"initDone"===Z.data.id&&(s.removeEventListener("error",S),s.removeEventListener("message",a),t(s))};if(s.addEventListener("error",S),s.addEventListener("message",a),Z){const t=Z.slice(0);s.postMessage({id:"init",url:o,wasmBinary:t},[t])}else s.postMessage({id:"init",url:o})}))}o.d(Z,{c:()=>S,e:()=>a,i:()=>t,j:()=>j,n:()=>O})},11322:(s,Z,o)=>{o.d(Z,{b:()=>j});var t=o(11115);class j extends t.b{constructor(s){super(),this._buffer=s}get underlyingResource(){return this._buffer}}},11206:(s,Z,o)=>{o.d(Z,{b:()=>i});var t=o(11086),j=o(10932),S=o(10900),a=o(11113),O=o(11214),v=o(11197),G=o(11223),B=o(11130),Q=o(11155);class D{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new S.n(0,0,0),this._diffPositionForCollisions=new S.n(0,0,0),this._collisionResponse=!0}}var z=o(10975),Y=o(11145),b=o(11174),f=o(10904),A=o(11229),d=o(10916),U=o(11091),u=o(11013);class H{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=S.n.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class F{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new H,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=new Map,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new D,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class i extends v.c{static get BILLBOARDMODE_NONE(){return v.c.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return v.c.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return v.c.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return v.c.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return v.c.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return v.c.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(s){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=s}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(s){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=s}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(s){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=s}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(s){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=s}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(s){this._internalAbstractMeshDataInfo._collisionRetryCount=s}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(s){this._internalAbstractMeshDataInfo._morphTargetManager!==s&&(this._internalAbstractMeshDataInfo._morphTargetManager=s,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(s){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==s&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=s,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(s){return!!super._updateNonUniformScalingState(s)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(s){this._internalAbstractMeshDataInfo._rawBoundingInfo=s}set KD(s){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(s)}set onCollisionPositionChange(s){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(s)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(s){if(this._internalAbstractMeshDataInfo._visibility===s)return;const Z=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=s,(1===Z&&1!==s||1!==Z&&1===s)&&this._markSubMeshesAsDirty((s=>{s.markAsMiscDirty(),s.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(s){this._internalAbstractMeshDataInfo._inheritVisibility=s}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let s=this._parentNode;for(;s;){const Z=s.isVisible;if("undefined"!==typeof Z)return Z;s=s.parent}}return this._isVisible}set isVisible(s){this._isVisible=s}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(s){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=s}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(s){this._internalAbstractMeshDataInfo._renderingGroupId=s}get material(){return this._internalAbstractMeshDataInfo._material}set material(s){this._setMaterial(s)}_setMaterial(s){this._internalAbstractMeshDataInfo._material!==s&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=s,s&&s.meshMap&&(s.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.vO&&(this.resetDrawCache(void 0,null==s),this._unBindEffect()))}getMaterialForRenderPass(s){var Z;return null===(Z=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===Z?void 0:Z[s]}setMaterialForRenderPass(s,Z){var o;this.resetDrawCache(s),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]);const t=this._internalAbstractMeshDataInfo._materialForRenderPass[s];null!==t&&void 0!==t&&null!==(o=t.meshMap)&&void 0!==o&&o[this.uniqueId]&&(t.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._materialForRenderPass[s]=Z,Z&&Z.meshMap&&(Z.meshMap[this.uniqueId]=this)}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(s){this._internalAbstractMeshDataInfo._receiveShadows!==s&&(this._internalAbstractMeshDataInfo._receiveShadows=s,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(s){this._internalAbstractMeshDataInfo._hasVertexAlpha!==s&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=s,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(s){this._internalAbstractMeshDataInfo._useVertexColors!==s&&(this._internalAbstractMeshDataInfo._useVertexColors=s,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(s){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==s&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=s,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(s){this._internalAbstractMeshDataInfo._numBoneInfluencers!==s&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=s,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(s){this._internalAbstractMeshDataInfo._applyFog!==s&&(this._internalAbstractMeshDataInfo._applyFog=s,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(s){this._internalAbstractMeshDataInfo._enableDistantPicking=s}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(s){s!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=s,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(s){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(s)?-1:s}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(s){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=s}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(s){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(s)?-1:s}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(s){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=s}get lightSources(){return this._lightSources}set skeleton(s){const Z=this._internalAbstractMeshDataInfo._skeleton;Z&&Z.needInitialSkinMatrix&&Z._unregisterMeshWithPoseMatrix(this),s&&s.needInitialSkinMatrix&&s._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=s,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(s){var Z;let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(s,o,!1),Z=this,this._internalAbstractMeshDataInfo=new F,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.CB=i.KB,this.onCollideObservable=new j.b,this.onCollisionPositionChangeObservable=new j.b,this.onMaterialChangedObservable=new j.b,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.Uv=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=b.d.Red(),this.outlineWidth=.02,this.overlayColor=b.d.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.UO=!1,this.Xs=!1,this.actionManager=null,this.ellipsoid=new S.n(.5,1,.5),this.ellipsoidOffset=new S.n(0,0,0),this.edgesWidth=1,this.edgesColor=new b.h(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,dO:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new j.b,this._onCollisionPositionChange=function(s,o){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;o.subtractToRef(Z._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,Z._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),Z._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>u.e.CollisionsEpsilon&&Z.position.addInPlace(Z._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),t&&Z.onCollideObservable.notifyObservers(t),Z.onCollisionPositionChangeObservable.notifyObservers(Z.position)},o=this.Ls(),o.wG(this),this._resyncLightSources(),this._uniformBuffer=new Q.e(this.Ls().getEngine(),void 0,void 0,s,!this.Ls().getEngine().isWebGPU),this._buildUniformLayout(),o.performancePriority){case 2:this.Xs=!0;case 1:this.UO=!0,this.Uv=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(s){const Z=this._uniformBuffer;Z.SO("world",s),Z.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),Z.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(s){let Z="Name: "+this.name+", isInstance: "+("InstancedMesh"===this.getClassName()?"YES":"NO");Z+=", # of submeshes: "+(this.vO?this.vO.length:0);const o=this._internalAbstractMeshDataInfo._skeleton;return o&&(Z+=", skeleton: "+o.name),s&&(Z+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],Z+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.dO?"YES":"NO")),Z}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==v.c.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(Z||this.actionManager.isRecursive)){if(!s)return this.actionManager;if(this.actionManager.hasSpecificTrigger(s))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(s,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.vO){for(const s of this.vO)s._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const s of this.Ls().lights)s.isEnabled()&&s.canAffectMesh(this)&&this._lightSources.push(s);this._markSubMeshesAsLightDirty()}_resyncLightSource(s){const Z=s.isEnabled()&&s.canAffectMesh(this),o=this._lightSources.indexOf(s);let t=!1;if(-1===o){if(!Z)return;this._lightSources.push(s)}else{if(Z)return;t=!0,this._lightSources.splice(o,1)}this._markSubMeshesAsLightDirty(t)}_unBindEffect(){for(const s of this.vO)s.setEffect(null)}_removeLightSource(s,Z){const o=this._lightSources.indexOf(s);-1!==o&&(this._lightSources.splice(o,1),this._markSubMeshesAsLightDirty(Z))}_markSubMeshesAsDirty(s){if(this.vO)for(const Z of this.vO)for(let o=0;o<Z._drawWrappers.length;++o){const t=Z._drawWrappers[o];t&&t.defines&&t.defines.markAllAsDirty&&s(t.defines)}}_markSubMeshesAsLightDirty(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((Z=>Z.markAsLightDirty(s)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((s=>s.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((s=>s.markAsMiscDirty()))}dG(s){return this._currentRenderId=Number.MAX_VALUE,super.dG(s),this._isDirty=!0,this}resetDrawCache(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.vO)for(const o of this.vO)o.resetDrawCache(s,Z)}get isBlocked(){return!1}getLOD(s){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}ra(){return null}getVerticesData(s){return null}hs(s,Z,o,t){return this}updateVerticesData(s,Z,o,t){return this}setIndices(s,Z){return this}isVerticesDataPresent(s){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.Ws()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(s){return this._boundingInfo=s,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(s,Z,o){return this._boundingInfo=new B.e(s,Z,o),this._boundingInfo}normalizeToUnitCube(){let s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(s,Z,o)}get useBones(){return this.skeleton&&this.Ls().skeletonsEnabled&&this.isVerticesDataPresent(a.e.MatricesIndicesKind)&&this.isVerticesDataPresent(a.e.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(s){}_activate(s,Z){return this._renderId=s,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===v.c.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(s,Z,o){return this.position.addInPlace(this.calcMovePOV(s,Z,o)),this}calcMovePOV(s,Z,o){const t=new S.b;(this.rotationQuaternion?this.rotationQuaternion:S.e.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(t);const j=S.n.Zero(),a=this.definedFacingForward?-1:1;return S.n.TransformCoordinatesFromFloatsToRef(s*a,Z,o*a,t,j),j}rotatePOV(s,Z,o){return this.rotation.addInPlace(this.calcRotatePOV(s,Z,o)),this}calcRotatePOV(s,Z,o){const t=this.definedFacingForward?1:-1;return new S.n(s*t,Z,o*t)}qs(s,Z){if(s){const o=(0,Y.e)(s,0,this.getTotalVertices(),Z);this._boundingInfo?this._boundingInfo.reConstruct(o.minimum,o.maximum):this._boundingInfo=new B.e(o.minimum,o.maximum)}if(this.vO)for(let o=0;o<this.vO.length;o++)this.vO[o].refreshBoundingInfo(s);this.Ws()}_refreshBoundingInfoDirect(s){if(this._boundingInfo?this._boundingInfo.reConstruct(s.minimum,s.maximum):this._boundingInfo=new B.e(s.minimum,s.maximum),this.vO)for(let Z=0;Z<this.vO.length;Z++)this.vO[Z].refreshBoundingInfo(null);this.Ws()}static _ApplySkeleton(s,Z,o,t,j,O,v){!function(s,Z,o,t,j,O,v){const G=S.g.sO[0],B=S.g.Matrix[0],Q=S.g.Matrix[1],D=Z===a.e.NormalKind?S.n.TransformNormalFromFloatsToRef:S.n.TransformCoordinatesFromFloatsToRef;for(let a=0,z=0;a<s.length;a+=3,z+=4){let Z,Y;for(B.reset(),Z=0;Z<4;Z++)Y=j[z+Z],Y>0&&(S.b.FromFloat32ArrayToRefScaled(o,Math.floor(16*t[z+Z]),Y,Q),B.addToSelf(Q));if(O&&v)for(Z=0;Z<4;Z++)Y=v[z+Z],Y>0&&(S.b.FromFloat32ArrayToRefScaled(o,Math.floor(16*O[z+Z]),Y,Q),B.addToSelf(Q));D(s[a],s[a+1],s[a+2],B,G),G.toArray(s,a)}}(s,Z,o,t,j,O,v)}_getData(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.e.PositionKind;const t=s.cache,j=s=>{if(t){const Z=t._vertexData||(t._vertexData={});return Z[s]||this.copyVerticesData(s,Z),Z[s]}return this.getVerticesData(s)};if(Z||(Z=j(o)),!Z)return null;if(t?(t._outputData?t._outputData.set(Z):t._outputData=new Float32Array(Z),Z=t._outputData):(s.applyMorph&&this.morphTargetManager||s.applySkeleton&&this.skeleton)&&(Z=Z.slice()),s.applyMorph&&this.morphTargetManager&&function(s,Z,o){let t=null;switch(Z){case a.e.PositionKind:t=s=>s.getPositions();break;case a.e.NormalKind:t=s=>s.getNormals();break;case a.e.TangentKind:t=s=>s.getTangents();break;case a.e.UVKind:t=s=>s.getUVs();break;case a.e.UV2Kind:t=s=>s.getUV2s();break;case a.e.ColorKind:t=s=>s.getColors();break;default:return}for(let j=0;j<s.length;j++){let Z=s[j];for(let S=0;S<o.numTargets;S++){const a=o.getTarget(S),O=a.influence;if(0!==O){const o=t(a);o&&(Z+=(o[j]-s[j])*O)}}s[j]=Z}}(Z,o,this.morphTargetManager),s.applySkeleton&&this.skeleton){const s=j(a.e.MatricesIndicesKind),t=j(a.e.MatricesWeightsKind);if(t&&s){const S=this.numBoneInfluencers>4,O=S?j(a.e.MatricesIndicesExtraKind):null,v=S?j(a.e.MatricesWeightsExtraKind):null,G=this.skeleton.getTransformMatrices(this);i._ApplySkeleton(Z,o,G,s,t,O,v)}}if(!1!==s.updatePositionsArray&&o===a.e.PositionKind){const s=this._internalAbstractMeshDataInfo._positions||[],o=s.length;if(s.length=Z.length/3,o<s.length)for(let Z=o;Z<s.length;Z++)s[Z]=new S.n;for(let t=0,j=0;t<s.length;t++,j+=3)s[t].Ja(Z[j],Z[j+1],Z[j+2]);this._internalAbstractMeshDataInfo._positions=s}return Z}getNormalsData(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:s,applyMorph:Z,updatePositionsArray:!1},null,a.e.NormalKind)}LO(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:s,applyMorph:Z,updatePositionsArray:!1},o,a.e.PositionKind)}Ws(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new B.e(S.n.Zero(),S.n.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(s){if(!this.vO)return this;const Z=this.vO.length;for(let o=0;o<Z;o++){const t=this.vO[o];(Z>1||!t.IsGlobal)&&t.updateBoundingInfo(s)}return this}_afterComputeWorldMatrix(){this.Xs||(this._boundingInfoIsDirty=!0)}isInFrustum(s){return this.getBoundingInfo().isInFrustum(s,this.CB)}isCompletelyInFrustum(s){return this.getBoundingInfo().isCompletelyInFrustum(s)}intersectsMesh(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2?arguments[2]:void 0;const t=this.getBoundingInfo(),j=s.getBoundingInfo();if(t.intersects(j,Z))return!0;if(o)for(const S of this.getChildMeshes())if(S.intersectsMesh(s,Z,!0))return!0;return!1}intersectsPoint(s){return this.getBoundingInfo().intersectsPoint(s)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(s){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=s}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const o=this.Ls().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=o.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,o.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,s,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId,Z),this}_collideForSubMesh(s,Z,o){var t;if(this._generatePointsArray(),!this._positions)return this;if(!s._lastColliderWorldVertices||!s._lastColliderTransformMatrix.equals(Z)){s._lastColliderTransformMatrix=Z.clone(),s._lastColliderWorldVertices=[],s._trianglePlanes=[];const o=s.verticesStart,t=s.verticesStart+s.verticesCount;for(let j=o;j<t;j++)s._lastColliderWorldVertices.push(S.n.TransformCoordinates(this._positions[j],Z))}return o._collide(s._trianglePlanes,s._lastColliderWorldVertices,this.ra(),s.indexStart,s.indexStart+s.indexCount,s.verticesStart,!!s.Ms(),this,this._shouldConvertRHS(),7===(null===(t=s.Ms())||void 0===t?void 0:t.fillMode)),this}_processCollisionsForSubMeshes(s,Z){const o=this._scene.getCollidingSubMeshCandidates(this,s),t=o.length;for(let j=0;j<t;j++){const S=o.data[j];t>1&&!S._checkCollision(s)||this._collideForSubMesh(S,Z,s)}return this}_shouldConvertRHS(){return!1}_checkCollision(s){if(!this.getBoundingInfo()._checkCollision(s))return this;const Z=S.g.Matrix[0],o=S.g.Matrix[1];return S.b.ScalingToRef(1/s._radius.x,1/s._radius.y,1/s._radius.z,Z),this.worldMatrixFromCache.multiplyToRef(Z,o),this._processCollisionsForSubMeshes(s,o),this}_generatePointsArray(){return!1}intersects(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],j=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const O=new G.b,v=this.getClassName(),B="InstancedLinesMesh"===v||"LinesMesh"===v||"GreasedLineMesh"===v?this.intersectionThreshold:0,Q=this.getBoundingInfo();if(!this.vO)return O;if(!a&&(!s.intersectsSphere(Q.boundingSphere,B)||!s.intersectsBox(Q.boundingBox,B)))return O;if(t)return O.hit=!a,O.pickedMesh=a?null:this,O.distance=a?0:S.n.Distance(s.origin,Q.boundingSphere.center),O.subMeshId=0,O;if(!this._generatePointsArray())return O;let D=null;const z=this._scene.getIntersectingSubMeshCandidates(this,s),Y=z.length;let b=!1;for(let S=0;S<Y;S++){const s=z.data[S].Ms();if(s&&(7==s.fillMode||0==s.fillMode||1==s.fillMode||2==s.fillMode||4==s.fillMode)){b=!0;break}}if(!b)return O.hit=!0,O.pickedMesh=this,O.distance=S.n.Distance(s.origin,Q.boundingSphere.center),O.subMeshId=-1,O;for(let S=0;S<Y;S++){const t=z.data[S];if(Y>1&&!a&&!t.canIntersects(s))continue;const j=t.intersects(s,this._positions,this.ra(),Z,o);if(j&&(Z||!D||j.distance<D.distance)&&(D=j,D.subMeshId=S,Z))break}if(D){const Z=j??this.getWorldMatrix(),o=S.g.sO[0],t=S.g.sO[1];S.n.TransformCoordinatesToRef(s.origin,Z,o),s.direction.scaleToRef(D.distance,t);const a=S.n.TransformNormal(t,Z).addInPlace(o);return O.hit=!0,O.distance=S.n.Distance(o,a),O.pickedPoint=a,O.pickedMesh=this,O.bu=D.bu||0,O.bv=D.bv||0,O.subMeshFaceId=D.faceId,O.faceId=D.faceId+z.data[D.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),O.subMeshId=D.subMeshId,O}return O}clone(s,Z,o){return null}releaseSubMeshes(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.vO)for(;this.vO.length;)this.vO[0].dispose(s);else this.vO=[];return this}dispose(s){let Z,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const t=this.Ls();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),t.freeActiveMeshes(),t.freeRenderingGroups(),t.renderingManager.maintainStateBetweenFrames&&t.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((s=>s!==this&&s.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),Z=0;Z<this._intersectionsInProgress.length;Z++){const s=this._intersectionsInProgress[Z],o=s._intersectionsInProgress.indexOf(this);s._intersectionsInProgress.splice(o,1)}this._intersectionsInProgress.length=0;const j=t.lights;for(const a of j){let s=a.includedOnlyMeshes.indexOf(this);-1!==s&&a.includedOnlyMeshes.splice(s,1),s=a.excludedMeshes.indexOf(this),-1!==s&&a.excludedMeshes.splice(s,1);const Z=a.getShadowGenerators();if(Z){const o=Z.values();for(let Z=o.next();!0!==Z.done;Z=o.next()){const o=Z.value.getShadowMap();o&&o.renderList&&(s=o.renderList.indexOf(this),-1!==s&&o.renderList.splice(s,1))}}}"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes(!0);const S=t.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,S.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),S.wipeCaches(),t.cG(this),this._parentContainer){const s=this._parentContainer.meshes.indexOf(this);s>-1&&this._parentContainer.meshes.splice(s,1),this._parentContainer=null}if(o&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!s)for(Z=0;Z<t.gQ.length;Z++)t.gQ[Z].k===this&&(t.gQ[Z].dispose(),Z--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(s,o)}_initFacetData(){const s=this._internalAbstractMeshDataInfo._facetData;s.facetNormals||(s.facetNormals=[]),s.facetPositions||(s.facetPositions=[]),s.facetPartitioning||(s.facetPartitioning=new Array),s.facetNb=this.ra().length/3|0,s.partitioningSubdivisions=s.partitioningSubdivisions?s.partitioningSubdivisions:10,s.partitioningBBoxRatio=s.partitioningBBoxRatio?s.partitioningBBoxRatio:1.01;for(let Z=0;Z<s.facetNb;Z++)s.facetNormals[Z]=S.n.Zero(),s.facetPositions[Z]=S.n.Zero();return s.facetDataEnabled=!0,this}updateFacetData(){const s=this._internalAbstractMeshDataInfo._facetData;s.facetDataEnabled||this._initFacetData();const Z=this.getVerticesData(a.e.PositionKind),o=this.ra(),t=this.getVerticesData(a.e.NormalKind),j=this.getBoundingInfo();if(s.facetDepthSort&&!s.facetDepthSortEnabled){if(s.facetDepthSortEnabled=!0,o instanceof Uint16Array)s.depthSortedIndices=new Uint16Array(o);else if(o instanceof Uint32Array)s.depthSortedIndices=new Uint32Array(o);else{let Z=!1;for(let s=0;s<o.length;s++)if(o[s]>65535){Z=!0;break}s.depthSortedIndices=Z?new Uint32Array(o):new Uint16Array(o)}if(s.facetDepthSortFunction=function(s,Z){return Z.sqDistance-s.sqDistance},!s.facetDepthSortFrom){const Z=this.Ls().activeCamera;s.facetDepthSortFrom=Z?Z.position:S.n.Zero()}s.depthSortedFacets=[];for(let Z=0;Z<s.facetNb;Z++){const o={ind:3*Z,sqDistance:0};s.depthSortedFacets.push(o)}s.invertedMatrix=S.b.Identity(),s.facetDepthSortOrigin=S.n.Zero()}s.bbSize.x=j.maximum.x-j.minimum.x>f.b?j.maximum.x-j.minimum.x:f.b,s.bbSize.y=j.maximum.y-j.minimum.y>f.b?j.maximum.y-j.minimum.y:f.b,s.bbSize.z=j.maximum.z-j.minimum.z>f.b?j.maximum.z-j.minimum.z:f.b;let v=s.bbSize.x>s.bbSize.y?s.bbSize.x:s.bbSize.y;if(v=v>s.bbSize.z?v:s.bbSize.z,s.subDiv.max=s.partitioningSubdivisions,s.subDiv.X=Math.floor(s.subDiv.max*s.bbSize.x/v),s.subDiv.Y=Math.floor(s.subDiv.max*s.bbSize.y/v),s.subDiv.Z=Math.floor(s.subDiv.max*s.bbSize.z/v),s.subDiv.X=s.subDiv.X<1?1:s.subDiv.X,s.subDiv.Y=s.subDiv.Y<1?1:s.subDiv.Y,s.subDiv.Z=s.subDiv.Z<1?1:s.subDiv.Z,s.facetParameters.facetNormals=this.getFacetLocalNormals(),s.facetParameters.facetPositions=this.getFacetLocalPositions(),s.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),s.facetParameters.bInfo=j,s.facetParameters.bbSize=s.bbSize,s.facetParameters.subDiv=s.subDiv,s.facetParameters.ratio=this.partitioningBBoxRatio,s.facetParameters.depthSort=s.facetDepthSort,s.facetDepthSort&&s.facetDepthSortEnabled&&(this.Ea(!0),this._worldMatrix.invertToRef(s.invertedMatrix),S.n.TransformCoordinatesToRef(s.facetDepthSortFrom,s.invertedMatrix,s.facetDepthSortOrigin),s.facetParameters.distanceTo=s.facetDepthSortOrigin),s.facetParameters.depthSortedFacets=s.depthSortedFacets,t&&O.d.ComputeNormals(Z,o,t,s.facetParameters),s.facetDepthSort&&s.facetDepthSortEnabled){s.depthSortedFacets.sort(s.facetDepthSortFunction);const Z=s.depthSortedIndices.length/3|0;for(let t=0;t<Z;t++){const Z=s.depthSortedFacets[t].ind;s.depthSortedIndices[3*t]=o[Z],s.depthSortedIndices[3*t+1]=o[Z+1],s.depthSortedIndices[3*t+2]=o[Z+2]}this.updateIndices(s.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const s=this._internalAbstractMeshDataInfo._facetData;return s.facetNormals||this.updateFacetData(),s.facetNormals}getFacetLocalPositions(){const s=this._internalAbstractMeshDataInfo._facetData;return s.facetPositions||this.updateFacetData(),s.facetPositions}getFacetLocalPartitioning(){const s=this._internalAbstractMeshDataInfo._facetData;return s.facetPartitioning||this.updateFacetData(),s.facetPartitioning}getFacetPosition(s){const Z=S.n.Zero();return this.getFacetPositionToRef(s,Z),Z}getFacetPositionToRef(s,Z){const o=this.getFacetLocalPositions()[s],t=this.getWorldMatrix();return S.n.TransformCoordinatesToRef(o,t,Z),this}getFacetNormal(s){const Z=S.n.Zero();return this.getFacetNormalToRef(s,Z),Z}getFacetNormalToRef(s,Z){const o=this.getFacetLocalNormals()[s];return S.n.TransformNormalToRef(o,this.getWorldMatrix(),Z),this}getFacetsAtLocalCoordinates(s,Z,o){const t=this.getBoundingInfo(),j=this._internalAbstractMeshDataInfo._facetData,S=Math.floor((s-t.minimum.x*j.partitioningBBoxRatio)*j.subDiv.X*j.partitioningBBoxRatio/j.bbSize.x),a=Math.floor((Z-t.minimum.y*j.partitioningBBoxRatio)*j.subDiv.Y*j.partitioningBBoxRatio/j.bbSize.y),O=Math.floor((o-t.minimum.z*j.partitioningBBoxRatio)*j.subDiv.Z*j.partitioningBBoxRatio/j.bbSize.z);return S<0||S>j.subDiv.max||a<0||a>j.subDiv.max||O<0||O>j.subDiv.max?null:j.facetPartitioning[S+j.subDiv.max*a+j.subDiv.max*j.subDiv.max*O]}getClosestFacetAtCoordinates(s,Z,o,t){let j=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const O=this.getWorldMatrix(),v=S.g.Matrix[5];O.invertToRef(v);const G=S.g.sO[8];S.n.TransformCoordinatesFromFloatsToRef(s,Z,o,v,G);const B=this.getClosestFacetAtLocalCoordinates(G.x,G.y,G.z,t,j,a);return t&&S.n.TransformCoordinatesFromFloatsToRef(t.x,t.y,t.z,O,t),B}getClosestFacetAtLocalCoordinates(s,Z,o,t){let j=arguments.length>4&&void 0!==arguments[4]&&arguments[4],S=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=null,O=0,v=0,G=0,B=0,Q=0,D=0,z=0,Y=0;const b=this.getFacetLocalPositions(),f=this.getFacetLocalNormals(),A=this.getFacetsAtLocalCoordinates(s,Z,o);if(!A)return null;let d,U,u,H=Number.MAX_VALUE,F=H;for(let i=0;i<A.length;i++)d=A[i],U=f[d],u=b[d],B=(s-u.x)*U.x+(Z-u.y)*U.y+(o-u.z)*U.z,(!j||j&&S&&B>=0||j&&!S&&B<=0)&&(B=U.x*u.x+U.y*u.y+U.z*u.z,Q=-(U.x*s+U.y*Z+U.z*o-B)/(U.x*U.x+U.y*U.y+U.z*U.z),D=s+U.x*Q,z=Z+U.y*Q,Y=o+U.z*Q,O=D-s,v=z-Z,G=Y-o,F=O*O+v*v+G*G,F<H&&(H=F,a=d,t&&(t.x=D,t.y=z,t.z=Y)));return a}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const s=this._internalAbstractMeshDataInfo._facetData;return s.facetDataEnabled&&(s.facetDataEnabled=!1,s.facetPositions=[],s.facetNormals=[],s.facetPartitioning=new Array,s.facetParameters={},s.depthSortedIndices=new Uint32Array(0)),this}updateIndices(s,Z){return this}createNormals(s){const Z=this.getVerticesData(a.e.PositionKind),o=this.ra();let t;return t=this.isVerticesDataPresent(a.e.NormalKind)?this.getVerticesData(a.e.NormalKind):[],O.d.ComputeNormals(Z,o,t,{useRightHandedSystem:this.Ls().useRightHandedSystem}),this.hs(a.e.NormalKind,t,s),this}async optimizeIndicesAsync(){const s=this.ra();if(!s)return this;const{OptimizeIndices:Z}=await o.e(35).then(o.bind(o,13540));return Z(s),this.setIndices(s,this.getTotalVertices()),this}alignWithNormal(s,Z){Z||(Z=A.c.Y);const o=S.g.sO[0],t=S.g.sO[1];return S.n.CrossToRef(Z,s,t),S.n.CrossToRef(s,t,o),this.rotationQuaternion?S.e.RotationQuaternionFromAxisToRef(o,s,t,this.rotationQuaternion):S.n.RotationFromAxisToRef(o,s,t,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,z.d)("EdgesRenderer")}enableEdgesRendering(s,Z,o){throw(0,z.d)("EdgesRenderer")}lQ(){return this._scene.gQ.filter((s=>s.k===this))}}i.OCCLUSION_TYPE_NONE=0,i.OCCLUSION_TYPE_OPTIMISTIC=1,i.OCCLUSION_TYPE_STRICT=2,i.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,i.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,i.CULLINGSTRATEGY_STANDARD=0,i.KB=1,i.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,i.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,t.c)([U.e.filter((function(){for(var s=arguments.length,Z=new Array(s),o=0;o<s;o++)Z[o]=arguments[o];let[t,j,S,a,O]=Z;return!Array.isArray(t)&&!Array.isArray(j)&&!Array.isArray(S)&&!Array.isArray(a)&&!Array.isArray(O)}))],i,"_ApplySkeleton",null),(0,d.f)("BABYLON.AbstractMesh",i)},11675:(s,Z,o)=>{o.d(Z,{e:()=>t.e});var t=o(11113)},11273:(s,Z,o)=>{o.d(Z,{e:()=>f});var t=o(10900),j=o(11174),S=o(11214),a=o(11113),O=o(11108),v=o(11282),G=o(11130),B=o(10938),Q=o(11172),D=o(11145),z=o(10927),Y=o(11291),b=o(11122);class f{get boundingBias(){return this._boundingBias}set boundingBias(s){this._boundingBias?this._boundingBias.O(s):this._boundingBias=s.clone(),this.Ws(!0,null)}static CreateGeometryForMesh(s){const Z=new f(f.RandomId(),s.Ls());return Z.ws(s),Z}get meshes(){return this._meshes}constructor(s,Z,o){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._extend={minimum:new t.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),maximum:new t.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=Z||z.c.LastCreatedScene,this._scene&&(this.id=s,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=j,o?this.setAllVerticesData(o,j):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),S&&(this.ws(S),S.Ea(!0)))}get extend(){return this._extend}Ls(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let s=0;s<this._meshes.length;s++)if(!this._meshes[s].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const s=new Set;for(const Z in this._vertexBuffers)s.add(this._vertexBuffers[Z].getWrapperBuffer());s.forEach((s=>{s._rebuild()}))}setAllVerticesData(s,Z){s.applyToGeometry(this,Z),this._notifyUpdate()}hs(s,Z){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3?arguments[3]:void 0;o&&Array.isArray(Z)&&(Z=new Float32Array(Z));const j=new a.e(this._engine,Z,s,{updatable:o,postponeInternalCreation:0===this._meshes.length,stride:t,label:"Geometry_"+this.id+"_"+s});this.setVerticesBuffer(j)}removeVerticesData(s){this._vertexBuffers[s]&&(this._vertexBuffers[s].dispose(),delete this._vertexBuffers[s]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const j=s.getKind();this._vertexBuffers[j]&&o&&this._vertexBuffers[j].dispose(),s._buffer&&s._buffer._increaseReferences(),this._vertexBuffers[j]=s;const S=this._meshes,O=S.length;if(j===a.e.PositionKind){this._totalVertices=Z??s._maxVerticesCount,this._updateExtend(s.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const o=this._extend&&this._extend.minimum||new t.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),j=this._extend&&this._extend.maximum||new t.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let s=0;s<O;s++){const Z=S[s];Z.buildBoundingInfo(o,j),Z._createGlobalSubMesh(Z.isUnIndexed),Z.Ea(!0),Z.synchronizeInstances()}}this._notifyUpdate(j)}updateVerticesDataDirectly(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const j=this.getVertexBuffer(s);j&&(j.updateDirectly(Z,o,t),this._notifyUpdate(s))}updateVerticesData(s,Z){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const t=this.getVertexBuffer(s);t&&(t.update(Z),s===a.e.PositionKind&&this.Ws(o,Z),this._notifyUpdate(s))}Ws(s,Z){if(s&&this._updateExtend(Z),this._resetPointsArrayCache(),s){const s=this._meshes;for(const Z of s){Z.hasBoundingInfo?Z.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):Z.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const s=Z.vO;for(const Z of s)Z.refreshBoundingInfo()}}}_bind(s,Z,o,t){if(!s)return;void 0===Z&&(Z=this._indexBuffer);const j=this.getVertexBuffers();if(!j)return;if(Z!=this._indexBuffer||!this._vertexArrayObjects&&!t)return void this._engine.bindBuffers(j,Z,s,o);const S=t||this._vertexArrayObjects,a=this._engine;S[s.key]||(S[s.key]=a.recordVertexArrayObject(j,Z,s,o)),a.bindVertexArrayObject(S[s.key],Z)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(s,Z,o){const t=this.getVertexBuffer(s);return t?t.getFloatData(this._totalVertices,o||Z&&1!==this._meshes.length):null}copyVerticesData(s,Z){const o=this.getVertexBuffer(s);if(!o)return;Z[s]||(Z[s]=new Float32Array(this._totalVertices*o.getSize()));const t=o.getData();t&&(0,b.h)(t,o.getSize(),o.type,o.byteOffset,o.byteStride,o.normalized,this._totalVertices,Z[s])}isVertexBufferUpdatable(s){const Z=this._vertexBuffers[s];return!!Z&&Z.isUpdatable()}getVertexBuffer(s){return this.isReady()?this._vertexBuffers[s]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(s){return this._vertexBuffers?void 0!==this._vertexBuffers[s]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(s)}getVerticesDataKinds(){const s=[];let Z;if(!this._vertexBuffers&&this._delayInfo)for(Z in this._delayInfo)s.push(Z);else for(Z in this._vertexBuffers)s.push(Z);return s}updateIndices(s,Z){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const t=s.length!==this._indices.length;if(o||(this._indices=s.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,s,Z),t)for(const s of this._meshes)s._createGlobalSubMesh(!0)}else this.setIndices(s,null,!0)}setIndexBuffer(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=s,this._totalVertices=Z,this._totalIndices=o,s.is32Bits=null===t?Z>65535:t;for(const j of this._meshes)j._createGlobalSubMesh(!0),j.synchronizeInstances();this._notifyUpdate()}setIndices(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=s,this._indexBufferIsUpdatable=o,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,o,"Geometry_"+this.id+"_IndexBuffer")),void 0!=Z&&(this._totalVertices=Z);for(const j of this._meshes)j._createGlobalSubMesh(!t),j.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}ra(s,Z){if(!this.isReady())return null;const o=this._indices;return Z||s&&1!==this._meshes.length?o.slice():o}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;s&&this._vertexArrayObjects&&this._vertexArrayObjects[s.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[s.key]),delete this._vertexArrayObjects[s.key])}releaseForMesh(s,Z){const o=this._meshes,t=o.indexOf(s);-1!==t&&(o.splice(t,1),this._vertexArrayObjects&&s._invalidateInstanceVertexArrayObject(),s._geometry=null,0===o.length&&Z&&this.dispose())}ws(s){if(s._geometry===this)return;const Z=s._geometry;Z&&Z.releaseForMesh(s),this._vertexArrayObjects&&s._invalidateInstanceVertexArrayObject();const o=this._meshes;s._geometry=this,s._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),o.push(s),this.isReady()?this._applyToMesh(s):this._boundingInfo&&s.setBoundingInfo(this._boundingInfo)}_updateExtend(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!s&&(s=this.getVerticesData(a.e.PositionKind),!s))return;this._extend=(0,D.e)(s,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(s){const Z=this._meshes.length;for(const o in this._vertexBuffers)1===Z&&this._vertexBuffers[o].create(),o===a.e.PositionKind&&(this._extend||this._updateExtend(),s.buildBoundingInfo(this._extend.minimum,this._extend.maximum),s._createGlobalSubMesh(s.isUnIndexed),s.Ws());1===Z&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),s._syncGeometryWithMorphTargetManager(),s.synchronizeInstances()}_notifyUpdate(s){this.onGeometryUpdated&&this.onGeometryUpdated(this,s),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const Z of this._meshes)Z._markSubMeshesAsAttributesDirty()}load(s,Z){2!==this.delayLoadState&&(this.isReady()?Z&&Z():(this.delayLoadState=2,this._queueLoad(s,Z)))}_queueLoad(s,Z){this.delayLoadingFile&&(s.addPendingData(this),s._loadFile(this.delayLoadingFile,(o=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(o),this),this.delayLoadState=1,this._delayInfo=[],s.removePendingData(this);const t=this._meshes,j=t.length;for(let s=0;s<j;s++)this._applyToMesh(t[s]);Z&&Z()}),void 0,!0))}toLeftHanded(){const s=this.ra(!1);if(null!=s&&s.length>0){for(let Z=0;Z<s.length;Z+=3){const o=s[Z+0];s[Z+0]=s[Z+2],s[Z+2]=o}this.setIndices(s)}const Z=this.getVerticesData(a.e.PositionKind,!1);if(null!=Z&&Z.length>0){for(let s=0;s<Z.length;s+=3)Z[s+2]=-Z[s+2];this.hs(a.e.PositionKind,Z,!1)}const o=this.getVerticesData(a.e.NormalKind,!1);if(null!=o&&o.length>0){for(let s=0;s<o.length;s+=3)o[s+2]=-o[s+2];this.hs(a.e.NormalKind,o,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const s=this.getVerticesData(a.e.PositionKind);if(!s||0===s.length)return!1;for(let Z=3*this._positionsCache.length,o=this._positionsCache.length;Z<s.length;Z+=3,++o)this._positionsCache[o]=t.n.oO(s,Z);for(let Z=0,o=0;Z<s.length;Z+=3,++o)this._positionsCache[o].set(s[0+Z],s[1+Z],s[2+Z]);return this._positionsCache.length=s.length/3,this._positions=this._positionsCache,!0}B(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const o in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[o]);this._vertexArrayObjects={};const s=this._meshes,Z=s.length;for(let o=0;o<Z;o++)s[o]._invalidateInstanceVertexArrayObject()}}dispose(){const s=this._meshes,Z=s.length;let o;for(o=0;o<Z;o++)this.releaseForMesh(s[o]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const t in this._vertexBuffers)this._vertexBuffers[t].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const s=this._parentContainer.geometries.indexOf(this);s>-1&&this._parentContainer.geometries.splice(s,1),this._parentContainer=null}this._isDisposed=!0}i(s){const Z=new S.d;Z.indices=[];const o=this.ra();if(o)for(let S=0;S<o.length;S++)Z.indices.push(o[S]);let t,j=!1,a=!1;for(t in this._vertexBuffers){const s=this.getVerticesData(t);if(s&&(s instanceof Float32Array?Z.set(new Float32Array(s),t):Z.set(s.slice(0),t),!a)){const s=this.getVertexBuffer(t);s&&(j=s.isUpdatable(),a=!j)}}const O=new f(s,this._scene,Z,j);for(t in O.delayLoadState=this.delayLoadState,O.delayLoadingFile=this.delayLoadingFile,O._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)O._delayInfo=O._delayInfo||[],O._delayInfo.push(t);return O._boundingInfo=new G.e(this._extend.minimum,this._extend.maximum),O}serialize(){const s={};return s.id=this.id,s.uniqueId=this.uniqueId,s.updatable=this._updatable,Q.b&&Q.b.HasTags(this)&&(s.tags=Q.b.GetTags(this)),s}_toNumberArray(s){return Array.isArray(s)?s:Array.prototype.slice.call(s)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const s in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,s)&&(this._vertexBuffers[s]._buffer._data=null)}serializeVerticeData(){const s=this.serialize();return this.isVerticesDataPresent(a.e.PositionKind)&&(s.gs=this._toNumberArray(this.getVerticesData(a.e.PositionKind)),this.isVertexBufferUpdatable(a.e.PositionKind)&&(s.positionsUpdatable=!0)),this.isVerticesDataPresent(a.e.NormalKind)&&(s.ls=this._toNumberArray(this.getVerticesData(a.e.NormalKind)),this.isVertexBufferUpdatable(a.e.NormalKind)&&(s.normalsUpdatable=!0)),this.isVerticesDataPresent(a.e.TangentKind)&&(s.tangents=this._toNumberArray(this.getVerticesData(a.e.TangentKind)),this.isVertexBufferUpdatable(a.e.TangentKind)&&(s.tangentsUpdatable=!0)),this.isVerticesDataPresent(a.e.UVKind)&&(s.es=this._toNumberArray(this.getVerticesData(a.e.UVKind)),this.isVertexBufferUpdatable(a.e.UVKind)&&(s.uvsUpdatable=!0)),this.isVerticesDataPresent(a.e.UV2Kind)&&(s.uvs2=this._toNumberArray(this.getVerticesData(a.e.UV2Kind)),this.isVertexBufferUpdatable(a.e.UV2Kind)&&(s.uvs2Updatable=!0)),this.isVerticesDataPresent(a.e.UV3Kind)&&(s.uvs3=this._toNumberArray(this.getVerticesData(a.e.UV3Kind)),this.isVertexBufferUpdatable(a.e.UV3Kind)&&(s.uvs3Updatable=!0)),this.isVerticesDataPresent(a.e.UV4Kind)&&(s.uvs4=this._toNumberArray(this.getVerticesData(a.e.UV4Kind)),this.isVertexBufferUpdatable(a.e.UV4Kind)&&(s.uvs4Updatable=!0)),this.isVerticesDataPresent(a.e.UV5Kind)&&(s.uvs5=this._toNumberArray(this.getVerticesData(a.e.UV5Kind)),this.isVertexBufferUpdatable(a.e.UV5Kind)&&(s.uvs5Updatable=!0)),this.isVerticesDataPresent(a.e.UV6Kind)&&(s.uvs6=this._toNumberArray(this.getVerticesData(a.e.UV6Kind)),this.isVertexBufferUpdatable(a.e.UV6Kind)&&(s.uvs6Updatable=!0)),this.isVerticesDataPresent(a.e.ColorKind)&&(s.Rs=this._toNumberArray(this.getVerticesData(a.e.ColorKind)),this.isVertexBufferUpdatable(a.e.ColorKind)&&(s.colorsUpdatable=!0)),this.isVerticesDataPresent(a.e.MatricesIndicesKind)&&(s.matricesIndices=this._toNumberArray(this.getVerticesData(a.e.MatricesIndicesKind)),s.matricesIndicesExpanded=!0,this.isVertexBufferUpdatable(a.e.MatricesIndicesKind)&&(s.matricesIndicesUpdatable=!0)),this.isVerticesDataPresent(a.e.MatricesWeightsKind)&&(s.matricesWeights=this._toNumberArray(this.getVerticesData(a.e.MatricesWeightsKind)),this.isVertexBufferUpdatable(a.e.MatricesWeightsKind)&&(s.matricesWeightsUpdatable=!0)),s.indices=this._toNumberArray(this.ra()),s}static ExtractFromMesh(s,Z){const o=s._geometry;return o?o.i(Z):null}static RandomId(){return B.g.RandomId()}static _GetGeometryByLoadedUniqueId(s,Z){for(let o=0;o<Z.geometries.length;o++)if(Z.geometries[o]._loadedUniqueId===s)return Z.geometries[o];return null}static _ImportGeometry(s,Z){const o=Z.Ls(),t=s.geometryUniqueId,S=s.geometryId;if(t||S){const s=t?this._GetGeometryByLoadedUniqueId(t,o):o.getGeometryById(S);s&&s.ws(Z)}else if(s instanceof ArrayBuffer){const o=Z._binaryInfo;if(o.positionsAttrDesc&&o.positionsAttrDesc.count>0){const t=new Float32Array(s,o.positionsAttrDesc.offset,o.positionsAttrDesc.count);Z.hs(a.e.PositionKind,t,!1)}if(o.normalsAttrDesc&&o.normalsAttrDesc.count>0){const t=new Float32Array(s,o.normalsAttrDesc.offset,o.normalsAttrDesc.count);Z.hs(a.e.NormalKind,t,!1)}if(o.tangetsAttrDesc&&o.tangetsAttrDesc.count>0){const t=new Float32Array(s,o.tangetsAttrDesc.offset,o.tangetsAttrDesc.count);Z.hs(a.e.TangentKind,t,!1)}if(o.uvsAttrDesc&&o.uvsAttrDesc.count>0){const t=new Float32Array(s,o.uvsAttrDesc.offset,o.uvsAttrDesc.count);if(Y.b)for(let s=1;s<t.length;s+=2)t[s]=1-t[s];Z.hs(a.e.UVKind,t,!1)}if(o.uvs2AttrDesc&&o.uvs2AttrDesc.count>0){const t=new Float32Array(s,o.uvs2AttrDesc.offset,o.uvs2AttrDesc.count);if(Y.b)for(let s=1;s<t.length;s+=2)t[s]=1-t[s];Z.hs(a.e.UV2Kind,t,!1)}if(o.uvs3AttrDesc&&o.uvs3AttrDesc.count>0){const t=new Float32Array(s,o.uvs3AttrDesc.offset,o.uvs3AttrDesc.count);if(Y.b)for(let s=1;s<t.length;s+=2)t[s]=1-t[s];Z.hs(a.e.UV3Kind,t,!1)}if(o.uvs4AttrDesc&&o.uvs4AttrDesc.count>0){const t=new Float32Array(s,o.uvs4AttrDesc.offset,o.uvs4AttrDesc.count);if(Y.b)for(let s=1;s<t.length;s+=2)t[s]=1-t[s];Z.hs(a.e.UV4Kind,t,!1)}if(o.uvs5AttrDesc&&o.uvs5AttrDesc.count>0){const t=new Float32Array(s,o.uvs5AttrDesc.offset,o.uvs5AttrDesc.count);if(Y.b)for(let s=1;s<t.length;s+=2)t[s]=1-t[s];Z.hs(a.e.UV5Kind,t,!1)}if(o.uvs6AttrDesc&&o.uvs6AttrDesc.count>0){const t=new Float32Array(s,o.uvs6AttrDesc.offset,o.uvs6AttrDesc.count);if(Y.b)for(let s=1;s<t.length;s+=2)t[s]=1-t[s];Z.hs(a.e.UV6Kind,t,!1)}if(o.colorsAttrDesc&&o.colorsAttrDesc.count>0){const t=new Float32Array(s,o.colorsAttrDesc.offset,o.colorsAttrDesc.count);Z.hs(a.e.ColorKind,t,!1,o.colorsAttrDesc.stride)}if(o.matricesIndicesAttrDesc&&o.matricesIndicesAttrDesc.count>0){const t=new Int32Array(s,o.matricesIndicesAttrDesc.offset,o.matricesIndicesAttrDesc.count),j=[];for(let s=0;s<t.length;s++){const Z=t[s];j.push(255&Z),j.push((65280&Z)>>8),j.push((16711680&Z)>>16),j.push(Z>>24&255)}Z.hs(a.e.MatricesIndicesKind,j,!1)}if(o.matricesIndicesExtraAttrDesc&&o.matricesIndicesExtraAttrDesc.count>0){const t=new Int32Array(s,o.matricesIndicesExtraAttrDesc.offset,o.matricesIndicesExtraAttrDesc.count),j=[];for(let s=0;s<t.length;s++){const Z=t[s];j.push(255&Z),j.push((65280&Z)>>8),j.push((16711680&Z)>>16),j.push(Z>>24&255)}Z.hs(a.e.MatricesIndicesExtraKind,j,!1)}if(o.matricesWeightsAttrDesc&&o.matricesWeightsAttrDesc.count>0){const t=new Float32Array(s,o.matricesWeightsAttrDesc.offset,o.matricesWeightsAttrDesc.count);Z.hs(a.e.MatricesWeightsKind,t,!1)}if(o.indicesAttrDesc&&o.indicesAttrDesc.count>0){const t=new Int32Array(s,o.indicesAttrDesc.offset,o.indicesAttrDesc.count);Z.setIndices(t,null)}if(o.subMeshesAttrDesc&&o.subMeshesAttrDesc.count>0){const t=new Int32Array(s,o.subMeshesAttrDesc.offset,5*o.subMeshesAttrDesc.count);Z.vO=[];for(let s=0;s<o.subMeshesAttrDesc.count;s++){const o=t[5*s+0],j=t[5*s+1],S=t[5*s+2],a=t[5*s+3],v=t[5*s+4];O.b.AddToMesh(o,j,S,a,v,Z)}}}else if(s.gs&&s.ls&&s.indices){if(Z.hs(a.e.PositionKind,s.gs,s.gs._updatable||s.positionsUpdatable),Z.hs(a.e.NormalKind,s.ls,s.ls._updatable||s.normalsUpdatable),s.tangents&&Z.hs(a.e.TangentKind,s.tangents,s.tangents._updatable||s.tangentsUpdatable),s.es&&Z.hs(a.e.UVKind,s.es,s.es._updatable||s.uvsUpdatable),s.uvs2&&Z.hs(a.e.UV2Kind,s.uvs2,s.uvs2._updatable||s.uvs2Updatable),s.uvs3&&Z.hs(a.e.UV3Kind,s.uvs3,s.uvs3._updatable||s.uvs3Updatable),s.uvs4&&Z.hs(a.e.UV4Kind,s.uvs4,s.uvs4._updatable||s.uvs4Updatable),s.uvs5&&Z.hs(a.e.UV5Kind,s.uvs5,s.uvs5._updatable||s.uvs5Updatable),s.uvs6&&Z.hs(a.e.UV6Kind,s.uvs6,s.uvs6._updatable||s.uvs6Updatable),s.Rs&&Z.hs(a.e.ColorKind,j.h.CheckColors4(s.Rs,s.gs.length/3),s.Rs._updatable),s.matricesIndices)if(s.matricesIndices._isExpanded||s.matricesIndicesExpanded)delete s.matricesIndices._isExpanded,delete s.matricesIndicesExpanded,Z.hs(a.e.MatricesIndicesKind,s.matricesIndices,s.matricesIndices._updatable||s.matricesIndicesUpdatable);else{const o=[];for(let Z=0;Z<s.matricesIndices.length;Z++){const t=s.matricesIndices[Z];o.push(255&t),o.push((65280&t)>>8),o.push((16711680&t)>>16),o.push(t>>24&255)}Z.hs(a.e.MatricesIndicesKind,o,s.matricesIndices._updatable||s.matricesIndicesUpdatable)}if(s.matricesIndicesExtra)if(s.matricesIndicesExtraExpanded||s.matricesIndicesExtra._isExpanded)delete s.matricesIndices._isExpanded,delete s.matricesIndicesExtraExpanded,Z.hs(a.e.MatricesIndicesExtraKind,s.matricesIndicesExtra,s.matricesIndicesExtra._updatable||s.matricesIndicesExtraUpdatable);else{const o=[];for(let Z=0;Z<s.matricesIndicesExtra.length;Z++){const t=s.matricesIndicesExtra[Z];o.push(255&t),o.push((65280&t)>>8),o.push((16711680&t)>>16),o.push(t>>24&255)}Z.hs(a.e.MatricesIndicesExtraKind,o,s.matricesIndicesExtra._updatable||s.matricesIndicesExtraUpdatable)}s.matricesWeights&&(f._CleanMatricesWeights(s,Z),Z.hs(a.e.MatricesWeightsKind,s.matricesWeights,s.matricesWeights._updatable)),s.matricesWeightsExtra&&Z.hs(a.e.MatricesWeightsExtraKind,s.matricesWeightsExtra,s.matricesWeights._updatable),Z.setIndices(s.indices,null)}if(s.vO){Z.vO=[];for(let o=0;o<s.vO.length;o++){const t=s.vO[o];O.b.AddToMesh(t.materialIndex,t.verticesStart,t.verticesCount,t.indexStart,t.indexCount,Z)}}Z._shouldGenerateFlatShading&&(Z.convertToFlatShadedMesh(),Z._shouldGenerateFlatShading=!1),Z.Ea(!0),o.onMeshImportedObservable.notifyObservers(Z)}static _CleanMatricesWeights(s,Z){const o=.001;if(!v.b.CleanBoneMatrixWeights)return;let t=0;if(!(s.skeletonId>-1))return;{const o=Z.Ls().getLastSkeletonById(s.skeletonId);if(!o)return;t=o.bones.length}const j=Z.getVerticesData(a.e.MatricesIndicesKind),S=Z.getVerticesData(a.e.MatricesIndicesExtraKind),O=s.matricesWeights,G=s.matricesWeightsExtra,B=s.numBoneInfluencer,Q=O.length;for(let a=0;a<Q;a+=4){let s=0,Z=-1;for(let t=0;t<4;t++){const j=O[a+t];s+=j,j<o&&Z<0&&(Z=t)}if(G)for(let t=0;t<4;t++){const j=G[a+t];s+=j,j<o&&Z<0&&(Z=t+4)}if((Z<0||Z>B-1)&&(Z=B-1),s>o){const Z=1/s;for(let s=0;s<4;s++)O[a+s]*=Z;if(G)for(let s=0;s<4;s++)G[a+s]*=Z}else Z>=4?(G[a+Z-4]=1-s,S[a+Z-4]=t):(O[a+Z]=1-s,j[a+Z]=t)}Z.hs(a.e.MatricesIndicesKind,j),s.matricesWeightsExtra&&Z.hs(a.e.MatricesIndicesExtraKind,S)}static Parse(s,Z,o){const j=new f(s.id,Z,void 0,s.updatable);return j._loadedUniqueId=s.uniqueId,Q.b&&Q.b.AddTagsTo(j,s.tags),s.delayLoadingFile?(j.delayLoadState=4,j.delayLoadingFile=o+s.delayLoadingFile,j._boundingInfo=new G.e(t.n.oO(s.boundingBoxMinimum),t.n.oO(s.boundingBoxMaximum)),j._delayInfo=[],s.hasUVs&&j._delayInfo.push(a.e.UVKind),s.hasUVs2&&j._delayInfo.push(a.e.UV2Kind),s.hasUVs3&&j._delayInfo.push(a.e.UV3Kind),s.hasUVs4&&j._delayInfo.push(a.e.UV4Kind),s.hasUVs5&&j._delayInfo.push(a.e.UV5Kind),s.hasUVs6&&j._delayInfo.push(a.e.UV6Kind),s.hasColors&&j._delayInfo.push(a.e.ColorKind),s.hasMatricesIndices&&j._delayInfo.push(a.e.MatricesIndicesKind),s.hasMatricesWeights&&j._delayInfo.push(a.e.MatricesWeightsKind),j._delayLoadingFunction=S.d.ImportVertexData):S.d.ImportVertexData(s,j),Z.pushGeometry(j,!0),j}}},11236:(s,Z,o)=>{o.d(Z,{e:()=>D});var t=o(10900),j=o(10955),S=o(11206),a=o(11240),O=o(10964),v=o(11197),G=o(11113),B=o(10938),Q=o(10916);a.d._instancedMeshFactory=(s,Z)=>{const o=new D(s,Z);if(Z.instancedBuffers){o.instancedBuffers={};for(const s in Z.instancedBuffers)o.instancedBuffers[s]=Z.instancedBuffers[s]}return o};class D extends S.b{constructor(s,Z){super(s,Z.Ls()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,Z.CQ(this),this._sourceMesh=Z,this._unIndexed=Z._unIndexed,this.position.O(Z.position),this.rotation.O(Z.rotation),this.ZO.O(Z.ZO),Z.rotationQuaternion&&(this.rotationQuaternion=Z.rotationQuaternion.clone()),this.animations=Z.animations.slice();for(const o of Z.getAnimationRanges())null!=o&&this.createAnimationRange(o.name,o.from,o.to);if(this.infiniteDistance=Z.infiniteDistance,this.setPivotMatrix(Z.getPivotMatrix()),Z.skeleton||Z.morphTargetManager||!Z.hasBoundingInfo)this.refreshBoundingInfo(!0,!0);else{const s=Z.getBoundingInfo();this.buildBoundingInfo(s.minimum,s.maximum)}this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(s){var Z;(null===(Z=this._sourceMesh)||void 0===Z?void 0:Z.receiveShadows)!==s&&B.g.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(s){var Z;(null===(Z=this._sourceMesh)||void 0===Z?void 0:Z.material)!==s&&B.g.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(s){var Z;(null===(Z=this._sourceMesh)||void 0===Z?void 0:Z.visibility)!==s&&B.g.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(s){var Z;(null===(Z=this._sourceMesh)||void 0===Z?void 0:Z.skeleton)!==s&&B.g.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(s){this._sourceMesh&&s!==this._sourceMesh.renderingGroupId&&j.b.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}get Pa(){return this._sourceMesh._geometry}createInstance(s){return this._sourceMesh.createInstance(s)}isReady(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(s,!0)}getVerticesData(s,Z,o){return this._sourceMesh.getVerticesData(s,Z,o)}copyVerticesData(s,Z){this._sourceMesh.copyVerticesData(s,Z)}hs(s,Z,o,t){return this.sourceMesh&&this.sourceMesh.hs(s,Z,o,t),this.sourceMesh}updateVerticesData(s,Z,o,t){return this.sourceMesh&&this.sourceMesh.updateVerticesData(s,Z,o,t),this.sourceMesh}setIndices(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(s,Z),this.sourceMesh}isVerticesDataPresent(s){return this._sourceMesh.isVerticesDataPresent(s)}ra(){return this._sourceMesh.ra()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let s,Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;s="object"===typeof Z?Z:{applySkeleton:Z,applyMorph:o};const t=this._sourceMesh.Pa?this._sourceMesh.Pa.boundingBias:null;return this.qs(this._sourceMesh._getData(s,null,G.e.PositionKind),t),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(s,Z){if(super._activate(s,Z),this._sourceMesh.vO||j.b.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,s),Z){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD!==this._sourceMesh&&this._currentLOD.billboardMode!==v.c.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new t.b);const s=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,t.g.sO[7].O(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.O(this._currentLOD.Ea(!0)),this._currentLOD.position.O(t.g.sO[7]),this._currentLOD._masterMesh=s,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(s){if(!s)return this;const Z=this.sourceMesh.getLODLevels();if(Z&&0!==Z.length){const Z=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(s,Z.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(s){return this.sourceMesh._preActivateForIntermediateRendering(s)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.vO)for(let s=0;s<this._sourceMesh.vO.length;s++)this._sourceMesh.vO[s].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Ws(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2?arguments[2]:void 0;const t=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).createInstance(s);if(O.c.DeepCopy(this,t,["name","vO","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","VQ","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo","Pa"],[]),this.refreshBoundingInfo(),Z&&(t.parent=Z),!o)for(let j=0;j<this.Ls().meshes.length;j++){const s=this.Ls().meshes[j];s.parent===this&&s.clone(s.name,t)}return t.Ea(!0),this.onClonedObservable.notifyObservers(t),t}dispose(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.IQ(this),super.dispose(s,Z)}_serializeAsParent(s){super._serializeAsParent(s),s.parentId=this._sourceMesh.uniqueId,s.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,Z=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;const t=this.clone("Clone of "+(this.name||this.id),s||this.parent,!0,Z&&Z.newSourcedMesh);t&&o&&o(this,t);for(const j of this.getChildTransformNodes(!0))j.instantiateHierarchy(t,Z,o);return t}}a.d.prototype.registerInstancedBuffer=function(s,Z){var o,t;if(null===(o=this._userInstancedBuffersStorage)||void 0===o||null===(t=o.vertexBuffers[s])||void 0===t||t.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const s of this.instances)s.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[s]=null,this._userInstancedBuffersStorage.strides[s]=Z,this._userInstancedBuffersStorage.sizes[s]=32*Z,this._userInstancedBuffersStorage.data[s]=new Float32Array(this._userInstancedBuffersStorage.sizes[s]),this._userInstancedBuffersStorage.vertexBuffers[s]=new G.e(this.getEngine(),this._userInstancedBuffersStorage.data[s],s,!0,!1,Z,!0);for(const j of this.instances)j.instancedBuffers[s]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},a.d.prototype._processInstancedBuffers=function(s,Z){const o=s?s.length:0;for(const t in this.instancedBuffers){let j=this._userInstancedBuffersStorage.sizes[t];const S=this._userInstancedBuffersStorage.strides[t],a=(o+1)*S;for(;j<a;)j*=2;this._userInstancedBuffersStorage.data[t].length!=j&&(this._userInstancedBuffersStorage.data[t]=new Float32Array(j),this._userInstancedBuffersStorage.sizes[t]=j,this._userInstancedBuffersStorage.vertexBuffers[t]&&(this._userInstancedBuffersStorage.vertexBuffers[t].dispose(),this._userInstancedBuffersStorage.vertexBuffers[t]=null));const O=this._userInstancedBuffersStorage.data[t];let v=0;if(Z){const s=this.instancedBuffers[t];s.toArray?s.toArray(O,v):s.copyToArray?s.copyToArray(O,v):O[v]=s,v+=S}for(let Z=0;Z<o;Z++){const o=s[Z].instancedBuffers[t];o.toArray?o.toArray(O,v):o.copyToArray?o.copyToArray(O,v):O[v]=o,v+=S}this._userInstancedBuffersStorage.vertexBuffers[t]?this._userInstancedBuffersStorage.vertexBuffers[t].updateDirectly(O,0):(this._userInstancedBuffersStorage.vertexBuffers[t]=new G.e(this.getEngine(),this._userInstancedBuffersStorage.data[t],t,!0,!1,S,!0),this._invalidateInstanceVertexArrayObject())}},a.d.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const s in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[s]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},a.d.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const s in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[s]&&this._userInstancedBuffersStorage.vertexBuffers[s].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,Q.f)("BABYLON.InstancedMesh",D)},11635:(s,Z,o)=>{o.d(Z,{d:()=>G});var t=o(11174),j=o(11113),S=o(11240),a=o(11236),O=o(11081),v=o(11642);S.d._LinesMeshParser=(s,Z)=>G.Parse(s,Z);class G extends S.d{_isShaderMaterial(s){return"ShaderMaterial"===s.getClassName()}constructor(s){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,S=arguments.length>5?arguments[5]:void 0,a=arguments.length>6?arguments[6]:void 0,O=arguments.length>7?arguments[7]:void 0;super(s,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Z,arguments.length>4?arguments[4]:void 0),this.useVertexColor=S,this.useVertexAlpha=a,this.color=new t.d(1,1,1),this.alpha=1,this._shaderLanguage=0,Z&&(this.color=Z.color.clone(),this.alpha=Z.alpha,this.useVertexColor=Z.useVertexColor,this.useVertexAlpha=Z.useVertexAlpha),this.intersectionThreshold=.1;const B={attributes:[j.e.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(this.useVertexAlpha?B.defines.push("#define VERTEXALPHA"):B.needAlphaBlending=!1,this.useVertexColor?(B.defines.push("#define VERTEXCOLOR"),B.attributes.push(j.e.ColorKind)):(B.uniforms.push("color"),this._color4=new t.h),O)this.material=O;else{this.Ls().getEngine().isWebGPU&&!G.ForceGLSL&&(this._shaderLanguage=1),B.shaderLanguage=this._shaderLanguage,B.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([o.e(23).then(o.bind(o,14160)),o.e(19).then(o.bind(o,14165))]):await Promise.all([o.e(17).then(o.bind(o,14168)),o.e(16).then(o.bind(o,14174))])},this.material=new v.e("colorShader",this.Ls(),"color",B,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(s){this._lineMaterial=s,this._lineMaterial.fillMode=O.c.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(s){}_bind(s,Z){if(!this._geometry)return this;const o=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(Z,o):this._geometry._bind(Z,o,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:s,g:Z,b:o}=this.color;this._color4.set(s,Z,o,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(s,Z,o){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const t=this.Ls().getEngine();return this._unIndexed?t.drawArraysType(O.c.LineListDrawMode,s.verticesStart,s.verticesCount,o):t.drawElementsType(O.c.LineListDrawMode,s.indexStart,s.indexCount,o),this}dispose(s){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(s)}clone(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2?arguments[2]:void 0;if(Z&&void 0===Z._addToSceneRootNodes){const o=Z;return o.source=this,new G(s,this.Ls(),o.parent,o.source,o.doNotCloneChildren)}return new G(s,this.Ls(),Z,this,o)}createInstance(s){const Z=new B(s,this);if(this.instancedBuffers){Z.instancedBuffers={};for(const s in this.instancedBuffers)Z.instancedBuffers[s]=this.instancedBuffers[s]}return Z}serialize(s){super.serialize(s),s.color=this.color.ma(),s.alpha=this.alpha}static Parse(s,Z){const o=new G(s.name,Z);return o.color=t.d.oO(s.color),o.alpha=s.alpha,o}}G.ForceGLSL=!1;class B extends a.e{constructor(s,Z){super(s,Z),this.intersectionThreshold=Z.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}},11240:(s,Z,o)=>{o.d(Z,{d:()=>w,f:()=>V});var t=o(10932),j=o(10938),S=o(10964),a=o(11172),O=o(11219),v=o(11246),G=o(10900),B=o(11174),Q=o(11201),D=o(11113),z=o(11214),Y=o(11273),b=o(11206),f=o(11108),A=o(11081),d=o(11295),U=o(11282),u=o(11167),H=o(10955),F=o(10916),i=o(10975),N=o(11297);class L{constructor(s,Z){this.distanceOrScreenCoverage=s,this.mesh=Z}}class V{}class g{constructor(){this.visibleInstances={},this.batchCache=new l,this.batchCacheReplacementModeInFrozenMode=new l,this.instancesBufferSize=2048}}class l{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class R{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class e{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}const c={source:null,parent:null,doNotCloneChildren:!1,clonePhysicsImpostor:!0,cloneThinInstances:!1};class w extends b.b{static _GetDefaultSideOrientation(s){return s||w.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(s){this._internalMeshDataInfo._useLODScreenCoverage=s,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(s){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==s&&(s&&this._internalMeshDataInfo._sourcePositions&&(this.hs(D.e.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.hs(D.e.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=s,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new t.b),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new t.b),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new t.b),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new t.b),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new t.b),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(s){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(s)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(s){this._internalMeshDataInfo._forcedInstanceCount=s}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(s){this._internalMeshDataInfo._sideOrientation=s,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===s||!this._scene.useRightHandedSystem&&0===s}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(s){this.sideOrientation=s,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(s){this._internalMeshDataInfo._overrideRenderingFillMode=s}get material(){return this._internalAbstractMeshDataInfo._material}set material(s){s&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(s.sideOrientation=null),this._setMaterial(s)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(s){this._unIndexed!==s&&(this._unIndexed=s,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(s){this._instanceDataStorage.manualUpdate=s}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(s){this._instanceDataStorage.previousManualUpdate=s}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(s){this._instanceDataStorage.forceMatrixUpdates=s}_copySource(s,Z){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],t=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const j=this.Ls();if(s._geometry&&s._geometry.ws(this),S.c.DeepCopy(s,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","Pa","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","VQ","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=s,j.useClonedMeshMap&&(s._internalMeshDataInfo.meshMap||(s._internalMeshDataInfo.meshMap={}),s._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=s._originalBuilderSideOrientation,this._creationDataStorage=s._creationDataStorage,s._ranges){const Z=s._ranges;for(const s in Z)Object.prototype.hasOwnProperty.call(Z,s)&&Z[s]&&this.createAnimationRange(s,Z[s].from,Z[s].to)}if(s.metadata&&s.metadata.clone?this.metadata=s.metadata.clone():this.metadata=s.metadata,this._internalMetadata=s._internalMetadata,a.b&&a.b.HasTags(s)&&a.b.AddTagsTo(this,a.b.GetTags(s,!0)),this.iO(s.isEnabled(!1)),this.parent=s.parent,this.setPivotMatrix(s.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+s.id,this.material=s.material,!Z){const j=s.getDescendants(!0);for(let s=0;s<j.length;s++){const S=j[s];S._isMesh?(c.parent=this,c.doNotCloneChildren=Z,c.clonePhysicsImpostor=o,c.cloneThinInstances=t,S.clone(this.name+"."+S.name,c)):S.clone&&S.clone(this.name+"."+S.name,this)}}if(s.morphTargetManager&&(this.morphTargetManager=s.morphTargetManager),j.getPhysicsEngine){const Z=j.getPhysicsEngine();if(o&&Z)if(1===Z.getPluginVersion()){const o=Z.getImpostorForPhysicsObject(s);o&&(this.physicsImpostor=o.clone(this))}else 2===Z.getPluginVersion()&&s.physicsBody&&s.physicsBody.clone(this)}for(let S=0;S<j.gQ.length;S++){const Z=j.gQ[S];Z.k===s&&Z.clone(Z.name,this)}if(this.skeleton=s.skeleton,t&&(s._thinInstanceDataStorage.matrixData?(this.pB("matrix",new Float32Array(s._thinInstanceDataStorage.matrixData),16,!s._thinInstanceDataStorage.matrixBuffer.isUpdatable()),this._thinInstanceDataStorage.matrixBufferSize=s._thinInstanceDataStorage.matrixBufferSize,this._thinInstanceDataStorage.instancesCount=s._thinInstanceDataStorage.instancesCount):this._thinInstanceDataStorage.matrixBufferSize=s._thinInstanceDataStorage.matrixBufferSize,s._userThinInstanceBuffersStorage)){const Z=s._userThinInstanceBuffersStorage;for(const s in Z.data){var O,v;this.pB(s,new Float32Array(Z.data[s]),Z.strides[s],!(null!==(O=Z.vertexBuffers)&&void 0!==O&&null!==(v=O[s])&&void 0!==v&&v.isUpdatable())),this._userThinInstanceBuffersStorage.sizes[s]=Z.sizes[s]}}this.refreshBoundingInfo(!0,!0),this.Ea(!0)}constructor(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,S=arguments.length>4?arguments[4]:void 0,a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(s,Z),this._internalMeshDataInfo=new e,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new g,this._thinInstanceDataStorage=new R,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=w.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,Z=this.Ls(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(s,Z,o)=>{s&&o&&(this._uniformBuffer?this.transferToEffect(Z):o.bindOnlyWorldMatrix(Z))};let O=null,v=!1;if(o&&void 0===o._addToSceneRootNodes){const s=o;O=s.parent??null,j=s.source??null,S=s.doNotCloneChildren??!1,a=s.clonePhysicsImpostor??!0,v=s.cloneThinInstances??!1}else O=o;j&&this._copySource(j,S,a,v),null!==O&&(this.parent=O),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=s=>{s.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new t.b(this._internalMeshDataInfo._onMeshReadyObserverAdded),j&&j.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,Z=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;const t=0===this.getTotalVertices()||Z&&Z.doNotInstantiate&&(!0===Z.doNotInstantiate||Z.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),s||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));t.parent=s||this.parent,t.position=this.position.clone(),t.ZO=this.ZO.clone(),this.rotationQuaternion?t.rotationQuaternion=this.rotationQuaternion.clone():t.rotation=this.rotation.clone(),o&&o(this,t);for(const j of this.getChildTransformNodes(!0))"InstancedMesh"===j.getClassName()&&"Mesh"===t.getClassName()&&j.sourceMesh===this?j.instantiateHierarchy(t,{doNotInstantiate:Z&&Z.doNotInstantiate||!1,newSourcedMesh:t},o):j.instantiateHierarchy(t,Z,o);return t}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(s){let Z=super.toString(s);if(Z+=", n vertices: "+this.getTotalVertices(),Z+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let o=0;o<this.animations.length;o++)Z+=", animation[0]: "+this.animations[o].toString(s);if(s)if(this._geometry){const s=this.ra(),o=this.getVerticesData(D.e.PositionKind);o&&s&&(Z+=", flat shading: "+(o.length/3===s.length?"YES":"NO"))}else Z+=", flat shading: UNKNOWN";return Z}_unBindEffect(){super._unBindEffect();for(const s of this.instances)s._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const s=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((Z,o)=>Z.distanceOrScreenCoverage<o.distanceOrScreenCoverage?s:Z.distanceOrScreenCoverage>o.distanceOrScreenCoverage?-s:0))}addLODLevel(s,Z){if(Z&&Z._masterMesh)return H.b.Warn("You cannot use a mesh as LOD level twice"),this;const o=new L(s,Z);return this._internalMeshDataInfo._LODLevels.push(o),Z&&(Z._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(s){const Z=this._internalMeshDataInfo;for(let o=0;o<Z._LODLevels.length;o++){const t=Z._LODLevels[o];if(t.distanceOrScreenCoverage===s)return t.mesh}return null}removeLODLevel(s){const Z=this._internalMeshDataInfo;for(let o=0;o<Z._LODLevels.length;o++)Z._LODLevels[o].mesh===s&&(Z._LODLevels.splice(o,1),s&&(s._masterMesh=null));return this._sortLODLevels(),this}getLOD(s,Z){const o=this._internalMeshDataInfo;if(!o._LODLevels||0===o._LODLevels.length)return this;const t=Z||this.getBoundingInfo().boundingSphere,j=s.mode===v.e.ORTHOGRAPHIC_CAMERA?s.OO:t.centerWorld.Go(s.globalPosition).length();let S=j,a=1;if(o._useLODScreenCoverage){const Z=s.screenArea;let o=t.radiusWorld*s.OO/j;o=o*o*Math.PI,S=o/Z,a=-1}if(a*o._LODLevels[o._LODLevels.length-1].distanceOrScreenCoverage>a*S)return this.onLODLevelSelection&&this.onLODLevelSelection(S,this,this),this;for(let O=0;O<o._LODLevels.length;O++){const s=o._LODLevels[O];if(a*s.distanceOrScreenCoverage<a*S){if(s.mesh){if(4===s.mesh.delayLoadState)return s.mesh._checkDelayState(),this;if(2===s.mesh.delayLoadState)return this;s.mesh._preActivate(),s.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(S,this,s.mesh),s.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(S,this,this),this}get Pa(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(s,Z,o,t){var j,S;if(!this._geometry)return null;let a=t||null===(j=this._userInstancedBuffersStorage)||void 0===j||null===(S=j.vertexBuffers[s])||void 0===S?void 0:S.getFloatData(this.instances.length+1,o||Z&&1!==this._geometry.meshes.length);return a||(a=this._geometry.getVerticesData(s,Z,o)),a}copyVerticesData(s,Z){this._geometry&&this._geometry.copyVerticesData(s,Z)}getVertexBuffer(s,Z){var o;return this._geometry?(Z||null===(o=this._userInstancedBuffersStorage)||void 0===o?void 0:o.vertexBuffers[s])??this._geometry.getVertexBuffer(s):null}isVerticesDataPresent(s,Z){var o;return this._geometry?!Z&&void 0!==(null===(o=this._userInstancedBuffersStorage)||void 0===o?void 0:o.vertexBuffers[s])||this._geometry.isVerticesDataPresent(s):!!this._delayInfo&&-1!==this._delayInfo.indexOf(s)}isVertexBufferUpdatable(s,Z){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(s);if(!Z){var o;const Z=null===(o=this._userInstancedBuffersStorage)||void 0===o?void 0:o.vertexBuffers[s];if(Z)return Z.isUpdatable()}return this._geometry.isVertexBufferUpdatable(s)}getVerticesDataKinds(s){if(!this._geometry){const s=[];if(this._delayInfo)for(const Z of this._delayInfo)s.push(Z);return s}const Z=this._geometry.getVerticesDataKinds();if(!s&&this._userInstancedBuffersStorage)for(const o in this._userInstancedBuffersStorage.vertexBuffers)-1===Z.indexOf(o)&&Z.push(o);return Z}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}ra(s,Z){return this._geometry?this._geometry.ra(s,Z):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(s))return!1;if(!this.vO||0===this.vO.length)return!0;if(!s)return!0;const o=this.getEngine(),t=this.Ls(),j=Z||o.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.Ea();const S=this.material||t.defaultMaterial;if(S)if(S._storeEffectOnSubMeshes)for(const D of this.vO){const s=D.Ms();if(s)if(s._storeEffectOnSubMeshes){if(!s.isReadyForSubMesh(this,D,j))return!1}else if(!s.isReady(this,j))return!1}else if(!S.isReady(this,j))return!1;const a=o.currentRenderPassId;for(const D of this.lightSources){const s=D.getShadowGenerators();if(!s)continue;const Z=s.values();for(let t=Z.next();!0!==t.done;t=Z.next()){var O,v,G,B;const s=t.value;if(s&&(null===(O=s.getShadowMap())||void 0===O||!O.renderList||null!==(v=s.getShadowMap())&&void 0!==v&&v.renderList&&-1!==(null===(G=s.getShadowMap())||void 0===G||null===(B=G.renderList)||void 0===B?void 0:B.indexOf(this)))){const Z=s.getShadowMap().renderPassIds??[o.currentRenderPassId];for(let t=0;t<Z.length;++t){o.currentRenderPassId=Z[t];for(const Z of this.vO){var Q;if(!s.isReady(Z,j,(null===(Q=Z.Ms())||void 0===Q?void 0:Q.needAlphaBlendingForMesh(this))??!1))return o.currentRenderPassId=a,!1}}o.currentRenderPassId=a}}}for(const D of this._internalMeshDataInfo._LODLevels)if(D.mesh&&!D.mesh.isReady(j))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}ZB(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(s){this._instanceDataStorage.overridenInstanceCount=s}_preActivate(){const s=this._internalMeshDataInfo,Z=this.Ls().getRenderId();return s._preActivateId===Z||(s._preActivateId=Z,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(s){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=s),this}_registerInstanceForRenderId(s,Z){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:Z,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[Z]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=Z,this._instanceDataStorage.visibleInstances[Z]=new Array),this._instanceDataStorage.visibleInstances[Z].push(s),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.Xs||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let s,Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;s="object"===typeof Z?Z:{applySkeleton:Z,applyMorph:o};const t=this.Pa?this.Pa.boundingBias:null;return this.qs(this._getData(s,null,D.e.PositionKind),t),this}_createGlobalSubMesh(s){const Z=this.getTotalVertices();if(!Z||!this.ra())return null;if(this.vO&&this.vO.length>0){const o=this.ra();if(!o)return null;const t=o.length;let j=!1;if(s)j=!0;else for(const s of this.vO){if(s.indexStart+s.indexCount>t){j=!0;break}if(s.verticesStart+s.verticesCount>Z){j=!0;break}}if(!j)return this.vO[0]}return this.releaseSubMeshes(),new f.b(0,0,Z,0,this.getTotalIndices()||Z,this)}subdivide(s){if(s<1)return;const Z=this.getTotalIndices();let o=Z/s|0,t=0;for(;o%3!==0;)o++;this.releaseSubMeshes();for(let j=0;j<s&&!(t>=Z);j++)f.b.CreateFromIndices(0,t,j===s-1?Z-t:o,this,void 0,!1),t+=o;this.refreshBoundingInfo(),this.synchronizeInstances()}hs(s,Z){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.hs(s,Z,o,t);else{const t=new z.d;t.set(Z,s);const j=this.Ls();new Y.e(Y.e.RandomId(),j,t,o,this)}return this}removeVerticesData(s){this._geometry&&this._geometry.removeVerticesData(s)}markVerticesDataAsUpdatable(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const o=this.getVertexBuffer(s);o&&o.isUpdatable()!==Z&&this.hs(s,this.getVerticesData(s),Z)}setVerticesBuffer(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=Y.e.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(s,null,Z),this}updateVerticesData(s,Z,o,t){return this._geometry?(t?(this.makeGeometryUnique(),this.updateVerticesData(s,Z,o,!1)):this._geometry.updateVerticesData(s,Z,o),this):this}updateMeshPositions(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const o=this.getVerticesData(D.e.PositionKind);if(!o)return this;if(s(o),this.updateVerticesData(D.e.PositionKind,o,!1,!1),Z){const s=this.ra(),Z=this.getVerticesData(D.e.NormalKind);if(!Z)return this;z.d.ComputeNormals(o,s,Z),this.updateVerticesData(D.e.NormalKind,Z,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const s=this._geometry,Z=this._geometry.i(Y.e.RandomId());return s.releaseForMesh(this,!0),Z.ws(this),this}setIndexBuffer(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,j=this._geometry;j||(j=new Y.e(Y.e.RandomId(),this.Ls(),void 0,void 0,this)),j.setIndexBuffer(s,Z,o,t)}setIndices(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(s,Z,o,t);else{const Z=new z.d;Z.indices=s;const t=this.Ls();new Y.e(Y.e.RandomId(),t,Z,o,this)}return this}updateIndices(s,Z){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(s,Z,o),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(s,Z,o){let t=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const j=this.Ls().getEngine();let S;if(this._unIndexed)if(this._getRenderingFillMode(o)===A.c.WireFrameFillMode)S=s._getLinesIndexBuffer(this.ra(),j);else S=null;else switch(this._getRenderingFillMode(o)){case A.c.PointFillMode:S=null;break;case A.c.WireFrameFillMode:S=s._getLinesIndexBuffer(this.ra(),j);break;default:case A.c.TriangleFillMode:S=this._geometry.getIndexBuffer()}return this._bindDirect(Z,S,t)}_bindDirect(s,Z){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(s),o&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(s,Z,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(s,Z),this):this}_draw(s,Z,o){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const t=this.Ls().getEngine();return this._unIndexed&&Z!==A.c.WireFrameFillMode||Z==A.c.PointFillMode?t.drawArraysType(Z,s.verticesStart,s.verticesCount,this.forcedInstanceCount||o):Z==A.c.WireFrameFillMode?t.drawElementsType(Z,0,s._linesIndexCount,this.forcedInstanceCount||o):t.drawElementsType(Z,s.indexStart,s.indexCount,this.forcedInstanceCount||o),this}registerBeforeRender(s){return this.onBeforeRenderObservable.add(s),this}unregisterBeforeRender(s){return this.onBeforeRenderObservable.removeCallback(s),this}registerAfterRender(s){return this.onAfterRenderObservable.add(s),this}unregisterAfterRender(s){return this.onAfterRenderObservable.removeCallback(s),this}_getInstancesRenderList(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(Z)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[s]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[s]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const o=this.Ls(),t=o._isInIntermediateRendering(),j=t?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,S=this._instanceDataStorage.batchCache;if(S.mustReturn=!1,S.renderSelf[s]=Z||!j&&this.isEnabled()&&this.isVisible,S.visibleInstances[s]=null,this._instanceDataStorage.visibleInstances&&!Z){const Z=this._instanceDataStorage.visibleInstances,j=o.getRenderId(),a=t?Z.intermediateDefaultRenderId:Z.defaultRenderId;S.visibleInstances[s]=Z[j],!S.visibleInstances[s]&&a&&(S.visibleInstances[s]=Z[a])}return S.hardwareInstancedRendering[s]=!Z&&this._instanceDataStorage.hardwareInstancedRendering&&null!==S.visibleInstances[s]&&void 0!==S.visibleInstances[s],this._instanceDataStorage.previousBatch=S,S}_updateInstancedBuffers(s,Z,o,t,j,S){const a=Z.visibleInstances[s._id],O=a?a.length:0,v=this._instanceDataStorage;let B=v.instancesBuffer,Q=v.instancesPreviousBuffer,z=0,Y=0;const b=Z.renderSelf[s._id],f=!B||o!==v.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!v.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||v.isFrozen&&!f)Y=(b?1:0)+O;else{const Z=this.getWorldMatrix();if(b&&(this._scene.needsPreviousWorldMatrices&&(v.masterMeshPreviousWorldMatrix?(v.masterMeshPreviousWorldMatrix.copyToArray(v.instancesPreviousData,z),v.masterMeshPreviousWorldMatrix.O(Z)):(v.masterMeshPreviousWorldMatrix=Z.clone(),v.masterMeshPreviousWorldMatrix.copyToArray(v.instancesPreviousData,z))),Z.copyToArray(v.instancesData,z),z+=16,Y++),a){var A;if(w.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(A=s.Ms())&&void 0!==A&&A.needAlphaBlendingForMesh(s.getRenderingMesh())){const s=this._scene.activeCamera.globalPosition;for(let Z=0;Z<a.length;Z++){const o=a[Z];o._distanceToCamera=G.n.Distance(o.getBoundingInfo().boundingSphere.centerWorld,s)}a.sort(((s,Z)=>s._distanceToCamera>Z._distanceToCamera?-1:s._distanceToCamera<Z._distanceToCamera?1:0))}for(let s=0;s<a.length;s++){const Z=a[s],o=Z.getWorldMatrix();o.copyToArray(v.instancesData,z),this._scene.needsPreviousWorldMatrices&&(Z._previousWorldMatrix?(Z._previousWorldMatrix.copyToArray(v.instancesPreviousData,z),Z._previousWorldMatrix.O(o)):(Z._previousWorldMatrix=o.clone(),Z._previousWorldMatrix.copyToArray(v.instancesPreviousData,z))),z+=16,Y++}}}f?(B&&B.dispose(),Q&&Q.dispose(),B=new D.c(t,v.instancesData,!0,16,!1,!0),v.instancesBuffer=B,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=B.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=B.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=B.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=B.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(Q=new D.c(t,v.instancesPreviousData,!0,16,!1,!0),v.instancesPreviousBuffer=Q,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=Q.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=Q.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=Q.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=Q.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(B.updateDirectly(v.instancesData,0,Y),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||Q.updateDirectly(v.instancesPreviousData,0,Y)),this._processInstancedBuffers(a,b),S&&void 0!==j&&(this.Ls()._activeIndices.addCount(s.indexCount*Y,!1),t._currentDrawContext&&(t._currentDrawContext.useInstancing=!0),this._bind(s,S,j),this._draw(s,j,Y)),!this._scene.needsPreviousWorldMatrices||f||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||Q.updateDirectly(v.instancesData,0,Y)}_renderWithInstances(s,Z,o,t,j){const S=o.visibleInstances[s._id],a=S?S.length:0,O=this._instanceDataStorage,v=O.instancesBufferSize,G=16*(a+1)*4;for(;O.instancesBufferSize<G;)O.instancesBufferSize*=2;return O.instancesData&&v==O.instancesBufferSize||(O.instancesData=new Float32Array(O.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!O.instancesPreviousData||v!=O.instancesBufferSize)&&(O.instancesPreviousData=new Float32Array(O.instancesBufferSize/4)),this._updateInstancedBuffers(s,o,v,j,Z,t),j.unbindInstanceAttributes(),this}_renderWithThinInstances(s,Z,o,t){var j;const S=(null===(j=this._thinInstanceDataStorage)||void 0===j?void 0:j.instancesCount)??0;this.Ls()._activeIndices.addCount(s.indexCount*S,!1),t._currentDrawContext&&(t._currentDrawContext.useInstancing=!0),this._bind(s,o,Z),this._draw(s,Z,S),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,S):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),t.unbindInstanceAttributes()}_processInstancedBuffers(s,Z){}_processRendering(s,Z,o,t,j,S,a,O){const v=this.Ls(),G=v.getEngine();if(t=this._getRenderingFillMode(t),S&&Z.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(Z,t,o,G),this;if(S)this._renderWithInstances(Z,t,j,o,G);else{G._currentDrawContext&&(G._currentDrawContext.useInstancing=!1);let o=0;j.renderSelf[Z._id]&&(a&&a(!1,s.getWorldMatrix(),O),o++,this._draw(Z,t,this._instanceDataStorage.overridenInstanceCount));const S=j.visibleInstances[Z._id];if(S){const s=S.length;o+=s;for(let o=0;o<s;o++){const s=S[o].getWorldMatrix();a&&a(!0,s,O),this._draw(Z,t)}}v._activeIndices.addCount(Z.indexCount*o,!1)}return this}_rebuild(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(s&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const Z in this._userInstancedBuffersStorage.vertexBuffers){const o=this._userInstancedBuffersStorage.vertexBuffers[Z];o&&(s&&o.dispose(),this._userInstancedBuffersStorage.vertexBuffers[Z]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(s)}_freeze(){if(this.vO){for(let s=0;s<this.vO.length;s++)this._getInstancesRenderList(s);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(s,Z,o,t){let j=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const S=this._scene.getEngine(),a=S.currentRenderPassId;if(void 0!==s&&(S.currentRenderPassId=s),t)(!j||j&&t.isInFrustum(this._scene._frustumPlanes))&&this.render(t,!!Z,o);else for(let O=0;O<this.vO.length;O++){const s=this.vO[O];(!j||j&&s.isInFrustum(this._scene._frustumPlanes))&&this.render(s,!!Z,o)}return void 0!==s&&(S.currentRenderPassId=a),this}directRender(){if(!this.vO)return this;for(const s of this.vO)this.render(s,!1);return this}render(s,Z,o){var t,j,S;const a=this.Ls();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const O=(null===(t=a.activeCameras)||void 0===t?void 0:t.length)??0;if((O>1&&a.activeCamera===a.activeCameras[0]||O<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const v=this._getInstancesRenderList(s._id,!!o);if(v.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const G=a.getEngine();let B=0,Q=null;this.ignoreCameraMaxZ&&a.activeCamera&&!a._isInIntermediateRendering()&&(B=a.activeCamera.maxZ,Q=a.activeCamera,a.activeCamera.maxZ=0,a.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const D=s.getRenderingMesh(),z=v.hardwareInstancedRendering[s._id]||D.hasThinInstances||!!this._userInstancedBuffersStorage&&!s.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,Y=this._instanceDataStorage,b=s.Ms();if(!b)return Q&&(Q.maxZ=B,a.updateTransformMatrix(!0)),this;if(Y.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===b){if(b._storeEffectOnSubMeshes&&(null===(j=s._drawWrapper)||void 0===j||!j._wasPreviouslyReady)||!b._storeEffectOnSubMeshes&&!b._getDrawWrapper()._wasPreviouslyReady)return Q&&(Q.maxZ=B,a.updateTransformMatrix(!0)),this}else{if(b._storeEffectOnSubMeshes){if(!b.isReadyForSubMesh(this,s,z))return Q&&(Q.maxZ=B,a.updateTransformMatrix(!0)),this}else if(!b.isReady(this,z))return Q&&(Q.maxZ=B,a.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=b}let f;Z&&G.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),f=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?s._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const d=(null===(S=f)||void 0===S?void 0:S.effect)??null;for(const A of a._beforeRenderingMeshStage)A.action(this,s,v,d);if(!f||!d)return Q&&(Q.maxZ=B,a.updateTransformMatrix(!0)),this;const U=o||this;let u;if(Y.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.Ta&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)u=Y.sideOrientation;else{const s=U._getWorldMatrixDeterminant();u=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),s<0&&(u=u===A.c.ClockWiseSideOrientation?A.c.CounterClockWiseSideOrientation:A.c.ClockWiseSideOrientation),Y.sideOrientation=u}const H=this._internalMeshDataInfo._effectiveMaterial._preBind(f,u);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&G.setDepthWrite(!0);const F=this._internalMeshDataInfo._effectiveMaterial,i=F.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),z||this._bind(s,d,i,!1);const N=U.getWorldMatrix();F._storeEffectOnSubMeshes?F.bindForSubMesh(N,this,s):F.bind(N,this),!F.Ta&&F.separateCullingPass&&(G.setState(!0,F.zOffset,!1,!H,F.cullBackFaces,F.stencil,F.zOffsetUnits),this._processRendering(this,s,d,i,v,z,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),G.setState(!0,F.zOffset,!1,H,F.cullBackFaces,F.stencil,F.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(s)),this._processRendering(this,s,d,i,v,z,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const A of a._afterRenderingMeshStage)A.action(this,s,v,d);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),Q&&(Q.maxZ=B,a.updateTransformMatrix(!0)),2!==a.performancePriority||Y.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(D.e.MatricesWeightsKind)&&(this.isVerticesDataPresent(D.e.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const s=this.getVerticesData(D.e.MatricesWeightsKind),Z=s.length;for(let o=0;o<Z;o+=4){const Z=s[o]+s[o+1]+s[o+2]+s[o+3];if(0===Z)s[o]=1;else{const t=1/Z;s[o]*=t,s[o+1]*=t,s[o+2]*=t,s[o+3]*=t}}this.hs(D.e.MatricesWeightsKind,s)}_normalizeSkinWeightsAndExtra(){const s=this.getVerticesData(D.e.MatricesWeightsExtraKind),Z=this.getVerticesData(D.e.MatricesWeightsKind),o=Z.length;for(let t=0;t<o;t+=4){let o=Z[t]+Z[t+1]+Z[t+2]+Z[t+3];if(o+=s[t]+s[t+1]+s[t+2]+s[t+3],0===o)Z[t]=1;else{const j=1/o;Z[t]*=j,Z[t+1]*=j,Z[t+2]*=j,Z[t+3]*=j,s[t]*=j,s[t+1]*=j,s[t+2]*=j,s[t+3]*=j}}this.hs(D.e.MatricesWeightsKind,Z),this.hs(D.e.MatricesWeightsKind,s)}validateSkinning(){const s=this.getVerticesData(D.e.MatricesWeightsExtraKind),Z=this.getVerticesData(D.e.MatricesWeightsKind);if(null===Z||null==this.skeleton)return{skinned:!1,valid:!0,iY:"not skinned"};const o=Z.length;let t=0,j=0,S=0,a=0;const O=null===s?4:8,v=[];for(let D=0;D<=O;D++)v[D]=0;for(let D=0;D<o;D+=4){let o=Z[D],G=o,B=0===G?0:1;for(let j=1;j<O;j++){const S=j<4?Z[D+j]:s[D+j-4];S>o&&t++,0!==S&&B++,G+=S,o=S}if(v[B]++,B>S&&(S=B),0===G)j++;else{const o=1/G;let t=0;for(let j=0;j<O;j++)t+=j<4?Math.abs(Z[D+j]-Z[D+j]*o):Math.abs(s[D+j-4]-s[D+j-4]*o);t>.001&&a++}}const G=this.skeleton.bones.length,B=this.getVerticesData(D.e.MatricesIndicesKind),Q=this.getVerticesData(D.e.MatricesIndicesExtraKind);let z=0;for(let D=0;D<o;D+=4)for(let s=0;s<O;s++){const Z=s<4?B[D+s]:Q[D+s-4];(Z>=G||Z<0)&&z++}return{skinned:!0,valid:0===j&&0===a&&0===z,iY:"Number of Weights = "+o/4+"\nMaximum influences = "+S+"\nMissing Weights = "+j+"\nNot Sorted = "+t+"\nNot Normalized = "+a+"\nWeightCounts = ["+v+"]\nNumber of bones = "+G+"\nBad Bone Indices = "+z}}_checkDelayState(){const s=this.Ls();return this._geometry?this._geometry.load(s):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(s)),this}_queueLoad(s){s.addPendingData(this);const Z=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return j.g.LoadFile(this.delayLoadingFile,(Z=>{Z instanceof ArrayBuffer?this._delayLoadingFunction(Z,this):this._delayLoadingFunction(JSON.parse(Z),this);for(const s of this.instances)s.refreshBoundingInfo(),s._syncSubMeshes();this.delayLoadState=1,s.removePendingData(this)}),(()=>{}),s.offlineProvider,Z),this}isInFrustum(s){return 2!==this.delayLoadState&&(!!super.isInFrustum(s)&&(this._checkDelayState(),!0))}setMaterialById(s){const Z=this.Ls().materials;let o;for(o=Z.length-1;o>-1;o--)if(Z[o].id===s)return this.material=Z[o],this;const t=this.Ls().multiMaterials;for(o=t.length-1;o>-1;o--)if(t[o].id===s)return this.material=t[o],this;return this}getAnimatables(){const s=[];return this.material&&s.push(this.material),this.skeleton&&s.push(this.skeleton),s}bakeTransformIntoVertices(s){if(!this.isVerticesDataPresent(D.e.PositionKind))return this;const Z=this.vO.splice(0);this._resetPointsArrayCache();let o=this.getVerticesData(D.e.PositionKind);const t=G.n.Zero();let j;for(j=0;j<o.length;j+=3)G.n.TransformCoordinatesFromFloatsToRef(o[j],o[j+1],o[j+2],s,t).toArray(o,j);if(this.hs(D.e.PositionKind,o,this.getVertexBuffer(D.e.PositionKind).isUpdatable()),this.isVerticesDataPresent(D.e.NormalKind)){for(o=this.getVerticesData(D.e.NormalKind),j=0;j<o.length;j+=3)G.n.TransformNormalFromFloatsToRef(o[j],o[j+1],o[j+2],s,t).normalize().toArray(o,j);this.hs(D.e.NormalKind,o,this.getVertexBuffer(D.e.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(D.e.TangentKind)){for(o=this.getVerticesData(D.e.TangentKind),j=0;j<o.length;j+=4)G.n.TransformNormalFromFloatsToRef(o[j],o[j+1],o[j+2],s,t).normalize().toArray(o,j);this.hs(D.e.TangentKind,o,this.getVertexBuffer(D.e.TangentKind).isUpdatable())}return s.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.vO=Z,this}bakeCurrentTransformIntoVertices(){let s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&this.makeGeometryUnique(),this.bakeTransformIntoVertices(this.Ea(!0)),this.resetLocalMatrix(s),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2?arguments[2]:void 0,t=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(Z&&void 0===Z._addToSceneRootNodes){const o=Z;return c.source=this,c.doNotCloneChildren=o.doNotCloneChildren,c.clonePhysicsImpostor=o.clonePhysicsImpostor,c.cloneThinInstances=o.cloneThinInstances,new w(s,this.Ls(),c)}return new w(s,this.Ls(),Z,this,o,t)}dispose(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const o=this._internalMeshDataInfo;if(o._onBeforeDrawObservable&&o._onBeforeDrawObservable.clear(),o._onBeforeBindObservable&&o._onBeforeBindObservable.clear(),o._onBeforeRenderObservable&&o._onBeforeRenderObservable.clear(),o._onAfterRenderObservable&&o._onAfterRenderObservable.clear(),o._onBetweenPassObservable&&o._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(o.meshMap)for(const s in o.meshMap){const Z=o.meshMap[s];Z&&(Z._internalMeshDataInfo._source=null,o.meshMap[s]=void 0)}o._source&&o._source._internalMeshDataInfo.meshMap&&(o._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const s=this.Ls().meshes;for(const Z of s){const s=Z;s._internalMeshDataInfo&&s._internalMeshDataInfo._source&&s._internalMeshDataInfo._source===this&&(s._internalMeshDataInfo._source=null)}}o._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(s,Z)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(s,Z,o,t,S,a){let O=arguments.length>6&&void 0!==arguments[6]&&arguments[6],v=arguments.length>7?arguments[7]:void 0;const G=this.Ls();return j.g.LoadImage(s,(s=>{const j=s.width,v=s.height,G=this.getEngine().createCanvas(j,v).getContext("2d");G.drawImage(s,0,0);const B=G.getImageData(0,0,j,v).data;this.applyDisplacementMapFromBuffer(B,j,v,Z,o,S,a,O),t&&t(this)}),v||(()=>{}),G.offlineProvider),this}applyDisplacementMapFromBuffer(s,Z,o,t,j,S,a){let O=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(D.e.PositionKind)||!this.isVerticesDataPresent(D.e.NormalKind)||!this.isVerticesDataPresent(D.e.UVKind))return H.b.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const v=this.getVerticesData(D.e.PositionKind,!0,!0),B=this.getVerticesData(D.e.NormalKind),Q=this.getVerticesData(D.e.UVKind);let Y=G.n.Zero();const b=G.n.Zero(),f=G.j.Zero();S=S||G.j.Zero(),a=a||new G.j(1,1);for(let D=0;D<v.length;D+=3){G.n.FromArrayToRef(v,D,Y),G.n.FromArrayToRef(B,D,b),G.j.FromArrayToRef(Q,D/3*2,f);const O=4*((Math.abs(f.x*a.x+S.x%1)*(Z-1)%Z|0)+(Math.abs(f.y*a.y+S.y%1)*(o-1)%o|0)*Z),z=.3*(s[O]/255)+.59*(s[O+1]/255)+.11*(s[O+2]/255);b.normalize(),b.scaleInPlace(t+(j-t)*z),Y=Y.add(b),Y.toArray(v,D)}return z.d.ComputeNormals(v,this.ra(),B),O?(this.hs(D.e.PositionKind,v),this.hs(D.e.NormalKind,B),this.hs(D.e.UVKind,Q)):(this.updateVerticesData(D.e.PositionKind,v),this.updateVerticesData(D.e.NormalKind,B)),this}_getFlattenedNormals(s,Z){const o=new Float32Array(3*s.length);let t=0;const j=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let S=0;S<s.length;S+=3){const a=G.n.oO(Z,3*s[S]),O=G.n.oO(Z,3*s[S+1]),v=G.n.oO(Z,3*s[S+2]),B=a.Go(O),Q=v.Go(O),D=G.n.Normalize(G.n.Cross(B,Q));j&&D.scaleInPlace(-1);for(let s=0;s<3;s++)o[t++]=D.x,o[t++]=D.y,o[t++]=D.z}return o}_convertToUnIndexedMesh(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Z=this.getVerticesDataKinds().filter((s=>{var Z;return!(null!==(Z=this.getVertexBuffer(s))&&void 0!==Z&&Z.getIsInstanced())})),o=this.ra(),t={},j=(s,Z)=>{const t=new Float32Array(o.length*Z);let j=0;for(let S=0;S<o.length;S++)for(let a=0;a<Z;a++)t[j++]=s[o[S]*Z+a];return t},S=this.getBoundingInfo(),a=this.Pa?this.vO.slice(0):[];for(const O of Z)t[O]=this.getVerticesData(O);for(const O of Z){const Z=this.getVertexBuffer(O),S=Z.getSize();if(s&&O===D.e.NormalKind){const s=this._getFlattenedNormals(o,t[D.e.PositionKind]);this.hs(D.e.NormalKind,s,Z.isUpdatable(),S)}else this.hs(O,j(t[O],S),Z.isUpdatable(),S)}if(this.morphTargetManager){for(let Z=0;Z<this.morphTargetManager.numTargets;Z++){const t=this.morphTargetManager.getTarget(Z),S=t.getPositions();t.setPositions(j(S,3));const a=t.getNormals();a&&t.setNormals(s?this._getFlattenedNormals(o,S):j(a,3));const O=t.getTangents();O&&t.setTangents(j(O,3));const v=t.getUVs();v&&t.setUVs(j(v,2));const G=t.getColors();G&&t.setColors(j(G,4))}this.morphTargetManager.synchronize()}for(let O=0;O<o.length;O++)o[O]=O;this.setIndices(o),this._unIndexed=!0,this.releaseSubMeshes();for(const O of a){const s=O.getBoundingInfo();f.b.AddToMesh(O.materialIndex,O.indexStart,O.indexCount,O.indexStart,O.indexCount,this).setBoundingInfo(s)}return this.setBoundingInfo(S),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Z=z.d.ExtractFromMesh(this);let o;if(s&&this.isVerticesDataPresent(D.e.NormalKind)&&Z.ls){for(o=0;o<Z.ls.length;o++)Z.ls[o]*=-1;this.hs(D.e.NormalKind,Z.ls,this.isVertexBufferUpdatable(D.e.NormalKind))}if(Z.indices){let s;for(o=0;o<Z.indices.length;o+=3)s=Z.indices[o+1],Z.indices[o+1]=Z.indices[o+2],Z.indices[o+2]=s;this.setIndices(Z.indices,null,this.isVertexBufferUpdatable(D.e.PositionKind),!0)}return this}increaseVertices(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const Z=z.d.ExtractFromMesh(this),o=Z.indices&&!Array.isArray(Z.indices)&&Array.from?Array.from(Z.indices):Z.indices,t=Z.gs&&!Array.isArray(Z.gs)&&Array.from?Array.from(Z.gs):Z.gs,j=Z.es&&!Array.isArray(Z.es)&&Array.from?Array.from(Z.es):Z.es,S=Z.ls&&!Array.isArray(Z.ls)&&Array.from?Array.from(Z.ls):Z.ls;if(o&&t){Z.indices=o,Z.gs=t,j&&(Z.es=j),S&&(Z.ls=S);const a=s+1,O=[];for(let s=0;s<a+1;s++)O[s]=[];let v,B;const Q=new G.n(0,0,0),z=new G.n(0,0,0),Y=new G.j(0,0),b=[],f=[],A=[];let d,U,u,H=t.length;j&&(U=j.length),S&&(u=S.length);for(let s=0;s<o.length;s+=3){f[0]=o[s],f[1]=o[s+1],f[2]=o[s+2];for(let s=0;s<3;s++)if(v=f[s],B=f[(s+1)%3],void 0===A[v]&&void 0===A[B]?(A[v]=[],A[B]=[]):(void 0===A[v]&&(A[v]=[]),void 0===A[B]&&(A[B]=[])),void 0===A[v][B]&&void 0===A[B][v]){A[v][B]=[],Q.x=(t[3*B]-t[3*v])/a,Q.y=(t[3*B+1]-t[3*v+1])/a,Q.z=(t[3*B+2]-t[3*v+2])/a,S&&(z.x=(S[3*B]-S[3*v])/a,z.y=(S[3*B+1]-S[3*v+1])/a,z.z=(S[3*B+2]-S[3*v+2])/a),j&&(Y.x=(j[2*B]-j[2*v])/a,Y.y=(j[2*B+1]-j[2*v+1])/a),A[v][B].push(v);for(let s=1;s<a;s++)A[v][B].push(t.length/3),t[H++]=t[3*v]+s*Q.x,t[H++]=t[3*v+1]+s*Q.y,t[H++]=t[3*v+2]+s*Q.z,S&&(S[u++]=S[3*v]+s*z.x,S[u++]=S[3*v+1]+s*z.y,S[u++]=S[3*v+2]+s*z.z),j&&(j[U++]=j[2*v]+s*Y.x,j[U++]=j[2*v+1]+s*Y.y);A[v][B].push(B),A[B][v]=[],d=A[v][B].length;for(let s=0;s<d;s++)A[B][v][s]=A[v][B][d-1-s]}O[0][0]=o[s],O[1][0]=A[o[s]][o[s+1]][1],O[1][1]=A[o[s]][o[s+2]][1];for(let Z=2;Z<a;Z++){O[Z][0]=A[o[s]][o[s+1]][Z],O[Z][Z]=A[o[s]][o[s+2]][Z],Q.x=(t[3*O[Z][Z]]-t[3*O[Z][0]])/Z,Q.y=(t[3*O[Z][Z]+1]-t[3*O[Z][0]+1])/Z,Q.z=(t[3*O[Z][Z]+2]-t[3*O[Z][0]+2])/Z,S&&(z.x=(S[3*O[Z][Z]]-S[3*O[Z][0]])/Z,z.y=(S[3*O[Z][Z]+1]-S[3*O[Z][0]+1])/Z,z.z=(S[3*O[Z][Z]+2]-S[3*O[Z][0]+2])/Z),j&&(Y.x=(j[2*O[Z][Z]]-j[2*O[Z][0]])/Z,Y.y=(j[2*O[Z][Z]+1]-j[2*O[Z][0]+1])/Z);for(let s=1;s<Z;s++)O[Z][s]=t.length/3,t[H++]=t[3*O[Z][0]]+s*Q.x,t[H++]=t[3*O[Z][0]+1]+s*Q.y,t[H++]=t[3*O[Z][0]+2]+s*Q.z,S&&(S[u++]=S[3*O[Z][0]]+s*z.x,S[u++]=S[3*O[Z][0]+1]+s*z.y,S[u++]=S[3*O[Z][0]+2]+s*z.z),j&&(j[U++]=j[2*O[Z][0]]+s*Y.x,j[U++]=j[2*O[Z][0]+1]+s*Y.y)}O[a]=A[o[s+1]][o[s+2]],b.push(O[0][0],O[1][0],O[1][1]);for(let s=1;s<a;s++){let Z;for(Z=0;Z<s;Z++)b.push(O[s][Z],O[s+1][Z],O[s+1][Z+1]),b.push(O[s][Z],O[s+1][Z+1],O[s][Z+1]);b.push(O[s][Z],O[s+1][Z],O[s+1][Z+1])}}Z.indices=b,Z.ws(this,this.isVertexBufferUpdatable(D.e.PositionKind))}else H.b.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const s=z.d.ExtractFromMesh(this),Z=s.es,o=s.indices,t=s.gs,j=s.Rs,S=s.matricesIndices,a=s.matricesWeights,O=s.matricesIndicesExtra,v=s.matricesWeightsExtra;if(void 0===o||void 0===t||null===o||null===t)H.b.Warn("VertexData contains empty entries");else{const G=[],B=[],Q=[],Y=[],b=[],f=[],A=[],d=[];let U=[],u=0;const H={};let F,i;for(let s=0;s<o.length;s+=3){i=[o[s],o[s+1],o[s+2]],U=[];for(let s=0;s<3;s++){U[s]="";for(let Z=0;Z<3;Z++)Math.abs(t[3*i[s]+Z])<1e-8&&(t[3*i[s]+Z]=0),U[s]+=t[3*i[s]+Z]+"|"}if(U[0]!=U[1]&&U[0]!=U[2]&&U[1]!=U[2])for(let s=0;s<3;s++){if(F=H[U[s]],void 0===F){H[U[s]]=u,F=u++;for(let Z=0;Z<3;Z++)G.push(t[3*i[s]+Z]);if(null!==j&&void 0!==j)for(let Z=0;Z<4;Z++)Y.push(j[4*i[s]+Z]);if(null!==Z&&void 0!==Z)for(let o=0;o<2;o++)Q.push(Z[2*i[s]+o]);if(null!==S&&void 0!==S)for(let Z=0;Z<4;Z++)b.push(S[4*i[s]+Z]);if(null!==a&&void 0!==a)for(let Z=0;Z<4;Z++)f.push(a[4*i[s]+Z]);if(null!==O&&void 0!==O)for(let Z=0;Z<4;Z++)A.push(O[4*i[s]+Z]);if(null!==v&&void 0!==v)for(let Z=0;Z<4;Z++)d.push(v[4*i[s]+Z])}B.push(F)}}const N=[];z.d.ComputeNormals(G,B,N),s.gs=G,s.indices=B,s.ls=N,null!==Z&&void 0!==Z&&(s.es=Q),null!==j&&void 0!==j&&(s.Rs=Y),null!==S&&void 0!==S&&(s.matricesIndices=b),null!==a&&void 0!==a&&(s.matricesWeights=f),null!==O&&void 0!==O&&(s.matricesIndicesExtra=A),null!==a&&void 0!==a&&(s.matricesWeightsExtra=d),s.ws(this,this.isVertexBufferUpdatable(D.e.PositionKind))}}static _instancedMeshFactory(s,Z){throw(0,i.d)("InstancedMesh")}static _PhysicsImpostorParser(s,Z,o){throw(0,i.d)("PhysicsImpostor")}createInstance(s){const Z=w._instancedMeshFactory(s,this);return Z.parent=this.parent,Z}synchronizeInstances(){for(let s=0;s<this.instances.length;s++){this.instances[s]._syncSubMeshes()}return this}optimizeIndices(s){const Z=this.ra(),o=this.getVerticesData(D.e.PositionKind);if(!o||!Z)return this;const t=[];for(let j=0;j<o.length;j+=3)t.push(G.n.oO(o,j));const S=[];return j.d.SyncAsyncForLoop(t.length,40,(s=>{const Z=t.length-1-s,o=t[Z];for(let j=0;j<Z;++j){const s=t[j];if(o.equals(s)){S[Z]=j;break}}}),(()=>{for(let s=0;s<Z.length;++s)Z[s]=S[Z[s]]||Z[s];const o=this.vO.slice(0);this.setIndices(Z),this.vO=o,s&&s(this)})),this}serialize(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s.name=this.name,s.id=this.id,s.uniqueId=this.uniqueId,s.type=this.getClassName(),a.b&&a.b.HasTags(this)&&(s.tags=a.b.GetTags(this)),s.position=this.position.ma(),this.rotationQuaternion?s.rotationQuaternion=this.rotationQuaternion.ma():this.rotation&&(s.rotation=this.rotation.ma()),s.ZO=this.ZO.ma(),this._postMultiplyPivotMatrix?s.pivotMatrix=this.getPivotMatrix().ma():s.localMatrix=this.getPivotMatrix().ma(),s.isEnabled=this.isEnabled(!1),s.isVisible=this.isVisible,s.infiniteDistance=this.infiniteDistance,s.pickable=this.Uv,s.receiveShadows=this.receiveShadows,s.billboardMode=this.billboardMode,s.visibility=this.visibility,s.UO=this.UO,s.checkCollisions=this.checkCollisions,s.ellipsoid=this.ellipsoid.ma(),s.ellipsoidOffset=this.ellipsoidOffset.ma(),s.Xs=this.Xs,s.isBlocker=this.isBlocker,s.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(s),s.isUnIndexed=this.isUnIndexed;const Z=this._geometry;if(Z&&this.vO){s.geometryUniqueId=Z.uniqueId,s.geometryId=Z.id,s.vO=[];for(let Z=0;Z<this.vO.length;Z++){const o=this.vO[Z];s.vO.push({materialIndex:o.materialIndex,verticesStart:o.verticesStart,verticesCount:o.verticesCount,indexStart:o.indexStart,indexCount:o.indexCount})}}if(this.material?this.material.doNotSerialize||(s.materialUniqueId=this.material.uniqueId,s.materialId=this.material.id):(this.material=null,s.materialUniqueId=this._scene.defaultMaterial.uniqueId,s.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(s.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(s.skeletonId=this.skeleton.id,s.numBoneInfluencers=this.numBoneInfluencers),this.Ls()._getComponent(N.d.NAME_PHYSICSENGINE)){const Z=this.getPhysicsImpostor();Z&&(s.physicsMass=Z.getParam("Nj"),s.physicsFriction=Z.getParam("friction"),s.physicsRestitution=Z.getParam("Nj"),s.physicsImpostor=Z.type)}this.metadata&&(s.metadata=this.metadata),s.instances=[];for(let o=0;o<this.instances.length;o++){const Z=this.instances[o];if(Z.doNotSerialize)continue;const t={name:Z.name,id:Z.id,isEnabled:Z.isEnabled(!1),isVisible:Z.isVisible,Uv:Z.Uv,checkCollisions:Z.checkCollisions,position:Z.position.ma(),ZO:Z.ZO.ma()};if(Z.parent&&Z.parent._serializeAsParent(t),Z.rotationQuaternion?t.rotationQuaternion=Z.rotationQuaternion.ma():Z.rotation&&(t.rotation=Z.rotation.ma()),this.Ls()._getComponent(N.d.NAME_PHYSICSENGINE)){const s=Z.getPhysicsImpostor();s&&(t.physicsMass=s.getParam("Nj"),t.physicsFriction=s.getParam("friction"),t.physicsRestitution=s.getParam("Nj"),t.physicsImpostor=s.type)}Z.metadata&&(t.metadata=Z.metadata),Z.actionManager&&(t.actions=Z.actionManager.serialize(Z.name)),s.instances.push(t),u.c.AppendSerializedAnimations(Z,t),t.ranges=Z.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(s.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const Z={data:{},sizes:{},strides:{}};for(const s in this._userThinInstanceBuffersStorage.data)Z.data[s]=Array.from(this._userThinInstanceBuffersStorage.data[s]),Z.sizes[s]=this._userThinInstanceBuffersStorage.sizes[s],Z.strides[s]=this._userThinInstanceBuffersStorage.strides[s];s.thinInstances.userThinInstance=Z}return u.c.AppendSerializedAnimations(this,s),s.ranges=this.serializeAnimationRanges(),s.layerMask=this.layerMask,s.alphaIndex=this.alphaIndex,s.hasVertexAlpha=this.hasVertexAlpha,s.overlayAlpha=this.overlayAlpha,s.overlayColor=this.overlayColor.ma(),s.renderOverlay=this.renderOverlay,s.applyFog=this.applyFog,this.actionManager&&(s.actions=this.actionManager.serialize(this.name)),s}_syncGeometryWithMorphTargetManager(){if(!this.Pa)return;this._markSubMeshesAsAttributesDirty();const s=this._internalAbstractMeshDataInfo._morphTargetManager;if(s&&s.vertexCount){if(s.vertexCount!==this.getTotalVertices())return H.b.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(s.isUsingTextureForTargets)return;for(let Z=0;Z<s.numInfluencers;Z++){const o=s.getActiveTarget(Z),t=o.getPositions();if(!t)return void H.b.Error("Invalid morph target. Target must have positions.");this.Pa.hs(D.e.PositionKind+Z,t,!1,3);const j=o.getNormals();j&&this.Pa.hs(D.e.NormalKind+Z,j,!1,3);const S=o.getTangents();S&&this.Pa.hs(D.e.TangentKind+Z,S,!1,3);const a=o.getUVs();a&&this.Pa.hs(D.e.UVKind+"_"+Z,a,!1,2);const O=o.getUV2s();O&&this.Pa.hs(D.e.UV2Kind+"_"+Z,O,!1,2);const v=o.getColors();v&&this.Pa.hs(D.e.ColorKind+Z,v,!1,4)}}else{let s=0;for(;this.Pa.isVerticesDataPresent(D.e.PositionKind+s);)this.Pa.removeVerticesData(D.e.PositionKind+s),this.Pa.isVerticesDataPresent(D.e.NormalKind+s)&&this.Pa.removeVerticesData(D.e.NormalKind+s),this.Pa.isVerticesDataPresent(D.e.TangentKind+s)&&this.Pa.removeVerticesData(D.e.TangentKind+s),this.Pa.isVerticesDataPresent(D.e.UVKind+s)&&this.Pa.removeVerticesData(D.e.UVKind+"_"+s),this.Pa.isVerticesDataPresent(D.e.UV2Kind+s)&&this.Pa.removeVerticesData(D.e.UV2Kind+"_"+s),this.Pa.isVerticesDataPresent(D.e.ColorKind+s)&&this.Pa.removeVerticesData(D.e.ColorKind+s),s++}}static Parse(s,Z,o){let t;if(t=s.type&&"LinesMesh"===s.type?w._LinesMeshParser(s,Z):s.type&&"GroundMesh"===s.type?w._GroundMeshParser(s,Z):s.type&&"GoldbergMesh"===s.type?w._GoldbergMeshParser(s,Z):s.type&&"GreasedLineMesh"===s.type?w._GreasedLineMeshParser(s,Z):s.type&&"TrailMesh"===s.type?w._TrailMeshParser(s,Z):new w(s.name,Z),t.id=s.id,t._waitingParsedUniqueId=s.uniqueId,a.b&&a.b.AddTagsTo(t,s.tags),t.position=G.n.oO(s.position),void 0!==s.metadata&&(t.metadata=s.metadata),s.rotationQuaternion?t.rotationQuaternion=G.e.oO(s.rotationQuaternion):s.rotation&&(t.rotation=G.n.oO(s.rotation)),t.ZO=G.n.oO(s.ZO),s.localMatrix?t.setPreTransformMatrix(G.b.oO(s.localMatrix)):s.pivotMatrix&&t.setPivotMatrix(G.b.oO(s.pivotMatrix)),t.iO(s.isEnabled),t.isVisible=s.isVisible,t.infiniteDistance=s.infiniteDistance,t.UO=!!s.UO,t.showBoundingBox=s.showBoundingBox,t.showSubMeshesBoundingBox=s.showSubMeshesBoundingBox,void 0!==s.applyFog&&(t.applyFog=s.applyFog),void 0!==s.pickable&&(t.Uv=s.pickable),void 0!==s.alphaIndex&&(t.alphaIndex=s.alphaIndex),t.receiveShadows=s.receiveShadows,void 0!==s.billboardMode&&(t.billboardMode=s.billboardMode),void 0!==s.visibility&&(t.visibility=s.visibility),t.checkCollisions=s.checkCollisions,t.Xs=!!s.Xs,s.ellipsoid&&(t.ellipsoid=G.n.oO(s.ellipsoid)),s.ellipsoidOffset&&(t.ellipsoidOffset=G.n.oO(s.ellipsoidOffset)),null!=s.overrideMaterialSideOrientation&&(t.sideOrientation=s.overrideMaterialSideOrientation),void 0!==s.sideOrientation&&(t.sideOrientation=s.sideOrientation),void 0!==s.isBlocker&&(t.isBlocker=s.isBlocker),t._shouldGenerateFlatShading=s.useFlatShading,s.dO&&(t._waitingData.dO=s.dO),void 0!==s.parentId&&(t._waitingParentId=s.parentId),void 0!==s.parentInstanceIndex&&(t._waitingParentInstanceIndex=s.parentInstanceIndex),void 0!==s.actions&&(t._waitingData.actions=s.actions),void 0!==s.overlayAlpha&&(t.overlayAlpha=s.overlayAlpha),void 0!==s.overlayColor&&(t.overlayColor=B.d.oO(s.overlayColor)),void 0!==s.renderOverlay&&(t.renderOverlay=s.renderOverlay),t.isUnIndexed=!!s.isUnIndexed,t.hasVertexAlpha=s.hasVertexAlpha,s.delayLoadingFile?(t.delayLoadState=4,t.delayLoadingFile=o+s.delayLoadingFile,t.buildBoundingInfo(G.n.oO(s.boundingBoxMinimum),G.n.oO(s.boundingBoxMaximum)),s._binaryInfo&&(t._binaryInfo=s._binaryInfo),t._delayInfo=[],s.hasUVs&&t._delayInfo.push(D.e.UVKind),s.hasUVs2&&t._delayInfo.push(D.e.UV2Kind),s.hasUVs3&&t._delayInfo.push(D.e.UV3Kind),s.hasUVs4&&t._delayInfo.push(D.e.UV4Kind),s.hasUVs5&&t._delayInfo.push(D.e.UV5Kind),s.hasUVs6&&t._delayInfo.push(D.e.UV6Kind),s.hasColors&&t._delayInfo.push(D.e.ColorKind),s.hasMatricesIndices&&t._delayInfo.push(D.e.MatricesIndicesKind),s.hasMatricesWeights&&t._delayInfo.push(D.e.MatricesWeightsKind),t._delayLoadingFunction=Y.e._ImportGeometry,U.b.ForceFullSceneLoadingForIncremental&&t._checkDelayState()):Y.e._ImportGeometry(s,t),s.materialUniqueId?t._waitingMaterialId=s.materialUniqueId:s.materialId&&(t._waitingMaterialId=s.materialId),s.morphTargetManagerId>-1&&(t._waitingMorphTargetManagerId=s.morphTargetManagerId),void 0!==s.skeletonId&&null!==s.skeletonId&&(t.skeleton=Z.getLastSkeletonById(s.skeletonId),s.numBoneInfluencers&&(t.numBoneInfluencers=s.numBoneInfluencers)),s.animations){for(let Z=0;Z<s.animations.length;Z++){const o=s.animations[Z],j=(0,F.e)("BABYLON.Animation");j&&t.animations.push(j.Parse(o))}Q.d.ParseAnimationRanges(t,s,Z)}if(s.autoAnimate&&Z.beginAnimation(t,s.autoAnimateFrom,s.autoAnimateTo,s.autoAnimateLoop,s.autoAnimateSpeed||1),s.layerMask&&!isNaN(s.layerMask)?t.layerMask=Math.abs(parseInt(s.layerMask)):t.layerMask=268435455,s.physicsImpostor&&(t.physicsImpostor=w._PhysicsImpostorParser(Z,t,s)),s.lodMeshIds&&(t._waitingData.lods={ids:s.lodMeshIds,distances:s.lodDistances?s.lodDistances:null,coverages:s.lodCoverages?s.lodCoverages:null}),s.instances)for(let j=0;j<s.instances.length;j++){const o=s.instances[j],S=t.createInstance(o.name);if(o.id&&(S.id=o.id),a.b&&(o.tags?a.b.AddTagsTo(S,o.tags):a.b.AddTagsTo(S,s.tags)),S.position=G.n.oO(o.position),void 0!==o.metadata&&(S.metadata=o.metadata),void 0!==o.parentId&&(S._waitingParentId=o.parentId),void 0!==o.parentInstanceIndex&&(S._waitingParentInstanceIndex=o.parentInstanceIndex),void 0!==o.isEnabled&&null!==o.isEnabled&&S.iO(o.isEnabled),void 0!==o.isVisible&&null!==o.isVisible&&(S.isVisible=o.isVisible),void 0!==o.Uv&&null!==o.Uv&&(S.Uv=o.Uv),o.rotationQuaternion?S.rotationQuaternion=G.e.oO(o.rotationQuaternion):o.rotation&&(S.rotation=G.n.oO(o.rotation)),S.ZO=G.n.oO(o.ZO),void 0!=o.checkCollisions&&null!=o.checkCollisions&&(S.checkCollisions=o.checkCollisions),void 0!=o.pickable&&null!=o.pickable&&(S.Uv=o.pickable),void 0!=o.showBoundingBox&&null!=o.showBoundingBox&&(S.showBoundingBox=o.showBoundingBox),void 0!=o.showSubMeshesBoundingBox&&null!=o.showSubMeshesBoundingBox&&(S.showSubMeshesBoundingBox=o.showSubMeshesBoundingBox),void 0!=o.alphaIndex&&null!=o.showSubMeshesBoundingBox&&(S.alphaIndex=o.alphaIndex),o.physicsImpostor&&(S.physicsImpostor=w._PhysicsImpostorParser(Z,S,o)),void 0!==o.actions&&(S._waitingData.actions=o.actions),o.animations){for(let s=0;s<o.animations.length;s++){const Z=o.animations[s],t=(0,F.e)("BABYLON.Animation");t&&S.animations.push(t.Parse(Z))}Q.d.ParseAnimationRanges(S,o,Z),o.autoAnimate&&Z.beginAnimation(S,o.autoAnimateFrom,o.autoAnimateTo,o.autoAnimateLoop,o.autoAnimateSpeed||1)}}if(s.thinInstances){const Z=s.thinInstances;if(t.thinInstanceEnablePicking=!!Z.enablePicking,Z.matrixData?(t.pB("matrix",new Float32Array(Z.matrixData),16,!1),t._thinInstanceDataStorage.matrixBufferSize=Z.matrixBufferSize,t._thinInstanceDataStorage.instancesCount=Z.instancesCount):t._thinInstanceDataStorage.matrixBufferSize=Z.matrixBufferSize,s.thinInstances.userThinInstance){const Z=s.thinInstances.userThinInstance;for(const s in Z.data)t.pB(s,new Float32Array(Z.data[s]),Z.strides[s],!1),t._userThinInstanceBuffersStorage.sizes[s]=Z.sizes[s]}}return t}setPositionsForCPUSkinning(){const s=this._internalMeshDataInfo;if(!s._sourcePositions){const Z=this.getVerticesData(D.e.PositionKind);if(!Z)return s._sourcePositions;s._sourcePositions=new Float32Array(Z),this.isVertexBufferUpdatable(D.e.PositionKind)||this.hs(D.e.PositionKind,Z,!0)}return s._sourcePositions}setNormalsForCPUSkinning(){const s=this._internalMeshDataInfo;if(!s._sourceNormals){const Z=this.getVerticesData(D.e.NormalKind);if(!Z)return s._sourceNormals;s._sourceNormals=new Float32Array(Z),this.isVertexBufferUpdatable(D.e.NormalKind)||this.hs(D.e.NormalKind,Z,!0)}return s._sourceNormals}applySkeleton(s){if(!this.Pa)return this;if(this.Pa._softwareSkinningFrameId==this.Ls().getFrameId())return this;if(this.Pa._softwareSkinningFrameId=this.Ls().getFrameId(),!this.isVerticesDataPresent(D.e.PositionKind))return this;if(!this.isVerticesDataPresent(D.e.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(D.e.MatricesWeightsKind))return this;const Z=this.isVerticesDataPresent(D.e.NormalKind),o=this._internalMeshDataInfo;if(!o._sourcePositions){const s=this.vO.slice();this.setPositionsForCPUSkinning(),this.vO=s}Z&&!o._sourceNormals&&this.setNormalsForCPUSkinning();let t=this.getVerticesData(D.e.PositionKind);if(!t)return this;t instanceof Float32Array||(t=new Float32Array(t));let j=this.getVerticesData(D.e.NormalKind);if(Z){if(!j)return this;j instanceof Float32Array||(j=new Float32Array(j))}const S=this.getVerticesData(D.e.MatricesIndicesKind),a=this.getVerticesData(D.e.MatricesWeightsKind);if(!a||!S)return this;const O=this.numBoneInfluencers>4,v=O?this.getVerticesData(D.e.MatricesIndicesExtraKind):null,B=O?this.getVerticesData(D.e.MatricesWeightsExtraKind):null,Q=s.getTransformMatrices(this),z=G.n.Zero(),Y=new G.b,b=new G.b;let f,A=0;for(let D=0;D<t.length;D+=3,A+=4){let s;for(f=0;f<4;f++)s=a[A+f],s>0&&(G.b.FromFloat32ArrayToRefScaled(Q,Math.floor(16*S[A+f]),s,b),Y.addToSelf(b));if(O)for(f=0;f<4;f++)s=B[A+f],s>0&&(G.b.FromFloat32ArrayToRefScaled(Q,Math.floor(16*v[A+f]),s,b),Y.addToSelf(b));G.n.TransformCoordinatesFromFloatsToRef(o._sourcePositions[D],o._sourcePositions[D+1],o._sourcePositions[D+2],Y,z),z.toArray(t,D),Z&&(G.n.TransformNormalFromFloatsToRef(o._sourceNormals[D],o._sourceNormals[D+1],o._sourceNormals[D+2],Y,z),z.toArray(j,D)),Y.reset()}return this.updateVerticesData(D.e.PositionKind,t),Z&&this.updateVerticesData(D.e.NormalKind,j),this}static MinMax(s){let Z=null,o=null;for(const t of s){const s=t.getBoundingInfo().boundingBox;Z&&o?(Z.minimizeInPlace(s.minimumWorld),o.maximizeInPlace(s.maximumWorld)):(Z=s.minimumWorld,o=s.maximumWorld)}return Z&&o?{min:Z,max:o}:{min:G.n.Zero(),max:G.n.Zero()}}static Center(s){const Z=s instanceof Array?w.MinMax(s):s;return G.n.Center(Z.min,Z.max)}static MergeMeshes(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments.length>2?arguments[2]:void 0,t=arguments.length>3?arguments[3]:void 0,j=arguments.length>4?arguments[4]:void 0,S=arguments.length>5?arguments[5]:void 0;return(0,O.q)(w._MergeMeshesCoroutine(s,Z,o,t,j,S,!1))}static async MergeMeshesAsync(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments.length>2?arguments[2]:void 0,t=arguments.length>3?arguments[3]:void 0,j=arguments.length>4?arguments[4]:void 0,S=arguments.length>5?arguments[5]:void 0;return await(0,O.m)(w._MergeMeshesCoroutine(s,Z,o,t,j,S,!0),(0,O.e)())}static*_MergeMeshesCoroutine(s){let Z,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=arguments.length>2?arguments[2]:void 0,j=arguments.length>3?arguments[3]:void 0,S=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,O=arguments.length>6?arguments[6]:void 0;if(0===(s=s.filter(Boolean)).length)return null;if(!t){let o=0;for(Z=0;Z<s.length;Z++)if(o+=s[Z].getTotalVertices(),o>=65536)return H.b.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}a&&(S=!1);const v=new Array,G=new Array,B=new Array,Q=s[0].sideOrientation;for(Z=0;Z<s.length;Z++){const o=s[Z];if(o.isAnInstance)return H.b.Warn("Cannot merge instance meshes."),null;if(Q!==o.sideOrientation)return H.b.Warn("Cannot merge meshes with different sideOrientation values."),null;if(S&&B.push(o.getTotalIndices()),a)if(o.material){const s=o.material;if(s instanceof d.d){for(let Z=0;Z<s.GO.length;Z++)v.indexOf(s.GO[Z])<0&&v.push(s.GO[Z]);for(let Z=0;Z<o.vO.length;Z++)G.push(v.indexOf(s.GO[o.vO[Z].materialIndex])),B.push(o.vO[Z].indexCount)}else{v.indexOf(s)<0&&v.push(s);for(let Z=0;Z<o.vO.length;Z++)G.push(v.indexOf(s)),B.push(o.vO[Z].indexCount)}}else for(let s=0;s<o.vO.length;s++)G.push(0),B.push(o.vO[s].indexCount)}const D=s[0],Y=s=>{const Z=s.Ea(!0);return{vertexData:z.d.ExtractFromMesh(s,!1,!1),transform:Z}},{vertexData:b,transform:A}=Y(D);O&&(yield);const U=new Array(s.length-1);for(let z=1;z<s.length;z++)U[z-1]=Y(s[z]),O&&(yield);const u=b._mergeCoroutine(A,U,t,O,!o);let F=u.next();for(;!F.done;)O&&(yield),F=u.next();const i=F.value;j||(j=new w(D.name+"_merged",D.Ls()));const N=i._applyToCoroutine(j,void 0,O);let L=N.next();for(;!L.done;)O&&(yield),L=N.next();if(j.checkCollisions=D.checkCollisions,j.sideOrientation=D.sideOrientation,o)for(Z=0;Z<s.length;Z++)s[Z].dispose();if(S||a){j.releaseSubMeshes(),Z=0;let s=0;for(;Z<B.length;)f.b.CreateFromIndices(0,s,B[Z],j,void 0,!1),s+=B[Z],Z++;for(const Z of j.vO)Z.refreshBoundingInfo();j.Ea(!0)}if(a){const s=new d.d(D.name+"_merged",D.Ls());s.GO=v;for(let Z=0;Z<j.vO.length;Z++)j.vO[Z].materialIndex=G[Z];j.material=s}else j.material=D.material;return j}CQ(s){s._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(s)}IQ(s){const Z=s._indexInSourceMeshInstanceArray;if(-1!=Z){if(Z!==this.instances.length-1){const s=this.instances[this.instances.length-1];this.instances[Z]=s,s._indexInSourceMeshInstanceArray=Z}s._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===A.c.CounterClockWiseSideOrientation}_getRenderingFillMode(s){const Z=this.Ls();return Z.forcePointsCloud?A.c.PointFillMode:Z.forceWireframe?A.c.WireFrameFillMode:this.overrideRenderingFillMode??s}setMaterialByID(s){return this.setMaterialById(s)}static CreateRibbon(s,Z,o,t,j,S,a,O,v){throw new Error("Import MeshBuilder to populate this function")}static CreateDisc(s,Z,o,t,j,S){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(s,Z,o,t,j){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(s,Z,o,t,j,S){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(s,Z,o,t){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(s,Z,o,t,j,S,a,O,v){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(s,Z,o,t,j,S,a){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(s,Z,o,t,j,S,a,O,v,G){throw new Error("Import MeshBuilder to populate this function")}static mv(s,Z,o,t,j){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(s,Z,o,t,j,S,a,O){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(s,Z,o,t,j,S,a){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(s,Z,o,t,j,S,a,O){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(s,Z,o,t,j,S,a,O,v,G){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(s,Z,o,t,j,S,a,O,v,G,B,Q){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(s,Z,o,t,j,S,a){throw new Error("Import MeshBuilder to populate this function")}static Jv(s,Z,o,t,j){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(s,Z,o,t,j,S){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(s,Z,o,t,j,S,a,O,v){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(s,Z,o,t,j,S,a,O,v,G,B){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(s,Z,o,t,j,S,a,O,v,G){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(s,Z,o){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(s,Z,o){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(s,Z,o,t,j,S){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(s,Z,o){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(s){throw new Error("Import MeshBuilder to populate this function")}}w.FRONTSIDE=z.d.FRONTSIDE,w.BACKSIDE=z.d.BACKSIDE,w.DOUBLESIDE=z.d.DOUBLESIDE,w.DEFAULTSIDE=z.d.DEFAULTSIDE,w.NO_CAP=0,w.CAP_START=1,w.CAP_END=2,w.CAP_ALL=3,w.NO_FLIP=0,w.FLIP_TILE=1,w.ROTATE_TILE=2,w.FLIP_ROW=3,w.ROTATE_ROW=4,w.FLIP_N_ROTATE_TILE=5,w.FLIP_N_ROTATE_ROW=6,w.CENTER=0,w.LEFT=1,w.RIGHT=2,w.TOP=3,w.BOTTOM=4,w.INSTANCEDMESH_SORT_TRANSPARENT=!1,w._GroundMeshParser=(s,Z)=>{throw(0,i.d)("GroundMesh")},w._GoldbergMeshParser=(s,Z)=>{throw(0,i.d)("GoldbergMesh")},w._LinesMeshParser=(s,Z)=>{throw(0,i.d)("LinesMesh")},w._GreasedLineMeshParser=(s,Z)=>{throw(0,i.d)("GreasedLineMesh")},w._GreasedLineRibbonMeshParser=(s,Z)=>{throw(0,i.d)("GreasedLineRibbonMesh")},w._TrailMeshParser=(s,Z)=>{throw(0,i.d)("TrailMesh")},(0,F.f)("BABYLON.Mesh",w)},11214:(s,Z,o)=>{o.d(Z,{d:()=>Y});var t=o(11086),j=o(10900),S=o(11113),a=o(10975),O=o(11174),v=o(10955),G=o(11091),B=o(11219),Q=o(10990),D=o(11108);class z{}class Y{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,B.i)(this._applyToCoroutine.bind(this)),this.uniqueId=Y._UniqueIdGenerator,Y._UniqueIdGenerator++}set(s,Z){switch(s.length||v.b.Warn(`Setting vertex data kind '${Z}' with an empty array`),Z){case S.e.PositionKind:this.gs=s;break;case S.e.NormalKind:this.ls=s;break;case S.e.TangentKind:this.tangents=s;break;case S.e.UVKind:this.es=s;break;case S.e.UV2Kind:this.uvs2=s;break;case S.e.UV3Kind:this.uvs3=s;break;case S.e.UV4Kind:this.uvs4=s;break;case S.e.UV5Kind:this.uvs5=s;break;case S.e.UV6Kind:this.uvs6=s;break;case S.e.ColorKind:this.Rs=s;break;case S.e.MatricesIndicesKind:this.matricesIndices=s;break;case S.e.MatricesWeightsKind:this.matricesWeights=s;break;case S.e.MatricesIndicesExtraKind:this.matricesIndicesExtra=s;break;case S.e.MatricesWeightsExtraKind:this.matricesWeightsExtra=s}}ws(s,Z){return this._applyTo(s,Z,!1),this}applyToGeometry(s,Z){return this._applyTo(s,Z,!1),this}updateMesh(s){return this._update(s),this}updateGeometry(s){return this._update(s),this}*_applyToCoroutine(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2?arguments[2]:void 0;if(this.gs&&(s.hs(S.e.PositionKind,this.gs,Z),o&&(yield)),this.ls&&(s.hs(S.e.NormalKind,this.ls,Z),o&&(yield)),this.tangents&&(s.hs(S.e.TangentKind,this.tangents,Z),o&&(yield)),this.es&&(s.hs(S.e.UVKind,this.es,Z),o&&(yield)),this.uvs2&&(s.hs(S.e.UV2Kind,this.uvs2,Z),o&&(yield)),this.uvs3&&(s.hs(S.e.UV3Kind,this.uvs3,Z),o&&(yield)),this.uvs4&&(s.hs(S.e.UV4Kind,this.uvs4,Z),o&&(yield)),this.uvs5&&(s.hs(S.e.UV5Kind,this.uvs5,Z),o&&(yield)),this.uvs6&&(s.hs(S.e.UV6Kind,this.uvs6,Z),o&&(yield)),this.Rs){const t=this.gs&&this.Rs.length===this.gs.length?3:4;s.hs(S.e.ColorKind,this.Rs,Z,t),this.hasVertexAlpha&&void 0!==s.hasVertexAlpha&&(s.hasVertexAlpha=!0),o&&(yield)}if(this.matricesIndices&&(s.hs(S.e.MatricesIndicesKind,this.matricesIndices,Z),o&&(yield)),this.matricesWeights&&(s.hs(S.e.MatricesWeightsKind,this.matricesWeights,Z),o&&(yield)),this.matricesIndicesExtra&&(s.hs(S.e.MatricesIndicesExtraKind,this.matricesIndicesExtra,Z),o&&(yield)),this.matricesWeightsExtra&&(s.hs(S.e.MatricesWeightsExtraKind,this.matricesWeightsExtra,Z),o&&(yield)),this.indices?(s.setIndices(this.indices,null,Z),o&&(yield)):s.setIndices([],null),s.vO&&this.materialInfos&&this.materialInfos.length>1){const Z=s;Z.vO=[];for(const s of this.materialInfos)new D.b(s.materialIndex,s.verticesStart,s.verticesCount,s.indexStart,s.indexCount,Z)}return this}_update(s,Z,o){return this.gs&&s.updateVerticesData(S.e.PositionKind,this.gs,Z,o),this.ls&&s.updateVerticesData(S.e.NormalKind,this.ls,Z,o),this.tangents&&s.updateVerticesData(S.e.TangentKind,this.tangents,Z,o),this.es&&s.updateVerticesData(S.e.UVKind,this.es,Z,o),this.uvs2&&s.updateVerticesData(S.e.UV2Kind,this.uvs2,Z,o),this.uvs3&&s.updateVerticesData(S.e.UV3Kind,this.uvs3,Z,o),this.uvs4&&s.updateVerticesData(S.e.UV4Kind,this.uvs4,Z,o),this.uvs5&&s.updateVerticesData(S.e.UV5Kind,this.uvs5,Z,o),this.uvs6&&s.updateVerticesData(S.e.UV6Kind,this.uvs6,Z,o),this.Rs&&s.updateVerticesData(S.e.ColorKind,this.Rs,Z,o),this.matricesIndices&&s.updateVerticesData(S.e.MatricesIndicesKind,this.matricesIndices,Z,o),this.matricesWeights&&s.updateVerticesData(S.e.MatricesWeightsKind,this.matricesWeights,Z,o),this.matricesIndicesExtra&&s.updateVerticesData(S.e.MatricesIndicesExtraKind,this.matricesIndicesExtra,Z,o),this.matricesWeightsExtra&&s.updateVerticesData(S.e.MatricesWeightsExtraKind,this.matricesWeightsExtra,Z,o),this.indices&&s.setIndices(this.indices,null),this}static _TransformVector3Coordinates(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s.length;const S=j.g.sO[0],a=j.g.sO[1];for(let O=o;O<o+t;O+=3)j.n.FromArrayToRef(s,O,S),j.n.TransformCoordinatesToRef(S,Z,a),s[O]=a.x,s[O+1]=a.y,s[O+2]=a.z}static _TransformVector3Normals(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s.length;const S=j.g.sO[0],a=j.g.sO[1];for(let O=o;O<o+t;O+=3)j.n.FromArrayToRef(s,O,S),j.n.TransformNormalToRef(S,Z,a),s[O]=a.x,s[O+1]=a.y,s[O+2]=a.z}static _TransformVector4Normals(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s.length;const S=j.g.Vector4[0],a=j.g.Vector4[1];for(let O=o;O<o+t;O+=4)j.p.FromArrayToRef(s,O,S),j.p.TransformNormalToRef(S,Z,a),s[O]=a.x,s[O+1]=a.y,s[O+2]=a.z,s[O+3]=a.w}static _FlipFaces(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s.length;for(let t=Z;t<Z+o;t+=3){const Z=s[t+1];s[t+1]=s[t+2],s[t+2]=Z}}transform(s){const Z=s.determinant()<0;return this.gs&&Y._TransformVector3Coordinates(this.gs,s),this.ls&&Y._TransformVector3Normals(this.ls,s),this.tangents&&Y._TransformVector4Normals(this.tangents,s),Z&&this.indices&&Y._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const s=[];for(const Z of this.materialInfos){const o=new Y;if(this.gs&&(o.gs=this.gs.slice(3*Z.verticesStart,3*(Z.verticesCount+Z.verticesStart))),this.ls&&(o.ls=this.ls.slice(3*Z.verticesStart,3*(Z.verticesCount+Z.verticesStart))),this.tangents&&(o.tangents=this.tangents.slice(4*Z.verticesStart,4*(Z.verticesCount+Z.verticesStart))),this.Rs&&(o.Rs=this.Rs.slice(4*Z.verticesStart,4*(Z.verticesCount+Z.verticesStart))),this.es&&(o.es=this.es.slice(2*Z.verticesStart,2*(Z.verticesCount+Z.verticesStart))),this.uvs2&&(o.uvs2=this.uvs2.slice(2*Z.verticesStart,2*(Z.verticesCount+Z.verticesStart))),this.uvs3&&(o.uvs3=this.uvs3.slice(2*Z.verticesStart,2*(Z.verticesCount+Z.verticesStart))),this.uvs4&&(o.uvs4=this.uvs4.slice(2*Z.verticesStart,2*(Z.verticesCount+Z.verticesStart))),this.uvs5&&(o.uvs5=this.uvs5.slice(2*Z.verticesStart,2*(Z.verticesCount+Z.verticesStart))),this.uvs6&&(o.uvs6=this.uvs6.slice(2*Z.verticesStart,2*(Z.verticesCount+Z.verticesStart))),this.matricesIndices&&(o.matricesIndices=this.matricesIndices.slice(4*Z.verticesStart,4*(Z.verticesCount+Z.verticesStart))),this.matricesIndicesExtra&&(o.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*Z.verticesStart,4*(Z.verticesCount+Z.verticesStart))),this.matricesWeights&&(o.matricesWeights=this.matricesWeights.slice(4*Z.verticesStart,4*(Z.verticesCount+Z.verticesStart))),this.matricesWeightsExtra&&(o.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*Z.verticesStart,4*(Z.verticesCount+Z.verticesStart))),this.indices){o.indices=[];for(let s=Z.indexStart;s<Z.indexStart+Z.indexCount;s++)o.indices.push(this.indices[s]-Z.verticesStart)}const t=new z;t.indexStart=0,t.indexCount=o.indices?o.indices.length:0,t.materialIndex=Z.materialIndex,t.verticesStart=0,t.verticesCount=(o.gs?o.gs.length:0)/3,o.materialInfos=[t],s.push(o)}return s}merge(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],j=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const S=Array.isArray(s)?s.map((s=>({vertexData:s}))):[{vertexData:s}];return(0,B.q)(this._mergeCoroutine(void 0,S,Z,!1,o,t,j))}*_mergeCoroutine(s,Z){var o,t;let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0,O=arguments.length>4?arguments[4]:void 0,v=arguments.length>5&&void 0!==arguments[5]&&arguments[5],G=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let B=Z.map((s=>s.vertexData)),Q=this;if(G)for(const S of B)S&&(S._validate(),!this.ls&&S.ls&&(this.ls=new Float32Array(this.gs.length)),!this.tangents&&S.tangents&&(this.tangents=new Float32Array(this.gs.length/3*4)),!this.es&&S.es&&(this.es=new Float32Array(this.gs.length/3*2)),!this.uvs2&&S.uvs2&&(this.uvs2=new Float32Array(this.gs.length/3*2)),!this.uvs3&&S.uvs3&&(this.uvs3=new Float32Array(this.gs.length/3*2)),!this.uvs4&&S.uvs4&&(this.uvs4=new Float32Array(this.gs.length/3*2)),!this.uvs5&&S.uvs5&&(this.uvs5=new Float32Array(this.gs.length/3*2)),!this.uvs6&&S.uvs6&&(this.uvs6=new Float32Array(this.gs.length/3*2)),!this.Rs&&S.Rs&&(this.Rs=new Float32Array(this.gs.length/3*4),this.Rs.fill(1)),!this.matricesIndices&&S.matricesIndices&&(this.matricesIndices=new Float32Array(this.gs.length/3*4)),!this.matricesWeights&&S.matricesWeights&&(this.matricesWeights=new Float32Array(this.gs.length/3*4)),!this.matricesIndicesExtra&&S.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.gs.length/3*4)),!this.matricesWeightsExtra&&S.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.gs.length/3*4)));for(const S of B)if(S)if(G)this.ls&&!S.ls&&(S.ls=new Float32Array(S.gs.length)),this.tangents&&!S.tangents&&(S.tangents=new Float32Array(S.gs.length/3*4)),this.es&&!S.es&&(S.es=new Float32Array(S.gs.length/3*2)),this.uvs2&&!S.uvs2&&(S.uvs2=new Float32Array(S.gs.length/3*2)),this.uvs3&&!S.uvs3&&(S.uvs3=new Float32Array(S.gs.length/3*2)),this.uvs4&&!S.uvs4&&(S.uvs4=new Float32Array(S.gs.length/3*2)),this.uvs5&&!S.uvs5&&(S.uvs5=new Float32Array(S.gs.length/3*2)),this.uvs6&&!S.uvs6&&(S.uvs6=new Float32Array(S.gs.length/3*2)),this.Rs&&!S.Rs&&(S.Rs=new Float32Array(S.gs.length/3*4),S.Rs.fill(1)),this.matricesIndices&&!S.matricesIndices&&(S.matricesIndices=new Float32Array(S.gs.length/3*4)),this.matricesWeights&&!S.matricesWeights&&(S.matricesWeights=new Float32Array(S.gs.length/3*4)),this.matricesIndicesExtra&&!S.matricesIndicesExtra&&(S.matricesIndicesExtra=new Float32Array(S.gs.length/3*4)),this.matricesWeightsExtra&&!S.matricesWeightsExtra&&(S.matricesWeightsExtra=new Float32Array(S.gs.length/3*4));else if(S._validate(),!this.ls!==!S.ls||!this.tangents!==!S.tangents||!this.es!==!S.es||!this.uvs2!==!S.uvs2||!this.uvs3!==!S.uvs3||!this.uvs4!==!S.uvs4||!this.uvs5!==!S.uvs5||!this.uvs6!==!S.uvs6||!this.Rs!==!S.Rs||!this.matricesIndices!==!S.matricesIndices||!this.matricesWeights!==!S.matricesWeights||!this.matricesIndicesExtra!==!S.matricesIndicesExtra||!this.matricesWeightsExtra!==!S.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(v){let o=0,t=0,j=0;const S=[];let a=null;const O=[];for(const Z of this.splitBasedOnMaterialID())O.push({vertexData:Z,transform:s});for(const s of Z)if(s.vertexData)for(const Z of s.vertexData.splitBasedOnMaterialID())O.push({vertexData:Z,transform:s.transform});O.sort(((s,Z)=>{const o=s.vertexData.materialInfos?s.vertexData.materialInfos[0].materialIndex:0,t=Z.vertexData.materialInfos?Z.vertexData.materialInfos[0].materialIndex:0;return o>t?1:o===t?0:-1}));for(const s of O){const Z=s.vertexData;if(o=Z.materialInfos?Z.materialInfos[0].materialIndex:0,a&&a.materialIndex===o)a.indexCount+=Z.indices.length,a.verticesCount+=Z.gs.length/3;else{const s=new z;s.materialIndex=o,s.indexStart=t,s.indexCount=Z.indices.length,s.verticesStart=j,s.verticesCount=Z.gs.length/3,S.push(s),a=s}t+=Z.indices.length,j+=Z.gs.length/3}const v=O.splice(0,1)[0];Q=v.vertexData,s=v.transform,B=O.map((s=>s.vertexData)),Z=O,this.materialInfos=S}const D=B.reduce(((s,Z)=>{var o;return s+((null===(o=Z.indices)||void 0===o?void 0:o.length)??0)}),(null===(o=Q.indices)||void 0===o?void 0:o.length)??0);let b=O||B.some((s=>s.indices===Q.indices))?null===(t=Q.indices)||void 0===t?void 0:t.slice():Q.indices;if(D>0){var f;let o=(null===(f=b)||void 0===f?void 0:f.length)??0;if(b||(b=new Array(D)),b.length!==D){if(Array.isArray(b))b.length=D;else{const s=j||b instanceof Uint32Array?new Uint32Array(D):new Uint16Array(D);s.set(b),b=s}s&&s.determinant()<0&&Y._FlipFaces(b,0,o)}let t=Q.gs?Q.gs.length/3:0;for(const{vertexData:s,transform:j}of Z)if(s.indices){for(let Z=0;Z<s.indices.length;Z++)b[o+Z]=s.indices[Z]+t;j&&j.determinant()<0&&Y._FlipFaces(b,o,s.indices.length),t+=s.gs.length/3,o+=s.indices.length,a&&(yield)}}return this.indices=b,this.gs=Y._MergeElement(S.e.PositionKind,Q.gs,s,Z.map((s=>[s.vertexData.gs,s.transform]))),a&&(yield),Q.ls&&(this.ls=Y._MergeElement(S.e.NormalKind,Q.ls,s,Z.map((s=>[s.vertexData.ls,s.transform]))),a&&(yield)),Q.tangents&&(this.tangents=Y._MergeElement(S.e.TangentKind,Q.tangents,s,Z.map((s=>[s.vertexData.tangents,s.transform]))),a&&(yield)),Q.es&&(this.es=Y._MergeElement(S.e.UVKind,Q.es,s,Z.map((s=>[s.vertexData.es,s.transform]))),a&&(yield)),Q.uvs2&&(this.uvs2=Y._MergeElement(S.e.UV2Kind,Q.uvs2,s,Z.map((s=>[s.vertexData.uvs2,s.transform]))),a&&(yield)),Q.uvs3&&(this.uvs3=Y._MergeElement(S.e.UV3Kind,Q.uvs3,s,Z.map((s=>[s.vertexData.uvs3,s.transform]))),a&&(yield)),Q.uvs4&&(this.uvs4=Y._MergeElement(S.e.UV4Kind,Q.uvs4,s,Z.map((s=>[s.vertexData.uvs4,s.transform]))),a&&(yield)),Q.uvs5&&(this.uvs5=Y._MergeElement(S.e.UV5Kind,Q.uvs5,s,Z.map((s=>[s.vertexData.uvs5,s.transform]))),a&&(yield)),Q.uvs6&&(this.uvs6=Y._MergeElement(S.e.UV6Kind,Q.uvs6,s,Z.map((s=>[s.vertexData.uvs6,s.transform]))),a&&(yield)),Q.Rs&&(this.Rs=Y._MergeElement(S.e.ColorKind,Q.Rs,s,Z.map((s=>[s.vertexData.Rs,s.transform]))),(void 0!==Q.hasVertexAlpha||Z.some((s=>void 0!==s.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=Q.hasVertexAlpha||Z.some((s=>s.vertexData.hasVertexAlpha))),a&&(yield)),Q.matricesIndices&&(this.matricesIndices=Y._MergeElement(S.e.MatricesIndicesKind,Q.matricesIndices,s,Z.map((s=>[s.vertexData.matricesIndices,s.transform]))),a&&(yield)),Q.matricesWeights&&(this.matricesWeights=Y._MergeElement(S.e.MatricesWeightsKind,Q.matricesWeights,s,Z.map((s=>[s.vertexData.matricesWeights,s.transform]))),a&&(yield)),Q.matricesIndicesExtra&&(this.matricesIndicesExtra=Y._MergeElement(S.e.MatricesIndicesExtraKind,Q.matricesIndicesExtra,s,Z.map((s=>[s.vertexData.matricesIndicesExtra,s.transform]))),a&&(yield)),Q.matricesWeightsExtra&&(this.matricesWeightsExtra=Y._MergeElement(S.e.MatricesWeightsExtraKind,Q.matricesWeightsExtra,s,Z.map((s=>[s.vertexData.matricesWeightsExtra,s.transform])))),this}static _MergeElement(s,Z,o,t){const j=t.filter((s=>null!==s[0]&&void 0!==s[0]));if(!Z&&0==j.length)return Z;if(!Z)return this._MergeElement(s,j[0][0],j[0][1],j.slice(1));const a=j.reduce(((s,Z)=>s+Z[0].length),Z.length),O=s===S.e.PositionKind?Y._TransformVector3Coordinates:s===S.e.NormalKind?Y._TransformVector3Normals:s===S.e.TangentKind?Y._TransformVector4Normals:()=>{};if(Z instanceof Float32Array){const s=new Float32Array(a);s.set(Z),o&&O(s,o,0,Z.length);let t=Z.length;for(const[Z,o]of j)s.set(Z,t),o&&O(s,o,t,Z.length),t+=Z.length;return s}{const s=new Array(a);for(let o=0;o<Z.length;o++)s[o]=Z[o];o&&O(s,o,0,Z.length);let t=Z.length;for(const[Z,o]of j){for(let o=0;o<Z.length;o++)s[t+o]=Z[o];o&&O(s,o,t,Z.length),t+=Z.length}return s}}_validate(){if(!this.gs)throw new Q.g("Positions are required",Q.f.MeshInvalidPositionsError);const s=(s,Z)=>{const o=S.e.DeduceStride(s);if(Z.length%o!==0)throw new Error("The "+s+"s array count must be a multiple of "+o);return Z.length/o},Z=s(S.e.PositionKind,this.gs),o=(o,t)=>{const j=s(o,t);if(j!==Z)throw new Error("The "+o+"s element count ("+j+") does not match the positions count ("+Z+")")};this.ls&&o(S.e.NormalKind,this.ls),this.tangents&&o(S.e.TangentKind,this.tangents),this.es&&o(S.e.UVKind,this.es),this.uvs2&&o(S.e.UV2Kind,this.uvs2),this.uvs3&&o(S.e.UV3Kind,this.uvs3),this.uvs4&&o(S.e.UV4Kind,this.uvs4),this.uvs5&&o(S.e.UV5Kind,this.uvs5),this.uvs6&&o(S.e.UV6Kind,this.uvs6),this.Rs&&o(S.e.ColorKind,this.Rs),this.matricesIndices&&o(S.e.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&o(S.e.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&o(S.e.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&o(S.e.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const s=this.serialize();return Y.Parse(s)}serialize(){const s={};if(this.gs&&(s.gs=Array.from(this.gs)),this.ls&&(s.ls=Array.from(this.ls)),this.tangents&&(s.tangents=Array.from(this.tangents)),this.es&&(s.es=Array.from(this.es)),this.uvs2&&(s.uvs2=Array.from(this.uvs2)),this.uvs3&&(s.uvs3=Array.from(this.uvs3)),this.uvs4&&(s.uvs4=Array.from(this.uvs4)),this.uvs5&&(s.uvs5=Array.from(this.uvs5)),this.uvs6&&(s.uvs6=Array.from(this.uvs6)),this.Rs&&(s.Rs=Array.from(this.Rs),s.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(s.matricesIndices=Array.from(this.matricesIndices),s.matricesIndicesExpanded=!0),this.matricesWeights&&(s.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(s.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),s.matricesIndicesExtraExpanded=!0),this.matricesWeightsExtra&&(s.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),s.indices=this.indices?Array.from(this.indices):[],this.materialInfos){s.materialInfos=[];for(const Z of this.materialInfos){const o={indexStart:Z.indexStart,indexCount:Z.indexCount,materialIndex:Z.materialIndex,verticesStart:Z.verticesStart,verticesCount:Z.verticesCount};s.materialInfos.push(o)}}return s}static ExtractFromMesh(s,Z,o){return Y._ExtractFrom(s,Z,o)}static ExtractFromGeometry(s,Z,o){return Y._ExtractFrom(s,Z,o)}static _ExtractFrom(s,Z,o){const t=new Y;if(s.isVerticesDataPresent(S.e.PositionKind)&&(t.gs=s.getVerticesData(S.e.PositionKind,Z,o)),s.isVerticesDataPresent(S.e.NormalKind)&&(t.ls=s.getVerticesData(S.e.NormalKind,Z,o)),s.isVerticesDataPresent(S.e.TangentKind)&&(t.tangents=s.getVerticesData(S.e.TangentKind,Z,o)),s.isVerticesDataPresent(S.e.UVKind)&&(t.es=s.getVerticesData(S.e.UVKind,Z,o)),s.isVerticesDataPresent(S.e.UV2Kind)&&(t.uvs2=s.getVerticesData(S.e.UV2Kind,Z,o)),s.isVerticesDataPresent(S.e.UV3Kind)&&(t.uvs3=s.getVerticesData(S.e.UV3Kind,Z,o)),s.isVerticesDataPresent(S.e.UV4Kind)&&(t.uvs4=s.getVerticesData(S.e.UV4Kind,Z,o)),s.isVerticesDataPresent(S.e.UV5Kind)&&(t.uvs5=s.getVerticesData(S.e.UV5Kind,Z,o)),s.isVerticesDataPresent(S.e.UV6Kind)&&(t.uvs6=s.getVerticesData(S.e.UV6Kind,Z,o)),s.isVerticesDataPresent(S.e.ColorKind)){const j=s.Pa||s,a=j.getVertexBuffer(S.e.ColorKind),O=j.getVerticesData(S.e.ColorKind,Z,o);if(3===a.getSize()){const s=new Float32Array(4*O.length/3);for(let Z=0,o=0;Z<O.length;Z+=3,o+=4)s[o]=O[Z],s[o+1]=O[Z+1],s[o+2]=O[Z+2],s[o+3]=1;t.Rs=s}else{if(4!==a.getSize())throw new Error(`Unexpected number of color components: ${a.getSize()}`);t.Rs=O}}return s.isVerticesDataPresent(S.e.MatricesIndicesKind)&&(t.matricesIndices=s.getVerticesData(S.e.MatricesIndicesKind,Z,o)),s.isVerticesDataPresent(S.e.MatricesWeightsKind)&&(t.matricesWeights=s.getVerticesData(S.e.MatricesWeightsKind,Z,o)),s.isVerticesDataPresent(S.e.MatricesIndicesExtraKind)&&(t.matricesIndicesExtra=s.getVerticesData(S.e.MatricesIndicesExtraKind,Z,o)),s.isVerticesDataPresent(S.e.MatricesWeightsExtraKind)&&(t.matricesWeightsExtra=s.getVerticesData(S.e.MatricesWeightsExtraKind,Z,o)),t.indices=s.ra(Z,o),t}static CreateRibbon(s){throw(0,a.d)("ribbonBuilder")}static CreateBox(s){throw(0,a.d)("boxBuilder")}static CreateTiledBox(s){throw(0,a.d)("tiledBoxBuilder")}static CreateTiledPlane(s){throw(0,a.d)("tiledPlaneBuilder")}static CreateSphere(s){throw(0,a.d)("sphereBuilder")}static CreateCylinder(s){throw(0,a.d)("cylinderBuilder")}static CreateTorus(s){throw(0,a.d)("torusBuilder")}static CreateLineSystem(s){throw(0,a.d)("linesBuilder")}static CreateDashedLines(s){throw(0,a.d)("linesBuilder")}static CreateGround(s){throw(0,a.d)("groundBuilder")}static CreateTiledGround(s){throw(0,a.d)("groundBuilder")}static CreateGroundFromHeightMap(s){throw(0,a.d)("groundBuilder")}static Jv(s){throw(0,a.d)("planeBuilder")}static CreateDisc(s){throw(0,a.d)("discBuilder")}static CreatePolygon(s,Z,o,t,j,S,O){throw(0,a.d)("polygonBuilder")}static CreateIcoSphere(s){throw(0,a.d)("icoSphereBuilder")}static CreatePolyhedron(s){throw(0,a.d)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||j.n.Up();throw(0,a.d)("capsuleBuilder")}static CreateTorusKnot(s){throw(0,a.d)("torusKnotBuilder")}static ComputeNormals(s,Z,o,t){let S=0,a=0,O=0,v=0,G=0,B=0,Q=0,D=0,z=0,Y=0,b=0,f=0,A=0,d=0,U=0,u=0,H=0,F=0,i=0,N=0,L=!1,V=!1,g=!1,l=!1,R=1,e=0,c=null;t&&(L=!!t.facetNormals,V=!!t.facetPositions,g=!!t.facetPartitioning,R=!0===t.useRightHandedSystem?-1:1,e=t.ratio||0,l=!!t.depthSort,c=t.distanceTo,l&&void 0===c&&(c=j.n.Zero()));let w=0,X=0,W=0,q=0;for(g&&t&&t.bbSize&&(w=t.subDiv.X*e/t.bbSize.x,X=t.subDiv.Y*e/t.bbSize.y,W=t.subDiv.Z*e/t.bbSize.z,q=t.subDiv.max*t.subDiv.max,t.facetPartitioning.length=0),S=0;S<s.length;S++)o[S]=0;const h=Z.length/3|0;for(S=0;S<h;S++){if(f=3*Z[3*S],A=f+1,d=f+2,U=3*Z[3*S+1],u=U+1,H=U+2,F=3*Z[3*S+2],i=F+1,N=F+2,a=s[f]-s[U],O=s[A]-s[u],v=s[d]-s[H],G=s[F]-s[U],B=s[i]-s[u],Q=s[N]-s[H],D=R*(O*Q-v*B),z=R*(v*G-a*Q),Y=R*(a*B-O*G),b=Math.sqrt(D*D+z*z+Y*Y),b=0===b?1:b,D/=b,z/=b,Y/=b,L&&t&&(t.facetNormals[S].x=D,t.facetNormals[S].y=z,t.facetNormals[S].z=Y),V&&t&&(t.facetPositions[S].x=(s[f]+s[U]+s[F])/3,t.facetPositions[S].y=(s[A]+s[u]+s[i])/3,t.facetPositions[S].z=(s[d]+s[H]+s[N])/3),g&&t){const Z=Math.floor((t.facetPositions[S].x-t.bInfo.minimum.x*e)*w),o=Math.floor((t.facetPositions[S].y-t.bInfo.minimum.y*e)*X),j=Math.floor((t.facetPositions[S].z-t.bInfo.minimum.z*e)*W),a=Math.floor((s[f]-t.bInfo.minimum.x*e)*w),O=Math.floor((s[A]-t.bInfo.minimum.y*e)*X),v=Math.floor((s[d]-t.bInfo.minimum.z*e)*W),G=Math.floor((s[U]-t.bInfo.minimum.x*e)*w),B=Math.floor((s[u]-t.bInfo.minimum.y*e)*X),Q=Math.floor((s[H]-t.bInfo.minimum.z*e)*W),D=Math.floor((s[F]-t.bInfo.minimum.x*e)*w),z=Math.floor((s[i]-t.bInfo.minimum.y*e)*X),Y=Math.floor((s[N]-t.bInfo.minimum.z*e)*W),b=a+t.subDiv.max*O+q*v,L=G+t.subDiv.max*B+q*Q,V=D+t.subDiv.max*z+q*Y,g=Z+t.subDiv.max*o+q*j;t.facetPartitioning[g]=t.facetPartitioning[g]?t.facetPartitioning[g]:[],t.facetPartitioning[b]=t.facetPartitioning[b]?t.facetPartitioning[b]:[],t.facetPartitioning[L]=t.facetPartitioning[L]?t.facetPartitioning[L]:[],t.facetPartitioning[V]=t.facetPartitioning[V]?t.facetPartitioning[V]:[],t.facetPartitioning[b].push(S),L!=b&&t.facetPartitioning[L].push(S),V!=L&&V!=b&&t.facetPartitioning[V].push(S),g!=b&&g!=L&&g!=V&&t.facetPartitioning[g].push(S)}if(l&&t&&t.facetPositions){const s=t.depthSortedFacets[S];s.ind=3*S,s.sqDistance=j.n.DistanceSquared(t.facetPositions[S],c)}o[f]+=D,o[A]+=z,o[d]+=Y,o[U]+=D,o[u]+=z,o[H]+=Y,o[F]+=D,o[i]+=z,o[N]+=Y}for(S=0;S<o.length/3;S++)D=o[3*S],z=o[3*S+1],Y=o[3*S+2],b=Math.sqrt(D*D+z*z+Y*Y),b=0===b?1:b,D/=b,z/=b,Y/=b,o[3*S]=D,o[3*S+1]=z,o[3*S+2]=Y}static _ComputeSides(s,Z,o,t,S,a,O){const v=o.length,G=t.length;let B,Q;switch(s=s||Y.DEFAULTSIDE){case Y.FRONTSIDE:break;case Y.BACKSIDE:for(B=0;B<v;B+=3){const s=o[B];o[B]=o[B+2],o[B+2]=s}for(Q=0;Q<G;Q++)t[Q]=-t[Q];break;case Y.DOUBLESIDE:{const s=Z.length,D=s/3;for(let o=0;o<s;o++)Z[s+o]=Z[o];for(B=0;B<v;B+=3)o[B+v]=o[B+2]+D,o[B+1+v]=o[B+1]+D,o[B+2+v]=o[B]+D;for(Q=0;Q<G;Q++)t[G+Q]=-t[Q];const z=S.length;let Y=0;for(Y=0;Y<z;Y++)S[Y+z]=S[Y];for(a=a||new j.p(0,0,1,1),O=O||new j.p(0,0,1,1),Y=0,B=0;B<z/2;B++)S[Y]=a.x+(a.z-a.x)*S[Y],S[Y+1]=a.y+(a.w-a.y)*S[Y+1],S[Y+z]=O.x+(O.z-O.x)*S[Y+z],S[Y+z+1]=O.y+(O.w-O.y)*S[Y+z+1],Y+=2;break}}}static Parse(s){const Z=new Y,o=s.gs;o&&Z.set(o,S.e.PositionKind);const t=s.ls;t&&Z.set(t,S.e.NormalKind);const j=s.tangents;j&&Z.set(j,S.e.TangentKind);const a=s.es;a&&Z.set(a,S.e.UVKind);const v=s.uvs2;v&&Z.set(v,S.e.UV2Kind);const G=s.uvs3;G&&Z.set(G,S.e.UV3Kind);const B=s.uvs4;B&&Z.set(B,S.e.UV4Kind);const Q=s.uvs5;Q&&Z.set(Q,S.e.UV5Kind);const D=s.uvs6;D&&Z.set(D,S.e.UV6Kind);const b=s.Rs;b&&(Z.set(O.h.CheckColors4(b,o.length/3),S.e.ColorKind),void 0!==s.hasVertexAlpha&&(Z.hasVertexAlpha=s.hasVertexAlpha));const f=s.matricesIndices;f&&Z.set(f,S.e.MatricesIndicesKind);const A=s.matricesWeights;A&&Z.set(A,S.e.MatricesWeightsKind);const d=s.indices;d&&(Z.indices=d);const U=s.materialInfos;if(U){Z.materialInfos=[];for(const s of U){const o=new z;o.indexCount=s.indexCount,o.indexStart=s.indexStart,o.verticesCount=s.verticesCount,o.verticesStart=s.verticesStart,o.materialIndex=s.materialIndex,Z.materialInfos.push(o)}}return Z}static ImportVertexData(s,Z){const o=Y.Parse(s);Z.setAllVerticesData(o,s.updatable)}}Y.FRONTSIDE=0,Y.BACKSIDE=1,Y.DOUBLESIDE=2,Y.DEFAULTSIDE=0,Y._UniqueIdGenerator=0,(0,t.c)([G.e.filter((function(){for(var s=arguments.length,Z=new Array(s),o=0;o<s;o++)Z[o]=arguments[o];let[t]=Z;return!Array.isArray(t)}))],Y,"_TransformVector3Coordinates",null),(0,t.c)([G.e.filter((function(){for(var s=arguments.length,Z=new Array(s),o=0;o<s;o++)Z[o]=arguments[o];let[t]=Z;return!Array.isArray(t)}))],Y,"_TransformVector3Normals",null),(0,t.c)([G.e.filter((function(){for(var s=arguments.length,Z=new Array(s),o=0;o<s;o++)Z[o]=arguments[o];let[t]=Z;return!Array.isArray(t)}))],Y,"_TransformVector4Normals",null),(0,t.c)([G.e.filter((function(){for(var s=arguments.length,Z=new Array(s),o=0;o<s;o++)Z[o]=arguments[o];let[t]=Z;return!Array.isArray(t)}))],Y,"_FlipFaces",null)},11108:(s,Z,o)=>{o.d(Z,{b:()=>v});var t=o(11113),j=o(11126),S=o(11130),a=o(11145),O=o(11151);class v{get materialDefines(){var s;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(s=this._getDrawWrapper())||void 0===s?void 0:s.defines}set materialDefines(s){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=s}_getDrawWrapper(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];s=s??this._engine.currentRenderPassId;let o=this._drawWrappers[s];return!o&&Z&&(this._drawWrappers[s]=o=new O.e(this._mesh.Ls().getEngine())),o}_removeDrawWrapper(s){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var o;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(o=this._drawWrappers[s])||void 0===o||o.dispose(Z));this._drawWrappers[s]=void 0}get effect(){var s;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(s=this._getDrawWrapper())||void 0===s?void 0:s.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(s){this._mainDrawWrapperOverride=s}setEffect(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2?arguments[2]:void 0,t=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const j=this._drawWrapper;j.setEffect(s,Z,t),void 0!==o&&(j.materialContext=o),s||(j.defines=null,j.materialContext=void 0)}resetDrawCache(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==s)return void this._removeDrawWrapper(s,!0,Z);for(const s of this._drawWrappers)null===s||void 0===s||s.dispose(Z)}this._drawWrappers=[]}static AddToMesh(s,Z,o,t,j,S,a){return new v(s,Z,o,t,j,S,a,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(s,Z,o,t,j,S,a){let O=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],v=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=s,this.verticesStart=Z,this.verticesCount=o,this.indexStart=t,this.indexCount=j,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=S,this._renderingMesh=a||S,v&&S.vO.push(this),this._engine=this._mesh.Ls().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=S.vO.length-1,O&&(this.refreshBoundingInfo(),S.Ea(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(s){return this._boundingInfo=s,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const s=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return s||this._renderingMesh}Ms(){let s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const Z=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!Z)return s&&this._mesh.Ls()._hasDefaultMaterial?this._mesh.Ls().defaultMaterial:null;if(this._isMultiMaterial(Z)){const s=Z.getSubMaterial(this.materialIndex);return this._currentMaterial!==s&&(this._currentMaterial=s,this.resetDrawCache()),s}return Z}_isMultiMaterial(s){return void 0!==s.getSubMaterial}refreshBoundingInfo(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.Pa)return this;if(s||(s=this._renderingMesh.getVerticesData(t.e.PositionKind)),!s)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const Z=this._renderingMesh.ra();let o;if(0===this.indexStart&&this.indexCount===Z.length){const s=this._renderingMesh.getBoundingInfo();o={minimum:s.minimum.clone(),maximum:s.maximum.clone()}}else o=(0,a.c)(s,Z,this.indexStart,this.indexCount,this._renderingMesh.Pa.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(o.minimum,o.maximum):this._boundingInfo=new S.e(o.minimum,o.maximum),this}_checkCollision(s){return this.getBoundingInfo()._checkCollision(s)}updateBoundingInfo(s){let Z=this.getBoundingInfo();return Z||(this.refreshBoundingInfo(),Z=this.getBoundingInfo()),Z&&Z.update(s),this}isInFrustum(s){const Z=this.getBoundingInfo();return!!Z&&Z.isInFrustum(s,this._mesh.CB)}isCompletelyInFrustum(s){const Z=this.getBoundingInfo();return!!Z&&Z.isCompletelyInFrustum(s)}render(s){return this._renderingMesh.render(this,s,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(s,Z){if(!this._linesIndexBuffer){const o=6*Math.floor(this.indexCount/3),t=this.verticesStart+this.verticesCount>65535?new Uint32Array(o):new Uint16Array(o);let j=0;if(0===s.length)for(let s=this.indexStart;s<this.indexStart+this.indexCount;s+=3)t[j++]=s,t[j++]=s+1,t[j++]=s+1,t[j++]=s+2,t[j++]=s+2,t[j++]=s;else for(let Z=this.indexStart;Z<this.indexStart+this.indexCount;Z+=3)t[j++]=s[Z],t[j++]=s[Z+1],t[j++]=s[Z+1],t[j++]=s[Z+2],t[j++]=s[Z+2],t[j++]=s[Z];this._linesIndexBuffer=Z.createIndexBuffer(t),this._linesIndexCount=t.length}return this._linesIndexBuffer}canIntersects(s){const Z=this.getBoundingInfo();return!!Z&&s.intersectsBox(Z.boundingBox)}intersects(s,Z,o,t,j){const S=this.Ms();if(!S)return null;let a=3,O=!1;switch(S.fillMode){case 3:case 5:case 6:case 8:return null;case 7:a=1,O=!0}return 4===S.fillMode?o.length?this._intersectLines(s,Z,o,this._mesh.intersectionThreshold,t):this._intersectUnIndexedLines(s,Z,o,this._mesh.intersectionThreshold,t):!o.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(s,Z,o,t,j):this._intersectTriangles(s,Z,o,a,O,t,j)}_intersectLines(s,Z,o,t,S){let a=null;for(let O=this.indexStart;O<this.indexStart+this.indexCount;O+=2){const v=Z[o[O]],G=Z[o[O+1]],B=s.intersectionSegment(v,G,t);if(!(B<0)&&((S||!a||B<a.distance)&&(a=new j.d(null,null,B),a.faceId=O/2,S)))break}return a}_intersectUnIndexedLines(s,Z,o,t,S){let a=null;for(let O=this.verticesStart;O<this.verticesStart+this.verticesCount;O+=2){const o=Z[O],v=Z[O+1],G=s.intersectionSegment(o,v,t);if(!(G<0)&&((S||!a||G<a.distance)&&(a=new j.d(null,null,G),a.faceId=O/2,S)))break}return a}_intersectTriangles(s,Z,o,t,j,S,a){let O=null,v=-1;for(let G=this.indexStart;G<this.indexStart+this.indexCount-(3-t);G+=t){v++;const t=o[G],B=o[G+1],Q=o[G+2];if(j&&4294967295===Q){G+=2;continue}const D=Z[t],z=Z[B],Y=Z[Q];if(!D||!z||!Y)continue;if(a&&!a(D,z,Y,s,t,B,Q))continue;const b=s.intersectsTriangle(D,z,Y);if(b){if(b.distance<0)continue;if((S||!O||b.distance<O.distance)&&(O=b,O.faceId=v,S))break}}return O}_intersectUnIndexedTriangles(s,Z,o,t,j){let S=null;for(let a=this.verticesStart;a<this.verticesStart+this.verticesCount;a+=3){const o=Z[a],O=Z[a+1],v=Z[a+2];if(j&&!j(o,O,v,s,-1,-1,-1))continue;const G=s.intersectsTriangle(o,O,v);if(G){if(G.distance<0)continue;if((t||!S||G.distance<S.distance)&&(S=G,S.faceId=a/3,t))break}}return S}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(s,Z){const o=new v(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,s,Z,!1);if(!this.IsGlobal){const s=this.getBoundingInfo();if(!s)return o;o._boundingInfo=new S.e(s.minimum,s.maximum)}return o}dispose(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.Ls().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const Z=this._mesh.vO.indexOf(this);this._mesh.vO.splice(Z,1),this.resetDrawCache(void 0,s)}getClassName(){return"SubMesh"}static CreateFromIndices(s,Z,o,t,j){let S=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=Number.MAX_VALUE,O=-Number.MAX_VALUE;const G=(j||t).ra();for(let v=Z;v<Z+o;v++){const s=G[v];s<a&&(a=s),s>O&&(O=s)}return new v(s,a,O-a+1,Z,o,t,j,S)}}},11656:(s,Z,o)=>{var t=o(11240),j=o(11113),S=o(10900),a=o(10955),O=o(11130);t.d.prototype.thinInstanceAdd=function(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.Ls().getEngine().getCaps().instancedArrays)return a.b.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(s)?s.length:1);const o=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(s))for(let t=0;t<s.length;++t)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,s[t],t===s.length-1&&Z);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,s,Z);return o},t.d.prototype.thinInstanceAddSelf=function(){let s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(S.b.IdentityReadOnly,s)},t.d.prototype.thinInstanceRegisterAttribute=function(s,Z){s===j.e.ColorKind&&(s=j.e.ColorInstanceKind),this.removeVerticesData(s),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[s]=Z,this._userThinInstanceBuffersStorage.sizes[s]=Z*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[s]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[s]),this._userThinInstanceBuffersStorage.vertexBuffers[s]=new j.e(this.getEngine(),this._userThinInstanceBuffersStorage.data[s],s,!0,!1,Z,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[s])},t.d.prototype.thinInstanceSetMatrixAt=function(s,Z){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||s>=this._thinInstanceDataStorage.instancesCount)return!1;const t=this._thinInstanceDataStorage.matrixData;return Z.copyToArray(t,16*s),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[s]=Z),o&&(this.EB("matrix"),this.Xs||this.thinInstanceRefreshBoundingInfo(!1)),!0},t.d.prototype.thinInstanceSetAttributeAt=function(s,Z,o){let t=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return s===j.e.ColorKind&&(s=j.e.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[s]||Z>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(s,0),this._userThinInstanceBuffersStorage.data[s].set(o,Z*this._userThinInstanceBuffersStorage.strides[s]),t&&this.EB(s),!0)},Object.defineProperty(t.d.prototype,"BO",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(s){var Z;const o=this._thinInstanceDataStorage.matrixData??(null===(Z=this.source)||void 0===Z?void 0:Z._thinInstanceDataStorage.matrixData);s<=(o?o.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=s)},enumerable:!0,configurable:!0}),t.d.prototype._thinInstanceCreateMatrixBuffer=function(s,Z){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const t=new j.c(this.getEngine(),Z,!o,16,!1,!0);for(let j=0;j<4;j++)this.setVerticesBuffer(t.createVertexBuffer(s+j,4*j,4));return t},t.d.prototype.pB=function(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var S;if(o=o||16,"matrix"===s)null===(S=this._thinInstanceDataStorage.matrixBuffer)||void 0===S||S.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=Z?Z.length:32*o,this._thinInstanceDataStorage.matrixData=Z,this._thinInstanceDataStorage.worldMatrices=null,null!==Z?(this._thinInstanceDataStorage.instancesCount=Z.length/o,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",Z,t),this.Xs||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.Xs||this.refreshBoundingInfo());else if("previousMatrix"===s){var a;null===(a=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===a||a.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=Z,null!==Z&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",Z,t))}else{var O;if(s===j.e.ColorKind&&(s=j.e.ColorInstanceKind),null===Z)null!==(O=this._userThinInstanceBuffersStorage)&&void 0!==O&&O.data[s]&&(this.removeVerticesData(s),delete this._userThinInstanceBuffersStorage.data[s],delete this._userThinInstanceBuffersStorage.strides[s],delete this._userThinInstanceBuffersStorage.sizes[s],delete this._userThinInstanceBuffersStorage.vertexBuffers[s]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[s]=Z,this._userThinInstanceBuffersStorage.strides[s]=o,this._userThinInstanceBuffersStorage.sizes[s]=Z.length,this._userThinInstanceBuffersStorage.vertexBuffers[s]=new j.e(this.getEngine(),Z,s,!t,!1,o,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[s])}},t.d.prototype.EB=function(s){var Z;if("matrix"===s)this.rQ&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(s),null===(Z=this._thinInstanceDataStorage.matrixBuffer)||void 0===Z||Z.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===s){var o;this.rQ&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(s),null===(o=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===o||o.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var t;s===j.e.ColorKind&&(s=j.e.ColorInstanceKind),null!==(t=this._userThinInstanceBuffersStorage)&&void 0!==t&&t.vertexBuffers[s]&&(this.rQ&&!this._userThinInstanceBuffersStorage.vertexBuffers[s].isUpdatable()&&this._thinInstanceRecreateBuffer(s),this._userThinInstanceBuffersStorage.vertexBuffers[s].updateDirectly(this._userThinInstanceBuffersStorage.data[s],0))}},t.d.prototype.thinInstancePartialBufferUpdate=function(s,Z,o){var t;"matrix"===s?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(Z,o):(s===j.e.ColorKind&&(s=j.e.ColorInstanceKind),null!==(t=this._userThinInstanceBuffersStorage)&&void 0!==t&&t.vertexBuffers[s]&&this._userThinInstanceBuffersStorage.vertexBuffers[s].updateDirectly(Z,o))},t.d.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const s=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let Z=0;Z<this._thinInstanceDataStorage.instancesCount;++Z)this._thinInstanceDataStorage.worldMatrices[Z]=S.b.oO(s,16*Z)}return this._thinInstanceDataStorage.worldMatrices},t.d.prototype.thinInstanceRefreshBoundingInfo=function(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const t=this._thinInstanceDataStorage.boundingVectors;if(s||!this.rawBoundingInfo){t.length=0,this.refreshBoundingInfo(Z,o);const s=this.getBoundingInfo();this.rawBoundingInfo=new O.e(s.minimum,s.maximum)}const j=this.getBoundingInfo(),a=this._thinInstanceDataStorage.matrixData;if(0===t.length)for(let S=0;S<j.boundingBox.vectors.length;++S)t.push(j.boundingBox.vectors[S].clone());S.g.sO[0].tO(Number.POSITIVE_INFINITY),S.g.sO[1].tO(Number.NEGATIVE_INFINITY);for(let O=0;O<this._thinInstanceDataStorage.instancesCount;++O){S.b.FromArrayToRef(a,16*O,S.g.Matrix[0]);for(let s=0;s<t.length;++s)S.n.TransformCoordinatesToRef(t[s],S.g.Matrix[0],S.g.sO[2]),S.g.sO[0].minimizeInPlace(S.g.sO[2]),S.g.sO[1].maximizeInPlace(S.g.sO[2])}j.reConstruct(S.g.sO[0],S.g.sO[1]),this.Ws()},t.d.prototype._thinInstanceRecreateBuffer=function(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var o;if("matrix"===s)null===(o=this._thinInstanceDataStorage.matrixBuffer)||void 0===o||o.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,Z);else if("previousMatrix"===s){var t;if(this._scene.needsPreviousWorldMatrices)null===(t=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===t||t.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,Z)}else{var S;s===j.e.ColorKind&&(s=j.e.ColorInstanceKind),null===(S=this._userThinInstanceBuffersStorage.vertexBuffers[s])||void 0===S||S.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[s]=new j.e(this.getEngine(),this._userThinInstanceBuffersStorage.data[s],s,!Z,!1,this._userThinInstanceBuffersStorage.strides[s],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[s])}},t.d.prototype._thinInstanceUpdateBufferSize=function(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;s===j.e.ColorKind&&(s=j.e.ColorInstanceKind);const o="matrix"===s;if(!o&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[s]))return;const t=o?16:this._userThinInstanceBuffersStorage.strides[s],S=o?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[s];let a=o?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[s];const O=(this._thinInstanceDataStorage.instancesCount+Z)*t;let v=S;for(;v<O;)v*=2;if(!a||S!=v){if(a){const s=new Float32Array(v);s.set(a,0),a=s}else a=new Float32Array(v);var G,B,Q;if(o){if(null===(G=this._thinInstanceDataStorage.matrixBuffer)||void 0===G||G.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",a,!1),this._thinInstanceDataStorage.matrixData=a,this._thinInstanceDataStorage.matrixBufferSize=v,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(B=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===B||B.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",a,!1)}else null===(Q=this._userThinInstanceBuffersStorage.vertexBuffers[s])||void 0===Q||Q.dispose(),this._userThinInstanceBuffersStorage.data[s]=a,this._userThinInstanceBuffersStorage.sizes[s]=v,this._userThinInstanceBuffersStorage.vertexBuffers[s]=new j.e(this.getEngine(),a,s,!0,!1,t,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[s])}},t.d.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},t.d.prototype._disposeThinInstanceSpecificData=function(){var s;null!==(s=this._thinInstanceDataStorage)&&void 0!==s&&s.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},11197:(s,Z,o)=>{o.d(Z,{c:()=>B});var t=o(11086),j=o(11091),S=o(11167),a=o(10932),O=o(10900),v=o(11201),G=o(10916);class B extends v.d{get billboardMode(){return this._billboardMode}set billboardMode(s){this._billboardMode!==s&&(this._billboardMode=s,this._cache.useBillboardPosition=0!==(this._billboardMode&B.BILLBOARDMODE_USE_POSITION))}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(s){this._infiniteDistance!==s&&(this._infiniteDistance=s)}constructor(s){let Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(s,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new O.n(0,0,1),this._up=new O.n(0,1,0),this._right=new O.n(1,0,0),this._position=O.n.Zero(),this._rotation=O.n.Zero(),this._rotationQuaternion=null,this._scaling=O.n.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=B.BILLBOARDMODE_NONE,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.nQ=O.b.Zero(),this._usePivotMatrix=!1,this._absolutePosition=O.n.Zero(),this._absoluteScaling=O.n.Zero(),this._absoluteRotationQuaternion=O.e.Identity(),this._pivotMatrix=O.b.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new a.b,this._nonUniformScaling=!1,Z&&this.Ls().addTransformNode(this)}getClassName(){return"dY"}get position(){return this._position}set position(s){this._position=s,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(s){this._rotation=s,this._rotationQuaternion=null,this._markAsDirtyInternal()}get ZO(){return this._scaling}set ZO(s){this._scaling=s,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(s){this._rotationQuaternion=s,s&&this._rotation.tO(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return O.n.TransformNormalFromFloatsToRef(0,0,this.Ls().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return O.n.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return O.n.TransformNormalFromFloatsToRef(this.Ls().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(s){return this._poseMatrix?(this._poseMatrix.O(s),this):(this._poseMatrix=s.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=O.b.Identity()),this._poseMatrix}_isSynchronized(){const s=this._cache;return this._billboardMode===s.billboardMode&&this._billboardMode===B.BILLBOARDMODE_NONE&&(!s.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const s=this._cache;s.localMatrixUpdated=!1,s.billboardMode=-1,s.infiniteDistance=!1,s.useBillboardPosition=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(s){return this.setPivotMatrix(s,!1)}setPivotMatrix(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.O(s),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=Z,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=O.b.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,Z=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;const t=this.clone("Clone of "+(this.name||this.id),s||this.parent,!0);t&&o&&o(this,t);for(const j of this.getChildTransformNodes(!0))j.instantiateHierarchy(t,Z,o);return t}dO(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return s?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.tO(0),this._rotationQuaternion=this._rotationQuaternion||O.e.Identity(),s.decompose(this._scaling,this._rotationQuaternion,this._position),this.Ea(!0)):(this._worldMatrix=s,this._absolutePosition.Ja(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.Ea(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.Ea(!0),this}get VQ(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.Ea(),this._absolutePosition}setAbsolutePosition(s){if(!s)return this;let Z,o,t;if(void 0===s.x){if(arguments.length<3)return this;Z=arguments[0],o=arguments[1],t=arguments[2]}else Z=s.x,o=s.y,t=s.z;if(this.parent){const s=O.g.Matrix[0];this.parent.getWorldMatrix().invertToRef(s),O.n.TransformCoordinatesFromFloatsToRef(Z,o,t,s,this.position)}else this.position.x=Z,this.position.y=o,this.position.z=t;return this._absolutePosition.O(s),this}setPositionWithLocalVector(s){return this.Ea(),this.position=O.n.TransformNormal(s,this.nQ),this}getPositionExpressedInLocalSpace(){this.Ea();const s=O.g.Matrix[0];return this.nQ.invertToRef(s),O.n.TransformNormal(this.position,s)}locallyTranslate(s){return this.Ea(!0),this.position=O.n.TransformCoordinates(s,this.nQ),this}lookAt(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const S=B._LookAtVectorCache,a=0===j?this.position:this.getAbsolutePosition();if(s.subtractToRef(a,S),this.setDirection(S,Z,o,t),1===j&&this.parent)if(this.rotationQuaternion){const s=O.g.Matrix[0];this.rotationQuaternion.toRotationMatrix(s);const Z=O.g.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(Z),Z.invert(),s.multiplyToRef(Z,s),this.rotationQuaternion.fromRotationMatrix(s)}else{const s=O.g.Quaternion[0];O.e.FromEulerVectorToRef(this.rotation,s);const Z=O.g.Matrix[0];s.toRotationMatrix(Z);const o=O.g.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(o),o.invert(),Z.multiplyToRef(o,Z),s.fromRotationMatrix(Z),s.toEulerAnglesToRef(this.rotation)}return this}Bv(s){const Z=O.n.Zero();return this.getDirectionToRef(s,Z),Z}getDirectionToRef(s,Z){return O.n.TransformNormalToRef(s,this.getWorldMatrix(),Z),this}setDirection(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const j=-Math.atan2(s.z,s.x)+Math.PI/2,S=Math.sqrt(s.x*s.x+s.z*s.z),a=-Math.atan2(s.y,S);return this.rotationQuaternion?O.e.RotationYawPitchRollToRef(j+Z,a+o,t,this.rotationQuaternion):(this.rotation.x=a+o,this.rotation.y=j+Z,this.rotation.z=t),this}setPivotPoint(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.Ls().getRenderId()&&this.Ea(!0);const o=this.getWorldMatrix();if(1==Z){const Z=O.g.Matrix[0];o.invertToRef(Z),s=O.n.TransformCoordinates(s,Z)}return this.setPivotMatrix(O.b.Translation(-s.x,-s.y,-s.z),!0)}getPivotPoint(){const s=O.n.Zero();return this.getPivotPointToRef(s),s}getPivotPointToRef(s){return s.x=-this._pivotMatrix.m[12],s.y=-this._pivotMatrix.m[13],s.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const s=O.n.Zero();return this.getAbsolutePivotPointToRef(s),s}getAbsolutePivotPointToRef(s){return this.getPivotPointToRef(s),O.n.TransformCoordinatesToRef(s,this.getWorldMatrix(),s),this}dG(s){if(this._isDirty)return this;if(this._children)for(const Z of this._children)Z.dG(s);return super.dG(s)}setParent(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!s&&!this.parent)return this;const t=O.g.Quaternion[0],j=O.g.sO[0],S=O.g.sO[1],a=O.g.Matrix[1];O.b.IdentityToRef(a);const v=O.g.Matrix[0];this.Ea(!0);let G=this.rotationQuaternion;return G||(G=B._TmpRotation,O.e.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,G)),O.b.ComposeToRef(this.ZO,G,this.position,v),this.parent&&v.multiplyToRef(this.parent.Ea(!0),v),s&&(s.Ea(!0).invertToRef(a),v.multiplyToRef(a,v)),v.decompose(S,t,j,Z?this:void 0),this.rotationQuaternion?this.rotationQuaternion.O(t):t.toEulerAnglesToRef(this.rotation),this.ZO.O(S),this.position.O(j),this.parent=s,o&&this.setPivotMatrix(O.b.Identity()),this}addChild(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return s.setParent(this,Z),this}removeChild(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return s.parent!==this||s.setParent(null,Z),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(s){return this._nonUniformScaling!==s&&(this._nonUniformScaling=s,!0)}attachToBone(s,Z){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=Z,this.parent=s,s.getSkeleton().prepare(!0),s.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=s?this._currentParentWhenAttachingToBone:null,this):(s&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(s,Z,o){let t;if(s.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.tO(0)),o&&0!==o){if(this.parent){const o=this.parent.getWorldMatrix(),t=O.g.Matrix[0];o.invertToRef(t),s=O.n.TransformNormal(s,t),o.determinant()<0&&(Z*=-1)}t=O.e.RotationAxisToRef(s,Z,B._RotationAxisCache),t.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else t=O.e.RotationAxisToRef(s,Z,B._RotationAxisCache),this.rotationQuaternion.multiplyToRef(t,this.rotationQuaternion);return this}rotateAround(s,Z,o){Z.normalize(),this.rotationQuaternion||(this.rotationQuaternion=O.e.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.tO(0));const t=O.g.sO[0],j=O.g.sO[1],S=O.g.sO[2],a=O.g.Quaternion[0],v=O.g.Matrix[0],G=O.g.Matrix[1],B=O.g.Matrix[2],Q=O.g.Matrix[3];return s.subtractToRef(this.position,t),O.b.TranslationToRef(t.x,t.y,t.z,v),O.b.TranslationToRef(-t.x,-t.y,-t.z,G),O.b.RotationAxisToRef(Z,o,B),G.multiplyToRef(B,Q),Q.multiplyToRef(v,Q),Q.decompose(j,a,S),this.position.addInPlace(S),a.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(s,Z,o){const t=s.scale(Z);if(o&&0!==o)this.setAbsolutePosition(this.getAbsolutePosition().add(t));else{const s=this.getPositionExpressedInLocalSpace().add(t);this.setPositionWithLocalVector(s)}return this}addRotation(s,Z,o){let t;this.rotationQuaternion?t=this.rotationQuaternion:(t=O.g.Quaternion[1],O.e.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,t));const j=O.g.Quaternion[0];return O.e.RotationYawPitchRollToRef(Z,s,o,j),t.multiplyInPlace(j),this.rotationQuaternion||t.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==B.BILLBOARDMODE_NONE}Ea(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const o=this.Ls().getRenderId();if(!this._isDirty&&!s&&(this._currentRenderId===o||this.isSynchronized()))return this._currentRenderId=o,this._worldMatrix;Z=Z||this.Ls().activeCamera,this._updateCache();const t=this._cache;t.pivotMatrixUpdated=!1,t.billboardMode=this.billboardMode,t.infiniteDistance=this.infiniteDistance,t.parent=this._parentNode,this._currentRenderId=o,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const j=this._getEffectiveParent(),S=B._TmpScaling;let a,v=this._position;if(this._infiniteDistance&&!this.parent&&Z){const s=Z.getWorldMatrix(),o=new O.n(s.m[12],s.m[13],s.m[14]);v=B._TmpTranslation,v.Ja(this._position.x+o.x,this._position.y+o.y,this._position.z+o.z)}if(S.Ja(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,a=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(O.e.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.Ja(0,0,0))}}else a=B._TmpRotation,O.e.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,a);if(this._usePivotMatrix){const s=O.g.Matrix[1];O.b.ScalingToRef(S.x,S.y,S.z,s);const Z=O.g.Matrix[0];a.toRotationMatrix(Z),this._pivotMatrix.multiplyToRef(s,O.g.Matrix[4]),O.g.Matrix[4].multiplyToRef(Z,this.nQ),this._postMultiplyPivotMatrix&&this.nQ.multiplyToRef(this._pivotMatrixInverse,this.nQ),this.nQ.addTranslationFromFloats(v.x,v.y,v.z)}else O.b.ComposeToRef(S,a,v,this.nQ);if(j&&j.getWorldMatrix){if(s&&j.Ea(s),this.billboardMode){if(this._transformToBoneReferal){const s=this.parent;s.getSkeleton().prepare(),s.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),O.g.Matrix[7])}else O.g.Matrix[7].O(j.getWorldMatrix());const s=O.g.sO[5],Z=O.g.sO[6],o=O.g.Quaternion[0];O.g.Matrix[7].decompose(Z,o,s),O.b.ScalingToRef(Z.x,Z.y,Z.z,O.g.Matrix[7]),O.g.Matrix[7].setTranslation(s),B.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(o,s),this.nQ.setTranslation(s)),this.nQ.multiplyToRef(O.g.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const s=this.parent;s.getSkeleton().prepare(),this.nQ.multiplyToRef(s.getFinalMatrix(),O.g.Matrix[6]),O.g.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.nQ.multiplyToRef(j.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.O(this.nQ);if(Z&&this.billboardMode)if(t.useBillboardPosition){if(t.useBillboardPosition){const s=O.g.sO[0];this._worldMatrix.getTranslationToRef(s);const o=Z.globalPosition;this._worldMatrix.invertToRef(O.g.Matrix[1]);const t=O.g.sO[1];O.n.TransformCoordinatesToRef(o,O.g.Matrix[1],t),t.normalize();const j=-Math.atan2(t.z,t.x)+Math.PI/2,S=Math.sqrt(t.x*t.x+t.z*t.z),a=-Math.atan2(t.y,S);if(O.e.RotationYawPitchRollToRef(j,a,0,O.g.Quaternion[0]),(this.billboardMode&B.BILLBOARDMODE_ALL)!==B.BILLBOARDMODE_ALL){const s=O.g.sO[1];O.g.Quaternion[0].toEulerAnglesToRef(s),(this.billboardMode&B.BILLBOARDMODE_X)!==B.BILLBOARDMODE_X&&(s.x=0),(this.billboardMode&B.BILLBOARDMODE_Y)!==B.BILLBOARDMODE_Y&&(s.y=0),(this.billboardMode&B.BILLBOARDMODE_Z)!==B.BILLBOARDMODE_Z&&(s.z=0),O.b.RotationYawPitchRollToRef(s.y,s.x,s.z,O.g.Matrix[0])}else O.b.FromQuaternionToRef(O.g.Quaternion[0],O.g.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(O.g.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(O.g.sO[0])}}else{const s=O.g.sO[0];if(this._worldMatrix.getTranslationToRef(s),O.g.Matrix[1].O(Z.getViewMatrix()),O.g.Matrix[1].setTranslationFromFloats(0,0,0),O.g.Matrix[1].invertToRef(O.g.Matrix[0]),(this.billboardMode&B.BILLBOARDMODE_ALL)!==B.BILLBOARDMODE_ALL){O.g.Matrix[0].decompose(void 0,O.g.Quaternion[0],void 0);const s=O.g.sO[1];O.g.Quaternion[0].toEulerAnglesToRef(s),(this.billboardMode&B.BILLBOARDMODE_X)!==B.BILLBOARDMODE_X&&(s.x=0),(this.billboardMode&B.BILLBOARDMODE_Y)!==B.BILLBOARDMODE_Y&&(s.y=0),(this.billboardMode&B.BILLBOARDMODE_Z)!==B.BILLBOARDMODE_Z&&(s.z=0),O.b.RotationYawPitchRollToRef(s.y,s.x,s.z,O.g.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(O.g.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(O.g.sO[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):j&&j._nonUniformScaling?this._updateNonUniformScalingState(j._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.Ja(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=O.b.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.Ea(),s){const s=this.getChildren();for(let Z=0;Z<s.length;++Z){const o=s[Z];if(o){o.Ea();const s=O.g.Matrix[0];o.nQ.multiplyToRef(this.nQ,s);const Z=O.g.Quaternion[0];s.decompose(o.ZO,Z,o.position),o.rotationQuaternion?o.rotationQuaternion.O(Z):Z.toEulerAnglesToRef(o.rotation)}}}this.ZO.Ja(1,1,1),this.position.Ja(0,0,0),this.rotation.Ja(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=O.e.Identity()),this._worldMatrix=O.b.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(s){return this.onAfterWorldMatrixUpdateObservable.add(s),this}unregisterAfterWorldMatrixUpdate(s){return this.onAfterWorldMatrixUpdateObservable.removeCallback(s),this}getPositionInCameraSpace(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return s||(s=this.Ls().activeCamera),O.n.TransformCoordinates(this.getAbsolutePosition(),s.getViewMatrix())}getDistanceToCamera(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return s||(s=this.Ls().activeCamera),this.getAbsolutePosition().Go(s.globalPosition).length()}clone(s,Z,o){const t=S.c.Clone((()=>new B(s,this.Ls())),this);if(t.name=s,t.id=s,Z&&(t.parent=Z),!o){const Z=this.getDescendants(!0);for(let o=0;o<Z.length;o++){const j=Z[o];j.clone&&j.clone(s+"."+j.name,t)}}return t}serialize(s){const Z=S.c.Serialize(this,s);return Z.type=this.getClassName(),Z.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(Z),Z.localMatrix=this.getPivotMatrix().ma(),Z.isEnabled=this.isEnabled(),S.c.AppendSerializedAnimations(this,Z),Z.ranges=this.serializeAnimationRanges(),Z}static Parse(s,Z,o){const t=S.c.Parse((()=>new B(s.name,Z)),s,Z,o);if(s.localMatrix?t.setPreTransformMatrix(O.b.oO(s.localMatrix)):s.pivotMatrix&&t.setPivotMatrix(O.b.oO(s.pivotMatrix)),t.iO(s.isEnabled),t._waitingParsedUniqueId=s.uniqueId,void 0!==s.parentId&&(t._waitingParentId=s.parentId),void 0!==s.parentInstanceIndex&&(t._waitingParentInstanceIndex=s.parentInstanceIndex),s.animations){for(let Z=0;Z<s.animations.length;Z++){const o=s.animations[Z],j=(0,G.e)("BABYLON.Animation");j&&t.animations.push(j.Parse(o))}v.d.ParseAnimationRanges(t,s,Z)}return s.autoAnimate&&Z.beginAnimation(t,s.autoAnimateFrom,s.autoAnimateTo,s.autoAnimateLoop,s.autoAnimateSpeed||1),t}getChildTransformNodes(s,Z){const o=[];return this._getDescendants(o,s,(s=>(!Z||Z(s))&&s instanceof B)),o}dispose(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.Ls().stopAnimation(this),this.Ls().removeTransformNode(this),this._parentContainer){const s=this._parentContainer.transformNodes.indexOf(this);s>-1&&this._parentContainer.transformNodes.splice(s,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),s){const s=this.getChildTransformNodes(!0);for(const Z of s)Z.parent=null,Z.Ea(!0)}super.dispose(s,Z)}normalizeToUnitCube(){let s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2?arguments[2]:void 0,t=null,j=null;Z&&(this.rotationQuaternion?(j=this.rotationQuaternion.clone(),this.rotationQuaternion.Ja(0,0,0,1)):this.rotation&&(t=this.rotation.clone(),this.rotation.Ja(0,0,0)));const S=this.getHierarchyBoundingVectors(s,o),a=S.max.Go(S.min),O=Math.max(a.x,a.y,a.z);if(0===O)return this;const v=1/O;return this.ZO.scaleInPlace(v),Z&&(this.rotationQuaternion&&j?this.rotationQuaternion.O(j):this.rotation&&t&&this.rotation.O(t)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}B.BILLBOARDMODE_NONE=0,B.BILLBOARDMODE_X=1,B.BILLBOARDMODE_Y=2,B.BILLBOARDMODE_Z=4,B.BILLBOARDMODE_ALL=7,B.BILLBOARDMODE_USE_POSITION=128,B.BillboardUseParentOrientation=!1,B._TmpRotation=O.e.Zero(),B._TmpScaling=O.n.Zero(),B._TmpTranslation=O.n.Zero(),B._LookAtVectorCache=new O.n(0,0,0),B._RotationAxisCache=new O.e,(0,t.c)([(0,j.G)("position")],B.prototype,"_position",void 0),(0,t.c)([(0,j.G)("rotation")],B.prototype,"_rotation",void 0),(0,t.c)([(0,j.z)("rotationQuaternion")],B.prototype,"_rotationQuaternion",void 0),(0,t.c)([(0,j.G)("ZO")],B.prototype,"_scaling",void 0),(0,t.c)([(0,j.K)("billboardMode")],B.prototype,"_billboardMode",void 0),(0,t.c)([(0,j.K)()],B.prototype,"scalingDeterminant",void 0),(0,t.c)([(0,j.K)("infiniteDistance")],B.prototype,"_infiniteDistance",void 0),(0,t.c)([(0,j.K)()],B.prototype,"ignoreNonUniformScaling",void 0),(0,t.c)([(0,j.K)()],B.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},11581:(s,Z,o)=>{o.d(Z,{b:()=>G});var t=o(10900),j=o(10935),S=o(11367),a=o(10904),O=o(11174);class v{constructor(s,Z,o,t){this.name=s,this.worldAxisForNormal=Z,this.worldAxisForFileX=o,this.worldAxisForFileY=t}}class G{static ConvertCubeMapTextureToSphericalPolynomial(s){var Z;if(!s.isCube)return null;null===(Z=s.Ls())||void 0===Z||Z.getEngine().flushFramebuffer();const o=s.getSize().width,t=s.readPixels(0,void 0,void 0,!1),j=s.readPixels(1,void 0,void 0,!1);let S,a;s.isRenderTarget?(S=s.readPixels(3,void 0,void 0,!1),a=s.readPixels(2,void 0,void 0,!1)):(S=s.readPixels(2,void 0,void 0,!1),a=s.readPixels(3,void 0,void 0,!1));const O=s.readPixels(4,void 0,void 0,!1),v=s.readPixels(5,void 0,void 0,!1),G=s.gammaSpace;let B=0;return 1!=s.textureType&&2!=s.textureType||(B=1),new Promise((s=>{Promise.all([j,t,S,a,O,v]).then((Z=>{let[t,j,S,a,O,v]=Z;const Q={size:o,right:j,left:t,up:S,down:a,front:O,back:v,format:5,type:B,gammaSpace:G};s(this.ConvertCubeMapToSphericalPolynomial(Q))}))}))}static _AreaElement(s,Z){return Math.atan2(s*Z,Math.sqrt(s*s+Z*Z+1))}static ConvertCubeMapToSphericalPolynomial(s){const Z=new S.e;let o=0;const t=2/s.size,v=t,G=.5*t,B=G-1;for(let S=0;S<6;S++){const Q=this._FileFaces[S],D=s[Q.name];let z=B;const Y=5===s.format?4:3;for(let S=0;S<s.size;S++){let b=B;for(let v=0;v<s.size;v++){const B=Q.worldAxisForFileX.scale(b).add(Q.worldAxisForFileY.scale(z)).add(Q.worldAxisForNormal);B.normalize();const f=this._AreaElement(b-G,z-G)-this._AreaElement(b-G,z+G)-this._AreaElement(b+G,z-G)+this._AreaElement(b+G,z+G);let A=D[S*s.size*Y+v*Y+0],d=D[S*s.size*Y+v*Y+1],U=D[S*s.size*Y+v*Y+2];isNaN(A)&&(A=0),isNaN(d)&&(d=0),isNaN(U)&&(U=0),0===s.type&&(A/=255,d/=255,U/=255),s.gammaSpace&&(A=Math.pow((0,j.Clamp)(A),a.j),d=Math.pow((0,j.Clamp)(d),a.j),U=Math.pow((0,j.Clamp)(U),a.j));const u=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const s=Math.max(A,d,U);if(s>u){const Z=u/s;A*=Z,d*=Z,U*=Z}}else A=(0,j.Clamp)(A,0,u),d=(0,j.Clamp)(d,0,u),U=(0,j.Clamp)(U,0,u);const H=new O.d(A,d,U);Z.addLight(B,H,f),o+=f,b+=t}z+=v}}const Q=6*(4*Math.PI)/6/o;return Z.scaleInPlace(Q),Z.convertIncidentRadianceToIrradiance(),Z.convertIrradianceToLambertianRadiance(),S.h.FromHarmonics(Z)}}G._FileFaces=[new v("right",new t.n(1,0,0),new t.n(0,0,-1),new t.n(0,-1,0)),new v("left",new t.n(-1,0,0),new t.n(0,0,1),new t.n(0,-1,0)),new v("up",new t.n(0,1,0),new t.n(1,0,0),new t.n(0,0,1)),new v("down",new t.n(0,-1,0),new t.n(1,0,0),new t.n(0,0,-1)),new v("front",new t.n(0,0,1),new t.n(1,0,0),new t.n(0,-1,0)),new v("back",new t.n(0,0,-1),new t.n(-1,0,0),new t.n(0,-1,0))],G.MAX_HDRI_VALUE=4096,G.PRESERVE_CLAMPED_COLORS=!1},10911:(s,Z,o)=>{function t(s,Z){const o=[];for(let t=0;t<s;++t)o.push(Z());return o}function j(s,Z){return t(s,Z)}o.d(Z,{e:()=>t,i:()=>j,m:()=>a});const S=["push","splice","pop","shift","unshift"];function a(s,Z){const o=S.map((o=>function(s,Z,o){const t=s[Z];if("function"!==typeof t)return null;const j=function(){const t=s.length,S=j.previous.apply(s,arguments);return o(Z,t),S};return t.next=j,j.previous=t,s[Z]=j,()=>{const o=j.previous;if(!o)return;const t=j.next;t?(o.next=t,t.previous=o):(o.next=void 0,s[Z]=o),j.next=void 0,j.previous=void 0}}(s,o,Z)));return()=>{for(const s of o)null===s||void 0===s||s()}}},11480:(s,Z,o)=>{o.d(Z,{b:()=>a});var t=o(11410),j=o(11482);let S=0;const a=s=>{if(!s.environmentBRDFTexture){const Z=s.useDelayedTextureLoading;s.useDelayedTextureLoading=!1;const o=s._blockEntityCollection;s._blockEntityCollection=!1;const a=t.c.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+S++,s,!0,!1,t.c.BILINEAR_SAMPLINGMODE);s._blockEntityCollection=o;const O=s.getEngine().getLoadedTexturesCache(),v=O.indexOf(a.getInternalTexture());-1!==v&&O.splice(v,1),a.isRGBD=!0,a.wrapU=t.c.CLAMP_ADDRESSMODE,a.wrapV=t.c.CLAMP_ADDRESSMODE,s.environmentBRDFTexture=a,s.useDelayedTextureLoading=Z,j.e.ExpandRGBDTexture(a);const G=s.getEngine().onContextRestoredObservable.add((()=>{a.isRGBD=!0;const Z=s.onBeforeRenderObservable.add((()=>{a.isReady()&&(s.onBeforeRenderObservable.remove(Z),j.e.ExpandRGBDTexture(a))}))}));s.jO.add((()=>{s.getEngine().onContextRestoredObservable.remove(G)}))}return s.environmentBRDFTexture}},11219:(s,Z,o)=>{function t(s,Z,o){try{const t=s.next();t.done?Z(t):t.value?t.value.then((()=>{t.value=void 0,Z(t)}),o):Z(t)}catch(t){o(t)}}function j(){let s,Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(o,j,S)=>{const a=performance.now();void 0===s||a-s>Z?(s=a,setTimeout((()=>{t(o,j,S)}),0)):t(o,j,S)}}function S(s,Z,o,t,j){const S=()=>{let a;const O=s=>{s.done?o(s.value):void 0===a?a=!0:S()};do{a=void 0,j&&j.aborted?t(new Error("Aborted")):Z(s,O,t),void 0===a&&(a=!1)}while(a)};S()}function a(s,Z){let o;return S(s,t,(s=>o=s),(s=>{throw s}),Z),o}async function O(s,Z,o){return await new Promise(((t,j)=>{S(s,Z,t,j,o)}))}function v(s,Z){return function(){return a(s(...arguments),Z)}}o.d(Z,{e:()=>j,i:()=>v,m:()=>O,q:()=>a})},11099:(s,Z,o)=>{o.d(Z,{e:()=>S,g:()=>a});const t={},j={};function S(s){const Z=s.getClassName();return j[Z]||(j[Z]={}),j[Z]}function a(s){const Z=s.getClassName();if(t[Z])return t[Z];t[Z]={};const o=t[Z];let S=s,a=Z;for(;a;){const s=j[a];for(const j in s)o[j]=s[j];let Z,t=!1;do{if(Z=Object.getPrototypeOf(S),!Z.getClassName){t=!0;break}if(Z.getClassName()!==a)break;S=Z}while(Z);if(t)break;a=Z.getClassName(),S=Z}return o}},11091:(s,Z,o)=>{o.d(Z,{D:()=>O,F:()=>B,G:()=>Q,K:()=>a,c:()=>S,e:()=>d,f:()=>z,i:()=>v,j:()=>Y,n:()=>G,r:()=>b,s:()=>A,v:()=>D,z:()=>f});var t=o(11099);function j(s,Z){return(o,j)=>{const S=(0,t.e)(o);S[j]||(S[j]={type:s,sourceName:Z})}}function S(s){return function(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(o,t)=>{const j=Z||"_"+t;Object.defineProperty(o,t,{get:function(){return this[j]},set:function(Z){var t;"function"===typeof(null===(t=this[j])||void 0===t?void 0:t.equals)&&this[j].equals(Z)||this[j]!==Z&&(this[j]=Z,o[s].apply(this))},enumerable:!0,configurable:!0})}}(s,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)}function a(s){return j(0,s)}function O(s){return j(1,s)}function v(s){return j(2,s)}function G(s){return j(3,s)}function B(s){return j(4,s)}function Q(s){return j(5,s)}function D(s){return j(6,s)}function z(s){return j(7,s)}function Y(s){return j(8,s)}function b(s){return j(9,s)}function f(s){return j(10,s)}function A(s){return j(12,s)}function d(s,Z,o,t){const j=o.value;o.value=function(){let o=j;if("undefined"!==typeof _native&&_native[Z]){const s=_native[Z];o=t?function(){return t(...arguments)?s(...arguments):j(...arguments)}:s}return s[Z]=o,o(...arguments)}}d.filter=function(s){return(Z,o,t)=>d(Z,o,t,s)}},11167:(s,Z,o)=>{o.d(Z,{c:()=>G});var t=o(10975),j=o(11172),S=o(11174),a=o(10900),O=o(11099);const v=function(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const S=s();j.b&&j.b.HasTags(Z)&&j.b.AddTagsTo(S,j.b.GetTags(Z,!0));const a=(0,O.g)(S),v={};for(const j in a){const s=a[j],O=Z[j],B=s.type;if(void 0!==O&&null!==O&&("uniqueId"!==j||G.AllowLoadingUniqueId))switch(B){case 0:case 6:case 9:case 11:S[j]=O;break;case 1:t.cloneTexturesOnlyOnce&&v[O.uniqueId]?S[j]=v[O.uniqueId]:(S[j]=o||O.isRenderTarget?O:O.clone(),v[O.uniqueId]=S[j]);break;case 2:case 3:case 4:case 5:case 7:case 8:case 10:case 12:S[j]=o?O:O.clone()}}return S};class G{static AppendSerializedAnimations(s,Z){if(s.animations){Z.animations=[];for(let o=0;o<s.animations.length;o++){const t=s.animations[o];Z.animations.push(t.serialize())}}}static Serialize(s,Z){Z||(Z={}),j.b&&(Z.tags=j.b.GetTags(s));const o=(0,O.g)(s);for(const t in o){const j=o[t],S=j.sourceName||t,a=j.type,O=s[t];if(void 0!==O&&null!==O&&("uniqueId"!==t||G.AllowLoadingUniqueId))switch(a){case 0:Z[S]=O;break;case 1:case 3:case 7:case 9:Z[S]=O.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:Z[S]=O.ma();break;case 6:case 11:Z[S]=O.id}}return Z}static ParseProperties(s,Z,o,t){t||(t="");const j=(0,O.g)(Z);for(const O in j){const v=j[O],B=s[v.sourceName||O],Q=v.type;if(void 0!==B&&null!==B&&("uniqueId"!==O||G.AllowLoadingUniqueId)){const s=Z;switch(Q){case 0:s[O]=B;break;case 1:o&&(s[O]=G._TextureParser(B,o,t));break;case 2:s[O]=S.d.oO(B);break;case 3:s[O]=G._FresnelParametersParser(B);break;case 4:s[O]=a.j.oO(B);break;case 5:s[O]=a.n.oO(B);break;case 6:o&&(s[O]=o.getLastMeshById(B));break;case 7:s[O]=G._ColorCurvesParser(B);break;case 8:s[O]=S.h.oO(B);break;case 9:s[O]=G._ImageProcessingConfigurationParser(B);break;case 10:s[O]=a.e.oO(B);break;case 11:o&&(s[O]=o.getCameraById(B));break;case 12:s[O]=a.b.oO(B)}}}}static Parse(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const S=s();return j.b&&j.b.AddTagsTo(S,Z.tags),G.ParseProperties(Z,S,o,t),S}static Clone(s,Z){return v(s,Z,!1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}static Instanciate(s,Z){return v(s,Z,!0)}}G.AllowLoadingUniqueId=!1,G._ImageProcessingConfigurationParser=s=>{throw(0,t.d)("ImageProcessingConfiguration")},G._FresnelParametersParser=s=>{throw(0,t.d)("FresnelParameters")},G._ColorCurvesParser=s=>{throw(0,t.d)("ColorCurves")},G._TextureParser=(s,Z,o)=>{throw(0,t.d)("Texture")}},10964:(s,Z,o)=>{o.d(Z,{c:()=>S});var t=o(10955);const j=(s,Z,o)=>s?s.getClassName&&"Mesh"===s.getClassName()?null:!s.getClassName||"SubMesh"!==s.getClassName()&&"PhysicsBody"!==s.getClassName()?s.clone?s.clone():Array.isArray(s)?s.slice():o&&"object"===typeof s?{...s}:null:s.clone(Z):null;class S{static DeepCopy(s,Z,o,S){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const O=function(s){const Z=[];do{const o=Object.getOwnPropertyNames(s);for(const s of o)-1===Z.indexOf(s)&&Z.push(s)}while(s=Object.getPrototypeOf(s));return Z}(s);for(const G of O){if("_"===G[0]&&(!S||-1===S.indexOf(G)))continue;if(G.endsWith("Observable"))continue;if(o&&-1!==o.indexOf(G))continue;const O=s[G],B=typeof O;if("function"!==B)try{if("object"===B)if(O instanceof Uint8Array)Z[G]=Uint8Array.from(O);else if(O instanceof Array){if(Z[G]=[],O.length>0)if("object"==typeof O[0])for(let s=0;s<O.length;s++){const o=j(O[s],Z,a);-1===Z[G].indexOf(o)&&Z[G].push(o)}else Z[G]=O.slice(0)}else Z[G]=j(O,Z,a);else Z[G]=O}catch(v){t.b.Warn(v.message)}}}}},11683:(s,Z,o)=>{function t(){const s=s=>!!s&&"object"===typeof s;for(var Z=arguments.length,o=new Array(Z),j=0;j<Z;j++)o[j]=arguments[j];return o.reduce(((Z,o)=>{const j=Object.keys(o);for(const S of j){const j=Z[S],a=o[S];Array.isArray(j)&&Array.isArray(a)?Z[S]=j.concat(...a):s(j)&&s(a)?Z[S]=t(j,a):Z[S]=a}return Z}),{})}o.d(Z,{e:()=>t})},10975:(s,Z,o)=>{o.d(Z,{d:()=>j});const t={};function j(s){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!t[s])return t[s]=!0,`${s} needs to be imported before as it contains a side-effect required by your code.`}},10947:(s,Z,o)=>{function t(){return"undefined"!==typeof window}function j(){return"undefined"!==typeof navigator}function S(){return"undefined"!==typeof document}function a(s){let Z="",o=s.firstChild;for(;o;)3===o.nodeType&&(Z+=o.textContent),o=o.nextSibling;return Z}o.d(Z,{d:()=>a,f:()=>S,g:()=>j,i:()=>t})},11460:(s,Z,o)=>{o.r(Z),o.d(Z,{Dispose:()=>D,DumpData:()=>Q,DumpDataAsync:()=>B,DumpFramebuffer:()=>G,DumpTools:()=>z});var t=o(11441),j=o(10938),S=o(10935),a=o(10927);let O,v=null;async function G(s,Z,o,t){let j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",S=arguments.length>5?arguments[5]:void 0,a=arguments.length>6?arguments[6]:void 0;const O=await o.readPixels(0,0,s,Z);Q(s,Z,new Uint8Array(O.buffer),t,j,S,!0,void 0,a)}async function B(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",j=arguments.length>4?arguments[4]:void 0,S=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],O=arguments.length>7?arguments[7]:void 0;return await new Promise((v=>{Q(s,Z,o,(s=>v(s)),t,j,S,a,O)}))}function Q(s,Z,G,B){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",z=arguments.length>5?arguments[5]:void 0,Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],b=arguments.length>7&&void 0!==arguments[7]&&arguments[7],f=arguments.length>8?arguments[8]:void 0;(async function(){return v||(v=new Promise(((s,Z)=>{let j,S=null;const v={yG:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(o.bind(o,11313)).then((G=>{let{ThinEngine:B}=G;const Q=a.c.Instances.length;try{j=new OffscreenCanvas(100,100),S=new B(j,!1,v)}catch(b){var z;Q<a.c.Instances.length&&(null===(z=a.c.Instances.pop())||void 0===z||z.dispose()),j=document.createElement("canvas"),S=new B(j,!1,v)}a.c.Instances.pop(),a.c.OnEnginesDisposedObservable.add((s=>{S&&s!==S&&!S.B&&0===a.c.Instances.length&&D()})),S.getCaps().parallelShaderCompile=void 0;const Y=new t.b(S);o.e(37).then(o.bind(o,13550)).then((o=>{let{passPixelShader:a}=o;if(!S)return void Z("Engine is not defined");const v=new t.c({wa:S,name:a.name,fragmentShader:a.shader,samplerNames:["textureSampler"]});O={canvas:j,wa:S,renderer:Y,wrapper:v},s(O)}))})).catch(Z)}))),await v})().then((o=>{if(o.wa.setSize(s,Z,!0),G instanceof Float32Array){const s=new Uint8Array(G.length);let Z=G.length;for(;Z--;){const o=G[Z];s[Z]=Math.round(255*(0,S.Clamp)(o))}G=s}const t=o.wa.createRawTexture(G,s,Z,5,!1,!Y,1);o.renderer.setViewport(),o.renderer.applyEffectWrapper(o.wrapper),o.wrapper.effect._bindTexture("textureSampler",t),o.renderer.draw(),b?j.g.ToBlob(o.canvas,(s=>{const Z=new FileReader;Z.onload=s=>{const Z=s.target.result;B&&B(Z)},Z.readAsArrayBuffer(s)}),Q,f):j.g.EncodeScreenshotCanvasData(o.canvas,B,Q,z,f),t.dispose()}))}function D(){var s;O?(O.wrapper.dispose(),O.renderer.dispose(),O.wa.dispose()):null===(s=v)||void 0===s||s.then((s=>{s.wrapper.dispose(),s.renderer.dispose(),s.wa.dispose()}));v=null,O=null}const z={DumpData:Q,DumpDataAsync:B,DumpFramebuffer:G,Dispose:D};j.g.DumpData=Q,j.g.DumpDataAsync=B,j.g.DumpFramebuffer=G},10990:(s,Z,o)=>{o.d(Z,{e:()=>t,f:()=>j,g:()=>S});class t extends Error{}t._setPrototypeOf=Object.setPrototypeOf||((s,Z)=>(s.__proto__=Z,s));const j={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};class S extends t{constructor(s,Z,o){super(s),this.errorCode=Z,this.innerError=o,this.name="RuntimeError",t._setPrototypeOf(this,S.prototype)}}},10982:(s,Z,o)=>{o.d(Z,{e:()=>e,h:()=>U,l:()=>V,p:()=>l,t:()=>N,s:()=>f,x:()=>F,y:()=>i,A:()=>L,C:()=>u});var t=o(10977),j=o(10947),S=o(10932);class a{}a.FilesToLoad={};var O=o(10990),v=o(10999),G=o(11004),B=o(10927),Q=o(10955),D=o(11009),z=o(11007),Y=o(11013);const b=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class f extends O.g{constructor(s,Z){super(s,O.f.LoadFileError),this.name="LoadFileError",O.e._setPrototypeOf(this,f.prototype),Z instanceof t.c?this.request=Z:this.file=Z}}class A extends O.g{constructor(s,Z){super(s,O.f.RequestFileError),this.request=Z,this.name="RequestFileError",O.e._setPrototypeOf(this,A.prototype)}}class d extends O.g{constructor(s,Z){super(s,O.f.ReadFileError),this.file=Z,this.name="ReadFileError",O.e._setPrototypeOf(this,d.prototype)}}const U={DefaultRetryStrategy:class{static ExponentialBackoff(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return(o,t,j)=>0!==t.status||j>=s||-1!==o.indexOf("file:")?-1:Math.pow(2,j)*Z}}.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:s=>s,ScriptBaseUrl:"",ScriptPreprocessUrl:s=>s,CleanUrl:s=>s=s.replace(/#/gm,"%23")},u=(s,Z)=>{if((!s||0!==s.indexOf("data:"))&&U.CorsBehavior)if("string"===typeof U.CorsBehavior||U.CorsBehavior instanceof String)Z.crossOrigin=U.CorsBehavior;else{const o=U.CorsBehavior(s);o&&(Z.crossOrigin=o)}},H={getRequiredSize:null},F=function(s,Z,o,j){let S,O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",G=arguments.length>5?arguments[5]:void 0,Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:B.c.LastCreatedEngine;if("undefined"===typeof HTMLImageElement&&(null===Q||void 0===Q||!Q._features.forceBitmapOverHTMLImageElement))return o("LoadImage is only supported in web or BabylonNative environments."),null;let D=!1;s instanceof ArrayBuffer||ArrayBuffer.isView(s)?"undefined"!==typeof Blob&&"undefined"!==typeof URL?(S=URL.createObjectURL(new Blob([s],{type:O})),D=!0):S=`data:${O};base64,`+(0,v.i)(s):s instanceof Blob?(S=URL.createObjectURL(s),D=!0):(S=U.CleanUrl(s),S=U.PreprocessUrl(S));const z=Z=>{if(o){const t=S||s.toString();o(`Error while trying to load image: ${0===t.indexOf("http")||t.length<=128?t:t.slice(0,128)+"..."}`,Z)}};if(null!==Q&&void 0!==Q&&Q._features.forceBitmapOverHTMLImageElement)return N(S,(t=>{Q.createImageBitmap(new Blob([t],{type:O}),{premultiplyAlpha:"none",...G}).then((s=>{Z(s),D&&URL.revokeObjectURL(S)})).catch((Z=>{o&&o("Error while trying to load image: "+s,Z)}))}),void 0,j||void 0,!0,((s,Z)=>{z(Z)})),null;const Y=new Image;if(H.getRequiredSize){const Z=H.getRequiredSize(s);Z.width&&(Y.width=Z.width),Z.height&&(Y.height=Z.height)}u(S,Y);const b=[],f=()=>{for(const s of b)s.target.removeEventListener(s.name,s.handler);b.length=0};b.push({target:Y,name:"load",handler:()=>{f(),Z(Y),D&&Y.src&&URL.revokeObjectURL(Y.src)}}),b.push({target:Y,name:"error",handler:s=>{f(),z(s),D&&Y.src&&URL.revokeObjectURL(Y.src)}}),b.push({target:document,name:"securitypolicyviolation",handler:s=>{if(s.blockedURI!==Y.src||"iY"===s.disposition)return;f();const Z=new Error(`CSP violation of policy ${s.effectiveDirective} ${s.blockedURI}. Current policy is ${s.originalPolicy}`);B.c.UseFallbackTexture=!1,z(Z),D&&Y.src&&URL.revokeObjectURL(Y.src),Y.src=""}}),(()=>{for(const s of b)s.target.addEventListener(s.name,s.handler)})();const A="blob:"===S.substring(0,5),d="data:"===S.substring(0,5),F=()=>{A||d||!t.c.IsCustomRequestAvailable?Y.src=S:N(S,((s,Z,o)=>{const t=new Blob([s],{type:!O&&o?o:O}),j=URL.createObjectURL(t);D=!0,Y.src=j}),void 0,j||void 0,!0,((s,Z)=>{z(Z)}))},i=()=>{j&&j.loadImage(S,Y)};if(!A&&!d&&j&&j.enableTexturesOffline)j.open(i,F);else{if(-1!==S.indexOf("file:")){const s=decodeURIComponent(S.substring(5).toLowerCase());if(a.FilesToLoad[s]&&"undefined"!==typeof URL){try{let Z;try{Z=URL.createObjectURL(a.FilesToLoad[s])}catch(L){Z=URL.createObjectURL(a.FilesToLoad[s])}Y.src=Z,D=!0}catch(V){Y.src=""}return Y}}F()}return Y},i=(s,Z,o,t,j)=>{const a=new FileReader,O={onCompleteObservable:new S.b,abort:()=>a.abort()};return a.onloadend=()=>O.onCompleteObservable.notifyObservers(O),j&&(a.onerror=()=>{j(new d(`Unable to read ${s.name}`,s))}),a.onload=s=>{Z(s.target.result)},o&&(a.onprogress=o),t?a.readAsArrayBuffer(s):a.readAsText(s),O},N=(s,Z,o,t,j,v,G)=>{if(s.name)return i(s,Z,o,j,v?s=>{v(void 0,s)}:void 0);const B=s;if(-1!==B.indexOf("file:")){let s=decodeURIComponent(B.substring(5).toLowerCase());0===s.indexOf("./")&&(s=s.substring(2));const t=a.FilesToLoad[s];if(t)return i(t,Z,o,j,v?s=>v(void 0,new f(s.message,s.file)):void 0)}const{match:z,type:Y}=R(B);if(z){const s={onCompleteObservable:new S.b,abort:()=>()=>{}};try{const s=j?e(B):c(B);Z(s,void 0,Y)}catch(O){v?v(void 0,O):Q.b.Error(O.message||"Failed to parse the Data URL")}return D.c.SetImmediate((()=>{s.onCompleteObservable.notifyObservers(s)})),s}return L(B,((s,o)=>{Z(s,null===o||void 0===o?void 0:o.responseURL,null===o||void 0===o?void 0:o.getResponseHeader("content-type"))}),o,t,j,v?s=>{v(s.request,new f(s.message,s.request))}:void 0,G)},L=(s,Z,o,a,O,v,G)=>{s=U.CleanUrl(s),s=U.PreprocessUrl(s);const B=U.BaseUrl+s;let D=!1;const z={onCompleteObservable:new S.b,abort:()=>D=!0},Y=()=>{let s,S=new t.c,a=null;const Y=()=>{S&&(o&&S.removeEventListener("progress",o),s&&S.removeEventListener("readystatechange",s),S.removeEventListener("loadend",b))};let b=()=>{Y(),z.onCompleteObservable.notifyObservers(z),z.onCompleteObservable.clear(),o=void 0,s=null,b=null,v=void 0,G=void 0,Z=void 0};z.abort=()=>{D=!0,b&&b(),S&&S.readyState!==(XMLHttpRequest.DONE||4)&&S.abort(),null!==a&&(clearTimeout(a),a=null),S=null};const f=s=>{const Z=s.message||"Unknown error";v&&S?v(new A(Z,S)):Q.b.Error(Z)},d=Q=>{if(S){if(S.open("GET",B),G)try{G(S)}catch(z){return void f(z)}O&&(S.responseType="arraybuffer"),o&&S.addEventListener("progress",o),b&&S.addEventListener("loadend",b),s=()=>{if(!D&&S&&S.readyState===(XMLHttpRequest.DONE||4)){if(s&&S.removeEventListener("readystatechange",s),S.status>=200&&S.status<300||0===S.status&&(!(0,j.i)()||g())){const s=O?S.response:S.responseText;if(null!==s){try{Z&&Z(s,S)}catch(z){f(z)}return}}const o=U.DefaultRetryStrategy;if(o){const s=o(B,S,Q);if(-1!==s)return Y(),S=new t.c,void(a=setTimeout((()=>d(Q+1)),s))}const G=new A("Error status: "+S.status+" "+S.statusText+" - Unable to load "+B,S);v&&v(G)}},S.addEventListener("readystatechange",s),S.send()}};d(0)};if(a&&a.enableSceneOffline){const t=s=>{s&&s.status>400?v&&v(s):Y()},j=()=>{a&&a.loadFile(U.BaseUrl+s,(s=>{!D&&Z&&Z(s),z.onCompleteObservable.notifyObservers(z)}),o?s=>{!D&&o&&o(s)}:void 0,t,O)};a.open(j,t)}else Y();return z},V=s=>{const{match:Z,type:o}=R(s);if(Z)return o||void 0;const t=s.lastIndexOf(".");switch(s.substring(t+1).toLowerCase()){case"glb":return"model/gltf-binary";case"bin":return"application/octet-stream";case"aO":return"model/gltf+json";case"jpg":case"jpeg":return"image/jpeg";case"png":return"image/png";case"webp":return"image/webp";default:return}},g=()=>"undefined"!==typeof location&&"file:"===location.protocol,l=s=>b.test(s),R=s=>{const Z=b.exec(s);if(null===Z||0===Z.length)return{match:!1,type:""};return{match:!0,type:Z[0].replace("data:","").replace("base64,","")}};function e(s){return(0,v.c)(s.split(",")[1])}const c=s=>(0,v.d)(s.split(",")[1]);let w;Y.e._FileToolsLoadImage=F,z.c.loadFile=N,G.m.loadFile=N;((s,Z,o,t,j,S,a,O,v,G)=>{w={DecodeBase64UrlToBinary:s,DecodeBase64UrlToString:Z,DefaultRetryStrategy:o.DefaultRetryStrategy,BaseUrl:o.BaseUrl,CorsBehavior:o.CorsBehavior,PreprocessUrl:o.PreprocessUrl,IsBase64DataUrl:t,IsFileURL:j,LoadFile:S,LoadImage:a,ReadFile:O,RequestFile:v,SetCorsBehavior:G},Object.defineProperty(w,"DefaultRetryStrategy",{get:function(){return o.DefaultRetryStrategy},set:function(s){o.DefaultRetryStrategy=s}}),Object.defineProperty(w,"BaseUrl",{get:function(){return o.BaseUrl},set:function(s){o.BaseUrl=s}}),Object.defineProperty(w,"PreprocessUrl",{get:function(){return o.PreprocessUrl},set:function(s){o.PreprocessUrl=s}}),Object.defineProperty(w,"CorsBehavior",{get:function(){return o.CorsBehavior},set:function(s){o.CorsBehavior=s}})})(e,c,U,l,g,N,F,i,L,u)},11070:(s,Z,o)=>{function t(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(s=>{const Z=16*Math.random()|0;return("x"===s?Z:3&Z|8).toString(16)}))}o.d(Z,{c:()=>t})},11066:(s,Z,o)=>{o.d(Z,{c:()=>S});var t=o(10955),j=o(10916);class S{static Instantiate(s){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[s])return this.RegisteredExternalClasses[s];const Z=(0,j.e)(s);if(Z)return Z;t.b.Warn(s+" not found, you may have missed an import.");const o=s.split(".");let S=window||this;for(let t=0,j=o.length;t<j;t++)S=S[o[t]];return"function"!==typeof S?null:S}}S.RegisteredExternalClasses={}},10955:(s,Z,o)=>{o.d(Z,{b:()=>t});class t{static _CheckLimit(s,Z){let o=t._LogLimitOutputs[s];return o?o.current++:(o={limit:Z,current:1},t._LogLimitOutputs[s]=o),o.current<=o.limit}static _GenerateLimitMessage(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const o=t._LogLimitOutputs[s];if(!o||!t.MessageLimitReached)return;const j=this._Levels[Z];o.current===o.limit&&t[j.name](t.MessageLimitReached.replace(/%LIMIT%/g,""+o.limit).replace(/%TYPE%/g,j.name??""))}static _AddLogEntry(s){t._LogCache=s+t._LogCache,t.OnNewCacheEntry&&t.OnNewCacheEntry(s)}static _FormatMessage(s){const Z=s=>s<10?"0"+s:""+s,o=new Date;return"["+Z(o.getHours())+":"+Z(o.getMinutes())+":"+Z(o.getSeconds())+"]: "+s}static _LogDisabled(s,Z){}static _LogEnabled(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Z=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;const j=Array.isArray(Z)?Z[0]:Z;if(void 0!==o&&!t._CheckLimit(j,o))return;const S=t._FormatMessage(j),a=this._Levels[s],O=Array.isArray(Z)?Z.slice(1):[];a.logFunc&&a.logFunc("BJS - "+S,...O);const v=`<div style='color:${a.color}'>${S}</div><br>`;t._AddLogEntry(v),t._GenerateLimitMessage(j,s)}static get LogCache(){return t._LogCache}static ClearLogCache(){t._LogCache="",t._LogLimitOutputs={},t.errorsCount=0}static set LogLevels(s){t.Log=t._LogDisabled,t.Warn=t._LogDisabled,t.Error=t._LogDisabled;const Z=[t.MessageLogLevel,t.WarningLogLevel,t.ErrorLogLevel];for(const o of Z)if((s&o)===o){const s=this._Levels[o];t[s.name]=t._LogEnabled.bind(t,o)}}}t.NoneLogLevel=0,t.MessageLogLevel=1,t.WarningLogLevel=2,t.ErrorLogLevel=4,t.AllLogLevel=7,t.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",t._LogCache="",t._LogLimitOutputs={},t._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],t.errorsCount=0,t.Log=t._LogEnabled.bind(t,t.MessageLogLevel),t.Warn=t._LogEnabled.bind(t,t.WarningLogLevel),t.Error=t._LogEnabled.bind(t,t.ErrorLogLevel)},10932:(s,Z,o)=>{o.d(Z,{b:()=>a});const t="undefined"!==typeof WeakRef;class j{constructor(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2?arguments[2]:void 0,t=arguments.length>3?arguments[3]:void 0;this.initialize(s,Z,o,t)}initialize(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2?arguments[2]:void 0,t=arguments.length>3?arguments[3]:void 0;return this.mask=s,this.skipNextObservers=Z,this.target=o,this.currentTarget=t,this}}class S{constructor(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=s,this.mask=Z,this.scope=o,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(s)}}class a{static FromPromise(s,Z){const o=new a;return s.then((s=>{o.notifyObservers(s)})).catch((s=>{if(!Z)throw s;Z.notifyObservers(s)})),o}get observers(){return this._observers}constructor(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=Z,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new j(0),s&&(this._onObserverAdded=s)}add(s){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!s)return null;const j=new S(s,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);j.unregisterOnNextCall=o,Z?this._observers.unshift(j):this._observers.push(j),this._onObserverAdded&&this._onObserverAdded(j),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(j,this._lastNotifiedValue);const a=t?new WeakRef(this):{deref:()=>this};return j._remove=function(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Z=a.deref();Z&&(s?Z.remove(j):Z._remove(j))},j}addOnce(s){return this.add(s,void 0,void 0,void 0,!0)}remove(s){if(!s)return!1;s._remove=null;return-1!==this._observers.indexOf(s)&&(this._deferUnregister(s),!0)}removeCallback(s,Z){for(let o=0;o<this._observers.length;o++){const t=this._observers[o];if(!t._willBeUnregistered&&(t.callback===s&&(!Z||Z===t.scope)))return this._deferUnregister(t),!0}return!1}_deferUnregister(s){s._willBeUnregistered||(this._numObserversMarkedAsDeleted++,s.unregisterOnNextCall=!1,s._willBeUnregistered=!0,setTimeout((()=>{this._remove(s)}),0))}_remove(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!s)return!1;const o=this._observers.indexOf(s);return-1!==o&&(Z&&this._numObserversMarkedAsDeleted--,this._observers.splice(o,1),!0)}makeObserverTopPriority(s){this._remove(s,!1),this._observers.unshift(s)}makeObserverBottomPriority(s){this._remove(s,!1),this._observers.push(s)}notifyObservers(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,o=arguments.length>2?arguments[2]:void 0,t=arguments.length>3?arguments[3]:void 0,j=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=s),!this._observers.length)return!0;const S=this._eventState;S.mask=Z,S.target=o,S.currentTarget=t,S.skipNextObservers=!1,S.lastReturnValue=s,S.userInfo=j;for(const a of this._observers)if(!a._willBeUnregistered&&(a.mask&Z&&(a.unregisterOnNextCall&&this._deferUnregister(a),a.scope?S.lastReturnValue=a.callback.apply(a.scope,[s,S]):S.lastReturnValue=a.callback(s,S)),S.skipNextObservers))return!1;return!0}notifyObserver(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=Z),s._willBeUnregistered)return;const t=this._eventState;t.mask=o,t.skipNextObservers=!1,s.unregisterOnNextCall&&this._deferUnregister(s),s.callback(Z,t)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const s=this._observers.pop();s&&(s._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const s=new a;return s._observers=this._observers.slice(0),s}hasSpecificMask(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const Z of this._observers)if(Z.mask&s||Z.mask===s)return!0;return!1}}},11396:(s,Z,o)=>{o.d(Z,{d:()=>j});var t=o(10968);class j{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(s,Z){j.Enabled&&(this._current+=s,Z&&this._fetchResult())}beginMonitoring(){j.Enabled&&(this._startMonitoringTime=t.c.Now)}endMonitoring(){let s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!j.Enabled)return;s&&this.fetchNewFrame();const Z=t.c.Now;this._current=Z-this._startMonitoringTime,s&&this._fetchResult()}dQ(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const s=t.c.Now;s-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=s,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}j.Enabled=!0},10968:(s,Z,o)=>{o.d(Z,{c:()=>j});var t=o(10947);class j{static get Now(){return(0,t.i)()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}},11482:(s,Z,o)=>{o.d(Z,{e:()=>S});var t=o(11433),j=o(11405);class S{static ExpandRGBDTexture(s){const Z=s._texture;if(!Z||!s.isRGBD)return;const j=Z.getEngine(),S=j.getCaps(),a=Z.isReady;let O=!1;S.textureHalfFloatRender&&S.textureHalfFloatLinearFiltering?(O=!0,Z.type=2):S.textureFloatRender&&S.textureFloatLinearFiltering&&(O=!0,Z.type=1),O&&(Z.isReady=!1,Z._isRGBD=!1,Z.invertY=!1);const v=async()=>{const S=j.isWebGPU,a=S?1:0;Z.isReady=!1,S?await o.e(21).then(o.bind(o,13583)):await o.e(14).then(o.bind(o,13590));const O=new t.d("rgbdDecode","rgbdDecode",null,null,1,null,3,j,!1,void 0,Z.type,void 0,null,!1,void 0,a);O.externalTextureSamplerBinding=!0;const v=j.createRenderTargetTexture(Z.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:Z.samplingMode,type:Z.type,format:5});O.onEffectCreatedObservable.addOnce((o=>{o.executeWhenCompiled((()=>{O.onApply=s=>{s._bindTexture("textureSampler",Z),s.setFloat2("scale",1,1)},s.Ls().postProcessManager.directRender([O],v,!0),j.restoreDefaultFramebuffer(),j._releaseTexture(Z),O&&O.dispose(),v._swapAndDie(Z),Z.isReady=!0}))}))};O&&(a?v():s.onLoadObservable.addOnce(v))}static async EncodeTextureToRGBD(s,Z){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Z.getEngine().isWebGPU?await o.e(22).then(o.bind(o,13600)):await o.e(15).then(o.bind(o,13594)),await(0,j.b)("rgbdEncode",s,Z,t,1,5)}}},11253:(s,Z,o)=>{o.d(Z,{b:()=>j,f:()=>t});class t{constructor(s){this.length=0,this.data=new Array(s),this._id=t._GlobalId++}push(s){this.data[this.length++]=s,this.length>this.data.length&&(this.data.length*=2)}forEach(s){for(let Z=0;Z<this.length;Z++)s(this.data[Z])}sort(s){this.data.sort(s)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(s){if(0!==s.length){this.length+s.length>this.data.length&&(this.data.length=2*(this.length+s.length));for(let Z=0;Z<s.length;Z++)this.data[this.length++]=(s.data||s)[Z]}}indexOf(s){const Z=this.data.indexOf(s);return Z>=this.length?-1:Z}contains(s){return-1!==this.indexOf(s)}}t._GlobalId=0;class j extends t{constructor(){super(...arguments),this._duplicateId=0}push(s){super.push(s),s.__smartArrayFlags||(s.__smartArrayFlags={}),s.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(s){return(!s.__smartArrayFlags||s.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(s),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(s){if(0!==s.length){this.length+s.length>this.data.length&&(this.data.length=2*(this.length+s.length));for(let Z=0;Z<s.length;Z++){const o=(s.data||s)[Z];this.pushNoDuplicate(o)}}}}},10999:(s,Z,o)=>{o.d(Z,{c:()=>a,d:()=>S,f:()=>t,i:()=>j});const t=s=>{if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(s);let Z="";for(let o=0;o<s.byteLength;o++)Z+=String.fromCharCode(s[o]);return Z},j=s=>{const Z="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let o,t,j,S,a,O,v,G="",B=0;const Q=ArrayBuffer.isView(s)?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s);for(;B<Q.length;)o=Q[B++],t=B<Q.length?Q[B++]:Number.NaN,j=B<Q.length?Q[B++]:Number.NaN,S=o>>2,a=(3&o)<<4|t>>4,O=(15&t)<<2|j>>6,v=63&j,isNaN(t)?O=v=64:isNaN(j)&&(v=64),G+=Z.charAt(S)+Z.charAt(a)+Z.charAt(O)+Z.charAt(v);return G},S=s=>atob(s),a=s=>{const Z=S(s),o=Z.length,t=new Uint8Array(new ArrayBuffer(o));for(let j=0;j<o;j++)t[j]=Z.charCodeAt(j);return t.buffer}},11172:(s,Z,o)=>{o.d(Z,{b:()=>j});class t{static Eval(s,Z){return"true"===(s=s.match(/\([^()]*\)/g)?s.replace(/\([^()]*\)/g,(s=>(s=s.slice(1,s.length-1),t._HandleParenthesisContent(s,Z)))):t._HandleParenthesisContent(s,Z))||"false"!==s&&t.Eval(s,Z)}static _HandleParenthesisContent(s,Z){let o;Z=Z||(s=>"true"===s);const j=s.split("||");for(const S in j)if(Object.prototype.hasOwnProperty.call(j,S)){let s=t._SimplifyNegation(j[S].trim());const a=s.split("&&");if(a.length>1)for(let j=0;j<a.length;++j){const S=t._SimplifyNegation(a[j].trim());if(o="true"!==S&&"false"!==S?"!"===S[0]?!Z(S.substring(1)):Z(S):"true"===S,!o){s="false";break}}if(o||"true"===s){o=!0;break}o="true"!==s&&"false"!==s?"!"===s[0]?!Z(s.substring(1)):Z(s):"true"===s}return o?"true":"false"}static _SimplifyNegation(s){return"!true"===(s=(s=s.replace(/^[\s!]+/,(s=>(s=s.replace(/[\s]/g,(()=>""))).length%2?"!":""))).trim())?s="false":"!false"===s&&(s="true"),s}}class j{static EnableFor(s){s._tags=s._tags||{},s.hasTags=()=>j.HasTags(s),s.addTags=Z=>j.AddTagsTo(s,Z),s.removeTags=Z=>j.RemoveTagsFrom(s,Z),s.matchesTagsQuery=Z=>j.MatchesQuery(s,Z)}static DisableFor(s){delete s._tags,delete s.hasTags,delete s.addTags,delete s.removeTags,delete s.matchesTagsQuery}static HasTags(s){if(!s._tags)return!1;const Z=s._tags;for(const o in Z)if(Object.prototype.hasOwnProperty.call(Z,o))return!0;return!1}static GetTags(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!s._tags)return null;if(Z){const Z=[];for(const o in s._tags)Object.prototype.hasOwnProperty.call(s._tags,o)&&!0===s._tags[o]&&Z.push(o);return Z.join(" ")}return s._tags}static AddTagsTo(s,Z){if(!Z)return;if("string"!==typeof Z)return;const o=Z.split(" ");for(const t of o)j._AddTagTo(s,t)}static _AddTagTo(s,Z){""!==(Z=Z.trim())&&"true"!==Z&&"false"!==Z&&(Z.match(/[\s]/)||Z.match(/^([!]|([|]|[&]){2})/)||(j.EnableFor(s),s._tags[Z]=!0))}static RemoveTagsFrom(s,Z){if(!j.HasTags(s))return;const o=Z.split(" ");for(const t in o)j._RemoveTagFrom(s,o[t])}static _RemoveTagFrom(s,Z){delete s._tags[Z]}static MatchesQuery(s,Z){return void 0===Z||(""===Z?j.HasTags(s):t.Eval(Z,(Z=>j.HasTags(s)&&s._tags[Z])))}}},11405:(s,Z,o)=>{o.d(Z,{b:()=>A,e:()=>H,g:()=>i,h:()=>N,k:()=>u});var t=o(11410),j=o(11416),S=o(11086),a=o(11433),O=o(11013),v=o(10916),G=o(11167),B=o(11441),Q=o(11304);class D extends B.c{_gatherImports(s,Z){s?(this._webGPUReady=!0,Z.push(Promise.all([o.e(36).then(o.bind(o,13543))]))):Z.push(Promise.all([o.e(37).then(o.bind(o,13550))])),super._gatherImports(s,Z)}constructor(s){super({...arguments.length>2?arguments[2]:void 0,name:s,wa:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||Q.d.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:D.FragmentUrl})}}D.FragmentUrl="pass";class z extends B.c{_gatherImports(s,Z){s?(this._webGPUReady=!0,Z.push(Promise.all([o.e(43).then(o.bind(o,13575))]))):Z.push(Promise.all([o.e(44).then(o.bind(o,13580))])),super._gatherImports(s,Z)}constructor(s){super({...arguments.length>2?arguments[2]:void 0,name:s,wa:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||Q.d.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:z.FragmentUrl,defines:"#define POSITIVEX"}),this._face=0}get face(){return this._face}set face(s){if(!(s<0||s>5))switch(this._face=s,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ")}}}z.FragmentUrl="passCube";var Y=o(11091);class b extends a.d{getClassName(){return"PassPostProcess"}constructor(s,Z){let o=arguments.length>4?arguments[4]:void 0;const t={size:"number"===typeof Z?Z:void 0,camera:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,samplingMode:arguments.length>3?arguments[3]:void 0,wa:o,reusable:arguments.length>5?arguments[5]:void 0,textureType:arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,blockCompilation:arguments.length>7&&void 0!==arguments[7]&&arguments[7],...Z};super(s,D.FragmentUrl,{effectWrapper:"number"!==typeof Z&&Z.effectWrapper?void 0:new D(s,o,t),...t})}static _Parse(s,Z,o,t){return G.c.Parse((()=>new b(s.name,s.options,Z,s.renderTargetSamplingMode,s._engine,s.reusable)),s,o,t)}}(0,v.f)("BABYLON.PassPostProcess",b);class f extends a.d{get face(){return this._effectWrapper.face}set face(s){this._effectWrapper.face=s}getClassName(){return"PassCubePostProcess"}constructor(s,Z){let o=arguments.length>4?arguments[4]:void 0;const t={size:"number"===typeof Z?Z:void 0,camera:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,samplingMode:arguments.length>3?arguments[3]:void 0,wa:o,reusable:arguments.length>5?arguments[5]:void 0,textureType:arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,blockCompilation:arguments.length>7&&void 0!==arguments[7]&&arguments[7],...Z};super(s,D.FragmentUrl,{effectWrapper:"number"!==typeof Z&&Z.effectWrapper?void 0:new z(s,o,t),...t})}static _Parse(s,Z,o,t){return G.c.Parse((()=>new f(s.name,s.options,Z,s.renderTargetSamplingMode,s._engine,s.reusable)),s,o,t)}}function A(s,Z,o,t,j,S,O,v){const G=Z.getEngine();return Z.isReady=!1,j=j??Z.samplingMode,t=t??Z.type,S=S??Z.format,O=O??Z.width,v=v??Z.height,-1===t&&(t=0),new Promise((B=>{const Q=new a.d("postprocess",s,null,null,1,null,j,G,!1,void 0,t,void 0,null,!1,S);Q.externalTextureSamplerBinding=!0;const D=G.createRenderTargetTexture({width:O,height:v},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:j,type:t,format:S});Q.onEffectCreatedObservable.addOnce((s=>{s.executeWhenCompiled((()=>{Q.onApply=s=>{s._bindTexture("textureSampler",Z),s.setFloat2("scale",1,1)},o.postProcessManager.directRender([Q],D,!0),G.restoreDefaultFramebuffer(),G._releaseTexture(Z),Q&&Q.dispose(),D._swapAndDie(Z),Z.type=t,Z.format=5,Z.isReady=!0,B(Z)}))}))}))}let d,U;function u(s){d||(d=new Float32Array(1),U=new Int32Array(d.buffer)),d[0]=s;const Z=U[0];let o=Z>>16&32768,t=Z>>12&2047;const j=Z>>23&255;return j<103?o:j>142?(o|=31744,o|=(255==j?0:1)&&8388607&Z,o):j<113?(t|=2048,o|=(t>>114-j)+(t>>113-j&1),o):(o|=j-112<<10|t>>1,o+=1&t,o)}function H(s){const Z=(32768&s)>>15,o=(31744&s)>>10,t=1023&s;return 0===o?(Z?-1:1)*Math.pow(2,-14)*(t/Math.pow(2,10)):31==o?t?NaN:1/0*(Z?-1:1):(Z?-1:1)*Math.pow(2,o-15)*(1+t/Math.pow(2,10))}(0,S.c)([(0,Y.K)()],f.prototype,"face",null),O.e._RescalePostProcessFactory=s=>new b("rescale",1,null,2,s,!1,0);const F=async(s,Z,S,O,v)=>{const G=s.Ls(),B=G.getEngine();let Q;if(B.isWebGPU?s.isCube?await o.e(40).then(o.bind(o,13565)):await o.e(41).then(o.bind(o,13568)):s.isCube?await o.e(38).then(o.bind(o,13555)):await o.e(39).then(o.bind(o,13563)),s.isCube){const s=["#define POSITIVEX","#define NEGATIVEX","#define POSITIVEY","#define NEGATIVEY","#define POSITIVEZ","#define NEGATIVEZ"];Q=new a.d("lodCube","lodCube",{uniforms:["lod","gamma"],samplingMode:t.c.NEAREST_NEAREST_MIPNEAREST,wa:B,defines:s[O],shaderLanguage:B.isWebGPU?1:0})}else Q=new a.d("lod","lod",{uniforms:["lod","gamma"],samplingMode:t.c.NEAREST_NEAREST_MIPNEAREST,wa:B,shaderLanguage:B.isWebGPU?1:0});await new Promise((s=>{Q.onEffectCreatedObservable.addOnce((Z=>{Z.executeWhenCompiled((()=>{s(0)}))}))}));const D=new j.d("temp",{width:Z,height:S},G,!1);Q.onApply=function(Z){Z.setTexture("textureSampler",s),Z.setFloat("lod",v),Z.setInt("gamma",s.gammaSpace?1:0)};const z=s.getInternalTexture();try{if(D.renderTarget&&z){const o=z.samplingMode;0!==v?s.updateSamplingMode(t.c.NEAREST_NEAREST_MIPNEAREST):s.updateSamplingMode(t.c.NEAREST_NEAREST),G.postProcessManager.directRender([Q],D.renderTarget,!0),s.updateSamplingMode(o);const j=await B.readPixels(0,0,Z,S),a=new Uint8Array(j.buffer,0,j.byteLength);return B.unBindFramebuffer(D.renderTarget),a}throw Error("Render to texture failed.")}finally{D.dispose(),Q.dispose()}};async function i(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return!s.isReady()&&s._texture&&await new Promise(((Z,o)=>{null!==s._texture?s._texture.onLoadedObservable.addOnce((()=>{Z(0)})):o(0)})),await F(s,Z,o,t,j)}const N={CreateResizedCopy:function(s,Z,o){let S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const a=s.Ls(),O=a.getEngine(),v=new j.d("resized"+s.name,{width:Z,height:o},a,!s.noMipmap,!0,s._texture.type,!1,s.samplingMode,!1);v.wrapU=s.wrapU,v.wrapV=s.wrapV,v.uOffset=s.uOffset,v.vOffset=s.vOffset,v.uScale=s.uScale,v.vScale=s.vScale,v.uAng=s.uAng,v.vAng=s.vAng,v.wAng=s.wAng,v.coordinatesIndex=s.coordinatesIndex,v.level=s.level,v.anisotropicFilteringLevel=s.anisotropicFilteringLevel,v._texture.isReady=!1,s.wrapU=t.c.CLAMP_ADDRESSMODE,s.wrapV=t.c.CLAMP_ADDRESSMODE;const G=new b("pass",1,null,S?t.c.BILINEAR_SAMPLINGMODE:t.c.NEAREST_SAMPLINGMODE,O,!1,0);return G.externalTextureSamplerBinding=!0,G.onEffectCreatedObservable.addOnce((Z=>{Z.executeWhenCompiled((()=>{G.onApply=function(Z){Z.setTexture("textureSampler",s)};const Z=v.renderTarget;Z&&(a.postProcessManager.directRender([G],Z),O.unBindFramebuffer(Z),v.disposeFramebufferObjects(),G.dispose(),v.getInternalTexture().isReady=!0)}))})),v},ApplyPostProcess:A,ToHalfFloat:u,FromHalfFloat:H,GetTextureDataAsync:i}},11009:(s,Z,o)=>{o.d(Z,{c:()=>j,d:()=>a});let t=[];class j{static SetImmediate(s){0===t.length&&setTimeout((()=>{const s=t;t=[];for(const Z of s)Z()}),1),t.push(s)}}function S(s,Z,o){try{if(s())return Z(),!0}catch(t){return null===o||void 0===o||o(t),!0}return!1}const a=function(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,a=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&S(s,Z,o))return null;const O=setInterval((()=>{S(s,Z,o)?clearInterval(O):(j-=t,j<0&&(clearInterval(O),null===o||void 0===o||o(new Error("Operation timed out after maximum retries. "+(a||"")),!0)))}),t);return()=>clearInterval(O)}},11077:(s,Z,o)=>{function t(s){let Z=1;do{Z*=2}while(Z<s);return Z===s}function j(s,Z,o){return s*(1-o)+Z*o}function S(s){const Z=a(s),o=O(s);return Z-s>s-o?o:Z}function a(s){return s--,s|=s>>1,s|=s>>2,s|=s>>4,s|=s>>8,s|=s>>16,++s}function O(s){return s|=s>>1,s|=s>>2,s|=s>>4,s|=s>>8,(s|=s>>16)-(s>>1)}function v(s,Z){let o;switch(arguments.length>2&&void 0!==arguments[2]?arguments[2]:2){case 1:o=O(s);break;case 2:o=S(s);break;default:o=a(s)}return Math.min(o,Z)}o.d(Z,{d:()=>O,f:()=>v,i:()=>t,l:()=>j,m:()=>S})},10938:(s,Z,o)=>{o.d(Z,{d:()=>A,g:()=>f});var t=o(10932),j=o(10947),S=o(10955),a=o(10964),O=o(10968),v=o(10975),G=o(10977),B=o(10927),Q=o(10982),D=o(11009),z=o(11066),Y=o(11070),b=o(11077);class f{static get BaseUrl(){return Q.h.BaseUrl}static set BaseUrl(s){Q.h.BaseUrl=s}static get CleanUrl(){return Q.h.CleanUrl}static set CleanUrl(s){Q.h.CleanUrl=s}static IsAbsoluteUrl(s){return 0===s.indexOf("//")||-1!==s.indexOf("://")&&(-1!==s.indexOf(".")&&(-1!==s.indexOf("/")&&(!(s.indexOf(":")>s.indexOf("/"))&&(s.indexOf("://")<s.indexOf(".")||(0===s.indexOf("data:")||0===s.indexOf("blob:"))))))}static set ScriptBaseUrl(s){Q.h.ScriptBaseUrl=s}static get ScriptBaseUrl(){return Q.h.ScriptBaseUrl}static set CDNBaseUrl(s){f.ScriptBaseUrl=s,f.AssetBaseUrl=s}static set ScriptPreprocessUrl(s){Q.h.ScriptPreprocessUrl=s}static get ScriptPreprocessUrl(){return Q.h.ScriptPreprocessUrl}static get DefaultRetryStrategy(){return Q.h.DefaultRetryStrategy}static set DefaultRetryStrategy(s){Q.h.DefaultRetryStrategy=s}static get CorsBehavior(){return Q.h.CorsBehavior}static set CorsBehavior(s){Q.h.CorsBehavior=s}static get UseFallbackTexture(){return B.c.UseFallbackTexture}static set UseFallbackTexture(s){B.c.UseFallbackTexture=s}static get RegisteredExternalClasses(){return z.c.RegisteredExternalClasses}static set RegisteredExternalClasses(s){z.c.RegisteredExternalClasses=s}static get fallbackTexture(){return B.c.FallbackTexture}static set fallbackTexture(s){B.c.FallbackTexture=s}static FetchToRef(s,Z,o,t,j,S){const a=4*((Math.abs(s)*o%o|0)+(Math.abs(Z)*t%t|0)*o);S.r=j[a]/255,S.g=j[a+1]/255,S.b=j[a+2]/255,S.a=j[a+3]/255}static Mix(s,Z,o){return 0}static Instantiate(s){return z.c.Instantiate(s)}static SetImmediate(s){D.c.SetImmediate(s)}static IsExponentOfTwo(s){return!0}static FloatRound(s){return Math.fround(s)}static GetFilename(s){const Z=s.lastIndexOf("/");return Z<0?s:s.substring(Z+1)}static GetFolderPath(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const o=s.lastIndexOf("/");return o<0?Z?s:"":s.substring(0,o+1)}static ToDegrees(s){return 180*s/Math.PI}static ToRadians(s){return s*Math.PI/180}static SmoothAngleChange(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9;const t=this.ToRadians(s),j=this.ToRadians(Z);return this.ToDegrees(Math.atan2((1-o)*Math.sin(j)+o*Math.sin(t),(1-o)*Math.cos(j)+o*Math.cos(t)))}static MakeArray(s,Z){return!0===Z||void 0!==s&&null!=s?Array.isArray(s)?s:[s]:null}static GetPointerPrefix(s){return(0,j.i)()&&!window.PointerEvent?"mouse":"pointer"}static SetCorsBehavior(s,Z){(0,Q.C)(s,Z)}static SetReferrerPolicyBehavior(s,Z){Z.referrerPolicy=s}static get PreprocessUrl(){return Q.h.PreprocessUrl}static set PreprocessUrl(s){Q.h.PreprocessUrl=s}static LoadImage(s,Z,o,t,j,S){return(0,Q.x)(s,Z,o,t,j,S)}static LoadFile(s,Z,o,t,j,S){return(0,Q.t)(s,Z,o,t,j,S)}static async LoadFileAsync(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return await new Promise(((o,t)=>{(0,Q.t)(s,(s=>{o(s)}),void 0,void 0,Z,((s,Z)=>{t(Z)}))}))}static GetAssetUrl(s){if(!s)return"";if(f.AssetBaseUrl&&s.startsWith(f._DefaultAssetsUrl)){const Z="/"===f.AssetBaseUrl[f.AssetBaseUrl.length-1]?f.AssetBaseUrl.substring(0,f.AssetBaseUrl.length-1):f.AssetBaseUrl;return s.replace(f._DefaultAssetsUrl,Z)}return s}static GetBabylonScriptURL(s,Z){if(!s)return"";if(f.ScriptBaseUrl&&s.startsWith(f._DefaultCdnUrl)){const Z="/"===f.ScriptBaseUrl[f.ScriptBaseUrl.length-1]?f.ScriptBaseUrl.substring(0,f.ScriptBaseUrl.length-1):f.ScriptBaseUrl;s=s.replace(f._DefaultCdnUrl,Z)}return s=f.ScriptPreprocessUrl(s),Z&&(s=f.GetAbsoluteUrl(s)),s}static LoadBabylonScript(s,Z,o,t){s=f.GetBabylonScriptURL(s),f.LoadScript(s,Z,o)}static async LoadBabylonScriptAsync(s){return s=f.GetBabylonScriptURL(s),await f.LoadScriptAsync(s)}static LoadScript(s,Z,o,t){let S=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("function"===typeof importScripts){try{importScripts(s),Z&&Z()}catch(v){null===o||void 0===o||o(`Unable to load script '${s}' in worker`,v)}return}if(!(0,j.i)())return void(null===o||void 0===o||o(`Cannot load script '${s}' outside of a window or a worker`));const a=document.getElementsByTagName("head")[0],O=document.createElement("script");S?(O.setAttribute("type","module"),O.innerText=s):(O.setAttribute("type","text/javascript"),O.setAttribute("src",s)),t&&(O.id=t),O.onload=()=>{Z&&Z()},O.onerror=Z=>{o&&o(`Unable to load script '${s}'`,Z)},a.appendChild(O)}static async LoadScriptAsync(s,Z){return await new Promise(((o,t)=>{this.LoadScript(s,(()=>{o()}),((s,Z)=>{t(Z||new Error(s))}),Z)}))}static ReadFileAsDataURL(s,Z,o){const j=new FileReader,S={onCompleteObservable:new t.b,abort:()=>j.abort()};return j.onloadend=()=>{S.onCompleteObservable.notifyObservers(S)},j.onload=s=>{Z(s.target.result)},j.onprogress=o,j.readAsDataURL(s),S}static ReadFile(s,Z,o,t,j){return(0,Q.y)(s,Z,o,t,j)}static FileAsURL(s){const Z=new Blob([s]);return window.URL.createObjectURL(Z)}static Format(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return s.toFixed(Z)}static DeepCopy(s,Z,o,t){a.c.DeepCopy(s,Z,o,t)}static IsEmpty(s){for(const Z in s)if(Object.prototype.hasOwnProperty.call(s,Z))return!1;return!0}static RegisterTopRootEvents(s,Z){for(let t=0;t<Z.length;t++){const j=Z[t];s.addEventListener(j.name,j.handler,!1);try{window.parent&&window.parent.addEventListener(j.name,j.handler,!1)}catch(o){}}}static UnregisterTopRootEvents(s,Z){for(let t=0;t<Z.length;t++){const j=Z[t];s.removeEventListener(j.name,j.handler);try{s.parent&&s.parent.removeEventListener(j.name,j.handler)}catch(o){}}}static async DumpFramebuffer(s,Z,o,t){throw(0,v.d)("DumpTools")}static DumpData(s,Z,o,t){throw(0,v.d)("DumpTools")}static async DumpDataAsync(s,Z,o){throw(0,v.d)("DumpTools")}static _IsOffScreenCanvas(s){return void 0!==s.convertToBlob}static ToBlob(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",t=arguments.length>3?arguments[3]:void 0;f._IsOffScreenCanvas(s)||s.toBlob||(s.toBlob=function(s,Z,o){setTimeout((()=>{const t=atob(this.toDataURL(Z,o).split(",")[1]),j=t.length,S=new Uint8Array(j);for(let s=0;s<j;s++)S[s]=t.charCodeAt(s);s(new Blob([S]))}))}),f._IsOffScreenCanvas(s)?s.convertToBlob({type:o,quality:t}).then((s=>Z(s))):s.toBlob((function(s){Z(s)}),o,t)}static DownloadBlob(s,Z){if("download"in document.createElement("a")){if(!Z){const s=new Date;Z="screenshot_"+((s.getFullYear()+"-"+(s.getMonth()+1)).slice(2)+"-"+s.getDate()+"_"+s.getHours()+"-"+("0"+s.getMinutes()).slice(-2))+".png"}f.Download(s,Z)}else if(s&&"undefined"!==typeof URL){const Z=URL.createObjectURL(s),o=window.open("");if(!o)return;const t=o.document.createElement("img");t.onload=function(){URL.revokeObjectURL(Z)},t.src=Z,o.document.body.appendChild(t)}}static EncodeScreenshotCanvasData(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",t=arguments.length>3?arguments[3]:void 0,j=arguments.length>4?arguments[4]:void 0;if("string"!==typeof t&&Z){if(Z){if(f._IsOffScreenCanvas(s))return void s.convertToBlob({type:o,quality:j}).then((s=>{const o=new FileReader;o.readAsDataURL(s),o.onloadend=()=>{const s=o.result;Z(s)}}));const t=s.toDataURL(o,j);Z(t)}}else this.ToBlob(s,(function(s){s&&f.DownloadBlob(s,t),Z&&Z("")}),o,j)}static Download(s,Z){if("undefined"===typeof URL)return;const o=window.URL.createObjectURL(s),t=document.createElement("a");document.body.appendChild(t),t.style.display="none",t.href=o,t.download=Z,t.addEventListener("click",(()=>{t.parentElement&&t.parentElement.removeChild(t)})),t.click(),window.URL.revokeObjectURL(o)}static BackCompatCameraNoPreventDefault(s){return"boolean"===typeof s[0]?s[0]:"boolean"===typeof s[1]&&s[1]}static CreateScreenshot(s,Z,o,t){throw(0,v.d)("ScreenshotTools")}static async CreateScreenshotAsync(s,Z,o){throw(0,v.d)("ScreenshotTools")}static CreateScreenshotUsingRenderTarget(s,Z,o,t){throw(0,v.d)("ScreenshotTools")}static async CreateScreenshotUsingRenderTargetAsync(s,Z,o){throw(0,v.d)("ScreenshotTools")}static RandomId(){return(0,Y.c)()}static IsBase64(s){return(0,Q.p)(s)}static DecodeBase64(s){return(0,Q.e)(s)}static get errorsCount(){return S.b.errorsCount}static Log(s){S.b.Log(s)}static Warn(s){S.b.Warn(s)}static Error(s){S.b.Error(s)}static get LogCache(){return S.b.LogCache}static ClearLogCache(){S.b.ClearLogCache()}static set LogLevels(s){S.b.LogLevels=s}static set PerformanceLogLevel(s){return(s&f.PerformanceUserMarkLogLevel)===f.PerformanceUserMarkLogLevel?(f.StartPerformanceCounter=f._StartUserMark,void(f.EndPerformanceCounter=f._EndUserMark)):(s&f.PerformanceConsoleLogLevel)===f.PerformanceConsoleLogLevel?(f.StartPerformanceCounter=f._StartPerformanceConsole,void(f.EndPerformanceCounter=f._EndPerformanceConsole)):(f.StartPerformanceCounter=f._StartPerformanceCounterDisabled,void(f.EndPerformanceCounter=f._EndPerformanceCounterDisabled))}static _StartPerformanceCounterDisabled(s,Z){}static _EndPerformanceCounterDisabled(s,Z){}static _StartUserMark(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!f._Performance){if(!(0,j.i)())return;f._Performance=window.performance}Z&&f._Performance.mark&&f._Performance.mark(s+"-Begin")}static _EndUserMark(s){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&f._Performance.mark&&(f._Performance.mark(s+"-End"),f._Performance.measure(s,s+"-Begin",s+"-End"))}static _StartPerformanceConsole(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Z&&(f._StartUserMark(s,Z),console.time&&console.time(s))}static _EndPerformanceConsole(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Z&&(f._EndUserMark(s,Z),console.timeEnd(s))}static get Now(){return O.c.Now}static GetClassName(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=null;if(!Z&&s.getClassName)o=s.getClassName();else{if(s instanceof Object){o=(Z?s:Object.getPrototypeOf(s)).constructor.__bjsclassName__}o||(o=typeof s)}return o}static First(s,Z){for(const o of s)if(Z(o))return o;return null}static getFullClassName(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=null,t=null;if(!Z&&s.getClassName)o=s.getClassName();else{if(s instanceof Object){const j=Z?s:Object.getPrototypeOf(s);o=j.constructor.__bjsclassName__,t=j.constructor.__bjsmoduleName__}o||(o=typeof s)}return o?(null!=t?t+".":"")+o:null}static async DelayAsync(s){await new Promise((Z=>{setTimeout((()=>{Z()}),s)}))}static IsSafari(){return!!(0,j.g)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}f.AssetBaseUrl="",f.UseCustomRequestHeaders=!1,f.CustomRequestHeaders=G.c.CustomRequestHeaders,f.GetDOMTextContent=j.d,f._DefaultCdnUrl="https://cdn.babylonjs.com",f._DefaultAssetsUrl="https://assets.babylonjs.com/core",f.GetAbsoluteUrl="object"===typeof document?s=>{const Z=document.createElement("a");return Z.href=s,Z.href}:"function"===typeof URL&&"object"===typeof location?s=>new URL(s,location.origin).href:()=>{throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},f.NoneLogLevel=S.b.NoneLogLevel,f.MessageLogLevel=S.b.MessageLogLevel,f.WarningLogLevel=S.b.WarningLogLevel,f.ErrorLogLevel=S.b.ErrorLogLevel,f.AllLogLevel=S.b.AllLogLevel,f.IsWindowObjectExist=j.i,f.PerformanceNoneLogLevel=0,f.PerformanceUserMarkLogLevel=1,f.PerformanceConsoleLogLevel=2,f.StartPerformanceCounter=f._StartPerformanceCounterDisabled,f.EndPerformanceCounter=f._EndPerformanceCounterDisabled;class A{constructor(s,Z,o){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.iterations=s,this.index=t-1,this._done=!1,this._fn=Z,this._successCallback=o}executeNext(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}breakLoop(){this._done=!0,this._successCallback()}static Run(s,Z,o){const t=new A(s,Z,o,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return t.executeNext(),t}static SyncAsyncForLoop(s,Z,o,t,j){let S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return A.Run(Math.ceil(s/Z),(t=>{j&&j()?t.breakLoop():setTimeout((()=>{for(let S=0;S<Z;++S){const a=t.index*Z+S;if(a>=s)break;if(o(a),j&&j()){t.breakLoop();break}}t.executeNext()}),S)}),t)}}f.Mix=b.l,f.IsExponentOfTwo=b.i,B.c.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},10916:(s,Z,o)=>{o.d(Z,{e:()=>S,f:()=>j});const t={};function j(s,Z){t[s]=Z}function S(s){return t[s]}},11539:(s,Z,o)=>{o.d(Z,{b:()=>t});class t{static get UniqueId(){const s=this._UniqueIdCounter;return this._UniqueIdCounter++,s}}t._UniqueIdCounter=1},10977:(s,Z,o)=>{o.d(Z,{c:()=>t});class t{constructor(){this._xhr="undefined"!==typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(t.CustomRequestHeaders).length>0||t.CustomRequestModifiers.length>0}get requestURL(){return this._requestURL}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const s in t.CustomRequestHeaders){const Z=t.CustomRequestHeaders[s];Z&&this._xhr.setRequestHeader(s,Z)}}_shouldSkipRequestModifications(s){return t.SkipRequestModificationForBabylonCDN&&(s.includes("preview.babylonjs.com")||s.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(s){this._xhr.onprogress=s}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(s){this._xhr.responseType=s}get timeout(){return this._xhr.timeout}set timeout(s){this._xhr.timeout=s}addEventListener(s,Z,o){this._xhr.addEventListener(s,Z,o)}removeEventListener(s,Z,o){this._xhr.removeEventListener(s,Z,o)}abort(){this._xhr.abort()}send(s){t.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(s)}open(s,Z){for(const o of t.CustomRequestModifiers){if(this._shouldSkipRequestModifications(Z))return;Z=o(this._xhr,Z)||Z}Z=(Z=Z.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=Z,this._xhr.open(s,Z,!0)}setRequestHeader(s,Z){this._xhr.setRequestHeader(s,Z)}getResponseHeader(s){return this._xhr.getResponseHeader(s)}}t.CustomRequestHeaders={},t.CustomRequestModifiers=new Array,t.SkipRequestModificationForBabylonCDN=!0},11665:(s,Z,o)=>{o.d(Z,{d:()=>j});class t{constructor(s){this._pendingActions=new Array,this._workerInfos=s.map((s=>({workerPromise:Promise.resolve(s),idle:!0})))}dispose(){for(const s of this._workerInfos)s.workerPromise.then((s=>{s.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(s){this._executeOnIdleWorker(s)||this._pendingActions.push(s)}_executeOnIdleWorker(s){for(const Z of this._workerInfos)if(Z.idle)return this._execute(Z,s),!0;return!1}_execute(s,Z){s.idle=!1,s.workerPromise.then((o=>{Z(o,(()=>{const Z=this._pendingActions.shift();Z?this._execute(s,Z):s.idle=!0}))}))}}class j extends t{constructor(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j.DefaultOptions;super([]),this._maxWorkers=s,this._createWorkerAsync=Z,this._options=o}push(s){if(!this._executeOnIdleWorker(s))if(this._workerInfos.length<this._maxWorkers){const Z={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(Z),this._execute(Z,s)}else this._pendingActions.push(s)}_execute(s,Z){s.timeoutId&&(clearTimeout(s.timeoutId),delete s.timeoutId),super._execute(s,((o,t)=>{Z(o,(()=>{t(),s.idle&&(s.timeoutId=setTimeout((()=>{s.workerPromise.then((s=>{s.terminate()}));const Z=this._workerInfos.indexOf(s);-1!==Z&&this._workerInfos.splice(Z,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}j.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},11619:(s,Z,o)=>{o.d(Z,{e:()=>B});var t=o(11086),j=o(10932),S=o(10927),a=o(11113),O=o(11091),v=o(11167),G=o(10916);class B{get influence(){return this._influence}set influence(s){if(this._influence===s)return;const Z=this._influence;this._influence=s,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===Z||0===s)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(s){this._animationPropertiesOverride=s}constructor(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=s,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uv2s=null,this._colors=null,this._uniqueId=0,this.onInfluenceChanged=new j.b,this._onDataLayoutChanged=new j.b,this._animationPropertiesOverride=null,this.id=s,this._scene=o||S.c.LastCreatedScene,this.influence=Z,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}get hasUV2s(){return!!this._uv2s}get hasColors(){return!!this._colors}get vertexCount(){return this._positions?this._positions.length/3:this._normals?this._normals.length/3:this._tangents?this._tangents.length/3:this._uvs?this._uvs.length/2:this._uv2s?this._uv2s.length/2:this._colors?this._colors.length/4:0}setPositions(s){const Z=this.hasPositions;this._positions=s,Z!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(s){const Z=this.hasNormals;this._normals=s,Z!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(s){const Z=this.hasTangents;this._tangents=s,Z!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(s){const Z=this.hasUVs;this._uvs=s,Z!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}setUV2s(s){const Z=this.hasUV2s;this._uv2s=s,Z!==this.hasUV2s&&this._onDataLayoutChanged.notifyObservers(void 0)}getUV2s(){return this._uv2s}setColors(s){const Z=this.hasColors;this._colors=s,Z!==this.hasColors&&this._onDataLayoutChanged.notifyObservers(void 0)}getColors(){return this._colors}clone(){const s=v.c.Clone((()=>new B(this.name,this.influence,this._scene)),this);return s._positions=this._positions,s._normals=this._normals,s._tangents=this._tangents,s._uvs=this._uvs,s._uv2s=this._uv2s,s._colors=this._colors,s}serialize(){const s={};return s.name=this.name,s.influence=this.influence,s.gs=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(s.id=this.id),this.hasNormals&&(s.ls=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(s.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(s.es=Array.prototype.slice.call(this.getUVs())),this.hasUV2s&&(s.uv2s=Array.prototype.slice.call(this.getUV2s())),this.hasColors&&(s.Rs=Array.prototype.slice.call(this.getColors())),v.c.AppendSerializedAnimations(this,s),s}getClassName(){return"MorphTarget"}static Parse(s,Z){const o=new B(s.name,s.influence);if(o.setPositions(s.gs),null!=s.id&&(o.id=s.id),s.ls&&o.setNormals(s.ls),s.tangents&&o.setTangents(s.tangents),s.es&&o.setUVs(s.es),s.uv2s&&o.setUV2s(s.uv2s),s.Rs&&o.setColors(s.Rs),s.animations){for(let Z=0;Z<s.animations.length;Z++){const t=s.animations[Z],j=(0,G.e)("BABYLON.Animation");j&&o.animations.push(j.Parse(t))}s.autoAnimate&&Z&&Z.beginAnimation(o,s.autoAnimateFrom,s.autoAnimateTo,s.autoAnimateLoop,s.autoAnimateSpeed||1)}return o}static FromMesh(s,Z,o){Z||(Z=s.name);const t=new B(Z,o,s.Ls());return t.setPositions(s.getVerticesData(a.e.PositionKind)),s.isVerticesDataPresent(a.e.NormalKind)&&t.setNormals(s.getVerticesData(a.e.NormalKind)),s.isVerticesDataPresent(a.e.TangentKind)&&t.setTangents(s.getVerticesData(a.e.TangentKind)),s.isVerticesDataPresent(a.e.UVKind)&&t.setUVs(s.getVerticesData(a.e.UVKind)),s.isVerticesDataPresent(a.e.UV2Kind)&&t.setUV2s(s.getVerticesData(a.e.UV2Kind)),s.isVerticesDataPresent(a.e.ColorKind)&&t.setColors(s.getVerticesData(a.e.ColorKind)),t}}(0,t.c)([(0,O.K)()],B.prototype,"id",void 0)},11433:(s,Z,o)=>{o.d(Z,{d:()=>Y});var t=o(11086),j=o(11253),S=o(10932),a=o(10900),O=o(11019),v=o(11091),G=o(11167),B=o(10916),Q=o(11013),D=o(11077),z=o(11441);Q.e.prototype.setTextureFromPostProcess=function(s,Z,o){var t;let j=null;Z&&(Z._forcedOutputTexture?j=Z._forcedOutputTexture:Z._textures.data[Z._currentRenderTextureInd]&&(j=Z._textures.data[Z._currentRenderTextureInd])),this._bindTexture(s,(null===(t=j)||void 0===t?void 0:t.texture)??null,o)},Q.e.prototype.setTextureFromPostProcessOutput=function(s,Z,o){var t;this._bindTexture(s,(null===Z||void 0===Z||null===(t=Z._outputTexture)||void 0===t?void 0:t.texture)??null,o)},O.d.prototype.setTextureFromPostProcess=function(s,Z){this._engine.setTextureFromPostProcess(this._samplers[s],Z,s)},O.d.prototype.setTextureFromPostProcessOutput=function(s,Z){this._engine.setTextureFromPostProcessOutput(this._samplers[s],Z,s)};class Y{static get ForceGLSL(){return z.c.ForceGLSL}static set ForceGLSL(s){z.c.ForceGLSL=s}static RegisterShaderCodeProcessing(s,Z){z.c.RegisterShaderCodeProcessing(s,Z)}get name(){return this._effectWrapper.name}set name(s){this._effectWrapper.name=s}get alphaMode(){return this._effectWrapper.alphaMode}set alphaMode(s){this._effectWrapper.alphaMode=s}get samples(){return this._samples}set samples(s){this._samples=Math.min(s,this._engine.getCaps().maxMSAASamples),this._textures.forEach((s=>{s.setSamples(this._samples)}))}get shaderLanguage(){return this._shaderLanguage}getEffectName(){return this._fragmentUrl}set onActivate(s){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),s&&(this._onActivateObserver=this.onActivateObservable.add(s))}set onSizeChanged(s){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(s)}set onApply(s){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(s)}set onBeforeRender(s){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(s)}set onAfterRender(s){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(s)}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}set inputTexture(s){this._forcedOutputTexture=s}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}getCamera(){return this._camera}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.Ja(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}constructor(s,Z,o,t,O,v){var G;let B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,Q=arguments.length>7?arguments[7]:void 0,D=arguments.length>8?arguments[8]:void 0,b=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,f=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,A=arguments.length>11&&void 0!==arguments[11]?arguments[11]:"postprocess",d=arguments.length>12?arguments[12]:void 0,U=arguments.length>13&&void 0!==arguments[13]&&arguments[13],u=arguments.length>14&&void 0!==arguments[14]?arguments[14]:5,H=arguments.length>15?arguments[15]:void 0,F=arguments.length>16?arguments[16]:void 0;this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.aQ=!0,this.forceAutoClearInAlphaMode=!1,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new j.f(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new a.j(1,1),this._texelSize=a.j.Zero(),this.onActivateObservable=new S.b,this.onSizeChangedObservable=new S.b,this.onApplyObservable=new S.b,this.onBeforeRenderObservable=new S.b,this.onAfterRenderObservable=new S.b,this.jO=new S.b;let i,N=1,L=null;if(o&&!Array.isArray(o)){const s=o;o=s.uniforms??null,t=s.samplers??null,N=s.size??1,v=s.camera??null,B=s.samplingMode??1,Q=s.wa,D=s.reusable,b=Array.isArray(s.defines)?s.defines.join("\n"):s.defines??null,f=s.textureType??0,A=s.vertexUrl??"postprocess",d=s.indexParameters,U=s.blockCompilation??!1,u=s.textureFormat??5,H=s.shaderLanguage??0,L=s.uniformBuffers??null,F=s.extraInitializations,i=s.effectWrapper}else O&&(N="number"===typeof O?O:{width:O.width,height:O.height});if(this._useExistingThinPostProcess=!!i,this._effectWrapper=i??new z.c({name:s,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:Z,wa:Q||(null===(G=v)||void 0===G?void 0:G.Ls().getEngine()),uniforms:o,samplers:t,uniformBuffers:L,defines:b,vertexUrl:A,indexParameters:d,blockCompilation:!0,shaderLanguage:H,extraInitializations:void 0}),this.name=s,this.onEffectCreatedObservable=this._effectWrapper.onEffectCreatedObservable,null!=v?(this._camera=v,this._scene=v.Ls(),v.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):Q&&(this._engine=Q,this._engine.postProcesses.push(this)),this._options=N,this.renderTargetSamplingMode=B||1,this._reusable=D||!1,this._textureType=f,this._textureFormat=u,this._shaderLanguage=H||0,this._samplers=t||[],-1===this._samplers.indexOf("textureSampler")&&this._samplers.push("textureSampler"),this._fragmentUrl=Z,this._vertexUrl=A,this._parameters=o||[],-1===this._parameters.indexOf("scale")&&this._parameters.push("scale"),this._uniformBuffers=L||[],this._indexParameters=d,!this._useExistingThinPostProcess){this._webGPUReady=1===this._shaderLanguage;const s=[];this._gatherImports(this._engine.isWebGPU&&!Y.ForceGLSL,s),this._effectWrapper._webGPUReady=this._webGPUReady,this._effectWrapper._postConstructor(U,b,F,s)}}_gatherImports(){let s=arguments.length>1?arguments[1]:void 0;arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this._webGPUReady?s.push(Promise.all([o.e(42).then(o.bind(o,13571))])):s.push(Promise.all([Promise.resolve().then(o.bind(o,11447))]))}getClassName(){return"PostProcess"}getEngine(){return this._engine}getEffect(){return this._effectWrapper.drawWrapper.effect}shareOutputWith(s){return this._disposeTextures(),this._shareOutputWithPostProcess=s,this}useOwnOutput(){0==this._textures.length&&(this._textures=new j.f(2)),this._shareOutputWithPostProcess=null}updateEffect(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3?arguments[3]:void 0,j=arguments.length>4?arguments[4]:void 0,S=arguments.length>5?arguments[5]:void 0,a=arguments.length>6?arguments[6]:void 0,O=arguments.length>7?arguments[7]:void 0;this._effectWrapper.updateEffect(s,Z,o,t,j,S,a,O),this._postProcessDefines=Array.isArray(this._effectWrapper.options.defines)?this._effectWrapper.options.defines.join("\n"):this._effectWrapper.options.defines}isReusable(){return this._reusable}markTextureDirty(){this.width=-1}_createRenderTargetTexture(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let j=0;j<this._textureCache.length;j++)if(this._textureCache[j].texture.width===s.width&&this._textureCache[j].texture.height===s.height&&this._textureCache[j].postProcessChannel===o&&this._textureCache[j].texture._generateDepthBuffer===Z.generateDepthBuffer&&this._textureCache[j].texture.samples===Z.samples)return this._textureCache[j].texture;const t=this._engine.createRenderTargetTexture(s,Z);return this._textureCache.push({texture:t,postProcessChannel:o,lastUsedRenderId:-1}),t}_flushTextureCache(){const s=this._renderId;for(let Z=this._textureCache.length-1;Z>=0;Z--)if(s-this._textureCache[Z].lastUsedRenderId>100){let s=!1;for(let o=0;o<this._textures.length;o++)if(this._textures.data[o]===this._textureCache[Z].texture){s=!0;break}s||(this._textureCache[Z].texture.dispose(),this._textureCache.splice(Z,1))}}resize(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],j=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._textures.length>0&&this._textures.reset(),this.width=s,this.height=Z;let S=null;if(o)for(let v=0;v<o._postProcesses.length;v++)if(null!==o._postProcesses[v]){S=o._postProcesses[v];break}const a={width:this.width,height:this.height},O={generateMipMaps:t,generateDepthBuffer:j||S===this,generateStencilBuffer:(j||S===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(a,O,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(a,O,1)),this._texelSize.Ja(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}_getTarget(){let s;if(this._shareOutputWithPostProcess)s=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)s=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{let Z;s=this.inputTexture;for(let o=0;o<this._textureCache.length;o++)if(this._textureCache[o].texture===s){Z=this._textureCache[o];break}Z&&(Z.lastUsedRenderId=this._renderId)}return s}activate(s){var Z,o;let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2?arguments[2]:void 0;const S=null===s||void 0!==s.cameraRigMode?s||this._camera:null,a=(null===S||void 0===S?void 0:S.Ls())??s,O=a.getEngine(),v=O.getCaps().maxTextureSize,G=(t?t.width:this._engine.getRenderWidth(!0))*this._options|0,B=(t?t.height:this._engine.getRenderHeight(!0))*this._options|0;let Q=this._options.width||G,z=this._options.height||B;const Y=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;let b=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){const s=O.currentViewport;s&&(Q*=s.width,z*=s.height)}(Y||this.alwaysForcePOT)&&(this._options.width||(Q=O.needPOTTextures?(0,D.f)(Q,v,this.scaleMode):Q),this._options.height||(z=O.needPOTTextures?(0,D.f)(z,v,this.scaleMode):z)),this.width===Q&&this.height===z&&(b=this._getTarget())||this.resize(Q,z,S,Y,j),this._textures.forEach((s=>{s.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(s,this.samples)})),this._flushTextureCache(),this._renderId++}return b||(b=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.Ja(G/Q,B/z),this._engine.bindFramebuffer(b,0,G,B,this.forceFullscreenViewport)):(this._scaleRatio.Ja(1,1),this._engine.bindFramebuffer(b,0,void 0,void 0,this.forceFullscreenViewport)),null===(Z=(o=this._engine)._debugInsertMarker)||void 0===Z||Z.call(o,`post process ${this.name} input`),this.onActivateObservable.notifyObservers(S),this.aQ&&(0===this.alphaMode||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:a.clearColor,a._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),b}get isSupported(){return this._effectWrapper.drawWrapper.effect.isSupported}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}isReady(){return this._effectWrapper.isReady()}apply(){if(!this._effectWrapper.isReady())return null;let s;var Z;(this._engine.enableEffect(this._effectWrapper.drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),this._engine.setAlphaMode(this.alphaMode),s=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding)||this._effectWrapper.drawWrapper.effect._bindTexture("textureSampler",null===(Z=s)||void 0===Z?void 0:Z.texture);return this._effectWrapper.drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effectWrapper.drawWrapper.effect),this._effectWrapper.bind(!0),this._effectWrapper.drawWrapper.effect}_disposeTextures(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())}_disposeTextureCache(){for(let s=this._textureCache.length-1;s>=0;s--)this._textureCache[s].texture.dispose();this._textureCache.length=0}setPrePassRenderer(s){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=s.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)}dispose(s){let Z;if(s=s||this._camera,this._useExistingThinPostProcess||this._effectWrapper.dispose(),this._disposeTextures(),this._scene&&(Z=this._scene.postProcesses.indexOf(this),-1!==Z&&this._scene.postProcesses.splice(Z,1)),this._parentContainer){const s=this._parentContainer.postProcesses.indexOf(this);s>-1&&this._parentContainer.postProcesses.splice(s,1),this._parentContainer=null}if(Z=this._engine.postProcesses.indexOf(this),-1!==Z&&this._engine.postProcesses.splice(Z,1),this.jO.notifyObservers(),s){if(s.detachPostProcess(this),Z=s._postProcesses.indexOf(this),0===Z&&s._postProcesses.length>0){const s=this._camera._getFirstPostProcess();s&&s.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}}serialize(){const s=G.c.Serialize(this),Z=this.getCamera()||this._scene&&this._scene.activeCamera;return s.customType="BABYLON."+this.getClassName(),s.cameraId=Z?Z.id:null,s.reusable=this._reusable,s.textureType=this._textureType,s.fragmentUrl=this._fragmentUrl,s.parameters=this._parameters,s.samplers=this._samplers,s.uniformBuffers=this._uniformBuffers,s.options=this._options,s.defines=this._postProcessDefines,s.textureFormat=this._textureFormat,s.vertexUrl=this._vertexUrl,s.indexParameters=this._indexParameters,s}clone(){const s=this.serialize();s._engine=this._engine,s.cameraId=null;const Z=Y.Parse(s,this._scene,"");return Z?(Z.onActivateObservable=this.onActivateObservable.clone(),Z.onSizeChangedObservable=this.onSizeChangedObservable.clone(),Z.onApplyObservable=this.onApplyObservable.clone(),Z.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),Z.onAfterRenderObservable=this.onAfterRenderObservable.clone(),Z._prePassEffectConfiguration=this._prePassEffectConfiguration,Z):null}static Parse(s,Z,o){const t=(0,B.e)(s.customType);if(!t||!t._Parse)return null;const j=Z?Z.getCameraById(s.cameraId):null;return t._Parse(s,j,Z,o)}static _Parse(s,Z,o,t){return G.c.Parse((()=>new Y(s.name,s.fragmentUrl,s.parameters,s.samplers,s.options,Z,s.renderTargetSamplingMode,s._engine,s.reusable,s.defines,s.textureType,s.vertexUrl,s.indexParameters,!1,s.textureFormat)),s,o,t)}}(0,t.c)([(0,v.K)()],Y.prototype,"uniqueId",void 0),(0,t.c)([(0,v.K)()],Y.prototype,"name",null),(0,t.c)([(0,v.K)()],Y.prototype,"width",void 0),(0,t.c)([(0,v.K)()],Y.prototype,"height",void 0),(0,t.c)([(0,v.K)()],Y.prototype,"renderTargetSamplingMode",void 0),(0,t.c)([(0,v.j)()],Y.prototype,"clearColor",void 0),(0,t.c)([(0,v.K)()],Y.prototype,"aQ",void 0),(0,t.c)([(0,v.K)()],Y.prototype,"forceAutoClearInAlphaMode",void 0),(0,t.c)([(0,v.K)()],Y.prototype,"alphaMode",null),(0,t.c)([(0,v.K)()],Y.prototype,"alphaConstants",void 0),(0,t.c)([(0,v.K)()],Y.prototype,"enablePixelPerfectMode",void 0),(0,t.c)([(0,v.K)()],Y.prototype,"forceFullscreenViewport",void 0),(0,t.c)([(0,v.K)()],Y.prototype,"scaleMode",void 0),(0,t.c)([(0,v.K)()],Y.prototype,"alwaysForcePOT",void 0),(0,t.c)([(0,v.K)("samples")],Y.prototype,"_samples",void 0),(0,t.c)([(0,v.K)()],Y.prototype,"adaptScaleToCurrentViewport",void 0),(0,B.f)("BABYLON.PostProcess",Y)},11424:(s,Z,o)=>{o.d(Z,{e:()=>S});var t=o(11113),j=o(10932);class S{constructor(s){this._vertexBuffers={},this.onBeforeRenderObservable=new j.b,this._scene=s}_prepareBuffers(){if(this._vertexBuffers[t.e.PositionKind])return;const s=[];s.push(1,1),s.push(-1,1),s.push(-1,-1),s.push(1,-1),this._vertexBuffers[t.e.PositionKind]=new t.e(this._scene.getEngine(),s,t.e.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const s=[];s.push(0),s.push(1),s.push(2),s.push(0),s.push(2),s.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(s)}_rebuild(){const s=this._vertexBuffers[t.e.PositionKind];s&&(s._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=this._scene.activeCamera;return!!o&&(Z=Z||o._postProcesses.filter((s=>null!=s)),!(!Z||0===Z.length||!this._scene.postProcessesEnabled)&&(Z[0].activate(o,s,null!==Z&&void 0!==Z),!0))}directRender(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,S=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:s.length;const O=this._scene.getEngine();for(let G=0;G<a;G++){var v;if(G<s.length-1)s[G+1].activate(this._scene.activeCamera||this._scene,null===Z||void 0===Z?void 0:Z.texture);else Z?O.bindFramebuffer(Z,t,void 0,void 0,o,j):S||O.restoreDefaultFramebuffer(),null===(v=O._debugInsertMarker)||void 0===v||v.call(O,`post process ${s[G].name} output`);const a=s[G],B=a.apply();B&&(a.onBeforeRenderObservable.notifyObservers(B),this._prepareBuffers(),O.bindBuffers(this._vertexBuffers,this._indexBuffer,B),O.drawElementsType(0,0,6),a.onAfterRenderObservable.notifyObservers(B))}O.setDepthBuffer(!0),O.setDepthWrite(!0)}_finalizeFrame(s,Z,o,t){let j=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const S=this._scene.activeCamera;if(!S)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(t=t||S._postProcesses.filter((s=>null!=s))).length||!this._scene.postProcessesEnabled)return;const a=this._scene.getEngine();for(let v=0,G=t.length;v<G;v++){const B=t[v];var O;if(v<G-1)B._outputTexture=t[v+1].activate(S,null===Z||void 0===Z?void 0:Z.texture);else Z?(a.bindFramebuffer(Z,o,void 0,void 0,j),B._outputTexture=Z):(a.restoreDefaultFramebuffer(),B._outputTexture=null),null===(O=a._debugInsertMarker)||void 0===O||O.call(a,`post process ${t[v].name} output`);if(s)break;const Q=B.apply();Q&&(B.onBeforeRenderObservable.notifyObservers(Q),this._prepareBuffers(),a.bindBuffers(this._vertexBuffers,this._indexBuffer,Q),a.drawElementsType(0,0,6),B.onAfterRenderObservable.notifyObservers(Q))}a.setDepthBuffer(!0),a.setDepthWrite(!0),a.setAlphaMode(0)}dispose(){const s=this._vertexBuffers[t.e.PositionKind];s&&(s.dispose(),this._vertexBuffers[t.e.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11428:(s,Z,o)=>{o.d(Z,{e:()=>O});var t=o(11253),j=o(10900);class S{set opaqueSortCompareFn(s){this._opaqueSortCompareFn=s||S.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(s){this._alphaTestSortCompareFn=s||S.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(s){this._transparentSortCompareFn=s||S.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=s,this._opaqueSubMeshes=new t.f(256),this._transparentSubMeshes=new t.f(256),this._alphaTestSubMeshes=new t.f(256),this._depthOnlySubMeshes=new t.f(256),this._particleSystems=new t.f(256),this._spriteManagers=new t.f(256),this._empty=!0,this._edgesRenderers=new t.b(16),this._scene=Z,this.opaqueSortCompareFn=o,this.alphaTestSortCompareFn=j,this.transparentSortCompareFn=S}render(s,Z,o,t){if(s)return void s(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const j=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(j.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),j.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const S=j.getStencilBuffer();if(j.setStencilBuffer(!1),Z&&this._renderSprites(),o&&this._renderParticles(t),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(j.setStencilBuffer(S),this._scene.useOrderIndependentTransparency){const s=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);s.length&&this._renderTransparent(s)}else this._renderTransparent(this._transparentSubMeshes);j.setAlphaMode(0)}if(j.setStencilBuffer(!1),this._edgesRenderers.length){for(let s=0;s<this._edgesRenderers.length;s++)this._edgesRenderers.data[s].render();j.setAlphaMode(0)}j.setStencilBuffer(S)}_renderOpaqueSorted(s){S._RenderSorted(s,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(s){S._RenderSorted(s,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(s){S._RenderSorted(s,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(s,Z,o,t){let a,O=0;const v=o?o.globalPosition:S._ZeroVector;if(t)for(;O<s.length;O++)a=s.data[O],a._alphaIndex=a.getMesh().alphaIndex,a._distanceToCamera=j.n.Distance(a.getBoundingInfo().boundingSphere.centerWorld,v);const G=s.length===s.data.length?s.data:s.data.slice(0,s.length);Z&&G.sort(Z);const B=G[0].getMesh().Ls();for(O=0;O<G.length;O++)if(a=G[O],!B._activeMeshesFrozenButKeepClipping||a.isInFrustum(B._frustumPlanes)){if(t){const s=a.Ms();if(s&&s.needDepthPrePass){const Z=s.Ls().getEngine();Z.setColorWrite(!1),Z.setAlphaMode(0),a.render(!1),Z.setColorWrite(!0)}}a.render(t)}}static defaultTransparentSortCompare(s,Z){return s._alphaIndex>Z._alphaIndex?1:s._alphaIndex<Z._alphaIndex?-1:S.backToFrontSortCompare(s,Z)}static backToFrontSortCompare(s,Z){return s._distanceToCamera<Z._distanceToCamera?1:s._distanceToCamera>Z._distanceToCamera?-1:0}static frontToBackSortCompare(s,Z){return s._distanceToCamera<Z._distanceToCamera?-1:s._distanceToCamera>Z._distanceToCamera?1:0}static PainterSortCompare(s,Z){const o=s.getMesh(),t=Z.getMesh();return o.material&&t.material?o.material.uniqueId-t.material.uniqueId:o.uniqueId-t.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(s,Z,o){void 0===Z&&(Z=s.getMesh()),void 0===o&&(o=s.Ms()),null!==o&&void 0!==o&&(o.needAlphaBlendingForMesh(Z)?this._transparentSubMeshes.push(s):o.needAlphaTestingForMesh(Z)?(o.needDepthPrePass&&this._depthOnlySubMeshes.push(s),this._alphaTestSubMeshes.push(s)):(o.needDepthPrePass&&this._depthOnlySubMeshes.push(s),this._opaqueSubMeshes.push(s)),Z._renderingGroup=this,Z._edgesRenderer&&Z.isEnabled()&&Z.isVisible&&Z._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(Z._edgesRenderer),this._empty=!1)}dispatchSprites(s){this._spriteManagers.push(s),this._empty=!1}dispatchParticles(s){this._particleSystems.push(s),this._empty=!1}_renderParticles(s){if(0===this._particleSystems.length)return;const Z=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let o=0;o<this._particleSystems.length;o++){const t=this._particleSystems.data[o];if(0===(Z&&Z.layerMask&t.layerMask))continue;const j=t.k;j.position&&s&&-1===s.indexOf(j)||this._scene._activeParticles.addCount(t.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const s=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let Z=0;Z<this._spriteManagers.length;Z++){const o=this._spriteManagers.data[Z];0!==(s&&s.layerMask&o.layerMask)&&o.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}S._ZeroVector=j.n.Zero();class a{}class O{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(s){s!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=s,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const s of this._scene.meshes)if(s.vO)for(const Z of s.vO)Z._wasDispatched=!1;if(this._scene.spriteManagers)for(const s of this._scene.spriteManagers)s._wasDispatched=!1;for(const s of this._scene.gQ)s._wasDispatched=!1}constructor(s){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new a,this._maintainStateBetweenFrames=!1,this._scene=s;for(let Z=O.MIN_RENDERINGGROUPS;Z<O.MAX_RENDERINGGROUPS;Z++)this._autoClearDepthStencil[Z]={aQ:!0,depth:!0,stencil:!0}}getRenderingGroup(s){const Z=s||0;return this._prepareRenderingGroup(Z),this._renderingGroups[Z]}_clearDepthStencilBuffer(){let s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,s,Z),this._depthStencilBufferAlreadyCleaned=!0)}render(s,Z,o,t){const j=this._renderingGroupInfo;if(j.fZ=this._scene,j.camera=this._scene.activeCamera,j.renderingManager=this,this._scene.spriteManagers&&t)for(let S=0;S<this._scene.spriteManagers.length;S++){const s=this._scene.spriteManagers[S];this.dispatchSprites(s)}for(let S=O.MIN_RENDERINGGROUPS;S<O.MAX_RENDERINGGROUPS;S++){this._depthStencilBufferAlreadyCleaned=S===O.MIN_RENDERINGGROUPS;const a=this._renderingGroups[S];if(!a||a._empty)continue;const v=1<<S;if(j.renderingGroupId=S,this._scene.onBeforeRenderingGroupObservable.notifyObservers(j,v),O.AUTOCLEAR){const s=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(S):this._autoClearDepthStencil[S];s&&s.aQ&&this._clearDepthStencilBuffer(s.depth,s.stencil)}for(const s of this._scene._beforeRenderingGroupDrawStage)s.action(S);a.render(s,t,o,Z);for(const s of this._scene._afterRenderingGroupDrawStage)s.action(S);this._scene.onAfterRenderingGroupObservable.notifyObservers(j,v)}}reset(){if(!this.maintainStateBetweenFrames)for(let s=O.MIN_RENDERINGGROUPS;s<O.MAX_RENDERINGGROUPS;s++){const Z=this._renderingGroups[s];Z&&Z.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let s=O.MIN_RENDERINGGROUPS;s<O.MAX_RENDERINGGROUPS;s++){const Z=this._renderingGroups[s];Z&&Z.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let s=O.MIN_RENDERINGGROUPS;s<O.MAX_RENDERINGGROUPS;s++){const Z=this._renderingGroups[s];Z&&Z.dispose()}}_prepareRenderingGroup(s){void 0===this._renderingGroups[s]&&(this._renderingGroups[s]=new S(s,this._scene,this._customOpaqueSortCompareFn[s],this._customAlphaTestSortCompareFn[s],this._customTransparentSortCompareFn[s]))}dispatchSprites(s){this.maintainStateBetweenFrames&&s._wasDispatched||(s._wasDispatched=!0,this.getRenderingGroup(s.renderingGroupId).dispatchSprites(s))}dispatchParticles(s){this.maintainStateBetweenFrames&&s._wasDispatched||(s._wasDispatched=!0,this.getRenderingGroup(s.renderingGroupId).dispatchParticles(s))}dispatch(s,Z,o){void 0===Z&&(Z=s.getMesh()),this.maintainStateBetweenFrames&&s._wasDispatched||(s._wasDispatched=!0,this.getRenderingGroup(Z.renderingGroupId).dispatch(s,Z,o))}setRenderingOrder(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[s]=Z,this._customAlphaTestSortCompareFn[s]=o,this._customTransparentSortCompareFn[s]=t,this._renderingGroups[s]){const Z=this._renderingGroups[s];Z.opaqueSortCompareFn=this._customOpaqueSortCompareFn[s],Z.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[s],Z.transparentSortCompareFn=this._customTransparentSortCompareFn[s]}}setRenderingAutoClearDepthStencil(s,Z){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],t=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[s]={aQ:Z,depth:o,stencil:t}}getAutoClearDepthStencilSetup(s){return this._autoClearDepthStencil[s]}}O.MAX_RENDERINGGROUPS=4,O.MIN_RENDERINGGROUPS=0,O.AUTOCLEAR=!0},11447:(s,Z,o)=>{o.r(Z),o.d(Z,{postprocessVertexShader:()=>a});var t=o(11026);const j="postprocessVertexShader",S="attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";t.d.ShadersStore[j]||(t.d.ShadersStore[j]=S);const a={name:j,shader:S}},11534:(s,Z,o)=>{o.d(Z,{c:()=>t});class t{}t._IsPickingAvailable=!1},11201:(s,Z,o)=>{o.d(Z,{d:()=>Q});var t=o(11086),j=o(10900),S=o(11091),a=o(10932),O=o(10927),v=o(10975),G=o(11167);class B{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new a.b,this._onClonedObservable=new a.b}}class Q{static AddNodeConstructor(s,Z){this._NodeConstructors[s]=Z}static Construct(s,Z,o,t){const j=this._NodeConstructors[s];return j?j(Z,o,t):null}set accessibilityTag(s){this._accessibilityTag=s,this.onAccessibilityTagChangedObservable.notifyObservers(s)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(s){this._nodeDataStorage._doNotSerialize=s}B(){return this._nodeDataStorage._isDisposed}set parent(s){if(this._parentNode===s)return;const Z=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const Z=this._parentNode._children.indexOf(this);-1!==Z&&this._parentNode._children.splice(Z,1),s||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=s,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),Z||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(s){s.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const s=this._scene.rootNodes,Z=s.length-1;s[this._nodeDataStorage._sceneRootNodesIndex]=s[Z],s[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(s){this._animationPropertiesOverride=s}getClassName(){return"Node"}set onDispose(s){this._onDisposeObserver&&this.jO.remove(this._onDisposeObserver),this._onDisposeObserver=this.jO.add(s)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new B,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new a.b,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=j.b.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.jO=new a.b,this._onDisposeObserver=null,this._behaviors=new Array,this.name=s,this.id=s,this._scene=Z||O.c.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),o&&this._addToSceneRootNodes()}Ls(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(s)||(s.init(),this._scene.isLoading&&!Z?this._scene.onDataLoadedObservable.addOnce((()=>{s.attach(this)})):s.attach(this),this._behaviors.push(s)),this}removeBehavior(s){const Z=this._behaviors.indexOf(s);return-1===Z||(this._behaviors[Z].detach(),this._behaviors.splice(Z,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(s){for(const Z of this._behaviors)if(Z.name===s)return Z;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.Ea(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(s){!s&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(s){return this.parent?this.parent._getActionManagerForTrigger(s,!1):null}_updateCache(s){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}dG(s){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){if(this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children)for(const s of this._children)s._syncParentEnabledState()}iO(s){this._nodeDataStorage._isEnabled!==s&&(this._nodeDataStorage._isEnabled=s,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(s))}isDescendantOf(s){return!!this.parent&&(this.parent===s||this.parent.isDescendantOf(s))}_getDescendants(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2?arguments[2]:void 0;if(this._children)for(let t=0;t<this._children.length;t++){const j=this._children[t];o&&!o(j)||s.push(j),Z||j._getDescendants(s,!1,o)}}getDescendants(s,Z){const o=[];return this._getDescendants(o,s,Z),o}getChildMeshes(s,Z){const o=[];return this._getDescendants(o,s,(s=>(!Z||Z(s))&&void 0!==s.CB)),o}getChildren(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(Z,s)}_setReady(s){s!==this._nodeDataStorage._isReady&&(s?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(s){for(let Z=0;Z<this.animations.length;Z++){const o=this.animations[Z];if(o.name===s)return o}return null}createAnimationRange(s,Z,o){if(!this._ranges[s]){this._ranges[s]=Q._AnimationRangeFactory(s,Z,o);for(let t=0,j=this.animations.length;t<j;t++)this.animations[t]&&this.animations[t].createRange(s,Z,o)}}deleteAnimationRange(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let o=0,t=this.animations.length;o<t;o++)this.animations[o]&&this.animations[o].deleteRange(s,Z);this._ranges[s]=null}getAnimationRange(s){return this._ranges[s]||null}clone(s,Z,o){const t=G.c.Clone((()=>new Q(s,this.Ls())),this);if(Z&&(t.parent=Z),!o){const Z=this.getDescendants(!0);for(let o=0;o<Z.length;o++){const j=Z[o];j.clone(s+"."+j.name,t)}}return t}getAnimationRanges(){const s=[];let Z;for(Z in this._ranges)s.push(this._ranges[Z]);return s}beginAnimation(s,Z,o,t){const j=this.getAnimationRange(s);return j?this._scene.beginAnimation(this,j.from,j.to,Z,o,t):null}serializeAnimationRanges(){const s=[];for(const Z in this._ranges){const o=this._ranges[Z];if(!o)continue;const t={};t.name=Z,t.from=o.from,t.to=o.to,s.push(t)}return s}Ea(s){return this._worldMatrix||(this._worldMatrix=j.b.Identity()),this._worldMatrix}dispose(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!s){const o=this.getDescendants(!0);for(const t of o)t.dispose(s,Z)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.jO.notifyObservers(this),this.jO.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const o of this._behaviors)o.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(s,Z,o){if(Z.ranges)for(let t=0;t<Z.ranges.length;t++){const o=Z.ranges[t];s.createAnimationRange(o.name,o.from,o.to)}}getHierarchyBoundingVectors(){let s,Z,o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.Ls().incrementRenderId(),this.Ea(!0);const S=this;if(S.getBoundingInfo&&S.vO){const o=S.getBoundingInfo();s=o.boundingBox.minimumWorld.clone(),Z=o.boundingBox.maximumWorld.clone()}else s=new j.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Z=new j.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(o){const o=this.getDescendants(!1);for(const S of o){const o=S;if(o.Ea(!0),t&&!t(o))continue;if(!o.getBoundingInfo||0===o.getTotalVertices())continue;const a=o.getBoundingInfo().boundingBox,O=a.minimumWorld,v=a.maximumWorld;j.n.CheckExtends(O,s,Z),j.n.CheckExtends(v,s,Z)}}return{min:s,max:Z}}}Q._AnimationRangeFactory=(s,Z,o)=>{throw(0,v.d)("AnimationRange")},Q._NodeConstructors={},(0,t.c)([(0,S.K)()],Q.prototype,"name",void 0),(0,t.c)([(0,S.K)()],Q.prototype,"id",void 0),(0,t.c)([(0,S.K)()],Q.prototype,"uniqueId",void 0),(0,t.c)([(0,S.K)()],Q.prototype,"state",void 0),(0,t.c)([(0,S.K)()],Q.prototype,"metadata",void 0)},11493:(s,Z,o)=>{o.d(Z,{c:()=>ss});var t=o(10938),j=o(10968),S=o(10932),a=o(11253);class O{constructor(){this._count=0,this._data={}}O(s){this.clear(),s.forEach(((s,Z)=>this.add(s,Z)))}get(s){const Z=this._data[s];if(void 0!==Z)return Z}getOrAddWithFactory(s,Z){let o=this.get(s);return void 0!==o||(o=Z(s),o&&this.add(s,o)),o}getOrAdd(s,Z){const o=this.get(s);return void 0!==o?o:(this.add(s,Z),Z)}contains(s){return void 0!==this._data[s]}add(s,Z){return void 0===this._data[s]&&(this._data[s]=Z,++this._count,!0)}set(s,Z){return void 0!==this._data[s]&&(this._data[s]=Z,!0)}getAndRemove(s){const Z=this.get(s);return void 0!==Z?(delete this._data[s],--this._count,Z):null}remove(s){return!!this.contains(s)&&(delete this._data[s],--this._count,!0)}clear(){this._data={},this._count=0}get count(){return this._count}forEach(s){for(const Z in this._data){s(Z,this._data[Z])}}first(s){for(const Z in this._data){const o=s(Z,this._data[Z]);if(o)return o}return null}}var v=o(11172),G=o(10900),B=o(11502),Q=o(11155),D=o(11223);class z{constructor(s,Z,o,t,j,S){this.source=s,this.pointerX=Z,this.pointerY=o,this.meshUnderPointer=t,this.sourceEvent=j,this.additionalData=S}static CreateNew(s,Z,o){const t=s.Ls();return new z(s,t.pointerX,t.pointerY,t.meshUnderPointer||s,Z,o)}static CreateNewFromSprite(s,Z,o,t){return new z(s,Z.pointerX,Z.pointerY,Z.meshUnderPointer,o,t)}static CreateNewFromScene(s,Z){return new z(null,s.pointerX,s.pointerY,s.meshUnderPointer,Z)}static CreateNewFromPrimitive(s,Z,o,t){return new z(s,Z.x,Z.y,null,o,t)}}var Y=o(11424),b=o(11428),f=o(11297),A=o(10947),d=o(10927),U=o(10975),u=o(11516);class H{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasTriggers(){for(const s in H.Triggers)if(Object.prototype.hasOwnProperty.call(H.Triggers,s))return!0;return!1}static get HasPickTriggers(){for(const s in H.Triggers)if(Object.prototype.hasOwnProperty.call(H.Triggers,s)){const Z=parseInt(s);if(Z>=1&&Z<=7)return!0}return!1}static HasSpecificTrigger(s){for(const Z in H.Triggers)if(Object.prototype.hasOwnProperty.call(H.Triggers,Z)){if(parseInt(Z)===s)return!0}return!1}}H.Triggers={};var F,i,N,L,V,g,l,R=o(11525);!function(s){s[s.Generic=0]="Generic",s[s.Keyboard=1]="Keyboard",s[s.Mouse=2]="Mouse",s[s.Touch=3]="Touch",s[s.DualShock=4]="DualShock",s[s.Xbox=5]="Xbox",s[s.Switch=6]="Switch",s[s.DualSense=7]="DualSense"}(F||(F={})),function(s){s[s.Horizontal=0]="Horizontal",s[s.Vertical=1]="Vertical",s[s.LeftClick=2]="LeftClick",s[s.MiddleClick=3]="MiddleClick",s[s.RightClick=4]="RightClick",s[s.BrowserBack=5]="BrowserBack",s[s.BrowserForward=6]="BrowserForward",s[s.MouseWheelX=7]="MouseWheelX",s[s.MouseWheelY=8]="MouseWheelY",s[s.MouseWheelZ=9]="MouseWheelZ",s[s.Move=12]="Move"}(i||(i={})),function(s){s[s.Horizontal=0]="Horizontal",s[s.Vertical=1]="Vertical",s[s.LeftClick=2]="LeftClick",s[s.MiddleClick=3]="MiddleClick",s[s.RightClick=4]="RightClick",s[s.BrowserBack=5]="BrowserBack",s[s.BrowserForward=6]="BrowserForward",s[s.MouseWheelX=7]="MouseWheelX",s[s.MouseWheelY=8]="MouseWheelY",s[s.MouseWheelZ=9]="MouseWheelZ",s[s.DeltaHorizontal=10]="DeltaHorizontal",s[s.DeltaVertical=11]="DeltaVertical"}(N||(N={})),function(s){s[s.Cross=0]="Cross",s[s.Circle=1]="Circle",s[s.Square=2]="Square",s[s.Triangle=3]="Triangle",s[s.L1=4]="L1",s[s.R1=5]="R1",s[s.L2=6]="L2",s[s.R2=7]="R2",s[s.Share=8]="Share",s[s.Options=9]="Options",s[s.L3=10]="L3",s[s.R3=11]="R3",s[s.DPadUp=12]="DPadUp",s[s.DPadDown=13]="DPadDown",s[s.DPadLeft=14]="DPadLeft",s[s.DPadRight=15]="DPadRight",s[s.Home=16]="Home",s[s.TouchPad=17]="TouchPad",s[s.LStickXAxis=18]="LStickXAxis",s[s.LStickYAxis=19]="LStickYAxis",s[s.RStickXAxis=20]="RStickXAxis",s[s.RStickYAxis=21]="RStickYAxis"}(L||(L={})),function(s){s[s.Cross=0]="Cross",s[s.Circle=1]="Circle",s[s.Square=2]="Square",s[s.Triangle=3]="Triangle",s[s.L1=4]="L1",s[s.R1=5]="R1",s[s.L2=6]="L2",s[s.R2=7]="R2",s[s.Create=8]="Create",s[s.Options=9]="Options",s[s.L3=10]="L3",s[s.R3=11]="R3",s[s.DPadUp=12]="DPadUp",s[s.DPadDown=13]="DPadDown",s[s.DPadLeft=14]="DPadLeft",s[s.DPadRight=15]="DPadRight",s[s.Home=16]="Home",s[s.TouchPad=17]="TouchPad",s[s.LStickXAxis=18]="LStickXAxis",s[s.LStickYAxis=19]="LStickYAxis",s[s.RStickXAxis=20]="RStickXAxis",s[s.RStickYAxis=21]="RStickYAxis"}(V||(V={})),function(s){s[s.A=0]="A",s[s.B=1]="B",s[s.X=2]="X",s[s.Y=3]="Y",s[s.LB=4]="LB",s[s.RB=5]="RB",s[s.LT=6]="LT",s[s.RT=7]="RT",s[s.Back=8]="Back",s[s.Start=9]="Start",s[s.LS=10]="LS",s[s.RS=11]="RS",s[s.DPadUp=12]="DPadUp",s[s.DPadDown=13]="DPadDown",s[s.DPadLeft=14]="DPadLeft",s[s.DPadRight=15]="DPadRight",s[s.Home=16]="Home",s[s.LStickXAxis=17]="LStickXAxis",s[s.LStickYAxis=18]="LStickYAxis",s[s.RStickXAxis=19]="RStickXAxis",s[s.RStickYAxis=20]="RStickYAxis"}(g||(g={})),function(s){s[s.B=0]="B",s[s.A=1]="A",s[s.Y=2]="Y",s[s.X=3]="X",s[s.L=4]="L",s[s.R=5]="R",s[s.ZL=6]="ZL",s[s.ZR=7]="ZR",s[s.Minus=8]="Minus",s[s.Plus=9]="Plus",s[s.LS=10]="LS",s[s.RS=11]="RS",s[s.DPadUp=12]="DPadUp",s[s.DPadDown=13]="DPadDown",s[s.DPadLeft=14]="DPadLeft",s[s.DPadRight=15]="DPadRight",s[s.Home=16]="Home",s[s.Capture=17]="Capture",s[s.LStickXAxis=18]="LStickXAxis",s[s.LStickYAxis=19]="LStickYAxis",s[s.RStickXAxis=20]="RStickXAxis",s[s.RStickYAxis=21]="RStickYAxis"}(l||(l={}));var e=o(11532);class c{static CreateDeviceEvent(s,Z,o,t,j,S,a){switch(s){case F.Keyboard:return this._CreateKeyboardEvent(o,t,j,S);case F.Mouse:if(o===i.MouseWheelX||o===i.MouseWheelY||o===i.MouseWheelZ)return this._CreateWheelEvent(s,Z,o,t,j,S);case F.Touch:return this._CreatePointerEvent(s,Z,o,t,j,S,a);default:throw`Unable to generate event for device ${F[s]}`}}static _CreatePointerEvent(s,Z,o,t,j,S,a){const O=this._CreateMouseEvent(s,Z,o,t,j,S);s===F.Mouse?(O.deviceType=F.Mouse,O.pointerId=1,O.pointerType="mouse"):(O.deviceType=F.Touch,O.pointerId=a??Z,O.pointerType="touch");let v=0;return v+=j.pollInput(s,Z,i.LeftClick),v+=2*j.pollInput(s,Z,i.RightClick),v+=4*j.pollInput(s,Z,i.MiddleClick),O.buttons=v,o===i.Move?O.type="pointermove":o>=i.LeftClick&&o<=i.RightClick&&(O.type=1===t?"pointerdown":"pointerup",O.button=o-2),O}static _CreateWheelEvent(s,Z,o,t,j,S){const a=this._CreateMouseEvent(s,Z,o,t,j,S);switch(a.pointerId=1,a.type="wheel",a.deltaMode=e.d.DOM_DELTA_PIXEL,a.deltaX=0,a.deltaY=0,a.deltaZ=0,o){case i.MouseWheelX:a.deltaX=t;break;case i.MouseWheelY:a.deltaY=t;break;case i.MouseWheelZ:a.deltaZ=t}return a}static _CreateMouseEvent(s,Z,o,t,j,S){const a=this._CreateEvent(S),O=j.pollInput(s,Z,i.Horizontal),v=j.pollInput(s,Z,i.Vertical);return S?(a.movementX=0,a.movementY=0,a.offsetX=a.movementX-S.getBoundingClientRect().x,a.offsetY=a.movementY-S.getBoundingClientRect().y):(a.movementX=j.pollInput(s,Z,10),a.movementY=j.pollInput(s,Z,11),a.offsetX=0,a.offsetY=0),this._CheckNonCharacterKeys(a,j),a.clientX=O,a.clientY=v,a.x=O,a.y=v,a.deviceType=s,a.deviceSlot=Z,a.inputIndex=o,a}static _CreateKeyboardEvent(s,Z,o,t){const j=this._CreateEvent(t);return this._CheckNonCharacterKeys(j,o),j.deviceType=F.Keyboard,j.deviceSlot=0,j.inputIndex=s,j.type=1===Z?"keydown":"keyup",j.key=String.fromCharCode(s),j.keyCode=s,j}static _CheckNonCharacterKeys(s,Z){const o=Z.isDeviceAvailable(F.Keyboard),t=o&&1===Z.pollInput(F.Keyboard,0,18),j=o&&1===Z.pollInput(F.Keyboard,0,17),S=o&&(1===Z.pollInput(F.Keyboard,0,91)||1===Z.pollInput(F.Keyboard,0,92)||1===Z.pollInput(F.Keyboard,0,93)),a=o&&1===Z.pollInput(F.Keyboard,0,16);s.altKey=t,s.ctrlKey=j,s.metaKey=S,s.shiftKey=a}static _CreateEvent(s){const Z={preventDefault:()=>{}};return Z.target=s,Z}}class w{constructor(s,Z,o){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(s,Z,((s,Z,t,j)=>{const S=c.CreateDeviceEvent(s,Z,t,j,this);o(s,Z,S)})):this._createDummyNativeInput()}pollInput(s,Z,o){return this._nativeInput.pollInput(s,Z,o)}isDeviceAvailable(s){return s===F.Mouse||s===F.Touch}dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}}const X=Object.keys(i).length/2;class W{constructor(s,Z,o,j){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=t.g.IsSafari(),this._usingMacOs=(0,A.g)()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=s=>{},this._keyboardUpEvent=s=>{},this._keyboardBlurEvent=s=>{},this._pointerMoveEvent=s=>{},this._pointerDownEvent=s=>{},this._pointerUpEvent=s=>{},this._pointerCancelEvent=s=>{},this._pointerCancelTouch=s=>{},this._pointerLeaveEvent=s=>{},this._pointerWheelEvent=s=>{},this._pointerBlurEvent=s=>{},this._pointerMacOsChromeOutEvent=s=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=(0,A.g)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=(0,A.g)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=s=>{},this._gamepadDisconnectedEvent=s=>{},this._eventPrefix=t.g.GetPointerPrefix(s),this._engine=s,this._onDeviceConnected=Z,this._onDeviceDisconnected=o,this._onInputChanged=j,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOs&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}pollInput(s,Z,o){const j=this._inputs[s][Z];if(!j)throw`Unable to find device ${F[s]}`;s>=F.DualShock&&s<=F.DualSense&&this._updateDevice(s,Z,o);const S=j[o];if(void 0===S)throw`Unable to find input ${o} for device ${F[s]} in slot ${Z}`;return o===i.Move&&t.g.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),S}isDeviceAvailable(s){return void 0!==this._inputs[s]}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_enableEvents(){const s=null===this||void 0===this?void 0:this._engine.getInputElement();if(s&&(!this._eventsAttached||this._elementToAttachTo!==s)){if(this._disableEvents(),this._inputs)for(const s of this._inputs)if(s)for(const Z in s){const o=s[+Z];if(o)for(let s=0;s<o.length;s++)o[s]=0}this._elementToAttachTo=s,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"leave",this._pointerLeaveEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOs&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOsChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_checkForConnectedDevices(){if(navigator.getGamepads){const s=navigator.getGamepads();for(const Z of s)Z&&this._addGamePad(Z)}"function"===typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(F.Mouse,0,0,0)}_addGamePad(s){const Z=this._getGamepadDeviceType(s.id),o=s.index;this._gamepads=this._gamepads||new Array(s.index+1),this._registerDevice(Z,o,s.buttons.length+s.axes.length),this._gamepads[o]=Z}_addPointerDevice(s,Z,o,t){this._pointerActive||(this._pointerActive=!0),this._registerDevice(s,Z,X);const j=this._inputs[s][Z];j[0]=o,j[1]=t}_registerDevice(s,Z,o){if(void 0===Z)throw`Unable to register device ${F[s]} to undefined slot.`;if(this._inputs[s]||(this._inputs[s]={}),!this._inputs[s][Z]){const t=new Array(o);t.fill(0),this._inputs[s][Z]=t,this._onDeviceConnected(s,Z)}}_unregisterDevice(s,Z){this._inputs[s][Z]&&(delete this._inputs[s][Z],this._onDeviceDisconnected(s,Z))}_handleKeyActions(){this._keyboardDownEvent=s=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(F.Keyboard,0,255));const Z=this._inputs[F.Keyboard][0];if(Z){Z[s.keyCode]=1;const o=s;o.inputIndex=s.keyCode,this._usingMacOs&&s.metaKey&&"Meta"!==s.key&&(this._metaKeys.includes(s.keyCode)||this._metaKeys.push(s.keyCode)),this._onInputChanged(F.Keyboard,0,o)}},this._keyboardUpEvent=s=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(F.Keyboard,0,255));const Z=this._inputs[F.Keyboard][0];if(Z){Z[s.keyCode]=0;const o=s;if(o.inputIndex=s.keyCode,this._usingMacOs&&"Meta"===s.key&&this._metaKeys.length>0){for(const s of this._metaKeys){const o=c.CreateDeviceEvent(F.Keyboard,0,s,0,this,this._elementToAttachTo);Z[s]=0,this._onInputChanged(F.Keyboard,0,o)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(F.Keyboard,0,o)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const s=this._inputs[F.Keyboard][0];for(let Z=0;Z<s.length;Z++)if(0!==s[Z]){s[Z]=0;const o=c.CreateDeviceEvent(F.Keyboard,0,Z,0,this,this._elementToAttachTo);this._onInputChanged(F.Keyboard,0,o)}this._usingMacOs&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_handlePointerActions(){this._maxTouchPoints=(0,A.g)()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let t=0;t<this._maxTouchPoints;t++)this._activeTouchIds[t]=-1;this._pointerMoveEvent=s=>{const Z=this._getPointerType(s);let o=Z===F.Mouse?0:this._activeTouchIds.indexOf(s.pointerId);if(Z===F.Touch&&-1===o){const j=this._activeTouchIds.indexOf(-1);if(!(j>=0))return void t.g.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);o=j,this._activeTouchIds[j]=s.pointerId,this._onDeviceConnected(Z,o)}this._inputs[Z]||(this._inputs[Z]={}),this._inputs[Z][o]||this._addPointerDevice(Z,o,s.clientX,s.clientY);const j=this._inputs[Z][o];if(j){const t=s;t.inputIndex=i.Move,j[i.Horizontal]=s.clientX,j[i.Vertical]=s.clientY,Z===F.Touch&&0===j[i.LeftClick]&&(j[i.LeftClick]=1),void 0===s.pointerId&&(s.pointerId=this._mouseId),this._onInputChanged(Z,o,t),this._usingSafari||-1===s.button||(t.inputIndex=s.button+2,j[s.button+2]=j[s.button+2]?0:1,this._onInputChanged(Z,o,t))}},this._pointerDownEvent=s=>{const Z=this._getPointerType(s);let o=Z===F.Mouse?0:s.pointerId;if(Z===F.Touch){let Z=this._activeTouchIds.indexOf(s.pointerId);if(-1===Z&&(Z=this._activeTouchIds.indexOf(-1)),!(Z>=0))return void t.g.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);o=Z,this._activeTouchIds[Z]=s.pointerId}this._inputs[Z]||(this._inputs[Z]={}),this._inputs[Z][o]?Z===F.Touch&&this._onDeviceConnected(Z,o):this._addPointerDevice(Z,o,s.clientX,s.clientY);const j=this._inputs[Z][o];if(j){const t=j[i.Horizontal],a=j[i.Vertical];if(Z===F.Mouse){if(void 0===s.pointerId&&(s.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(S){}}else if(s.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(s.pointerId)}catch(S){}j[i.Horizontal]=s.clientX,j[i.Vertical]=s.clientY,j[s.button+2]=1;const O=s;O.inputIndex=s.button+2,this._onInputChanged(Z,o,O),t===s.clientX&&a===s.clientY||(O.inputIndex=i.Move,this._onInputChanged(Z,o,O))}},this._pointerUpEvent=s=>{var Z;const o=this._getPointerType(s),t=o===F.Mouse?0:this._activeTouchIds.indexOf(s.pointerId);if(o===F.Touch){if(-1===t)return;this._activeTouchIds[t]=-1}const j=null===(Z=this._inputs[o])||void 0===Z?void 0:Z[t];let S=s.button,a=j&&0!==j[S+2];if(!a&&this._isUsingFirefox&&this._usingMacOs&&j&&(S=2===S?0:2,a=0!==j[S+2]),a){var O,v,G,B;const Z=j[i.Horizontal],a=j[i.Vertical];j[i.Horizontal]=s.clientX,j[i.Vertical]=s.clientY,j[S+2]=0;const Q=s;void 0===s.pointerId&&(s.pointerId=this._mouseId),Z===s.clientX&&a===s.clientY||(Q.inputIndex=i.Move,this._onInputChanged(o,t,Q)),Q.inputIndex=S+2,o===F.Mouse&&this._mouseId>=0&&null!==(O=(v=this._elementToAttachTo).hasPointerCapture)&&void 0!==O&&O.call(v,this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):s.pointerId&&null!==(G=(B=this._elementToAttachTo).hasPointerCapture)&&void 0!==G&&G.call(B,s.pointerId)&&this._elementToAttachTo.releasePointerCapture(s.pointerId),this._onInputChanged(o,t,Q),o===F.Touch&&this._onDeviceDisconnected(o,t)}},this._pointerCancelTouch=s=>{var Z,o;const t=this._activeTouchIds.indexOf(s);if(-1===t)return;null!==(Z=(o=this._elementToAttachTo).hasPointerCapture)&&void 0!==Z&&Z.call(o,s)&&this._elementToAttachTo.releasePointerCapture(s),this._inputs[F.Touch][t][i.LeftClick]=0;const j=c.CreateDeviceEvent(F.Touch,t,i.LeftClick,0,this,this._elementToAttachTo,s);this._onInputChanged(F.Touch,t,j),this._activeTouchIds[t]=-1,this._onDeviceDisconnected(F.Touch,t)},this._pointerCancelEvent=s=>{if("mouse"===s.pointerType){var Z,o;const s=this._inputs[F.Mouse][0];this._mouseId>=0&&null!==(Z=(o=this._elementToAttachTo).hasPointerCapture)&&void 0!==Z&&Z.call(o,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let Z=i.LeftClick;Z<=i.BrowserForward;Z++)if(1===s[Z]){s[Z]=0;const o=c.CreateDeviceEvent(F.Mouse,0,Z,0,this,this._elementToAttachTo);this._onInputChanged(F.Mouse,0,o)}}else this._pointerCancelTouch(s.pointerId)},this._pointerLeaveEvent=s=>{"pen"===s.pointerType&&this._pointerCancelTouch(s.pointerId)},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let s=!1;const Z=function(){};try{const o=Object.defineProperty({},"passive",{get:function(){s=!0}});this._elementToAttachTo.addEventListener("test",Z,o),this._elementToAttachTo.removeEventListener("test",Z,o)}catch(o){}this._pointerBlurEvent=()=>{if(this.isDeviceAvailable(F.Mouse)){var s,Z;const o=this._inputs[F.Mouse][0];this._mouseId>=0&&null!==(s=(Z=this._elementToAttachTo).hasPointerCapture)&&void 0!==s&&s.call(Z,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let s=i.LeftClick;s<=i.BrowserForward;s++)if(1===o[s]){o[s]=0;const Z=c.CreateDeviceEvent(F.Mouse,0,s,0,this,this._elementToAttachTo);this._onInputChanged(F.Mouse,0,Z)}}if(this.isDeviceAvailable(F.Touch)){const s=this._inputs[F.Touch];for(let Z=0;Z<this._activeTouchIds.length;Z++){var o,t,j;const S=this._activeTouchIds[Z];if(null!==(o=(t=this._elementToAttachTo).hasPointerCapture)&&void 0!==o&&o.call(t,S)&&this._elementToAttachTo.releasePointerCapture(S),-1!==S&&1===(null===(j=s[Z])||void 0===j?void 0:j[i.LeftClick])){s[Z][i.LeftClick]=0;const o=c.CreateDeviceEvent(F.Touch,Z,i.LeftClick,0,this,this._elementToAttachTo,S);this._onInputChanged(F.Touch,Z,o),this._activeTouchIds[Z]=-1,this._onDeviceDisconnected(F.Touch,Z)}}}},this._pointerWheelEvent=s=>{const Z=F.Mouse;this._inputs[Z]||(this._inputs[Z]=[]),this._inputs[Z][0]||(this._pointerActive=!0,this._registerDevice(Z,0,X));const o=this._inputs[Z][0];if(o){o[i.MouseWheelX]=s.deltaX||0,o[i.MouseWheelY]=s.deltaY||s.wheelDelta||0,o[i.MouseWheelZ]=s.deltaZ||0;const t=s;void 0===s.pointerId&&(s.pointerId=this._mouseId),0!==o[i.MouseWheelX]&&(t.inputIndex=i.MouseWheelX,this._onInputChanged(Z,0,t)),0!==o[i.MouseWheelY]&&(t.inputIndex=i.MouseWheelY,this._onInputChanged(Z,0,t)),0!==o[i.MouseWheelZ]&&(t.inputIndex=i.MouseWheelZ,this._onInputChanged(Z,0,t))}},this._usingMacOs&&this._isUsingChromium&&(this._pointerMacOsChromeOutEvent=s=>{s.buttons>1&&this._pointerCancelEvent(s)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOsChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"leave",this._pointerLeaveEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!s&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((()=>{if(this.isDeviceAvailable(F.Mouse)){const s=this._inputs[F.Mouse][0];s[i.MouseWheelX]=0,s[i.MouseWheelY]=0,s[i.MouseWheelZ]=0}}))}_handleGamepadActions(){this._gamepadConnectedEvent=s=>{this._addGamePad(s.gamepad)},this._gamepadDisconnectedEvent=s=>{if(this._gamepads){const Z=this._getGamepadDeviceType(s.gamepad.id),o=s.gamepad.index;this._unregisterDevice(Z,o),delete this._gamepads[o]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_updateDevice(s,Z,o){const t=navigator.getGamepads()[Z];if(t&&s===this._gamepads[Z]){const j=this._inputs[s][Z];o>=t.buttons.length?j[o]=t.axes[o-t.buttons.length].valueOf():j[o]=t.buttons[o].value}}_getGamepadDeviceType(s){return-1!==s.indexOf("054c")?-1!==s.indexOf("0ce6")?F.DualSense:F.DualShock:-1!==s.indexOf("Xbox One")||-1!==s.search("Xbox 360")||-1!==s.search("xinput")?F.Xbox:-1!==s.indexOf("057e")?F.Switch:F.Generic}_getPointerType(s){let Z=F.Mouse;return("touch"===s.pointerType||"pen"===s.pointerType||s.touches)&&(Z=F.Touch),Z}}class q{constructor(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.deviceType=Z,this.deviceSlot=o,this.onInputChangedObservable=new S.b,this._deviceInputSystem=s}getInput(s){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,s)}}class h{constructor(s){this._registeredManagers=new Array,this._refCount=0,this.registerManager=s=>{for(let Z=0;Z<this._devices.length;Z++){const o=this._devices[Z];for(const t in o){const o=+t;s._addDevice(new q(this._deviceInputSystem,Z,o))}}this._registeredManagers.push(s)},this.unregisterManager=s=>{const Z=this._registeredManagers.indexOf(s);Z>-1&&this._registeredManagers.splice(Z,1)};const Z=Object.keys(F).length/2;this._devices=new Array(Z);const o=(s,Z)=>{this._devices[s]||(this._devices[s]=new Array),this._devices[s][Z]||(this._devices[s][Z]=Z);for(const o of this._registeredManagers){const t=new q(this._deviceInputSystem,s,Z);o._addDevice(t)}},t=(s,Z)=>{var o;null!==(o=this._devices[s])&&void 0!==o&&o[Z]&&delete this._devices[s][Z];for(const t of this._registeredManagers)t._removeDevice(s,Z)},j=(s,Z,o)=>{if(o)for(const t of this._registeredManagers)t._onInputChanged(s,Z,o)};"undefined"!==typeof _native?this._deviceInputSystem=new w(o,t,j):this._deviceInputSystem=new W(s,o,t,j)}dispose(){this._deviceInputSystem.dispose()}}class M{getDeviceSource(s,Z){if(void 0===Z){if(void 0===this._firstDevice[s])return null;Z=this._firstDevice[s]}return this._devices[s]&&void 0!==this._devices[s][Z]?this._devices[s][Z]:null}getDeviceSources(s){return this._devices[s]?this._devices[s].filter((s=>!!s)):[]}constructor(s){const Z=Object.keys(F).length/2;this._devices=new Array(Z),this._firstDevice=new Array(Z),this._engine=s,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new h(s)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new S.b((s=>{for(const Z of this._devices)if(Z)for(const o of Z)o&&this.onDeviceConnectedObservable.notifyObserver(s,o)})),this.onDeviceDisconnectedObservable=new S.b,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=s.jO.add((()=>{this.dispose()}))}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.jO.remove(this._onDisposeObserver)}_addDevice(s){this._devices[s.deviceType]||(this._devices[s.deviceType]=[]),this._devices[s.deviceType][s.deviceSlot]||(this._devices[s.deviceType][s.deviceSlot]=s,this._updateFirstDevices(s.deviceType)),this.onDeviceConnectedObservable.notifyObservers(s)}_removeDevice(s,Z){var o,t;const j=null===(o=this._devices[s])||void 0===o?void 0:o[Z];this.onDeviceDisconnectedObservable.notifyObservers(j),null!==(t=this._devices[s])&&void 0!==t&&t[Z]&&delete this._devices[s][Z],this._updateFirstDevices(s)}_onInputChanged(s,Z,o){var t,j;null===(t=this._devices[s])||void 0===t||null===(j=t[Z])||void 0===j||j.onInputChangedObservable.notifyObservers(o)}_updateFirstDevices(s){switch(s){case F.Keyboard:case F.Mouse:this._firstDevice[s]=0;break;case F.Touch:case F.DualSense:case F.DualShock:case F.Xbox:case F.Switch:case F.Generic:{delete this._firstDevice[s];const Z=this._devices[s];if(Z)for(let o=0;o<Z.length;o++)if(Z[o]){this._firstDevice[s]=o;break}break}}}}var x=o(11534);class k{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get Gt(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(s){this._singleClick=s}set Gt(s){this._doubleClick=s}set hasSwiped(s){this._hasSwiped=s}set ignore(s){this._ignore=s}}class y{constructor(s){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._activePointerIds=new Array,this._activePointerIdsCount=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new G.j(0,0),this._previousStartingPointerPosition=new G.j(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=s||d.c.LastCreatedScene,this._scene}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(s){return this._meshUnderPointerId[s]||null}get unTranslatedPointer(){return new G.j(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(s){this._pointerX=s}get pointerY(){return this._pointerY}set pointerY(s){this._pointerY=s}_updatePointerPosition(s){const Z=this._scene.getEngine().getInputElementClientRect();Z&&(this._pointerX=s.clientX-Z.left,this._pointerY=s.clientY-Z.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(s,Z){const o=this._scene,t=o.getEngine(),j=t.getInputElement();j&&(j.tabIndex=t.canvasTabIndex,o.doNotHandleCursors||(j.style.cursor=o.defaultCursor)),this._setCursorAndPointerOverMesh(s,Z,o);for(const v of o._pointerMoveStage){var S;const o=!(null===(S=s=s||this._pickMove(Z))||void 0===S||!S.pickedMesh);s=v.action(this._unTranslatedPointerX,this._unTranslatedPointerY,s,o,j)}const a=Z.inputIndex>=i.MouseWheelX&&Z.inputIndex<=i.MouseWheelZ?u.b.POINTERWHEEL:u.b.POINTERMOVE;let O;o.onPointerMove&&(s=s||this._pickMove(Z),o.onPointerMove(Z,s,a)),s?(O=new u.f(a,Z,s),this._setRayOnPointerInfo(s,Z)):(O=new u.f(a,Z,null,this),this._movePointerInfo=O),o.onPointerObservable.hasObservers()&&o.onPointerObservable.notifyObservers(O,a)}_setRayOnPointerInfo(s,Z){const o=this._scene;s&&x.c._IsPickingAvailable&&(s.ray||(s.ray=o.createPickingRay(Z.offsetX,Z.offsetY,G.b.Identity(),o.activeCamera)))}_addCameraPointerObserver(s,Z){return this._cameraObserverCount++,this._scene.onPointerObservable.add(s,Z)}_removeCameraPointerObserver(s){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(s)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(s,Z,o){const t=this._scene,j=new u.d(o,Z,this._unTranslatedPointerX,this._unTranslatedPointerY);return s&&(j.originalPickingInfo=s,j.ray=s.ray,"xr-near"===Z.pointerType&&s.originMesh&&(j.nearInteractionPickingInfo=s)),t.onPrePointerObservable.notifyObservers(j,o),!!j.skipOnPointerObservable}_pickMove(s){const Z=this._scene,o=Z.vo(this._unTranslatedPointerX,this._unTranslatedPointerY,Z.pointerMovePredicate,Z.pointerMoveFastCheck,Z.cameraToUseForPointers,Z.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(o,s,Z),o}_setCursorAndPointerOverMesh(s,Z,o){const t=o.getEngine().getInputElement();if(null!==s&&void 0!==s&&s.pickedMesh){if(this.setPointerOverMesh(s.pickedMesh,Z.pointerId,s,Z),!o.doNotHandleCursors&&t&&this._pointerOverMesh){const s=this._pointerOverMesh._getActionManagerForTrigger();s&&s.hasPointerTriggers&&(t.style.cursor=s.hoverCursor||o.hoverCursor)}}else this.setPointerOverMesh(null,Z.pointerId,s,Z)}simulatePointerMove(s,Z){const o=new PointerEvent("pointermove",Z);o.inputIndex=i.Move,this._checkPrePointerObservable(s,o,u.b.POINTERMOVE)||this._processPointerMove(s,o)}simulatePointerDown(s,Z){const o=new PointerEvent("pointerdown",Z);o.inputIndex=o.button+2,this._checkPrePointerObservable(s,o,u.b.POINTERDOWN)||this._processPointerDown(s,o)}_processPointerDown(s,Z){var o;const t=this._scene;if(null!==(o=s)&&void 0!==o&&o.pickedMesh){this._pickedDownMesh=s.pickedMesh;const o=s.pickedMesh._getActionManagerForTrigger();if(o){if(o.hasPickTriggers)switch(o.processTrigger(5,new z(s.pickedMesh,t.pointerX,t.pointerY,s.pickedMesh,Z,s)),Z.button){case 0:o.processTrigger(2,new z(s.pickedMesh,t.pointerX,t.pointerY,s.pickedMesh,Z,s));break;case 1:o.processTrigger(4,new z(s.pickedMesh,t.pointerX,t.pointerY,s.pickedMesh,Z,s));break;case 2:o.processTrigger(3,new z(s.pickedMesh,t.pointerX,t.pointerY,s.pickedMesh,Z,s))}o.hasSpecificTrigger(8)&&window.setTimeout((()=>{const s=t.vo(this._unTranslatedPointerX,this._unTranslatedPointerY,(s=>s.Uv&&s.isVisible&&s.isReady()&&s.actionManager&&s.actionManager.hasSpecificTrigger(8)&&s===this._pickedDownMesh),!1,t.cameraToUseForPointers);null!==s&&void 0!==s&&s.pickedMesh&&o&&0!==this._activePointerIdsCount&&Date.now()-this._startingPointerTime>y.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,o.processTrigger(8,z.CreateNew(s.pickedMesh,Z)))}),y.LongPressDelay)}}else for(const a of t._pointerDownStage)s=a.action(this._unTranslatedPointerX,this._unTranslatedPointerY,s,Z,!1);let j;const S=u.b.POINTERDOWN;s?(t.onPointerDown&&t.onPointerDown(Z,s,S),j=new u.f(S,Z,s),this._setRayOnPointerInfo(s,Z)):j=new u.f(S,Z,null,this),t.onPointerObservable.hasObservers()&&t.onPointerObservable.notifyObservers(j,S)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(s,Z,o){const t=new PointerEvent("pointerup",Z);t.inputIndex=i.Move;const j=new k;o?j.Gt=!0:j.singleClick=!0,this._checkPrePointerObservable(s,t,u.b.POINTERUP)||this._processPointerUp(s,t,j)}_processPointerUp(s,Z,o){var t;const j=this._scene;if(null!==(t=s)&&void 0!==t&&t.pickedMesh){if(this._pickedUpMesh=s.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(j.onPointerPick&&j.onPointerPick(Z,s),o.singleClick&&!o.ignore&&j.onPointerObservable.observers.length>this._cameraObserverCount)){const o=u.b.POINTERPICK,t=new u.f(o,Z,s);this._setRayOnPointerInfo(s,Z),j.onPointerObservable.notifyObservers(t,o)}const t=s.pickedMesh._getActionManagerForTrigger();if(t&&!o.ignore){t.processTrigger(7,z.CreateNew(s.pickedMesh,Z,s)),!o.hasSwiped&&o.singleClick&&t.processTrigger(1,z.CreateNew(s.pickedMesh,Z,s));const j=s.pickedMesh._getActionManagerForTrigger(6);o.Gt&&j&&j.processTrigger(6,z.CreateNew(s.pickedMesh,Z,s))}}else if(!o.ignore)for(const S of j._pointerUpStage)s=S.action(this._unTranslatedPointerX,this._unTranslatedPointerY,s,Z,o.Gt);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const s=this._pickedDownMesh._getActionManagerForTrigger(16);s&&s.processTrigger(16,z.CreateNew(this._pickedDownMesh,Z))}if(!o.ignore){const t=new u.f(u.b.POINTERUP,Z,s);if(this._setRayOnPointerInfo(s,Z),j.onPointerObservable.notifyObservers(t,u.b.POINTERUP),j.onPointerUp&&j.onPointerUp(Z,s,u.b.POINTERUP),!o.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let t=0;if(o.singleClick?t=u.b.POINTERTAP:o.Gt&&(t=u.b.POINTERDOUBLETAP),t){const o=new u.f(t,Z,s);j.onPointerObservable.hasObservers()&&j.onPointerObservable.hasSpecificMask(t)&&j.onPointerObservable.notifyObservers(o,t)}}}}isPointerCaptured(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._pointerCaptures[s]}attachControl(){let s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const j=this._scene,S=j.getEngine();t||(t=S.getInputElement()),this._alreadyAttached&&this.SQ(),t&&(this._alreadyAttachedTo=t),this._deviceSourceManager=new M(S),this._initActionManager=s=>{if(!this._meshPickProceed){const Z=j.skipPointerUpPicking||0===j._registeredActions&&!this._checkForPicking()&&!j.onPointerUp?null:j.vo(this._unTranslatedPointerX,this._unTranslatedPointerY,j.pointerUpPredicate,j.pointerUpFastCheck,j.cameraToUseForPointers,j.pointerUpTrianglePredicate);this._currentPickResult=Z,Z&&(s=Z.hit&&Z.pickedMesh?Z.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return s},this._delayedSimpleClick=(s,Z,o)=>{if((Date.now()-this._previousStartingPointerTime>y.DoubleClickDelay&&!this._doubleClickOccured||s!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,Z.singleClick=!0,Z.ignore=!1,this._delayedClicks[s])){const Z=this._delayedClicks[s].evt,o=u.b.POINTERTAP,t=new u.f(o,Z,this._currentPickResult);j.onPointerObservable.hasObservers()&&j.onPointerObservable.hasSpecificMask(o)&&j.onPointerObservable.notifyObservers(t,o),this._delayedClicks[s]=null}},this._initClickEvent=(s,Z,o,t)=>{const j=new k;this._currentPickResult=null;let S=null,a=s.hasSpecificMask(u.b.POINTERPICK)||Z.hasSpecificMask(u.b.POINTERPICK)||s.hasSpecificMask(u.b.POINTERTAP)||Z.hasSpecificMask(u.b.POINTERTAP)||s.hasSpecificMask(u.b.POINTERDOUBLETAP)||Z.hasSpecificMask(u.b.POINTERDOUBLETAP);!a&&H&&(S=this._initActionManager(S,j),S&&(a=S.hasPickTriggers));let O=!1;if(a=a&&!this._isMultiTouchGesture,a){const a=o.button;if(j.hasSwiped=this._isPointerSwiping(),!j.hasSwiped){let B=!y.ExclusiveDoubleClickMode;if(B||(B=!s.hasSpecificMask(u.b.POINTERDOUBLETAP)&&!Z.hasSpecificMask(u.b.POINTERDOUBLETAP),B&&!H.HasSpecificTrigger(6)&&(S=this._initActionManager(S,j),S&&(B=!S.hasSpecificTrigger(6)))),B)(Date.now()-this._previousStartingPointerTime>y.DoubleClickDelay||a!==this._previousButtonPressed)&&(j.singleClick=!0,t(j,this._currentPickResult),O=!0);else{const s={evt:o,clickInfo:j,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,a,j,t),y.DoubleClickDelay)};this._delayedClicks[a]=s}let Q=s.hasSpecificMask(u.b.POINTERDOUBLETAP)||Z.hasSpecificMask(u.b.POINTERDOUBLETAP);if(!Q&&H.HasSpecificTrigger(6)&&(S=this._initActionManager(S,j),S&&(Q=S.hasSpecificTrigger(6))),Q)if(a===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<y.DoubleClickDelay&&!this._doubleClickOccured){if(j.hasSwiped||this._isPointerSwiping())if(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=a,y.ExclusiveDoubleClickMode){var v;if(this._delayedClicks[a])clearTimeout(null===(v=this._delayedClicks[a])||void 0===v?void 0:v.timeoutId),this._delayedClicks[a]=null;t(j,this._previousPickResult)}else t(j,this._currentPickResult);else{var G;if(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,j.Gt=!0,j.ignore=!1,y.ExclusiveDoubleClickMode&&this._delayedClicks[a])clearTimeout(null===(G=this._delayedClicks[a])||void 0===G?void 0:G.timeoutId),this._delayedClicks[a]=null;t(j,this._currentPickResult)}O=!0}else this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=a}}O||t(j,this._currentPickResult)},this._onPointerMove=s=>{if(this._updatePointerPosition(s),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>y.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>y.DragMovementThreshold),S.isPointerLock&&S._verifyPointerLock(),this._checkPrePointerObservable(null,s,s.inputIndex>=i.MouseWheelX&&s.inputIndex<=i.MouseWheelZ?u.b.POINTERWHEEL:u.b.POINTERMOVE))return;if(!j.cameraToUseForPointers&&!j.activeCamera)return;if(j.DQ)return void this._processPointerMove(new D.b,s);j.pointerMovePredicate||(j.pointerMovePredicate=s=>s.Uv&&s.isVisible&&s.isReady()&&s.isEnabled()&&(s.enablePointerMoveEvents||j.constantlyUpdateMeshUnderPointer||null!==s._getActionManagerForTrigger())&&(!j.cameraToUseForPointers||0!==(j.cameraToUseForPointers.layerMask&s.layerMask)));const Z=j._registeredActions>0||j.constantlyUpdateMeshUnderPointer?this._pickMove(s):null;this._processPointerMove(Z,s)},this._onPointerDown=s=>{const Z=this._activePointerIds.indexOf(-1);if(-1===Z?this._activePointerIds.push(s.pointerId):this._activePointerIds[Z]=s.pointerId,this._activePointerIdsCount++,this._pickedDownMesh=null,this._meshPickProceed=!1,y.ExclusiveDoubleClickMode)for(let t=0;t<this._delayedClicks.length;t++)if(this._delayedClicks[t])if(s.button===t){var o;clearTimeout(null===(o=this._delayedClicks[t])||void 0===o?void 0:o.timeoutId)}else{const s=this._delayedClicks[t].clickInfo;this._doubleClickOccured=!1,s.singleClick=!0,s.ignore=!1;const Z=this._delayedClicks[t].evt,o=u.b.POINTERTAP,S=new u.f(o,Z,this._currentPickResult);j.onPointerObservable.hasObservers()&&j.onPointerObservable.hasSpecificMask(o)&&j.onPointerObservable.notifyObservers(S,o),this._delayedClicks[t]=null}if(this._updatePointerPosition(s),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=s.button),j.preventDefaultOnPointerDown&&t&&(s.preventDefault(),t.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,s,u.b.POINTERDOWN))return;if(!j.cameraToUseForPointers&&!j.activeCamera)return;let S;this._pointerCaptures[s.pointerId]=!0,j.pointerDownPredicate||(j.pointerDownPredicate=s=>s.Uv&&s.isVisible&&s.isReady()&&s.isEnabled()&&(!j.cameraToUseForPointers||0!==(j.cameraToUseForPointers.layerMask&s.layerMask))),this._pickedDownMesh=null,S=j.skipPointerDownPicking||0===j._registeredActions&&!this._checkForPicking()&&!j.onPointerDown?new D.b:j.vo(this._unTranslatedPointerX,this._unTranslatedPointerY,j.pointerDownPredicate,j.pointerDownFastCheck,j.cameraToUseForPointers,j.pointerDownTrianglePredicate),this._processPointerDown(S,s)},this._onPointerUp=s=>{const Z=this._activePointerIds.indexOf(s.pointerId);-1!==Z&&(this._activePointerIds[Z]=-1,this._activePointerIdsCount--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(s),j.preventDefaultOnPointerUp&&t&&(s.preventDefault(),t.focus()),this._initClickEvent(j.onPrePointerObservable,j.onPointerObservable,s,((Z,o)=>{if(j.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!Z.ignore)){if(this._checkPrePointerObservable(null,s,u.b.POINTERUP))return this._swipeButtonPressed===s.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),void(0===s.buttons&&(this._pointerCaptures[s.pointerId]=!1));Z.hasSwiped||(Z.singleClick&&j.onPrePointerObservable.hasSpecificMask(u.b.POINTERTAP)&&this._checkPrePointerObservable(null,s,u.b.POINTERTAP)&&(this._skipPointerTap=!0),Z.Gt&&j.onPrePointerObservable.hasSpecificMask(u.b.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,s,u.b.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}this._pointerCaptures[s.pointerId]?(0===s.buttons&&(this._pointerCaptures[s.pointerId]=!1),(j.cameraToUseForPointers||j.activeCamera)&&(j.pointerUpPredicate||(j.pointerUpPredicate=s=>s.Uv&&s.isVisible&&s.isReady()&&s.isEnabled()&&(!j.cameraToUseForPointers||0!==(j.cameraToUseForPointers.layerMask&s.layerMask))),!this._meshPickProceed&&(H&&H.HasTriggers||this._checkForPicking()||j.onPointerUp)&&this._initActionManager(null,Z),o||(o=this._currentPickResult),this._processPointerUp(o,s,Z),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===s.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))):this._swipeButtonPressed===s.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1)})))},this._onKeyDown=s=>{const Z=R.e.KEYDOWN;if(j.onPreKeyboardObservable.hasObservers()){const o=new R.h(Z,s);if(j.onPreKeyboardObservable.notifyObservers(o,Z),o.skipOnKeyboardObservable)return}if(j.onKeyboardObservable.hasObservers()){const o=new R.l(Z,s);j.onKeyboardObservable.notifyObservers(o,Z)}j.actionManager&&j.actionManager.processTrigger(14,z.CreateNewFromScene(j,s))},this._onKeyUp=s=>{const Z=R.e.KEYUP;if(j.onPreKeyboardObservable.hasObservers()){const o=new R.h(Z,s);if(j.onPreKeyboardObservable.notifyObservers(o,Z),o.skipOnKeyboardObservable)return}if(j.onKeyboardObservable.hasObservers()){const o=new R.l(Z,s);j.onKeyboardObservable.notifyObservers(o,Z)}j.actionManager&&j.actionManager.processTrigger(15,z.CreateNewFromScene(j,s))},this._deviceSourceManager.onDeviceConnectedObservable.add((t=>{t.deviceType===F.Mouse?t.onInputChangedObservable.add((j=>{this._originMouseEvent=j,j.inputIndex===i.LeftClick||j.inputIndex===i.MiddleClick||j.inputIndex===i.RightClick||j.inputIndex===i.BrowserBack||j.inputIndex===i.BrowserForward?Z&&1===t.getInput(j.inputIndex)?this._onPointerDown(j):s&&0===t.getInput(j.inputIndex)&&this._onPointerUp(j):o&&(j.inputIndex===i.Move?this._onPointerMove(j):j.inputIndex!==i.MouseWheelX&&j.inputIndex!==i.MouseWheelY&&j.inputIndex!==i.MouseWheelZ||this._onPointerMove(j))})):t.deviceType===F.Touch?t.onInputChangedObservable.add((j=>{j.inputIndex===i.LeftClick&&(Z&&1===t.getInput(j.inputIndex)?(this._onPointerDown(j),this._activePointerIdsCount>1&&(this._isMultiTouchGesture=!0)):s&&0===t.getInput(j.inputIndex)&&(this._onPointerUp(j),0===this._activePointerIdsCount&&(this._isMultiTouchGesture=!1))),o&&j.inputIndex===i.Move&&this._onPointerMove(j)})):t.deviceType===F.Keyboard&&t.onInputChangedObservable.add((s=>{"keydown"===s.type?this._onKeyDown(s):"keyup"===s.type&&this._onKeyUp(s)}))})),this._alreadyAttached=!0}SQ(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0,t=arguments.length>3?arguments[3]:void 0;if(this._meshUnderPointerId[Z]===s&&(!s||!s._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const j=this._meshUnderPointerId[Z];let S;j&&(S=j._getActionManagerForTrigger(10),S&&S.processTrigger(10,new z(j,this._pointerX,this._pointerY,s,t,{pointerId:Z}))),s?(this._meshUnderPointerId[Z]=s,this._pointerOverMesh=s,S=s._getActionManagerForTrigger(9),S&&S.processTrigger(9,new z(s,this._pointerX,this._pointerY,s,t,{pointerId:Z,pickResult:o}))):(delete this._meshUnderPointerId[Z],this._pointerOverMesh=null),this._scene.onMeshUnderPointerUpdatedObservable.hasObservers()&&this._scene.onMeshUnderPointerUpdatedObservable.notifyObservers({mesh:s,pointerId:Z})}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(s){this._pointerOverMesh===s&&(this._pointerOverMesh=null),this._pickedDownMesh===s&&(this._pickedDownMesh=null),this._pickedUpMesh===s&&(this._pickedUpMesh=null);for(const Z in this._meshUnderPointerId)this._meshUnderPointerId[Z]===s&&delete this._meshUnderPointerId[Z]}}y.DragMovementThreshold=10,y.LongPressDelay=500,y.DoubleClickDelay=300,y.ExclusiveDoubleClickMode=!1;var I=o(11396),C=o(11174),K=o(11267),p=o(11539),E=o(10982),P=o(11187),r=o(10911);class T{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.DQ=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}var m,n=o(10955),J=o(10916);!function(s){s[s.BackwardCompatible=0]="BackwardCompatible",s[s.Intermediate=1]="Intermediate",s[s.Aggressive=2]="Aggressive"}(m||(m={}));class ss{static DefaultMaterialFactory(s){throw(0,U.d)("zO")}static CollisionCoordinatorFactory(){throw(0,U.d)("DefaultCollisionCoordinator")}get clearColor(){return this._clearColor}set clearColor(s){s!==this._clearColor&&(this._clearColor=s,this.onClearColorChangedObservable.notifyObservers(this._clearColor))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get performancePriority(){return this._performancePriority}set performancePriority(s){if(s!==this._performancePriority){switch(this._performancePriority=s,s){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.DQ=!1,this.aQ=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.DQ=!0,this.aQ=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.DQ=!0,this.aQ=!1}this.onScenePerformancePriorityChangedObservable.notifyObservers(s)}}set forceWireframe(s){this._forceWireframe!==s&&(this._forceWireframe=s,this.markAllMaterialsAsDirty(16))}get forceWireframe(){return this._forceWireframe}set skipFrustumClipping(s){this._skipFrustumClipping!==s&&(this._skipFrustumClipping=s)}get skipFrustumClipping(){return this._skipFrustumClipping}set forcePointsCloud(s){this._forcePointsCloud!==s&&(this._forcePointsCloud=s,this.markAllMaterialsAsDirty(16))}get forcePointsCloud(){return this._forcePointsCloud}get environmentTexture(){return this._environmentTexture}set environmentTexture(s){this._environmentTexture!==s&&(this._environmentTexture=s,this.onEnvironmentTextureChangedObservable.notifyObservers(s),this.markAllMaterialsAsDirty(1))}getNodes(){let s=[];s=s.concat(this.meshes),s=s.concat(this.lights),s=s.concat(this.cameras),s=s.concat(this.transformNodes);for(const Z of this.skeletons)s=s.concat(Z.bones);return s}get animationPropertiesOverride(){return this._animationPropertiesOverride}set animationPropertiesOverride(s){this._animationPropertiesOverride=s}set onDispose(s){this._onDisposeObserver&&this.jO.remove(this._onDisposeObserver),this._onDisposeObserver=this.jO.add(s)}set beforeRender(s){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),s&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(s))}set afterRender(s){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),s&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(s))}set beforeCameraRender(s){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(s)}set afterCameraRender(s){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(s)}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}set pointerDownPredicate(s){this._pointerPickingConfiguration.pointerDownPredicate=s}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}set pointerUpPredicate(s){this._pointerPickingConfiguration.pointerUpPredicate=s}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}set pointerMovePredicate(s){this._pointerPickingConfiguration.pointerMovePredicate=s}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}set pointerDownFastCheck(s){this._pointerPickingConfiguration.pointerDownFastCheck=s}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}set pointerUpFastCheck(s){this._pointerPickingConfiguration.pointerUpFastCheck=s}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}set pointerMoveFastCheck(s){this._pointerPickingConfiguration.pointerMoveFastCheck=s}get DQ(){return this._pointerPickingConfiguration.DQ}set DQ(s){this._pointerPickingConfiguration.DQ=s}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}set skipPointerDownPicking(s){this._pointerPickingConfiguration.skipPointerDownPicking=s}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}set skipPointerUpPicking(s){this._pointerPickingConfiguration.skipPointerUpPicking=s}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}static get DragMovementThreshold(){return y.DragMovementThreshold}static set DragMovementThreshold(s){y.DragMovementThreshold=s}static get LongPressDelay(){return y.LongPressDelay}static set LongPressDelay(s){y.LongPressDelay=s}static get DoubleClickDelay(){return y.DoubleClickDelay}static set DoubleClickDelay(s){y.DoubleClickDelay=s}static get ExclusiveDoubleClickMode(){return y.ExclusiveDoubleClickMode}static set ExclusiveDoubleClickMode(s){y.ExclusiveDoubleClickMode=s}bindEyePosition(s){var Z;let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vEyePosition",t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const j=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:(null===(Z=this.activeCamera)||void 0===Z?void 0:Z.globalPosition)??G.n.ZeroReadOnly,S=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return G.g.Vector4[0].set(j.x,j.y,j.z,S?-1:1),s&&(t?s.setFloat3(o,G.g.Vector4[0].x,G.g.Vector4[0].y,G.g.Vector4[0].z):s.setVector4(o,G.g.Vector4[0])),G.g.Vector4[0]}finalizeSceneUbo(){const s=this.getSceneUniformBuffer(),Z=this.bindEyePosition(null);return s.updateFloat4("vEyePosition",Z.x,Z.y,Z.z,Z.w),s.update(),s}set useRightHandedSystem(s){this._useRightHandedSystem!==s&&(this._useRightHandedSystem=s,this.markAllMaterialsAsDirty(16))}get useRightHandedSystem(){return this._useRightHandedSystem}setStepId(s){this._currentStepId=s}getStepId(){return this._currentStepId}getInternalStep(){return this._currentInternalStep}set fogEnabled(s){this._fogEnabled!==s&&(this._fogEnabled=s,this.markAllMaterialsAsDirty(16))}get fogEnabled(){return this._fogEnabled}set fogMode(s){this._fogMode!==s&&(this._fogMode=s,this.markAllMaterialsAsDirty(16))}get fogMode(){return this._fogMode}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set shadowsEnabled(s){this._shadowsEnabled!==s&&(this._shadowsEnabled=s,this.markAllMaterialsAsDirty(2))}get shadowsEnabled(){return this._shadowsEnabled}set lightsEnabled(s){this._lightsEnabled!==s&&(this._lightsEnabled=s,this.markAllMaterialsAsDirty(2))}get lightsEnabled(){return this._lightsEnabled}get activeCameras(){return this._activeCameras}set activeCameras(s){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),s&&(this._unObserveActiveCameras=(0,r.m)(s,(()=>{this.onActiveCamerasChanged.notifyObservers(this)}))),this._activeCameras=s}get activeCamera(){return this._activeCamera}set activeCamera(s){s!==this._activeCamera&&(this._activeCamera=s,this.onActiveCameraChanged.notifyObservers(this))}get _hasDefaultMaterial(){return ss.DefaultMaterialFactory!==ss._OriginalDefaultMaterialFactory}get defaultMaterial(){return this.WB||(this.WB=ss.DefaultMaterialFactory(this)),this.WB}set defaultMaterial(s){this.WB=s}set texturesEnabled(s){this._texturesEnabled!==s&&(this._texturesEnabled=s,this.markAllMaterialsAsDirty(1))}get texturesEnabled(){return this._texturesEnabled}get frameGraph(){return this._frameGraph}set frameGraph(s){if(this._frameGraph)return this._frameGraph=s,void(s||(this.customRenderFunction=this._currentCustomRenderFunction));this._frameGraph=s,s&&(this._currentCustomRenderFunction=this.customRenderFunction,this.customRenderFunction=this._renderWithFrameGraph,this.activeCamera=null)}set skeletonsEnabled(s){this._skeletonsEnabled!==s&&(this._skeletonsEnabled=s,this.markAllMaterialsAsDirty(8))}get skeletonsEnabled(){return this._skeletonsEnabled}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=ss.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get renderingManager(){return this._renderingManager}get frustumPlanes(){return this._frustumPlanes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const s of this._transientComponents)s.register();this._transientComponents.length=0}}o(s){this._components.push(s),this._transientComponents.push(s);const Z=s;Z.addFromContainer&&Z.serialize&&this._serializableComponents.push(Z)}_getComponent(s){for(const Z of this._components)if(Z.name===s)return Z;return null}get uniqueId(){return this._uniqueId}constructor(s,Z){this._inputManager=new y(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.aQ=!0,this.autoClearDepthAndStencil=!0,this._clearColor=new C.h(.2,.2,.3,1),this.onClearColorChangedObservable=new S.b,this.ambientColor=new C.d(0,0,0),this.environmentIntensity=1,this.iblIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new S.b,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.gQ=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.effectLayers=[],this.GD=null,this.layers=[],this.lensFlareSystems=[],this.proceduralTextures=[],this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.jO=new S.b,this._onDisposeObserver=null,this.onBeforeRenderObservable=new S.b,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new S.b,this.onAfterRenderCameraObservable=new S.b,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new S.b,this.onAfterAnimationsObservable=new S.b,this.onBeforeDrawPhaseObservable=new S.b,this.onAfterDrawPhaseObservable=new S.b,this.onReadyObservable=new S.b,this.onBeforeCameraRenderObservable=new S.b,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new S.b,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new S.b,this.onAfterActiveMeshesEvaluationObservable=new S.b,this.onBeforeParticlesRenderingObservable=new S.b,this.onAfterParticlesRenderingObservable=new S.b,this.onDataLoadedObservable=new S.b,this.onNewCameraAddedObservable=new S.b,this.onCameraRemovedObservable=new S.b,this.onNewLightAddedObservable=new S.b,this.onLightRemovedObservable=new S.b,this.onNewGeometryAddedObservable=new S.b,this.onGeometryRemovedObservable=new S.b,this.onNewTransformNodeAddedObservable=new S.b,this.onTransformNodeRemovedObservable=new S.b,this.onNewMeshAddedObservable=new S.b,this.onMeshRemovedObservable=new S.b,this.onNewSkeletonAddedObservable=new S.b,this.onSkeletonRemovedObservable=new S.b,this.onNewMaterialAddedObservable=new S.b,this.onNewMultiMaterialAddedObservable=new S.b,this.onMaterialRemovedObservable=new S.b,this.onMultiMaterialRemovedObservable=new S.b,this.onNewTextureAddedObservable=new S.b,this.onTextureRemovedObservable=new S.b,this.onBeforeRenderTargetsRenderObservable=new S.b,this.onAfterRenderTargetsRenderObservable=new S.b,this.onBeforeStepObservable=new S.b,this.onAfterStepObservable=new S.b,this.onActiveCameraChanged=new S.b,this.onActiveCamerasChanged=new S.b,this.onBeforeRenderingGroupObservable=new S.b,this.onAfterRenderingGroupObservable=new S.b,this.onMeshImportedObservable=new S.b,this.onAnimationFileImportedObservable=new S.b,this.onEnvironmentTextureChangedObservable=new S.b,this.onMeshUnderPointerUpdatedObservable=new S.b,this._registeredForLateAnimationBindings=new a.b(256),this._pointerPickingConfiguration=new T,this.onPrePointerObservable=new S.b,this.onPointerObservable=new S.b,this.onPreKeyboardObservable=new S.b,this.onKeyboardObservable=new S.b,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=ss.FOGMODE_NONE,this.fogColor=new C.d(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this._frameGraph=null,this.frameGraphs=[],this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new G.n(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new a.b(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new I.d,this._activeIndices=new I.d,this._activeParticles=new I.d,this._activeBones=new I.d,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=[],this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new a.f(256),this._processedMaterials=new a.f(256),this._renderTargets=new a.b(256),this._materialsRenderTargets=new a.b(256),this._activeParticleSystems=new a.f(256),this._activeSkeletons=new a.b(32),this._softwareSkinnedMeshes=new a.b(32),this._activeAnimatables=new Array,this._transformMatrix=G.b.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=f.f.Create(),this._beforeClearStage=f.f.Create(),this._beforeRenderTargetClearStage=f.f.Create(),this._gatherRenderTargetsStage=f.f.Create(),this._gatherActiveCameraRenderTargetsStage=f.f.Create(),this._isReadyForMeshStage=f.f.Create(),this._beforeEvaluateActiveMeshStage=f.f.Create(),this._evaluateSubMeshStage=f.f.Create(),this._preActiveMeshStage=f.f.Create(),this._cameraDrawRenderTargetStage=f.f.Create(),this._beforeCameraDrawStage=f.f.Create(),this._beforeRenderTargetDrawStage=f.f.Create(),this._beforeRenderingGroupDrawStage=f.f.Create(),this._beforeRenderingMeshStage=f.f.Create(),this._afterRenderingMeshStage=f.f.Create(),this._afterRenderingGroupDrawStage=f.f.Create(),this._afterCameraDrawStage=f.f.Create(),this._afterCameraPostProcessStage=f.f.Create(),this._afterRenderTargetDrawStage=f.f.Create(),this._afterRenderTargetPostProcessStage=f.f.Create(),this._afterRenderStage=f.f.Create(),this._pointerMoveStage=f.f.Create(),this._pointerDownStage=f.f.Create(),this._pointerUpStage=f.f.Create(),this._geometriesByUniqueId=null,this._uniqueId=0,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._useCurrentFrameBuffer=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[],this._uniqueId=this.getUniqueId();const o={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...Z};s=this._engine=s||d.c.LastCreatedEngine,o.virtual?s._virtualScenes.push(this):(d.c._LastCreatedScene=this,s.scenes.push(this)),this._uid=null,this._renderingManager=new b.e(this),Y.e&&(this.postProcessManager=new Y.e(this)),(0,A.i)()&&this.attachControl(),this._createUbo(),B.c&&(this._imageProcessingConfiguration=new B.c),this.setDefaultCandidateProviders(),o.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=o.useMaterialMeshMap,this.useClonedMeshMap=o.useClonedMeshMap,Z&&Z.virtual||s.onNewSceneAddedObservable.notifyObservers(this)}getClassName(){return"Scene"}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_getDefaultSubMeshCandidates(s){return this._defaultSubMeshCandidates.data=s.vO,this._defaultSubMeshCandidates.length=s.vO.length,this._defaultSubMeshCandidates}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=s=>this._getDefaultSubMeshCandidates(s),this.getIntersectingSubMeshCandidates=(s,Z)=>this._getDefaultSubMeshCandidates(s),this.getCollidingSubMeshCandidates=(s,Z)=>this._getDefaultSubMeshCandidates(s)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}get pointerX(){return this._inputManager.pointerX}set pointerX(s){this._inputManager.pointerX=s}get pointerY(){return this._inputManager.pointerY}set pointerY(s){this._inputManager.pointerY=s}getCachedMaterial(){return this._cachedMaterial}getCachedEffect(){return this._cachedEffect}getCachedVisibility(){return this._cachedVisibility}isCachedMaterialInvalid(s,Z){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this._cachedEffect!==Z||this._cachedMaterial!==s||this._cachedVisibility!==o}getEngine(){return this._engine}getTotalVertices(){return this._totalVertices.current}get totalVerticesPerfCounter(){return this._totalVertices}getActiveIndices(){return this._activeIndices.current}get totalActiveIndicesPerfCounter(){return this._activeIndices}getActiveParticles(){return this._activeParticles.current}get activeParticlesPerfCounter(){return this._activeParticles}getActiveBones(){return this._activeBones.current}get activeBonesPerfCounter(){return this._activeBones}getActiveMeshes(){return this._activeMeshes}getAnimationRatio(){return void 0!==this._animationRatio?this._animationRatio:1}getRenderId(){return this._renderId}getFrameId(){return this._frameId}incrementRenderId(){this._renderId++}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}simulatePointerMove(s,Z){return this._inputManager.simulatePointerMove(s,Z),this}simulatePointerDown(s,Z){return this._inputManager.simulatePointerDown(s,Z),this}simulatePointerUp(s,Z,o){return this._inputManager.simulatePointerUp(s,Z,o),this}isPointerCaptured(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._inputManager.isPointerCaptured(s)}attachControl(){let s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._inputManager.attachControl(s,Z,o)}SQ(){this._inputManager.SQ()}isReady(){var s,Z;let o,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._isDisposed)return!1;const j=this.getEngine(),S=j.currentRenderPassId;j.currentRenderPassId=(null===(s=this.activeCamera)||void 0===s?void 0:s.renderPassId)??S;let a=!0;for(this._pendingData.length>0&&(a=!1),null===(Z=this.prePassRenderer)||void 0===Z||Z.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&a&&(a=this.depthPeelingRenderer.isReady()),t&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),o=0;o<this.meshes.length;o++){const s=this.meshes[o];if(!s.vO||0===s.vO.length)continue;if(!s.isReady(!0)){a=!1;continue}const Z=s.hasThinInstances||"InstancedMesh"===s.getClassName()||"InstancedLinesMesh"===s.getClassName()||j.getCaps().instancedArrays&&s.instances.length>0;for(const o of this._isReadyForMeshStage)o.action(s,Z)||(a=!1);if(!t)continue;const S=s.material||this.defaultMaterial;if(S)if(S._storeEffectOnSubMeshes)for(const o of s.vO){const s=o.Ms();s&&s.hasRenderTargetTextures&&null!=s.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(s)&&(this._processedMaterials.push(s),this._materialsRenderTargets.concatWithNoDuplicate(s.getRenderTargetTextures()))}else S.hasRenderTargetTextures&&null!=S.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(S)&&(this._processedMaterials.push(S),this._materialsRenderTargets.concatWithNoDuplicate(S.getRenderTargetTextures()))}if(t)for(o=0;o<this._materialsRenderTargets.length;++o){this._materialsRenderTargets.data[o].isReadyForRendering()||(a=!1)}for(o=0;o<this.geometries.length;o++){2===this.geometries[o].delayLoadState&&(a=!1)}if(this.activeCameras&&this.activeCameras.length>0)for(const O of this.activeCameras)O.isReady(!0)||(a=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(a=!1));for(const O of this.gQ)O.isReady()||(a=!1);if(this.layers)for(const O of this.layers)O.isReady()||(a=!1);if(this.effectLayers)for(const O of this.effectLayers)O.isLayerReady()||(a=!1);return j.areAllEffectsReady()||(a=!1),j.currentRenderPassId=S,a}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}registerBeforeRender(s){this.onBeforeRenderObservable.add(s)}unregisterBeforeRender(s){this.onBeforeRenderObservable.removeCallback(s)}registerAfterRender(s){this.onAfterRenderObservable.add(s)}unregisterAfterRender(s){this.onAfterRenderObservable.removeCallback(s)}_executeOnceBeforeRender(s){const Z=()=>{s(),setTimeout((()=>{this.unregisterBeforeRender(Z)}))};this.registerBeforeRender(Z)}executeOnceBeforeRender(s,Z){void 0!==Z?setTimeout((()=>{this._executeOnceBeforeRender(s)}),Z):this._executeOnceBeforeRender(s)}addPendingData(s){this._pendingData.push(s)}removePendingData(s){const Z=this.isLoading,o=this._pendingData.indexOf(s);-1!==o&&this._pendingData.splice(o,1),Z&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}getWaitingItemsCount(){return this._pendingData.length}get isLoading(){return this._pendingData.length>0}executeWhenReady(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.onReadyObservable.addOnce(s),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(Z)}async whenReadyAsync(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return await new Promise((Z=>{this.executeWhenReady((()=>{Z()}),s)}))}_checkIsReady(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._registerTransientComponents(),this.isReady(s)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((()=>{this.incrementRenderId(),this._checkIsReady(s)}),100))}get animatables(){return this._activeAnimatables}resetLastAnimationTimeFrame(){this._animationTimeLast=j.c.Now}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projectionMatrix}getTransformMatrix(){return this._transformMatrix}setTransformMatrix(s,Z,o,t){o||t||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===s.updateFlag&&this._projectionUpdateFlag===Z.updateFlag||(this._viewUpdateFlag=s.updateFlag,this._projectionUpdateFlag=Z.updateFlag,this._viewMatrix=s,this._projectionMatrix=Z,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?K.c.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=K.c.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(o,t):this._sceneUbo.useUbo&&(this._sceneUbo.SO("viewProjection",this._transformMatrix),this._sceneUbo.SO("view",this._viewMatrix),this._sceneUbo.SO("projection",this._projectionMatrix)))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}createSceneUniformBuffer(s){const Z=new Q.e(this._engine,void 0,!1,s??"fZ");return Z.addUniform("viewProjection",16),Z.addUniform("view",16),Z.addUniform("projection",16),Z.addUniform("vEyePosition",4),Z}setSceneUniformBuffer(s){this._sceneUbo=s,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}getUniqueId(){return p.b.UniqueId}wG(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._blockEntityCollection&&(this.meshes.push(s),s._resyncLightSources(),s.parent||s._addToSceneRootNodes(),t.g.SetImmediate((()=>{this.onNewMeshAddedObservable.notifyObservers(s)})),Z)){const Z=s.getChildMeshes();for(const s of Z)this.wG(s)}}cG(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const o=this.meshes.indexOf(s);if(-1!==o&&(this.meshes.splice(o,1),s.parent||s._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(s),this.onMeshRemovedObservable.notifyObservers(s),Z){const Z=s.getChildMeshes();for(const s of Z)this.cG(s)}return o}addTransformNode(s){this._blockEntityCollection||s.Ls()===this&&-1!==s._indexInSceneTransformNodesArray||(s._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(s),s.parent||s._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(s))}removeTransformNode(s){const Z=s._indexInSceneTransformNodesArray;if(-1!==Z){if(Z!==this.transformNodes.length-1){const s=this.transformNodes[this.transformNodes.length-1];this.transformNodes[Z]=s,s._indexInSceneTransformNodesArray=Z}s._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),s.parent||s._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(s),Z}removeSkeleton(s){const Z=this.skeletons.indexOf(s);return-1!==Z&&(this.skeletons.splice(Z,1),this.onSkeletonRemovedObservable.notifyObservers(s),this._executeActiveContainerCleanup(this._activeSkeletons)),Z}removeMorphTargetManager(s){const Z=this.morphTargetManagers.indexOf(s);return-1!==Z&&this.morphTargetManagers.splice(Z,1),Z}removeLight(s){const Z=this.lights.indexOf(s);if(-1!==Z){for(const Z of this.meshes)Z._removeLightSource(s,!1);this.lights.splice(Z,1),this.sortLightsByPriority(),s.parent||s._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(s),Z}removeCamera(s){const Z=this.cameras.indexOf(s);if(-1!==Z&&(this.cameras.splice(Z,1),s.parent||s._removeFromSceneRootNodes()),this.activeCameras){const Z=this.activeCameras.indexOf(s);-1!==Z&&this.activeCameras.splice(Z,1)}return this.activeCamera===s&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(s),Z}removeParticleSystem(s){const Z=this.gQ.indexOf(s);return-1!==Z&&(this.gQ.splice(Z,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),Z}removeAnimation(s){const Z=this.animations.indexOf(s);return-1!==Z&&this.animations.splice(Z,1),Z}stopAnimation(s,Z,o){}removeAnimationGroup(s){const Z=this.animationGroups.indexOf(s);return-1!==Z&&this.animationGroups.splice(Z,1),Z}removeMultiMaterial(s){const Z=this.multiMaterials.indexOf(s);return-1!==Z&&this.multiMaterials.splice(Z,1),this.onMultiMaterialRemovedObservable.notifyObservers(s),Z}removeMaterial(s){const Z=s._indexInSceneMaterialArray;if(-1!==Z&&Z<this.materials.length){if(Z!==this.materials.length-1){const s=this.materials[this.materials.length-1];this.materials[Z]=s,s._indexInSceneMaterialArray=Z}s._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(s),Z}removeActionManager(s){const Z=this.actionManagers.indexOf(s);return-1!==Z&&this.actionManagers.splice(Z,1),Z}removeTexture(s){const Z=this.textures.indexOf(s);return-1!==Z&&this.textures.splice(Z,1),this.onTextureRemovedObservable.notifyObservers(s),Z}addLight(s){if(!this._blockEntityCollection){this.lights.push(s),this.sortLightsByPriority(),s.parent||s._addToSceneRootNodes();for(const Z of this.meshes)-1===Z.lightSources.indexOf(s)&&(Z.lightSources.push(s),Z._resyncLightSources());t.g.SetImmediate((()=>{this.onNewLightAddedObservable.notifyObservers(s)}))}}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(P.b.CompareLightsPriority)}addCamera(s){this._blockEntityCollection||(this.cameras.push(s),t.g.SetImmediate((()=>{this.onNewCameraAddedObservable.notifyObservers(s)})),s.parent||s._addToSceneRootNodes())}addSkeleton(s){this._blockEntityCollection||(this.skeletons.push(s),t.g.SetImmediate((()=>{this.onNewSkeletonAddedObservable.notifyObservers(s)})))}addParticleSystem(s){this._blockEntityCollection||this.gQ.push(s)}addAnimation(s){this._blockEntityCollection||this.animations.push(s)}addAnimationGroup(s){this._blockEntityCollection||this.animationGroups.push(s)}addMultiMaterial(s){this._blockEntityCollection||(this.multiMaterials.push(s),t.g.SetImmediate((()=>{this.onNewMultiMaterialAddedObservable.notifyObservers(s)})))}addMaterial(s){this._blockEntityCollection||s.Ls()===this&&-1!==s._indexInSceneMaterialArray||(s._indexInSceneMaterialArray=this.materials.length,this.materials.push(s),t.g.SetImmediate((()=>{this.onNewMaterialAddedObservable.notifyObservers(s)})))}addMorphTargetManager(s){this._blockEntityCollection||this.morphTargetManagers.push(s)}addGeometry(s){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[s.uniqueId]=this.geometries.length),this.geometries.push(s))}addActionManager(s){this.actionManagers.push(s)}addTexture(s){this._blockEntityCollection||(this.textures.push(s),this.onNewTextureAddedObservable.notifyObservers(s))}switchActiveCamera(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.SQ(),this.activeCamera=s,Z&&s.attachControl())}setActiveCameraById(s){const Z=this.getCameraById(s);return Z?(this.activeCamera=Z,Z):null}setActiveCameraByName(s){const Z=this.getCameraByName(s);return Z?(this.activeCamera=Z,Z):null}getAnimationGroupByName(s){for(let Z=0;Z<this.animationGroups.length;Z++)if(this.animationGroups[Z].name===s)return this.animationGroups[Z];return null}_getMaterial(s,Z){for(let o=0;o<this.materials.length;o++){const s=this.materials[o];if(Z(s))return s}if(s)for(let o=0;o<this.multiMaterials.length;o++){const s=this.multiMaterials[o];if(Z(s))return s}return null}getMaterialByUniqueID(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.getMaterialByUniqueId(s,Z)}getMaterialByUniqueId(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(Z,(Z=>Z.uniqueId===s))}getMaterialById(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(Z,(Z=>Z.id===s))}getMaterialByName(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(Z,(Z=>Z.name===s))}getLastMaterialById(s){let Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(let o=this.materials.length-1;o>=0;o--)if(this.materials[o].id===s)return this.materials[o];if(Z)for(let o=this.multiMaterials.length-1;o>=0;o--)if(this.multiMaterials[o].id===s)return this.multiMaterials[o];return null}getTextureByUniqueId(s){for(let Z=0;Z<this.textures.length;Z++)if(this.textures[Z].uniqueId===s)return this.textures[Z];return null}getTextureByName(s){for(let Z=0;Z<this.textures.length;Z++)if(this.textures[Z].name===s)return this.textures[Z];return null}getCameraById(s){for(let Z=0;Z<this.cameras.length;Z++)if(this.cameras[Z].id===s)return this.cameras[Z];return null}getCameraByUniqueId(s){for(let Z=0;Z<this.cameras.length;Z++)if(this.cameras[Z].uniqueId===s)return this.cameras[Z];return null}getCameraByName(s){for(let Z=0;Z<this.cameras.length;Z++)if(this.cameras[Z].name===s)return this.cameras[Z];return null}getBoneById(s){for(let Z=0;Z<this.skeletons.length;Z++){const o=this.skeletons[Z];for(let Z=0;Z<o.bones.length;Z++)if(o.bones[Z].id===s)return o.bones[Z]}return null}getBoneByName(s){for(let Z=0;Z<this.skeletons.length;Z++){const o=this.skeletons[Z];for(let Z=0;Z<o.bones.length;Z++)if(o.bones[Z].name===s)return o.bones[Z]}return null}getLightByName(s){for(let Z=0;Z<this.lights.length;Z++)if(this.lights[Z].name===s)return this.lights[Z];return null}getLightById(s){for(let Z=0;Z<this.lights.length;Z++)if(this.lights[Z].id===s)return this.lights[Z];return null}getLightByUniqueId(s){for(let Z=0;Z<this.lights.length;Z++)if(this.lights[Z].uniqueId===s)return this.lights[Z];return null}getParticleSystemById(s){for(let Z=0;Z<this.gQ.length;Z++)if(this.gQ[Z].id===s)return this.gQ[Z];return null}getGeometryById(s){for(let Z=0;Z<this.geometries.length;Z++)if(this.geometries[Z].id===s)return this.geometries[Z];return null}_getGeometryByUniqueId(s){if(this._geometriesByUniqueId){const Z=this._geometriesByUniqueId[s];if(void 0!==Z)return this.geometries[Z]}else for(let Z=0;Z<this.geometries.length;Z++)if(this.geometries[Z].uniqueId===s)return this.geometries[Z];return null}getFrameGraphByName(s){for(let Z=0;Z<this.frameGraphs.length;Z++)if(this.frameGraphs[Z].name===s)return this.frameGraphs[Z];return null}pushGeometry(s,Z){return!(!Z&&this._getGeometryByUniqueId(s.uniqueId))&&(this.addGeometry(s),t.g.SetImmediate((()=>{this.onNewGeometryAddedObservable.notifyObservers(s)})),!0)}removeGeometry(s){let Z;if(this._geometriesByUniqueId){if(Z=this._geometriesByUniqueId[s.uniqueId],void 0===Z)return!1}else if(Z=this.geometries.indexOf(s),Z<0)return!1;if(Z!==this.geometries.length-1){const s=this.geometries[this.geometries.length-1];s&&(this.geometries[Z]=s,this._geometriesByUniqueId&&(this._geometriesByUniqueId[s.uniqueId]=Z))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[s.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(s),!0}getGeometries(){return this.geometries}getMeshById(s){for(let Z=0;Z<this.meshes.length;Z++)if(this.meshes[Z].id===s)return this.meshes[Z];return null}getMeshesById(s){return this.meshes.filter((function(Z){return Z.id===s}))}getTransformNodeById(s){for(let Z=0;Z<this.transformNodes.length;Z++)if(this.transformNodes[Z].id===s)return this.transformNodes[Z];return null}getTransformNodeByUniqueId(s){for(let Z=0;Z<this.transformNodes.length;Z++)if(this.transformNodes[Z].uniqueId===s)return this.transformNodes[Z];return null}getTransformNodesById(s){return this.transformNodes.filter((function(Z){return Z.id===s}))}getMeshByUniqueId(s){for(let Z=0;Z<this.meshes.length;Z++)if(this.meshes[Z].uniqueId===s)return this.meshes[Z];return null}getLastMeshById(s){for(let Z=this.meshes.length-1;Z>=0;Z--)if(this.meshes[Z].id===s)return this.meshes[Z];return null}getLastTransformNodeById(s){for(let Z=this.transformNodes.length-1;Z>=0;Z--)if(this.transformNodes[Z].id===s)return this.transformNodes[Z];return null}getLastEntryById(s){let Z;for(Z=this.meshes.length-1;Z>=0;Z--)if(this.meshes[Z].id===s)return this.meshes[Z];for(Z=this.transformNodes.length-1;Z>=0;Z--)if(this.transformNodes[Z].id===s)return this.transformNodes[Z];for(Z=this.cameras.length-1;Z>=0;Z--)if(this.cameras[Z].id===s)return this.cameras[Z];for(Z=this.lights.length-1;Z>=0;Z--)if(this.lights[Z].id===s)return this.lights[Z];return null}getNodeById(s){const Z=this.getMeshById(s);if(Z)return Z;const o=this.getTransformNodeById(s);if(o)return o;const t=this.getLightById(s);if(t)return t;const j=this.getCameraById(s);if(j)return j;const S=this.getBoneById(s);return S||null}getNodeByName(s){const Z=this.getMeshByName(s);if(Z)return Z;const o=this.getTransformNodeByName(s);if(o)return o;const t=this.getLightByName(s);if(t)return t;const j=this.getCameraByName(s);if(j)return j;const S=this.getBoneByName(s);return S||null}getMeshByName(s){for(let Z=0;Z<this.meshes.length;Z++)if(this.meshes[Z].name===s)return this.meshes[Z];return null}getTransformNodeByName(s){for(let Z=0;Z<this.transformNodes.length;Z++)if(this.transformNodes[Z].name===s)return this.transformNodes[Z];return null}getLastSkeletonById(s){for(let Z=this.skeletons.length-1;Z>=0;Z--)if(this.skeletons[Z].id===s)return this.skeletons[Z];return null}getSkeletonByUniqueId(s){for(let Z=0;Z<this.skeletons.length;Z++)if(this.skeletons[Z].uniqueId===s)return this.skeletons[Z];return null}getSkeletonById(s){for(let Z=0;Z<this.skeletons.length;Z++)if(this.skeletons[Z].id===s)return this.skeletons[Z];return null}getSkeletonByName(s){for(let Z=0;Z<this.skeletons.length;Z++)if(this.skeletons[Z].name===s)return this.skeletons[Z];return null}getMorphTargetManagerById(s){for(let Z=0;Z<this.morphTargetManagers.length;Z++)if(this.morphTargetManagers[Z].uniqueId===s)return this.morphTargetManagers[Z];return null}getMorphTargetById(s){for(let Z=0;Z<this.morphTargetManagers.length;++Z){const o=this.morphTargetManagers[Z];for(let Z=0;Z<o.numTargets;++Z){const t=o.getTarget(Z);if(t.id===s)return t}}return null}getMorphTargetByName(s){for(let Z=0;Z<this.morphTargetManagers.length;++Z){const o=this.morphTargetManagers[Z];for(let Z=0;Z<o.numTargets;++Z){const t=o.getTarget(Z);if(t.name===s)return t}}return null}getPostProcessByName(s){for(let Z=0;Z<this.postProcesses.length;++Z){const o=this.postProcesses[Z];if(o.name===s)return o}return null}isActiveMesh(s){return-1!==this._activeMeshes.indexOf(s)}get uid(){return this._uid||(this._uid=t.g.RandomId()),this._uid}addExternalData(s,Z){return this._externalData||(this._externalData=new O),this._externalData.add(s,Z)}getExternalData(s){return this._externalData?this._externalData.get(s):null}getOrAddExternalDataWithFactory(s,Z){return this._externalData||(this._externalData=new O),this._externalData.getOrAddWithFactory(s,Z)}removeExternalData(s){return this._externalData.remove(s)}_evaluateSubMesh(s,Z,o,t){if(t||s.isInFrustum(this._frustumPlanes)){for(const t of this._evaluateSubMeshStage)t.action(Z,s);const o=s.Ms();null!==o&&void 0!==o&&(o.hasRenderTargetTextures&&null!=o.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(o)&&(this._processedMaterials.push(o),this._materialsRenderTargets.concatWithNoDuplicate(o.getRenderTargetTextures())),this._renderingManager.dispatch(s,Z,o))}}freeProcessedMaterials(){this._processedMaterials.dispose()}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set blockfreeActiveMeshesAndRenderingGroups(s){this._preventFreeActiveMeshesAndRenderingGroups!==s&&(s&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=s)}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let s=0;s<this.activeCameras.length;s++){const Z=this.activeCameras[s];Z&&Z._activeMeshes&&Z._activeMeshes.dispose()}}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let s=0;s<this.textures.length;s++){const Z=this.textures[s];Z&&Z.renderList&&Z.freeRenderingGroups()}}_isInIntermediateRendering(){return this._intermediateRendering}freezeActiveMeshes(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0,t=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],j=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.executeWhenReady((()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=j,this._skipEvaluateActiveMeshesCompletely=s,t)for(let s=0;s<this._activeMeshes.length;s++)this._activeMeshes.data[s]._freeze();Z&&Z()}else o&&o("No active camera found")})),this}unfreezeActiveMeshes(){for(let s=0;s<this.meshes.length;s++){const Z=this.meshes[s];Z._internalAbstractMeshDataInfo&&(Z._internalAbstractMeshDataInfo._isActive=!1)}for(let s=0;s<this._activeMeshes.length;s++)this._activeMeshes.data[s]._unFreeze();return this._activeMeshesFrozen=!1,this}_executeActiveContainerCleanup(s){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((()=>s.dispose()))}_evaluateActiveMeshes(){if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode){var s;if(this._activeMeshes.length>0)null===(s=this.activeCamera)||void 0===s||s._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();return}if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const s=this._activeMeshes.length;for(let Z=0;Z<s;Z++){this._activeMeshes.data[Z].Ea()}}if(this._activeParticleSystems){const s=this._activeParticleSystems.length;for(let Z=0;Z<s;Z++)this._activeParticleSystems.data[Z].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const t of this._beforeEvaluateActiveMeshStage)t.action();const Z=this.getActiveMeshCandidates(),o=Z.length;for(let t=0;t<o;t++){const s=Z.data[t];let o=s._internalAbstractMeshDataInfo._currentLOD.get(this.activeCamera);if(o?o[1]=-1:(o=[s,-1],s._internalAbstractMeshDataInfo._currentLOD.set(this.activeCamera,o)),s.isBlocked)continue;if(this._totalVertices.addCount(s.getTotalVertices(),!1),!s.isReady()||!s.isEnabled()||s.ZO.hasAZeroComponent)continue;s.Ea(),s.actionManager&&s.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(s);let j=this.customLODSelector?this.customLODSelector(s,this.activeCamera):s.getLOD(this.activeCamera);if(o[0]=j,o[1]=this._frameId,void 0!==j&&null!==j&&(j!==s&&0!==j.billboardMode&&j.Ea(),s._preActivate(),s.isVisible&&s.visibility>0&&0!==(s.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||s.UO||s.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(s),this.activeCamera._activeMeshes.push(s),j!==s&&j._activate(this._renderId,!1);for(const Z of this._preActiveMeshStage)Z.action(s);s._activate(this._renderId,!1)&&(s.isAnInstance?s._internalAbstractMeshDataInfo._actAsRegularMesh&&(j=s):j._internalAbstractMeshDataInfo._onlyForInstances=!1,j._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(s,j)),s._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let s=0;s<this.gQ.length;s++){const Z=this.gQ[s];if(!Z.isStarted()||!Z.k)continue;const o=Z.k;o.position&&!o.isEnabled()||(this._activeParticleSystems.push(Z),Z.animate(),this._renderingManager.dispatchParticles(Z))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}_prepareSkeleton(s){this._skeletonsEnabled&&s.skeleton&&(this._activeSkeletons.pushNoDuplicate(s.skeleton)&&(s.skeleton.prepare(),this._activeBones.addCount(s.skeleton.bones.length,!1)),s.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(s)&&this.frameGraph&&s.applySkeleton(s.skeleton))}_activeMesh(s,Z){this._prepareSkeleton(Z);let o=s.hasInstances||s.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||Z.UO;if(Z&&Z.vO&&Z.vO.length>0){const t=this.getActiveSubMeshCandidates(Z),j=t.length;o=o||1===j;for(let S=0;S<j;S++){const j=t.data[S];this._evaluateSubMesh(j,Z,s,o)}}}updateTransformMatrix(s){const Z=this.activeCamera;if(Z)if(Z._renderingMultiview){const o=Z._rigCameras[0],t=Z._rigCameras[1];this.setTransformMatrix(o.getViewMatrix(),o.getProjectionMatrix(s),t.getViewMatrix(),t.getProjectionMatrix(s))}else this.setTransformMatrix(Z.getViewMatrix(),Z.getProjectionMatrix(s))}_bindFrameBuffer(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._useCurrentFrameBuffer||(s&&s._multiviewTexture?s._multiviewTexture._bindFrameBuffer():s&&s.outputRenderTarget?s.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer()),Z&&this._clearFrameBuffer(s)}_clearFrameBuffer(s){if(s&&s._multiviewTexture);else if(s&&s.outputRenderTarget&&!s._renderingMultiview){const Z=s.outputRenderTarget;Z.onClearObservable.hasObservers()?Z.onClearObservable.notifyObservers(this._engine):Z.skipInitialClear||s.isRightCamera||(this.aQ&&this._engine.clear(Z.clearColor||this._clearColor,!Z._cleared,!0,!0),Z._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_renderForCamera(s,Z){var o;let j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(s&&s._skipRendering)return;const S=this._engine;if(this._activeCamera=s,!this.activeCamera)throw new Error("Active camera not set");if(S.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&j){let Z=!0;s._renderingMultiview&&s.outputRenderTarget&&(Z=s.outputRenderTarget.skipInitialClear,this.aQ&&(this._defaultFrameBufferCleared=!1,s.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),s._renderingMultiview&&s.outputRenderTarget&&(s.outputRenderTarget.skipInitialClear=Z)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let t=0;t<this._softwareSkinnedMeshes.length;t++){const s=this._softwareSkinnedMeshes.data[t];s.applySkeleton(s.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),s.customRenderTargets&&s.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(s.customRenderTargets),Z&&Z.customRenderTargets&&Z.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(Z.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const t of this._gatherActiveCameraRenderTargetsStage)t.action(this._renderTargets);let a=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){t.g.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let s=0;s<this._renderTargets.length;s++){const Z=this._renderTargets.data[s];if(Z._shouldRender()){this._renderId++;const s=Z.activeCamera&&Z.activeCamera!==this.activeCamera;Z.render(s,this.dumpNextRenderTargets),a=!0}}t.g.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const s of this._cameraDrawRenderTargetStage)a=s.action(this.activeCamera)||a;this._intermediateRendering=!1}this._engine.currentRenderPassId=(null===(o=s.outputRenderTarget)||void 0===o?void 0:o.renderPassId)??s.renderPassId??0,a&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||s._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const t of this._beforeCameraDrawStage)t.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),S.snapshotRendering&&1===S.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const t of this._afterCameraDrawStage)t.action(this.activeCamera);if(this.postProcessManager&&!s._multiviewTexture){const Z=s.outputRenderTarget?s.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(s.isIntermediate,Z)}for(const t of this._afterCameraPostProcessStage)t.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}_processSubCameras(s){let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(0===s.cameraRigMode||s._renderingMultiview)return s._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(s,void 0,Z),void this.onAfterRenderCameraObservable.notifyObservers(s);if(s._useMultiviewToSingleView)this._renderMultiviewToSingleView(s);else{this.onBeforeCameraRenderObservable.notifyObservers(s);for(let Z=0;Z<s._rigCameras.length;Z++)this._renderForCamera(s._rigCameras[Z],s)}this._activeCamera=s,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(s)}_checkIntersections(){for(let s=0;s<this._meshesForIntersections.length;s++){const Z=this._meshesForIntersections.data[s];if(Z.actionManager)for(let s=0;Z.actionManager&&s<Z.actionManager.actions.length;s++){const o=Z.actionManager.actions[s];if(12===o.trigger||13===o.trigger){const s=o.getTriggerParameter(),t=s.mesh?s.mesh:s,j=t.intersectsMesh(Z,s.usePreciseIntersection),S=Z._intersectionsInProgress.indexOf(t);j&&-1===S?12===o.trigger?(o._executeCurrent(z.CreateNew(Z,void 0,t)),Z._intersectionsInProgress.push(t)):13===o.trigger&&Z._intersectionsInProgress.push(t):!j&&S>-1&&(13===o.trigger&&o._executeCurrent(z.CreateNew(Z,void 0,t)),Z.actionManager.hasSpecificTrigger(13,(s=>{const Z=s.mesh?s.mesh:s;return t===Z}))&&13!==o.trigger||Z._intersectionsInProgress.splice(S,1))}}}}_advancePhysicsEngineStep(s){}_animate(s){}animate(){if(this._engine.isDeterministicLockStep()){let s=Math.max(ss.MinDeltaTime,Math.min(this._engine.getDeltaTime(),ss.MaxDeltaTime))+this._timeAccumulator;const Z=this._engine.getTimeStep(),o=1e3/Z/1e3;let t=0;const j=this._engine.getLockstepMaxSteps();let S=Math.floor(s/Z);for(S=Math.min(S,j);s>0&&t<S;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=Z*o,this._animate(Z),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(Z),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,t++,s-=Z;this._timeAccumulator=s<0?0:s}else{const s=this.useConstantAnimationDeltaTime?16:Math.max(ss.MinDeltaTime,Math.min(this._engine.getDeltaTime(),ss.MaxDeltaTime));this._animationRatio=.06*s,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(s)}}_clear(){(this.autoClearDepthAndStencil||this.aQ)&&this._engine.clear(this._clearColor,this.aQ||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}_checkCameraRenderTarget(s){var Z;if(null===s||void 0===s||!s.outputRenderTarget||null!==s&&void 0!==s&&s.isRigCamera||(s.outputRenderTarget._cleared=!1),null!==s&&void 0!==s&&null!==(Z=s.rigCameras)&&void 0!==Z&&Z.length)for(let o=0;o<s.rigCameras.length;++o){const Z=s.rigCameras[o].outputRenderTarget;Z&&(Z._cleared=!1)}}resetDrawCache(s){if(this.meshes)for(const Z of this.meshes)Z.resetDrawCache(s)}_renderWithFrameGraph(){var s;let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.activeCamera=null,this._activeParticleSystems.reset(),this._activeSkeletons.reset(),Z)for(const j of this.cameras)if(j.update(),0!==j.cameraRigMode)for(let s=0;s<j._rigCameras.length;s++)j._rigCameras[s].update();this.onBeforeRenderObservable.notifyObservers(this);for(const j of this._beforeClearStage)j.action();const o=this.getActiveMeshCandidates(),t=o.length;for(let j=0;j<t;j++){const s=o.data[j];s.isBlocked||(this._totalVertices.addCount(s.getTotalVertices(),!1),s.isReady()&&s.isEnabled()&&!s.ZO.hasAZeroComponent&&(s.Ea(),s.actionManager&&s.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(s)))}if(this.particlesEnabled)for(let j=0;j<this.gQ.length;j++){const s=this.gQ[j];if(!s.isStarted()||!s.k)continue;const Z=s.k;Z.position&&!Z.isEnabled()||(this._activeParticleSystems.push(s),s.animate())}null===(s=this.frameGraph)||void 0===s||s.execute()}_renderRenderTarget(s,Z){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._intermediateRendering=!0,s._shouldRender()){if(this._renderId++,this.activeCamera=Z,!this.activeCamera)throw new Error("Active camera not set");this._engine.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),s.render(o,t)}this._intermediateRendering=!1}render(){var s;let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.B){if(this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),null!==(s=this.activeCameras)&&void 0!==s&&s.length)for(const s of this.activeCameras)this._checkCameraRenderTarget(s);this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),o||this.animate();for(const s of this._beforeCameraUpdateStage)s.action();if(Z)if(this.activeCameras&&this.activeCameras.length>0)for(let s=0;s<this.activeCameras.length;s++){const Z=this.activeCameras[s];if(Z.update(),0!==Z.cameraRigMode)for(let s=0;s<Z._rigCameras.length;s++)Z._rigCameras[s].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let s=0;s<this.activeCamera._rigCameras.length;s++)this.activeCamera._rigCameras[s].update();if(this.customRenderFunction)this._renderId++,this._engine.currentRenderPassId=0,this.customRenderFunction(Z,o);else{var j;this.onBeforeRenderObservable.notifyObservers(this),this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const s=null!==(j=this.activeCameras)&&void 0!==j&&j.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){t.g.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0);for(let Z=0;Z<this.customRenderTargets.length;Z++){const o=this.customRenderTargets[Z],t=o.activeCamera||this.activeCamera;this._renderRenderTarget(o,t,s!==t,this.dumpNextRenderTargets)}t.g.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._renderId++}this._engine.currentRenderPassId=(null===s||void 0===s?void 0:s.renderPassId)??0,this.activeCamera=s,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const Z of this._beforeClearStage)Z.action();this._clearFrameBuffer(this.activeCamera);for(const Z of this._gatherRenderTargetsStage)Z.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let Z=0;Z<this.activeCameras.length;Z++)this._processSubCameras(this.activeCameras[Z],Z>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}}this._checkIntersections();for(const s of this._afterRenderStage)s.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let s=0;s<this._toBeDisposed.length;s++){const Z=this._toBeDisposed[s];Z&&Z.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}}freezeMaterials(){for(let s=0;s<this.materials.length;s++)this.materials[s].freeze()}unfreezeMaterials(){for(let s=0;s<this.materials.length;s++)this.materials[s].unfreeze()}dispose(){if(this.B)return;if(this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this._activeAnimatables&&this.stopAllAnimations){for(const s of this._activeAnimatables)s.onAnimationEndObservable.clear(),s.onAnimationEnd=null;this.stopAllAnimations()}this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const s=this._activeRequests.slice();for(const j of s)j.abort();this._activeRequests.length=0;try{this.jO.notifyObservers(this)}catch(t){n.b.Error("An error occurred while calling onDisposeObservable!",t)}this.SQ();if(this._engine.getInputElement())for(let j=0;j<this.cameras.length;j++)this.cameras[j].SQ();this._disposeList(this.animationGroups),this._disposeList(this.lights),this.WB&&this.WB.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.meshes,(s=>s.dispose(!0))),this._disposeList(this.transformNodes,(s=>s.dispose(!0)));const Z=this.cameras;this._disposeList(Z),this._disposeList(this.gQ),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let o=this._engine.scenes.indexOf(this);if(o>-1&&this._engine.scenes.splice(o,1),d.c._LastCreatedScene===this){d.c._LastCreatedScene=null;let s=d.c.Instances.length-1;for(;s>=0;){const Z=d.c.Instances[s];if(Z.scenes.length>0){d.c._LastCreatedScene=Z.scenes[this._engine.scenes.length-1];break}s--}}o=this._engine._virtualScenes.indexOf(this),o>-1&&this._engine._virtualScenes.splice(o,1),this._engine.wipeCaches(!0),this.jO.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this.onClearColorChangedObservable.clear(),this.onEnvironmentTextureChangedObservable.clear(),this.onMeshUnderPointerUpdatedObservable.clear(),this._isDisposed=!0}_disposeList(s,Z){const o=s.slice(0);Z=Z??(s=>s.dispose());for(const t of o)Z(t);s.length=0}get B(){return this._isDisposed}clearCachedVertexData(){for(let s=0;s<this.meshes.length;s++){const Z=this.meshes[s].Pa;Z&&Z.clearCachedData()}}cleanCachedTextureBuffer(){for(const s of this.textures){s._buffer&&(s._buffer=null)}}getWorldExtends(s){const Z=new G.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o=new G.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);s=s||(()=>!0);const t=this.meshes.filter(s);for(const j of t){if(j.Ea(!0),!j.vO||0===j.vO.length||j.infiniteDistance)continue;const s=j.getBoundingInfo(),t=s.boundingBox.minimumWorld,S=s.boundingBox.maximumWorld;G.n.CheckExtends(t,Z,o),G.n.CheckExtends(S,Z,o)}return{min:Z,max:o}}createPickingRay(s,Z,o,t){throw(0,U.d)("Ray")}createPickingRayToRef(s,Z,o,t,j){throw(0,U.d)("Ray")}createPickingRayInCameraSpace(s,Z,o){throw(0,U.d)("Ray")}createPickingRayInCameraSpaceToRef(s,Z,o,t){throw(0,U.d)("Ray")}vo(s,Z,o,t,j,S){const a=(0,U.d)("Ray",!0);return a&&n.b.Warn(a),new D.b}pickWithBoundingInfo(s,Z,o,t,j){const S=(0,U.d)("Ray",!0);return S&&n.b.Warn(S),new D.b}pickWithRay(s,Z,o,t){throw(0,U.d)("Ray")}multiPick(s,Z,o,t,j){throw(0,U.d)("Ray")}multiPickWithRay(s,Z,o){throw(0,U.d)("Ray")}setPointerOverMesh(s,Z,o){this._inputManager.setPointerOverMesh(s,Z,o)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_rebuildGeometries(){for(const s of this.geometries)s._rebuild();for(const s of this.meshes)s._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const s of this._components)s.rebuild();for(const s of this.gQ)s.rebuild();if(this.spriteManagers)for(const s of this.spriteManagers)s.rebuild()}_rebuildTextures(){for(const s of this.textures)s._rebuild(!0);this.markAllMaterialsAsDirty(1)}_getByTags(s,Z,o){if(void 0===Z)return s;const t=[];for(const j in s){const S=s[j];v.b&&v.b.MatchesQuery(S,Z)&&(!o||o(S))&&t.push(S)}return t}getMeshesByTags(s,Z){return this._getByTags(this.meshes,s,Z)}getCamerasByTags(s,Z){return this._getByTags(this.cameras,s,Z)}getLightsByTags(s,Z){return this._getByTags(this.lights,s,Z)}getMaterialByTags(s,Z){return this._getByTags(this.materials,s,Z).concat(this._getByTags(this.multiMaterials,s,Z))}getTransformNodesByTags(s,Z){return this._getByTags(this.transformNodes,s,Z)}setRenderingOrder(s){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(s,Z,o,t)}setRenderingAutoClearDepthStencil(s,Z){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],t=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(s,Z,o,t)}getAutoClearDepthStencilSetup(s){return this._renderingManager.getAutoClearDepthStencilSetup(s)}_forceBlockMaterialDirtyMechanism(s){this._blockMaterialDirtyMechanism=s}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set blockMaterialDirtyMechanism(s){this._blockMaterialDirtyMechanism!==s&&(this._blockMaterialDirtyMechanism=s,s||this.markAllMaterialsAsDirty(127))}markAllMaterialsAsDirty(s,Z){if(!this._blockMaterialDirtyMechanism)for(const o of this.materials)Z&&!Z(o)||o.dG(s)}_loadFile(s,Z,o,t,j,S,a){const O=(0,E.t)(s,Z,o,t?this.offlineProvider:void 0,j,S,a);return this._activeRequests.push(O),O.onCompleteObservable.add((s=>{this._activeRequests.splice(this._activeRequests.indexOf(s),1)})),O}async _loadFileAsync(s,Z,o,t,j){return await new Promise(((S,a)=>{this._loadFile(s,(s=>{S(s)}),Z,o,t,((s,Z)=>{a(Z)}),j)}))}_requestFile(s,Z,o,t,j,S,a){const O=(0,E.A)(s,Z,o,t?this.offlineProvider:void 0,j,S,a);return this._activeRequests.push(O),O.onCompleteObservable.add((s=>{this._activeRequests.splice(this._activeRequests.indexOf(s),1)})),O}async _requestFileAsync(s,Z,o,t,j){return await new Promise(((S,a)=>{this._requestFile(s,(s=>{S(s)}),Z,o,t,(s=>{a(s)}),j)}))}_readFile(s,Z,o,t,j){const S=(0,E.y)(s,Z,o,t,j);return this._activeRequests.push(S),S.onCompleteObservable.add((s=>{this._activeRequests.splice(this._activeRequests.indexOf(s),1)})),S}async _readFileAsync(s,Z,o){return await new Promise(((t,j)=>{this._readFile(s,(s=>{t(s)}),Z,o,(s=>{j(s)}))}))}getPerfCollector(){throw(0,U.d)("performanceViewerSceneExtension")}setActiveCameraByID(s){return this.setActiveCameraById(s)}getMaterialByID(s){return this.getMaterialById(s)}getLastMaterialByID(s){return this.getLastMaterialById(s)}getTextureByUniqueID(s){return this.getTextureByUniqueId(s)}getCameraByID(s){return this.getCameraById(s)}getCameraByUniqueID(s){return this.getCameraByUniqueId(s)}getBoneByID(s){return this.getBoneById(s)}getLightByID(s){return this.getLightById(s)}getLightByUniqueID(s){return this.getLightByUniqueId(s)}getParticleSystemByID(s){return this.getParticleSystemById(s)}getGeometryByID(s){return this.getGeometryById(s)}getMeshByID(s){return this.getMeshById(s)}getMeshByUniqueID(s){return this.getMeshByUniqueId(s)}getLastMeshByID(s){return this.getLastMeshById(s)}getMeshesByID(s){return this.getMeshesById(s)}getTransformNodeByID(s){return this.getTransformNodeById(s)}getTransformNodeByUniqueID(s){return this.getTransformNodeByUniqueId(s)}getTransformNodesByID(s){return this.getTransformNodesById(s)}getNodeByID(s){return this.getNodeById(s)}getLastEntryByID(s){return this.getLastEntryById(s)}getLastSkeletonByID(s){return this.getLastSkeletonById(s)}}ss.FOGMODE_NONE=0,ss.FOGMODE_EXP=1,ss.FOGMODE_EXP2=2,ss.FOGMODE_LINEAR=3,ss.MinDeltaTime=1,ss.MaxDeltaTime=1e3,ss._OriginalDefaultMaterialFactory=ss.DefaultMaterialFactory,(0,J.f)("BABYLON.Scene",ss)},11297:(s,Z,o)=>{o.d(Z,{d:()=>t,f:()=>j});class t{}t.NAME_EFFECTLAYER="EffectLayer",t.NAME_LAYER="Layer",t.NAME_LENSFLARESYSTEM="LensFlareSystem",t.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",t.NAME_PARTICLESYSTEM="NY",t.NAME_GAMEPAD="Gamepad",t.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",t.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",t.NAME_PREPASSRENDERER="PrePassRenderer",t.NAME_DEPTHRENDERER="DepthRenderer",t.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",t.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",t.NAME_SPRITE="Sprite",t.NAME_SUBSURFACE="SubSurface",t.NAME_OUTLINERENDERER="Outline",t.NAME_PROCEDURALTEXTURE="ProceduralTexture",t.NAME_SHADOWGENERATOR="ShadowGenerator",t.NAME_OCTREE="LY",t.NAME_PHYSICSENGINE="PhysicsEngine",t.NAME_AUDIO="Audio",t.NAME_FLUIDRENDERER="FluidRenderer",t.NAME_IBLCDFGENERATOR="iblCDFGenerator",t.STEP_ISREADYFORMESH_EFFECTLAYER=0,t.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,t.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,t.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,t.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,t.STEP_BEFORECAMERADRAW_PREPASS=0,t.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,t.STEP_BEFORECAMERADRAW_LAYER=2,t.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,t.STEP_BEFORERENDERTARGETDRAW_LAYER=1,t.STEP_BEFORERENDERINGMESH_PREPASS=0,t.STEP_BEFORERENDERINGMESH_OUTLINE=1,t.STEP_AFTERRENDERINGMESH_PREPASS=0,t.STEP_AFTERRENDERINGMESH_OUTLINE=1,t.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,t.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,t.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,t.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,t.STEP_BEFORECLEAR_PREPASS=1,t.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,t.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,t.STEP_AFTERRENDERTARGETDRAW_LAYER=1,t.STEP_AFTERCAMERADRAW_PREPASS=0,t.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,t.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,t.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,t.STEP_AFTERCAMERADRAW_LAYER=4,t.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,t.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,t.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,t.STEP_AFTERRENDER_AUDIO=0,t.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,t.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,t.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,t.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,t.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,t.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,t.STEP_POINTERMOVE_SPRITE=0,t.STEP_POINTERDOWN_SPRITE=0,t.STEP_POINTERUP_SPRITE=0;class j extends Array{constructor(s){super(...s)}static Create(){return Object.create(j.prototype)}registerStep(s,Z,o){let t=0,j=Number.MAX_VALUE;for(;t<this.length;t++){if(j=this[t].index,s<j)break}this.splice(t,0,{index:s,component:Z,action:o.bind(Z)})}clear(){this.length=0}}},11086:(s,Z,o)=>{o.d(Z,{c:()=>t});function t(s,Z,o,t){var j,S=arguments.length,a=S<3?Z:null===t?t=Object.getOwnPropertyDescriptor(Z,o):t;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(s,Z,o,t);else for(var O=s.length-1;O>=0;O--)(j=s[O])&&(a=(S<3?j(a):S>3?j(Z,o,a):j(Z,o))||a);return S>3&&a&&Object.defineProperty(Z,o,a),a}Object.create;Object.create}}]);