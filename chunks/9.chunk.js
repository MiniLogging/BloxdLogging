"use strict";(self["9d4d30r2sf"]=self["9d4d30r2sf"]||[]).push([[9],{12365:(o,v,V)=>{V.d(v,{d:()=>mo,f:()=>b,k:()=>u,i:()=>Y,o:()=>q});class g{constructor(){this.children=[]}isValid(o){return!0}process(o,v,V){let g="";if(this.line){let V=this.line;const h=v.processor;if(h){var E,I,Q,U,n,O;h.lineProcessor&&(V=h.lineProcessor(V,v.isFragment,v.processingContext));const g=(null===(E=v.processor)||void 0===E?void 0:E.attributeKeywordName)??"attribute",x=v.isFragment&&null!==(I=v.processor)&&void 0!==I&&I.varyingFragmentKeywordName?null===(Q=v.processor)||void 0===Q?void 0:Q.varyingFragmentKeywordName:!v.isFragment&&null!==(U=v.processor)&&void 0!==U&&U.varyingVertexKeywordName?null===(n=v.processor)||void 0===n?void 0:n.varyingVertexKeywordName:"varying";if(!v.isFragment&&h.attributeProcessor&&this.line.startsWith(g))V=h.attributeProcessor(this.line,o,v.processingContext);else if(h.varyingProcessor&&(null!==(O=h.varyingCheck)&&void 0!==O&&O.call(h,this.line,v.isFragment)||!h.varyingCheck&&this.line.startsWith(x)))V=h.varyingProcessor(this.line,v.isFragment,o,v.processingContext);else if(h.uniformProcessor&&h.uniformRegexp&&h.uniformRegexp.test(this.line))v.lookForClosingBracketForUniformBuffer||(V=h.uniformProcessor(this.line,v.isFragment,o,v.processingContext));else if(h.uniformBufferProcessor&&h.uniformBufferRegexp&&h.uniformBufferRegexp.test(this.line))v.lookForClosingBracketForUniformBuffer||(V=h.uniformBufferProcessor(this.line,v.isFragment,v.processingContext),v.lookForClosingBracketForUniformBuffer=!0);else if(h.textureProcessor&&h.textureRegexp&&h.textureRegexp.test(this.line))V=h.textureProcessor(this.line,v.isFragment,o,v.processingContext);else if((h.uniformProcessor||h.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!v.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?h.uniformProcessor&&(V=h.uniformProcessor(this.line,v.isFragment,o,v.processingContext)):h.uniformBufferProcessor&&(V=h.uniformBufferProcessor(this.line,v.isFragment,v.processingContext),v.lookForClosingBracketForUniformBuffer=!0)}v.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(v.lookForClosingBracketForUniformBuffer=!1,h.endOfUniformBufferProcessor&&(V=h.endOfUniformBufferProcessor(this.line,v.isFragment,v.processingContext)))}g+=V+"\n"}for(const h of this.children)g+=h.process(o,v,V);return this.additionalDefineKey&&(o[this.additionalDefineKey]=this.additionalDefineValue||"true",V[this.additionalDefineKey]=o[this.additionalDefineKey]),g}}class E{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(o){this._lines.length=0;for(const v of o){if(!v||"\r"===v)continue;if("#"===v[0]){this._lines.push(v);continue}const o=v.trim();if(!o)continue;if(o.startsWith("//")){this._lines.push(v);continue}const V=o.indexOf(";");if(-1===V)this._lines.push(o);else if(V===o.length-1)o.length>1&&this._lines.push(o);else{const o=v.split(";");for(let v=0;v<o.length;v++){let V=o[v];V&&(V=V.trim(),V&&this._lines.push(V+(v!==o.length-1?";":"")))}}}}}class I extends g{process(o,v,V){for(let g=0;g<this.children.length;g++){const E=this.children[g];if(E.isValid(o))return E.process(o,v,V)}return""}}class Q extends g{isValid(o){return this.testExpression.isTrue(o)}}class U{isTrue(o){return!0}static postfixToInfix(o){const v=[];for(const V of o)if(void 0===U._OperatorPriority[V])v.push(V);else{const o=v[v.length-1],g=v[v.length-2];v.length-=2,v.push(`(${g}${V}${o})`)}return v[v.length-1]}static infixToPostfix(o){const v=U._InfixToPostfixCache.get(o);if(v)return v.accessTime=Date.now(),v.result;if(!o.includes("&&")&&!o.includes("||")&&!o.includes(")")&&!o.includes("("))return[o];const V=[];let g=-1;const E=()=>{h=h.trim(),""!==h&&(V.push(h),h="")},I=o=>{g<U._Stack.length-1&&(U._Stack[++g]=o)},Q=()=>U._Stack[g],n=()=>-1===g?"!!INVALID EXPRESSION!!":U._Stack[g--];let O=0,h="";for(;O<o.length;){const v=o.charAt(O),x=O<o.length-1?o.substring(O,2+O):"";if("("===v)h="",I(v);else if(")"===v){for(E();-1!==g&&"("!==Q();)V.push(n());n()}else if(U._OperatorPriority[x]>1){for(E();-1!==g&&U._OperatorPriority[Q()]>=U._OperatorPriority[x];)V.push(n());I(x),O++}else h+=v;O++}for(E();-1!==g;)"("===Q()?n():V.push(n());return U._InfixToPostfixCache.size>=U.InfixToPostfixCacheLimitSize&&U.ClearCache(),U._InfixToPostfixCache.set(o,{result:V,accessTime:Date.now()}),V}static ClearCache(){const o=Array.from(U._InfixToPostfixCache.entries()).sort(((o,v)=>o[1].accessTime-v[1].accessTime));for(let v=0;v<U.InfixToPostfixCacheCleanupSize;v++)U._InfixToPostfixCache.delete(o[v][0])}}U.InfixToPostfixCacheLimitSize=5e4,U.InfixToPostfixCacheCleanupSize=25e3,U._InfixToPostfixCache=new Map,U._OperatorPriority={")":0,"(":1,"||":2,"&&":3},U._Stack=["","","","","","","","","","","","","","","","","","","",""];class n extends U{constructor(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=o,this.not=v}isTrue(o){let v=void 0!==o[this.define];return this.not&&(v=!v),v}}class O extends U{isTrue(o){return this.leftOperand.isTrue(o)||this.rightOperand.isTrue(o)}}class h extends U{isTrue(o){return this.leftOperand.isTrue(o)&&this.rightOperand.isTrue(o)}}class x extends U{constructor(o,v,V){super(),this.define=o,this.operand=v,this.testValue=V}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(o){let v=!1;const V=parseInt(void 0!=o[this.define]?o[this.define]:this.define),g=parseInt(void 0!=o[this.testValue]?o[this.testValue]:this.testValue);if(isNaN(V)||isNaN(g))return!1;switch(this.operand){case">":v=V>g;break;case"<":v=V<g;break;case"<=":v=V<=g;break;case">=":v=V>=g;break;case"==":v=V===g;break;case"!=":v=V!==g}return v}}var f=V(12325),l=V(12370);const S=/defined\s*?\((.+?)\)/g,T=/defined\s*?\[(.+?)\]/g,c=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,R=/__decl__/,j=/light\{X\}.(\w*)/g,t=/\{X\}/g,s=[],L=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function b(o){o.processor&&o.processor.initializeShaders&&o.processor.initializeShaders(o.processingContext)}function u(o,v,V,g){var E;null!==(E=v.processor)&&void 0!==E&&E.preProcessShaderCode&&(o=v.processor.preProcessShaderCode(o,v.isFragment)),Y(o,v,(o=>{v.processCodeAfterIncludes&&(o=v.processCodeAfterIncludes(v.isFragment?"fragment":"vertex",o,v.defines));const E=function(o,v,V){let g=function(o,v){var V;if(null!==(V=v.processor)&&void 0!==V&&V.noPrecision)return o;const g=v.shouldUseHighPrecisionShader;-1===o.indexOf("precision highp float")?o=g?"precision highp float;\n"+o:"precision mediump float;\n"+o:g||(o=o.replace("precision highp float","precision mediump float"));return o}(o,v);if(!v.processor)return g;if(0===v.processor.shaderLanguage&&-1!==g.indexOf("#version 3")&&(g=g.replace("#version 300 es",""),!v.processor.parseGLES3))return g;const E=v.defines,I=N(v,V);v.processor.preProcessor&&(g=v.processor.preProcessor(g,E,I,v.isFragment,v.processingContext));const Q={};g=d(g,I,v,Q),v.processor.postProcessor&&(g=v.processor.postProcessor(g,E,v.isFragment,v.processingContext,V?{drawBuffersExtensionDisabled:!V.getCaps().drawBuffersExtension}:{},I,Q));null!==V&&void 0!==V&&V._features.needShaderCodeInlining&&(g=V.inlineShaderCode(g));return g}(o,v,g);V(E,o)}))}function mo(o,v,V){return V.processor&&V.processor.finalizeShaders?V.processor.finalizeShaders(o,v,V.processingContext):{vertexCode:o,fragmentCode:v}}function a(o){const v=/defined\((.+)\)/.exec(o);if(v&&v.length)return new n(v[1].trim(),"!"===o[0]);const V=["==","!=",">=","<=","<",">"];let g="",E=0;for(g of V)if(E=o.indexOf(g),E>-1)break;if(-1===E)return new n(o);const I=o.substring(0,E).trim(),Q=o.substring(E+g.length).trim();return new x(I,g,Q)}function F(o,v){const V=new Q,g=o.substring(0,v);let E=o.substring(v);return E=E.substring(0,(E.indexOf("//")+1||E.length+1)-1).trim(),V.testExpression="#ifdef"===g?new n(E):"#ifndef"===g?new n(E,!0):function(o){o=o.replace(S,"defined[$1]");const v=U.infixToPostfix(o),V=[];for(const E of v)if("||"!==E&&"&&"!==E)V.push(E);else if(V.length>=2){let o=V[V.length-1],v=V[V.length-2];V.length-=2;const g="&&"==E?new h:new O;"string"===typeof o&&(o=o.replace(T,"defined($1)")),"string"===typeof v&&(v=v.replace(T,"defined($1)")),g.leftOperand="string"===typeof v?a(v):v,g.rightOperand="string"===typeof o?a(o):o,V.push(g)}let g=V[V.length-1];return"string"===typeof g&&(g=g.replace(T,"defined($1)")),"string"===typeof g?a(g):g}(E),V}function i(o,v,V,E){let I=o.currentLine;for(;J(o,V,E);){I=o.currentLine;const Q=I.substring(0,5).toLowerCase();if("#else"===Q){const V=new g;return v.children.push(V),void J(o,V,E)}if("#elif"===Q){const o=F(I,5);v.children.push(o),V=o}}}function J(o,v,V){for(;o.canRead;){o.lineIndex++;const E=o.currentLine;if(E.indexOf("#")>=0){const g=L.exec(E);if(g&&g.length){switch(g[0]){case"#ifdef":{const g=new I;v.children.push(g);const Q=F(E,6);g.children.push(Q),i(o,g,Q,V);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const g=new I;v.children.push(g);const Q=F(E,7);g.children.push(Q),i(o,g,Q,V);break}case"#if":{const g=new I,Q=F(E,3);v.children.push(g),g.children.push(Q),i(o,g,Q,V);break}}continue}}const Q=new g;if(Q.line=E,v.children.push(Q),"#"===E[0]&&"d"===E[1]){const o=E.replace(";","").split(" ");Q.additionalDefineKey=o[1],3===o.length&&(Q.additionalDefineValue=o[2])}}return!1}function d(o,v,V,I){const Q=new g,U=new E;return U.lineIndex=-1,U.lines=o.split("\n"),J(U,Q,I),Q.process(v,V,I)}function N(o,v){var V;const g=o.defines,E={};for(const I of g){const o=I.replace("#define","").replace(";","").trim().split(" ");E[o[0]]=o.length>1?o[1]:""}return 0===(null===(V=o.processor)||void 0===V?void 0:V.shaderLanguage)&&(E.GL_ES="true"),E.__VERSION__=o.version,E[o.platformName]="true",(0,l.h)(E,null===v||void 0===v?void 0:v.isNDCHalfZRange,null===v||void 0===v?void 0:v.Ug,null===v||void 0===v?void 0:v.useExactSrgbConversions),E}function Y(o,v,V){let g;for(s.length=0;null!==(g=c.exec(o));)s.push(g);let E=String(o),I=[o],Q=!1;for(const U of s){let o=U[1];if(-1!==o.indexOf("__decl__")&&(o=o.replace(R,""),v.supportsUniformBuffers&&(o=o.replace("Vertex","Ubo").replace("Fragment","Ubo")),o+="Declaration"),!v.includesShadersStore[o]){const g=v.shadersRepository+"ShadersInclude/"+o+".fx";return void q.loadFile(g,(g=>{v.includesShadersStore[o]=g,Y(I.join(""),v,V)}))}{let V=v.includesShadersStore[o];if(U[2]){const o=U[3].split(",");for(let v=0;v<o.length;v+=2){const g=new RegExp(o[v],"g"),E=o[v+1];V=V.replace(g,E)}}if(U[4]){const o=U[5];if(-1!==o.indexOf("..")){const g=o.split(".."),E=parseInt(g[0]);let I=parseInt(g[1]),Q=V.slice(0);V="",isNaN(I)&&(I=v.indexParameters[g[1]]);for(let o=E;o<I;o++)v.supportsUniformBuffers||(Q=Q.replace(j,((o,v)=>v+"{X}"))),V+=Q.replace(t,o.toString())+"\n"}else v.supportsUniformBuffers||(V=V.replace(j,((o,v)=>v+"{X}"))),V=V.replace(t,o)}const g=[];for(const o of I){const v=o.split(U[0]);for(let o=0;o<v.length-1;o++)g.push(v[o]),g.push(V);g.push(v[v.length-1])}I=g,Q=Q||V.indexOf("#include<")>=0||V.indexOf("#include <")>=0}}s.length=0,E=I.join(""),Q?Y(E.toString(),v,V):V(E)}const q={loadFile:(o,v,V,g,E,I)=>{throw(0,f.b)("FileTools")}}},12370:(o,v,V)=>{V.d(v,{d:()=>E,e:()=>I,h:()=>U,l:()=>Q,m:()=>n});var g=V(12325);V(12302);const E={};function I(o,v){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(v?v+"\n":"")+o}function Q(o,v,V,I,Q,U,n){const O=n||E.loadFile;if(O){return O(o,v,V,I,Q,U)}throw(0,g.b)("FileTools")}function U(o,v,V,g){if(o)return v?o.IS_NDC_HALF_ZRANGE="":delete o.IS_NDC_HALF_ZRANGE,V?o.USE_REVERSE_DEPTHBUFFER="":delete o.USE_REVERSE_DEPTHBUFFER,void(g?o.USE_EXACT_SRGB_CONVERSIONS="":delete o.USE_EXACT_SRGB_CONVERSIONS);{let o="";return v&&(o+="#define IS_NDC_HALF_ZRANGE"),V&&(o&&(o+="\n"),o+="#define USE_REVERSE_DEPTHBUFFER"),g&&(o&&(o+="\n"),o+="#define USE_EXACT_SRGB_CONVERSIONS"),o}}function n(o,v){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2],g=arguments.length>3?arguments[3]:void 0;switch(o){case 3:{const o=(ArrayBuffer,new Int8Array(v));return g&&o.set(new Int8Array(g)),o}case 0:{const o=(ArrayBuffer,new Uint8Array(v));return g&&o.set(new Uint8Array(g)),o}case 4:{const o=v instanceof ArrayBuffer?new Int16Array(v):new Int16Array(V?v/2:v);return g&&o.set(new Int16Array(g)),o}case 5:case 8:case 9:case 10:case 2:{const o=v instanceof ArrayBuffer?new Uint16Array(v):new Uint16Array(V?v/2:v);return g&&o.set(new Uint16Array(g)),o}case 6:{const o=v instanceof ArrayBuffer?new Int32Array(v):new Int32Array(V?v/4:v);return g&&o.set(new Int32Array(g)),o}case 7:case 11:case 12:case 13:case 14:case 15:{const o=v instanceof ArrayBuffer?new Uint32Array(v):new Uint32Array(V?v/4:v);return g&&o.set(new Uint32Array(g)),o}case 1:{const o=v instanceof ArrayBuffer?new Float32Array(v):new Float32Array(V?v/4:v);return g&&o.set(new Float32Array(g)),o}}const E=(ArrayBuffer,new Uint8Array(v));return g&&E.set(new Uint8Array(g)),E}},12396:(o,v,V)=>{V.d(v,{b:()=>g});class g{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?g.ShadersRepository:g.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?g.ShadersStore:g.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?g.IncludesShadersStore:g.IncludesShadersStoreWGSL}}g.ShadersRepository="src/Shaders/",g.ShadersStore={},g.IncludesShadersStore={},g.ShadersRepositoryWGSL="src/ShadersWGSL/",g.ShadersStoreWGSL={},g.IncludesShadersStoreWGSL={}},12408:(o,v,V)=>{V.d(v,{b:()=>f,d:()=>t,g:()=>S,h:()=>l,i:()=>T,m:()=>j,n:()=>x,r:()=>O,v:()=>h,w:()=>n,y:()=>U});class g{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.Tv._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(o){o&&this.program&&o(this.program)}setEngine(o){this.Tv=o}_fillEffectInformation(o,v,V,g,E,I,Q,U){const n=this.Tv;if(n.supportsUniformBuffers)for(const h in v)o.bindUniformBlock(h,v[h]);let O;for(this.Tv.getUniforms(this,V).forEach(((o,v)=>{g[V[v]]=o})),this._uniforms=g,O=0;O<E.length;O++){null==o.getUniform(E[O])&&(E.splice(O,1),O--)}E.forEach(((o,v)=>{I[o]=v}));for(const h of n.getAttributes(this,Q))U.push(h)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(o,v){const V=this._valueCache[o],g=v.updateFlag;return(void 0===V||V!==g)&&(this._valueCache[o]=g,!0)}_cacheFloat2(o,v,V){let g=this._valueCache[o];if(!g||2!==g.length)return g=[v,V],this._valueCache[o]=g,!0;let E=!1;return g[0]!==v&&(g[0]=v,E=!0),g[1]!==V&&(g[1]=V,E=!0),E}_cacheFloat3(o,v,V,g){let E=this._valueCache[o];if(!E||3!==E.length)return E=[v,V,g],this._valueCache[o]=E,!0;let I=!1;return E[0]!==v&&(E[0]=v,I=!0),E[1]!==V&&(E[1]=V,I=!0),E[2]!==g&&(E[2]=g,I=!0),I}_cacheFloat4(o,v,V,g,E){let I=this._valueCache[o];if(!I||4!==I.length)return I=[v,V,g,E],this._valueCache[o]=I,!0;let Q=!1;return I[0]!==v&&(I[0]=v,Q=!0),I[1]!==V&&(I[1]=V,Q=!0),I[2]!==g&&(I[2]=g,Q=!0),I[3]!==E&&(I[3]=E,Q=!0),Q}setInt(o,v){const V=this._valueCache[o];void 0!==V&&V===v||this.Tv.setInt(this._uniforms[o],v)&&(this._valueCache[o]=v)}setInt2(o,v,V){this._cacheFloat2(o,v,V)&&(this.Tv.setInt2(this._uniforms[o],v,V)||(this._valueCache[o]=null))}setInt3(o,v,V,g){this._cacheFloat3(o,v,V,g)&&(this.Tv.setInt3(this._uniforms[o],v,V,g)||(this._valueCache[o]=null))}setInt4(o,v,V,g,E){this._cacheFloat4(o,v,V,g,E)&&(this.Tv.setInt4(this._uniforms[o],v,V,g,E)||(this._valueCache[o]=null))}setIntArray(o,v){this._valueCache[o]=null,this.Tv.setIntArray(this._uniforms[o],v)}setIntArray2(o,v){this._valueCache[o]=null,this.Tv.setIntArray2(this._uniforms[o],v)}setIntArray3(o,v){this._valueCache[o]=null,this.Tv.setIntArray3(this._uniforms[o],v)}setIntArray4(o,v){this._valueCache[o]=null,this.Tv.setIntArray4(this._uniforms[o],v)}setUInt(o,v){const V=this._valueCache[o];void 0!==V&&V===v||this.Tv.setUInt(this._uniforms[o],v)&&(this._valueCache[o]=v)}setUInt2(o,v,V){this._cacheFloat2(o,v,V)&&(this.Tv.setUInt2(this._uniforms[o],v,V)||(this._valueCache[o]=null))}setUInt3(o,v,V,g){this._cacheFloat3(o,v,V,g)&&(this.Tv.setUInt3(this._uniforms[o],v,V,g)||(this._valueCache[o]=null))}setUInt4(o,v,V,g,E){this._cacheFloat4(o,v,V,g,E)&&(this.Tv.setUInt4(this._uniforms[o],v,V,g,E)||(this._valueCache[o]=null))}setUIntArray(o,v){this._valueCache[o]=null,this.Tv.setUIntArray(this._uniforms[o],v)}setUIntArray2(o,v){this._valueCache[o]=null,this.Tv.setUIntArray2(this._uniforms[o],v)}setUIntArray3(o,v){this._valueCache[o]=null,this.Tv.setUIntArray3(this._uniforms[o],v)}setUIntArray4(o,v){this._valueCache[o]=null,this.Tv.setUIntArray4(this._uniforms[o],v)}setArray(o,v){this._valueCache[o]=null,this.Tv.setArray(this._uniforms[o],v)}setArray2(o,v){this._valueCache[o]=null,this.Tv.setArray2(this._uniforms[o],v)}setArray3(o,v){this._valueCache[o]=null,this.Tv.setArray3(this._uniforms[o],v)}setArray4(o,v){this._valueCache[o]=null,this.Tv.setArray4(this._uniforms[o],v)}setMatrices(o,v){v&&(this._valueCache[o]=null,this.Tv.setMatrices(this._uniforms[o],v))}setMatrix(o,v){this._cacheMatrix(o,v)&&(this.Tv.setMatrices(this._uniforms[o],v.Dg())||(this._valueCache[o]=null))}setMatrix3x3(o,v){this._valueCache[o]=null,this.Tv.setMatrix3x3(this._uniforms[o],v)}setMatrix2x2(o,v){this._valueCache[o]=null,this.Tv.setMatrix2x2(this._uniforms[o],v)}setFloat(o,v){const V=this._valueCache[o];void 0!==V&&V===v||this.Tv.setFloat(this._uniforms[o],v)&&(this._valueCache[o]=v)}setVector2(o,v){this._cacheFloat2(o,v.x,v.y)&&(this.Tv.setFloat2(this._uniforms[o],v.x,v.y)||(this._valueCache[o]=null))}setFloat2(o,v,V){this._cacheFloat2(o,v,V)&&(this.Tv.setFloat2(this._uniforms[o],v,V)||(this._valueCache[o]=null))}setVector3(o,v){this._cacheFloat3(o,v.x,v.y,v.z)&&(this.Tv.setFloat3(this._uniforms[o],v.x,v.y,v.z)||(this._valueCache[o]=null))}setFloat3(o,v,V,g){this._cacheFloat3(o,v,V,g)&&(this.Tv.setFloat3(this._uniforms[o],v,V,g)||(this._valueCache[o]=null))}setVector4(o,v){this._cacheFloat4(o,v.x,v.y,v.z,v.w)&&(this.Tv.setFloat4(this._uniforms[o],v.x,v.y,v.z,v.w)||(this._valueCache[o]=null))}setQuaternion(o,v){this._cacheFloat4(o,v.x,v.y,v.z,v.w)&&(this.Tv.setFloat4(this._uniforms[o],v.x,v.y,v.z,v.w)||(this._valueCache[o]=null))}setFloat4(o,v,V,g,E){this._cacheFloat4(o,v,V,g,E)&&(this.Tv.setFloat4(this._uniforms[o],v,V,g,E)||(this._valueCache[o]=null))}setColor3(o,v){this._cacheFloat3(o,v.r,v.g,v.b)&&(this.Tv.setFloat3(this._uniforms[o],v.r,v.g,v.b)||(this._valueCache[o]=null))}setColor4(o,v,V){this._cacheFloat4(o,v.r,v.g,v.b,V)&&(this.Tv.setFloat4(this._uniforms[o],v.r,v.g,v.b,V)||(this._valueCache[o]=null))}setDirectColor4(o,v){this._cacheFloat4(o,v.r,v.g,v.b,v.a)&&(this.Tv.setFloat4(this._uniforms[o],v.r,v.g,v.b,v.a)||(this._valueCache[o]=null))}_getVertexShaderCode(){return this.vertexShader?this.Tv._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.Tv._getShaderSource(this.fragmentShader):null}}var E=V(12370);const I=new WeakMap,Q={_webGLVersion:2,cachedPipelines:{}};function U(o){let v=I.get(o);if(!v){if(!o)return Q;v={_webGLVersion:o.TEXTURE_BINDING_3D?2:1,_context:o,parallelShaderCompile:o.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},I.set(o,v)}return v}function n(o){I.delete(o)}function O(o,v,V,g,E,I){const Q=U(g);I||(I=Q._createShaderProgramInjection??f);return I(o,R(v,"vertex",g,Q._contextWasLost),R(V,"fragment",g,Q._contextWasLost),g,E,Q.validateShaderPrograms)}function h(o,v,V,g,E){let I=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6?arguments[6]:void 0;const n=U(E);Q||(Q=n._createShaderProgramInjection??f);const O=n._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return Q(o,c(v,"vertex",g,O,E,n._contextWasLost),c(V,"fragment",g,O,E,n._contextWasLost),E,I,n.validateShaderPrograms)}function x(o,v){const V=new g,E=U(o);return E.parallelShaderCompile&&!E.disableParallelShaderCompile&&(V.isParallelCompiled=!0),V.context=E._context,V}function f(o,v,V,g){let E=arguments.length>5?arguments[5]:void 0;const I=g.createProgram();if(o.program=I,!I)throw new Error("Unable to create program");return g.attachShader(I,v),g.attachShader(I,V),g.linkProgram(I),o.context=g,o.vertexShader=v,o.fragmentShader=V,o.isParallelCompiled||S(o,g,E),I}function l(o,v,V){const g=o;if(g._isDisposed)return!1;const E=U(v);return!!(E&&E.parallelShaderCompile&&E.parallelShaderCompile.COMPLETION_STATUS_KHR&&g.program&&v.getProgramParameter(g.program,E.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(S(g,v,V),!0)}function S(o,v,V){const g=o.context,E=o.vertexShader,I=o.fragmentShader,Q=o.program;if(!g.getProgramParameter(Q,g.LINK_STATUS)){if(!v.getShaderParameter(E,v.COMPILE_STATUS)){const V=v.getShaderInfoLog(E);if(V)throw o.vertexCompilationError=V,new Error("VERTEX SHADER "+V)}if(!v.getShaderParameter(I,v.COMPILE_STATUS)){const V=v.getShaderInfoLog(I);if(V)throw o.fragmentCompilationError=V,new Error("FRAGMENT SHADER "+V)}const V=g.getProgramInfoLog(Q);if(V)throw o.programLinkError=V,new Error(V)}if(V){g.validateProgram(Q);if(!g.getProgramParameter(Q,g.VALIDATE_STATUS)){const v=g.getProgramInfoLog(Q);if(v)throw o.programValidationError=v,new Error(v)}}g.deleteShader(E),g.deleteShader(I),o.vertexShader=void 0,o.fragmentShader=void 0,o.onCompiled&&(o.onCompiled(),o.onCompiled=void 0)}function T(o,v,V,g,E,I,Q,n,x){let f=arguments.length>10?arguments[10]:void 0,l=arguments.length>11?arguments[11]:void 0,S=arguments.length>12?arguments[12]:void 0;const T=U(o.context);l||(l=T.createRawShaderProgramInjection??O),S||(S=T.createShaderProgramInjection??h);const c=o;c.program=g?l(c,v,V,c.context,x):S(c,v,V,n,c.context,x),c.program.__SPECTOR_rebuildProgram=Q,f()}function c(o,v,V,g,I,Q){return R((0,E.e)(o,V,g),v,I,Q)}function R(o,v,V,g){const E=V.createShader("vertex"===v?V.VERTEX_SHADER:V.FRAGMENT_SHADER);if(!E){let o=V.NO_ERROR,E=V.NO_ERROR;for(;(E=V.getError())!==V.NO_ERROR;)o=E;throw new Error(`Something went wrong while creating a gl ${v} shader object. gl error=${o}, gl isContextLost=${V.isContextLost()}, _contextWasLost=${g}`)}return V.shaderSource(E,o),V.compileShader(E),E}function j(o,v){v.useProgram(o)}function t(o,v){const V=o;if(!V.isParallelCompiled)return void v(o);const g=V.onCompiled;V.onCompiled=()=>{null===g||void 0===g||g(),v(o)}}},12405:(o,v,V)=>{V.d(v,{c:()=>x,g:()=>l,h:()=>O,j:()=>h});var g=V(12302),E=V(12408),I=V(12396),Q=V(12308),U=V(12365),n=V(12370);function O(o,v){return(0,E.y)(v).cachedPipelines[o]}function h(o){const v=o._name,V=o.context;if(v&&V){const o=(0,E.y)(V),g=o.cachedPipelines[v];null===g||void 0===g||g.dispose(),delete o.cachedPipelines[v]}}function x(o,v,V,E,I,Q,n){let O,h;const x=(0,g.n)()?null===Q||void 0===Q?void 0:Q.getHostDocument():null;O="string"===typeof v?v:v.vertexSource?"source:"+v.vertexSource:v.vertexElement?(null===x||void 0===x?void 0:x.getElementById(v.vertexElement))||v.vertexElement:v.vertex||v,h="string"===typeof v?v:v.fragmentSource?"source:"+v.fragmentSource:v.fragmentElement?(null===x||void 0===x?void 0:x.getElementById(v.fragmentElement))||v.fragmentElement:v.fragment||v;const l=[void 0,void 0],S=()=>{if(l[0]&&l[1]){o.isFragment=!0;const[g,O]=l;(0,U.k)(O,o,((Q,O)=>{n&&(n._fragmentSourceCodeBeforeMigration=O),V&&(Q=V("fragment",Q));const h=(0,U.d)(g,Q,o);o=null;const x=function(o,v,V,g){if(V){return{vertexSourceCode:(1===g?"//":"")+"#define SHADER_NAME vertex:"+(V.vertexElement||V.vertex||V.spectorName||V)+"\n"+o,fragmentSourceCode:(1===g?"//":"")+"#define SHADER_NAME fragment:"+(V.fragmentElement||V.fragment||V.spectorName||V)+"\n"+v}}return{vertexSourceCode:o,fragmentSourceCode:v}}(h.vertexCode,h.fragmentCode,v,I);null===E||void 0===E||E(x.vertexSourceCode,x.fragmentSourceCode)}),Q)}};f(O,"Vertex","",(v=>{(0,U.f)(o),(0,U.k)(v,o,((o,g)=>{n&&(n._rawVertexSourceCode=v,n._vertexSourceCodeBeforeMigration=g),V&&(o=V("vertex",o)),l[0]=o,S()}),Q)}),I),f(h,"Fragment","Pixel",(o=>{n&&(n._rawFragmentSourceCode=o),l[1]=o,S()}),I)}function f(o,v,V,E,Q,U){if("undefined"!==typeof HTMLElement&&o instanceof HTMLElement){return void E((0,g.d)(o))}if("source:"===o.substring(0,7))return void E(o.substring(7));if("base64:"===o.substring(0,7)){return void E(window.atob(o.substring(7)))}const O=I.b.GetShadersStore(Q);if(O[o+v+"Shader"])return void E(O[o+v+"Shader"]);if(V&&O[o+V+"Shader"])return void E(O[o+V+"Shader"]);let h;if(h="."===o[0]||"/"===o[0]||o.indexOf("http")>-1?o:I.b.GetShadersRepository(Q)+o,!(U=U||n.l))throw new Error("loadFileInjection is not defined");U(h+"."+v.toLowerCase()+".fx",E)}const l=(o,v,V,g)=>{try{const I=o.context?(0,E.y)(o.context):null;I&&(I.disableParallelShaderCompile=o.disableParallelCompilation);const Q=o.existingPipelineContext||v(o.shaderProcessingContext);return Q._name=o.name,o.name&&I&&(I.cachedPipelines[o.name]=Q),V(Q,o.vertex,o.fragment,!!o.createAsRaw,"","",o.rebuildRebind,o.defines,o.transformFeedbackVaryings,"",(()=>{g(Q,(()=>{var v;null===(v=o.onRenderingStateCompiled)||void 0===v||v.call(o,Q)}))})),Q}catch(I){throw Q.b.Error("Error compiling effect"),I}}},12390:(o,v,V)=>{V.r(v),V.d(v,{Effect:()=>n});var g=V(12297),E=V(12308),I=V(12396),Q=V(12405),U=V(12374);class n{static get ShadersRepository(){return I.b.ShadersRepository}static set ShadersRepository(o){I.b.ShadersRepository=o}get l(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new g.e),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(o,v,V){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,I=arguments.length>4?arguments[4]:void 0,U=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,f=arguments.length>9?arguments[9]:void 0,l=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",S=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,T=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new g.e,this.onErrorObservable=new g.e,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=o,this._key=l;const c=this._key.replace(/\r/g,"").replace(/\n/g,"|");let R;if(v.attributes){const o=v;if(this._engine=V,this._attributesNames=o.attributes,this._uniformsNames=o.uniformsNames.concat(o.samplers),this._samplerList=o.samplers.slice(),this.defines=o.defines,this.onError=o.onError,this.onCompiled=o.onCompiled,this._fallbacks=o.fallbacks,this._indexParameters=o.indexParameters,this._transformFeedbackVaryings=o.transformFeedbackVaryings||null,this._multiTarget=!!o.multiTarget,this._shaderLanguage=o.shaderLanguage??0,this._disableParallelShaderCompilation=!!o.disableParallelShaderCompilation,o.uniformBuffersNames){this._uniformBuffersNamesList=o.uniformBuffersNames.slice();for(let v=0;v<o.uniformBuffersNames.length;v++)this._uniformBuffersNames[o.uniformBuffersNames[v]]=v}this._processFinalCode=o.processFinalCode??null,this._processCodeAfterIncludes=o.processCodeAfterIncludes??void 0,T=o.extraInitializationsAsync,R=o.existingPipelineContext}else this._engine=I,this.defines=null==U?"":U,this._uniformsNames=V.concat(E),this._samplerList=E?E.slice():[],this._attributesNames=v,this._uniformBuffersNamesList=[],this._shaderLanguage=S,this.onError=x,this.onCompiled=h,this._indexParameters=f,this._fallbacks=O;"WEBGL2"===this._engine.shaderPlatformName&&(R=(0,Q.h)(c,this._engine._gl)??R),this._attributeLocationByName={},this.uniqueId=n._UniqueIdSeed++,R?(this._pipelineContext=R,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,T),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.l||this.dispose(!0)}))}async _processShaderCodeAsync(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,g=arguments.length>3?arguments[3]:void 0;g&&await g(),this._processingContext=V||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const E={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:o??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:I.b.GetShadersRepository(this._shaderLanguage),includesShadersStore:I.b.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,Ug:this._engine.Ug,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,Q.c)(E,this.name,this._processFinalCode,((o,V)=>{this._vertexSourceCode=o,this._fragmentSourceCode=V,this._prepareEffect(v)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.l||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(o){return this._attributes[o]}getAttributeLocationByName(o){return this._attributeLocationByName[o]}getAttributesCount(){return this._attributes.length}getUniformIndex(o){return this._uniformsNames.indexOf(o)}getUniform(o){return this._uniforms[o]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((o=>{this.executeWhenCompiled(o)}))}executeWhenCompiled(o){this.isReady()?o(this):(this.onCompileObservable.add((v=>{o(v)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(o){(0,U.d)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(v=>{this._processCompilationErrors(v,o)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var o;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(o=this._pipelineContext)||void 0===o?void 0:o._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var o;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(o=this._pipelineContext)||void 0===o?void 0:o._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,Ug:this._engine.Ug,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(o,v,V,g){this._isReady=!1,this._vertexSourceCodeOverride=o,this._fragmentSourceCodeOverride=v,this.onError=(o,v)=>{g&&g(v)},this.onCompiled=()=>{var o,v;const g=this.getEngine().scenes;if(g)for(let V=0;V<g.length;V++)g[V].markAllMaterialsAsDirty(127);null===(o=(v=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===o||o.call(v,V)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(o){if(this._pipelineContext=o,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let v=0;v<this._attributesNames.length;v++){const o=this._attributesNames[v];this._attributeLocationByName[o]=this._attributes[v]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),n.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const v=this._pipelineContext;this._isReady=!1;try{const V=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),g=V?null:this.defines,E=V?this._vertexSourceCodeOverride:this._vertexSourceCode,I=V?this._fragmentSourceCodeOverride:this._fragmentSourceCode,U=this._engine;this._pipelineContext=(0,Q.g)({existingPipelineContext:o?v:null,vertex:E,fragment:I,context:"WEBGL2"===U.shaderPlatformName||"WEBGL1"===U.shaderPlatformName?U._gl:void 0,rebuildRebind:(o,v,V,g)=>this._rebuildProgram(o,v,V,g),defines:g,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:V,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:V=>{v&&!o&&this._engine._deletePipelineContext(v),V&&this._onRenderingStateCompiled(V)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(v)}catch(V){this._processCompilationErrors(V,v)}}_getShaderCodeAndErrorLine(o,v,V){const g=V?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let E=null;if(v&&o){const I=v.match(g);if(I&&2===I.length){const v=parseInt(I[1]),g=o.split("\n",-1);g.length>=v&&(E=`Offending line [${v}] in ${V?"fragment":"vertex"} code: ${g[v-1]}`)}}return[o,E]}_processCompilationErrors(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=o.message;const V=this._attributesNames,g=this._fallbacks;if(E.b.Error("Unable to compile effect:"),E.b.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),E.b.Error(`Attributes: ${V.join(" ")}`),E.b.Error("Defines:\n"+this.defines),n.LogShaderCodeOnCompilationError){var I,Q;let o=null,v=null,V=null;var U;if(null!==(I=this._pipelineContext)&&void 0!==I&&I._getVertexShaderCode()&&([V,o]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),V&&(E.b.Error("Vertex code:"),E.b.Error(V))),null!==(Q=this._pipelineContext)&&void 0!==Q&&Q._getFragmentShaderCode())[V,v]=this._getShaderCodeAndErrorLine(null===(U=this._pipelineContext)||void 0===U?void 0:U._getFragmentShaderCode(),this._compilationError,!0),V&&(E.b.Error("Fragment code:"),E.b.Error(V));o&&E.b.Error(o),v&&E.b.Error(v)}E.b.Error("Error: "+this._compilationError);const O=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};v&&(this._pipelineContext=v,this._isReady=!0,O()),g?(this._pipelineContext=null,g.hasMoreFallbacks?(this._allFallbacksProcessed=!1,E.b.Error("Trying next fallback."),this.defines=g.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,O(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,v||O())}get isSupported(){return""===this._compilationError}_bindTexture(o,v){this._engine._bindTexture(this._samplers[o],v,o)}setTexture(o,v){this._engine.setTexture(this._samplers[o],this._uniforms[o],v,o)}setTextureArray(o,v){const V=o+"Ex";if(-1===this._samplerList.indexOf(V+"0")){const g=this._samplerList.indexOf(o);for(let o=1;o<v.length;o++){const v=V+(o-1).toString();this._samplerList.splice(g+o,0,v)}let E=0;for(const o of this._samplerList)this._samplers[o]=E,E+=1}this._engine.setTextureArray(this._samplers[o],this._uniforms[o],v,o)}bindUniformBuffer(o,v){const V=this._uniformBuffersNames[v];void 0===V||n._BaseCache[V]===o&&this._engine._features.useUBOBindingCache||(n._BaseCache[V]=o,this._engine.bindUniformBufferBase(o,V,v))}bindUniformBlock(o,v){this._engine.bindUniformBlock(this._pipelineContext,o,v)}setInt(o,v){return this._pipelineContext.setInt(o,v),this}setInt2(o,v,V){return this._pipelineContext.setInt2(o,v,V),this}setInt3(o,v,V,g){return this._pipelineContext.setInt3(o,v,V,g),this}setInt4(o,v,V,g,E){return this._pipelineContext.setInt4(o,v,V,g,E),this}setIntArray(o,v){return this._pipelineContext.setIntArray(o,v),this}setIntArray2(o,v){return this._pipelineContext.setIntArray2(o,v),this}setIntArray3(o,v){return this._pipelineContext.setIntArray3(o,v),this}setIntArray4(o,v){return this._pipelineContext.setIntArray4(o,v),this}setUInt(o,v){return this._pipelineContext.setUInt(o,v),this}setUInt2(o,v,V){return this._pipelineContext.setUInt2(o,v,V),this}setUInt3(o,v,V,g){return this._pipelineContext.setUInt3(o,v,V,g),this}setUInt4(o,v,V,g,E){return this._pipelineContext.setUInt4(o,v,V,g,E),this}setUIntArray(o,v){return this._pipelineContext.setUIntArray(o,v),this}setUIntArray2(o,v){return this._pipelineContext.setUIntArray2(o,v),this}setUIntArray3(o,v){return this._pipelineContext.setUIntArray3(o,v),this}setUIntArray4(o,v){return this._pipelineContext.setUIntArray4(o,v),this}setFloatArray(o,v){return this._pipelineContext.setArray(o,v),this}setFloatArray2(o,v){return this._pipelineContext.setArray2(o,v),this}setFloatArray3(o,v){return this._pipelineContext.setArray3(o,v),this}setFloatArray4(o,v){return this._pipelineContext.setArray4(o,v),this}setArray(o,v){return this._pipelineContext.setArray(o,v),this}setArray2(o,v){return this._pipelineContext.setArray2(o,v),this}setArray3(o,v){return this._pipelineContext.setArray3(o,v),this}setArray4(o,v){return this._pipelineContext.setArray4(o,v),this}setMatrices(o,v){return this._pipelineContext.setMatrices(o,v),this}setMatrix(o,v){return this._pipelineContext.setMatrix(o,v),this}setMatrix3x3(o,v){return this._pipelineContext.setMatrix3x3(o,v),this}setMatrix2x2(o,v){return this._pipelineContext.setMatrix2x2(o,v),this}setFloat(o,v){return this._pipelineContext.setFloat(o,v),this}setBool(o,v){return this._pipelineContext.setInt(o,v?1:0),this}setVector2(o,v){return this._pipelineContext.setVector2(o,v),this}setFloat2(o,v,V){return this._pipelineContext.setFloat2(o,v,V),this}setVector3(o,v){return this._pipelineContext.setVector3(o,v),this}setFloat3(o,v,V,g){return this._pipelineContext.setFloat3(o,v,V,g),this}setVector4(o,v){return this._pipelineContext.setVector4(o,v),this}setQuaternion(o,v){return this._pipelineContext.setQuaternion(o,v),this}setFloat4(o,v,V,g,E){return this._pipelineContext.setFloat4(o,v,V,g,E),this}setColor3(o,v){return this._pipelineContext.setColor3(o,v),this}setColor4(o,v,V){return this._pipelineContext.setColor4(o,v,V),this}setDirectColor4(o,v){return this._pipelineContext.setDirectColor4(o,v),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(n.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,Q.j)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(o,v,V){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;v&&(I.b.GetShadersStore(g)[`${o}PixelShader`]=v),V&&(I.b.GetShadersStore(g)[`${o}VertexShader`]=V)}static ResetCache(){n._BaseCache={}}}n.LogShaderCodeOnCompilationError=!0,n.PersistentMode=!1,n.AutomaticallyClearCodeCache=!1,n._UniqueIdSeed=0,n._BaseCache={},n.ShadersStore=I.b.ShadersStore,n.IncludesShadersStore=I.b.IncludesShadersStore},12325:(o,v,V)=>{V.d(v,{b:()=>E});const g={};function E(o){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!g[o])return g[o]=!0,`${o} needs to be imported before as it contains a side-effect required by your code.`}},12302:(o,v,V)=>{function g(){return"undefined"!==typeof window}function E(){return"undefined"!==typeof navigator}function I(){return"undefined"!==typeof document}function Q(o){let v="",V=o.firstChild;for(;V;)3===V.nodeType&&(v+=V.textContent),V=V.nextSibling;return v}V.d(v,{d:()=>Q,f:()=>I,j:()=>E,n:()=>g})},12308:(o,v,V)=>{V.d(v,{b:()=>g});class g{static _CheckLimit(o,v){let V=g._LogLimitOutputs[o];return V?V.current++:(V={limit:v,current:1},g._LogLimitOutputs[o]=V),V.current<=V.limit}static _GenerateLimitMessage(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const V=g._LogLimitOutputs[o];if(!V||!g.MessageLimitReached)return;const E=this._Levels[v];V.current===V.limit&&g[E.name](g.MessageLimitReached.replace(/%LIMIT%/g,""+V.limit).replace(/%TYPE%/g,E.name??""))}static _AddLogEntry(o){g._LogCache=o+g._LogCache,g.OnNewCacheEntry&&g.OnNewCacheEntry(o)}static _FormatMessage(o){const v=o=>o<10?"0"+o:""+o,V=new Date;return"["+v(V.getHours())+":"+v(V.getMinutes())+":"+v(V.getSeconds())+"]: "+o}static _LogDisabled(o,v){}static _LogEnabled(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1?arguments[1]:void 0,V=arguments.length>2?arguments[2]:void 0;const E=Array.isArray(v)?v[0]:v;if(void 0!==V&&!g._CheckLimit(E,V))return;const I=g._FormatMessage(E),Q=this._Levels[o],U=Array.isArray(v)?v.slice(1):[];Q.logFunc&&Q.logFunc("BJS - "+I,...U);const n=`<div style='color:${Q.color}'>${I}</div><br>`;g._AddLogEntry(n),g._GenerateLimitMessage(E,o)}static get LogCache(){return g._LogCache}static ClearLogCache(){g._LogCache="",g._LogLimitOutputs={},g.errorsCount=0}static set LogLevels(o){g.Log=g._LogDisabled,g.Warn=g._LogDisabled,g.Error=g._LogDisabled;const v=[g.MessageLogLevel,g.WarningLogLevel,g.ErrorLogLevel];for(const V of v)if((o&V)===V){const o=this._Levels[V];g[o.name]=g._LogEnabled.bind(g,V)}}}g.NoneLogLevel=0,g.MessageLogLevel=1,g.WarningLogLevel=2,g.ErrorLogLevel=4,g.AllLogLevel=7,g.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",g._LogCache="",g._LogLimitOutputs={},g._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],g.errorsCount=0,g.Log=g._LogEnabled.bind(g,g.MessageLogLevel),g.Warn=g._LogEnabled.bind(g,g.WarningLogLevel),g.Error=g._LogEnabled.bind(g,g.ErrorLogLevel)},12297:(o,v,V)=>{V.d(v,{e:()=>Q});const g="undefined"!==typeof WeakRef;class E{constructor(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2?arguments[2]:void 0,g=arguments.length>3?arguments[3]:void 0;this.initialize(o,v,V,g)}initialize(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],V=arguments.length>2?arguments[2]:void 0,g=arguments.length>3?arguments[3]:void 0;return this.mask=o,this.skipNextObservers=v,this.target=V,this.currentTarget=g,this}}class I{constructor(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=o,this.mask=v,this.scope=V,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(o)}}class Q{static FromPromise(o,v){const V=new Q;return o.then((o=>{V.notifyObservers(o)})).catch((o=>{if(!v)throw o;v.notifyObservers(o)})),V}get observers(){return this._observers}constructor(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=v,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new E(0),o&&(this._onObserverAdded=o)}add(o){let v=arguments.length>2&&void 0!==arguments[2]&&arguments[2],V=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!o)return null;const E=new I(o,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);E.unregisterOnNextCall=V,v?this._observers.unshift(E):this._observers.push(E),this._onObserverAdded&&this._onObserverAdded(E),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(E,this._lastNotifiedValue);const Q=g?new WeakRef(this):{deref:()=>this};return E._remove=function(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const v=Q.deref();v&&(o?v.remove(E):v._remove(E))},E}addOnce(o){return this.add(o,void 0,void 0,void 0,!0)}remove(o){if(!o)return!1;o._remove=null;return-1!==this._observers.indexOf(o)&&(this._deferUnregister(o),!0)}removeCallback(o,v){for(let V=0;V<this._observers.length;V++){const g=this._observers[V];if(!g._willBeUnregistered&&(g.callback===o&&(!v||v===g.scope)))return this._deferUnregister(g),!0}return!1}_deferUnregister(o){o._willBeUnregistered||(this._numObserversMarkedAsDeleted++,o.unregisterOnNextCall=!1,o._willBeUnregistered=!0,setTimeout((()=>{this._remove(o)}),0))}_remove(o){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!o)return!1;const V=this._observers.indexOf(o);return-1!==V&&(v&&this._numObserversMarkedAsDeleted--,this._observers.splice(V,1),!0)}makeObserverTopPriority(o){this._remove(o,!1),this._observers.unshift(o)}makeObserverBottomPriority(o){this._remove(o,!1),this._observers.push(o)}notifyObservers(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,V=arguments.length>2?arguments[2]:void 0,g=arguments.length>3?arguments[3]:void 0,E=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=o),!this._observers.length)return!0;const I=this._eventState;I.mask=v,I.target=V,I.currentTarget=g,I.skipNextObservers=!1,I.lastReturnValue=o,I.userInfo=E;for(const Q of this._observers)if(!Q._willBeUnregistered&&(Q.mask&v&&(Q.unregisterOnNextCall&&this._deferUnregister(Q),Q.scope?I.lastReturnValue=Q.callback.apply(Q.scope,[o,I]):I.lastReturnValue=Q.callback(o,I)),I.skipNextObservers))return!1;return!0}notifyObserver(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=v),o._willBeUnregistered)return;const g=this._eventState;g.mask=V,g.skipNextObservers=!1,o.unregisterOnNextCall&&this._deferUnregister(o),o.callback(v,g)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const o=this._observers.pop();o&&(o._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const o=new Q;return o._observers=this._observers.slice(0),o}hasSpecificMask(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const v of this._observers)if(v.mask&o||v.mask===o)return!0;return!1}}},12374:(o,v,V)=>{V.d(v,{b:()=>E,d:()=>Q});let g=[];class E{static SetImmediate(o){0===g.length&&setTimeout((()=>{const o=g;g=[];for(const v of o)v()}),1),g.push(o)}}function I(o,v,V){try{if(o())return v(),!0}catch(g){return null===V||void 0===V||V(g),!0}return!1}const Q=function(o,v,V){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,Q=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&I(o,v,V))return null;const U=setInterval((()=>{I(o,v,V)?clearInterval(U):(E-=g,E<0&&(clearInterval(U),null===V||void 0===V||V(new Error("Operation timed out after maximum retries. "+(Q||"")),!0)))}),g);return()=>clearInterval(U)}}}]);