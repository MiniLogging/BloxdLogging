"use strict";(self.ra6kpa9z1sg=self.ra6kpa9z1sg||[]).push([[9],{12673:(p,b,M)=>{M.d(b,{b:()=>e,f:()=>L,l:()=>u,h:()=>q,m:()=>B});class h{constructor(){this.children=[]}isValid(p){return!0}process(p,b,M){let h="";if(this.line){let M=this.line;const z=b.processor;if(z){var Q,mp,y,P,w,t;z.lineProcessor&&(M=z.lineProcessor(M,b.isFragment,b.processingContext));const h=(null===(Q=b.processor)||void 0===Q?void 0:Q.attributeKeywordName)??"attribute",x=b.isFragment&&null!==(mp=b.processor)&&void 0!==mp&&mp.varyingFragmentKeywordName?null===(y=b.processor)||void 0===y?void 0:y.varyingFragmentKeywordName:!b.isFragment&&null!==(P=b.processor)&&void 0!==P&&P.varyingVertexKeywordName?null===(w=b.processor)||void 0===w?void 0:w.varyingVertexKeywordName:"varying";if(!b.isFragment&&z.attributeProcessor&&this.line.startsWith(h))M=z.attributeProcessor(this.line,p,b.processingContext);else if(z.varyingProcessor&&(null!==(t=z.varyingCheck)&&void 0!==t&&t.call(z,this.line,b.isFragment)||!z.varyingCheck&&this.line.startsWith(x)))M=z.varyingProcessor(this.line,b.isFragment,p,b.processingContext);else if(z.uniformProcessor&&z.uniformRegexp&&z.uniformRegexp.test(this.line))b.lookForClosingBracketForUniformBuffer||(M=z.uniformProcessor(this.line,b.isFragment,p,b.processingContext));else if(z.uniformBufferProcessor&&z.uniformBufferRegexp&&z.uniformBufferRegexp.test(this.line))b.lookForClosingBracketForUniformBuffer||(M=z.uniformBufferProcessor(this.line,b.isFragment,b.processingContext),b.lookForClosingBracketForUniformBuffer=!0);else if(z.textureProcessor&&z.textureRegexp&&z.textureRegexp.test(this.line))M=z.textureProcessor(this.line,b.isFragment,p,b.processingContext);else if((z.uniformProcessor||z.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!b.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?z.uniformProcessor&&(M=z.uniformProcessor(this.line,b.isFragment,p,b.processingContext)):z.uniformBufferProcessor&&(M=z.uniformBufferProcessor(this.line,b.isFragment,b.processingContext),b.lookForClosingBracketForUniformBuffer=!0)}b.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(b.lookForClosingBracketForUniformBuffer=!1,z.endOfUniformBufferProcessor&&(M=z.endOfUniformBufferProcessor(this.line,b.isFragment,b.processingContext)))}h+=M+"\n"}for(const z of this.children)h+=z.process(p,b,M);return this.additionalDefineKey&&(p[this.additionalDefineKey]=this.additionalDefineValue||"true",M[this.additionalDefineKey]=p[this.additionalDefineKey]),h}}class Q{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(p){this._lines.length=0;for(const b of p){if(!b||"\r"===b)continue;if("#"===b[0]){this._lines.push(b);continue}const p=b.trim();if(!p)continue;if(p.startsWith("//")){this._lines.push(b);continue}const M=p.indexOf(";");if(-1===M)this._lines.push(p);else if(M===p.length-1)p.length>1&&this._lines.push(p);else{const p=b.split(";");for(let b=0;b<p.length;b++){let M=p[b];M&&(M=M.trim(),M&&this._lines.push(M+(b!==p.length-1?";":"")))}}}}}class mp extends h{process(p,b,M){for(let h=0;h<this.children.length;h++){const Q=this.children[h];if(Q.isValid(p))return Q.process(p,b,M)}return""}}class y extends h{isValid(p){return this.testExpression.isTrue(p)}}class P{isTrue(p){return!0}static postfixToInfix(p){const b=[];for(const M of p)if(void 0===P._OperatorPriority[M])b.push(M);else{const p=b[b.length-1],h=b[b.length-2];b.length-=2,b.push(`(${h}${M}${p})`)}return b[b.length-1]}static infixToPostfix(p){const b=P._InfixToPostfixCache.get(p);if(b)return b.accessTime=Date.now(),b.result;if(!p.includes("&&")&&!p.includes("||")&&!p.includes(")")&&!p.includes("("))return[p];const M=[];let h=-1;const Q=()=>{z=z.trim(),""!==z&&(M.push(z),z="")},mp=p=>{h<P._Stack.length-1&&(P._Stack[++h]=p)},y=()=>P._Stack[h],w=()=>-1===h?"!!INVALID EXPRESSION!!":P._Stack[h--];let t=0,z="";for(;t<p.length;){const b=p.charAt(t),x=t<p.length-1?p.substring(t,2+t):"";if("("===b)z="",mp(b);else if(")"===b){for(Q();-1!==h&&"("!==y();)M.push(w());w()}else if(P._OperatorPriority[x]>1){for(Q();-1!==h&&P._OperatorPriority[y()]>=P._OperatorPriority[x];)M.push(w());mp(x),t++}else z+=b;t++}for(Q();-1!==h;)"("===y()?w():M.push(w());return P._InfixToPostfixCache.size>=P.InfixToPostfixCacheLimitSize&&P.ClearCache(),P._InfixToPostfixCache.set(p,{result:M,accessTime:Date.now()}),M}static ClearCache(){const p=Array.from(P._InfixToPostfixCache.entries()).sort(((p,b)=>p[1].accessTime-b[1].accessTime));for(let b=0;b<P.InfixToPostfixCacheCleanupSize;b++)P._InfixToPostfixCache.delete(p[b][0])}}P.InfixToPostfixCacheLimitSize=5e4,P.InfixToPostfixCacheCleanupSize=25e3,P._InfixToPostfixCache=new Map,P._OperatorPriority={")":0,"(":1,"||":2,"&&":3},P._Stack=["","","","","","","","","","","","","","","","","","","",""];class w extends P{constructor(p){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=p,this.not=b}isTrue(p){let b=void 0!==p[this.define];return this.not&&(b=!b),b}}class t extends P{isTrue(p){return this.leftOperand.isTrue(p)||this.rightOperand.isTrue(p)}}class z extends P{isTrue(p){return this.leftOperand.isTrue(p)&&this.rightOperand.isTrue(p)}}class x extends P{constructor(p,b,M){super(),this.define=p,this.operand=b,this.testValue=M}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(p){let b=!1;const M=parseInt(void 0!=p[this.define]?p[this.define]:this.define),h=parseInt(void 0!=p[this.testValue]?p[this.testValue]:this.testValue);if(isNaN(M)||isNaN(h))return!1;switch(this.operand){case">":b=M>h;break;case"<":b=M<h;break;case"<=":b=M<=h;break;case">=":b=M>=h;break;case"==":b=M===h;break;case"!=":b=M!==h}return b}}var S=M(12635),X=M(12676);const c=/defined\s*?\((.+?)\)/g,J=/defined\s*?\[(.+?)\]/g,g=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,f=/__decl__/,Y=/light\{X\}.(\w*)/g,a=/\{X\}/g,o=[],l=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function L(p){p.processor&&p.processor.initializeShaders&&p.processor.initializeShaders(p.processingContext)}function u(p,b,M,h){var Q;null!==(Q=b.processor)&&void 0!==Q&&Q.preProcessShaderCode&&(p=b.processor.preProcessShaderCode(p,b.isFragment)),q(p,b,(p=>{b.processCodeAfterIncludes&&(p=b.processCodeAfterIncludes(b.isFragment?"fragment":"vertex",p,b.defines));const Q=function(p,b,M){let h=function(p,b){var M;if(null!==(M=b.processor)&&void 0!==M&&M.noPrecision)return p;const h=b.shouldUseHighPrecisionShader;-1===p.indexOf("precision highp float")?p=h?"precision highp float;\n"+p:"precision mediump float;\n"+p:h||(p=p.replace("precision highp float","precision mediump float"));return p}(p,b);if(!b.processor)return h;if(0===b.processor.shaderLanguage&&-1!==h.indexOf("#version 3")&&(h=h.replace("#version 300 es",""),!b.processor.parseGLES3))return h;const Q=b.defines,mp=U(b,M);b.processor.preProcessor&&(h=b.processor.preProcessor(h,Q,mp,b.isFragment,b.processingContext));const y={};h=Z(h,mp,b,y),b.processor.postProcessor&&(h=b.processor.postProcessor(h,Q,b.isFragment,b.processingContext,M?{drawBuffersExtensionDisabled:!M.getCaps().drawBuffersExtension}:{},mp,y));null!==M&&void 0!==M&&M._features.needShaderCodeInlining&&(h=M.inlineShaderCode(h));return h}(p,b,h);M(Q,p)}))}function e(p,b,M){return M.processor&&M.processor.finalizeShaders?M.processor.finalizeShaders(p,b,M.processingContext):{vertexCode:p,fragmentCode:b}}function d(p){const b=/defined\((.+)\)/.exec(p);if(b&&b.length)return new w(b[1].trim(),"!"===p[0]);const M=["==","!=",">=","<=","<",">"];let h="",Q=0;for(h of M)if(Q=p.indexOf(h),Q>-1)break;if(-1===Q)return new w(p);const mp=p.substring(0,Q).trim(),y=p.substring(Q+h.length).trim();return new x(mp,h,y)}function I(p,b){const M=new y,h=p.substring(0,b);let Q=p.substring(b);return Q=Q.substring(0,(Q.indexOf("//")+1||Q.length+1)-1).trim(),M.testExpression="#ifdef"===h?new w(Q):"#ifndef"===h?new w(Q,!0):function(p){p=p.replace(c,"defined[$1]");const b=P.infixToPostfix(p),M=[];for(const Q of b)if("||"!==Q&&"&&"!==Q)M.push(Q);else if(M.length>=2){let p=M[M.length-1],b=M[M.length-2];M.length-=2;const h="&&"==Q?new z:new t;"string"===typeof p&&(p=p.replace(J,"defined($1)")),"string"===typeof b&&(b=b.replace(J,"defined($1)")),h.leftOperand="string"===typeof b?d(b):b,h.rightOperand="string"===typeof p?d(p):p,M.push(h)}let h=M[M.length-1];return"string"===typeof h&&(h=h.replace(J,"defined($1)")),"string"===typeof h?d(h):h}(Q),M}function G(p,b,M,Q){let mp=p.currentLine;for(;v(p,M,Q);){mp=p.currentLine;const y=mp.substring(0,5).toLowerCase();if("#else"===y){const M=new h;return b.children.push(M),void v(p,M,Q)}if("#elif"===y){const p=I(mp,5);b.children.push(p),M=p}}}function v(p,b,M){for(;p.canRead;){p.lineIndex++;const Q=p.currentLine;if(Q.indexOf("#")>=0){const h=l.exec(Q);if(h&&h.length){switch(h[0]){case"#ifdef":{const h=new mp;b.children.push(h);const y=I(Q,6);h.children.push(y),G(p,h,y,M);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const h=new mp;b.children.push(h);const y=I(Q,7);h.children.push(y),G(p,h,y,M);break}case"#if":{const h=new mp,y=I(Q,3);b.children.push(h),h.children.push(y),G(p,h,y,M);break}}continue}}const y=new h;if(y.line=Q,b.children.push(y),"#"===Q[0]&&"d"===Q[1]){const p=Q.replace(";","").split(" ");y.additionalDefineKey=p[1],3===p.length&&(y.additionalDefineValue=p[2])}}return!1}function Z(p,b,M,mp){const y=new h,P=new Q;return P.lineIndex=-1,P.lines=p.split("\n"),v(P,y,mp),y.process(b,M,mp)}function U(p,b){var M;const h=p.defines,Q={};for(const mp of h){const p=mp.replace("#define","").replace(";","").trim().split(" ");Q[p[0]]=p.length>1?p[1]:""}return 0===(null===(M=p.processor)||void 0===M?void 0:M.shaderLanguage)&&(Q.GL_ES="true"),Q.__VERSION__=p.version,Q[p.platformName]="true",(0,X.j)(Q,null===b||void 0===b?void 0:b.isNDCHalfZRange,null===b||void 0===b?void 0:b.zb,null===b||void 0===b?void 0:b.useExactSrgbConversions),Q}function q(p,b,M){let h;for(o.length=0;null!==(h=g.exec(p));)o.push(h);let Q=String(p),mp=[p],y=!1;for(const P of o){let p=P[1];if(-1!==p.indexOf("__decl__")&&(p=p.replace(f,""),b.supportsUniformBuffers&&(p=p.replace("Vertex","Ubo").replace("Fragment","Ubo")),p+="Declaration"),!b.includesShadersStore[p]){const h=b.shadersRepository+"ShadersInclude/"+p+".fx";return void B.loadFile(h,(h=>{b.includesShadersStore[p]=h,q(mp.join(""),b,M)}))}{let M=b.includesShadersStore[p];if(P[2]){const p=P[3].split(",");for(let b=0;b<p.length;b+=2){const h=new RegExp(p[b],"g"),Q=p[b+1];M=M.replace(h,Q)}}if(P[4]){const p=P[5];if(-1!==p.indexOf("..")){const h=p.split(".."),Q=parseInt(h[0]);let mp=parseInt(h[1]),y=M.slice(0);M="",isNaN(mp)&&(mp=b.indexParameters[h[1]]);for(let p=Q;p<mp;p++)b.supportsUniformBuffers||(y=y.replace(Y,((p,b)=>b+"{X}"))),M+=y.replace(a,p.toString())+"\n"}else b.supportsUniformBuffers||(M=M.replace(Y,((p,b)=>b+"{X}"))),M=M.replace(a,p)}const h=[];for(const p of mp){const b=p.split(P[0]);for(let p=0;p<b.length-1;p++)h.push(b[p]),h.push(M);h.push(b[b.length-1])}mp=h,y=y||M.indexOf("#include<")>=0||M.indexOf("#include <")>=0}}o.length=0,Q=mp.join(""),y?q(Q.toString(),b,M):M(Q)}const B={loadFile:(p,b,M,h,Q,mp)=>{throw(0,S.b)("FileTools")}}},12676:(p,b,M)=>{M.d(b,{d:()=>Q,g:()=>mp,j:()=>P,k:()=>y,o:()=>w});var h=M(12635);M(12620);const Q={};function mp(p,b){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(b?b+"\n":"")+p}function y(p,b,M,mp,y,P,w){const t=w||Q.loadFile;if(t){return t(p,b,M,mp,y,P)}throw(0,h.b)("FileTools")}function P(p,b,M,h){if(p)return b?p.IS_NDC_HALF_ZRANGE="":delete p.IS_NDC_HALF_ZRANGE,M?p.USE_REVERSE_DEPTHBUFFER="":delete p.USE_REVERSE_DEPTHBUFFER,void(h?p.USE_EXACT_SRGB_CONVERSIONS="":delete p.USE_EXACT_SRGB_CONVERSIONS);{let p="";return b&&(p+="#define IS_NDC_HALF_ZRANGE"),M&&(p&&(p+="\n"),p+="#define USE_REVERSE_DEPTHBUFFER"),h&&(p&&(p+="\n"),p+="#define USE_EXACT_SRGB_CONVERSIONS"),p}}function w(p,b){let M=arguments.length>2&&void 0!==arguments[2]&&arguments[2],h=arguments.length>3?arguments[3]:void 0;switch(p){case 3:{const p=(ArrayBuffer,new Int8Array(b));return h&&p.set(new Int8Array(h)),p}case 0:{const p=(ArrayBuffer,new Uint8Array(b));return h&&p.set(new Uint8Array(h)),p}case 4:{const p=b instanceof ArrayBuffer?new Int16Array(b):new Int16Array(M?b/2:b);return h&&p.set(new Int16Array(h)),p}case 5:case 8:case 9:case 10:case 2:{const p=b instanceof ArrayBuffer?new Uint16Array(b):new Uint16Array(M?b/2:b);return h&&p.set(new Uint16Array(h)),p}case 6:{const p=b instanceof ArrayBuffer?new Int32Array(b):new Int32Array(M?b/4:b);return h&&p.set(new Int32Array(h)),p}case 7:case 11:case 12:case 13:case 14:case 15:{const p=b instanceof ArrayBuffer?new Uint32Array(b):new Uint32Array(M?b/4:b);return h&&p.set(new Uint32Array(h)),p}case 1:{const p=b instanceof ArrayBuffer?new Float32Array(b):new Float32Array(M?b/4:b);return h&&p.set(new Float32Array(h)),p}}const Q=(ArrayBuffer,new Uint8Array(b));return h&&Q.set(new Uint8Array(h)),Q}},12695:(p,b,M)=>{M.d(b,{d:()=>h});class h{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?h.ShadersRepository:h.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?h.ShadersStore:h.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?h.IncludesShadersStore:h.IncludesShadersStoreWGSL}}h.ShadersRepository="src/Shaders/",h.ShadersStore={},h.IncludesShadersStore={},h.ShadersRepositoryWGSL="src/ShadersWGSL/",h.ShadersStoreWGSL={},h.IncludesShadersStoreWGSL={}},12701:(p,b,M)=>{M.d(b,{c:()=>S,g:()=>a,i:()=>c,j:()=>X,n:()=>J,o:()=>Y,s:()=>x,w:()=>t,A:()=>z,E:()=>w,I:()=>P});class h{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.hM._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(p){p&&this.program&&p(this.program)}setEngine(p){this.hM=p}_fillEffectInformation(p,b,M,h,Q,mp,y,P){const w=this.hM;if(w.supportsUniformBuffers)for(const z in b)p.bindUniformBlock(z,b[z]);let t;for(this.hM.getUniforms(this,M).forEach(((p,b)=>{h[M[b]]=p})),this._uniforms=h,t=0;t<Q.length;t++){null==p.getUniform(Q[t])&&(Q.splice(t,1),t--)}Q.forEach(((p,b)=>{mp[p]=b}));for(const z of w.getAttributes(this,y))P.push(z)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(p,b){const M=this._valueCache[p],h=b.updateFlag;return(void 0===M||M!==h)&&(this._valueCache[p]=h,!0)}_cacheFloat2(p,b,M){let h=this._valueCache[p];if(!h||2!==h.length)return h=[b,M],this._valueCache[p]=h,!0;let Q=!1;return h[0]!==b&&(h[0]=b,Q=!0),h[1]!==M&&(h[1]=M,Q=!0),Q}_cacheFloat3(p,b,M,h){let Q=this._valueCache[p];if(!Q||3!==Q.length)return Q=[b,M,h],this._valueCache[p]=Q,!0;let mp=!1;return Q[0]!==b&&(Q[0]=b,mp=!0),Q[1]!==M&&(Q[1]=M,mp=!0),Q[2]!==h&&(Q[2]=h,mp=!0),mp}_cacheFloat4(p,b,M,h,Q){let mp=this._valueCache[p];if(!mp||4!==mp.length)return mp=[b,M,h,Q],this._valueCache[p]=mp,!0;let y=!1;return mp[0]!==b&&(mp[0]=b,y=!0),mp[1]!==M&&(mp[1]=M,y=!0),mp[2]!==h&&(mp[2]=h,y=!0),mp[3]!==Q&&(mp[3]=Q,y=!0),y}setInt(p,b){const M=this._valueCache[p];void 0!==M&&M===b||this.hM.setInt(this._uniforms[p],b)&&(this._valueCache[p]=b)}setInt2(p,b,M){this._cacheFloat2(p,b,M)&&(this.hM.setInt2(this._uniforms[p],b,M)||(this._valueCache[p]=null))}setInt3(p,b,M,h){this._cacheFloat3(p,b,M,h)&&(this.hM.setInt3(this._uniforms[p],b,M,h)||(this._valueCache[p]=null))}setInt4(p,b,M,h,Q){this._cacheFloat4(p,b,M,h,Q)&&(this.hM.setInt4(this._uniforms[p],b,M,h,Q)||(this._valueCache[p]=null))}setIntArray(p,b){this._valueCache[p]=null,this.hM.setIntArray(this._uniforms[p],b)}setIntArray2(p,b){this._valueCache[p]=null,this.hM.setIntArray2(this._uniforms[p],b)}setIntArray3(p,b){this._valueCache[p]=null,this.hM.setIntArray3(this._uniforms[p],b)}setIntArray4(p,b){this._valueCache[p]=null,this.hM.setIntArray4(this._uniforms[p],b)}setUInt(p,b){const M=this._valueCache[p];void 0!==M&&M===b||this.hM.setUInt(this._uniforms[p],b)&&(this._valueCache[p]=b)}setUInt2(p,b,M){this._cacheFloat2(p,b,M)&&(this.hM.setUInt2(this._uniforms[p],b,M)||(this._valueCache[p]=null))}setUInt3(p,b,M,h){this._cacheFloat3(p,b,M,h)&&(this.hM.setUInt3(this._uniforms[p],b,M,h)||(this._valueCache[p]=null))}setUInt4(p,b,M,h,Q){this._cacheFloat4(p,b,M,h,Q)&&(this.hM.setUInt4(this._uniforms[p],b,M,h,Q)||(this._valueCache[p]=null))}setUIntArray(p,b){this._valueCache[p]=null,this.hM.setUIntArray(this._uniforms[p],b)}setUIntArray2(p,b){this._valueCache[p]=null,this.hM.setUIntArray2(this._uniforms[p],b)}setUIntArray3(p,b){this._valueCache[p]=null,this.hM.setUIntArray3(this._uniforms[p],b)}setUIntArray4(p,b){this._valueCache[p]=null,this.hM.setUIntArray4(this._uniforms[p],b)}setArray(p,b){this._valueCache[p]=null,this.hM.setArray(this._uniforms[p],b)}setArray2(p,b){this._valueCache[p]=null,this.hM.setArray2(this._uniforms[p],b)}setArray3(p,b){this._valueCache[p]=null,this.hM.setArray3(this._uniforms[p],b)}setArray4(p,b){this._valueCache[p]=null,this.hM.setArray4(this._uniforms[p],b)}setMatrices(p,b){b&&(this._valueCache[p]=null,this.hM.setMatrices(this._uniforms[p],b))}setMatrix(p,b){this._cacheMatrix(p,b)&&(this.hM.setMatrices(this._uniforms[p],b.ub())||(this._valueCache[p]=null))}setMatrix3x3(p,b){this._valueCache[p]=null,this.hM.setMatrix3x3(this._uniforms[p],b)}setMatrix2x2(p,b){this._valueCache[p]=null,this.hM.setMatrix2x2(this._uniforms[p],b)}setFloat(p,b){const M=this._valueCache[p];void 0!==M&&M===b||this.hM.setFloat(this._uniforms[p],b)&&(this._valueCache[p]=b)}setVector2(p,b){this._cacheFloat2(p,b.x,b.y)&&(this.hM.setFloat2(this._uniforms[p],b.x,b.y)||(this._valueCache[p]=null))}setFloat2(p,b,M){this._cacheFloat2(p,b,M)&&(this.hM.setFloat2(this._uniforms[p],b,M)||(this._valueCache[p]=null))}setVector3(p,b){this._cacheFloat3(p,b.x,b.y,b.z)&&(this.hM.setFloat3(this._uniforms[p],b.x,b.y,b.z)||(this._valueCache[p]=null))}setFloat3(p,b,M,h){this._cacheFloat3(p,b,M,h)&&(this.hM.setFloat3(this._uniforms[p],b,M,h)||(this._valueCache[p]=null))}setVector4(p,b){this._cacheFloat4(p,b.x,b.y,b.z,b.w)&&(this.hM.setFloat4(this._uniforms[p],b.x,b.y,b.z,b.w)||(this._valueCache[p]=null))}setQuaternion(p,b){this._cacheFloat4(p,b.x,b.y,b.z,b.w)&&(this.hM.setFloat4(this._uniforms[p],b.x,b.y,b.z,b.w)||(this._valueCache[p]=null))}setFloat4(p,b,M,h,Q){this._cacheFloat4(p,b,M,h,Q)&&(this.hM.setFloat4(this._uniforms[p],b,M,h,Q)||(this._valueCache[p]=null))}setColor3(p,b){this._cacheFloat3(p,b.r,b.g,b.b)&&(this.hM.setFloat3(this._uniforms[p],b.r,b.g,b.b)||(this._valueCache[p]=null))}setColor4(p,b,M){this._cacheFloat4(p,b.r,b.g,b.b,M)&&(this.hM.setFloat4(this._uniforms[p],b.r,b.g,b.b,M)||(this._valueCache[p]=null))}setDirectColor4(p,b){this._cacheFloat4(p,b.r,b.g,b.b,b.a)&&(this.hM.setFloat4(this._uniforms[p],b.r,b.g,b.b,b.a)||(this._valueCache[p]=null))}_getVertexShaderCode(){return this.vertexShader?this.hM._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.hM._getShaderSource(this.fragmentShader):null}}var Q=M(12676);const mp=new WeakMap,y={_webGLVersion:2,cachedPipelines:{}};function P(p){let b=mp.get(p);if(!b){if(!p)return y;b={_webGLVersion:p.TEXTURE_BINDING_3D?2:1,_context:p,parallelShaderCompile:p.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},mp.set(p,b)}return b}function w(p){mp.delete(p)}function t(p,b,M,h,Q,mp){const y=P(h);mp||(mp=y._createShaderProgramInjection??S);return mp(p,f(b,"vertex",h,y._contextWasLost),f(M,"fragment",h,y._contextWasLost),h,Q,y.validateShaderPrograms)}function z(p,b,M,h,Q){let mp=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6?arguments[6]:void 0;const w=P(Q);y||(y=w._createShaderProgramInjection??S);const t=w._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return y(p,g(b,"vertex",h,t,Q,w._contextWasLost),g(M,"fragment",h,t,Q,w._contextWasLost),Q,mp,w.validateShaderPrograms)}function x(p,b){const M=new h,Q=P(p);return Q.parallelShaderCompile&&!Q.disableParallelShaderCompile&&(M.isParallelCompiled=!0),M.context=Q._context,M}function S(p,b,M,h){let Q=arguments.length>5?arguments[5]:void 0;const mp=h.createProgram();if(p.program=mp,!mp)throw new Error("Unable to create program");return h.attachShader(mp,b),h.attachShader(mp,M),h.linkProgram(mp),p.context=h,p.vertexShader=b,p.fragmentShader=M,p.isParallelCompiled||c(p,h,Q),mp}function X(p,b,M){const h=p;if(h._isDisposed)return!1;const Q=P(b);return!!(Q&&Q.parallelShaderCompile&&Q.parallelShaderCompile.COMPLETION_STATUS_KHR&&h.program&&b.getProgramParameter(h.program,Q.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(c(h,b,M),!0)}function c(p,b,M){const h=p.context,Q=p.vertexShader,mp=p.fragmentShader,y=p.program;if(!h.getProgramParameter(y,h.LINK_STATUS)){if(!b.getShaderParameter(Q,b.COMPILE_STATUS)){const M=b.getShaderInfoLog(Q);if(M)throw p.vertexCompilationError=M,new Error("VERTEX SHADER "+M)}if(!b.getShaderParameter(mp,b.COMPILE_STATUS)){const M=b.getShaderInfoLog(mp);if(M)throw p.fragmentCompilationError=M,new Error("FRAGMENT SHADER "+M)}const M=h.getProgramInfoLog(y);if(M)throw p.programLinkError=M,new Error(M)}if(M){h.validateProgram(y);if(!h.getProgramParameter(y,h.VALIDATE_STATUS)){const b=h.getProgramInfoLog(y);if(b)throw p.programValidationError=b,new Error(b)}}h.deleteShader(Q),h.deleteShader(mp),p.vertexShader=void 0,p.fragmentShader=void 0,p.onCompiled&&(p.onCompiled(),p.onCompiled=void 0)}function J(p,b,M,h,Q,mp,y,w,x){let S=arguments.length>10?arguments[10]:void 0,X=arguments.length>11?arguments[11]:void 0,c=arguments.length>12?arguments[12]:void 0;const J=P(p.context);X||(X=J.createRawShaderProgramInjection??t),c||(c=J.createShaderProgramInjection??z);const g=p;g.program=h?X(g,b,M,g.context,x):c(g,b,M,w,g.context,x),g.program.__SPECTOR_rebuildProgram=y,S()}function g(p,b,M,h,mp,y){return f((0,Q.g)(p,M,h),b,mp,y)}function f(p,b,M,h){const Q=M.createShader("vertex"===b?M.VERTEX_SHADER:M.FRAGMENT_SHADER);if(!Q){let p=M.NO_ERROR,Q=M.NO_ERROR;for(;(Q=M.getError())!==M.NO_ERROR;)p=Q;throw new Error(`Something went wrong while creating a gl ${b} shader object. gl error=${p}, gl isContextLost=${M.isContextLost()}, _contextWasLost=${h}`)}return M.shaderSource(Q,p),M.compileShader(Q),Q}function Y(p,b){b.useProgram(p)}function a(p,b){const M=p;if(!M.isParallelCompiled)return void b(p);const h=M.onCompiled;M.onCompiled=()=>{null===h||void 0===h||h(),b(p)}}},12698:(p,b,M)=>{M.d(b,{e:()=>x,i:()=>X,j:()=>t,n:()=>z});var h=M(12620),Q=M(12701),mp=M(12695),y=M(12622),P=M(12673),w=M(12676);function t(p,b){return(0,Q.I)(b).cachedPipelines[p]}function z(p){const b=p._name,M=p.context;if(b&&M){const p=(0,Q.I)(M),h=p.cachedPipelines[b];null===h||void 0===h||h.dispose(),delete p.cachedPipelines[b]}}function x(p,b,M,Q,mp,y,w){let t,z;const x=(0,h.o)()?null===y||void 0===y?void 0:y.getHostDocument():null;t="string"===typeof b?b:b.vertexSource?"source:"+b.vertexSource:b.vertexElement?(null===x||void 0===x?void 0:x.getElementById(b.vertexElement))||b.vertexElement:b.vertex||b,z="string"===typeof b?b:b.fragmentSource?"source:"+b.fragmentSource:b.fragmentElement?(null===x||void 0===x?void 0:x.getElementById(b.fragmentElement))||b.fragmentElement:b.fragment||b;const X=[void 0,void 0],c=()=>{if(X[0]&&X[1]){p.isFragment=!0;const[h,t]=X;(0,P.l)(t,p,((y,t)=>{w&&(w._fragmentSourceCodeBeforeMigration=t),M&&(y=M("fragment",y));const z=(0,P.b)(h,y,p);p=null;const x=function(p,b,M,h){if(M){return{vertexSourceCode:(1===h?"//":"")+"#define SHADER_NAME vertex:"+(M.vertexElement||M.vertex||M.spectorName||M)+"\n"+p,fragmentSourceCode:(1===h?"//":"")+"#define SHADER_NAME fragment:"+(M.fragmentElement||M.fragment||M.spectorName||M)+"\n"+b}}return{vertexSourceCode:p,fragmentSourceCode:b}}(z.vertexCode,z.fragmentCode,b,mp);null===Q||void 0===Q||Q(x.vertexSourceCode,x.fragmentSourceCode)}),y)}};S(t,"Vertex","",(b=>{(0,P.f)(p),(0,P.l)(b,p,((p,h)=>{w&&(w._rawVertexSourceCode=b,w._vertexSourceCodeBeforeMigration=h),M&&(p=M("vertex",p)),X[0]=p,c()}),y)}),mp),S(z,"Fragment","Pixel",(p=>{w&&(w._rawFragmentSourceCode=p),X[1]=p,c()}),mp)}function S(p,b,M,Q,y,P){if("undefined"!==typeof HTMLElement&&p instanceof HTMLElement){return void Q((0,h.c)(p))}if("source:"===p.substring(0,7))return void Q(p.substring(7));if("base64:"===p.substring(0,7)){return void Q(window.atob(p.substring(7)))}const t=mp.d.GetShadersStore(y);if(t[p+b+"Shader"])return void Q(t[p+b+"Shader"]);if(M&&t[p+M+"Shader"])return void Q(t[p+M+"Shader"]);let z;if(z="."===p[0]||"/"===p[0]||p.indexOf("http")>-1?p:mp.d.GetShadersRepository(y)+p,!(P=P||w.k))throw new Error("loadFileInjection is not defined");P(z+"."+b.toLowerCase()+".fx",Q)}const X=(p,b,M,h)=>{try{const mp=p.context?(0,Q.I)(p.context):null;mp&&(mp.disableParallelShaderCompile=p.disableParallelCompilation);const y=p.existingPipelineContext||b(p.shaderProcessingContext);return y._name=p.name,p.name&&mp&&(mp.cachedPipelines[p.name]=y),M(y,p.vertex,p.fragment,!!p.createAsRaw,"","",p.rebuildRebind,p.defines,p.transformFeedbackVaryings,"",(()=>{h(y,(()=>{var b;null===(b=p.onRenderingStateCompiled)||void 0===b||b.call(p,y)}))})),y}catch(mp){throw y.d.Error("Error compiling effect"),mp}}},12687:(p,b,M)=>{M.r(b),M.d(b,{Effect:()=>w});var h=M(12617),Q=M(12622),mp=M(12695),y=M(12698),P=M(12680);class w{static get ShadersRepository(){return mp.d.ShadersRepository}static set ShadersRepository(p){mp.d.ShadersRepository=p}get S(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new h.d),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(p,b,M){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,mp=arguments.length>4?arguments[4]:void 0,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,S=arguments.length>9?arguments[9]:void 0,X=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",c=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,J=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new h.d,this.onErrorObservable=new h.d,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=p,this._key=X;const g=this._key.replace(/\r/g,"").replace(/\n/g,"|");let f;if(b.attributes){const p=b;if(this._engine=M,this._attributesNames=p.attributes,this._uniformsNames=p.uniformsNames.concat(p.samplers),this._samplerList=p.samplers.slice(),this.defines=p.defines,this.onError=p.onError,this.onCompiled=p.onCompiled,this._fallbacks=p.fallbacks,this._indexParameters=p.indexParameters,this._transformFeedbackVaryings=p.transformFeedbackVaryings||null,this._multiTarget=!!p.multiTarget,this._shaderLanguage=p.shaderLanguage??0,this._disableParallelShaderCompilation=!!p.disableParallelShaderCompilation,p.uniformBuffersNames){this._uniformBuffersNamesList=p.uniformBuffersNames.slice();for(let b=0;b<p.uniformBuffersNames.length;b++)this._uniformBuffersNames[p.uniformBuffersNames[b]]=b}this._processFinalCode=p.processFinalCode??null,this._processCodeAfterIncludes=p.processCodeAfterIncludes??void 0,J=p.extraInitializationsAsync,f=p.existingPipelineContext}else this._engine=mp,this.defines=null==P?"":P,this._uniformsNames=M.concat(Q),this._samplerList=Q?Q.slice():[],this._attributesNames=b,this._uniformBuffersNamesList=[],this._shaderLanguage=c,this.onError=x,this.onCompiled=z,this._indexParameters=S,this._fallbacks=t;"WEBGL2"===this._engine.shaderPlatformName&&(f=(0,y.j)(g,this._engine._gl)??f),this._attributeLocationByName={},this.uniqueId=w._UniqueIdSeed++,f?(this._pipelineContext=f,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,J),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.S||this.dispose(!0)}))}async _processShaderCodeAsync(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,h=arguments.length>3?arguments[3]:void 0;h&&await h(),this._processingContext=M||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const Q={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:p??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:mp.d.GetShadersRepository(this._shaderLanguage),includesShadersStore:mp.d.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,zb:this._engine.zb,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,y.e)(Q,this.name,this._processFinalCode,((p,M)=>{this._vertexSourceCode=p,this._fragmentSourceCode=M,this._prepareEffect(b)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.S||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(p){return this._attributes[p]}getAttributeLocationByName(p){return this._attributeLocationByName[p]}getAttributesCount(){return this._attributes.length}getUniformIndex(p){return this._uniformsNames.indexOf(p)}getUniform(p){return this._uniforms[p]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((p=>{this.executeWhenCompiled(p)}))}executeWhenCompiled(p){this.isReady()?p(this):(this.onCompileObservable.add((b=>{p(b)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(p){(0,P.g)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(b=>{this._processCompilationErrors(b,p)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var p;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(p=this._pipelineContext)||void 0===p?void 0:p._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var p;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(p=this._pipelineContext)||void 0===p?void 0:p._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,zb:this._engine.zb,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(p,b,M,h){this._isReady=!1,this._vertexSourceCodeOverride=p,this._fragmentSourceCodeOverride=b,this.onError=(p,b)=>{h&&h(b)},this.onCompiled=()=>{var p,b;const h=this.getEngine().scenes;if(h)for(let M=0;M<h.length;M++)h[M].markAllMaterialsAsDirty(127);null===(p=(b=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===p||p.call(b,M)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(p){if(this._pipelineContext=p,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let b=0;b<this._attributesNames.length;b++){const p=this._attributesNames[b];this._attributeLocationByName[p]=this._attributes[b]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),w.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let p=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b=this._pipelineContext;this._isReady=!1;try{const M=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),h=M?null:this.defines,Q=M?this._vertexSourceCodeOverride:this._vertexSourceCode,mp=M?this._fragmentSourceCodeOverride:this._fragmentSourceCode,P=this._engine;this._pipelineContext=(0,y.i)({existingPipelineContext:p?b:null,vertex:Q,fragment:mp,context:"WEBGL2"===P.shaderPlatformName||"WEBGL1"===P.shaderPlatformName?P._gl:void 0,rebuildRebind:(p,b,M,h)=>this._rebuildProgram(p,b,M,h),defines:h,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:M,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:M=>{b&&!p&&this._engine._deletePipelineContext(b),M&&this._onRenderingStateCompiled(M)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(b)}catch(M){this._processCompilationErrors(M,b)}}_getShaderCodeAndErrorLine(p,b,M){const h=M?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let Q=null;if(b&&p){const mp=b.match(h);if(mp&&2===mp.length){const b=parseInt(mp[1]),h=p.split("\n",-1);h.length>=b&&(Q=`Offending line [${b}] in ${M?"fragment":"vertex"} code: ${h[b-1]}`)}}return[p,Q]}_processCompilationErrors(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=p.message;const M=this._attributesNames,h=this._fallbacks;if(Q.d.Error("Unable to compile effect:"),Q.d.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),Q.d.Error(`Attributes: ${M.join(" ")}`),Q.d.Error("Defines:\n"+this.defines),w.LogShaderCodeOnCompilationError){var mp,y;let p=null,b=null,M=null;var P;if(null!==(mp=this._pipelineContext)&&void 0!==mp&&mp._getVertexShaderCode()&&([M,p]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),M&&(Q.d.Error("Vertex code:"),Q.d.Error(M))),null!==(y=this._pipelineContext)&&void 0!==y&&y._getFragmentShaderCode())[M,b]=this._getShaderCodeAndErrorLine(null===(P=this._pipelineContext)||void 0===P?void 0:P._getFragmentShaderCode(),this._compilationError,!0),M&&(Q.d.Error("Fragment code:"),Q.d.Error(M));p&&Q.d.Error(p),b&&Q.d.Error(b)}Q.d.Error("Error: "+this._compilationError);const t=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};b&&(this._pipelineContext=b,this._isReady=!0,t()),h?(this._pipelineContext=null,h.hasMoreFallbacks?(this._allFallbacksProcessed=!1,Q.d.Error("Trying next fallback."),this.defines=h.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,t(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,b||t())}get isSupported(){return""===this._compilationError}_bindTexture(p,b){this._engine._bindTexture(this._samplers[p],b,p)}setTexture(p,b){this._engine.setTexture(this._samplers[p],this._uniforms[p],b,p)}setTextureArray(p,b){const M=p+"Ex";if(-1===this._samplerList.indexOf(M+"0")){const h=this._samplerList.indexOf(p);for(let p=1;p<b.length;p++){const b=M+(p-1).toString();this._samplerList.splice(h+p,0,b)}let Q=0;for(const p of this._samplerList)this._samplers[p]=Q,Q+=1}this._engine.setTextureArray(this._samplers[p],this._uniforms[p],b,p)}bindUniformBuffer(p,b){const M=this._uniformBuffersNames[b];void 0===M||w._BaseCache[M]===p&&this._engine._features.useUBOBindingCache||(w._BaseCache[M]=p,this._engine.bindUniformBufferBase(p,M,b))}bindUniformBlock(p,b){this._engine.bindUniformBlock(this._pipelineContext,p,b)}setInt(p,b){return this._pipelineContext.setInt(p,b),this}setInt2(p,b,M){return this._pipelineContext.setInt2(p,b,M),this}setInt3(p,b,M,h){return this._pipelineContext.setInt3(p,b,M,h),this}setInt4(p,b,M,h,Q){return this._pipelineContext.setInt4(p,b,M,h,Q),this}setIntArray(p,b){return this._pipelineContext.setIntArray(p,b),this}setIntArray2(p,b){return this._pipelineContext.setIntArray2(p,b),this}setIntArray3(p,b){return this._pipelineContext.setIntArray3(p,b),this}setIntArray4(p,b){return this._pipelineContext.setIntArray4(p,b),this}setUInt(p,b){return this._pipelineContext.setUInt(p,b),this}setUInt2(p,b,M){return this._pipelineContext.setUInt2(p,b,M),this}setUInt3(p,b,M,h){return this._pipelineContext.setUInt3(p,b,M,h),this}setUInt4(p,b,M,h,Q){return this._pipelineContext.setUInt4(p,b,M,h,Q),this}setUIntArray(p,b){return this._pipelineContext.setUIntArray(p,b),this}setUIntArray2(p,b){return this._pipelineContext.setUIntArray2(p,b),this}setUIntArray3(p,b){return this._pipelineContext.setUIntArray3(p,b),this}setUIntArray4(p,b){return this._pipelineContext.setUIntArray4(p,b),this}setFloatArray(p,b){return this._pipelineContext.setArray(p,b),this}setFloatArray2(p,b){return this._pipelineContext.setArray2(p,b),this}setFloatArray3(p,b){return this._pipelineContext.setArray3(p,b),this}setFloatArray4(p,b){return this._pipelineContext.setArray4(p,b),this}setArray(p,b){return this._pipelineContext.setArray(p,b),this}setArray2(p,b){return this._pipelineContext.setArray2(p,b),this}setArray3(p,b){return this._pipelineContext.setArray3(p,b),this}setArray4(p,b){return this._pipelineContext.setArray4(p,b),this}setMatrices(p,b){return this._pipelineContext.setMatrices(p,b),this}setMatrix(p,b){return this._pipelineContext.setMatrix(p,b),this}setMatrix3x3(p,b){return this._pipelineContext.setMatrix3x3(p,b),this}setMatrix2x2(p,b){return this._pipelineContext.setMatrix2x2(p,b),this}setFloat(p,b){return this._pipelineContext.setFloat(p,b),this}setBool(p,b){return this._pipelineContext.setInt(p,b?1:0),this}setVector2(p,b){return this._pipelineContext.setVector2(p,b),this}setFloat2(p,b,M){return this._pipelineContext.setFloat2(p,b,M),this}setVector3(p,b){return this._pipelineContext.setVector3(p,b),this}setFloat3(p,b,M,h){return this._pipelineContext.setFloat3(p,b,M,h),this}setVector4(p,b){return this._pipelineContext.setVector4(p,b),this}setQuaternion(p,b){return this._pipelineContext.setQuaternion(p,b),this}setFloat4(p,b,M,h,Q){return this._pipelineContext.setFloat4(p,b,M,h,Q),this}setColor3(p,b){return this._pipelineContext.setColor3(p,b),this}setColor4(p,b,M){return this._pipelineContext.setColor4(p,b,M),this}setDirectColor4(p,b){return this._pipelineContext.setDirectColor4(p,b),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(w.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,y.n)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(p,b,M){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;b&&(mp.d.GetShadersStore(h)[`${p}PixelShader`]=b),M&&(mp.d.GetShadersStore(h)[`${p}VertexShader`]=M)}static ResetCache(){w._BaseCache={}}}w.LogShaderCodeOnCompilationError=!0,w.PersistentMode=!1,w.AutomaticallyClearCodeCache=!1,w._UniqueIdSeed=0,w._BaseCache={},w.ShadersStore=mp.d.ShadersStore,w.IncludesShadersStore=mp.d.IncludesShadersStore},12635:(p,b,M)=>{M.d(b,{b:()=>Q});const h={};function Q(p){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!h[p])return h[p]=!0,`${p} needs to be imported before as it contains a side-effect required by your code.`}},12620:(p,b,M)=>{function h(){return"undefined"!==typeof window}function Q(){return"undefined"!==typeof navigator}function mp(){return"undefined"!==typeof document}function y(p){let b="",M=p.firstChild;for(;M;)3===M.nodeType&&(b+=M.textContent),M=M.nextSibling;return b}M.d(b,{c:()=>y,g:()=>mp,k:()=>Q,o:()=>h})},12622:(p,b,M)=>{M.d(b,{d:()=>h});class h{static _CheckLimit(p,b){let M=h._LogLimitOutputs[p];return M?M.current++:(M={limit:b,current:1},h._LogLimitOutputs[p]=M),M.current<=M.limit}static _GenerateLimitMessage(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const M=h._LogLimitOutputs[p];if(!M||!h.MessageLimitReached)return;const Q=this._Levels[b];M.current===M.limit&&h[Q.name](h.MessageLimitReached.replace(/%LIMIT%/g,""+M.limit).replace(/%TYPE%/g,Q.name??""))}static _AddLogEntry(p){h._LogCache=p+h._LogCache,h.OnNewCacheEntry&&h.OnNewCacheEntry(p)}static _FormatMessage(p){const b=p=>p<10?"0"+p:""+p,M=new Date;return"["+b(M.getHours())+":"+b(M.getMinutes())+":"+b(M.getSeconds())+"]: "+p}static _LogDisabled(p,b){}static _LogEnabled(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1?arguments[1]:void 0,M=arguments.length>2?arguments[2]:void 0;const Q=Array.isArray(b)?b[0]:b;if(void 0!==M&&!h._CheckLimit(Q,M))return;const mp=h._FormatMessage(Q),y=this._Levels[p],P=Array.isArray(b)?b.slice(1):[];y.logFunc&&y.logFunc("BJS - "+mp,...P);const w=`<div style='color:${y.color}'>${mp}</div><br>`;h._AddLogEntry(w),h._GenerateLimitMessage(Q,p)}static get LogCache(){return h._LogCache}static ClearLogCache(){h._LogCache="",h._LogLimitOutputs={},h.errorsCount=0}static set LogLevels(p){h.Log=h._LogDisabled,h.Warn=h._LogDisabled,h.Error=h._LogDisabled;const b=[h.MessageLogLevel,h.WarningLogLevel,h.ErrorLogLevel];for(const M of b)if((p&M)===M){const p=this._Levels[M];h[p.name]=h._LogEnabled.bind(h,M)}}}h.NoneLogLevel=0,h.MessageLogLevel=1,h.WarningLogLevel=2,h.ErrorLogLevel=4,h.AllLogLevel=7,h.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",h._LogCache="",h._LogLimitOutputs={},h._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],h.errorsCount=0,h.Log=h._LogEnabled.bind(h,h.MessageLogLevel),h.Warn=h._LogEnabled.bind(h,h.WarningLogLevel),h.Error=h._LogEnabled.bind(h,h.ErrorLogLevel)},12617:(p,b,M)=>{M.d(b,{d:()=>y});const h="undefined"!==typeof WeakRef;class Q{constructor(p){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],M=arguments.length>2?arguments[2]:void 0,h=arguments.length>3?arguments[3]:void 0;this.initialize(p,b,M,h)}initialize(p){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],M=arguments.length>2?arguments[2]:void 0,h=arguments.length>3?arguments[3]:void 0;return this.mask=p,this.skipNextObservers=b,this.target=M,this.currentTarget=h,this}}class mp{constructor(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=p,this.mask=b,this.scope=M,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let p=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(p)}}class y{static FromPromise(p,b){const M=new y;return p.then((p=>{M.notifyObservers(p)})).catch((p=>{if(!b)throw p;b.notifyObservers(p)})),M}get observers(){return this._observers}constructor(p){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=b,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new Q(0),p&&(this._onObserverAdded=p)}add(p){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],M=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!p)return null;const Q=new mp(p,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);Q.unregisterOnNextCall=M,b?this._observers.unshift(Q):this._observers.push(Q),this._onObserverAdded&&this._onObserverAdded(Q),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(Q,this._lastNotifiedValue);const y=h?new WeakRef(this):{deref:()=>this};return Q._remove=function(){let p=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b=y.deref();b&&(p?b.remove(Q):b._remove(Q))},Q}addOnce(p){return this.add(p,void 0,void 0,void 0,!0)}remove(p){if(!p)return!1;p._remove=null;return-1!==this._observers.indexOf(p)&&(this._deferUnregister(p),!0)}removeCallback(p,b){for(let M=0;M<this._observers.length;M++){const h=this._observers[M];if(!h._willBeUnregistered&&(h.callback===p&&(!b||b===h.scope)))return this._deferUnregister(h),!0}return!1}_deferUnregister(p){p._willBeUnregistered||(this._numObserversMarkedAsDeleted++,p.unregisterOnNextCall=!1,p._willBeUnregistered=!0,setTimeout((()=>{this._remove(p)}),0))}_remove(p){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!p)return!1;const M=this._observers.indexOf(p);return-1!==M&&(b&&this._numObserversMarkedAsDeleted--,this._observers.splice(M,1),!0)}makeObserverTopPriority(p){this._remove(p,!1),this._observers.unshift(p)}makeObserverBottomPriority(p){this._remove(p,!1),this._observers.push(p)}notifyObservers(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,M=arguments.length>2?arguments[2]:void 0,h=arguments.length>3?arguments[3]:void 0,Q=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=p),!this._observers.length)return!0;const mp=this._eventState;mp.mask=b,mp.target=M,mp.currentTarget=h,mp.skipNextObservers=!1,mp.lastReturnValue=p,mp.userInfo=Q;for(const y of this._observers)if(!y._willBeUnregistered&&(y.mask&b&&(y.unregisterOnNextCall&&this._deferUnregister(y),y.scope?mp.lastReturnValue=y.callback.apply(y.scope,[p,mp]):mp.lastReturnValue=y.callback(p,mp)),mp.skipNextObservers))return!1;return!0}notifyObserver(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=b),p._willBeUnregistered)return;const h=this._eventState;h.mask=M,h.skipNextObservers=!1,p.unregisterOnNextCall&&this._deferUnregister(p),p.callback(b,h)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const p=this._observers.pop();p&&(p._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const p=new y;return p._observers=this._observers.slice(0),p}hasSpecificMask(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const b of this._observers)if(b.mask&p||b.mask===p)return!0;return!1}}},12680:(p,b,M)=>{M.d(b,{e:()=>Q,g:()=>y});let h=[];class Q{static SetImmediate(p){0===h.length&&setTimeout((()=>{const p=h;h=[];for(const b of p)b()}),1),h.push(p)}}function mp(p,b,M){try{if(p())return b(),!0}catch(h){return null===M||void 0===M||M(h),!0}return!1}const y=function(p,b,M){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,y=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&mp(p,b,M))return null;const P=setInterval((()=>{mp(p,b,M)?clearInterval(P):(Q-=h,Q<0&&(clearInterval(P),null===M||void 0===M||M(new Error("Operation timed out after maximum retries. "+(y||"")),!0)))}),h);return()=>clearInterval(P)}}}]);