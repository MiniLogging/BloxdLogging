"use strict";(self.wj3aziuz228=self.wj3aziuz228||[]).push([[9],{12362:(u,R,I)=>{I.d(R,{c:()=>Y,f:()=>q,k:()=>e,j:()=>v,o:()=>p});class B{constructor(){this.children=[]}isValid(u){return!0}process(u,R,I){let B="";if(this.line){let I=this.line;const G=R.processor;if(G){var U,K,C,D,s,t;G.lineProcessor&&(I=G.lineProcessor(I,R.isFragment,R.processingContext));const B=(null===(U=R.processor)||void 0===U?void 0:U.attributeKeywordName)??"attribute",S=R.isFragment&&null!==(K=R.processor)&&void 0!==K&&K.varyingFragmentKeywordName?null===(C=R.processor)||void 0===C?void 0:C.varyingFragmentKeywordName:!R.isFragment&&null!==(D=R.processor)&&void 0!==D&&D.varyingVertexKeywordName?null===(s=R.processor)||void 0===s?void 0:s.varyingVertexKeywordName:"varying";if(!R.isFragment&&G.attributeProcessor&&this.line.startsWith(B))I=G.attributeProcessor(this.line,u,R.processingContext);else if(G.varyingProcessor&&(null!==(t=G.varyingCheck)&&void 0!==t&&t.call(G,this.line,R.isFragment)||!G.varyingCheck&&this.line.startsWith(S)))I=G.varyingProcessor(this.line,R.isFragment,u,R.processingContext);else if(G.uniformProcessor&&G.uniformRegexp&&G.uniformRegexp.test(this.line))R.lookForClosingBracketForUniformBuffer||(I=G.uniformProcessor(this.line,R.isFragment,u,R.processingContext));else if(G.uniformBufferProcessor&&G.uniformBufferRegexp&&G.uniformBufferRegexp.test(this.line))R.lookForClosingBracketForUniformBuffer||(I=G.uniformBufferProcessor(this.line,R.isFragment,R.processingContext),R.lookForClosingBracketForUniformBuffer=!0);else if(G.textureProcessor&&G.textureRegexp&&G.textureRegexp.test(this.line))I=G.textureProcessor(this.line,R.isFragment,u,R.processingContext);else if((G.uniformProcessor||G.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!R.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?G.uniformProcessor&&(I=G.uniformProcessor(this.line,R.isFragment,u,R.processingContext)):G.uniformBufferProcessor&&(I=G.uniformBufferProcessor(this.line,R.isFragment,R.processingContext),R.lookForClosingBracketForUniformBuffer=!0)}R.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(R.lookForClosingBracketForUniformBuffer=!1,G.endOfUniformBufferProcessor&&(I=G.endOfUniformBufferProcessor(this.line,R.isFragment,R.processingContext)))}B+=I+"\n"}for(const G of this.children)B+=G.process(u,R,I);return this.additionalDefineKey&&(u[this.additionalDefineKey]=this.additionalDefineValue||"true",I[this.additionalDefineKey]=u[this.additionalDefineKey]),B}}class U{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(u){this._lines.length=0;for(const R of u){if(!R||"\r"===R)continue;if("#"===R[0]){this._lines.push(R);continue}const u=R.trim();if(!u)continue;if(u.startsWith("//")){this._lines.push(R);continue}const I=u.indexOf(";");if(-1===I)this._lines.push(u);else if(I===u.length-1)u.length>1&&this._lines.push(u);else{const u=R.split(";");for(let R=0;R<u.length;R++){let I=u[R];I&&(I=I.trim(),I&&this._lines.push(I+(R!==u.length-1?";":"")))}}}}}class K extends B{process(u,R,I){for(let B=0;B<this.children.length;B++){const U=this.children[B];if(U.isValid(u))return U.process(u,R,I)}return""}}class C extends B{isValid(u){return this.testExpression.isTrue(u)}}class D{isTrue(u){return!0}static postfixToInfix(u){const R=[];for(const I of u)if(void 0===D._OperatorPriority[I])R.push(I);else{const u=R[R.length-1],B=R[R.length-2];R.length-=2,R.push(`(${B}${I}${u})`)}return R[R.length-1]}static infixToPostfix(u){const R=D._InfixToPostfixCache.get(u);if(R)return R.accessTime=Date.now(),R.result;if(!u.includes("&&")&&!u.includes("||")&&!u.includes(")")&&!u.includes("("))return[u];const I=[];let B=-1;const U=()=>{G=G.trim(),""!==G&&(I.push(G),G="")},K=u=>{B<D._Stack.length-1&&(D._Stack[++B]=u)},C=()=>D._Stack[B],s=()=>-1===B?"!!INVALID EXPRESSION!!":D._Stack[B--];let t=0,G="";for(;t<u.length;){const R=u.charAt(t),S=t<u.length-1?u.substring(t,2+t):"";if("("===R)G="",K(R);else if(")"===R){for(U();-1!==B&&"("!==C();)I.push(s());s()}else if(D._OperatorPriority[S]>1){for(U();-1!==B&&D._OperatorPriority[C()]>=D._OperatorPriority[S];)I.push(s());K(S),t++}else G+=R;t++}for(U();-1!==B;)"("===C()?s():I.push(s());return D._InfixToPostfixCache.size>=D.InfixToPostfixCacheLimitSize&&D.ClearCache(),D._InfixToPostfixCache.set(u,{result:I,accessTime:Date.now()}),I}static ClearCache(){const u=Array.from(D._InfixToPostfixCache.entries()).sort(((u,R)=>u[1].accessTime-R[1].accessTime));for(let R=0;R<D.InfixToPostfixCacheCleanupSize;R++)D._InfixToPostfixCache.delete(u[R][0])}}D.InfixToPostfixCacheLimitSize=5e4,D.InfixToPostfixCacheCleanupSize=25e3,D._InfixToPostfixCache=new Map,D._OperatorPriority={")":0,"(":1,"||":2,"&&":3},D._Stack=["","","","","","","","","","","","","","","","","","","",""];class s extends D{constructor(u){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=u,this.not=R}isTrue(u){let R=void 0!==u[this.define];return this.not&&(R=!R),R}}class t extends D{isTrue(u){return this.leftOperand.isTrue(u)||this.rightOperand.isTrue(u)}}class G extends D{isTrue(u){return this.leftOperand.isTrue(u)&&this.rightOperand.isTrue(u)}}class S extends D{constructor(u,R,I){super(),this.define=u,this.operand=R,this.testValue=I}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(u){let R=!1;const I=parseInt(void 0!=u[this.define]?u[this.define]:this.define),B=parseInt(void 0!=u[this.testValue]?u[this.testValue]:this.testValue);if(isNaN(I)||isNaN(B))return!1;switch(this.operand){case">":R=I>B;break;case"<":R=I<B;break;case"<=":R=I<=B;break;case">=":R=I>=B;break;case"==":R=I===B;break;case"!=":R=I!==B}return R}}var b=I(12335),r=I(12371);const P=/defined\s*?\((.+?)\)/g,X=/defined\s*?\[(.+?)\]/g,E=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,z=/__decl__/,f=/light\{X\}.(\w*)/g,T=/\{X\}/g,Q=[],V=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function q(u){u.processor&&u.processor.initializeShaders&&u.processor.initializeShaders(u.processingContext)}function e(u,R,I,B){var U;null!==(U=R.processor)&&void 0!==U&&U.preProcessShaderCode&&(u=R.processor.preProcessShaderCode(u,R.isFragment)),v(u,R,(u=>{R.processCodeAfterIncludes&&(u=R.processCodeAfterIncludes(R.isFragment?"fragment":"vertex",u,R.defines));const U=function(u,R,I){let B=function(u,R){var I;if(null!==(I=R.processor)&&void 0!==I&&I.noPrecision)return u;const B=R.shouldUseHighPrecisionShader;-1===u.indexOf("precision highp float")?u=B?"precision highp float;\n"+u:"precision mediump float;\n"+u:B||(u=u.replace("precision highp float","precision mediump float"));return u}(u,R);if(!R.processor)return B;if(0===R.processor.shaderLanguage&&-1!==B.indexOf("#version 3")&&(B=B.replace("#version 300 es",""),!R.processor.parseGLES3))return B;const U=R.defines,K=g(R,I);R.processor.preProcessor&&(B=R.processor.preProcessor(B,U,K,R.isFragment,R.processingContext));const C={};B=x(B,K,R,C),R.processor.postProcessor&&(B=R.processor.postProcessor(B,U,R.isFragment,R.processingContext,I?{drawBuffersExtensionDisabled:!I.getCaps().drawBuffersExtension}:{},K,C));null!==I&&void 0!==I&&I._features.needShaderCodeInlining&&(B=I.inlineShaderCode(B));return B}(u,R,B);I(U,u)}))}function Y(u,R,I){return I.processor&&I.processor.finalizeShaders?I.processor.finalizeShaders(u,R,I.processingContext):{vertexCode:u,fragmentCode:R}}function M(u){const R=/defined\((.+)\)/.exec(u);if(R&&R.length)return new s(R[1].trim(),"!"===u[0]);const I=["==","!=",">=","<=","<",">"];let B="",U=0;for(B of I)if(U=u.indexOf(B),U>-1)break;if(-1===U)return new s(u);const K=u.substring(0,U).trim(),C=u.substring(U+B.length).trim();return new S(K,B,C)}function o(u,R){const I=new C,B=u.substring(0,R);let U=u.substring(R);return U=U.substring(0,(U.indexOf("//")+1||U.length+1)-1).trim(),I.testExpression="#ifdef"===B?new s(U):"#ifndef"===B?new s(U,!0):function(u){u=u.replace(P,"defined[$1]");const R=D.infixToPostfix(u),I=[];for(const U of R)if("||"!==U&&"&&"!==U)I.push(U);else if(I.length>=2){let u=I[I.length-1],R=I[I.length-2];I.length-=2;const B="&&"==U?new G:new t;"string"===typeof u&&(u=u.replace(X,"defined($1)")),"string"===typeof R&&(R=R.replace(X,"defined($1)")),B.leftOperand="string"===typeof R?M(R):R,B.rightOperand="string"===typeof u?M(u):u,I.push(B)}let B=I[I.length-1];return"string"===typeof B&&(B=B.replace(X,"defined($1)")),"string"===typeof B?M(B):B}(U),I}function j(u,R,I,U){let K=u.currentLine;for(;h(u,I,U);){K=u.currentLine;const C=K.substring(0,5).toLowerCase();if("#else"===C){const I=new B;return R.children.push(I),void h(u,I,U)}if("#elif"===C){const u=o(K,5);R.children.push(u),I=u}}}function h(u,R,I){for(;u.canRead;){u.lineIndex++;const U=u.currentLine;if(U.indexOf("#")>=0){const B=V.exec(U);if(B&&B.length){switch(B[0]){case"#ifdef":{const B=new K;R.children.push(B);const C=o(U,6);B.children.push(C),j(u,B,C,I);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const B=new K;R.children.push(B);const C=o(U,7);B.children.push(C),j(u,B,C,I);break}case"#if":{const B=new K,C=o(U,3);R.children.push(B),B.children.push(C),j(u,B,C,I);break}}continue}}const C=new B;if(C.line=U,R.children.push(C),"#"===U[0]&&"d"===U[1]){const u=U.replace(";","").split(" ");C.additionalDefineKey=u[1],3===u.length&&(C.additionalDefineValue=u[2])}}return!1}function x(u,R,I,K){const C=new B,D=new U;return D.lineIndex=-1,D.lines=u.split("\n"),h(D,C,K),C.process(R,I,K)}function g(u,R){var I;const B=u.defines,U={};for(const K of B){const u=K.replace("#define","").replace(";","").trim().split(" ");U[u[0]]=u.length>1?u[1]:""}return 0===(null===(I=u.processor)||void 0===I?void 0:I.shaderLanguage)&&(U.GL_ES="true"),U.__VERSION__=u.version,U[u.platformName]="true",(0,r.j)(U,null===R||void 0===R?void 0:R.isNDCHalfZRange,null===R||void 0===R?void 0:R.FC,null===R||void 0===R?void 0:R.useExactSrgbConversions),U}function v(u,R,I){let B;for(Q.length=0;null!==(B=E.exec(u));)Q.push(B);let U=String(u),K=[u],C=!1;for(const D of Q){let u=D[1];if(-1!==u.indexOf("__decl__")&&(u=u.replace(z,""),R.supportsUniformBuffers&&(u=u.replace("Vertex","Ubo").replace("Fragment","Ubo")),u+="Declaration"),!R.includesShadersStore[u]){const B=R.shadersRepository+"ShadersInclude/"+u+".fx";return void p.loadFile(B,(B=>{R.includesShadersStore[u]=B,v(K.join(""),R,I)}))}{let I=R.includesShadersStore[u];if(D[2]){const u=D[3].split(",");for(let R=0;R<u.length;R+=2){const B=new RegExp(u[R],"g"),U=u[R+1];I=I.replace(B,U)}}if(D[4]){const u=D[5];if(-1!==u.indexOf("..")){const B=u.split(".."),U=parseInt(B[0]);let K=parseInt(B[1]),C=I.slice(0);I="",isNaN(K)&&(K=R.indexParameters[B[1]]);for(let u=U;u<K;u++)R.supportsUniformBuffers||(C=C.replace(f,((u,R)=>R+"{X}"))),I+=C.replace(T,u.toString())+"\n"}else R.supportsUniformBuffers||(I=I.replace(f,((u,R)=>R+"{X}"))),I=I.replace(T,u)}const B=[];for(const u of K){const R=u.split(D[0]);for(let u=0;u<R.length-1;u++)B.push(R[u]),B.push(I);B.push(R[R.length-1])}K=B,C=C||I.indexOf("#include<")>=0||I.indexOf("#include <")>=0}}Q.length=0,U=K.join(""),C?v(U.toString(),R,I):I(U)}const p={loadFile:(u,R,I,B,U,K)=>{throw(0,b.c)("FileTools")}}},12371:(u,R,I)=>{I.d(R,{d:()=>U,f:()=>K,j:()=>D,l:()=>C,n:()=>s});var B=I(12335);I(12312);const U={};function K(u,R){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(R?R+"\n":"")+u}function C(u,R,I,K,C,D,s){const t=s||U.loadFile;if(t){return t(u,R,I,K,C,D)}throw(0,B.c)("FileTools")}function D(u,R,I,B){if(u)return R?u.IS_NDC_HALF_ZRANGE="":delete u.IS_NDC_HALF_ZRANGE,I?u.USE_REVERSE_DEPTHBUFFER="":delete u.USE_REVERSE_DEPTHBUFFER,void(B?u.USE_EXACT_SRGB_CONVERSIONS="":delete u.USE_EXACT_SRGB_CONVERSIONS);{let u="";return R&&(u+="#define IS_NDC_HALF_ZRANGE"),I&&(u&&(u+="\n"),u+="#define USE_REVERSE_DEPTHBUFFER"),B&&(u&&(u+="\n"),u+="#define USE_EXACT_SRGB_CONVERSIONS"),u}}function s(u,R){let I=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3?arguments[3]:void 0;switch(u){case 3:{const u=(ArrayBuffer,new Int8Array(R));return B&&u.set(new Int8Array(B)),u}case 0:{const u=(ArrayBuffer,new Uint8Array(R));return B&&u.set(new Uint8Array(B)),u}case 4:{const u=R instanceof ArrayBuffer?new Int16Array(R):new Int16Array(I?R/2:R);return B&&u.set(new Int16Array(B)),u}case 5:case 8:case 9:case 10:case 2:{const u=R instanceof ArrayBuffer?new Uint16Array(R):new Uint16Array(I?R/2:R);return B&&u.set(new Uint16Array(B)),u}case 6:{const u=R instanceof ArrayBuffer?new Int32Array(R):new Int32Array(I?R/4:R);return B&&u.set(new Int32Array(B)),u}case 7:case 11:case 12:case 13:case 14:case 15:{const u=R instanceof ArrayBuffer?new Uint32Array(R):new Uint32Array(I?R/4:R);return B&&u.set(new Uint32Array(B)),u}case 1:{const u=R instanceof ArrayBuffer?new Float32Array(R):new Float32Array(I?R/4:R);return B&&u.set(new Float32Array(B)),u}}const U=(ArrayBuffer,new Uint8Array(R));return B&&U.set(new Uint8Array(B)),U}},12389:(u,R,I)=>{I.d(R,{d:()=>B});class B{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?B.ShadersRepository:B.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?B.ShadersStore:B.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?B.IncludesShadersStore:B.IncludesShadersStoreWGSL}}B.ShadersRepository="src/Shaders/",B.ShadersStore={},B.IncludesShadersStore={},B.ShadersRepositoryWGSL="src/ShadersWGSL/",B.ShadersStoreWGSL={},B.IncludesShadersStoreWGSL={}},12403:(u,R,I)=>{I.d(R,{d:()=>b,h:()=>T,k:()=>P,l:()=>r,m:()=>X,p:()=>f,t:()=>S,v:()=>t,x:()=>G,B:()=>s,E:()=>D});class B{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.rR._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(u){u&&this.program&&u(this.program)}setEngine(u){this.rR=u}_fillEffectInformation(u,R,I,B,U,K,C,D){const s=this.rR;if(s.supportsUniformBuffers)for(const G in R)u.bindUniformBlock(G,R[G]);let t;for(this.rR.getUniforms(this,I).forEach(((u,R)=>{B[I[R]]=u})),this._uniforms=B,t=0;t<U.length;t++){null==u.getUniform(U[t])&&(U.splice(t,1),t--)}U.forEach(((u,R)=>{K[u]=R}));for(const G of s.getAttributes(this,C))D.push(G)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(u,R){const I=this._valueCache[u],B=R.updateFlag;return(void 0===I||I!==B)&&(this._valueCache[u]=B,!0)}_cacheFloat2(u,R,I){let B=this._valueCache[u];if(!B||2!==B.length)return B=[R,I],this._valueCache[u]=B,!0;let U=!1;return B[0]!==R&&(B[0]=R,U=!0),B[1]!==I&&(B[1]=I,U=!0),U}_cacheFloat3(u,R,I,B){let U=this._valueCache[u];if(!U||3!==U.length)return U=[R,I,B],this._valueCache[u]=U,!0;let K=!1;return U[0]!==R&&(U[0]=R,K=!0),U[1]!==I&&(U[1]=I,K=!0),U[2]!==B&&(U[2]=B,K=!0),K}_cacheFloat4(u,R,I,B,U){let K=this._valueCache[u];if(!K||4!==K.length)return K=[R,I,B,U],this._valueCache[u]=K,!0;let C=!1;return K[0]!==R&&(K[0]=R,C=!0),K[1]!==I&&(K[1]=I,C=!0),K[2]!==B&&(K[2]=B,C=!0),K[3]!==U&&(K[3]=U,C=!0),C}setInt(u,R){const I=this._valueCache[u];void 0!==I&&I===R||this.rR.setInt(this._uniforms[u],R)&&(this._valueCache[u]=R)}setInt2(u,R,I){this._cacheFloat2(u,R,I)&&(this.rR.setInt2(this._uniforms[u],R,I)||(this._valueCache[u]=null))}setInt3(u,R,I,B){this._cacheFloat3(u,R,I,B)&&(this.rR.setInt3(this._uniforms[u],R,I,B)||(this._valueCache[u]=null))}setInt4(u,R,I,B,U){this._cacheFloat4(u,R,I,B,U)&&(this.rR.setInt4(this._uniforms[u],R,I,B,U)||(this._valueCache[u]=null))}setIntArray(u,R){this._valueCache[u]=null,this.rR.setIntArray(this._uniforms[u],R)}setIntArray2(u,R){this._valueCache[u]=null,this.rR.setIntArray2(this._uniforms[u],R)}setIntArray3(u,R){this._valueCache[u]=null,this.rR.setIntArray3(this._uniforms[u],R)}setIntArray4(u,R){this._valueCache[u]=null,this.rR.setIntArray4(this._uniforms[u],R)}setUInt(u,R){const I=this._valueCache[u];void 0!==I&&I===R||this.rR.setUInt(this._uniforms[u],R)&&(this._valueCache[u]=R)}setUInt2(u,R,I){this._cacheFloat2(u,R,I)&&(this.rR.setUInt2(this._uniforms[u],R,I)||(this._valueCache[u]=null))}setUInt3(u,R,I,B){this._cacheFloat3(u,R,I,B)&&(this.rR.setUInt3(this._uniforms[u],R,I,B)||(this._valueCache[u]=null))}setUInt4(u,R,I,B,U){this._cacheFloat4(u,R,I,B,U)&&(this.rR.setUInt4(this._uniforms[u],R,I,B,U)||(this._valueCache[u]=null))}setUIntArray(u,R){this._valueCache[u]=null,this.rR.setUIntArray(this._uniforms[u],R)}setUIntArray2(u,R){this._valueCache[u]=null,this.rR.setUIntArray2(this._uniforms[u],R)}setUIntArray3(u,R){this._valueCache[u]=null,this.rR.setUIntArray3(this._uniforms[u],R)}setUIntArray4(u,R){this._valueCache[u]=null,this.rR.setUIntArray4(this._uniforms[u],R)}setArray(u,R){this._valueCache[u]=null,this.rR.setArray(this._uniforms[u],R)}setArray2(u,R){this._valueCache[u]=null,this.rR.setArray2(this._uniforms[u],R)}setArray3(u,R){this._valueCache[u]=null,this.rR.setArray3(this._uniforms[u],R)}setArray4(u,R){this._valueCache[u]=null,this.rR.setArray4(this._uniforms[u],R)}setMatrices(u,R){R&&(this._valueCache[u]=null,this.rR.setMatrices(this._uniforms[u],R))}setMatrix(u,R){this._cacheMatrix(u,R)&&(this.rR.setMatrices(this._uniforms[u],R.sD())||(this._valueCache[u]=null))}setMatrix3x3(u,R){this._valueCache[u]=null,this.rR.setMatrix3x3(this._uniforms[u],R)}setMatrix2x2(u,R){this._valueCache[u]=null,this.rR.setMatrix2x2(this._uniforms[u],R)}setFloat(u,R){const I=this._valueCache[u];void 0!==I&&I===R||this.rR.setFloat(this._uniforms[u],R)&&(this._valueCache[u]=R)}setVector2(u,R){this._cacheFloat2(u,R.x,R.y)&&(this.rR.setFloat2(this._uniforms[u],R.x,R.y)||(this._valueCache[u]=null))}setFloat2(u,R,I){this._cacheFloat2(u,R,I)&&(this.rR.setFloat2(this._uniforms[u],R,I)||(this._valueCache[u]=null))}setVector3(u,R){this._cacheFloat3(u,R.x,R.y,R.z)&&(this.rR.setFloat3(this._uniforms[u],R.x,R.y,R.z)||(this._valueCache[u]=null))}setFloat3(u,R,I,B){this._cacheFloat3(u,R,I,B)&&(this.rR.setFloat3(this._uniforms[u],R,I,B)||(this._valueCache[u]=null))}setVector4(u,R){this._cacheFloat4(u,R.x,R.y,R.z,R.w)&&(this.rR.setFloat4(this._uniforms[u],R.x,R.y,R.z,R.w)||(this._valueCache[u]=null))}setQuaternion(u,R){this._cacheFloat4(u,R.x,R.y,R.z,R.w)&&(this.rR.setFloat4(this._uniforms[u],R.x,R.y,R.z,R.w)||(this._valueCache[u]=null))}setFloat4(u,R,I,B,U){this._cacheFloat4(u,R,I,B,U)&&(this.rR.setFloat4(this._uniforms[u],R,I,B,U)||(this._valueCache[u]=null))}setColor3(u,R){this._cacheFloat3(u,R.r,R.g,R.b)&&(this.rR.setFloat3(this._uniforms[u],R.r,R.g,R.b)||(this._valueCache[u]=null))}setColor4(u,R,I){this._cacheFloat4(u,R.r,R.g,R.b,I)&&(this.rR.setFloat4(this._uniforms[u],R.r,R.g,R.b,I)||(this._valueCache[u]=null))}setDirectColor4(u,R){this._cacheFloat4(u,R.r,R.g,R.b,R.a)&&(this.rR.setFloat4(this._uniforms[u],R.r,R.g,R.b,R.a)||(this._valueCache[u]=null))}_getVertexShaderCode(){return this.vertexShader?this.rR._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.rR._getShaderSource(this.fragmentShader):null}}var U=I(12371);const K=new WeakMap,C={_webGLVersion:2,cachedPipelines:{}};function D(u){let R=K.get(u);if(!R){if(!u)return C;R={_webGLVersion:u.TEXTURE_BINDING_3D?2:1,_context:u,parallelShaderCompile:u.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},K.set(u,R)}return R}function s(u){K.delete(u)}function t(u,R,I,B,U,K){const C=D(B);K||(K=C._createShaderProgramInjection??b);return K(u,z(R,"vertex",B,C._contextWasLost),z(I,"fragment",B,C._contextWasLost),B,U,C.validateShaderPrograms)}function G(u,R,I,B,U){let K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6?arguments[6]:void 0;const s=D(U);C||(C=s._createShaderProgramInjection??b);const t=s._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return C(u,E(R,"vertex",B,t,U,s._contextWasLost),E(I,"fragment",B,t,U,s._contextWasLost),U,K,s.validateShaderPrograms)}function S(u,R){const I=new B,U=D(u);return U.parallelShaderCompile&&!U.disableParallelShaderCompile&&(I.isParallelCompiled=!0),I.context=U._context,I}function b(u,R,I,B){let U=arguments.length>5?arguments[5]:void 0;const K=B.createProgram();if(u.program=K,!K)throw new Error("Unable to create program");return B.attachShader(K,R),B.attachShader(K,I),B.linkProgram(K),u.context=B,u.vertexShader=R,u.fragmentShader=I,u.isParallelCompiled||P(u,B,U),K}function r(u,R,I){const B=u;if(B._isDisposed)return!1;const U=D(R);return!!(U&&U.parallelShaderCompile&&U.parallelShaderCompile.COMPLETION_STATUS_KHR&&B.program&&R.getProgramParameter(B.program,U.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(P(B,R,I),!0)}function P(u,R,I){const B=u.context,U=u.vertexShader,K=u.fragmentShader,C=u.program;if(!B.getProgramParameter(C,B.LINK_STATUS)){if(!R.getShaderParameter(U,R.COMPILE_STATUS)){const I=R.getShaderInfoLog(U);if(I)throw u.vertexCompilationError=I,new Error("VERTEX SHADER "+I)}if(!R.getShaderParameter(K,R.COMPILE_STATUS)){const I=R.getShaderInfoLog(K);if(I)throw u.fragmentCompilationError=I,new Error("FRAGMENT SHADER "+I)}const I=B.getProgramInfoLog(C);if(I)throw u.programLinkError=I,new Error(I)}if(I){B.validateProgram(C);if(!B.getProgramParameter(C,B.VALIDATE_STATUS)){const R=B.getProgramInfoLog(C);if(R)throw u.programValidationError=R,new Error(R)}}B.deleteShader(U),B.deleteShader(K),u.vertexShader=void 0,u.fragmentShader=void 0,u.onCompiled&&(u.onCompiled(),u.onCompiled=void 0)}function X(u,R,I,B,U,K,C,s,S){let b=arguments.length>10?arguments[10]:void 0,r=arguments.length>11?arguments[11]:void 0,P=arguments.length>12?arguments[12]:void 0;const X=D(u.context);r||(r=X.createRawShaderProgramInjection??t),P||(P=X.createShaderProgramInjection??G);const E=u;E.program=B?r(E,R,I,E.context,S):P(E,R,I,s,E.context,S),E.program.__SPECTOR_rebuildProgram=C,b()}function E(u,R,I,B,K,C){return z((0,U.f)(u,I,B),R,K,C)}function z(u,R,I,B){const U=I.createShader("vertex"===R?I.VERTEX_SHADER:I.FRAGMENT_SHADER);if(!U){let u=I.NO_ERROR,U=I.NO_ERROR;for(;(U=I.getError())!==I.NO_ERROR;)u=U;throw new Error(`Something went wrong while creating a gl ${R} shader object. gl error=${u}, gl isContextLost=${I.isContextLost()}, _contextWasLost=${B}`)}return I.shaderSource(U,u),I.compileShader(U),U}function f(u,R){R.useProgram(u)}function T(u,R){const I=u;if(!I.isParallelCompiled)return void R(u);const B=I.onCompiled;I.onCompiled=()=>{null===B||void 0===B||B(),R(u)}}},12397:(u,R,I)=>{I.d(R,{c:()=>S,d:()=>r,h:()=>t,k:()=>G});var B=I(12312),U=I(12403),K=I(12389),C=I(12315),D=I(12362),s=I(12371);function t(u,R){return(0,U.E)(R).cachedPipelines[u]}function G(u){const R=u._name,I=u.context;if(R&&I){const u=(0,U.E)(I),B=u.cachedPipelines[R];null===B||void 0===B||B.dispose(),delete u.cachedPipelines[R]}}function S(u,R,I,U,K,C,s){let t,G;const S=(0,B.h)()?null===C||void 0===C?void 0:C.getHostDocument():null;t="string"===typeof R?R:R.vertexSource?"source:"+R.vertexSource:R.vertexElement?(null===S||void 0===S?void 0:S.getElementById(R.vertexElement))||R.vertexElement:R.vertex||R,G="string"===typeof R?R:R.fragmentSource?"source:"+R.fragmentSource:R.fragmentElement?(null===S||void 0===S?void 0:S.getElementById(R.fragmentElement))||R.fragmentElement:R.fragment||R;const r=[void 0,void 0],P=()=>{if(r[0]&&r[1]){u.isFragment=!0;const[B,t]=r;(0,D.k)(t,u,((C,t)=>{s&&(s._fragmentSourceCodeBeforeMigration=t),I&&(C=I("fragment",C));const G=(0,D.c)(B,C,u);u=null;const S=function(u,R,I,B){if(I){return{vertexSourceCode:(1===B?"//":"")+"#define SHADER_NAME vertex:"+(I.vertexElement||I.vertex||I.spectorName||I)+"\n"+u,fragmentSourceCode:(1===B?"//":"")+"#define SHADER_NAME fragment:"+(I.fragmentElement||I.fragment||I.spectorName||I)+"\n"+R}}return{vertexSourceCode:u,fragmentSourceCode:R}}(G.vertexCode,G.fragmentCode,R,K);null===U||void 0===U||U(S.vertexSourceCode,S.fragmentSourceCode)}),C)}};b(t,"Vertex","",(R=>{(0,D.f)(u),(0,D.k)(R,u,((u,B)=>{s&&(s._rawVertexSourceCode=R,s._vertexSourceCodeBeforeMigration=B),I&&(u=I("vertex",u)),r[0]=u,P()}),C)}),K),b(G,"Fragment","Pixel",(u=>{s&&(s._rawFragmentSourceCode=u),r[1]=u,P()}),K)}function b(u,R,I,U,C,D){if("undefined"!==typeof HTMLElement&&u instanceof HTMLElement){return void U((0,B.c)(u))}if("source:"===u.substring(0,7))return void U(u.substring(7));if("base64:"===u.substring(0,7)){return void U(window.atob(u.substring(7)))}const t=K.d.GetShadersStore(C);if(t[u+R+"Shader"])return void U(t[u+R+"Shader"]);if(I&&t[u+I+"Shader"])return void U(t[u+I+"Shader"]);let G;if(G="."===u[0]||"/"===u[0]||u.indexOf("http")>-1?u:K.d.GetShadersRepository(C)+u,!(D=D||s.l))throw new Error("loadFileInjection is not defined");D(G+"."+R.toLowerCase()+".fx",U)}const r=(u,R,I,B)=>{try{const K=u.context?(0,U.E)(u.context):null;K&&(K.disableParallelShaderCompile=u.disableParallelCompilation);const C=u.existingPipelineContext||R(u.shaderProcessingContext);return C._name=u.name,u.name&&K&&(K.cachedPipelines[u.name]=C),I(C,u.vertex,u.fragment,!!u.createAsRaw,"","",u.rebuildRebind,u.defines,u.transformFeedbackVaryings,"",(()=>{B(C,(()=>{var R;null===(R=u.onRenderingStateCompiled)||void 0===R||R.call(u,C)}))})),C}catch(K){throw C.b.Error("Error compiling effect"),K}}},12386:(u,R,I)=>{I.r(R),I.d(R,{Effect:()=>s});var B=I(12303),U=I(12315),K=I(12389),C=I(12397),D=I(12374);class s{static get ShadersRepository(){return K.d.ShadersRepository}static set ShadersRepository(u){K.d.ShadersRepository=u}get C(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new B.c),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(u,R,I){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,K=arguments.length>4?arguments[4]:void 0,D=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,b=arguments.length>9?arguments[9]:void 0,r=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",P=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,X=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new B.c,this.onErrorObservable=new B.c,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=u,this._key=r;const E=this._key.replace(/\r/g,"").replace(/\n/g,"|");let z;if(R.attributes){const u=R;if(this._engine=I,this._attributesNames=u.attributes,this._uniformsNames=u.uniformsNames.concat(u.samplers),this._samplerList=u.samplers.slice(),this.defines=u.defines,this.onError=u.onError,this.onCompiled=u.onCompiled,this._fallbacks=u.fallbacks,this._indexParameters=u.indexParameters,this._transformFeedbackVaryings=u.transformFeedbackVaryings||null,this._multiTarget=!!u.multiTarget,this._shaderLanguage=u.shaderLanguage??0,this._disableParallelShaderCompilation=!!u.disableParallelShaderCompilation,u.uniformBuffersNames){this._uniformBuffersNamesList=u.uniformBuffersNames.slice();for(let R=0;R<u.uniformBuffersNames.length;R++)this._uniformBuffersNames[u.uniformBuffersNames[R]]=R}this._processFinalCode=u.processFinalCode??null,this._processCodeAfterIncludes=u.processCodeAfterIncludes??void 0,X=u.extraInitializationsAsync,z=u.existingPipelineContext}else this._engine=K,this.defines=null==D?"":D,this._uniformsNames=I.concat(U),this._samplerList=U?U.slice():[],this._attributesNames=R,this._uniformBuffersNamesList=[],this._shaderLanguage=P,this.onError=S,this.onCompiled=G,this._indexParameters=b,this._fallbacks=t;"WEBGL2"===this._engine.shaderPlatformName&&(z=(0,C.h)(E,this._engine._gl)??z),this._attributeLocationByName={},this.uniqueId=s._UniqueIdSeed++,z?(this._pipelineContext=z,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,X),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.C||this.dispose(!0)}))}async _processShaderCodeAsync(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3?arguments[3]:void 0;B&&await B(),this._processingContext=I||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const U={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:u??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:K.d.GetShadersRepository(this._shaderLanguage),includesShadersStore:K.d.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,FC:this._engine.FC,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,C.c)(U,this.name,this._processFinalCode,((u,I)=>{this._vertexSourceCode=u,this._fragmentSourceCode=I,this._prepareEffect(R)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.C||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(u){return this._attributes[u]}getAttributeLocationByName(u){return this._attributeLocationByName[u]}getAttributesCount(){return this._attributes.length}getUniformIndex(u){return this._uniformsNames.indexOf(u)}getUniform(u){return this._uniforms[u]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((u=>{this.executeWhenCompiled(u)}))}executeWhenCompiled(u){this.isReady()?u(this):(this.onCompileObservable.add((R=>{u(R)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(u){(0,D.h)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(R=>{this._processCompilationErrors(R,u)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var u;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(u=this._pipelineContext)||void 0===u?void 0:u._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var u;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(u=this._pipelineContext)||void 0===u?void 0:u._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,FC:this._engine.FC,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(u,R,I,B){this._isReady=!1,this._vertexSourceCodeOverride=u,this._fragmentSourceCodeOverride=R,this.onError=(u,R)=>{B&&B(R)},this.onCompiled=()=>{var u,R;const B=this.getEngine().scenes;if(B)for(let I=0;I<B.length;I++)B[I].markAllMaterialsAsDirty(127);null===(u=(R=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===u||u.call(R,I)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(u){if(this._pipelineContext=u,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let R=0;R<this._attributesNames.length;R++){const u=this._attributesNames[R];this._attributeLocationByName[u]=this._attributes[R]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),s.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const R=this._pipelineContext;this._isReady=!1;try{const I=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),B=I?null:this.defines,U=I?this._vertexSourceCodeOverride:this._vertexSourceCode,K=I?this._fragmentSourceCodeOverride:this._fragmentSourceCode,D=this._engine;this._pipelineContext=(0,C.d)({existingPipelineContext:u?R:null,vertex:U,fragment:K,context:"WEBGL2"===D.shaderPlatformName||"WEBGL1"===D.shaderPlatformName?D._gl:void 0,rebuildRebind:(u,R,I,B)=>this._rebuildProgram(u,R,I,B),defines:B,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:I,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:I=>{R&&!u&&this._engine._deletePipelineContext(R),I&&this._onRenderingStateCompiled(I)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(R)}catch(I){this._processCompilationErrors(I,R)}}_getShaderCodeAndErrorLine(u,R,I){const B=I?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let U=null;if(R&&u){const K=R.match(B);if(K&&2===K.length){const R=parseInt(K[1]),B=u.split("\n",-1);B.length>=R&&(U=`Offending line [${R}] in ${I?"fragment":"vertex"} code: ${B[R-1]}`)}}return[u,U]}_processCompilationErrors(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=u.message;const I=this._attributesNames,B=this._fallbacks;if(U.b.Error("Unable to compile effect:"),U.b.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),U.b.Error(`Attributes: ${I.join(" ")}`),U.b.Error("Defines:\n"+this.defines),s.LogShaderCodeOnCompilationError){var K,C;let u=null,R=null,I=null;var D;if(null!==(K=this._pipelineContext)&&void 0!==K&&K._getVertexShaderCode()&&([I,u]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),I&&(U.b.Error("Vertex code:"),U.b.Error(I))),null!==(C=this._pipelineContext)&&void 0!==C&&C._getFragmentShaderCode())[I,R]=this._getShaderCodeAndErrorLine(null===(D=this._pipelineContext)||void 0===D?void 0:D._getFragmentShaderCode(),this._compilationError,!0),I&&(U.b.Error("Fragment code:"),U.b.Error(I));u&&U.b.Error(u),R&&U.b.Error(R)}U.b.Error("Error: "+this._compilationError);const t=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};R&&(this._pipelineContext=R,this._isReady=!0,t()),B?(this._pipelineContext=null,B.hasMoreFallbacks?(this._allFallbacksProcessed=!1,U.b.Error("Trying next fallback."),this.defines=B.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,t(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,R||t())}get isSupported(){return""===this._compilationError}_bindTexture(u,R){this._engine._bindTexture(this._samplers[u],R,u)}setTexture(u,R){this._engine.setTexture(this._samplers[u],this._uniforms[u],R,u)}setTextureArray(u,R){const I=u+"Ex";if(-1===this._samplerList.indexOf(I+"0")){const B=this._samplerList.indexOf(u);for(let u=1;u<R.length;u++){const R=I+(u-1).toString();this._samplerList.splice(B+u,0,R)}let U=0;for(const u of this._samplerList)this._samplers[u]=U,U+=1}this._engine.setTextureArray(this._samplers[u],this._uniforms[u],R,u)}bindUniformBuffer(u,R){const I=this._uniformBuffersNames[R];void 0===I||s._BaseCache[I]===u&&this._engine._features.useUBOBindingCache||(s._BaseCache[I]=u,this._engine.bindUniformBufferBase(u,I,R))}bindUniformBlock(u,R){this._engine.bindUniformBlock(this._pipelineContext,u,R)}setInt(u,R){return this._pipelineContext.setInt(u,R),this}setInt2(u,R,I){return this._pipelineContext.setInt2(u,R,I),this}setInt3(u,R,I,B){return this._pipelineContext.setInt3(u,R,I,B),this}setInt4(u,R,I,B,U){return this._pipelineContext.setInt4(u,R,I,B,U),this}setIntArray(u,R){return this._pipelineContext.setIntArray(u,R),this}setIntArray2(u,R){return this._pipelineContext.setIntArray2(u,R),this}setIntArray3(u,R){return this._pipelineContext.setIntArray3(u,R),this}setIntArray4(u,R){return this._pipelineContext.setIntArray4(u,R),this}setUInt(u,R){return this._pipelineContext.setUInt(u,R),this}setUInt2(u,R,I){return this._pipelineContext.setUInt2(u,R,I),this}setUInt3(u,R,I,B){return this._pipelineContext.setUInt3(u,R,I,B),this}setUInt4(u,R,I,B,U){return this._pipelineContext.setUInt4(u,R,I,B,U),this}setUIntArray(u,R){return this._pipelineContext.setUIntArray(u,R),this}setUIntArray2(u,R){return this._pipelineContext.setUIntArray2(u,R),this}setUIntArray3(u,R){return this._pipelineContext.setUIntArray3(u,R),this}setUIntArray4(u,R){return this._pipelineContext.setUIntArray4(u,R),this}setFloatArray(u,R){return this._pipelineContext.setArray(u,R),this}setFloatArray2(u,R){return this._pipelineContext.setArray2(u,R),this}setFloatArray3(u,R){return this._pipelineContext.setArray3(u,R),this}setFloatArray4(u,R){return this._pipelineContext.setArray4(u,R),this}setArray(u,R){return this._pipelineContext.setArray(u,R),this}setArray2(u,R){return this._pipelineContext.setArray2(u,R),this}setArray3(u,R){return this._pipelineContext.setArray3(u,R),this}setArray4(u,R){return this._pipelineContext.setArray4(u,R),this}setMatrices(u,R){return this._pipelineContext.setMatrices(u,R),this}setMatrix(u,R){return this._pipelineContext.setMatrix(u,R),this}setMatrix3x3(u,R){return this._pipelineContext.setMatrix3x3(u,R),this}setMatrix2x2(u,R){return this._pipelineContext.setMatrix2x2(u,R),this}setFloat(u,R){return this._pipelineContext.setFloat(u,R),this}setBool(u,R){return this._pipelineContext.setInt(u,R?1:0),this}setVector2(u,R){return this._pipelineContext.setVector2(u,R),this}setFloat2(u,R,I){return this._pipelineContext.setFloat2(u,R,I),this}setVector3(u,R){return this._pipelineContext.setVector3(u,R),this}setFloat3(u,R,I,B){return this._pipelineContext.setFloat3(u,R,I,B),this}setVector4(u,R){return this._pipelineContext.setVector4(u,R),this}setQuaternion(u,R){return this._pipelineContext.setQuaternion(u,R),this}setFloat4(u,R,I,B,U){return this._pipelineContext.setFloat4(u,R,I,B,U),this}setColor3(u,R){return this._pipelineContext.setColor3(u,R),this}setColor4(u,R,I){return this._pipelineContext.setColor4(u,R,I),this}setDirectColor4(u,R){return this._pipelineContext.setDirectColor4(u,R),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(s.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,C.k)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(u,R,I){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;R&&(K.d.GetShadersStore(B)[`${u}PixelShader`]=R),I&&(K.d.GetShadersStore(B)[`${u}VertexShader`]=I)}static ResetCache(){s._BaseCache={}}}s.LogShaderCodeOnCompilationError=!0,s.PersistentMode=!1,s.AutomaticallyClearCodeCache=!1,s._UniqueIdSeed=0,s._BaseCache={},s.ShadersStore=K.d.ShadersStore,s.IncludesShadersStore=K.d.IncludesShadersStore},12335:(u,R,I)=>{I.d(R,{c:()=>U});const B={};function U(u){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!B[u])return B[u]=!0,`${u} needs to be imported before as it contains a side-effect required by your code.`}},12312:(u,R,I)=>{function B(){return"undefined"!==typeof window}function U(){return"undefined"!==typeof navigator}function K(){return"undefined"!==typeof document}function C(u){let R="",I=u.firstChild;for(;I;)3===I.nodeType&&(R+=I.textContent),I=I.nextSibling;return R}I.d(R,{c:()=>C,e:()=>K,g:()=>U,h:()=>B})},12315:(u,R,I)=>{I.d(R,{b:()=>B});class B{static _CheckLimit(u,R){let I=B._LogLimitOutputs[u];return I?I.current++:(I={limit:R,current:1},B._LogLimitOutputs[u]=I),I.current<=I.limit}static _GenerateLimitMessage(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const I=B._LogLimitOutputs[u];if(!I||!B.MessageLimitReached)return;const U=this._Levels[R];I.current===I.limit&&B[U.name](B.MessageLimitReached.replace(/%LIMIT%/g,""+I.limit).replace(/%TYPE%/g,U.name??""))}static _AddLogEntry(u){B._LogCache=u+B._LogCache,B.OnNewCacheEntry&&B.OnNewCacheEntry(u)}static _FormatMessage(u){const R=u=>u<10?"0"+u:""+u,I=new Date;return"["+R(I.getHours())+":"+R(I.getMinutes())+":"+R(I.getSeconds())+"]: "+u}static _LogDisabled(u,R){}static _LogEnabled(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,R=arguments.length>1?arguments[1]:void 0,I=arguments.length>2?arguments[2]:void 0;const U=Array.isArray(R)?R[0]:R;if(void 0!==I&&!B._CheckLimit(U,I))return;const K=B._FormatMessage(U),C=this._Levels[u],D=Array.isArray(R)?R.slice(1):[];C.logFunc&&C.logFunc("BJS - "+K,...D);const s=`<div style='color:${C.color}'>${K}</div><br>`;B._AddLogEntry(s),B._GenerateLimitMessage(U,u)}static get LogCache(){return B._LogCache}static ClearLogCache(){B._LogCache="",B._LogLimitOutputs={},B.errorsCount=0}static set LogLevels(u){B.Log=B._LogDisabled,B.Warn=B._LogDisabled,B.Error=B._LogDisabled;const R=[B.MessageLogLevel,B.WarningLogLevel,B.ErrorLogLevel];for(const I of R)if((u&I)===I){const u=this._Levels[I];B[u.name]=B._LogEnabled.bind(B,I)}}}B.NoneLogLevel=0,B.MessageLogLevel=1,B.WarningLogLevel=2,B.ErrorLogLevel=4,B.AllLogLevel=7,B.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",B._LogCache="",B._LogLimitOutputs={},B._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],B.errorsCount=0,B.Log=B._LogEnabled.bind(B,B.MessageLogLevel),B.Warn=B._LogEnabled.bind(B,B.WarningLogLevel),B.Error=B._LogEnabled.bind(B,B.ErrorLogLevel)},12303:(u,R,I)=>{I.d(R,{c:()=>C});const B="undefined"!==typeof WeakRef;class U{constructor(u){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2?arguments[2]:void 0,B=arguments.length>3?arguments[3]:void 0;this.initialize(u,R,I,B)}initialize(u){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],I=arguments.length>2?arguments[2]:void 0,B=arguments.length>3?arguments[3]:void 0;return this.mask=u,this.skipNextObservers=R,this.target=I,this.currentTarget=B,this}}class K{constructor(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=u,this.mask=R,this.scope=I,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(u)}}class C{static FromPromise(u,R){const I=new C;return u.then((u=>{I.notifyObservers(u)})).catch((u=>{if(!R)throw u;R.notifyObservers(u)})),I}get observers(){return this._observers}constructor(u){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=R,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new U(0),u&&(this._onObserverAdded=u)}add(u){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],I=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!u)return null;const U=new K(u,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);U.unregisterOnNextCall=I,R?this._observers.unshift(U):this._observers.push(U),this._onObserverAdded&&this._onObserverAdded(U),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(U,this._lastNotifiedValue);const C=B?new WeakRef(this):{deref:()=>this};return U._remove=function(){let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const R=C.deref();R&&(u?R.remove(U):R._remove(U))},U}addOnce(u){return this.add(u,void 0,void 0,void 0,!0)}remove(u){if(!u)return!1;u._remove=null;return-1!==this._observers.indexOf(u)&&(this._deferUnregister(u),!0)}removeCallback(u,R){for(let I=0;I<this._observers.length;I++){const B=this._observers[I];if(!B._willBeUnregistered&&(B.callback===u&&(!R||R===B.scope)))return this._deferUnregister(B),!0}return!1}_deferUnregister(u){u._willBeUnregistered||(this._numObserversMarkedAsDeleted++,u.unregisterOnNextCall=!1,u._willBeUnregistered=!0,setTimeout((()=>{this._remove(u)}),0))}_remove(u){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!u)return!1;const I=this._observers.indexOf(u);return-1!==I&&(R&&this._numObserversMarkedAsDeleted--,this._observers.splice(I,1),!0)}makeObserverTopPriority(u){this._remove(u,!1),this._observers.unshift(u)}makeObserverBottomPriority(u){this._remove(u,!1),this._observers.push(u)}notifyObservers(u){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,I=arguments.length>2?arguments[2]:void 0,B=arguments.length>3?arguments[3]:void 0,U=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=u),!this._observers.length)return!0;const K=this._eventState;K.mask=R,K.target=I,K.currentTarget=B,K.skipNextObservers=!1,K.lastReturnValue=u,K.userInfo=U;for(const C of this._observers)if(!C._willBeUnregistered&&(C.mask&R&&(C.unregisterOnNextCall&&this._deferUnregister(C),C.scope?K.lastReturnValue=C.callback.apply(C.scope,[u,K]):K.lastReturnValue=C.callback(u,K)),K.skipNextObservers))return!1;return!0}notifyObserver(u,R){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=R),u._willBeUnregistered)return;const B=this._eventState;B.mask=I,B.skipNextObservers=!1,u.unregisterOnNextCall&&this._deferUnregister(u),u.callback(R,B)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const u=this._observers.pop();u&&(u._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const u=new C;return u._observers=this._observers.slice(0),u}hasSpecificMask(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const R of this._observers)if(R.mask&u||R.mask===u)return!0;return!1}}},12374:(u,R,I)=>{I.d(R,{d:()=>U,h:()=>C});let B=[];class U{static SetImmediate(u){0===B.length&&setTimeout((()=>{const u=B;B=[];for(const R of u)R()}),1),B.push(u)}}function K(u,R,I){try{if(u())return R(),!0}catch(B){return null===I||void 0===I||I(B),!0}return!1}const C=function(u,R,I){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,C=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&K(u,R,I))return null;const D=setInterval((()=>{K(u,R,I)?clearInterval(D):(U-=B,U<0&&(clearInterval(D),null===I||void 0===I||I(new Error("Operation timed out after maximum retries. "+(C||"")),!0)))}),B);return()=>clearInterval(D)}}}]);