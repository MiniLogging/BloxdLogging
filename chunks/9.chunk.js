"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[9],{2162:(j,H,s)=>{s.r(H),s.d(H,{Dispose:()=>p,DumpData:()=>x,DumpDataAsync:()=>U,DumpFramebuffer:()=>L,DumpTools:()=>a});var i=s(2068),B=s(504),e=s(708),k=s(545);let V,C=null;async function L(j,H,s,i){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",e=arguments.length>5?arguments[5]:void 0,k=arguments.length>6?arguments[6]:void 0;const V=await s.readPixels(0,0,j,H);x(j,H,new Uint8Array(V.buffer),i,B,e,!0,void 0,k)}function U(j,H,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",B=arguments.length>4?arguments[4]:void 0,e=arguments.length>5&&void 0!==arguments[5]&&arguments[5],k=arguments.length>6&&void 0!==arguments[6]&&arguments[6],V=arguments.length>7?arguments[7]:void 0;return new Promise((C=>{x(j,H,s,(j=>C(j)),i,B,e,k,V)}))}function x(j,H,L,U){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",a=arguments.length>5?arguments[5]:void 0,E=arguments.length>6&&void 0!==arguments[6]&&arguments[6],r=arguments.length>7&&void 0!==arguments[7]&&arguments[7],q=arguments.length>8?arguments[8]:void 0;(async function(){return C||(C=new Promise(((j,H)=>{let B,e=null;const C={$i:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};s.e(22).then(s.bind(s,11604)).then((L=>{let{ThinEngine:U}=L;try{B=new OffscreenCanvas(100,100),e=new U(B,!1,C)}catch(a){B=document.createElement("canvas"),e=new U(B,!1,C)}k.c.Instances.pop(),k.c.OnEnginesDisposedObservable.add((j=>{e&&j!==e&&!e.u&&0===k.c.Instances.length&&p()})),e.getCaps().parallelShaderCompile=void 0;const x=new i.d(e);s.e(33).then(s.bind(s,12565)).then((s=>{let{passPixelShader:k}=s;if(!e)return void H("Engine is not defined");const C=new i.h({Sj:e,name:k.name,fragmentShader:k.shader,samplerNames:["textureSampler"]});V={canvas:B,Sj:e,renderer:x,wrapper:C},j(V)}))})).catch(H)}))),await C})().then((s=>{if(s.Sj.setSize(j,H,!0),L instanceof Float32Array){const j=new Uint8Array(L.length);let H=L.length;for(;H--;){const s=L[H];j[H]=Math.round(255*(0,e.e)(s))}L=j}const i=s.Sj.createRawTexture(L,j,H,5,!1,!E,1);s.renderer.setViewport(),s.renderer.applyEffectWrapper(s.wrapper),s.wrapper.effect._bindTexture("textureSampler",i),s.renderer.draw(),r?B.f.ToBlob(s.canvas,(j=>{const H=new FileReader;H.onload=j=>{const H=j.target.result;U&&U(H)},H.readAsArrayBuffer(j)}),x,q):B.f.EncodeScreenshotCanvasData(s.canvas,U,x,a,q),i.dispose()}))}function p(){var j;V?(V.wrapper.dispose(),V.renderer.dispose(),V.Sj.dispose()):null===(j=C)||void 0===j||j.then((j=>{j.wrapper.dispose(),j.renderer.dispose(),j.Sj.dispose()}));C=null,V=null}const a={DumpData:x,DumpDataAsync:U,DumpFramebuffer:L,Dispose:p};B.f.DumpData=x,B.f.DumpDataAsync=U,B.f.DumpFramebuffer=L}}]);